function _Ee(n,e){for(var i=0;i<e.length;i++){const o=e[i];if(typeof o!="string"&&!Array.isArray(o)){for(const l in o)if(l!=="default"&&!(l in n)){const u=Object.getOwnPropertyDescriptor(o,l);u&&Object.defineProperty(n,l,u.get?u:{enumerable:!0,get:()=>o[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var Py=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Hg(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var OM={exports:{}},zT={},kM={exports:{}},Dr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jK;function yEe(){if(jK)return Dr;jK=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),f=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),R=Symbol.iterator;function O(be){return be===null||typeof be!="object"?null:(be=R&&be[R]||be["@@iterator"],typeof be=="function"?be:null)}var L={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},D=Object.assign,U={};function B(be,xe,je){this.props=be,this.context=xe,this.refs=U,this.updater=je||L}B.prototype.isReactComponent={},B.prototype.setState=function(be,xe){if(typeof be!="object"&&typeof be!="function"&&be!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,be,xe,"setState")},B.prototype.forceUpdate=function(be){this.updater.enqueueForceUpdate(this,be,"forceUpdate")};function Y(){}Y.prototype=B.prototype;function W(be,xe,je){this.props=be,this.context=xe,this.refs=U,this.updater=je||L}var ne=W.prototype=new Y;ne.constructor=W,D(ne,B.prototype),ne.isPureReactComponent=!0;var le=Array.isArray,re=Object.prototype.hasOwnProperty,me={current:null},q={key:!0,ref:!0,__self:!0,__source:!0};function J(be,xe,je){var nt,dt={},ft=null,lt=null;if(xe!=null)for(nt in xe.ref!==void 0&&(lt=xe.ref),xe.key!==void 0&&(ft=""+xe.key),xe)re.call(xe,nt)&&!q.hasOwnProperty(nt)&&(dt[nt]=xe[nt]);var gt=arguments.length-2;if(gt===1)dt.children=je;else if(1<gt){for(var at=Array(gt),Ct=0;Ct<gt;Ct++)at[Ct]=arguments[Ct+2];dt.children=at}if(be&&be.defaultProps)for(nt in gt=be.defaultProps,gt)dt[nt]===void 0&&(dt[nt]=gt[nt]);return{$$typeof:n,type:be,key:ft,ref:lt,props:dt,_owner:me.current}}function Q(be,xe){return{$$typeof:n,type:be.type,key:xe,ref:be.ref,props:be.props,_owner:be._owner}}function ie(be){return typeof be=="object"&&be!==null&&be.$$typeof===n}function pe(be){var xe={"=":"=0",":":"=2"};return"$"+be.replace(/[=:]/g,function(je){return xe[je]})}var de=/\/+/g;function he(be,xe){return typeof be=="object"&&be!==null&&be.key!=null?pe(""+be.key):xe.toString(36)}function Se(be,xe,je,nt,dt){var ft=typeof be;(ft==="undefined"||ft==="boolean")&&(be=null);var lt=!1;if(be===null)lt=!0;else switch(ft){case"string":case"number":lt=!0;break;case"object":switch(be.$$typeof){case n:case e:lt=!0}}if(lt)return lt=be,dt=dt(lt),be=nt===""?"."+he(lt,0):nt,le(dt)?(je="",be!=null&&(je=be.replace(de,"$&/")+"/"),Se(dt,xe,je,"",function(Ct){return Ct})):dt!=null&&(ie(dt)&&(dt=Q(dt,je+(!dt.key||lt&&lt.key===dt.key?"":(""+dt.key).replace(de,"$&/")+"/")+be)),xe.push(dt)),1;if(lt=0,nt=nt===""?".":nt+":",le(be))for(var gt=0;gt<be.length;gt++){ft=be[gt];var at=nt+he(ft,gt);lt+=Se(ft,xe,je,at,dt)}else if(at=O(be),typeof at=="function")for(be=at.call(be),gt=0;!(ft=be.next()).done;)ft=ft.value,at=nt+he(ft,gt++),lt+=Se(ft,xe,je,at,dt);else if(ft==="object")throw xe=String(be),Error("Objects are not valid as a React child (found: "+(xe==="[object Object]"?"object with keys {"+Object.keys(be).join(", ")+"}":xe)+"). If you meant to render a collection of children, use an array instead.");return lt}function Ie(be,xe,je){if(be==null)return be;var nt=[],dt=0;return Se(be,nt,"","",function(ft){return xe.call(je,ft,dt++)}),nt}function Fe(be){if(be._status===-1){var xe=be._result;xe=xe(),xe.then(function(je){(be._status===0||be._status===-1)&&(be._status=1,be._result=je)},function(je){(be._status===0||be._status===-1)&&(be._status=2,be._result=je)}),be._status===-1&&(be._status=0,be._result=xe)}if(be._status===1)return be._result.default;throw be._result}var we={current:null},Re={transition:null},Te={ReactCurrentDispatcher:we,ReactCurrentBatchConfig:Re,ReactCurrentOwner:me};function Ne(){throw Error("act(...) is not supported in production builds of React.")}return Dr.Children={map:Ie,forEach:function(be,xe,je){Ie(be,function(){xe.apply(this,arguments)},je)},count:function(be){var xe=0;return Ie(be,function(){xe++}),xe},toArray:function(be){return Ie(be,function(xe){return xe})||[]},only:function(be){if(!ie(be))throw Error("React.Children.only expected to receive a single React element child.");return be}},Dr.Component=B,Dr.Fragment=i,Dr.Profiler=l,Dr.PureComponent=W,Dr.StrictMode=o,Dr.Suspense=v,Dr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Te,Dr.act=Ne,Dr.cloneElement=function(be,xe,je){if(be==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+be+".");var nt=D({},be.props),dt=be.key,ft=be.ref,lt=be._owner;if(xe!=null){if(xe.ref!==void 0&&(ft=xe.ref,lt=me.current),xe.key!==void 0&&(dt=""+xe.key),be.type&&be.type.defaultProps)var gt=be.type.defaultProps;for(at in xe)re.call(xe,at)&&!q.hasOwnProperty(at)&&(nt[at]=xe[at]===void 0&&gt!==void 0?gt[at]:xe[at])}var at=arguments.length-2;if(at===1)nt.children=je;else if(1<at){gt=Array(at);for(var Ct=0;Ct<at;Ct++)gt[Ct]=arguments[Ct+2];nt.children=gt}return{$$typeof:n,type:be.type,key:dt,ref:ft,props:nt,_owner:lt}},Dr.createContext=function(be){return be={$$typeof:f,_currentValue:be,_currentValue2:be,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},be.Provider={$$typeof:u,_context:be},be.Consumer=be},Dr.createElement=J,Dr.createFactory=function(be){var xe=J.bind(null,be);return xe.type=be,xe},Dr.createRef=function(){return{current:null}},Dr.forwardRef=function(be){return{$$typeof:y,render:be}},Dr.isValidElement=ie,Dr.lazy=function(be){return{$$typeof:C,_payload:{_status:-1,_result:be},_init:Fe}},Dr.memo=function(be,xe){return{$$typeof:b,type:be,compare:xe===void 0?null:xe}},Dr.startTransition=function(be){var xe=Re.transition;Re.transition={};try{be()}finally{Re.transition=xe}},Dr.unstable_act=Ne,Dr.useCallback=function(be,xe){return we.current.useCallback(be,xe)},Dr.useContext=function(be){return we.current.useContext(be)},Dr.useDebugValue=function(){},Dr.useDeferredValue=function(be){return we.current.useDeferredValue(be)},Dr.useEffect=function(be,xe){return we.current.useEffect(be,xe)},Dr.useId=function(){return we.current.useId()},Dr.useImperativeHandle=function(be,xe,je){return we.current.useImperativeHandle(be,xe,je)},Dr.useInsertionEffect=function(be,xe){return we.current.useInsertionEffect(be,xe)},Dr.useLayoutEffect=function(be,xe){return we.current.useLayoutEffect(be,xe)},Dr.useMemo=function(be,xe){return we.current.useMemo(be,xe)},Dr.useReducer=function(be,xe,je){return we.current.useReducer(be,xe,je)},Dr.useRef=function(be){return we.current.useRef(be)},Dr.useState=function(be){return we.current.useState(be)},Dr.useSyncExternalStore=function(be,xe,je){return we.current.useSyncExternalStore(be,xe,je)},Dr.useTransition=function(){return we.current.useTransition()},Dr.version="18.3.1",Dr}var FK;function em(){return FK||(FK=1,kM.exports=yEe()),kM.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BK;function EEe(){if(BK)return zT;BK=1;var n=em(),e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function f(y,v,b){var C,R={},O=null,L=null;b!==void 0&&(O=""+b),v.key!==void 0&&(O=""+v.key),v.ref!==void 0&&(L=v.ref);for(C in v)o.call(v,C)&&!u.hasOwnProperty(C)&&(R[C]=v[C]);if(y&&y.defaultProps)for(C in v=y.defaultProps,v)R[C]===void 0&&(R[C]=v[C]);return{$$typeof:e,type:y,key:O,ref:L,props:R,_owner:l.current}}return zT.Fragment=i,zT.jsx=f,zT.jsxs=f,zT}var zK;function vEe(){return zK||(zK=1,OM.exports=EEe()),OM.exports}var S=vEe(),k=em();const gi=Hg(k),WK=_Ee({__proto__:null,default:gi},[k]);var MP={},NM={exports:{}},ml={},xM={exports:{}},DM={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var GK;function SEe(){return GK||(GK=1,(function(n){function e(Re,Te){var Ne=Re.length;Re.push(Te);e:for(;0<Ne;){var be=Ne-1>>>1,xe=Re[be];if(0<l(xe,Te))Re[be]=Te,Re[Ne]=xe,Ne=be;else break e}}function i(Re){return Re.length===0?null:Re[0]}function o(Re){if(Re.length===0)return null;var Te=Re[0],Ne=Re.pop();if(Ne!==Te){Re[0]=Ne;e:for(var be=0,xe=Re.length,je=xe>>>1;be<je;){var nt=2*(be+1)-1,dt=Re[nt],ft=nt+1,lt=Re[ft];if(0>l(dt,Ne))ft<xe&&0>l(lt,dt)?(Re[be]=lt,Re[ft]=Ne,be=ft):(Re[be]=dt,Re[nt]=Ne,be=nt);else if(ft<xe&&0>l(lt,Ne))Re[be]=lt,Re[ft]=Ne,be=ft;else break e}}return Te}function l(Re,Te){var Ne=Re.sortIndex-Te.sortIndex;return Ne!==0?Ne:Re.id-Te.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;n.unstable_now=function(){return u.now()}}else{var f=Date,y=f.now();n.unstable_now=function(){return f.now()-y}}var v=[],b=[],C=1,R=null,O=3,L=!1,D=!1,U=!1,B=typeof setTimeout=="function"?setTimeout:null,Y=typeof clearTimeout=="function"?clearTimeout:null,W=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ne(Re){for(var Te=i(b);Te!==null;){if(Te.callback===null)o(b);else if(Te.startTime<=Re)o(b),Te.sortIndex=Te.expirationTime,e(v,Te);else break;Te=i(b)}}function le(Re){if(U=!1,ne(Re),!D)if(i(v)!==null)D=!0,Fe(re);else{var Te=i(b);Te!==null&&we(le,Te.startTime-Re)}}function re(Re,Te){D=!1,U&&(U=!1,Y(J),J=-1),L=!0;var Ne=O;try{for(ne(Te),R=i(v);R!==null&&(!(R.expirationTime>Te)||Re&&!pe());){var be=R.callback;if(typeof be=="function"){R.callback=null,O=R.priorityLevel;var xe=be(R.expirationTime<=Te);Te=n.unstable_now(),typeof xe=="function"?R.callback=xe:R===i(v)&&o(v),ne(Te)}else o(v);R=i(v)}if(R!==null)var je=!0;else{var nt=i(b);nt!==null&&we(le,nt.startTime-Te),je=!1}return je}finally{R=null,O=Ne,L=!1}}var me=!1,q=null,J=-1,Q=5,ie=-1;function pe(){return!(n.unstable_now()-ie<Q)}function de(){if(q!==null){var Re=n.unstable_now();ie=Re;var Te=!0;try{Te=q(!0,Re)}finally{Te?he():(me=!1,q=null)}}else me=!1}var he;if(typeof W=="function")he=function(){W(de)};else if(typeof MessageChannel<"u"){var Se=new MessageChannel,Ie=Se.port2;Se.port1.onmessage=de,he=function(){Ie.postMessage(null)}}else he=function(){B(de,0)};function Fe(Re){q=Re,me||(me=!0,he())}function we(Re,Te){J=B(function(){Re(n.unstable_now())},Te)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Re){Re.callback=null},n.unstable_continueExecution=function(){D||L||(D=!0,Fe(re))},n.unstable_forceFrameRate=function(Re){0>Re||125<Re?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<Re?Math.floor(1e3/Re):5},n.unstable_getCurrentPriorityLevel=function(){return O},n.unstable_getFirstCallbackNode=function(){return i(v)},n.unstable_next=function(Re){switch(O){case 1:case 2:case 3:var Te=3;break;default:Te=O}var Ne=O;O=Te;try{return Re()}finally{O=Ne}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Re,Te){switch(Re){case 1:case 2:case 3:case 4:case 5:break;default:Re=3}var Ne=O;O=Re;try{return Te()}finally{O=Ne}},n.unstable_scheduleCallback=function(Re,Te,Ne){var be=n.unstable_now();switch(typeof Ne=="object"&&Ne!==null?(Ne=Ne.delay,Ne=typeof Ne=="number"&&0<Ne?be+Ne:be):Ne=be,Re){case 1:var xe=-1;break;case 2:xe=250;break;case 5:xe=1073741823;break;case 4:xe=1e4;break;default:xe=5e3}return xe=Ne+xe,Re={id:C++,callback:Te,priorityLevel:Re,startTime:Ne,expirationTime:xe,sortIndex:-1},Ne>be?(Re.sortIndex=Ne,e(b,Re),i(v)===null&&Re===i(b)&&(U?(Y(J),J=-1):U=!0,we(le,Ne-be))):(Re.sortIndex=xe,e(v,Re),D||L||(D=!0,Fe(re))),Re},n.unstable_shouldYield=pe,n.unstable_wrapCallback=function(Re){var Te=O;return function(){var Ne=O;O=Te;try{return Re.apply(this,arguments)}finally{O=Ne}}}})(DM)),DM}var HK;function bEe(){return HK||(HK=1,xM.exports=SEe()),xM.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $K;function wEe(){if($K)return ml;$K=1;var n=em(),e=bEe();function i(p){for(var _="https://reactjs.org/docs/error-decoder.html?invariant="+p,T=1;T<arguments.length;T++)_+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+p+"; visit "+_+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,l={};function u(p,_){f(p,_),f(p+"Capture",_)}function f(p,_){for(l[p]=_,p=0;p<_.length;p++)o.add(_[p])}var y=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,C={},R={};function O(p){return v.call(R,p)?!0:v.call(C,p)?!1:b.test(p)?R[p]=!0:(C[p]=!0,!1)}function L(p,_,T,x){if(T!==null&&T.type===0)return!1;switch(typeof _){case"function":case"symbol":return!0;case"boolean":return x?!1:T!==null?!T.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function D(p,_,T,x){if(_===null||typeof _>"u"||L(p,_,T,x))return!0;if(x)return!1;if(T!==null)switch(T.type){case 3:return!_;case 4:return _===!1;case 5:return isNaN(_);case 6:return isNaN(_)||1>_}return!1}function U(p,_,T,x,j,K,fe){this.acceptsBooleans=_===2||_===3||_===4,this.attributeName=x,this.attributeNamespace=j,this.mustUseProperty=T,this.propertyName=p,this.type=_,this.sanitizeURL=K,this.removeEmptyString=fe}var B={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){B[p]=new U(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var _=p[0];B[_]=new U(_,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){B[p]=new U(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){B[p]=new U(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){B[p]=new U(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){B[p]=new U(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){B[p]=new U(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){B[p]=new U(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){B[p]=new U(p,5,!1,p.toLowerCase(),null,!1,!1)});var Y=/[\-:]([a-z])/g;function W(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var _=p.replace(Y,W);B[_]=new U(_,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var _=p.replace(Y,W);B[_]=new U(_,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var _=p.replace(Y,W);B[_]=new U(_,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){B[p]=new U(p,1,!1,p.toLowerCase(),null,!1,!1)}),B.xlinkHref=new U("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){B[p]=new U(p,1,!1,p.toLowerCase(),null,!0,!0)});function ne(p,_,T,x){var j=B.hasOwnProperty(_)?B[_]:null;(j!==null?j.type!==0:x||!(2<_.length)||_[0]!=="o"&&_[0]!=="O"||_[1]!=="n"&&_[1]!=="N")&&(D(_,T,j,x)&&(T=null),x||j===null?O(_)&&(T===null?p.removeAttribute(_):p.setAttribute(_,""+T)):j.mustUseProperty?p[j.propertyName]=T===null?j.type===3?!1:"":T:(_=j.attributeName,x=j.attributeNamespace,T===null?p.removeAttribute(_):(j=j.type,T=j===3||j===4&&T===!0?"":""+T,x?p.setAttributeNS(x,_,T):p.setAttribute(_,T))))}var le=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,re=Symbol.for("react.element"),me=Symbol.for("react.portal"),q=Symbol.for("react.fragment"),J=Symbol.for("react.strict_mode"),Q=Symbol.for("react.profiler"),ie=Symbol.for("react.provider"),pe=Symbol.for("react.context"),de=Symbol.for("react.forward_ref"),he=Symbol.for("react.suspense"),Se=Symbol.for("react.suspense_list"),Ie=Symbol.for("react.memo"),Fe=Symbol.for("react.lazy"),we=Symbol.for("react.offscreen"),Re=Symbol.iterator;function Te(p){return p===null||typeof p!="object"?null:(p=Re&&p[Re]||p["@@iterator"],typeof p=="function"?p:null)}var Ne=Object.assign,be;function xe(p){if(be===void 0)try{throw Error()}catch(T){var _=T.stack.trim().match(/\n( *(at )?)/);be=_&&_[1]||""}return`
`+be+p}var je=!1;function nt(p,_){if(!p||je)return"";je=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(_)if(_=function(){throw Error()},Object.defineProperty(_.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(_,[])}catch(ut){var x=ut}Reflect.construct(p,[],_)}else{try{_.call()}catch(ut){x=ut}p.call(_.prototype)}else{try{throw Error()}catch(ut){x=ut}p()}}catch(ut){if(ut&&x&&typeof ut.stack=="string"){for(var j=ut.stack.split(`
`),K=x.stack.split(`
`),fe=j.length-1,Oe=K.length-1;1<=fe&&0<=Oe&&j[fe]!==K[Oe];)Oe--;for(;1<=fe&&0<=Oe;fe--,Oe--)if(j[fe]!==K[Oe]){if(fe!==1||Oe!==1)do if(fe--,Oe--,0>Oe||j[fe]!==K[Oe]){var Ve=`
`+j[fe].replace(" at new "," at ");return p.displayName&&Ve.includes("<anonymous>")&&(Ve=Ve.replace("<anonymous>",p.displayName)),Ve}while(1<=fe&&0<=Oe);break}}}finally{je=!1,Error.prepareStackTrace=T}return(p=p?p.displayName||p.name:"")?xe(p):""}function dt(p){switch(p.tag){case 5:return xe(p.type);case 16:return xe("Lazy");case 13:return xe("Suspense");case 19:return xe("SuspenseList");case 0:case 2:case 15:return p=nt(p.type,!1),p;case 11:return p=nt(p.type.render,!1),p;case 1:return p=nt(p.type,!0),p;default:return""}}function ft(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case q:return"Fragment";case me:return"Portal";case Q:return"Profiler";case J:return"StrictMode";case he:return"Suspense";case Se:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case pe:return(p.displayName||"Context")+".Consumer";case ie:return(p._context.displayName||"Context")+".Provider";case de:var _=p.render;return p=p.displayName,p||(p=_.displayName||_.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case Ie:return _=p.displayName||null,_!==null?_:ft(p.type)||"Memo";case Fe:_=p._payload,p=p._init;try{return ft(p(_))}catch{}}return null}function lt(p){var _=p.type;switch(p.tag){case 24:return"Cache";case 9:return(_.displayName||"Context")+".Consumer";case 10:return(_._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=_.render,p=p.displayName||p.name||"",_.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return _;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ft(_);case 8:return _===J?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _}return null}function gt(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function at(p){var _=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(_==="checkbox"||_==="radio")}function Ct(p){var _=at(p)?"checked":"value",T=Object.getOwnPropertyDescriptor(p.constructor.prototype,_),x=""+p[_];if(!p.hasOwnProperty(_)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var j=T.get,K=T.set;return Object.defineProperty(p,_,{configurable:!0,get:function(){return j.call(this)},set:function(fe){x=""+fe,K.call(this,fe)}}),Object.defineProperty(p,_,{enumerable:T.enumerable}),{getValue:function(){return x},setValue:function(fe){x=""+fe},stopTracking:function(){p._valueTracker=null,delete p[_]}}}}function En(p){p._valueTracker||(p._valueTracker=Ct(p))}function Gt(p){if(!p)return!1;var _=p._valueTracker;if(!_)return!0;var T=_.getValue(),x="";return p&&(x=at(p)?p.checked?"true":"false":p.value),p=x,p!==T?(_.setValue(p),!0):!1}function Xt(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function st(p,_){var T=_.checked;return Ne({},_,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:T??p._wrapperState.initialChecked})}function hn(p,_){var T=_.defaultValue==null?"":_.defaultValue,x=_.checked!=null?_.checked:_.defaultChecked;T=gt(_.value!=null?_.value:T),p._wrapperState={initialChecked:x,initialValue:T,controlled:_.type==="checkbox"||_.type==="radio"?_.checked!=null:_.value!=null}}function an(p,_){_=_.checked,_!=null&&ne(p,"checked",_,!1)}function jt(p,_){an(p,_);var T=gt(_.value),x=_.type;if(T!=null)x==="number"?(T===0&&p.value===""||p.value!=T)&&(p.value=""+T):p.value!==""+T&&(p.value=""+T);else if(x==="submit"||x==="reset"){p.removeAttribute("value");return}_.hasOwnProperty("value")?St(p,_.type,T):_.hasOwnProperty("defaultValue")&&St(p,_.type,gt(_.defaultValue)),_.checked==null&&_.defaultChecked!=null&&(p.defaultChecked=!!_.defaultChecked)}function on(p,_,T){if(_.hasOwnProperty("value")||_.hasOwnProperty("defaultValue")){var x=_.type;if(!(x!=="submit"&&x!=="reset"||_.value!==void 0&&_.value!==null))return;_=""+p._wrapperState.initialValue,T||_===p.value||(p.value=_),p.defaultValue=_}T=p.name,T!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,T!==""&&(p.name=T)}function St(p,_,T){(_!=="number"||Xt(p.ownerDocument)!==p)&&(T==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+T&&(p.defaultValue=""+T))}var ve=Array.isArray;function De(p,_,T,x){if(p=p.options,_){_={};for(var j=0;j<T.length;j++)_["$"+T[j]]=!0;for(T=0;T<p.length;T++)j=_.hasOwnProperty("$"+p[T].value),p[T].selected!==j&&(p[T].selected=j),j&&x&&(p[T].defaultSelected=!0)}else{for(T=""+gt(T),_=null,j=0;j<p.length;j++){if(p[j].value===T){p[j].selected=!0,x&&(p[j].defaultSelected=!0);return}_!==null||p[j].disabled||(_=p[j])}_!==null&&(_.selected=!0)}}function Ke(p,_){if(_.dangerouslySetInnerHTML!=null)throw Error(i(91));return Ne({},_,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function Ot(p,_){var T=_.value;if(T==null){if(T=_.children,_=_.defaultValue,T!=null){if(_!=null)throw Error(i(92));if(ve(T)){if(1<T.length)throw Error(i(93));T=T[0]}_=T}_==null&&(_=""),T=_}p._wrapperState={initialValue:gt(T)}}function Et(p,_){var T=gt(_.value),x=gt(_.defaultValue);T!=null&&(T=""+T,T!==p.value&&(p.value=T),_.defaultValue==null&&p.defaultValue!==T&&(p.defaultValue=T)),x!=null&&(p.defaultValue=""+x)}function Pt(p){var _=p.textContent;_===p._wrapperState.initialValue&&_!==""&&_!==null&&(p.value=_)}function Ut(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function cn(p,_){return p==null||p==="http://www.w3.org/1999/xhtml"?Ut(_):p==="http://www.w3.org/2000/svg"&&_==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var _t,wn=(function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(_,T,x,j){MSApp.execUnsafeLocalFunction(function(){return p(_,T,x,j)})}:p})(function(p,_){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=_;else{for(_t=_t||document.createElement("div"),_t.innerHTML="<svg>"+_.valueOf().toString()+"</svg>",_=_t.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;_.firstChild;)p.appendChild(_.firstChild)}});function Nt(p,_){if(_){var T=p.firstChild;if(T&&T===p.lastChild&&T.nodeType===3){T.nodeValue=_;return}}p.textContent=_}var Ht={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Lr=["Webkit","ms","Moz","O"];Object.keys(Ht).forEach(function(p){Lr.forEach(function(_){_=_+p.charAt(0).toUpperCase()+p.substring(1),Ht[_]=Ht[p]})});function wi(p,_,T){return _==null||typeof _=="boolean"||_===""?"":T||typeof _!="number"||_===0||Ht.hasOwnProperty(p)&&Ht[p]?(""+_).trim():_+"px"}function ti(p,_){p=p.style;for(var T in _)if(_.hasOwnProperty(T)){var x=T.indexOf("--")===0,j=wi(T,_[T],x);T==="float"&&(T="cssFloat"),x?p.setProperty(T,j):p[T]=j}}var Vi=Ne({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function us(p,_){if(_){if(Vi[p]&&(_.children!=null||_.dangerouslySetInnerHTML!=null))throw Error(i(137,p));if(_.dangerouslySetInnerHTML!=null){if(_.children!=null)throw Error(i(60));if(typeof _.dangerouslySetInnerHTML!="object"||!("__html"in _.dangerouslySetInnerHTML))throw Error(i(61))}if(_.style!=null&&typeof _.style!="object")throw Error(i(62))}}function _o(p,_){if(p.indexOf("-")===-1)return typeof _.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Wr=null;function Do(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var Fc=null,Yr=null,yo=null;function Ys(p){if(p=h_(p)){if(typeof Fc!="function")throw Error(i(280));var _=p.stateNode;_&&(_=kE(_),Fc(p.stateNode,p.type,_))}}function Zi(p){Yr?yo?yo.push(p):yo=[p]:Yr=p}function Bc(){if(Yr){var p=Yr,_=yo;if(yo=Yr=null,Ys(p),_)for(p=0;p<_.length;p++)Ys(_[p])}}function Eo(p,_){return p(_)}function yu(){}var Wa=!1;function Ns(p,_,T){if(Wa)return p(_,T);Wa=!0;try{return Eo(p,_,T)}finally{Wa=!1,(Yr!==null||yo!==null)&&(yu(),Bc())}}function Kt(p,_){var T=p.stateNode;if(T===null)return null;var x=kE(T);if(x===null)return null;T=x[_];e:switch(_){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(p=p.type,x=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!x;break e;default:p=!1}if(p)return null;if(T&&typeof T!="function")throw Error(i(231,_,typeof T));return T}var zc=!1;if(y)try{var Zo={};Object.defineProperty(Zo,"passive",{get:function(){zc=!0}}),window.addEventListener("test",Zo,Zo),window.removeEventListener("test",Zo,Zo)}catch{zc=!1}function Ga(p,_,T,x,j,K,fe,Oe,Ve){var ut=Array.prototype.slice.call(arguments,3);try{_.apply(T,ut)}catch(xt){this.onError(xt)}}var Wc=!1,ea=null,ta=!1,yd=null,Sh={onError:function(p){Wc=!0,ea=p}};function Pl(p,_,T,x,j,K,fe,Oe,Ve){Wc=!1,ea=null,Ga.apply(Sh,arguments)}function bh(p,_,T,x,j,K,fe,Oe,Ve){if(Pl.apply(this,arguments),Wc){if(Wc){var ut=ea;Wc=!1,ea=null}else throw Error(i(198));ta||(ta=!0,yd=ut)}}function xs(p){var _=p,T=p;if(p.alternate)for(;_.return;)_=_.return;else{p=_;do _=p,(_.flags&4098)!==0&&(T=_.return),p=_.return;while(p)}return _.tag===3?T:null}function Ol(p){if(p.tag===13){var _=p.memoizedState;if(_===null&&(p=p.alternate,p!==null&&(_=p.memoizedState)),_!==null)return _.dehydrated}return null}function na(p){if(xs(p)!==p)throw Error(i(188))}function Ed(p){var _=p.alternate;if(!_){if(_=xs(p),_===null)throw Error(i(188));return _!==p?null:p}for(var T=p,x=_;;){var j=T.return;if(j===null)break;var K=j.alternate;if(K===null){if(x=j.return,x!==null){T=x;continue}break}if(j.child===K.child){for(K=j.child;K;){if(K===T)return na(j),p;if(K===x)return na(j),_;K=K.sibling}throw Error(i(188))}if(T.return!==x.return)T=j,x=K;else{for(var fe=!1,Oe=j.child;Oe;){if(Oe===T){fe=!0,T=j,x=K;break}if(Oe===x){fe=!0,x=j,T=K;break}Oe=Oe.sibling}if(!fe){for(Oe=K.child;Oe;){if(Oe===T){fe=!0,T=K,x=j;break}if(Oe===x){fe=!0,x=K,T=j;break}Oe=Oe.sibling}if(!fe)throw Error(i(189))}}if(T.alternate!==x)throw Error(i(190))}if(T.tag!==3)throw Error(i(188));return T.stateNode.current===T?p:_}function kl(p){return p=Ed(p),p!==null?Nl(p):null}function Nl(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var _=Nl(p);if(_!==null)return _;p=p.sibling}return null}var va=e.unstable_scheduleCallback,xl=e.unstable_cancelCallback,wh=e.unstable_shouldYield,Xs=e.unstable_requestPaint,Xr=e.unstable_now,Th=e.unstable_getCurrentPriorityLevel,Mr=e.unstable_ImmediatePriority,mc=e.unstable_UserBlockingPriority,ra=e.unstable_NormalPriority,vd=e.unstable_LowPriority,Je=e.unstable_IdlePriority,qt=null,Kn=null;function $i(p){if(Kn&&typeof Kn.onCommitFiberRoot=="function")try{Kn.onCommitFiberRoot(qt,p,void 0,(p.current.flags&128)===128)}catch{}}var gs=Math.clz32?Math.clz32:gc,Gc=Math.log,Ch=Math.LN2;function gc(p){return p>>>=0,p===0?32:31-(Gc(p)/Ch|0)|0}var Hc=64,Dl=4194304;function Cr(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function Ll(p,_){var T=p.pendingLanes;if(T===0)return 0;var x=0,j=p.suspendedLanes,K=p.pingedLanes,fe=T&268435455;if(fe!==0){var Oe=fe&~j;Oe!==0?x=Cr(Oe):(K&=fe,K!==0&&(x=Cr(K)))}else fe=T&~j,fe!==0?x=Cr(fe):K!==0&&(x=Cr(K));if(x===0)return 0;if(_!==0&&_!==x&&(_&j)===0&&(j=x&-x,K=_&-_,j>=K||j===16&&(K&4194240)!==0))return _;if((x&4)!==0&&(x|=T&16),_=p.entangledLanes,_!==0)for(p=p.entanglements,_&=x;0<_;)T=31-gs(_),j=1<<T,x|=p[T],_&=~j;return x}function _c(p,_){switch(p){case 1:case 2:case 4:return _+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ki(p,_){for(var T=p.suspendedLanes,x=p.pingedLanes,j=p.expirationTimes,K=p.pendingLanes;0<K;){var fe=31-gs(K),Oe=1<<fe,Ve=j[fe];Ve===-1?((Oe&T)===0||(Oe&x)!==0)&&(j[fe]=_c(Oe,_)):Ve<=_&&(p.expiredLanes|=Oe),K&=~Oe}}function li(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function Gr(){var p=Hc;return Hc<<=1,(Hc&4194240)===0&&(Hc=64),p}function Ml(p){for(var _=[],T=0;31>T;T++)_.push(p);return _}function Eu(p,_,T){p.pendingLanes|=_,_!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,_=31-gs(_),p[_]=T}function ui(p,_){var T=p.pendingLanes&~_;p.pendingLanes=_,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=_,p.mutableReadLanes&=_,p.entangledLanes&=_,_=p.entanglements;var x=p.eventTimes;for(p=p.expirationTimes;0<T;){var j=31-gs(T),K=1<<j;_[j]=0,x[j]=-1,p[j]=-1,T&=~K}}function vu(p,_){var T=p.entangledLanes|=_;for(p=p.entanglements;T;){var x=31-gs(T),j=1<<x;j&_|p[x]&_&&(p[x]|=_),T&=~j}}var yr=0;function Ul(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var Rh,Ih,Su,sm,Gp,Hp=!1,Sa=[],_s=null,ba=null,wa=null,bu=new Map,Ta=new Map,Ha=[],$p="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function $c(p,_){switch(p){case"focusin":case"focusout":_s=null;break;case"dragenter":case"dragleave":ba=null;break;case"mouseover":case"mouseout":wa=null;break;case"pointerover":case"pointerout":bu.delete(_.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ta.delete(_.pointerId)}}function Ds(p,_,T,x,j,K){return p===null||p.nativeEvent!==K?(p={blockedOn:_,domEventName:T,eventSystemFlags:x,nativeEvent:K,targetContainers:[j]},_!==null&&(_=h_(_),_!==null&&Ih(_)),p):(p.eventSystemFlags|=x,_=p.targetContainers,j!==null&&_.indexOf(j)===-1&&_.push(j),p)}function Jg(p,_,T,x,j){switch(_){case"focusin":return _s=Ds(_s,p,_,T,x,j),!0;case"dragenter":return ba=Ds(ba,p,_,T,x,j),!0;case"mouseover":return wa=Ds(wa,p,_,T,x,j),!0;case"pointerover":var K=j.pointerId;return bu.set(K,Ds(bu.get(K)||null,p,_,T,x,j)),!0;case"gotpointercapture":return K=j.pointerId,Ta.set(K,Ds(Ta.get(K)||null,p,_,T,x,j)),!0}return!1}function Vl(p){var _=Kp(p.target);if(_!==null){var T=xs(_);if(T!==null){if(_=T.tag,_===13){if(_=Ol(T),_!==null){p.blockedOn=_,Gp(p.priority,function(){Su(T)});return}}else if(_===3&&T.stateNode.current.memoizedState.isDehydrated){p.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}p.blockedOn=null}function jl(p){if(p.blockedOn!==null)return!1;for(var _=p.targetContainers;0<_.length;){var T=Ur(p.domEventName,p.eventSystemFlags,_[0],p.nativeEvent);if(T===null){T=p.nativeEvent;var x=new T.constructor(T.type,T);Wr=x,T.target.dispatchEvent(x),Wr=null}else return _=h_(T),_!==null&&Ih(_),p.blockedOn=T,!1;_.shift()}return!0}function wu(p,_,T){jl(p)&&T.delete(_)}function om(){Hp=!1,_s!==null&&jl(_s)&&(_s=null),ba!==null&&jl(ba)&&(ba=null),wa!==null&&jl(wa)&&(wa=null),bu.forEach(wu),Ta.forEach(wu)}function yc(p,_){p.blockedOn===_&&(p.blockedOn=null,Hp||(Hp=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,om)))}function Ca(p){function _(j){return yc(j,p)}if(0<Sa.length){yc(Sa[0],p);for(var T=1;T<Sa.length;T++){var x=Sa[T];x.blockedOn===p&&(x.blockedOn=null)}}for(_s!==null&&yc(_s,p),ba!==null&&yc(ba,p),wa!==null&&yc(wa,p),bu.forEach(_),Ta.forEach(_),T=0;T<Ha.length;T++)x=Ha[T],x.blockedOn===p&&(x.blockedOn=null);for(;0<Ha.length&&(T=Ha[0],T.blockedOn===null);)Vl(T),T.blockedOn===null&&Ha.shift()}var Fl=le.ReactCurrentBatchConfig,Ce=!0;function Me(p,_,T,x){var j=yr,K=Fl.transition;Fl.transition=null;try{yr=1,Yt(p,_,T,x)}finally{yr=j,Fl.transition=K}}function ct(p,_,T,x){var j=yr,K=Fl.transition;Fl.transition=null;try{yr=4,Yt(p,_,T,x)}finally{yr=j,Fl.transition=K}}function Yt(p,_,T,x){if(Ce){var j=Ur(p,_,T,x);if(j===null)gb(p,_,x,ar,T),$c(p,x);else if(Jg(j,p,_,T,x))x.stopPropagation();else if($c(p,x),_&4&&-1<$p.indexOf(p)){for(;j!==null;){var K=h_(j);if(K!==null&&Rh(K),K=Ur(p,_,T,x),K===null&&gb(p,_,x,ar,T),K===j)break;j=K}j!==null&&x.stopPropagation()}else gb(p,_,x,null,T)}}var ar=null;function Ur(p,_,T,x){if(ar=null,p=Do(x),p=Kp(p),p!==null)if(_=xs(p),_===null)p=null;else if(T=_.tag,T===13){if(p=Ol(_),p!==null)return p;p=null}else if(T===3){if(_.stateNode.current.memoizedState.isDehydrated)return _.tag===3?_.stateNode.containerInfo:null;p=null}else _!==p&&(p=null);return ar=p,null}function si(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Th()){case Mr:return 1;case mc:return 4;case ra:case vd:return 16;case Je:return 536870912;default:return 16}default:return 16}}var tr=null,nr=null,Pi=null;function Js(){if(Pi)return Pi;var p,_=nr,T=_.length,x,j="value"in tr?tr.value:tr.textContent,K=j.length;for(p=0;p<T&&_[p]===j[p];p++);var fe=T-p;for(x=1;x<=fe&&_[T-x]===j[K-x];x++);return Pi=j.slice(p,1<x?1-x:void 0)}function Kc(p){var _=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&_===13&&(p=13)):p=_,p===10&&(p=13),32<=p||p===13?p:0}function Lo(){return!0}function Tu(){return!1}function Ls(p){function _(T,x,j,K,fe){this._reactName=T,this._targetInst=j,this.type=x,this.nativeEvent=K,this.target=fe,this.currentTarget=null;for(var Oe in p)p.hasOwnProperty(Oe)&&(T=p[Oe],this[Oe]=T?T(K):K[Oe]);return this.isDefaultPrevented=(K.defaultPrevented!=null?K.defaultPrevented:K.returnValue===!1)?Lo:Tu,this.isPropagationStopped=Tu,this}return Ne(_.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=Lo)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=Lo)},persist:function(){},isPersistent:Lo}),_}var Ec={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},am=Ls(Ec),qc=Ne({},Ec,{view:0,detail:0}),Qg=Ls(qc),Ah,Sd,Ph,vc=Ne({},qc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ru,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==Ph&&(Ph&&p.type==="mousemove"?(Ah=p.screenX-Ph.screenX,Sd=p.screenY-Ph.screenY):Sd=Ah=0,Ph=p),Ah)},movementY:function(p){return"movementY"in p?p.movementY:Sd}}),Cu=Ls(vc),Zg=Ne({},vc,{dataTransfer:0}),yE=Ls(Zg),cm=Ne({},qc,{relatedTarget:0}),lm=Ls(cm),EE=Ne({},Ec,{animationName:0,elapsedTime:0,pseudoElement:0}),$a=Ls(EE),vE=Ne({},Ec,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),bd=Ls(vE),e_=Ne({},Ec,{data:0}),t_=Ls(e_),Hn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ra={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},SE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function bE(p){var _=this.nativeEvent;return _.getModifierState?_.getModifierState(p):(p=SE[p])?!!_[p]:!1}function Ru(){return bE}var P=Ne({},qc,{key:function(p){if(p.key){var _=Hn[p.key]||p.key;if(_!=="Unidentified")return _}return p.type==="keypress"?(p=Kc(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?Ra[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ru,charCode:function(p){return p.type==="keypress"?Kc(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?Kc(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),$=Ls(P),se=Ne({},vc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ee=Ls(se),Ye=Ne({},qc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ru}),ht=Ls(Ye),$t=Ne({},Ec,{propertyName:0,elapsedTime:0,pseudoElement:0}),oi=Ls($t),Qs=Ne({},vc,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),fr=Ls(Qs),vo=[9,13,27,32],Ms=y&&"CompositionEvent"in window,Yc=null;y&&"documentMode"in document&&(Yc=document.documentMode);var Ka=y&&"TextEvent"in window&&!Yc,wd=y&&(!Ms||Yc&&8<Yc&&11>=Yc),um=" ",tI=!1;function nI(p,_){switch(p){case"keyup":return vo.indexOf(_.keyCode)!==-1;case"keydown":return _.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Sc(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var dm=!1;function XN(p,_){switch(p){case"compositionend":return Sc(_);case"keypress":return _.which!==32?null:(tI=!0,um);case"textInput":return p=_.data,p===um&&tI?null:p;default:return null}}function JN(p,_){if(dm)return p==="compositionend"||!Ms&&nI(p,_)?(p=Js(),Pi=nr=tr=null,dm=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(_.ctrlKey||_.altKey||_.metaKey)||_.ctrlKey&&_.altKey){if(_.char&&1<_.char.length)return _.char;if(_.which)return String.fromCharCode(_.which)}return null;case"compositionend":return wd&&_.locale!=="ko"?null:_.data;default:return null}}var QN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ob(p){var _=p&&p.nodeName&&p.nodeName.toLowerCase();return _==="input"?!!QN[p.type]:_==="textarea"}function rI(p,_,T,x){Zi(x),_=c_(_,"onChange"),0<_.length&&(T=new am("onChange","change",null,T,x),p.push({event:T,listeners:_}))}var n_=null,hm=null;function ab(p){fI(p,0)}function wE(p){var _=Em(p);if(Gt(_))return p}function ZN(p,_){if(p==="change")return _}var r_=!1;if(y){var cb;if(y){var lb="oninput"in document;if(!lb){var iI=document.createElement("div");iI.setAttribute("oninput","return;"),lb=typeof iI.oninput=="function"}cb=lb}else cb=!1;r_=cb&&(!document.documentMode||9<document.documentMode)}function Td(){n_&&(n_.detachEvent("onpropertychange",sI),hm=n_=null)}function sI(p){if(p.propertyName==="value"&&wE(hm)){var _=[];rI(_,hm,p,Do(p)),Ns(ab,_)}}function ex(p,_,T){p==="focusin"?(Td(),n_=_,hm=T,n_.attachEvent("onpropertychange",sI)):p==="focusout"&&Td()}function qa(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return wE(hm)}function tx(p,_){if(p==="click")return wE(_)}function nx(p,_){if(p==="input"||p==="change")return wE(_)}function rx(p,_){return p===_&&(p!==0||1/p===1/_)||p!==p&&_!==_}var Bl=typeof Object.is=="function"?Object.is:rx;function pm(p,_){if(Bl(p,_))return!0;if(typeof p!="object"||p===null||typeof _!="object"||_===null)return!1;var T=Object.keys(p),x=Object.keys(_);if(T.length!==x.length)return!1;for(x=0;x<T.length;x++){var j=T[x];if(!v.call(_,j)||!Bl(p[j],_[j]))return!1}return!0}function oI(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function aI(p,_){var T=oI(p);p=0;for(var x;T;){if(T.nodeType===3){if(x=p+T.textContent.length,p<=_&&x>=_)return{node:T,offset:_-p};p=x}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=oI(T)}}function cI(p,_){return p&&_?p===_?!0:p&&p.nodeType===3?!1:_&&_.nodeType===3?cI(p,_.parentNode):"contains"in p?p.contains(_):p.compareDocumentPosition?!!(p.compareDocumentPosition(_)&16):!1:!1}function ub(){for(var p=window,_=Xt();_ instanceof p.HTMLIFrameElement;){try{var T=typeof _.contentWindow.location.href=="string"}catch{T=!1}if(T)p=_.contentWindow;else break;_=Xt(p.document)}return _}function db(p){var _=p&&p.nodeName&&p.nodeName.toLowerCase();return _&&(_==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||_==="textarea"||p.contentEditable==="true")}function ix(p){var _=ub(),T=p.focusedElem,x=p.selectionRange;if(_!==T&&T&&T.ownerDocument&&cI(T.ownerDocument.documentElement,T)){if(x!==null&&db(T)){if(_=x.start,p=x.end,p===void 0&&(p=_),"selectionStart"in T)T.selectionStart=_,T.selectionEnd=Math.min(p,T.value.length);else if(p=(_=T.ownerDocument||document)&&_.defaultView||window,p.getSelection){p=p.getSelection();var j=T.textContent.length,K=Math.min(x.start,j);x=x.end===void 0?K:Math.min(x.end,j),!p.extend&&K>x&&(j=x,x=K,K=j),j=aI(T,K);var fe=aI(T,x);j&&fe&&(p.rangeCount!==1||p.anchorNode!==j.node||p.anchorOffset!==j.offset||p.focusNode!==fe.node||p.focusOffset!==fe.offset)&&(_=_.createRange(),_.setStart(j.node,j.offset),p.removeAllRanges(),K>x?(p.addRange(_),p.extend(fe.node,fe.offset)):(_.setEnd(fe.node,fe.offset),p.addRange(_)))}}for(_=[],p=T;p=p.parentNode;)p.nodeType===1&&_.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<_.length;T++)p=_[T],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var hb=y&&"documentMode"in document&&11>=document.documentMode,Oh=null,pb=null,rt=null,fb=!1;function lI(p,_,T){var x=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;fb||Oh==null||Oh!==Xt(x)||(x=Oh,"selectionStart"in x&&db(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),rt&&pm(rt,x)||(rt=x,x=c_(pb,"onSelect"),0<x.length&&(_=new am("onSelect","select",null,_,T),p.push({event:_,listeners:x}),_.target=Oh)))}function TE(p,_){var T={};return T[p.toLowerCase()]=_.toLowerCase(),T["Webkit"+p]="webkit"+_,T["Moz"+p]="moz"+_,T}var fm={animationend:TE("Animation","AnimationEnd"),animationiteration:TE("Animation","AnimationIteration"),animationstart:TE("Animation","AnimationStart"),transitionend:TE("Transition","TransitionEnd")},CE={},mb={};y&&(mb=document.createElement("div").style,"AnimationEvent"in window||(delete fm.animationend.animation,delete fm.animationiteration.animation,delete fm.animationstart.animation),"TransitionEvent"in window||delete fm.transitionend.transition);function RE(p){if(CE[p])return CE[p];if(!fm[p])return p;var _=fm[p],T;for(T in _)if(_.hasOwnProperty(T)&&T in mb)return CE[p]=_[T];return p}var uI=RE("animationend"),dI=RE("animationiteration"),i_=RE("animationstart"),mm=RE("transitionend"),hI=new Map,pI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function zl(p,_){hI.set(p,_),u(_,[p])}for(var s_=0;s_<pI.length;s_++){var gm=pI[s_],sx=gm.toLowerCase(),ox=gm[0].toUpperCase()+gm.slice(1);zl(sx,"on"+ox)}zl(uI,"onAnimationEnd"),zl(dI,"onAnimationIteration"),zl(i_,"onAnimationStart"),zl("dblclick","onDoubleClick"),zl("focusin","onFocus"),zl("focusout","onBlur"),zl(mm,"onTransitionEnd"),f("onMouseEnter",["mouseout","mouseover"]),f("onMouseLeave",["mouseout","mouseover"]),f("onPointerEnter",["pointerout","pointerover"]),f("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var o_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),ax=new Set("cancel close invalid load scroll toggle".split(" ").concat(o_));function IE(p,_,T){var x=p.type||"unknown-event";p.currentTarget=T,bh(x,_,void 0,p),p.currentTarget=null}function fI(p,_){_=(_&4)!==0;for(var T=0;T<p.length;T++){var x=p[T],j=x.event;x=x.listeners;e:{var K=void 0;if(_)for(var fe=x.length-1;0<=fe;fe--){var Oe=x[fe],Ve=Oe.instance,ut=Oe.currentTarget;if(Oe=Oe.listener,Ve!==K&&j.isPropagationStopped())break e;IE(j,Oe,ut),K=Ve}else for(fe=0;fe<x.length;fe++){if(Oe=x[fe],Ve=Oe.instance,ut=Oe.currentTarget,Oe=Oe.listener,Ve!==K&&j.isPropagationStopped())break e;IE(j,Oe,ut),K=Ve}}}if(ta)throw p=yd,ta=!1,yd=null,p}function Oi(p,_){var T=_[vb];T===void 0&&(T=_[vb]=new Set);var x=p+"__bubble";T.has(x)||(mI(_,p,2,!1),T.add(x))}function Ya(p,_,T){var x=0;_&&(x|=4),mI(T,p,x,_)}var AE="_reactListening"+Math.random().toString(36).slice(2);function Cd(p){if(!p[AE]){p[AE]=!0,o.forEach(function(T){T!=="selectionchange"&&(ax.has(T)||Ya(T,!1,p),Ya(T,!0,p))});var _=p.nodeType===9?p:p.ownerDocument;_===null||_[AE]||(_[AE]=!0,Ya("selectionchange",!1,_))}}function mI(p,_,T,x){switch(si(_)){case 1:var j=Me;break;case 4:j=ct;break;default:j=Yt}T=j.bind(null,_,T,p),j=void 0,!zc||_!=="touchstart"&&_!=="touchmove"&&_!=="wheel"||(j=!0),x?j!==void 0?p.addEventListener(_,T,{capture:!0,passive:j}):p.addEventListener(_,T,!0):j!==void 0?p.addEventListener(_,T,{passive:j}):p.addEventListener(_,T,!1)}function gb(p,_,T,x,j){var K=x;if((_&1)===0&&(_&2)===0&&x!==null)e:for(;;){if(x===null)return;var fe=x.tag;if(fe===3||fe===4){var Oe=x.stateNode.containerInfo;if(Oe===j||Oe.nodeType===8&&Oe.parentNode===j)break;if(fe===4)for(fe=x.return;fe!==null;){var Ve=fe.tag;if((Ve===3||Ve===4)&&(Ve=fe.stateNode.containerInfo,Ve===j||Ve.nodeType===8&&Ve.parentNode===j))return;fe=fe.return}for(;Oe!==null;){if(fe=Kp(Oe),fe===null)return;if(Ve=fe.tag,Ve===5||Ve===6){x=K=fe;continue e}Oe=Oe.parentNode}}x=x.return}Ns(function(){var ut=K,xt=Do(T),Dt=[];e:{var kt=hI.get(p);if(kt!==void 0){var ln=am,gn=p;switch(p){case"keypress":if(Kc(T)===0)break e;case"keydown":case"keyup":ln=$;break;case"focusin":gn="focus",ln=lm;break;case"focusout":gn="blur",ln=lm;break;case"beforeblur":case"afterblur":ln=lm;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ln=Cu;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ln=yE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ln=ht;break;case uI:case dI:case i_:ln=$a;break;case mm:ln=oi;break;case"scroll":ln=Qg;break;case"wheel":ln=fr;break;case"copy":case"cut":case"paste":ln=bd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ln=Ee}var yn=(_&4)!==0,ns=!yn&&p==="scroll",Qe=yn?kt!==null?kt+"Capture":null:kt;yn=[];for(var Be=ut,it;Be!==null;){it=Be;var Vt=it.stateNode;if(it.tag===5&&Vt!==null&&(it=Vt,Qe!==null&&(Vt=Kt(Be,Qe),Vt!=null&&yn.push(a_(Be,Vt,it)))),ns)break;Be=Be.return}0<yn.length&&(kt=new ln(kt,gn,null,T,xt),Dt.push({event:kt,listeners:yn}))}}if((_&7)===0){e:{if(kt=p==="mouseover"||p==="pointerover",ln=p==="mouseout"||p==="pointerout",kt&&T!==Wr&&(gn=T.relatedTarget||T.fromElement)&&(Kp(gn)||gn[Rd]))break e;if((ln||kt)&&(kt=xt.window===xt?xt:(kt=xt.ownerDocument)?kt.defaultView||kt.parentWindow:window,ln?(gn=T.relatedTarget||T.toElement,ln=ut,gn=gn?Kp(gn):null,gn!==null&&(ns=xs(gn),gn!==ns||gn.tag!==5&&gn.tag!==6)&&(gn=null)):(ln=null,gn=ut),ln!==gn)){if(yn=Cu,Vt="onMouseLeave",Qe="onMouseEnter",Be="mouse",(p==="pointerout"||p==="pointerover")&&(yn=Ee,Vt="onPointerLeave",Qe="onPointerEnter",Be="pointer"),ns=ln==null?kt:Em(ln),it=gn==null?kt:Em(gn),kt=new yn(Vt,Be+"leave",ln,T,xt),kt.target=ns,kt.relatedTarget=it,Vt=null,Kp(xt)===ut&&(yn=new yn(Qe,Be+"enter",gn,T,xt),yn.target=it,yn.relatedTarget=ns,Vt=yn),ns=Vt,ln&&gn)t:{for(yn=ln,Qe=gn,Be=0,it=yn;it;it=_m(it))Be++;for(it=0,Vt=Qe;Vt;Vt=_m(Vt))it++;for(;0<Be-it;)yn=_m(yn),Be--;for(;0<it-Be;)Qe=_m(Qe),it--;for(;Be--;){if(yn===Qe||Qe!==null&&yn===Qe.alternate)break t;yn=_m(yn),Qe=_m(Qe)}yn=null}else yn=null;ln!==null&&gI(Dt,kt,ln,yn,!1),gn!==null&&ns!==null&&gI(Dt,ns,gn,yn,!0)}}e:{if(kt=ut?Em(ut):window,ln=kt.nodeName&&kt.nodeName.toLowerCase(),ln==="select"||ln==="input"&&kt.type==="file")var vn=ZN;else if(ob(kt))if(r_)vn=nx;else{vn=qa;var On=ex}else(ln=kt.nodeName)&&ln.toLowerCase()==="input"&&(kt.type==="checkbox"||kt.type==="radio")&&(vn=tx);if(vn&&(vn=vn(p,ut))){rI(Dt,vn,T,xt);break e}On&&On(p,kt,ut),p==="focusout"&&(On=kt._wrapperState)&&On.controlled&&kt.type==="number"&&St(kt,"number",kt.value)}switch(On=ut?Em(ut):window,p){case"focusin":(ob(On)||On.contentEditable==="true")&&(Oh=On,pb=ut,rt=null);break;case"focusout":rt=pb=Oh=null;break;case"mousedown":fb=!0;break;case"contextmenu":case"mouseup":case"dragend":fb=!1,lI(Dt,T,xt);break;case"selectionchange":if(hb)break;case"keydown":case"keyup":lI(Dt,T,xt)}var kn;if(Ms)e:{switch(p){case"compositionstart":var jn="onCompositionStart";break e;case"compositionend":jn="onCompositionEnd";break e;case"compositionupdate":jn="onCompositionUpdate";break e}jn=void 0}else dm?nI(p,T)&&(jn="onCompositionEnd"):p==="keydown"&&T.keyCode===229&&(jn="onCompositionStart");jn&&(wd&&T.locale!=="ko"&&(dm||jn!=="onCompositionStart"?jn==="onCompositionEnd"&&dm&&(kn=Js()):(tr=xt,nr="value"in tr?tr.value:tr.textContent,dm=!0)),On=c_(ut,jn),0<On.length&&(jn=new t_(jn,p,null,T,xt),Dt.push({event:jn,listeners:On}),kn?jn.data=kn:(kn=Sc(T),kn!==null&&(jn.data=kn)))),(kn=Ka?XN(p,T):JN(p,T))&&(ut=c_(ut,"onBeforeInput"),0<ut.length&&(xt=new t_("onBeforeInput","beforeinput",null,T,xt),Dt.push({event:xt,listeners:ut}),xt.data=kn))}fI(Dt,_)})}function a_(p,_,T){return{instance:p,listener:_,currentTarget:T}}function c_(p,_){for(var T=_+"Capture",x=[];p!==null;){var j=p,K=j.stateNode;j.tag===5&&K!==null&&(j=K,K=Kt(p,T),K!=null&&x.unshift(a_(p,K,j)),K=Kt(p,_),K!=null&&x.push(a_(p,K,j))),p=p.return}return x}function _m(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function gI(p,_,T,x,j){for(var K=_._reactName,fe=[];T!==null&&T!==x;){var Oe=T,Ve=Oe.alternate,ut=Oe.stateNode;if(Ve!==null&&Ve===x)break;Oe.tag===5&&ut!==null&&(Oe=ut,j?(Ve=Kt(T,K),Ve!=null&&fe.unshift(a_(T,Ve,Oe))):j||(Ve=Kt(T,K),Ve!=null&&fe.push(a_(T,Ve,Oe)))),T=T.return}fe.length!==0&&p.push({event:_,listeners:fe})}var cx=/\r\n?/g,_b=/\u0000|\uFFFD/g;function _I(p){return(typeof p=="string"?p:""+p).replace(cx,`
`).replace(_b,"")}function l_(p,_,T){if(_=_I(_),_I(p)!==_&&T)throw Error(i(425))}function u_(){}var yb=null,PE=null;function ym(p,_){return p==="textarea"||p==="noscript"||typeof _.children=="string"||typeof _.children=="number"||typeof _.dangerouslySetInnerHTML=="object"&&_.dangerouslySetInnerHTML!==null&&_.dangerouslySetInnerHTML.__html!=null}var Eb=typeof setTimeout=="function"?setTimeout:void 0,lx=typeof clearTimeout=="function"?clearTimeout:void 0,yI=typeof Promise=="function"?Promise:void 0,ux=typeof queueMicrotask=="function"?queueMicrotask:typeof yI<"u"?function(p){return yI.resolve(null).then(p).catch(dx)}:Eb;function dx(p){setTimeout(function(){throw p})}function OE(p,_){var T=_,x=0;do{var j=T.nextSibling;if(p.removeChild(T),j&&j.nodeType===8)if(T=j.data,T==="/$"){if(x===0){p.removeChild(j),Ca(_);return}x--}else T!=="$"&&T!=="$?"&&T!=="$!"||x++;T=j}while(T);Ca(_)}function Iu(p){for(;p!=null;p=p.nextSibling){var _=p.nodeType;if(_===1||_===3)break;if(_===8){if(_=p.data,_==="$"||_==="$!"||_==="$?")break;if(_==="/$")return null}}return p}function EI(p){p=p.previousSibling;for(var _=0;p;){if(p.nodeType===8){var T=p.data;if(T==="$"||T==="$!"||T==="$?"){if(_===0)return p;_--}else T==="/$"&&_++}p=p.previousSibling}return null}var kh=Math.random().toString(36).slice(2),Au="__reactFiber$"+kh,d_="__reactProps$"+kh,Rd="__reactContainer$"+kh,vb="__reactEvents$"+kh,hx="__reactListeners$"+kh,px="__reactHandles$"+kh;function Kp(p){var _=p[Au];if(_)return _;for(var T=p.parentNode;T;){if(_=T[Rd]||T[Au]){if(T=_.alternate,_.child!==null||T!==null&&T.child!==null)for(p=EI(p);p!==null;){if(T=p[Au])return T;p=EI(p)}return _}p=T,T=p.parentNode}return null}function h_(p){return p=p[Au]||p[Rd],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function Em(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(i(33))}function kE(p){return p[d_]||null}var Sb=[],Id=-1;function Wl(p){return{current:p}}function Ti(p){0>Id||(p.current=Sb[Id],Sb[Id]=null,Id--)}function ki(p,_){Id++,Sb[Id]=p.current,p.current=_}var Nh={},ia=Wl(Nh),Ia=Wl(!1),xh=Nh;function Dh(p,_){var T=p.type.contextTypes;if(!T)return Nh;var x=p.stateNode;if(x&&x.__reactInternalMemoizedUnmaskedChildContext===_)return x.__reactInternalMemoizedMaskedChildContext;var j={},K;for(K in T)j[K]=_[K];return x&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=_,p.__reactInternalMemoizedMaskedChildContext=j),j}function Xa(p){return p=p.childContextTypes,p!=null}function NE(){Ti(Ia),Ti(ia)}function vm(p,_,T){if(ia.current!==Nh)throw Error(i(168));ki(ia,_),ki(Ia,T)}function vI(p,_,T){var x=p.stateNode;if(_=_.childContextTypes,typeof x.getChildContext!="function")return T;x=x.getChildContext();for(var j in x)if(!(j in _))throw Error(i(108,lt(p)||"Unknown",j));return Ne({},T,x)}function xE(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||Nh,xh=ia.current,ki(ia,p),ki(Ia,Ia.current),!0}function SI(p,_,T){var x=p.stateNode;if(!x)throw Error(i(169));T?(p=vI(p,_,xh),x.__reactInternalMemoizedMergedChildContext=p,Ti(Ia),Ti(ia),ki(ia,p)):Ti(Ia),ki(Ia,T)}var Ad=null,DE=!1,bb=!1;function wb(p){Ad===null?Ad=[p]:Ad.push(p)}function fx(p){DE=!0,wb(p)}function Lh(){if(!bb&&Ad!==null){bb=!0;var p=0,_=yr;try{var T=Ad;for(yr=1;p<T.length;p++){var x=T[p];do x=x(!0);while(x!==null)}Ad=null,DE=!1}catch(j){throw Ad!==null&&(Ad=Ad.slice(p+1)),va(Mr,Lh),j}finally{yr=_,bb=!1}}return null}var Sm=[],Mh=0,LE=null,ME=0,Aa=[],Xc=0,qp=null,Pd=1,Od="";function Yp(p,_){Sm[Mh++]=ME,Sm[Mh++]=LE,LE=p,ME=_}function bI(p,_,T){Aa[Xc++]=Pd,Aa[Xc++]=Od,Aa[Xc++]=qp,qp=p;var x=Pd;p=Od;var j=32-gs(x)-1;x&=~(1<<j),T+=1;var K=32-gs(_)+j;if(30<K){var fe=j-j%5;K=(x&(1<<fe)-1).toString(32),x>>=fe,j-=fe,Pd=1<<32-gs(_)+j|T<<j|x,Od=K+p}else Pd=1<<K|T<<j|x,Od=p}function bm(p){p.return!==null&&(Yp(p,1),bI(p,1,0))}function UE(p){for(;p===LE;)LE=Sm[--Mh],Sm[Mh]=null,ME=Sm[--Mh],Sm[Mh]=null;for(;p===qp;)qp=Aa[--Xc],Aa[Xc]=null,Od=Aa[--Xc],Aa[Xc]=null,Pd=Aa[--Xc],Aa[Xc]=null}var bc=null,wc=null,ji=!1,Gl=null;function wI(p,_){var T=tl(5,null,null,0);T.elementType="DELETED",T.stateNode=_,T.return=p,_=p.deletions,_===null?(p.deletions=[T],p.flags|=16):_.push(T)}function TI(p,_){switch(p.tag){case 5:var T=p.type;return _=_.nodeType!==1||T.toLowerCase()!==_.nodeName.toLowerCase()?null:_,_!==null?(p.stateNode=_,bc=p,wc=Iu(_.firstChild),!0):!1;case 6:return _=p.pendingProps===""||_.nodeType!==3?null:_,_!==null?(p.stateNode=_,bc=p,wc=null,!0):!1;case 13:return _=_.nodeType!==8?null:_,_!==null?(T=qp!==null?{id:Pd,overflow:Od}:null,p.memoizedState={dehydrated:_,treeContext:T,retryLane:1073741824},T=tl(18,null,null,0),T.stateNode=_,T.return=p,p.child=T,bc=p,wc=null,!0):!1;default:return!1}}function p_(p){return(p.mode&1)!==0&&(p.flags&128)===0}function f_(p){if(ji){var _=wc;if(_){var T=_;if(!TI(p,_)){if(p_(p))throw Error(i(418));_=Iu(T.nextSibling);var x=bc;_&&TI(p,_)?wI(x,T):(p.flags=p.flags&-4097|2,ji=!1,bc=p)}}else{if(p_(p))throw Error(i(418));p.flags=p.flags&-4097|2,ji=!1,bc=p}}}function Tb(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;bc=p}function wm(p){if(p!==bc)return!1;if(!ji)return Tb(p),ji=!0,!1;var _;if((_=p.tag!==3)&&!(_=p.tag!==5)&&(_=p.type,_=_!=="head"&&_!=="body"&&!ym(p.type,p.memoizedProps)),_&&(_=wc)){if(p_(p))throw Cb(),Error(i(418));for(;_;)wI(p,_),_=Iu(_.nextSibling)}if(Tb(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));e:{for(p=p.nextSibling,_=0;p;){if(p.nodeType===8){var T=p.data;if(T==="/$"){if(_===0){wc=Iu(p.nextSibling);break e}_--}else T!=="$"&&T!=="$!"&&T!=="$?"||_++}p=p.nextSibling}wc=null}}else wc=bc?Iu(p.stateNode.nextSibling):null;return!0}function Cb(){for(var p=wc;p;)p=Iu(p.nextSibling)}function Xp(){wc=bc=null,ji=!1}function Tm(p){Gl===null?Gl=[p]:Gl.push(p)}var m_=le.ReactCurrentBatchConfig;function g_(p,_,T){if(p=T.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(i(309));var x=T.stateNode}if(!x)throw Error(i(147,p));var j=x,K=""+p;return _!==null&&_.ref!==null&&typeof _.ref=="function"&&_.ref._stringRef===K?_.ref:(_=function(fe){var Oe=j.refs;fe===null?delete Oe[K]:Oe[K]=fe},_._stringRef=K,_)}if(typeof p!="string")throw Error(i(284));if(!T._owner)throw Error(i(290,p))}return p}function VE(p,_){throw p=Object.prototype.toString.call(_),Error(i(31,p==="[object Object]"?"object with keys {"+Object.keys(_).join(", ")+"}":p))}function Rb(p){var _=p._init;return _(p._payload)}function CI(p){function _(Qe,Be){if(p){var it=Qe.deletions;it===null?(Qe.deletions=[Be],Qe.flags|=16):it.push(Be)}}function T(Qe,Be){if(!p)return null;for(;Be!==null;)_(Qe,Be),Be=Be.sibling;return null}function x(Qe,Be){for(Qe=new Map;Be!==null;)Be.key!==null?Qe.set(Be.key,Be):Qe.set(Be.index,Be),Be=Be.sibling;return Qe}function j(Qe,Be){return Qe=qh(Qe,Be),Qe.index=0,Qe.sibling=null,Qe}function K(Qe,Be,it){return Qe.index=it,p?(it=Qe.alternate,it!==null?(it=it.index,it<Be?(Qe.flags|=2,Be):it):(Qe.flags|=2,Be)):(Qe.flags|=1048576,Be)}function fe(Qe){return p&&Qe.alternate===null&&(Qe.flags|=2),Qe}function Oe(Qe,Be,it,Vt){return Be===null||Be.tag!==6?(Be=fv(it,Qe.mode,Vt),Be.return=Qe,Be):(Be=j(Be,it),Be.return=Qe,Be)}function Ve(Qe,Be,it,Vt){var vn=it.type;return vn===q?xt(Qe,Be,it.props.children,Vt,it.key):Be!==null&&(Be.elementType===vn||typeof vn=="object"&&vn!==null&&vn.$$typeof===Fe&&Rb(vn)===Be.type)?(Vt=j(Be,it.props),Vt.ref=g_(Qe,Be,it),Vt.return=Qe,Vt):(Vt=Mm(it.type,it.key,it.props,null,Qe.mode,Vt),Vt.ref=g_(Qe,Be,it),Vt.return=Qe,Vt)}function ut(Qe,Be,it,Vt){return Be===null||Be.tag!==4||Be.stateNode.containerInfo!==it.containerInfo||Be.stateNode.implementation!==it.implementation?(Be=Um(it,Qe.mode,Vt),Be.return=Qe,Be):(Be=j(Be,it.children||[]),Be.return=Qe,Be)}function xt(Qe,Be,it,Vt,vn){return Be===null||Be.tag!==7?(Be=Yh(it,Qe.mode,Vt,vn),Be.return=Qe,Be):(Be=j(Be,it),Be.return=Qe,Be)}function Dt(Qe,Be,it){if(typeof Be=="string"&&Be!==""||typeof Be=="number")return Be=fv(""+Be,Qe.mode,it),Be.return=Qe,Be;if(typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case re:return it=Mm(Be.type,Be.key,Be.props,null,Qe.mode,it),it.ref=g_(Qe,null,Be),it.return=Qe,it;case me:return Be=Um(Be,Qe.mode,it),Be.return=Qe,Be;case Fe:var Vt=Be._init;return Dt(Qe,Vt(Be._payload),it)}if(ve(Be)||Te(Be))return Be=Yh(Be,Qe.mode,it,null),Be.return=Qe,Be;VE(Qe,Be)}return null}function kt(Qe,Be,it,Vt){var vn=Be!==null?Be.key:null;if(typeof it=="string"&&it!==""||typeof it=="number")return vn!==null?null:Oe(Qe,Be,""+it,Vt);if(typeof it=="object"&&it!==null){switch(it.$$typeof){case re:return it.key===vn?Ve(Qe,Be,it,Vt):null;case me:return it.key===vn?ut(Qe,Be,it,Vt):null;case Fe:return vn=it._init,kt(Qe,Be,vn(it._payload),Vt)}if(ve(it)||Te(it))return vn!==null?null:xt(Qe,Be,it,Vt,null);VE(Qe,it)}return null}function ln(Qe,Be,it,Vt,vn){if(typeof Vt=="string"&&Vt!==""||typeof Vt=="number")return Qe=Qe.get(it)||null,Oe(Be,Qe,""+Vt,vn);if(typeof Vt=="object"&&Vt!==null){switch(Vt.$$typeof){case re:return Qe=Qe.get(Vt.key===null?it:Vt.key)||null,Ve(Be,Qe,Vt,vn);case me:return Qe=Qe.get(Vt.key===null?it:Vt.key)||null,ut(Be,Qe,Vt,vn);case Fe:var On=Vt._init;return ln(Qe,Be,it,On(Vt._payload),vn)}if(ve(Vt)||Te(Vt))return Qe=Qe.get(it)||null,xt(Be,Qe,Vt,vn,null);VE(Be,Vt)}return null}function gn(Qe,Be,it,Vt){for(var vn=null,On=null,kn=Be,jn=Be=0,no=null;kn!==null&&jn<it.length;jn++){kn.index>jn?(no=kn,kn=null):no=kn.sibling;var Jr=kt(Qe,kn,it[jn],Vt);if(Jr===null){kn===null&&(kn=no);break}p&&kn&&Jr.alternate===null&&_(Qe,kn),Be=K(Jr,Be,jn),On===null?vn=Jr:On.sibling=Jr,On=Jr,kn=no}if(jn===it.length)return T(Qe,kn),ji&&Yp(Qe,jn),vn;if(kn===null){for(;jn<it.length;jn++)kn=Dt(Qe,it[jn],Vt),kn!==null&&(Be=K(kn,Be,jn),On===null?vn=kn:On.sibling=kn,On=kn);return ji&&Yp(Qe,jn),vn}for(kn=x(Qe,kn);jn<it.length;jn++)no=ln(kn,Qe,jn,it[jn],Vt),no!==null&&(p&&no.alternate!==null&&kn.delete(no.key===null?jn:no.key),Be=K(no,Be,jn),On===null?vn=no:On.sibling=no,On=no);return p&&kn.forEach(function(Du){return _(Qe,Du)}),ji&&Yp(Qe,jn),vn}function yn(Qe,Be,it,Vt){var vn=Te(it);if(typeof vn!="function")throw Error(i(150));if(it=vn.call(it),it==null)throw Error(i(151));for(var On=vn=null,kn=Be,jn=Be=0,no=null,Jr=it.next();kn!==null&&!Jr.done;jn++,Jr=it.next()){kn.index>jn?(no=kn,kn=null):no=kn.sibling;var Du=kt(Qe,kn,Jr.value,Vt);if(Du===null){kn===null&&(kn=no);break}p&&kn&&Du.alternate===null&&_(Qe,kn),Be=K(Du,Be,jn),On===null?vn=Du:On.sibling=Du,On=Du,kn=no}if(Jr.done)return T(Qe,kn),ji&&Yp(Qe,jn),vn;if(kn===null){for(;!Jr.done;jn++,Jr=it.next())Jr=Dt(Qe,Jr.value,Vt),Jr!==null&&(Be=K(Jr,Be,jn),On===null?vn=Jr:On.sibling=Jr,On=Jr);return ji&&Yp(Qe,jn),vn}for(kn=x(Qe,kn);!Jr.done;jn++,Jr=it.next())Jr=ln(kn,Qe,jn,Jr.value,Vt),Jr!==null&&(p&&Jr.alternate!==null&&kn.delete(Jr.key===null?jn:Jr.key),Be=K(Jr,Be,jn),On===null?vn=Jr:On.sibling=Jr,On=Jr);return p&&kn.forEach(function(kx){return _(Qe,kx)}),ji&&Yp(Qe,jn),vn}function ns(Qe,Be,it,Vt){if(typeof it=="object"&&it!==null&&it.type===q&&it.key===null&&(it=it.props.children),typeof it=="object"&&it!==null){switch(it.$$typeof){case re:e:{for(var vn=it.key,On=Be;On!==null;){if(On.key===vn){if(vn=it.type,vn===q){if(On.tag===7){T(Qe,On.sibling),Be=j(On,it.props.children),Be.return=Qe,Qe=Be;break e}}else if(On.elementType===vn||typeof vn=="object"&&vn!==null&&vn.$$typeof===Fe&&Rb(vn)===On.type){T(Qe,On.sibling),Be=j(On,it.props),Be.ref=g_(Qe,On,it),Be.return=Qe,Qe=Be;break e}T(Qe,On);break}else _(Qe,On);On=On.sibling}it.type===q?(Be=Yh(it.props.children,Qe.mode,Vt,it.key),Be.return=Qe,Qe=Be):(Vt=Mm(it.type,it.key,it.props,null,Qe.mode,Vt),Vt.ref=g_(Qe,Be,it),Vt.return=Qe,Qe=Vt)}return fe(Qe);case me:e:{for(On=it.key;Be!==null;){if(Be.key===On)if(Be.tag===4&&Be.stateNode.containerInfo===it.containerInfo&&Be.stateNode.implementation===it.implementation){T(Qe,Be.sibling),Be=j(Be,it.children||[]),Be.return=Qe,Qe=Be;break e}else{T(Qe,Be);break}else _(Qe,Be);Be=Be.sibling}Be=Um(it,Qe.mode,Vt),Be.return=Qe,Qe=Be}return fe(Qe);case Fe:return On=it._init,ns(Qe,Be,On(it._payload),Vt)}if(ve(it))return gn(Qe,Be,it,Vt);if(Te(it))return yn(Qe,Be,it,Vt);VE(Qe,it)}return typeof it=="string"&&it!==""||typeof it=="number"?(it=""+it,Be!==null&&Be.tag===6?(T(Qe,Be.sibling),Be=j(Be,it),Be.return=Qe,Qe=Be):(T(Qe,Be),Be=fv(it,Qe.mode,Vt),Be.return=Qe,Qe=Be),fe(Qe)):T(Qe,Be)}return ns}var Cm=CI(!0),Ib=CI(!1),jE=Wl(null),FE=null,Rm=null,Ab=null;function Pb(){Ab=Rm=FE=null}function Ob(p){var _=jE.current;Ti(jE),p._currentValue=_}function BE(p,_,T){for(;p!==null;){var x=p.alternate;if((p.childLanes&_)!==_?(p.childLanes|=_,x!==null&&(x.childLanes|=_)):x!==null&&(x.childLanes&_)!==_&&(x.childLanes|=_),p===T)break;p=p.return}}function Hl(p,_){FE=p,Ab=Rm=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&_)!==0&&(Qa=!0),p.firstContext=null)}function Jc(p){var _=p._currentValue;if(Ab!==p)if(p={context:p,memoizedValue:_,next:null},Rm===null){if(FE===null)throw Error(i(308));Rm=p,FE.dependencies={lanes:0,firstContext:p}}else Rm=Rm.next=p;return _}var Jp=null;function kb(p){Jp===null?Jp=[p]:Jp.push(p)}function Nb(p,_,T,x){var j=_.interleaved;return j===null?(T.next=T,kb(_)):(T.next=j.next,j.next=T),_.interleaved=T,kd(p,x)}function kd(p,_){p.lanes|=_;var T=p.alternate;for(T!==null&&(T.lanes|=_),T=p,p=p.return;p!==null;)p.childLanes|=_,T=p.alternate,T!==null&&(T.childLanes|=_),T=p,p=p.return;return T.tag===3?T.stateNode:null}var Nd=!1;function xb(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function RI(p,_){p=p.updateQueue,_.updateQueue===p&&(_.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function xd(p,_){return{eventTime:p,lane:_,tag:0,payload:null,callback:null,next:null}}function $l(p,_,T){var x=p.updateQueue;if(x===null)return null;if(x=x.shared,(Rr&2)!==0){var j=x.pending;return j===null?_.next=_:(_.next=j.next,j.next=_),x.pending=_,kd(p,T)}return j=x.interleaved,j===null?(_.next=_,kb(x)):(_.next=j.next,j.next=_),x.interleaved=_,kd(p,T)}function zE(p,_,T){if(_=_.updateQueue,_!==null&&(_=_.shared,(T&4194240)!==0)){var x=_.lanes;x&=p.pendingLanes,T|=x,_.lanes=T,vu(p,T)}}function II(p,_){var T=p.updateQueue,x=p.alternate;if(x!==null&&(x=x.updateQueue,T===x)){var j=null,K=null;if(T=T.firstBaseUpdate,T!==null){do{var fe={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};K===null?j=K=fe:K=K.next=fe,T=T.next}while(T!==null);K===null?j=K=_:K=K.next=_}else j=K=_;T={baseState:x.baseState,firstBaseUpdate:j,lastBaseUpdate:K,shared:x.shared,effects:x.effects},p.updateQueue=T;return}p=T.lastBaseUpdate,p===null?T.firstBaseUpdate=_:p.next=_,T.lastBaseUpdate=_}function WE(p,_,T,x){var j=p.updateQueue;Nd=!1;var K=j.firstBaseUpdate,fe=j.lastBaseUpdate,Oe=j.shared.pending;if(Oe!==null){j.shared.pending=null;var Ve=Oe,ut=Ve.next;Ve.next=null,fe===null?K=ut:fe.next=ut,fe=Ve;var xt=p.alternate;xt!==null&&(xt=xt.updateQueue,Oe=xt.lastBaseUpdate,Oe!==fe&&(Oe===null?xt.firstBaseUpdate=ut:Oe.next=ut,xt.lastBaseUpdate=Ve))}if(K!==null){var Dt=j.baseState;fe=0,xt=ut=Ve=null,Oe=K;do{var kt=Oe.lane,ln=Oe.eventTime;if((x&kt)===kt){xt!==null&&(xt=xt.next={eventTime:ln,lane:0,tag:Oe.tag,payload:Oe.payload,callback:Oe.callback,next:null});e:{var gn=p,yn=Oe;switch(kt=_,ln=T,yn.tag){case 1:if(gn=yn.payload,typeof gn=="function"){Dt=gn.call(ln,Dt,kt);break e}Dt=gn;break e;case 3:gn.flags=gn.flags&-65537|128;case 0:if(gn=yn.payload,kt=typeof gn=="function"?gn.call(ln,Dt,kt):gn,kt==null)break e;Dt=Ne({},Dt,kt);break e;case 2:Nd=!0}}Oe.callback!==null&&Oe.lane!==0&&(p.flags|=64,kt=j.effects,kt===null?j.effects=[Oe]:kt.push(Oe))}else ln={eventTime:ln,lane:kt,tag:Oe.tag,payload:Oe.payload,callback:Oe.callback,next:null},xt===null?(ut=xt=ln,Ve=Dt):xt=xt.next=ln,fe|=kt;if(Oe=Oe.next,Oe===null){if(Oe=j.shared.pending,Oe===null)break;kt=Oe,Oe=kt.next,kt.next=null,j.lastBaseUpdate=kt,j.shared.pending=null}}while(!0);if(xt===null&&(Ve=Dt),j.baseState=Ve,j.firstBaseUpdate=ut,j.lastBaseUpdate=xt,_=j.shared.interleaved,_!==null){j=_;do fe|=j.lane,j=j.next;while(j!==_)}else K===null&&(j.shared.lanes=0);of|=fe,p.lanes=fe,p.memoizedState=Dt}}function AI(p,_,T){if(p=_.effects,_.effects=null,p!==null)for(_=0;_<p.length;_++){var x=p[_],j=x.callback;if(j!==null){if(x.callback=null,x=T,typeof j!="function")throw Error(i(191,j));j.call(x)}}}var __={},Pu=Wl(__),Qp=Wl(__),y_=Wl(__);function Uh(p){if(p===__)throw Error(i(174));return p}function Db(p,_){switch(ki(y_,_),ki(Qp,p),ki(Pu,__),p=_.nodeType,p){case 9:case 11:_=(_=_.documentElement)?_.namespaceURI:cn(null,"");break;default:p=p===8?_.parentNode:_,_=p.namespaceURI||null,p=p.tagName,_=cn(_,p)}Ti(Pu),ki(Pu,_)}function Zp(){Ti(Pu),Ti(Qp),Ti(y_)}function PI(p){Uh(y_.current);var _=Uh(Pu.current),T=cn(_,p.type);_!==T&&(ki(Qp,p),ki(Pu,T))}function Lb(p){Qp.current===p&&(Ti(Pu),Ti(Qp))}var es=Wl(0);function GE(p){for(var _=p;_!==null;){if(_.tag===13){var T=_.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||T.data==="$?"||T.data==="$!"))return _}else if(_.tag===19&&_.memoizedProps.revealOrder!==void 0){if((_.flags&128)!==0)return _}else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===p)break;for(;_.sibling===null;){if(_.return===null||_.return===p)return null;_=_.return}_.sibling.return=_.return,_=_.sibling}return null}var Mb=[];function Ub(){for(var p=0;p<Mb.length;p++)Mb[p]._workInProgressVersionPrimary=null;Mb.length=0}var E_=le.ReactCurrentDispatcher,Vb=le.ReactCurrentBatchConfig,ef=0,qi=null,Zs=null,ys=null,v_=!1,Dd=!1,S_=0,mx=0;function sa(){throw Error(i(321))}function jb(p,_){if(_===null)return!1;for(var T=0;T<_.length&&T<p.length;T++)if(!Bl(p[T],_[T]))return!1;return!0}function Im(p,_,T,x,j,K){if(ef=K,qi=_,_.memoizedState=null,_.updateQueue=null,_.lanes=0,E_.current=p===null||p.memoizedState===null?_x:VI,p=T(x,j),Dd){K=0;do{if(Dd=!1,S_=0,25<=K)throw Error(i(301));K+=1,ys=Zs=null,_.updateQueue=null,E_.current=yx,p=T(x,j)}while(Dd)}if(E_.current=Pm,_=Zs!==null&&Zs.next!==null,ef=0,ys=Zs=qi=null,v_=!1,_)throw Error(i(300));return p}function Fb(){var p=S_!==0;return S_=0,p}function Kl(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ys===null?qi.memoizedState=ys=p:ys=ys.next=p,ys}function Ja(){if(Zs===null){var p=qi.alternate;p=p!==null?p.memoizedState:null}else p=Zs.next;var _=ys===null?qi.memoizedState:ys.next;if(_!==null)ys=_,Zs=p;else{if(p===null)throw Error(i(310));Zs=p,p={memoizedState:Zs.memoizedState,baseState:Zs.baseState,baseQueue:Zs.baseQueue,queue:Zs.queue,next:null},ys===null?qi.memoizedState=ys=p:ys=ys.next=p}return ys}function tf(p,_){return typeof _=="function"?_(p):_}function Bb(p){var _=Ja(),T=_.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=p;var x=Zs,j=x.baseQueue,K=T.pending;if(K!==null){if(j!==null){var fe=j.next;j.next=K.next,K.next=fe}x.baseQueue=j=K,T.pending=null}if(j!==null){K=j.next,x=x.baseState;var Oe=fe=null,Ve=null,ut=K;do{var xt=ut.lane;if((ef&xt)===xt)Ve!==null&&(Ve=Ve.next={lane:0,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null}),x=ut.hasEagerState?ut.eagerState:p(x,ut.action);else{var Dt={lane:xt,action:ut.action,hasEagerState:ut.hasEagerState,eagerState:ut.eagerState,next:null};Ve===null?(Oe=Ve=Dt,fe=x):Ve=Ve.next=Dt,qi.lanes|=xt,of|=xt}ut=ut.next}while(ut!==null&&ut!==K);Ve===null?fe=x:Ve.next=Oe,Bl(x,_.memoizedState)||(Qa=!0),_.memoizedState=x,_.baseState=fe,_.baseQueue=Ve,T.lastRenderedState=x}if(p=T.interleaved,p!==null){j=p;do K=j.lane,qi.lanes|=K,of|=K,j=j.next;while(j!==p)}else j===null&&(T.lanes=0);return[_.memoizedState,T.dispatch]}function zb(p){var _=Ja(),T=_.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=p;var x=T.dispatch,j=T.pending,K=_.memoizedState;if(j!==null){T.pending=null;var fe=j=j.next;do K=p(K,fe.action),fe=fe.next;while(fe!==j);Bl(K,_.memoizedState)||(Qa=!0),_.memoizedState=K,_.baseQueue===null&&(_.baseState=K),T.lastRenderedState=K}return[K,x]}function OI(){}function kI(p,_){var T=qi,x=Ja(),j=_(),K=!Bl(x.memoizedState,j);if(K&&(x.memoizedState=j,Qa=!0),x=x.queue,KE(xI.bind(null,T,x,p),[p]),x.getSnapshot!==_||K||ys!==null&&ys.memoizedState.tag&1){if(T.flags|=2048,Ld(9,b_.bind(null,T,x,j,_),void 0,null),eo===null)throw Error(i(349));(ef&30)!==0||NI(T,_,j)}return j}function NI(p,_,T){p.flags|=16384,p={getSnapshot:_,value:T},_=qi.updateQueue,_===null?(_={lastEffect:null,stores:null},qi.updateQueue=_,_.stores=[p]):(T=_.stores,T===null?_.stores=[p]:T.push(p))}function b_(p,_,T,x){_.value=T,_.getSnapshot=x,nf(_)&&HE(p)}function xI(p,_,T){return T(function(){nf(_)&&HE(p)})}function nf(p){var _=p.getSnapshot;p=p.value;try{var T=_();return!Bl(p,T)}catch{return!0}}function HE(p){var _=kd(p,1);_!==null&&Rc(_,p,1,-1)}function w_(p){var _=Kl();return typeof p=="function"&&(p=p()),_.memoizedState=_.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:tf,lastRenderedState:p},_.queue=p,p=p.dispatch=rf.bind(null,qi,p),[_.memoizedState,p]}function Ld(p,_,T,x){return p={tag:p,create:_,destroy:T,deps:x,next:null},_=qi.updateQueue,_===null?(_={lastEffect:null,stores:null},qi.updateQueue=_,_.lastEffect=p.next=p):(T=_.lastEffect,T===null?_.lastEffect=p.next=p:(x=T.next,T.next=p,p.next=x,_.lastEffect=p)),p}function T_(){return Ja().memoizedState}function $E(p,_,T,x){var j=Kl();qi.flags|=p,j.memoizedState=Ld(1|_,T,void 0,x===void 0?null:x)}function C_(p,_,T,x){var j=Ja();x=x===void 0?null:x;var K=void 0;if(Zs!==null){var fe=Zs.memoizedState;if(K=fe.destroy,x!==null&&jb(x,fe.deps)){j.memoizedState=Ld(_,T,K,x);return}}qi.flags|=p,j.memoizedState=Ld(1|_,T,K,x)}function DI(p,_){return $E(8390656,8,p,_)}function KE(p,_){return C_(2048,8,p,_)}function LI(p,_){return C_(4,2,p,_)}function MI(p,_){return C_(4,4,p,_)}function qE(p,_){if(typeof _=="function")return p=p(),_(p),function(){_(null)};if(_!=null)return p=p(),_.current=p,function(){_.current=null}}function YE(p,_,T){return T=T!=null?T.concat([p]):null,C_(4,4,qE.bind(null,_,p),T)}function Wb(){}function UI(p,_){var T=Ja();_=_===void 0?null:_;var x=T.memoizedState;return x!==null&&_!==null&&jb(_,x[1])?x[0]:(T.memoizedState=[p,_],p)}function Gb(p,_){var T=Ja();_=_===void 0?null:_;var x=T.memoizedState;return x!==null&&_!==null&&jb(_,x[1])?x[0]:(p=p(),T.memoizedState=[p,_],p)}function XE(p,_,T){return(ef&21)===0?(p.baseState&&(p.baseState=!1,Qa=!0),p.memoizedState=T):(Bl(T,_)||(T=Gr(),qi.lanes|=T,of|=T,p.baseState=!0),_)}function gx(p,_){var T=yr;yr=T!==0&&4>T?T:4,p(!0);var x=Vb.transition;Vb.transition={};try{p(!1),_()}finally{yr=T,Vb.transition=x}}function ql(){return Ja().memoizedState}function Am(p,_,T){var x=Gh(p);if(T={lane:x,action:T,hasEagerState:!1,eagerState:null,next:null},Hb(p))$b(_,T);else if(T=Nb(p,_,T,x),T!==null){var j=Oa();Rc(T,p,x,j),Vh(T,_,x)}}function rf(p,_,T){var x=Gh(p),j={lane:x,action:T,hasEagerState:!1,eagerState:null,next:null};if(Hb(p))$b(_,j);else{var K=p.alternate;if(p.lanes===0&&(K===null||K.lanes===0)&&(K=_.lastRenderedReducer,K!==null))try{var fe=_.lastRenderedState,Oe=K(fe,T);if(j.hasEagerState=!0,j.eagerState=Oe,Bl(Oe,fe)){var Ve=_.interleaved;Ve===null?(j.next=j,kb(_)):(j.next=Ve.next,Ve.next=j),_.interleaved=j;return}}catch{}finally{}T=Nb(p,_,j,x),T!==null&&(j=Oa(),Rc(T,p,x,j),Vh(T,_,x))}}function Hb(p){var _=p.alternate;return p===qi||_!==null&&_===qi}function $b(p,_){Dd=v_=!0;var T=p.pending;T===null?_.next=_:(_.next=T.next,T.next=_),p.pending=_}function Vh(p,_,T){if((T&4194240)!==0){var x=_.lanes;x&=p.pendingLanes,T|=x,_.lanes=T,vu(p,T)}}var Pm={readContext:Jc,useCallback:sa,useContext:sa,useEffect:sa,useImperativeHandle:sa,useInsertionEffect:sa,useLayoutEffect:sa,useMemo:sa,useReducer:sa,useRef:sa,useState:sa,useDebugValue:sa,useDeferredValue:sa,useTransition:sa,useMutableSource:sa,useSyncExternalStore:sa,useId:sa,unstable_isNewReconciler:!1},_x={readContext:Jc,useCallback:function(p,_){return Kl().memoizedState=[p,_===void 0?null:_],p},useContext:Jc,useEffect:DI,useImperativeHandle:function(p,_,T){return T=T!=null?T.concat([p]):null,$E(4194308,4,qE.bind(null,_,p),T)},useLayoutEffect:function(p,_){return $E(4194308,4,p,_)},useInsertionEffect:function(p,_){return $E(4,2,p,_)},useMemo:function(p,_){var T=Kl();return _=_===void 0?null:_,p=p(),T.memoizedState=[p,_],p},useReducer:function(p,_,T){var x=Kl();return _=T!==void 0?T(_):_,x.memoizedState=x.baseState=_,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:_},x.queue=p,p=p.dispatch=Am.bind(null,qi,p),[x.memoizedState,p]},useRef:function(p){var _=Kl();return p={current:p},_.memoizedState=p},useState:w_,useDebugValue:Wb,useDeferredValue:function(p){return Kl().memoizedState=p},useTransition:function(){var p=w_(!1),_=p[0];return p=gx.bind(null,p[1]),Kl().memoizedState=p,[_,p]},useMutableSource:function(){},useSyncExternalStore:function(p,_,T){var x=qi,j=Kl();if(ji){if(T===void 0)throw Error(i(407));T=T()}else{if(T=_(),eo===null)throw Error(i(349));(ef&30)!==0||NI(x,_,T)}j.memoizedState=T;var K={value:T,getSnapshot:_};return j.queue=K,DI(xI.bind(null,x,K,p),[p]),x.flags|=2048,Ld(9,b_.bind(null,x,K,T,_),void 0,null),T},useId:function(){var p=Kl(),_=eo.identifierPrefix;if(ji){var T=Od,x=Pd;T=(x&~(1<<32-gs(x)-1)).toString(32)+T,_=":"+_+"R"+T,T=S_++,0<T&&(_+="H"+T.toString(32)),_+=":"}else T=mx++,_=":"+_+"r"+T.toString(32)+":";return p.memoizedState=_},unstable_isNewReconciler:!1},VI={readContext:Jc,useCallback:UI,useContext:Jc,useEffect:KE,useImperativeHandle:YE,useInsertionEffect:LI,useLayoutEffect:MI,useMemo:Gb,useReducer:Bb,useRef:T_,useState:function(){return Bb(tf)},useDebugValue:Wb,useDeferredValue:function(p){var _=Ja();return XE(_,Zs.memoizedState,p)},useTransition:function(){var p=Bb(tf)[0],_=Ja().memoizedState;return[p,_]},useMutableSource:OI,useSyncExternalStore:kI,useId:ql,unstable_isNewReconciler:!1},yx={readContext:Jc,useCallback:UI,useContext:Jc,useEffect:KE,useImperativeHandle:YE,useInsertionEffect:LI,useLayoutEffect:MI,useMemo:Gb,useReducer:zb,useRef:T_,useState:function(){return zb(tf)},useDebugValue:Wb,useDeferredValue:function(p){var _=Ja();return Zs===null?_.memoizedState=p:XE(_,Zs.memoizedState,p)},useTransition:function(){var p=zb(tf)[0],_=Ja().memoizedState;return[p,_]},useMutableSource:OI,useSyncExternalStore:kI,useId:ql,unstable_isNewReconciler:!1};function Qc(p,_){if(p&&p.defaultProps){_=Ne({},_),p=p.defaultProps;for(var T in p)_[T]===void 0&&(_[T]=p[T]);return _}return _}function JE(p,_,T,x){_=p.memoizedState,T=T(x,_),T=T==null?_:Ne({},_,T),p.memoizedState=T,p.lanes===0&&(p.updateQueue.baseState=T)}var QE={isMounted:function(p){return(p=p._reactInternals)?xs(p)===p:!1},enqueueSetState:function(p,_,T){p=p._reactInternals;var x=Oa(),j=Gh(p),K=xd(x,j);K.payload=_,T!=null&&(K.callback=T),_=$l(p,K,j),_!==null&&(Rc(_,p,j,x),zE(_,p,j))},enqueueReplaceState:function(p,_,T){p=p._reactInternals;var x=Oa(),j=Gh(p),K=xd(x,j);K.tag=1,K.payload=_,T!=null&&(K.callback=T),_=$l(p,K,j),_!==null&&(Rc(_,p,j,x),zE(_,p,j))},enqueueForceUpdate:function(p,_){p=p._reactInternals;var T=Oa(),x=Gh(p),j=xd(T,x);j.tag=2,_!=null&&(j.callback=_),_=$l(p,j,x),_!==null&&(Rc(_,p,x,T),zE(_,p,x))}};function Md(p,_,T,x,j,K,fe){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(x,K,fe):_.prototype&&_.prototype.isPureReactComponent?!pm(T,x)||!pm(j,K):!0}function jI(p,_,T){var x=!1,j=Nh,K=_.contextType;return typeof K=="object"&&K!==null?K=Jc(K):(j=Xa(_)?xh:ia.current,x=_.contextTypes,K=(x=x!=null)?Dh(p,j):Nh),_=new _(T,K),p.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=QE,p.stateNode=_,_._reactInternals=p,x&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=j,p.__reactInternalMemoizedMaskedChildContext=K),_}function FI(p,_,T,x){p=_.state,typeof _.componentWillReceiveProps=="function"&&_.componentWillReceiveProps(T,x),typeof _.UNSAFE_componentWillReceiveProps=="function"&&_.UNSAFE_componentWillReceiveProps(T,x),_.state!==p&&QE.enqueueReplaceState(_,_.state,null)}function Kb(p,_,T,x){var j=p.stateNode;j.props=T,j.state=p.memoizedState,j.refs={},xb(p);var K=_.contextType;typeof K=="object"&&K!==null?j.context=Jc(K):(K=Xa(_)?xh:ia.current,j.context=Dh(p,K)),j.state=p.memoizedState,K=_.getDerivedStateFromProps,typeof K=="function"&&(JE(p,_,K,T),j.state=p.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof j.getSnapshotBeforeUpdate=="function"||typeof j.UNSAFE_componentWillMount!="function"&&typeof j.componentWillMount!="function"||(_=j.state,typeof j.componentWillMount=="function"&&j.componentWillMount(),typeof j.UNSAFE_componentWillMount=="function"&&j.UNSAFE_componentWillMount(),_!==j.state&&QE.enqueueReplaceState(j,j.state,null),WE(p,T,j,x),j.state=p.memoizedState),typeof j.componentDidMount=="function"&&(p.flags|=4194308)}function Om(p,_){try{var T="",x=_;do T+=dt(x),x=x.return;while(x);var j=T}catch(K){j=`
Error generating stack: `+K.message+`
`+K.stack}return{value:p,source:_,stack:j,digest:null}}function ZE(p,_,T){return{value:p,source:null,stack:T??null,digest:_??null}}function qb(p,_){try{console.error(_.value)}catch(T){setTimeout(function(){throw T})}}var Yb=typeof WeakMap=="function"?WeakMap:Map;function Xb(p,_,T){T=xd(-1,T),T.tag=3,T.payload={element:null};var x=_.value;return T.callback=function(){aa||(aa=!0,mw=x),qb(p,_)},T}function BI(p,_,T){T=xd(-1,T),T.tag=3;var x=p.type.getDerivedStateFromError;if(typeof x=="function"){var j=_.value;T.payload=function(){return x(j)},T.callback=function(){qb(p,_)}}var K=p.stateNode;return K!==null&&typeof K.componentDidCatch=="function"&&(T.callback=function(){qb(p,_),typeof x!="function"&&(zh===null?zh=new Set([this]):zh.add(this));var fe=_.stack;this.componentDidCatch(_.value,{componentStack:fe!==null?fe:""})}),T}function Jb(p,_,T){var x=p.pingCache;if(x===null){x=p.pingCache=new Yb;var j=new Set;x.set(_,j)}else j=x.get(_),j===void 0&&(j=new Set,x.set(_,j));j.has(T)||(j.add(T),p=sA.bind(null,p,_,T),_.then(p,p))}function zI(p){do{var _;if((_=p.tag===13)&&(_=p.memoizedState,_=_!==null?_.dehydrated!==null:!0),_)return p;p=p.return}while(p!==null);return null}function WI(p,_,T,x,j){return(p.mode&1)===0?(p===_?p.flags|=65536:(p.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(_=xd(-1,1),_.tag=2,$l(T,_,1))),T.lanes|=1),p):(p.flags|=65536,p.lanes=j,p)}var Ex=le.ReactCurrentOwner,Qa=!1;function Pa(p,_,T,x){_.child=p===null?Ib(_,null,T,x):Cm(_,p.child,T,x)}function GI(p,_,T,x,j){T=T.render;var K=_.ref;return Hl(_,j),x=Im(p,_,T,x,K,j),T=Fb(),p!==null&&!Qa?(_.updateQueue=p.updateQueue,_.flags&=-2053,p.lanes&=~j,Ud(p,_,j)):(ji&&T&&bm(_),_.flags|=1,Pa(p,_,x,j),_.child)}function HI(p,_,T,x,j){if(p===null){var K=T.type;return typeof K=="function"&&!Cw(K)&&K.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(_.tag=15,_.type=K,Qb(p,_,K,x,j)):(p=Mm(T.type,null,x,_,_.mode,j),p.ref=_.ref,p.return=_,_.child=p)}if(K=p.child,(p.lanes&j)===0){var fe=K.memoizedProps;if(T=T.compare,T=T!==null?T:pm,T(fe,x)&&p.ref===_.ref)return Ud(p,_,j)}return _.flags|=1,p=qh(K,x),p.ref=_.ref,p.return=_,_.child=p}function Qb(p,_,T,x,j){if(p!==null){var K=p.memoizedProps;if(pm(K,x)&&p.ref===_.ref)if(Qa=!1,_.pendingProps=x=K,(p.lanes&j)!==0)(p.flags&131072)!==0&&(Qa=!0);else return _.lanes=p.lanes,Ud(p,_,j)}return Zb(p,_,T,x,j)}function Ou(p,_,T){var x=_.pendingProps,j=x.children,K=p!==null?p.memoizedState:null;if(x.mode==="hidden")if((_.mode&1)===0)_.memoizedState={baseLanes:0,cachePool:null,transitions:null},ki(km,Cc),Cc|=T;else{if((T&1073741824)===0)return p=K!==null?K.baseLanes|T:T,_.lanes=_.childLanes=1073741824,_.memoizedState={baseLanes:p,cachePool:null,transitions:null},_.updateQueue=null,ki(km,Cc),Cc|=p,null;_.memoizedState={baseLanes:0,cachePool:null,transitions:null},x=K!==null?K.baseLanes:T,ki(km,Cc),Cc|=x}else K!==null?(x=K.baseLanes|T,_.memoizedState=null):x=T,ki(km,Cc),Cc|=x;return Pa(p,_,j,T),_.child}function $I(p,_){var T=_.ref;(p===null&&T!==null||p!==null&&p.ref!==T)&&(_.flags|=512,_.flags|=2097152)}function Zb(p,_,T,x,j){var K=Xa(T)?xh:ia.current;return K=Dh(_,K),Hl(_,j),T=Im(p,_,T,x,K,j),x=Fb(),p!==null&&!Qa?(_.updateQueue=p.updateQueue,_.flags&=-2053,p.lanes&=~j,Ud(p,_,j)):(ji&&x&&bm(_),_.flags|=1,Pa(p,_,T,j),_.child)}function KI(p,_,T,x,j){if(Xa(T)){var K=!0;xE(_)}else K=!1;if(Hl(_,j),_.stateNode===null)nv(p,_),jI(_,T,x),Kb(_,T,x,j),x=!0;else if(p===null){var fe=_.stateNode,Oe=_.memoizedProps;fe.props=Oe;var Ve=fe.context,ut=T.contextType;typeof ut=="object"&&ut!==null?ut=Jc(ut):(ut=Xa(T)?xh:ia.current,ut=Dh(_,ut));var xt=T.getDerivedStateFromProps,Dt=typeof xt=="function"||typeof fe.getSnapshotBeforeUpdate=="function";Dt||typeof fe.UNSAFE_componentWillReceiveProps!="function"&&typeof fe.componentWillReceiveProps!="function"||(Oe!==x||Ve!==ut)&&FI(_,fe,x,ut),Nd=!1;var kt=_.memoizedState;fe.state=kt,WE(_,x,fe,j),Ve=_.memoizedState,Oe!==x||kt!==Ve||Ia.current||Nd?(typeof xt=="function"&&(JE(_,T,xt,x),Ve=_.memoizedState),(Oe=Nd||Md(_,T,Oe,x,kt,Ve,ut))?(Dt||typeof fe.UNSAFE_componentWillMount!="function"&&typeof fe.componentWillMount!="function"||(typeof fe.componentWillMount=="function"&&fe.componentWillMount(),typeof fe.UNSAFE_componentWillMount=="function"&&fe.UNSAFE_componentWillMount()),typeof fe.componentDidMount=="function"&&(_.flags|=4194308)):(typeof fe.componentDidMount=="function"&&(_.flags|=4194308),_.memoizedProps=x,_.memoizedState=Ve),fe.props=x,fe.state=Ve,fe.context=ut,x=Oe):(typeof fe.componentDidMount=="function"&&(_.flags|=4194308),x=!1)}else{fe=_.stateNode,RI(p,_),Oe=_.memoizedProps,ut=_.type===_.elementType?Oe:Qc(_.type,Oe),fe.props=ut,Dt=_.pendingProps,kt=fe.context,Ve=T.contextType,typeof Ve=="object"&&Ve!==null?Ve=Jc(Ve):(Ve=Xa(T)?xh:ia.current,Ve=Dh(_,Ve));var ln=T.getDerivedStateFromProps;(xt=typeof ln=="function"||typeof fe.getSnapshotBeforeUpdate=="function")||typeof fe.UNSAFE_componentWillReceiveProps!="function"&&typeof fe.componentWillReceiveProps!="function"||(Oe!==Dt||kt!==Ve)&&FI(_,fe,x,Ve),Nd=!1,kt=_.memoizedState,fe.state=kt,WE(_,x,fe,j);var gn=_.memoizedState;Oe!==Dt||kt!==gn||Ia.current||Nd?(typeof ln=="function"&&(JE(_,T,ln,x),gn=_.memoizedState),(ut=Nd||Md(_,T,ut,x,kt,gn,Ve)||!1)?(xt||typeof fe.UNSAFE_componentWillUpdate!="function"&&typeof fe.componentWillUpdate!="function"||(typeof fe.componentWillUpdate=="function"&&fe.componentWillUpdate(x,gn,Ve),typeof fe.UNSAFE_componentWillUpdate=="function"&&fe.UNSAFE_componentWillUpdate(x,gn,Ve)),typeof fe.componentDidUpdate=="function"&&(_.flags|=4),typeof fe.getSnapshotBeforeUpdate=="function"&&(_.flags|=1024)):(typeof fe.componentDidUpdate!="function"||Oe===p.memoizedProps&&kt===p.memoizedState||(_.flags|=4),typeof fe.getSnapshotBeforeUpdate!="function"||Oe===p.memoizedProps&&kt===p.memoizedState||(_.flags|=1024),_.memoizedProps=x,_.memoizedState=gn),fe.props=x,fe.state=gn,fe.context=Ve,x=ut):(typeof fe.componentDidUpdate!="function"||Oe===p.memoizedProps&&kt===p.memoizedState||(_.flags|=4),typeof fe.getSnapshotBeforeUpdate!="function"||Oe===p.memoizedProps&&kt===p.memoizedState||(_.flags|=1024),x=!1)}return ew(p,_,T,x,K,j)}function ew(p,_,T,x,j,K){$I(p,_);var fe=(_.flags&128)!==0;if(!x&&!fe)return j&&SI(_,T,!1),Ud(p,_,K);x=_.stateNode,Ex.current=_;var Oe=fe&&typeof T.getDerivedStateFromError!="function"?null:x.render();return _.flags|=1,p!==null&&fe?(_.child=Cm(_,p.child,null,K),_.child=Cm(_,null,Oe,K)):Pa(p,_,Oe,K),_.memoizedState=x.state,j&&SI(_,T,!0),_.child}function qI(p){var _=p.stateNode;_.pendingContext?vm(p,_.pendingContext,_.pendingContext!==_.context):_.context&&vm(p,_.context,!1),Db(p,_.containerInfo)}function YI(p,_,T,x,j){return Xp(),Tm(j),_.flags|=256,Pa(p,_,T,x),_.child}var R_={dehydrated:null,treeContext:null,retryLane:0};function tw(p){return{baseLanes:p,cachePool:null,transitions:null}}function XI(p,_,T){var x=_.pendingProps,j=es.current,K=!1,fe=(_.flags&128)!==0,Oe;if((Oe=fe)||(Oe=p!==null&&p.memoizedState===null?!1:(j&2)!==0),Oe?(K=!0,_.flags&=-129):(p===null||p.memoizedState!==null)&&(j|=1),ki(es,j&1),p===null)return f_(_),p=_.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((_.mode&1)===0?_.lanes=1:p.data==="$!"?_.lanes=8:_.lanes=1073741824,null):(fe=x.children,p=x.fallback,K?(x=_.mode,K=_.child,fe={mode:"hidden",children:fe},(x&1)===0&&K!==null?(K.childLanes=0,K.pendingProps=fe):K=U_(fe,x,0,null),p=Yh(p,x,T,null),K.return=_,p.return=_,K.sibling=p,_.child=K,_.child.memoizedState=tw(T),_.memoizedState=R_,p):nw(_,fe));if(j=p.memoizedState,j!==null&&(Oe=j.dehydrated,Oe!==null))return vx(p,_,fe,x,Oe,j,T);if(K){K=x.fallback,fe=_.mode,j=p.child,Oe=j.sibling;var Ve={mode:"hidden",children:x.children};return(fe&1)===0&&_.child!==j?(x=_.child,x.childLanes=0,x.pendingProps=Ve,_.deletions=null):(x=qh(j,Ve),x.subtreeFlags=j.subtreeFlags&14680064),Oe!==null?K=qh(Oe,K):(K=Yh(K,fe,T,null),K.flags|=2),K.return=_,x.return=_,x.sibling=K,_.child=x,x=K,K=_.child,fe=p.child.memoizedState,fe=fe===null?tw(T):{baseLanes:fe.baseLanes|T,cachePool:null,transitions:fe.transitions},K.memoizedState=fe,K.childLanes=p.childLanes&~T,_.memoizedState=R_,x}return K=p.child,p=K.sibling,x=qh(K,{mode:"visible",children:x.children}),(_.mode&1)===0&&(x.lanes=T),x.return=_,x.sibling=null,p!==null&&(T=_.deletions,T===null?(_.deletions=[p],_.flags|=16):T.push(p)),_.child=x,_.memoizedState=null,x}function nw(p,_){return _=U_({mode:"visible",children:_},p.mode,0,null),_.return=p,p.child=_}function ev(p,_,T,x){return x!==null&&Tm(x),Cm(_,p.child,null,T),p=nw(_,_.pendingProps.children),p.flags|=2,_.memoizedState=null,p}function vx(p,_,T,x,j,K,fe){if(T)return _.flags&256?(_.flags&=-257,x=ZE(Error(i(422))),ev(p,_,fe,x)):_.memoizedState!==null?(_.child=p.child,_.flags|=128,null):(K=x.fallback,j=_.mode,x=U_({mode:"visible",children:x.children},j,0,null),K=Yh(K,j,fe,null),K.flags|=2,x.return=_,K.return=_,x.sibling=K,_.child=x,(_.mode&1)!==0&&Cm(_,p.child,null,fe),_.child.memoizedState=tw(fe),_.memoizedState=R_,K);if((_.mode&1)===0)return ev(p,_,fe,null);if(j.data==="$!"){if(x=j.nextSibling&&j.nextSibling.dataset,x)var Oe=x.dgst;return x=Oe,K=Error(i(419)),x=ZE(K,x,void 0),ev(p,_,fe,x)}if(Oe=(fe&p.childLanes)!==0,Qa||Oe){if(x=eo,x!==null){switch(fe&-fe){case 4:j=2;break;case 16:j=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:j=32;break;case 536870912:j=268435456;break;default:j=0}j=(j&(x.suspendedLanes|fe))!==0?0:j,j!==0&&j!==K.retryLane&&(K.retryLane=j,kd(p,j),Rc(x,p,j,-1))}return Dm(),x=ZE(Error(i(421))),ev(p,_,fe,x)}return j.data==="$?"?(_.flags|=128,_.child=p.child,_=Ax.bind(null,p),j._reactRetry=_,null):(p=K.treeContext,wc=Iu(j.nextSibling),bc=_,ji=!0,Gl=null,p!==null&&(Aa[Xc++]=Pd,Aa[Xc++]=Od,Aa[Xc++]=qp,Pd=p.id,Od=p.overflow,qp=_),_=nw(_,x.children),_.flags|=4096,_)}function JI(p,_,T){p.lanes|=_;var x=p.alternate;x!==null&&(x.lanes|=_),BE(p.return,_,T)}function tv(p,_,T,x,j){var K=p.memoizedState;K===null?p.memoizedState={isBackwards:_,rendering:null,renderingStartTime:0,last:x,tail:T,tailMode:j}:(K.isBackwards=_,K.rendering=null,K.renderingStartTime=0,K.last=x,K.tail=T,K.tailMode=j)}function rw(p,_,T){var x=_.pendingProps,j=x.revealOrder,K=x.tail;if(Pa(p,_,x.children,T),x=es.current,(x&2)!==0)x=x&1|2,_.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=_.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&JI(p,T,_);else if(p.tag===19)JI(p,T,_);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===_)break e;for(;p.sibling===null;){if(p.return===null||p.return===_)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}x&=1}if(ki(es,x),(_.mode&1)===0)_.memoizedState=null;else switch(j){case"forwards":for(T=_.child,j=null;T!==null;)p=T.alternate,p!==null&&GE(p)===null&&(j=T),T=T.sibling;T=j,T===null?(j=_.child,_.child=null):(j=T.sibling,T.sibling=null),tv(_,!1,j,T,K);break;case"backwards":for(T=null,j=_.child,_.child=null;j!==null;){if(p=j.alternate,p!==null&&GE(p)===null){_.child=j;break}p=j.sibling,j.sibling=T,T=j,j=p}tv(_,!0,T,null,K);break;case"together":tv(_,!1,null,null,void 0);break;default:_.memoizedState=null}return _.child}function nv(p,_){(_.mode&1)===0&&p!==null&&(p.alternate=null,_.alternate=null,_.flags|=2)}function Ud(p,_,T){if(p!==null&&(_.dependencies=p.dependencies),of|=_.lanes,(T&_.childLanes)===0)return null;if(p!==null&&_.child!==p.child)throw Error(i(153));if(_.child!==null){for(p=_.child,T=qh(p,p.pendingProps),_.child=T,T.return=_;p.sibling!==null;)p=p.sibling,T=T.sibling=qh(p,p.pendingProps),T.return=_;T.sibling=null}return _.child}function rv(p,_,T){switch(_.tag){case 3:qI(_),Xp();break;case 5:PI(_);break;case 1:Xa(_.type)&&xE(_);break;case 4:Db(_,_.stateNode.containerInfo);break;case 10:var x=_.type._context,j=_.memoizedProps.value;ki(jE,x._currentValue),x._currentValue=j;break;case 13:if(x=_.memoizedState,x!==null)return x.dehydrated!==null?(ki(es,es.current&1),_.flags|=128,null):(T&_.child.childLanes)!==0?XI(p,_,T):(ki(es,es.current&1),p=Ud(p,_,T),p!==null?p.sibling:null);ki(es,es.current&1);break;case 19:if(x=(T&_.childLanes)!==0,(p.flags&128)!==0){if(x)return rw(p,_,T);_.flags|=128}if(j=_.memoizedState,j!==null&&(j.rendering=null,j.tail=null,j.lastEffect=null),ki(es,es.current),x)break;return null;case 22:case 23:return _.lanes=0,Ou(p,_,T)}return Ud(p,_,T)}var iv,sv,I_,iw;iv=function(p,_){for(var T=_.child;T!==null;){if(T.tag===5||T.tag===6)p.appendChild(T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===_)break;for(;T.sibling===null;){if(T.return===null||T.return===_)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},sv=function(){},I_=function(p,_,T,x){var j=p.memoizedProps;if(j!==x){p=_.stateNode,Uh(Pu.current);var K=null;switch(T){case"input":j=st(p,j),x=st(p,x),K=[];break;case"select":j=Ne({},j,{value:void 0}),x=Ne({},x,{value:void 0}),K=[];break;case"textarea":j=Ke(p,j),x=Ke(p,x),K=[];break;default:typeof j.onClick!="function"&&typeof x.onClick=="function"&&(p.onclick=u_)}us(T,x);var fe;T=null;for(ut in j)if(!x.hasOwnProperty(ut)&&j.hasOwnProperty(ut)&&j[ut]!=null)if(ut==="style"){var Oe=j[ut];for(fe in Oe)Oe.hasOwnProperty(fe)&&(T||(T={}),T[fe]="")}else ut!=="dangerouslySetInnerHTML"&&ut!=="children"&&ut!=="suppressContentEditableWarning"&&ut!=="suppressHydrationWarning"&&ut!=="autoFocus"&&(l.hasOwnProperty(ut)?K||(K=[]):(K=K||[]).push(ut,null));for(ut in x){var Ve=x[ut];if(Oe=j!=null?j[ut]:void 0,x.hasOwnProperty(ut)&&Ve!==Oe&&(Ve!=null||Oe!=null))if(ut==="style")if(Oe){for(fe in Oe)!Oe.hasOwnProperty(fe)||Ve&&Ve.hasOwnProperty(fe)||(T||(T={}),T[fe]="");for(fe in Ve)Ve.hasOwnProperty(fe)&&Oe[fe]!==Ve[fe]&&(T||(T={}),T[fe]=Ve[fe])}else T||(K||(K=[]),K.push(ut,T)),T=Ve;else ut==="dangerouslySetInnerHTML"?(Ve=Ve?Ve.__html:void 0,Oe=Oe?Oe.__html:void 0,Ve!=null&&Oe!==Ve&&(K=K||[]).push(ut,Ve)):ut==="children"?typeof Ve!="string"&&typeof Ve!="number"||(K=K||[]).push(ut,""+Ve):ut!=="suppressContentEditableWarning"&&ut!=="suppressHydrationWarning"&&(l.hasOwnProperty(ut)?(Ve!=null&&ut==="onScroll"&&Oi("scroll",p),K||Oe===Ve||(K=[])):(K=K||[]).push(ut,Ve))}T&&(K=K||[]).push("style",T);var ut=K;(_.updateQueue=ut)&&(_.flags|=4)}},iw=function(p,_,T,x){T!==x&&(_.flags|=4)};function A_(p,_){if(!ji)switch(p.tailMode){case"hidden":_=p.tail;for(var T=null;_!==null;)_.alternate!==null&&(T=_),_=_.sibling;T===null?p.tail=null:T.sibling=null;break;case"collapsed":T=p.tail;for(var x=null;T!==null;)T.alternate!==null&&(x=T),T=T.sibling;x===null?_||p.tail===null?p.tail=null:p.tail.sibling=null:x.sibling=null}}function Mo(p){var _=p.alternate!==null&&p.alternate.child===p.child,T=0,x=0;if(_)for(var j=p.child;j!==null;)T|=j.lanes|j.childLanes,x|=j.subtreeFlags&14680064,x|=j.flags&14680064,j.return=p,j=j.sibling;else for(j=p.child;j!==null;)T|=j.lanes|j.childLanes,x|=j.subtreeFlags,x|=j.flags,j.return=p,j=j.sibling;return p.subtreeFlags|=x,p.childLanes=T,_}function ov(p,_,T){var x=_.pendingProps;switch(UE(_),_.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Mo(_),null;case 1:return Xa(_.type)&&NE(),Mo(_),null;case 3:return x=_.stateNode,Zp(),Ti(Ia),Ti(ia),Ub(),x.pendingContext&&(x.context=x.pendingContext,x.pendingContext=null),(p===null||p.child===null)&&(wm(_)?_.flags|=4:p===null||p.memoizedState.isDehydrated&&(_.flags&256)===0||(_.flags|=1024,Gl!==null&&(_w(Gl),Gl=null))),sv(p,_),Mo(_),null;case 5:Lb(_);var j=Uh(y_.current);if(T=_.type,p!==null&&_.stateNode!=null)I_(p,_,T,x,j),p.ref!==_.ref&&(_.flags|=512,_.flags|=2097152);else{if(!x){if(_.stateNode===null)throw Error(i(166));return Mo(_),null}if(p=Uh(Pu.current),wm(_)){x=_.stateNode,T=_.type;var K=_.memoizedProps;switch(x[Au]=_,x[d_]=K,p=(_.mode&1)!==0,T){case"dialog":Oi("cancel",x),Oi("close",x);break;case"iframe":case"object":case"embed":Oi("load",x);break;case"video":case"audio":for(j=0;j<o_.length;j++)Oi(o_[j],x);break;case"source":Oi("error",x);break;case"img":case"image":case"link":Oi("error",x),Oi("load",x);break;case"details":Oi("toggle",x);break;case"input":hn(x,K),Oi("invalid",x);break;case"select":x._wrapperState={wasMultiple:!!K.multiple},Oi("invalid",x);break;case"textarea":Ot(x,K),Oi("invalid",x)}us(T,K),j=null;for(var fe in K)if(K.hasOwnProperty(fe)){var Oe=K[fe];fe==="children"?typeof Oe=="string"?x.textContent!==Oe&&(K.suppressHydrationWarning!==!0&&l_(x.textContent,Oe,p),j=["children",Oe]):typeof Oe=="number"&&x.textContent!==""+Oe&&(K.suppressHydrationWarning!==!0&&l_(x.textContent,Oe,p),j=["children",""+Oe]):l.hasOwnProperty(fe)&&Oe!=null&&fe==="onScroll"&&Oi("scroll",x)}switch(T){case"input":En(x),on(x,K,!0);break;case"textarea":En(x),Pt(x);break;case"select":case"option":break;default:typeof K.onClick=="function"&&(x.onclick=u_)}x=j,_.updateQueue=x,x!==null&&(_.flags|=4)}else{fe=j.nodeType===9?j:j.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=Ut(T)),p==="http://www.w3.org/1999/xhtml"?T==="script"?(p=fe.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof x.is=="string"?p=fe.createElement(T,{is:x.is}):(p=fe.createElement(T),T==="select"&&(fe=p,x.multiple?fe.multiple=!0:x.size&&(fe.size=x.size))):p=fe.createElementNS(p,T),p[Au]=_,p[d_]=x,iv(p,_,!1,!1),_.stateNode=p;e:{switch(fe=_o(T,x),T){case"dialog":Oi("cancel",p),Oi("close",p),j=x;break;case"iframe":case"object":case"embed":Oi("load",p),j=x;break;case"video":case"audio":for(j=0;j<o_.length;j++)Oi(o_[j],p);j=x;break;case"source":Oi("error",p),j=x;break;case"img":case"image":case"link":Oi("error",p),Oi("load",p),j=x;break;case"details":Oi("toggle",p),j=x;break;case"input":hn(p,x),j=st(p,x),Oi("invalid",p);break;case"option":j=x;break;case"select":p._wrapperState={wasMultiple:!!x.multiple},j=Ne({},x,{value:void 0}),Oi("invalid",p);break;case"textarea":Ot(p,x),j=Ke(p,x),Oi("invalid",p);break;default:j=x}us(T,j),Oe=j;for(K in Oe)if(Oe.hasOwnProperty(K)){var Ve=Oe[K];K==="style"?ti(p,Ve):K==="dangerouslySetInnerHTML"?(Ve=Ve?Ve.__html:void 0,Ve!=null&&wn(p,Ve)):K==="children"?typeof Ve=="string"?(T!=="textarea"||Ve!=="")&&Nt(p,Ve):typeof Ve=="number"&&Nt(p,""+Ve):K!=="suppressContentEditableWarning"&&K!=="suppressHydrationWarning"&&K!=="autoFocus"&&(l.hasOwnProperty(K)?Ve!=null&&K==="onScroll"&&Oi("scroll",p):Ve!=null&&ne(p,K,Ve,fe))}switch(T){case"input":En(p),on(p,x,!1);break;case"textarea":En(p),Pt(p);break;case"option":x.value!=null&&p.setAttribute("value",""+gt(x.value));break;case"select":p.multiple=!!x.multiple,K=x.value,K!=null?De(p,!!x.multiple,K,!1):x.defaultValue!=null&&De(p,!!x.multiple,x.defaultValue,!0);break;default:typeof j.onClick=="function"&&(p.onclick=u_)}switch(T){case"button":case"input":case"select":case"textarea":x=!!x.autoFocus;break e;case"img":x=!0;break e;default:x=!1}}x&&(_.flags|=4)}_.ref!==null&&(_.flags|=512,_.flags|=2097152)}return Mo(_),null;case 6:if(p&&_.stateNode!=null)iw(p,_,p.memoizedProps,x);else{if(typeof x!="string"&&_.stateNode===null)throw Error(i(166));if(T=Uh(y_.current),Uh(Pu.current),wm(_)){if(x=_.stateNode,T=_.memoizedProps,x[Au]=_,(K=x.nodeValue!==T)&&(p=bc,p!==null))switch(p.tag){case 3:l_(x.nodeValue,T,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&l_(x.nodeValue,T,(p.mode&1)!==0)}K&&(_.flags|=4)}else x=(T.nodeType===9?T:T.ownerDocument).createTextNode(x),x[Au]=_,_.stateNode=x}return Mo(_),null;case 13:if(Ti(es),x=_.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(ji&&wc!==null&&(_.mode&1)!==0&&(_.flags&128)===0)Cb(),Xp(),_.flags|=98560,K=!1;else if(K=wm(_),x!==null&&x.dehydrated!==null){if(p===null){if(!K)throw Error(i(318));if(K=_.memoizedState,K=K!==null?K.dehydrated:null,!K)throw Error(i(317));K[Au]=_}else Xp(),(_.flags&128)===0&&(_.memoizedState=null),_.flags|=4;Mo(_),K=!1}else Gl!==null&&(_w(Gl),Gl=null),K=!0;if(!K)return _.flags&65536?_:null}return(_.flags&128)!==0?(_.lanes=T,_):(x=x!==null,x!==(p!==null&&p.memoizedState!==null)&&x&&(_.child.flags|=8192,(_.mode&1)!==0&&(p===null||(es.current&1)!==0?to===0&&(to=3):Dm())),_.updateQueue!==null&&(_.flags|=4),Mo(_),null);case 4:return Zp(),sv(p,_),p===null&&Cd(_.stateNode.containerInfo),Mo(_),null;case 10:return Ob(_.type._context),Mo(_),null;case 17:return Xa(_.type)&&NE(),Mo(_),null;case 19:if(Ti(es),K=_.memoizedState,K===null)return Mo(_),null;if(x=(_.flags&128)!==0,fe=K.rendering,fe===null)if(x)A_(K,!1);else{if(to!==0||p!==null&&(p.flags&128)!==0)for(p=_.child;p!==null;){if(fe=GE(p),fe!==null){for(_.flags|=128,A_(K,!1),x=fe.updateQueue,x!==null&&(_.updateQueue=x,_.flags|=4),_.subtreeFlags=0,x=T,T=_.child;T!==null;)K=T,p=x,K.flags&=14680066,fe=K.alternate,fe===null?(K.childLanes=0,K.lanes=p,K.child=null,K.subtreeFlags=0,K.memoizedProps=null,K.memoizedState=null,K.updateQueue=null,K.dependencies=null,K.stateNode=null):(K.childLanes=fe.childLanes,K.lanes=fe.lanes,K.child=fe.child,K.subtreeFlags=0,K.deletions=null,K.memoizedProps=fe.memoizedProps,K.memoizedState=fe.memoizedState,K.updateQueue=fe.updateQueue,K.type=fe.type,p=fe.dependencies,K.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),T=T.sibling;return ki(es,es.current&1|2),_.child}p=p.sibling}K.tail!==null&&Xr()>Zc&&(_.flags|=128,x=!0,A_(K,!1),_.lanes=4194304)}else{if(!x)if(p=GE(fe),p!==null){if(_.flags|=128,x=!0,T=p.updateQueue,T!==null&&(_.updateQueue=T,_.flags|=4),A_(K,!0),K.tail===null&&K.tailMode==="hidden"&&!fe.alternate&&!ji)return Mo(_),null}else 2*Xr()-K.renderingStartTime>Zc&&T!==1073741824&&(_.flags|=128,x=!0,A_(K,!1),_.lanes=4194304);K.isBackwards?(fe.sibling=_.child,_.child=fe):(T=K.last,T!==null?T.sibling=fe:_.child=fe,K.last=fe)}return K.tail!==null?(_=K.tail,K.rendering=_,K.tail=_.sibling,K.renderingStartTime=Xr(),_.sibling=null,T=es.current,ki(es,x?T&1|2:T&1),_):(Mo(_),null);case 22:case 23:return L_(),x=_.memoizedState!==null,p!==null&&p.memoizedState!==null!==x&&(_.flags|=8192),x&&(_.mode&1)!==0?(Cc&1073741824)!==0&&(Mo(_),_.subtreeFlags&6&&(_.flags|=8192)):Mo(_),null;case 24:return null;case 25:return null}throw Error(i(156,_.tag))}function Sx(p,_){switch(UE(_),_.tag){case 1:return Xa(_.type)&&NE(),p=_.flags,p&65536?(_.flags=p&-65537|128,_):null;case 3:return Zp(),Ti(Ia),Ti(ia),Ub(),p=_.flags,(p&65536)!==0&&(p&128)===0?(_.flags=p&-65537|128,_):null;case 5:return Lb(_),null;case 13:if(Ti(es),p=_.memoizedState,p!==null&&p.dehydrated!==null){if(_.alternate===null)throw Error(i(340));Xp()}return p=_.flags,p&65536?(_.flags=p&-65537|128,_):null;case 19:return Ti(es),null;case 4:return Zp(),null;case 10:return Ob(_.type._context),null;case 22:case 23:return L_(),null;case 24:return null;default:return null}}var P_=!1,Uo=!1,bx=typeof WeakSet=="function"?WeakSet:Set,dn=null;function sf(p,_){var T=p.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(x){ts(p,_,x)}else T.current=null}function sw(p,_,T){try{T()}catch(x){ts(p,_,x)}}var QI=!1;function wx(p,_){if(yb=Ce,p=ub(),db(p)){if("selectionStart"in p)var T={start:p.selectionStart,end:p.selectionEnd};else e:{T=(T=p.ownerDocument)&&T.defaultView||window;var x=T.getSelection&&T.getSelection();if(x&&x.rangeCount!==0){T=x.anchorNode;var j=x.anchorOffset,K=x.focusNode;x=x.focusOffset;try{T.nodeType,K.nodeType}catch{T=null;break e}var fe=0,Oe=-1,Ve=-1,ut=0,xt=0,Dt=p,kt=null;t:for(;;){for(var ln;Dt!==T||j!==0&&Dt.nodeType!==3||(Oe=fe+j),Dt!==K||x!==0&&Dt.nodeType!==3||(Ve=fe+x),Dt.nodeType===3&&(fe+=Dt.nodeValue.length),(ln=Dt.firstChild)!==null;)kt=Dt,Dt=ln;for(;;){if(Dt===p)break t;if(kt===T&&++ut===j&&(Oe=fe),kt===K&&++xt===x&&(Ve=fe),(ln=Dt.nextSibling)!==null)break;Dt=kt,kt=Dt.parentNode}Dt=ln}T=Oe===-1||Ve===-1?null:{start:Oe,end:Ve}}else T=null}T=T||{start:0,end:0}}else T=null;for(PE={focusedElem:p,selectionRange:T},Ce=!1,dn=_;dn!==null;)if(_=dn,p=_.child,(_.subtreeFlags&1028)!==0&&p!==null)p.return=_,dn=p;else for(;dn!==null;){_=dn;try{var gn=_.alternate;if((_.flags&1024)!==0)switch(_.tag){case 0:case 11:case 15:break;case 1:if(gn!==null){var yn=gn.memoizedProps,ns=gn.memoizedState,Qe=_.stateNode,Be=Qe.getSnapshotBeforeUpdate(_.elementType===_.type?yn:Qc(_.type,yn),ns);Qe.__reactInternalSnapshotBeforeUpdate=Be}break;case 3:var it=_.stateNode.containerInfo;it.nodeType===1?it.textContent="":it.nodeType===9&&it.documentElement&&it.removeChild(it.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(Vt){ts(_,_.return,Vt)}if(p=_.sibling,p!==null){p.return=_.return,dn=p;break}dn=_.return}return gn=QI,QI=!1,gn}function jh(p,_,T){var x=_.updateQueue;if(x=x!==null?x.lastEffect:null,x!==null){var j=x=x.next;do{if((j.tag&p)===p){var K=j.destroy;j.destroy=void 0,K!==void 0&&sw(_,T,K)}j=j.next}while(j!==x)}}function av(p,_){if(_=_.updateQueue,_=_!==null?_.lastEffect:null,_!==null){var T=_=_.next;do{if((T.tag&p)===p){var x=T.create;T.destroy=x()}T=T.next}while(T!==_)}}function ow(p){var _=p.ref;if(_!==null){var T=p.stateNode;switch(p.tag){case 5:p=T;break;default:p=T}typeof _=="function"?_(p):_.current=p}}function ZI(p){var _=p.alternate;_!==null&&(p.alternate=null,ZI(_)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(_=p.stateNode,_!==null&&(delete _[Au],delete _[d_],delete _[vb],delete _[hx],delete _[px])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function aw(p){return p.tag===5||p.tag===3||p.tag===4}function eA(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||aw(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function cw(p,_,T){var x=p.tag;if(x===5||x===6)p=p.stateNode,_?T.nodeType===8?T.parentNode.insertBefore(p,_):T.insertBefore(p,_):(T.nodeType===8?(_=T.parentNode,_.insertBefore(p,T)):(_=T,_.appendChild(p)),T=T._reactRootContainer,T!=null||_.onclick!==null||(_.onclick=u_));else if(x!==4&&(p=p.child,p!==null))for(cw(p,_,T),p=p.sibling;p!==null;)cw(p,_,T),p=p.sibling}function O_(p,_,T){var x=p.tag;if(x===5||x===6)p=p.stateNode,_?T.insertBefore(p,_):T.appendChild(p);else if(x!==4&&(p=p.child,p!==null))for(O_(p,_,T),p=p.sibling;p!==null;)O_(p,_,T),p=p.sibling}var Vo=null,Tc=!1;function Fh(p,_,T){for(T=T.child;T!==null;)lw(p,_,T),T=T.sibling}function lw(p,_,T){if(Kn&&typeof Kn.onCommitFiberUnmount=="function")try{Kn.onCommitFiberUnmount(qt,T)}catch{}switch(T.tag){case 5:Uo||sf(T,_);case 6:var x=Vo,j=Tc;Vo=null,Fh(p,_,T),Vo=x,Tc=j,Vo!==null&&(Tc?(p=Vo,T=T.stateNode,p.nodeType===8?p.parentNode.removeChild(T):p.removeChild(T)):Vo.removeChild(T.stateNode));break;case 18:Vo!==null&&(Tc?(p=Vo,T=T.stateNode,p.nodeType===8?OE(p.parentNode,T):p.nodeType===1&&OE(p,T),Ca(p)):OE(Vo,T.stateNode));break;case 4:x=Vo,j=Tc,Vo=T.stateNode.containerInfo,Tc=!0,Fh(p,_,T),Vo=x,Tc=j;break;case 0:case 11:case 14:case 15:if(!Uo&&(x=T.updateQueue,x!==null&&(x=x.lastEffect,x!==null))){j=x=x.next;do{var K=j,fe=K.destroy;K=K.tag,fe!==void 0&&((K&2)!==0||(K&4)!==0)&&sw(T,_,fe),j=j.next}while(j!==x)}Fh(p,_,T);break;case 1:if(!Uo&&(sf(T,_),x=T.stateNode,typeof x.componentWillUnmount=="function"))try{x.props=T.memoizedProps,x.state=T.memoizedState,x.componentWillUnmount()}catch(Oe){ts(T,_,Oe)}Fh(p,_,T);break;case 21:Fh(p,_,T);break;case 22:T.mode&1?(Uo=(x=Uo)||T.memoizedState!==null,Fh(p,_,T),Uo=x):Fh(p,_,T);break;default:Fh(p,_,T)}}function tA(p){var _=p.updateQueue;if(_!==null){p.updateQueue=null;var T=p.stateNode;T===null&&(T=p.stateNode=new bx),_.forEach(function(x){var j=Lm.bind(null,p,x);T.has(x)||(T.add(x),x.then(j,j))})}}function Yl(p,_){var T=_.deletions;if(T!==null)for(var x=0;x<T.length;x++){var j=T[x];try{var K=p,fe=_,Oe=fe;e:for(;Oe!==null;){switch(Oe.tag){case 5:Vo=Oe.stateNode,Tc=!1;break e;case 3:Vo=Oe.stateNode.containerInfo,Tc=!0;break e;case 4:Vo=Oe.stateNode.containerInfo,Tc=!0;break e}Oe=Oe.return}if(Vo===null)throw Error(i(160));lw(K,fe,j),Vo=null,Tc=!1;var Ve=j.alternate;Ve!==null&&(Ve.return=null),j.return=null}catch(ut){ts(j,_,ut)}}if(_.subtreeFlags&12854)for(_=_.child;_!==null;)uw(_,p),_=_.sibling}function uw(p,_){var T=p.alternate,x=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(Yl(_,p),ku(p),x&4){try{jh(3,p,p.return),av(3,p)}catch(yn){ts(p,p.return,yn)}try{jh(5,p,p.return)}catch(yn){ts(p,p.return,yn)}}break;case 1:Yl(_,p),ku(p),x&512&&T!==null&&sf(T,T.return);break;case 5:if(Yl(_,p),ku(p),x&512&&T!==null&&sf(T,T.return),p.flags&32){var j=p.stateNode;try{Nt(j,"")}catch(yn){ts(p,p.return,yn)}}if(x&4&&(j=p.stateNode,j!=null)){var K=p.memoizedProps,fe=T!==null?T.memoizedProps:K,Oe=p.type,Ve=p.updateQueue;if(p.updateQueue=null,Ve!==null)try{Oe==="input"&&K.type==="radio"&&K.name!=null&&an(j,K),_o(Oe,fe);var ut=_o(Oe,K);for(fe=0;fe<Ve.length;fe+=2){var xt=Ve[fe],Dt=Ve[fe+1];xt==="style"?ti(j,Dt):xt==="dangerouslySetInnerHTML"?wn(j,Dt):xt==="children"?Nt(j,Dt):ne(j,xt,Dt,ut)}switch(Oe){case"input":jt(j,K);break;case"textarea":Et(j,K);break;case"select":var kt=j._wrapperState.wasMultiple;j._wrapperState.wasMultiple=!!K.multiple;var ln=K.value;ln!=null?De(j,!!K.multiple,ln,!1):kt!==!!K.multiple&&(K.defaultValue!=null?De(j,!!K.multiple,K.defaultValue,!0):De(j,!!K.multiple,K.multiple?[]:"",!1))}j[d_]=K}catch(yn){ts(p,p.return,yn)}}break;case 6:if(Yl(_,p),ku(p),x&4){if(p.stateNode===null)throw Error(i(162));j=p.stateNode,K=p.memoizedProps;try{j.nodeValue=K}catch(yn){ts(p,p.return,yn)}}break;case 3:if(Yl(_,p),ku(p),x&4&&T!==null&&T.memoizedState.isDehydrated)try{Ca(_.containerInfo)}catch(yn){ts(p,p.return,yn)}break;case 4:Yl(_,p),ku(p);break;case 13:Yl(_,p),ku(p),j=p.child,j.flags&8192&&(K=j.memoizedState!==null,j.stateNode.isHidden=K,!K||j.alternate!==null&&j.alternate.memoizedState!==null||(fw=Xr())),x&4&&tA(p);break;case 22:if(xt=T!==null&&T.memoizedState!==null,p.mode&1?(Uo=(ut=Uo)||xt,Yl(_,p),Uo=ut):Yl(_,p),ku(p),x&8192){if(ut=p.memoizedState!==null,(p.stateNode.isHidden=ut)&&!xt&&(p.mode&1)!==0)for(dn=p,xt=p.child;xt!==null;){for(Dt=dn=xt;dn!==null;){switch(kt=dn,ln=kt.child,kt.tag){case 0:case 11:case 14:case 15:jh(4,kt,kt.return);break;case 1:sf(kt,kt.return);var gn=kt.stateNode;if(typeof gn.componentWillUnmount=="function"){x=kt,T=kt.return;try{_=x,gn.props=_.memoizedProps,gn.state=_.memoizedState,gn.componentWillUnmount()}catch(yn){ts(x,T,yn)}}break;case 5:sf(kt,kt.return);break;case 22:if(kt.memoizedState!==null){cv(Dt);continue}}ln!==null?(ln.return=kt,dn=ln):cv(Dt)}xt=xt.sibling}e:for(xt=null,Dt=p;;){if(Dt.tag===5){if(xt===null){xt=Dt;try{j=Dt.stateNode,ut?(K=j.style,typeof K.setProperty=="function"?K.setProperty("display","none","important"):K.display="none"):(Oe=Dt.stateNode,Ve=Dt.memoizedProps.style,fe=Ve!=null&&Ve.hasOwnProperty("display")?Ve.display:null,Oe.style.display=wi("display",fe))}catch(yn){ts(p,p.return,yn)}}}else if(Dt.tag===6){if(xt===null)try{Dt.stateNode.nodeValue=ut?"":Dt.memoizedProps}catch(yn){ts(p,p.return,yn)}}else if((Dt.tag!==22&&Dt.tag!==23||Dt.memoizedState===null||Dt===p)&&Dt.child!==null){Dt.child.return=Dt,Dt=Dt.child;continue}if(Dt===p)break e;for(;Dt.sibling===null;){if(Dt.return===null||Dt.return===p)break e;xt===Dt&&(xt=null),Dt=Dt.return}xt===Dt&&(xt=null),Dt.sibling.return=Dt.return,Dt=Dt.sibling}}break;case 19:Yl(_,p),ku(p),x&4&&tA(p);break;case 21:break;default:Yl(_,p),ku(p)}}function ku(p){var _=p.flags;if(_&2){try{e:{for(var T=p.return;T!==null;){if(aw(T)){var x=T;break e}T=T.return}throw Error(i(160))}switch(x.tag){case 5:var j=x.stateNode;x.flags&32&&(Nt(j,""),x.flags&=-33);var K=eA(p);O_(p,K,j);break;case 3:case 4:var fe=x.stateNode.containerInfo,Oe=eA(p);cw(p,Oe,fe);break;default:throw Error(i(161))}}catch(Ve){ts(p,p.return,Ve)}p.flags&=-3}_&4096&&(p.flags&=-4097)}function Tx(p,_,T){dn=p,dw(p)}function dw(p,_,T){for(var x=(p.mode&1)!==0;dn!==null;){var j=dn,K=j.child;if(j.tag===22&&x){var fe=j.memoizedState!==null||P_;if(!fe){var Oe=j.alternate,Ve=Oe!==null&&Oe.memoizedState!==null||Uo;Oe=P_;var ut=Uo;if(P_=fe,(Uo=Ve)&&!ut)for(dn=j;dn!==null;)fe=dn,Ve=fe.child,fe.tag===22&&fe.memoizedState!==null?nA(j):Ve!==null?(Ve.return=fe,dn=Ve):nA(j);for(;K!==null;)dn=K,dw(K),K=K.sibling;dn=j,P_=Oe,Uo=ut}hw(p)}else(j.subtreeFlags&8772)!==0&&K!==null?(K.return=j,dn=K):hw(p)}}function hw(p){for(;dn!==null;){var _=dn;if((_.flags&8772)!==0){var T=_.alternate;try{if((_.flags&8772)!==0)switch(_.tag){case 0:case 11:case 15:Uo||av(5,_);break;case 1:var x=_.stateNode;if(_.flags&4&&!Uo)if(T===null)x.componentDidMount();else{var j=_.elementType===_.type?T.memoizedProps:Qc(_.type,T.memoizedProps);x.componentDidUpdate(j,T.memoizedState,x.__reactInternalSnapshotBeforeUpdate)}var K=_.updateQueue;K!==null&&AI(_,K,x);break;case 3:var fe=_.updateQueue;if(fe!==null){if(T=null,_.child!==null)switch(_.child.tag){case 5:T=_.child.stateNode;break;case 1:T=_.child.stateNode}AI(_,fe,T)}break;case 5:var Oe=_.stateNode;if(T===null&&_.flags&4){T=Oe;var Ve=_.memoizedProps;switch(_.type){case"button":case"input":case"select":case"textarea":Ve.autoFocus&&T.focus();break;case"img":Ve.src&&(T.src=Ve.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(_.memoizedState===null){var ut=_.alternate;if(ut!==null){var xt=ut.memoizedState;if(xt!==null){var Dt=xt.dehydrated;Dt!==null&&Ca(Dt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}Uo||_.flags&512&&ow(_)}catch(kt){ts(_,_.return,kt)}}if(_===p){dn=null;break}if(T=_.sibling,T!==null){T.return=_.return,dn=T;break}dn=_.return}}function cv(p){for(;dn!==null;){var _=dn;if(_===p){dn=null;break}var T=_.sibling;if(T!==null){T.return=_.return,dn=T;break}dn=_.return}}function nA(p){for(;dn!==null;){var _=dn;try{switch(_.tag){case 0:case 11:case 15:var T=_.return;try{av(4,_)}catch(Ve){ts(_,T,Ve)}break;case 1:var x=_.stateNode;if(typeof x.componentDidMount=="function"){var j=_.return;try{x.componentDidMount()}catch(Ve){ts(_,j,Ve)}}var K=_.return;try{ow(_)}catch(Ve){ts(_,K,Ve)}break;case 5:var fe=_.return;try{ow(_)}catch(Ve){ts(_,fe,Ve)}}}catch(Ve){ts(_,_.return,Ve)}if(_===p){dn=null;break}var Oe=_.sibling;if(Oe!==null){Oe.return=_.return,dn=Oe;break}dn=_.return}}var Cx=Math.ceil,Bh=le.ReactCurrentDispatcher,lv=le.ReactCurrentOwner,oa=le.ReactCurrentBatchConfig,Rr=0,eo=null,ds=null,Us=0,Cc=0,km=Wl(0),to=0,Nm=null,of=0,uv=0,pw=0,af=null,Es=null,fw=0,Zc=1/0,Nu=null,aa=!1,mw=null,zh=null,k_=!1,Wh=null,N_=0,xm=0,gw=null,x_=-1,dv=0;function Oa(){return(Rr&6)!==0?Xr():x_!==-1?x_:x_=Xr()}function Gh(p){return(p.mode&1)===0?1:(Rr&2)!==0&&Us!==0?Us&-Us:m_.transition!==null?(dv===0&&(dv=Gr()),dv):(p=yr,p!==0||(p=window.event,p=p===void 0?16:si(p.type)),p)}function Rc(p,_,T,x){if(50<xm)throw xm=0,gw=null,Error(i(185));Eu(p,T,x),((Rr&2)===0||p!==eo)&&(p===eo&&((Rr&2)===0&&(uv|=T),to===4&&Hh(p,Us)),ca(p,x),T===1&&Rr===0&&(_.mode&1)===0&&(Zc=Xr()+500,DE&&Lh()))}function ca(p,_){var T=p.callbackNode;Ki(p,_);var x=Ll(p,p===eo?Us:0);if(x===0)T!==null&&xl(T),p.callbackNode=null,p.callbackPriority=0;else if(_=x&-x,p.callbackPriority!==_){if(T!=null&&xl(T),_===1)p.tag===0?fx(hv.bind(null,p)):wb(hv.bind(null,p)),ux(function(){(Rr&6)===0&&Lh()}),T=null;else{switch(Ul(x)){case 1:T=Mr;break;case 4:T=mc;break;case 16:T=ra;break;case 536870912:T=Je;break;default:T=ra}T=ww(T,rA.bind(null,p))}p.callbackPriority=_,p.callbackNode=T}}function rA(p,_){if(x_=-1,dv=0,(Rr&6)!==0)throw Error(i(327));var T=p.callbackNode;if(Kh()&&p.callbackNode!==T)return null;var x=Ll(p,p===eo?Us:0);if(x===0)return null;if((x&30)!==0||(x&p.expiredLanes)!==0||_)_=M_(p,x);else{_=x;var j=Rr;Rr|=2;var K=Ew();(eo!==p||Us!==_)&&(Nu=null,Zc=Xr()+500,Vd(p,_));do try{Ix();break}catch(Oe){yw(p,Oe)}while(!0);Pb(),Bh.current=K,Rr=j,ds!==null?_=0:(eo=null,Us=0,_=to)}if(_!==0){if(_===2&&(j=li(p),j!==0&&(x=j,_=D_(p,j))),_===1)throw T=Nm,Vd(p,0),Hh(p,x),ca(p,Xr()),T;if(_===6)Hh(p,x);else{if(j=p.current.alternate,(x&30)===0&&!iA(j)&&(_=M_(p,x),_===2&&(K=li(p),K!==0&&(x=K,_=D_(p,K))),_===1))throw T=Nm,Vd(p,0),Hh(p,x),ca(p,Xr()),T;switch(p.finishedWork=j,p.finishedLanes=x,_){case 0:case 1:throw Error(i(345));case 2:el(p,Es,Nu);break;case 3:if(Hh(p,x),(x&130023424)===x&&(_=fw+500-Xr(),10<_)){if(Ll(p,0)!==0)break;if(j=p.suspendedLanes,(j&x)!==x){Oa(),p.pingedLanes|=p.suspendedLanes&j;break}p.timeoutHandle=Eb(el.bind(null,p,Es,Nu),_);break}el(p,Es,Nu);break;case 4:if(Hh(p,x),(x&4194240)===x)break;for(_=p.eventTimes,j=-1;0<x;){var fe=31-gs(x);K=1<<fe,fe=_[fe],fe>j&&(j=fe),x&=~K}if(x=j,x=Xr()-x,x=(120>x?120:480>x?480:1080>x?1080:1920>x?1920:3e3>x?3e3:4320>x?4320:1960*Cx(x/1960))-x,10<x){p.timeoutHandle=Eb(el.bind(null,p,Es,Nu),x);break}el(p,Es,Nu);break;case 5:el(p,Es,Nu);break;default:throw Error(i(329))}}}return ca(p,Xr()),p.callbackNode===T?rA.bind(null,p):null}function D_(p,_){var T=af;return p.current.memoizedState.isDehydrated&&(Vd(p,_).flags|=256),p=M_(p,_),p!==2&&(_=Es,Es=T,_!==null&&_w(_)),p}function _w(p){Es===null?Es=p:Es.push.apply(Es,p)}function iA(p){for(var _=p;;){if(_.flags&16384){var T=_.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var x=0;x<T.length;x++){var j=T[x],K=j.getSnapshot;j=j.value;try{if(!Bl(K(),j))return!1}catch{return!1}}}if(T=_.child,_.subtreeFlags&16384&&T!==null)T.return=_,_=T;else{if(_===p)break;for(;_.sibling===null;){if(_.return===null||_.return===p)return!0;_=_.return}_.sibling.return=_.return,_=_.sibling}}return!0}function Hh(p,_){for(_&=~pw,_&=~uv,p.suspendedLanes|=_,p.pingedLanes&=~_,p=p.expirationTimes;0<_;){var T=31-gs(_),x=1<<T;p[T]=-1,_&=~x}}function hv(p){if((Rr&6)!==0)throw Error(i(327));Kh();var _=Ll(p,0);if((_&1)===0)return ca(p,Xr()),null;var T=M_(p,_);if(p.tag!==0&&T===2){var x=li(p);x!==0&&(_=x,T=D_(p,x))}if(T===1)throw T=Nm,Vd(p,0),Hh(p,_),ca(p,Xr()),T;if(T===6)throw Error(i(345));return p.finishedWork=p.current.alternate,p.finishedLanes=_,el(p,Es,Nu),ca(p,Xr()),null}function cf(p,_){var T=Rr;Rr|=1;try{return p(_)}finally{Rr=T,Rr===0&&(Zc=Xr()+500,DE&&Lh())}}function $h(p){Wh!==null&&Wh.tag===0&&(Rr&6)===0&&Kh();var _=Rr;Rr|=1;var T=oa.transition,x=yr;try{if(oa.transition=null,yr=1,p)return p()}finally{yr=x,oa.transition=T,Rr=_,(Rr&6)===0&&Lh()}}function L_(){Cc=km.current,Ti(km)}function Vd(p,_){p.finishedWork=null,p.finishedLanes=0;var T=p.timeoutHandle;if(T!==-1&&(p.timeoutHandle=-1,lx(T)),ds!==null)for(T=ds.return;T!==null;){var x=T;switch(UE(x),x.tag){case 1:x=x.type.childContextTypes,x!=null&&NE();break;case 3:Zp(),Ti(Ia),Ti(ia),Ub();break;case 5:Lb(x);break;case 4:Zp();break;case 13:Ti(es);break;case 19:Ti(es);break;case 10:Ob(x.type._context);break;case 22:case 23:L_()}T=T.return}if(eo=p,ds=p=qh(p.current,null),Us=Cc=_,to=0,Nm=null,pw=uv=of=0,Es=af=null,Jp!==null){for(_=0;_<Jp.length;_++)if(T=Jp[_],x=T.interleaved,x!==null){T.interleaved=null;var j=x.next,K=T.pending;if(K!==null){var fe=K.next;K.next=j,x.next=fe}T.pending=x}Jp=null}return p}function yw(p,_){do{var T=ds;try{if(Pb(),E_.current=Pm,v_){for(var x=qi.memoizedState;x!==null;){var j=x.queue;j!==null&&(j.pending=null),x=x.next}v_=!1}if(ef=0,ys=Zs=qi=null,Dd=!1,S_=0,lv.current=null,T===null||T.return===null){to=1,Nm=_,ds=null;break}e:{var K=p,fe=T.return,Oe=T,Ve=_;if(_=Us,Oe.flags|=32768,Ve!==null&&typeof Ve=="object"&&typeof Ve.then=="function"){var ut=Ve,xt=Oe,Dt=xt.tag;if((xt.mode&1)===0&&(Dt===0||Dt===11||Dt===15)){var kt=xt.alternate;kt?(xt.updateQueue=kt.updateQueue,xt.memoizedState=kt.memoizedState,xt.lanes=kt.lanes):(xt.updateQueue=null,xt.memoizedState=null)}var ln=zI(fe);if(ln!==null){ln.flags&=-257,WI(ln,fe,Oe,K,_),ln.mode&1&&Jb(K,ut,_),_=ln,Ve=ut;var gn=_.updateQueue;if(gn===null){var yn=new Set;yn.add(Ve),_.updateQueue=yn}else gn.add(Ve);break e}else{if((_&1)===0){Jb(K,ut,_),Dm();break e}Ve=Error(i(426))}}else if(ji&&Oe.mode&1){var ns=zI(fe);if(ns!==null){(ns.flags&65536)===0&&(ns.flags|=256),WI(ns,fe,Oe,K,_),Tm(Om(Ve,Oe));break e}}K=Ve=Om(Ve,Oe),to!==4&&(to=2),af===null?af=[K]:af.push(K),K=fe;do{switch(K.tag){case 3:K.flags|=65536,_&=-_,K.lanes|=_;var Qe=Xb(K,Ve,_);II(K,Qe);break e;case 1:Oe=Ve;var Be=K.type,it=K.stateNode;if((K.flags&128)===0&&(typeof Be.getDerivedStateFromError=="function"||it!==null&&typeof it.componentDidCatch=="function"&&(zh===null||!zh.has(it)))){K.flags|=65536,_&=-_,K.lanes|=_;var Vt=BI(K,Oe,_);II(K,Vt);break e}}K=K.return}while(K!==null)}Sw(T)}catch(vn){_=vn,ds===T&&T!==null&&(ds=T=T.return);continue}break}while(!0)}function Ew(){var p=Bh.current;return Bh.current=Pm,p===null?Pm:p}function Dm(){(to===0||to===3||to===2)&&(to=4),eo===null||(of&268435455)===0&&(uv&268435455)===0||Hh(eo,Us)}function M_(p,_){var T=Rr;Rr|=2;var x=Ew();(eo!==p||Us!==_)&&(Nu=null,Vd(p,_));do try{Rx();break}catch(j){yw(p,j)}while(!0);if(Pb(),Rr=T,Bh.current=x,ds!==null)throw Error(i(261));return eo=null,Us=0,to}function Rx(){for(;ds!==null;)vw(ds)}function Ix(){for(;ds!==null&&!wh();)vw(ds)}function vw(p){var _=aA(p.alternate,p,Cc);p.memoizedProps=p.pendingProps,_===null?Sw(p):ds=_,lv.current=null}function Sw(p){var _=p;do{var T=_.alternate;if(p=_.return,(_.flags&32768)===0){if(T=ov(T,_,Cc),T!==null){ds=T;return}}else{if(T=Sx(T,_),T!==null){T.flags&=32767,ds=T;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{to=6,ds=null;return}}if(_=_.sibling,_!==null){ds=_;return}ds=_=p}while(_!==null);to===0&&(to=5)}function el(p,_,T){var x=yr,j=oa.transition;try{oa.transition=null,yr=1,bw(p,_,T,x)}finally{oa.transition=j,yr=x}return null}function bw(p,_,T,x){do Kh();while(Wh!==null);if((Rr&6)!==0)throw Error(i(327));T=p.finishedWork;var j=p.finishedLanes;if(T===null)return null;if(p.finishedWork=null,p.finishedLanes=0,T===p.current)throw Error(i(177));p.callbackNode=null,p.callbackPriority=0;var K=T.lanes|T.childLanes;if(ui(p,K),p===eo&&(ds=eo=null,Us=0),(T.subtreeFlags&2064)===0&&(T.flags&2064)===0||k_||(k_=!0,ww(ra,function(){return Kh(),null})),K=(T.flags&15990)!==0,(T.subtreeFlags&15990)!==0||K){K=oa.transition,oa.transition=null;var fe=yr;yr=1;var Oe=Rr;Rr|=4,lv.current=null,wx(p,T),uw(T,p),ix(PE),Ce=!!yb,PE=yb=null,p.current=T,Tx(T),Xs(),Rr=Oe,yr=fe,oa.transition=K}else p.current=T;if(k_&&(k_=!1,Wh=p,N_=j),K=p.pendingLanes,K===0&&(zh=null),$i(T.stateNode),ca(p,Xr()),_!==null)for(x=p.onRecoverableError,T=0;T<_.length;T++)j=_[T],x(j.value,{componentStack:j.stack,digest:j.digest});if(aa)throw aa=!1,p=mw,mw=null,p;return(N_&1)!==0&&p.tag!==0&&Kh(),K=p.pendingLanes,(K&1)!==0?p===gw?xm++:(xm=0,gw=p):xm=0,Lh(),null}function Kh(){if(Wh!==null){var p=Ul(N_),_=oa.transition,T=yr;try{if(oa.transition=null,yr=16>p?16:p,Wh===null)var x=!1;else{if(p=Wh,Wh=null,N_=0,(Rr&6)!==0)throw Error(i(331));var j=Rr;for(Rr|=4,dn=p.current;dn!==null;){var K=dn,fe=K.child;if((dn.flags&16)!==0){var Oe=K.deletions;if(Oe!==null){for(var Ve=0;Ve<Oe.length;Ve++){var ut=Oe[Ve];for(dn=ut;dn!==null;){var xt=dn;switch(xt.tag){case 0:case 11:case 15:jh(8,xt,K)}var Dt=xt.child;if(Dt!==null)Dt.return=xt,dn=Dt;else for(;dn!==null;){xt=dn;var kt=xt.sibling,ln=xt.return;if(ZI(xt),xt===ut){dn=null;break}if(kt!==null){kt.return=ln,dn=kt;break}dn=ln}}}var gn=K.alternate;if(gn!==null){var yn=gn.child;if(yn!==null){gn.child=null;do{var ns=yn.sibling;yn.sibling=null,yn=ns}while(yn!==null)}}dn=K}}if((K.subtreeFlags&2064)!==0&&fe!==null)fe.return=K,dn=fe;else e:for(;dn!==null;){if(K=dn,(K.flags&2048)!==0)switch(K.tag){case 0:case 11:case 15:jh(9,K,K.return)}var Qe=K.sibling;if(Qe!==null){Qe.return=K.return,dn=Qe;break e}dn=K.return}}var Be=p.current;for(dn=Be;dn!==null;){fe=dn;var it=fe.child;if((fe.subtreeFlags&2064)!==0&&it!==null)it.return=fe,dn=it;else e:for(fe=Be;dn!==null;){if(Oe=dn,(Oe.flags&2048)!==0)try{switch(Oe.tag){case 0:case 11:case 15:av(9,Oe)}}catch(vn){ts(Oe,Oe.return,vn)}if(Oe===fe){dn=null;break e}var Vt=Oe.sibling;if(Vt!==null){Vt.return=Oe.return,dn=Vt;break e}dn=Oe.return}}if(Rr=j,Lh(),Kn&&typeof Kn.onPostCommitFiberRoot=="function")try{Kn.onPostCommitFiberRoot(qt,p)}catch{}x=!0}return x}finally{yr=T,oa.transition=_}}return!1}function pv(p,_,T){_=Om(T,_),_=Xb(p,_,1),p=$l(p,_,1),_=Oa(),p!==null&&(Eu(p,1,_),ca(p,_))}function ts(p,_,T){if(p.tag===3)pv(p,p,T);else for(;_!==null;){if(_.tag===3){pv(_,p,T);break}else if(_.tag===1){var x=_.stateNode;if(typeof _.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(zh===null||!zh.has(x))){p=Om(T,p),p=BI(_,p,1),_=$l(_,p,1),p=Oa(),_!==null&&(Eu(_,1,p),ca(_,p));break}}_=_.return}}function sA(p,_,T){var x=p.pingCache;x!==null&&x.delete(_),_=Oa(),p.pingedLanes|=p.suspendedLanes&T,eo===p&&(Us&T)===T&&(to===4||to===3&&(Us&130023424)===Us&&500>Xr()-fw?Vd(p,0):pw|=T),ca(p,_)}function oA(p,_){_===0&&((p.mode&1)===0?_=1:(_=Dl,Dl<<=1,(Dl&130023424)===0&&(Dl=4194304)));var T=Oa();p=kd(p,_),p!==null&&(Eu(p,_,T),ca(p,T))}function Ax(p){var _=p.memoizedState,T=0;_!==null&&(T=_.retryLane),oA(p,T)}function Lm(p,_){var T=0;switch(p.tag){case 13:var x=p.stateNode,j=p.memoizedState;j!==null&&(T=j.retryLane);break;case 19:x=p.stateNode;break;default:throw Error(i(314))}x!==null&&x.delete(_),oA(p,T)}var aA;aA=function(p,_,T){if(p!==null)if(p.memoizedProps!==_.pendingProps||Ia.current)Qa=!0;else{if((p.lanes&T)===0&&(_.flags&128)===0)return Qa=!1,rv(p,_,T);Qa=(p.flags&131072)!==0}else Qa=!1,ji&&(_.flags&1048576)!==0&&bI(_,ME,_.index);switch(_.lanes=0,_.tag){case 2:var x=_.type;nv(p,_),p=_.pendingProps;var j=Dh(_,ia.current);Hl(_,T),j=Im(null,_,x,p,j,T);var K=Fb();return _.flags|=1,typeof j=="object"&&j!==null&&typeof j.render=="function"&&j.$$typeof===void 0?(_.tag=1,_.memoizedState=null,_.updateQueue=null,Xa(x)?(K=!0,xE(_)):K=!1,_.memoizedState=j.state!==null&&j.state!==void 0?j.state:null,xb(_),j.updater=QE,_.stateNode=j,j._reactInternals=_,Kb(_,x,p,T),_=ew(null,_,x,!0,K,T)):(_.tag=0,ji&&K&&bm(_),Pa(null,_,j,T),_=_.child),_;case 16:x=_.elementType;e:{switch(nv(p,_),p=_.pendingProps,j=x._init,x=j(x._payload),_.type=x,j=_.tag=Px(x),p=Qc(x,p),j){case 0:_=Zb(null,_,x,p,T);break e;case 1:_=KI(null,_,x,p,T);break e;case 11:_=GI(null,_,x,p,T);break e;case 14:_=HI(null,_,x,Qc(x.type,p),T);break e}throw Error(i(306,x,""))}return _;case 0:return x=_.type,j=_.pendingProps,j=_.elementType===x?j:Qc(x,j),Zb(p,_,x,j,T);case 1:return x=_.type,j=_.pendingProps,j=_.elementType===x?j:Qc(x,j),KI(p,_,x,j,T);case 3:e:{if(qI(_),p===null)throw Error(i(387));x=_.pendingProps,K=_.memoizedState,j=K.element,RI(p,_),WE(_,x,null,T);var fe=_.memoizedState;if(x=fe.element,K.isDehydrated)if(K={element:x,isDehydrated:!1,cache:fe.cache,pendingSuspenseBoundaries:fe.pendingSuspenseBoundaries,transitions:fe.transitions},_.updateQueue.baseState=K,_.memoizedState=K,_.flags&256){j=Om(Error(i(423)),_),_=YI(p,_,x,T,j);break e}else if(x!==j){j=Om(Error(i(424)),_),_=YI(p,_,x,T,j);break e}else for(wc=Iu(_.stateNode.containerInfo.firstChild),bc=_,ji=!0,Gl=null,T=Ib(_,null,x,T),_.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if(Xp(),x===j){_=Ud(p,_,T);break e}Pa(p,_,x,T)}_=_.child}return _;case 5:return PI(_),p===null&&f_(_),x=_.type,j=_.pendingProps,K=p!==null?p.memoizedProps:null,fe=j.children,ym(x,j)?fe=null:K!==null&&ym(x,K)&&(_.flags|=32),$I(p,_),Pa(p,_,fe,T),_.child;case 6:return p===null&&f_(_),null;case 13:return XI(p,_,T);case 4:return Db(_,_.stateNode.containerInfo),x=_.pendingProps,p===null?_.child=Cm(_,null,x,T):Pa(p,_,x,T),_.child;case 11:return x=_.type,j=_.pendingProps,j=_.elementType===x?j:Qc(x,j),GI(p,_,x,j,T);case 7:return Pa(p,_,_.pendingProps,T),_.child;case 8:return Pa(p,_,_.pendingProps.children,T),_.child;case 12:return Pa(p,_,_.pendingProps.children,T),_.child;case 10:e:{if(x=_.type._context,j=_.pendingProps,K=_.memoizedProps,fe=j.value,ki(jE,x._currentValue),x._currentValue=fe,K!==null)if(Bl(K.value,fe)){if(K.children===j.children&&!Ia.current){_=Ud(p,_,T);break e}}else for(K=_.child,K!==null&&(K.return=_);K!==null;){var Oe=K.dependencies;if(Oe!==null){fe=K.child;for(var Ve=Oe.firstContext;Ve!==null;){if(Ve.context===x){if(K.tag===1){Ve=xd(-1,T&-T),Ve.tag=2;var ut=K.updateQueue;if(ut!==null){ut=ut.shared;var xt=ut.pending;xt===null?Ve.next=Ve:(Ve.next=xt.next,xt.next=Ve),ut.pending=Ve}}K.lanes|=T,Ve=K.alternate,Ve!==null&&(Ve.lanes|=T),BE(K.return,T,_),Oe.lanes|=T;break}Ve=Ve.next}}else if(K.tag===10)fe=K.type===_.type?null:K.child;else if(K.tag===18){if(fe=K.return,fe===null)throw Error(i(341));fe.lanes|=T,Oe=fe.alternate,Oe!==null&&(Oe.lanes|=T),BE(fe,T,_),fe=K.sibling}else fe=K.child;if(fe!==null)fe.return=K;else for(fe=K;fe!==null;){if(fe===_){fe=null;break}if(K=fe.sibling,K!==null){K.return=fe.return,fe=K;break}fe=fe.return}K=fe}Pa(p,_,j.children,T),_=_.child}return _;case 9:return j=_.type,x=_.pendingProps.children,Hl(_,T),j=Jc(j),x=x(j),_.flags|=1,Pa(p,_,x,T),_.child;case 14:return x=_.type,j=Qc(x,_.pendingProps),j=Qc(x.type,j),HI(p,_,x,j,T);case 15:return Qb(p,_,_.type,_.pendingProps,T);case 17:return x=_.type,j=_.pendingProps,j=_.elementType===x?j:Qc(x,j),nv(p,_),_.tag=1,Xa(x)?(p=!0,xE(_)):p=!1,Hl(_,T),jI(_,x,j),Kb(_,x,j,T),ew(null,_,x,!0,p,T);case 19:return rw(p,_,T);case 22:return Ou(p,_,T)}throw Error(i(156,_.tag))};function ww(p,_){return va(p,_)}function Tw(p,_,T,x){this.tag=p,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=_,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function tl(p,_,T,x){return new Tw(p,_,T,x)}function Cw(p){return p=p.prototype,!(!p||!p.isReactComponent)}function Px(p){if(typeof p=="function")return Cw(p)?1:0;if(p!=null){if(p=p.$$typeof,p===de)return 11;if(p===Ie)return 14}return 2}function qh(p,_){var T=p.alternate;return T===null?(T=tl(p.tag,_,p.key,p.mode),T.elementType=p.elementType,T.type=p.type,T.stateNode=p.stateNode,T.alternate=p,p.alternate=T):(T.pendingProps=_,T.type=p.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=p.flags&14680064,T.childLanes=p.childLanes,T.lanes=p.lanes,T.child=p.child,T.memoizedProps=p.memoizedProps,T.memoizedState=p.memoizedState,T.updateQueue=p.updateQueue,_=p.dependencies,T.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext},T.sibling=p.sibling,T.index=p.index,T.ref=p.ref,T}function Mm(p,_,T,x,j,K){var fe=2;if(x=p,typeof p=="function")Cw(p)&&(fe=1);else if(typeof p=="string")fe=5;else e:switch(p){case q:return Yh(T.children,j,K,_);case J:fe=8,j|=8;break;case Q:return p=tl(12,T,_,j|2),p.elementType=Q,p.lanes=K,p;case he:return p=tl(13,T,_,j),p.elementType=he,p.lanes=K,p;case Se:return p=tl(19,T,_,j),p.elementType=Se,p.lanes=K,p;case we:return U_(T,j,K,_);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case ie:fe=10;break e;case pe:fe=9;break e;case de:fe=11;break e;case Ie:fe=14;break e;case Fe:fe=16,x=null;break e}throw Error(i(130,p==null?p:typeof p,""))}return _=tl(fe,T,_,j),_.elementType=p,_.type=x,_.lanes=K,_}function Yh(p,_,T,x){return p=tl(7,p,x,_),p.lanes=T,p}function U_(p,_,T,x){return p=tl(22,p,x,_),p.elementType=we,p.lanes=T,p.stateNode={isHidden:!1},p}function fv(p,_,T){return p=tl(6,p,null,_),p.lanes=T,p}function Um(p,_,T){return _=tl(4,p.children!==null?p.children:[],p.key,_),_.lanes=T,_.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},_}function Rw(p,_,T,x,j){this.tag=_,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ml(0),this.expirationTimes=Ml(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ml(0),this.identifierPrefix=x,this.onRecoverableError=j,this.mutableSourceEagerHydrationData=null}function Vm(p,_,T,x,j,K,fe,Oe,Ve){return p=new Rw(p,_,T,Oe,Ve),_===1?(_=1,K===!0&&(_|=8)):_=0,K=tl(3,null,null,_),p.current=K,K.stateNode=p,K.memoizedState={element:x,isDehydrated:T,cache:null,transitions:null,pendingSuspenseBoundaries:null},xb(K),p}function mv(p,_,T){var x=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:me,key:x==null?null:""+x,children:p,containerInfo:_,implementation:T}}function Iw(p){if(!p)return Nh;p=p._reactInternals;e:{if(xs(p)!==p||p.tag!==1)throw Error(i(170));var _=p;do{switch(_.tag){case 3:_=_.stateNode.context;break e;case 1:if(Xa(_.type)){_=_.stateNode.__reactInternalMemoizedMergedChildContext;break e}}_=_.return}while(_!==null);throw Error(i(171))}if(p.tag===1){var T=p.type;if(Xa(T))return vI(p,T,_)}return _}function lf(p,_,T,x,j,K,fe,Oe,Ve){return p=Vm(T,x,!0,p,j,K,fe,Oe,Ve),p.context=Iw(null),T=p.current,x=Oa(),j=Gh(T),K=xd(x,j),K.callback=_??null,$l(T,K,j),p.current.lanes=j,Eu(p,j,x),ca(p,x),p}function xu(p,_,T,x){var j=_.current,K=Oa(),fe=Gh(j);return T=Iw(T),_.context===null?_.context=T:_.pendingContext=T,_=xd(K,fe),_.payload={element:p},x=x===void 0?null:x,x!==null&&(_.callback=x),p=$l(j,_,fe),p!==null&&(Rc(p,j,fe,K),zE(p,j,fe)),fe}function gv(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function jm(p,_){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var T=p.retryLane;p.retryLane=T!==0&&T<_?T:_}}function Aw(p,_){jm(p,_),(p=p.alternate)&&jm(p,_)}function Ox(){return null}var cA=typeof reportError=="function"?reportError:function(p){console.error(p)};function Pw(p){this._internalRoot=p}V_.prototype.render=Pw.prototype.render=function(p){var _=this._internalRoot;if(_===null)throw Error(i(409));xu(p,_,null,null)},V_.prototype.unmount=Pw.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var _=p.containerInfo;$h(function(){xu(null,p,null,null)}),_[Rd]=null}};function V_(p){this._internalRoot=p}V_.prototype.unstable_scheduleHydration=function(p){if(p){var _=sm();p={blockedOn:null,target:p,priority:_};for(var T=0;T<Ha.length&&_!==0&&_<Ha[T].priority;T++);Ha.splice(T,0,p),T===0&&Vl(p)}};function j_(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function F_(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function lA(){}function uA(p,_,T,x,j){if(j){if(typeof x=="function"){var K=x;x=function(){var ut=gv(fe);K.call(ut)}}var fe=lf(_,x,p,0,null,!1,!1,"",lA);return p._reactRootContainer=fe,p[Rd]=fe.current,Cd(p.nodeType===8?p.parentNode:p),$h(),fe}for(;j=p.lastChild;)p.removeChild(j);if(typeof x=="function"){var Oe=x;x=function(){var ut=gv(Ve);Oe.call(ut)}}var Ve=Vm(p,0,!1,null,null,!1,!1,"",lA);return p._reactRootContainer=Ve,p[Rd]=Ve.current,Cd(p.nodeType===8?p.parentNode:p),$h(function(){xu(_,Ve,T,x)}),Ve}function _v(p,_,T,x,j){var K=T._reactRootContainer;if(K){var fe=K;if(typeof j=="function"){var Oe=j;j=function(){var Ve=gv(fe);Oe.call(Ve)}}xu(_,fe,p,j)}else fe=uA(T,_,p,j,x);return gv(fe)}Rh=function(p){switch(p.tag){case 3:var _=p.stateNode;if(_.current.memoizedState.isDehydrated){var T=Cr(_.pendingLanes);T!==0&&(vu(_,T|1),ca(_,Xr()),(Rr&6)===0&&(Zc=Xr()+500,Lh()))}break;case 13:$h(function(){var x=kd(p,1);if(x!==null){var j=Oa();Rc(x,p,1,j)}}),Aw(p,1)}},Ih=function(p){if(p.tag===13){var _=kd(p,134217728);if(_!==null){var T=Oa();Rc(_,p,134217728,T)}Aw(p,134217728)}},Su=function(p){if(p.tag===13){var _=Gh(p),T=kd(p,_);if(T!==null){var x=Oa();Rc(T,p,_,x)}Aw(p,_)}},sm=function(){return yr},Gp=function(p,_){var T=yr;try{return yr=p,_()}finally{yr=T}},Fc=function(p,_,T){switch(_){case"input":if(jt(p,T),_=T.name,T.type==="radio"&&_!=null){for(T=p;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll("input[name="+JSON.stringify(""+_)+'][type="radio"]'),_=0;_<T.length;_++){var x=T[_];if(x!==p&&x.form===p.form){var j=kE(x);if(!j)throw Error(i(90));Gt(x),jt(x,j)}}}break;case"textarea":Et(p,T);break;case"select":_=T.value,_!=null&&De(p,!!T.multiple,_,!1)}},Eo=cf,yu=$h;var B_={usingClientEntryPoint:!1,Events:[h_,Em,kE,Zi,Bc,cf]},Za={findFiberByHostInstance:Kp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},dA={bundleType:Za.bundleType,version:Za.version,rendererPackageName:Za.rendererPackageName,rendererConfig:Za.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:le.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=kl(p),p===null?null:p.stateNode},findFiberByHostInstance:Za.findFiberByHostInstance||Ox,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var yv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yv.isDisabled&&yv.supportsFiber)try{qt=yv.inject(dA),Kn=yv}catch{}}return ml.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B_,ml.createPortal=function(p,_){var T=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!j_(_))throw Error(i(200));return mv(p,_,null,T)},ml.createRoot=function(p,_){if(!j_(p))throw Error(i(299));var T=!1,x="",j=cA;return _!=null&&(_.unstable_strictMode===!0&&(T=!0),_.identifierPrefix!==void 0&&(x=_.identifierPrefix),_.onRecoverableError!==void 0&&(j=_.onRecoverableError)),_=Vm(p,1,!1,null,null,T,!1,x,j),p[Rd]=_.current,Cd(p.nodeType===8?p.parentNode:p),new Pw(_)},ml.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var _=p._reactInternals;if(_===void 0)throw typeof p.render=="function"?Error(i(188)):(p=Object.keys(p).join(","),Error(i(268,p)));return p=kl(_),p=p===null?null:p.stateNode,p},ml.flushSync=function(p){return $h(p)},ml.hydrate=function(p,_,T){if(!F_(_))throw Error(i(200));return _v(null,p,_,!0,T)},ml.hydrateRoot=function(p,_,T){if(!j_(p))throw Error(i(405));var x=T!=null&&T.hydratedSources||null,j=!1,K="",fe=cA;if(T!=null&&(T.unstable_strictMode===!0&&(j=!0),T.identifierPrefix!==void 0&&(K=T.identifierPrefix),T.onRecoverableError!==void 0&&(fe=T.onRecoverableError)),_=lf(_,null,p,1,T??null,j,!1,K,fe),p[Rd]=_.current,Cd(p),x)for(p=0;p<x.length;p++)T=x[p],j=T._getVersion,j=j(T._source),_.mutableSourceEagerHydrationData==null?_.mutableSourceEagerHydrationData=[T,j]:_.mutableSourceEagerHydrationData.push(T,j);return new V_(_)},ml.render=function(p,_,T){if(!F_(_))throw Error(i(200));return _v(null,p,_,!1,T)},ml.unmountComponentAtNode=function(p){if(!F_(p))throw Error(i(40));return p._reactRootContainer?($h(function(){_v(null,null,p,!1,function(){p._reactRootContainer=null,p[Rd]=null})}),!0):!1},ml.unstable_batchedUpdates=cf,ml.unstable_renderSubtreeIntoContainer=function(p,_,T,x){if(!F_(T))throw Error(i(200));if(p==null||p._reactInternals===void 0)throw Error(i(38));return _v(p,_,T,!1,x)},ml.version="18.3.1-next-f1338f8080-20240426",ml}var KK;function DZ(){if(KK)return NM.exports;KK=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),NM.exports=wEe(),NM.exports}var qK;function TEe(){if(qK)return MP;qK=1;var n=DZ();return MP.createRoot=n.createRoot,MP.hydrateRoot=n.hydrateRoot,MP}var CEe=TEe();const REe=Hg(CEe);function IEe(n,e,i,o){return n.addEventListener(e,i,o),()=>{n.removeEventListener(e,i,o)}}function Fk(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function AEe(){return!!(globalThis!=null&&globalThis.document)}function LZ(n){return n.parentElement&&LZ(n.parentElement)?!0:n.hidden}function PEe(n){const e=n.getAttribute("contenteditable");return e!=="false"&&e!=null}function OEe(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function kEe(n){var e;return((e=MZ(n))==null?void 0:e.defaultView)??window}function MZ(n){return Fk(n)?n.ownerDocument:document}function NEe(n){return n.view??window}function xEe(n){return MZ(n).activeElement}function DEe(n){const e=NEe(n);return typeof e.PointerEvent<"u"&&n instanceof e.PointerEvent?n.pointerType==="mouse":n instanceof e.MouseEvent}function UZ(n){return!!n.touches}function LEe(n){return UZ(n)&&n.touches.length>1}function MEe(n,e="page"){const i=n.touches[0]||n.changedTouches[0];return{x:i[`${e}X`],y:i[`${e}Y`]}}function UEe(n,e="page"){return{x:n[`${e}X`],y:n[`${e}Y`]}}function VZ(n,e="page"){return UZ(n)?MEe(n,e):UEe(n,e)}function VEe(n){return e=>{const i=DEe(e);(!i||i&&e.button===0)&&n(e)}}function jEe(n,e=!1){function i(l){n(l,{point:VZ(l)})}return e?VEe(i):i}function hO(n,e,i,o){return IEe(n,e,jEe(i,e==="pointerdown"),o)}function FEe(n,...e){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const i={...n};for(const o of e)if(o!=null)for(const l in o)Object.prototype.hasOwnProperty.call(o,l)&&(l in i&&delete i[l],i[l]=o[l]);return i}const dr=n=>n?"":void 0,Lf=n=>n?!0:void 0;function BEe(n){return Array.isArray(n)}function ad(n){const e=typeof n;return n!=null&&(e==="object"||e==="function")&&!BEe(n)}function zEe(n){const e=n==null?0:n.length;return e?n[e-1]:void 0}function WEe(n){const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}}function rV(n){if(n==null)return n;const{unitless:e}=WEe(n);return e||typeof n=="number"?`${n}px`:n}const jZ=(n,e)=>parseInt(n[1],10)>parseInt(e[1],10)?1:-1,M5=n=>Object.fromEntries(Object.entries(n).sort(jZ));function YK(n){const e=M5(n);return Object.assign(Object.values(e),e)}function GEe(n){const e=Object.keys(M5(n));return new Set(e)}function XK(n){if(!n)return n;n=rV(n)??n;const e=-.02;return typeof n=="number"?`${n+e}`:n.replace(/(\d+\.?\d*)/u,i=>`${parseFloat(i)+e}`)}function iC(n,e){const i=["@media screen"];return n&&i.push("and",`(min-width: ${rV(n)})`),e&&i.push("and",`(max-width: ${rV(e)})`),i.join(" ")}function HEe(n){if(!n)return null;n.base=n.base??"0px";const e=YK(n),i=Object.entries(n).sort(jZ).map(([u,f],y,v)=>{let[,b]=v[y+1]??[];return b=parseFloat(b)>0?XK(b):void 0,{_minW:XK(f),breakpoint:u,minW:f,maxW:b,maxWQuery:iC(null,b),minWQuery:iC(f),minMaxQuery:iC(f,b)}}),o=GEe(n),l=Array.from(o.values());return{keys:o,normalized:e,isResponsive(u){const f=Object.keys(u);return f.length>0&&f.every(y=>o.has(y))},asObject:M5(n),asArray:YK(n),details:i,get(u){return i.find(f=>f.breakpoint===u)},media:[null,...e.map(u=>iC(u)).slice(1)],toArrayValue(u){if(!ad(u))throw new Error("toArrayValue: value must be an object");const f=l.map(y=>u[y]??null);for(;zEe(f)===null;)f.pop();return f},toObjectValue(u){if(!Array.isArray(u))throw new Error("toObjectValue: value must be an array");return u.reduce((f,y,v)=>{const b=l[v];return b!=null&&y!=null&&(f[b]=y),f},{})}}}function FZ(...n){return function(...i){n.forEach(o=>o==null?void 0:o(...i))}}function Vn(...n){return function(i){n.some(o=>(o==null||o(i),i==null?void 0:i.defaultPrevented))}}function Bk(n){return k.Children.toArray(n).filter(e=>k.isValidElement(e))}function U5(n){const e=Object.assign({},n);for(let i in e)e[i]===void 0&&delete e[i];return e}function $Ee(n,e){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${e}`}function Ai(n={}){const{name:e,strict:i=!0,hookName:o="useContext",providerName:l="Provider",errorMessage:u,defaultValue:f}=n,y=k.createContext(f);y.displayName=e;function v(){var C;const b=k.useContext(y);if(!b&&i){const R=new Error(u??$Ee(o,l));throw R.name="ContextError",(C=Error.captureStackTrace)==null||C.call(Error,R,v),R}return b}return[y.Provider,v,y]}const bn=(...n)=>n.filter(Boolean).join(" "),BZ=n=>n.hasAttribute("tabindex"),KEe=n=>BZ(n)&&n.tabIndex===-1;function KO(n){if(!Fk(n)||LZ(n)||OEe(n))return!1;const{localName:e}=n;if(["input","select","textarea","button"].indexOf(e)>=0)return!0;const o={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return e in o?o[e]():PEe(n)?!0:BZ(n)}function qEe(n){return n?Fk(n)&&KO(n)&&!KEe(n):!1}const YEe=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],XEe=YEe.join(),JEe=n=>n.offsetWidth>0&&n.offsetHeight>0;function zZ(n){const e=Array.from(n.querySelectorAll(XEe));return e.unshift(n),e.filter(i=>KO(i)&&JEe(i))}function QEe(n,e,i,o){const l=typeof e=="string"?e.split("."):[e];for(o=0;o<l.length&&n;o+=1)n=n[l[o]];return n===void 0?i:n}const ZEe=n=>{const e=new WeakMap;return(o,l,u,f)=>{if(typeof o>"u")return n(o,l,u);e.has(o)||e.set(o,new Map);const y=e.get(o);if(y.has(l))return y.get(l);const v=n(o,l,u,f);return y.set(l,v),v}},WZ=ZEe(QEe),eve=n=>n.default||n;function V5(n){const{wasSelected:e,enabled:i,isSelected:o,mode:l="unmount"}=n;return!!(!i||o||l==="keepMounted"&&e)}function tve(n){const e=parseFloat(n);return typeof e!="number"||Number.isNaN(e)?0:e}function j5(n,e){let i=tve(n);const o=10**(e??10);return i=Math.round(i*o)/o,e?i.toFixed(e):i.toString()}function iV(n){if(!Number.isFinite(n))return 0;let e=1,i=0;for(;Math.round(n*e)/e!==n;)e*=10,i+=1;return i}function JK(n,e,i){return(n-e)*100/(i-e)}function nve(n,e,i){return(i-e)*n+e}function QK(n,e,i){const o=Math.round((n-e)/i)*i+e,l=iV(i);return j5(o,l)}function pO(n,e,i){return n==null?n:(i<e&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,e),i))}function CR(n,e=[]){const i=Object.assign({},n);for(const o of e)o in i&&delete i[o];return i}function GZ(n,e){const i={};for(const o of e)o in n&&(i[o]=n[o]);return i}function F5(n,e){return Array.isArray(n)?n.map(i=>i===null?null:e(i)):ad(n)?Object.keys(n).reduce((i,o)=>(i[o]=e(n[o]),i),{}):n!=null?e(n):null}const rve=n=>typeof n=="function";function bl(n,...e){return rve(n)?n(...e):n}function ive(n){const e=n.ownerDocument.defaultView||window,{overflow:i,overflowX:o,overflowY:l}=e.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(i+l+o)}function sve(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function HZ(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:Fk(n)&&ive(n)?n:HZ(sve(n))}function ove(n,e){const i={},o={};for(const[l,u]of Object.entries(n))e.includes(l)?i[l]=u:o[l]=u;return[i,o]}function ave(n,...e){const i=Object.getOwnPropertyDescriptors(n),o=Object.keys(i),l=f=>{const y={};for(let v=0;v<f.length;v++){const b=f[v];i[b]&&(Object.defineProperty(y,b,i[b]),delete i[b])}return y},u=f=>l(Array.isArray(f)?f:o.filter(f));return e.map(u).concat(l(o))}function ZK(n,e,i={}){const{stop:o,getKey:l}=i;function u(f,y=[]){if(ad(f)||Array.isArray(f)){const v={};for(const[b,C]of Object.entries(f)){const R=(l==null?void 0:l(b))??b,O=[...y,R];if(o!=null&&o(f,O))return e(f,y);v[R]=u(C,O)}return v}return e(f,y)}return u(n)}var sC={exports:{}};sC.exports;var eq;function cve(){return eq||(eq=1,(function(n,e){var i=200,o="__lodash_hash_undefined__",l=800,u=16,f=9007199254740991,y="[object Arguments]",v="[object Array]",b="[object AsyncFunction]",C="[object Boolean]",R="[object Date]",O="[object Error]",L="[object Function]",D="[object GeneratorFunction]",U="[object Map]",B="[object Number]",Y="[object Null]",W="[object Object]",ne="[object Proxy]",le="[object RegExp]",re="[object Set]",me="[object String]",q="[object Undefined]",J="[object WeakMap]",Q="[object ArrayBuffer]",ie="[object DataView]",pe="[object Float32Array]",de="[object Float64Array]",he="[object Int8Array]",Se="[object Int16Array]",Ie="[object Int32Array]",Fe="[object Uint8Array]",we="[object Uint8ClampedArray]",Re="[object Uint16Array]",Te="[object Uint32Array]",Ne=/[\\^$.*+?()[\]{}|]/g,be=/^\[object .+?Constructor\]$/,xe=/^(?:0|[1-9]\d*)$/,je={};je[pe]=je[de]=je[he]=je[Se]=je[Ie]=je[Fe]=je[we]=je[Re]=je[Te]=!0,je[y]=je[v]=je[Q]=je[C]=je[ie]=je[R]=je[O]=je[L]=je[U]=je[B]=je[W]=je[le]=je[re]=je[me]=je[J]=!1;var nt=typeof Py=="object"&&Py&&Py.Object===Object&&Py,dt=typeof self=="object"&&self&&self.Object===Object&&self,ft=nt||dt||Function("return this")(),lt=e&&!e.nodeType&&e,gt=lt&&!0&&n&&!n.nodeType&&n,at=gt&&gt.exports===lt,Ct=at&&nt.process,En=(function(){try{var Ce=gt&&gt.require&&gt.require("util").types;return Ce||Ct&&Ct.binding&&Ct.binding("util")}catch{}})(),Gt=En&&En.isTypedArray;function Xt(Ce,Me,ct){switch(ct.length){case 0:return Ce.call(Me);case 1:return Ce.call(Me,ct[0]);case 2:return Ce.call(Me,ct[0],ct[1]);case 3:return Ce.call(Me,ct[0],ct[1],ct[2])}return Ce.apply(Me,ct)}function st(Ce,Me){for(var ct=-1,Yt=Array(Ce);++ct<Ce;)Yt[ct]=Me(ct);return Yt}function hn(Ce){return function(Me){return Ce(Me)}}function an(Ce,Me){return Ce==null?void 0:Ce[Me]}function jt(Ce,Me){return function(ct){return Ce(Me(ct))}}var on=Array.prototype,St=Function.prototype,ve=Object.prototype,De=ft["__core-js_shared__"],Ke=St.toString,Ot=ve.hasOwnProperty,Et=(function(){var Ce=/[^.]+$/.exec(De&&De.keys&&De.keys.IE_PROTO||"");return Ce?"Symbol(src)_1."+Ce:""})(),Pt=ve.toString,Ut=Ke.call(Object),cn=RegExp("^"+Ke.call(Ot).replace(Ne,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_t=at?ft.Buffer:void 0,wn=ft.Symbol,Nt=ft.Uint8Array;_t&&_t.allocUnsafe;var Ht=jt(Object.getPrototypeOf,Object),Lr=Object.create,wi=ve.propertyIsEnumerable,ti=on.splice,Vi=wn?wn.toStringTag:void 0,us=(function(){try{var Ce=Ki(Object,"defineProperty");return Ce({},"",{}),Ce}catch{}})(),_o=_t?_t.isBuffer:void 0,Wr=Math.max,Do=Date.now,Fc=Ki(ft,"Map"),Yr=Ki(Object,"create"),yo=(function(){function Ce(){}return function(Me){if(!$c(Me))return{};if(Lr)return Lr(Me);Ce.prototype=Me;var ct=new Ce;return Ce.prototype=void 0,ct}})();function Ys(Ce){var Me=-1,ct=Ce==null?0:Ce.length;for(this.clear();++Me<ct;){var Yt=Ce[Me];this.set(Yt[0],Yt[1])}}function Zi(){this.__data__=Yr?Yr(null):{},this.size=0}function Bc(Ce){var Me=this.has(Ce)&&delete this.__data__[Ce];return this.size-=Me?1:0,Me}function Eo(Ce){var Me=this.__data__;if(Yr){var ct=Me[Ce];return ct===o?void 0:ct}return Ot.call(Me,Ce)?Me[Ce]:void 0}function yu(Ce){var Me=this.__data__;return Yr?Me[Ce]!==void 0:Ot.call(Me,Ce)}function Wa(Ce,Me){var ct=this.__data__;return this.size+=this.has(Ce)?0:1,ct[Ce]=Yr&&Me===void 0?o:Me,this}Ys.prototype.clear=Zi,Ys.prototype.delete=Bc,Ys.prototype.get=Eo,Ys.prototype.has=yu,Ys.prototype.set=Wa;function Ns(Ce){var Me=-1,ct=Ce==null?0:Ce.length;for(this.clear();++Me<ct;){var Yt=Ce[Me];this.set(Yt[0],Yt[1])}}function Kt(){this.__data__=[],this.size=0}function zc(Ce){var Me=this.__data__,ct=Xs(Me,Ce);if(ct<0)return!1;var Yt=Me.length-1;return ct==Yt?Me.pop():ti.call(Me,ct,1),--this.size,!0}function Zo(Ce){var Me=this.__data__,ct=Xs(Me,Ce);return ct<0?void 0:Me[ct][1]}function Ga(Ce){return Xs(this.__data__,Ce)>-1}function Wc(Ce,Me){var ct=this.__data__,Yt=Xs(ct,Ce);return Yt<0?(++this.size,ct.push([Ce,Me])):ct[Yt][1]=Me,this}Ns.prototype.clear=Kt,Ns.prototype.delete=zc,Ns.prototype.get=Zo,Ns.prototype.has=Ga,Ns.prototype.set=Wc;function ea(Ce){var Me=-1,ct=Ce==null?0:Ce.length;for(this.clear();++Me<ct;){var Yt=Ce[Me];this.set(Yt[0],Yt[1])}}function ta(){this.size=0,this.__data__={hash:new Ys,map:new(Fc||Ns),string:new Ys}}function yd(Ce){var Me=_c(this,Ce).delete(Ce);return this.size-=Me?1:0,Me}function Sh(Ce){return _c(this,Ce).get(Ce)}function Pl(Ce){return _c(this,Ce).has(Ce)}function bh(Ce,Me){var ct=_c(this,Ce),Yt=ct.size;return ct.set(Ce,Me),this.size+=ct.size==Yt?0:1,this}ea.prototype.clear=ta,ea.prototype.delete=yd,ea.prototype.get=Sh,ea.prototype.has=Pl,ea.prototype.set=bh;function xs(Ce){var Me=this.__data__=new Ns(Ce);this.size=Me.size}function Ol(){this.__data__=new Ns,this.size=0}function na(Ce){var Me=this.__data__,ct=Me.delete(Ce);return this.size=Me.size,ct}function Ed(Ce){return this.__data__.get(Ce)}function kl(Ce){return this.__data__.has(Ce)}function Nl(Ce,Me){var ct=this.__data__;if(ct instanceof Ns){var Yt=ct.__data__;if(!Fc||Yt.length<i-1)return Yt.push([Ce,Me]),this.size=++ct.size,this;ct=this.__data__=new ea(Yt)}return ct.set(Ce,Me),this.size=ct.size,this}xs.prototype.clear=Ol,xs.prototype.delete=na,xs.prototype.get=Ed,xs.prototype.has=kl,xs.prototype.set=Nl;function va(Ce,Me){var ct=ba(Ce),Yt=!ct&&_s(Ce),ar=!ct&&!Yt&&Ta(Ce),Ur=!ct&&!Yt&&!ar&&Vl(Ce),si=ct||Yt||ar||Ur,tr=si?st(Ce.length,String):[],nr=tr.length;for(var Pi in Ce)si&&(Pi=="length"||ar&&(Pi=="offset"||Pi=="parent")||Ur&&(Pi=="buffer"||Pi=="byteLength"||Pi=="byteOffset")||Ml(Pi,nr))||tr.push(Pi);return tr}function xl(Ce,Me,ct){(ct!==void 0&&!Sa(Ce[Me],ct)||ct===void 0&&!(Me in Ce))&&Xr(Ce,Me,ct)}function wh(Ce,Me,ct){var Yt=Ce[Me];(!(Ot.call(Ce,Me)&&Sa(Yt,ct))||ct===void 0&&!(Me in Ce))&&Xr(Ce,Me,ct)}function Xs(Ce,Me){for(var ct=Ce.length;ct--;)if(Sa(Ce[ct][0],Me))return ct;return-1}function Xr(Ce,Me,ct){Me=="__proto__"&&us?us(Ce,Me,{configurable:!0,enumerable:!0,value:ct,writable:!0}):Ce[Me]=ct}var Th=Ll();function Mr(Ce){return Ce==null?Ce===void 0?q:Y:Vi&&Vi in Object(Ce)?li(Ce):Rh(Ce)}function mc(Ce){return Ds(Ce)&&Mr(Ce)==y}function ra(Ce){if(!$c(Ce)||vu(Ce))return!1;var Me=Ha(Ce)?cn:be;return Me.test(Hp(Ce))}function vd(Ce){return Ds(Ce)&&$p(Ce.length)&&!!je[Mr(Ce)]}function Je(Ce){if(!$c(Ce))return Ul(Ce);var Me=yr(Ce),ct=[];for(var Yt in Ce)Yt=="constructor"&&(Me||!Ot.call(Ce,Yt))||ct.push(Yt);return ct}function qt(Ce,Me,ct,Yt,ar){Ce!==Me&&Th(Me,function(Ur,si){if(ar||(ar=new xs),$c(Ur))Kn(Ce,Me,si,ct,qt,Yt,ar);else{var tr=Yt?Yt(Su(Ce,si),Ur,si+"",Ce,Me,ar):void 0;tr===void 0&&(tr=Ur),xl(Ce,si,tr)}},wu)}function Kn(Ce,Me,ct,Yt,ar,Ur,si){var tr=Su(Ce,ct),nr=Su(Me,ct),Pi=si.get(nr);if(Pi){xl(Ce,ct,Pi);return}var Js=Ur?Ur(tr,nr,ct+"",Ce,Me,si):void 0,Kc=Js===void 0;if(Kc){var Lo=ba(nr),Tu=!Lo&&Ta(nr),Ls=!Lo&&!Tu&&Vl(nr);Js=nr,Lo||Tu||Ls?ba(tr)?Js=tr:bu(tr)?Js=Hc(tr):Tu?(Kc=!1,Js=Gc(nr)):Ls?(Kc=!1,Js=gc(nr)):Js=[]:Jg(nr)||_s(nr)?(Js=tr,_s(tr)?Js=jl(tr):(!$c(tr)||Ha(tr))&&(Js=Gr(nr))):Kc=!1}Kc&&(si.set(nr,Js),ar(Js,nr,Yt,Ur,si),si.delete(nr)),xl(Ce,ct,Js)}function $i(Ce,Me){return sm(Ih(Ce,Me,Ca),Ce+"")}var gs=us?function(Ce,Me){return us(Ce,"toString",{configurable:!0,enumerable:!1,value:yc(Me),writable:!0})}:Ca;function Gc(Ce,Me){return Ce.slice()}function Ch(Ce){var Me=new Ce.constructor(Ce.byteLength);return new Nt(Me).set(new Nt(Ce)),Me}function gc(Ce,Me){var ct=Ch(Ce.buffer);return new Ce.constructor(ct,Ce.byteOffset,Ce.length)}function Hc(Ce,Me){var ct=-1,Yt=Ce.length;for(Me||(Me=Array(Yt));++ct<Yt;)Me[ct]=Ce[ct];return Me}function Dl(Ce,Me,ct,Yt){var ar=!ct;ct||(ct={});for(var Ur=-1,si=Me.length;++Ur<si;){var tr=Me[Ur],nr=void 0;nr===void 0&&(nr=Ce[tr]),ar?Xr(ct,tr,nr):wh(ct,tr,nr)}return ct}function Cr(Ce){return $i(function(Me,ct){var Yt=-1,ar=ct.length,Ur=ar>1?ct[ar-1]:void 0,si=ar>2?ct[2]:void 0;for(Ur=Ce.length>3&&typeof Ur=="function"?(ar--,Ur):void 0,si&&Eu(ct[0],ct[1],si)&&(Ur=ar<3?void 0:Ur,ar=1),Me=Object(Me);++Yt<ar;){var tr=ct[Yt];tr&&Ce(Me,tr,Yt,Ur)}return Me})}function Ll(Ce){return function(Me,ct,Yt){for(var ar=-1,Ur=Object(Me),si=Yt(Me),tr=si.length;tr--;){var nr=si[++ar];if(ct(Ur[nr],nr,Ur)===!1)break}return Me}}function _c(Ce,Me){var ct=Ce.__data__;return ui(Me)?ct[typeof Me=="string"?"string":"hash"]:ct.map}function Ki(Ce,Me){var ct=an(Ce,Me);return ra(ct)?ct:void 0}function li(Ce){var Me=Ot.call(Ce,Vi),ct=Ce[Vi];try{Ce[Vi]=void 0;var Yt=!0}catch{}var ar=Pt.call(Ce);return Yt&&(Me?Ce[Vi]=ct:delete Ce[Vi]),ar}function Gr(Ce){return typeof Ce.constructor=="function"&&!yr(Ce)?yo(Ht(Ce)):{}}function Ml(Ce,Me){var ct=typeof Ce;return Me=Me??f,!!Me&&(ct=="number"||ct!="symbol"&&xe.test(Ce))&&Ce>-1&&Ce%1==0&&Ce<Me}function Eu(Ce,Me,ct){if(!$c(ct))return!1;var Yt=typeof Me;return(Yt=="number"?wa(ct)&&Ml(Me,ct.length):Yt=="string"&&Me in ct)?Sa(ct[Me],Ce):!1}function ui(Ce){var Me=typeof Ce;return Me=="string"||Me=="number"||Me=="symbol"||Me=="boolean"?Ce!=="__proto__":Ce===null}function vu(Ce){return!!Et&&Et in Ce}function yr(Ce){var Me=Ce&&Ce.constructor,ct=typeof Me=="function"&&Me.prototype||ve;return Ce===ct}function Ul(Ce){var Me=[];if(Ce!=null)for(var ct in Object(Ce))Me.push(ct);return Me}function Rh(Ce){return Pt.call(Ce)}function Ih(Ce,Me,ct){return Me=Wr(Me===void 0?Ce.length-1:Me,0),function(){for(var Yt=arguments,ar=-1,Ur=Wr(Yt.length-Me,0),si=Array(Ur);++ar<Ur;)si[ar]=Yt[Me+ar];ar=-1;for(var tr=Array(Me+1);++ar<Me;)tr[ar]=Yt[ar];return tr[Me]=ct(si),Xt(Ce,this,tr)}}function Su(Ce,Me){if(!(Me==="constructor"&&typeof Ce[Me]=="function")&&Me!="__proto__")return Ce[Me]}var sm=Gp(gs);function Gp(Ce){var Me=0,ct=0;return function(){var Yt=Do(),ar=u-(Yt-ct);if(ct=Yt,ar>0){if(++Me>=l)return arguments[0]}else Me=0;return Ce.apply(void 0,arguments)}}function Hp(Ce){if(Ce!=null){try{return Ke.call(Ce)}catch{}try{return Ce+""}catch{}}return""}function Sa(Ce,Me){return Ce===Me||Ce!==Ce&&Me!==Me}var _s=mc((function(){return arguments})())?mc:function(Ce){return Ds(Ce)&&Ot.call(Ce,"callee")&&!wi.call(Ce,"callee")},ba=Array.isArray;function wa(Ce){return Ce!=null&&$p(Ce.length)&&!Ha(Ce)}function bu(Ce){return Ds(Ce)&&wa(Ce)}var Ta=_o||Fl;function Ha(Ce){if(!$c(Ce))return!1;var Me=Mr(Ce);return Me==L||Me==D||Me==b||Me==ne}function $p(Ce){return typeof Ce=="number"&&Ce>-1&&Ce%1==0&&Ce<=f}function $c(Ce){var Me=typeof Ce;return Ce!=null&&(Me=="object"||Me=="function")}function Ds(Ce){return Ce!=null&&typeof Ce=="object"}function Jg(Ce){if(!Ds(Ce)||Mr(Ce)!=W)return!1;var Me=Ht(Ce);if(Me===null)return!0;var ct=Ot.call(Me,"constructor")&&Me.constructor;return typeof ct=="function"&&ct instanceof ct&&Ke.call(ct)==Ut}var Vl=Gt?hn(Gt):vd;function jl(Ce){return Dl(Ce,wu(Ce))}function wu(Ce){return wa(Ce)?va(Ce):Je(Ce)}var om=Cr(function(Ce,Me,ct,Yt){qt(Ce,Me,ct,Yt)});function yc(Ce){return function(){return Ce}}function Ca(Ce){return Ce}function Fl(){return!1}n.exports=om})(sC,sC.exports)),sC.exports}var lve=cve();const Tp=Hg(lve);function fo(n,e=[]){const i=k.useRef(n);return k.useEffect(()=>{i.current=n}),k.useCallback((...o)=>{var l;return(l=i.current)==null?void 0:l.call(i,...o)},e)}function Uy(n,e,i,o){const l=fo(i);return k.useEffect(()=>{const u=typeof n=="function"?n():n??document;if(!(!i||!u))return u.addEventListener(e,l,o),()=>{u.removeEventListener(e,l,o)}},[e,n,o,l,i]),()=>{const u=typeof n=="function"?n():n??document;u==null||u.removeEventListener(e,l,o)}}function $Z(n){const{isOpen:e,ref:i}=n,[o,l]=k.useState(e),[u,f]=k.useState(!1);return k.useEffect(()=>{u||(l(e),f(!0))},[e,u,o]),Uy(()=>i.current,"animationend",()=>{l(e)}),{present:!(e?!1:!o),onComplete(){var C;const v=kEe(i.current),b=new v.CustomEvent("animationend",{bubbles:!0});(C=i.current)==null||C.dispatchEvent(b)}}}var LM,tq;function uve(){return tq||(tq=1,LM=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var e=document.activeElement,i=[],o=0;o<n.rangeCount;o++)i.push(n.getRangeAt(o));switch(e.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":e.blur();break;default:e=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||i.forEach(function(l){n.addRange(l)}),e&&e.focus()}}),LM}var MM,nq;function dve(){if(nq)return MM;nq=1;var n=uve(),e={"text/plain":"Text","text/html":"Url",default:"Text"},i="Copy to clipboard: #{key}, Enter";function o(u){var f=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return u.replace(/#{\s*key\s*}/g,f)}function l(u,f){var y,v,b,C,R,O,L=!1;f||(f={}),y=f.debug||!1;try{b=n(),C=document.createRange(),R=document.getSelection(),O=document.createElement("span"),O.textContent=u,O.ariaHidden="true",O.style.all="unset",O.style.position="fixed",O.style.top=0,O.style.clip="rect(0, 0, 0, 0)",O.style.whiteSpace="pre",O.style.webkitUserSelect="text",O.style.MozUserSelect="text",O.style.msUserSelect="text",O.style.userSelect="text",O.addEventListener("copy",function(U){if(U.stopPropagation(),f.format)if(U.preventDefault(),typeof U.clipboardData>"u"){y&&console.warn("unable to use e.clipboardData"),y&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var B=e[f.format]||e.default;window.clipboardData.setData(B,u)}else U.clipboardData.clearData(),U.clipboardData.setData(f.format,u);f.onCopy&&(U.preventDefault(),f.onCopy(U.clipboardData))}),document.body.appendChild(O),C.selectNodeContents(O),R.addRange(C);var D=document.execCommand("copy");if(!D)throw new Error("copy command was unsuccessful");L=!0}catch(U){y&&console.error("unable to copy using execCommand: ",U),y&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(f.format||"text",u),f.onCopy&&f.onCopy(window.clipboardData),L=!0}catch(B){y&&console.error("unable to copy using clipboardData: ",B),y&&console.error("falling back to prompt"),v=o("message"in f?f.message:i),window.prompt(v,u)}}finally{R&&(typeof R.removeRange=="function"?R.removeRange(C):R.removeAllRanges()),O&&document.body.removeChild(O),b()}return L}return MM=l,MM}var hve=dve();const rq=Hg(hve);function iq(n,e={}){const[i,o]=k.useState(!1),[l,u]=k.useState(n);k.useEffect(()=>u(n),[n]);const{timeout:f=1500,...y}=typeof e=="number"?{timeout:e}:e,v=k.useCallback(b=>{const C=typeof b=="string"?b:l;"clipboard"in navigator?navigator.clipboard.writeText(C).then(()=>o(!0)).catch(()=>o(rq(C,y))):o(rq(C,y))},[l,y]);return k.useEffect(()=>{let b=null;return i&&(b=window.setTimeout(()=>{o(!1)},f)),()=>{b&&window.clearTimeout(b)}},[f,i]),{value:l,setValue:u,onCopy:v,hasCopied:i}}function KZ(n){const{value:e,defaultValue:i,onChange:o,shouldUpdate:l=(O,L)=>O!==L}=n,u=fo(o),f=fo(l),[y,v]=k.useState(i),b=e!==void 0,C=b?e:y,R=fo(O=>{const D=typeof O=="function"?O(C):O;f(C,D)&&(b||v(D),u(D))},[b,u,C,f]);return[C,R]}function pve(n={}){const{onChange:e,precision:i,defaultValue:o,value:l,step:u=1,min:f=Number.MIN_SAFE_INTEGER,max:y=Number.MAX_SAFE_INTEGER,keepWithinRange:v=!0}=n,b=fo(e),[C,R]=k.useState(()=>o==null?"":UM(o,u,i)??""),O=typeof l<"u",L=O?l:C,D=qZ(gg(L),u),U=i??D,B=k.useCallback(ie=>{ie!==L&&(O||R(ie.toString()),b==null||b(ie.toString(),gg(ie)))},[b,O,L]),Y=k.useCallback(ie=>{let pe=ie;return v&&(pe=pO(pe,f,y)),j5(pe,U)},[U,v,y,f]),W=k.useCallback((ie=u)=>{let pe;L===""?pe=gg(ie):pe=gg(L)+ie,pe=Y(pe),B(pe)},[Y,u,B,L]),ne=k.useCallback((ie=u)=>{let pe;L===""?pe=gg(-ie):pe=gg(L)-ie,pe=Y(pe),B(pe)},[Y,u,B,L]),le=k.useCallback(()=>{let ie;o==null?ie="":ie=UM(o,u,i)??f,B(ie)},[o,i,u,B,f]),re=k.useCallback(ie=>{const pe=UM(ie,u,U)??f;B(pe)},[U,u,B,f]),me=gg(L);return{isOutOfRange:me>y||me<f,isAtMax:me===y,isAtMin:me===f,precision:U,value:L,valueAsNumber:me,update:B,reset:le,increment:W,decrement:ne,clamp:Y,cast:re,setValue:R}}function gg(n){return parseFloat(n.toString().replace(/[^\w.-]+/g,""))}function qZ(n,e){return Math.max(iV(e),iV(n))}function UM(n,e,i){const o=gg(n);if(Number.isNaN(o))return;const l=qZ(o,e);return j5(o,i??l)}function pd(n={}){const{onClose:e,onOpen:i,isOpen:o,id:l}=n,u=fo(i),f=fo(e),[y,v]=k.useState(n.defaultIsOpen||!1),b=o!==void 0?o:y,C=o!==void 0,R=k.useId(),O=l??`disclosure-${R}`,L=k.useCallback(()=>{C||v(!1),f==null||f()},[C,f]),D=k.useCallback(()=>{C||v(!0),u==null||u()},[C,u]),U=k.useCallback(()=>{b?L():D()},[b,D,L]);function B(W={}){return{...W,"aria-expanded":b,"aria-controls":O,onClick(ne){var le;(le=W.onClick)==null||le.call(W,ne),U()}}}function Y(W={}){return{...W,hidden:!b,id:O}}return{isOpen:b,onOpen:D,onClose:L,onToggle:U,isControlled:C,getButtonProps:B,getDisclosureProps:Y}}const Ip=globalThis!=null&&globalThis.document?k.useLayoutEffect:k.useEffect,Wf=(n,e)=>{const i=k.useRef(!1),o=k.useRef(!1);k.useEffect(()=>{if(i.current&&o.current)return n();o.current=!0},e),k.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[])};function fve(n){const e=n.current;if(!e)return!1;const i=xEe(e);return!i||e.contains(i)?!1:!!qEe(i)}function YZ(n,e){const{shouldFocus:i,visible:o,focusRef:l}=e,u=i&&!o;Wf(()=>{if(!u||fve(n))return;const f=(l==null?void 0:l.current)||n.current;let y;if(f)return y=requestAnimationFrame(()=>{f.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(y)}},[u,n,l])}const mve={preventScroll:!0,shouldFocus:!1};function gve(n,e=mve){const{focusRef:i,preventScroll:o,shouldFocus:l,visible:u}=e,f=_ve(n)?n.current:n,y=l&&u,v=k.useRef(y),b=k.useRef(u);Ip(()=>{!b.current&&u&&(v.current=y),b.current=u},[u,y]);const C=k.useCallback(()=>{if(!(!u||!f||!v.current)&&(v.current=!1,!f.contains(document.activeElement)))if(i!=null&&i.current)requestAnimationFrame(()=>{var R;(R=i.current)==null||R.focus({preventScroll:o})});else{const R=zZ(f);R.length>0&&requestAnimationFrame(()=>{R[0].focus({preventScroll:o})})}},[u,o,f,i]);Wf(()=>{C()},[C]),Uy(f,"transitionend",C)}function _ve(n){return"current"in n}function yve(n){return"current"in n}const XZ=()=>typeof window<"u";function Eve(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const vve=n=>XZ()&&n.test(navigator.vendor),Sve=n=>XZ()&&n.test(Eve()),bve=()=>Sve(/mac|iphone|ipad|ipod/i),wve=()=>bve()&&vve(/apple/i);function Tve(n){const{ref:e,elements:i,enabled:o}=n,l=()=>{var u;return((u=e.current)==null?void 0:u.ownerDocument)??document};Uy(l,"pointerdown",u=>{var b,C;if(!wve()||!o)return;const f=((C=(b=u.composedPath)==null?void 0:b.call(u))==null?void 0:C[0])??u.target,v=(i??[e]).some(R=>{const O=yve(R)?R.current:R;return(O==null?void 0:O.contains(f))||O===f});l().activeElement!==f&&v&&(u.preventDefault(),f.focus())})}function Cve(n,e){const i=k.useId();return k.useMemo(()=>n||[e,i].filter(Boolean).join("-"),[n,e,i])}function Rve(n,...e){const i=Cve(n);return k.useMemo(()=>e.map(o=>`${o}-${i}`),[i,e])}function Ive(n,e){const i=fo(n);k.useEffect(()=>{let o=null;const l=()=>i();return e!==null&&(o=window.setInterval(l,e)),()=>{o&&window.clearInterval(o)}},[e,i])}function JZ(n){const e=k.useRef(null);return e.current=n,e}function Ave(n,e){if(n!=null){if(typeof n=="function"){n(e);return}try{n.current=e}catch{throw new Error(`Cannot assign value '${e}' to ref '${n}'`)}}}function Gi(...n){return e=>{n.forEach(i=>{Ave(i,e)})}}function Pve(...n){return k.useMemo(()=>Gi(...n),n)}function QZ(n){const{ref:e,handler:i,enabled:o=!0}=n,l=fo(i),f=k.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;k.useEffect(()=>{if(!o)return;const y=R=>{VM(R,e)&&(f.isPointerDown=!0)},v=R=>{if(f.ignoreEmulatedMouseEvents){f.ignoreEmulatedMouseEvents=!1;return}f.isPointerDown&&i&&VM(R,e)&&(f.isPointerDown=!1,l(R))},b=R=>{f.ignoreEmulatedMouseEvents=!0,i&&f.isPointerDown&&VM(R,e)&&(f.isPointerDown=!1,l(R))},C=ZZ(e.current);return C.addEventListener("mousedown",y,!0),C.addEventListener("mouseup",v,!0),C.addEventListener("touchstart",y,!0),C.addEventListener("touchend",b,!0),()=>{C.removeEventListener("mousedown",y,!0),C.removeEventListener("mouseup",v,!0),C.removeEventListener("touchstart",y,!0),C.removeEventListener("touchend",b,!0)}},[i,e,l,f,o])}function VM(n,e){var o,l;const i=((o=n.composedPath)==null?void 0:o.call(n)[0])??n.target;return i&&!ZZ(i).contains(i)?!1:!((l=e.current)!=null&&l.contains(i))}function ZZ(n){return(n==null?void 0:n.ownerDocument)??document}function Ove(n,e){const i=fo(n);k.useEffect(()=>{if(e==null)return;let o=null;return o=window.setTimeout(()=>{i()},e),()=>{o&&window.clearTimeout(o)}},[e,i])}const eee=1/60*1e3,kve=typeof performance<"u"?()=>performance.now():()=>Date.now(),tee=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(kve()),eee);function Nve(n){let e=[],i=[],o=0,l=!1,u=!1;const f=new WeakSet,y={schedule:(v,b=!1,C=!1)=>{const R=C&&l,O=R?e:i;return b&&f.add(v),O.indexOf(v)===-1&&(O.push(v),R&&l&&(o=e.length)),v},cancel:v=>{const b=i.indexOf(v);b!==-1&&i.splice(b,1),f.delete(v)},process:v=>{if(l){u=!0;return}if(l=!0,[e,i]=[i,e],i.length=0,o=e.length,o)for(let b=0;b<o;b++){const C=e[b];C(v),f.has(C)&&(y.schedule(C),n())}l=!1,u&&(u=!1,y.process(v))}};return y}const xve=40;let sV=!0,KC=!1,oV=!1;const eS={delta:0,timestamp:0},RR=["read","update","preRender","render","postRender"],zk=RR.reduce((n,e)=>(n[e]=Nve(()=>KC=!0),n),{}),Dve=RR.reduce((n,e)=>{const i=zk[e];return n[e]=(o,l=!1,u=!1)=>(KC||Uve(),i.schedule(o,l,u)),n},{}),Lve=RR.reduce((n,e)=>(n[e]=zk[e].cancel,n),{});RR.reduce((n,e)=>(n[e]=()=>zk[e].process(eS),n),{});const Mve=n=>zk[n].process(eS),nee=n=>{KC=!1,eS.delta=sV?eee:Math.max(Math.min(n-eS.timestamp,xve),1),eS.timestamp=n,oV=!0,RR.forEach(Mve),oV=!1,KC&&(sV=!1,tee(nee))},Uve=()=>{KC=!0,sV=!0,oV||tee(nee)},sq=()=>eS;var Vve=Object.defineProperty,jve=(n,e,i)=>e in n?Vve(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,sh=(n,e,i)=>(jve(n,typeof e!="symbol"?e+"":e,i),i);class Fve{constructor(e,i,o){if(sh(this,"history",[]),sh(this,"startEvent",null),sh(this,"lastEvent",null),sh(this,"lastEventInfo",null),sh(this,"handlers",{}),sh(this,"removeListeners",()=>{}),sh(this,"threshold",3),sh(this,"win"),sh(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const y=jM(this.lastEventInfo,this.history),v=this.startEvent!==null,b=Gve(y.offset,{x:0,y:0})>=this.threshold;if(!v&&!b)return;const{timestamp:C}=sq();this.history.push({...y.point,timestamp:C});const{onStart:R,onMove:O}=this.handlers;v||(R==null||R(this.lastEvent,y),this.startEvent=this.lastEvent),O==null||O(this.lastEvent,y)}),sh(this,"onPointerMove",(y,v)=>{this.lastEvent=y,this.lastEventInfo=v,Dve.update(this.updatePoint,!0)}),sh(this,"onPointerUp",(y,v)=>{const b=jM(v,this.history),{onEnd:C,onSessionEnd:R}=this.handlers;R==null||R(y,b),this.end(),!(!C||!this.startEvent)&&(C==null||C(y,b))}),this.win=e.view??window,LEe(e))return;this.handlers=i,o&&(this.threshold=o),e.stopPropagation(),e.preventDefault();const l={point:VZ(e)},{timestamp:u}=sq();this.history=[{...l.point,timestamp:u}];const{onSessionStart:f}=i;f==null||f(e,jM(l,this.history)),this.removeListeners=Wve(hO(this.win,"pointermove",this.onPointerMove),hO(this.win,"pointerup",this.onPointerUp),hO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(e){this.handlers=e}end(){var e;(e=this.removeListeners)==null||e.call(this),Lve.update(this.updatePoint)}}function oq(n,e){return{x:n.x-e.x,y:n.y-e.y}}function jM(n,e){return{point:n.point,delta:oq(n.point,e[e.length-1]),offset:oq(n.point,e[0]),velocity:zve(e,.1)}}const Bve=n=>n*1e3;function zve(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,o=null;const l=n[n.length-1];for(;i>=0&&(o=n[i],!(l.timestamp-o.timestamp>Bve(e)));)i--;if(!o)return{x:0,y:0};const u=(l.timestamp-o.timestamp)/1e3;if(u===0)return{x:0,y:0};const f={x:(l.x-o.x)/u,y:(l.y-o.y)/u};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}function Wve(...n){return e=>n.reduce((i,o)=>o(i),e)}function FM(n,e){return Math.abs(n-e)}function aq(n){return"x"in n&&"y"in n}function Gve(n,e){if(typeof n=="number"&&typeof e=="number")return FM(n,e);if(aq(n)&&aq(e)){const i=FM(n.x,e.x),o=FM(n.y,e.y);return Math.sqrt(i**2+o**2)}return 0}function Hve(n,e){const{onPan:i,onPanStart:o,onPanEnd:l,onPanSessionStart:u,onPanSessionEnd:f,threshold:y}=e,v=!!(i||o||l||u||f),b=k.useRef(null),C=JZ({onSessionStart:u,onSessionEnd:f,onStart:o,onMove:i,onEnd(R,O){b.current=null,l==null||l(R,O)}});k.useEffect(()=>{var R;(R=b.current)==null||R.updateHandlers(C.current)}),k.useEffect(()=>{const R=n.current;if(!R||!v)return;function O(L){b.current=new Fve(L,C.current,y)}return hO(R,"pointerdown",O)},[n,v,C,y]),k.useEffect(()=>()=>{var R;(R=b.current)==null||R.end(),b.current=null},[])}const Wo={open:(n,e)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${e}`,closed:(n,e)=>`${n}[data-closed], ${n}[data-state=closed] ${e}`,hover:(n,e)=>`${n}:hover ${e}, ${n}[data-hover] ${e}`,focus:(n,e)=>`${n}:focus ${e}, ${n}[data-focus] ${e}`,focusVisible:(n,e)=>`${n}:focus-visible ${e}`,focusWithin:(n,e)=>`${n}:focus-within ${e}`,active:(n,e)=>`${n}:active ${e}, ${n}[data-active] ${e}`,disabled:(n,e)=>`${n}:disabled ${e}, ${n}[data-disabled] ${e}`,invalid:(n,e)=>`${n}:invalid ${e}, ${n}[data-invalid] ${e}`,checked:(n,e)=>`${n}:checked ${e}, ${n}[data-checked] ${e}`,placeholderShown:(n,e)=>`${n}:placeholder-shown ${e}`},fp=n=>ree(e=>n(e,"&"),"[role=group]","[data-group]",".group"),Rf=n=>ree(e=>n(e,"~ &"),"[data-peer]",".peer"),ree=(n,...e)=>e.map(n).join(", "),tS={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:fp(Wo.open),_groupClosed:fp(Wo.closed),_groupHover:fp(Wo.hover),_peerHover:Rf(Wo.hover),_groupFocus:fp(Wo.focus),_peerFocus:Rf(Wo.focus),_groupFocusVisible:fp(Wo.focusVisible),_peerFocusVisible:Rf(Wo.focusVisible),_groupActive:fp(Wo.active),_peerActive:Rf(Wo.active),_groupDisabled:fp(Wo.disabled),_peerDisabled:Rf(Wo.disabled),_groupInvalid:fp(Wo.invalid),_peerInvalid:Rf(Wo.invalid),_groupChecked:fp(Wo.checked),_peerChecked:Rf(Wo.checked),_groupFocusWithin:fp(Wo.focusWithin),_peerFocusWithin:Rf(Wo.focusWithin),_peerPlaceholderShown:Rf(Wo.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},iee=Object.keys(tS),$ve=n=>/!(important)?$/.test(n),cq=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,Kve=(n,e)=>i=>{const o=String(e),l=$ve(o),u=cq(o),f=n?`${n}.${u}`:u;let y=ad(i.__cssMap)&&f in i.__cssMap?i.__cssMap[f].varRef:e;return y=cq(y),l?`${y} !important`:y};function B5(n){const{scale:e,transform:i,compose:o}=n;return(u,f)=>{const y=Kve(e,u)(f);let v=(i==null?void 0:i(y,f))??y;return o&&(v=o(v,f)),v}}const UP=(...n)=>e=>n.reduce((i,o)=>o(i),e);function td(n,e){return i=>{const o={property:i,scale:n};return o.transform=B5({scale:n,transform:e}),o}}const qve=({rtl:n,ltr:e})=>i=>i.direction==="rtl"?n:e;function Yve(n){const{property:e,scale:i,transform:o}=n;return{scale:i,property:qve(e),transform:i?B5({scale:i,compose:o}):o}}const see=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function Xve(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...see].join(" ")}function Jve(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...see].join(" ")}const Qve={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},Zve={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function e0e(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const t0e={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},aV={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},n0e=new Set(Object.values(aV)),cV=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),r0e=n=>n.trim();function i0e(n,e){if(n==null||cV.has(n))return n;if(!(lV(n)||cV.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),u=l==null?void 0:l[1],f=l==null?void 0:l[2];if(!u||!f)return n;const y=u.includes("-gradient")?u:`${u}-gradient`,[v,...b]=f.split(",").map(r0e).filter(Boolean);if((b==null?void 0:b.length)===0)return n;const C=v in aV?aV[v]:v;b.unshift(C);const R=b.map(O=>{if(n0e.has(O))return O;const L=O.indexOf(" "),[D,U]=L!==-1?[O.substr(0,L),O.substr(L+1)]:[O],B=lV(U)?U:U&&U.split(" "),Y=`colors.${D}`,W=Y in e.__cssMap?e.__cssMap[Y].varRef:D;return B?[W,...Array.isArray(B)?B:[B]].join(" "):W});return`${y}(${R.join(", ")})`}const lV=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),s0e=(n,e)=>i0e(n,e??{});function o0e(n){return/^var\(--.+\)$/.test(n)}const a0e=n=>{const e=parseFloat(n.toString()),i=n.toString().replace(String(e),"");return{unitless:!i,value:e,unit:i}},mp=n=>e=>`${n}(${e})`,qr={filter(n){return n!=="auto"?n:Qve},backdropFilter(n){return n!=="auto"?n:Zve},ring(n){return e0e(qr.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?Xve():n==="auto-gpu"?Jve():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:e}=a0e(n);return e||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,e){const i={left:"right",right:"left"};return e.direction==="rtl"?i[n]:n},degree(n){if(o0e(n)||n==null)return n;const e=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||e?`${n}deg`:n},gradient:s0e,blur:mp("blur"),opacity:mp("opacity"),brightness:mp("brightness"),contrast:mp("contrast"),dropShadow:mp("drop-shadow"),grayscale:mp("grayscale"),hueRotate:n=>mp("hue-rotate")(qr.degree(n)),invert:mp("invert"),saturate:mp("saturate"),sepia:mp("sepia"),bgImage(n){return n==null||lV(n)||cV.has(n)?n:`url(${n})`},outline(n){const e=String(n)==="0"||String(n)==="none";return n!==null&&e?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:e,divide:i}=t0e[n]??{},o={flexDirection:n};return e&&(o[e]=1),i&&(o[i]=1),o}},Ge={borderWidths:td("borderWidths"),borderStyles:td("borderStyles"),colors:td("colors"),borders:td("borders"),gradients:td("gradients",qr.gradient),radii:td("radii",qr.px),space:td("space",UP(qr.vh,qr.px)),spaceT:td("space",UP(qr.vh,qr.px)),degreeT(n){return{property:n,transform:qr.degree}},prop(n,e,i){return{property:n,scale:e,...e&&{transform:B5({scale:e,transform:i})}}},propT(n,e){return{property:n,transform:e}},sizes:td("sizes",UP(qr.vh,qr.px)),sizesT:td("sizes",UP(qr.vh,qr.fraction)),shadows:td("shadows"),logical:Yve,blur:td("blur",qr.blur)},fO={background:Ge.colors("background"),backgroundColor:Ge.colors("backgroundColor"),backgroundImage:Ge.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:qr.bgClip},bgSize:Ge.prop("backgroundSize"),bgPosition:Ge.prop("backgroundPosition"),bg:Ge.colors("background"),bgColor:Ge.colors("backgroundColor"),bgPos:Ge.prop("backgroundPosition"),bgRepeat:Ge.prop("backgroundRepeat"),bgAttachment:Ge.prop("backgroundAttachment"),bgGradient:Ge.gradients("backgroundImage"),bgClip:{transform:qr.bgClip}};Object.assign(fO,{bgImage:fO.backgroundImage,bgImg:fO.backgroundImage});const pi={border:Ge.borders("border"),borderWidth:Ge.borderWidths("borderWidth"),borderStyle:Ge.borderStyles("borderStyle"),borderColor:Ge.colors("borderColor"),borderRadius:Ge.radii("borderRadius"),borderTop:Ge.borders("borderTop"),borderBlockStart:Ge.borders("borderBlockStart"),borderTopLeftRadius:Ge.radii("borderTopLeftRadius"),borderStartStartRadius:Ge.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Ge.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Ge.radii("borderTopRightRadius"),borderStartEndRadius:Ge.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Ge.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Ge.borders("borderRight"),borderInlineEnd:Ge.borders("borderInlineEnd"),borderBottom:Ge.borders("borderBottom"),borderBlockEnd:Ge.borders("borderBlockEnd"),borderBottomLeftRadius:Ge.radii("borderBottomLeftRadius"),borderBottomRightRadius:Ge.radii("borderBottomRightRadius"),borderLeft:Ge.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Ge.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Ge.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Ge.borders(["borderLeft","borderRight"]),borderInline:Ge.borders("borderInline"),borderY:Ge.borders(["borderTop","borderBottom"]),borderBlock:Ge.borders("borderBlock"),borderTopWidth:Ge.borderWidths("borderTopWidth"),borderBlockStartWidth:Ge.borderWidths("borderBlockStartWidth"),borderTopColor:Ge.colors("borderTopColor"),borderBlockStartColor:Ge.colors("borderBlockStartColor"),borderTopStyle:Ge.borderStyles("borderTopStyle"),borderBlockStartStyle:Ge.borderStyles("borderBlockStartStyle"),borderBottomWidth:Ge.borderWidths("borderBottomWidth"),borderBlockEndWidth:Ge.borderWidths("borderBlockEndWidth"),borderBottomColor:Ge.colors("borderBottomColor"),borderBlockEndColor:Ge.colors("borderBlockEndColor"),borderBottomStyle:Ge.borderStyles("borderBottomStyle"),borderBlockEndStyle:Ge.borderStyles("borderBlockEndStyle"),borderLeftWidth:Ge.borderWidths("borderLeftWidth"),borderInlineStartWidth:Ge.borderWidths("borderInlineStartWidth"),borderLeftColor:Ge.colors("borderLeftColor"),borderInlineStartColor:Ge.colors("borderInlineStartColor"),borderLeftStyle:Ge.borderStyles("borderLeftStyle"),borderInlineStartStyle:Ge.borderStyles("borderInlineStartStyle"),borderRightWidth:Ge.borderWidths("borderRightWidth"),borderInlineEndWidth:Ge.borderWidths("borderInlineEndWidth"),borderRightColor:Ge.colors("borderRightColor"),borderInlineEndColor:Ge.colors("borderInlineEndColor"),borderRightStyle:Ge.borderStyles("borderRightStyle"),borderInlineEndStyle:Ge.borderStyles("borderInlineEndStyle"),borderTopRadius:Ge.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Ge.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Ge.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Ge.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(pi,{rounded:pi.borderRadius,roundedTop:pi.borderTopRadius,roundedTopLeft:pi.borderTopLeftRadius,roundedTopRight:pi.borderTopRightRadius,roundedTopStart:pi.borderStartStartRadius,roundedTopEnd:pi.borderStartEndRadius,roundedBottom:pi.borderBottomRadius,roundedBottomLeft:pi.borderBottomLeftRadius,roundedBottomRight:pi.borderBottomRightRadius,roundedBottomStart:pi.borderEndStartRadius,roundedBottomEnd:pi.borderEndEndRadius,roundedLeft:pi.borderLeftRadius,roundedRight:pi.borderRightRadius,roundedStart:pi.borderInlineStartRadius,roundedEnd:pi.borderInlineEndRadius,borderStart:pi.borderInlineStart,borderEnd:pi.borderInlineEnd,borderTopStartRadius:pi.borderStartStartRadius,borderTopEndRadius:pi.borderStartEndRadius,borderBottomStartRadius:pi.borderEndStartRadius,borderBottomEndRadius:pi.borderEndEndRadius,borderStartRadius:pi.borderInlineStartRadius,borderEndRadius:pi.borderInlineEndRadius,borderStartWidth:pi.borderInlineStartWidth,borderEndWidth:pi.borderInlineEndWidth,borderStartColor:pi.borderInlineStartColor,borderEndColor:pi.borderInlineEndColor,borderStartStyle:pi.borderInlineStartStyle,borderEndStyle:pi.borderInlineEndStyle});const c0e={color:Ge.colors("color"),textColor:Ge.colors("color"),fill:Ge.colors("fill"),stroke:Ge.colors("stroke"),accentColor:Ge.colors("accentColor"),textFillColor:Ge.colors("textFillColor")},qO={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:qr.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Ge.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Ge.space("gap"),rowGap:Ge.space("rowGap"),columnGap:Ge.space("columnGap")};Object.assign(qO,{flexDir:qO.flexDirection});const rd={width:Ge.sizesT("width"),inlineSize:Ge.sizesT("inlineSize"),height:Ge.sizes("height"),blockSize:Ge.sizes("blockSize"),boxSize:Ge.sizes(["width","height"]),minWidth:Ge.sizes("minWidth"),minInlineSize:Ge.sizes("minInlineSize"),minHeight:Ge.sizes("minHeight"),minBlockSize:Ge.sizes("minBlockSize"),maxWidth:Ge.sizes("maxWidth"),maxInlineSize:Ge.sizes("maxInlineSize"),maxHeight:Ge.sizes("maxHeight"),maxBlockSize:Ge.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,e)=>{var l,u;return{[`@media screen and (min-width: ${((u=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:u.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,e)=>{var l,u;return{[`@media screen and (max-width: ${((u=(l=e.__breakpoints)==null?void 0:l.get(n))==null?void 0:u._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Ge.propT("float",qr.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(rd,{w:rd.width,h:rd.height,minW:rd.minWidth,maxW:rd.maxWidth,minH:rd.minHeight,maxH:rd.maxHeight,overscroll:rd.overscrollBehavior,overscrollX:rd.overscrollBehaviorX,overscrollY:rd.overscrollBehaviorY});const l0e={filter:{transform:qr.filter},blur:Ge.blur("--chakra-blur"),brightness:Ge.propT("--chakra-brightness",qr.brightness),contrast:Ge.propT("--chakra-contrast",qr.contrast),hueRotate:Ge.propT("--chakra-hue-rotate",qr.hueRotate),invert:Ge.propT("--chakra-invert",qr.invert),saturate:Ge.propT("--chakra-saturate",qr.saturate),dropShadow:Ge.propT("--chakra-drop-shadow",qr.dropShadow),backdropFilter:{transform:qr.backdropFilter},backdropBlur:Ge.blur("--chakra-backdrop-blur"),backdropBrightness:Ge.propT("--chakra-backdrop-brightness",qr.brightness),backdropContrast:Ge.propT("--chakra-backdrop-contrast",qr.contrast),backdropHueRotate:Ge.propT("--chakra-backdrop-hue-rotate",qr.hueRotate),backdropInvert:Ge.propT("--chakra-backdrop-invert",qr.invert),backdropSaturate:Ge.propT("--chakra-backdrop-saturate",qr.saturate)},u0e={ring:{transform:qr.ring},ringColor:Ge.colors("--chakra-ring-color"),ringOffset:Ge.prop("--chakra-ring-offset-width"),ringOffsetColor:Ge.colors("--chakra-ring-offset-color"),ringInset:Ge.prop("--chakra-ring-inset")},d0e={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:qr.outline},outlineOffset:!0,outlineColor:Ge.colors("outlineColor")},oee={gridGap:Ge.space("gridGap"),gridColumnGap:Ge.space("gridColumnGap"),gridRowGap:Ge.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function h0e(n,e,i,o){const l=typeof e=="string"?e.split("."):[e];for(o=0;o<l.length&&n;o+=1)n=n[l[o]];return n===void 0?i:n}const p0e=n=>{const e=new WeakMap;return(o,l,u,f)=>{if(typeof o>"u")return n(o,l,u);e.has(o)||e.set(o,new Map);const y=e.get(o);if(y.has(l))return y.get(l);const v=n(o,l,u,f);return y.set(l,v),v}},f0e=p0e(h0e),m0e={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},g0e={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},BM=(n,e,i)=>{const o={},l=f0e(n,e,{});for(const u in l)u in i&&i[u]!=null||(o[u]=l[u]);return o},_0e={srOnly:{transform(n){return n===!0?m0e:n==="focusable"?g0e:{}}},layerStyle:{processResult:!0,transform:(n,e,i)=>BM(e,`layerStyles.${n}`,i)},textStyle:{processResult:!0,transform:(n,e,i)=>BM(e,`textStyles.${n}`,i)},apply:{processResult:!0,transform:(n,e,i)=>BM(e,n,i)}},TC={position:!0,pos:Ge.prop("position"),zIndex:Ge.prop("zIndex","zIndices"),inset:Ge.spaceT("inset"),insetX:Ge.spaceT(["left","right"]),insetInline:Ge.spaceT("insetInline"),insetY:Ge.spaceT(["top","bottom"]),insetBlock:Ge.spaceT("insetBlock"),top:Ge.spaceT("top"),insetBlockStart:Ge.spaceT("insetBlockStart"),bottom:Ge.spaceT("bottom"),insetBlockEnd:Ge.spaceT("insetBlockEnd"),left:Ge.spaceT("left"),insetInlineStart:Ge.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Ge.spaceT("right"),insetInlineEnd:Ge.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(TC,{insetStart:TC.insetInlineStart,insetEnd:TC.insetInlineEnd});const uV={boxShadow:Ge.shadows("boxShadow"),mixBlendMode:!0,blendMode:Ge.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Ge.prop("backgroundBlendMode"),opacity:!0};Object.assign(uV,{shadow:uV.boxShadow});const ss={margin:Ge.spaceT("margin"),marginTop:Ge.spaceT("marginTop"),marginBlockStart:Ge.spaceT("marginBlockStart"),marginRight:Ge.spaceT("marginRight"),marginInlineEnd:Ge.spaceT("marginInlineEnd"),marginBottom:Ge.spaceT("marginBottom"),marginBlockEnd:Ge.spaceT("marginBlockEnd"),marginLeft:Ge.spaceT("marginLeft"),marginInlineStart:Ge.spaceT("marginInlineStart"),marginX:Ge.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Ge.spaceT("marginInline"),marginY:Ge.spaceT(["marginTop","marginBottom"]),marginBlock:Ge.spaceT("marginBlock"),padding:Ge.space("padding"),paddingTop:Ge.space("paddingTop"),paddingBlockStart:Ge.space("paddingBlockStart"),paddingRight:Ge.space("paddingRight"),paddingBottom:Ge.space("paddingBottom"),paddingBlockEnd:Ge.space("paddingBlockEnd"),paddingLeft:Ge.space("paddingLeft"),paddingInlineStart:Ge.space("paddingInlineStart"),paddingInlineEnd:Ge.space("paddingInlineEnd"),paddingX:Ge.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Ge.space("paddingInline"),paddingY:Ge.space(["paddingTop","paddingBottom"]),paddingBlock:Ge.space("paddingBlock")};Object.assign(ss,{m:ss.margin,mt:ss.marginTop,mr:ss.marginRight,me:ss.marginInlineEnd,marginEnd:ss.marginInlineEnd,mb:ss.marginBottom,ml:ss.marginLeft,ms:ss.marginInlineStart,marginStart:ss.marginInlineStart,mx:ss.marginX,my:ss.marginY,p:ss.padding,pt:ss.paddingTop,py:ss.paddingY,px:ss.paddingX,pb:ss.paddingBottom,pl:ss.paddingLeft,ps:ss.paddingInlineStart,paddingStart:ss.paddingInlineStart,pr:ss.paddingRight,pe:ss.paddingInlineEnd,paddingEnd:ss.paddingInlineEnd});const y0e={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Ge.spaceT("scrollMargin"),scrollMarginTop:Ge.spaceT("scrollMarginTop"),scrollMarginBottom:Ge.spaceT("scrollMarginBottom"),scrollMarginLeft:Ge.spaceT("scrollMarginLeft"),scrollMarginRight:Ge.spaceT("scrollMarginRight"),scrollMarginX:Ge.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Ge.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Ge.spaceT("scrollPadding"),scrollPaddingTop:Ge.spaceT("scrollPaddingTop"),scrollPaddingBottom:Ge.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Ge.spaceT("scrollPaddingLeft"),scrollPaddingRight:Ge.spaceT("scrollPaddingRight"),scrollPaddingX:Ge.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Ge.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},E0e={fontFamily:Ge.prop("fontFamily","fonts"),fontSize:Ge.prop("fontSize","fontSizes",qr.px),fontWeight:Ge.prop("fontWeight","fontWeights"),lineHeight:Ge.prop("lineHeight","lineHeights"),letterSpacing:Ge.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},v0e={textDecorationColor:Ge.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Ge.shadows("textShadow")},S0e={clipPath:!0,transform:Ge.propT("transform",qr.transform),transformOrigin:!0,translateX:Ge.spaceT("--chakra-translate-x"),translateY:Ge.spaceT("--chakra-translate-y"),skewX:Ge.degreeT("--chakra-skew-x"),skewY:Ge.degreeT("--chakra-skew-y"),scaleX:Ge.prop("--chakra-scale-x"),scaleY:Ge.prop("--chakra-scale-y"),scale:Ge.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Ge.degreeT("--chakra-rotate")},b0e={listStyleType:!0,listStylePosition:!0,listStylePos:Ge.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Ge.prop("listStyleImage")},w0e={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Ge.prop("transitionDuration","transition.duration"),transitionProperty:Ge.prop("transitionProperty","transition.property"),transitionTimingFunction:Ge.prop("transitionTimingFunction","transition.easing")},z5=Tp({},fO,pi,c0e,qO,rd,l0e,u0e,d0e,oee,_0e,TC,uV,ss,y0e,E0e,v0e,S0e,b0e,w0e),T0e=Object.assign({},ss,rd,qO,oee,TC),C0e=Object.keys(T0e),R0e=[...Object.keys(z5),...iee],I0e={...z5,...tS},A0e=n=>n in I0e,P0e=n=>e=>{if(!e.__breakpoints)return n;const{isResponsive:i,toArrayValue:o,media:l}=e.__breakpoints,u={};for(const f in n){let y=bl(n[f],e);if(y==null)continue;if(y=ad(y)&&i(y)?o(y):y,!Array.isArray(y)){u[f]=y;continue}const v=y.slice(0,l.length).length;for(let b=0;b<v;b+=1){const C=l==null?void 0:l[b];if(!C){u[f]=y[b];continue}u[C]=u[C]||{},y[b]!=null&&(u[C][f]=y[b])}}return u};function O0e(n){const e=[];let i="",o=!1;for(let l=0;l<n.length;l++){const u=n[l];u==="("?(o=!0,i+=u):u===")"?(o=!1,i+=u):u===","&&!o?(e.push(i),i=""):i+=u}return i=i.trim(),i&&e.push(i),e}function k0e(n){return/^var\(--.+\)$/.test(n)}const N0e=(n,e)=>n.startsWith("--")&&typeof e=="string"&&!k0e(e),x0e=(n,e)=>{if(e==null)return e;const i=f=>{var y,v;return(v=(y=n.__cssMap)==null?void 0:y[f])==null?void 0:v.varRef},o=f=>i(f)??f,[l,u]=O0e(e);return e=i(l)??o(u)??o(e),e};function D0e(n){const{configs:e={},pseudos:i={},theme:o}=n,l=(u,f=!1)=>{var C;const y=bl(u,o),v=P0e(y)(o);let b={};for(let R in v){const O=v[R];let L=bl(O,o);R in i&&(R=i[R]),N0e(R,L)&&(L=x0e(o,L));let D=e[R];if(D===!0&&(D={property:R}),ad(L)){b[R]=b[R]??{},b[R]=Tp({},b[R],l(L,!0));continue}let U=((C=D==null?void 0:D.transform)==null?void 0:C.call(D,L,o,y))??L;U=D!=null&&D.processResult?l(U,!0):U;const B=bl(D==null?void 0:D.property,o);if(!f&&(D!=null&&D.static)){const Y=bl(D.static,o);b=Tp({},b,Y)}if(B&&Array.isArray(B)){for(const Y of B)b[Y]=U;continue}if(B){B==="&"&&ad(U)?b=Tp({},b,U):b[B]=U;continue}if(ad(U)){b=Tp({},b,U);continue}b[R]=U}return b};return l}const aee=n=>e=>D0e({theme:e,pseudos:tS,configs:z5})(n);function EGe(n){return n}function vGe(n){return n}function Qi(n){return{definePartsStyle(e){return e},defineMultiStyleConfig(e){return{parts:n,...e}}}}function L0e(n,e,i){var o,l;return((l=(o=n.__cssMap)==null?void 0:o[`${e}.${i}`])==null?void 0:l.varRef)??i}function M0e(n,e){if(Array.isArray(n))return n;if(ad(n))return e(n);if(n!=null)return[n]}function U0e(n,e){for(let i=e+1;i<n.length;i++)if(n[i]!=null)return i;return-1}function V0e(n){const e=n.__breakpoints;return function(o,l,u,f){var O,L;if(!e)return;const y={},v=M0e(u,e.toArrayValue);if(!v)return y;const b=v.length,C=b===1,R=!!o.parts;for(let D=0;D<b;D++){const U=e.details[D],B=e.details[U0e(v,D)],Y=iC(U.minW,B==null?void 0:B._minW),W=bl((O=o[l])==null?void 0:O[v[D]],f);if(W){if(R){(L=o.parts)==null||L.forEach(ne=>{Tp(y,{[ne]:C?W[ne]:{[Y]:W[ne]}})});continue}if(!R){C?Tp(y,W):y[Y]=W;continue}y[Y]=W}}return y}}function j0e(n){return e=>{const{variant:i,size:o,theme:l}=e,u=V0e(l);return Tp({},bl(n.baseStyle??{},e),u(n,"sizes",o,e),u(n,"variants",i,e))}}function Hi(n){return CR(n,["styleConfig","size","variant","colorScheme"])}function cee(n){return ad(n)&&n.reference?n.reference:String(n)}const Wk=(n,...e)=>e.map(cee).join(` ${n} `).replace(/calc/g,""),lq=(...n)=>`calc(${Wk("+",...n)})`,uq=(...n)=>`calc(${Wk("-",...n)})`,dV=(...n)=>`calc(${Wk("*",...n)})`,dq=(...n)=>`calc(${Wk("/",...n)})`,hq=n=>{const e=cee(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:dV(e,-1)},Pf=Object.assign(n=>({add:(...e)=>Pf(lq(n,...e)),subtract:(...e)=>Pf(uq(n,...e)),multiply:(...e)=>Pf(dV(n,...e)),divide:(...e)=>Pf(dq(n,...e)),negate:()=>Pf(hq(n)),toString:()=>n.toString()}),{add:lq,subtract:uq,multiply:dV,divide:dq,negate:hq});function F0e(n,e="-"){return n.replace(/\s+/g,e)}function B0e(n){const e=F0e(n.toString());return W0e(z0e(e))}function z0e(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function W0e(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function G0e(n,e=""){return[e,n].filter(Boolean).join("-")}function H0e(n,e){return`var(${n}${e?`, ${e}`:""})`}function $0e(n,e=""){return B0e(`--${G0e(n,e)}`)}function Gn(n,e,i){const o=$0e(n,i);return{variable:o,reference:H0e(o,e)}}function K0e(n,e){const i={};for(const o of e){if(Array.isArray(o)){const[l,u]=o;i[l]=Gn(`${n}-${l}`,u);continue}i[o]=Gn(`${n}-${o}`)}return i}const q0e=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function Y0e(n){return GZ(n,q0e)}function X0e(n){return n.semanticTokens}function J0e(n){const{__cssMap:e,__cssVars:i,__breakpoints:o,...l}=n;return l}function Q0e(n){const e=Y0e(n),i=X0e(n),o=u=>iee.includes(u)||u==="default",l={};return ZK(e,(u,f)=>{u!=null&&(l[f.join(".")]={isSemantic:!1,value:u})}),ZK(i,(u,f)=>{u!=null&&(l[f.join(".")]={isSemantic:!0,value:u})},{stop:u=>Object.keys(u).every(o)}),l}function pq(n,e){return Gn(String(n).replace(/\./g,"-"),void 0,e)}function Z0e(n){var f;const e=Q0e(n),i=(f=n.config)==null?void 0:f.cssVarPrefix;let o={};const l={};function u(y,v){const C=[String(y).split(".")[0],v].join(".");if(!e[C])return v;const{reference:O}=pq(C,i);return O}for(const[y,v]of Object.entries(e)){const{isSemantic:b,value:C}=v,{variable:R,reference:O}=pq(y,i);if(!b){if(y.startsWith("space")){const D=y.split("."),[U,...B]=D,Y=`${U}.-${B.join(".")}`,W=Pf.negate(C),ne=Pf.negate(O);l[Y]={value:W,var:R,varRef:ne}}o[R]=C,l[y]={value:C,var:R,varRef:O};continue}const L=ad(C)?C:{default:C};o=Tp(o,Object.entries(L).reduce((D,[U,B])=>{if(!B)return D;const Y=u(y,`${B}`);if(U==="default")return D[R]=Y,D;const W=(tS==null?void 0:tS[U])??U;return D[W]={[R]:Y},D},{})),l[y]={value:O,var:R,varRef:O}}return{cssVars:o,cssMap:l}}function eSe(n){const e=J0e(n),{cssMap:i,cssVars:o}=Z0e(e);return Object.assign(e,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...o},__cssMap:i,__breakpoints:HEe(e.breakpoints)}),e}function yi(n,e={}){let i=!1;function o(){if(!i){i=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...C){o();for(const R of C)e[R]=v(R);return yi(n,e)}function u(...C){for(const R of C)R in e||(e[R]=v(R));return yi(n,e)}function f(){return Object.fromEntries(Object.entries(e).map(([R,O])=>[R,O.selector]))}function y(){return Object.fromEntries(Object.entries(e).map(([R,O])=>[R,O.className]))}function v(C){const L=`chakra-${(["container","root"].includes(C??"")?[n]:[n,C]).filter(Boolean).join("__")}`;return{className:L,selector:`.${L}`,toString:()=>C}}return{parts:l,toPart:v,extend:u,selectors:f,classnames:y,get keys(){return Object.keys(e)},__type:{}}}const tSe=yi("accordion").parts("root","container","button","panel","icon"),nSe=yi("alert").parts("title","description","container","icon","spinner"),rSe=yi("avatar").parts("label","badge","container","excessLabel","group"),iSe=yi("breadcrumb").parts("link","item","container","separator");yi("button").parts();const sSe=yi("checkbox").parts("control","icon","container","label");yi("progress").parts("track","filledTrack","label");const oSe=yi("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),aSe=yi("editable").parts("preview","input","textarea"),cSe=yi("form").parts("container","requiredIndicator","helperText"),lSe=yi("formError").parts("text","icon"),uSe=yi("input").parts("addon","field","element","group"),dSe=yi("list").parts("container","item","icon"),hSe=yi("menu").parts("button","list","item","groupTitle","icon","command","divider"),pSe=yi("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),fSe=yi("numberinput").parts("root","field","stepperGroup","stepper");yi("pininput").parts("field");const mSe=yi("popover").parts("content","header","body","footer","popper","arrow","closeButton"),gSe=yi("progress").parts("label","filledTrack","track"),_Se=yi("radio").parts("container","control","label"),ySe=yi("select").parts("field","icon"),ESe=yi("slider").parts("container","track","thumb","filledTrack","mark"),vSe=yi("stat").parts("container","label","helpText","number","icon"),SSe=yi("switch").parts("container","track","thumb","label"),bSe=yi("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),wSe=yi("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),TSe=yi("tag").parts("container","label","closeButton"),CSe=yi("card").parts("container","header","body","footer");yi("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:RSe,defineMultiStyleConfig:ISe}=Qi(tSe.keys),ASe={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},PSe={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},OSe={pt:"2",px:"4",pb:"5"},kSe={fontSize:"1.25em"},NSe=RSe({container:ASe,button:PSe,panel:OSe,icon:kSe}),xSe=ISe({baseStyle:NSe});function Oy(n,e,i){return Math.min(Math.max(n,i),e)}class DSe extends Error{constructor(e){super(`Failed to parse color: "${e}"`)}}var oC=DSe;function W5(n){if(typeof n!="string")throw new oC(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=n.trim();e=zSe.test(n)?USe(n):n;const i=VSe.exec(e);if(i){const f=Array.from(i).slice(1);return[...f.slice(0,3).map(y=>parseInt(qC(y,2),16)),parseInt(qC(f[3]||"f",2),16)/255]}const o=jSe.exec(e);if(o){const f=Array.from(o).slice(1);return[...f.slice(0,3).map(y=>parseInt(y,16)),parseInt(f[3]||"ff",16)/255]}const l=FSe.exec(e);if(l){const f=Array.from(l).slice(1);return[...f.slice(0,3).map(y=>parseInt(y,10)),parseFloat(f[3]||"1")]}const u=BSe.exec(e);if(u){const[f,y,v,b]=Array.from(u).slice(1).map(parseFloat);if(Oy(0,100,y)!==y)throw new oC(n);if(Oy(0,100,v)!==v)throw new oC(n);return[...WSe(f,y,v),Number.isNaN(b)?1:b]}throw new oC(n)}function LSe(n){let e=5381,i=n.length;for(;i;)e=e*33^n.charCodeAt(--i);return(e>>>0)%2341}const fq=n=>parseInt(n.replace(/_/g,""),36),MSe="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,e)=>{const i=fq(e.substring(0,3)),o=fq(e.substring(3)).toString(16);let l="";for(let u=0;u<6-o.length;u++)l+="0";return n[i]=`${l}${o}`,n},{});function USe(n){const e=n.toLowerCase().trim(),i=MSe[LSe(e)];if(!i)throw new oC(n);return`#${i}`}const qC=(n,e)=>Array.from(Array(e)).map(()=>n).join(""),VSe=new RegExp(`^#${qC("([a-f0-9])",3)}([a-f0-9])?$`,"i"),jSe=new RegExp(`^#${qC("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),FSe=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${qC(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),BSe=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,zSe=/^[a-z]+$/i,mq=n=>Math.round(n*255),WSe=(n,e,i)=>{let o=i/100;if(e===0)return[o,o,o].map(mq);const l=(n%360+360)%360/60,u=(1-Math.abs(2*o-1))*(e/100),f=u*(1-Math.abs(l%2-1));let y=0,v=0,b=0;l>=0&&l<1?(y=u,v=f):l>=1&&l<2?(y=f,v=u):l>=2&&l<3?(v=u,b=f):l>=3&&l<4?(v=f,b=u):l>=4&&l<5?(y=f,b=u):l>=5&&l<6&&(y=u,b=f);const C=o-u/2,R=y+C,O=v+C,L=b+C;return[R,O,L].map(mq)};function GSe(n,e,i,o){return`rgba(${Oy(0,255,n).toFixed()}, ${Oy(0,255,e).toFixed()}, ${Oy(0,255,i).toFixed()}, ${parseFloat(Oy(0,1,o).toFixed(3))})`}function HSe(n,e){const[i,o,l,u]=W5(n);return GSe(i,o,l,u-e)}function $Se(n){const[e,i,o,l]=W5(n);let u=f=>{const y=Oy(0,255,f).toString(16);return y.length===1?`0${y}`:y};return`#${u(e)}${u(i)}${u(o)}${l<1?u(Math.round(l*255)):""}`}const KSe=n=>Object.keys(n).length===0;function qSe(n,e,i,o,l){for(e=e.split?e.split("."):e,o=0;o<e.length;o++)n=n?n[e[o]]:l;return n===l?i:n}const Lc=(n,e,i)=>{const o=qSe(n,`colors.${e}`,e);try{return $Se(o),o}catch{return i??"#000000"}},YSe=n=>{const[e,i,o]=W5(n);return(e*299+i*587+o*114)/1e3},XSe=n=>e=>{const i=Lc(e,n);return YSe(i)<128?"dark":"light"},JSe=n=>e=>XSe(n)(e)==="dark",vS=(n,e)=>i=>{const o=Lc(i,n);return HSe(o,1-e)};function gq(n="1rem",e="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${e} 25%,
    transparent 25%,
    transparent 50%,
    ${e} 50%,
    ${e} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const QSe=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function ZSe(n){const e=QSe();return!n||KSe(n)?e:n.string&&n.colors?tbe(n.string,n.colors):n.string&&!n.colors?ebe(n.string):n.colors&&!n.string?nbe(n.colors):e}function ebe(n){let e=0;if(n.length===0)return e.toString();for(let o=0;o<n.length;o+=1)e=n.charCodeAt(o)+((e<<5)-e),e=e&e;let i="#";for(let o=0;o<3;o+=1){const l=e>>o*8&255;i+=`00${l.toString(16)}`.substr(-2)}return i}function tbe(n,e){let i=0;if(n.length===0)return e[0];for(let o=0;o<n.length;o+=1)i=n.charCodeAt(o)+((i<<5)-i),i=i&i;return i=(i%e.length+e.length)%e.length,e[i]}function nbe(n){return n[Math.floor(Math.random()*n.length)]}function Wn(n,e){return i=>i.colorMode==="dark"?e:n}function G5(n){const{orientation:e,vertical:i,horizontal:o}=n;return e?e==="vertical"?i:o:{}}function lee(n){return ad(n)&&n.reference?n.reference:String(n)}const Gk=(n,...e)=>e.map(lee).join(` ${n} `).replace(/calc/g,""),_q=(...n)=>`calc(${Gk("+",...n)})`,yq=(...n)=>`calc(${Gk("-",...n)})`,hV=(...n)=>`calc(${Gk("*",...n)})`,Eq=(...n)=>`calc(${Gk("/",...n)})`,vq=n=>{const e=lee(n);return e!=null&&!Number.isNaN(parseFloat(e))?String(e).startsWith("-")?String(e).slice(1):`-${e}`:hV(e,-1)},Of=Object.assign(n=>({add:(...e)=>Of(_q(n,...e)),subtract:(...e)=>Of(yq(n,...e)),multiply:(...e)=>Of(hV(n,...e)),divide:(...e)=>Of(Eq(n,...e)),negate:()=>Of(vq(n)),toString:()=>n.toString()}),{add:_q,subtract:yq,multiply:hV,divide:Eq,negate:vq});function rbe(n){return!Number.isInteger(parseFloat(n.toString()))}function ibe(n,e="-"){return n.replace(/\s+/g,e)}function uee(n){const e=ibe(n.toString());return e.includes("\\.")?n:rbe(n)?e.replace(".","\\."):n}function sbe(n,e=""){return[e,uee(n)].filter(Boolean).join("-")}function obe(n,e){return`var(${uee(n)}${e?`, ${e}`:""})`}function abe(n,e=""){return`--${sbe(n,e)}`}function Qo(n,e){const i=abe(n,e==null?void 0:e.prefix);return{variable:i,reference:obe(i,cbe(e==null?void 0:e.fallback))}}function cbe(n){return n==null?void 0:n.reference}const{definePartsStyle:IR,defineMultiStyleConfig:lbe}=Qi(nSe.keys),pu=Gn("alert-fg"),Gf=Gn("alert-bg"),ube=IR({container:{bg:Gf.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:pu.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:pu.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function H5(n){const{theme:e,colorScheme:i}=n,o=vS(`${i}.200`,.16)(e);return{light:`colors.${i}.100`,dark:o}}const dbe=IR(n=>{const{colorScheme:e}=n,i=H5(n);return{container:{[pu.variable]:`colors.${e}.600`,[Gf.variable]:i.light,_dark:{[pu.variable]:`colors.${e}.200`,[Gf.variable]:i.dark}}}}),hbe=IR(n=>{const{colorScheme:e}=n,i=H5(n);return{container:{[pu.variable]:`colors.${e}.600`,[Gf.variable]:i.light,_dark:{[pu.variable]:`colors.${e}.200`,[Gf.variable]:i.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:pu.reference}}}),pbe=IR(n=>{const{colorScheme:e}=n,i=H5(n);return{container:{[pu.variable]:`colors.${e}.600`,[Gf.variable]:i.light,_dark:{[pu.variable]:`colors.${e}.200`,[Gf.variable]:i.dark},pt:"2",borderTopWidth:"4px",borderTopColor:pu.reference}}}),fbe=IR(n=>{const{colorScheme:e}=n;return{container:{[pu.variable]:"colors.white",[Gf.variable]:`colors.${e}.600`,_dark:{[pu.variable]:"colors.gray.900",[Gf.variable]:`colors.${e}.200`},color:pu.reference}}}),mbe={subtle:dbe,"left-accent":hbe,"top-accent":pbe,solid:fbe},gbe=lbe({baseStyle:ube,variants:mbe,defaultProps:{variant:"subtle",colorScheme:"blue"}}),dee={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},_be={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},ybe={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},hee={...dee,..._be,container:ybe},Ebe=n=>typeof n=="function";function Mc(n,...e){return Ebe(n)?n(...e):n}const{definePartsStyle:pee,defineMultiStyleConfig:vbe}=Qi(rSe.keys),nS=Gn("avatar-border-color"),CC=Gn("avatar-bg"),YC=Gn("avatar-font-size"),SS=Gn("avatar-size"),Sbe={borderRadius:"full",border:"0.2em solid",borderColor:nS.reference,[nS.variable]:"white",_dark:{[nS.variable]:"colors.gray.800"}},bbe={bg:CC.reference,fontSize:YC.reference,width:SS.reference,height:SS.reference,lineHeight:"1",[CC.variable]:"colors.gray.200",_dark:{[CC.variable]:"colors.whiteAlpha.400"}},wbe=n=>{const{name:e,theme:i}=n,o=e?ZSe({string:e}):"colors.gray.400",l=JSe(o)(i);let u="white";return l||(u="gray.800"),{bg:CC.reference,fontSize:YC.reference,color:u,borderColor:nS.reference,verticalAlign:"top",width:SS.reference,height:SS.reference,"&:not([data-loaded])":{[CC.variable]:o},[nS.variable]:"colors.white",_dark:{[nS.variable]:"colors.gray.800"}}},Tbe={fontSize:YC.reference,lineHeight:"1"},Cbe=pee(n=>({badge:Mc(Sbe,n),excessLabel:Mc(bbe,n),container:Mc(wbe,n),label:Tbe}));function pg(n){const e=n!=="100%"?hee[n]:void 0;return pee({container:{[SS.variable]:e??n,[YC.variable]:`calc(${e??n} / 2.5)`},excessLabel:{[SS.variable]:e??n,[YC.variable]:`calc(${e??n} / 2.5)`}})}const Rbe={"2xs":pg(4),xs:pg(6),sm:pg(8),md:pg(12),lg:pg(16),xl:pg(24),"2xl":pg(32),full:pg("100%")},Ibe=vbe({baseStyle:Cbe,sizes:Rbe,defaultProps:{size:"md"}}),go=K0e("badge",["bg","color","shadow"]),Abe={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:go.bg.reference,color:go.color.reference,boxShadow:go.shadow.reference},Pbe=n=>{const{colorScheme:e,theme:i}=n,o=vS(`${e}.500`,.6)(i);return{[go.bg.variable]:`colors.${e}.500`,[go.color.variable]:"colors.white",_dark:{[go.bg.variable]:o,[go.color.variable]:"colors.whiteAlpha.800"}}},Obe=n=>{const{colorScheme:e,theme:i}=n,o=vS(`${e}.200`,.16)(i);return{[go.bg.variable]:`colors.${e}.100`,[go.color.variable]:`colors.${e}.800`,_dark:{[go.bg.variable]:o,[go.color.variable]:`colors.${e}.200`}}},kbe=n=>{const{colorScheme:e,theme:i}=n,o=vS(`${e}.200`,.8)(i);return{[go.color.variable]:`colors.${e}.500`,_dark:{[go.color.variable]:o},[go.shadow.variable]:`inset 0 0 0px 1px ${go.color.reference}`}},Nbe={solid:Pbe,subtle:Obe,outline:kbe},RC={baseStyle:Abe,variants:Nbe,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:xbe,definePartsStyle:Dbe}=Qi(iSe.keys),zM=Gn("breadcrumb-link-decor"),Lbe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:zM.reference,[zM.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[zM.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},Mbe=Dbe({link:Lbe}),Ube=xbe({baseStyle:Mbe}),Vbe={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},fee=n=>{const{colorScheme:e,theme:i}=n;if(e==="gray")return{color:Wn("gray.800","whiteAlpha.900")(n),_hover:{bg:Wn("gray.100","whiteAlpha.200")(n)},_active:{bg:Wn("gray.200","whiteAlpha.300")(n)}};const o=vS(`${e}.200`,.12)(i),l=vS(`${e}.200`,.24)(i);return{color:Wn(`${e}.600`,`${e}.200`)(n),bg:"transparent",_hover:{bg:Wn(`${e}.50`,o)(n)},_active:{bg:Wn(`${e}.100`,l)(n)}}},jbe=n=>{const{colorScheme:e}=n,i=Wn("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:e==="gray"?i:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...Mc(fee,n)}},Fbe={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},Bbe=n=>{const{colorScheme:e}=n;if(e==="gray"){const y=Wn("gray.100","whiteAlpha.200")(n);return{bg:y,color:Wn("gray.800","whiteAlpha.900")(n),_hover:{bg:Wn("gray.200","whiteAlpha.300")(n),_disabled:{bg:y}},_active:{bg:Wn("gray.300","whiteAlpha.400")(n)}}}const{bg:i=`${e}.500`,color:o="white",hoverBg:l=`${e}.600`,activeBg:u=`${e}.700`}=Fbe[e]??{},f=Wn(i,`${e}.200`)(n);return{bg:f,color:Wn(o,"gray.800")(n),_hover:{bg:Wn(l,`${e}.300`)(n),_disabled:{bg:f}},_active:{bg:Wn(u,`${e}.400`)(n)}}},zbe=n=>{const{colorScheme:e}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:Wn(`${e}.500`,`${e}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:Wn(`${e}.700`,`${e}.500`)(n)}}},Wbe={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},Gbe={ghost:fee,outline:jbe,solid:Bbe,link:zbe,unstyled:Wbe},Hbe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},$be={baseStyle:Vbe,variants:Gbe,sizes:Hbe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:Vy,defineMultiStyleConfig:Kbe}=Qi(CSe.keys),YO=Gn("card-bg"),Mf=Gn("card-padding"),mee=Gn("card-shadow"),mO=Gn("card-radius"),gee=Gn("card-border-width","0"),_ee=Gn("card-border-color"),qbe=Vy({container:{[YO.variable]:"colors.chakra-body-bg",backgroundColor:YO.reference,boxShadow:mee.reference,borderRadius:mO.reference,color:"chakra-body-text",borderWidth:gee.reference,borderColor:_ee.reference},body:{padding:Mf.reference,flex:"1 1 0%"},header:{padding:Mf.reference},footer:{padding:Mf.reference}}),Ybe={sm:Vy({container:{[mO.variable]:"radii.base",[Mf.variable]:"space.3"}}),md:Vy({container:{[mO.variable]:"radii.md",[Mf.variable]:"space.5"}}),lg:Vy({container:{[mO.variable]:"radii.xl",[Mf.variable]:"space.7"}})},Xbe={elevated:Vy({container:{[mee.variable]:"shadows.base",_dark:{[YO.variable]:"colors.gray.700"}}}),outline:Vy({container:{[gee.variable]:"1px",[_ee.variable]:"colors.chakra-border-color"}}),filled:Vy({container:{[YO.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Mf.variable]:0},header:{[Mf.variable]:0},footer:{[Mf.variable]:0}}},Jbe=Kbe({baseStyle:qbe,variants:Xbe,sizes:Ybe,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:gO,defineMultiStyleConfig:Qbe}=Qi(sSe.keys),IC=Gn("checkbox-size"),Zbe=n=>{const{colorScheme:e}=n;return{w:IC.reference,h:IC.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:Wn(`${e}.500`,`${e}.200`)(n),borderColor:Wn(`${e}.500`,`${e}.200`)(n),color:Wn("white","gray.900")(n),_hover:{bg:Wn(`${e}.600`,`${e}.300`)(n),borderColor:Wn(`${e}.600`,`${e}.300`)(n)},_disabled:{borderColor:Wn("gray.200","transparent")(n),bg:Wn("gray.200","whiteAlpha.300")(n),color:Wn("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:Wn(`${e}.500`,`${e}.200`)(n),borderColor:Wn(`${e}.500`,`${e}.200`)(n),color:Wn("white","gray.900")(n)},_disabled:{bg:Wn("gray.100","whiteAlpha.100")(n),borderColor:Wn("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:Wn("red.500","red.300")(n)}}},ewe={_disabled:{cursor:"not-allowed"}},twe={userSelect:"none",_disabled:{opacity:.4}},nwe={transitionProperty:"transform",transitionDuration:"normal"},rwe=gO(n=>({icon:nwe,container:ewe,control:Mc(Zbe,n),label:twe})),iwe={sm:gO({control:{[IC.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:gO({control:{[IC.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:gO({control:{[IC.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},yg=Qbe({baseStyle:rwe,sizes:iwe,defaultProps:{size:"md",colorScheme:"blue"}}),AC=Qo("close-button-size"),WT=Qo("close-button-bg"),swe={w:[AC.reference],h:[AC.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[WT.variable]:"colors.blackAlpha.100",_dark:{[WT.variable]:"colors.whiteAlpha.100"}},_active:{[WT.variable]:"colors.blackAlpha.200",_dark:{[WT.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:WT.reference},owe={lg:{[AC.variable]:"sizes.10",fontSize:"md"},md:{[AC.variable]:"sizes.8",fontSize:"xs"},sm:{[AC.variable]:"sizes.6",fontSize:"2xs"}},awe={baseStyle:swe,sizes:owe,defaultProps:{size:"md"}},{variants:cwe,defaultProps:lwe}=RC,uwe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:go.bg.reference,color:go.color.reference,boxShadow:go.shadow.reference},dwe={baseStyle:uwe,variants:cwe,defaultProps:lwe},hwe={w:"100%",mx:"auto",maxW:"prose",px:"4"},pwe={baseStyle:hwe},fwe={opacity:.6,borderColor:"inherit"},mwe={borderStyle:"solid"},gwe={borderStyle:"dashed"},_we={solid:mwe,dashed:gwe},ywe={baseStyle:fwe,variants:_we,defaultProps:{variant:"solid"}},{definePartsStyle:pV,defineMultiStyleConfig:Ewe}=Qi(oSe.keys),WM=Gn("drawer-bg"),GM=Gn("drawer-box-shadow");function T0(n){return pV(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const vwe={bg:"blackAlpha.600",zIndex:"modal"},Swe={display:"flex",zIndex:"modal",justifyContent:"center"},bwe=n=>{const{isFullHeight:e}=n;return{...e&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[WM.variable]:"colors.white",[GM.variable]:"shadows.lg",_dark:{[WM.variable]:"colors.gray.700",[GM.variable]:"shadows.dark-lg"},bg:WM.reference,boxShadow:GM.reference}},wwe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},Twe={position:"absolute",top:"2",insetEnd:"3"},Cwe={px:"6",py:"2",flex:"1",overflow:"auto"},Rwe={px:"6",py:"4"},Iwe=pV(n=>({overlay:vwe,dialogContainer:Swe,dialog:Mc(bwe,n),header:wwe,closeButton:Twe,body:Cwe,footer:Rwe})),Awe={xs:T0("xs"),sm:T0("md"),md:T0("lg"),lg:T0("2xl"),xl:T0("4xl"),full:T0("full")},Pwe=Ewe({baseStyle:Iwe,sizes:Awe,defaultProps:{size:"xs"}}),{definePartsStyle:Owe,defineMultiStyleConfig:kwe}=Qi(aSe.keys),Nwe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},xwe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},Dwe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},Lwe=Owe({preview:Nwe,input:xwe,textarea:Dwe}),Mwe=kwe({baseStyle:Lwe}),{definePartsStyle:Uwe,defineMultiStyleConfig:Vwe}=Qi(cSe.keys),rS=Gn("form-control-color"),jwe={marginStart:"1",[rS.variable]:"colors.red.500",_dark:{[rS.variable]:"colors.red.300"},color:rS.reference},Fwe={mt:"2",[rS.variable]:"colors.gray.600",_dark:{[rS.variable]:"colors.whiteAlpha.600"},color:rS.reference,lineHeight:"normal",fontSize:"sm"},Bwe=Uwe({container:{width:"100%",position:"relative"},requiredIndicator:jwe,helperText:Fwe}),zwe=Vwe({baseStyle:Bwe}),{definePartsStyle:Wwe,defineMultiStyleConfig:Gwe}=Qi(lSe.keys),iS=Gn("form-error-color"),Hwe={[iS.variable]:"colors.red.500",_dark:{[iS.variable]:"colors.red.300"},color:iS.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},$we={marginEnd:"0.5em",[iS.variable]:"colors.red.500",_dark:{[iS.variable]:"colors.red.300"},color:iS.reference},Kwe=Wwe({text:Hwe,icon:$we}),qwe=Gwe({baseStyle:Kwe}),Ywe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},Xwe={baseStyle:Ywe},Jwe={fontFamily:"heading",fontWeight:"bold"},Qwe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},Zwe={baseStyle:Jwe,sizes:Qwe,defaultProps:{size:"xl"}},{definePartsStyle:Nf,defineMultiStyleConfig:eTe}=Qi(uSe.keys),j0=Gn("input-height"),F0=Gn("input-font-size"),B0=Gn("input-padding"),z0=Gn("input-border-radius"),tTe=Nf({addon:{height:j0.reference,fontSize:F0.reference,px:B0.reference,borderRadius:z0.reference},field:{width:"100%",height:j0.reference,fontSize:F0.reference,px:B0.reference,borderRadius:z0.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),fg={lg:{[F0.variable]:"fontSizes.lg",[B0.variable]:"space.4",[z0.variable]:"radii.md",[j0.variable]:"sizes.12"},md:{[F0.variable]:"fontSizes.md",[B0.variable]:"space.4",[z0.variable]:"radii.md",[j0.variable]:"sizes.10"},sm:{[F0.variable]:"fontSizes.sm",[B0.variable]:"space.3",[z0.variable]:"radii.sm",[j0.variable]:"sizes.8"},xs:{[F0.variable]:"fontSizes.xs",[B0.variable]:"space.2",[z0.variable]:"radii.sm",[j0.variable]:"sizes.6"}},nTe={lg:Nf({field:fg.lg,group:fg.lg}),md:Nf({field:fg.md,group:fg.md}),sm:Nf({field:fg.sm,group:fg.sm}),xs:Nf({field:fg.xs,group:fg.xs})};function $5(n){const{focusBorderColor:e,errorBorderColor:i}=n;return{focusBorderColor:e||Wn("blue.500","blue.300")(n),errorBorderColor:i||Wn("red.500","red.300")(n)}}const rTe=Nf(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=$5(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:Wn("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Lc(e,o),boxShadow:`0 0 0 1px ${Lc(e,o)}`},_focusVisible:{zIndex:1,borderColor:Lc(e,i),boxShadow:`0 0 0 1px ${Lc(e,i)}`}},addon:{border:"1px solid",borderColor:Wn("inherit","whiteAlpha.50")(n),bg:Wn("gray.100","whiteAlpha.300")(n)}}}),iTe=Nf(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=$5(n);return{field:{border:"2px solid",borderColor:"transparent",bg:Wn("gray.100","whiteAlpha.50")(n),_hover:{bg:Wn("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Lc(e,o)},_focusVisible:{bg:"transparent",borderColor:Lc(e,i)}},addon:{border:"2px solid",borderColor:"transparent",bg:Wn("gray.100","whiteAlpha.50")(n)}}}),sTe=Nf(n=>{const{theme:e}=n,{focusBorderColor:i,errorBorderColor:o}=$5(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Lc(e,o),boxShadow:`0px 1px 0px 0px ${Lc(e,o)}`},_focusVisible:{borderColor:Lc(e,i),boxShadow:`0px 1px 0px 0px ${Lc(e,i)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),oTe=Nf({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),aTe={outline:rTe,filled:iTe,flushed:sTe,unstyled:oTe},_i=eTe({baseStyle:tTe,sizes:nTe,variants:aTe,defaultProps:{size:"md",variant:"outline"}}),HM=Gn("kbd-bg"),cTe={[HM.variable]:"colors.gray.100",_dark:{[HM.variable]:"colors.whiteAlpha.100"},bg:HM.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},lTe={baseStyle:cTe},uTe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},dTe={baseStyle:uTe},{defineMultiStyleConfig:hTe,definePartsStyle:pTe}=Qi(dSe.keys),fTe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},mTe=pTe({icon:fTe}),gTe=hTe({baseStyle:mTe}),{defineMultiStyleConfig:_Te,definePartsStyle:yTe}=Qi(hSe.keys),gp=Gn("menu-bg"),$M=Gn("menu-shadow"),ETe={[gp.variable]:"#fff",[$M.variable]:"shadows.sm",_dark:{[gp.variable]:"colors.gray.700",[$M.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:gp.reference,boxShadow:$M.reference},vTe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[gp.variable]:"colors.gray.100",_dark:{[gp.variable]:"colors.whiteAlpha.100"}},_active:{[gp.variable]:"colors.gray.200",_dark:{[gp.variable]:"colors.whiteAlpha.200"}},_expanded:{[gp.variable]:"colors.gray.100",_dark:{[gp.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:gp.reference},STe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},bTe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},wTe={opacity:.6},TTe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},CTe={transitionProperty:"common",transitionDuration:"normal"},RTe=yTe({button:CTe,list:ETe,item:vTe,groupTitle:STe,icon:bTe,command:wTe,divider:TTe}),ITe=_Te({baseStyle:RTe}),{defineMultiStyleConfig:ATe,definePartsStyle:fV}=Qi(pSe.keys),KM=Gn("modal-bg"),qM=Gn("modal-shadow"),PTe={bg:"blackAlpha.600",zIndex:"modal"},OTe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:e?"center":"flex-start",overflow:i==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},kTe=n=>{const{isCentered:e,scrollBehavior:i}=n;return{borderRadius:"md",color:"inherit",my:e?"auto":"16",mx:e?"auto":void 0,zIndex:"modal",maxH:i==="inside"?"calc(100% - 7.5rem)":void 0,[KM.variable]:"colors.white",[qM.variable]:"shadows.lg",_dark:{[KM.variable]:"colors.gray.700",[qM.variable]:"shadows.dark-lg"},bg:KM.reference,boxShadow:qM.reference}},NTe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},xTe={position:"absolute",top:"2",insetEnd:"3"},DTe=n=>{const{scrollBehavior:e}=n;return{px:"6",py:"2",flex:"1",overflow:e==="inside"?"auto":void 0}},LTe={px:"6",py:"4"},MTe=fV(n=>({overlay:PTe,dialogContainer:Mc(OTe,n),dialog:Mc(kTe,n),header:NTe,closeButton:xTe,body:Mc(DTe,n),footer:LTe}));function oh(n){return fV(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const UTe={xs:oh("xs"),sm:oh("sm"),md:oh("md"),lg:oh("lg"),xl:oh("xl"),"2xl":oh("2xl"),"3xl":oh("3xl"),"4xl":oh("4xl"),"5xl":oh("5xl"),"6xl":oh("6xl"),full:oh("full")},VTe=ATe({baseStyle:MTe,sizes:UTe,defaultProps:{size:"md"}}),yee={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:jTe,definePartsStyle:Eee}=Qi(fSe.keys),K5=Qo("number-input-stepper-width"),vee=Qo("number-input-input-padding"),FTe=Of(K5).add("0.5rem").toString(),YM=Qo("number-input-bg"),XM=Qo("number-input-color"),JM=Qo("number-input-border-color"),BTe={[K5.variable]:"sizes.6",[vee.variable]:FTe},zTe=n=>{var e;return((e=Mc(_i.baseStyle,n))==null?void 0:e.field)??{}},WTe={width:K5.reference},GTe={borderStart:"1px solid",borderStartColor:JM.reference,color:XM.reference,bg:YM.reference,[XM.variable]:"colors.chakra-body-text",[JM.variable]:"colors.chakra-border-color",_dark:{[XM.variable]:"colors.whiteAlpha.800",[JM.variable]:"colors.whiteAlpha.300"},_active:{[YM.variable]:"colors.gray.200",_dark:{[YM.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},HTe=Eee(n=>({root:BTe,field:Mc(zTe,n)??{},stepperGroup:WTe,stepper:GTe}));function VP(n){var u,f;const e=(u=_i.sizes)==null?void 0:u[n],i={lg:"md",md:"md",sm:"sm",xs:"sm"},o=((f=e.field)==null?void 0:f.fontSize)??"md",l=yee.fontSizes[o];return Eee({field:{...e.field,paddingInlineEnd:vee.reference,verticalAlign:"top"},stepper:{fontSize:Of(l).multiply(.75).toString(),_first:{borderTopEndRadius:i[n]},_last:{borderBottomEndRadius:i[n],mt:"-1px",borderTopWidth:1}}})}const $Te={xs:VP("xs"),sm:VP("sm"),md:VP("md"),lg:VP("lg")},KTe=jTe({baseStyle:HTe,sizes:$Te,variants:_i.variants,defaultProps:_i.defaultProps});var _Z;const qTe={...(_Z=_i.baseStyle)==null?void 0:_Z.field,textAlign:"center"},YTe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var yZ;const XTe={outline:n=>{var e,i;return((i=Mc((e=_i.variants)==null?void 0:e.outline,n))==null?void 0:i.field)??{}},flushed:n=>{var e,i;return((i=Mc((e=_i.variants)==null?void 0:e.flushed,n))==null?void 0:i.field)??{}},filled:n=>{var e,i;return((i=Mc((e=_i.variants)==null?void 0:e.filled,n))==null?void 0:i.field)??{}},unstyled:((yZ=_i.variants)==null?void 0:yZ.unstyled.field)??{}},JTe={baseStyle:qTe,sizes:YTe,variants:XTe,defaultProps:_i.defaultProps},{defineMultiStyleConfig:QTe,definePartsStyle:ZTe}=Qi(mSe.keys),jP=Qo("popper-bg"),eCe=Qo("popper-arrow-bg"),Sq=Qo("popper-arrow-shadow-color"),tCe={zIndex:"popover"},nCe={[jP.variable]:"colors.white",bg:jP.reference,[eCe.variable]:jP.reference,[Sq.variable]:"colors.gray.200",_dark:{[jP.variable]:"colors.gray.700",[Sq.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},rCe={px:3,py:2,borderBottomWidth:"1px"},iCe={px:3,py:2},sCe={px:3,py:2,borderTopWidth:"1px"},oCe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},aCe=ZTe({popper:tCe,content:nCe,header:rCe,body:iCe,footer:sCe,closeButton:oCe}),cCe=QTe({baseStyle:aCe}),{defineMultiStyleConfig:lCe,definePartsStyle:aC}=Qi(gSe.keys),uCe=n=>{const{colorScheme:e,theme:i,isIndeterminate:o,hasStripe:l}=n,u=Wn(gq(),gq("1rem","rgba(0,0,0,0.1)"))(n),f=Wn(`${e}.500`,`${e}.200`)(n),y=`linear-gradient(
    to right,
    transparent 0%,
    ${Lc(i,f)} 50%,
    transparent 100%
  )`;return{...!o&&l&&u,...o?{bgImage:y}:{bgColor:f}}},dCe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},hCe=n=>({bg:Wn("gray.100","whiteAlpha.300")(n)}),pCe=n=>({transitionProperty:"common",transitionDuration:"slow",...uCe(n)}),fCe=aC(n=>({label:dCe,filledTrack:pCe(n),track:hCe(n)})),mCe={xs:aC({track:{h:"1"}}),sm:aC({track:{h:"2"}}),md:aC({track:{h:"3"}}),lg:aC({track:{h:"4"}})},gCe=lCe({sizes:mCe,baseStyle:fCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:_Ce,definePartsStyle:_O}=Qi(_Se.keys),yCe=n=>{var i;const e=(i=Mc(yg.baseStyle,n))==null?void 0:i.control;return{...e,borderRadius:"full",_checked:{...e==null?void 0:e._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},ECe=_O(n=>{var e,i;return{label:(e=yg.baseStyle)==null?void 0:e.call(yg,n).label,container:(i=yg.baseStyle)==null?void 0:i.call(yg,n).container,control:yCe(n)}}),vCe={md:_O({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:_O({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:_O({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},SCe=_Ce({baseStyle:ECe,sizes:vCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:bCe,definePartsStyle:wCe}=Qi(ySe.keys),FP=Gn("select-bg");var EZ;const TCe={...(EZ=_i.baseStyle)==null?void 0:EZ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:FP.reference,[FP.variable]:"colors.white",_dark:{[FP.variable]:"colors.gray.700"},"> option, > optgroup":{bg:FP.reference}},CCe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},RCe=wCe({field:TCe,icon:CCe}),BP={paddingInlineEnd:"8"};var vZ,SZ,bZ,wZ,TZ,CZ,RZ,IZ;const ICe={lg:{...(vZ=_i.sizes)==null?void 0:vZ.lg,field:{...(SZ=_i.sizes)==null?void 0:SZ.lg.field,...BP}},md:{...(bZ=_i.sizes)==null?void 0:bZ.md,field:{...(wZ=_i.sizes)==null?void 0:wZ.md.field,...BP}},sm:{...(TZ=_i.sizes)==null?void 0:TZ.sm,field:{...(CZ=_i.sizes)==null?void 0:CZ.sm.field,...BP}},xs:{...(RZ=_i.sizes)==null?void 0:RZ.xs,field:{...(IZ=_i.sizes)==null?void 0:IZ.xs.field,...BP},icon:{insetEnd:"1"}}},ACe=bCe({baseStyle:RCe,sizes:ICe,variants:_i.variants,defaultProps:_i.defaultProps}),QM=Gn("skeleton-start-color"),ZM=Gn("skeleton-end-color"),PCe={[QM.variable]:"colors.gray.100",[ZM.variable]:"colors.gray.400",_dark:{[QM.variable]:"colors.gray.800",[ZM.variable]:"colors.gray.600"},background:QM.reference,borderColor:ZM.reference,opacity:.7,borderRadius:"sm"},OCe={baseStyle:PCe},eU=Gn("skip-link-bg"),kCe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[eU.variable]:"colors.white",_dark:{[eU.variable]:"colors.gray.700"},bg:eU.reference}},NCe={baseStyle:kCe},{defineMultiStyleConfig:xCe,definePartsStyle:Hk}=Qi(ESe.keys),Yy=Gn("slider-thumb-size"),XC=Gn("slider-track-size"),Eg=Gn("slider-bg"),DCe=n=>{const{orientation:e}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...G5({orientation:e,vertical:{h:"100%",px:Pf(Yy.reference).divide(2).toString()},horizontal:{w:"100%",py:Pf(Yy.reference).divide(2).toString()}})}},LCe=n=>({...G5({orientation:n.orientation,horizontal:{h:XC.reference},vertical:{w:XC.reference}}),overflow:"hidden",borderRadius:"sm",[Eg.variable]:"colors.gray.200",_dark:{[Eg.variable]:"colors.whiteAlpha.200"},_disabled:{[Eg.variable]:"colors.gray.300",_dark:{[Eg.variable]:"colors.whiteAlpha.300"}},bg:Eg.reference}),MCe=n=>{const{orientation:e}=n;return{...G5({orientation:e,vertical:{left:"50%"},horizontal:{top:"50%"}}),w:Yy.reference,h:Yy.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_active:{"--slider-thumb-scale":"1.15"},_disabled:{bg:"gray.300"}}},UCe=n=>{const{colorScheme:e}=n;return{width:"inherit",height:"inherit",[Eg.variable]:`colors.${e}.500`,_dark:{[Eg.variable]:`colors.${e}.200`},bg:Eg.reference}},VCe=Hk(n=>({container:DCe(n),track:LCe(n),thumb:MCe(n),filledTrack:UCe(n)})),jCe=Hk({container:{[Yy.variable]:"sizes.4",[XC.variable]:"sizes.1"}}),FCe=Hk({container:{[Yy.variable]:"sizes.3.5",[XC.variable]:"sizes.1"}}),BCe=Hk({container:{[Yy.variable]:"sizes.2.5",[XC.variable]:"sizes.0.5"}}),zCe={lg:jCe,md:FCe,sm:BCe},WCe=xCe({baseStyle:VCe,sizes:zCe,defaultProps:{size:"md",colorScheme:"blue"}}),Ay=Qo("spinner-size"),GCe={width:[Ay.reference],height:[Ay.reference]},HCe={xs:{[Ay.variable]:"sizes.3"},sm:{[Ay.variable]:"sizes.4"},md:{[Ay.variable]:"sizes.6"},lg:{[Ay.variable]:"sizes.8"},xl:{[Ay.variable]:"sizes.12"}},$Ce={baseStyle:GCe,sizes:HCe,defaultProps:{size:"md"}},{defineMultiStyleConfig:KCe,definePartsStyle:See}=Qi(vSe.keys),qCe={fontWeight:"medium"},YCe={opacity:.8,marginBottom:"2"},XCe={verticalAlign:"baseline",fontWeight:"semibold"},JCe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},QCe=See({container:{},label:qCe,helpText:YCe,number:XCe,icon:JCe}),ZCe={md:See({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},eRe=KCe({baseStyle:QCe,sizes:ZCe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:tRe,definePartsStyle:cC}=Qi(["stepper","step","title","description","indicator","separator","icon","number"]),kf=Gn("stepper-indicator-size"),W0=Gn("stepper-icon-size"),G0=Gn("stepper-title-font-size"),lC=Gn("stepper-description-font-size"),GT=Gn("stepper-accent-color"),nRe=cC(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[GT.variable]:`colors.${n}.500`,_dark:{[GT.variable]:`colors.${n}.200`}},title:{fontSize:G0.reference,fontWeight:"medium"},description:{fontSize:lC.reference,color:"chakra-subtle-text"},number:{fontSize:G0.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:W0.reference,height:W0.reference},indicator:{flexShrink:0,borderRadius:"full",width:kf.reference,height:kf.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:GT.reference},"&[data-status=complete]":{bg:GT.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:GT.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${kf.reference} - 8px)`,top:`calc(${kf.reference} + 4px)`,insetStart:`calc(${kf.reference} / 2 - 1px)`}}})),rRe=tRe({baseStyle:nRe,sizes:{xs:cC({stepper:{[kf.variable]:"sizes.4",[W0.variable]:"sizes.3",[G0.variable]:"fontSizes.xs",[lC.variable]:"fontSizes.xs"}}),sm:cC({stepper:{[kf.variable]:"sizes.6",[W0.variable]:"sizes.4",[G0.variable]:"fontSizes.sm",[lC.variable]:"fontSizes.xs"}}),md:cC({stepper:{[kf.variable]:"sizes.8",[W0.variable]:"sizes.5",[G0.variable]:"fontSizes.md",[lC.variable]:"fontSizes.sm"}}),lg:cC({stepper:{[kf.variable]:"sizes.10",[W0.variable]:"sizes.6",[G0.variable]:"fontSizes.lg",[lC.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:iRe,definePartsStyle:yO}=Qi(SSe.keys),PC=Qo("switch-track-width"),jy=Qo("switch-track-height"),tU=Qo("switch-track-diff"),sRe=Of.subtract(PC,jy),mV=Qo("switch-thumb-x"),HT=Qo("switch-bg"),oRe=n=>{const{colorScheme:e}=n;return{borderRadius:"full",p:"0.5",width:[PC.reference],height:[jy.reference],transitionProperty:"common",transitionDuration:"fast",[HT.variable]:"colors.gray.300",_dark:{[HT.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[HT.variable]:`colors.${e}.500`,_dark:{[HT.variable]:`colors.${e}.200`}},bg:HT.reference}},aRe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[jy.reference],height:[jy.reference],_checked:{transform:`translateX(${mV.reference})`}},cRe=yO(n=>({container:{[tU.variable]:sRe,[mV.variable]:tU.reference,_rtl:{[mV.variable]:Of(tU).negate().toString()}},track:oRe(n),thumb:aRe})),lRe={sm:yO({container:{[PC.variable]:"1.375rem",[jy.variable]:"sizes.3"}}),md:yO({container:{[PC.variable]:"1.875rem",[jy.variable]:"sizes.4"}}),lg:yO({container:{[PC.variable]:"2.875rem",[jy.variable]:"sizes.6"}})},uRe=iRe({baseStyle:cRe,sizes:lRe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:dRe,definePartsStyle:sS}=Qi(bSe.keys),hRe=sS({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),XO={"&[data-is-numeric=true]":{textAlign:"end"}},pRe=sS(n=>{const{colorScheme:e}=n;return{th:{color:Wn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Wn(`${e}.100`,`${e}.700`)(n),...XO},td:{borderBottom:"1px",borderColor:Wn(`${e}.100`,`${e}.700`)(n),...XO},caption:{color:Wn("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),fRe=sS(n=>{const{colorScheme:e}=n;return{th:{color:Wn("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Wn(`${e}.100`,`${e}.700`)(n),...XO},td:{borderBottom:"1px",borderColor:Wn(`${e}.100`,`${e}.700`)(n),...XO},caption:{color:Wn("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:Wn(`${e}.100`,`${e}.700`)(n)},td:{background:Wn(`${e}.100`,`${e}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),mRe={simple:pRe,striped:fRe,unstyled:{}},gRe={sm:sS({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:sS({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:sS({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},_Re=dRe({baseStyle:hRe,variants:mRe,sizes:gRe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),El=Gn("tabs-color"),uh=Gn("tabs-bg"),zP=Gn("tabs-border-color"),{defineMultiStyleConfig:yRe,definePartsStyle:Ap}=Qi(wSe.keys),ERe=n=>{const{orientation:e}=n;return{display:e==="vertical"?"flex":"block"}},vRe=n=>{const{isFitted:e}=n;return{flex:e?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},SRe=n=>{const{align:e="start",orientation:i}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[e],flexDirection:i==="vertical"?"column":"row"}},bRe={p:4},wRe=Ap(n=>({root:ERe(n),tab:vRe(n),tablist:SRe(n),tabpanel:bRe})),TRe={sm:Ap({tab:{py:1,px:4,fontSize:"sm"}}),md:Ap({tab:{fontSize:"md",py:2,px:4}}),lg:Ap({tab:{fontSize:"lg",py:3,px:4}})},CRe=Ap(n=>{const{colorScheme:e,orientation:i}=n,o=i==="vertical",l=o?"borderStart":"borderBottom",u=o?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[u]:"-2px",_selected:{[El.variable]:`colors.${e}.600`,_dark:{[El.variable]:`colors.${e}.300`},borderColor:"currentColor"},_active:{[uh.variable]:"colors.gray.200",_dark:{[uh.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:El.reference,bg:uh.reference}}}),RRe=Ap(n=>{const{colorScheme:e}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[zP.variable]:"transparent",_selected:{[El.variable]:`colors.${e}.600`,[zP.variable]:"colors.white",_dark:{[El.variable]:`colors.${e}.300`,[zP.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:zP.reference},color:El.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),IRe=Ap(n=>{const{colorScheme:e}=n;return{tab:{border:"1px solid",borderColor:"inherit",[uh.variable]:"colors.gray.50",_dark:{[uh.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[uh.variable]:"colors.white",[El.variable]:`colors.${e}.600`,_dark:{[uh.variable]:"colors.gray.800",[El.variable]:`colors.${e}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:El.reference,bg:uh.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),ARe=Ap(n=>{const{colorScheme:e,theme:i}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:Lc(i,`${e}.700`),bg:Lc(i,`${e}.100`)}}}}),PRe=Ap(n=>{const{colorScheme:e}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[El.variable]:"colors.gray.600",_dark:{[El.variable]:"inherit"},_selected:{[El.variable]:"colors.white",[uh.variable]:`colors.${e}.600`,_dark:{[El.variable]:"colors.gray.800",[uh.variable]:`colors.${e}.300`}},color:El.reference,bg:uh.reference}}}),ORe=Ap({}),kRe={line:CRe,enclosed:RRe,"enclosed-colored":IRe,"soft-rounded":ARe,"solid-rounded":PRe,unstyled:ORe},NRe=yRe({baseStyle:wRe,sizes:TRe,variants:kRe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:xRe,definePartsStyle:Fy}=Qi(TSe.keys),bq=Gn("tag-bg"),wq=Gn("tag-color"),nU=Gn("tag-shadow"),EO=Gn("tag-min-height"),vO=Gn("tag-min-width"),SO=Gn("tag-font-size"),bO=Gn("tag-padding-inline"),DRe={fontWeight:"medium",lineHeight:1.2,outline:0,[wq.variable]:go.color.reference,[bq.variable]:go.bg.reference,[nU.variable]:go.shadow.reference,color:wq.reference,bg:bq.reference,boxShadow:nU.reference,borderRadius:"md",minH:EO.reference,minW:vO.reference,fontSize:SO.reference,px:bO.reference,_focusVisible:{[nU.variable]:"shadows.outline"}},LRe={lineHeight:1.2,overflow:"visible"},MRe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},URe=Fy({container:DRe,label:LRe,closeButton:MRe}),VRe={sm:Fy({container:{[EO.variable]:"sizes.5",[vO.variable]:"sizes.5",[SO.variable]:"fontSizes.xs",[bO.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:Fy({container:{[EO.variable]:"sizes.6",[vO.variable]:"sizes.6",[SO.variable]:"fontSizes.sm",[bO.variable]:"space.2"}}),lg:Fy({container:{[EO.variable]:"sizes.8",[vO.variable]:"sizes.8",[SO.variable]:"fontSizes.md",[bO.variable]:"space.3"}})},jRe={subtle:Fy(n=>{var e;return{container:(e=RC.variants)==null?void 0:e.subtle(n)}}),solid:Fy(n=>{var e;return{container:(e=RC.variants)==null?void 0:e.solid(n)}}),outline:Fy(n=>{var e;return{container:(e=RC.variants)==null?void 0:e.outline(n)}})},FRe=xRe({variants:jRe,baseStyle:URe,sizes:VRe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var AZ;const BRe={...(AZ=_i.baseStyle)==null?void 0:AZ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var PZ;const zRe={outline:n=>{var e;return((e=_i.variants)==null?void 0:e.outline(n).field)??{}},flushed:n=>{var e;return((e=_i.variants)==null?void 0:e.flushed(n).field)??{}},filled:n=>{var e;return((e=_i.variants)==null?void 0:e.filled(n).field)??{}},unstyled:((PZ=_i.variants)==null?void 0:PZ.unstyled.field)??{}};var OZ,kZ,NZ,xZ;const WRe={xs:((OZ=_i.sizes)==null?void 0:OZ.xs.field)??{},sm:((kZ=_i.sizes)==null?void 0:kZ.sm.field)??{},md:((NZ=_i.sizes)==null?void 0:NZ.md.field)??{},lg:((xZ=_i.sizes)==null?void 0:xZ.lg.field)??{}},GRe={baseStyle:BRe,sizes:WRe,variants:zRe,defaultProps:{size:"md",variant:"outline"}},WP=Qo("tooltip-bg"),rU=Qo("tooltip-fg"),HRe=Qo("popper-arrow-bg"),$Re={bg:WP.reference,color:rU.reference,[WP.variable]:"colors.gray.700",[rU.variable]:"colors.whiteAlpha.900",_dark:{[WP.variable]:"colors.gray.300",[rU.variable]:"colors.gray.900"},[HRe.variable]:WP.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},KRe={baseStyle:$Re},qRe={Accordion:xSe,Alert:gbe,Avatar:Ibe,Badge:RC,Breadcrumb:Ube,Button:$be,Checkbox:yg,CloseButton:awe,Code:dwe,Container:pwe,Divider:ywe,Drawer:Pwe,Editable:Mwe,Form:zwe,FormError:qwe,FormLabel:Xwe,Heading:Zwe,Input:_i,Kbd:lTe,Link:dTe,List:gTe,Menu:ITe,Modal:VTe,NumberInput:KTe,PinInput:JTe,Popover:cCe,Progress:gCe,Radio:SCe,Select:ACe,Skeleton:OCe,SkipLink:NCe,Slider:WCe,Spinner:$Ce,Stat:eRe,Switch:uRe,Table:_Re,Tabs:NRe,Tag:FRe,Textarea:GRe,Tooltip:KRe,Card:Jbe,Stepper:rRe},YRe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},XRe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},JRe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},QRe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},ZRe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},eIe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},tIe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},nIe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},rIe={property:eIe,easing:tIe,duration:nIe},iIe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},sIe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},oIe={breakpoints:XRe,zIndices:iIe,radii:QRe,blur:sIe,colors:JRe,...yee,sizes:hee,shadows:ZRe,space:dee,borders:YRe,transition:rIe},aIe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},cIe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},lIe="ltr",uIe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},dIe={semanticTokens:aIe,direction:lIe,...oIe,components:qRe,styles:cIe,config:uIe};function hIe(n){if(n.sheet)return n.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===n)return document.styleSheets[e]}function pIe(n){var e=document.createElement("style");return e.setAttribute("data-emotion",n.key),n.nonce!==void 0&&e.setAttribute("nonce",n.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var fIe=(function(){function n(i){var o=this;this._insertTag=function(l){var u;o.tags.length===0?o.insertionPoint?u=o.insertionPoint.nextSibling:o.prepend?u=o.container.firstChild:u=o.before:u=o.tags[o.tags.length-1].nextSibling,o.container.insertBefore(l,u),o.tags.push(l)},this.isSpeedy=i.speedy===void 0?!0:i.speedy,this.tags=[],this.ctr=0,this.nonce=i.nonce,this.key=i.key,this.container=i.container,this.prepend=i.prepend,this.insertionPoint=i.insertionPoint,this.before=null}var e=n.prototype;return e.hydrate=function(o){o.forEach(this._insertTag)},e.insert=function(o){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(pIe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var u=hIe(l);try{u.insertRule(o,u.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(o));this.ctr++},e.flush=function(){this.tags.forEach(function(o){var l;return(l=o.parentNode)==null?void 0:l.removeChild(o)}),this.tags=[],this.ctr=0},n})(),cc="-ms-",JO="-moz-",fi="-webkit-",bee="comm",q5="rule",Y5="decl",mIe="@import",wee="@keyframes",gIe="@layer",_Ie=Math.abs,$k=String.fromCharCode,yIe=Object.assign;function EIe(n,e){return Va(n,0)^45?(((e<<2^Va(n,0))<<2^Va(n,1))<<2^Va(n,2))<<2^Va(n,3):0}function Tee(n){return n.trim()}function vIe(n,e){return(n=e.exec(n))?n[0]:n}function mi(n,e,i){return n.replace(e,i)}function gV(n,e){return n.indexOf(e)}function Va(n,e){return n.charCodeAt(e)|0}function JC(n,e,i){return n.slice(e,i)}function Ep(n){return n.length}function X5(n){return n.length}function GP(n,e){return e.push(n),n}function SIe(n,e){return n.map(e).join("")}var Kk=1,bS=1,Cee=0,Il=0,Io=0,HS="";function qk(n,e,i,o,l,u,f){return{value:n,root:e,parent:i,type:o,props:l,children:u,line:Kk,column:bS,length:f,return:""}}function $T(n,e){return yIe(qk("",null,null,"",null,null,0),n,{length:-n.length},e)}function bIe(){return Io}function wIe(){return Io=Il>0?Va(HS,--Il):0,bS--,Io===10&&(bS=1,Kk--),Io}function fu(){return Io=Il<Cee?Va(HS,Il++):0,bS++,Io===10&&(bS=1,Kk++),Io}function Pp(){return Va(HS,Il)}function wO(){return Il}function AR(n,e){return JC(HS,n,e)}function QC(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Ree(n){return Kk=bS=1,Cee=Ep(HS=n),Il=0,[]}function Iee(n){return HS="",n}function TO(n){return Tee(AR(Il-1,_V(n===91?n+2:n===40?n+1:n)))}function TIe(n){for(;(Io=Pp())&&Io<33;)fu();return QC(n)>2||QC(Io)>3?"":" "}function CIe(n,e){for(;--e&&fu()&&!(Io<48||Io>102||Io>57&&Io<65||Io>70&&Io<97););return AR(n,wO()+(e<6&&Pp()==32&&fu()==32))}function _V(n){for(;fu();)switch(Io){case n:return Il;case 34:case 39:n!==34&&n!==39&&_V(Io);break;case 40:n===41&&_V(n);break;case 92:fu();break}return Il}function RIe(n,e){for(;fu()&&n+Io!==57;)if(n+Io===84&&Pp()===47)break;return"/*"+AR(e,Il-1)+"*"+$k(n===47?n:fu())}function IIe(n){for(;!QC(Pp());)fu();return AR(n,Il)}function AIe(n){return Iee(CO("",null,null,null,[""],n=Ree(n),0,[0],n))}function CO(n,e,i,o,l,u,f,y,v){for(var b=0,C=0,R=f,O=0,L=0,D=0,U=1,B=1,Y=1,W=0,ne="",le=l,re=u,me=o,q=ne;B;)switch(D=W,W=fu()){case 40:if(D!=108&&Va(q,R-1)==58){gV(q+=mi(TO(W),"&","&\f"),"&\f")!=-1&&(Y=-1);break}case 34:case 39:case 91:q+=TO(W);break;case 9:case 10:case 13:case 32:q+=TIe(D);break;case 92:q+=CIe(wO()-1,7);continue;case 47:switch(Pp()){case 42:case 47:GP(PIe(RIe(fu(),wO()),e,i),v);break;default:q+="/"}break;case 123*U:y[b++]=Ep(q)*Y;case 125*U:case 59:case 0:switch(W){case 0:case 125:B=0;case 59+C:Y==-1&&(q=mi(q,/\f/g,"")),L>0&&Ep(q)-R&&GP(L>32?Cq(q+";",o,i,R-1):Cq(mi(q," ","")+";",o,i,R-2),v);break;case 59:q+=";";default:if(GP(me=Tq(q,e,i,b,C,l,y,ne,le=[],re=[],R),u),W===123)if(C===0)CO(q,e,me,me,le,u,R,y,re);else switch(O===99&&Va(q,3)===110?100:O){case 100:case 108:case 109:case 115:CO(n,me,me,o&&GP(Tq(n,me,me,0,0,l,y,ne,l,le=[],R),re),l,re,R,y,o?le:re);break;default:CO(q,me,me,me,[""],re,0,y,re)}}b=C=L=0,U=Y=1,ne=q="",R=f;break;case 58:R=1+Ep(q),L=D;default:if(U<1){if(W==123)--U;else if(W==125&&U++==0&&wIe()==125)continue}switch(q+=$k(W),W*U){case 38:Y=C>0?1:(q+="\f",-1);break;case 44:y[b++]=(Ep(q)-1)*Y,Y=1;break;case 64:Pp()===45&&(q+=TO(fu())),O=Pp(),C=R=Ep(ne=q+=IIe(wO())),W++;break;case 45:D===45&&Ep(q)==2&&(U=0)}}return u}function Tq(n,e,i,o,l,u,f,y,v,b,C){for(var R=l-1,O=l===0?u:[""],L=X5(O),D=0,U=0,B=0;D<o;++D)for(var Y=0,W=JC(n,R+1,R=_Ie(U=f[D])),ne=n;Y<L;++Y)(ne=Tee(U>0?O[Y]+" "+W:mi(W,/&\f/g,O[Y])))&&(v[B++]=ne);return qk(n,e,i,l===0?q5:y,v,b,C)}function PIe(n,e,i){return qk(n,e,i,bee,$k(bIe()),JC(n,2,-2),0)}function Cq(n,e,i,o){return qk(n,e,i,Y5,JC(n,0,o),JC(n,o+1,-1),o)}function oS(n,e){for(var i="",o=X5(n),l=0;l<o;l++)i+=e(n[l],l,n,e)||"";return i}function OIe(n,e,i,o){switch(n.type){case gIe:if(n.children.length)break;case mIe:case Y5:return n.return=n.return||n.value;case bee:return"";case wee:return n.return=n.value+"{"+oS(n.children,o)+"}";case q5:n.value=n.props.join(",")}return Ep(i=oS(n.children,o))?n.return=n.value+"{"+i+"}":""}function kIe(n){var e=X5(n);return function(i,o,l,u){for(var f="",y=0;y<e;y++)f+=n[y](i,o,l,u)||"";return f}}function NIe(n){return function(e){e.root||(e=e.return)&&n(e)}}var Rq=function(e){var i=new WeakMap;return function(o){if(i.has(o))return i.get(o);var l=e(o);return i.set(o,l),l}};function Aee(n){var e=Object.create(null);return function(i){return e[i]===void 0&&(e[i]=n(i)),e[i]}}var xIe=function(e,i,o){for(var l=0,u=0;l=u,u=Pp(),l===38&&u===12&&(i[o]=1),!QC(u);)fu();return AR(e,Il)},DIe=function(e,i){var o=-1,l=44;do switch(QC(l)){case 0:l===38&&Pp()===12&&(i[o]=1),e[o]+=xIe(Il-1,i,o);break;case 2:e[o]+=TO(l);break;case 4:if(l===44){e[++o]=Pp()===58?"&\f":"",i[o]=e[o].length;break}default:e[o]+=$k(l)}while(l=fu());return e},LIe=function(e,i){return Iee(DIe(Ree(e),i))},Iq=new WeakMap,MIe=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var i=e.value,o=e.parent,l=e.column===o.column&&e.line===o.line;o.type!=="rule";)if(o=o.parent,!o)return;if(!(e.props.length===1&&i.charCodeAt(0)!==58&&!Iq.get(o))&&!l){Iq.set(e,!0);for(var u=[],f=LIe(i,u),y=o.props,v=0,b=0;v<f.length;v++)for(var C=0;C<y.length;C++,b++)e.props[b]=u[v]?f[v].replace(/&\f/g,y[C]):y[C]+" "+f[v]}}},UIe=function(e){if(e.type==="decl"){var i=e.value;i.charCodeAt(0)===108&&i.charCodeAt(2)===98&&(e.return="",e.value="")}};function Pee(n,e){switch(EIe(n,e)){case 5103:return fi+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return fi+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return fi+n+JO+n+cc+n+n;case 6828:case 4268:return fi+n+cc+n+n;case 6165:return fi+n+cc+"flex-"+n+n;case 5187:return fi+n+mi(n,/(\w+).+(:[^]+)/,fi+"box-$1$2"+cc+"flex-$1$2")+n;case 5443:return fi+n+cc+"flex-item-"+mi(n,/flex-|-self/,"")+n;case 4675:return fi+n+cc+"flex-line-pack"+mi(n,/align-content|flex-|-self/,"")+n;case 5548:return fi+n+cc+mi(n,"shrink","negative")+n;case 5292:return fi+n+cc+mi(n,"basis","preferred-size")+n;case 6060:return fi+"box-"+mi(n,"-grow","")+fi+n+cc+mi(n,"grow","positive")+n;case 4554:return fi+mi(n,/([^-])(transform)/g,"$1"+fi+"$2")+n;case 6187:return mi(mi(mi(n,/(zoom-|grab)/,fi+"$1"),/(image-set)/,fi+"$1"),n,"")+n;case 5495:case 3959:return mi(n,/(image-set\([^]*)/,fi+"$1$`$1");case 4968:return mi(mi(n,/(.+:)(flex-)?(.*)/,fi+"box-pack:$3"+cc+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+fi+n+n;case 4095:case 3583:case 4068:case 2532:return mi(n,/(.+)-inline(.+)/,fi+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Ep(n)-1-e>6)switch(Va(n,e+1)){case 109:if(Va(n,e+4)!==45)break;case 102:return mi(n,/(.+:)(.+)-([^]+)/,"$1"+fi+"$2-$3$1"+JO+(Va(n,e+3)==108?"$3":"$2-$3"))+n;case 115:return~gV(n,"stretch")?Pee(mi(n,"stretch","fill-available"),e)+n:n}break;case 4949:if(Va(n,e+1)!==115)break;case 6444:switch(Va(n,Ep(n)-3-(~gV(n,"!important")&&10))){case 107:return mi(n,":",":"+fi)+n;case 101:return mi(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+fi+(Va(n,14)===45?"inline-":"")+"box$3$1"+fi+"$2$3$1"+cc+"$2box$3")+n}break;case 5936:switch(Va(n,e+11)){case 114:return fi+n+cc+mi(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return fi+n+cc+mi(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return fi+n+cc+mi(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return fi+n+cc+n+n}return n}var VIe=function(e,i,o,l){if(e.length>-1&&!e.return)switch(e.type){case Y5:e.return=Pee(e.value,e.length);break;case wee:return oS([$T(e,{value:mi(e.value,"@","@"+fi)})],l);case q5:if(e.length)return SIe(e.props,function(u){switch(vIe(u,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return oS([$T(e,{props:[mi(u,/:(read-\w+)/,":"+JO+"$1")]})],l);case"::placeholder":return oS([$T(e,{props:[mi(u,/:(plac\w+)/,":"+fi+"input-$1")]}),$T(e,{props:[mi(u,/:(plac\w+)/,":"+JO+"$1")]}),$T(e,{props:[mi(u,/:(plac\w+)/,cc+"input-$1")]})],l)}return""})}},jIe=[VIe],FIe=function(e){var i=e.key;if(i==="css"){var o=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(o,function(U){var B=U.getAttribute("data-emotion");B.indexOf(" ")!==-1&&(document.head.appendChild(U),U.setAttribute("data-s",""))})}var l=e.stylisPlugins||jIe,u={},f,y=[];f=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+i+' "]'),function(U){for(var B=U.getAttribute("data-emotion").split(" "),Y=1;Y<B.length;Y++)u[B[Y]]=!0;y.push(U)});var v,b=[MIe,UIe];{var C,R=[OIe,NIe(function(U){C.insert(U)})],O=kIe(b.concat(l,R)),L=function(B){return oS(AIe(B),O)};v=function(B,Y,W,ne){C=W,L(B?B+"{"+Y.styles+"}":Y.styles),ne&&(D.inserted[Y.name]=!0)}}var D={key:i,sheet:new fIe({key:i,container:f,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:u,registered:{},insert:v};return D.sheet.hydrate(y),D};function Xy(){return Xy=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)({}).hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},Xy.apply(null,arguments)}var iU={exports:{}},Si={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Aq;function BIe(){if(Aq)return Si;Aq=1;var n=typeof Symbol=="function"&&Symbol.for,e=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,o=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,u=n?Symbol.for("react.profiler"):60114,f=n?Symbol.for("react.provider"):60109,y=n?Symbol.for("react.context"):60110,v=n?Symbol.for("react.async_mode"):60111,b=n?Symbol.for("react.concurrent_mode"):60111,C=n?Symbol.for("react.forward_ref"):60112,R=n?Symbol.for("react.suspense"):60113,O=n?Symbol.for("react.suspense_list"):60120,L=n?Symbol.for("react.memo"):60115,D=n?Symbol.for("react.lazy"):60116,U=n?Symbol.for("react.block"):60121,B=n?Symbol.for("react.fundamental"):60117,Y=n?Symbol.for("react.responder"):60118,W=n?Symbol.for("react.scope"):60119;function ne(re){if(typeof re=="object"&&re!==null){var me=re.$$typeof;switch(me){case e:switch(re=re.type,re){case v:case b:case o:case u:case l:case R:return re;default:switch(re=re&&re.$$typeof,re){case y:case C:case D:case L:case f:return re;default:return me}}case i:return me}}}function le(re){return ne(re)===b}return Si.AsyncMode=v,Si.ConcurrentMode=b,Si.ContextConsumer=y,Si.ContextProvider=f,Si.Element=e,Si.ForwardRef=C,Si.Fragment=o,Si.Lazy=D,Si.Memo=L,Si.Portal=i,Si.Profiler=u,Si.StrictMode=l,Si.Suspense=R,Si.isAsyncMode=function(re){return le(re)||ne(re)===v},Si.isConcurrentMode=le,Si.isContextConsumer=function(re){return ne(re)===y},Si.isContextProvider=function(re){return ne(re)===f},Si.isElement=function(re){return typeof re=="object"&&re!==null&&re.$$typeof===e},Si.isForwardRef=function(re){return ne(re)===C},Si.isFragment=function(re){return ne(re)===o},Si.isLazy=function(re){return ne(re)===D},Si.isMemo=function(re){return ne(re)===L},Si.isPortal=function(re){return ne(re)===i},Si.isProfiler=function(re){return ne(re)===u},Si.isStrictMode=function(re){return ne(re)===l},Si.isSuspense=function(re){return ne(re)===R},Si.isValidElementType=function(re){return typeof re=="string"||typeof re=="function"||re===o||re===b||re===u||re===l||re===R||re===O||typeof re=="object"&&re!==null&&(re.$$typeof===D||re.$$typeof===L||re.$$typeof===f||re.$$typeof===y||re.$$typeof===C||re.$$typeof===B||re.$$typeof===Y||re.$$typeof===W||re.$$typeof===U)},Si.typeOf=ne,Si}var Pq;function zIe(){return Pq||(Pq=1,iU.exports=BIe()),iU.exports}var sU,Oq;function WIe(){if(Oq)return sU;Oq=1;var n=zIe(),e={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},u={};u[n.ForwardRef]=o,u[n.Memo]=l;function f(D){return n.isMemo(D)?l:u[D.$$typeof]||e}var y=Object.defineProperty,v=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,C=Object.getOwnPropertyDescriptor,R=Object.getPrototypeOf,O=Object.prototype;function L(D,U,B){if(typeof U!="string"){if(O){var Y=R(U);Y&&Y!==O&&L(D,Y,B)}var W=v(U);b&&(W=W.concat(b(U)));for(var ne=f(D),le=f(U),re=0;re<W.length;++re){var me=W[re];if(!i[me]&&!(B&&B[me])&&!(le&&le[me])&&!(ne&&ne[me])){var q=C(U,me);try{y(D,me,q)}catch{}}}}return D}return sU=L,sU}var GIe=WIe();const HIe=Hg(GIe);var $Ie=!0;function Oee(n,e,i){var o="";return i.split(" ").forEach(function(l){n[l]!==void 0?e.push(n[l]+";"):l&&(o+=l+" ")}),o}var J5=function(e,i,o){var l=e.key+"-"+i.name;(o===!1||$Ie===!1)&&e.registered[l]===void 0&&(e.registered[l]=i.styles)},Q5=function(e,i,o){J5(e,i,o);var l=e.key+"-"+i.name;if(e.inserted[i.name]===void 0){var u=i;do e.insert(i===u?"."+l:"",u,e.sheet,!0),u=u.next;while(u!==void 0)}};function KIe(n){for(var e=0,i,o=0,l=n.length;l>=4;++o,l-=4)i=n.charCodeAt(o)&255|(n.charCodeAt(++o)&255)<<8|(n.charCodeAt(++o)&255)<<16|(n.charCodeAt(++o)&255)<<24,i=(i&65535)*1540483477+((i>>>16)*59797<<16),i^=i>>>24,e=(i&65535)*1540483477+((i>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(l){case 3:e^=(n.charCodeAt(o+2)&255)<<16;case 2:e^=(n.charCodeAt(o+1)&255)<<8;case 1:e^=n.charCodeAt(o)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var qIe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},YIe=/[A-Z]|^ms/g,XIe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,kee=function(e){return e.charCodeAt(1)===45},kq=function(e){return e!=null&&typeof e!="boolean"},oU=Aee(function(n){return kee(n)?n:n.replace(YIe,"-$&").toLowerCase()}),Nq=function(e,i){switch(e){case"animation":case"animationName":if(typeof i=="string")return i.replace(XIe,function(o,l,u){return vp={name:l,styles:u,next:vp},l})}return qIe[e]!==1&&!kee(e)&&typeof i=="number"&&i!==0?i+"px":i};function ZC(n,e,i){if(i==null)return"";var o=i;if(o.__emotion_styles!==void 0)return o;switch(typeof i){case"boolean":return"";case"object":{var l=i;if(l.anim===1)return vp={name:l.name,styles:l.styles,next:vp},l.name;var u=i;if(u.styles!==void 0){var f=u.next;if(f!==void 0)for(;f!==void 0;)vp={name:f.name,styles:f.styles,next:vp},f=f.next;var y=u.styles+";";return y}return JIe(n,e,i)}case"function":{if(n!==void 0){var v=vp,b=i(n);return vp=v,ZC(n,e,b)}break}}var C=i;if(e==null)return C;var R=e[C];return R!==void 0?R:C}function JIe(n,e,i){var o="";if(Array.isArray(i))for(var l=0;l<i.length;l++)o+=ZC(n,e,i[l])+";";else for(var u in i){var f=i[u];if(typeof f!="object"){var y=f;e!=null&&e[y]!==void 0?o+=u+"{"+e[y]+"}":kq(y)&&(o+=oU(u)+":"+Nq(u,y)+";")}else if(Array.isArray(f)&&typeof f[0]=="string"&&(e==null||e[f[0]]===void 0))for(var v=0;v<f.length;v++)kq(f[v])&&(o+=oU(u)+":"+Nq(u,f[v])+";");else{var b=ZC(n,e,f);switch(u){case"animation":case"animationName":{o+=oU(u)+":"+b+";";break}default:o+=u+"{"+b+"}"}}}return o}var xq=/label:\s*([^\s;{]+)\s*(;|$)/g,vp;function Yk(n,e,i){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var o=!0,l="";vp=void 0;var u=n[0];if(u==null||u.raw===void 0)o=!1,l+=ZC(i,e,u);else{var f=u;l+=f[0]}for(var y=1;y<n.length;y++)if(l+=ZC(i,e,n[y]),o){var v=u;l+=v[y]}xq.lastIndex=0;for(var b="",C;(C=xq.exec(l))!==null;)b+="-"+C[1];var R=KIe(l)+b;return{name:R,styles:l,next:vp}}var QIe=function(e){return e()},Nee=WK.useInsertionEffect?WK.useInsertionEffect:!1,xee=Nee||QIe,Dq=Nee||k.useLayoutEffect,Z5=k.createContext(typeof HTMLElement<"u"?FIe({key:"css"}):null);Z5.Provider;var ZIe=function(){return k.useContext(Z5)},e3=function(e){return k.forwardRef(function(i,o){var l=k.useContext(Z5);return e(i,l,o)})},wS=k.createContext({}),eAe=function(e,i){if(typeof i=="function"){var o=i(e);return o}return Xy({},e,i)},tAe=Rq(function(n){return Rq(function(e){return eAe(n,e)})}),nAe=function(e){var i=k.useContext(wS);return e.theme!==i&&(i=tAe(i)(e.theme)),k.createElement(wS.Provider,{value:i},e.children)},t3={}.hasOwnProperty,yV="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",rAe=function(e,i){var o={};for(var l in i)t3.call(i,l)&&(o[l]=i[l]);return o[yV]=e,o},iAe=function(e){var i=e.cache,o=e.serialized,l=e.isStringTag;return J5(i,o,l),xee(function(){return Q5(i,o,l)}),null},sAe=e3(function(n,e,i){var o=n.css;typeof o=="string"&&e.registered[o]!==void 0&&(o=e.registered[o]);var l=n[yV],u=[o],f="";typeof n.className=="string"?f=Oee(e.registered,u,n.className):n.className!=null&&(f=n.className+" ");var y=Yk(u,void 0,k.useContext(wS));f+=e.key+"-"+y.name;var v={};for(var b in n)t3.call(n,b)&&b!=="css"&&b!==yV&&(v[b]=n[b]);return v.className=f,i&&(v.ref=i),k.createElement(k.Fragment,null,k.createElement(iAe,{cache:e,serialized:y,isStringTag:typeof l=="string"}),k.createElement(l,v))}),oAe=sAe,Lq=function(e,i){var o=arguments;if(i==null||!t3.call(i,"css"))return k.createElement.apply(void 0,o);var l=o.length,u=new Array(l);u[0]=oAe,u[1]=rAe(e,i);for(var f=2;f<l;f++)u[f]=o[f];return k.createElement.apply(null,u)};(function(n){var e;e||(e=n.JSX||(n.JSX={}))})(Lq||(Lq={}));var Xk=e3(function(n,e){var i=n.styles,o=Yk([i],void 0,k.useContext(wS)),l=k.useRef();return Dq(function(){var u=e.key+"-global",f=new e.sheet.constructor({key:u,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),y=!1,v=document.querySelector('style[data-emotion="'+u+" "+o.name+'"]');return e.sheet.tags.length&&(f.before=e.sheet.tags[0]),v!==null&&(y=!0,v.setAttribute("data-emotion",u),f.hydrate([v])),l.current=[f,y],function(){f.flush()}},[e]),Dq(function(){var u=l.current,f=u[0],y=u[1];if(y){u[1]=!1;return}if(o.next!==void 0&&Q5(e,o.next,!0),f.tags.length){var v=f.tags[f.tags.length-1].nextElementSibling;f.before=v,f.flush()}e.insert("",o,f,!1)},[e,o.name]),null});function aAe(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return Yk(e)}function PR(){var n=aAe.apply(void 0,arguments),e="animation-"+n.name;return{name:e,styles:"@keyframes "+e+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const n3=k.createContext({});n3.displayName="ColorModeContext";function Jk(){const n=k.useContext(n3);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function Rg(n,e){const{colorMode:i}=Jk();return i==="dark"?e:n}const HP={light:"chakra-ui-light",dark:"chakra-ui-dark"};function cAe(n={}){const{preventTransition:e=!0,nonce:i}=n,o={setDataset:l=>{const u=e?o.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,u==null||u()},setClassName(l){document.body.classList.add(l?HP.dark:HP.light),document.body.classList.remove(l?HP.light:HP.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return o.query().matches??l==="dark"?"dark":"light"},addListener(l){const u=o.query(),f=y=>{l(y.matches?"dark":"light")};return typeof u.addListener=="function"?u.addListener(f):u.addEventListener("change",f),()=>{typeof u.removeListener=="function"?u.removeListener(f):u.removeEventListener("change",f)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),i!==void 0&&(l.nonce=i),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return o}const lAe="chakra-ui-color-mode";function uAe(n){return{ssr:!1,type:"localStorage",get(e){if(!(globalThis!=null&&globalThis.document))return e;let i;try{i=localStorage.getItem(n)||e}catch{}return i||e},set(e){try{localStorage.setItem(n,e)}catch{}}}}const dAe=uAe(lAe),Mq=()=>{},hAe=AEe()?k.useLayoutEffect:k.useEffect;function Uq(n,e){return n.type==="cookie"&&n.ssr?n.get(e):e}const Dee=function(e){const{value:i,children:o,options:{useSystemColorMode:l,initialColorMode:u,disableTransitionOnChange:f}={},colorModeManager:y=dAe}=e,v=ZIe(),b=u==="dark"?"dark":"light",[C,R]=k.useState(()=>Uq(y,b)),[O,L]=k.useState(()=>Uq(y)),{getSystemTheme:D,setClassName:U,setDataset:B,addListener:Y}=k.useMemo(()=>cAe({preventTransition:f,nonce:v==null?void 0:v.nonce}),[f,v==null?void 0:v.nonce]),W=u==="system"&&!C?O:C,ne=k.useCallback(me=>{const q=me==="system"?D():me;R(q),U(q==="dark"),B(q),y.set(q)},[y,D,U,B]);hAe(()=>{u==="system"&&L(D())},[]),k.useEffect(()=>{const me=y.get();if(me){ne(me);return}if(u==="system"){ne("system");return}ne(b)},[y,b,u,ne]);const le=k.useCallback(()=>{ne(W==="dark"?"light":"dark")},[W,ne]);k.useEffect(()=>{if(l)return Y(ne)},[l,Y,ne]);const re=k.useMemo(()=>({colorMode:i??W,toggleColorMode:i?Mq:le,setColorMode:i?Mq:ne,forced:i!==void 0}),[W,le,ne,i]);return S.jsx(n3.Provider,{value:re,children:o})};Dee.displayName="ColorModeProvider";const Lee=String.raw,Mee=Lee`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,pAe=()=>S.jsx(Xk,{styles:Mee}),fAe=({scope:n=""})=>S.jsx(Xk,{styles:Lee`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${Mee}
    `});function mAe(n){const{cssVarsRoot:e,theme:i,children:o}=n,l=k.useMemo(()=>eSe(i),[i]);return S.jsxs(nAe,{theme:l,children:[S.jsx(gAe,{root:e}),o]})}function gAe({root:n=":host, :root"}){const e=[n,"[data-theme]"].join(",");return S.jsx(Xk,{styles:i=>({[e]:i.__cssVars})})}Ai({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function _Ae(){const{colorMode:n}=Jk();return S.jsx(Xk,{styles:e=>{const i=WZ(e,"styles.global"),o=bl(i,{theme:e,colorMode:n});return o?aee(o)(e):void 0}})}const[yAe,EAe]=Ai({strict:!1,name:"PortalManagerContext"});function r3(n){const{children:e,zIndex:i}=n;return S.jsx(yAe,{value:{zIndex:i},children:e})}r3.displayName="PortalManager";const i3=k.createContext({getDocument(){return document},getWindow(){return window}});i3.displayName="EnvironmentContext";function vAe({defer:n}={}){const[,e]=k.useReducer(i=>i+1,0);return Ip(()=>{n&&e()},[n]),k.useContext(i3)}function Uee(n){const{children:e,environment:i,disabled:o}=n,l=k.useRef(null),u=k.useMemo(()=>i||{getDocument:()=>{var y;return((y=l.current)==null?void 0:y.ownerDocument)??document},getWindow:()=>{var y;return((y=l.current)==null?void 0:y.ownerDocument.defaultView)??window}},[i]),f=!o||!i;return S.jsxs(i3.Provider,{value:u,children:[e,f&&S.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}Uee.displayName="EnvironmentProvider";const SAe=n=>{const{children:e,colorModeManager:i,portalZIndex:o,resetScope:l,resetCSS:u=!0,theme:f={},environment:y,cssVarsRoot:v,disableEnvironment:b,disableGlobalStyle:C}=n,R=S.jsx(Uee,{environment:y,disabled:b,children:e});return S.jsx(mAe,{theme:f,cssVarsRoot:v,children:S.jsxs(Dee,{colorModeManager:i,options:f.config,children:[u?S.jsx(fAe,{scope:l}):S.jsx(pAe,{}),!C&&S.jsx(_Ae,{}),o?S.jsx(r3,{zIndex:o,children:R}):R]})})},s3=k.createContext({});function o3(n){const e=k.useRef(null);return e.current===null&&(e.current=n()),e.current}const OR=k.createContext(null),a3=k.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class bAe extends k.Component{getSnapshotBeforeUpdate(e){const i=this.props.childRef.current;if(i&&e.isPresent&&!this.props.isPresent){const o=this.props.sizeRef.current;o.height=i.offsetHeight||0,o.width=i.offsetWidth||0,o.top=i.offsetTop,o.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function wAe({children:n,isPresent:e}){const i=k.useId(),o=k.useRef(null),l=k.useRef({width:0,height:0,top:0,left:0}),{nonce:u}=k.useContext(a3);return k.useInsertionEffect(()=>{const{width:f,height:y,top:v,left:b}=l.current;if(e||!o.current||!f||!y)return;o.current.dataset.motionPopId=i;const C=document.createElement("style");return u&&(C.nonce=u),document.head.appendChild(C),C.sheet&&C.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${y}px !important;
            top: ${v}px !important;
            left: ${b}px !important;
          }
        `),()=>{document.head.removeChild(C)}},[e]),S.jsx(bAe,{isPresent:e,childRef:o,sizeRef:l,children:k.cloneElement(n,{ref:o})})}const TAe=({children:n,initial:e,isPresent:i,onExitComplete:o,custom:l,presenceAffectsLayout:u,mode:f})=>{const y=o3(CAe),v=k.useId(),b=k.useCallback(R=>{y.set(R,!0);for(const O of y.values())if(!O)return;o&&o()},[y,o]),C=k.useMemo(()=>({id:v,initial:e,isPresent:i,custom:l,onExitComplete:b,register:R=>(y.set(R,!1),()=>y.delete(R))}),u?[Math.random(),b]:[i,b]);return k.useMemo(()=>{y.forEach((R,O)=>y.set(O,!1))},[i]),k.useEffect(()=>{!i&&!y.size&&o&&o()},[i]),f==="popLayout"&&(n=S.jsx(wAe,{isPresent:i,children:n})),S.jsx(OR.Provider,{value:C,children:n})};function CAe(){return new Map}function c3(n=!0){const e=k.useContext(OR);if(e===null)return[!0,null];const{isPresent:i,onExitComplete:o,register:l}=e,u=k.useId();k.useEffect(()=>{n&&l(u)},[n]);const f=k.useCallback(()=>n&&o&&o(u),[u,o,n]);return!i&&o?[!1,f]:[!0]}function RAe(){return IAe(k.useContext(OR))}function IAe(n){return n===null?!0:n.isPresent}const $P=n=>n.key||"";function Vq(n){const e=[];return k.Children.forEach(n,i=>{k.isValidElement(i)&&e.push(i)}),e}const l3=typeof window<"u",Vee=l3?k.useLayoutEffect:k.useEffect,lE=({children:n,custom:e,initial:i=!0,onExitComplete:o,presenceAffectsLayout:l=!0,mode:u="sync",propagate:f=!1})=>{const[y,v]=c3(f),b=k.useMemo(()=>Vq(n),[n]),C=f&&!y?[]:b.map($P),R=k.useRef(!0),O=k.useRef(b),L=o3(()=>new Map),[D,U]=k.useState(b),[B,Y]=k.useState(b);Vee(()=>{R.current=!1,O.current=b;for(let le=0;le<B.length;le++){const re=$P(B[le]);C.includes(re)?L.delete(re):L.get(re)!==!0&&L.set(re,!1)}},[B,C.length,C.join("-")]);const W=[];if(b!==D){let le=[...b];for(let re=0;re<B.length;re++){const me=B[re],q=$P(me);C.includes(q)||(le.splice(re,0,me),W.push(me))}u==="wait"&&W.length&&(le=W),Y(Vq(le)),U(b);return}const{forceRender:ne}=k.useContext(s3);return S.jsx(S.Fragment,{children:B.map(le=>{const re=$P(le),me=f&&!y?!1:b===B||C.includes(re),q=()=>{if(L.has(re))L.set(re,!0);else return;let J=!0;L.forEach(Q=>{Q||(J=!1)}),J&&(ne==null||ne(),Y(O.current),f&&(v==null||v()),o&&o())};return S.jsx(TAe,{isPresent:me,initial:!R.current||i?void 0:!1,custom:me?void 0:e,presenceAffectsLayout:l,mode:u,onExitComplete:me?void 0:q,children:le},re)})})},mu=n=>n;let jee=mu;function u3(n){let e;return()=>(e===void 0&&(e=n()),e)}const TS=(n,e,i)=>{const o=e-n;return o===0?1:(i-n)/o},Uf=n=>n*1e3,Vf=n=>n/1e3,AAe={useManualTiming:!1};function PAe(n){let e=new Set,i=new Set,o=!1,l=!1;const u=new WeakSet;let f={delta:0,timestamp:0,isProcessing:!1};function y(b){u.has(b)&&(v.schedule(b),n()),b(f)}const v={schedule:(b,C=!1,R=!1)=>{const L=R&&o?e:i;return C&&u.add(b),L.has(b)||L.add(b),b},cancel:b=>{i.delete(b),u.delete(b)},process:b=>{if(f=b,o){l=!0;return}o=!0,[e,i]=[i,e],e.forEach(y),e.clear(),o=!1,l&&(l=!1,v.process(b))}};return v}const KP=["read","resolveKeyframes","update","preRender","render","postRender"],OAe=40;function Fee(n,e){let i=!1,o=!0;const l={delta:0,timestamp:0,isProcessing:!1},u=()=>i=!0,f=KP.reduce((Y,W)=>(Y[W]=PAe(u),Y),{}),{read:y,resolveKeyframes:v,update:b,preRender:C,render:R,postRender:O}=f,L=()=>{const Y=performance.now();i=!1,l.delta=o?1e3/60:Math.max(Math.min(Y-l.timestamp,OAe),1),l.timestamp=Y,l.isProcessing=!0,y.process(l),v.process(l),b.process(l),C.process(l),R.process(l),O.process(l),l.isProcessing=!1,i&&e&&(o=!1,n(L))},D=()=>{i=!0,o=!0,l.isProcessing||n(L)};return{schedule:KP.reduce((Y,W)=>{const ne=f[W];return Y[W]=(le,re=!1,me=!1)=>(i||D(),ne.schedule(le,re,me)),Y},{}),cancel:Y=>{for(let W=0;W<KP.length;W++)f[KP[W]].cancel(Y)},state:l,steps:f}}const{schedule:cs,cancel:Dg,state:Ma,steps:aU}=Fee(typeof requestAnimationFrame<"u"?requestAnimationFrame:mu,!0),Bee=k.createContext({strict:!1}),jq={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},CS={};for(const n in jq)CS[n]={isEnabled:e=>jq[n].some(i=>!!e[i])};function kAe(n){for(const e in n)CS[e]={...CS[e],...n[e]}}const NAe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function QO(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||NAe.has(n)}let zee=n=>!QO(n);function xAe(n){n&&(zee=e=>e.startsWith("on")?!QO(e):n(e))}try{xAe(require("@emotion/is-prop-valid").default)}catch{}function DAe(n,e,i){const o={};for(const l in n)l==="values"&&typeof n.values=="object"||(zee(l)||i===!0&&QO(l)||!e&&!QO(l)||n.draggable&&l.startsWith("onDrag"))&&(o[l]=n[l]);return o}function LAe(n){if(typeof Proxy>"u")return n;const e=new Map,i=(...o)=>n(...o);return new Proxy(i,{get:(o,l)=>l==="create"?n:(e.has(l)||e.set(l,n(l)),e.get(l))})}const Qk=k.createContext({});function eR(n){return typeof n=="string"||Array.isArray(n)}function Zk(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const d3=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],h3=["initial",...d3];function eN(n){return Zk(n.animate)||h3.some(e=>eR(n[e]))}function Wee(n){return!!(eN(n)||n.variants)}function MAe(n,e){if(eN(n)){const{initial:i,animate:o}=n;return{initial:i===!1||eR(i)?i:void 0,animate:eR(o)?o:void 0}}return n.inherit!==!1?e:{}}function UAe(n){const{initial:e,animate:i}=MAe(n,k.useContext(Qk));return k.useMemo(()=>({initial:e,animate:i}),[Fq(e),Fq(i)])}function Fq(n){return Array.isArray(n)?n.join(" "):n}const VAe=Symbol.for("motionComponentSymbol");function H0(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function jAe(n,e,i){return k.useCallback(o=>{o&&n.onMount&&n.onMount(o),e&&(o?e.mount(o):e.unmount()),i&&(typeof i=="function"?i(o):H0(i)&&(i.current=o))},[e])}const p3=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),FAe="framerAppearId",Gee="data-"+p3(FAe),{schedule:f3}=Fee(queueMicrotask,!1),Hee=k.createContext({});function BAe(n,e,i,o,l){var u,f;const{visualElement:y}=k.useContext(Qk),v=k.useContext(Bee),b=k.useContext(OR),C=k.useContext(a3).reducedMotion,R=k.useRef(null);o=o||v.renderer,!R.current&&o&&(R.current=o(n,{visualState:e,parent:y,props:i,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:C}));const O=R.current,L=k.useContext(Hee);O&&!O.projection&&l&&(O.type==="html"||O.type==="svg")&&zAe(R.current,i,l,L);const D=k.useRef(!1);k.useInsertionEffect(()=>{O&&D.current&&O.update(i,b)});const U=i[Gee],B=k.useRef(!!U&&!(!((u=window.MotionHandoffIsComplete)===null||u===void 0)&&u.call(window,U))&&((f=window.MotionHasOptimisedAnimation)===null||f===void 0?void 0:f.call(window,U)));return Vee(()=>{O&&(D.current=!0,window.MotionIsMounted=!0,O.updateFeatures(),f3.render(O.render),B.current&&O.animationState&&O.animationState.animateChanges())}),k.useEffect(()=>{O&&(!B.current&&O.animationState&&O.animationState.animateChanges(),B.current&&(queueMicrotask(()=>{var Y;(Y=window.MotionHandoffMarkAsComplete)===null||Y===void 0||Y.call(window,U)}),B.current=!1))}),O}function zAe(n,e,i,o){const{layoutId:l,layout:u,drag:f,dragConstraints:y,layoutScroll:v,layoutRoot:b}=e;n.projection=new i(n.latestValues,e["data-framer-portal-id"]?void 0:$ee(n.parent)),n.projection.setOptions({layoutId:l,layout:u,alwaysMeasureLayout:!!f||y&&H0(y),visualElement:n,animationType:typeof u=="string"?u:"both",initialPromotionConfig:o,layoutScroll:v,layoutRoot:b})}function $ee(n){if(n)return n.options.allowProjection!==!1?n.projection:$ee(n.parent)}function WAe({preloadedFeatures:n,createVisualElement:e,useRender:i,useVisualState:o,Component:l}){var u,f;n&&kAe(n);function y(b,C){let R;const O={...k.useContext(a3),...b,layoutId:GAe(b)},{isStatic:L}=O,D=UAe(b),U=o(b,L);if(!L&&l3){HAe();const B=$Ae(O);R=B.MeasureLayout,D.visualElement=BAe(l,U,O,e,B.ProjectionNode)}return S.jsxs(Qk.Provider,{value:D,children:[R&&D.visualElement?S.jsx(R,{visualElement:D.visualElement,...O}):null,i(l,b,jAe(U,D.visualElement,C),U,L,D.visualElement)]})}y.displayName=`motion.${typeof l=="string"?l:`create(${(f=(u=l.displayName)!==null&&u!==void 0?u:l.name)!==null&&f!==void 0?f:""})`}`;const v=k.forwardRef(y);return v[VAe]=l,v}function GAe({layoutId:n}){const e=k.useContext(s3).id;return e&&n!==void 0?e+"-"+n:n}function HAe(n,e){k.useContext(Bee).strict}function $Ae(n){const{drag:e,layout:i}=CS;if(!e&&!i)return{};const o={...e,...i};return{MeasureLayout:e!=null&&e.isEnabled(n)||i!=null&&i.isEnabled(n)?o.MeasureLayout:void 0,ProjectionNode:o.ProjectionNode}}const KAe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function m3(n){return typeof n!="string"||n.includes("-")?!1:!!(KAe.indexOf(n)>-1||/[A-Z]/u.test(n))}function Bq(n){const e=[{},{}];return n==null||n.values.forEach((i,o)=>{e[0][o]=i.get(),e[1][o]=i.getVelocity()}),e}function g3(n,e,i,o){if(typeof e=="function"){const[l,u]=Bq(o);e=e(i!==void 0?i:n.custom,l,u)}if(typeof e=="string"&&(e=n.variants&&n.variants[e]),typeof e=="function"){const[l,u]=Bq(o);e=e(i!==void 0?i:n.custom,l,u)}return e}const EV=n=>Array.isArray(n),qAe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),YAe=n=>EV(n)?n[n.length-1]||0:n,pc=n=>!!(n&&n.getVelocity);function RO(n){const e=pc(n)?n.get():n;return qAe(e)?e.toValue():e}function XAe({scrapeMotionValuesFromProps:n,createRenderState:e,onUpdate:i},o,l,u){const f={latestValues:JAe(o,l,u,n),renderState:e()};return i&&(f.onMount=y=>i({props:o,current:y,...f}),f.onUpdate=y=>i(y)),f}const Kee=n=>(e,i)=>{const o=k.useContext(Qk),l=k.useContext(OR),u=()=>XAe(n,e,o,l);return i?u():o3(u)};function JAe(n,e,i,o){const l={},u=o(n,{});for(const O in u)l[O]=RO(u[O]);let{initial:f,animate:y}=n;const v=eN(n),b=Wee(n);e&&b&&!v&&n.inherit!==!1&&(f===void 0&&(f=e.initial),y===void 0&&(y=e.animate));let C=i?i.initial===!1:!1;C=C||f===!1;const R=C?y:f;if(R&&typeof R!="boolean"&&!Zk(R)){const O=Array.isArray(R)?R:[R];for(let L=0;L<O.length;L++){const D=g3(n,O[L]);if(D){const{transitionEnd:U,transition:B,...Y}=D;for(const W in Y){let ne=Y[W];if(Array.isArray(ne)){const le=C?ne.length-1:0;ne=ne[le]}ne!==null&&(l[W]=ne)}for(const W in U)l[W]=U[W]}}}return l}const $S=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],uE=new Set($S),qee=n=>e=>typeof e=="string"&&e.startsWith(n),Yee=qee("--"),QAe=qee("var(--"),_3=n=>QAe(n)?ZAe.test(n.split("/*")[0].trim()):!1,ZAe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Xee=(n,e)=>e&&typeof n=="number"?e.transform(n):n,Hf=(n,e,i)=>i>e?e:i<n?n:i,KS={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},tR={...KS,transform:n=>Hf(0,1,n)},qP={...KS,default:1},kR=n=>({test:e=>typeof e=="string"&&e.endsWith(n)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${n}`}),_g=kR("deg"),Op=kR("%"),Yn=kR("px"),e1e=kR("vh"),t1e=kR("vw"),zq={...Op,parse:n=>Op.parse(n)/100,transform:n=>Op.transform(n*100)},n1e={borderWidth:Yn,borderTopWidth:Yn,borderRightWidth:Yn,borderBottomWidth:Yn,borderLeftWidth:Yn,borderRadius:Yn,radius:Yn,borderTopLeftRadius:Yn,borderTopRightRadius:Yn,borderBottomRightRadius:Yn,borderBottomLeftRadius:Yn,width:Yn,maxWidth:Yn,height:Yn,maxHeight:Yn,top:Yn,right:Yn,bottom:Yn,left:Yn,padding:Yn,paddingTop:Yn,paddingRight:Yn,paddingBottom:Yn,paddingLeft:Yn,margin:Yn,marginTop:Yn,marginRight:Yn,marginBottom:Yn,marginLeft:Yn,backgroundPositionX:Yn,backgroundPositionY:Yn},r1e={rotate:_g,rotateX:_g,rotateY:_g,rotateZ:_g,scale:qP,scaleX:qP,scaleY:qP,scaleZ:qP,skew:_g,skewX:_g,skewY:_g,distance:Yn,translateX:Yn,translateY:Yn,translateZ:Yn,x:Yn,y:Yn,z:Yn,perspective:Yn,transformPerspective:Yn,opacity:tR,originX:zq,originY:zq,originZ:Yn},Wq={...KS,transform:Math.round},y3={...n1e,...r1e,zIndex:Wq,size:Yn,fillOpacity:tR,strokeOpacity:tR,numOctaves:Wq},i1e={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},s1e=$S.length;function o1e(n,e,i){let o="",l=!0;for(let u=0;u<s1e;u++){const f=$S[u],y=n[f];if(y===void 0)continue;let v=!0;if(typeof y=="number"?v=y===(f.startsWith("scale")?1:0):v=parseFloat(y)===0,!v||i){const b=Xee(y,y3[f]);if(!v){l=!1;const C=i1e[f]||f;o+=`${C}(${b}) `}i&&(e[f]=b)}}return o=o.trim(),i?o=i(e,l?"":o):l&&(o="none"),o}function E3(n,e,i){const{style:o,vars:l,transformOrigin:u}=n;let f=!1,y=!1;for(const v in e){const b=e[v];if(uE.has(v)){f=!0;continue}else if(Yee(v)){l[v]=b;continue}else{const C=Xee(b,y3[v]);v.startsWith("origin")?(y=!0,u[v]=C):o[v]=C}}if(e.transform||(f||i?o.transform=o1e(e,n.transform,i):o.transform&&(o.transform="none")),y){const{originX:v="50%",originY:b="50%",originZ:C=0}=u;o.transformOrigin=`${v} ${b} ${C}`}}const a1e={offset:"stroke-dashoffset",array:"stroke-dasharray"},c1e={offset:"strokeDashoffset",array:"strokeDasharray"};function l1e(n,e,i=1,o=0,l=!0){n.pathLength=1;const u=l?a1e:c1e;n[u.offset]=Yn.transform(-o);const f=Yn.transform(e),y=Yn.transform(i);n[u.array]=`${f} ${y}`}function Gq(n,e,i){return typeof n=="string"?n:Yn.transform(e+i*n)}function u1e(n,e,i){const o=Gq(e,n.x,n.width),l=Gq(i,n.y,n.height);return`${o} ${l}`}function v3(n,{attrX:e,attrY:i,attrScale:o,originX:l,originY:u,pathLength:f,pathSpacing:y=1,pathOffset:v=0,...b},C,R){if(E3(n,b,R),C){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:O,style:L,dimensions:D}=n;O.transform&&(D&&(L.transform=O.transform),delete O.transform),D&&(l!==void 0||u!==void 0||L.transform)&&(L.transformOrigin=u1e(D,l!==void 0?l:.5,u!==void 0?u:.5)),e!==void 0&&(O.x=e),i!==void 0&&(O.y=i),o!==void 0&&(O.scale=o),f!==void 0&&l1e(O,f,y,v,!1)}const S3=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),Jee=()=>({...S3(),attrs:{}}),b3=n=>typeof n=="string"&&n.toLowerCase()==="svg";function Qee(n,{style:e,vars:i},o,l){Object.assign(n.style,e,l&&l.getProjectionStyles(o));for(const u in i)n.style.setProperty(u,i[u])}const Zee=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function ete(n,e,i,o){Qee(n,e,void 0,o);for(const l in e.attrs)n.setAttribute(Zee.has(l)?l:p3(l),e.attrs[l])}const ZO={};function d1e(n){Object.assign(ZO,n)}function tte(n,{layout:e,layoutId:i}){return uE.has(n)||n.startsWith("origin")||(e||i!==void 0)&&(!!ZO[n]||n==="opacity")}function w3(n,e,i){var o;const{style:l}=n,u={};for(const f in l)(pc(l[f])||e.style&&pc(e.style[f])||tte(f,n)||((o=i==null?void 0:i.getValue(f))===null||o===void 0?void 0:o.liveStyle)!==void 0)&&(u[f]=l[f]);return u}function nte(n,e,i){const o=w3(n,e,i);for(const l in n)if(pc(n[l])||pc(e[l])){const u=$S.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;o[u]=n[l]}return o}function h1e(n,e){try{e.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{e.dimensions={x:0,y:0,width:0,height:0}}}const Hq=["x","y","width","height","cx","cy","r"],p1e={useVisualState:Kee({scrapeMotionValuesFromProps:nte,createRenderState:Jee,onUpdate:({props:n,prevProps:e,current:i,renderState:o,latestValues:l})=>{if(!i)return;let u=!!n.drag;if(!u){for(const y in l)if(uE.has(y)){u=!0;break}}if(!u)return;let f=!e;if(e)for(let y=0;y<Hq.length;y++){const v=Hq[y];n[v]!==e[v]&&(f=!0)}f&&cs.read(()=>{h1e(i,o),cs.render(()=>{v3(o,l,b3(i.tagName),n.transformTemplate),ete(i,o)})})}})},f1e={useVisualState:Kee({scrapeMotionValuesFromProps:w3,createRenderState:S3})};function rte(n,e,i){for(const o in e)!pc(e[o])&&!tte(o,i)&&(n[o]=e[o])}function m1e({transformTemplate:n},e){return k.useMemo(()=>{const i=S3();return E3(i,e,n),Object.assign({},i.vars,i.style)},[e])}function g1e(n,e){const i=n.style||{},o={};return rte(o,i,n),Object.assign(o,m1e(n,e)),o}function _1e(n,e){const i={},o=g1e(n,e);return n.drag&&n.dragListener!==!1&&(i.draggable=!1,o.userSelect=o.WebkitUserSelect=o.WebkitTouchCallout="none",o.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(i.tabIndex=0),i.style=o,i}function y1e(n,e,i,o){const l=k.useMemo(()=>{const u=Jee();return v3(u,e,b3(o),n.transformTemplate),{...u.attrs,style:{...u.style}}},[e]);if(n.style){const u={};rte(u,n.style,n),l.style={...u,...l.style}}return l}function E1e(n=!1){return(i,o,l,{latestValues:u},f)=>{const v=(m3(i)?y1e:_1e)(o,u,f,i),b=DAe(o,typeof i=="string",n),C=i!==k.Fragment?{...b,...v,ref:l}:{},{children:R}=o,O=k.useMemo(()=>pc(R)?R.get():R,[R]);return k.createElement(i,{...C,children:O})}}function v1e(n,e){return function(o,{forwardMotionProps:l}={forwardMotionProps:!1}){const f={...m3(o)?p1e:f1e,preloadedFeatures:n,useRender:E1e(l),createVisualElement:e,Component:o};return WAe(f)}}function ite(n,e){if(!Array.isArray(e))return!1;const i=e.length;if(i!==n.length)return!1;for(let o=0;o<i;o++)if(e[o]!==n[o])return!1;return!0}function tN(n,e,i){const o=n.getProps();return g3(o,e,i!==void 0?i:o.custom,n)}const S1e=u3(()=>window.ScrollTimeline!==void 0);class b1e{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>"finished"in e?e.finished:e))}getAll(e){return this.animations[0][e]}setAll(e,i){for(let o=0;o<this.animations.length;o++)this.animations[o][e]=i}attachTimeline(e,i){const o=this.animations.map(l=>{if(S1e()&&l.attachTimeline)return l.attachTimeline(e);if(typeof i=="function")return i(l)});return()=>{o.forEach((l,u)=>{l&&l(),this.animations[u].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get startTime(){return this.getAll("startTime")}get duration(){let e=0;for(let i=0;i<this.animations.length;i++)e=Math.max(e,this.animations[i].duration);return e}runAll(e){this.animations.forEach(i=>i[e]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class w1e extends b1e{then(e,i){return Promise.all(this.animations).then(e).catch(i)}}function T3(n,e){return n?n[e]||n.default||n:void 0}const vV=2e4;function ste(n){let e=0;const i=50;let o=n.next(e);for(;!o.done&&e<vV;)e+=i,o=n.next(e);return e>=vV?1/0:e}function C3(n){return typeof n=="function"}function $q(n,e){n.timeline=e,n.onfinish=null}const R3=n=>Array.isArray(n)&&typeof n[0]=="number",T1e={linearEasing:void 0};function C1e(n,e){const i=u3(n);return()=>{var o;return(o=T1e[e])!==null&&o!==void 0?o:i()}}const ek=C1e(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),ote=(n,e,i=10)=>{let o="";const l=Math.max(Math.round(e/i),2);for(let u=0;u<l;u++)o+=n(TS(0,l-1,u))+", ";return`linear(${o.substring(0,o.length-2)})`};function ate(n){return!!(typeof n=="function"&&ek()||!n||typeof n=="string"&&(n in SV||ek())||R3(n)||Array.isArray(n)&&n.every(ate))}const uC=([n,e,i,o])=>`cubic-bezier(${n}, ${e}, ${i}, ${o})`,SV={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:uC([0,.65,.55,1]),circOut:uC([.55,0,1,.45]),backIn:uC([.31,.01,.66,-.59]),backOut:uC([.33,1.53,.69,.99])};function cte(n,e){if(n)return typeof n=="function"&&ek()?ote(n,e):R3(n)?uC(n):Array.isArray(n)?n.map(i=>cte(i,e)||SV.easeOut):SV[n]}const lh={x:!1,y:!1};function lte(){return lh.x||lh.y}function R1e(n,e,i){var o;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const u=(o=void 0)!==null&&o!==void 0?o:l.querySelectorAll(n);return u?Array.from(u):[]}return Array.from(n)}function ute(n,e){const i=R1e(n),o=new AbortController,l={passive:!0,...e,signal:o.signal};return[i,l,()=>o.abort()]}function Kq(n){return e=>{e.pointerType==="touch"||lte()||n(e)}}function I1e(n,e,i={}){const[o,l,u]=ute(n,i),f=Kq(y=>{const{target:v}=y,b=e(y);if(typeof b!="function"||!v)return;const C=Kq(R=>{b(R),v.removeEventListener("pointerleave",C)});v.addEventListener("pointerleave",C,l)});return o.forEach(y=>{y.addEventListener("pointerenter",f,l)}),u}const dte=(n,e)=>e?n===e?!0:dte(n,e.parentElement):!1,I3=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,A1e=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function P1e(n){return A1e.has(n.tagName)||n.tabIndex!==-1}const dC=new WeakSet;function qq(n){return e=>{e.key==="Enter"&&n(e)}}function cU(n,e){n.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const O1e=(n,e)=>{const i=n.currentTarget;if(!i)return;const o=qq(()=>{if(dC.has(i))return;cU(i,"down");const l=qq(()=>{cU(i,"up")}),u=()=>cU(i,"cancel");i.addEventListener("keyup",l,e),i.addEventListener("blur",u,e)});i.addEventListener("keydown",o,e),i.addEventListener("blur",()=>i.removeEventListener("keydown",o),e)};function Yq(n){return I3(n)&&!lte()}function k1e(n,e,i={}){const[o,l,u]=ute(n,i),f=y=>{const v=y.currentTarget;if(!Yq(y)||dC.has(v))return;dC.add(v);const b=e(y),C=(L,D)=>{window.removeEventListener("pointerup",R),window.removeEventListener("pointercancel",O),!(!Yq(L)||!dC.has(v))&&(dC.delete(v),typeof b=="function"&&b(L,{success:D}))},R=L=>{C(L,i.useGlobalTarget||dte(v,L.target))},O=L=>{C(L,!1)};window.addEventListener("pointerup",R,l),window.addEventListener("pointercancel",O,l)};return o.forEach(y=>{!P1e(y)&&y.getAttribute("tabindex")===null&&(y.tabIndex=0),(i.useGlobalTarget?window:y).addEventListener("pointerdown",f,l),y.addEventListener("focus",b=>O1e(b,l),l)}),u}function N1e(n){return n==="x"||n==="y"?lh[n]?null:(lh[n]=!0,()=>{lh[n]=!1}):lh.x||lh.y?null:(lh.x=lh.y=!0,()=>{lh.x=lh.y=!1})}const hte=new Set(["width","height","top","left","right","bottom",...$S]);let IO;function x1e(){IO=void 0}const kp={now:()=>(IO===void 0&&kp.set(Ma.isProcessing||AAe.useManualTiming?Ma.timestamp:performance.now()),IO),set:n=>{IO=n,queueMicrotask(x1e)}};function A3(n,e){n.indexOf(e)===-1&&n.push(e)}function P3(n,e){const i=n.indexOf(e);i>-1&&n.splice(i,1)}class O3{constructor(){this.subscriptions=[]}add(e){return A3(this.subscriptions,e),()=>P3(this.subscriptions,e)}notify(e,i,o){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](e,i,o);else for(let u=0;u<l;u++){const f=this.subscriptions[u];f&&f(e,i,o)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function pte(n,e){return e?n*(1e3/e):0}const Xq=30,D1e=n=>!isNaN(parseFloat(n));class L1e{constructor(e,i={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(o,l=!0)=>{const u=kp.now();this.updatedAt!==u&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(o),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(e),this.owner=i.owner}setCurrent(e){this.current=e,this.updatedAt=kp.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=D1e(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,i){this.events[e]||(this.events[e]=new O3);const o=this.events[e].add(i);return e==="change"?()=>{o(),cs.read(()=>{this.events.change.getSize()||this.stop()})}:o}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,i){this.passiveEffect=e,this.stopPassiveEffect=i}set(e,i=!0){!i||!this.passiveEffect?this.updateAndNotify(e,i):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,i,o){this.set(i),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-o}jump(e,i=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=kp.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>Xq)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,Xq);return pte(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(e){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=e(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function nR(n,e){return new L1e(n,e)}function M1e(n,e,i){n.hasValue(e)?n.getValue(e).set(i):n.addValue(e,nR(i))}function U1e(n,e){const i=tN(n,e);let{transitionEnd:o={},transition:l={},...u}=i||{};u={...u,...o};for(const f in u){const y=YAe(u[f]);M1e(n,f,y)}}function V1e(n){return!!(pc(n)&&n.add)}function bV(n,e){const i=n.getValue("willChange");if(V1e(i))return i.add(e)}function fte(n){return n.props[Gee]}const mte=(n,e,i)=>(((1-3*i+3*e)*n+(3*i-6*e))*n+3*e)*n,j1e=1e-7,F1e=12;function B1e(n,e,i,o,l){let u,f,y=0;do f=e+(i-e)/2,u=mte(f,o,l)-n,u>0?i=f:e=f;while(Math.abs(u)>j1e&&++y<F1e);return f}function NR(n,e,i,o){if(n===e&&i===o)return mu;const l=u=>B1e(u,0,1,n,i);return u=>u===0||u===1?u:mte(l(u),e,o)}const gte=n=>e=>e<=.5?n(2*e)/2:(2-n(2*(1-e)))/2,_te=n=>e=>1-n(1-e),yte=NR(.33,1.53,.69,.99),k3=_te(yte),Ete=gte(k3),vte=n=>(n*=2)<1?.5*k3(n):.5*(2-Math.pow(2,-10*(n-1))),N3=n=>1-Math.sin(Math.acos(n)),Ste=_te(N3),bte=gte(N3),wte=n=>/^0[^.\s]+$/u.test(n);function z1e(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||wte(n):!0}const OC=n=>Math.round(n*1e5)/1e5,x3=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function W1e(n){return n==null}const G1e=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,D3=(n,e)=>i=>!!(typeof i=="string"&&G1e.test(i)&&i.startsWith(n)||e&&!W1e(i)&&Object.prototype.hasOwnProperty.call(i,e)),Tte=(n,e,i)=>o=>{if(typeof o!="string")return o;const[l,u,f,y]=o.match(x3);return{[n]:parseFloat(l),[e]:parseFloat(u),[i]:parseFloat(f),alpha:y!==void 0?parseFloat(y):1}},H1e=n=>Hf(0,255,n),lU={...KS,transform:n=>Math.round(H1e(n))},ky={test:D3("rgb","red"),parse:Tte("red","green","blue"),transform:({red:n,green:e,blue:i,alpha:o=1})=>"rgba("+lU.transform(n)+", "+lU.transform(e)+", "+lU.transform(i)+", "+OC(tR.transform(o))+")"};function $1e(n){let e="",i="",o="",l="";return n.length>5?(e=n.substring(1,3),i=n.substring(3,5),o=n.substring(5,7),l=n.substring(7,9)):(e=n.substring(1,2),i=n.substring(2,3),o=n.substring(3,4),l=n.substring(4,5),e+=e,i+=i,o+=o,l+=l),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(o,16),alpha:l?parseInt(l,16)/255:1}}const wV={test:D3("#"),parse:$1e,transform:ky.transform},$0={test:D3("hsl","hue"),parse:Tte("hue","saturation","lightness"),transform:({hue:n,saturation:e,lightness:i,alpha:o=1})=>"hsla("+Math.round(n)+", "+Op.transform(OC(e))+", "+Op.transform(OC(i))+", "+OC(tR.transform(o))+")"},lc={test:n=>ky.test(n)||wV.test(n)||$0.test(n),parse:n=>ky.test(n)?ky.parse(n):$0.test(n)?$0.parse(n):wV.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?ky.transform(n):$0.transform(n)},K1e=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function q1e(n){var e,i;return isNaN(n)&&typeof n=="string"&&(((e=n.match(x3))===null||e===void 0?void 0:e.length)||0)+(((i=n.match(K1e))===null||i===void 0?void 0:i.length)||0)>0}const Cte="number",Rte="color",Y1e="var",X1e="var(",Jq="${}",J1e=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function rR(n){const e=n.toString(),i=[],o={color:[],number:[],var:[]},l=[];let u=0;const y=e.replace(J1e,v=>(lc.test(v)?(o.color.push(u),l.push(Rte),i.push(lc.parse(v))):v.startsWith(X1e)?(o.var.push(u),l.push(Y1e),i.push(v)):(o.number.push(u),l.push(Cte),i.push(parseFloat(v))),++u,Jq)).split(Jq);return{values:i,split:y,indexes:o,types:l}}function Ite(n){return rR(n).values}function Ate(n){const{split:e,types:i}=rR(n),o=e.length;return l=>{let u="";for(let f=0;f<o;f++)if(u+=e[f],l[f]!==void 0){const y=i[f];y===Cte?u+=OC(l[f]):y===Rte?u+=lc.transform(l[f]):u+=l[f]}return u}}const Q1e=n=>typeof n=="number"?0:n;function Z1e(n){const e=Ite(n);return Ate(n)(e.map(Q1e))}const Lg={test:q1e,parse:Ite,createTransformer:Ate,getAnimatableNone:Z1e},ePe=new Set(["brightness","contrast","saturate","opacity"]);function tPe(n){const[e,i]=n.slice(0,-1).split("(");if(e==="drop-shadow")return n;const[o]=i.match(x3)||[];if(!o)return n;const l=i.replace(o,"");let u=ePe.has(e)?1:0;return o!==i&&(u*=100),e+"("+u+l+")"}const nPe=/\b([a-z-]*)\(.*?\)/gu,TV={...Lg,getAnimatableNone:n=>{const e=n.match(nPe);return e?e.map(tPe).join(" "):n}},rPe={...y3,color:lc,backgroundColor:lc,outlineColor:lc,fill:lc,stroke:lc,borderColor:lc,borderTopColor:lc,borderRightColor:lc,borderBottomColor:lc,borderLeftColor:lc,filter:TV,WebkitFilter:TV},L3=n=>rPe[n];function Pte(n,e){let i=L3(n);return i!==TV&&(i=Lg),i.getAnimatableNone?i.getAnimatableNone(e):void 0}const iPe=new Set(["auto","none","0"]);function sPe(n,e,i){let o=0,l;for(;o<n.length&&!l;){const u=n[o];typeof u=="string"&&!iPe.has(u)&&rR(u).values.length&&(l=n[o]),o++}if(l&&i)for(const u of e)n[u]=Pte(i,l)}const Qq=n=>n===KS||n===Yn,Zq=(n,e)=>parseFloat(n.split(", ")[e]),eY=(n,e)=>(i,{transform:o})=>{if(o==="none"||!o)return 0;const l=o.match(/^matrix3d\((.+)\)$/u);if(l)return Zq(l[1],e);{const u=o.match(/^matrix\((.+)\)$/u);return u?Zq(u[1],n):0}},oPe=new Set(["x","y","z"]),aPe=$S.filter(n=>!oPe.has(n));function cPe(n){const e=[];return aPe.forEach(i=>{const o=n.getValue(i);o!==void 0&&(e.push([i,o.get()]),o.set(i.startsWith("scale")?1:0))}),e}const RS={width:({x:n},{paddingLeft:e="0",paddingRight:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),height:({y:n},{paddingTop:e="0",paddingBottom:i="0"})=>n.max-n.min-parseFloat(e)-parseFloat(i),top:(n,{top:e})=>parseFloat(e),left:(n,{left:e})=>parseFloat(e),bottom:({y:n},{top:e})=>parseFloat(e)+(n.max-n.min),right:({x:n},{left:e})=>parseFloat(e)+(n.max-n.min),x:eY(4,13),y:eY(5,14)};RS.translateX=RS.x;RS.translateY=RS.y;const By=new Set;let CV=!1,RV=!1;function Ote(){if(RV){const n=Array.from(By).filter(o=>o.needsMeasurement),e=new Set(n.map(o=>o.element)),i=new Map;e.forEach(o=>{const l=cPe(o);l.length&&(i.set(o,l),o.render())}),n.forEach(o=>o.measureInitialState()),e.forEach(o=>{o.render();const l=i.get(o);l&&l.forEach(([u,f])=>{var y;(y=o.getValue(u))===null||y===void 0||y.set(f)})}),n.forEach(o=>o.measureEndState()),n.forEach(o=>{o.suspendedScrollY!==void 0&&window.scrollTo(0,o.suspendedScrollY)})}RV=!1,CV=!1,By.forEach(n=>n.complete()),By.clear()}function kte(){By.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(RV=!0)})}function lPe(){kte(),Ote()}class M3{constructor(e,i,o,l,u,f=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...e],this.onComplete=i,this.name=o,this.motionValue=l,this.element=u,this.isAsync=f}scheduleResolve(){this.isScheduled=!0,this.isAsync?(By.add(this),CV||(CV=!0,cs.read(kte),cs.resolveKeyframes(Ote))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:i,element:o,motionValue:l}=this;for(let u=0;u<e.length;u++)if(e[u]===null)if(u===0){const f=l==null?void 0:l.get(),y=e[e.length-1];if(f!==void 0)e[0]=f;else if(o&&i){const v=o.readValue(i,y);v!=null&&(e[0]=v)}e[0]===void 0&&(e[0]=y),l&&f===void 0&&l.set(e[0])}else e[u]=e[u-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),By.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,By.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const Nte=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),uPe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function dPe(n){const e=uPe.exec(n);if(!e)return[,];const[,i,o,l]=e;return[`--${i??o}`,l]}function xte(n,e,i=1){const[o,l]=dPe(n);if(!o)return;const u=window.getComputedStyle(e).getPropertyValue(o);if(u){const f=u.trim();return Nte(f)?parseFloat(f):f}return _3(l)?xte(l,e,i+1):l}const Dte=n=>e=>e.test(n),hPe={test:n=>n==="auto",parse:n=>n},Lte=[KS,Yn,Op,_g,t1e,e1e,hPe],tY=n=>Lte.find(Dte(n));class Mte extends M3{constructor(e,i,o,l,u){super(e,i,o,l,u,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:i,name:o}=this;if(!i||!i.current)return;super.readKeyframes();for(let v=0;v<e.length;v++){let b=e[v];if(typeof b=="string"&&(b=b.trim(),_3(b))){const C=xte(b,i.current);C!==void 0&&(e[v]=C),v===e.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!hte.has(o)||e.length!==2)return;const[l,u]=e,f=tY(l),y=tY(u);if(f!==y)if(Qq(f)&&Qq(y))for(let v=0;v<e.length;v++){const b=e[v];typeof b=="string"&&(e[v]=parseFloat(b))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:i}=this,o=[];for(let l=0;l<e.length;l++)z1e(e[l])&&o.push(l);o.length&&sPe(e,o,i)}measureInitialState(){const{element:e,unresolvedKeyframes:i,name:o}=this;if(!e||!e.current)return;o==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=RS[o](e.measureViewportBox(),window.getComputedStyle(e.current)),i[0]=this.measuredOrigin;const l=i[i.length-1];l!==void 0&&e.getValue(o,l).jump(l,!1)}measureEndState(){var e;const{element:i,name:o,unresolvedKeyframes:l}=this;if(!i||!i.current)return;const u=i.getValue(o);u&&u.jump(this.measuredOrigin,!1);const f=l.length-1,y=l[f];l[f]=RS[o](i.measureViewportBox(),window.getComputedStyle(i.current)),y!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=y),!((e=this.removedTransforms)===null||e===void 0)&&e.length&&this.removedTransforms.forEach(([v,b])=>{i.getValue(v).set(b)}),this.resolveNoneKeyframes()}}const nY=(n,e)=>e==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(Lg.test(n)||n==="0")&&!n.startsWith("url("));function pPe(n){const e=n[0];if(n.length===1)return!0;for(let i=0;i<n.length;i++)if(n[i]!==e)return!0}function fPe(n,e,i,o){const l=n[0];if(l===null)return!1;if(e==="display"||e==="visibility")return!0;const u=n[n.length-1],f=nY(l,e),y=nY(u,e);return!f||!y?!1:pPe(n)||(i==="spring"||C3(i))&&o}const mPe=n=>n!==null;function nN(n,{repeat:e,repeatType:i="loop"},o){const l=n.filter(mPe),u=e&&i!=="loop"&&e%2===1?0:l.length-1;return!u||o===void 0?l[u]:o}const gPe=40;class Ute{constructor({autoplay:e=!0,delay:i=0,type:o="keyframes",repeat:l=0,repeatDelay:u=0,repeatType:f="loop",...y}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=kp.now(),this.options={autoplay:e,delay:i,type:o,repeat:l,repeatDelay:u,repeatType:f,...y},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>gPe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&lPe(),this._resolved}onKeyframesResolved(e,i){this.resolvedAt=kp.now(),this.hasAttemptedResolve=!0;const{name:o,type:l,velocity:u,delay:f,onComplete:y,onUpdate:v,isGenerator:b}=this.options;if(!b&&!fPe(e,o,l,u))if(f)this.options.duration=0;else{v&&v(nN(e,this.options,i)),y&&y(),this.resolveFinishedPromise();return}const C=this.initPlayback(e,i);C!==!1&&(this._resolved={keyframes:e,finalKeyframe:i,...C},this.onPostResolved())}onPostResolved(){}then(e,i){return this.currentFinishedPromise.then(e,i)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(e=>{this.resolveFinishedPromise=e})}}const Rs=(n,e,i)=>n+(e-n)*i;function uU(n,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(e-n)*6*i:i<1/2?e:i<2/3?n+(e-n)*(2/3-i)*6:n}function _Pe({hue:n,saturation:e,lightness:i,alpha:o}){n/=360,e/=100,i/=100;let l=0,u=0,f=0;if(!e)l=u=f=i;else{const y=i<.5?i*(1+e):i+e-i*e,v=2*i-y;l=uU(v,y,n+1/3),u=uU(v,y,n),f=uU(v,y,n-1/3)}return{red:Math.round(l*255),green:Math.round(u*255),blue:Math.round(f*255),alpha:o}}function tk(n,e){return i=>i>0?e:n}const dU=(n,e,i)=>{const o=n*n,l=i*(e*e-o)+o;return l<0?0:Math.sqrt(l)},yPe=[wV,ky,$0],EPe=n=>yPe.find(e=>e.test(n));function rY(n){const e=EPe(n);if(!e)return!1;let i=e.parse(n);return e===$0&&(i=_Pe(i)),i}const iY=(n,e)=>{const i=rY(n),o=rY(e);if(!i||!o)return tk(n,e);const l={...i};return u=>(l.red=dU(i.red,o.red,u),l.green=dU(i.green,o.green,u),l.blue=dU(i.blue,o.blue,u),l.alpha=Rs(i.alpha,o.alpha,u),ky.transform(l))},vPe=(n,e)=>i=>e(n(i)),xR=(...n)=>n.reduce(vPe),IV=new Set(["none","hidden"]);function SPe(n,e){return IV.has(n)?i=>i<=0?n:e:i=>i>=1?e:n}function bPe(n,e){return i=>Rs(n,e,i)}function U3(n){return typeof n=="number"?bPe:typeof n=="string"?_3(n)?tk:lc.test(n)?iY:CPe:Array.isArray(n)?Vte:typeof n=="object"?lc.test(n)?iY:wPe:tk}function Vte(n,e){const i=[...n],o=i.length,l=n.map((u,f)=>U3(u)(u,e[f]));return u=>{for(let f=0;f<o;f++)i[f]=l[f](u);return i}}function wPe(n,e){const i={...n,...e},o={};for(const l in i)n[l]!==void 0&&e[l]!==void 0&&(o[l]=U3(n[l])(n[l],e[l]));return l=>{for(const u in o)i[u]=o[u](l);return i}}function TPe(n,e){var i;const o=[],l={color:0,var:0,number:0};for(let u=0;u<e.values.length;u++){const f=e.types[u],y=n.indexes[f][l[f]],v=(i=n.values[y])!==null&&i!==void 0?i:0;o[u]=v,l[f]++}return o}const CPe=(n,e)=>{const i=Lg.createTransformer(e),o=rR(n),l=rR(e);return o.indexes.var.length===l.indexes.var.length&&o.indexes.color.length===l.indexes.color.length&&o.indexes.number.length>=l.indexes.number.length?IV.has(n)&&!l.values.length||IV.has(e)&&!o.values.length?SPe(n,e):xR(Vte(TPe(o,l),l.values),i):tk(n,e)};function jte(n,e,i){return typeof n=="number"&&typeof e=="number"&&typeof i=="number"?Rs(n,e,i):U3(n)(n,e)}const RPe=5;function Fte(n,e,i){const o=Math.max(e-RPe,0);return pte(i-n(o),e-o)}const Gs={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},hU=.001;function IPe({duration:n=Gs.duration,bounce:e=Gs.bounce,velocity:i=Gs.velocity,mass:o=Gs.mass}){let l,u,f=1-e;f=Hf(Gs.minDamping,Gs.maxDamping,f),n=Hf(Gs.minDuration,Gs.maxDuration,Vf(n)),f<1?(l=b=>{const C=b*f,R=C*n,O=C-i,L=AV(b,f),D=Math.exp(-R);return hU-O/L*D},u=b=>{const R=b*f*n,O=R*i+i,L=Math.pow(f,2)*Math.pow(b,2)*n,D=Math.exp(-R),U=AV(Math.pow(b,2),f);return(-l(b)+hU>0?-1:1)*((O-L)*D)/U}):(l=b=>{const C=Math.exp(-b*n),R=(b-i)*n+1;return-hU+C*R},u=b=>{const C=Math.exp(-b*n),R=(i-b)*(n*n);return C*R});const y=5/n,v=PPe(l,u,y);if(n=Uf(n),isNaN(v))return{stiffness:Gs.stiffness,damping:Gs.damping,duration:n};{const b=Math.pow(v,2)*o;return{stiffness:b,damping:f*2*Math.sqrt(o*b),duration:n}}}const APe=12;function PPe(n,e,i){let o=i;for(let l=1;l<APe;l++)o=o-n(o)/e(o);return o}function AV(n,e){return n*Math.sqrt(1-e*e)}const OPe=["duration","bounce"],kPe=["stiffness","damping","mass"];function sY(n,e){return e.some(i=>n[i]!==void 0)}function NPe(n){let e={velocity:Gs.velocity,stiffness:Gs.stiffness,damping:Gs.damping,mass:Gs.mass,isResolvedFromDuration:!1,...n};if(!sY(n,kPe)&&sY(n,OPe))if(n.visualDuration){const i=n.visualDuration,o=2*Math.PI/(i*1.2),l=o*o,u=2*Hf(.05,1,1-(n.bounce||0))*Math.sqrt(l);e={...e,mass:Gs.mass,stiffness:l,damping:u}}else{const i=IPe(n);e={...e,...i,mass:Gs.mass},e.isResolvedFromDuration=!0}return e}function Bte(n=Gs.visualDuration,e=Gs.bounce){const i=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:e}:n;let{restSpeed:o,restDelta:l}=i;const u=i.keyframes[0],f=i.keyframes[i.keyframes.length-1],y={done:!1,value:u},{stiffness:v,damping:b,mass:C,duration:R,velocity:O,isResolvedFromDuration:L}=NPe({...i,velocity:-Vf(i.velocity||0)}),D=O||0,U=b/(2*Math.sqrt(v*C)),B=f-u,Y=Vf(Math.sqrt(v/C)),W=Math.abs(B)<5;o||(o=W?Gs.restSpeed.granular:Gs.restSpeed.default),l||(l=W?Gs.restDelta.granular:Gs.restDelta.default);let ne;if(U<1){const re=AV(Y,U);ne=me=>{const q=Math.exp(-U*Y*me);return f-q*((D+U*Y*B)/re*Math.sin(re*me)+B*Math.cos(re*me))}}else if(U===1)ne=re=>f-Math.exp(-Y*re)*(B+(D+Y*B)*re);else{const re=Y*Math.sqrt(U*U-1);ne=me=>{const q=Math.exp(-U*Y*me),J=Math.min(re*me,300);return f-q*((D+U*Y*B)*Math.sinh(J)+re*B*Math.cosh(J))/re}}const le={calculatedDuration:L&&R||null,next:re=>{const me=ne(re);if(L)y.done=re>=R;else{let q=0;U<1&&(q=re===0?Uf(D):Fte(ne,re,me));const J=Math.abs(q)<=o,Q=Math.abs(f-me)<=l;y.done=J&&Q}return y.value=y.done?f:me,y},toString:()=>{const re=Math.min(ste(le),vV),me=ote(q=>le.next(re*q).value,re,30);return re+"ms "+me}};return le}function oY({keyframes:n,velocity:e=0,power:i=.8,timeConstant:o=325,bounceDamping:l=10,bounceStiffness:u=500,modifyTarget:f,min:y,max:v,restDelta:b=.5,restSpeed:C}){const R=n[0],O={done:!1,value:R},L=J=>y!==void 0&&J<y||v!==void 0&&J>v,D=J=>y===void 0?v:v===void 0||Math.abs(y-J)<Math.abs(v-J)?y:v;let U=i*e;const B=R+U,Y=f===void 0?B:f(B);Y!==B&&(U=Y-R);const W=J=>-U*Math.exp(-J/o),ne=J=>Y+W(J),le=J=>{const Q=W(J),ie=ne(J);O.done=Math.abs(Q)<=b,O.value=O.done?Y:ie};let re,me;const q=J=>{L(O.value)&&(re=J,me=Bte({keyframes:[O.value,D(O.value)],velocity:Fte(ne,J,O.value),damping:l,stiffness:u,restDelta:b,restSpeed:C}))};return q(0),{calculatedDuration:null,next:J=>{let Q=!1;return!me&&re===void 0&&(Q=!0,le(J),q(J)),re!==void 0&&J>=re?me.next(J-re):(!Q&&le(J),O)}}}const xPe=NR(.42,0,1,1),DPe=NR(0,0,.58,1),zte=NR(.42,0,.58,1),LPe=n=>Array.isArray(n)&&typeof n[0]!="number",MPe={linear:mu,easeIn:xPe,easeInOut:zte,easeOut:DPe,circIn:N3,circInOut:bte,circOut:Ste,backIn:k3,backInOut:Ete,backOut:yte,anticipate:vte},aY=n=>{if(R3(n)){jee(n.length===4);const[e,i,o,l]=n;return NR(e,i,o,l)}else if(typeof n=="string")return MPe[n];return n};function UPe(n,e,i){const o=[],l=i||jte,u=n.length-1;for(let f=0;f<u;f++){let y=l(n[f],n[f+1]);if(e){const v=Array.isArray(e)?e[f]||mu:e;y=xR(v,y)}o.push(y)}return o}function VPe(n,e,{clamp:i=!0,ease:o,mixer:l}={}){const u=n.length;if(jee(u===e.length),u===1)return()=>e[0];if(u===2&&e[0]===e[1])return()=>e[1];const f=n[0]===n[1];n[0]>n[u-1]&&(n=[...n].reverse(),e=[...e].reverse());const y=UPe(e,o,l),v=y.length,b=C=>{if(f&&C<n[0])return e[0];let R=0;if(v>1)for(;R<n.length-2&&!(C<n[R+1]);R++);const O=TS(n[R],n[R+1],C);return y[R](O)};return i?C=>b(Hf(n[0],n[u-1],C)):b}function jPe(n,e){const i=n[n.length-1];for(let o=1;o<=e;o++){const l=TS(0,e,o);n.push(Rs(i,1,l))}}function FPe(n){const e=[0];return jPe(e,n.length-1),e}function BPe(n,e){return n.map(i=>i*e)}function zPe(n,e){return n.map(()=>e||zte).splice(0,n.length-1)}function nk({duration:n=300,keyframes:e,times:i,ease:o="easeInOut"}){const l=LPe(o)?o.map(aY):aY(o),u={done:!1,value:e[0]},f=BPe(i&&i.length===e.length?i:FPe(e),n),y=VPe(f,e,{ease:Array.isArray(l)?l:zPe(e,l)});return{calculatedDuration:n,next:v=>(u.value=y(v),u.done=v>=n,u)}}const WPe=n=>{const e=({timestamp:i})=>n(i);return{start:()=>cs.update(e,!0),stop:()=>Dg(e),now:()=>Ma.isProcessing?Ma.timestamp:kp.now()}},GPe={decay:oY,inertia:oY,tween:nk,keyframes:nk,spring:Bte},HPe=n=>n/100;class V3 extends Ute{constructor(e){super(e),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:v}=this.options;v&&v()};const{name:i,motionValue:o,element:l,keyframes:u}=this.options,f=(l==null?void 0:l.KeyframeResolver)||M3,y=(v,b)=>this.onKeyframesResolved(v,b);this.resolver=new f(u,y,i,o,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(e){const{type:i="keyframes",repeat:o=0,repeatDelay:l=0,repeatType:u,velocity:f=0}=this.options,y=C3(i)?i:GPe[i]||nk;let v,b;y!==nk&&typeof e[0]!="number"&&(v=xR(HPe,jte(e[0],e[1])),e=[0,100]);const C=y({...this.options,keyframes:e});u==="mirror"&&(b=y({...this.options,keyframes:[...e].reverse(),velocity:-f})),C.calculatedDuration===null&&(C.calculatedDuration=ste(C));const{calculatedDuration:R}=C,O=R+l,L=O*(o+1)-l;return{generator:C,mirroredGenerator:b,mapPercentToKeyframes:v,calculatedDuration:R,resolvedDuration:O,totalDuration:L}}onPostResolved(){const{autoplay:e=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!e?this.pause():this.state=this.pendingPlayState}tick(e,i=!1){const{resolved:o}=this;if(!o){const{keyframes:J}=this.options;return{done:!0,value:J[J.length-1]}}const{finalKeyframe:l,generator:u,mirroredGenerator:f,mapPercentToKeyframes:y,keyframes:v,calculatedDuration:b,totalDuration:C,resolvedDuration:R}=o;if(this.startTime===null)return u.next(0);const{delay:O,repeat:L,repeatType:D,repeatDelay:U,onUpdate:B}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-C/this.speed,this.startTime)),i?this.currentTime=e:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(e-this.startTime)*this.speed;const Y=this.currentTime-O*(this.speed>=0?1:-1),W=this.speed>=0?Y<0:Y>C;this.currentTime=Math.max(Y,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=C);let ne=this.currentTime,le=u;if(L){const J=Math.min(this.currentTime,C)/R;let Q=Math.floor(J),ie=J%1;!ie&&J>=1&&(ie=1),ie===1&&Q--,Q=Math.min(Q,L+1),!!(Q%2)&&(D==="reverse"?(ie=1-ie,U&&(ie-=U/R)):D==="mirror"&&(le=f)),ne=Hf(0,1,ie)*R}const re=W?{done:!1,value:v[0]}:le.next(ne);y&&(re.value=y(re.value));let{done:me}=re;!W&&b!==null&&(me=this.speed>=0?this.currentTime>=C:this.currentTime<=0);const q=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&me);return q&&l!==void 0&&(re.value=nN(v,this.options,l)),B&&B(re.value),q&&this.finish(),re}get duration(){const{resolved:e}=this;return e?Vf(e.calculatedDuration):0}get time(){return Vf(this.currentTime)}set time(e){e=Uf(e),this.currentTime=e,this.holdTime!==null||this.speed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.speed)}get speed(){return this.playbackSpeed}set speed(e){const i=this.playbackSpeed!==e;this.playbackSpeed=e,i&&(this.time=Vf(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:e=WPe,onPlay:i,startTime:o}=this.options;this.driver||(this.driver=e(u=>this.tick(u))),i&&i();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=o??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var e;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(e=this.currentTime)!==null&&e!==void 0?e:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:e}=this.options;e&&e()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}}const $Pe=new Set(["opacity","clipPath","filter","transform"]);function KPe(n,e,i,{delay:o=0,duration:l=300,repeat:u=0,repeatType:f="loop",ease:y="easeInOut",times:v}={}){const b={[e]:i};v&&(b.offset=v);const C=cte(y,l);return Array.isArray(C)&&(b.easing=C),n.animate(b,{delay:o,duration:l,easing:Array.isArray(C)?"linear":C,fill:"both",iterations:u+1,direction:f==="reverse"?"alternate":"normal"})}const qPe=u3(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),rk=10,YPe=2e4;function XPe(n){return C3(n.type)||n.type==="spring"||!ate(n.ease)}function JPe(n,e){const i=new V3({...e,keyframes:n,repeat:0,delay:0,isGenerator:!0});let o={done:!1,value:n[0]};const l=[];let u=0;for(;!o.done&&u<YPe;)o=i.sample(u),l.push(o.value),u+=rk;return{times:void 0,keyframes:l,duration:u-rk,ease:"linear"}}const Wte={anticipate:vte,backInOut:Ete,circInOut:bte};function QPe(n){return n in Wte}class cY extends Ute{constructor(e){super(e);const{name:i,motionValue:o,element:l,keyframes:u}=this.options;this.resolver=new Mte(u,(f,y)=>this.onKeyframesResolved(f,y),i,o,l),this.resolver.scheduleResolve()}initPlayback(e,i){let{duration:o=300,times:l,ease:u,type:f,motionValue:y,name:v,startTime:b}=this.options;if(!y.owner||!y.owner.current)return!1;if(typeof u=="string"&&ek()&&QPe(u)&&(u=Wte[u]),XPe(this.options)){const{onComplete:R,onUpdate:O,motionValue:L,element:D,...U}=this.options,B=JPe(e,U);e=B.keyframes,e.length===1&&(e[1]=e[0]),o=B.duration,l=B.times,u=B.ease,f="keyframes"}const C=KPe(y.owner.current,v,e,{...this.options,duration:o,times:l,ease:u});return C.startTime=b??this.calcStartTime(),this.pendingTimeline?($q(C,this.pendingTimeline),this.pendingTimeline=void 0):C.onfinish=()=>{const{onComplete:R}=this.options;y.set(nN(e,this.options,i)),R&&R(),this.cancel(),this.resolveFinishedPromise()},{animation:C,duration:o,times:l,type:f,ease:u,keyframes:e}}get duration(){const{resolved:e}=this;if(!e)return 0;const{duration:i}=e;return Vf(i)}get time(){const{resolved:e}=this;if(!e)return 0;const{animation:i}=e;return Vf(i.currentTime||0)}set time(e){const{resolved:i}=this;if(!i)return;const{animation:o}=i;o.currentTime=Uf(e)}get speed(){const{resolved:e}=this;if(!e)return 1;const{animation:i}=e;return i.playbackRate}set speed(e){const{resolved:i}=this;if(!i)return;const{animation:o}=i;o.playbackRate=e}get state(){const{resolved:e}=this;if(!e)return"idle";const{animation:i}=e;return i.playState}get startTime(){const{resolved:e}=this;if(!e)return null;const{animation:i}=e;return i.startTime}attachTimeline(e){if(!this._resolved)this.pendingTimeline=e;else{const{resolved:i}=this;if(!i)return mu;const{animation:o}=i;$q(o,e)}return mu}play(){if(this.isStopped)return;const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.playState==="finished"&&this.updateFinishedPromise(),i.play()}pause(){const{resolved:e}=this;if(!e)return;const{animation:i}=e;i.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:e}=this;if(!e)return;const{animation:i,keyframes:o,duration:l,type:u,ease:f,times:y}=e;if(i.playState==="idle"||i.playState==="finished")return;if(this.time){const{motionValue:b,onUpdate:C,onComplete:R,element:O,...L}=this.options,D=new V3({...L,keyframes:o,duration:l,type:u,ease:f,times:y,isGenerator:!0}),U=Uf(this.time);b.setWithVelocity(D.sample(U-rk).value,D.sample(U).value,rk)}const{onStop:v}=this.options;v&&v(),this.cancel()}complete(){const{resolved:e}=this;e&&e.animation.finish()}cancel(){const{resolved:e}=this;e&&e.animation.cancel()}static supports(e){const{motionValue:i,name:o,repeatDelay:l,repeatType:u,damping:f,type:y}=e;if(!i||!i.owner||!(i.owner.current instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:b}=i.owner.getProps();return qPe()&&o&&$Pe.has(o)&&!v&&!b&&!l&&u!=="mirror"&&f!==0&&y!=="inertia"}}const ZPe={type:"spring",stiffness:500,damping:25,restSpeed:10},eOe=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),tOe={type:"keyframes",duration:.8},nOe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},rOe=(n,{keyframes:e})=>e.length>2?tOe:uE.has(n)?n.startsWith("scale")?eOe(e[1]):ZPe:nOe;function iOe({when:n,delay:e,delayChildren:i,staggerChildren:o,staggerDirection:l,repeat:u,repeatType:f,repeatDelay:y,from:v,elapsed:b,...C}){return!!Object.keys(C).length}const j3=(n,e,i,o={},l,u)=>f=>{const y=T3(o,n)||{},v=y.delay||o.delay||0;let{elapsed:b=0}=o;b=b-Uf(v);let C={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:e.getVelocity(),...y,delay:-b,onUpdate:O=>{e.set(O),y.onUpdate&&y.onUpdate(O)},onComplete:()=>{f(),y.onComplete&&y.onComplete()},name:n,motionValue:e,element:u?void 0:l};iOe(y)||(C={...C,...rOe(n,C)}),C.duration&&(C.duration=Uf(C.duration)),C.repeatDelay&&(C.repeatDelay=Uf(C.repeatDelay)),C.from!==void 0&&(C.keyframes[0]=C.from);let R=!1;if((C.type===!1||C.duration===0&&!C.repeatDelay)&&(C.duration=0,C.delay===0&&(R=!0)),R&&!u&&e.get()!==void 0){const O=nN(C.keyframes,y);if(O!==void 0)return cs.update(()=>{C.onUpdate(O),C.onComplete()}),new w1e([])}return!u&&cY.supports(C)?new cY(C):new V3(C)};function sOe({protectedKeys:n,needsAnimating:e},i){const o=n.hasOwnProperty(i)&&e[i]!==!0;return e[i]=!1,o}function Gte(n,e,{delay:i=0,transitionOverride:o,type:l}={}){var u;let{transition:f=n.getDefaultTransition(),transitionEnd:y,...v}=e;o&&(f=o);const b=[],C=l&&n.animationState&&n.animationState.getState()[l];for(const R in v){const O=n.getValue(R,(u=n.latestValues[R])!==null&&u!==void 0?u:null),L=v[R];if(L===void 0||C&&sOe(C,R))continue;const D={delay:i,...T3(f||{},R)};let U=!1;if(window.MotionHandoffAnimation){const Y=fte(n);if(Y){const W=window.MotionHandoffAnimation(Y,R,cs);W!==null&&(D.startTime=W,U=!0)}}bV(n,R),O.start(j3(R,O,L,n.shouldReduceMotion&&hte.has(R)?{type:!1}:D,n,U));const B=O.animation;B&&b.push(B)}return y&&Promise.all(b).then(()=>{cs.update(()=>{y&&U1e(n,y)})}),b}function PV(n,e,i={}){var o;const l=tN(n,e,i.type==="exit"?(o=n.presenceContext)===null||o===void 0?void 0:o.custom:void 0);let{transition:u=n.getDefaultTransition()||{}}=l||{};i.transitionOverride&&(u=i.transitionOverride);const f=l?()=>Promise.all(Gte(n,l,i)):()=>Promise.resolve(),y=n.variantChildren&&n.variantChildren.size?(b=0)=>{const{delayChildren:C=0,staggerChildren:R,staggerDirection:O}=u;return oOe(n,e,C+b,R,O,i)}:()=>Promise.resolve(),{when:v}=u;if(v){const[b,C]=v==="beforeChildren"?[f,y]:[y,f];return b().then(()=>C())}else return Promise.all([f(),y(i.delay)])}function oOe(n,e,i=0,o=0,l=1,u){const f=[],y=(n.variantChildren.size-1)*o,v=l===1?(b=0)=>b*o:(b=0)=>y-b*o;return Array.from(n.variantChildren).sort(aOe).forEach((b,C)=>{b.notify("AnimationStart",e),f.push(PV(b,e,{...u,delay:i+v(C)}).then(()=>b.notify("AnimationComplete",e)))}),Promise.all(f)}function aOe(n,e){return n.sortNodePosition(e)}function cOe(n,e,i={}){n.notify("AnimationStart",e);let o;if(Array.isArray(e)){const l=e.map(u=>PV(n,u,i));o=Promise.all(l)}else if(typeof e=="string")o=PV(n,e,i);else{const l=typeof e=="function"?tN(n,e,i.custom):e;o=Promise.all(Gte(n,l,i))}return o.then(()=>{n.notify("AnimationComplete",e)})}const lOe=h3.length;function Hte(n){if(!n)return;if(!n.isControllingVariants){const i=n.parent?Hte(n.parent)||{}:{};return n.props.initial!==void 0&&(i.initial=n.props.initial),i}const e={};for(let i=0;i<lOe;i++){const o=h3[i],l=n.props[o];(eR(l)||l===!1)&&(e[o]=l)}return e}const uOe=[...d3].reverse(),dOe=d3.length;function hOe(n){return e=>Promise.all(e.map(({animation:i,options:o})=>cOe(n,i,o)))}function pOe(n){let e=hOe(n),i=lY(),o=!0;const l=v=>(b,C)=>{var R;const O=tN(n,C,v==="exit"?(R=n.presenceContext)===null||R===void 0?void 0:R.custom:void 0);if(O){const{transition:L,transitionEnd:D,...U}=O;b={...b,...U,...D}}return b};function u(v){e=v(n)}function f(v){const{props:b}=n,C=Hte(n.parent)||{},R=[],O=new Set;let L={},D=1/0;for(let B=0;B<dOe;B++){const Y=uOe[B],W=i[Y],ne=b[Y]!==void 0?b[Y]:C[Y],le=eR(ne),re=Y===v?W.isActive:null;re===!1&&(D=B);let me=ne===C[Y]&&ne!==b[Y]&&le;if(me&&o&&n.manuallyAnimateOnMount&&(me=!1),W.protectedKeys={...L},!W.isActive&&re===null||!ne&&!W.prevProp||Zk(ne)||typeof ne=="boolean")continue;const q=fOe(W.prevProp,ne);let J=q||Y===v&&W.isActive&&!me&&le||B>D&&le,Q=!1;const ie=Array.isArray(ne)?ne:[ne];let pe=ie.reduce(l(Y),{});re===!1&&(pe={});const{prevResolvedValues:de={}}=W,he={...de,...pe},Se=we=>{J=!0,O.has(we)&&(Q=!0,O.delete(we)),W.needsAnimating[we]=!0;const Re=n.getValue(we);Re&&(Re.liveStyle=!1)};for(const we in he){const Re=pe[we],Te=de[we];if(L.hasOwnProperty(we))continue;let Ne=!1;EV(Re)&&EV(Te)?Ne=!ite(Re,Te):Ne=Re!==Te,Ne?Re!=null?Se(we):O.add(we):Re!==void 0&&O.has(we)?Se(we):W.protectedKeys[we]=!0}W.prevProp=ne,W.prevResolvedValues=pe,W.isActive&&(L={...L,...pe}),o&&n.blockInitialAnimation&&(J=!1),J&&(!(me&&q)||Q)&&R.push(...ie.map(we=>({animation:we,options:{type:Y}})))}if(O.size){const B={};O.forEach(Y=>{const W=n.getBaseTarget(Y),ne=n.getValue(Y);ne&&(ne.liveStyle=!0),B[Y]=W??null}),R.push({animation:B})}let U=!!R.length;return o&&(b.initial===!1||b.initial===b.animate)&&!n.manuallyAnimateOnMount&&(U=!1),o=!1,U?e(R):Promise.resolve()}function y(v,b){var C;if(i[v].isActive===b)return Promise.resolve();(C=n.variantChildren)===null||C===void 0||C.forEach(O=>{var L;return(L=O.animationState)===null||L===void 0?void 0:L.setActive(v,b)}),i[v].isActive=b;const R=f(v);for(const O in i)i[O].protectedKeys={};return R}return{animateChanges:f,setActive:y,setAnimateFunction:u,getState:()=>i,reset:()=>{i=lY(),o=!0}}}function fOe(n,e){return typeof e=="string"?e!==n:Array.isArray(e)?!ite(e,n):!1}function by(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function lY(){return{animate:by(!0),whileInView:by(),whileHover:by(),whileTap:by(),whileDrag:by(),whileFocus:by(),exit:by()}}class $g{constructor(e){this.isMounted=!1,this.node=e}update(){}}class mOe extends $g{constructor(e){super(e),e.animationState||(e.animationState=pOe(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Zk(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:i}=this.node.prevProps||{};e!==i&&this.updateAnimationControlsSubscription()}unmount(){var e;this.node.animationState.reset(),(e=this.unmountControls)===null||e===void 0||e.call(this)}}let gOe=0;class _Oe extends $g{constructor(){super(...arguments),this.id=gOe++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:i}=this.node.presenceContext,{isPresent:o}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===o)return;const l=this.node.animationState.setActive("exit",!e);i&&!e&&l.then(()=>i(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const yOe={animation:{Feature:mOe},exit:{Feature:_Oe}};function iR(n,e,i,o={passive:!0}){return n.addEventListener(e,i,o),()=>n.removeEventListener(e,i)}function DR(n){return{point:{x:n.pageX,y:n.pageY}}}const EOe=n=>e=>I3(e)&&n(e,DR(e));function kC(n,e,i,o){return iR(n,e,EOe(i),o)}const uY=(n,e)=>Math.abs(n-e);function vOe(n,e){const i=uY(n.x,e.x),o=uY(n.y,e.y);return Math.sqrt(i**2+o**2)}class $te{constructor(e,i,{transformPagePoint:o,contextWindow:l,dragSnapToOrigin:u=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const R=fU(this.lastMoveEventInfo,this.history),O=this.startEvent!==null,L=vOe(R.offset,{x:0,y:0})>=3;if(!O&&!L)return;const{point:D}=R,{timestamp:U}=Ma;this.history.push({...D,timestamp:U});const{onStart:B,onMove:Y}=this.handlers;O||(B&&B(this.lastMoveEvent,R),this.startEvent=this.lastMoveEvent),Y&&Y(this.lastMoveEvent,R)},this.handlePointerMove=(R,O)=>{this.lastMoveEvent=R,this.lastMoveEventInfo=pU(O,this.transformPagePoint),cs.update(this.updatePoint,!0)},this.handlePointerUp=(R,O)=>{this.end();const{onEnd:L,onSessionEnd:D,resumeAnimation:U}=this.handlers;if(this.dragSnapToOrigin&&U&&U(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const B=fU(R.type==="pointercancel"?this.lastMoveEventInfo:pU(O,this.transformPagePoint),this.history);this.startEvent&&L&&L(R,B),D&&D(R,B)},!I3(e))return;this.dragSnapToOrigin=u,this.handlers=i,this.transformPagePoint=o,this.contextWindow=l||window;const f=DR(e),y=pU(f,this.transformPagePoint),{point:v}=y,{timestamp:b}=Ma;this.history=[{...v,timestamp:b}];const{onSessionStart:C}=i;C&&C(e,fU(y,this.history)),this.removeListeners=xR(kC(this.contextWindow,"pointermove",this.handlePointerMove),kC(this.contextWindow,"pointerup",this.handlePointerUp),kC(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Dg(this.updatePoint)}}function pU(n,e){return e?{point:e(n.point)}:n}function dY(n,e){return{x:n.x-e.x,y:n.y-e.y}}function fU({point:n},e){return{point:n,delta:dY(n,Kte(e)),offset:dY(n,SOe(e)),velocity:bOe(e,.1)}}function SOe(n){return n[0]}function Kte(n){return n[n.length-1]}function bOe(n,e){if(n.length<2)return{x:0,y:0};let i=n.length-1,o=null;const l=Kte(n);for(;i>=0&&(o=n[i],!(l.timestamp-o.timestamp>Uf(e)));)i--;if(!o)return{x:0,y:0};const u=Vf(l.timestamp-o.timestamp);if(u===0)return{x:0,y:0};const f={x:(l.x-o.x)/u,y:(l.y-o.y)/u};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}const qte=1e-4,wOe=1-qte,TOe=1+qte,Yte=.01,COe=0-Yte,ROe=0+Yte;function gu(n){return n.max-n.min}function IOe(n,e,i){return Math.abs(n-e)<=i}function hY(n,e,i,o=.5){n.origin=o,n.originPoint=Rs(e.min,e.max,n.origin),n.scale=gu(i)/gu(e),n.translate=Rs(i.min,i.max,n.origin)-n.originPoint,(n.scale>=wOe&&n.scale<=TOe||isNaN(n.scale))&&(n.scale=1),(n.translate>=COe&&n.translate<=ROe||isNaN(n.translate))&&(n.translate=0)}function NC(n,e,i,o){hY(n.x,e.x,i.x,o?o.originX:void 0),hY(n.y,e.y,i.y,o?o.originY:void 0)}function pY(n,e,i){n.min=i.min+e.min,n.max=n.min+gu(e)}function AOe(n,e,i){pY(n.x,e.x,i.x),pY(n.y,e.y,i.y)}function fY(n,e,i){n.min=e.min-i.min,n.max=n.min+gu(e)}function xC(n,e,i){fY(n.x,e.x,i.x),fY(n.y,e.y,i.y)}function POe(n,{min:e,max:i},o){return e!==void 0&&n<e?n=o?Rs(e,n,o.min):Math.max(n,e):i!==void 0&&n>i&&(n=o?Rs(i,n,o.max):Math.min(n,i)),n}function mY(n,e,i){return{min:e!==void 0?n.min+e:void 0,max:i!==void 0?n.max+i-(n.max-n.min):void 0}}function OOe(n,{top:e,left:i,bottom:o,right:l}){return{x:mY(n.x,i,l),y:mY(n.y,e,o)}}function gY(n,e){let i=e.min-n.min,o=e.max-n.max;return e.max-e.min<n.max-n.min&&([i,o]=[o,i]),{min:i,max:o}}function kOe(n,e){return{x:gY(n.x,e.x),y:gY(n.y,e.y)}}function NOe(n,e){let i=.5;const o=gu(n),l=gu(e);return l>o?i=TS(e.min,e.max-o,n.min):o>l&&(i=TS(n.min,n.max-l,e.min)),Hf(0,1,i)}function xOe(n,e){const i={};return e.min!==void 0&&(i.min=e.min-n.min),e.max!==void 0&&(i.max=e.max-n.min),i}const OV=.35;function DOe(n=OV){return n===!1?n=0:n===!0&&(n=OV),{x:_Y(n,"left","right"),y:_Y(n,"top","bottom")}}function _Y(n,e,i){return{min:yY(n,e),max:yY(n,i)}}function yY(n,e){return typeof n=="number"?n:n[e]||0}const EY=()=>({translate:0,scale:1,origin:0,originPoint:0}),K0=()=>({x:EY(),y:EY()}),vY=()=>({min:0,max:0}),lo=()=>({x:vY(),y:vY()});function id(n){return[n("x"),n("y")]}function Xte({top:n,left:e,right:i,bottom:o}){return{x:{min:e,max:i},y:{min:n,max:o}}}function LOe({x:n,y:e}){return{top:e.min,right:n.max,bottom:e.max,left:n.min}}function MOe(n,e){if(!e)return n;const i=e({x:n.left,y:n.top}),o=e({x:n.right,y:n.bottom});return{top:i.y,left:i.x,bottom:o.y,right:o.x}}function mU(n){return n===void 0||n===1}function kV({scale:n,scaleX:e,scaleY:i}){return!mU(n)||!mU(e)||!mU(i)}function Ty(n){return kV(n)||Jte(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function Jte(n){return SY(n.x)||SY(n.y)}function SY(n){return n&&n!=="0%"}function ik(n,e,i){const o=n-i,l=e*o;return i+l}function bY(n,e,i,o,l){return l!==void 0&&(n=ik(n,l,o)),ik(n,i,o)+e}function NV(n,e=0,i=1,o,l){n.min=bY(n.min,e,i,o,l),n.max=bY(n.max,e,i,o,l)}function Qte(n,{x:e,y:i}){NV(n.x,e.translate,e.scale,e.originPoint),NV(n.y,i.translate,i.scale,i.originPoint)}const wY=.999999999999,TY=1.0000000000001;function UOe(n,e,i,o=!1){const l=i.length;if(!l)return;e.x=e.y=1;let u,f;for(let y=0;y<l;y++){u=i[y],f=u.projectionDelta;const{visualElement:v}=u.options;v&&v.props.style&&v.props.style.display==="contents"||(o&&u.options.layoutScroll&&u.scroll&&u!==u.root&&Y0(n,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),f&&(e.x*=f.x.scale,e.y*=f.y.scale,Qte(n,f)),o&&Ty(u.latestValues)&&Y0(n,u.latestValues))}e.x<TY&&e.x>wY&&(e.x=1),e.y<TY&&e.y>wY&&(e.y=1)}function q0(n,e){n.min=n.min+e,n.max=n.max+e}function CY(n,e,i,o,l=.5){const u=Rs(n.min,n.max,l);NV(n,e,i,u,o)}function Y0(n,e){CY(n.x,e.x,e.scaleX,e.scale,e.originX),CY(n.y,e.y,e.scaleY,e.scale,e.originY)}function Zte(n,e){return Xte(MOe(n.getBoundingClientRect(),e))}function VOe(n,e,i){const o=Zte(n,i),{scroll:l}=e;return l&&(q0(o.x,l.offset.x),q0(o.y,l.offset.y)),o}const ene=({current:n})=>n?n.ownerDocument.defaultView:null,jOe=new WeakMap;class FOe{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=lo(),this.visualElement=e}start(e,{snapToCursor:i=!1}={}){const{presenceContext:o}=this.visualElement;if(o&&o.isPresent===!1)return;const l=C=>{const{dragSnapToOrigin:R}=this.getProps();R?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(DR(C).point)},u=(C,R)=>{const{drag:O,dragPropagation:L,onDragStart:D}=this.getProps();if(O&&!L&&(this.openDragLock&&this.openDragLock(),this.openDragLock=N1e(O),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),id(B=>{let Y=this.getAxisMotionValue(B).get()||0;if(Op.test(Y)){const{projection:W}=this.visualElement;if(W&&W.layout){const ne=W.layout.layoutBox[B];ne&&(Y=gu(ne)*(parseFloat(Y)/100))}}this.originPoint[B]=Y}),D&&cs.postRender(()=>D(C,R)),bV(this.visualElement,"transform");const{animationState:U}=this.visualElement;U&&U.setActive("whileDrag",!0)},f=(C,R)=>{const{dragPropagation:O,dragDirectionLock:L,onDirectionLock:D,onDrag:U}=this.getProps();if(!O&&!this.openDragLock)return;const{offset:B}=R;if(L&&this.currentDirection===null){this.currentDirection=BOe(B),this.currentDirection!==null&&D&&D(this.currentDirection);return}this.updateAxis("x",R.point,B),this.updateAxis("y",R.point,B),this.visualElement.render(),U&&U(C,R)},y=(C,R)=>this.stop(C,R),v=()=>id(C=>{var R;return this.getAnimationState(C)==="paused"&&((R=this.getAxisMotionValue(C).animation)===null||R===void 0?void 0:R.play())}),{dragSnapToOrigin:b}=this.getProps();this.panSession=new $te(e,{onSessionStart:l,onStart:u,onMove:f,onSessionEnd:y,resumeAnimation:v},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:b,contextWindow:ene(this.visualElement)})}stop(e,i){const o=this.isDragging;if(this.cancel(),!o)return;const{velocity:l}=i;this.startAnimation(l);const{onDragEnd:u}=this.getProps();u&&cs.postRender(()=>u(e,i))}cancel(){this.isDragging=!1;const{projection:e,animationState:i}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:o}=this.getProps();!o&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(e,i,o){const{drag:l}=this.getProps();if(!o||!YP(e,l,this.currentDirection))return;const u=this.getAxisMotionValue(e);let f=this.originPoint[e]+o[e];this.constraints&&this.constraints[e]&&(f=POe(f,this.constraints[e],this.elastic[e])),u.set(f)}resolveConstraints(){var e;const{dragConstraints:i,dragElastic:o}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,u=this.constraints;i&&H0(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&l?this.constraints=OOe(l.layoutBox,i):this.constraints=!1,this.elastic=DOe(o),u!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&id(f=>{this.constraints!==!1&&this.getAxisMotionValue(f)&&(this.constraints[f]=xOe(l.layoutBox[f],this.constraints[f]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:i}=this.getProps();if(!e||!H0(e))return!1;const o=e.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const u=VOe(o,l.root,this.visualElement.getTransformPagePoint());let f=kOe(l.layout.layoutBox,u);if(i){const y=i(LOe(f));this.hasMutatedConstraints=!!y,y&&(f=Xte(y))}return f}startAnimation(e){const{drag:i,dragMomentum:o,dragElastic:l,dragTransition:u,dragSnapToOrigin:f,onDragTransitionEnd:y}=this.getProps(),v=this.constraints||{},b=id(C=>{if(!YP(C,i,this.currentDirection))return;let R=v&&v[C]||{};f&&(R={min:0,max:0});const O=l?200:1e6,L=l?40:1e7,D={type:"inertia",velocity:o?e[C]:0,bounceStiffness:O,bounceDamping:L,timeConstant:750,restDelta:1,restSpeed:10,...u,...R};return this.startAxisValueAnimation(C,D)});return Promise.all(b).then(y)}startAxisValueAnimation(e,i){const o=this.getAxisMotionValue(e);return bV(this.visualElement,e),o.start(j3(e,o,0,i,this.visualElement,!1))}stopAnimation(){id(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){id(e=>{var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(e){var i;return(i=this.getAxisMotionValue(e).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(e){const i=`_drag${e.toUpperCase()}`,o=this.visualElement.getProps(),l=o[i];return l||this.visualElement.getValue(e,(o.initial?o.initial[e]:void 0)||0)}snapToCursor(e){id(i=>{const{drag:o}=this.getProps();if(!YP(i,o,this.currentDirection))return;const{projection:l}=this.visualElement,u=this.getAxisMotionValue(i);if(l&&l.layout){const{min:f,max:y}=l.layout.layoutBox[i];u.set(e[i]-Rs(f,y,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:i}=this.getProps(),{projection:o}=this.visualElement;if(!H0(i)||!o||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};id(f=>{const y=this.getAxisMotionValue(f);if(y&&this.constraints!==!1){const v=y.get();l[f]=NOe({min:v,max:v},this.constraints[f])}});const{transformTemplate:u}=this.visualElement.getProps();this.visualElement.current.style.transform=u?u({},""):"none",o.root&&o.root.updateScroll(),o.updateLayout(),this.resolveConstraints(),id(f=>{if(!YP(f,e,null))return;const y=this.getAxisMotionValue(f),{min:v,max:b}=this.constraints[f];y.set(Rs(v,b,l[f]))})}addListeners(){if(!this.visualElement.current)return;jOe.set(this.visualElement,this);const e=this.visualElement.current,i=kC(e,"pointerdown",v=>{const{drag:b,dragListener:C=!0}=this.getProps();b&&C&&this.start(v)}),o=()=>{const{dragConstraints:v}=this.getProps();H0(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,u=l.addEventListener("measure",o);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),cs.read(o);const f=iR(window,"resize",()=>this.scalePositionWithinConstraints()),y=l.addEventListener("didUpdate",(({delta:v,hasLayoutChanged:b})=>{this.isDragging&&b&&(id(C=>{const R=this.getAxisMotionValue(C);R&&(this.originPoint[C]+=v[C].translate,R.set(R.get()+v[C].translate))}),this.visualElement.render())}));return()=>{f(),i(),u(),y&&y()}}getProps(){const e=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:o=!1,dragPropagation:l=!1,dragConstraints:u=!1,dragElastic:f=OV,dragMomentum:y=!0}=e;return{...e,drag:i,dragDirectionLock:o,dragPropagation:l,dragConstraints:u,dragElastic:f,dragMomentum:y}}}function YP(n,e,i){return(e===!0||e===n)&&(i===null||i===n)}function BOe(n,e=10){let i=null;return Math.abs(n.y)>e?i="y":Math.abs(n.x)>e&&(i="x"),i}class zOe extends $g{constructor(e){super(e),this.removeGroupControls=mu,this.removeListeners=mu,this.controls=new FOe(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||mu}unmount(){this.removeGroupControls(),this.removeListeners()}}const RY=n=>(e,i)=>{n&&cs.postRender(()=>n(e,i))};class WOe extends $g{constructor(){super(...arguments),this.removePointerDownListener=mu}onPointerDown(e){this.session=new $te(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:ene(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:i,onPan:o,onPanEnd:l}=this.node.getProps();return{onSessionStart:RY(e),onStart:RY(i),onMove:o,onEnd:(u,f)=>{delete this.session,l&&cs.postRender(()=>l(u,f))}}}mount(){this.removePointerDownListener=kC(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const AO={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function IY(n,e){return e.max===e.min?0:n/(e.max-e.min)*100}const KT={correct:(n,e)=>{if(!e.target)return n;if(typeof n=="string")if(Yn.test(n))n=parseFloat(n);else return n;const i=IY(n,e.target.x),o=IY(n,e.target.y);return`${i}% ${o}%`}},GOe={correct:(n,{treeScale:e,projectionDelta:i})=>{const o=n,l=Lg.parse(n);if(l.length>5)return o;const u=Lg.createTransformer(n),f=typeof l[0]!="number"?1:0,y=i.x.scale*e.x,v=i.y.scale*e.y;l[0+f]/=y,l[1+f]/=v;const b=Rs(y,v,.5);return typeof l[2+f]=="number"&&(l[2+f]/=b),typeof l[3+f]=="number"&&(l[3+f]/=b),u(l)}};class HOe extends k.Component{componentDidMount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:o,layoutId:l}=this.props,{projection:u}=e;d1e($Oe),u&&(i.group&&i.group.add(u),o&&o.register&&l&&o.register(u),u.root.didUpdate(),u.addEventListener("animationComplete",()=>{this.safeToRemove()}),u.setOptions({...u.options,onExitComplete:()=>this.safeToRemove()})),AO.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:i,visualElement:o,drag:l,isPresent:u}=this.props,f=o.projection;return f&&(f.isPresent=u,l||e.layoutDependency!==i||i===void 0?f.willUpdate():this.safeToRemove(),e.isPresent!==u&&(u?f.promote():f.relegate()||cs.postRender(()=>{const y=f.getStack();(!y||!y.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),f3.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:o}=this.props,{projection:l}=e;l&&(l.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(l),o&&o.deregister&&o.deregister(l))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function tne(n){const[e,i]=c3(),o=k.useContext(s3);return S.jsx(HOe,{...n,layoutGroup:o,switchLayoutGroup:k.useContext(Hee),isPresent:e,safeToRemove:i})}const $Oe={borderRadius:{...KT,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:KT,borderTopRightRadius:KT,borderBottomLeftRadius:KT,borderBottomRightRadius:KT,boxShadow:GOe};function KOe(n,e,i){const o=pc(n)?n:nR(n);return o.start(j3("",o,e,i)),o.animation}function qOe(n){return n instanceof SVGElement&&n.tagName!=="svg"}const YOe=(n,e)=>n.depth-e.depth;class XOe{constructor(){this.children=[],this.isDirty=!1}add(e){A3(this.children,e),this.isDirty=!0}remove(e){P3(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(YOe),this.isDirty=!1,this.children.forEach(e)}}function JOe(n,e){const i=kp.now(),o=({timestamp:l})=>{const u=l-i;u>=e&&(Dg(o),n(u-e))};return cs.read(o,!0),()=>Dg(o)}const nne=["TopLeft","TopRight","BottomLeft","BottomRight"],QOe=nne.length,AY=n=>typeof n=="string"?parseFloat(n):n,PY=n=>typeof n=="number"||Yn.test(n);function ZOe(n,e,i,o,l,u){l?(n.opacity=Rs(0,i.opacity!==void 0?i.opacity:1,eke(o)),n.opacityExit=Rs(e.opacity!==void 0?e.opacity:1,0,tke(o))):u&&(n.opacity=Rs(e.opacity!==void 0?e.opacity:1,i.opacity!==void 0?i.opacity:1,o));for(let f=0;f<QOe;f++){const y=`border${nne[f]}Radius`;let v=OY(e,y),b=OY(i,y);if(v===void 0&&b===void 0)continue;v||(v=0),b||(b=0),v===0||b===0||PY(v)===PY(b)?(n[y]=Math.max(Rs(AY(v),AY(b),o),0),(Op.test(b)||Op.test(v))&&(n[y]+="%")):n[y]=b}(e.rotate||i.rotate)&&(n.rotate=Rs(e.rotate||0,i.rotate||0,o))}function OY(n,e){return n[e]!==void 0?n[e]:n.borderRadius}const eke=rne(0,.5,Ste),tke=rne(.5,.95,mu);function rne(n,e,i){return o=>o<n?0:o>e?1:i(TS(n,e,o))}function kY(n,e){n.min=e.min,n.max=e.max}function nd(n,e){kY(n.x,e.x),kY(n.y,e.y)}function NY(n,e){n.translate=e.translate,n.scale=e.scale,n.originPoint=e.originPoint,n.origin=e.origin}function xY(n,e,i,o,l){return n-=e,n=ik(n,1/i,o),l!==void 0&&(n=ik(n,1/l,o)),n}function nke(n,e=0,i=1,o=.5,l,u=n,f=n){if(Op.test(e)&&(e=parseFloat(e),e=Rs(f.min,f.max,e/100)-f.min),typeof e!="number")return;let y=Rs(u.min,u.max,o);n===u&&(y-=e),n.min=xY(n.min,e,i,y,l),n.max=xY(n.max,e,i,y,l)}function DY(n,e,[i,o,l],u,f){nke(n,e[i],e[o],e[l],e.scale,u,f)}const rke=["x","scaleX","originX"],ike=["y","scaleY","originY"];function LY(n,e,i,o){DY(n.x,e,rke,i?i.x:void 0,o?o.x:void 0),DY(n.y,e,ike,i?i.y:void 0,o?o.y:void 0)}function MY(n){return n.translate===0&&n.scale===1}function ine(n){return MY(n.x)&&MY(n.y)}function UY(n,e){return n.min===e.min&&n.max===e.max}function ske(n,e){return UY(n.x,e.x)&&UY(n.y,e.y)}function VY(n,e){return Math.round(n.min)===Math.round(e.min)&&Math.round(n.max)===Math.round(e.max)}function sne(n,e){return VY(n.x,e.x)&&VY(n.y,e.y)}function jY(n){return gu(n.x)/gu(n.y)}function FY(n,e){return n.translate===e.translate&&n.scale===e.scale&&n.originPoint===e.originPoint}class oke{constructor(){this.members=[]}add(e){A3(this.members,e),e.scheduleRender()}remove(e){if(P3(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(e){const i=this.members.findIndex(l=>e===l);if(i===0)return!1;let o;for(let l=i;l>=0;l--){const u=this.members[l];if(u.isPresent!==!1){o=u;break}}return o?(this.promote(o),!0):!1}promote(e,i){const o=this.lead;if(e!==o&&(this.prevLead=o,this.lead=e,e.show(),o)){o.instance&&o.scheduleRender(),e.scheduleRender(),e.resumeFrom=o,i&&(e.resumeFrom.preserveOpacity=!0),o.snapshot&&(e.snapshot=o.snapshot,e.snapshot.latestValues=o.animationValues||o.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:l}=e.options;l===!1&&o.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:i,resumingFrom:o}=e;i.onExitComplete&&i.onExitComplete(),o&&o.options.onExitComplete&&o.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function ake(n,e,i){let o="";const l=n.x.translate/e.x,u=n.y.translate/e.y,f=(i==null?void 0:i.z)||0;if((l||u||f)&&(o=`translate3d(${l}px, ${u}px, ${f}px) `),(e.x!==1||e.y!==1)&&(o+=`scale(${1/e.x}, ${1/e.y}) `),i){const{transformPerspective:b,rotate:C,rotateX:R,rotateY:O,skewX:L,skewY:D}=i;b&&(o=`perspective(${b}px) ${o}`),C&&(o+=`rotate(${C}deg) `),R&&(o+=`rotateX(${R}deg) `),O&&(o+=`rotateY(${O}deg) `),L&&(o+=`skewX(${L}deg) `),D&&(o+=`skewY(${D}deg) `)}const y=n.x.scale*e.x,v=n.y.scale*e.y;return(y!==1||v!==1)&&(o+=`scale(${y}, ${v})`),o||"none"}const Cy={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},hC=typeof window<"u"&&window.MotionDebug!==void 0,gU=["","X","Y","Z"],cke={visibility:"hidden"},BY=1e3;let lke=0;function _U(n,e,i,o){const{latestValues:l}=e;l[n]&&(i[n]=l[n],e.setStaticValue(n,0),o&&(o[n]=0))}function one(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:e}=n.options;if(!e)return;const i=fte(e);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:l,layoutId:u}=n.options;window.MotionCancelOptimisedAnimation(i,"transform",cs,!(l||u))}const{parent:o}=n;o&&!o.hasCheckedOptimisedAppear&&one(o)}function ane({attachResizeListener:n,defaultParent:e,measureScroll:i,checkIsScrollRoot:o,resetTransform:l}){return class{constructor(f={},y=e==null?void 0:e()){this.id=lke++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,hC&&(Cy.totalNodes=Cy.resolvedTargetDeltas=Cy.recalculatedProjection=0),this.nodes.forEach(hke),this.nodes.forEach(_ke),this.nodes.forEach(yke),this.nodes.forEach(pke),hC&&window.MotionDebug.record(Cy)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=f,this.root=y?y.root||y:this,this.path=y?[...y.path,y]:[],this.parent=y,this.depth=y?y.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new XOe)}addEventListener(f,y){return this.eventHandlers.has(f)||this.eventHandlers.set(f,new O3),this.eventHandlers.get(f).add(y)}notifyListeners(f,...y){const v=this.eventHandlers.get(f);v&&v.notify(...y)}hasListeners(f){return this.eventHandlers.has(f)}mount(f,y=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=qOe(f),this.instance=f;const{layoutId:v,layout:b,visualElement:C}=this.options;if(C&&!C.current&&C.mount(f),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),y&&(b||v)&&(this.isLayoutDirty=!0),n){let R;const O=()=>this.root.updateBlockedByResize=!1;n(f,()=>{this.root.updateBlockedByResize=!0,R&&R(),R=JOe(O,250),AO.hasAnimatedSinceResize&&(AO.hasAnimatedSinceResize=!1,this.nodes.forEach(WY))})}v&&this.root.registerSharedNode(v,this),this.options.animate!==!1&&C&&(v||b)&&this.addEventListener("didUpdate",({delta:R,hasLayoutChanged:O,hasRelativeTargetChanged:L,layout:D})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const U=this.options.transition||C.getDefaultTransition()||wke,{onLayoutAnimationStart:B,onLayoutAnimationComplete:Y}=C.getProps(),W=!this.targetLayout||!sne(this.targetLayout,D)||L,ne=!O&&L;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||ne||O&&(W||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(R,ne);const le={...T3(U,"layout"),onPlay:B,onComplete:Y};(C.shouldReduceMotion||this.options.layoutRoot)&&(le.delay=0,le.type=!1),this.startAnimation(le)}else O||WY(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=D})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const f=this.getStack();f&&f.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Dg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Eke),this.animationId++)}getTransformTemplate(){const{visualElement:f}=this.options;return f&&f.getProps().transformTemplate}willUpdate(f=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&one(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let C=0;C<this.path.length;C++){const R=this.path[C];R.shouldResetTransform=!0,R.updateScroll("snapshot"),R.options.layoutRoot&&R.willUpdate(!1)}const{layoutId:y,layout:v}=this.options;if(y===void 0&&!v)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),f&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(zY);return}this.isUpdating||this.nodes.forEach(mke),this.isUpdating=!1,this.nodes.forEach(gke),this.nodes.forEach(uke),this.nodes.forEach(dke),this.clearAllSnapshots();const y=kp.now();Ma.delta=Hf(0,1e3/60,y-Ma.timestamp),Ma.timestamp=y,Ma.isProcessing=!0,aU.update.process(Ma),aU.preRender.process(Ma),aU.render.process(Ma),Ma.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,f3.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(fke),this.sharedNodes.forEach(vke)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,cs.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){cs.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const f=this.layout;this.layout=this.measure(!1),this.layoutCorrected=lo(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:y}=this.options;y&&y.notify("LayoutMeasure",this.layout.layoutBox,f?f.layoutBox:void 0)}updateScroll(f="measure"){let y=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===f&&(y=!1),y){const v=o(this.instance);this.scroll={animationId:this.root.animationId,phase:f,isRoot:v,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!l)return;const f=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,y=this.projectionDelta&&!ine(this.projectionDelta),v=this.getTransformTemplate(),b=v?v(this.latestValues,""):void 0,C=b!==this.prevTransformTemplateValue;f&&(y||Ty(this.latestValues)||C)&&(l(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(f=!0){const y=this.measurePageBox();let v=this.removeElementScroll(y);return f&&(v=this.removeTransform(v)),Tke(v),{animationId:this.root.animationId,measuredBox:y,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){var f;const{visualElement:y}=this.options;if(!y)return lo();const v=y.measureViewportBox();if(!(((f=this.scroll)===null||f===void 0?void 0:f.wasRoot)||this.path.some(Cke))){const{scroll:C}=this.root;C&&(q0(v.x,C.offset.x),q0(v.y,C.offset.y))}return v}removeElementScroll(f){var y;const v=lo();if(nd(v,f),!((y=this.scroll)===null||y===void 0)&&y.wasRoot)return v;for(let b=0;b<this.path.length;b++){const C=this.path[b],{scroll:R,options:O}=C;C!==this.root&&R&&O.layoutScroll&&(R.wasRoot&&nd(v,f),q0(v.x,R.offset.x),q0(v.y,R.offset.y))}return v}applyTransform(f,y=!1){const v=lo();nd(v,f);for(let b=0;b<this.path.length;b++){const C=this.path[b];!y&&C.options.layoutScroll&&C.scroll&&C!==C.root&&Y0(v,{x:-C.scroll.offset.x,y:-C.scroll.offset.y}),Ty(C.latestValues)&&Y0(v,C.latestValues)}return Ty(this.latestValues)&&Y0(v,this.latestValues),v}removeTransform(f){const y=lo();nd(y,f);for(let v=0;v<this.path.length;v++){const b=this.path[v];if(!b.instance||!Ty(b.latestValues))continue;kV(b.latestValues)&&b.updateSnapshot();const C=lo(),R=b.measurePageBox();nd(C,R),LY(y,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,C)}return Ty(this.latestValues)&&LY(y,this.latestValues),y}setTargetDelta(f){this.targetDelta=f,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(f){this.options={...this.options,...f,crossfade:f.crossfade!==void 0?f.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ma.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(f=!1){var y;const v=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=v.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=v.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=v.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==v;if(!(f||b&&this.isSharedProjectionDirty||this.isProjectionDirty||!((y=this.parent)===null||y===void 0)&&y.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:R,layoutId:O}=this.options;if(!(!this.layout||!(R||O))){if(this.resolvedRelativeTargetAt=Ma.timestamp,!this.targetDelta&&!this.relativeTarget){const L=this.getClosestProjectingParent();L&&L.layout&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=lo(),this.relativeTargetOrigin=lo(),xC(this.relativeTargetOrigin,this.layout.layoutBox,L.layout.layoutBox),nd(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=lo(),this.targetWithTransforms=lo()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),AOe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):nd(this.target,this.layout.layoutBox),Qte(this.target,this.targetDelta)):nd(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const L=this.getClosestProjectingParent();L&&!!L.resumingFrom==!!this.resumingFrom&&!L.options.layoutScroll&&L.target&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=lo(),this.relativeTargetOrigin=lo(),xC(this.relativeTargetOrigin,this.target,L.target),nd(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}hC&&Cy.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||kV(this.parent.latestValues)||Jte(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var f;const y=this.getLead(),v=!!this.resumingFrom||this!==y;let b=!0;if((this.isProjectionDirty||!((f=this.parent)===null||f===void 0)&&f.isProjectionDirty)&&(b=!1),v&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===Ma.timestamp&&(b=!1),b)return;const{layout:C,layoutId:R}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(C||R))return;nd(this.layoutCorrected,this.layout.layoutBox);const O=this.treeScale.x,L=this.treeScale.y;UOe(this.layoutCorrected,this.treeScale,this.path,v),y.layout&&!y.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(y.target=y.layout.layoutBox,y.targetWithTransforms=lo());const{target:D}=y;if(!D){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(NY(this.prevProjectionDelta.x,this.projectionDelta.x),NY(this.prevProjectionDelta.y,this.projectionDelta.y)),NC(this.projectionDelta,this.layoutCorrected,D,this.latestValues),(this.treeScale.x!==O||this.treeScale.y!==L||!FY(this.projectionDelta.x,this.prevProjectionDelta.x)||!FY(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",D)),hC&&Cy.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(f=!0){var y;if((y=this.options.visualElement)===null||y===void 0||y.scheduleRender(),f){const v=this.getStack();v&&v.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=K0(),this.projectionDelta=K0(),this.projectionDeltaWithTransform=K0()}setAnimationOrigin(f,y=!1){const v=this.snapshot,b=v?v.latestValues:{},C={...this.latestValues},R=K0();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!y;const O=lo(),L=v?v.source:void 0,D=this.layout?this.layout.source:void 0,U=L!==D,B=this.getStack(),Y=!B||B.members.length<=1,W=!!(U&&!Y&&this.options.crossfade===!0&&!this.path.some(bke));this.animationProgress=0;let ne;this.mixTargetDelta=le=>{const re=le/1e3;GY(R.x,f.x,re),GY(R.y,f.y,re),this.setTargetDelta(R),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(xC(O,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Ske(this.relativeTarget,this.relativeTargetOrigin,O,re),ne&&ske(this.relativeTarget,ne)&&(this.isProjectionDirty=!1),ne||(ne=lo()),nd(ne,this.relativeTarget)),U&&(this.animationValues=C,ZOe(C,b,this.latestValues,re,W,Y)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=re},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(f){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Dg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=cs.update(()=>{AO.hasAnimatedSinceResize=!0,this.currentAnimation=KOe(0,BY,{...f,onUpdate:y=>{this.mixTargetDelta(y),f.onUpdate&&f.onUpdate(y)},onComplete:()=>{f.onComplete&&f.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const f=this.getStack();f&&f.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(BY),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const f=this.getLead();let{targetWithTransforms:y,target:v,layout:b,latestValues:C}=f;if(!(!y||!v||!b)){if(this!==f&&this.layout&&b&&cne(this.options.animationType,this.layout.layoutBox,b.layoutBox)){v=this.target||lo();const R=gu(this.layout.layoutBox.x);v.x.min=f.target.x.min,v.x.max=v.x.min+R;const O=gu(this.layout.layoutBox.y);v.y.min=f.target.y.min,v.y.max=v.y.min+O}nd(y,v),Y0(y,C),NC(this.projectionDeltaWithTransform,this.layoutCorrected,y,C)}}registerSharedNode(f,y){this.sharedNodes.has(f)||this.sharedNodes.set(f,new oke),this.sharedNodes.get(f).add(y);const b=y.options.initialPromotionConfig;y.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(y):void 0})}isLead(){const f=this.getStack();return f?f.lead===this:!0}getLead(){var f;const{layoutId:y}=this.options;return y?((f=this.getStack())===null||f===void 0?void 0:f.lead)||this:this}getPrevLead(){var f;const{layoutId:y}=this.options;return y?(f=this.getStack())===null||f===void 0?void 0:f.prevLead:void 0}getStack(){const{layoutId:f}=this.options;if(f)return this.root.sharedNodes.get(f)}promote({needsReset:f,transition:y,preserveFollowOpacity:v}={}){const b=this.getStack();b&&b.promote(this,v),f&&(this.projectionDelta=void 0,this.needsReset=!0),y&&this.setOptions({transition:y})}relegate(){const f=this.getStack();return f?f.relegate(this):!1}resetSkewAndRotation(){const{visualElement:f}=this.options;if(!f)return;let y=!1;const{latestValues:v}=f;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(y=!0),!y)return;const b={};v.z&&_U("z",f,b,this.animationValues);for(let C=0;C<gU.length;C++)_U(`rotate${gU[C]}`,f,b,this.animationValues),_U(`skew${gU[C]}`,f,b,this.animationValues);f.render();for(const C in b)f.setStaticValue(C,b[C]),this.animationValues&&(this.animationValues[C]=b[C]);f.scheduleRender()}getProjectionStyles(f){var y,v;if(!this.instance||this.isSVG)return;if(!this.isVisible)return cke;const b={visibility:""},C=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,b.opacity="",b.pointerEvents=RO(f==null?void 0:f.pointerEvents)||"",b.transform=C?C(this.latestValues,""):"none",b;const R=this.getLead();if(!this.projectionDelta||!this.layout||!R.target){const U={};return this.options.layoutId&&(U.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,U.pointerEvents=RO(f==null?void 0:f.pointerEvents)||""),this.hasProjected&&!Ty(this.latestValues)&&(U.transform=C?C({},""):"none",this.hasProjected=!1),U}const O=R.animationValues||R.latestValues;this.applyTransformsToTarget(),b.transform=ake(this.projectionDeltaWithTransform,this.treeScale,O),C&&(b.transform=C(O,b.transform));const{x:L,y:D}=this.projectionDelta;b.transformOrigin=`${L.origin*100}% ${D.origin*100}% 0`,R.animationValues?b.opacity=R===this?(v=(y=O.opacity)!==null&&y!==void 0?y:this.latestValues.opacity)!==null&&v!==void 0?v:1:this.preserveOpacity?this.latestValues.opacity:O.opacityExit:b.opacity=R===this?O.opacity!==void 0?O.opacity:"":O.opacityExit!==void 0?O.opacityExit:0;for(const U in ZO){if(O[U]===void 0)continue;const{correct:B,applyTo:Y}=ZO[U],W=b.transform==="none"?O[U]:B(O[U],R);if(Y){const ne=Y.length;for(let le=0;le<ne;le++)b[Y[le]]=W}else b[U]=W}return this.options.layoutId&&(b.pointerEvents=R===this?RO(f==null?void 0:f.pointerEvents)||"":"none"),b}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(f=>{var y;return(y=f.currentAnimation)===null||y===void 0?void 0:y.stop()}),this.root.nodes.forEach(zY),this.root.sharedNodes.clear()}}}function uke(n){n.updateLayout()}function dke(n){var e;const i=((e=n.resumeFrom)===null||e===void 0?void 0:e.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&i&&n.hasListeners("didUpdate")){const{layoutBox:o,measuredBox:l}=n.layout,{animationType:u}=n.options,f=i.source!==n.layout.source;u==="size"?id(R=>{const O=f?i.measuredBox[R]:i.layoutBox[R],L=gu(O);O.min=o[R].min,O.max=O.min+L}):cne(u,i.layoutBox,o)&&id(R=>{const O=f?i.measuredBox[R]:i.layoutBox[R],L=gu(o[R]);O.max=O.min+L,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[R].max=n.relativeTarget[R].min+L)});const y=K0();NC(y,o,i.layoutBox);const v=K0();f?NC(v,n.applyTransform(l,!0),i.measuredBox):NC(v,o,i.layoutBox);const b=!ine(y);let C=!1;if(!n.resumeFrom){const R=n.getClosestProjectingParent();if(R&&!R.resumeFrom){const{snapshot:O,layout:L}=R;if(O&&L){const D=lo();xC(D,i.layoutBox,O.layoutBox);const U=lo();xC(U,o,L.layoutBox),sne(D,U)||(C=!0),R.options.layoutRoot&&(n.relativeTarget=U,n.relativeTargetOrigin=D,n.relativeParent=R)}}}n.notifyListeners("didUpdate",{layout:o,snapshot:i,delta:v,layoutDelta:y,hasLayoutChanged:b,hasRelativeTargetChanged:C})}else if(n.isLead()){const{onExitComplete:o}=n.options;o&&o()}n.options.transition=void 0}function hke(n){hC&&Cy.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function pke(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function fke(n){n.clearSnapshot()}function zY(n){n.clearMeasurements()}function mke(n){n.isLayoutDirty=!1}function gke(n){const{visualElement:e}=n.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),n.resetTransform()}function WY(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function _ke(n){n.resolveTargetDelta()}function yke(n){n.calcProjection()}function Eke(n){n.resetSkewAndRotation()}function vke(n){n.removeLeadSnapshot()}function GY(n,e,i){n.translate=Rs(e.translate,0,i),n.scale=Rs(e.scale,1,i),n.origin=e.origin,n.originPoint=e.originPoint}function HY(n,e,i,o){n.min=Rs(e.min,i.min,o),n.max=Rs(e.max,i.max,o)}function Ske(n,e,i,o){HY(n.x,e.x,i.x,o),HY(n.y,e.y,i.y,o)}function bke(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const wke={duration:.45,ease:[.4,0,.1,1]},$Y=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),KY=$Y("applewebkit/")&&!$Y("chrome/")?Math.round:mu;function qY(n){n.min=KY(n.min),n.max=KY(n.max)}function Tke(n){qY(n.x),qY(n.y)}function cne(n,e,i){return n==="position"||n==="preserve-aspect"&&!IOe(jY(e),jY(i),.2)}function Cke(n){var e;return n!==n.root&&((e=n.scroll)===null||e===void 0?void 0:e.wasRoot)}const Rke=ane({attachResizeListener:(n,e)=>iR(n,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),yU={current:void 0},lne=ane({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!yU.current){const n=new Rke({});n.mount(window),n.setOptions({layoutScroll:!0}),yU.current=n}return yU.current},resetTransform:(n,e)=>{n.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),Ike={pan:{Feature:WOe},drag:{Feature:zOe,ProjectionNode:lne,MeasureLayout:tne}};function YY(n,e,i){const{props:o}=n;n.animationState&&o.whileHover&&n.animationState.setActive("whileHover",i==="Start");const l="onHover"+i,u=o[l];u&&cs.postRender(()=>u(e,DR(e)))}class Ake extends $g{mount(){const{current:e}=this.node;e&&(this.unmount=I1e(e,i=>(YY(this.node,i,"Start"),o=>YY(this.node,o,"End"))))}unmount(){}}class Pke extends $g{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=xR(iR(this.node.current,"focus",()=>this.onFocus()),iR(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function XY(n,e,i){const{props:o}=n;n.animationState&&o.whileTap&&n.animationState.setActive("whileTap",i==="Start");const l="onTap"+(i==="End"?"":i),u=o[l];u&&cs.postRender(()=>u(e,DR(e)))}class Oke extends $g{mount(){const{current:e}=this.node;e&&(this.unmount=k1e(e,i=>(XY(this.node,i,"Start"),(o,{success:l})=>XY(this.node,o,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const xV=new WeakMap,EU=new WeakMap,kke=n=>{const e=xV.get(n.target);e&&e(n)},Nke=n=>{n.forEach(kke)};function xke({root:n,...e}){const i=n||document;EU.has(i)||EU.set(i,{});const o=EU.get(i),l=JSON.stringify(e);return o[l]||(o[l]=new IntersectionObserver(Nke,{root:n,...e})),o[l]}function Dke(n,e,i){const o=xke(e);return xV.set(n,i),o.observe(n),()=>{xV.delete(n),o.unobserve(n)}}const Lke={some:0,all:1};class Mke extends $g{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:i,margin:o,amount:l="some",once:u}=e,f={root:i?i.current:void 0,rootMargin:o,threshold:typeof l=="number"?l:Lke[l]},y=v=>{const{isIntersecting:b}=v;if(this.isInView===b||(this.isInView=b,u&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:C,onViewportLeave:R}=this.node.getProps(),O=b?C:R;O&&O(v)};return Dke(this.node.current,f,y)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:i}=this.node;["amount","margin","root"].some(Uke(e,i))&&this.startObserver()}unmount(){}}function Uke({viewport:n={}},{viewport:e={}}={}){return i=>n[i]!==e[i]}const Vke={inView:{Feature:Mke},tap:{Feature:Oke},focus:{Feature:Pke},hover:{Feature:Ake}},jke={layout:{ProjectionNode:lne,MeasureLayout:tne}},DV={current:null},une={current:!1};function Fke(){if(une.current=!0,!!l3)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),e=()=>DV.current=n.matches;n.addListener(e),e()}else DV.current=!1}const Bke=[...Lte,lc,Lg],zke=n=>Bke.find(Dte(n)),JY=new WeakMap;function Wke(n,e,i){for(const o in e){const l=e[o],u=i[o];if(pc(l))n.addValue(o,l);else if(pc(u))n.addValue(o,nR(l,{owner:n}));else if(u!==l)if(n.hasValue(o)){const f=n.getValue(o);f.liveStyle===!0?f.jump(l):f.hasAnimated||f.set(l)}else{const f=n.getStaticValue(o);n.addValue(o,nR(f!==void 0?f:l,{owner:n}))}}for(const o in i)e[o]===void 0&&n.removeValue(o);return e}const QY=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Gke{scrapeMotionValuesFromProps(e,i,o){return{}}constructor({parent:e,props:i,presenceContext:o,reducedMotionConfig:l,blockInitialAnimation:u,visualState:f},y={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=M3,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const L=kp.now();this.renderScheduledAt<L&&(this.renderScheduledAt=L,cs.render(this.render,!1,!0))};const{latestValues:v,renderState:b,onUpdate:C}=f;this.onUpdate=C,this.latestValues=v,this.baseTarget={...v},this.initialValues=i.initial?{...v}:{},this.renderState=b,this.parent=e,this.props=i,this.presenceContext=o,this.depth=e?e.depth+1:0,this.reducedMotionConfig=l,this.options=y,this.blockInitialAnimation=!!u,this.isControllingVariants=eN(i),this.isVariantNode=Wee(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:R,...O}=this.scrapeMotionValuesFromProps(i,{},this);for(const L in O){const D=O[L];v[L]!==void 0&&pc(D)&&D.set(v[L],!1)}}mount(e){this.current=e,JY.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,o)=>this.bindToMotionValue(o,i)),une.current||Fke(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:DV.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){JY.delete(this.current),this.projection&&this.projection.unmount(),Dg(this.notifyUpdate),Dg(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const i=this.features[e];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(e,i){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const o=uE.has(e),l=i.on("change",y=>{this.latestValues[e]=y,this.props.onUpdate&&cs.preRender(this.notifyUpdate),o&&this.projection&&(this.projection.isTransformDirty=!0)}),u=i.on("renderRequest",this.scheduleRender);let f;window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,e,i)),this.valueSubscriptions.set(e,()=>{l(),u(),f&&f(),i.owner&&i.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in CS){const i=CS[e];if(!i)continue;const{isEnabled:o,Feature:l}=i;if(!this.features[e]&&l&&o(this.props)&&(this.features[e]=new l(this)),this.features[e]){const u=this.features[e];u.isMounted?u.update():(u.mount(),u.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):lo()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,i){this.latestValues[e]=i}update(e,i){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let o=0;o<QY.length;o++){const l=QY[o];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const u="on"+l,f=e[u];f&&(this.propEventSubscriptions[l]=this.on(l,f))}this.prevMotionValues=Wke(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(e),()=>i.variantChildren.delete(e)}addValue(e,i){const o=this.values.get(e);i!==o&&(o&&this.removeValue(e),this.bindToMotionValue(e,i),this.values.set(e,i),this.latestValues[e]=i.get())}removeValue(e){this.values.delete(e);const i=this.valueSubscriptions.get(e);i&&(i(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,i){if(this.props.values&&this.props.values[e])return this.props.values[e];let o=this.values.get(e);return o===void 0&&i!==void 0&&(o=nR(i===null?void 0:i,{owner:this}),this.addValue(e,o)),o}readValue(e,i){var o;let l=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(o=this.getBaseTargetFromProps(this.props,e))!==null&&o!==void 0?o:this.readValueFromInstance(this.current,e,this.options);return l!=null&&(typeof l=="string"&&(Nte(l)||wte(l))?l=parseFloat(l):!zke(l)&&Lg.test(i)&&(l=Pte(e,i)),this.setBaseTarget(e,pc(l)?l.get():l)),pc(l)?l.get():l}setBaseTarget(e,i){this.baseTarget[e]=i}getBaseTarget(e){var i;const{initial:o}=this.props;let l;if(typeof o=="string"||typeof o=="object"){const f=g3(this.props,o,(i=this.presenceContext)===null||i===void 0?void 0:i.custom);f&&(l=f[e])}if(o&&l!==void 0)return l;const u=this.getBaseTargetFromProps(this.props,e);return u!==void 0&&!pc(u)?u:this.initialValues[e]!==void 0&&l===void 0?void 0:this.baseTarget[e]}on(e,i){return this.events[e]||(this.events[e]=new O3),this.events[e].add(i)}notify(e,...i){this.events[e]&&this.events[e].notify(...i)}}class dne extends Gke{constructor(){super(...arguments),this.KeyframeResolver=Mte}sortInstanceNodePosition(e,i){return e.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(e,i){return e.style?e.style[i]:void 0}removeValueFromRenderState(e,{vars:i,style:o}){delete i[e],delete o[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;pc(e)&&(this.childSubscription=e.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function Hke(n){return window.getComputedStyle(n)}class $ke extends dne{constructor(){super(...arguments),this.type="html",this.renderInstance=Qee}readValueFromInstance(e,i){if(uE.has(i)){const o=L3(i);return o&&o.default||0}else{const o=Hke(e),l=(Yee(i)?o.getPropertyValue(i):o[i])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(e,{transformPagePoint:i}){return Zte(e,i)}build(e,i,o){E3(e,i,o.transformTemplate)}scrapeMotionValuesFromProps(e,i,o){return w3(e,i,o)}}class Kke extends dne{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=lo}getBaseTargetFromProps(e,i){return e[i]}readValueFromInstance(e,i){if(uE.has(i)){const o=L3(i);return o&&o.default||0}return i=Zee.has(i)?i:p3(i),e.getAttribute(i)}scrapeMotionValuesFromProps(e,i,o){return nte(e,i,o)}build(e,i,o){v3(e,i,this.isSVGTag,o.transformTemplate)}renderInstance(e,i,o,l){ete(e,i,o,l)}mount(e){this.isSVGTag=b3(e.tagName),super.mount(e)}}const qke=(n,e)=>m3(n)?new Kke(e):new $ke(e,{allowProjection:n!==k.Fragment}),Yke=v1e({...yOe,...Vke,...Ike,...jke},qke),Bp=LAe(Yke),Xke=(n,e)=>n.find(i=>i.id===e);function ZY(n,e){const i=hne(n,e),o=i?n[i].findIndex(l=>l.id===e):-1;return{position:i,index:o}}function hne(n,e){for(const[i,o]of Object.entries(n))if(Xke(o,e))return i}function Jke(n){const e=n.includes("right"),i=n.includes("left");let o="center";return e&&(o="flex-end"),i&&(o="flex-start"),{display:"flex",flexDirection:"column",alignItems:o}}function Qke(n){const i=n==="top"||n==="bottom"?"0 auto":void 0,o=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,u=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",f=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:i,top:o,bottom:l,right:u,left:f}}var Zke=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|popover|popoverTarget|popoverTargetAction|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,eNe=Aee(function(n){return Zke.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),tNe=eNe,nNe=function(e){return e!=="theme"},eX=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?tNe:nNe},tX=function(e,i,o){var l;if(i){var u=i.shouldForwardProp;l=e.__emotion_forwardProp&&u?function(f){return e.__emotion_forwardProp(f)&&u(f)}:u}return typeof l!="function"&&o&&(l=e.__emotion_forwardProp),l},rNe=function(e){var i=e.cache,o=e.serialized,l=e.isStringTag;return J5(i,o,l),xee(function(){return Q5(i,o,l)}),null},iNe=function n(e,i){var o=e.__emotion_real===e,l=o&&e.__emotion_base||e,u,f;i!==void 0&&(u=i.label,f=i.target);var y=tX(e,i,o),v=y||eX(l),b=!v("as");return function(){var C=arguments,R=o&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(u!==void 0&&R.push("label:"+u+";"),C[0]==null||C[0].raw===void 0)R.push.apply(R,C);else{var O=C[0];R.push(O[0]);for(var L=C.length,D=1;D<L;D++)R.push(C[D],O[D])}var U=e3(function(B,Y,W){var ne=b&&B.as||l,le="",re=[],me=B;if(B.theme==null){me={};for(var q in B)me[q]=B[q];me.theme=k.useContext(wS)}typeof B.className=="string"?le=Oee(Y.registered,re,B.className):B.className!=null&&(le=B.className+" ");var J=Yk(R.concat(re),Y.registered,me);le+=Y.key+"-"+J.name,f!==void 0&&(le+=" "+f);var Q=b&&y===void 0?eX(ne):v,ie={};for(var pe in B)b&&pe==="as"||Q(pe)&&(ie[pe]=B[pe]);return ie.className=le,W&&(ie.ref=W),k.createElement(k.Fragment,null,k.createElement(rNe,{cache:Y,serialized:J,isStringTag:typeof ne=="string"}),k.createElement(ne,ie))});return U.displayName=u!==void 0?u:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",U.defaultProps=e.defaultProps,U.__emotion_real=U,U.__emotion_base=l,U.__emotion_styles=R,U.__emotion_forwardProp=y,Object.defineProperty(U,"toString",{value:function(){return"."+f}}),U.withComponent=function(B,Y){var W=n(B,Xy({},i,Y,{shouldForwardProp:tX(U,Y,!0)}));return W.apply(void 0,R)},U}},sNe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],LV=iNe.bind(null);sNe.forEach(function(n){LV[n]=LV(n)});const oNe=new Set([...R0e,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),aNe=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function cNe(n){return(aNe.has(n)||!oNe.has(n))&&n[0]!=="_"}const lNe=eve(LV),uNe=({baseStyle:n})=>e=>{const{theme:i,css:o,__css:l,sx:u,...f}=e,[y]=ave(f,A0e),v=bl(n,e),b=FEe({},l,v,U5(y),u),C=aee(b)(e.theme);return o?[C,o]:C};function vU(n,e){const{baseStyle:i,...o}=e??{};o.shouldForwardProp||(o.shouldForwardProp=cNe);const l=uNe({baseStyle:i}),u=lNe(n,o)(l);return k.forwardRef(function(v,b){const{children:C,...R}=v,{colorMode:O,forced:L}=Jk(),D=L?O:void 0;return k.createElement(u,{ref:b,"data-theme":D,...R},C)})}function dNe(){const n=new Map;return new Proxy(vU,{apply(e,i,o){return vU(...o)},get(e,i){return n.has(i)||n.set(i,vU(i)),n.get(i)}})}const Mt=dNe(),hNe={initial:n=>{const{position:e}=n,i=["top","bottom"].includes(e)?"y":"x";let o=["top-right","bottom-right"].includes(e)?1:-1;return e==="bottom"&&(o=1),{opacity:0,[i]:o*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},pne=k.memo(n=>{const{id:e,message:i,onCloseComplete:o,onRequestRemove:l,requestClose:u=!1,position:f="bottom",duration:y=5e3,containerStyle:v,motionVariants:b=hNe,toastSpacing:C="0.5rem"}=n,[R,O]=k.useState(y),L=RAe();Wf(()=>{L||o==null||o()},[L]),Wf(()=>{O(y)},[y]);const D=()=>O(null),U=()=>O(y),B=()=>{L&&l()};k.useEffect(()=>{L&&u&&l()},[L,u,l]),Ove(B,R);const Y=k.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:C,...v}),[v,C]),W=k.useMemo(()=>Jke(f),[f]);return S.jsx(Bp.div,{layout:!0,className:"chakra-toast",variants:b,initial:"initial",animate:"animate",exit:"exit",onHoverStart:D,onHoverEnd:U,custom:{position:f},style:W,children:S.jsx(Mt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:Y,children:bl(i,{id:e,onClose:B})})})});pne.displayName="ToastComponent";function zt(n){return k.forwardRef(n)}var SU,nX;function pNe(){if(nX)return SU;nX=1;var n=typeof Element<"u",e=typeof Map=="function",i=typeof Set=="function",o=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(u,f){if(u===f)return!0;if(u&&f&&typeof u=="object"&&typeof f=="object"){if(u.constructor!==f.constructor)return!1;var y,v,b;if(Array.isArray(u)){if(y=u.length,y!=f.length)return!1;for(v=y;v--!==0;)if(!l(u[v],f[v]))return!1;return!0}var C;if(e&&u instanceof Map&&f instanceof Map){if(u.size!==f.size)return!1;for(C=u.entries();!(v=C.next()).done;)if(!f.has(v.value[0]))return!1;for(C=u.entries();!(v=C.next()).done;)if(!l(v.value[1],f.get(v.value[0])))return!1;return!0}if(i&&u instanceof Set&&f instanceof Set){if(u.size!==f.size)return!1;for(C=u.entries();!(v=C.next()).done;)if(!f.has(v.value[0]))return!1;return!0}if(o&&ArrayBuffer.isView(u)&&ArrayBuffer.isView(f)){if(y=u.length,y!=f.length)return!1;for(v=y;v--!==0;)if(u[v]!==f[v])return!1;return!0}if(u.constructor===RegExp)return u.source===f.source&&u.flags===f.flags;if(u.valueOf!==Object.prototype.valueOf&&typeof u.valueOf=="function"&&typeof f.valueOf=="function")return u.valueOf()===f.valueOf();if(u.toString!==Object.prototype.toString&&typeof u.toString=="function"&&typeof f.toString=="function")return u.toString()===f.toString();if(b=Object.keys(u),y=b.length,y!==Object.keys(f).length)return!1;for(v=y;v--!==0;)if(!Object.prototype.hasOwnProperty.call(f,b[v]))return!1;if(n&&u instanceof Element)return!1;for(v=y;v--!==0;)if(!((b[v]==="_owner"||b[v]==="__v"||b[v]==="__o")&&u.$$typeof)&&!l(u[b[v]],f[b[v]]))return!1;return!0}return u!==u&&f!==f}return SU=function(f,y){try{return l(f,y)}catch(v){if((v.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw v}},SU}var fNe=pNe();const mNe=Hg(fNe);function qS(){const n=k.useContext(wS);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function fne(){const n=Jk(),e=qS();return{...n,theme:e}}function gNe(n,e,i){if(e==null)return e;const o=l=>{var u,f;return(f=(u=n.__cssMap)==null?void 0:u[l])==null?void 0:f.value};return o(e)??o(i)??i}function _Ne(n,e,i){const o=Array.isArray(e)?e:[e],l=Array.isArray(i)?i:[i];return u=>{const f=l.filter(Boolean),y=o.map((v,b)=>{const C=`${n}.${v}`;return gNe(u,C,f[b]??v)});return Array.isArray(e)?y:y[0]}}function yNe(n){return Object.fromEntries(Object.entries(n).filter(([e,i])=>i!==void 0&&e!=="children"&&!k.isValidElement(i)))}function mne(n,e={}){const{styleConfig:i,...o}=e,{theme:l,colorMode:u}=fne(),f=n?WZ(l,`components.${n}`):void 0,y=i||f,v=Tp({theme:l,colorMode:u},(y==null?void 0:y.defaultProps)??{},yNe(o),(C,R)=>C?void 0:R),b=k.useRef({});if(y){const R=j0e(y)(v);mNe(b.current,R)||(b.current=R)}return b.current}function gd(n,e={}){return mne(n,e)}function Ba(n,e={}){return mne(n,e)}const rX={path:S.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[S.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),S.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),S.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},Zt=zt((n,e)=>{const{as:i,viewBox:o,color:l="currentColor",focusable:u=!1,children:f,className:y,__css:v,...b}=n,C=bn("chakra-icon",y),R=gd("Icon",n),O={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...v,...R},L={ref:e,focusable:u,className:C,__css:O},D=o??rX.viewBox;if(i&&typeof i!="string")return S.jsx(Mt.svg,{as:i,...L,...b});const U=f??rX.path;return S.jsx(Mt.svg,{verticalAlign:"middle",viewBox:D,...L,...b,children:U})});Zt.displayName="Icon";function ENe(n){return S.jsx(Zt,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function vNe(n){return S.jsx(Zt,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function iX(n){return S.jsx(Zt,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const SNe=PR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),_d=zt((n,e)=>{const i=gd("Spinner",n),{label:o="Loading...",thickness:l="2px",speed:u="0.45s",emptyColor:f="transparent",className:y,...v}=Hi(n),b=bn("chakra-spinner",y),C={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:f,borderLeftColor:f,animation:`${SNe} ${u} linear infinite`,...i};return S.jsx(Mt.div,{ref:e,__css:C,className:b,...v,children:o&&S.jsx(Mt.span,{srOnly:!0,children:o})})});_d.displayName="Spinner";const[bNe,F3]=Ai({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[wNe,B3]=Ai({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),gne={info:{icon:vNe,colorScheme:"blue"},warning:{icon:iX,colorScheme:"orange"},success:{icon:ENe,colorScheme:"green"},error:{icon:iX,colorScheme:"red"},loading:{icon:_d,colorScheme:"blue"}};function TNe(n){return gne[n].colorScheme}function CNe(n){return gne[n].icon}const Jy=zt(function(e,i){const{status:o="info",addRole:l=!0,...u}=Hi(e),f=e.colorScheme??TNe(o),y=Ba("Alert",{...e,colorScheme:f}),v={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...y.container};return S.jsx(bNe,{value:{status:o},children:S.jsx(wNe,{value:y,children:S.jsx(Mt.div,{"data-status":o,role:l?"alert":void 0,ref:i,...u,className:bn("chakra-alert",e.className),__css:v})})})});Jy.displayName="Alert";function Qy(n){const{status:e}=F3(),i=CNe(e),o=B3(),l=e==="loading"?o.spinner:o.icon;return S.jsx(Mt.span,{display:"inherit","data-status":e,...n,className:bn("chakra-alert__icon",n.className),__css:l,children:n.children||S.jsx(i,{h:"100%",w:"100%"})})}Qy.displayName="AlertIcon";const sk=zt(function(e,i){const o=B3(),{status:l}=F3();return S.jsx(Mt.div,{ref:i,"data-status":l,...e,className:bn("chakra-alert__title",e.className),__css:o.title})});sk.displayName="AlertTitle";const ok=zt(function(e,i){const{status:o}=F3(),l=B3(),u={display:"inline",...l.description};return S.jsx(Mt.div,{ref:i,"data-status":o,...e,className:bn("chakra-alert__desc",e.className),__css:u})});ok.displayName="AlertDescription";function RNe(n){return S.jsx(Zt,{focusable:"false","aria-hidden":!0,...n,children:S.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const z3=zt(function(e,i){const o=gd("CloseButton",e),{children:l,isDisabled:u,__css:f,...y}=Hi(e),v={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return S.jsx(Mt.button,{type:"button","aria-label":"Close",ref:i,disabled:u,__css:{...v,...o,...f},...y,children:l||S.jsx(RNe,{width:"1em",height:"1em"})})});z3.displayName="CloseButton";const INe=n=>{const{status:e,variant:i="solid",id:o,title:l,isClosable:u,onClose:f,description:y,colorScheme:v,icon:b}=n,C=o?{root:`toast-${o}`,title:`toast-${o}-title`,description:`toast-${o}-description`}:void 0;return S.jsxs(Jy,{addRole:!1,status:e,variant:i,id:C==null?void 0:C.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:v,children:[S.jsx(Qy,{children:b}),S.jsxs(Mt.div,{flex:"1",maxWidth:"100%",children:[l&&S.jsx(sk,{id:C==null?void 0:C.title,children:l}),y&&S.jsx(ok,{id:C==null?void 0:C.description,display:"block",children:y})]}),u&&S.jsx(z3,{size:"sm",onClick:f,position:"absolute",insetEnd:1,top:1})]})};function _ne(n={}){const{render:e,toastComponent:i=INe}=n;return l=>typeof e=="function"?e({...l,...n}):S.jsx(i,{...l,...n})}const ANe={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},bp=PNe(ANe);function PNe(n){let e=n;const i=new Set,o=l=>{e=l(e),i.forEach(u=>u())};return{getState:()=>e,subscribe:l=>(i.add(l),()=>{o(()=>n),i.delete(l)}),removeToast:(l,u)=>{o(f=>({...f,[u]:f[u].filter(y=>y.id!=l)}))},notify:(l,u)=>{const f=ONe(l,u),{position:y,id:v}=f;return o(b=>{const R=y.includes("top")?[f,...b[y]??[]]:[...b[y]??[],f];return{...b,[y]:R}}),v},update:(l,u)=>{l&&o(f=>{const y={...f},{position:v,index:b}=ZY(y,l);return v&&b!==-1&&(y[v][b]={...y[v][b],...u,message:_ne(u)}),y})},closeAll:({positions:l}={})=>{o(u=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((v,b)=>(v[b]=u[b].map(C=>({...C,requestClose:!0})),v),{...u}))},close:l=>{o(u=>{const f=hne(u,l);return f?{...u,[f]:u[f].map(y=>y.id==l?{...y,requestClose:!0}:y)}:u})},isActive:l=>!!ZY(bp.getState(),l).position}}let sX=0;function ONe(n,e={}){sX+=1;const i=e.id??sX,o=e.position??"bottom";return{id:i,message:n,position:o,duration:e.duration,onCloseComplete:e.onCloseComplete,onRequestRemove:()=>bp.removeToast(String(i),o),status:e.status,requestClose:!1,containerStyle:e.containerStyle}}var yne=DZ();const[Ene,kNe]=Ai({strict:!1,name:"PortalContext"}),W3="chakra-portal",NNe=".chakra-portal",xNe=n=>S.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),DNe=n=>{const{appendToParentPortal:e,children:i}=n,[o,l]=k.useState(null),u=k.useRef(null),[,f]=k.useState({});k.useEffect(()=>f({}),[]);const y=kNe(),v=EAe();Ip(()=>{if(!o)return;const C=o.ownerDocument,R=e?y??C.body:C.body;if(!R)return;u.current=C.createElement("div"),u.current.className=W3,R.appendChild(u.current),f({});const O=u.current;return()=>{R.contains(O)&&R.removeChild(O)}},[o]);const b=v!=null&&v.zIndex?S.jsx(xNe,{zIndex:v==null?void 0:v.zIndex,children:i}):i;return u.current?yne.createPortal(S.jsx(Ene,{value:u.current,children:b}),u.current):S.jsx("span",{ref:C=>{C&&l(C)}})},LNe=n=>{const{children:e,containerRef:i,appendToParentPortal:o}=n,l=i.current,u=l??(typeof window<"u"?document.body:void 0),f=k.useMemo(()=>{const v=l==null?void 0:l.ownerDocument.createElement("div");return v&&(v.className=W3),v},[l]),[,y]=k.useState({});return Ip(()=>y({}),[]),Ip(()=>{if(!(!f||!u))return u.appendChild(f),()=>{u.removeChild(f)}},[f,u]),u&&f?yne.createPortal(S.jsx(Ene,{value:o?f:null,children:e}),f):null};function Al(n){const e={appendToParentPortal:!0,...n},{containerRef:i,...o}=e;return i?S.jsx(LNe,{containerRef:i,...o}):S.jsx(DNe,{...o})}Al.className=W3;Al.selector=NNe;Al.displayName="Portal";const[MNe,UNe]=Ai({name:"ToastOptionsContext",strict:!1}),VNe=n=>{const e=k.useSyncExternalStore(bp.subscribe,bp.getState,bp.getState),{motionVariants:i,component:o=pne,portalProps:l,animatePresenceProps:u}=n,y=Object.keys(e).map(v=>{const b=e[v];return S.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${v}`,id:`chakra-toast-manager-${v}`,style:Qke(v),children:S.jsx(lE,{...u,initial:!1,children:b.map(C=>S.jsx(o,{motionVariants:i,...C},C.id))})},v)});return S.jsx(Al,{...l,children:y})},jNe=n=>function({children:i,theme:o=n,toastOptions:l,...u}){return S.jsxs(SAe,{theme:o,...u,children:[S.jsx(MNe,{value:l==null?void 0:l.defaultOptions,children:i}),S.jsx(VNe,{...l})]})},FNe=jNe(dIe);function oX(n){return n.sort((e,i)=>{const o=e.compareDocumentPosition(i);if(o&Node.DOCUMENT_POSITION_FOLLOWING||o&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(o&Node.DOCUMENT_POSITION_PRECEDING||o&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(o&Node.DOCUMENT_POSITION_DISCONNECTED||o&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const BNe=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function aX(n,e,i){let o=n+1;return i&&o>=e&&(o=0),o}function cX(n,e,i){let o=n-1;return i&&o<0&&(o=e),o}const bU=typeof window<"u"?k.useLayoutEffect:k.useEffect,lX=n=>n;var zNe=Object.defineProperty,WNe=(n,e,i)=>e in n?zNe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,Ws=(n,e,i)=>(WNe(n,typeof e!="symbol"?e+"":e,i),i);class GNe{constructor(){Ws(this,"descendants",new Map),Ws(this,"register",e=>{if(e!=null)return BNe(e)?this.registerNode(e):i=>{this.registerNode(i,e)}}),Ws(this,"unregister",e=>{this.descendants.delete(e);const i=oX(Array.from(this.descendants.keys()));this.assignIndex(i)}),Ws(this,"destroy",()=>{this.descendants.clear()}),Ws(this,"assignIndex",e=>{this.descendants.forEach(i=>{const o=e.indexOf(i.node);i.index=o,i.node.dataset.index=i.index.toString()})}),Ws(this,"count",()=>this.descendants.size),Ws(this,"enabledCount",()=>this.enabledValues().length),Ws(this,"values",()=>Array.from(this.descendants.values()).sort((i,o)=>i.index-o.index)),Ws(this,"enabledValues",()=>this.values().filter(e=>!e.disabled)),Ws(this,"item",e=>{if(this.count()!==0)return this.values()[e]}),Ws(this,"enabledItem",e=>{if(this.enabledCount()!==0)return this.enabledValues()[e]}),Ws(this,"first",()=>this.item(0)),Ws(this,"firstEnabled",()=>this.enabledItem(0)),Ws(this,"last",()=>this.item(this.descendants.size-1)),Ws(this,"lastEnabled",()=>{const e=this.enabledValues().length-1;return this.enabledItem(e)}),Ws(this,"indexOf",e=>{var i;return e?((i=this.descendants.get(e))==null?void 0:i.index)??-1:-1}),Ws(this,"enabledIndexOf",e=>e==null?-1:this.enabledValues().findIndex(i=>i.node.isSameNode(e))),Ws(this,"next",(e,i=!0)=>{const o=aX(e,this.count(),i);return this.item(o)}),Ws(this,"nextEnabled",(e,i=!0)=>{const o=this.item(e);if(!o)return;const l=this.enabledIndexOf(o.node),u=aX(l,this.enabledCount(),i);return this.enabledItem(u)}),Ws(this,"prev",(e,i=!0)=>{const o=cX(e,this.count()-1,i);return this.item(o)}),Ws(this,"prevEnabled",(e,i=!0)=>{const o=this.item(e);if(!o)return;const l=this.enabledIndexOf(o.node),u=cX(l,this.enabledCount()-1,i);return this.enabledItem(u)}),Ws(this,"registerNode",(e,i)=>{if(!e||this.descendants.has(e))return;const o=Array.from(this.descendants.keys()).concat(e),l=oX(o);i!=null&&i.disabled&&(i.disabled=!!i.disabled);const u={node:e,index:-1,...i};this.descendants.set(e,u),this.assignIndex(l)})}}function vne(){const[n,e]=Ai({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,e,()=>{const l=k.useRef(new GNe);return bU(()=>()=>l.current.destroy()),l.current},l=>{const u=e(),[f,y]=k.useState(-1),v=k.useRef(null);bU(()=>()=>{v.current&&u.unregister(v.current)},[]),bU(()=>{if(!v.current)return;const C=Number(v.current.dataset.index);f!=C&&!Number.isNaN(C)&&y(C)});const b=lX(l?u.register(l):u.register);return{descendants:u,index:f,enabledIndex:u.enabledIndexOf(v.current),register:Gi(b,v)}}]}const X0={ease:[.25,.1,.25,1],easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},zy={enter:{duration:.2,ease:X0.easeOut},exit:{duration:.1,ease:X0.easeIn}},jf={enter:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.enter}),exit:(n,e)=>({...n,delay:typeof e=="number"?e:e==null?void 0:e.exit})},HNe=n=>n!=null&&parseInt(n.toString(),10)>0,uX={exit:{height:{duration:.2,ease:X0.ease},opacity:{duration:.3,ease:X0.ease}},enter:{height:{duration:.3,ease:X0.ease},opacity:{duration:.4,ease:X0.ease}}},$Ne={exit:({animateOpacity:n,startingHeight:e,transition:i,transitionEnd:o,delay:l})=>({...n&&{opacity:HNe(e)?1:0},height:e,transitionEnd:o==null?void 0:o.exit,transition:(i==null?void 0:i.exit)??jf.exit(uX.exit,l)}),enter:({animateOpacity:n,endingHeight:e,transition:i,transitionEnd:o,delay:l})=>({...n&&{opacity:1},height:e,transitionEnd:o==null?void 0:o.enter,transition:(i==null?void 0:i.enter)??jf.enter(uX.enter,l)})},Sne=k.forwardRef((n,e)=>{const{in:i,unmountOnExit:o,animateOpacity:l=!0,startingHeight:u=0,endingHeight:f="auto",style:y,className:v,transition:b,transitionEnd:C,animatePresenceProps:R,...O}=n,[L,D]=k.useState(!1);k.useEffect(()=>{const ne=setTimeout(()=>{D(!0)});return()=>clearTimeout(ne)},[]);const U=parseFloat(u.toString())>0,B={startingHeight:u,endingHeight:f,animateOpacity:l,transition:L?b:{enter:{duration:0}},transitionEnd:{enter:C==null?void 0:C.enter,exit:o?C==null?void 0:C.exit:{...C==null?void 0:C.exit,display:U?"block":"none"}}},Y=o?i:!0,W=i||o?"enter":"exit";return S.jsx(lE,{...R,initial:!1,custom:B,children:Y&&S.jsx(Bp.div,{ref:e,...O,className:bn("chakra-collapse",v),style:{overflow:"hidden",display:"block",...y},custom:B,variants:$Ne,initial:o?"exit":!1,animate:W,exit:"exit"})})});Sne.displayName="Collapse";const[KNe,qNe]=Ai({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function YNe(n){const e=n.trim().split(" "),i=e[0]??"",o=e.length>1?e[e.length-1]:"";return i&&o?`${i.charAt(0)}${o.charAt(0)}`:i.charAt(0)}function bne(n){const{name:e,getInitials:i,...o}=n,l=qNe();return S.jsx(Mt.div,{role:"img","aria-label":e,...o,__css:l.label,children:e?i==null?void 0:i(e):null})}bne.displayName="AvatarName";const wne=n=>S.jsxs(Mt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[S.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),S.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function Tne(n){const{loading:e,src:i,srcSet:o,onLoad:l,onError:u,crossOrigin:f,sizes:y,ignoreFallback:v}=n,[b,C]=k.useState("pending");k.useEffect(()=>{C(i?"loading":"pending")},[i]);const R=k.useRef(null),O=k.useCallback(()=>{if(!i)return;L();const D=new Image;D.src=i,f&&(D.crossOrigin=f),o&&(D.srcset=o),y&&(D.sizes=y),e&&(D.loading=e),D.onload=U=>{L(),C("loaded"),l==null||l(U)},D.onerror=U=>{L(),C("failed"),u==null||u(U)},R.current=D},[i,f,o,y,l,u,e]),L=()=>{R.current&&(R.current.onload=null,R.current.onerror=null,R.current=null)};return Ip(()=>{if(!v)return b==="loading"&&O(),()=>{L()}},[b,O,v]),v?"loaded":b}const XNe=(n,e)=>n!=="loaded"&&e==="beforeLoadOrError"||n==="failed"&&e==="onError";function Cne(n){const{src:e,srcSet:i,onError:o,onLoad:l,getInitials:u,name:f,borderRadius:y,loading:v,iconLabel:b,icon:C=S.jsx(wne,{}),ignoreFallback:R,referrerPolicy:O,crossOrigin:L}=n,U=Tne({src:e,onError:o,crossOrigin:L,ignoreFallback:R})==="loaded";return!e||!U?f?S.jsx(bne,{className:"chakra-avatar__initials",getInitials:u,name:f}):k.cloneElement(C,{role:"img","aria-label":b}):S.jsx(Mt.img,{src:e,srcSet:i,alt:f??b,onLoad:l,referrerPolicy:O,crossOrigin:L??void 0,className:"chakra-avatar__img",loading:v,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:y}})}Cne.displayName="AvatarImage";const JNe={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},cd=zt((n,e)=>{const i=Ba("Avatar",n),[o,l]=k.useState(!1),{src:u,srcSet:f,name:y,showBorder:v,borderRadius:b="full",onError:C,onLoad:R,getInitials:O=YNe,icon:L=S.jsx(wne,{}),iconLabel:D=" avatar",loading:U,children:B,borderColor:Y,ignoreFallback:W,crossOrigin:ne,referrerPolicy:le,...re}=Hi(n),me={borderRadius:b,borderWidth:v?"2px":void 0,...JNe,...i.container};return Y&&(me.borderColor=Y),S.jsx(Mt.span,{ref:e,...re,className:bn("chakra-avatar",n.className),"data-loaded":dr(o),__css:me,children:S.jsxs(KNe,{value:i,children:[S.jsx(Cne,{src:u,srcSet:f,loading:U,onLoad:Vn(R,()=>{l(!0)}),onError:C,getInitials:O,name:y,borderRadius:b,icon:L,iconLabel:D,ignoreFallback:W,crossOrigin:ne,referrerPolicy:le}),B]})})});cd.displayName="Avatar";const Dc=zt(function(e,i){const o=gd("Badge",e),{className:l,...u}=Hi(e);return S.jsx(Mt.span,{ref:i,className:bn("chakra-badge",e.className),...u,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...o}})});Dc.displayName="Badge";const $e=Mt("div");$e.displayName="Box";const[bGe,QNe]=Ai({strict:!1,name:"ButtonGroupContext"});function pC(n){const{children:e,className:i,...o}=n,l=k.isValidElement(e)?k.cloneElement(e,{"aria-hidden":!0,focusable:!1}):e,u=bn("chakra-button__icon",i);return S.jsx(Mt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...o,className:u,children:l})}pC.displayName="ButtonIcon";function MV(n){const{label:e,placement:i,spacing:o="0.5rem",children:l=S.jsx(_d,{color:"currentColor",width:"1em",height:"1em"}),className:u,__css:f,...y}=n,v=bn("chakra-button__spinner",u),b=i==="start"?"marginEnd":"marginStart",C=k.useMemo(()=>({display:"flex",alignItems:"center",position:e?"relative":"absolute",[b]:e?o:0,fontSize:"1em",lineHeight:"normal",...f}),[f,e,b,o]);return S.jsx(Mt.div,{className:v,...y,__css:C,children:l})}MV.displayName="ButtonSpinner";function ZNe(n){const[e,i]=k.useState(!n);return{ref:k.useCallback(u=>{u&&i(u.tagName==="BUTTON")},[]),type:e?"button":void 0}}const $n=zt((n,e)=>{const i=QNe(),o=gd("Button",{...i,...n}),{isDisabled:l=i==null?void 0:i.isDisabled,isLoading:u,isActive:f,children:y,leftIcon:v,rightIcon:b,loadingText:C,iconSpacing:R="0.5rem",type:O,spinner:L,spinnerPlacement:D="start",className:U,as:B,shouldWrapChildren:Y,...W}=Hi(n),ne=k.useMemo(()=>{const q={...o==null?void 0:o._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...o,...!!i&&{_focus:q}}},[o,i]),{ref:le,type:re}=ZNe(B),me={rightIcon:b,leftIcon:v,iconSpacing:R,children:y,shouldWrapChildren:Y};return S.jsxs(Mt.button,{disabled:l||u,ref:Pve(e,le),as:B,type:O??re,"data-active":dr(f),"data-loading":dr(u),__css:ne,className:bn("chakra-button",U),...W,children:[u&&D==="start"&&S.jsx(MV,{className:"chakra-button__spinner--start",label:C,placement:"start",spacing:R,children:L}),u?C||S.jsx(Mt.span,{opacity:0,children:S.jsx(dX,{...me})}):S.jsx(dX,{...me}),u&&D==="end"&&S.jsx(MV,{className:"chakra-button__spinner--end",label:C,placement:"end",spacing:R,children:L})]})});$n.displayName="Button";function dX(n){const{leftIcon:e,rightIcon:i,children:o,iconSpacing:l,shouldWrapChildren:u}=n;return u?S.jsxs("span",{style:{display:"contents"},children:[e&&S.jsx(pC,{marginEnd:l,children:e}),o,i&&S.jsx(pC,{marginStart:l,children:i})]}):S.jsxs(S.Fragment,{children:[e&&S.jsx(pC,{marginEnd:l,children:e}),o,i&&S.jsx(pC,{marginStart:l,children:i})]})}const ya=zt((n,e)=>{const{icon:i,children:o,isRound:l,"aria-label":u,...f}=n,y=i||o,v=k.isValidElement(y)?k.cloneElement(y,{"aria-hidden":!0,focusable:!1}):null;return S.jsx($n,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:e,"aria-label":u,...f,children:v})});ya.displayName="IconButton";const Rne=Mt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});Rne.displayName="Center";const exe={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};zt(function(e,i){const{axis:o="both",...l}=e;return S.jsx(Mt.div,{ref:i,__css:exe[o],...l,position:"absolute"})});var txe=()=>typeof document<"u",hX=!1,LR=null,Zy=!1,UV=!1,VV=new Set;function G3(n,e){VV.forEach(i=>i(n,e))}var nxe=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function rxe(n){return!(n.metaKey||!nxe&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function pX(n){Zy=!0,rxe(n)&&(LR="keyboard",G3("keyboard",n))}function C0(n){if(LR="pointer",n.type==="mousedown"||n.type==="pointerdown"){Zy=!0;const e=n.composedPath?n.composedPath()[0]:n.target;let i=!1;try{i=e.matches(":focus-visible")}catch{}if(i)return;G3("pointer",n)}}function ixe(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function sxe(n){ixe(n)&&(Zy=!0,LR="virtual")}function oxe(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!Zy&&!UV&&(LR="virtual",G3("virtual",n)),Zy=!1,UV=!1)}function axe(){Zy=!1,UV=!0}function fX(){return LR!=="pointer"}function cxe(){if(!txe()||hX)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...i){Zy=!0,n.apply(this,i)},document.addEventListener("keydown",pX,!0),document.addEventListener("keyup",pX,!0),document.addEventListener("click",sxe,!0),window.addEventListener("focus",oxe,!0),window.addEventListener("blur",axe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",C0,!0),document.addEventListener("pointermove",C0,!0),document.addEventListener("pointerup",C0,!0)):(document.addEventListener("mousedown",C0,!0),document.addEventListener("mousemove",C0,!0),document.addEventListener("mouseup",C0,!0)),hX=!0}function lxe(n){cxe(),n(fX());const e=()=>n(fX());return VV.add(e),()=>{VV.delete(e)}}const[uxe,Ine]=Ai({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[dxe,YS]=Ai({strict:!1,name:"FormControlContext"});function hxe(n){const{id:e,isRequired:i,isInvalid:o,isDisabled:l,isReadOnly:u,...f}=n,y=k.useId(),v=e||`field-${y}`,b=`${v}-label`,C=`${v}-feedback`,R=`${v}-helptext`,[O,L]=k.useState(!1),[D,U]=k.useState(!1),[B,Y]=k.useState(!1),W=k.useCallback((q={},J=null)=>({id:R,...q,ref:Gi(J,Q=>{Q&&U(!0)})}),[R]),ne=k.useCallback((q={},J=null)=>({...q,ref:J,"data-focus":dr(B),"data-disabled":dr(l),"data-invalid":dr(o),"data-readonly":dr(u),id:q.id!==void 0?q.id:b,htmlFor:q.htmlFor!==void 0?q.htmlFor:v}),[v,l,B,o,u,b]),le=k.useCallback((q={},J=null)=>({id:C,...q,ref:Gi(J,Q=>{Q&&L(!0)}),"aria-live":"polite"}),[C]),re=k.useCallback((q={},J=null)=>({...q,...f,ref:J,role:"group","data-focus":dr(B),"data-disabled":dr(l),"data-invalid":dr(o),"data-readonly":dr(u)}),[f,l,B,o,u]),me=k.useCallback((q={},J=null)=>({...q,ref:J,role:"presentation","aria-hidden":!0,children:q.children||"*"}),[]);return{isRequired:!!i,isInvalid:!!o,isReadOnly:!!u,isDisabled:!!l,isFocused:!!B,onFocus:()=>Y(!0),onBlur:()=>Y(!1),hasFeedbackText:O,setHasFeedbackText:L,hasHelpText:D,setHasHelpText:U,id:v,labelId:b,feedbackId:C,helpTextId:R,htmlProps:f,getHelpTextProps:W,getErrorMessageProps:le,getRootProps:re,getLabelProps:ne,getRequiredIndicatorProps:me}}const Br=zt(function(e,i){const o=Ba("Form",e),l=Hi(e),{getRootProps:u,htmlProps:f,...y}=hxe(l),v=bn("chakra-form-control",e.className);return S.jsx(dxe,{value:y,children:S.jsx(uxe,{value:o,children:S.jsx(Mt.div,{...u({},i),className:v,__css:o.container})})})});Br.displayName="FormControl";const aS=zt(function(e,i){const o=YS(),l=Ine(),u=bn("chakra-form__helper-text",e.className);return S.jsx(Mt.div,{...o==null?void 0:o.getHelpTextProps(e,i),__css:l.helperText,className:u})});aS.displayName="FormHelperText";function H3(n){const{isDisabled:e,isInvalid:i,isReadOnly:o,isRequired:l,...u}=$3(n);return{...u,disabled:e,readOnly:o,required:l,"aria-invalid":Lf(i),"aria-required":Lf(l),"aria-readonly":Lf(o)}}function $3(n){const e=YS(),{id:i,disabled:o,readOnly:l,required:u,isRequired:f,isInvalid:y,isReadOnly:v,isDisabled:b,onFocus:C,onBlur:R,...O}=n,L=n["aria-describedby"]?[n["aria-describedby"]]:[];return e!=null&&e.hasFeedbackText&&(e!=null&&e.isInvalid)&&L.push(e.feedbackId),e!=null&&e.hasHelpText&&L.push(e.helpTextId),{...O,"aria-describedby":L.join(" ")||void 0,id:i??(e==null?void 0:e.id),isDisabled:o??b??(e==null?void 0:e.isDisabled),isReadOnly:l??v??(e==null?void 0:e.isReadOnly),isRequired:u??f??(e==null?void 0:e.isRequired),isInvalid:y??(e==null?void 0:e.isInvalid),onFocus:Vn(e==null?void 0:e.onFocus,C),onBlur:Vn(e==null?void 0:e.onBlur,R)}}const pxe={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function fxe(n={}){const e=$3(n),{isDisabled:i,isReadOnly:o,isRequired:l,isInvalid:u,id:f,onBlur:y,onFocus:v,"aria-describedby":b}=e,{defaultChecked:C,isChecked:R,isFocusable:O,onChange:L,isIndeterminate:D,name:U,value:B,tabIndex:Y=void 0,"aria-label":W,"aria-labelledby":ne,"aria-invalid":le,...re}=n,me=CR(re,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),q=fo(L),J=fo(y),Q=fo(v),[ie,pe]=k.useState(!1),[de,he]=k.useState(!1),[Se,Ie]=k.useState(!1),Fe=k.useRef(!1);k.useEffect(()=>lxe(st=>{Fe.current=st}),[]);const we=k.useRef(null),[Re,Te]=k.useState(!0),[Ne,be]=k.useState(!!C),xe=R!==void 0,je=xe?R:Ne,nt=k.useCallback(st=>{if(o||i){st.preventDefault();return}xe||be(je?st.currentTarget.checked:D?!0:st.currentTarget.checked),q==null||q(st)},[o,i,je,xe,D,q]);Ip(()=>{we.current&&(we.current.indeterminate=!!D)},[D]),Wf(()=>{i&&pe(!1)},[i,pe]),Ip(()=>{const st=we.current;if(!(st!=null&&st.form))return;const hn=()=>{be(!!C)};return st.form.addEventListener("reset",hn),()=>{var an;return(an=st.form)==null?void 0:an.removeEventListener("reset",hn)}},[]);const dt=i&&!O,ft=k.useCallback(st=>{st.key===" "&&Ie(!0)},[Ie]),lt=k.useCallback(st=>{st.key===" "&&Ie(!1)},[Ie]);Ip(()=>{if(!we.current)return;we.current.checked!==je&&be(we.current.checked)},[we.current]);const gt=k.useCallback((st={},hn=null)=>{const an=jt=>{ie&&jt.preventDefault(),Ie(!0)};return{...st,ref:hn,"data-active":dr(Se),"data-hover":dr(de),"data-checked":dr(je),"data-focus":dr(ie),"data-focus-visible":dr(ie&&Fe.current),"data-indeterminate":dr(D),"data-disabled":dr(i),"data-invalid":dr(u),"data-readonly":dr(o),"aria-hidden":!0,onMouseDown:Vn(st.onMouseDown,an),onMouseUp:Vn(st.onMouseUp,()=>Ie(!1)),onMouseEnter:Vn(st.onMouseEnter,()=>he(!0)),onMouseLeave:Vn(st.onMouseLeave,()=>he(!1))}},[Se,je,i,ie,de,D,u,o]),at=k.useCallback((st={},hn=null)=>({...st,ref:hn,"data-active":dr(Se),"data-hover":dr(de),"data-checked":dr(je),"data-focus":dr(ie),"data-focus-visible":dr(ie&&Fe.current),"data-indeterminate":dr(D),"data-disabled":dr(i),"data-invalid":dr(u),"data-readonly":dr(o)}),[Se,je,i,ie,de,D,u,o]),Ct=k.useCallback((st={},hn=null)=>({...me,...st,ref:Gi(hn,an=>{an&&Te(an.tagName==="LABEL")}),onClick:Vn(st.onClick,()=>{var an;Re||((an=we.current)==null||an.click(),requestAnimationFrame(()=>{var jt;(jt=we.current)==null||jt.focus({preventScroll:!0})}))}),"data-disabled":dr(i),"data-checked":dr(je),"data-invalid":dr(u)}),[me,i,je,u,Re]),En=k.useCallback((st={},hn=null)=>({...st,ref:Gi(we,hn),type:"checkbox",name:U,value:B,id:f,tabIndex:Y,onChange:Vn(st.onChange,nt),onBlur:Vn(st.onBlur,J,()=>pe(!1)),onFocus:Vn(st.onFocus,Q,()=>pe(!0)),onKeyDown:Vn(st.onKeyDown,ft),onKeyUp:Vn(st.onKeyUp,lt),required:l,checked:je,disabled:dt,readOnly:o,"aria-label":W,"aria-labelledby":ne,"aria-invalid":le?!!le:u,"aria-describedby":b,"aria-disabled":i,"aria-checked":D?"mixed":je,style:pxe}),[U,B,f,Y,nt,J,Q,ft,lt,l,je,dt,o,W,ne,le,u,b,i,D]),Gt=k.useCallback((st={},hn=null)=>({...st,ref:hn,onMouseDown:Vn(st.onMouseDown,mxe),"data-disabled":dr(i),"data-checked":dr(je),"data-invalid":dr(u)}),[je,i,u]);return{state:{isInvalid:u,isFocused:ie,isChecked:je,isActive:Se,isHovered:de,isIndeterminate:D,isDisabled:i,isReadOnly:o,isRequired:l},getRootProps:Ct,getCheckboxProps:gt,getIndicatorProps:at,getInputProps:En,getLabelProps:Gt,htmlProps:me}}function mxe(n){n.preventDefault(),n.stopPropagation()}const sR=zt(function(e,i){const{borderLeftWidth:o,borderBottomWidth:l,borderTopWidth:u,borderRightWidth:f,borderWidth:y,borderStyle:v,borderColor:b,...C}=gd("Divider",e),{className:R,orientation:O="horizontal",__css:L,...D}=Hi(e),U={vertical:{borderLeftWidth:o||f||y||"1px",height:"100%"},horizontal:{borderBottomWidth:l||u||y||"1px",width:"100%"}};return S.jsx(Mt.hr,{ref:i,"aria-orientation":O,...D,__css:{...C,border:"0",borderColor:b,borderStyle:v,...U[O],...L},className:bn("chakra-divider",R)})});sR.displayName="Divider";const Mi=zt(function(e,i){const{direction:o,align:l,justify:u,wrap:f,basis:y,grow:v,shrink:b,...C}=e,R={display:"flex",flexDirection:o,alignItems:l,justifyContent:u,flexWrap:f,flexBasis:y,flexGrow:v,flexShrink:b};return S.jsx(Mt.div,{ref:i,__css:R,...C})});Mi.displayName="Flex";function gxe(n,e){if(n==null)return{};var i={};for(var o in n)if({}.hasOwnProperty.call(n,o)){if(e.indexOf(o)!==-1)continue;i[o]=n[o]}return i}var wU={exports:{}},TU,mX;function _xe(){if(mX)return TU;mX=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return TU=n,TU}var CU,gX;function yxe(){if(gX)return CU;gX=1;var n=_xe();function e(){}function i(){}return i.resetWarningCache=e,CU=function(){function o(f,y,v,b,C,R){if(R!==n){var O=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw O.name="Invariant Violation",O}}o.isRequired=o;function l(){return o}var u={array:o,bigint:o,bool:o,func:o,number:o,object:o,string:o,symbol:o,any:o,arrayOf:l,element:o,elementType:o,instanceOf:l,node:o,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:i,resetWarningCache:e};return u.PropTypes=u,u},CU}var _X;function Exe(){return _X||(_X=1,wU.exports=yxe()()),wU.exports}var vxe=Exe();const Nn=Hg(vxe);var jV="data-focus-lock",Ane="data-focus-lock-disabled",Sxe="data-no-focus-lock",bxe="data-autofocus-inside",wxe="data-no-autofocus";function RU(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function Txe(n,e){var i=k.useState(function(){return{value:n,callback:e,facade:{get current(){return i.value},set current(o){var l=i.value;l!==o&&(i.value=o,i.callback(o,l))}}}})[0];return i.callback=e,i.facade}var Cxe=typeof window<"u"?k.useLayoutEffect:k.useEffect,yX=new WeakMap;function Pne(n,e){var i=Txe(null,function(o){return n.forEach(function(l){return RU(l,o)})});return Cxe(function(){var o=yX.get(i);if(o){var l=new Set(o),u=new Set(n),f=i.current;l.forEach(function(y){u.has(y)||RU(y,null)}),u.forEach(function(y){l.has(y)||RU(y,f)})}yX.set(i,n)},[n]),i}var IU={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},wp=function(){return wp=Object.assign||function(e){for(var i,o=1,l=arguments.length;o<l;o++){i=arguments[o];for(var u in i)Object.prototype.hasOwnProperty.call(i,u)&&(e[u]=i[u])}return e},wp.apply(this,arguments)};function MR(n,e){var i={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(i[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(n);l<o.length;l++)e.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(n,o[l])&&(i[o[l]]=n[o[l]]);return i}function Rxe(n,e,i){if(i||arguments.length===2)for(var o=0,l=e.length,u;o<l;o++)(u||!(o in e))&&(u||(u=Array.prototype.slice.call(e,0,o)),u[o]=e[o]);return n.concat(u||Array.prototype.slice.call(e))}function One(n){return n}function kne(n,e){e===void 0&&(e=One);var i=[],o=!1,l={read:function(){if(o)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:n},useMedium:function(u){var f=e(u,o);return i.push(f),function(){i=i.filter(function(y){return y!==f})}},assignSyncMedium:function(u){for(o=!0;i.length;){var f=i;i=[],f.forEach(u)}i={push:function(y){return u(y)},filter:function(){return i}}},assignMedium:function(u){o=!0;var f=[];if(i.length){var y=i;i=[],y.forEach(u),f=i}var v=function(){var C=f;f=[],C.forEach(u)},b=function(){return Promise.resolve().then(v)};b(),i={push:function(C){f.push(C),b()},filter:function(C){return f=f.filter(C),i}}}};return l}function K3(n,e){return e===void 0&&(e=One),kne(n,e)}function Nne(n){n===void 0&&(n={});var e=kne(null);return e.options=wp({async:!0,ssr:!1},n),e}var xne=function(n){var e=n.sideCar,i=MR(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var o=e.read();if(!o)throw new Error("Sidecar medium not found");return k.createElement(o,wp({},i))};xne.isSideCarExport=!0;function Ixe(n,e){return n.useMedium(e),xne}var Dne=K3({},function(n){var e=n.target,i=n.currentTarget;return{target:e,currentTarget:i}}),Lne=K3(),Axe=K3(),Pxe=Nne({async:!0,ssr:typeof document<"u"}),Oxe=k.createContext(void 0),kxe=[],q3=k.forwardRef(function(e,i){var o,l=k.useState(),u=l[0],f=l[1],y=k.useRef(),v=k.useRef(!1),b=k.useRef(null),C=k.useState({}),R=C[1],O=e.children,L=e.disabled,D=L===void 0?!1:L,U=e.noFocusGuards,B=U===void 0?!1:U,Y=e.persistentFocus,W=Y===void 0?!1:Y,ne=e.crossFrame,le=ne===void 0?!0:ne,re=e.autoFocus,me=re===void 0?!0:re;e.allowTextSelection;var q=e.group,J=e.className,Q=e.whiteList,ie=e.hasPositiveIndices,pe=e.shards,de=pe===void 0?kxe:pe,he=e.as,Se=he===void 0?"div":he,Ie=e.lockProps,Fe=Ie===void 0?{}:Ie,we=e.sideCar,Re=e.returnFocus,Te=Re===void 0?!1:Re,Ne=e.focusOptions,be=e.onActivation,xe=e.onDeactivation,je=k.useState({}),nt=je[0],dt=k.useCallback(function(an){var jt=an.captureFocusRestore;if(!b.current){var on,St=(on=document)==null?void 0:on.activeElement;b.current=St,St!==document.body&&(b.current=jt(St))}y.current&&be&&be(y.current),v.current=!0,R()},[be]),ft=k.useCallback(function(){v.current=!1,xe&&xe(y.current),R()},[xe]),lt=k.useCallback(function(an){var jt=b.current;if(jt){var on=(typeof jt=="function"?jt():jt)||document.body,St=typeof Te=="function"?Te(on):Te;if(St){var ve=typeof St=="object"?St:void 0;b.current=null,an?Promise.resolve().then(function(){return on.focus(ve)}):on.focus(ve)}}},[Te]),gt=k.useCallback(function(an){v.current&&Dne.useMedium(an)},[]),at=Lne.useMedium,Ct=k.useCallback(function(an){y.current!==an&&(y.current=an,f(an))},[]),En=Xy((o={},o[Ane]=D&&"disabled",o[jV]=q,o),Fe),Gt=B!==!0,Xt=Gt&&B!=="tail",st=Pne([i,Ct]),hn=k.useMemo(function(){return{observed:y,shards:de,enabled:!D,active:v.current}},[D,v.current,de,u]);return gi.createElement(k.Fragment,null,Gt&&[gi.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:D?-1:0,style:IU}),ie?gi.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:D?-1:1,style:IU}):null],!D&&gi.createElement(we,{id:nt,sideCar:Pxe,observed:u,disabled:D,persistentFocus:W,crossFrame:le,autoFocus:me,whiteList:Q,shards:de,onActivation:dt,onDeactivation:ft,returnFocus:lt,focusOptions:Ne,noFocusGuards:B}),gi.createElement(Se,Xy({ref:st},En,{className:J,onBlur:at,onFocus:gt}),gi.createElement(Oxe.Provider,{value:hn},O)),Xt&&gi.createElement("div",{"data-focus-guard":!0,tabIndex:D?-1:0,style:IU}))});q3.propTypes={};function FV(n,e){return FV=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,o){return i.__proto__=o,i},FV(n,e)}function Nxe(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,FV(n,e)}function oR(n){"@babel/helpers - typeof";return oR=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oR(n)}function xxe(n,e){if(oR(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var o=i.call(n,e);if(oR(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Dxe(n){var e=xxe(n,"string");return oR(e)=="symbol"?e:e+""}function Lxe(n,e,i){return(e=Dxe(e))in n?Object.defineProperty(n,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[e]=i,n}function Mxe(n,e){function i(o){return o.displayName||o.name||"Component"}return function(l){var u=[],f;function y(){f=n(u.map(function(b){return b.props})),e(f)}var v=(function(b){Nxe(C,b);function C(){return b.apply(this,arguments)||this}C.peek=function(){return f};var R=C.prototype;return R.componentDidMount=function(){u.push(this),y()},R.componentDidUpdate=function(){y()},R.componentWillUnmount=function(){var L=u.indexOf(this);u.splice(L,1),y()},R.render=function(){return gi.createElement(l,this.props)},C})(k.PureComponent);return Lxe(v,"displayName","SideEffect("+i(l)+")"),v}}var zp=function(n){for(var e=Array(n.length),i=0;i<n.length;++i)e[i]=n[i];return e},eE=function(n){return Array.isArray(n)?n:[n]},Mne=function(n){return Array.isArray(n)?n[0]:n},Uxe=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var e=window.getComputedStyle(n,null);return!e||!e.getPropertyValue?!1:e.getPropertyValue("display")==="none"||e.getPropertyValue("visibility")==="hidden"},Une=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},Vne=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},Vxe=function(n){return n.hasAttribute("inert")},jxe=function(n,e){return!n||Vne(n)||!Uxe(n)&&!Vxe(n)&&e(Une(n))},jne=function(n,e){var i=n.get(e);if(i!==void 0)return i;var o=jxe(e,jne.bind(void 0,n));return n.set(e,o),o},Fxe=function(n,e){return n&&!Vne(n)?Wxe(n)?e(Une(n)):!1:!0},Fne=function(n,e){var i=n.get(e);if(i!==void 0)return i;var o=Fxe(e,Fne.bind(void 0,n));return n.set(e,o),o},Bne=function(n){return n.dataset},Bxe=function(n){return n.tagName==="BUTTON"},zne=function(n){return n.tagName==="INPUT"},Wne=function(n){return zne(n)&&n.type==="radio"},zxe=function(n){return!((zne(n)||Bxe(n))&&(n.type==="hidden"||n.disabled))},Wxe=function(n){var e=n.getAttribute(wxe);return![!0,"true",""].includes(e)},Y3=function(n){var e;return!!(n&&(!((e=Bne(n))===null||e===void 0)&&e.focusGuard))},BV=function(n){return!Y3(n)},Gxe=function(n){return!!n},Hxe=function(n,e){var i=Math.max(0,n.tabIndex),o=Math.max(0,e.tabIndex),l=i-o,u=n.index-e.index;if(l){if(!i)return 1;if(!o)return-1}return l||u},$xe=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},X3=function(n,e,i){return zp(n).map(function(o,l){var u=$xe(o);return{node:o,index:l,tabIndex:i&&u===-1?(o.dataset||{}).focusGuard?0:-1:u}}).filter(function(o){return!e||o.tabIndex>=0}).sort(Hxe)},Kxe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],J3=Kxe.join(","),qxe="".concat(J3,", [data-focus-guard]"),Gne=function(n,e){return zp((n.shadowRoot||n).children).reduce(function(i,o){return i.concat(o.matches(e?qxe:J3)?[o]:[],Gne(o))},[])},Yxe=function(n,e){var i;return n instanceof HTMLIFrameElement&&(!((i=n.contentDocument)===null||i===void 0)&&i.body)?IS([n.contentDocument.body],e):[n]},IS=function(n,e){return n.reduce(function(i,o){var l,u=Gne(o,e),f=(l=[]).concat.apply(l,u.map(function(y){return Yxe(y,e)}));return i.concat(f,o.parentNode?zp(o.parentNode.querySelectorAll(J3)).filter(function(y){return y===o}):[])},[])},Xxe=function(n){var e=n.querySelectorAll("[".concat(bxe,"]"));return zp(e).map(function(i){return IS([i])}).reduce(function(i,o){return i.concat(o)},[])},Q3=function(n,e){return zp(n).filter(function(i){return jne(e,i)}).filter(function(i){return zxe(i)})},EX=function(n,e){return e===void 0&&(e=new Map),zp(n).filter(function(i){return Fne(e,i)})},Z3=function(n,e,i){return X3(Q3(IS(n,i),e),!0,i)},aR=function(n,e){return X3(Q3(IS(n),e),!1)},Jxe=function(n,e){return Q3(Xxe(n),e)},Wy=function(n,e){return n.shadowRoot?Wy(n.shadowRoot,e):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,e)?!0:zp(n.children).some(function(i){var o;if(i instanceof HTMLIFrameElement){var l=(o=i.contentDocument)===null||o===void 0?void 0:o.body;return l?Wy(l,e):!1}return Wy(i,e)})},Qxe=function(n){for(var e=new Set,i=n.length,o=0;o<i;o+=1)for(var l=o+1;l<i;l+=1){var u=n[o].compareDocumentPosition(n[l]);(u&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&e.add(l),(u&Node.DOCUMENT_POSITION_CONTAINS)>0&&e.add(o)}return n.filter(function(f,y){return!e.has(y)})},Hne=function(n){return n.parentNode?Hne(n.parentNode):n},ej=function(n){var e=eE(n);return e.filter(Boolean).reduce(function(i,o){var l=o.getAttribute(jV);return i.push.apply(i,l?Qxe(zp(Hne(o).querySelectorAll("[".concat(jV,'="').concat(l,'"]:not([').concat(Ane,'="disabled"])')))):[o]),i},[])},Zxe=function(n){try{return n()}catch{return}},cR=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var e=n.activeElement;return e.shadowRoot?cR(e.shadowRoot):e instanceof HTMLIFrameElement&&Zxe(function(){return e.contentWindow.document})?cR(e.contentWindow.document):e}},eDe=function(n,e){return n===e},tDe=function(n,e){return!!zp(n.querySelectorAll("iframe")).some(function(i){return eDe(i,e)})},$ne=function(n,e){return e===void 0&&(e=cR(Mne(n).ownerDocument)),!e||e.dataset&&e.dataset.focusGuard?!1:ej(n).some(function(i){return Wy(i,e)||tDe(i,e)})},nDe=function(n){n===void 0&&(n=document);var e=cR(n);return e?zp(n.querySelectorAll("[".concat(Sxe,"]"))).some(function(i){return Wy(i,e)}):!1},rDe=function(n,e){return e.filter(Wne).filter(function(i){return i.name===n.name}).filter(function(i){return i.checked})[0]||n},tj=function(n,e){return Wne(n)&&n.name?rDe(n,e):n},iDe=function(n){var e=new Set;return n.forEach(function(i){return e.add(tj(i,n))}),n.filter(function(i){return e.has(i)})},vX=function(n){return n[0]&&n.length>1?tj(n[0],n):n[0]},SX=function(n,e){return n.indexOf(tj(e,n))},zV="NEW_FOCUS",sDe=function(n,e,i,o,l){var u=n.length,f=n[0],y=n[u-1],v=Y3(o);if(!(o&&n.indexOf(o)>=0)){var b=o!==void 0?i.indexOf(o):-1,C=l?i.indexOf(l):b,R=l?n.indexOf(l):-1;if(b===-1)return R!==-1?R:zV;if(R===-1)return zV;var O=b-C,L=i.indexOf(f),D=i.indexOf(y),U=iDe(i),B=o!==void 0?U.indexOf(o):-1,Y=l?U.indexOf(l):B,W=U.filter(function(J){return J.tabIndex>=0}),ne=o!==void 0?W.indexOf(o):-1,le=l?W.indexOf(l):ne,re=ne>=0&&le>=0?le-ne:Y-B;if(!O&&R>=0||e.length===0)return R;var me=SX(n,e[0]),q=SX(n,e[e.length-1]);if(b<=L&&v&&Math.abs(O)>1)return q;if(b>=D&&v&&Math.abs(O)>1)return me;if(O&&Math.abs(re)>1)return R;if(b<=L)return q;if(b>D)return me;if(O)return Math.abs(O)>1?R:(u+R+O)%u}},oDe=function(n){return function(e){var i,o=(i=Bne(e))===null||i===void 0?void 0:i.autofocus;return e.autofocus||o!==void 0&&o!=="false"||n.indexOf(e)>=0}},bX=function(n,e,i){var o=n.map(function(u){var f=u.node;return f}),l=EX(o.filter(oDe(i)));return l&&l.length?vX(l):vX(EX(e))},WV=function(n,e){return e===void 0&&(e=[]),e.push(n),n.parentNode&&WV(n.parentNode.host||n.parentNode,e),e},AU=function(n,e){for(var i=WV(n),o=WV(e),l=0;l<i.length;l+=1){var u=i[l];if(o.indexOf(u)>=0)return u}return!1},Kne=function(n,e,i){var o=eE(n),l=eE(e),u=o[0],f=!1;return l.filter(Boolean).forEach(function(y){f=AU(f||y,y)||f,i.filter(Boolean).forEach(function(v){var b=AU(u,v);b&&(!f||Wy(b,f)?f=b:f=AU(b,f))})}),f},wX=function(n,e){return n.reduce(function(i,o){return i.concat(Jxe(o,e))},[])},aDe=function(n,e){var i=new Map;return e.forEach(function(o){return i.set(o.node,o)}),n.map(function(o){return i.get(o)}).filter(Gxe)},cDe=function(n,e){var i=cR(eE(n).length>0?document:Mne(n).ownerDocument),o=ej(n).filter(BV),l=Kne(i||n,n,o),u=new Map,f=aR(o,u),y=f.filter(function(D){var U=D.node;return BV(U)});if(y[0]){var v=aR([l],u).map(function(D){var U=D.node;return U}),b=aDe(v,y),C=b.map(function(D){var U=D.node;return U}),R=b.filter(function(D){var U=D.tabIndex;return U>=0}).map(function(D){var U=D.node;return U}),O=sDe(C,R,v,i,e);if(O===zV){var L=bX(f,R,wX(o,u))||bX(f,C,wX(o,u));if(L)return{node:L};console.warn("focus-lock: cannot find any node to move focus into");return}return O===void 0?O:b[O]}},lDe=function(n){var e=ej(n).filter(BV),i=Kne(n,n,e),o=X3(IS([i],!0),!0,!0),l=IS(e,!1);return o.map(function(u){var f=u.node,y=u.index;return{node:f,index:y,lockItem:l.indexOf(f)>=0,guard:Y3(f)}})},nj=function(n,e){n&&("focus"in n&&n.focus(e),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},PU=0,OU=!1,qne=function(n,e,i){i===void 0&&(i={});var o=cDe(n,e);if(!OU&&o){if(PU>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),OU=!0,setTimeout(function(){OU=!1},1);return}PU++,nj(o.node,i.focusOptions),PU--}};function qT(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var e=n?new WeakRef(n):null;return function(){return(e==null?void 0:e.deref())||null}}var uDe=function(n){if(!n)return null;for(var e=[],i=n;i&&i!==document.body;)e.push({current:qT(i),parent:qT(i.parentElement),left:qT(i.previousElementSibling),right:qT(i.nextElementSibling)}),i=i.parentElement;return{element:qT(n),stack:e,ownerDocument:n.ownerDocument}},dDe=function(n){var e,i,o,l,u;if(n)for(var f=n.stack,y=n.ownerDocument,v=new Map,b=0,C=f;b<C.length;b++){var R=C[b],O=(e=R.parent)===null||e===void 0?void 0:e.call(R);if(O&&y.contains(O)){for(var L=(i=R.left)===null||i===void 0?void 0:i.call(R),D=R.current(),U=O.contains(D)?D:void 0,B=(o=R.right)===null||o===void 0?void 0:o.call(R),Y=Z3([O],v),W=(u=(l=U??(L==null?void 0:L.nextElementSibling))!==null&&l!==void 0?l:B)!==null&&u!==void 0?u:L;W;){for(var ne=0,le=Y;ne<le.length;ne++){var re=le[ne];if(W!=null&&W.contains(re.node))return re.node}W=W.nextElementSibling}if(Y.length)return Y[0].node}}},Yne=function(n){var e=uDe(n);return function(){return dDe(e)}},hDe=function(n,e,i){if(!n||!e)return console.error("no element or scope given"),{};var o=eE(e);if(o.every(function(f){return!Wy(f,n)}))return console.error("Active element is not contained in the scope"),{};var l=i?Z3(o,new Map):aR(o,new Map),u=l.findIndex(function(f){var y=f.node;return y===n});if(u!==-1)return{prev:l[u-1],next:l[u+1],first:l[0],last:l[l.length-1]}},pDe=function(n,e){var i=e?Z3(eE(n),new Map):aR(eE(n),new Map);return{first:i[0],last:i[i.length-1]}},fDe=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},Xne=function(n,e,i){e===void 0&&(e={});var o=fDe(e),l=hDe(n,o.scope,o.onlyTabbable);if(l){var u=i(l,o.cycle);u&&nj(u.node,o.focusOptions)}},mDe=function(n,e){e===void 0&&(e={}),Xne(n,e,function(i,o){var l=i.next,u=i.first;return l||o&&u})},gDe=function(n,e){e===void 0&&(e={}),Xne(n,e,function(i,o){var l=i.prev,u=i.last;return l||o&&u})},Jne=function(n,e,i){var o,l=pDe(n,(o=e.onlyTabbable)!==null&&o!==void 0?o:!0),u=l[i];u&&nj(u.node,e.focusOptions)},_De=function(n,e){e===void 0&&(e={}),Jne(n,e,"first")},yDe=function(n,e){e===void 0&&(e={}),Jne(n,e,"last")};function rj(n){setTimeout(n,1)}var EDe=function(e){return e&&"current"in e?e.current:e},Qne=function(){return document&&document.activeElement===document.body},vDe=function(){return Qne()||nDe()},cS=null,gl=null,TX=function(){return null},lS=null,lR=!1,ij=!1,SDe=function(){return!0},bDe=function(e){return(cS.whiteList||SDe)(e)},wDe=function(e,i){lS={observerNode:e,portaledElement:i}},TDe=function(e){return lS&&lS.portaledElement===e};function CX(n,e,i,o){var l=null,u=n;do{var f=o[u];if(f.guard)f.node.dataset.focusAutoGuard&&(l=f);else if(f.lockItem){if(u!==n)return;l=null}else break}while((u+=i)!==e);l&&(l.node.tabIndex=0)}var CDe=function(e){return e?!!lR:lR==="meanwhile"},RDe=function n(e,i,o){return i&&(i.host===e&&(!i.activeElement||o.contains(i.activeElement))||i.parentNode&&n(e,i.parentNode,o))},IDe=function(e,i){return i.some(function(o){return RDe(e,o,o)})},Zne=function(e){return aR(e,new Map)},ADe=function(e){return!Zne([e.parentNode]).some(function(i){return i.node===e})},ak=function(){var e=!1;if(cS){var i=cS,o=i.observed,l=i.persistentFocus,u=i.autoFocus,f=i.shards,y=i.crossFrame,v=i.focusOptions,b=i.noFocusGuards,C=o||lS&&lS.portaledElement;if(Qne()&&gl&&gl!==document.body&&(!document.body.contains(gl)||ADe(gl))){var R=TX();R&&R.focus()}var O=document&&document.activeElement;if(C){var L=[C].concat(f.map(EDe).filter(Boolean)),D=function(){if(!CDe(y)||!b||!gl||ij)return!1;var ne=Zne(L),le=ne.findIndex(function(re){var me=re.node;return me===gl});return le===0||le===ne.length-1};if((!O||bDe(O))&&(l||D()||!vDe()||!gl&&u)&&(C&&!($ne(L)||O&&IDe(O,L)||TDe(O))&&(document&&!gl&&O&&!u?(O.blur&&O.blur(),document.body.focus()):(e=qne(L,gl,{focusOptions:v}),lS={})),gl=document&&document.activeElement,gl!==document.body&&(TX=Yne(gl)),lR=!1),document&&O!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var U=document&&document.activeElement,B=lDe(L),Y=B.map(function(W){var ne=W.node;return ne}).indexOf(U);Y>-1&&(B.filter(function(W){var ne=W.guard,le=W.node;return ne&&le.dataset.focusAutoGuard}).forEach(function(W){var ne=W.node;return ne.removeAttribute("tabIndex")}),CX(Y,B.length,1,B),CX(Y,-1,-1,B))}}}return e},ere=function(e){ak()&&e&&(e.stopPropagation(),e.preventDefault())},sj=function(){return rj(ak)},PDe=function(e){var i=e.target,o=e.currentTarget;o.contains(i)||wDe(o,i)},ODe=function(){return null},tre=function(){ij=!0},nre=function(){ij=!1,lR="just",rj(function(){lR="meanwhile"})},kDe=function(){document.addEventListener("focusin",ere),document.addEventListener("focusout",sj),window.addEventListener("focus",tre),window.addEventListener("blur",nre)},NDe=function(){document.removeEventListener("focusin",ere),document.removeEventListener("focusout",sj),window.removeEventListener("focus",tre),window.removeEventListener("blur",nre)};function xDe(n){return n.filter(function(e){var i=e.disabled;return!i})}var rre={moveFocusInside:qne,focusInside:$ne,focusNextElement:mDe,focusPrevElement:gDe,focusFirstElement:_De,focusLastElement:yDe,captureFocusRestore:Yne};function DDe(n){var e=n.slice(-1)[0];e&&!cS&&kDe();var i=cS,o=i&&e&&e.id===i.id;cS=e,i&&!o&&(i.onDeactivation(),n.filter(function(l){var u=l.id;return u===i.id}).length||i.returnFocus(!e)),e?(gl=null,(!o||i.observed!==e.observed)&&e.onActivation(rre),ak(),rj(ak)):(NDe(),gl=null)}Dne.assignSyncMedium(PDe);Lne.assignMedium(sj);Axe.assignMedium(function(n){return n(rre)});const LDe=Mxe(xDe,DDe)(ODe);var GV=k.forwardRef(function(e,i){return gi.createElement(q3,Xy({sideCar:LDe,ref:i},e))}),ire=q3.propTypes||{};ire.sideCar;gxe(ire,["sideCar"]);GV.propTypes={};const MDe=GV.default??GV,sre=n=>{const{initialFocusRef:e,finalFocusRef:i,contentRef:o,restoreFocus:l,children:u,isDisabled:f,autoFocus:y,persistentFocus:v,lockFocusAcrossFrames:b}=n,C=k.useCallback(()=>{e!=null&&e.current?e.current.focus():o!=null&&o.current&&zZ(o.current).length===0&&requestAnimationFrame(()=>{var D;(D=o.current)==null||D.focus()})},[e,o]),R=k.useCallback(()=>{var L;(L=i==null?void 0:i.current)==null||L.focus()},[i]),O=l&&!i;return S.jsx(MDe,{crossFrame:b,persistentFocus:v,autoFocus:y,disabled:f,onActivation:C,onDeactivation:R,returnFocus:O,children:u})};sre.displayName="FocusLock";const[UDe,VDe]=Ai({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),Sp=zt((n,e)=>{const i=Ba("FormError",n),o=Hi(n),l=YS();return l!=null&&l.isInvalid?S.jsx(UDe,{value:i,children:S.jsx(Mt.div,{...l==null?void 0:l.getErrorMessageProps(o,e),className:bn("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...i.text}})}):null});Sp.displayName="FormErrorMessage";const jDe=zt((n,e)=>{const i=VDe(),o=YS();if(!(o!=null&&o.isInvalid))return null;const l=bn("chakra-form__error-icon",n.className);return S.jsx(Zt,{ref:e,"aria-hidden":!0,...n,__css:i.icon,className:l,children:S.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});jDe.displayName="FormErrorIcon";const os=zt(function(e,i){const o=gd("FormLabel",e),l=Hi(e),{className:u,children:f,requiredIndicator:y=S.jsx(ore,{}),optionalIndicator:v=null,...b}=l,C=YS(),R=(C==null?void 0:C.getLabelProps(b,i))??{ref:i,...b};return S.jsxs(Mt.label,{...R,className:bn("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...o},children:[f,C!=null&&C.isRequired?y:v]})});os.displayName="FormLabel";const ore=zt(function(e,i){const o=YS(),l=Ine();if(!(o!=null&&o.isRequired))return null;const u=bn("chakra-form__required-indicator",e.className);return S.jsx(Mt.span,{...o==null?void 0:o.getRequiredIndicatorProps(e,i),__css:l.requiredIndicator,className:u})});ore.displayName="RequiredIndicator";const ck=zt(function(e,i){const{templateAreas:o,gap:l,rowGap:u,columnGap:f,column:y,row:v,autoFlow:b,autoRows:C,templateRows:R,autoColumns:O,templateColumns:L,...D}=e,U={display:"grid",gridTemplateAreas:o,gridGap:l,gridRowGap:u,gridColumnGap:f,gridAutoColumns:O,gridColumn:y,gridRow:v,gridAutoFlow:b,gridAutoRows:C,gridTemplateRows:R,gridTemplateColumns:L};return S.jsx(Mt.div,{ref:i,__css:U,...D})});ck.displayName="Grid";const oj=zt(function(e,i){const{columns:o,spacingX:l,spacingY:u,spacing:f,minChildWidth:y,...v}=e,b=qS(),C=y?BDe(y,b):zDe(o);return S.jsx(ck,{ref:i,gap:f,columnGap:l,rowGap:u,templateColumns:C,...v})});oj.displayName="SimpleGrid";function FDe(n){return typeof n=="number"?`${n}px`:n}function BDe(n,e){return F5(n,i=>{const o=_Ne("sizes",i,FDe(i))(e);return i===null?null:`repeat(auto-fit, minmax(${o}, 1fr))`})}function zDe(n){return F5(n,e=>e===null?null:`repeat(${e}, minmax(0, 1fr))`)}function Wp(n){const{viewBox:e="0 0 24 24",d:i,displayName:o,defaultProps:l={}}=n,u=k.Children.toArray(n.path),f=zt((y,v)=>S.jsx(Zt,{ref:v,viewBox:e,...l,...y,children:u.length?u:S.jsx("path",{fill:"currentColor",d:i})}));return f.displayName=o,f}const HV=zt(function(e,i){const{htmlWidth:o,htmlHeight:l,alt:u,...f}=e;return S.jsx("img",{width:o,height:l,ref:i,alt:u,...f})});HV.displayName="NativeImage";const Cp=zt(function(e,i){const{fallbackSrc:o,fallback:l,src:u,srcSet:f,align:y,fit:v,loading:b,ignoreFallback:C,crossOrigin:R,fallbackStrategy:O="beforeLoadOrError",referrerPolicy:L,...D}=e,U=o!==void 0||l!==void 0,B=b!=null||C||!U,Y=Tne({...e,crossOrigin:R,ignoreFallback:B}),W=XNe(Y,O),ne={ref:i,objectFit:v,objectPosition:y,...B?D:CR(D,["onError","onLoad"])};return W?l||S.jsx(Mt.img,{as:HV,className:"chakra-image__placeholder",src:o,...ne}):S.jsx(Mt.img,{as:HV,src:u,srcSet:f,crossOrigin:R,loading:b,referrerPolicy:L,className:"chakra-image",...ne})});Cp.displayName="Image";const Li=zt(function(e,i){const{htmlSize:o,...l}=e,u=Ba("Input",l),f=Hi(l),y=H3(f),v=bn("chakra-input",e.className);return S.jsx(Mt.input,{size:o,...y,__css:u.field,ref:i,className:v})});Li.displayName="Input";Li.id="Input";const[WDe,are]=Ai({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),Ag=zt(function(e,i){const o=Ba("Input",e),{children:l,className:u,...f}=Hi(e),y=bn("chakra-input__group",u),v={},b=Bk(l),C=o.field;b.forEach(O=>{o&&(C&&O.type.id==="InputLeftElement"&&(v.paddingStart=C.height??C.h),C&&O.type.id==="InputRightElement"&&(v.paddingEnd=C.height??C.h),O.type.id==="InputRightAddon"&&(v.borderEndRadius=0),O.type.id==="InputLeftAddon"&&(v.borderStartRadius=0))});const R=b.map(O=>{var D,U;const L=U5({size:((D=O.props)==null?void 0:D.size)||e.size,variant:((U=O.props)==null?void 0:U.variant)||e.variant});return O.type.id!=="Input"?k.cloneElement(O,L):k.cloneElement(O,Object.assign(L,v,O.props))});return S.jsx(Mt.div,{className:y,ref:i,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...o.group},"data-group":!0,...f,children:S.jsx(WDe,{value:o,children:R})})});Ag.displayName="InputGroup";const GDe={left:{marginEnd:"-1px",borderEndRadius:0,borderEndColor:"transparent"},right:{marginStart:"-1px",borderStartRadius:0,borderStartColor:"transparent"}},HDe=Mt("div",{baseStyle:{flex:"0 0 auto",width:"auto",display:"flex",alignItems:"center",whiteSpace:"nowrap"}}),aj=zt(function(e,i){const{placement:o="left",...l}=e,u=GDe[o]??{},f=are();return S.jsx(HDe,{ref:i,...l,__css:{...f.addon,...u}})});aj.displayName="InputAddon";const cj=zt(function(e,i){return S.jsx(aj,{ref:i,placement:"left",...e,className:bn("chakra-input__left-addon",e.className)})});cj.displayName="InputLeftAddon";cj.id="InputLeftAddon";const cre=zt(function(e,i){return S.jsx(aj,{ref:i,placement:"right",...e,className:bn("chakra-input__right-addon",e.className)})});cre.displayName="InputRightAddon";cre.id="InputRightAddon";const $De=Mt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),rN=zt(function(e,i){const{placement:o="left",...l}=e,u=are(),f=u.field,v={[o==="left"?"insetStart":"insetEnd"]:"0",width:(f==null?void 0:f.height)??(f==null?void 0:f.h),height:(f==null?void 0:f.height)??(f==null?void 0:f.h),fontSize:f==null?void 0:f.fontSize,...u.element};return S.jsx($De,{ref:i,__css:v,...l})});rN.id="InputElement";rN.displayName="InputElement";const uS=zt(function(e,i){const{className:o,...l}=e,u=bn("chakra-input__left-element",o);return S.jsx(rN,{ref:i,placement:"left",className:u,...l})});uS.id="InputLeftElement";uS.displayName="InputLeftElement";const uR=zt(function(e,i){const{className:o,...l}=e,u=bn("chakra-input__right-element",o);return S.jsx(rN,{ref:i,placement:"right",className:u,...l})});uR.id="InputRightElement";uR.displayName="InputRightElement";const uu=zt(function(e,i){const o=gd("Link",e),{className:l,isExternal:u,...f}=Hi(e);return S.jsx(Mt.a,{target:u?"_blank":void 0,rel:u?"noopener":void 0,ref:i,className:bn("chakra-link",l),...f,__css:o})});uu.displayName="Link";const[KDe,lre]=Ai({name:"ListStylesContext",errorMessage:`useListStyles returned is 'undefined'. Seems you forgot to wrap the components in "<List />" `}),iN=zt(function(e,i){const o=Ba("List",e),{children:l,styleType:u="none",stylePosition:f,spacing:y,...v}=Hi(e),b=Bk(l),R=y?{"& > *:not(style) ~ *:not(style)":{mt:y}}:{};return S.jsx(KDe,{value:o,children:S.jsx(Mt.ul,{ref:i,listStyleType:u,listStylePosition:f,role:"list",__css:{...o.container,...R},...v,children:b})})});iN.displayName="List";const qDe=zt((n,e)=>{const{as:i,...o}=n;return S.jsx(iN,{ref:e,as:"ol",styleType:"decimal",marginStart:"1em",...o})});qDe.displayName="OrderedList";const YDe=zt(function(e,i){const{as:o,...l}=e;return S.jsx(iN,{ref:i,as:"ul",styleType:"initial",marginStart:"1em",...l})});YDe.displayName="UnorderedList";const ure=zt(function(e,i){const o=lre();return S.jsx(Mt.li,{ref:i,...e,__css:o.item})});ure.displayName="ListItem";const XDe=zt(function(e,i){const o=lre();return S.jsx(Zt,{ref:i,role:"presentation",...e,__css:o.icon})});XDe.displayName="ListIcon";function JDe(n,e={}){const{ssr:i=!0,fallback:o}=e,{getWindow:l}=vAe(),u=Array.isArray(n)?n:[n];let f=Array.isArray(o)?o:[o];f=f.filter(b=>b!=null);const[y,v]=k.useState(()=>u.map((b,C)=>({media:b,matches:i?!!f[C]:l().matchMedia(b).matches})));return k.useEffect(()=>{const b=l();v(u.map(O=>({media:O,matches:b.matchMedia(O).matches})));const C=u.map(O=>b.matchMedia(O)),R=O=>{v(L=>L.slice().map(D=>D.media===O.media?{...D,matches:O.matches}:D))};return C.forEach(O=>{typeof O.addListener=="function"?O.addListener(R):O.addEventListener("change",R)}),()=>{C.forEach(O=>{typeof O.removeListener=="function"?O.removeListener(R):O.removeEventListener("change",R)})}},[l]),y.map(b=>b.matches)}function QDe(n,e,i,o){if(e==null)return o;if(!o)return n.find(f=>i(f).toLowerCase().startsWith(e.toLowerCase()));const l=n.filter(u=>i(u).toLowerCase().startsWith(e.toLowerCase()));if(l.length>0){let u;return l.includes(o)?(u=l.indexOf(o)+1,u===l.length&&(u=0),l[u]):(u=n.indexOf(l[0]),n[u])}return o}function ZDe(n){const{key:e}=n;return e.length===1||e.length>1&&/[^a-zA-Z0-9]/.test(e)}function eLe(n={}){const{timeout:e=300,preventDefault:i=()=>!0}=n,[o,l]=k.useState([]),u=k.useRef(void 0),f=()=>{u.current&&(clearTimeout(u.current),u.current=null)},y=()=>{f(),u.current=setTimeout(()=>{l([]),u.current=null},e)};k.useEffect(()=>f,[]);function v(b){return C=>{if(C.key==="Backspace"){const R=[...o];R.pop(),l(R);return}if(ZDe(C)){const R=o.concat(C.key);i(C)&&(C.preventDefault(),C.stopPropagation()),l(R),b(R.join("")),y()}}}return v}var Tl="top",fd="bottom",md="right",Cl="left",lj="auto",UR=[Tl,fd,md,Cl],AS="start",dR="end",tLe="clippingParents",dre="viewport",YT="popper",nLe="reference",RX=UR.reduce(function(n,e){return n.concat([e+"-"+AS,e+"-"+dR])},[]),hre=[].concat(UR,[lj]).reduce(function(n,e){return n.concat([e,e+"-"+AS,e+"-"+dR])},[]),rLe="beforeRead",iLe="read",sLe="afterRead",oLe="beforeMain",aLe="main",cLe="afterMain",lLe="beforeWrite",uLe="write",dLe="afterWrite",hLe=[rLe,iLe,sLe,oLe,aLe,cLe,lLe,uLe,dLe];function jp(n){return n?(n.nodeName||"").toLowerCase():null}function _u(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var e=n.ownerDocument;return e&&e.defaultView||window}return n}function tE(n){var e=_u(n).Element;return n instanceof e||n instanceof Element}function ld(n){var e=_u(n).HTMLElement;return n instanceof e||n instanceof HTMLElement}function uj(n){if(typeof ShadowRoot>"u")return!1;var e=_u(n).ShadowRoot;return n instanceof e||n instanceof ShadowRoot}function pLe(n){var e=n.state;Object.keys(e.elements).forEach(function(i){var o=e.styles[i]||{},l=e.attributes[i]||{},u=e.elements[i];!ld(u)||!jp(u)||(Object.assign(u.style,o),Object.keys(l).forEach(function(f){var y=l[f];y===!1?u.removeAttribute(f):u.setAttribute(f,y===!0?"":y)}))})}function fLe(n){var e=n.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(o){var l=e.elements[o],u=e.attributes[o]||{},f=Object.keys(e.styles.hasOwnProperty(o)?e.styles[o]:i[o]),y=f.reduce(function(v,b){return v[b]="",v},{});!ld(l)||!jp(l)||(Object.assign(l.style,y),Object.keys(u).forEach(function(v){l.removeAttribute(v)}))})}}const mLe={name:"applyStyles",enabled:!0,phase:"write",fn:pLe,effect:fLe,requires:["computeStyles"]};function Np(n){return n.split("-")[0]}var Gy=Math.max,lk=Math.min,PS=Math.round;function $V(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function pre(){return!/^((?!chrome|android).)*safari/i.test($V())}function OS(n,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var o=n.getBoundingClientRect(),l=1,u=1;e&&ld(n)&&(l=n.offsetWidth>0&&PS(o.width)/n.offsetWidth||1,u=n.offsetHeight>0&&PS(o.height)/n.offsetHeight||1);var f=tE(n)?_u(n):window,y=f.visualViewport,v=!pre()&&i,b=(o.left+(v&&y?y.offsetLeft:0))/l,C=(o.top+(v&&y?y.offsetTop:0))/u,R=o.width/l,O=o.height/u;return{width:R,height:O,top:C,right:b+R,bottom:C+O,left:b,x:b,y:C}}function dj(n){var e=OS(n),i=n.offsetWidth,o=n.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-o)<=1&&(o=e.height),{x:n.offsetLeft,y:n.offsetTop,width:i,height:o}}function fre(n,e){var i=e.getRootNode&&e.getRootNode();if(n.contains(e))return!0;if(i&&uj(i)){var o=e;do{if(o&&n.isSameNode(o))return!0;o=o.parentNode||o.host}while(o)}return!1}function $f(n){return _u(n).getComputedStyle(n)}function gLe(n){return["table","td","th"].indexOf(jp(n))>=0}function Kg(n){return((tE(n)?n.ownerDocument:n.document)||window.document).documentElement}function sN(n){return jp(n)==="html"?n:n.assignedSlot||n.parentNode||(uj(n)?n.host:null)||Kg(n)}function IX(n){return!ld(n)||$f(n).position==="fixed"?null:n.offsetParent}function _Le(n){var e=/firefox/i.test($V()),i=/Trident/i.test($V());if(i&&ld(n)){var o=$f(n);if(o.position==="fixed")return null}var l=sN(n);for(uj(l)&&(l=l.host);ld(l)&&["html","body"].indexOf(jp(l))<0;){var u=$f(l);if(u.transform!=="none"||u.perspective!=="none"||u.contain==="paint"||["transform","perspective"].indexOf(u.willChange)!==-1||e&&u.willChange==="filter"||e&&u.filter&&u.filter!=="none")return l;l=l.parentNode}return null}function VR(n){for(var e=_u(n),i=IX(n);i&&gLe(i)&&$f(i).position==="static";)i=IX(i);return i&&(jp(i)==="html"||jp(i)==="body"&&$f(i).position==="static")?e:i||_Le(n)||e}function hj(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function DC(n,e,i){return Gy(n,lk(e,i))}function yLe(n,e,i){var o=DC(n,e,i);return o>i?i:o}function mre(){return{top:0,right:0,bottom:0,left:0}}function gre(n){return Object.assign({},mre(),n)}function _re(n,e){return e.reduce(function(i,o){return i[o]=n,i},{})}var ELe=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,gre(typeof e!="number"?e:_re(e,UR))};function vLe(n){var e,i=n.state,o=n.name,l=n.options,u=i.elements.arrow,f=i.modifiersData.popperOffsets,y=Np(i.placement),v=hj(y),b=[Cl,md].indexOf(y)>=0,C=b?"height":"width";if(!(!u||!f)){var R=ELe(l.padding,i),O=dj(u),L=v==="y"?Tl:Cl,D=v==="y"?fd:md,U=i.rects.reference[C]+i.rects.reference[v]-f[v]-i.rects.popper[C],B=f[v]-i.rects.reference[v],Y=VR(u),W=Y?v==="y"?Y.clientHeight||0:Y.clientWidth||0:0,ne=U/2-B/2,le=R[L],re=W-O[C]-R[D],me=W/2-O[C]/2+ne,q=DC(le,me,re),J=v;i.modifiersData[o]=(e={},e[J]=q,e.centerOffset=q-me,e)}}function SLe(n){var e=n.state,i=n.options,o=i.element,l=o===void 0?"[data-popper-arrow]":o;l!=null&&(typeof l=="string"&&(l=e.elements.popper.querySelector(l),!l)||fre(e.elements.popper,l)&&(e.elements.arrow=l))}const bLe={name:"arrow",enabled:!0,phase:"main",fn:vLe,effect:SLe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function kS(n){return n.split("-")[1]}var wLe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function TLe(n,e){var i=n.x,o=n.y,l=e.devicePixelRatio||1;return{x:PS(i*l)/l||0,y:PS(o*l)/l||0}}function AX(n){var e,i=n.popper,o=n.popperRect,l=n.placement,u=n.variation,f=n.offsets,y=n.position,v=n.gpuAcceleration,b=n.adaptive,C=n.roundOffsets,R=n.isFixed,O=f.x,L=O===void 0?0:O,D=f.y,U=D===void 0?0:D,B=typeof C=="function"?C({x:L,y:U}):{x:L,y:U};L=B.x,U=B.y;var Y=f.hasOwnProperty("x"),W=f.hasOwnProperty("y"),ne=Cl,le=Tl,re=window;if(b){var me=VR(i),q="clientHeight",J="clientWidth";if(me===_u(i)&&(me=Kg(i),$f(me).position!=="static"&&y==="absolute"&&(q="scrollHeight",J="scrollWidth")),me=me,l===Tl||(l===Cl||l===md)&&u===dR){le=fd;var Q=R&&me===re&&re.visualViewport?re.visualViewport.height:me[q];U-=Q-o.height,U*=v?1:-1}if(l===Cl||(l===Tl||l===fd)&&u===dR){ne=md;var ie=R&&me===re&&re.visualViewport?re.visualViewport.width:me[J];L-=ie-o.width,L*=v?1:-1}}var pe=Object.assign({position:y},b&&wLe),de=C===!0?TLe({x:L,y:U},_u(i)):{x:L,y:U};if(L=de.x,U=de.y,v){var he;return Object.assign({},pe,(he={},he[le]=W?"0":"",he[ne]=Y?"0":"",he.transform=(re.devicePixelRatio||1)<=1?"translate("+L+"px, "+U+"px)":"translate3d("+L+"px, "+U+"px, 0)",he))}return Object.assign({},pe,(e={},e[le]=W?U+"px":"",e[ne]=Y?L+"px":"",e.transform="",e))}function CLe(n){var e=n.state,i=n.options,o=i.gpuAcceleration,l=o===void 0?!0:o,u=i.adaptive,f=u===void 0?!0:u,y=i.roundOffsets,v=y===void 0?!0:y,b={placement:Np(e.placement),variation:kS(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:l,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,AX(Object.assign({},b,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:f,roundOffsets:v})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,AX(Object.assign({},b,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:v})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const RLe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:CLe,data:{}};var XP={passive:!0};function ILe(n){var e=n.state,i=n.instance,o=n.options,l=o.scroll,u=l===void 0?!0:l,f=o.resize,y=f===void 0?!0:f,v=_u(e.elements.popper),b=[].concat(e.scrollParents.reference,e.scrollParents.popper);return u&&b.forEach(function(C){C.addEventListener("scroll",i.update,XP)}),y&&v.addEventListener("resize",i.update,XP),function(){u&&b.forEach(function(C){C.removeEventListener("scroll",i.update,XP)}),y&&v.removeEventListener("resize",i.update,XP)}}const ALe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:ILe,data:{}};var PLe={left:"right",right:"left",bottom:"top",top:"bottom"};function PO(n){return n.replace(/left|right|bottom|top/g,function(e){return PLe[e]})}var OLe={start:"end",end:"start"};function PX(n){return n.replace(/start|end/g,function(e){return OLe[e]})}function pj(n){var e=_u(n),i=e.pageXOffset,o=e.pageYOffset;return{scrollLeft:i,scrollTop:o}}function fj(n){return OS(Kg(n)).left+pj(n).scrollLeft}function kLe(n,e){var i=_u(n),o=Kg(n),l=i.visualViewport,u=o.clientWidth,f=o.clientHeight,y=0,v=0;if(l){u=l.width,f=l.height;var b=pre();(b||!b&&e==="fixed")&&(y=l.offsetLeft,v=l.offsetTop)}return{width:u,height:f,x:y+fj(n),y:v}}function NLe(n){var e,i=Kg(n),o=pj(n),l=(e=n.ownerDocument)==null?void 0:e.body,u=Gy(i.scrollWidth,i.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),f=Gy(i.scrollHeight,i.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),y=-o.scrollLeft+fj(n),v=-o.scrollTop;return $f(l||i).direction==="rtl"&&(y+=Gy(i.clientWidth,l?l.clientWidth:0)-u),{width:u,height:f,x:y,y:v}}function mj(n){var e=$f(n),i=e.overflow,o=e.overflowX,l=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+l+o)}function yre(n){return["html","body","#document"].indexOf(jp(n))>=0?n.ownerDocument.body:ld(n)&&mj(n)?n:yre(sN(n))}function LC(n,e){var i;e===void 0&&(e=[]);var o=yre(n),l=o===((i=n.ownerDocument)==null?void 0:i.body),u=_u(o),f=l?[u].concat(u.visualViewport||[],mj(o)?o:[]):o,y=e.concat(f);return l?y:y.concat(LC(sN(f)))}function KV(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function xLe(n,e){var i=OS(n,!1,e==="fixed");return i.top=i.top+n.clientTop,i.left=i.left+n.clientLeft,i.bottom=i.top+n.clientHeight,i.right=i.left+n.clientWidth,i.width=n.clientWidth,i.height=n.clientHeight,i.x=i.left,i.y=i.top,i}function OX(n,e,i){return e===dre?KV(kLe(n,i)):tE(e)?xLe(e,i):KV(NLe(Kg(n)))}function DLe(n){var e=LC(sN(n)),i=["absolute","fixed"].indexOf($f(n).position)>=0,o=i&&ld(n)?VR(n):n;return tE(o)?e.filter(function(l){return tE(l)&&fre(l,o)&&jp(l)!=="body"}):[]}function LLe(n,e,i,o){var l=e==="clippingParents"?DLe(n):[].concat(e),u=[].concat(l,[i]),f=u[0],y=u.reduce(function(v,b){var C=OX(n,b,o);return v.top=Gy(C.top,v.top),v.right=lk(C.right,v.right),v.bottom=lk(C.bottom,v.bottom),v.left=Gy(C.left,v.left),v},OX(n,f,o));return y.width=y.right-y.left,y.height=y.bottom-y.top,y.x=y.left,y.y=y.top,y}function Ere(n){var e=n.reference,i=n.element,o=n.placement,l=o?Np(o):null,u=o?kS(o):null,f=e.x+e.width/2-i.width/2,y=e.y+e.height/2-i.height/2,v;switch(l){case Tl:v={x:f,y:e.y-i.height};break;case fd:v={x:f,y:e.y+e.height};break;case md:v={x:e.x+e.width,y};break;case Cl:v={x:e.x-i.width,y};break;default:v={x:e.x,y:e.y}}var b=l?hj(l):null;if(b!=null){var C=b==="y"?"height":"width";switch(u){case AS:v[b]=v[b]-(e[C]/2-i[C]/2);break;case dR:v[b]=v[b]+(e[C]/2-i[C]/2);break}}return v}function hR(n,e){e===void 0&&(e={});var i=e,o=i.placement,l=o===void 0?n.placement:o,u=i.strategy,f=u===void 0?n.strategy:u,y=i.boundary,v=y===void 0?tLe:y,b=i.rootBoundary,C=b===void 0?dre:b,R=i.elementContext,O=R===void 0?YT:R,L=i.altBoundary,D=L===void 0?!1:L,U=i.padding,B=U===void 0?0:U,Y=gre(typeof B!="number"?B:_re(B,UR)),W=O===YT?nLe:YT,ne=n.rects.popper,le=n.elements[D?W:O],re=LLe(tE(le)?le:le.contextElement||Kg(n.elements.popper),v,C,f),me=OS(n.elements.reference),q=Ere({reference:me,element:ne,placement:l}),J=KV(Object.assign({},ne,q)),Q=O===YT?J:me,ie={top:re.top-Q.top+Y.top,bottom:Q.bottom-re.bottom+Y.bottom,left:re.left-Q.left+Y.left,right:Q.right-re.right+Y.right},pe=n.modifiersData.offset;if(O===YT&&pe){var de=pe[l];Object.keys(ie).forEach(function(he){var Se=[md,fd].indexOf(he)>=0?1:-1,Ie=[Tl,fd].indexOf(he)>=0?"y":"x";ie[he]+=de[Ie]*Se})}return ie}function MLe(n,e){e===void 0&&(e={});var i=e,o=i.placement,l=i.boundary,u=i.rootBoundary,f=i.padding,y=i.flipVariations,v=i.allowedAutoPlacements,b=v===void 0?hre:v,C=kS(o),R=C?y?RX:RX.filter(function(D){return kS(D)===C}):UR,O=R.filter(function(D){return b.indexOf(D)>=0});O.length===0&&(O=R);var L=O.reduce(function(D,U){return D[U]=hR(n,{placement:U,boundary:l,rootBoundary:u,padding:f})[Np(U)],D},{});return Object.keys(L).sort(function(D,U){return L[D]-L[U]})}function ULe(n){if(Np(n)===lj)return[];var e=PO(n);return[PX(n),e,PX(e)]}function VLe(n){var e=n.state,i=n.options,o=n.name;if(!e.modifiersData[o]._skip){for(var l=i.mainAxis,u=l===void 0?!0:l,f=i.altAxis,y=f===void 0?!0:f,v=i.fallbackPlacements,b=i.padding,C=i.boundary,R=i.rootBoundary,O=i.altBoundary,L=i.flipVariations,D=L===void 0?!0:L,U=i.allowedAutoPlacements,B=e.options.placement,Y=Np(B),W=Y===B,ne=v||(W||!D?[PO(B)]:ULe(B)),le=[B].concat(ne).reduce(function(nt,dt){return nt.concat(Np(dt)===lj?MLe(e,{placement:dt,boundary:C,rootBoundary:R,padding:b,flipVariations:D,allowedAutoPlacements:U}):dt)},[]),re=e.rects.reference,me=e.rects.popper,q=new Map,J=!0,Q=le[0],ie=0;ie<le.length;ie++){var pe=le[ie],de=Np(pe),he=kS(pe)===AS,Se=[Tl,fd].indexOf(de)>=0,Ie=Se?"width":"height",Fe=hR(e,{placement:pe,boundary:C,rootBoundary:R,altBoundary:O,padding:b}),we=Se?he?md:Cl:he?fd:Tl;re[Ie]>me[Ie]&&(we=PO(we));var Re=PO(we),Te=[];if(u&&Te.push(Fe[de]<=0),y&&Te.push(Fe[we]<=0,Fe[Re]<=0),Te.every(function(nt){return nt})){Q=pe,J=!1;break}q.set(pe,Te)}if(J)for(var Ne=D?3:1,be=function(dt){var ft=le.find(function(lt){var gt=q.get(lt);if(gt)return gt.slice(0,dt).every(function(at){return at})});if(ft)return Q=ft,"break"},xe=Ne;xe>0;xe--){var je=be(xe);if(je==="break")break}e.placement!==Q&&(e.modifiersData[o]._skip=!0,e.placement=Q,e.reset=!0)}}const jLe={name:"flip",enabled:!0,phase:"main",fn:VLe,requiresIfExists:["offset"],data:{_skip:!1}};function kX(n,e,i){return i===void 0&&(i={x:0,y:0}),{top:n.top-e.height-i.y,right:n.right-e.width+i.x,bottom:n.bottom-e.height+i.y,left:n.left-e.width-i.x}}function NX(n){return[Tl,md,fd,Cl].some(function(e){return n[e]>=0})}function FLe(n){var e=n.state,i=n.name,o=e.rects.reference,l=e.rects.popper,u=e.modifiersData.preventOverflow,f=hR(e,{elementContext:"reference"}),y=hR(e,{altBoundary:!0}),v=kX(f,o),b=kX(y,l,u),C=NX(v),R=NX(b);e.modifiersData[i]={referenceClippingOffsets:v,popperEscapeOffsets:b,isReferenceHidden:C,hasPopperEscaped:R},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":C,"data-popper-escaped":R})}const BLe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:FLe};function zLe(n,e,i){var o=Np(n),l=[Cl,Tl].indexOf(o)>=0?-1:1,u=typeof i=="function"?i(Object.assign({},e,{placement:n})):i,f=u[0],y=u[1];return f=f||0,y=(y||0)*l,[Cl,md].indexOf(o)>=0?{x:y,y:f}:{x:f,y}}function WLe(n){var e=n.state,i=n.options,o=n.name,l=i.offset,u=l===void 0?[0,0]:l,f=hre.reduce(function(C,R){return C[R]=zLe(R,e.rects,u),C},{}),y=f[e.placement],v=y.x,b=y.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=v,e.modifiersData.popperOffsets.y+=b),e.modifiersData[o]=f}const GLe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:WLe};function HLe(n){var e=n.state,i=n.name;e.modifiersData[i]=Ere({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const $Le={name:"popperOffsets",enabled:!0,phase:"read",fn:HLe,data:{}};function KLe(n){return n==="x"?"y":"x"}function qLe(n){var e=n.state,i=n.options,o=n.name,l=i.mainAxis,u=l===void 0?!0:l,f=i.altAxis,y=f===void 0?!1:f,v=i.boundary,b=i.rootBoundary,C=i.altBoundary,R=i.padding,O=i.tether,L=O===void 0?!0:O,D=i.tetherOffset,U=D===void 0?0:D,B=hR(e,{boundary:v,rootBoundary:b,padding:R,altBoundary:C}),Y=Np(e.placement),W=kS(e.placement),ne=!W,le=hj(Y),re=KLe(le),me=e.modifiersData.popperOffsets,q=e.rects.reference,J=e.rects.popper,Q=typeof U=="function"?U(Object.assign({},e.rects,{placement:e.placement})):U,ie=typeof Q=="number"?{mainAxis:Q,altAxis:Q}:Object.assign({mainAxis:0,altAxis:0},Q),pe=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,de={x:0,y:0};if(me){if(u){var he,Se=le==="y"?Tl:Cl,Ie=le==="y"?fd:md,Fe=le==="y"?"height":"width",we=me[le],Re=we+B[Se],Te=we-B[Ie],Ne=L?-J[Fe]/2:0,be=W===AS?q[Fe]:J[Fe],xe=W===AS?-J[Fe]:-q[Fe],je=e.elements.arrow,nt=L&&je?dj(je):{width:0,height:0},dt=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:mre(),ft=dt[Se],lt=dt[Ie],gt=DC(0,q[Fe],nt[Fe]),at=ne?q[Fe]/2-Ne-gt-ft-ie.mainAxis:be-gt-ft-ie.mainAxis,Ct=ne?-q[Fe]/2+Ne+gt+lt+ie.mainAxis:xe+gt+lt+ie.mainAxis,En=e.elements.arrow&&VR(e.elements.arrow),Gt=En?le==="y"?En.clientTop||0:En.clientLeft||0:0,Xt=(he=pe==null?void 0:pe[le])!=null?he:0,st=we+at-Xt-Gt,hn=we+Ct-Xt,an=DC(L?lk(Re,st):Re,we,L?Gy(Te,hn):Te);me[le]=an,de[le]=an-we}if(y){var jt,on=le==="x"?Tl:Cl,St=le==="x"?fd:md,ve=me[re],De=re==="y"?"height":"width",Ke=ve+B[on],Ot=ve-B[St],Et=[Tl,Cl].indexOf(Y)!==-1,Pt=(jt=pe==null?void 0:pe[re])!=null?jt:0,Ut=Et?Ke:ve-q[De]-J[De]-Pt+ie.altAxis,cn=Et?ve+q[De]+J[De]-Pt-ie.altAxis:Ot,_t=L&&Et?yLe(Ut,ve,cn):DC(L?Ut:Ke,ve,L?cn:Ot);me[re]=_t,de[re]=_t-ve}e.modifiersData[o]=de}}const YLe={name:"preventOverflow",enabled:!0,phase:"main",fn:qLe,requiresIfExists:["offset"]};function XLe(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function JLe(n){return n===_u(n)||!ld(n)?pj(n):XLe(n)}function QLe(n){var e=n.getBoundingClientRect(),i=PS(e.width)/n.offsetWidth||1,o=PS(e.height)/n.offsetHeight||1;return i!==1||o!==1}function ZLe(n,e,i){i===void 0&&(i=!1);var o=ld(e),l=ld(e)&&QLe(e),u=Kg(e),f=OS(n,l,i),y={scrollLeft:0,scrollTop:0},v={x:0,y:0};return(o||!o&&!i)&&((jp(e)!=="body"||mj(u))&&(y=JLe(e)),ld(e)?(v=OS(e,!0),v.x+=e.clientLeft,v.y+=e.clientTop):u&&(v.x=fj(u))),{x:f.left+y.scrollLeft-v.x,y:f.top+y.scrollTop-v.y,width:f.width,height:f.height}}function e2e(n){var e=new Map,i=new Set,o=[];n.forEach(function(u){e.set(u.name,u)});function l(u){i.add(u.name);var f=[].concat(u.requires||[],u.requiresIfExists||[]);f.forEach(function(y){if(!i.has(y)){var v=e.get(y);v&&l(v)}}),o.push(u)}return n.forEach(function(u){i.has(u.name)||l(u)}),o}function t2e(n){var e=e2e(n);return hLe.reduce(function(i,o){return i.concat(e.filter(function(l){return l.phase===o}))},[])}function n2e(n){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(n())})})),e}}function r2e(n){var e=n.reduce(function(i,o){var l=i[o.name];return i[o.name]=l?Object.assign({},l,o,{options:Object.assign({},l.options,o.options),data:Object.assign({},l.data,o.data)}):o,i},{});return Object.keys(e).map(function(i){return e[i]})}var xX={placement:"bottom",modifiers:[],strategy:"absolute"};function DX(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return!e.some(function(o){return!(o&&typeof o.getBoundingClientRect=="function")})}function i2e(n){n===void 0&&(n={});var e=n,i=e.defaultModifiers,o=i===void 0?[]:i,l=e.defaultOptions,u=l===void 0?xX:l;return function(y,v,b){b===void 0&&(b=u);var C={placement:"bottom",orderedModifiers:[],options:Object.assign({},xX,u),modifiersData:{},elements:{reference:y,popper:v},attributes:{},styles:{}},R=[],O=!1,L={state:C,setOptions:function(Y){var W=typeof Y=="function"?Y(C.options):Y;U(),C.options=Object.assign({},u,C.options,W),C.scrollParents={reference:tE(y)?LC(y):y.contextElement?LC(y.contextElement):[],popper:LC(v)};var ne=t2e(r2e([].concat(o,C.options.modifiers)));return C.orderedModifiers=ne.filter(function(le){return le.enabled}),D(),L.update()},forceUpdate:function(){if(!O){var Y=C.elements,W=Y.reference,ne=Y.popper;if(DX(W,ne)){C.rects={reference:ZLe(W,VR(ne),C.options.strategy==="fixed"),popper:dj(ne)},C.reset=!1,C.placement=C.options.placement,C.orderedModifiers.forEach(function(ie){return C.modifiersData[ie.name]=Object.assign({},ie.data)});for(var le=0;le<C.orderedModifiers.length;le++){if(C.reset===!0){C.reset=!1,le=-1;continue}var re=C.orderedModifiers[le],me=re.fn,q=re.options,J=q===void 0?{}:q,Q=re.name;typeof me=="function"&&(C=me({state:C,options:J,name:Q,instance:L})||C)}}}},update:n2e(function(){return new Promise(function(B){L.forceUpdate(),B(C)})}),destroy:function(){U(),O=!0}};if(!DX(y,v))return L;L.setOptions(b).then(function(B){!O&&b.onFirstUpdate&&b.onFirstUpdate(B)});function D(){C.orderedModifiers.forEach(function(B){var Y=B.name,W=B.options,ne=W===void 0?{}:W,le=B.effect;if(typeof le=="function"){var re=le({state:C,name:Y,instance:L,options:ne}),me=function(){};R.push(re||me)}})}function U(){R.forEach(function(B){return B()}),R=[]}return L}}var s2e=[ALe,$Le,RLe,mLe,GLe,jLe,YLe,bLe,BLe],o2e=i2e({defaultModifiers:s2e});const R0=(n,e)=>({var:n,varRef:e?`var(${n}, ${e})`:`var(${n})`}),Ao={arrowShadowColor:R0("--popper-arrow-shadow-color"),arrowSize:R0("--popper-arrow-size","8px"),arrowSizeHalf:R0("--popper-arrow-size-half"),arrowBg:R0("--popper-arrow-bg"),transformOrigin:R0("--popper-transform-origin"),arrowOffset:R0("--popper-arrow-offset")};function a2e(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const c2e={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},l2e=n=>c2e[n],LX={scroll:!0,resize:!0};function u2e(n){let e;return typeof n=="object"?e={enabled:!0,options:{...LX,...n}}:e={enabled:n,options:LX},e}const d2e={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const e=n.elements.reference;n.elements.popper.style.width=`${e.offsetWidth}px`}},h2e={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{MX(n)},effect:({state:n})=>()=>{MX(n)}},MX=n=>{n.elements.popper.style.setProperty(Ao.transformOrigin.var,l2e(n.placement))},p2e={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{f2e(n)}},f2e=n=>{var i;if(!n.placement)return;const e=m2e(n.placement);if((i=n.elements)!=null&&i.arrow&&e){Object.assign(n.elements.arrow.style,{[e.property]:e.value,width:Ao.arrowSize.varRef,height:Ao.arrowSize.varRef,zIndex:-1});const o={[Ao.arrowSizeHalf.var]:`calc(${Ao.arrowSize.varRef} / 2 - 1px)`,[Ao.arrowOffset.var]:`calc(${Ao.arrowSizeHalf.varRef} * -1)`};for(const l in o)n.elements.arrow.style.setProperty(l,o[l])}},m2e=n=>{if(n.startsWith("top"))return{property:"bottom",value:Ao.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:Ao.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:Ao.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:Ao.arrowOffset.varRef}},g2e={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{UX(n)},effect:({state:n})=>()=>{UX(n)}},UX=n=>{if(!n.elements.arrow)return;const e=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!e)return;const i=a2e(n.placement);i&&e.style.setProperty("--popper-arrow-default-shadow",i),Object.assign(e.style,{transform:"rotate(45deg)",background:Ao.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},_2e={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},y2e={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function E2e(n,e="ltr"){var o;const i=((o=_2e[n])==null?void 0:o[e])||n;return e==="ltr"?i:y2e[n]??i}function gj(n={}){const{enabled:e=!0,modifiers:i,placement:o="bottom",strategy:l="absolute",arrowPadding:u=8,eventListeners:f=!0,offset:y,gutter:v=8,flip:b=!0,boundary:C="clippingParents",preventOverflow:R=!0,matchWidth:O,direction:L="ltr"}=n,D=k.useRef(null),U=k.useRef(null),B=k.useRef(null),Y=E2e(o,L),W=k.useRef(()=>{}),ne=k.useCallback(()=>{var ie;!e||!D.current||!U.current||((ie=W.current)==null||ie.call(W),B.current=o2e(D.current,U.current,{placement:Y,modifiers:[g2e,p2e,h2e,{...d2e,enabled:!!O},{name:"eventListeners",...u2e(f)},{name:"arrow",options:{padding:u}},{name:"offset",options:{offset:y??[0,v]}},{name:"flip",enabled:!!b,options:{padding:8}},{name:"preventOverflow",enabled:!!R,options:{boundary:C}},...i??[]],strategy:l}),B.current.forceUpdate(),W.current=B.current.destroy)},[Y,e,i,O,f,u,y,v,b,R,C,l]);k.useEffect(()=>()=>{var ie;!D.current&&!U.current&&((ie=B.current)==null||ie.destroy(),B.current=null)},[]);const le=k.useCallback(ie=>{D.current=ie,ne()},[ne]),re=k.useCallback((ie={},pe=null)=>({...ie,ref:Gi(le,pe)}),[le]),me=k.useCallback(ie=>{U.current=ie,ne()},[ne]),q=k.useCallback((ie={},pe=null)=>({...ie,ref:Gi(me,pe),style:{...ie.style,position:l,minWidth:O?void 0:"max-content",inset:"0 auto auto 0"}}),[l,me,O]),J=k.useCallback((ie={},pe=null)=>{const{size:de,shadowColor:he,bg:Se,style:Ie,...Fe}=ie;return{...Fe,ref:pe,"data-popper-arrow":"",style:v2e(ie)}},[]),Q=k.useCallback((ie={},pe=null)=>({...ie,ref:pe,"data-popper-arrow-inner":""}),[]);return{update(){var ie;(ie=B.current)==null||ie.update()},forceUpdate(){var ie;(ie=B.current)==null||ie.forceUpdate()},transformOrigin:Ao.transformOrigin.varRef,referenceRef:le,popperRef:me,getPopperProps:q,getArrowProps:J,getArrowInnerProps:Q,getReferenceProps:re}}function v2e(n){const{size:e,shadowColor:i,bg:o,style:l}=n,u={...l,position:"absolute"};return e&&(u["--popper-arrow-size"]=e),i&&(u["--popper-arrow-shadow-color"]=i),o&&(u["--popper-arrow-bg"]=o),u}function S2e(){const n=k.useRef(new Map),e=n.current,i=k.useCallback((l,u,f,y)=>{n.current.set(f,{type:u,el:l,options:y}),l.addEventListener(u,f,y)},[]),o=k.useCallback((l,u,f,y)=>{l.removeEventListener(u,f,y),n.current.delete(f)},[]);return k.useEffect(()=>()=>{e.forEach((l,u)=>{o(l.el,l.type,u,l.options)})},[o,e]),{add:i,remove:o}}function kU(n){var l,u;const e=((u=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:u[0])??n.target,{tagName:i,isContentEditable:o}=e;return i!=="INPUT"&&i!=="TEXTAREA"&&o!==!0}function vre(n={}){const{ref:e,isDisabled:i,isFocusable:o,clickOnEnter:l=!0,clickOnSpace:u=!0,onMouseDown:f,onMouseUp:y,onClick:v,onKeyDown:b,onKeyUp:C,tabIndex:R,onMouseOver:O,onMouseLeave:L,...D}=n,[U,B]=k.useState(!0),[Y,W]=k.useState(!1),ne=S2e(),le=we=>{we&&we.tagName!=="BUTTON"&&B(!1)},re=U?R:R||0,me=i&&!o,q=k.useCallback(we=>{if(i){we.stopPropagation(),we.preventDefault();return}we.currentTarget.focus(),v==null||v(we)},[i,v]),J=k.useCallback(we=>{Y&&kU(we)&&(we.preventDefault(),we.stopPropagation(),W(!1),ne.remove(document,"keyup",J,!1))},[Y,ne]),Q=k.useCallback(we=>{if(b==null||b(we),i||we.defaultPrevented||we.metaKey||!kU(we.nativeEvent)||U)return;const Re=l&&we.key==="Enter";u&&we.key===" "&&(we.preventDefault(),W(!0)),Re&&(we.preventDefault(),we.currentTarget.click()),ne.add(document,"keyup",J,!1)},[i,U,b,l,u,ne,J]),ie=k.useCallback(we=>{if(C==null||C(we),i||we.defaultPrevented||we.metaKey||!kU(we.nativeEvent)||U)return;u&&we.key===" "&&(we.preventDefault(),W(!1),we.currentTarget.click())},[u,U,i,C]),pe=k.useCallback(we=>{we.button===0&&(W(!1),ne.remove(document,"mouseup",pe,!1))},[ne]),de=k.useCallback(we=>{if(we.button!==0)return;if(i){we.stopPropagation(),we.preventDefault();return}U||W(!0),we.currentTarget.focus({preventScroll:!0}),ne.add(document,"mouseup",pe,!1),f==null||f(we)},[i,U,f,ne,pe]),he=k.useCallback(we=>{we.button===0&&(U||W(!1),y==null||y(we))},[y,U]),Se=k.useCallback(we=>{if(i){we.preventDefault();return}O==null||O(we)},[i,O]),Ie=k.useCallback(we=>{Y&&(we.preventDefault(),W(!1)),L==null||L(we)},[Y,L]),Fe=Gi(e,le);return U?{...D,ref:Fe,type:"button","aria-disabled":me?void 0:i,disabled:me,onClick:q,onMouseDown:f,onMouseUp:y,onKeyUp:C,onKeyDown:b,onMouseOver:O,onMouseLeave:L}:{...D,ref:Fe,role:"button","data-active":dr(Y),"aria-disabled":i?"true":void 0,tabIndex:me?void 0:re,onClick:q,onMouseDown:de,onMouseUp:he,onKeyUp:ie,onKeyDown:Q,onMouseOver:Se,onMouseLeave:Ie}}const[b2e,w2e,T2e,C2e]=vne(),[R2e,jR]=Ai({strict:!1,name:"MenuContext"});function Sre(n){return(n==null?void 0:n.ownerDocument)??document}function I2e(n){return Sre(n).activeElement===n}function A2e(n={}){const{id:e,closeOnSelect:i=!0,closeOnBlur:o=!0,initialFocusRef:l,autoSelect:u=!0,isLazy:f,isOpen:y,defaultIsOpen:v,onClose:b,onOpen:C,placement:R="bottom-start",lazyBehavior:O="unmount",direction:L,computePositionOnMount:D=!1,...U}=n,B=k.useRef(null),Y=k.useRef(null),W=k.useRef(!0),ne=T2e(),le=k.useCallback(()=>{requestAnimationFrame(()=>{var je;(je=B.current)==null||je.focus({preventScroll:!1})})},[]),re=k.useCallback(()=>{const je=setTimeout(()=>{var nt,dt;if(l)(nt=l.current)==null||nt.focus();else if(!ne.count())(dt=B.current)==null||dt.focus({preventScroll:!1});else{const ft=ne.firstEnabled();ft&&Se(ft.index)}});Te.current.add(je)},[ne,l]),me=k.useCallback(()=>{const je=setTimeout(()=>{var nt;if(!ne.count())(nt=B.current)==null||nt.focus({preventScroll:!1});else{const dt=ne.lastEnabled();dt&&Se(dt.index)}});Te.current.add(je)},[ne]),q=k.useCallback(()=>{C==null||C(),u?re():le()},[u,re,le,C]),{isOpen:J,onOpen:Q,onClose:ie,onToggle:pe}=pd({isOpen:y,defaultIsOpen:v,onClose:b,onOpen:q});QZ({enabled:J&&o,ref:B,handler:je=>{var dt,ft,lt;const nt=((ft=(dt=je.composedPath)==null?void 0:dt.call(je))==null?void 0:ft[0])??je.target;(lt=Y.current)!=null&&lt.contains(nt)||ie()}});const de=gj({...U,enabled:J||D,placement:R,direction:L}),[he,Se]=k.useState(-1);YZ(B,{focusRef:Y,visible:J,shouldFocus:!0});const Ie=$Z({isOpen:J,ref:B}),[Fe,we]=Rve(e,"menu-button","menu-list"),Re=k.useCallback(()=>{Q(),le()},[Q,le]),Te=k.useRef(new Set([]));k.useEffect(()=>{const je=Te.current;return()=>{je.forEach(nt=>clearTimeout(nt)),je.clear()}},[]),Wf(()=>{var je;J||(Se(-1),(je=B.current)==null||je.scrollTo(0,0))},[J]),Wf(()=>{J&&he===-1&&le()},[he,J]),k.useEffect(()=>{var nt;if(!J)return;const je=ne.item(he);(nt=je==null?void 0:je.node)==null||nt.focus({preventScroll:!W.current})},[ne,he,J]);const Ne=k.useCallback(()=>{Q(),re()},[re,Q]),be=k.useCallback(()=>{W.current=!0,Q(),me()},[Q,me]),xe=k.useCallback(()=>{var lt,gt;const je=Sre(B.current),nt=(lt=B.current)==null?void 0:lt.contains(je.activeElement);if(!(J&&!nt))return;const ft=(gt=ne.item(he))==null?void 0:gt.node;ft==null||ft.focus({preventScroll:!W.current})},[J,he,ne]);return{openAndFocusMenu:Re,openAndFocusFirstItem:Ne,openAndFocusLastItem:be,onTransitionEnd:xe,unstable__animationState:Ie,descendants:ne,popper:de,buttonId:Fe,menuId:we,forceUpdate:de.forceUpdate,orientation:"vertical",isOpen:J,onToggle:pe,onOpen:Q,onClose:ie,menuRef:B,buttonRef:Y,focusedIndex:he,closeOnSelect:i,closeOnBlur:o,autoSelect:u,setFocusedIndex:Se,isLazy:f,lazyBehavior:O,initialFocusRef:l,scrollIntoViewRef:W}}function P2e(n={},e=null){const i=jR(),{onToggle:o,popper:l,openAndFocusFirstItem:u,openAndFocusLastItem:f,scrollIntoViewRef:y}=i,v=k.useCallback(b=>{const C=b.key,O={Enter:u,ArrowDown:u,ArrowUp:f}[C];O&&(y.current=!0,b.preventDefault(),b.stopPropagation(),O(b))},[u,f,y]);return{...n,ref:Gi(i.buttonRef,e,l.referenceRef),id:i.buttonId,"data-active":dr(i.isOpen),"aria-expanded":i.isOpen,"aria-haspopup":"menu","aria-controls":i.menuId,onClick:Vn(n.onClick,o),onKeyDown:Vn(n.onKeyDown,v)}}function qV(n){var e;return x2e(n)&&!!((e=n==null?void 0:n.getAttribute("role"))!=null&&e.startsWith("menuitem"))}function O2e(n={},e=null){const i=jR();if(!i)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:o,setFocusedIndex:l,menuRef:u,isOpen:f,onClose:y,menuId:v,isLazy:b,lazyBehavior:C,scrollIntoViewRef:R,unstable__animationState:O}=i,L=w2e(),D=eLe({preventDefault:W=>W.key!==" "&&qV(W.target)}),U=k.useCallback(W=>{if(!W.currentTarget.contains(W.target))return;const ne=W.key,re={Tab:q=>q.preventDefault(),Escape:q=>{q.stopPropagation(),y()},ArrowDown:()=>{R.current=!0;const q=L.nextEnabled(o)??L.firstEnabled();q&&l(q.index)},ArrowUp:()=>{R.current=!0;const q=L.prevEnabled(o)??L.firstEnabled();q&&l(q.index)}}[ne];if(re){W.preventDefault(),re(W);return}const me=D(q=>{const J=QDe(L.values(),q,Q=>{var ie;return((ie=Q==null?void 0:Q.node)==null?void 0:ie.textContent)??""},L.item(o));if(J){const Q=L.indexOf(J.node);l(Q)}});qV(W.target)&&me(W)},[L,o,D,y,l,R]),B=k.useRef(!1);f&&(B.current=!0);const Y=V5({wasSelected:B.current,enabled:b,mode:C,isSelected:O.present});return{...n,ref:Gi(u,e),children:Y?n.children:null,tabIndex:-1,role:"menu",id:v,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:Vn(n.onKeyDown,U)}}function k2e(n={}){const{popper:e,isOpen:i}=jR();return e.getPopperProps({...n,style:{visibility:i?"visible":"hidden",...n.style}})}function N2e(n={},e=null){const{onMouseEnter:i,onMouseMove:o,onMouseLeave:l,onClick:u,onFocus:f,isDisabled:y,isFocusable:v,closeOnSelect:b,type:C,...R}=n,O=jR(),{setFocusedIndex:L,focusedIndex:D,closeOnSelect:U,onClose:B,menuId:Y,scrollIntoViewRef:W}=O,ne=k.useRef(null),le=`${Y}-menuitem-${k.useId()}`,{index:re,register:me}=C2e({disabled:y&&!v}),q=k.useCallback(Se=>{i==null||i(Se),!y&&(W.current=!1,L(re))},[L,re,y,i,W]),J=k.useCallback(Se=>{o==null||o(Se),ne.current&&!I2e(ne.current)&&q(Se)},[q,o]),Q=k.useCallback(Se=>{l==null||l(Se),!y&&L(-1)},[L,y,l]),ie=k.useCallback(Se=>{u==null||u(Se),qV(Se.currentTarget)&&(b??U)&&B()},[B,u,U,b]),pe=k.useCallback(Se=>{f==null||f(Se),L(re)},[L,f,re]),de=re===D,he=vre({onClick:ie,onFocus:pe,onMouseEnter:q,onMouseMove:J,onMouseLeave:Q,ref:Gi(me,ne,e),isDisabled:y,isFocusable:v});return{...R,...he,type:C??he.type,id:le,role:"menuitem",tabIndex:de?0:-1}}function x2e(n){if(!D2e(n))return!1;const e=n.ownerDocument.defaultView??window;return n instanceof e.HTMLElement}function D2e(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[L2e,FR]=Ai({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),XS=n=>{const{children:e}=n,i=Ba("Menu",n),o=Hi(n),{direction:l}=qS(),{descendants:u,...f}=A2e({...o,direction:l}),y=k.useMemo(()=>f,[f]),{isOpen:v,onClose:b,forceUpdate:C}=y;return S.jsx(b2e,{value:u,children:S.jsx(R2e,{value:y,children:S.jsx(L2e,{value:i,children:bl(e,{isOpen:v,onClose:b,forceUpdate:C})})})})};XS.displayName="Menu";const M2e=zt((n,e)=>{const i=FR();return S.jsx(Mt.button,{ref:e,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...i.button}})}),JS=zt((n,e)=>{const{children:i,as:o,...l}=n,u=P2e(l,e),f=o||M2e;return S.jsx(f,{...u,className:bn("chakra-menu__menu-button",n.className),children:S.jsx(Mt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});JS.displayName="MenuButton";const bre=zt((n,e)=>{const i=FR();return S.jsx(Mt.span,{ref:e,...n,__css:i.command,className:"chakra-menu__command"})});bre.displayName="MenuCommand";const wre=n=>{const{className:e,children:i,...o}=n,l=FR(),u=k.Children.only(i),f=k.isValidElement(u)?k.cloneElement(u,{focusable:"false","aria-hidden":!0,className:bn("chakra-menu__icon",u.props.className)}):null,y=bn("chakra-menu__icon-wrapper",e);return S.jsx(Mt.span,{className:y,...o,__css:l.icon,children:f})};wre.displayName="MenuIcon";const U2e=zt((n,e)=>{const{type:i,...o}=n,l=FR(),u=o.as||i?i??void 0:"button",f=k.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return S.jsx(Mt.button,{ref:e,type:u,...o,__css:f})}),NS=zt((n,e)=>{const{icon:i,iconSpacing:o="0.75rem",command:l,commandSpacing:u="0.75rem",children:f,...y}=n,v=N2e(y,e),C=i||l?S.jsx("span",{style:{pointerEvents:"none",flex:1},children:f}):f;return S.jsxs(U2e,{...v,className:bn("chakra-menu__menuitem",v.className),children:[i&&S.jsx(wre,{fontSize:"0.8em",marginEnd:o,children:i}),C,l&&S.jsx(bre,{marginStart:u,children:l})]})});NS.displayName="MenuItem";const V2e={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},j2e=Mt(Bp.div),QS=zt(function(e,i){var O;const{rootProps:o,motionProps:l,...u}=e,{isOpen:f,onTransitionEnd:y,unstable__animationState:v}=jR(),b=O2e(u,i),C=k2e(o),R=FR();return S.jsx(Mt.div,{...C,__css:{zIndex:e.zIndex??((O=R.list)==null?void 0:O.zIndex)},children:S.jsx(j2e,{variants:V2e,initial:!1,animate:f?"enter":"exit",__css:{outline:0,...R.list},...l,...b,className:bn("chakra-menu__menu-list",b.className),onUpdate:y,onAnimationComplete:FZ(v.onComplete,b.onAnimationComplete)})})});QS.displayName="MenuList";var F2e=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},I0=new WeakMap,JP=new WeakMap,QP={},NU=0,Tre=function(n){return n&&(n.host||Tre(n.parentNode))},B2e=function(n,e){return e.map(function(i){if(n.contains(i))return i;var o=Tre(i);return o&&n.contains(o)?o:(console.error("aria-hidden",i,"in not contained inside",n,". Doing nothing"),null)}).filter(function(i){return!!i})},z2e=function(n,e,i,o){var l=B2e(e,Array.isArray(n)?n:[n]);QP[i]||(QP[i]=new WeakMap);var u=QP[i],f=[],y=new Set,v=new Set(l),b=function(R){!R||y.has(R)||(y.add(R),b(R.parentNode))};l.forEach(b);var C=function(R){!R||v.has(R)||Array.prototype.forEach.call(R.children,function(O){if(y.has(O))C(O);else try{var L=O.getAttribute(o),D=L!==null&&L!=="false",U=(I0.get(O)||0)+1,B=(u.get(O)||0)+1;I0.set(O,U),u.set(O,B),f.push(O),U===1&&D&&JP.set(O,!0),B===1&&O.setAttribute(i,"true"),D||O.setAttribute(o,"true")}catch(Y){console.error("aria-hidden: cannot operate on ",O,Y)}})};return C(e),y.clear(),NU++,function(){f.forEach(function(R){var O=I0.get(R)-1,L=u.get(R)-1;I0.set(R,O),u.set(R,L),O||(JP.has(R)||R.removeAttribute(o),JP.delete(R)),L||R.removeAttribute(i)}),NU--,NU||(I0=new WeakMap,I0=new WeakMap,JP=new WeakMap,QP={})}},W2e=function(n,e,i){i===void 0&&(i="data-aria-hidden");var o=Array.from(Array.isArray(n)?n:[n]),l=F2e(n);return l?(o.push.apply(o,Array.from(l.querySelectorAll("[aria-live], script"))),z2e(o,l,i,"aria-hidden")):function(){return null}},G2e=Object.defineProperty,H2e=(n,e,i)=>e in n?G2e(n,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[e]=i,$2e=(n,e,i)=>(H2e(n,e+"",i),i);class K2e{constructor(){$2e(this,"modals"),this.modals=new Set}add(e){return this.modals.add(e),this.modals.size}remove(e){this.modals.delete(e)}isTopModal(e){if(!e)return!1;const i=Array.from(this.modals)[this.modals.size-1];return e===i}}const YV=new K2e;function Cre(n,e){const[i,o]=k.useState(0);return k.useEffect(()=>{const l=n.current;if(l){if(e){const u=YV.add(l);o(u)}return()=>{YV.remove(l),o(0)}}},[e,n]),i}function q2e(n){const{isOpen:e,onClose:i,id:o,closeOnOverlayClick:l=!0,closeOnEsc:u=!0,useInert:f=!0,onOverlayClick:y,onEsc:v}=n,b=k.useRef(null),C=k.useRef(null),[R,O,L]=X2e(o,"chakra-modal","chakra-modal--header","chakra-modal--body");Y2e(b,e&&f);const D=Cre(b,e),U=k.useRef(null),B=k.useCallback(Q=>{U.current=Q.target},[]),Y=k.useCallback(Q=>{Q.key==="Escape"&&(Q.stopPropagation(),u&&(i==null||i()),v==null||v())},[u,i,v]),[W,ne]=k.useState(!1),[le,re]=k.useState(!1),me=k.useCallback((Q={},ie=null)=>({role:"dialog",...Q,ref:Gi(ie,b),id:R,tabIndex:-1,"aria-modal":!0,"aria-labelledby":W?O:void 0,"aria-describedby":le?L:void 0,onClick:Vn(Q.onClick,pe=>pe.stopPropagation())}),[L,le,R,O,W]),q=k.useCallback(Q=>{Q.stopPropagation(),U.current===Q.target&&YV.isTopModal(b.current)&&(l&&(i==null||i()),y==null||y())},[i,l,y]),J=k.useCallback((Q={},ie=null)=>({...Q,ref:Gi(ie,C),onClick:Vn(Q.onClick,q),onKeyDown:Vn(Q.onKeyDown,Y),onMouseDown:Vn(Q.onMouseDown,B)}),[Y,B,q]);return{isOpen:e,onClose:i,headerId:O,bodyId:L,setBodyMounted:re,setHeaderMounted:ne,dialogRef:b,overlayRef:C,getDialogProps:me,getDialogContainerProps:J,index:D}}function Y2e(n,e){const i=n.current;k.useEffect(()=>{if(!(!n.current||!e))return W2e(n.current)},[e,n,i])}function X2e(n,...e){const i=k.useId(),o=n||i;return k.useMemo(()=>e.map(l=>`${l}-${o}`),[o,e])}const[J2e,ZS]=Ai({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[Q2e,nE]=Ai({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),Is=n=>{const e={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames??!0},{portalProps:i,children:o,autoFocus:l,trapFocus:u,initialFocusRef:f,finalFocusRef:y,returnFocusOnClose:v,blockScrollOnMount:b,allowPinchZoom:C,preserveScrollBarGap:R,motionPreset:O,lockFocusAcrossFrames:L,animatePresenceProps:D,onCloseComplete:U}=e,B=Ba("Modal",e),W={...q2e(e),autoFocus:l,trapFocus:u,initialFocusRef:f,finalFocusRef:y,returnFocusOnClose:v,blockScrollOnMount:b,allowPinchZoom:C,preserveScrollBarGap:R,motionPreset:O,lockFocusAcrossFrames:L};return S.jsx(Q2e,{value:W,children:S.jsx(J2e,{value:B,children:S.jsx(lE,{...D,onExitComplete:U,children:W.isOpen&&S.jsx(Al,{...i,children:o})})})})};Is.displayName="Modal";var OO="right-scroll-bar-position",kO="width-before-scroll-bar",Z2e="with-scroll-bars-hidden",eMe="--removed-body-scroll-bar-size",Rre=Nne(),xU=function(){},oN=k.forwardRef(function(n,e){var i=k.useRef(null),o=k.useState({onScrollCapture:xU,onWheelCapture:xU,onTouchMoveCapture:xU}),l=o[0],u=o[1],f=n.forwardProps,y=n.children,v=n.className,b=n.removeScrollBar,C=n.enabled,R=n.shards,O=n.sideCar,L=n.noRelative,D=n.noIsolation,U=n.inert,B=n.allowPinchZoom,Y=n.as,W=Y===void 0?"div":Y,ne=n.gapMode,le=MR(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),re=O,me=Pne([i,e]),q=wp(wp({},le),l);return k.createElement(k.Fragment,null,C&&k.createElement(re,{sideCar:Rre,removeScrollBar:b,shards:R,noRelative:L,noIsolation:D,inert:U,setCallbacks:u,allowPinchZoom:!!B,lockRef:i,gapMode:ne}),f?k.cloneElement(k.Children.only(y),wp(wp({},q),{ref:me})):k.createElement(W,wp({},q,{className:v,ref:me}),y))});oN.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};oN.classNames={fullWidth:kO,zeroRight:OO};var tMe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function nMe(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=tMe();return e&&n.setAttribute("nonce",e),n}function rMe(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function iMe(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var sMe=function(){var n=0,e=null;return{add:function(i){n==0&&(e=nMe())&&(rMe(e,i),iMe(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},oMe=function(){var n=sMe();return function(e,i){k.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&i])}},Ire=function(){var n=oMe(),e=function(i){var o=i.styles,l=i.dynamic;return n(o,l),null};return e},aMe={left:0,top:0,right:0,gap:0},DU=function(n){return parseInt(n||"",10)||0},cMe=function(n){var e=window.getComputedStyle(document.body),i=e[n==="padding"?"paddingLeft":"marginLeft"],o=e[n==="padding"?"paddingTop":"marginTop"],l=e[n==="padding"?"paddingRight":"marginRight"];return[DU(i),DU(o),DU(l)]},lMe=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return aMe;var e=cMe(n),i=document.documentElement.clientWidth,o=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,o-i+e[2]-e[0])}},uMe=Ire(),dS="data-scroll-locked",dMe=function(n,e,i,o){var l=n.left,u=n.top,f=n.right,y=n.gap;return i===void 0&&(i="margin"),`
  .`.concat(Z2e,` {
   overflow: hidden `).concat(o,`;
   padding-right: `).concat(y,"px ").concat(o,`;
  }
  body[`).concat(dS,`] {
    overflow: hidden `).concat(o,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(o,";"),i==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(u,`px;
    padding-right: `).concat(f,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(y,"px ").concat(o,`;
    `),i==="padding"&&"padding-right: ".concat(y,"px ").concat(o,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(OO,` {
    right: `).concat(y,"px ").concat(o,`;
  }
  
  .`).concat(kO,` {
    margin-right: `).concat(y,"px ").concat(o,`;
  }
  
  .`).concat(OO," .").concat(OO,` {
    right: 0 `).concat(o,`;
  }
  
  .`).concat(kO," .").concat(kO,` {
    margin-right: 0 `).concat(o,`;
  }
  
  body[`).concat(dS,`] {
    `).concat(eMe,": ").concat(y,`px;
  }
`)},VX=function(){var n=parseInt(document.body.getAttribute(dS)||"0",10);return isFinite(n)?n:0},hMe=function(){k.useEffect(function(){return document.body.setAttribute(dS,(VX()+1).toString()),function(){var n=VX()-1;n<=0?document.body.removeAttribute(dS):document.body.setAttribute(dS,n.toString())}},[])},pMe=function(n){var e=n.noRelative,i=n.noImportant,o=n.gapMode,l=o===void 0?"margin":o;hMe();var u=k.useMemo(function(){return lMe(l)},[l]);return k.createElement(uMe,{styles:dMe(u,!e,l,i?"":"!important")})},XV=!1;if(typeof window<"u")try{var ZP=Object.defineProperty({},"passive",{get:function(){return XV=!0,!0}});window.addEventListener("test",ZP,ZP),window.removeEventListener("test",ZP,ZP)}catch{XV=!1}var A0=XV?{passive:!1}:!1,fMe=function(n){return n.tagName==="TEXTAREA"},Are=function(n,e){if(!(n instanceof Element))return!1;var i=window.getComputedStyle(n);return i[e]!=="hidden"&&!(i.overflowY===i.overflowX&&!fMe(n)&&i[e]==="visible")},mMe=function(n){return Are(n,"overflowY")},gMe=function(n){return Are(n,"overflowX")},jX=function(n,e){var i=e.ownerDocument,o=e;do{typeof ShadowRoot<"u"&&o instanceof ShadowRoot&&(o=o.host);var l=Pre(n,o);if(l){var u=Ore(n,o),f=u[1],y=u[2];if(f>y)return!0}o=o.parentNode}while(o&&o!==i.body);return!1},_Me=function(n){var e=n.scrollTop,i=n.scrollHeight,o=n.clientHeight;return[e,i,o]},yMe=function(n){var e=n.scrollLeft,i=n.scrollWidth,o=n.clientWidth;return[e,i,o]},Pre=function(n,e){return n==="v"?mMe(e):gMe(e)},Ore=function(n,e){return n==="v"?_Me(e):yMe(e)},EMe=function(n,e){return n==="h"&&e==="rtl"?-1:1},vMe=function(n,e,i,o,l){var u=EMe(n,window.getComputedStyle(e).direction),f=u*o,y=i.target,v=e.contains(y),b=!1,C=f>0,R=0,O=0;do{if(!y)break;var L=Ore(n,y),D=L[0],U=L[1],B=L[2],Y=U-B-u*D;(D||Y)&&Pre(n,y)&&(R+=Y,O+=D);var W=y.parentNode;y=W&&W.nodeType===Node.DOCUMENT_FRAGMENT_NODE?W.host:W}while(!v&&y!==document.body||v&&(e.contains(y)||e===y));return(C&&Math.abs(R)<1||!C&&Math.abs(O)<1)&&(b=!0),b},eO=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},FX=function(n){return[n.deltaX,n.deltaY]},BX=function(n){return n&&"current"in n?n.current:n},SMe=function(n,e){return n[0]===e[0]&&n[1]===e[1]},bMe=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},wMe=0,P0=[];function TMe(n){var e=k.useRef([]),i=k.useRef([0,0]),o=k.useRef(),l=k.useState(wMe++)[0],u=k.useState(Ire)[0],f=k.useRef(n);k.useEffect(function(){f.current=n},[n]),k.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var U=Rxe([n.lockRef.current],(n.shards||[]).map(BX),!0).filter(Boolean);return U.forEach(function(B){return B.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),U.forEach(function(B){return B.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var y=k.useCallback(function(U,B){if("touches"in U&&U.touches.length===2||U.type==="wheel"&&U.ctrlKey)return!f.current.allowPinchZoom;var Y=eO(U),W=i.current,ne="deltaX"in U?U.deltaX:W[0]-Y[0],le="deltaY"in U?U.deltaY:W[1]-Y[1],re,me=U.target,q=Math.abs(ne)>Math.abs(le)?"h":"v";if("touches"in U&&q==="h"&&me.type==="range")return!1;var J=jX(q,me);if(!J)return!0;if(J?re=q:(re=q==="v"?"h":"v",J=jX(q,me)),!J)return!1;if(!o.current&&"changedTouches"in U&&(ne||le)&&(o.current=re),!re)return!0;var Q=o.current||re;return vMe(Q,B,U,Q==="h"?ne:le)},[]),v=k.useCallback(function(U){var B=U;if(!(!P0.length||P0[P0.length-1]!==u)){var Y="deltaY"in B?FX(B):eO(B),W=e.current.filter(function(re){return re.name===B.type&&(re.target===B.target||B.target===re.shadowParent)&&SMe(re.delta,Y)})[0];if(W&&W.should){B.cancelable&&B.preventDefault();return}if(!W){var ne=(f.current.shards||[]).map(BX).filter(Boolean).filter(function(re){return re.contains(B.target)}),le=ne.length>0?y(B,ne[0]):!f.current.noIsolation;le&&B.cancelable&&B.preventDefault()}}},[]),b=k.useCallback(function(U,B,Y,W){var ne={name:U,delta:B,target:Y,should:W,shadowParent:CMe(Y)};e.current.push(ne),setTimeout(function(){e.current=e.current.filter(function(le){return le!==ne})},1)},[]),C=k.useCallback(function(U){i.current=eO(U),o.current=void 0},[]),R=k.useCallback(function(U){b(U.type,FX(U),U.target,y(U,n.lockRef.current))},[]),O=k.useCallback(function(U){b(U.type,eO(U),U.target,y(U,n.lockRef.current))},[]);k.useEffect(function(){return P0.push(u),n.setCallbacks({onScrollCapture:R,onWheelCapture:R,onTouchMoveCapture:O}),document.addEventListener("wheel",v,A0),document.addEventListener("touchmove",v,A0),document.addEventListener("touchstart",C,A0),function(){P0=P0.filter(function(U){return U!==u}),document.removeEventListener("wheel",v,A0),document.removeEventListener("touchmove",v,A0),document.removeEventListener("touchstart",C,A0)}},[]);var L=n.removeScrollBar,D=n.inert;return k.createElement(k.Fragment,null,D?k.createElement(u,{styles:bMe(l)}):null,L?k.createElement(pMe,{noRelative:n.noRelative,gapMode:n.gapMode}):null)}function CMe(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const RMe=Ixe(Rre,TMe);var kre=k.forwardRef(function(n,e){return k.createElement(oN,wp({},n,{ref:e,sideCar:RMe}))});kre.classNames=oN.classNames;function IMe(n){const{autoFocus:e,trapFocus:i,dialogRef:o,initialFocusRef:l,blockScrollOnMount:u,allowPinchZoom:f,finalFocusRef:y,returnFocusOnClose:v,preserveScrollBarGap:b,lockFocusAcrossFrames:C,isOpen:R}=nE(),[O,L]=c3();k.useEffect(()=>{!O&&L&&setTimeout(L)},[O,L]);const D=Cre(o,R);return S.jsx(sre,{autoFocus:e,isDisabled:!i,initialFocusRef:l,finalFocusRef:y,restoreFocus:v,contentRef:o,lockFocusAcrossFrames:C,children:S.jsx(kre,{removeScrollBar:!b,allowPinchZoom:f,enabled:D===1&&u,forwardProps:!0,children:n.children})})}const AMe={initial:({offsetX:n,offsetY:e,transition:i,transitionEnd:o,delay:l})=>({opacity:0,x:n,y:e,transition:(i==null?void 0:i.exit)??jf.exit(zy.exit,l),transitionEnd:o==null?void 0:o.exit}),enter:({transition:n,transitionEnd:e,delay:i})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??jf.enter(zy.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({offsetY:n,offsetX:e,transition:i,transitionEnd:o,reverse:l,delay:u})=>{const f={x:e,y:n};return{opacity:0,transition:(i==null?void 0:i.exit)??jf.exit(zy.exit,u),...l?{...f,transitionEnd:o==null?void 0:o.exit}:{transitionEnd:{...f,...o==null?void 0:o.exit}}}}},fC={initial:"initial",animate:"enter",exit:"exit",variants:AMe},PMe=k.forwardRef(function(e,i){const{unmountOnExit:o,in:l,reverse:u=!0,className:f,offsetX:y=0,offsetY:v=8,transition:b,transitionEnd:C,delay:R,animatePresenceProps:O,...L}=e,D=o?l&&o:!0,U=l||o?"enter":"exit",B={offsetX:y,offsetY:v,reverse:u,transition:b,transitionEnd:C,delay:R};return S.jsx(lE,{...O,custom:B,children:D&&S.jsx(Bp.div,{ref:i,className:bn("chakra-offset-slide",f),custom:B,...fC,animate:U,...L})})});PMe.displayName="SlideFade";const OMe={exit:({reverse:n,initialScale:e,transition:i,transitionEnd:o,delay:l})=>({opacity:0,...n?{scale:e,transitionEnd:o==null?void 0:o.exit}:{transitionEnd:{scale:e,...o==null?void 0:o.exit}},transition:(i==null?void 0:i.exit)??jf.exit(zy.exit,l)}),enter:({transitionEnd:n,transition:e,delay:i})=>({opacity:1,scale:1,transition:(e==null?void 0:e.enter)??jf.enter(zy.enter,i),transitionEnd:n==null?void 0:n.enter})},Nre={initial:"exit",animate:"enter",exit:"exit",variants:OMe},kMe=k.forwardRef(function(e,i){const{unmountOnExit:o,in:l,reverse:u=!0,initialScale:f=.95,className:y,transition:v,transitionEnd:b,delay:C,animatePresenceProps:R,...O}=e,L=o?l&&o:!0,D=l||o?"enter":"exit",U={initialScale:f,reverse:u,transition:v,transitionEnd:b,delay:C};return S.jsx(lE,{...R,custom:U,children:L&&S.jsx(Bp.div,{ref:i,className:bn("chakra-offset-slide",y),...Nre,animate:D,custom:U,...O})})});kMe.displayName="ScaleFade";const NMe={slideInBottom:{...fC,custom:{offsetY:16,reverse:!0}},slideInRight:{...fC,custom:{offsetX:16,reverse:!0}},slideInTop:{...fC,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...fC,custom:{offsetX:-16,reverse:!0}},scale:{...Nre,custom:{initialScale:.95,reverse:!0}},none:{}},xMe=Mt(Bp.section),DMe=n=>NMe[n||"none"],xre=k.forwardRef((n,e)=>{const{preset:i,motionProps:o=DMe(i),...l}=n;return S.jsx(xMe,{ref:e,...o,...l})});xre.displayName="ModalTransition";const As=zt((n,e)=>{const{className:i,children:o,containerProps:l,motionProps:u,...f}=n,{getDialogProps:y,getDialogContainerProps:v}=nE(),b=y(f,e),C=v(l),R=bn("chakra-modal__content",i),O=ZS(),L={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...O.dialog},D={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...O.dialogContainer},{motionPreset:U}=nE();return S.jsx(IMe,{children:S.jsx(Mt.div,{...C,className:"chakra-modal__content-container",tabIndex:-1,__css:D,children:S.jsx(xre,{preset:U,motionProps:u,className:R,...b,__css:L,children:o})})})});As.displayName="ModalContent";const Ps=zt((n,e)=>{const{className:i,...o}=n,{bodyId:l,setBodyMounted:u}=nE();k.useEffect(()=>(u(!0),()=>u(!1)),[u]);const f=bn("chakra-modal__body",i),y=ZS();return S.jsx(Mt.div,{ref:e,className:f,id:l,...o,__css:y.body})});Ps.displayName="ModalBody";const $s=zt((n,e)=>{const{onClick:i,className:o,...l}=n,{onClose:u}=nE(),f=bn("chakra-modal__close-btn",o),y=ZS();return S.jsx(z3,{ref:e,__css:y.closeButton,className:f,onClick:Vn(i,v=>{v.stopPropagation(),u()}),...l})});$s.displayName="ModalCloseButton";const gh=zt((n,e)=>{const{className:i,...o}=n,l=bn("chakra-modal__footer",i),u=ZS(),f={display:"flex",alignItems:"center",justifyContent:"flex-end",...u.footer};return S.jsx(Mt.footer,{ref:e,...o,__css:f,className:l})});gh.displayName="ModalFooter";const Jo=zt((n,e)=>{const{className:i,...o}=n,{headerId:l,setHeaderMounted:u}=nE();k.useEffect(()=>(u(!0),()=>u(!1)),[u]);const f=bn("chakra-modal__header",i),y=ZS(),v={flex:0,...y.header};return S.jsx(Mt.header,{ref:e,className:f,id:l,...o,__css:v})});Jo.displayName="ModalHeader";const LMe={enter:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??jf.enter(zy.enter,i),transitionEnd:e==null?void 0:e.enter}),exit:({transition:n,transitionEnd:e,delay:i}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??jf.exit(zy.exit,i),transitionEnd:e==null?void 0:e.exit})},Dre={initial:"exit",animate:"enter",exit:"exit",variants:LMe},MMe=k.forwardRef(function(e,i){const{unmountOnExit:o,in:l,className:u,transition:f,transitionEnd:y,delay:v,animatePresenceProps:b,...C}=e,R=l||o?"enter":"exit",O=o?l&&o:!0,L={transition:f,transitionEnd:y,delay:v};return S.jsx(lE,{...b,custom:L,children:O&&S.jsx(Bp.div,{ref:i,className:bn("chakra-fade",u),custom:L,...Dre,animate:R,...C})})});MMe.displayName="Fade";const UMe=Mt(Bp.div),Os=zt((n,e)=>{const{className:i,transition:o,motionProps:l,...u}=n,f=bn("chakra-modal__overlay",i),v={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...ZS().overlay},{motionPreset:b}=nE(),R=l||(b==="none"?{}:Dre);return S.jsx(UMe,{...R,__css:v,ref:e,className:f,...u})});Os.displayName="ModalOverlay";function VMe(n){const{leastDestructiveRef:e,...i}=n;return S.jsx(Is,{...i,initialFocusRef:e})}const jMe=zt((n,e)=>S.jsx(As,{ref:e,role:"alertdialog",...n})),FMe=n=>S.jsx(Zt,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M21,5H3C2.621,5,2.275,5.214,2.105,5.553C1.937,5.892,1.973,6.297,2.2,6.6l9,12 c0.188,0.252,0.485,0.4,0.8,0.4s0.611-0.148,0.8-0.4l9-12c0.228-0.303,0.264-0.708,0.095-1.047C21.725,5.214,21.379,5,21,5z"})}),BMe=n=>S.jsx(Zt,{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M12.8,5.4c-0.377-0.504-1.223-0.504-1.6,0l-9,12c-0.228,0.303-0.264,0.708-0.095,1.047 C2.275,18.786,2.621,19,3,19h18c0.379,0,0.725-0.214,0.895-0.553c0.169-0.339,0.133-0.744-0.095-1.047L12.8,5.4z"})});function zX(n,e,i,o){k.useEffect(()=>{if(!n.current||!o)return;const l=n.current.ownerDocument.defaultView??window,u=Array.isArray(e)?e:[e],f=new l.MutationObserver(y=>{for(const v of y)v.type==="attributes"&&v.attributeName&&u.includes(v.attributeName)&&i(v)});return f.observe(n.current,{attributes:!0,attributeFilter:u}),()=>f.disconnect()})}const zMe=50,WX=300;function WMe(n,e){const[i,o]=k.useState(!1),[l,u]=k.useState(null),[f,y]=k.useState(!0),v=k.useRef(null),b=()=>clearTimeout(v.current);Ive(()=>{l==="increment"&&n(),l==="decrement"&&e()},i?zMe:null);const C=k.useCallback(()=>{f&&n(),v.current=setTimeout(()=>{y(!1),o(!0),u("increment")},WX)},[n,f]),R=k.useCallback(()=>{f&&e(),v.current=setTimeout(()=>{y(!1),o(!0),u("decrement")},WX)},[e,f]),O=k.useCallback(()=>{y(!0),o(!1),b()},[]);return k.useEffect(()=>()=>b(),[]),{up:C,down:R,stop:O,isSpinning:i}}const GMe=/^[Ee0-9+\-.]$/;function HMe(n){return GMe.test(n)}function $Me(n,e){if(n.key==null)return!0;const i=n.ctrlKey||n.altKey||n.metaKey;return!(n.key.length===1)||i?!0:e(n.key)}function KMe(n={}){const{focusInputOnChange:e=!0,clampValueOnBlur:i=!0,keepWithinRange:o=!0,min:l=Number.MIN_SAFE_INTEGER,max:u=Number.MAX_SAFE_INTEGER,step:f=1,isReadOnly:y,isDisabled:v,isRequired:b,isInvalid:C,pattern:R="[0-9]*(.[0-9]+)?",inputMode:O="decimal",allowMouseWheel:L,id:D,onChange:U,precision:B,name:Y,"aria-describedby":W,"aria-label":ne,"aria-labelledby":le,onFocus:re,onBlur:me,onInvalid:q,getAriaValueText:J,isValidCharacter:Q,format:ie,parse:pe,...de}=n,he=fo(re),Se=fo(me),Ie=fo(q),Fe=fo(Q??HMe),we=fo(J),Re=pve(n),{update:Te,increment:Ne,decrement:be}=Re,[xe,je]=k.useState(!1),nt=!(y||v),dt=k.useRef(null),ft=k.useRef(null),lt=k.useRef(null),gt=k.useRef(null),at=k.useCallback(_t=>_t.split("").filter(Fe).join(""),[Fe]),Ct=k.useCallback(_t=>(pe==null?void 0:pe(_t))??_t,[pe]),En=k.useCallback(_t=>((ie==null?void 0:ie(_t))??_t).toString(),[ie]);Wf(()=>{(Re.valueAsNumber>u||Re.valueAsNumber<l)&&(Ie==null||Ie("rangeOverflow",En(Re.value),Re.valueAsNumber))},[Re.valueAsNumber,Re.value,En,Ie]),Ip(()=>{if(!dt.current)return;if(dt.current.value!=Re.value){const wn=Ct(dt.current.value);Re.setValue(at(wn))}},[Ct,at]);const Gt=k.useCallback((_t=f)=>{nt&&Ne(_t)},[Ne,nt,f]),Xt=k.useCallback((_t=f)=>{nt&&be(_t)},[be,nt,f]),st=WMe(Gt,Xt);zX(lt,"disabled",st.stop,st.isSpinning),zX(gt,"disabled",st.stop,st.isSpinning);const hn=k.useCallback(_t=>{if(_t.nativeEvent.isComposing)return;const Nt=Ct(_t.currentTarget.value);Te(at(Nt)),ft.current={start:_t.currentTarget.selectionStart,end:_t.currentTarget.selectionEnd}},[Te,at,Ct]),an=k.useCallback(_t=>{var wn;he==null||he(_t),ft.current&&(_t.currentTarget.selectionStart=ft.current.start??((wn=_t.currentTarget.value)==null?void 0:wn.length),_t.currentTarget.selectionEnd=ft.current.end??_t.currentTarget.selectionStart)},[he]),jt=k.useCallback(_t=>{if(_t.nativeEvent.isComposing)return;$Me(_t,Fe)||_t.preventDefault();const wn=on(_t)*f,Nt=_t.key,Lr={ArrowUp:()=>Gt(wn),ArrowDown:()=>Xt(wn),Home:()=>Te(l),End:()=>Te(u)}[Nt];Lr&&(_t.preventDefault(),Lr(_t))},[Fe,f,Gt,Xt,Te,l,u]),on=_t=>{let wn=1;return(_t.metaKey||_t.ctrlKey)&&(wn=.1),_t.shiftKey&&(wn=10),wn},St=k.useMemo(()=>{const _t=we==null?void 0:we(Re.value);if(_t!=null)return _t;const wn=Re.value.toString();return wn||void 0},[Re.value,we]),ve=k.useCallback(()=>{let _t=Re.value;if(Re.value==="")return;/^[eE]/.test(Re.value.toString())?Re.setValue(""):(Re.valueAsNumber<l&&(_t=l),Re.valueAsNumber>u&&(_t=u),Re.cast(_t))},[Re,u,l]),De=k.useCallback(()=>{je(!1),i&&ve()},[i,je,ve]),Ke=k.useCallback(()=>{e&&requestAnimationFrame(()=>{var _t;(_t=dt.current)==null||_t.focus()})},[e]),Ot=k.useCallback(_t=>{_t.preventDefault(),st.up(),Ke()},[Ke,st]),Et=k.useCallback(_t=>{_t.preventDefault(),st.down(),Ke()},[Ke,st]);Uy(()=>dt.current,"wheel",_t=>{var wi;const Nt=(((wi=dt.current)==null?void 0:wi.ownerDocument)??document).activeElement===dt.current;if(!L||!Nt)return;_t.preventDefault();const Ht=on(_t)*f,Lr=Math.sign(_t.deltaY);Lr===-1?Gt(Ht):Lr===1&&Xt(Ht)},{passive:!1});const Pt=k.useCallback((_t={},wn=null)=>{const Nt=v||o&&Re.isAtMax;return{..._t,ref:Gi(wn,lt),role:"button",tabIndex:-1,onPointerDown:Vn(_t.onPointerDown,Ht=>{Ht.button!==0||Nt||Ot(Ht)}),onPointerLeave:Vn(_t.onPointerLeave,st.stop),onPointerUp:Vn(_t.onPointerUp,st.stop),disabled:Nt,"aria-disabled":Lf(Nt)}},[Re.isAtMax,o,Ot,st.stop,v]),Ut=k.useCallback((_t={},wn=null)=>{const Nt=v||o&&Re.isAtMin;return{..._t,ref:Gi(wn,gt),role:"button",tabIndex:-1,onPointerDown:Vn(_t.onPointerDown,Ht=>{Ht.button!==0||Nt||Et(Ht)}),onPointerLeave:Vn(_t.onPointerLeave,st.stop),onPointerUp:Vn(_t.onPointerUp,st.stop),disabled:Nt,"aria-disabled":Lf(Nt)}},[Re.isAtMin,o,Et,st.stop,v]),cn=k.useCallback((_t={},wn=null)=>({name:Y,inputMode:O,type:"text",pattern:R,"aria-labelledby":le,"aria-label":ne,"aria-describedby":W,id:D,disabled:v,role:"spinbutton",..._t,readOnly:_t.readOnly??y,"aria-readonly":_t.readOnly??y,"aria-required":_t.required??b,required:_t.required??b,ref:Gi(dt,wn),value:En(Re.value),"aria-valuemin":l,"aria-valuemax":u,"aria-valuenow":Number.isNaN(Re.valueAsNumber)?void 0:Re.valueAsNumber,"aria-invalid":Lf(C??Re.isOutOfRange),"aria-valuetext":St,autoComplete:"off",autoCorrect:"off",onChange:Vn(_t.onChange,hn),onKeyDown:Vn(_t.onKeyDown,jt),onFocus:Vn(_t.onFocus,an,()=>je(!0)),onBlur:Vn(_t.onBlur,Se,De)}),[Y,O,R,le,ne,En,W,D,v,b,y,C,Re.value,Re.valueAsNumber,Re.isOutOfRange,l,u,St,hn,jt,an,Se,De]);return{value:En(Re.value),valueAsNumber:Re.valueAsNumber,isFocused:xe,isDisabled:v,isReadOnly:y,getIncrementButtonProps:Pt,getDecrementButtonProps:Ut,getInputProps:cn,htmlProps:de}}const[qMe,aN]=Ai({name:"NumberInputStylesContext",errorMessage:`useNumberInputStyles returned is 'undefined'. Seems you forgot to wrap the components in "<NumberInput />" `}),[YMe,_j]=Ai({name:"NumberInputContext",errorMessage:"useNumberInputContext: `context` is undefined. Seems you forgot to wrap number-input's components within <NumberInput />"}),Go=zt(function(e,i){const o=Ba("NumberInput",e),l=Hi(e),u=$3(l),{htmlProps:f,...y}=KMe(u),v=k.useMemo(()=>y,[y]);return S.jsx(YMe,{value:v,children:S.jsx(qMe,{value:o,children:S.jsx(Mt.div,{...f,ref:i,className:bn("chakra-numberinput",e.className),__css:{position:"relative",zIndex:0,...o.root}})})})});Go.displayName="NumberInput";const Ho=zt(function(e,i){const o=aN();return S.jsx(Mt.div,{"aria-hidden":!0,ref:i,...e,__css:{display:"flex",flexDirection:"column",position:"absolute",top:"0",insetEnd:"0px",margin:"1px",height:"calc(100% - 2px)",zIndex:1,...o.stepperGroup}})});Ho.displayName="NumberInputStepper";const $o=zt(function(e,i){const{getInputProps:o}=_j(),l=o(e,i),u=aN();return S.jsx(Mt.input,{...l,className:bn("chakra-numberinput__field",e.className),__css:{width:"100%",...u.field}})});$o.displayName="NumberInputField";const Lre=Mt("div",{baseStyle:{display:"flex",justifyContent:"center",alignItems:"center",flex:1,transitionProperty:"common",transitionDuration:"normal",userSelect:"none",cursor:"pointer",lineHeight:"normal"}}),Ko=zt(function(e,i){const o=aN(),{getDecrementButtonProps:l}=_j(),u=l(e,i);return S.jsx(Lre,{...u,__css:o.stepper,children:e.children??S.jsx(FMe,{})})});Ko.displayName="NumberDecrementStepper";const qo=zt(function(e,i){const{getIncrementButtonProps:o}=_j(),l=o(e,i),u=aN();return S.jsx(Lre,{...l,__css:u.stepper,children:e.children??S.jsx(BMe,{})})});qo.displayName="NumberIncrementStepper";const[XMe,cN]=Ai({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[JMe,Mre]=Ai({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),O0={click:"click",hover:"hover"};function QMe(n={}){const{closeOnBlur:e=!0,closeOnEsc:i=!0,initialFocusRef:o,id:l,returnFocusOnClose:u=!0,autoFocus:f=!0,arrowSize:y,arrowShadowColor:v,trigger:b=O0.click,openDelay:C=200,closeDelay:R=200,isLazy:O,lazyBehavior:L="unmount",computePositionOnMount:D,...U}=n,{isOpen:B,onClose:Y,onOpen:W,onToggle:ne}=pd(n),[le,re]=k.useState(u);k.useEffect(()=>re(u),[u]);const me=k.useRef(null),q=k.useRef(null),J=k.useRef(null),Q=k.useRef(!1),ie=k.useRef(!1);B&&(ie.current=!0);const[pe,de]=k.useState(!1),[he,Se]=k.useState(!1),Ie=k.useId(),Fe=l??Ie,[we,Re,Te,Ne]=["popover-trigger","popover-content","popover-header","popover-body"].map(jt=>`${jt}-${Fe}`),{referenceRef:be,getArrowProps:xe,getPopperProps:je,getArrowInnerProps:nt,forceUpdate:dt}=gj({...U,enabled:B||!!D}),ft=$Z({isOpen:B,ref:J});Tve({enabled:B,ref:q}),YZ(J,{focusRef:q,visible:B,shouldFocus:le&&b===O0.click}),gve(J,{focusRef:o,visible:B,shouldFocus:f&&b===O0.click}),QZ({enabled:B&&e,ref:J,handler(jt){var St;const on=((St=jt.composedPath)==null?void 0:St.call(jt)[0])??[jt.target];tO(q.current,on)||(on&&re(!KO(on)),Y())}});const lt=V5({wasSelected:ie.current,enabled:O,mode:L,isSelected:ft.present}),gt=k.useCallback((jt={},on=null)=>{const St={...jt,style:{...jt.style,transformOrigin:Ao.transformOrigin.varRef,[Ao.arrowSize.var]:y?`${y}px`:void 0,[Ao.arrowShadowColor.var]:v},ref:Gi(J,on),children:lt?jt.children:null,id:Re,tabIndex:-1,role:"dialog",onKeyDown:Vn(jt.onKeyDown,ve=>{ve.nativeEvent.isComposing||i&&ve.key==="Escape"&&(ve.preventDefault(),ve.stopPropagation(),Y())}),onBlur:Vn(jt.onBlur,ve=>{const De=GX(ve),Ke=tO(J.current,De),Ot=tO(q.current,De),Et=!Ke&&!Ot;De&&re(!KO(De)),B&&e&&Et&&Y()}),"aria-labelledby":pe?Te:void 0,"aria-describedby":he?Ne:void 0};return b===O0.hover&&(St.role="tooltip",St.onMouseEnter=Vn(jt.onMouseEnter,()=>{Q.current=!0}),St.onMouseLeave=Vn(jt.onMouseLeave,ve=>{ve.nativeEvent.relatedTarget!==null&&(Q.current=!1,setTimeout(()=>Y(),R))})),St},[lt,Re,pe,Te,he,Ne,b,i,Y,B,e,R,v,y]),at=k.useCallback((jt={},on=null)=>je({...jt,style:{visibility:B?"visible":"hidden",...jt.style}},on),[B,je]),Ct=k.useCallback((jt,on=null)=>({...jt,ref:Gi(on,me,be)}),[me,be]),En=k.useRef(void 0),Gt=k.useRef(void 0),Xt=k.useCallback(jt=>{me.current==null&&be(jt)},[be]),st=k.useCallback((jt={},on=null)=>{const St={...jt,ref:Gi(q,on,Xt),id:we,"aria-haspopup":"dialog","aria-expanded":B,"aria-controls":Re};return b===O0.click&&(St.onClick=Vn(jt.onClick,ne)),b===O0.hover&&(St.onFocus=Vn(jt.onFocus,()=>{En.current===void 0&&W()}),St.onBlur=Vn(jt.onBlur,ve=>{const De=GX(ve),Ke=!tO(J.current,De);B&&e&&Ke&&Y()}),St.onKeyDown=Vn(jt.onKeyDown,ve=>{ve.key==="Escape"&&Y()}),St.onMouseEnter=Vn(jt.onMouseEnter,()=>{Q.current=!0,En.current=window.setTimeout(()=>W(),C)}),St.onMouseLeave=Vn(jt.onMouseLeave,()=>{Q.current=!1,En.current&&(clearTimeout(En.current),En.current=void 0),Gt.current=window.setTimeout(()=>{Q.current===!1&&Y()},R)})),St},[we,B,Re,b,Xt,ne,W,e,Y,C,R]);k.useEffect(()=>()=>{En.current&&clearTimeout(En.current),Gt.current&&clearTimeout(Gt.current)},[]);const hn=k.useCallback((jt={},on=null)=>({...jt,id:Te,ref:Gi(on,St=>{de(!!St)})}),[Te]),an=k.useCallback((jt={},on=null)=>({...jt,id:Ne,ref:Gi(on,St=>{Se(!!St)})}),[Ne]);return{forceUpdate:dt,isOpen:B,onAnimationComplete:ft.onComplete,onClose:Y,getAnchorProps:Ct,getArrowProps:xe,getArrowInnerProps:nt,getPopoverPositionerProps:at,getPopoverProps:gt,getTriggerProps:st,getHeaderProps:hn,getBodyProps:an}}function tO(n,e){return n===e||(n==null?void 0:n.contains(e))}function GX(n){const e=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??e}function Ure(n){const e=Ba("Popover",n),{children:i,...o}=Hi(n),l=qS(),u=QMe({...o,direction:l.direction});return S.jsx(XMe,{value:u,children:S.jsx(JMe,{value:e,children:bl(i,{isOpen:u.isOpen,onClose:u.onClose,forceUpdate:u.forceUpdate})})})}Ure.displayName="Popover";function Vre(n){var i;const e=k.version;return typeof e!="string"||e.startsWith("18.")?n==null?void 0:n.ref:(i=n==null?void 0:n.props)==null?void 0:i.ref}const jre=zt(function(e,i){const{getBodyProps:o}=cN(),l=Mre();return S.jsx(Mt.div,{...o(e,i),className:bn("chakra-popover__body",e.className),__css:l.body})});jre.displayName="PopoverBody";function ZMe(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const eUe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},tUe=Mt(Bp.section),Fre=zt(function(e,i){const{variants:o=eUe,...l}=e,{isOpen:u}=cN();return S.jsx(tUe,{ref:i,variants:ZMe(o),initial:!1,animate:u?"enter":"exit",...l})});Fre.displayName="PopoverTransition";const Bre=zt(function(e,i){const{rootProps:o,motionProps:l,...u}=e,{getPopoverProps:f,getPopoverPositionerProps:y,onAnimationComplete:v}=cN(),b=Mre(),C={position:"relative",display:"flex",flexDirection:"column",...b.content};return S.jsx(Mt.div,{...y(o),__css:b.popper,className:"chakra-popover__popper",children:S.jsx(Fre,{...l,...f(u,i),onAnimationComplete:FZ(v,u.onAnimationComplete),className:bn("chakra-popover__content",e.className),__css:C})})});Bre.displayName="PopoverContent";function zre(n){const e=k.Children.only(n.children),{getTriggerProps:i}=cN();return S.jsx(S.Fragment,{children:k.cloneElement(e,i(e.props,Vre(e)))})}zre.displayName="PopoverTrigger";function nUe(n,e,i){return(n-e)*100/(i-e)}PR({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});PR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const rUe=PR({"0%":{left:"-40%"},"100%":{left:"100%"}}),iUe=PR({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function sUe(n){const{value:e=0,min:i,max:o,valueText:l,getValueText:u,isIndeterminate:f,role:y="progressbar"}=n,v=nUe(e,i,o);return{bind:{"data-indeterminate":f?"":void 0,"aria-valuemax":o,"aria-valuemin":i,"aria-valuenow":f?void 0:e,"aria-valuetext":(()=>{if(e!=null)return typeof u=="function"?u(e,v):l})(),role:y},percent:v,value:e}}const[oUe,aUe]=Ai({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),cUe=zt((n,e)=>{const{min:i,max:o,value:l,isIndeterminate:u,role:f,...y}=n,v=sUe({value:l,min:i,max:o,isIndeterminate:u,role:f}),C={height:"100%",...aUe().filledTrack};return S.jsx(Mt.div,{ref:e,style:{width:`${v.percent}%`,...y.style},...v.bind,...y,__css:C})}),Hy=zt((n,e)=>{var q;const{value:i,min:o=0,max:l=100,hasStripe:u,isAnimated:f,children:y,borderRadius:v,isIndeterminate:b,"aria-label":C,"aria-labelledby":R,"aria-valuetext":O,title:L,role:D,...U}=Hi(n),B=Ba("Progress",n),Y=v??((q=B.track)==null?void 0:q.borderRadius),W={animation:`${iUe} 1s linear infinite`},re={...!b&&u&&f&&W,...b&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${rUe} 1s ease infinite normal none running`}},me={overflow:"hidden",position:"relative",...B.track};return S.jsx(Mt.div,{ref:e,borderRadius:Y,__css:me,...U,children:S.jsxs(oUe,{value:B,children:[S.jsx(cUe,{"aria-label":C,"aria-labelledby":R,"aria-valuetext":O,min:o,max:l,value:i,isIndeterminate:b,css:re,borderRadius:Y,title:L,role:D}),y]})})});Hy.displayName="Progress";const Wre=zt(function(e,i){const{children:o,placeholder:l,className:u,...f}=e;return S.jsxs(Mt.select,{...f,ref:i,className:bn("chakra-select",u),children:[l&&S.jsx("option",{value:"",children:l}),o]})});Wre.displayName="SelectField";const Gre=zt((n,e)=>{var ne;const i=Ba("Select",n),{rootProps:o,placeholder:l,icon:u,color:f,height:y,h:v,minH:b,minHeight:C,iconColor:R,iconSize:O,...L}=Hi(n),[D,U]=ove(L,C0e),B=H3(U),Y={width:"100%",height:"fit-content",position:"relative",color:f},W={paddingEnd:"2rem",...i.field,_focus:{zIndex:"unset",...(ne=i.field)==null?void 0:ne._focus}};return S.jsxs(Mt.div,{className:"chakra-select__wrapper",__css:Y,...D,...o,children:[S.jsx(Wre,{ref:e,height:v??y,minH:b??C,placeholder:l,...B,__css:W,children:n.children}),S.jsx(Hre,{"data-disabled":dr(B.disabled),...(R||f)&&{color:R||f},__css:i.icon,...O&&{fontSize:O},children:u})]})});Gre.displayName="Select";const lUe=n=>S.jsx("svg",{viewBox:"0 0 24 24",...n,children:S.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),uUe=Mt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Hre=n=>{const{children:e=S.jsx(lUe,{}),...i}=n,o=k.cloneElement(e,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return S.jsx(uUe,{...i,className:"chakra-select__icon-wrapper",children:k.isValidElement(e)?o:null})};Hre.displayName="SelectIcon";function LU(n){const{orientation:e,vertical:i,horizontal:o}=n;return e==="vertical"?i:o}function dUe(n){const{orientation:e,thumbPercents:i,isReversed:o}=n,l=L=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...LU({orientation:e,vertical:{bottom:`${i[L]}%`,transform:"translate(-50%, 50%) scale(var(--slider-thumb-scale, 1))"},horizontal:{left:`${i[L]}%`,transform:"translate(-50%, -50%) scale(var(--slider-thumb-scale, 1))"}})}),u={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},f={position:"absolute",...LU({orientation:e,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},y=i.length===1,v=[0,o?100-i[0]:i[0]],b=y?v:i;let C=b[0];!y&&o&&(C=100-C);const R=Math.abs(b[b.length-1]-b[0]),O={...f,...LU({orientation:e,vertical:o?{height:`${R}%`,top:`${C}%`}:{height:`${R}%`,bottom:`${C}%`},horizontal:o?{width:`${R}%`,right:`${C}%`}:{width:`${R}%`,left:`${C}%`}})};return{trackStyle:f,innerTrackStyle:O,rootStyle:u,getThumbStyle:l}}function hUe(n){const{isReversed:e,direction:i,orientation:o}=n;return i==="ltr"||o==="vertical"?e:!e}function pUe(n){const{min:e=0,max:i=100,onChange:o,value:l,defaultValue:u,isReversed:f,direction:y="ltr",orientation:v="horizontal",id:b,isDisabled:C,isReadOnly:R,onChangeStart:O,onChangeEnd:L,step:D=1,getAriaValueText:U,"aria-valuetext":B,"aria-label":Y,"aria-labelledby":W,name:ne,focusThumbOnChange:le=!0,...re}=n,me=fo(O),q=fo(L),J=fo(U),Q=hUe({isReversed:f,direction:y,orientation:v}),[ie,pe]=KZ({value:l,defaultValue:u??mUe(e,i),onChange:o}),[de,he]=k.useState(!1),[Se,Ie]=k.useState(!1),Fe=!(C||R),we=(i-e)/10,Re=D||(i-e)/100,Te=pO(ie,e,i),Ne=i-Te+e,xe=JK(Q?Ne:Te,e,i),je=v==="vertical",nt=JZ({min:e,max:i,step:D,isDisabled:C,value:Te,isInteractive:Fe,isReversed:Q,isVertical:je,eventSource:null,focusThumbOnChange:le,orientation:v}),dt=k.useRef(null),ft=k.useRef(null),lt=k.useRef(null),gt=k.useId(),at=b??gt,[Ct,En]=[`slider-thumb-${at}`,`slider-track-${at}`],Gt=k.useCallback(Nt=>{var Do;if(!dt.current)return;const Ht=nt.current;Ht.eventSource="pointer";const Lr=dt.current.getBoundingClientRect(),{clientX:wi,clientY:ti}=((Do=Nt.touches)==null?void 0:Do[0])??Nt,Vi=je?Lr.bottom-ti:wi-Lr.left,us=je?Lr.height:Lr.width;let _o=Vi/us;Q&&(_o=1-_o);let Wr=nve(_o,Ht.min,Ht.max);return Ht.step&&(Wr=parseFloat(QK(Wr,Ht.min,Ht.step))),Wr=pO(Wr,Ht.min,Ht.max),Wr},[je,Q,nt]),Xt=k.useCallback(Nt=>{const Ht=nt.current;Ht.isInteractive&&(Nt=parseFloat(QK(Nt,Ht.min,Re)),Nt=pO(Nt,Ht.min,Ht.max),pe(Nt))},[Re,pe,nt]),st=k.useMemo(()=>({stepUp(Nt=Re){const Ht=Q?Te-Nt:Te+Nt;Xt(Ht)},stepDown(Nt=Re){const Ht=Q?Te+Nt:Te-Nt;Xt(Ht)},reset(){Xt(u||0)},stepTo(Nt){Xt(Nt)}}),[Xt,Q,Te,Re,u]),hn=k.useCallback(Nt=>{const Ht=nt.current,wi={ArrowRight:()=>st.stepUp(),ArrowUp:()=>st.stepUp(),ArrowLeft:()=>st.stepDown(),ArrowDown:()=>st.stepDown(),PageUp:()=>st.stepUp(we),PageDown:()=>st.stepDown(we),Home:()=>Xt(Ht.min),End:()=>Xt(Ht.max)}[Nt.key];wi&&(Nt.preventDefault(),Nt.stopPropagation(),wi(Nt),Ht.eventSource="keyboard")},[st,Xt,we,nt]),an=(J==null?void 0:J(Te))??B,{getThumbStyle:jt,rootStyle:on,trackStyle:St,innerTrackStyle:ve}=k.useMemo(()=>{const Nt=nt.current;return dUe({isReversed:Q,orientation:Nt.orientation,thumbPercents:[xe]})},[Q,xe,nt]),De=k.useCallback(()=>{nt.current.focusThumbOnChange&&setTimeout(()=>{var Ht;return(Ht=ft.current)==null?void 0:Ht.focus()})},[nt]);Wf(()=>{const Nt=nt.current;De(),Nt.eventSource==="keyboard"&&(q==null||q(Nt.value))},[Te,q]);function Ke(Nt){const Ht=Gt(Nt);Ht!=null&&Ht!==nt.current.value&&pe(Ht)}Hve(lt,{onPanSessionStart(Nt){const Ht=nt.current;Ht.isInteractive&&(he(!0),De(),Ke(Nt),me==null||me(Ht.value))},onPanSessionEnd(){const Nt=nt.current;Nt.isInteractive&&(he(!1),q==null||q(Nt.value))},onPan(Nt){nt.current.isInteractive&&Ke(Nt)}});const Ot=k.useCallback((Nt={},Ht=null)=>({...Nt,...re,ref:Gi(Ht,lt),tabIndex:-1,"aria-disabled":Lf(C),"data-focused":dr(Se),style:{...Nt.style,...on}}),[re,C,Se,on]),Et=k.useCallback((Nt={},Ht=null)=>({...Nt,ref:Gi(Ht,dt),id:En,"data-disabled":dr(C),style:{...Nt.style,...St}}),[C,En,St]),Pt=k.useCallback((Nt={},Ht=null)=>({...Nt,ref:Ht,style:{...Nt.style,...ve}}),[ve]),Ut=k.useCallback((Nt={},Ht=null)=>({...Nt,ref:Gi(Ht,ft),role:"slider",tabIndex:Fe?0:void 0,id:Ct,"data-active":dr(de),"aria-valuetext":an,"aria-valuemin":e,"aria-valuemax":i,"aria-valuenow":Te,"aria-orientation":v,"aria-disabled":Lf(C),"aria-readonly":Lf(R),"aria-label":Y,"aria-labelledby":Y?void 0:W,style:{...Nt.style,...jt(0)},onKeyDown:Vn(Nt.onKeyDown,hn),onFocus:Vn(Nt.onFocus,()=>Ie(!0)),onBlur:Vn(Nt.onBlur,()=>Ie(!1))}),[Fe,Ct,de,an,e,i,Te,v,C,R,Y,W,jt,hn]),cn=k.useCallback((Nt,Ht=null)=>{const Lr=!(Nt.value<e||Nt.value>i),wi=Te>=Nt.value,ti=JK(Nt.value,e,i),Vi={position:"absolute",pointerEvents:"none",...fUe({orientation:v,vertical:{bottom:Q?`${100-ti}%`:`${ti}%`},horizontal:{left:Q?`${100-ti}%`:`${ti}%`}})};return{...Nt,ref:Ht,role:"presentation","aria-hidden":!0,"data-disabled":dr(C),"data-invalid":dr(!Lr),"data-highlighted":dr(wi),style:{...Nt.style,...Vi}}},[C,Q,i,e,v,Te]),_t=k.useCallback((Nt={},Ht=null)=>({...Nt,ref:Ht,type:"hidden",value:Te,name:ne}),[ne,Te]);return{state:{value:Te,isFocused:Se,isDragging:de},actions:st,getRootProps:Ot,getTrackProps:Et,getInnerTrackProps:Pt,getThumbProps:Ut,getMarkerProps:cn,getInputProps:_t}}function fUe(n){const{orientation:e,vertical:i,horizontal:o}=n;return e==="vertical"?i:o}function mUe(n,e){return e<n?n:n+(e-n)/2}const[gUe,lN]=Ai({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[_Ue,uN]=Ai({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),hS=zt((n,e)=>{const i={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},o=Ba("Slider",i),l=Hi(i),{direction:u}=qS();l.direction=u;const{getInputProps:f,getRootProps:y,...v}=pUe(l),b=y(),C=f({},e);return S.jsx(gUe,{value:v,children:S.jsx(_Ue,{value:o,children:S.jsxs(Mt.div,{...b,className:bn("chakra-slider",i.className),__css:o.container,children:[i.children,S.jsx("input",{...C})]})})})});hS.displayName="Slider";const pS=zt((n,e)=>{const{getThumbProps:i}=lN(),o=uN(),l=i(n,e);return S.jsx(Mt.div,{...l,className:bn("chakra-slider__thumb",n.className),__css:o.thumb})});pS.displayName="SliderThumb";const fS=zt((n,e)=>{const{getTrackProps:i}=lN(),o=uN(),l=i(n,e);return S.jsx(Mt.div,{...l,className:bn("chakra-slider__track",n.className),__css:o.track})});fS.displayName="SliderTrack";const mS=zt((n,e)=>{const{getInnerTrackProps:i}=lN(),o=uN(),l=i(n,e);return S.jsx(Mt.div,{...l,className:bn("chakra-slider__filled-track",n.className),__css:o.filledTrack})});mS.displayName="SliderFilledTrack";const yUe=zt((n,e)=>{const{getMarkerProps:i}=lN(),o=uN(),l=i(n,e);return S.jsx(Mt.div,{...l,className:bn("chakra-slider__marker",n.className),__css:o.mark})});yUe.displayName="SliderMark";const MC=Mt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});MC.displayName="Spacer";const $re=n=>S.jsx(Mt.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});$re.displayName="StackItem";function EUe(n){const{spacing:e,direction:i}=n,o={column:{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:e,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:e,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":F5(i,l=>o[l])}}const yj=zt((n,e)=>{const{isInline:i,direction:o,align:l,justify:u,spacing:f="0.5rem",wrap:y,children:v,divider:b,className:C,shouldWrapChildren:R,...O}=n,L=i?"row":o??"column",D=k.useMemo(()=>EUe({spacing:f,direction:L}),[f,L]),U=!!b,B=!R&&!U,Y=k.useMemo(()=>{const ne=Bk(v);return B?ne:ne.map((le,re)=>{const me=typeof le.key<"u"?le.key:re,q=re+1===ne.length,Q=R?S.jsx($re,{children:le},me):le;if(!U)return Q;const ie=k.cloneElement(b,{__css:D}),pe=q?null:ie;return S.jsxs(k.Fragment,{children:[Q,pe]},me)})},[b,D,U,B,R,v]),W=bn("chakra-stack",C);return S.jsx(Mt.div,{ref:e,display:"flex",alignItems:l,justifyContent:u,flexDirection:L,flexWrap:y,gap:U?void 0:f,className:W,...O,children:Y})});yj.displayName="Stack";const Cn=zt((n,e)=>S.jsx(yj,{align:"center",...n,direction:"row",ref:e}));Cn.displayName="HStack";const hr=zt((n,e)=>S.jsx(yj,{align:"center",...n,direction:"column",ref:e}));hr.displayName="VStack";const sd=zt(function(e,i){const o=Ba("Switch",e),{spacing:l="0.5rem",children:u,...f}=Hi(e),{getIndicatorProps:y,getInputProps:v,getCheckboxProps:b,getRootProps:C,getLabelProps:R}=fxe(f),O=k.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...o.container}),[o.container]),L=k.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...o.track}),[o.track]),D=k.useMemo(()=>({userSelect:"none",marginStart:l,...o.label}),[l,o.label]);return S.jsxs(Mt.label,{...C(),className:bn("chakra-switch",e.className),__css:O,children:[S.jsx("input",{className:"chakra-switch__input",...v({},i)}),S.jsx(Mt.span,{...b(),className:"chakra-switch__track",__css:L,children:S.jsx(Mt.span,{__css:o.thumb,className:"chakra-switch__thumb",...y()})}),u&&S.jsx(Mt.span,{className:"chakra-switch__label",...R(),__css:D,children:u})]})});sd.displayName="Switch";const[vUe,SUe,bUe,wUe]=vne();function TUe(n){const{defaultIndex:e,onChange:i,index:o,isManual:l,isLazy:u,lazyBehavior:f="unmount",orientation:y="horizontal",direction:v="ltr",...b}=n,[C,R]=k.useState(e??0),[O,L]=KZ({defaultValue:e??0,value:o,onChange:i});k.useEffect(()=>{o!=null&&R(o)},[o]);const D=bUe(),U=k.useId();return{id:`tabs-${n.id??U}`,selectedIndex:O,focusedIndex:C,setSelectedIndex:L,setFocusedIndex:R,isManual:l,isLazy:u,lazyBehavior:f,orientation:y,descendants:D,direction:v,htmlProps:b}}const[CUe,dN]=Ai({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function RUe(n){const{focusedIndex:e,orientation:i,direction:o}=dN(),l=SUe(),u=k.useCallback(f=>{const y=()=>{var ne;const W=l.nextEnabled(e);W&&((ne=W.node)==null||ne.focus())},v=()=>{var ne;const W=l.prevEnabled(e);W&&((ne=W.node)==null||ne.focus())},b=()=>{var ne;const W=l.firstEnabled();W&&((ne=W.node)==null||ne.focus())},C=()=>{var ne;const W=l.lastEnabled();W&&((ne=W.node)==null||ne.focus())},R=i==="horizontal",O=i==="vertical",L=f.key,D=o==="ltr"?"ArrowLeft":"ArrowRight",U=o==="ltr"?"ArrowRight":"ArrowLeft",Y={[D]:()=>R&&v(),[U]:()=>R&&y(),ArrowDown:()=>O&&y(),ArrowUp:()=>O&&v(),Home:b,End:C}[L];Y&&(f.preventDefault(),Y(f))},[l,e,i,o]);return{...n,role:"tablist","aria-orientation":i,onKeyDown:Vn(n.onKeyDown,u)}}function IUe(n){const{isDisabled:e=!1,isFocusable:i=!1,...o}=n,{setSelectedIndex:l,isManual:u,id:f,setFocusedIndex:y,selectedIndex:v}=dN(),{index:b,register:C}=wUe({disabled:e&&!i}),R=b===v,O=()=>{l(b)},L=()=>{y(b),!u&&!(e&&i)&&l(b)};return{...vre({...o,ref:Gi(C,n.ref),isDisabled:e,isFocusable:i,onClick:Vn(n.onClick,O)}),id:Kre(f,b),role:"tab",tabIndex:R?0:-1,type:"button","aria-selected":R,"aria-controls":qre(f,b),onFocus:e?void 0:Vn(n.onFocus,L)}}const[AUe,PUe]=Ai({});function OUe(n){const e=dN(),{id:i,selectedIndex:o}=e,u=Bk(n.children).map((f,y)=>k.createElement(AUe,{key:f.key??y,value:{isSelected:y===o,id:qre(i,y),tabId:Kre(i,y),selectedIndex:o}},f));return{...n,children:u}}function kUe(n){const{children:e,...i}=n,{isLazy:o,lazyBehavior:l}=dN(),{isSelected:u,id:f,tabId:y}=PUe(),v=k.useRef(!1);u&&(v.current=!0);const b=V5({wasSelected:v.current,isSelected:u,enabled:o,mode:l});return{tabIndex:0,...i,children:b?e:null,role:"tabpanel","aria-labelledby":y,hidden:!u,id:f}}function Kre(n,e){return`${n}--tab-${e}`}function qre(n,e){return`${n}--tabpanel-${e}`}const[NUe,hN]=Ai({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),xS=zt(function(e,i){const o=Ba("Tabs",e),{children:l,className:u,...f}=Hi(e),{htmlProps:y,descendants:v,...b}=TUe(f),C=k.useMemo(()=>b,[b]),{isFitted:R,...O}=y,L={position:"relative",...o.root};return S.jsx(vUe,{value:v,children:S.jsx(CUe,{value:C,children:S.jsx(NUe,{value:o,children:S.jsx(Mt.div,{className:bn("chakra-tabs",u),ref:i,...O,__css:L,children:l})})})})});xS.displayName="Tabs";const ga=zt(function(e,i){const o=hN(),l=IUe({...e,ref:i}),u={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...o.tab};return S.jsx(Mt.button,{...l,className:bn("chakra-tabs__tab",e.className),__css:u})});ga.displayName="Tab";const DS=zt(function(e,i){const o=RUe({...e,ref:i}),l=hN(),u={display:"flex",...l.tablist};return S.jsx(Mt.div,{...o,className:bn("chakra-tabs__tablist",e.className),__css:u})});DS.displayName="TabList";const uc=zt(function(e,i){const o=kUe({...e,ref:i}),l=hN();return S.jsx(Mt.div,{outline:"0",...o,className:bn("chakra-tabs__tab-panel",e.className),__css:l.tabpanel})});uc.displayName="TabPanel";const pR=zt(function(e,i){const o=OUe(e),l=hN();return S.jsx(Mt.div,{...o,width:"100%",ref:i,className:bn("chakra-tabs__tab-panels",e.className),__css:l.tabpanels})});pR.displayName="TabPanels";const[xUe,Yre]=Ai({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),Xre=zt((n,e)=>{const i=Ba("Tag",n),o=Hi(n),l={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...i.container};return S.jsx(xUe,{value:i,children:S.jsx(Mt.span,{ref:e,...o,__css:l})})});Xre.displayName="Tag";const Jre=zt((n,e)=>{const i=Yre();return S.jsx(Mt.span,{ref:e,noOfLines:1,...n,__css:i.label})});Jre.displayName="TagLabel";const DUe=zt((n,e)=>S.jsx(Zt,{ref:e,verticalAlign:"top",marginEnd:"0.5rem",...n}));DUe.displayName="TagLeftIcon";const LUe=zt((n,e)=>S.jsx(Zt,{ref:e,verticalAlign:"top",marginStart:"0.5rem",...n}));LUe.displayName="TagRightIcon";const Qre=n=>S.jsx(Zt,{verticalAlign:"inherit",viewBox:"0 0 512 512",...n,children:S.jsx("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});Qre.displayName="TagCloseIcon";const Zre=zt((n,e)=>{const{isDisabled:i,children:o,...l}=n,f={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...Yre().closeButton};return S.jsx(Mt.button,{ref:e,"aria-label":"close",...l,type:"button",disabled:i,__css:f,children:o||S.jsx(Qre,{})})});Zre.displayName="TagCloseButton";const MUe=["h","minH","height","minHeight"],eie=zt((n,e)=>{const i=gd("Textarea",n),{className:o,rows:l,...u}=Hi(n),f=H3(u),y=l?CR(i,MUe):i;return S.jsx(Mt.textarea,{ref:e,rows:l,...f,className:bn("chakra-textarea",o),__css:y})});eie.displayName="Textarea";function UUe(n,e){const i=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[i];return(l==null?void 0:l[e])??i}function VUe(n,e){const i=l=>({...e,...l,position:UUe((l==null?void 0:l.position)??(e==null?void 0:e.position),n)}),o=l=>{const u=i(l),f=_ne(u);return bp.notify(f,u)};return o.update=(l,u)=>{bp.update(l,i(u))},o.promise=(l,u)=>{const f=o({...u.loading,status:"loading",duration:null});l.then(y=>o.update(f,{status:"success",duration:5e3,...bl(u.success,y)})).catch(y=>o.update(f,{status:"error",duration:5e3,...bl(u.error,y)}))},o.closeAll=bp.closeAll,o.close=bp.close,o.isActive=bp.isActive,o}function Ea(n){const{theme:e}=fne(),i=UNe();return k.useMemo(()=>VUe(e.direction,{...i,...n}),[n,e.direction,i])}const jUe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},JV=n=>{var e;return((e=n.current)==null?void 0:e.ownerDocument)||document},NO=n=>{var e,i;return((i=(e=n.current)==null?void 0:e.ownerDocument)==null?void 0:i.defaultView)||window};function FUe(n={}){const{openDelay:e=0,closeDelay:i=0,closeOnClick:o=!0,closeOnMouseDown:l,closeOnScroll:u,closeOnPointerDown:f=l,closeOnEsc:y=!0,onOpen:v,onClose:b,placement:C,id:R,isOpen:O,defaultIsOpen:L,arrowSize:D=10,arrowShadowColor:U,arrowPadding:B,modifiers:Y,isDisabled:W,gutter:ne,offset:le,direction:re,...me}=n,{isOpen:q,onOpen:J,onClose:Q}=pd({isOpen:O,defaultIsOpen:L,onOpen:v,onClose:b}),{referenceRef:ie,getPopperProps:pe,getArrowInnerProps:de,getArrowProps:he}=gj({enabled:q,placement:C,arrowPadding:B,modifiers:Y,gutter:ne,offset:le,direction:re}),Se=k.useId(),Fe=`tooltip-${R??Se}`,we=k.useRef(null),Re=k.useRef(void 0),Te=k.useCallback(()=>{Re.current&&(clearTimeout(Re.current),Re.current=void 0)},[]),Ne=k.useRef(void 0),be=k.useCallback(()=>{Ne.current&&(clearTimeout(Ne.current),Ne.current=void 0)},[]),xe=k.useCallback(()=>{be(),Q()},[Q,be]),je=BUe(we,xe),nt=k.useCallback(()=>{if(!W&&!Re.current){q&&je();const Gt=NO(we);Re.current=Gt.setTimeout(J,e)}},[je,W,q,J,e]),dt=k.useCallback(()=>{Te();const Gt=NO(we);Ne.current=Gt.setTimeout(xe,i)},[i,xe,Te]),ft=k.useCallback(()=>{q&&o&&dt()},[o,dt,q]),lt=k.useCallback(()=>{q&&f&&dt()},[f,dt,q]),gt=k.useCallback(Gt=>{q&&Gt.key==="Escape"&&dt()},[q,dt]);Uy(()=>JV(we),"keydown",y?gt:void 0),Uy(()=>{if(!u)return null;const Gt=we.current;if(!Gt)return null;const Xt=HZ(Gt);return Xt.localName==="body"?NO(we):Xt},"scroll",()=>{q&&u&&xe()},{passive:!0,capture:!0}),k.useEffect(()=>{W&&(Te(),q&&Q())},[W,q,Q,Te]),k.useEffect(()=>()=>{Te(),be()},[Te,be]),Uy(()=>we.current,"pointerleave",dt);const at=k.useCallback((Gt={},Xt=null)=>({...Gt,ref:Gi(we,Xt,ie),onPointerEnter:Vn(Gt.onPointerEnter,hn=>{hn.pointerType!=="touch"&&nt()}),onClick:Vn(Gt.onClick,ft),onPointerDown:Vn(Gt.onPointerDown,lt),onFocus:Vn(Gt.onFocus,nt),onBlur:Vn(Gt.onBlur,dt),"aria-describedby":q?Fe:void 0}),[nt,dt,lt,q,Fe,ft,ie]),Ct=k.useCallback((Gt={},Xt=null)=>pe({...Gt,style:{...Gt.style,[Ao.arrowSize.var]:D?`${D}px`:void 0,[Ao.arrowShadowColor.var]:U}},Xt),[pe,D,U]),En=k.useCallback((Gt={},Xt=null)=>{const st={...Gt.style,position:"relative",transformOrigin:Ao.transformOrigin.varRef};return{ref:Xt,...me,...Gt,id:Fe,role:"tooltip",style:st}},[me,Fe]);return{isOpen:q,show:nt,hide:dt,getTriggerProps:at,getTooltipProps:En,getTooltipPositionerProps:Ct,getArrowProps:he,getArrowInnerProps:de}}const MU="chakra-ui:close-tooltip";function BUe(n,e){return k.useEffect(()=>{const i=JV(n);return i.addEventListener(MU,e),()=>i.removeEventListener(MU,e)},[e,n]),()=>{const i=JV(n),o=NO(n);i.dispatchEvent(new o.CustomEvent(MU))}}const zUe=Mt(Bp.div),Ff=zt((n,e)=>{const i=gd("Tooltip",n),o=Hi(n),l=qS(),{children:u,label:f,shouldWrapChildren:y,"aria-label":v,hasArrow:b,bg:C,portalProps:R,background:O,backgroundColor:L,bgColor:D,motionProps:U,animatePresenceProps:B,...Y}=o,W=O??L??C??D;if(W){i.bg=W;const ie=L0e(l,"colors",W);i[Ao.arrowBg.var]=ie}const ne=FUe({...Y,direction:l.direction}),le=!k.isValidElement(u)||y;let re;if(le)re=S.jsx(Mt.span,{display:"inline-block",tabIndex:0,...ne.getTriggerProps(),children:u});else{const ie=k.Children.only(u);re=k.cloneElement(ie,ne.getTriggerProps(ie.props,Vre(ie)))}const me=!!v,q=ne.getTooltipProps({},e),J=me?CR(q,["role","id"]):q,Q=GZ(q,["role","id"]);return f?S.jsxs(S.Fragment,{children:[re,S.jsx(lE,{...B,children:ne.isOpen&&S.jsx(Al,{...R,children:S.jsx(Mt.div,{...ne.getTooltipPositionerProps(),__css:{zIndex:i.zIndex,pointerEvents:"none"},children:S.jsxs(zUe,{variants:jUe,initial:"exit",animate:"enter",exit:"exit",...U,...J,__css:i,children:[f,me&&S.jsx(Mt.span,{srOnly:!0,...Q,children:v}),b&&S.jsx(Mt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:S.jsx(Mt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:i.bg}})})]})})})})]}):S.jsx(S.Fragment,{children:u})});Ff.displayName="Tooltip";const fR=zt(function(e,i){const o=gd("Heading",e),{className:l,...u}=Hi(e);return S.jsx(Mt.h2,{ref:i,className:bn("chakra-heading",e.className),...u,__css:o})});fR.displayName="Heading";const qe=zt(function(e,i){const o=gd("Text",e),{className:l,align:u,decoration:f,casing:y,...v}=Hi(e),b=U5({textAlign:e.align,textDecoration:e.decoration,textTransform:e.casing});return S.jsx(Mt.p,{ref:i,className:bn("chakra-text",e.className),...b,...v,__css:o})});qe.displayName="Text";const tie=zt(function(e,i){const{spacing:o="0.5rem",spacingX:l,spacingY:u,children:f,justify:y,direction:v,align:b,className:C,shouldWrapChildren:R,...O}=e,L=k.useMemo(()=>R?k.Children.map(f,(D,U)=>S.jsx(Ej,{children:D},U)):f,[f,R]);return S.jsx(Mt.div,{ref:i,className:bn("chakra-wrap",C),...O,children:S.jsx(Mt.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:y,alignItems:b,flexDirection:v,listStyleType:"none",gap:o,columnGap:l,rowGap:u,padding:"0"},children:L})})});tie.displayName="Wrap";const Ej=zt(function(e,i){const{className:o,...l}=e;return S.jsx(Mt.li,{ref:i,__css:{display:"flex",alignItems:"flex-start"},className:bn("chakra-wrap__listitem",o),...l})});Ej.displayName="WrapItem";const WUe="modulepreload",GUe=function(n,e){return new URL(n,e).href},HX={},UU=function(e,i,o){let l=Promise.resolve();if(i&&i.length>0){let f=function(C){return Promise.all(C.map(R=>Promise.resolve(R).then(O=>({status:"fulfilled",value:O}),O=>({status:"rejected",reason:O}))))};const y=document.getElementsByTagName("link"),v=document.querySelector("meta[property=csp-nonce]"),b=(v==null?void 0:v.nonce)||(v==null?void 0:v.getAttribute("nonce"));l=f(i.map(C=>{if(C=GUe(C,o),C in HX)return;HX[C]=!0;const R=C.endsWith(".css"),O=R?'[rel="stylesheet"]':"";if(!!o)for(let U=y.length-1;U>=0;U--){const B=y[U];if(B.href===C&&(!R||B.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${C}"]${O}`))return;const D=document.createElement("link");if(D.rel=R?"stylesheet":WUe,R||(D.as="script"),D.crossOrigin="",D.href=C,b&&D.setAttribute("nonce",b),document.head.appendChild(D),R)return new Promise((U,B)=>{D.addEventListener("load",U),D.addEventListener("error",()=>B(new Error(`Unable to preload CSS for ${C}`)))})}))}function u(f){const y=new Event("vite:preloadError",{cancelable:!0});if(y.payload=f,window.dispatchEvent(y),!y.defaultPrevented)throw f}return l.then(f=>{for(const y of f||[])y.status==="rejected"&&u(y.reason);return e().catch(u)})},VU=()=>{const n=new Date,e=n.getHours().toString().padStart(2,"0"),i=n.getMinutes().toString().padStart(2,"0"),o=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${e}:${i}:${o}.${l}`},H={log:(...n)=>{n.map((e,i)=>i===0&&typeof e=="string"?`
${e}`:e)},error:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.error(`[ERROR] [${VU()}] `,...e)}},warn:(...n)=>{{const e=n.map((i,o)=>o===0&&typeof i=="string"?`
${i}`:i);console.warn(`[WARN] [${VU()}]`,...e)}},trace:n=>{console.trace(`[TRACE] [${VU()}] ${n}`)}};async function HUe(n){let e;try{switch(n){case"default":e=await UU(()=>import("./index.v0.9.22.js"),[],import.meta.url);break;default:e=await UU(()=>import("./index.v0.9.22.js"),[],import.meta.url)}return e.default}catch(i){return H.error("Failed to load theme:",i),e=await UU(()=>import("./index.v0.9.22.js"),[],import.meta.url),e.default}}const $Ue=()=>{};var $X={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nie=function(n){const e=[];let i=0;for(let o=0;o<n.length;o++){let l=n.charCodeAt(o);l<128?e[i++]=l:l<2048?(e[i++]=l>>6|192,e[i++]=l&63|128):(l&64512)===55296&&o+1<n.length&&(n.charCodeAt(o+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++o)&1023),e[i++]=l>>18|240,e[i++]=l>>12&63|128,e[i++]=l>>6&63|128,e[i++]=l&63|128):(e[i++]=l>>12|224,e[i++]=l>>6&63|128,e[i++]=l&63|128)}return e},KUe=function(n){const e=[];let i=0,o=0;for(;i<n.length;){const l=n[i++];if(l<128)e[o++]=String.fromCharCode(l);else if(l>191&&l<224){const u=n[i++];e[o++]=String.fromCharCode((l&31)<<6|u&63)}else if(l>239&&l<365){const u=n[i++],f=n[i++],y=n[i++],v=((l&7)<<18|(u&63)<<12|(f&63)<<6|y&63)-65536;e[o++]=String.fromCharCode(55296+(v>>10)),e[o++]=String.fromCharCode(56320+(v&1023))}else{const u=n[i++],f=n[i++];e[o++]=String.fromCharCode((l&15)<<12|(u&63)<<6|f&63)}}return e.join("")},rie={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,o=[];for(let l=0;l<n.length;l+=3){const u=n[l],f=l+1<n.length,y=f?n[l+1]:0,v=l+2<n.length,b=v?n[l+2]:0,C=u>>2,R=(u&3)<<4|y>>4;let O=(y&15)<<2|b>>6,L=b&63;v||(L=64,f||(O=64)),o.push(i[C],i[R],i[O],i[L])}return o.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(nie(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):KUe(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,o=[];for(let l=0;l<n.length;){const u=i[n.charAt(l++)],y=l<n.length?i[n.charAt(l)]:0;++l;const b=l<n.length?i[n.charAt(l)]:64;++l;const R=l<n.length?i[n.charAt(l)]:64;if(++l,u==null||y==null||b==null||R==null)throw new qUe;const O=u<<2|y>>4;if(o.push(O),b!==64){const L=y<<4&240|b>>2;if(o.push(L),R!==64){const D=b<<6&192|R;o.push(D)}}}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class qUe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const YUe=function(n){const e=nie(n);return rie.encodeByteArray(e,!0)},uk=function(n){return YUe(n).replace(/\./g,"")},iie=function(n){try{return rie.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XUe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JUe=()=>XUe().__FIREBASE_DEFAULTS__,QUe=()=>{if(typeof process>"u"||typeof $X>"u")return;const n=$X.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},ZUe=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&iie(n[1]);return e&&JSON.parse(e)},pN=()=>{try{return $Ue()||JUe()||QUe()||ZUe()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},sie=n=>{var e,i;return(i=(e=pN())===null||e===void 0?void 0:e.emulatorHosts)===null||i===void 0?void 0:i[n]},vj=n=>{const e=sie(n);if(!e)return;const i=e.lastIndexOf(":");if(i<=0||i+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const o=parseInt(e.substring(i+1),10);return e[0]==="["?[e.substring(1,i-1),o]:[e.substring(0,i),o]},oie=()=>{var n;return(n=pN())===null||n===void 0?void 0:n.config},aie=n=>{var e;return(e=pN())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eVe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}wrapCallback(e){return(i,o)=>{i?this.reject(i):this.resolve(o),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(i):e(i,o))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tm(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function fN(n){return(await fetch(n,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cie(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},o=e||"demo-project",l=n.iat||0,u=n.sub||n.user_id;if(!u)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const f=Object.assign({iss:`https://securetoken.google.com/${o}`,aud:o,iat:l,exp:l+3600,auth_time:l,sub:u,user_id:u,firebase:{sign_in_provider:"custom",identities:{}}},n);return[uk(JSON.stringify(i)),uk(JSON.stringify(f)),""].join(".")}const UC={};function tVe(){const n={prod:[],emulator:[]};for(const e of Object.keys(UC))UC[e]?n.emulator.push(e):n.prod.push(e);return n}function nVe(n){let e=document.getElementById(n),i=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),i=!0),{created:i,element:e}}let KX=!1;function mN(n,e){if(typeof window>"u"||typeof document>"u"||!tm(window.location.host)||UC[n]===e||UC[n]||KX)return;UC[n]=e;function i(O){return`__firebase__banner__${O}`}const o="__firebase__banner",u=tVe().prod.length>0;function f(){const O=document.getElementById(o);O&&O.remove()}function y(O){O.style.display="flex",O.style.background="#7faaf0",O.style.position="fixed",O.style.bottom="5px",O.style.left="5px",O.style.padding=".5em",O.style.borderRadius="5px",O.style.alignItems="center"}function v(O,L){O.setAttribute("width","24"),O.setAttribute("id",L),O.setAttribute("height","24"),O.setAttribute("viewBox","0 0 24 24"),O.setAttribute("fill","none"),O.style.marginLeft="-6px"}function b(){const O=document.createElement("span");return O.style.cursor="pointer",O.style.marginLeft="16px",O.style.fontSize="24px",O.innerHTML=" &times;",O.onclick=()=>{KX=!0,f()},O}function C(O,L){O.setAttribute("id",L),O.innerText="Learn more",O.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",O.setAttribute("target","__blank"),O.style.paddingLeft="5px",O.style.textDecoration="underline"}function R(){const O=nVe(o),L=i("text"),D=document.getElementById(L)||document.createElement("span"),U=i("learnmore"),B=document.getElementById(U)||document.createElement("a"),Y=i("preprendIcon"),W=document.getElementById(Y)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(O.created){const ne=O.element;y(ne),C(B,U);const le=b();v(W,Y),ne.append(W,D,B,le),document.body.appendChild(ne)}u?(D.innerText="Preview backend disconnected.",W.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(W.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,D.innerText="Preview backend running in this workspace."),D.setAttribute("id",L)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",R):R()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fc(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function rVe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(fc())}function iVe(){var n;const e=(n=pN())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function sVe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function oVe(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function aVe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function cVe(){const n=fc();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function lVe(){return!iVe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function uVe(){try{return typeof indexedDB=="object"}catch{return!1}}function dVe(){return new Promise((n,e)=>{try{let i=!0;const o="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(o);l.onsuccess=()=>{l.result.close(),i||self.indexedDB.deleteDatabase(o),n(!0)},l.onupgradeneeded=()=>{i=!1},l.onerror=()=>{var u;e(((u=l.error)===null||u===void 0?void 0:u.message)||"")}}catch(i){e(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hVe="FirebaseError";class Eh extends Error{constructor(e,i,o){super(i),this.code=e,this.customData=o,this.name=hVe,Object.setPrototypeOf(this,Eh.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,BR.prototype.create)}}class BR{constructor(e,i,o){this.service=e,this.serviceName=i,this.errors=o}create(e,...i){const o=i[0]||{},l=`${this.service}/${e}`,u=this.errors[e],f=u?pVe(u,o):"Error",y=`${this.serviceName}: ${f} (${l}).`;return new Eh(l,y,o)}}function pVe(n,e){return n.replace(fVe,(i,o)=>{const l=e[o];return l!=null?String(l):`<${o}?>`})}const fVe=/\{\$([^}]+)}/g;function mVe(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Kf(n,e){if(n===e)return!0;const i=Object.keys(n),o=Object.keys(e);for(const l of i){if(!o.includes(l))return!1;const u=n[l],f=e[l];if(qX(u)&&qX(f)){if(!Kf(u,f))return!1}else if(u!==f)return!1}for(const l of o)if(!i.includes(l))return!1;return!0}function qX(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zR(n){const e=[];for(const[i,o]of Object.entries(n))Array.isArray(o)?o.forEach(l=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(l))}):e.push(encodeURIComponent(i)+"="+encodeURIComponent(o));return e.length?"&"+e.join("&"):""}function mC(n){const e={};return n.replace(/^\?/,"").split("&").forEach(o=>{if(o){const[l,u]=o.split("=");e[decodeURIComponent(l)]=decodeURIComponent(u)}}),e}function gC(n){const e=n.indexOf("?");if(!e)return"";const i=n.indexOf("#",e);return n.substring(e,i>0?i:void 0)}function gVe(n,e){const i=new _Ve(n,e);return i.subscribe.bind(i)}class _Ve{constructor(e,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{e(this)}).catch(o=>{this.error(o)})}next(e){this.forEachObserver(i=>{i.next(e)})}error(e){this.forEachObserver(i=>{i.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,i,o){let l;if(e===void 0&&i===void 0&&o===void 0)throw new Error("Missing Observer.");yVe(e,["next","error","complete"])?l=e:l={next:e,error:i,complete:o},l.next===void 0&&(l.next=jU),l.error===void 0&&(l.error=jU),l.complete===void 0&&(l.complete=jU);const u=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),u}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,e)}sendOne(e,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{i(this.observers[e])}catch(o){typeof console<"u"&&console.error&&console.error(o)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function yVe(n,e){if(typeof n!="object"||n===null)return!1;for(const i of e)if(i in n&&typeof n[i]=="function")return!0;return!1}function jU(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ui(n){return n&&n._delegate?n._delegate:n}class qf{constructor(e,i,o){this.name=e,this.instanceFactory=i,this.type=o,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ry="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EVe{constructor(e,i){this.name=e,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const i=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(i)){const o=new eVe;if(this.instancesDeferred.set(i,o),this.isInitialized(i)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:i});l&&o.resolve(l)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(e){var i;const o=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),l=(i=e==null?void 0:e.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(u){if(l)return null;throw u}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(SVe(e))try{this.getOrInitializeService({instanceIdentifier:Ry})}catch{}for(const[i,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);try{const u=this.getOrInitializeService({instanceIdentifier:l});o.resolve(u)}catch{}}}}clearInstance(e=Ry){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...e.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ry){return this.instances.has(e)}getOptions(e=Ry){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:i={}}=e,o=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(o))throw Error(`${this.name}(${o}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:o,options:i});for(const[u,f]of this.instancesDeferred.entries()){const y=this.normalizeInstanceIdentifier(u);o===y&&f.resolve(l)}return l}onInit(e,i){var o;const l=this.normalizeInstanceIdentifier(i),u=(o=this.onInitCallbacks.get(l))!==null&&o!==void 0?o:new Set;u.add(e),this.onInitCallbacks.set(l,u);const f=this.instances.get(l);return f&&e(f,l),()=>{u.delete(e)}}invokeOnInitCallbacks(e,i){const o=this.onInitCallbacks.get(i);if(o)for(const l of o)try{l(e,i)}catch{}}getOrInitializeService({instanceIdentifier:e,options:i={}}){let o=this.instances.get(e);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:vVe(e),options:i}),this.instances.set(e,o),this.instancesOptions.set(e,i),this.invokeOnInitCallbacks(o,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,o)}catch{}return o||null}normalizeInstanceIdentifier(e=Ry){return this.component?this.component.multipleInstances?e:Ry:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function vVe(n){return n===Ry?void 0:n}function SVe(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bVe{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const i=this.getProvider(e.name);if(i.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);i.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const i=new EVe(e,this);return this.providers.set(e,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fr;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Fr||(Fr={}));const wVe={debug:Fr.DEBUG,verbose:Fr.VERBOSE,info:Fr.INFO,warn:Fr.WARN,error:Fr.ERROR,silent:Fr.SILENT},TVe=Fr.INFO,CVe={[Fr.DEBUG]:"log",[Fr.VERBOSE]:"log",[Fr.INFO]:"info",[Fr.WARN]:"warn",[Fr.ERROR]:"error"},RVe=(n,e,...i)=>{if(e<n.logLevel)return;const o=new Date().toISOString(),l=CVe[e];if(l)console[l](`[${o}]  ${n.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Sj{constructor(e){this.name=e,this._logLevel=TVe,this._logHandler=RVe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Fr))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?wVe[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Fr.DEBUG,...e),this._logHandler(this,Fr.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Fr.VERBOSE,...e),this._logHandler(this,Fr.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Fr.INFO,...e),this._logHandler(this,Fr.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Fr.WARN,...e),this._logHandler(this,Fr.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Fr.ERROR,...e),this._logHandler(this,Fr.ERROR,...e)}}const IVe=(n,e)=>e.some(i=>n instanceof i);let YX,XX;function AVe(){return YX||(YX=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function PVe(){return XX||(XX=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const lie=new WeakMap,QV=new WeakMap,uie=new WeakMap,FU=new WeakMap,bj=new WeakMap;function OVe(n){const e=new Promise((i,o)=>{const l=()=>{n.removeEventListener("success",u),n.removeEventListener("error",f)},u=()=>{i(Pg(n.result)),l()},f=()=>{o(n.error),l()};n.addEventListener("success",u),n.addEventListener("error",f)});return e.then(i=>{i instanceof IDBCursor&&lie.set(i,n)}).catch(()=>{}),bj.set(e,n),e}function kVe(n){if(QV.has(n))return;const e=new Promise((i,o)=>{const l=()=>{n.removeEventListener("complete",u),n.removeEventListener("error",f),n.removeEventListener("abort",f)},u=()=>{i(),l()},f=()=>{o(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",u),n.addEventListener("error",f),n.addEventListener("abort",f)});QV.set(n,e)}let ZV={get(n,e,i){if(n instanceof IDBTransaction){if(e==="done")return QV.get(n);if(e==="objectStoreNames")return n.objectStoreNames||uie.get(n);if(e==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return Pg(n[e])},set(n,e,i){return n[e]=i,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function NVe(n){ZV=n(ZV)}function xVe(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...i){const o=n.call(BU(this),e,...i);return uie.set(o,e.sort?e.sort():[e]),Pg(o)}:PVe().includes(n)?function(...e){return n.apply(BU(this),e),Pg(lie.get(this))}:function(...e){return Pg(n.apply(BU(this),e))}}function DVe(n){return typeof n=="function"?xVe(n):(n instanceof IDBTransaction&&kVe(n),IVe(n,AVe())?new Proxy(n,ZV):n)}function Pg(n){if(n instanceof IDBRequest)return OVe(n);if(FU.has(n))return FU.get(n);const e=DVe(n);return e!==n&&(FU.set(n,e),bj.set(e,n)),e}const BU=n=>bj.get(n);function LVe(n,e,{blocked:i,upgrade:o,blocking:l,terminated:u}={}){const f=indexedDB.open(n,e),y=Pg(f);return o&&f.addEventListener("upgradeneeded",v=>{o(Pg(f.result),v.oldVersion,v.newVersion,Pg(f.transaction),v)}),i&&f.addEventListener("blocked",v=>i(v.oldVersion,v.newVersion,v)),y.then(v=>{u&&v.addEventListener("close",()=>u()),l&&v.addEventListener("versionchange",b=>l(b.oldVersion,b.newVersion,b))}).catch(()=>{}),y}const MVe=["get","getKey","getAll","getAllKeys","count"],UVe=["put","add","delete","clear"],zU=new Map;function JX(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(zU.get(e))return zU.get(e);const i=e.replace(/FromIndex$/,""),o=e!==i,l=UVe.includes(i);if(!(i in(o?IDBIndex:IDBObjectStore).prototype)||!(l||MVe.includes(i)))return;const u=async function(f,...y){const v=this.transaction(f,l?"readwrite":"readonly");let b=v.store;return o&&(b=b.index(y.shift())),(await Promise.all([b[i](...y),l&&v.done]))[0]};return zU.set(e,u),u}NVe(n=>({...n,get:(e,i,o)=>JX(e,i)||n.get(e,i,o),has:(e,i)=>!!JX(e,i)||n.has(e,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VVe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(jVe(i)){const o=i.getImmediate();return`${o.library}/${o.version}`}else return null}).filter(i=>i).join(" ")}}function jVe(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const e5="@firebase/app",QX="0.13.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yf=new Sj("@firebase/app"),FVe="@firebase/app-compat",BVe="@firebase/analytics-compat",zVe="@firebase/analytics",WVe="@firebase/app-check-compat",GVe="@firebase/app-check",HVe="@firebase/auth",$Ve="@firebase/auth-compat",KVe="@firebase/database",qVe="@firebase/data-connect",YVe="@firebase/database-compat",XVe="@firebase/functions",JVe="@firebase/functions-compat",QVe="@firebase/installations",ZVe="@firebase/installations-compat",e5e="@firebase/messaging",t5e="@firebase/messaging-compat",n5e="@firebase/performance",r5e="@firebase/performance-compat",i5e="@firebase/remote-config",s5e="@firebase/remote-config-compat",o5e="@firebase/storage",a5e="@firebase/storage-compat",c5e="@firebase/firestore",l5e="@firebase/ai",u5e="@firebase/firestore-compat",d5e="firebase",h5e="11.10.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t5="[DEFAULT]",p5e={[e5]:"fire-core",[FVe]:"fire-core-compat",[zVe]:"fire-analytics",[BVe]:"fire-analytics-compat",[GVe]:"fire-app-check",[WVe]:"fire-app-check-compat",[HVe]:"fire-auth",[$Ve]:"fire-auth-compat",[KVe]:"fire-rtdb",[qVe]:"fire-data-connect",[YVe]:"fire-rtdb-compat",[XVe]:"fire-fn",[JVe]:"fire-fn-compat",[QVe]:"fire-iid",[ZVe]:"fire-iid-compat",[e5e]:"fire-fcm",[t5e]:"fire-fcm-compat",[n5e]:"fire-perf",[r5e]:"fire-perf-compat",[i5e]:"fire-rc",[s5e]:"fire-rc-compat",[o5e]:"fire-gcs",[a5e]:"fire-gcs-compat",[c5e]:"fire-fst",[u5e]:"fire-fst-compat",[l5e]:"fire-vertex","fire-js":"fire-js",[d5e]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dk=new Map,f5e=new Map,n5=new Map;function ZX(n,e){try{n.container.addComponent(e)}catch(i){Yf.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,i)}}function Mg(n){const e=n.name;if(n5.has(e))return Yf.debug(`There were multiple attempts to register component ${e}.`),!1;n5.set(e,n);for(const i of dk.values())ZX(i,n);for(const i of f5e.values())ZX(i,n);return!0}function WR(n,e){const i=n.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),n.container.getProvider(e)}function vl(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m5e={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Og=new BR("app","Firebase",m5e);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g5e{constructor(e,i,o){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=o,this.container.addComponent(new qf("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Og.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dE=h5e;function die(n,e={}){let i=n;typeof e!="object"&&(e={name:e});const o=Object.assign({name:t5,automaticDataCollectionEnabled:!0},e),l=o.name;if(typeof l!="string"||!l)throw Og.create("bad-app-name",{appName:String(l)});if(i||(i=oie()),!i)throw Og.create("no-options");const u=dk.get(l);if(u){if(Kf(i,u.options)&&Kf(o,u.config))return u;throw Og.create("duplicate-app",{appName:l})}const f=new bVe(l);for(const v of n5.values())f.addComponent(v);const y=new g5e(i,o,f);return dk.set(l,y),y}function gN(n=t5){const e=dk.get(n);if(!e&&n===t5&&oie())return die();if(!e)throw Og.create("no-app",{appName:n});return e}function ud(n,e,i){var o;let l=(o=p5e[n])!==null&&o!==void 0?o:n;i&&(l+=`-${i}`);const u=l.match(/\s|\//),f=e.match(/\s|\//);if(u||f){const y=[`Unable to register library "${l}" with version "${e}":`];u&&y.push(`library name "${l}" contains illegal characters (whitespace or "/")`),u&&f&&y.push("and"),f&&y.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Yf.warn(y.join(" "));return}Mg(new qf(`${l}-version`,()=>({library:l,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _5e="firebase-heartbeat-database",y5e=1,mR="firebase-heartbeat-store";let WU=null;function hie(){return WU||(WU=LVe(_5e,y5e,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(mR)}catch(i){console.warn(i)}}}}).catch(n=>{throw Og.create("idb-open",{originalErrorMessage:n.message})})),WU}async function E5e(n){try{const i=(await hie()).transaction(mR),o=await i.objectStore(mR).get(pie(n));return await i.done,o}catch(e){if(e instanceof Eh)Yf.warn(e.message);else{const i=Og.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Yf.warn(i.message)}}}async function eJ(n,e){try{const o=(await hie()).transaction(mR,"readwrite");await o.objectStore(mR).put(e,pie(n)),await o.done}catch(i){if(i instanceof Eh)Yf.warn(i.message);else{const o=Og.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});Yf.warn(o.message)}}}function pie(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v5e=1024,S5e=30;class b5e{constructor(e){this.container=e,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new T5e(i),this._heartbeatsCachePromise=this._storage.read().then(o=>(this._heartbeatsCache=o,o))}async triggerHeartbeat(){var e,i;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),u=tJ();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===u||this._heartbeatsCache.heartbeats.some(f=>f.date===u))return;if(this._heartbeatsCache.heartbeats.push({date:u,agent:l}),this._heartbeatsCache.heartbeats.length>S5e){const f=C5e(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(f,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(o){Yf.warn(o)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=tJ(),{heartbeatsToSend:o,unsentEntries:l}=w5e(this._heartbeatsCache.heartbeats),u=uk(JSON.stringify({version:2,heartbeats:o}));return this._heartbeatsCache.lastSentHeartbeatDate=i,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),u}catch(i){return Yf.warn(i),""}}}function tJ(){return new Date().toISOString().substring(0,10)}function w5e(n,e=v5e){const i=[];let o=n.slice();for(const l of n){const u=i.find(f=>f.agent===l.agent);if(u){if(u.dates.push(l.date),nJ(i)>e){u.dates.pop();break}}else if(i.push({agent:l.agent,dates:[l.date]}),nJ(i)>e){i.pop();break}o=o.slice(1)}return{heartbeatsToSend:i,unsentEntries:o}}class T5e{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return uVe()?dVe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await E5e(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return eJ(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return eJ(this.app,{lastSentHeartbeatDate:(i=e.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...e.heartbeats]})}else return}}function nJ(n){return uk(JSON.stringify({version:2,heartbeats:n})).length}function C5e(n){if(n.length===0)return-1;let e=0,i=n[0].date;for(let o=1;o<n.length;o++)n[o].date<i&&(i=n[o].date,e=o);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R5e(n){Mg(new qf("platform-logger",e=>new VVe(e),"PRIVATE")),Mg(new qf("heartbeat",e=>new b5e(e),"PRIVATE")),ud(e5,QX,n),ud(e5,QX,"esm2017"),ud("fire-js","")}R5e("");function fie(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const I5e=fie,mie=new BR("auth","Firebase",fie());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hk=new Sj("@firebase/auth");function A5e(n,...e){hk.logLevel<=Fr.WARN&&hk.warn(`Auth (${dE}): ${n}`,...e)}function xO(n,...e){hk.logLevel<=Fr.ERROR&&hk.error(`Auth (${dE}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _h(n,...e){throw wj(n,...e)}function xp(n,...e){return wj(n,...e)}function gie(n,e,i){const o=Object.assign(Object.assign({},I5e()),{[e]:i});return new BR("auth","Firebase",o).create(e,{appName:n.name})}function Bf(n){return gie(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function wj(n,...e){if(typeof n!="string"){const i=e[0],o=[...e.slice(1)];return o[0]&&(o[0].appName=n.name),n._errorFactory.create(i,...o)}return mie.create(n,...e)}function Qn(n,e,...i){if(!n)throw wj(e,...i)}function xf(n){const e="INTERNAL ASSERTION FAILED: "+n;throw xO(e),new Error(e)}function Xf(n,e){n||xf(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r5(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function P5e(){return rJ()==="http:"||rJ()==="https:"}function rJ(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O5e(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(P5e()||oVe()||"connection"in navigator)?navigator.onLine:!0}function k5e(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GR{constructor(e,i){this.shortDelay=e,this.longDelay=i,Xf(i>e,"Short delay should be less than long delay!"),this.isMobile=rVe()||aVe()}get(){return O5e()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tj(n,e){Xf(n.emulator,"Emulator should always be set here");const{url:i}=n.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _ie{static initialize(e,i,o){this.fetchImpl=e,i&&(this.headersImpl=i),o&&(this.responseImpl=o)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;xf("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;xf("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;xf("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N5e={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x5e=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],D5e=new GR(3e4,6e4);function nm(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function rm(n,e,i,o,l={}){return yie(n,l,async()=>{let u={},f={};o&&(e==="GET"?f=o:u={body:JSON.stringify(o)});const y=zR(Object.assign({key:n.config.apiKey},f)).slice(1),v=await n._getAdditionalHeaders();v["Content-Type"]="application/json",n.languageCode&&(v["X-Firebase-Locale"]=n.languageCode);const b=Object.assign({method:e,headers:v},u);return sVe()||(b.referrerPolicy="no-referrer"),n.emulatorConfig&&tm(n.emulatorConfig.host)&&(b.credentials="include"),_ie.fetch()(await Eie(n,n.config.apiHost,i,y),b)})}async function yie(n,e,i){n._canInitEmulator=!1;const o=Object.assign(Object.assign({},N5e),e);try{const l=new M5e(n),u=await Promise.race([i(),l.promise]);l.clearNetworkTimeout();const f=await u.json();if("needConfirmation"in f)throw nO(n,"account-exists-with-different-credential",f);if(u.ok&&!("errorMessage"in f))return f;{const y=u.ok?f.errorMessage:f.error.message,[v,b]=y.split(" : ");if(v==="FEDERATED_USER_ID_ALREADY_LINKED")throw nO(n,"credential-already-in-use",f);if(v==="EMAIL_EXISTS")throw nO(n,"email-already-in-use",f);if(v==="USER_DISABLED")throw nO(n,"user-disabled",f);const C=o[v]||v.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw gie(n,C,b);_h(n,C)}}catch(l){if(l instanceof Eh)throw l;_h(n,"network-request-failed",{message:String(l)})}}async function HR(n,e,i,o,l={}){const u=await rm(n,e,i,o,l);return"mfaPendingCredential"in u&&_h(n,"multi-factor-auth-required",{_serverResponse:u}),u}async function Eie(n,e,i,o){const l=`${e}${i}?${o}`,u=n,f=u.config.emulator?Tj(n.config,l):`${n.config.apiScheme}://${l}`;return x5e.includes(i)&&(await u._persistenceManagerAvailable,u._getPersistenceType()==="COOKIE")?u._getPersistence()._getFinalTarget(f).toString():f}function L5e(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class M5e{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((i,o)=>{this.timer=setTimeout(()=>o(xp(this.auth,"network-request-failed")),D5e.get())})}}function nO(n,e,i){const o={appName:n.name};i.email&&(o.email=i.email),i.phoneNumber&&(o.phoneNumber=i.phoneNumber);const l=xp(n,e,o);return l.customData._tokenResponse=i,l}function iJ(n){return n!==void 0&&n.enterprise!==void 0}class U5e{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===e)return L5e(i.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function V5e(n,e){return rm(n,"GET","/v2/recaptchaConfig",nm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function j5e(n,e){return rm(n,"POST","/v1/accounts:delete",e)}async function pk(n,e){return rm(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VC(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function F5e(n,e=!1){const i=Ui(n),o=await i.getIdToken(e),l=Cj(o);Qn(l&&l.exp&&l.auth_time&&l.iat,i.auth,"internal-error");const u=typeof l.firebase=="object"?l.firebase:void 0,f=u==null?void 0:u.sign_in_provider;return{claims:l,token:o,authTime:VC(GU(l.auth_time)),issuedAtTime:VC(GU(l.iat)),expirationTime:VC(GU(l.exp)),signInProvider:f||null,signInSecondFactor:(u==null?void 0:u.sign_in_second_factor)||null}}function GU(n){return Number(n)*1e3}function Cj(n){const[e,i,o]=n.split(".");if(e===void 0||i===void 0||o===void 0)return xO("JWT malformed, contained fewer than 3 sections"),null;try{const l=iie(i);return l?JSON.parse(l):(xO("Failed to decode base64 JWT payload"),null)}catch(l){return xO("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function sJ(n){const e=Cj(n);return Qn(e,"internal-error"),Qn(typeof e.exp<"u","internal-error"),Qn(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gR(n,e,i=!1){if(i)return e;try{return await e}catch(o){throw o instanceof Eh&&B5e(o)&&n.auth.currentUser===n&&await n.auth.signOut(),o}}function B5e({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z5e{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var i;if(e){const o=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),o}else{this.errorBackoff=3e4;const l=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(e=!1){if(!this.isRunning)return;const i=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i5{constructor(e,i){this.createdAt=e,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=VC(this.lastLoginAt),this.creationTime=VC(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fk(n){var e;const i=n.auth,o=await n.getIdToken(),l=await gR(n,pk(i,{idToken:o}));Qn(l==null?void 0:l.users.length,i,"internal-error");const u=l.users[0];n._notifyReloadListener(u);const f=!((e=u.providerUserInfo)===null||e===void 0)&&e.length?vie(u.providerUserInfo):[],y=G5e(n.providerData,f),v=n.isAnonymous,b=!(n.email&&u.passwordHash)&&!(y!=null&&y.length),C=v?b:!1,R={uid:u.localId,displayName:u.displayName||null,photoURL:u.photoUrl||null,email:u.email||null,emailVerified:u.emailVerified||!1,phoneNumber:u.phoneNumber||null,tenantId:u.tenantId||null,providerData:y,metadata:new i5(u.createdAt,u.lastLoginAt),isAnonymous:C};Object.assign(n,R)}async function W5e(n){const e=Ui(n);await fk(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function G5e(n,e){return[...n.filter(o=>!e.some(l=>l.providerId===o.providerId)),...e]}function vie(n){return n.map(e=>{var{providerId:i}=e,o=MR(e,["providerId"]);return{providerId:i,uid:o.rawId||"",displayName:o.displayName||null,email:o.email||null,phoneNumber:o.phoneNumber||null,photoURL:o.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function H5e(n,e){const i=await yie(n,{},async()=>{const o=zR({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:l,apiKey:u}=n.config,f=await Eie(n,l,"/v1/token",`key=${u}`),y=await n._getAdditionalHeaders();y["Content-Type"]="application/x-www-form-urlencoded";const v={method:"POST",headers:y,body:o};return n.emulatorConfig&&tm(n.emulatorConfig.host)&&(v.credentials="include"),_ie.fetch()(f,v)});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function $5e(n,e){return rm(n,"POST","/v2/accounts:revokeToken",nm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gS{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Qn(e.idToken,"internal-error"),Qn(typeof e.idToken<"u","internal-error"),Qn(typeof e.refreshToken<"u","internal-error");const i="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):sJ(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,i)}updateFromIdToken(e){Qn(e.length!==0,"internal-error");const i=sJ(e);this.updateTokensAndExpiration(e,null,i)}async getToken(e,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(Qn(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,i){const{accessToken:o,refreshToken:l,expiresIn:u}=await H5e(e,i);this.updateTokensAndExpiration(o,l,Number(u))}updateTokensAndExpiration(e,i,o){this.refreshToken=i||null,this.accessToken=e||null,this.expirationTime=Date.now()+o*1e3}static fromJSON(e,i){const{refreshToken:o,accessToken:l,expirationTime:u}=i,f=new gS;return o&&(Qn(typeof o=="string","internal-error",{appName:e}),f.refreshToken=o),l&&(Qn(typeof l=="string","internal-error",{appName:e}),f.accessToken=l),u&&(Qn(typeof u=="number","internal-error",{appName:e}),f.expirationTime=u),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new gS,this.toJSON())}_performRefresh(){return xf("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mg(n,e){Qn(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ph{constructor(e){var{uid:i,auth:o,stsTokenManager:l}=e,u=MR(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new z5e(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=o,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=u.displayName||null,this.email=u.email||null,this.emailVerified=u.emailVerified||!1,this.phoneNumber=u.phoneNumber||null,this.photoURL=u.photoURL||null,this.isAnonymous=u.isAnonymous||!1,this.tenantId=u.tenantId||null,this.providerData=u.providerData?[...u.providerData]:[],this.metadata=new i5(u.createdAt||void 0,u.lastLoginAt||void 0)}async getIdToken(e){const i=await gR(this,this.stsTokenManager.getToken(this.auth,e));return Qn(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(e){return F5e(this,e)}reload(){return W5e(this)}_assign(e){this!==e&&(Qn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(i=>Object.assign({},i)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const i=new ph(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return i.metadata._copy(this.metadata),i}_onReload(e){Qn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,i=!1){let o=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),o=!0),i&&await fk(this),await this.auth._persistUserIfCurrent(this),o&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(vl(this.auth.app))return Promise.reject(Bf(this.auth));const e=await this.getIdToken();return await gR(this,j5e(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,i){var o,l,u,f,y,v,b,C;const R=(o=i.displayName)!==null&&o!==void 0?o:void 0,O=(l=i.email)!==null&&l!==void 0?l:void 0,L=(u=i.phoneNumber)!==null&&u!==void 0?u:void 0,D=(f=i.photoURL)!==null&&f!==void 0?f:void 0,U=(y=i.tenantId)!==null&&y!==void 0?y:void 0,B=(v=i._redirectEventId)!==null&&v!==void 0?v:void 0,Y=(b=i.createdAt)!==null&&b!==void 0?b:void 0,W=(C=i.lastLoginAt)!==null&&C!==void 0?C:void 0,{uid:ne,emailVerified:le,isAnonymous:re,providerData:me,stsTokenManager:q}=i;Qn(ne&&q,e,"internal-error");const J=gS.fromJSON(this.name,q);Qn(typeof ne=="string",e,"internal-error"),mg(R,e.name),mg(O,e.name),Qn(typeof le=="boolean",e,"internal-error"),Qn(typeof re=="boolean",e,"internal-error"),mg(L,e.name),mg(D,e.name),mg(U,e.name),mg(B,e.name),mg(Y,e.name),mg(W,e.name);const Q=new ph({uid:ne,auth:e,email:O,emailVerified:le,displayName:R,isAnonymous:re,photoURL:D,phoneNumber:L,tenantId:U,stsTokenManager:J,createdAt:Y,lastLoginAt:W});return me&&Array.isArray(me)&&(Q.providerData=me.map(ie=>Object.assign({},ie))),B&&(Q._redirectEventId=B),Q}static async _fromIdTokenResponse(e,i,o=!1){const l=new gS;l.updateFromServerResponse(i);const u=new ph({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:o});return await fk(u),u}static async _fromGetAccountInfoResponse(e,i,o){const l=i.users[0];Qn(l.localId!==void 0,"internal-error");const u=l.providerUserInfo!==void 0?vie(l.providerUserInfo):[],f=!(l.email&&l.passwordHash)&&!(u!=null&&u.length),y=new gS;y.updateFromIdToken(o);const v=new ph({uid:l.localId,auth:e,stsTokenManager:y,isAnonymous:f}),b={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:u,metadata:new i5(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(u!=null&&u.length)};return Object.assign(v,b),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oJ=new Map;function Df(n){Xf(n instanceof Function,"Expected a class definition");let e=oJ.get(n);return e?(Xf(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,oJ.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sie{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,i){this.storage[e]=i}async _get(e){const i=this.storage[e];return i===void 0?null:i}async _remove(e){delete this.storage[e]}_addListener(e,i){}_removeListener(e,i){}}Sie.type="NONE";const aJ=Sie;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DO(n,e,i){return`firebase:${n}:${e}:${i}`}class _S{constructor(e,i,o){this.persistence=e,this.auth=i,this.userKey=o;const{config:l,name:u}=this.auth;this.fullUserKey=DO(this.userKey,l.apiKey,u),this.fullPersistenceKey=DO("persistence",l.apiKey,u),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const i=await pk(this.auth,{idToken:e}).catch(()=>{});return i?ph._fromGetAccountInfoResponse(this.auth,i,e):null}return ph._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,i,o="authUser"){if(!i.length)return new _S(Df(aJ),e,o);const l=(await Promise.all(i.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let u=l[0]||Df(aJ);const f=DO(o,e.config.apiKey,e.name);let y=null;for(const b of i)try{const C=await b._get(f);if(C){let R;if(typeof C=="string"){const O=await pk(e,{idToken:C}).catch(()=>{});if(!O)break;R=await ph._fromGetAccountInfoResponse(e,O,C)}else R=ph._fromJSON(e,C);b!==u&&(y=R),u=b;break}}catch{}const v=l.filter(b=>b._shouldAllowMigration);return!u._shouldAllowMigration||!v.length?new _S(u,e,o):(u=v[0],y&&await u._set(f,y.toJSON()),await Promise.all(i.map(async b=>{if(b!==u)try{await b._remove(f)}catch{}})),new _S(u,e,o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cJ(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Cie(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(bie(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Iie(e))return"Blackberry";if(Aie(e))return"Webos";if(wie(e))return"Safari";if((e.includes("chrome/")||Tie(e))&&!e.includes("edge/"))return"Chrome";if(Rie(e))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,o=n.match(i);if((o==null?void 0:o.length)===2)return o[1]}return"Other"}function bie(n=fc()){return/firefox\//i.test(n)}function wie(n=fc()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Tie(n=fc()){return/crios\//i.test(n)}function Cie(n=fc()){return/iemobile/i.test(n)}function Rie(n=fc()){return/android/i.test(n)}function Iie(n=fc()){return/blackberry/i.test(n)}function Aie(n=fc()){return/webos/i.test(n)}function Rj(n=fc()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function K5e(n=fc()){var e;return Rj(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function q5e(){return cVe()&&document.documentMode===10}function Pie(n=fc()){return Rj(n)||Rie(n)||Aie(n)||Iie(n)||/windows phone/i.test(n)||Cie(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oie(n,e=[]){let i;switch(n){case"Browser":i=cJ(fc());break;case"Worker":i=`${cJ(fc())}-${n}`;break;default:i=n}const o=e.length?e.join(","):"FirebaseCore-web";return`${i}/JsCore/${dE}/${o}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y5e{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,i){const o=u=>new Promise((f,y)=>{try{const v=e(u);f(v)}catch(v){y(v)}});o.onAbort=i,this.queue.push(o);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const i=[];try{for(const o of this.queue)await o(e),o.onAbort&&i.push(o.onAbort)}catch(o){i.reverse();for(const l of i)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:o==null?void 0:o.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function X5e(n,e={}){return rm(n,"GET","/v2/passwordPolicy",nm(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J5e=6;class Q5e{constructor(e){var i,o,l,u;const f=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(i=f.minPasswordLength)!==null&&i!==void 0?i:J5e,f.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=f.maxPasswordLength),f.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=f.containsLowercaseCharacter),f.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=f.containsUppercaseCharacter),f.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=f.containsNumericCharacter),f.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=f.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(o=e.allowedNonAlphanumericCharacters)===null||o===void 0?void 0:o.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(u=e.forceUpgradeOnSignin)!==null&&u!==void 0?u:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var i,o,l,u,f,y;const v={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,v),this.validatePasswordCharacterOptions(e,v),v.isValid&&(v.isValid=(i=v.meetsMinPasswordLength)!==null&&i!==void 0?i:!0),v.isValid&&(v.isValid=(o=v.meetsMaxPasswordLength)!==null&&o!==void 0?o:!0),v.isValid&&(v.isValid=(l=v.containsLowercaseLetter)!==null&&l!==void 0?l:!0),v.isValid&&(v.isValid=(u=v.containsUppercaseLetter)!==null&&u!==void 0?u:!0),v.isValid&&(v.isValid=(f=v.containsNumericCharacter)!==null&&f!==void 0?f:!0),v.isValid&&(v.isValid=(y=v.containsNonAlphanumericCharacter)!==null&&y!==void 0?y:!0),v}validatePasswordLengthOptions(e,i){const o=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;o&&(i.meetsMinPasswordLength=e.length>=o),l&&(i.meetsMaxPasswordLength=e.length<=l)}validatePasswordCharacterOptions(e,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let o;for(let l=0;l<e.length;l++)o=e.charAt(l),this.updatePasswordCharacterOptionsStatuses(i,o>="a"&&o<="z",o>="A"&&o<="Z",o>="0"&&o<="9",this.allowedNonAlphanumericCharacters.includes(o))}updatePasswordCharacterOptionsStatuses(e,i,o,l,u){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=o)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z5e{constructor(e,i,o,l){this.app=e,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=o,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new lJ(this),this.idTokenSubscription=new lJ(this),this.beforeStateQueue=new Y5e(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=mie,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=l.sdkClientVersion,this._persistenceManagerAvailable=new Promise(u=>this._resolvePersistenceManagerAvailable=u)}_initializeWithPersistence(e,i){return i&&(this._popupRedirectResolver=Df(i)),this._initializationPromise=this.queue(async()=>{var o,l,u;if(!this._deleted&&(this.persistenceManager=await _S.create(this,e),(o=this._resolvePersistenceManagerAvailable)===null||o===void 0||o.call(this),!this._deleted)){if(!((l=this._popupRedirectResolver)===null||l===void 0)&&l._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((u=this.currentUser)===null||u===void 0?void 0:u.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const i=await pk(this,{idToken:e}),o=await ph._fromGetAccountInfoResponse(this,i,e);await this.directlySetCurrentUser(o)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(vl(this.app)){const f=this.app.settings.authIdToken;return f?new Promise(y=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(f).then(y,y))}):this.directlySetCurrentUser(null)}const o=await this.assertedPersistence.getCurrentUser();let l=o,u=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const f=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,y=l==null?void 0:l._redirectEventId,v=await this.tryRedirectSignIn(e);(!f||f===y)&&(v!=null&&v.user)&&(l=v.user,u=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(u)try{await this.beforeStateQueue.runMiddleware(l)}catch(f){l=o,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(f))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Qn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(e){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(e){try{await fk(e)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=k5e()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(vl(this.app))return Promise.reject(Bf(this));const i=e?Ui(e):null;return i&&Qn(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(e,i=!1){if(!this._deleted)return e&&Qn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return vl(this.app)?Promise.reject(Bf(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return vl(this.app)?Promise.reject(Bf(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Df(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await X5e(this),i=new Q5e(e);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new BR("auth","Firebase",e())}onAuthStateChanged(e,i,o){return this.registerStateListener(this.authStateSubscription,e,i,o)}beforeAuthStateChanged(e,i){return this.beforeStateQueue.pushCallback(e,i)}onIdTokenChanged(e,i,o){return this.registerStateListener(this.idTokenSubscription,e,i,o)}authStateReady(){return new Promise((e,i)=>{if(this.currentUser)e();else{const o=this.onAuthStateChanged(()=>{o(),e()},i)}})}async revokeAccessToken(e){if(this.currentUser){const i=await this.currentUser.getIdToken(),o={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:i};this.tenantId!=null&&(o.tenantId=this.tenantId),await $5e(this,o)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,i){const o=await this.getOrInitRedirectPersistenceManager(i);return e===null?o.removeCurrentUser():o.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const i=e&&Df(e)||this._popupRedirectResolver;Qn(i,this,"argument-error"),this.redirectPersistenceManager=await _S.create(this,[Df(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var i,o;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===e?this._currentUser:((o=this.redirectUser)===null||o===void 0?void 0:o._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const o=(i=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==o&&(this.lastNotifiedUid=o,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,i,o,l){if(this._deleted)return()=>{};const u=typeof i=="function"?i:i.next.bind(i);let f=!1;const y=this._isInitialized?Promise.resolve():this._initializationPromise;if(Qn(y,this,"internal-error"),y.then(()=>{f||u(this.currentUser)}),typeof i=="function"){const v=e.addObserver(i,o,l);return()=>{f=!0,v()}}else{const v=e.addObserver(i);return()=>{f=!0,v()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Qn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Oie(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const o=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());o&&(i["X-Firebase-Client"]=o);const l=await this._getAppCheckToken();return l&&(i["X-Firebase-AppCheck"]=l),i}async _getAppCheckToken(){var e;if(vl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return i!=null&&i.error&&A5e(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function qg(n){return Ui(n)}class lJ{constructor(e){this.auth=e,this.observer=null,this.addObserver=gVe(i=>this.observer=i)}get next(){return Qn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _N={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function e3e(n){_N=n}function kie(n){return _N.loadJS(n)}function t3e(){return _N.recaptchaEnterpriseScript}function n3e(){return _N.gapiScript}function r3e(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class i3e{constructor(){this.enterprise=new s3e}ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}class s3e{ready(e){e()}execute(e,i){return Promise.resolve("token")}render(e,i){return""}}const o3e="recaptcha-enterprise",Nie="NO_RECAPTCHA";class a3e{constructor(e){this.type=o3e,this.auth=qg(e)}async verify(e="verify",i=!1){async function o(u){if(!i){if(u.tenantId==null&&u._agentRecaptchaConfig!=null)return u._agentRecaptchaConfig.siteKey;if(u.tenantId!=null&&u._tenantRecaptchaConfigs[u.tenantId]!==void 0)return u._tenantRecaptchaConfigs[u.tenantId].siteKey}return new Promise(async(f,y)=>{V5e(u,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(v=>{if(v.recaptchaKey===void 0)y(new Error("recaptcha Enterprise site key undefined"));else{const b=new U5e(v);return u.tenantId==null?u._agentRecaptchaConfig=b:u._tenantRecaptchaConfigs[u.tenantId]=b,f(b.siteKey)}}).catch(v=>{y(v)})})}function l(u,f,y){const v=window.grecaptcha;iJ(v)?v.enterprise.ready(()=>{v.enterprise.execute(u,{action:e}).then(b=>{f(b)}).catch(()=>{f(Nie)})}):y(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new i3e().execute("siteKey",{action:"verify"}):new Promise((u,f)=>{o(this.auth).then(y=>{if(!i&&iJ(window.grecaptcha))l(y,u,f);else{if(typeof window>"u"){f(new Error("RecaptchaVerifier is only supported in browser"));return}let v=t3e();v.length!==0&&(v+=y),kie(v).then(()=>{l(y,u,f)}).catch(b=>{f(b)})}}).catch(y=>{f(y)})})}}async function uJ(n,e,i,o=!1,l=!1){const u=new a3e(n);let f;if(l)f=Nie;else try{f=await u.verify(i)}catch{f=await u.verify(i,!0)}const y=Object.assign({},e);if(i==="mfaSmsEnrollment"||i==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in y){const v=y.phoneEnrollmentInfo.phoneNumber,b=y.phoneEnrollmentInfo.recaptchaToken;Object.assign(y,{phoneEnrollmentInfo:{phoneNumber:v,recaptchaToken:b,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in y){const v=y.phoneSignInInfo.recaptchaToken;Object.assign(y,{phoneSignInInfo:{recaptchaToken:v,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return y}return o?Object.assign(y,{captchaResp:f}):Object.assign(y,{captchaResponse:f}),Object.assign(y,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(y,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),y}async function mk(n,e,i,o,l){var u;if(!((u=n._getRecaptchaConfig())===null||u===void 0)&&u.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const f=await uJ(n,e,i,i==="getOobCode");return o(n,f)}else return o(n,e).catch(async f=>{if(f.code==="auth/missing-recaptcha-token"){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const y=await uJ(n,e,i,i==="getOobCode");return o(n,y)}else return Promise.reject(f)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c3e(n,e){const i=WR(n,"auth");if(i.isInitialized()){const l=i.getImmediate(),u=i.getOptions();if(Kf(u,e??{}))return l;_h(l,"already-initialized")}return i.initialize({options:e})}function l3e(n,e){const i=(e==null?void 0:e.persistence)||[],o=(Array.isArray(i)?i:[i]).map(Df);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(o,e==null?void 0:e.popupRedirectResolver)}function u3e(n,e,i){const o=qg(n);Qn(/^https?:\/\//.test(e),o,"invalid-emulator-scheme");const l=!1,u=xie(e),{host:f,port:y}=d3e(e),v=y===null?"":`:${y}`,b={url:`${u}//${f}${v}/`},C=Object.freeze({host:f,port:y,protocol:u.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!o._canInitEmulator){Qn(o.config.emulator&&o.emulatorConfig,o,"emulator-config-failed"),Qn(Kf(b,o.config.emulator)&&Kf(C,o.emulatorConfig),o,"emulator-config-failed");return}o.config.emulator=b,o.emulatorConfig=C,o.settings.appVerificationDisabledForTesting=!0,tm(f)?(fN(`${u}//${f}${v}`),mN("Auth",!0)):h3e()}function xie(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function d3e(n){const e=xie(n),i=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!i)return{host:"",port:null};const o=i[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(o);if(l){const u=l[1];return{host:u,port:dJ(o.substr(u.length+1))}}else{const[u,f]=o.split(":");return{host:u,port:dJ(f)}}}function dJ(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function h3e(){function n(){const e=document.createElement("p"),i=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ij{constructor(e,i){this.providerId=e,this.signInMethod=i}toJSON(){return xf("not implemented")}_getIdTokenResponse(e){return xf("not implemented")}_linkToIdToken(e,i){return xf("not implemented")}_getReauthenticationResolver(e){return xf("not implemented")}}async function p3e(n,e){return rm(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f3e(n,e){return HR(n,"POST","/v1/accounts:signInWithPassword",nm(n,e))}async function Die(n,e){return rm(n,"POST","/v1/accounts:sendOobCode",nm(n,e))}async function m3e(n,e){return Die(n,e)}async function g3e(n,e){return Die(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _3e(n,e){return HR(n,"POST","/v1/accounts:signInWithEmailLink",nm(n,e))}async function y3e(n,e){return HR(n,"POST","/v1/accounts:signInWithEmailLink",nm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _R extends Ij{constructor(e,i,o,l=null){super("password",o),this._email=e,this._password=i,this._tenantId=l}static _fromEmailAndPassword(e,i){return new _R(e,i,"password")}static _fromEmailAndCode(e,i,o=null){return new _R(e,i,"emailLink",o)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const i={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return mk(e,i,"signInWithPassword",f3e);case"emailLink":return _3e(e,{email:this._email,oobCode:this._password});default:_h(e,"internal-error")}}async _linkToIdToken(e,i){switch(this.signInMethod){case"password":const o={idToken:i,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return mk(e,o,"signUpPassword",p3e);case"emailLink":return y3e(e,{idToken:i,email:this._email,oobCode:this._password});default:_h(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yS(n,e){return HR(n,"POST","/v1/accounts:signInWithIdp",nm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E3e="http://localhost";class rE extends Ij{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const i=new rE(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(i.idToken=e.idToken),e.accessToken&&(i.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(i.nonce=e.nonce),e.pendingToken&&(i.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(i.accessToken=e.oauthToken,i.secret=e.oauthTokenSecret):_h("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const i=typeof e=="string"?JSON.parse(e):e,{providerId:o,signInMethod:l}=i,u=MR(i,["providerId","signInMethod"]);if(!o||!l)return null;const f=new rE(o,l);return f.idToken=u.idToken||void 0,f.accessToken=u.accessToken||void 0,f.secret=u.secret,f.nonce=u.nonce,f.pendingToken=u.pendingToken||null,f}_getIdTokenResponse(e){const i=this.buildRequest();return yS(e,i)}_linkToIdToken(e,i){const o=this.buildRequest();return o.idToken=i,yS(e,o)}_getReauthenticationResolver(e){const i=this.buildRequest();return i.autoCreate=!1,yS(e,i)}buildRequest(){const e={requestUri:E3e,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),e.postBody=zR(i)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v3e(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function S3e(n){const e=mC(gC(n)).link,i=e?mC(gC(e)).deep_link_id:null,o=mC(gC(n)).deep_link_id;return(o?mC(gC(o)).link:null)||o||i||e||n}class Aj{constructor(e){var i,o,l,u,f,y;const v=mC(gC(e)),b=(i=v.apiKey)!==null&&i!==void 0?i:null,C=(o=v.oobCode)!==null&&o!==void 0?o:null,R=v3e((l=v.mode)!==null&&l!==void 0?l:null);Qn(b&&C&&R,"argument-error"),this.apiKey=b,this.operation=R,this.code=C,this.continueUrl=(u=v.continueUrl)!==null&&u!==void 0?u:null,this.languageCode=(f=v.lang)!==null&&f!==void 0?f:null,this.tenantId=(y=v.tenantId)!==null&&y!==void 0?y:null}static parseLink(e){const i=S3e(e);try{return new Aj(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eb{constructor(){this.providerId=eb.PROVIDER_ID}static credential(e,i){return _R._fromEmailAndPassword(e,i)}static credentialWithLink(e,i){const o=Aj.parseLink(i);return Qn(o,"argument-error"),_R._fromEmailAndCode(e,o.code,o.tenantId)}}eb.PROVIDER_ID="password";eb.EMAIL_PASSWORD_SIGN_IN_METHOD="password";eb.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lie{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $R extends Lie{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg extends $R{constructor(){super("facebook.com")}static credential(e){return rE._fromParams({providerId:vg.PROVIDER_ID,signInMethod:vg.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return vg.credentialFromTaggedObject(e)}static credentialFromError(e){return vg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return vg.credential(e.oauthAccessToken)}catch{return null}}}vg.FACEBOOK_SIGN_IN_METHOD="facebook.com";vg.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sg extends $R{constructor(){super("google.com"),this.addScope("profile")}static credential(e,i){return rE._fromParams({providerId:Sg.PROVIDER_ID,signInMethod:Sg.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:i})}static credentialFromResult(e){return Sg.credentialFromTaggedObject(e)}static credentialFromError(e){return Sg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:i,oauthAccessToken:o}=e;if(!i&&!o)return null;try{return Sg.credential(i,o)}catch{return null}}}Sg.GOOGLE_SIGN_IN_METHOD="google.com";Sg.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bg extends $R{constructor(){super("github.com")}static credential(e){return rE._fromParams({providerId:bg.PROVIDER_ID,signInMethod:bg.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return bg.credentialFromTaggedObject(e)}static credentialFromError(e){return bg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return bg.credential(e.oauthAccessToken)}catch{return null}}}bg.GITHUB_SIGN_IN_METHOD="github.com";bg.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wg extends $R{constructor(){super("twitter.com")}static credential(e,i){return rE._fromParams({providerId:wg.PROVIDER_ID,signInMethod:wg.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:i})}static credentialFromResult(e){return wg.credentialFromTaggedObject(e)}static credentialFromError(e){return wg.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:i,oauthTokenSecret:o}=e;if(!i||!o)return null;try{return wg.credential(i,o)}catch{return null}}}wg.TWITTER_SIGN_IN_METHOD="twitter.com";wg.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function b3e(n,e){return HR(n,"POST","/v1/accounts:signUp",nm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iE{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,i,o,l=!1){const u=await ph._fromIdTokenResponse(e,o,l),f=hJ(o);return new iE({user:u,providerId:f,_tokenResponse:o,operationType:i})}static async _forOperation(e,i,o){await e._updateTokensIfNecessary(o,!0);const l=hJ(o);return new iE({user:e,providerId:l,_tokenResponse:o,operationType:i})}}function hJ(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gk extends Eh{constructor(e,i,o,l){var u;super(i.code,i.message),this.operationType=o,this.user=l,Object.setPrototypeOf(this,gk.prototype),this.customData={appName:e.name,tenantId:(u=e.tenantId)!==null&&u!==void 0?u:void 0,_serverResponse:i.customData._serverResponse,operationType:o}}static _fromErrorAndOperation(e,i,o,l){return new gk(e,i,o,l)}}function Mie(n,e,i,o){return(e==="reauthenticate"?i._getReauthenticationResolver(n):i._getIdTokenResponse(n)).catch(u=>{throw u.code==="auth/multi-factor-auth-required"?gk._fromErrorAndOperation(n,u,e,o):u})}async function w3e(n,e,i=!1){const o=await gR(n,e._linkToIdToken(n.auth,await n.getIdToken()),i);return iE._forOperation(n,"link",o)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T3e(n,e,i=!1){const{auth:o}=n;if(vl(o.app))return Promise.reject(Bf(o));const l="reauthenticate";try{const u=await gR(n,Mie(o,l,e,n),i);Qn(u.idToken,o,"internal-error");const f=Cj(u.idToken);Qn(f,o,"internal-error");const{sub:y}=f;return Qn(n.uid===y,o,"user-mismatch"),iE._forOperation(n,l,u)}catch(u){throw(u==null?void 0:u.code)==="auth/user-not-found"&&_h(o,"user-mismatch"),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Uie(n,e,i=!1){if(vl(n.app))return Promise.reject(Bf(n));const o="signIn",l=await Mie(n,o,e),u=await iE._fromIdTokenResponse(n,o,l);return i||await n._updateCurrentUser(u.user),u}async function C3e(n,e){return Uie(qg(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vie(n){const e=qg(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function R3e(n,e,i){const o=qg(n);await mk(o,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",g3e)}async function I3e(n,e,i){if(vl(n.app))return Promise.reject(Bf(n));const o=qg(n),f=await mk(o,{returnSecureToken:!0,email:e,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",b3e).catch(v=>{throw v.code==="auth/password-does-not-meet-requirements"&&Vie(n),v}),y=await iE._fromIdTokenResponse(o,"signIn",f);return await o._updateCurrentUser(y.user),y}function A3e(n,e,i){return vl(n.app)?Promise.reject(Bf(n)):C3e(Ui(n),eb.credential(e,i)).catch(async o=>{throw o.code==="auth/password-does-not-meet-requirements"&&Vie(n),o})}async function jie(n,e){const i=Ui(n),l={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:u}=await m3e(i.auth,l);u!==n.email&&await n.reload()}function P3e(n,e,i,o){return Ui(n).onIdTokenChanged(e,i,o)}function O3e(n,e,i){return Ui(n).beforeAuthStateChanged(e,i)}function k3e(n,e,i,o){return Ui(n).onAuthStateChanged(e,i,o)}function N3e(n){return Ui(n).signOut()}const _k="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fie{constructor(e,i){this.storageRetriever=e,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(_k,"1"),this.storage.removeItem(_k),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,i){return this.storage.setItem(e,JSON.stringify(i)),Promise.resolve()}_get(e){const i=this.storage.getItem(e);return Promise.resolve(i?JSON.parse(i):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x3e=1e3,D3e=10;class Bie extends Fie{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,i)=>this.onStorageEvent(e,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Pie(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const i of Object.keys(this.listeners)){const o=this.storage.getItem(i),l=this.localCache[i];o!==l&&e(i,l,o)}}onStorageEvent(e,i=!1){if(!e.key){this.forAllChangedKeys((f,y,v)=>{this.notifyListeners(f,v)});return}const o=e.key;i?this.detachListener():this.stopPolling();const l=()=>{const f=this.storage.getItem(o);!i&&this.localCache[o]===f||this.notifyListeners(o,f)},u=this.storage.getItem(o);q5e()&&u!==e.newValue&&e.newValue!==e.oldValue?setTimeout(l,D3e):l()}notifyListeners(e,i){this.localCache[e]=i;const o=this.listeners[e];if(o)for(const l of Array.from(o))l(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,i,o)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:i,newValue:o}),!0)})},x3e)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,i){await super._set(e,i),this.localCache[e]=JSON.stringify(i)}async _get(e){const i=await super._get(e);return this.localCache[e]=JSON.stringify(i),i}async _remove(e){await super._remove(e),delete this.localCache[e]}}Bie.type="LOCAL";const L3e=Bie;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zie extends Fie{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,i){}_removeListener(e,i){}}zie.type="SESSION";const Wie=zie;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M3e(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yN{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const i=this.receivers.find(l=>l.isListeningto(e));if(i)return i;const o=new yN(e);return this.receivers.push(o),o}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const i=e,{eventId:o,eventType:l,data:u}=i.data,f=this.handlersMap[l];if(!(f!=null&&f.size))return;i.ports[0].postMessage({status:"ack",eventId:o,eventType:l});const y=Array.from(f).map(async b=>b(i.origin,u)),v=await M3e(y);i.ports[0].postMessage({status:"done",eventId:o,eventType:l,response:v})}_subscribe(e,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(i)}_unsubscribe(e,i){this.handlersMap[e]&&i&&this.handlersMap[e].delete(i),(!i||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}yN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pj(n="",e=10){let i="";for(let o=0;o<e;o++)i+=Math.floor(Math.random()*10);return n+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U3e{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,i,o=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let u,f;return new Promise((y,v)=>{const b=Pj("",20);l.port1.start();const C=setTimeout(()=>{v(new Error("unsupported_event"))},o);f={messageChannel:l,onMessage(R){const O=R;if(O.data.eventId===b)switch(O.data.status){case"ack":clearTimeout(C),u=setTimeout(()=>{v(new Error("timeout"))},3e3);break;case"done":clearTimeout(u),y(O.data.response);break;default:clearTimeout(C),clearTimeout(u),v(new Error("invalid_response"));break}}},this.handlers.add(f),l.port1.addEventListener("message",f.onMessage),this.target.postMessage({eventType:e,eventId:b,data:i},[l.port2])}).finally(()=>{f&&this.removeMessageHandler(f)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dp(){return window}function V3e(n){Dp().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gie(){return typeof Dp().WorkerGlobalScope<"u"&&typeof Dp().importScripts=="function"}async function j3e(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function F3e(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function B3e(){return Gie()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hie="firebaseLocalStorageDb",z3e=1,yk="firebaseLocalStorage",$ie="fbase_key";class KR{constructor(e){this.request=e}toPromise(){return new Promise((e,i)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function EN(n,e){return n.transaction([yk],e?"readwrite":"readonly").objectStore(yk)}function W3e(){const n=indexedDB.deleteDatabase(Hie);return new KR(n).toPromise()}function s5(){const n=indexedDB.open(Hie,z3e);return new Promise((e,i)=>{n.addEventListener("error",()=>{i(n.error)}),n.addEventListener("upgradeneeded",()=>{const o=n.result;try{o.createObjectStore(yk,{keyPath:$ie})}catch(l){i(l)}}),n.addEventListener("success",async()=>{const o=n.result;o.objectStoreNames.contains(yk)?e(o):(o.close(),await W3e(),e(await s5()))})})}async function pJ(n,e,i){const o=EN(n,!0).put({[$ie]:e,value:i});return new KR(o).toPromise()}async function G3e(n,e){const i=EN(n,!1).get(e),o=await new KR(i).toPromise();return o===void 0?null:o.value}function fJ(n,e){const i=EN(n,!0).delete(e);return new KR(i).toPromise()}const H3e=800,$3e=3;class Kie{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await s5(),this.db)}async _withRetries(e){let i=0;for(;;)try{const o=await this._openDb();return await e(o)}catch(o){if(i++>$3e)throw o;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Gie()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=yN._getInstance(B3e()),this.receiver._subscribe("keyChanged",async(e,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(e,i)=>["keyChanged"])}async initializeSender(){var e,i;if(this.activeServiceWorker=await j3e(),!this.activeServiceWorker)return;this.sender=new U3e(this.activeServiceWorker);const o=await this.sender._send("ping",{},800);o&&!((e=o[0])===null||e===void 0)&&e.fulfilled&&!((i=o[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||F3e()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await s5();return await pJ(e,_k,"1"),await fJ(e,_k),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,i){return this._withPendingWrite(async()=>(await this._withRetries(o=>pJ(o,e,i)),this.localCache[e]=i,this.notifyServiceWorker(e)))}async _get(e){const i=await this._withRetries(o=>G3e(o,e));return this.localCache[e]=i,i}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(i=>fJ(i,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(l=>{const u=EN(l,!1).getAll();return new KR(u).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const i=[],o=new Set;if(e.length!==0)for(const{fbase_key:l,value:u}of e)o.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(u)&&(this.notifyListeners(l,u),i.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!o.has(l)&&(this.notifyListeners(l,null),i.push(l));return i}notifyListeners(e,i){this.localCache[e]=i;const o=this.listeners[e];if(o)for(const l of Array.from(o))l(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),H3e)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(i)}_removeListener(e,i){this.listeners[e]&&(this.listeners[e].delete(i),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Kie.type="LOCAL";const K3e=Kie;new GR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q3e(n,e){return e?Df(e):(Qn(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oj extends Ij{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return yS(e,this._buildIdpRequest())}_linkToIdToken(e,i){return yS(e,this._buildIdpRequest(i))}_getReauthenticationResolver(e){return yS(e,this._buildIdpRequest())}_buildIdpRequest(e){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(i.idToken=e),i}}function Y3e(n){return Uie(n.auth,new Oj(n),n.bypassAuthState)}function X3e(n){const{auth:e,user:i}=n;return Qn(i,e,"internal-error"),T3e(i,new Oj(n),n.bypassAuthState)}async function J3e(n){const{auth:e,user:i}=n;return Qn(i,e,"internal-error"),w3e(i,new Oj(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qie{constructor(e,i,o,l,u=!1){this.auth=e,this.resolver=o,this.user=l,this.bypassAuthState=u,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(e,i)=>{this.pendingPromise={resolve:e,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(o){this.reject(o)}})}async onAuthEvent(e){const{urlResponse:i,sessionId:o,postBody:l,tenantId:u,error:f,type:y}=e;if(f){this.reject(f);return}const v={auth:this.auth,requestUri:i,sessionId:o,tenantId:u||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(y)(v))}catch(b){this.reject(b)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Y3e;case"linkViaPopup":case"linkViaRedirect":return J3e;case"reauthViaPopup":case"reauthViaRedirect":return X3e;default:_h(this.auth,"internal-error")}}resolve(e){Xf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Xf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q3e=new GR(2e3,1e4);class J0 extends qie{constructor(e,i,o,l,u){super(e,i,l,u),this.provider=o,this.authWindow=null,this.pollId=null,J0.currentPopupAction&&J0.currentPopupAction.cancel(),J0.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Qn(e,this.auth,"internal-error"),e}async onExecution(){Xf(this.filter.length===1,"Popup operations only handle one event");const e=Pj();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(xp(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(xp(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,J0.currentPopupAction=null}pollUserCancellation(){const e=()=>{var i,o;if(!((o=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||o===void 0)&&o.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(xp(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Q3e.get())};e()}}J0.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z3e="pendingRedirect",LO=new Map;class eje extends qie{constructor(e,i,o=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,o),this.eventId=null}async execute(){let e=LO.get(this.auth._key());if(!e){try{const o=await tje(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(o)}catch(i){e=()=>Promise.reject(i)}LO.set(this.auth._key(),e)}return this.bypassAuthState||LO.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const i=await this.auth._redirectUserForId(e.eventId);if(i)return this.user=i,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function tje(n,e){const i=ije(e),o=rje(n);if(!await o._isAvailable())return!1;const l=await o._get(i)==="true";return await o._remove(i),l}function nje(n,e){LO.set(n._key(),e)}function rje(n){return Df(n._redirectPersistence)}function ije(n){return DO(Z3e,n.config.apiKey,n.name)}async function sje(n,e,i=!1){if(vl(n.app))return Promise.reject(Bf(n));const o=qg(n),l=q3e(o,e),f=await new eje(o,l,i).execute();return f&&!i&&(delete f.user._redirectEventId,await o._persistUserIfCurrent(f.user),await o._setRedirectUser(null,e)),f}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oje=600*1e3;class aje{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let i=!1;return this.consumers.forEach(o=>{this.isEventForConsumer(e,o)&&(i=!0,this.sendToConsumer(e,o),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!cje(e)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=e,i=!0)),i}sendToConsumer(e,i){var o;if(e.error&&!Yie(e)){const l=((o=e.error.code)===null||o===void 0?void 0:o.split("auth/")[1])||"internal-error";i.onError(xp(this.auth,l))}else i.onAuthEvent(e)}isEventForConsumer(e,i){const o=i.eventId===null||!!e.eventId&&e.eventId===i.eventId;return i.filter.includes(e.type)&&o}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=oje&&this.cachedEventUids.clear(),this.cachedEventUids.has(mJ(e))}saveEventToCache(e){this.cachedEventUids.add(mJ(e)),this.lastProcessedEventTime=Date.now()}}function mJ(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Yie({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function cje(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Yie(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lje(n,e={}){return rm(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uje=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,dje=/^https?/;async function hje(n){if(n.config.emulator)return;const{authorizedDomains:e}=await lje(n);for(const i of e)try{if(pje(i))return}catch{}_h(n,"unauthorized-domain")}function pje(n){const e=r5(),{protocol:i,hostname:o}=new URL(e);if(n.startsWith("chrome-extension://")){const f=new URL(n);return f.hostname===""&&o===""?i==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):i==="chrome-extension:"&&f.hostname===o}if(!dje.test(i))return!1;if(uje.test(n))return o===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(o)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fje=new GR(3e4,6e4);function gJ(){const n=Dp().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let i=0;i<n.CP.length;i++)n.CP[i]=null}}function mje(n){return new Promise((e,i)=>{var o,l,u;function f(){gJ(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{gJ(),i(xp(n,"network-request-failed"))},timeout:fje.get()})}if(!((l=(o=Dp().gapi)===null||o===void 0?void 0:o.iframes)===null||l===void 0)&&l.Iframe)e(gapi.iframes.getContext());else if(!((u=Dp().gapi)===null||u===void 0)&&u.load)f();else{const y=r3e("iframefcb");return Dp()[y]=()=>{gapi.load?f():i(xp(n,"network-request-failed"))},kie(`${n3e()}?onload=${y}`).catch(v=>i(v))}}).catch(e=>{throw MO=null,e})}let MO=null;function gje(n){return MO=MO||mje(n),MO}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _je=new GR(5e3,15e3),yje="__/auth/iframe",Eje="emulator/auth/iframe",vje={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Sje=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function bje(n){const e=n.config;Qn(e.authDomain,n,"auth-domain-config-required");const i=e.emulator?Tj(e,Eje):`https://${n.config.authDomain}/${yje}`,o={apiKey:e.apiKey,appName:n.name,v:dE},l=Sje.get(n.config.apiHost);l&&(o.eid=l);const u=n._getFrameworks();return u.length&&(o.fw=u.join(",")),`${i}?${zR(o).slice(1)}`}async function wje(n){const e=await gje(n),i=Dp().gapi;return Qn(i,n,"internal-error"),e.open({where:document.body,url:bje(n),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:vje,dontclear:!0},o=>new Promise(async(l,u)=>{await o.restyle({setHideOnLeave:!1});const f=xp(n,"network-request-failed"),y=Dp().setTimeout(()=>{u(f)},_je.get());function v(){Dp().clearTimeout(y),l(o)}o.ping(v).then(v,()=>{u(f)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tje={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Cje=500,Rje=600,Ije="_blank",Aje="http://localhost";class _J{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Pje(n,e,i,o=Cje,l=Rje){const u=Math.max((window.screen.availHeight-l)/2,0).toString(),f=Math.max((window.screen.availWidth-o)/2,0).toString();let y="";const v=Object.assign(Object.assign({},Tje),{width:o.toString(),height:l.toString(),top:u,left:f}),b=fc().toLowerCase();i&&(y=Tie(b)?Ije:i),bie(b)&&(e=e||Aje,v.scrollbars="yes");const C=Object.entries(v).reduce((O,[L,D])=>`${O}${L}=${D},`,"");if(K5e(b)&&y!=="_self")return Oje(e||"",y),new _J(null);const R=window.open(e||"",y,C);Qn(R,n,"popup-blocked");try{R.focus()}catch{}return new _J(R)}function Oje(n,e){const i=document.createElement("a");i.href=n,i.target=e;const o=document.createEvent("MouseEvent");o.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(o)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kje="__/auth/handler",Nje="emulator/auth/handler",xje=encodeURIComponent("fac");async function yJ(n,e,i,o,l,u){Qn(n.config.authDomain,n,"auth-domain-config-required"),Qn(n.config.apiKey,n,"invalid-api-key");const f={apiKey:n.config.apiKey,appName:n.name,authType:i,redirectUrl:o,v:dE,eventId:l};if(e instanceof Lie){e.setDefaultLanguage(n.languageCode),f.providerId=e.providerId||"",mVe(e.getCustomParameters())||(f.customParameters=JSON.stringify(e.getCustomParameters()));for(const[C,R]of Object.entries({}))f[C]=R}if(e instanceof $R){const C=e.getScopes().filter(R=>R!=="");C.length>0&&(f.scopes=C.join(","))}n.tenantId&&(f.tid=n.tenantId);const y=f;for(const C of Object.keys(y))y[C]===void 0&&delete y[C];const v=await n._getAppCheckToken(),b=v?`#${xje}=${encodeURIComponent(v)}`:"";return`${Dje(n)}?${zR(y).slice(1)}${b}`}function Dje({config:n}){return n.emulator?Tj(n,Nje):`https://${n.authDomain}/${kje}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HU="webStorageSupport";class Lje{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Wie,this._completeRedirectFn=sje,this._overrideRedirectResult=nje}async _openPopup(e,i,o,l){var u;Xf((u=this.eventManagers[e._key()])===null||u===void 0?void 0:u.manager,"_initialize() not called before _openPopup()");const f=await yJ(e,i,o,r5(),l);return Pje(e,f,Pj())}async _openRedirect(e,i,o,l){await this._originValidation(e);const u=await yJ(e,i,o,r5(),l);return V3e(u),new Promise(()=>{})}_initialize(e){const i=e._key();if(this.eventManagers[i]){const{manager:l,promise:u}=this.eventManagers[i];return l?Promise.resolve(l):(Xf(u,"If manager is not set, promise should be"),u)}const o=this.initAndGetManager(e);return this.eventManagers[i]={promise:o},o.catch(()=>{delete this.eventManagers[i]}),o}async initAndGetManager(e){const i=await wje(e),o=new aje(e);return i.register("authEvent",l=>(Qn(l==null?void 0:l.authEvent,e,"invalid-auth-event"),{status:o.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:o},this.iframes[e._key()]=i,o}_isIframeWebStorageSupported(e,i){this.iframes[e._key()].send(HU,{type:HU},l=>{var u;const f=(u=l==null?void 0:l[0])===null||u===void 0?void 0:u[HU];f!==void 0&&i(!!f),_h(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const i=e._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=hje(e)),this.originValidationPromises[i]}get _shouldInitProactively(){return Pie()||wie()||Rj()}}const Mje=Lje;var EJ="@firebase/auth",vJ="1.10.8";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uje{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const i=this.auth.onIdTokenChanged(o=>{e((o==null?void 0:o.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,i),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const i=this.internalListeners.get(e);i&&(this.internalListeners.delete(e),i(),this.updateProactiveRefresh())}assertAuthConfigured(){Qn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vje(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function jje(n){Mg(new qf("auth",(e,{options:i})=>{const o=e.getProvider("app").getImmediate(),l=e.getProvider("heartbeat"),u=e.getProvider("app-check-internal"),{apiKey:f,authDomain:y}=o.options;Qn(f&&!f.includes(":"),"invalid-api-key",{appName:o.name});const v={apiKey:f,authDomain:y,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Oie(n)},b=new Z5e(o,l,u,v);return l3e(b,i),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,i,o)=>{e.getProvider("auth-internal").initialize()})),Mg(new qf("auth-internal",e=>{const i=qg(e.getProvider("auth").getImmediate());return(o=>new Uje(o))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),ud(EJ,vJ,Vje(n)),ud(EJ,vJ,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fje=300,Bje=aie("authIdTokenMaxAge")||Fje;let SJ=null;const zje=n=>async e=>{const i=e&&await e.getIdTokenResult(),o=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(o&&o>Bje)return;const l=i==null?void 0:i.token;SJ!==l&&(SJ=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function LS(n=gN()){const e=WR(n,"auth");if(e.isInitialized())return e.getImmediate();const i=c3e(n,{popupRedirectResolver:Mje,persistence:[K3e,L3e,Wie]}),o=aie("authTokenSyncURL");if(o&&typeof isSecureContext=="boolean"&&isSecureContext){const u=new URL(o,location.origin);if(location.origin===u.origin){const f=zje(u.toString());O3e(i,f,()=>f(i.currentUser)),P3e(i,y=>f(y))}}const l=sie("auth");return l&&u3e(i,`http://${l}`),i}function Wje(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}e3e({loadJS(n){return new Promise((e,i)=>{const o=document.createElement("script");o.setAttribute("src",n),o.onload=e,o.onerror=l=>{const u=xp("internal-error");u.customData=l,i(u)},o.type="text/javascript",o.charset="UTF-8",Wje().appendChild(o)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});jje("Browser");var bJ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var kg,Xie;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(q,J){function Q(){}Q.prototype=J.prototype,q.D=J.prototype,q.prototype=new Q,q.prototype.constructor=q,q.C=function(ie,pe,de){for(var he=Array(arguments.length-2),Se=2;Se<arguments.length;Se++)he[Se-2]=arguments[Se];return J.prototype[pe].apply(ie,he)}}function i(){this.blockSize=-1}function o(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(o,i),o.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(q,J,Q){Q||(Q=0);var ie=Array(16);if(typeof J=="string")for(var pe=0;16>pe;++pe)ie[pe]=J.charCodeAt(Q++)|J.charCodeAt(Q++)<<8|J.charCodeAt(Q++)<<16|J.charCodeAt(Q++)<<24;else for(pe=0;16>pe;++pe)ie[pe]=J[Q++]|J[Q++]<<8|J[Q++]<<16|J[Q++]<<24;J=q.g[0],Q=q.g[1],pe=q.g[2];var de=q.g[3],he=J+(de^Q&(pe^de))+ie[0]+3614090360&4294967295;J=Q+(he<<7&4294967295|he>>>25),he=de+(pe^J&(Q^pe))+ie[1]+3905402710&4294967295,de=J+(he<<12&4294967295|he>>>20),he=pe+(Q^de&(J^Q))+ie[2]+606105819&4294967295,pe=de+(he<<17&4294967295|he>>>15),he=Q+(J^pe&(de^J))+ie[3]+3250441966&4294967295,Q=pe+(he<<22&4294967295|he>>>10),he=J+(de^Q&(pe^de))+ie[4]+4118548399&4294967295,J=Q+(he<<7&4294967295|he>>>25),he=de+(pe^J&(Q^pe))+ie[5]+1200080426&4294967295,de=J+(he<<12&4294967295|he>>>20),he=pe+(Q^de&(J^Q))+ie[6]+2821735955&4294967295,pe=de+(he<<17&4294967295|he>>>15),he=Q+(J^pe&(de^J))+ie[7]+4249261313&4294967295,Q=pe+(he<<22&4294967295|he>>>10),he=J+(de^Q&(pe^de))+ie[8]+1770035416&4294967295,J=Q+(he<<7&4294967295|he>>>25),he=de+(pe^J&(Q^pe))+ie[9]+2336552879&4294967295,de=J+(he<<12&4294967295|he>>>20),he=pe+(Q^de&(J^Q))+ie[10]+4294925233&4294967295,pe=de+(he<<17&4294967295|he>>>15),he=Q+(J^pe&(de^J))+ie[11]+2304563134&4294967295,Q=pe+(he<<22&4294967295|he>>>10),he=J+(de^Q&(pe^de))+ie[12]+1804603682&4294967295,J=Q+(he<<7&4294967295|he>>>25),he=de+(pe^J&(Q^pe))+ie[13]+4254626195&4294967295,de=J+(he<<12&4294967295|he>>>20),he=pe+(Q^de&(J^Q))+ie[14]+2792965006&4294967295,pe=de+(he<<17&4294967295|he>>>15),he=Q+(J^pe&(de^J))+ie[15]+1236535329&4294967295,Q=pe+(he<<22&4294967295|he>>>10),he=J+(pe^de&(Q^pe))+ie[1]+4129170786&4294967295,J=Q+(he<<5&4294967295|he>>>27),he=de+(Q^pe&(J^Q))+ie[6]+3225465664&4294967295,de=J+(he<<9&4294967295|he>>>23),he=pe+(J^Q&(de^J))+ie[11]+643717713&4294967295,pe=de+(he<<14&4294967295|he>>>18),he=Q+(de^J&(pe^de))+ie[0]+3921069994&4294967295,Q=pe+(he<<20&4294967295|he>>>12),he=J+(pe^de&(Q^pe))+ie[5]+3593408605&4294967295,J=Q+(he<<5&4294967295|he>>>27),he=de+(Q^pe&(J^Q))+ie[10]+38016083&4294967295,de=J+(he<<9&4294967295|he>>>23),he=pe+(J^Q&(de^J))+ie[15]+3634488961&4294967295,pe=de+(he<<14&4294967295|he>>>18),he=Q+(de^J&(pe^de))+ie[4]+3889429448&4294967295,Q=pe+(he<<20&4294967295|he>>>12),he=J+(pe^de&(Q^pe))+ie[9]+568446438&4294967295,J=Q+(he<<5&4294967295|he>>>27),he=de+(Q^pe&(J^Q))+ie[14]+3275163606&4294967295,de=J+(he<<9&4294967295|he>>>23),he=pe+(J^Q&(de^J))+ie[3]+4107603335&4294967295,pe=de+(he<<14&4294967295|he>>>18),he=Q+(de^J&(pe^de))+ie[8]+1163531501&4294967295,Q=pe+(he<<20&4294967295|he>>>12),he=J+(pe^de&(Q^pe))+ie[13]+2850285829&4294967295,J=Q+(he<<5&4294967295|he>>>27),he=de+(Q^pe&(J^Q))+ie[2]+4243563512&4294967295,de=J+(he<<9&4294967295|he>>>23),he=pe+(J^Q&(de^J))+ie[7]+1735328473&4294967295,pe=de+(he<<14&4294967295|he>>>18),he=Q+(de^J&(pe^de))+ie[12]+2368359562&4294967295,Q=pe+(he<<20&4294967295|he>>>12),he=J+(Q^pe^de)+ie[5]+4294588738&4294967295,J=Q+(he<<4&4294967295|he>>>28),he=de+(J^Q^pe)+ie[8]+2272392833&4294967295,de=J+(he<<11&4294967295|he>>>21),he=pe+(de^J^Q)+ie[11]+1839030562&4294967295,pe=de+(he<<16&4294967295|he>>>16),he=Q+(pe^de^J)+ie[14]+4259657740&4294967295,Q=pe+(he<<23&4294967295|he>>>9),he=J+(Q^pe^de)+ie[1]+2763975236&4294967295,J=Q+(he<<4&4294967295|he>>>28),he=de+(J^Q^pe)+ie[4]+1272893353&4294967295,de=J+(he<<11&4294967295|he>>>21),he=pe+(de^J^Q)+ie[7]+4139469664&4294967295,pe=de+(he<<16&4294967295|he>>>16),he=Q+(pe^de^J)+ie[10]+3200236656&4294967295,Q=pe+(he<<23&4294967295|he>>>9),he=J+(Q^pe^de)+ie[13]+681279174&4294967295,J=Q+(he<<4&4294967295|he>>>28),he=de+(J^Q^pe)+ie[0]+3936430074&4294967295,de=J+(he<<11&4294967295|he>>>21),he=pe+(de^J^Q)+ie[3]+3572445317&4294967295,pe=de+(he<<16&4294967295|he>>>16),he=Q+(pe^de^J)+ie[6]+76029189&4294967295,Q=pe+(he<<23&4294967295|he>>>9),he=J+(Q^pe^de)+ie[9]+3654602809&4294967295,J=Q+(he<<4&4294967295|he>>>28),he=de+(J^Q^pe)+ie[12]+3873151461&4294967295,de=J+(he<<11&4294967295|he>>>21),he=pe+(de^J^Q)+ie[15]+530742520&4294967295,pe=de+(he<<16&4294967295|he>>>16),he=Q+(pe^de^J)+ie[2]+3299628645&4294967295,Q=pe+(he<<23&4294967295|he>>>9),he=J+(pe^(Q|~de))+ie[0]+4096336452&4294967295,J=Q+(he<<6&4294967295|he>>>26),he=de+(Q^(J|~pe))+ie[7]+1126891415&4294967295,de=J+(he<<10&4294967295|he>>>22),he=pe+(J^(de|~Q))+ie[14]+2878612391&4294967295,pe=de+(he<<15&4294967295|he>>>17),he=Q+(de^(pe|~J))+ie[5]+4237533241&4294967295,Q=pe+(he<<21&4294967295|he>>>11),he=J+(pe^(Q|~de))+ie[12]+1700485571&4294967295,J=Q+(he<<6&4294967295|he>>>26),he=de+(Q^(J|~pe))+ie[3]+2399980690&4294967295,de=J+(he<<10&4294967295|he>>>22),he=pe+(J^(de|~Q))+ie[10]+4293915773&4294967295,pe=de+(he<<15&4294967295|he>>>17),he=Q+(de^(pe|~J))+ie[1]+2240044497&4294967295,Q=pe+(he<<21&4294967295|he>>>11),he=J+(pe^(Q|~de))+ie[8]+1873313359&4294967295,J=Q+(he<<6&4294967295|he>>>26),he=de+(Q^(J|~pe))+ie[15]+4264355552&4294967295,de=J+(he<<10&4294967295|he>>>22),he=pe+(J^(de|~Q))+ie[6]+2734768916&4294967295,pe=de+(he<<15&4294967295|he>>>17),he=Q+(de^(pe|~J))+ie[13]+1309151649&4294967295,Q=pe+(he<<21&4294967295|he>>>11),he=J+(pe^(Q|~de))+ie[4]+4149444226&4294967295,J=Q+(he<<6&4294967295|he>>>26),he=de+(Q^(J|~pe))+ie[11]+3174756917&4294967295,de=J+(he<<10&4294967295|he>>>22),he=pe+(J^(de|~Q))+ie[2]+718787259&4294967295,pe=de+(he<<15&4294967295|he>>>17),he=Q+(de^(pe|~J))+ie[9]+3951481745&4294967295,q.g[0]=q.g[0]+J&4294967295,q.g[1]=q.g[1]+(pe+(he<<21&4294967295|he>>>11))&4294967295,q.g[2]=q.g[2]+pe&4294967295,q.g[3]=q.g[3]+de&4294967295}o.prototype.u=function(q,J){J===void 0&&(J=q.length);for(var Q=J-this.blockSize,ie=this.B,pe=this.h,de=0;de<J;){if(pe==0)for(;de<=Q;)l(this,q,de),de+=this.blockSize;if(typeof q=="string"){for(;de<J;)if(ie[pe++]=q.charCodeAt(de++),pe==this.blockSize){l(this,ie),pe=0;break}}else for(;de<J;)if(ie[pe++]=q[de++],pe==this.blockSize){l(this,ie),pe=0;break}}this.h=pe,this.o+=J},o.prototype.v=function(){var q=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);q[0]=128;for(var J=1;J<q.length-8;++J)q[J]=0;var Q=8*this.o;for(J=q.length-8;J<q.length;++J)q[J]=Q&255,Q/=256;for(this.u(q),q=Array(16),J=Q=0;4>J;++J)for(var ie=0;32>ie;ie+=8)q[Q++]=this.g[J]>>>ie&255;return q};function u(q,J){var Q=y;return Object.prototype.hasOwnProperty.call(Q,q)?Q[q]:Q[q]=J(q)}function f(q,J){this.h=J;for(var Q=[],ie=!0,pe=q.length-1;0<=pe;pe--){var de=q[pe]|0;ie&&de==J||(Q[pe]=de,ie=!1)}this.g=Q}var y={};function v(q){return-128<=q&&128>q?u(q,function(J){return new f([J|0],0>J?-1:0)}):new f([q|0],0>q?-1:0)}function b(q){if(isNaN(q)||!isFinite(q))return R;if(0>q)return B(b(-q));for(var J=[],Q=1,ie=0;q>=Q;ie++)J[ie]=q/Q|0,Q*=4294967296;return new f(J,0)}function C(q,J){if(q.length==0)throw Error("number format error: empty string");if(J=J||10,2>J||36<J)throw Error("radix out of range: "+J);if(q.charAt(0)=="-")return B(C(q.substring(1),J));if(0<=q.indexOf("-"))throw Error('number format error: interior "-" character');for(var Q=b(Math.pow(J,8)),ie=R,pe=0;pe<q.length;pe+=8){var de=Math.min(8,q.length-pe),he=parseInt(q.substring(pe,pe+de),J);8>de?(de=b(Math.pow(J,de)),ie=ie.j(de).add(b(he))):(ie=ie.j(Q),ie=ie.add(b(he)))}return ie}var R=v(0),O=v(1),L=v(16777216);n=f.prototype,n.m=function(){if(U(this))return-B(this).m();for(var q=0,J=1,Q=0;Q<this.g.length;Q++){var ie=this.i(Q);q+=(0<=ie?ie:4294967296+ie)*J,J*=4294967296}return q},n.toString=function(q){if(q=q||10,2>q||36<q)throw Error("radix out of range: "+q);if(D(this))return"0";if(U(this))return"-"+B(this).toString(q);for(var J=b(Math.pow(q,6)),Q=this,ie="";;){var pe=le(Q,J).g;Q=Y(Q,pe.j(J));var de=((0<Q.g.length?Q.g[0]:Q.h)>>>0).toString(q);if(Q=pe,D(Q))return de+ie;for(;6>de.length;)de="0"+de;ie=de+ie}},n.i=function(q){return 0>q?0:q<this.g.length?this.g[q]:this.h};function D(q){if(q.h!=0)return!1;for(var J=0;J<q.g.length;J++)if(q.g[J]!=0)return!1;return!0}function U(q){return q.h==-1}n.l=function(q){return q=Y(this,q),U(q)?-1:D(q)?0:1};function B(q){for(var J=q.g.length,Q=[],ie=0;ie<J;ie++)Q[ie]=~q.g[ie];return new f(Q,~q.h).add(O)}n.abs=function(){return U(this)?B(this):this},n.add=function(q){for(var J=Math.max(this.g.length,q.g.length),Q=[],ie=0,pe=0;pe<=J;pe++){var de=ie+(this.i(pe)&65535)+(q.i(pe)&65535),he=(de>>>16)+(this.i(pe)>>>16)+(q.i(pe)>>>16);ie=he>>>16,de&=65535,he&=65535,Q[pe]=he<<16|de}return new f(Q,Q[Q.length-1]&-2147483648?-1:0)};function Y(q,J){return q.add(B(J))}n.j=function(q){if(D(this)||D(q))return R;if(U(this))return U(q)?B(this).j(B(q)):B(B(this).j(q));if(U(q))return B(this.j(B(q)));if(0>this.l(L)&&0>q.l(L))return b(this.m()*q.m());for(var J=this.g.length+q.g.length,Q=[],ie=0;ie<2*J;ie++)Q[ie]=0;for(ie=0;ie<this.g.length;ie++)for(var pe=0;pe<q.g.length;pe++){var de=this.i(ie)>>>16,he=this.i(ie)&65535,Se=q.i(pe)>>>16,Ie=q.i(pe)&65535;Q[2*ie+2*pe]+=he*Ie,W(Q,2*ie+2*pe),Q[2*ie+2*pe+1]+=de*Ie,W(Q,2*ie+2*pe+1),Q[2*ie+2*pe+1]+=he*Se,W(Q,2*ie+2*pe+1),Q[2*ie+2*pe+2]+=de*Se,W(Q,2*ie+2*pe+2)}for(ie=0;ie<J;ie++)Q[ie]=Q[2*ie+1]<<16|Q[2*ie];for(ie=J;ie<2*J;ie++)Q[ie]=0;return new f(Q,0)};function W(q,J){for(;(q[J]&65535)!=q[J];)q[J+1]+=q[J]>>>16,q[J]&=65535,J++}function ne(q,J){this.g=q,this.h=J}function le(q,J){if(D(J))throw Error("division by zero");if(D(q))return new ne(R,R);if(U(q))return J=le(B(q),J),new ne(B(J.g),B(J.h));if(U(J))return J=le(q,B(J)),new ne(B(J.g),J.h);if(30<q.g.length){if(U(q)||U(J))throw Error("slowDivide_ only works with positive integers.");for(var Q=O,ie=J;0>=ie.l(q);)Q=re(Q),ie=re(ie);var pe=me(Q,1),de=me(ie,1);for(ie=me(ie,2),Q=me(Q,2);!D(ie);){var he=de.add(ie);0>=he.l(q)&&(pe=pe.add(Q),de=he),ie=me(ie,1),Q=me(Q,1)}return J=Y(q,pe.j(J)),new ne(pe,J)}for(pe=R;0<=q.l(J);){for(Q=Math.max(1,Math.floor(q.m()/J.m())),ie=Math.ceil(Math.log(Q)/Math.LN2),ie=48>=ie?1:Math.pow(2,ie-48),de=b(Q),he=de.j(J);U(he)||0<he.l(q);)Q-=ie,de=b(Q),he=de.j(J);D(de)&&(de=O),pe=pe.add(de),q=Y(q,he)}return new ne(pe,q)}n.A=function(q){return le(this,q).h},n.and=function(q){for(var J=Math.max(this.g.length,q.g.length),Q=[],ie=0;ie<J;ie++)Q[ie]=this.i(ie)&q.i(ie);return new f(Q,this.h&q.h)},n.or=function(q){for(var J=Math.max(this.g.length,q.g.length),Q=[],ie=0;ie<J;ie++)Q[ie]=this.i(ie)|q.i(ie);return new f(Q,this.h|q.h)},n.xor=function(q){for(var J=Math.max(this.g.length,q.g.length),Q=[],ie=0;ie<J;ie++)Q[ie]=this.i(ie)^q.i(ie);return new f(Q,this.h^q.h)};function re(q){for(var J=q.g.length+1,Q=[],ie=0;ie<J;ie++)Q[ie]=q.i(ie)<<1|q.i(ie-1)>>>31;return new f(Q,q.h)}function me(q,J){var Q=J>>5;J%=32;for(var ie=q.g.length-Q,pe=[],de=0;de<ie;de++)pe[de]=0<J?q.i(de+Q)>>>J|q.i(de+Q+1)<<32-J:q.i(de+Q);return new f(pe,q.h)}o.prototype.digest=o.prototype.v,o.prototype.reset=o.prototype.s,o.prototype.update=o.prototype.u,Xie=o,f.prototype.add=f.prototype.add,f.prototype.multiply=f.prototype.j,f.prototype.modulo=f.prototype.A,f.prototype.compare=f.prototype.l,f.prototype.toNumber=f.prototype.m,f.prototype.toString=f.prototype.toString,f.prototype.getBits=f.prototype.i,f.fromNumber=b,f.fromString=C,kg=f}).apply(typeof bJ<"u"?bJ:typeof self<"u"?self:typeof window<"u"?window:{});var rO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Jie,_C,Qie,UO,o5,Zie,ese,tse;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(P,$,se){return P==Array.prototype||P==Object.prototype||(P[$]=se.value),P};function i(P){P=[typeof globalThis=="object"&&globalThis,P,typeof window=="object"&&window,typeof self=="object"&&self,typeof rO=="object"&&rO];for(var $=0;$<P.length;++$){var se=P[$];if(se&&se.Math==Math)return se}throw Error("Cannot find global object")}var o=i(this);function l(P,$){if($)e:{var se=o;P=P.split(".");for(var Ee=0;Ee<P.length-1;Ee++){var Ye=P[Ee];if(!(Ye in se))break e;se=se[Ye]}P=P[P.length-1],Ee=se[P],$=$(Ee),$!=Ee&&$!=null&&e(se,P,{configurable:!0,writable:!0,value:$})}}function u(P,$){P instanceof String&&(P+="");var se=0,Ee=!1,Ye={next:function(){if(!Ee&&se<P.length){var ht=se++;return{value:$(ht,P[ht]),done:!1}}return Ee=!0,{done:!0,value:void 0}}};return Ye[Symbol.iterator]=function(){return Ye},Ye}l("Array.prototype.values",function(P){return P||function(){return u(this,function($,se){return se})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var f=f||{},y=this||self;function v(P){var $=typeof P;return $=$!="object"?$:P?Array.isArray(P)?"array":$:"null",$=="array"||$=="object"&&typeof P.length=="number"}function b(P){var $=typeof P;return $=="object"&&P!=null||$=="function"}function C(P,$,se){return P.call.apply(P.bind,arguments)}function R(P,$,se){if(!P)throw Error();if(2<arguments.length){var Ee=Array.prototype.slice.call(arguments,2);return function(){var Ye=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Ye,Ee),P.apply($,Ye)}}return function(){return P.apply($,arguments)}}function O(P,$,se){return O=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?C:R,O.apply(null,arguments)}function L(P,$){var se=Array.prototype.slice.call(arguments,1);return function(){var Ee=se.slice();return Ee.push.apply(Ee,arguments),P.apply(this,Ee)}}function D(P,$){function se(){}se.prototype=$.prototype,P.aa=$.prototype,P.prototype=new se,P.prototype.constructor=P,P.Qb=function(Ee,Ye,ht){for(var $t=Array(arguments.length-2),oi=2;oi<arguments.length;oi++)$t[oi-2]=arguments[oi];return $.prototype[Ye].apply(Ee,$t)}}function U(P){const $=P.length;if(0<$){const se=Array($);for(let Ee=0;Ee<$;Ee++)se[Ee]=P[Ee];return se}return[]}function B(P,$){for(let se=1;se<arguments.length;se++){const Ee=arguments[se];if(v(Ee)){const Ye=P.length||0,ht=Ee.length||0;P.length=Ye+ht;for(let $t=0;$t<ht;$t++)P[Ye+$t]=Ee[$t]}else P.push(Ee)}}class Y{constructor($,se){this.i=$,this.j=se,this.h=0,this.g=null}get(){let $;return 0<this.h?(this.h--,$=this.g,this.g=$.next,$.next=null):$=this.i(),$}}function W(P){return/^[\s\xa0]*$/.test(P)}function ne(){var P=y.navigator;return P&&(P=P.userAgent)?P:""}function le(P){return le[" "](P),P}le[" "]=function(){};var re=ne().indexOf("Gecko")!=-1&&!(ne().toLowerCase().indexOf("webkit")!=-1&&ne().indexOf("Edge")==-1)&&!(ne().indexOf("Trident")!=-1||ne().indexOf("MSIE")!=-1)&&ne().indexOf("Edge")==-1;function me(P,$,se){for(const Ee in P)$.call(se,P[Ee],Ee,P)}function q(P,$){for(const se in P)$.call(void 0,P[se],se,P)}function J(P){const $={};for(const se in P)$[se]=P[se];return $}const Q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ie(P,$){let se,Ee;for(let Ye=1;Ye<arguments.length;Ye++){Ee=arguments[Ye];for(se in Ee)P[se]=Ee[se];for(let ht=0;ht<Q.length;ht++)se=Q[ht],Object.prototype.hasOwnProperty.call(Ee,se)&&(P[se]=Ee[se])}}function pe(P){var $=1;P=P.split(":");const se=[];for(;0<$&&P.length;)se.push(P.shift()),$--;return P.length&&se.push(P.join(":")),se}function de(P){y.setTimeout(()=>{throw P},0)}function he(){var P=Te;let $=null;return P.g&&($=P.g,P.g=P.g.next,P.g||(P.h=null),$.next=null),$}class Se{constructor(){this.h=this.g=null}add($,se){const Ee=Ie.get();Ee.set($,se),this.h?this.h.next=Ee:this.g=Ee,this.h=Ee}}var Ie=new Y(()=>new Fe,P=>P.reset());class Fe{constructor(){this.next=this.g=this.h=null}set($,se){this.h=$,this.g=se,this.next=null}reset(){this.next=this.g=this.h=null}}let we,Re=!1,Te=new Se,Ne=()=>{const P=y.Promise.resolve(void 0);we=()=>{P.then(be)}};var be=()=>{for(var P;P=he();){try{P.h.call(P.g)}catch(se){de(se)}var $=Ie;$.j(P),100>$.h&&($.h++,P.next=$.g,$.g=P)}Re=!1};function xe(){this.s=this.s,this.C=this.C}xe.prototype.s=!1,xe.prototype.ma=function(){this.s||(this.s=!0,this.N())},xe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function je(P,$){this.type=P,this.g=this.target=$,this.defaultPrevented=!1}je.prototype.h=function(){this.defaultPrevented=!0};var nt=(function(){if(!y.addEventListener||!Object.defineProperty)return!1;var P=!1,$=Object.defineProperty({},"passive",{get:function(){P=!0}});try{const se=()=>{};y.addEventListener("test",se,$),y.removeEventListener("test",se,$)}catch{}return P})();function dt(P,$){if(je.call(this,P?P.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,P){var se=this.type=P.type,Ee=P.changedTouches&&P.changedTouches.length?P.changedTouches[0]:null;if(this.target=P.target||P.srcElement,this.g=$,$=P.relatedTarget){if(re){e:{try{le($.nodeName);var Ye=!0;break e}catch{}Ye=!1}Ye||($=null)}}else se=="mouseover"?$=P.fromElement:se=="mouseout"&&($=P.toElement);this.relatedTarget=$,Ee?(this.clientX=Ee.clientX!==void 0?Ee.clientX:Ee.pageX,this.clientY=Ee.clientY!==void 0?Ee.clientY:Ee.pageY,this.screenX=Ee.screenX||0,this.screenY=Ee.screenY||0):(this.clientX=P.clientX!==void 0?P.clientX:P.pageX,this.clientY=P.clientY!==void 0?P.clientY:P.pageY,this.screenX=P.screenX||0,this.screenY=P.screenY||0),this.button=P.button,this.key=P.key||"",this.ctrlKey=P.ctrlKey,this.altKey=P.altKey,this.shiftKey=P.shiftKey,this.metaKey=P.metaKey,this.pointerId=P.pointerId||0,this.pointerType=typeof P.pointerType=="string"?P.pointerType:ft[P.pointerType]||"",this.state=P.state,this.i=P,P.defaultPrevented&&dt.aa.h.call(this)}}D(dt,je);var ft={2:"touch",3:"pen",4:"mouse"};dt.prototype.h=function(){dt.aa.h.call(this);var P=this.i;P.preventDefault?P.preventDefault():P.returnValue=!1};var lt="closure_listenable_"+(1e6*Math.random()|0),gt=0;function at(P,$,se,Ee,Ye){this.listener=P,this.proxy=null,this.src=$,this.type=se,this.capture=!!Ee,this.ha=Ye,this.key=++gt,this.da=this.fa=!1}function Ct(P){P.da=!0,P.listener=null,P.proxy=null,P.src=null,P.ha=null}function En(P){this.src=P,this.g={},this.h=0}En.prototype.add=function(P,$,se,Ee,Ye){var ht=P.toString();P=this.g[ht],P||(P=this.g[ht]=[],this.h++);var $t=Xt(P,$,Ee,Ye);return-1<$t?($=P[$t],se||($.fa=!1)):($=new at($,this.src,ht,!!Ee,Ye),$.fa=se,P.push($)),$};function Gt(P,$){var se=$.type;if(se in P.g){var Ee=P.g[se],Ye=Array.prototype.indexOf.call(Ee,$,void 0),ht;(ht=0<=Ye)&&Array.prototype.splice.call(Ee,Ye,1),ht&&(Ct($),P.g[se].length==0&&(delete P.g[se],P.h--))}}function Xt(P,$,se,Ee){for(var Ye=0;Ye<P.length;++Ye){var ht=P[Ye];if(!ht.da&&ht.listener==$&&ht.capture==!!se&&ht.ha==Ee)return Ye}return-1}var st="closure_lm_"+(1e6*Math.random()|0),hn={};function an(P,$,se,Ee,Ye){if(Array.isArray($)){for(var ht=0;ht<$.length;ht++)an(P,$[ht],se,Ee,Ye);return null}return se=Pt(se),P&&P[lt]?P.K($,se,b(Ee)?!!Ee.capture:!1,Ye):jt(P,$,se,!1,Ee,Ye)}function jt(P,$,se,Ee,Ye,ht){if(!$)throw Error("Invalid event type");var $t=b(Ye)?!!Ye.capture:!!Ye,oi=Ot(P);if(oi||(P[st]=oi=new En(P)),se=oi.add($,se,Ee,$t,ht),se.proxy)return se;if(Ee=on(),se.proxy=Ee,Ee.src=P,Ee.listener=se,P.addEventListener)nt||(Ye=$t),Ye===void 0&&(Ye=!1),P.addEventListener($.toString(),Ee,Ye);else if(P.attachEvent)P.attachEvent(De($.toString()),Ee);else if(P.addListener&&P.removeListener)P.addListener(Ee);else throw Error("addEventListener and attachEvent are unavailable.");return se}function on(){function P(se){return $.call(P.src,P.listener,se)}const $=Ke;return P}function St(P,$,se,Ee,Ye){if(Array.isArray($))for(var ht=0;ht<$.length;ht++)St(P,$[ht],se,Ee,Ye);else Ee=b(Ee)?!!Ee.capture:!!Ee,se=Pt(se),P&&P[lt]?(P=P.i,$=String($).toString(),$ in P.g&&(ht=P.g[$],se=Xt(ht,se,Ee,Ye),-1<se&&(Ct(ht[se]),Array.prototype.splice.call(ht,se,1),ht.length==0&&(delete P.g[$],P.h--)))):P&&(P=Ot(P))&&($=P.g[$.toString()],P=-1,$&&(P=Xt($,se,Ee,Ye)),(se=-1<P?$[P]:null)&&ve(se))}function ve(P){if(typeof P!="number"&&P&&!P.da){var $=P.src;if($&&$[lt])Gt($.i,P);else{var se=P.type,Ee=P.proxy;$.removeEventListener?$.removeEventListener(se,Ee,P.capture):$.detachEvent?$.detachEvent(De(se),Ee):$.addListener&&$.removeListener&&$.removeListener(Ee),(se=Ot($))?(Gt(se,P),se.h==0&&(se.src=null,$[st]=null)):Ct(P)}}}function De(P){return P in hn?hn[P]:hn[P]="on"+P}function Ke(P,$){if(P.da)P=!0;else{$=new dt($,this);var se=P.listener,Ee=P.ha||P.src;P.fa&&ve(P),P=se.call(Ee,$)}return P}function Ot(P){return P=P[st],P instanceof En?P:null}var Et="__closure_events_fn_"+(1e9*Math.random()>>>0);function Pt(P){return typeof P=="function"?P:(P[Et]||(P[Et]=function($){return P.handleEvent($)}),P[Et])}function Ut(){xe.call(this),this.i=new En(this),this.M=this,this.F=null}D(Ut,xe),Ut.prototype[lt]=!0,Ut.prototype.removeEventListener=function(P,$,se,Ee){St(this,P,$,se,Ee)};function cn(P,$){var se,Ee=P.F;if(Ee)for(se=[];Ee;Ee=Ee.F)se.push(Ee);if(P=P.M,Ee=$.type||$,typeof $=="string")$=new je($,P);else if($ instanceof je)$.target=$.target||P;else{var Ye=$;$=new je(Ee,P),ie($,Ye)}if(Ye=!0,se)for(var ht=se.length-1;0<=ht;ht--){var $t=$.g=se[ht];Ye=_t($t,Ee,!0,$)&&Ye}if($t=$.g=P,Ye=_t($t,Ee,!0,$)&&Ye,Ye=_t($t,Ee,!1,$)&&Ye,se)for(ht=0;ht<se.length;ht++)$t=$.g=se[ht],Ye=_t($t,Ee,!1,$)&&Ye}Ut.prototype.N=function(){if(Ut.aa.N.call(this),this.i){var P=this.i,$;for($ in P.g){for(var se=P.g[$],Ee=0;Ee<se.length;Ee++)Ct(se[Ee]);delete P.g[$],P.h--}}this.F=null},Ut.prototype.K=function(P,$,se,Ee){return this.i.add(String(P),$,!1,se,Ee)},Ut.prototype.L=function(P,$,se,Ee){return this.i.add(String(P),$,!0,se,Ee)};function _t(P,$,se,Ee){if($=P.i.g[String($)],!$)return!0;$=$.concat();for(var Ye=!0,ht=0;ht<$.length;++ht){var $t=$[ht];if($t&&!$t.da&&$t.capture==se){var oi=$t.listener,Qs=$t.ha||$t.src;$t.fa&&Gt(P.i,$t),Ye=oi.call(Qs,Ee)!==!1&&Ye}}return Ye&&!Ee.defaultPrevented}function wn(P,$,se){if(typeof P=="function")se&&(P=O(P,se));else if(P&&typeof P.handleEvent=="function")P=O(P.handleEvent,P);else throw Error("Invalid listener argument");return 2147483647<Number($)?-1:y.setTimeout(P,$||0)}function Nt(P){P.g=wn(()=>{P.g=null,P.i&&(P.i=!1,Nt(P))},P.l);const $=P.h;P.h=null,P.m.apply(null,$)}class Ht extends xe{constructor($,se){super(),this.m=$,this.l=se,this.h=null,this.i=!1,this.g=null}j($){this.h=arguments,this.g?this.i=!0:Nt(this)}N(){super.N(),this.g&&(y.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Lr(P){xe.call(this),this.h=P,this.g={}}D(Lr,xe);var wi=[];function ti(P){me(P.g,function($,se){this.g.hasOwnProperty(se)&&ve($)},P),P.g={}}Lr.prototype.N=function(){Lr.aa.N.call(this),ti(this)},Lr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Vi=y.JSON.stringify,us=y.JSON.parse,_o=class{stringify(P){return y.JSON.stringify(P,void 0)}parse(P){return y.JSON.parse(P,void 0)}};function Wr(){}Wr.prototype.h=null;function Do(P){return P.h||(P.h=P.i())}function Fc(){}var Yr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function yo(){je.call(this,"d")}D(yo,je);function Ys(){je.call(this,"c")}D(Ys,je);var Zi={},Bc=null;function Eo(){return Bc=Bc||new Ut}Zi.La="serverreachability";function yu(P){je.call(this,Zi.La,P)}D(yu,je);function Wa(P){const $=Eo();cn($,new yu($))}Zi.STAT_EVENT="statevent";function Ns(P,$){je.call(this,Zi.STAT_EVENT,P),this.stat=$}D(Ns,je);function Kt(P){const $=Eo();cn($,new Ns($,P))}Zi.Ma="timingevent";function zc(P,$){je.call(this,Zi.Ma,P),this.size=$}D(zc,je);function Zo(P,$){if(typeof P!="function")throw Error("Fn must not be null and must be a function");return y.setTimeout(function(){P()},$)}function Ga(){this.g=!0}Ga.prototype.xa=function(){this.g=!1};function Wc(P,$,se,Ee,Ye,ht){P.info(function(){if(P.g)if(ht)for(var $t="",oi=ht.split("&"),Qs=0;Qs<oi.length;Qs++){var fr=oi[Qs].split("=");if(1<fr.length){var vo=fr[0];fr=fr[1];var Ms=vo.split("_");$t=2<=Ms.length&&Ms[1]=="type"?$t+(vo+"="+fr+"&"):$t+(vo+"=redacted&")}}else $t=null;else $t=ht;return"XMLHTTP REQ ("+Ee+") [attempt "+Ye+"]: "+$+`
`+se+`
`+$t})}function ea(P,$,se,Ee,Ye,ht,$t){P.info(function(){return"XMLHTTP RESP ("+Ee+") [ attempt "+Ye+"]: "+$+`
`+se+`
`+ht+" "+$t})}function ta(P,$,se,Ee){P.info(function(){return"XMLHTTP TEXT ("+$+"): "+Sh(P,se)+(Ee?" "+Ee:"")})}function yd(P,$){P.info(function(){return"TIMEOUT: "+$})}Ga.prototype.info=function(){};function Sh(P,$){if(!P.g)return $;if(!$)return null;try{var se=JSON.parse($);if(se){for(P=0;P<se.length;P++)if(Array.isArray(se[P])){var Ee=se[P];if(!(2>Ee.length)){var Ye=Ee[1];if(Array.isArray(Ye)&&!(1>Ye.length)){var ht=Ye[0];if(ht!="noop"&&ht!="stop"&&ht!="close")for(var $t=1;$t<Ye.length;$t++)Ye[$t]=""}}}}return Vi(se)}catch{return $}}var Pl={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},bh={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},xs;function Ol(){}D(Ol,Wr),Ol.prototype.g=function(){return new XMLHttpRequest},Ol.prototype.i=function(){return{}},xs=new Ol;function na(P,$,se,Ee){this.j=P,this.i=$,this.l=se,this.R=Ee||1,this.U=new Lr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ed}function Ed(){this.i=null,this.g="",this.h=!1}var kl={},Nl={};function va(P,$,se){P.L=1,P.v=vu(li($)),P.m=se,P.P=!0,xl(P,null)}function xl(P,$){P.F=Date.now(),Xr(P),P.A=li(P.v);var se=P.A,Ee=P.R;Array.isArray(Ee)||(Ee=[String(Ee)]),bu(se.i,"t",Ee),P.C=0,se=P.j.J,P.h=new Ed,P.g=e_(P.j,se?$:null,!P.m),0<P.O&&(P.M=new Ht(O(P.Y,P,P.g),P.O)),$=P.U,se=P.g,Ee=P.ca;var Ye="readystatechange";Array.isArray(Ye)||(Ye&&(wi[0]=Ye.toString()),Ye=wi);for(var ht=0;ht<Ye.length;ht++){var $t=an(se,Ye[ht],Ee||$.handleEvent,!1,$.h||$);if(!$t)break;$.g[$t.key]=$t}$=P.H?J(P.H):{},P.m?(P.u||(P.u="POST"),$["Content-Type"]="application/x-www-form-urlencoded",P.g.ea(P.A,P.u,P.m,$)):(P.u="GET",P.g.ea(P.A,P.u,null,$)),Wa(),Wc(P.i,P.u,P.A,P.l,P.R,P.m)}na.prototype.ca=function(P){P=P.target;const $=this.M;$&&Pi(P)==3?$.j():this.Y(P)},na.prototype.Y=function(P){try{if(P==this.g)e:{const Ms=Pi(this.g);var $=this.g.Ba();const Yc=this.g.Z();if(!(3>Ms)&&(Ms!=3||this.g&&(this.h.h||this.g.oa()||Js(this.g)))){this.J||Ms!=4||$==7||($==8||0>=Yc?Wa(3):Wa(2)),Mr(this);var se=this.g.Z();this.X=se;t:if(wh(this)){var Ee=Js(this.g);P="";var Ye=Ee.length,ht=Pi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ra(this),mc(this);var $t="";break t}this.h.i=new y.TextDecoder}for($=0;$<Ye;$++)this.h.h=!0,P+=this.h.i.decode(Ee[$],{stream:!(ht&&$==Ye-1)});Ee.length=0,this.h.g+=P,this.C=0,$t=this.h.g}else $t=this.g.oa();if(this.o=se==200,ea(this.i,this.u,this.A,this.l,this.R,Ms,se),this.o){if(this.T&&!this.K){t:{if(this.g){var oi,Qs=this.g;if((oi=Qs.g?Qs.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!W(oi)){var fr=oi;break t}}fr=null}if(se=fr)ta(this.i,this.l,se,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,vd(this,se);else{this.o=!1,this.s=3,Kt(12),ra(this),mc(this);break e}}if(this.P){se=!0;let Ka;for(;!this.J&&this.C<$t.length;)if(Ka=Xs(this,$t),Ka==Nl){Ms==4&&(this.s=4,Kt(14),se=!1),ta(this.i,this.l,null,"[Incomplete Response]");break}else if(Ka==kl){this.s=4,Kt(15),ta(this.i,this.l,$t,"[Invalid Chunk]"),se=!1;break}else ta(this.i,this.l,Ka,null),vd(this,Ka);if(wh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ms!=4||$t.length!=0||this.h.h||(this.s=1,Kt(16),se=!1),this.o=this.o&&se,!se)ta(this.i,this.l,$t,"[Invalid Chunked Response]"),ra(this),mc(this);else if(0<$t.length&&!this.W){this.W=!0;var vo=this.j;vo.g==this&&vo.ba&&!vo.M&&(vo.j.info("Great, no buffering proxy detected. Bytes received: "+$t.length),Zg(vo),vo.M=!0,Kt(11))}}else ta(this.i,this.l,$t,null),vd(this,$t);Ms==4&&ra(this),this.o&&!this.J&&(Ms==4?lm(this.j,this):(this.o=!1,Xr(this)))}else Kc(this.g),se==400&&0<$t.indexOf("Unknown SID")?(this.s=3,Kt(12)):(this.s=0,Kt(13)),ra(this),mc(this)}}}catch{}finally{}};function wh(P){return P.g?P.u=="GET"&&P.L!=2&&P.j.Ca:!1}function Xs(P,$){var se=P.C,Ee=$.indexOf(`
`,se);return Ee==-1?Nl:(se=Number($.substring(se,Ee)),isNaN(se)?kl:(Ee+=1,Ee+se>$.length?Nl:($=$.slice(Ee,Ee+se),P.C=Ee+se,$)))}na.prototype.cancel=function(){this.J=!0,ra(this)};function Xr(P){P.S=Date.now()+P.I,Th(P,P.I)}function Th(P,$){if(P.B!=null)throw Error("WatchDog timer not null");P.B=Zo(O(P.ba,P),$)}function Mr(P){P.B&&(y.clearTimeout(P.B),P.B=null)}na.prototype.ba=function(){this.B=null;const P=Date.now();0<=P-this.S?(yd(this.i,this.A),this.L!=2&&(Wa(),Kt(17)),ra(this),this.s=2,mc(this)):Th(this,this.S-P)};function mc(P){P.j.G==0||P.J||lm(P.j,P)}function ra(P){Mr(P);var $=P.M;$&&typeof $.ma=="function"&&$.ma(),P.M=null,ti(P.U),P.g&&($=P.g,P.g=null,$.abort(),$.ma())}function vd(P,$){try{var se=P.j;if(se.G!=0&&(se.g==P||gs(se.h,P))){if(!P.K&&gs(se.h,P)&&se.G==3){try{var Ee=se.Da.g.parse($)}catch{Ee=null}if(Array.isArray(Ee)&&Ee.length==3){var Ye=Ee;if(Ye[0]==0){e:if(!se.u){if(se.g)if(se.g.F+3e3<P.F)cm(se),Ec(se);else break e;Cu(se),Kt(18)}}else se.za=Ye[1],0<se.za-se.T&&37500>Ye[2]&&se.F&&se.v==0&&!se.C&&(se.C=Zo(O(se.Za,se),6e3));if(1>=$i(se.h)&&se.ca){try{se.ca()}catch{}se.ca=void 0}}else $a(se,11)}else if((P.K||se.g==P)&&cm(se),!W($))for(Ye=se.Da.g.parse($),$=0;$<Ye.length;$++){let fr=Ye[$];if(se.T=fr[0],fr=fr[1],se.G==2)if(fr[0]=="c"){se.K=fr[1],se.ia=fr[2];const vo=fr[3];vo!=null&&(se.la=vo,se.j.info("VER="+se.la));const Ms=fr[4];Ms!=null&&(se.Aa=Ms,se.j.info("SVER="+se.Aa));const Yc=fr[5];Yc!=null&&typeof Yc=="number"&&0<Yc&&(Ee=1.5*Yc,se.L=Ee,se.j.info("backChannelRequestTimeoutMs_="+Ee)),Ee=se;const Ka=P.g;if(Ka){const wd=Ka.g?Ka.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(wd){var ht=Ee.h;ht.g||wd.indexOf("spdy")==-1&&wd.indexOf("quic")==-1&&wd.indexOf("h2")==-1||(ht.j=ht.l,ht.g=new Set,ht.h&&(Gc(ht,ht.h),ht.h=null))}if(Ee.D){const um=Ka.g?Ka.g.getResponseHeader("X-HTTP-Session-Id"):null;um&&(Ee.ya=um,ui(Ee.I,Ee.D,um))}}se.G=3,se.l&&se.l.ua(),se.ba&&(se.R=Date.now()-P.F,se.j.info("Handshake RTT: "+se.R+"ms")),Ee=se;var $t=P;if(Ee.qa=bd(Ee,Ee.J?Ee.ia:null,Ee.W),$t.K){Ch(Ee.h,$t);var oi=$t,Qs=Ee.L;Qs&&(oi.I=Qs),oi.B&&(Mr(oi),Xr(oi)),Ee.g=$t}else vc(Ee);0<se.i.length&&qc(se)}else fr[0]!="stop"&&fr[0]!="close"||$a(se,7);else se.G==3&&(fr[0]=="stop"||fr[0]=="close"?fr[0]=="stop"?$a(se,7):Ls(se):fr[0]!="noop"&&se.l&&se.l.ta(fr),se.v=0)}}Wa(4)}catch{}}var Je=class{constructor(P,$){this.g=P,this.map=$}};function qt(P){this.l=P||10,y.PerformanceNavigationTiming?(P=y.performance.getEntriesByType("navigation"),P=0<P.length&&(P[0].nextHopProtocol=="hq"||P[0].nextHopProtocol=="h2")):P=!!(y.chrome&&y.chrome.loadTimes&&y.chrome.loadTimes()&&y.chrome.loadTimes().wasFetchedViaSpdy),this.j=P?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Kn(P){return P.h?!0:P.g?P.g.size>=P.j:!1}function $i(P){return P.h?1:P.g?P.g.size:0}function gs(P,$){return P.h?P.h==$:P.g?P.g.has($):!1}function Gc(P,$){P.g?P.g.add($):P.h=$}function Ch(P,$){P.h&&P.h==$?P.h=null:P.g&&P.g.has($)&&P.g.delete($)}qt.prototype.cancel=function(){if(this.i=gc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const P of this.g.values())P.cancel();this.g.clear()}};function gc(P){if(P.h!=null)return P.i.concat(P.h.D);if(P.g!=null&&P.g.size!==0){let $=P.i;for(const se of P.g.values())$=$.concat(se.D);return $}return U(P.i)}function Hc(P){if(P.V&&typeof P.V=="function")return P.V();if(typeof Map<"u"&&P instanceof Map||typeof Set<"u"&&P instanceof Set)return Array.from(P.values());if(typeof P=="string")return P.split("");if(v(P)){for(var $=[],se=P.length,Ee=0;Ee<se;Ee++)$.push(P[Ee]);return $}$=[],se=0;for(Ee in P)$[se++]=P[Ee];return $}function Dl(P){if(P.na&&typeof P.na=="function")return P.na();if(!P.V||typeof P.V!="function"){if(typeof Map<"u"&&P instanceof Map)return Array.from(P.keys());if(!(typeof Set<"u"&&P instanceof Set)){if(v(P)||typeof P=="string"){var $=[];P=P.length;for(var se=0;se<P;se++)$.push(se);return $}$=[],se=0;for(const Ee in P)$[se++]=Ee;return $}}}function Cr(P,$){if(P.forEach&&typeof P.forEach=="function")P.forEach($,void 0);else if(v(P)||typeof P=="string")Array.prototype.forEach.call(P,$,void 0);else for(var se=Dl(P),Ee=Hc(P),Ye=Ee.length,ht=0;ht<Ye;ht++)$.call(void 0,Ee[ht],se&&se[ht],P)}var Ll=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function _c(P,$){if(P){P=P.split("&");for(var se=0;se<P.length;se++){var Ee=P[se].indexOf("="),Ye=null;if(0<=Ee){var ht=P[se].substring(0,Ee);Ye=P[se].substring(Ee+1)}else ht=P[se];$(ht,Ye?decodeURIComponent(Ye.replace(/\+/g," ")):"")}}}function Ki(P){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,P instanceof Ki){this.h=P.h,Gr(this,P.j),this.o=P.o,this.g=P.g,Ml(this,P.s),this.l=P.l;var $=P.i,se=new Sa;se.i=$.i,$.g&&(se.g=new Map($.g),se.h=$.h),Eu(this,se),this.m=P.m}else P&&($=String(P).match(Ll))?(this.h=!1,Gr(this,$[1]||"",!0),this.o=yr($[2]||""),this.g=yr($[3]||"",!0),Ml(this,$[4]),this.l=yr($[5]||"",!0),Eu(this,$[6]||"",!0),this.m=yr($[7]||"")):(this.h=!1,this.i=new Sa(null,this.h))}Ki.prototype.toString=function(){var P=[],$=this.j;$&&P.push(Ul($,Ih,!0),":");var se=this.g;return(se||$=="file")&&(P.push("//"),($=this.o)&&P.push(Ul($,Ih,!0),"@"),P.push(encodeURIComponent(String(se)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),se=this.s,se!=null&&P.push(":",String(se))),(se=this.l)&&(this.g&&se.charAt(0)!="/"&&P.push("/"),P.push(Ul(se,se.charAt(0)=="/"?sm:Su,!0))),(se=this.i.toString())&&P.push("?",se),(se=this.m)&&P.push("#",Ul(se,Hp)),P.join("")};function li(P){return new Ki(P)}function Gr(P,$,se){P.j=se?yr($,!0):$,P.j&&(P.j=P.j.replace(/:$/,""))}function Ml(P,$){if($){if($=Number($),isNaN($)||0>$)throw Error("Bad port number "+$);P.s=$}else P.s=null}function Eu(P,$,se){$ instanceof Sa?(P.i=$,Ha(P.i,P.h)):(se||($=Ul($,Gp)),P.i=new Sa($,P.h))}function ui(P,$,se){P.i.set($,se)}function vu(P){return ui(P,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),P}function yr(P,$){return P?$?decodeURI(P.replace(/%25/g,"%2525")):decodeURIComponent(P):""}function Ul(P,$,se){return typeof P=="string"?(P=encodeURI(P).replace($,Rh),se&&(P=P.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),P):null}function Rh(P){return P=P.charCodeAt(0),"%"+(P>>4&15).toString(16)+(P&15).toString(16)}var Ih=/[#\/\?@]/g,Su=/[#\?:]/g,sm=/[#\?]/g,Gp=/[#\?@]/g,Hp=/#/g;function Sa(P,$){this.h=this.g=null,this.i=P||null,this.j=!!$}function _s(P){P.g||(P.g=new Map,P.h=0,P.i&&_c(P.i,function($,se){P.add(decodeURIComponent($.replace(/\+/g," ")),se)}))}n=Sa.prototype,n.add=function(P,$){_s(this),this.i=null,P=Ta(this,P);var se=this.g.get(P);return se||this.g.set(P,se=[]),se.push($),this.h+=1,this};function ba(P,$){_s(P),$=Ta(P,$),P.g.has($)&&(P.i=null,P.h-=P.g.get($).length,P.g.delete($))}function wa(P,$){return _s(P),$=Ta(P,$),P.g.has($)}n.forEach=function(P,$){_s(this),this.g.forEach(function(se,Ee){se.forEach(function(Ye){P.call($,Ye,Ee,this)},this)},this)},n.na=function(){_s(this);const P=Array.from(this.g.values()),$=Array.from(this.g.keys()),se=[];for(let Ee=0;Ee<$.length;Ee++){const Ye=P[Ee];for(let ht=0;ht<Ye.length;ht++)se.push($[Ee])}return se},n.V=function(P){_s(this);let $=[];if(typeof P=="string")wa(this,P)&&($=$.concat(this.g.get(Ta(this,P))));else{P=Array.from(this.g.values());for(let se=0;se<P.length;se++)$=$.concat(P[se])}return $},n.set=function(P,$){return _s(this),this.i=null,P=Ta(this,P),wa(this,P)&&(this.h-=this.g.get(P).length),this.g.set(P,[$]),this.h+=1,this},n.get=function(P,$){return P?(P=this.V(P),0<P.length?String(P[0]):$):$};function bu(P,$,se){ba(P,$),0<se.length&&(P.i=null,P.g.set(Ta(P,$),U(se)),P.h+=se.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const P=[],$=Array.from(this.g.keys());for(var se=0;se<$.length;se++){var Ee=$[se];const ht=encodeURIComponent(String(Ee)),$t=this.V(Ee);for(Ee=0;Ee<$t.length;Ee++){var Ye=ht;$t[Ee]!==""&&(Ye+="="+encodeURIComponent(String($t[Ee]))),P.push(Ye)}}return this.i=P.join("&")};function Ta(P,$){return $=String($),P.j&&($=$.toLowerCase()),$}function Ha(P,$){$&&!P.j&&(_s(P),P.i=null,P.g.forEach(function(se,Ee){var Ye=Ee.toLowerCase();Ee!=Ye&&(ba(this,Ee),bu(this,Ye,se))},P)),P.j=$}function $p(P,$){const se=new Ga;if(y.Image){const Ee=new Image;Ee.onload=L(Ds,se,"TestLoadImage: loaded",!0,$,Ee),Ee.onerror=L(Ds,se,"TestLoadImage: error",!1,$,Ee),Ee.onabort=L(Ds,se,"TestLoadImage: abort",!1,$,Ee),Ee.ontimeout=L(Ds,se,"TestLoadImage: timeout",!1,$,Ee),y.setTimeout(function(){Ee.ontimeout&&Ee.ontimeout()},1e4),Ee.src=P}else $(!1)}function $c(P,$){const se=new Ga,Ee=new AbortController,Ye=setTimeout(()=>{Ee.abort(),Ds(se,"TestPingServer: timeout",!1,$)},1e4);fetch(P,{signal:Ee.signal}).then(ht=>{clearTimeout(Ye),ht.ok?Ds(se,"TestPingServer: ok",!0,$):Ds(se,"TestPingServer: server error",!1,$)}).catch(()=>{clearTimeout(Ye),Ds(se,"TestPingServer: error",!1,$)})}function Ds(P,$,se,Ee,Ye){try{Ye&&(Ye.onload=null,Ye.onerror=null,Ye.onabort=null,Ye.ontimeout=null),Ee(se)}catch{}}function Jg(){this.g=new _o}function Vl(P,$,se){const Ee=se||"";try{Cr(P,function(Ye,ht){let $t=Ye;b(Ye)&&($t=Vi(Ye)),$.push(Ee+ht+"="+encodeURIComponent($t))})}catch(Ye){throw $.push(Ee+"type="+encodeURIComponent("_badmap")),Ye}}function jl(P){this.l=P.Ub||null,this.j=P.eb||!1}D(jl,Wr),jl.prototype.g=function(){return new wu(this.l,this.j)},jl.prototype.i=(function(P){return function(){return P}})({});function wu(P,$){Ut.call(this),this.D=P,this.o=$,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}D(wu,Ut),n=wu.prototype,n.open=function(P,$){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=P,this.A=$,this.readyState=1,Ca(this)},n.send=function(P){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const $={headers:this.u,method:this.B,credentials:this.m,cache:void 0};P&&($.body=P),(this.D||y).fetch(new Request(this.A,$)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,yc(this)),this.readyState=0},n.Sa=function(P){if(this.g&&(this.l=P,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=P.headers,this.readyState=2,Ca(this)),this.g&&(this.readyState=3,Ca(this),this.g)))if(this.responseType==="arraybuffer")P.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof y.ReadableStream<"u"&&"body"in P){if(this.j=P.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;om(this)}else P.text().then(this.Ra.bind(this),this.ga.bind(this))};function om(P){P.j.read().then(P.Pa.bind(P)).catch(P.ga.bind(P))}n.Pa=function(P){if(this.g){if(this.o&&P.value)this.response.push(P.value);else if(!this.o){var $=P.value?P.value:new Uint8Array(0);($=this.v.decode($,{stream:!P.done}))&&(this.response=this.responseText+=$)}P.done?yc(this):Ca(this),this.readyState==3&&om(this)}},n.Ra=function(P){this.g&&(this.response=this.responseText=P,yc(this))},n.Qa=function(P){this.g&&(this.response=P,yc(this))},n.ga=function(){this.g&&yc(this)};function yc(P){P.readyState=4,P.l=null,P.j=null,P.v=null,Ca(P)}n.setRequestHeader=function(P,$){this.u.append(P,$)},n.getResponseHeader=function(P){return this.h&&this.h.get(P.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const P=[],$=this.h.entries();for(var se=$.next();!se.done;)se=se.value,P.push(se[0]+": "+se[1]),se=$.next();return P.join(`\r
`)};function Ca(P){P.onreadystatechange&&P.onreadystatechange.call(P)}Object.defineProperty(wu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(P){this.m=P?"include":"same-origin"}});function Fl(P){let $="";return me(P,function(se,Ee){$+=Ee,$+=":",$+=se,$+=`\r
`}),$}function Ce(P,$,se){e:{for(Ee in se){var Ee=!1;break e}Ee=!0}Ee||(se=Fl(se),typeof P=="string"?se!=null&&encodeURIComponent(String(se)):ui(P,$,se))}function Me(P){Ut.call(this),this.headers=new Map,this.o=P||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}D(Me,Ut);var ct=/^https?$/i,Yt=["POST","PUT"];n=Me.prototype,n.Ha=function(P){this.J=P},n.ea=function(P,$,se,Ee){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+P);$=$?$.toUpperCase():"GET",this.D=P,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():xs.g(),this.v=this.o?Do(this.o):Do(xs),this.g.onreadystatechange=O(this.Ea,this);try{this.B=!0,this.g.open($,String(P),!0),this.B=!1}catch(ht){ar(this,ht);return}if(P=se||"",se=new Map(this.headers),Ee)if(Object.getPrototypeOf(Ee)===Object.prototype)for(var Ye in Ee)se.set(Ye,Ee[Ye]);else if(typeof Ee.keys=="function"&&typeof Ee.get=="function")for(const ht of Ee.keys())se.set(ht,Ee.get(ht));else throw Error("Unknown input type for opt_headers: "+String(Ee));Ee=Array.from(se.keys()).find(ht=>ht.toLowerCase()=="content-type"),Ye=y.FormData&&P instanceof y.FormData,!(0<=Array.prototype.indexOf.call(Yt,$,void 0))||Ee||Ye||se.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ht,$t]of se)this.g.setRequestHeader(ht,$t);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{nr(this),this.u=!0,this.g.send(P),this.u=!1}catch(ht){ar(this,ht)}};function ar(P,$){P.h=!1,P.g&&(P.j=!0,P.g.abort(),P.j=!1),P.l=$,P.m=5,Ur(P),tr(P)}function Ur(P){P.A||(P.A=!0,cn(P,"complete"),cn(P,"error"))}n.abort=function(P){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=P||7,cn(this,"complete"),cn(this,"abort"),tr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tr(this,!0)),Me.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?si(this):this.bb())},n.bb=function(){si(this)};function si(P){if(P.h&&typeof f<"u"&&(!P.v[1]||Pi(P)!=4||P.Z()!=2)){if(P.u&&Pi(P)==4)wn(P.Ea,0,P);else if(cn(P,"readystatechange"),Pi(P)==4){P.h=!1;try{const $t=P.Z();e:switch($t){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var $=!0;break e;default:$=!1}var se;if(!(se=$)){var Ee;if(Ee=$t===0){var Ye=String(P.D).match(Ll)[1]||null;!Ye&&y.self&&y.self.location&&(Ye=y.self.location.protocol.slice(0,-1)),Ee=!ct.test(Ye?Ye.toLowerCase():"")}se=Ee}if(se)cn(P,"complete"),cn(P,"success");else{P.m=6;try{var ht=2<Pi(P)?P.g.statusText:""}catch{ht=""}P.l=ht+" ["+P.Z()+"]",Ur(P)}}finally{tr(P)}}}}function tr(P,$){if(P.g){nr(P);const se=P.g,Ee=P.v[0]?()=>{}:null;P.g=null,P.v=null,$||cn(P,"ready");try{se.onreadystatechange=Ee}catch{}}}function nr(P){P.I&&(y.clearTimeout(P.I),P.I=null)}n.isActive=function(){return!!this.g};function Pi(P){return P.g?P.g.readyState:0}n.Z=function(){try{return 2<Pi(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(P){if(this.g){var $=this.g.responseText;return P&&$.indexOf(P)==0&&($=$.substring(P.length)),us($)}};function Js(P){try{if(!P.g)return null;if("response"in P.g)return P.g.response;switch(P.H){case"":case"text":return P.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in P.g)return P.g.mozResponseArrayBuffer}return null}catch{return null}}function Kc(P){const $={};P=(P.g&&2<=Pi(P)&&P.g.getAllResponseHeaders()||"").split(`\r
`);for(let Ee=0;Ee<P.length;Ee++){if(W(P[Ee]))continue;var se=pe(P[Ee]);const Ye=se[0];if(se=se[1],typeof se!="string")continue;se=se.trim();const ht=$[Ye]||[];$[Ye]=ht,ht.push(se)}q($,function(Ee){return Ee.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Lo(P,$,se){return se&&se.internalChannelParams&&se.internalChannelParams[P]||$}function Tu(P){this.Aa=0,this.i=[],this.j=new Ga,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Lo("failFast",!1,P),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Lo("baseRetryDelayMs",5e3,P),this.cb=Lo("retryDelaySeedMs",1e4,P),this.Wa=Lo("forwardChannelMaxRetries",2,P),this.wa=Lo("forwardChannelRequestTimeoutMs",2e4,P),this.pa=P&&P.xmlHttpFactory||void 0,this.Xa=P&&P.Tb||void 0,this.Ca=P&&P.useFetchStreams||!1,this.L=void 0,this.J=P&&P.supportsCrossDomainXhr||!1,this.K="",this.h=new qt(P&&P.concurrentRequestLimit),this.Da=new Jg,this.P=P&&P.fastHandshake||!1,this.O=P&&P.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=P&&P.Rb||!1,P&&P.xa&&this.j.xa(),P&&P.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&P&&P.detectBufferingProxy||!1,this.ja=void 0,P&&P.longPollingTimeout&&0<P.longPollingTimeout&&(this.ja=P.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Tu.prototype,n.la=8,n.G=1,n.connect=function(P,$,se,Ee){Kt(0),this.W=P,this.H=$||{},se&&Ee!==void 0&&(this.H.OSID=se,this.H.OAID=Ee),this.F=this.X,this.I=bd(this,null,this.W),qc(this)};function Ls(P){if(am(P),P.G==3){var $=P.U++,se=li(P.I);if(ui(se,"SID",P.K),ui(se,"RID",$),ui(se,"TYPE","terminate"),Sd(P,se),$=new na(P,P.j,$),$.L=2,$.v=vu(li(se)),se=!1,y.navigator&&y.navigator.sendBeacon)try{se=y.navigator.sendBeacon($.v.toString(),"")}catch{}!se&&y.Image&&(new Image().src=$.v,se=!0),se||($.g=e_($.j,null),$.g.ea($.v)),$.F=Date.now(),Xr($)}vE(P)}function Ec(P){P.g&&(Zg(P),P.g.cancel(),P.g=null)}function am(P){Ec(P),P.u&&(y.clearTimeout(P.u),P.u=null),cm(P),P.h.cancel(),P.s&&(typeof P.s=="number"&&y.clearTimeout(P.s),P.s=null)}function qc(P){if(!Kn(P.h)&&!P.s){P.s=!0;var $=P.Ga;we||Ne(),Re||(we(),Re=!0),Te.add($,P),P.B=0}}function Qg(P,$){return $i(P.h)>=P.h.j-(P.s?1:0)?!1:P.s?(P.i=$.D.concat(P.i),!0):P.G==1||P.G==2||P.B>=(P.Va?0:P.Wa)?!1:(P.s=Zo(O(P.Ga,P,$),EE(P,P.B)),P.B++,!0)}n.Ga=function(P){if(this.s)if(this.s=null,this.G==1){if(!P){this.U=Math.floor(1e5*Math.random()),P=this.U++;const Ye=new na(this,this.j,P);let ht=this.o;if(this.S&&(ht?(ht=J(ht),ie(ht,this.S)):ht=this.S),this.m!==null||this.O||(Ye.H=ht,ht=null),this.P)e:{for(var $=0,se=0;se<this.i.length;se++){t:{var Ee=this.i[se];if("__data__"in Ee.map&&(Ee=Ee.map.__data__,typeof Ee=="string")){Ee=Ee.length;break t}Ee=void 0}if(Ee===void 0)break;if($+=Ee,4096<$){$=se;break e}if($===4096||se===this.i.length-1){$=se+1;break e}}$=1e3}else $=1e3;$=Ph(this,Ye,$),se=li(this.I),ui(se,"RID",P),ui(se,"CVER",22),this.D&&ui(se,"X-HTTP-Session-Id",this.D),Sd(this,se),ht&&(this.O?$="headers="+encodeURIComponent(String(Fl(ht)))+"&"+$:this.m&&Ce(se,this.m,ht)),Gc(this.h,Ye),this.Ua&&ui(se,"TYPE","init"),this.P?(ui(se,"$req",$),ui(se,"SID","null"),Ye.T=!0,va(Ye,se,null)):va(Ye,se,$),this.G=2}}else this.G==3&&(P?Ah(this,P):this.i.length==0||Kn(this.h)||Ah(this))};function Ah(P,$){var se;$?se=$.l:se=P.U++;const Ee=li(P.I);ui(Ee,"SID",P.K),ui(Ee,"RID",se),ui(Ee,"AID",P.T),Sd(P,Ee),P.m&&P.o&&Ce(Ee,P.m,P.o),se=new na(P,P.j,se,P.B+1),P.m===null&&(se.H=P.o),$&&(P.i=$.D.concat(P.i)),$=Ph(P,se,1e3),se.I=Math.round(.5*P.wa)+Math.round(.5*P.wa*Math.random()),Gc(P.h,se),va(se,Ee,$)}function Sd(P,$){P.H&&me(P.H,function(se,Ee){ui($,Ee,se)}),P.l&&Cr({},function(se,Ee){ui($,Ee,se)})}function Ph(P,$,se){se=Math.min(P.i.length,se);var Ee=P.l?O(P.l.Na,P.l,P):null;e:{var Ye=P.i;let ht=-1;for(;;){const $t=["count="+se];ht==-1?0<se?(ht=Ye[0].g,$t.push("ofs="+ht)):ht=0:$t.push("ofs="+ht);let oi=!0;for(let Qs=0;Qs<se;Qs++){let fr=Ye[Qs].g;const vo=Ye[Qs].map;if(fr-=ht,0>fr)ht=Math.max(0,Ye[Qs].g-100),oi=!1;else try{Vl(vo,$t,"req"+fr+"_")}catch{Ee&&Ee(vo)}}if(oi){Ee=$t.join("&");break e}}}return P=P.i.splice(0,se),$.D=P,Ee}function vc(P){if(!P.g&&!P.u){P.Y=1;var $=P.Fa;we||Ne(),Re||(we(),Re=!0),Te.add($,P),P.v=0}}function Cu(P){return P.g||P.u||3<=P.v?!1:(P.Y++,P.u=Zo(O(P.Fa,P),EE(P,P.v)),P.v++,!0)}n.Fa=function(){if(this.u=null,yE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var P=2*this.R;this.j.info("BP detection timer enabled: "+P),this.A=Zo(O(this.ab,this),P)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Kt(10),Ec(this),yE(this))};function Zg(P){P.A!=null&&(y.clearTimeout(P.A),P.A=null)}function yE(P){P.g=new na(P,P.j,"rpc",P.Y),P.m===null&&(P.g.H=P.o),P.g.O=0;var $=li(P.qa);ui($,"RID","rpc"),ui($,"SID",P.K),ui($,"AID",P.T),ui($,"CI",P.F?"0":"1"),!P.F&&P.ja&&ui($,"TO",P.ja),ui($,"TYPE","xmlhttp"),Sd(P,$),P.m&&P.o&&Ce($,P.m,P.o),P.L&&(P.g.I=P.L);var se=P.g;P=P.ia,se.L=1,se.v=vu(li($)),se.m=null,se.P=!0,xl(se,P)}n.Za=function(){this.C!=null&&(this.C=null,Ec(this),Cu(this),Kt(19))};function cm(P){P.C!=null&&(y.clearTimeout(P.C),P.C=null)}function lm(P,$){var se=null;if(P.g==$){cm(P),Zg(P),P.g=null;var Ee=2}else if(gs(P.h,$))se=$.D,Ch(P.h,$),Ee=1;else return;if(P.G!=0){if($.o)if(Ee==1){se=$.m?$.m.length:0,$=Date.now()-$.F;var Ye=P.B;Ee=Eo(),cn(Ee,new zc(Ee,se)),qc(P)}else vc(P);else if(Ye=$.s,Ye==3||Ye==0&&0<$.X||!(Ee==1&&Qg(P,$)||Ee==2&&Cu(P)))switch(se&&0<se.length&&($=P.h,$.i=$.i.concat(se)),Ye){case 1:$a(P,5);break;case 4:$a(P,10);break;case 3:$a(P,6);break;default:$a(P,2)}}}function EE(P,$){let se=P.Ta+Math.floor(Math.random()*P.cb);return P.isActive()||(se*=2),se*$}function $a(P,$){if(P.j.info("Error code "+$),$==2){var se=O(P.fb,P),Ee=P.Xa;const Ye=!Ee;Ee=new Ki(Ee||"//www.google.com/images/cleardot.gif"),y.location&&y.location.protocol=="http"||Gr(Ee,"https"),vu(Ee),Ye?$p(Ee.toString(),se):$c(Ee.toString(),se)}else Kt(2);P.G=0,P.l&&P.l.sa($),vE(P),am(P)}n.fb=function(P){P?(this.j.info("Successfully pinged google.com"),Kt(2)):(this.j.info("Failed to ping google.com"),Kt(1))};function vE(P){if(P.G=0,P.ka=[],P.l){const $=gc(P.h);($.length!=0||P.i.length!=0)&&(B(P.ka,$),B(P.ka,P.i),P.h.i.length=0,U(P.i),P.i.length=0),P.l.ra()}}function bd(P,$,se){var Ee=se instanceof Ki?li(se):new Ki(se);if(Ee.g!="")$&&(Ee.g=$+"."+Ee.g),Ml(Ee,Ee.s);else{var Ye=y.location;Ee=Ye.protocol,$=$?$+"."+Ye.hostname:Ye.hostname,Ye=+Ye.port;var ht=new Ki(null);Ee&&Gr(ht,Ee),$&&(ht.g=$),Ye&&Ml(ht,Ye),se&&(ht.l=se),Ee=ht}return se=P.D,$=P.ya,se&&$&&ui(Ee,se,$),ui(Ee,"VER",P.la),Sd(P,Ee),Ee}function e_(P,$,se){if($&&!P.J)throw Error("Can't create secondary domain capable XhrIo object.");return $=P.Ca&&!P.pa?new Me(new jl({eb:se})):new Me(P.pa),$.Ha(P.J),$}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function t_(){}n=t_.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Hn(){}Hn.prototype.g=function(P,$){return new Ra(P,$)};function Ra(P,$){Ut.call(this),this.g=new Tu($),this.l=P,this.h=$&&$.messageUrlParams||null,P=$&&$.messageHeaders||null,$&&$.clientProtocolHeaderRequired&&(P?P["X-Client-Protocol"]="webchannel":P={"X-Client-Protocol":"webchannel"}),this.g.o=P,P=$&&$.initMessageHeaders||null,$&&$.messageContentType&&(P?P["X-WebChannel-Content-Type"]=$.messageContentType:P={"X-WebChannel-Content-Type":$.messageContentType}),$&&$.va&&(P?P["X-WebChannel-Client-Profile"]=$.va:P={"X-WebChannel-Client-Profile":$.va}),this.g.S=P,(P=$&&$.Sb)&&!W(P)&&(this.g.m=P),this.v=$&&$.supportsCrossDomainXhr||!1,this.u=$&&$.sendRawJson||!1,($=$&&$.httpSessionIdParam)&&!W($)&&(this.g.D=$,P=this.h,P!==null&&$ in P&&(P=this.h,$ in P&&delete P[$])),this.j=new Ru(this)}D(Ra,Ut),Ra.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ra.prototype.close=function(){Ls(this.g)},Ra.prototype.o=function(P){var $=this.g;if(typeof P=="string"){var se={};se.__data__=P,P=se}else this.u&&(se={},se.__data__=Vi(P),P=se);$.i.push(new Je($.Ya++,P)),$.G==3&&qc($)},Ra.prototype.N=function(){this.g.l=null,delete this.j,Ls(this.g),delete this.g,Ra.aa.N.call(this)};function SE(P){yo.call(this),P.__headers__&&(this.headers=P.__headers__,this.statusCode=P.__status__,delete P.__headers__,delete P.__status__);var $=P.__sm__;if($){e:{for(const se in $){P=se;break e}P=void 0}(this.i=P)&&(P=this.i,$=$!==null&&P in $?$[P]:void 0),this.data=$}else this.data=P}D(SE,yo);function bE(){Ys.call(this),this.status=1}D(bE,Ys);function Ru(P){this.g=P}D(Ru,t_),Ru.prototype.ua=function(){cn(this.g,"a")},Ru.prototype.ta=function(P){cn(this.g,new SE(P))},Ru.prototype.sa=function(P){cn(this.g,new bE)},Ru.prototype.ra=function(){cn(this.g,"b")},Hn.prototype.createWebChannel=Hn.prototype.g,Ra.prototype.send=Ra.prototype.o,Ra.prototype.open=Ra.prototype.m,Ra.prototype.close=Ra.prototype.close,tse=function(){return new Hn},ese=function(){return Eo()},Zie=Zi,o5={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Pl.NO_ERROR=0,Pl.TIMEOUT=8,Pl.HTTP_ERROR=6,UO=Pl,bh.COMPLETE="complete",Qie=bh,Fc.EventType=Yr,Yr.OPEN="a",Yr.CLOSE="b",Yr.ERROR="c",Yr.MESSAGE="d",Ut.prototype.listen=Ut.prototype.K,_C=Fc,Me.prototype.listenOnce=Me.prototype.L,Me.prototype.getLastError=Me.prototype.Ka,Me.prototype.getLastErrorCode=Me.prototype.Ba,Me.prototype.getStatus=Me.prototype.Z,Me.prototype.getResponseJson=Me.prototype.Oa,Me.prototype.getResponseText=Me.prototype.oa,Me.prototype.send=Me.prototype.ea,Me.prototype.setWithCredentials=Me.prototype.Ha,Jie=Me}).apply(typeof rO<"u"?rO:typeof self<"u"?self:typeof window<"u"?window:{});const wJ="@firebase/firestore",TJ="4.8.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dc{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}dc.UNAUTHENTICATED=new dc(null),dc.GOOGLE_CREDENTIALS=new dc("google-credentials-uid"),dc.FIRST_PARTY=new dc("first-party-uid"),dc.MOCK_USER=new dc("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tb="11.10.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sE=new Sj("@firebase/firestore");function N0(){return sE.logLevel}function fn(n,...e){if(sE.logLevel<=Fr.DEBUG){const i=e.map(kj);sE.debug(`Firestore (${tb}): ${n}`,...i)}}function Jf(n,...e){if(sE.logLevel<=Fr.ERROR){const i=e.map(kj);sE.error(`Firestore (${tb}): ${n}`,...i)}}function Ug(n,...e){if(sE.logLevel<=Fr.WARN){const i=e.map(kj);sE.warn(`Firestore (${tb}): ${n}`,...i)}}function kj(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(i){return JSON.stringify(i)})(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zn(n,e,i){let o="Unexpected state";typeof e=="string"?o=e:i=e,nse(n,o,i)}function nse(n,e,i){let o=`FIRESTORE (${tb}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(i!==void 0)try{o+=" CONTEXT: "+JSON.stringify(i)}catch{o+=" CONTEXT: "+i}throw Jf(o),new Error(o)}function bi(n,e,i,o){let l="Unexpected state";typeof i=="string"?l=i:o=i,n||nse(e,l,o)}function pr(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class sn extends Eh{constructor(e,i){super(e,i),this.code=e,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zf{constructor(){this.promise=new Promise(((e,i)=>{this.resolve=e,this.reject=i}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rse{constructor(e,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Gje{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,i){e.enqueueRetryable((()=>i(dc.UNAUTHENTICATED)))}shutdown(){}}class Hje{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,i){this.changeListener=i,e.enqueueRetryable((()=>i(this.token.user)))}shutdown(){this.changeListener=null}}class $je{constructor(e){this.t=e,this.currentUser=dc.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,i){bi(this.o===void 0,42304);let o=this.i;const l=v=>this.i!==o?(o=this.i,i(v)):Promise.resolve();let u=new zf;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new zf,e.enqueueRetryable((()=>l(this.currentUser)))};const f=()=>{const v=u;e.enqueueRetryable((async()=>{await v.promise,await l(this.currentUser)}))},y=v=>{fn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=v,this.o&&(this.auth.addAuthTokenListener(this.o),f())};this.t.onInit((v=>y(v))),setTimeout((()=>{if(!this.auth){const v=this.t.getImmediate({optional:!0});v?y(v):(fn("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new zf)}}),0),f()}getToken(){const e=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then((o=>this.i!==e?(fn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):o?(bi(typeof o.accessToken=="string",31837,{l:o}),new rse(o.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return bi(e===null||typeof e=="string",2055,{h:e}),new dc(e)}}class Kje{constructor(e,i,o){this.P=e,this.T=i,this.I=o,this.type="FirstParty",this.user=dc.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class qje{constructor(e,i,o){this.P=e,this.T=i,this.I=o}getToken(){return Promise.resolve(new Kje(this.P,this.T,this.I))}start(e,i){e.enqueueRetryable((()=>i(dc.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class CJ{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Yje{constructor(e,i){this.V=i,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,vl(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,i){bi(this.o===void 0,3512);const o=u=>{u.error!=null&&fn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${u.error.message}`);const f=u.token!==this.m;return this.m=u.token,fn("FirebaseAppCheckTokenProvider",`Received ${f?"new":"existing"} token.`),f?i(u.token):Promise.resolve()};this.o=u=>{e.enqueueRetryable((()=>o(u)))};const l=u=>{fn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=u,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((u=>l(u))),setTimeout((()=>{if(!this.appCheck){const u=this.V.getImmediate({optional:!0});u?l(u):fn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new CJ(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((i=>i?(bi(typeof i.token=="string",44558,{tokenResult:i}),this.m=i.token,new CJ(i.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xje(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(i);else for(let o=0;o<n;o++)i[o]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ise(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nj{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=62*Math.floor(4.129032258064516);let o="";for(;o.length<20;){const l=Xje(40);for(let u=0;u<l.length;++u)o.length<20&&l[u]<i&&(o+=e.charAt(l[u]%62))}return o}}function Or(n,e){return n<e?-1:n>e?1:0}function a5(n,e){let i=0;for(;i<n.length&&i<e.length;){const o=n.codePointAt(i),l=e.codePointAt(i);if(o!==l){if(o<128&&l<128)return Or(o,l);{const u=ise(),f=Jje(u.encode(RJ(n,i)),u.encode(RJ(e,i)));return f!==0?f:Or(o,l)}}i+=o>65535?2:1}return Or(n.length,e.length)}function RJ(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function Jje(n,e){for(let i=0;i<n.length&&i<e.length;++i)if(n[i]!==e[i])return Or(n[i],e[i]);return Or(n.length,e.length)}function MS(n,e,i){return n.length===e.length&&n.every(((o,l)=>i(o,e[l])))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IJ="__name__";class _p{constructor(e,i,o){i===void 0?i=0:i>e.length&&Zn(637,{offset:i,range:e.length}),o===void 0?o=e.length-i:o>e.length-i&&Zn(1746,{length:o,range:e.length-i}),this.segments=e,this.offset=i,this.len=o}get length(){return this.len}isEqual(e){return _p.comparator(this,e)===0}child(e){const i=this.segments.slice(this.offset,this.limit());return e instanceof _p?e.forEach((o=>{i.push(o)})):i.push(e),this.construct(i)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==e.get(i))return!1;return!0}forEach(e){for(let i=this.offset,o=this.limit();i<o;i++)e(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,i){const o=Math.min(e.length,i.length);for(let l=0;l<o;l++){const u=_p.compareSegments(e.get(l),i.get(l));if(u!==0)return u}return Or(e.length,i.length)}static compareSegments(e,i){const o=_p.isNumericId(e),l=_p.isNumericId(i);return o&&!l?-1:!o&&l?1:o&&l?_p.extractNumericId(e).compare(_p.extractNumericId(i)):a5(e,i)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return kg.fromString(e.substring(4,e.length-2))}}class Ji extends _p{construct(e,i,o){return new Ji(e,i,o)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const i=[];for(const o of e){if(o.indexOf("//")>=0)throw new sn(Tt.INVALID_ARGUMENT,`Invalid segment (${o}). Paths must not contain // in them.`);i.push(...o.split("/").filter((l=>l.length>0)))}return new Ji(i)}static emptyPath(){return new Ji([])}}const Qje=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ja extends _p{construct(e,i,o){return new ja(e,i,o)}static isValidIdentifier(e){return Qje.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ja.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===IJ}static keyField(){return new ja([IJ])}static fromServerFormat(e){const i=[];let o="",l=0;const u=()=>{if(o.length===0)throw new sn(Tt.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(o),o=""};let f=!1;for(;l<e.length;){const y=e[l];if(y==="\\"){if(l+1===e.length)throw new sn(Tt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const v=e[l+1];if(v!=="\\"&&v!=="."&&v!=="`")throw new sn(Tt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);o+=v,l+=2}else y==="`"?(f=!f,l++):y!=="."||f?(o+=y,l++):(u(),l++)}if(u(),f)throw new sn(Tt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ja(i)}static emptyPath(){return new ja([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xn{constructor(e){this.path=e}static fromPath(e){return new xn(Ji.fromString(e))}static fromName(e){return new xn(Ji.fromString(e).popFirst(5))}static empty(){return new xn(Ji.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ji.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,i){return Ji.comparator(e.path,i.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new xn(new Ji(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sse(n,e,i){if(!i)throw new sn(Tt.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Zje(n,e,i,o){if(e===!0&&o===!0)throw new sn(Tt.INVALID_ARGUMENT,`${n} and ${i} cannot be used together.`)}function AJ(n){if(!xn.isDocumentKey(n))throw new sn(Tt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function PJ(n){if(xn.isDocumentKey(n))throw new sn(Tt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function ose(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function vN(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(o){return o.constructor?o.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Zn(12329,{type:typeof n})}function Rl(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new sn(Tt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=vN(n);throw new sn(Tt.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return n}function eFe(n,e){if(e<=0)throw new sn(Tt.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oo(n,e){const i={typeString:n};return e&&(i.value=e),i}function qR(n,e){if(!ose(n))throw new sn(Tt.INVALID_ARGUMENT,"JSON must be an object");let i;for(const o in e)if(e[o]){const l=e[o].typeString,u="value"in e[o]?{value:e[o].value}:void 0;if(!(o in n)){i=`JSON missing required field: '${o}'`;break}const f=n[o];if(l&&typeof f!==l){i=`JSON field '${o}' must be a ${l}.`;break}if(u!==void 0&&f!==u.value){i=`Expected '${o}' field to equal '${u.value}'`;break}}if(i)throw new sn(Tt.INVALID_ARGUMENT,i);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OJ=-62135596800,kJ=1e6;class as{static now(){return as.fromMillis(Date.now())}static fromDate(e){return as.fromMillis(e.getTime())}static fromMillis(e){const i=Math.floor(e/1e3),o=Math.floor((e-1e3*i)*kJ);return new as(i,o)}constructor(e,i){if(this.seconds=e,this.nanoseconds=i,i<0)throw new sn(Tt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new sn(Tt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(e<OJ)throw new sn(Tt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new sn(Tt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/kJ}_compareTo(e){return this.seconds===e.seconds?Or(this.nanoseconds,e.nanoseconds):Or(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:as._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(qR(e,as._jsonSchema))return new as(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-OJ;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}as._jsonSchemaVersion="firestore/timestamp/1.0",as._jsonSchema={type:Oo("string",as._jsonSchemaVersion),seconds:Oo("number"),nanoseconds:Oo("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lr{static fromTimestamp(e){return new lr(e)}static min(){return new lr(new as(0,0))}static max(){return new lr(new as(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yR=-1;function tFe(n,e){const i=n.toTimestamp().seconds,o=n.toTimestamp().nanoseconds+1,l=lr.fromTimestamp(o===1e9?new as(i+1,0):new as(i,o));return new Vg(l,xn.empty(),e)}function nFe(n){return new Vg(n.readTime,n.key,yR)}class Vg{constructor(e,i,o){this.readTime=e,this.documentKey=i,this.largestBatchId=o}static min(){return new Vg(lr.min(),xn.empty(),yR)}static max(){return new Vg(lr.max(),xn.empty(),yR)}}function rFe(n,e){let i=n.readTime.compareTo(e.readTime);return i!==0?i:(i=xn.comparator(n.documentKey,e.documentKey),i!==0?i:Or(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iFe="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class sFe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nb(n){if(n.code!==Tt.FAILED_PRECONDITION||n.message!==iFe)throw n;fn("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class At{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)}),(i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)}))}catch(e){return this.next(void 0,e)}next(e,i){return this.callbackAttached&&Zn(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(e,this.result):new At(((o,l)=>{this.nextCallback=u=>{this.wrapSuccess(e,u).next(o,l)},this.catchCallback=u=>{this.wrapFailure(i,u).next(o,l)}}))}toPromise(){return new Promise(((e,i)=>{this.next(e,i)}))}wrapUserFunction(e){try{const i=e();return i instanceof At?i:At.resolve(i)}catch(i){return At.reject(i)}}wrapSuccess(e,i){return e?this.wrapUserFunction((()=>e(i))):At.resolve(i)}wrapFailure(e,i){return e?this.wrapUserFunction((()=>e(i))):At.reject(i)}static resolve(e){return new At(((i,o)=>{i(e)}))}static reject(e){return new At(((i,o)=>{o(e)}))}static waitFor(e){return new At(((i,o)=>{let l=0,u=0,f=!1;e.forEach((y=>{++l,y.next((()=>{++u,f&&u===l&&i()}),(v=>o(v)))})),f=!0,u===l&&i()}))}static or(e){let i=At.resolve(!1);for(const o of e)i=i.next((l=>l?At.resolve(l):o()));return i}static forEach(e,i){const o=[];return e.forEach(((l,u)=>{o.push(i.call(this,l,u))})),this.waitFor(o)}static mapArray(e,i){return new At(((o,l)=>{const u=e.length,f=new Array(u);let y=0;for(let v=0;v<u;v++){const b=v;i(e[b]).next((C=>{f[b]=C,++y,y===u&&o(f)}),(C=>l(C)))}}))}static doWhile(e,i){return new At(((o,l)=>{const u=()=>{e()===!0?i().next((()=>{u()}),l):o()};u()}))}}function oFe(n){const e=n.match(/Android ([\d.]+)/i),i=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function rb(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SN{constructor(e,i){this.previousValue=e,i&&(i.sequenceNumberHandler=o=>this._e(o),this.ae=o=>i.writeSequenceNumber(o))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ae&&this.ae(e),e}}SN.ue=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xj=-1;function bN(n){return n==null}function Ek(n){return n===0&&1/n==-1/0}function aFe(n){return typeof n=="number"&&Number.isInteger(n)&&!Ek(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ase="";function cFe(n){let e="";for(let i=0;i<n.length;i++)e.length>0&&(e=NJ(e)),e=lFe(n.get(i),e);return NJ(e)}function lFe(n,e){let i=e;const o=n.length;for(let l=0;l<o;l++){const u=n.charAt(l);switch(u){case"\0":i+="";break;case ase:i+="";break;default:i+=u}}return i}function NJ(n){return n+ase+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xJ(n){let e=0;for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e++;return e}function Yg(n,e){for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&e(i,n[i])}function cse(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ks{constructor(e,i){this.comparator=e,this.root=i||Ua.EMPTY}insert(e,i){return new ks(this.comparator,this.root.insert(e,i,this.comparator).copy(null,null,Ua.BLACK,null,null))}remove(e){return new ks(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ua.BLACK,null,null))}get(e){let i=this.root;for(;!i.isEmpty();){const o=this.comparator(e,i.key);if(o===0)return i.value;o<0?i=i.left:o>0&&(i=i.right)}return null}indexOf(e){let i=0,o=this.root;for(;!o.isEmpty();){const l=this.comparator(e,o.key);if(l===0)return i+o.left.size;l<0?o=o.left:(i+=o.left.size+1,o=o.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((i,o)=>(e(i,o),!1)))}toString(){const e=[];return this.inorderTraversal(((i,o)=>(e.push(`${i}:${o}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new iO(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new iO(this.root,e,this.comparator,!1)}getReverseIterator(){return new iO(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new iO(this.root,e,this.comparator,!0)}}class iO{constructor(e,i,o,l){this.isReverse=l,this.nodeStack=[];let u=1;for(;!e.isEmpty();)if(u=i?o(e.key,i):1,i&&l&&(u*=-1),u<0)e=this.isReverse?e.left:e.right;else{if(u===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const i={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ua{constructor(e,i,o,l,u){this.key=e,this.value=i,this.color=o??Ua.RED,this.left=l??Ua.EMPTY,this.right=u??Ua.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,i,o,l,u){return new Ua(e??this.key,i??this.value,o??this.color,l??this.left,u??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,o){let l=this;const u=o(e,l.key);return l=u<0?l.copy(null,null,null,l.left.insert(e,i,o),null):u===0?l.copy(null,i,null,null,null):l.copy(null,null,null,null,l.right.insert(e,i,o)),l.fixUp()}removeMin(){if(this.left.isEmpty())return Ua.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,i){let o,l=this;if(i(e,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(e,i),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),i(e,l.key)===0){if(l.right.isEmpty())return Ua.EMPTY;o=l.right.min(),l=l.copy(o.key,o.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(e,i))}return l.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ua.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ua.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Zn(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Zn(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Zn(27949);return e+(this.isRed()?0:1)}}Ua.EMPTY=null,Ua.RED=!0,Ua.BLACK=!1;Ua.EMPTY=new class{constructor(){this.size=0}get key(){throw Zn(57766)}get value(){throw Zn(16141)}get color(){throw Zn(16727)}get left(){throw Zn(29726)}get right(){throw Zn(36894)}copy(e,i,o,l,u){return this}insert(e,i,o){return new Ua(e,i)}remove(e,i){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yo{constructor(e){this.comparator=e,this.data=new ks(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((i,o)=>(e(i),!1)))}forEachInRange(e,i){const o=this.data.getIteratorFrom(e[0]);for(;o.hasNext();){const l=o.getNext();if(this.comparator(l.key,e[1])>=0)return;i(l.key)}}forEachWhile(e,i){let o;for(o=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();o.hasNext();)if(!e(o.getNext().key))return}firstAfterOrEqual(e){const i=this.data.getIteratorFrom(e);return i.hasNext()?i.getNext().key:null}getIterator(){return new DJ(this.data.getIterator())}getIteratorFrom(e){return new DJ(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let i=this;return i.size<e.size&&(i=e,e=this),e.forEach((o=>{i=i.add(o)})),i}isEqual(e){if(!(e instanceof Yo)||this.size!==e.size)return!1;const i=this.data.getIterator(),o=e.data.getIterator();for(;i.hasNext();){const l=i.getNext().key,u=o.getNext().key;if(this.comparator(l,u)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((i=>{e.push(i)})),e}toString(){const e=[];return this.forEach((i=>e.push(i))),"SortedSet("+e.toString()+")"}copy(e){const i=new Yo(this.comparator);return i.data=e,i}}class DJ{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class du{constructor(e){this.fields=e,e.sort(ja.comparator)}static empty(){return new du([])}unionWith(e){let i=new Yo(ja.comparator);for(const o of this.fields)i=i.add(o);for(const o of e)i=i.add(o);return new du(i.toArray())}covers(e){for(const i of this.fields)if(i.isPrefixOf(e))return!0;return!1}isEqual(e){return MS(this.fields,e.fields,((i,o)=>i.isEqual(o)))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lse extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fa{constructor(e){this.binaryString=e}static fromBase64String(e){const i=(function(l){try{return atob(l)}catch(u){throw typeof DOMException<"u"&&u instanceof DOMException?new lse("Invalid base64 string: "+u):u}})(e);return new Fa(i)}static fromUint8Array(e){const i=(function(l){let u="";for(let f=0;f<l.length;++f)u+=String.fromCharCode(l[f]);return u})(e);return new Fa(i)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(i){return btoa(i)})(this.binaryString)}toUint8Array(){return(function(i){const o=new Uint8Array(i.length);for(let l=0;l<i.length;l++)o[l]=i.charCodeAt(l);return o})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Or(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Fa.EMPTY_BYTE_STRING=new Fa("");const uFe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function jg(n){if(bi(!!n,39018),typeof n=="string"){let e=0;const i=uFe.exec(n);if(bi(!!i,46558,{timestamp:n}),i[1]){let l=i[1];l=(l+"000000000").substr(0,9),e=Number(l)}const o=new Date(n);return{seconds:Math.floor(o.getTime()/1e3),nanos:e}}return{seconds:uo(n.seconds),nanos:uo(n.nanos)}}function uo(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Fg(n){return typeof n=="string"?Fa.fromBase64String(n):Fa.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const use="server_timestamp",dse="__type__",hse="__previous_value__",pse="__local_write_time__";function Dj(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[dse])===null||i===void 0?void 0:i.stringValue)===use}function wN(n){const e=n.mapValue.fields[hse];return Dj(e)?wN(e):e}function ER(n){const e=jg(n.mapValue.fields[pse].timestampValue);return new as(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dFe{constructor(e,i,o,l,u,f,y,v,b,C){this.databaseId=e,this.appId=i,this.persistenceKey=o,this.host=l,this.ssl=u,this.forceLongPolling=f,this.autoDetectLongPolling=y,this.longPollingOptions=v,this.useFetchStreams=b,this.isUsingEmulator=C}}const vk="(default)";class vR{constructor(e,i){this.projectId=e,this.database=i||vk}static empty(){return new vR("","")}get isDefaultDatabase(){return this.database===vk}isEqual(e){return e instanceof vR&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fse="__type__",hFe="__max__",sO={mapValue:{}},mse="__vector__",Sk="value";function Bg(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Dj(n)?4:fFe(n)?9007199254740991:pFe(n)?10:11:Zn(28295,{value:n})}function Fp(n,e){if(n===e)return!0;const i=Bg(n);if(i!==Bg(e))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ER(n).isEqual(ER(e));case 3:return(function(l,u){if(typeof l.timestampValue=="string"&&typeof u.timestampValue=="string"&&l.timestampValue.length===u.timestampValue.length)return l.timestampValue===u.timestampValue;const f=jg(l.timestampValue),y=jg(u.timestampValue);return f.seconds===y.seconds&&f.nanos===y.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(l,u){return Fg(l.bytesValue).isEqual(Fg(u.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(l,u){return uo(l.geoPointValue.latitude)===uo(u.geoPointValue.latitude)&&uo(l.geoPointValue.longitude)===uo(u.geoPointValue.longitude)})(n,e);case 2:return(function(l,u){if("integerValue"in l&&"integerValue"in u)return uo(l.integerValue)===uo(u.integerValue);if("doubleValue"in l&&"doubleValue"in u){const f=uo(l.doubleValue),y=uo(u.doubleValue);return f===y?Ek(f)===Ek(y):isNaN(f)&&isNaN(y)}return!1})(n,e);case 9:return MS(n.arrayValue.values||[],e.arrayValue.values||[],Fp);case 10:case 11:return(function(l,u){const f=l.mapValue.fields||{},y=u.mapValue.fields||{};if(xJ(f)!==xJ(y))return!1;for(const v in f)if(f.hasOwnProperty(v)&&(y[v]===void 0||!Fp(f[v],y[v])))return!1;return!0})(n,e);default:return Zn(52216,{left:n})}}function SR(n,e){return(n.values||[]).find((i=>Fp(i,e)))!==void 0}function US(n,e){if(n===e)return 0;const i=Bg(n),o=Bg(e);if(i!==o)return Or(i,o);switch(i){case 0:case 9007199254740991:return 0;case 1:return Or(n.booleanValue,e.booleanValue);case 2:return(function(u,f){const y=uo(u.integerValue||u.doubleValue),v=uo(f.integerValue||f.doubleValue);return y<v?-1:y>v?1:y===v?0:isNaN(y)?isNaN(v)?0:-1:1})(n,e);case 3:return LJ(n.timestampValue,e.timestampValue);case 4:return LJ(ER(n),ER(e));case 5:return a5(n.stringValue,e.stringValue);case 6:return(function(u,f){const y=Fg(u),v=Fg(f);return y.compareTo(v)})(n.bytesValue,e.bytesValue);case 7:return(function(u,f){const y=u.split("/"),v=f.split("/");for(let b=0;b<y.length&&b<v.length;b++){const C=Or(y[b],v[b]);if(C!==0)return C}return Or(y.length,v.length)})(n.referenceValue,e.referenceValue);case 8:return(function(u,f){const y=Or(uo(u.latitude),uo(f.latitude));return y!==0?y:Or(uo(u.longitude),uo(f.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return MJ(n.arrayValue,e.arrayValue);case 10:return(function(u,f){var y,v,b,C;const R=u.fields||{},O=f.fields||{},L=(y=R[Sk])===null||y===void 0?void 0:y.arrayValue,D=(v=O[Sk])===null||v===void 0?void 0:v.arrayValue,U=Or(((b=L==null?void 0:L.values)===null||b===void 0?void 0:b.length)||0,((C=D==null?void 0:D.values)===null||C===void 0?void 0:C.length)||0);return U!==0?U:MJ(L,D)})(n.mapValue,e.mapValue);case 11:return(function(u,f){if(u===sO.mapValue&&f===sO.mapValue)return 0;if(u===sO.mapValue)return 1;if(f===sO.mapValue)return-1;const y=u.fields||{},v=Object.keys(y),b=f.fields||{},C=Object.keys(b);v.sort(),C.sort();for(let R=0;R<v.length&&R<C.length;++R){const O=a5(v[R],C[R]);if(O!==0)return O;const L=US(y[v[R]],b[C[R]]);if(L!==0)return L}return Or(v.length,C.length)})(n.mapValue,e.mapValue);default:throw Zn(23264,{le:i})}}function LJ(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Or(n,e);const i=jg(n),o=jg(e),l=Or(i.seconds,o.seconds);return l!==0?l:Or(i.nanos,o.nanos)}function MJ(n,e){const i=n.values||[],o=e.values||[];for(let l=0;l<i.length&&l<o.length;++l){const u=US(i[l],o[l]);if(u)return u}return Or(i.length,o.length)}function VS(n){return c5(n)}function c5(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(i){const o=jg(i);return`time(${o.seconds},${o.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(i){return Fg(i).toBase64()})(n.bytesValue):"referenceValue"in n?(function(i){return xn.fromName(i).toString()})(n.referenceValue):"geoPointValue"in n?(function(i){return`geo(${i.latitude},${i.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(i){let o="[",l=!0;for(const u of i.values||[])l?l=!1:o+=",",o+=c5(u);return o+"]"})(n.arrayValue):"mapValue"in n?(function(i){const o=Object.keys(i.fields||{}).sort();let l="{",u=!0;for(const f of o)u?u=!1:l+=",",l+=`${f}:${c5(i.fields[f])}`;return l+"}"})(n.mapValue):Zn(61005,{value:n})}function VO(n){switch(Bg(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=wN(n);return e?16+VO(e):16;case 5:return 2*n.stringValue.length;case 6:return Fg(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(o){return(o.values||[]).reduce(((l,u)=>l+VO(u)),0)})(n.arrayValue);case 10:case 11:return(function(o){let l=0;return Yg(o.fields,((u,f)=>{l+=u.length+VO(f)})),l})(n.mapValue);default:throw Zn(13486,{value:n})}}function UJ(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function l5(n){return!!n&&"integerValue"in n}function Lj(n){return!!n&&"arrayValue"in n}function VJ(n){return!!n&&"nullValue"in n}function jJ(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function jO(n){return!!n&&"mapValue"in n}function pFe(n){var e,i;return((i=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[fse])===null||i===void 0?void 0:i.stringValue)===mse}function jC(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Yg(n.mapValue.fields,((i,o)=>e.mapValue.fields[i]=jC(o))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(n.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=jC(n.arrayValue.values[i]);return e}return Object.assign({},n)}function fFe(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===hFe}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sl{constructor(e){this.value=e}static empty(){return new Sl({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let i=this.value;for(let o=0;o<e.length-1;++o)if(i=(i.mapValue.fields||{})[e.get(o)],!jO(i))return null;return i=(i.mapValue.fields||{})[e.lastSegment()],i||null}}set(e,i){this.getFieldsMap(e.popLast())[e.lastSegment()]=jC(i)}setAll(e){let i=ja.emptyPath(),o={},l=[];e.forEach(((f,y)=>{if(!i.isImmediateParentOf(y)){const v=this.getFieldsMap(i);this.applyChanges(v,o,l),o={},l=[],i=y.popLast()}f?o[y.lastSegment()]=jC(f):l.push(y.lastSegment())}));const u=this.getFieldsMap(i);this.applyChanges(u,o,l)}delete(e){const i=this.field(e.popLast());jO(i)&&i.mapValue.fields&&delete i.mapValue.fields[e.lastSegment()]}isEqual(e){return Fp(this.value,e.value)}getFieldsMap(e){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let o=0;o<e.length;++o){let l=i.mapValue.fields[e.get(o)];jO(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},i.mapValue.fields[e.get(o)]=l),i=l}return i.mapValue.fields}applyChanges(e,i,o){Yg(i,((l,u)=>e[l]=u));for(const l of o)delete e[l]}clone(){return new Sl(jC(this.value))}}function gse(n){const e=[];return Yg(n.fields,((i,o)=>{const l=new ja([i]);if(jO(o)){const u=gse(o.mapValue).fields;if(u.length===0)e.push(l);else for(const f of u)e.push(l.child(f))}else e.push(l)})),new du(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hc{constructor(e,i,o,l,u,f,y){this.key=e,this.documentType=i,this.version=o,this.readTime=l,this.createTime=u,this.data=f,this.documentState=y}static newInvalidDocument(e){return new hc(e,0,lr.min(),lr.min(),lr.min(),Sl.empty(),0)}static newFoundDocument(e,i,o,l){return new hc(e,1,i,lr.min(),o,l,0)}static newNoDocument(e,i){return new hc(e,2,i,lr.min(),lr.min(),Sl.empty(),0)}static newUnknownDocument(e,i){return new hc(e,3,i,lr.min(),lr.min(),Sl.empty(),2)}convertToFoundDocument(e,i){return!this.createTime.isEqual(lr.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Sl.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Sl.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=lr.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof hc&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new hc(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bk{constructor(e,i){this.position=e,this.inclusive=i}}function FJ(n,e,i){let o=0;for(let l=0;l<n.position.length;l++){const u=e[l],f=n.position[l];if(u.field.isKeyField()?o=xn.comparator(xn.fromName(f.referenceValue),i.key):o=US(f,i.data.field(u.field)),u.dir==="desc"&&(o*=-1),o!==0)break}return o}function BJ(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let i=0;i<n.position.length;i++)if(!Fp(n.position[i],e.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bR{constructor(e,i="asc"){this.field=e,this.dir=i}}function mFe(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _se{}class Po extends _se{constructor(e,i,o){super(),this.field=e,this.op=i,this.value=o}static create(e,i,o){return e.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(e,i,o):new _Fe(e,i,o):i==="array-contains"?new vFe(e,o):i==="in"?new SFe(e,o):i==="not-in"?new bFe(e,o):i==="array-contains-any"?new wFe(e,o):new Po(e,i,o)}static createKeyFieldInFilter(e,i,o){return i==="in"?new yFe(e,o):new EFe(e,o)}matches(e){const i=e.data.field(this.field);return this.op==="!="?i!==null&&i.nullValue===void 0&&this.matchesComparison(US(i,this.value)):i!==null&&Bg(this.value)===Bg(i)&&this.matchesComparison(US(i,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Zn(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class yh extends _se{constructor(e,i){super(),this.filters=e,this.op=i,this.he=null}static create(e,i){return new yh(e,i)}matches(e){return yse(this)?this.filters.find((i=>!i.matches(e)))===void 0:this.filters.find((i=>i.matches(e)))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce(((e,i)=>e.concat(i.getFlattenedFilters())),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function yse(n){return n.op==="and"}function Ese(n){return gFe(n)&&yse(n)}function gFe(n){for(const e of n.filters)if(e instanceof yh)return!1;return!0}function u5(n){if(n instanceof Po)return n.field.canonicalString()+n.op.toString()+VS(n.value);if(Ese(n))return n.filters.map((e=>u5(e))).join(",");{const e=n.filters.map((i=>u5(i))).join(",");return`${n.op}(${e})`}}function vse(n,e){return n instanceof Po?(function(o,l){return l instanceof Po&&o.op===l.op&&o.field.isEqual(l.field)&&Fp(o.value,l.value)})(n,e):n instanceof yh?(function(o,l){return l instanceof yh&&o.op===l.op&&o.filters.length===l.filters.length?o.filters.reduce(((u,f,y)=>u&&vse(f,l.filters[y])),!0):!1})(n,e):void Zn(19439)}function Sse(n){return n instanceof Po?(function(i){return`${i.field.canonicalString()} ${i.op} ${VS(i.value)}`})(n):n instanceof yh?(function(i){return i.op.toString()+" {"+i.getFilters().map(Sse).join(" ,")+"}"})(n):"Filter"}class _Fe extends Po{constructor(e,i,o){super(e,i,o),this.key=xn.fromName(o.referenceValue)}matches(e){const i=xn.comparator(e.key,this.key);return this.matchesComparison(i)}}class yFe extends Po{constructor(e,i){super(e,"in",i),this.keys=bse("in",i)}matches(e){return this.keys.some((i=>i.isEqual(e.key)))}}class EFe extends Po{constructor(e,i){super(e,"not-in",i),this.keys=bse("not-in",i)}matches(e){return!this.keys.some((i=>i.isEqual(e.key)))}}function bse(n,e){var i;return(((i=e.arrayValue)===null||i===void 0?void 0:i.values)||[]).map((o=>xn.fromName(o.referenceValue)))}class vFe extends Po{constructor(e,i){super(e,"array-contains",i)}matches(e){const i=e.data.field(this.field);return Lj(i)&&SR(i.arrayValue,this.value)}}class SFe extends Po{constructor(e,i){super(e,"in",i)}matches(e){const i=e.data.field(this.field);return i!==null&&SR(this.value.arrayValue,i)}}class bFe extends Po{constructor(e,i){super(e,"not-in",i)}matches(e){if(SR(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=e.data.field(this.field);return i!==null&&i.nullValue===void 0&&!SR(this.value.arrayValue,i)}}class wFe extends Po{constructor(e,i){super(e,"array-contains-any",i)}matches(e){const i=e.data.field(this.field);return!(!Lj(i)||!i.arrayValue.values)&&i.arrayValue.values.some((o=>SR(this.value.arrayValue,o)))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TFe{constructor(e,i=null,o=[],l=[],u=null,f=null,y=null){this.path=e,this.collectionGroup=i,this.orderBy=o,this.filters=l,this.limit=u,this.startAt=f,this.endAt=y,this.Pe=null}}function zJ(n,e=null,i=[],o=[],l=null,u=null,f=null){return new TFe(n,e,i,o,l,u,f)}function Mj(n){const e=pr(n);if(e.Pe===null){let i=e.path.canonicalString();e.collectionGroup!==null&&(i+="|cg:"+e.collectionGroup),i+="|f:",i+=e.filters.map((o=>u5(o))).join(","),i+="|ob:",i+=e.orderBy.map((o=>(function(u){return u.field.canonicalString()+u.dir})(o))).join(","),bN(e.limit)||(i+="|l:",i+=e.limit),e.startAt&&(i+="|lb:",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map((o=>VS(o))).join(",")),e.endAt&&(i+="|ub:",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map((o=>VS(o))).join(",")),e.Pe=i}return e.Pe}function Uj(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<n.orderBy.length;i++)if(!mFe(n.orderBy[i],e.orderBy[i]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let i=0;i<n.filters.length;i++)if(!vse(n.filters[i],e.filters[i]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!BJ(n.startAt,e.startAt)&&BJ(n.endAt,e.endAt)}function d5(n){return xn.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ib{constructor(e,i=null,o=[],l=[],u=null,f="F",y=null,v=null){this.path=e,this.collectionGroup=i,this.explicitOrderBy=o,this.filters=l,this.limit=u,this.limitType=f,this.startAt=y,this.endAt=v,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}}function CFe(n,e,i,o,l,u,f,y){return new ib(n,e,i,o,l,u,f,y)}function TN(n){return new ib(n)}function WJ(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function wse(n){return n.collectionGroup!==null}function FC(n){const e=pr(n);if(e.Te===null){e.Te=[];const i=new Set;for(const u of e.explicitOrderBy)e.Te.push(u),i.add(u.field.canonicalString());const o=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(f){let y=new Yo(ja.comparator);return f.filters.forEach((v=>{v.getFlattenedFilters().forEach((b=>{b.isInequality()&&(y=y.add(b.field))}))})),y})(e).forEach((u=>{i.has(u.canonicalString())||u.isKeyField()||e.Te.push(new bR(u,o))})),i.has(ja.keyField().canonicalString())||e.Te.push(new bR(ja.keyField(),o))}return e.Te}function Lp(n){const e=pr(n);return e.Ie||(e.Ie=RFe(e,FC(n))),e.Ie}function RFe(n,e){if(n.limitType==="F")return zJ(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((l=>{const u=l.dir==="desc"?"asc":"desc";return new bR(l.field,u)}));const i=n.endAt?new bk(n.endAt.position,n.endAt.inclusive):null,o=n.startAt?new bk(n.startAt.position,n.startAt.inclusive):null;return zJ(n.path,n.collectionGroup,e,n.filters,n.limit,i,o)}}function h5(n,e){const i=n.filters.concat([e]);return new ib(n.path,n.collectionGroup,n.explicitOrderBy.slice(),i,n.limit,n.limitType,n.startAt,n.endAt)}function wk(n,e,i){return new ib(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,i,n.startAt,n.endAt)}function CN(n,e){return Uj(Lp(n),Lp(e))&&n.limitType===e.limitType}function Tse(n){return`${Mj(Lp(n))}|lt:${n.limitType}`}function x0(n){return`Query(target=${(function(i){let o=i.path.canonicalString();return i.collectionGroup!==null&&(o+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(o+=`, filters: [${i.filters.map((l=>Sse(l))).join(", ")}]`),bN(i.limit)||(o+=", limit: "+i.limit),i.orderBy.length>0&&(o+=`, orderBy: [${i.orderBy.map((l=>(function(f){return`${f.field.canonicalString()} (${f.dir})`})(l))).join(", ")}]`),i.startAt&&(o+=", startAt: ",o+=i.startAt.inclusive?"b:":"a:",o+=i.startAt.position.map((l=>VS(l))).join(",")),i.endAt&&(o+=", endAt: ",o+=i.endAt.inclusive?"a:":"b:",o+=i.endAt.position.map((l=>VS(l))).join(",")),`Target(${o})`})(Lp(n))}; limitType=${n.limitType})`}function RN(n,e){return e.isFoundDocument()&&(function(o,l){const u=l.key.path;return o.collectionGroup!==null?l.key.hasCollectionId(o.collectionGroup)&&o.path.isPrefixOf(u):xn.isDocumentKey(o.path)?o.path.isEqual(u):o.path.isImmediateParentOf(u)})(n,e)&&(function(o,l){for(const u of FC(o))if(!u.field.isKeyField()&&l.data.field(u.field)===null)return!1;return!0})(n,e)&&(function(o,l){for(const u of o.filters)if(!u.matches(l))return!1;return!0})(n,e)&&(function(o,l){return!(o.startAt&&!(function(f,y,v){const b=FJ(f,y,v);return f.inclusive?b<=0:b<0})(o.startAt,FC(o),l)||o.endAt&&!(function(f,y,v){const b=FJ(f,y,v);return f.inclusive?b>=0:b>0})(o.endAt,FC(o),l))})(n,e)}function IFe(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Cse(n){return(e,i)=>{let o=!1;for(const l of FC(n)){const u=AFe(l,e,i);if(u!==0)return u;o=o||l.field.isKeyField()}return 0}}function AFe(n,e,i){const o=n.field.isKeyField()?xn.comparator(e.key,i.key):(function(u,f,y){const v=f.data.field(u),b=y.data.field(u);return v!==null&&b!==null?US(v,b):Zn(42886)})(n.field,e,i);switch(n.dir){case"asc":return o;case"desc":return-1*o;default:return Zn(19790,{direction:n.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hE{constructor(e,i){this.mapKeyFn=e,this.equalsFn=i,this.inner={},this.innerSize=0}get(e){const i=this.mapKeyFn(e),o=this.inner[i];if(o!==void 0){for(const[l,u]of o)if(this.equalsFn(l,e))return u}}has(e){return this.get(e)!==void 0}set(e,i){const o=this.mapKeyFn(e),l=this.inner[o];if(l===void 0)return this.inner[o]=[[e,i]],void this.innerSize++;for(let u=0;u<l.length;u++)if(this.equalsFn(l[u][0],e))return void(l[u]=[e,i]);l.push([e,i]),this.innerSize++}delete(e){const i=this.mapKeyFn(e),o=this.inner[i];if(o===void 0)return!1;for(let l=0;l<o.length;l++)if(this.equalsFn(o[l][0],e))return o.length===1?delete this.inner[i]:o.splice(l,1),this.innerSize--,!0;return!1}forEach(e){Yg(this.inner,((i,o)=>{for(const[l,u]of o)e(l,u)}))}isEmpty(){return cse(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PFe=new ks(xn.comparator);function Qf(){return PFe}const Rse=new ks(xn.comparator);function yC(...n){let e=Rse;for(const i of n)e=e.insert(i.key,i);return e}function Ise(n){let e=Rse;return n.forEach(((i,o)=>e=e.insert(i,o.overlayedDocument))),e}function Ny(){return BC()}function Ase(){return BC()}function BC(){return new hE((n=>n.toString()),((n,e)=>n.isEqual(e)))}const OFe=new ks(xn.comparator),kFe=new Yo(xn.comparator);function zr(...n){let e=kFe;for(const i of n)e=e.add(i);return e}const NFe=new Yo(Or);function xFe(){return NFe}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vj(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ek(e)?"-0":e}}function Pse(n){return{integerValue:""+n}}function DFe(n,e){return aFe(e)?Pse(e):Vj(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IN{constructor(){this._=void 0}}function LFe(n,e,i){return n instanceof Tk?(function(l,u){const f={fields:{[dse]:{stringValue:use},[pse]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return u&&Dj(u)&&(u=wN(u)),u&&(f.fields[hse]=u),{mapValue:f}})(i,e):n instanceof jS?kse(n,e):n instanceof FS?Nse(n,e):(function(l,u){const f=Ose(l,u),y=GJ(f)+GJ(l.Ee);return l5(f)&&l5(l.Ee)?Pse(y):Vj(l.serializer,y)})(n,e)}function MFe(n,e,i){return n instanceof jS?kse(n,e):n instanceof FS?Nse(n,e):i}function Ose(n,e){return n instanceof Ck?(function(o){return l5(o)||(function(u){return!!u&&"doubleValue"in u})(o)})(e)?e:{integerValue:0}:null}class Tk extends IN{}class jS extends IN{constructor(e){super(),this.elements=e}}function kse(n,e){const i=xse(e);for(const o of n.elements)i.some((l=>Fp(l,o)))||i.push(o);return{arrayValue:{values:i}}}class FS extends IN{constructor(e){super(),this.elements=e}}function Nse(n,e){let i=xse(e);for(const o of n.elements)i=i.filter((l=>!Fp(l,o)));return{arrayValue:{values:i}}}class Ck extends IN{constructor(e,i){super(),this.serializer=e,this.Ee=i}}function GJ(n){return uo(n.integerValue||n.doubleValue)}function xse(n){return Lj(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dse{constructor(e,i){this.field=e,this.transform=i}}function UFe(n,e){return n.field.isEqual(e.field)&&(function(o,l){return o instanceof jS&&l instanceof jS||o instanceof FS&&l instanceof FS?MS(o.elements,l.elements,Fp):o instanceof Ck&&l instanceof Ck?Fp(o.Ee,l.Ee):o instanceof Tk&&l instanceof Tk})(n.transform,e.transform)}class VFe{constructor(e,i){this.version=e,this.transformResults=i}}class dd{constructor(e,i){this.updateTime=e,this.exists=i}static none(){return new dd}static exists(e){return new dd(void 0,e)}static updateTime(e){return new dd(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function FO(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class AN{}function Lse(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new jj(n.key,dd.none()):new YR(n.key,n.data,dd.none());{const i=n.data,o=Sl.empty();let l=new Yo(ja.comparator);for(let u of e.fields)if(!l.has(u)){let f=i.field(u);f===null&&u.length>1&&(u=u.popLast(),f=i.field(u)),f===null?o.delete(u):o.set(u,f),l=l.add(u)}return new Xg(n.key,o,new du(l.toArray()),dd.none())}}function jFe(n,e,i){n instanceof YR?(function(l,u,f){const y=l.value.clone(),v=$J(l.fieldTransforms,u,f.transformResults);y.setAll(v),u.convertToFoundDocument(f.version,y).setHasCommittedMutations()})(n,e,i):n instanceof Xg?(function(l,u,f){if(!FO(l.precondition,u))return void u.convertToUnknownDocument(f.version);const y=$J(l.fieldTransforms,u,f.transformResults),v=u.data;v.setAll(Mse(l)),v.setAll(y),u.convertToFoundDocument(f.version,v).setHasCommittedMutations()})(n,e,i):(function(l,u,f){u.convertToNoDocument(f.version).setHasCommittedMutations()})(0,e,i)}function zC(n,e,i,o){return n instanceof YR?(function(u,f,y,v){if(!FO(u.precondition,f))return y;const b=u.value.clone(),C=KJ(u.fieldTransforms,v,f);return b.setAll(C),f.convertToFoundDocument(f.version,b).setHasLocalMutations(),null})(n,e,i,o):n instanceof Xg?(function(u,f,y,v){if(!FO(u.precondition,f))return y;const b=KJ(u.fieldTransforms,v,f),C=f.data;return C.setAll(Mse(u)),C.setAll(b),f.convertToFoundDocument(f.version,C).setHasLocalMutations(),y===null?null:y.unionWith(u.fieldMask.fields).unionWith(u.fieldTransforms.map((R=>R.field)))})(n,e,i,o):(function(u,f,y){return FO(u.precondition,f)?(f.convertToNoDocument(f.version).setHasLocalMutations(),null):y})(n,e,i)}function FFe(n,e){let i=null;for(const o of n.fieldTransforms){const l=e.data.field(o.field),u=Ose(o.transform,l||null);u!=null&&(i===null&&(i=Sl.empty()),i.set(o.field,u))}return i||null}function HJ(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(o,l){return o===void 0&&l===void 0||!(!o||!l)&&MS(o,l,((u,f)=>UFe(u,f)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class YR extends AN{constructor(e,i,o,l=[]){super(),this.key=e,this.value=i,this.precondition=o,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class Xg extends AN{constructor(e,i,o,l,u=[]){super(),this.key=e,this.data=i,this.fieldMask=o,this.precondition=l,this.fieldTransforms=u,this.type=1}getFieldMask(){return this.fieldMask}}function Mse(n){const e=new Map;return n.fieldMask.fields.forEach((i=>{if(!i.isEmpty()){const o=n.data.field(i);e.set(i,o)}})),e}function $J(n,e,i){const o=new Map;bi(n.length===i.length,32656,{Ae:i.length,Re:n.length});for(let l=0;l<i.length;l++){const u=n[l],f=u.transform,y=e.data.field(u.field);o.set(u.field,MFe(f,y,i[l]))}return o}function KJ(n,e,i){const o=new Map;for(const l of n){const u=l.transform,f=i.data.field(l.field);o.set(l.field,LFe(u,f,e))}return o}class jj extends AN{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class BFe extends AN{constructor(e,i){super(),this.key=e,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zFe{constructor(e,i,o,l){this.batchId=e,this.localWriteTime=i,this.baseMutations=o,this.mutations=l}applyToRemoteDocument(e,i){const o=i.mutationResults;for(let l=0;l<this.mutations.length;l++){const u=this.mutations[l];u.key.isEqual(e.key)&&jFe(u,e,o[l])}}applyToLocalView(e,i){for(const o of this.baseMutations)o.key.isEqual(e.key)&&(i=zC(o,e,i,this.localWriteTime));for(const o of this.mutations)o.key.isEqual(e.key)&&(i=zC(o,e,i,this.localWriteTime));return i}applyToLocalDocumentSet(e,i){const o=Ase();return this.mutations.forEach((l=>{const u=e.get(l.key),f=u.overlayedDocument;let y=this.applyToLocalView(f,u.mutatedFields);y=i.has(l.key)?null:y;const v=Lse(f,y);v!==null&&o.set(l.key,v),f.isValidDocument()||f.convertToNoDocument(lr.min())})),o}keys(){return this.mutations.reduce(((e,i)=>e.add(i.key)),zr())}isEqual(e){return this.batchId===e.batchId&&MS(this.mutations,e.mutations,((i,o)=>HJ(i,o)))&&MS(this.baseMutations,e.baseMutations,((i,o)=>HJ(i,o)))}}class Fj{constructor(e,i,o,l){this.batch=e,this.commitVersion=i,this.mutationResults=o,this.docVersions=l}static from(e,i,o){bi(e.mutations.length===o.length,58842,{Ve:e.mutations.length,me:o.length});let l=(function(){return OFe})();const u=e.mutations;for(let f=0;f<u.length;f++)l=l.insert(u[f].key,o[f].version);return new Fj(e,i,o,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WFe{constructor(e,i){this.largestBatchId=e,this.mutation=i}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GFe{constructor(e,i){this.count=e,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Co,ei;function HFe(n){switch(n){case Tt.OK:return Zn(64938);case Tt.CANCELLED:case Tt.UNKNOWN:case Tt.DEADLINE_EXCEEDED:case Tt.RESOURCE_EXHAUSTED:case Tt.INTERNAL:case Tt.UNAVAILABLE:case Tt.UNAUTHENTICATED:return!1;case Tt.INVALID_ARGUMENT:case Tt.NOT_FOUND:case Tt.ALREADY_EXISTS:case Tt.PERMISSION_DENIED:case Tt.FAILED_PRECONDITION:case Tt.ABORTED:case Tt.OUT_OF_RANGE:case Tt.UNIMPLEMENTED:case Tt.DATA_LOSS:return!0;default:return Zn(15467,{code:n})}}function Use(n){if(n===void 0)return Jf("GRPC error has no .code"),Tt.UNKNOWN;switch(n){case Co.OK:return Tt.OK;case Co.CANCELLED:return Tt.CANCELLED;case Co.UNKNOWN:return Tt.UNKNOWN;case Co.DEADLINE_EXCEEDED:return Tt.DEADLINE_EXCEEDED;case Co.RESOURCE_EXHAUSTED:return Tt.RESOURCE_EXHAUSTED;case Co.INTERNAL:return Tt.INTERNAL;case Co.UNAVAILABLE:return Tt.UNAVAILABLE;case Co.UNAUTHENTICATED:return Tt.UNAUTHENTICATED;case Co.INVALID_ARGUMENT:return Tt.INVALID_ARGUMENT;case Co.NOT_FOUND:return Tt.NOT_FOUND;case Co.ALREADY_EXISTS:return Tt.ALREADY_EXISTS;case Co.PERMISSION_DENIED:return Tt.PERMISSION_DENIED;case Co.FAILED_PRECONDITION:return Tt.FAILED_PRECONDITION;case Co.ABORTED:return Tt.ABORTED;case Co.OUT_OF_RANGE:return Tt.OUT_OF_RANGE;case Co.UNIMPLEMENTED:return Tt.UNIMPLEMENTED;case Co.DATA_LOSS:return Tt.DATA_LOSS;default:return Zn(39323,{code:n})}}(ei=Co||(Co={}))[ei.OK=0]="OK",ei[ei.CANCELLED=1]="CANCELLED",ei[ei.UNKNOWN=2]="UNKNOWN",ei[ei.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ei[ei.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ei[ei.NOT_FOUND=5]="NOT_FOUND",ei[ei.ALREADY_EXISTS=6]="ALREADY_EXISTS",ei[ei.PERMISSION_DENIED=7]="PERMISSION_DENIED",ei[ei.UNAUTHENTICATED=16]="UNAUTHENTICATED",ei[ei.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ei[ei.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ei[ei.ABORTED=10]="ABORTED",ei[ei.OUT_OF_RANGE=11]="OUT_OF_RANGE",ei[ei.UNIMPLEMENTED=12]="UNIMPLEMENTED",ei[ei.INTERNAL=13]="INTERNAL",ei[ei.UNAVAILABLE=14]="UNAVAILABLE",ei[ei.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $Fe=new kg([4294967295,4294967295],0);function qJ(n){const e=ise().encode(n),i=new Xie;return i.update(e),new Uint8Array(i.digest())}function YJ(n){const e=new DataView(n.buffer),i=e.getUint32(0,!0),o=e.getUint32(4,!0),l=e.getUint32(8,!0),u=e.getUint32(12,!0);return[new kg([i,o],0),new kg([l,u],0)]}class Bj{constructor(e,i,o){if(this.bitmap=e,this.padding=i,this.hashCount=o,i<0||i>=8)throw new EC(`Invalid padding: ${i}`);if(o<0)throw new EC(`Invalid hash count: ${o}`);if(e.length>0&&this.hashCount===0)throw new EC(`Invalid hash count: ${o}`);if(e.length===0&&i!==0)throw new EC(`Invalid padding when bitmap length is 0: ${i}`);this.fe=8*e.length-i,this.ge=kg.fromNumber(this.fe)}pe(e,i,o){let l=e.add(i.multiply(kg.fromNumber(o)));return l.compare($Fe)===1&&(l=new kg([l.getBits(0),l.getBits(1)],0)),l.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.fe===0)return!1;const i=qJ(e),[o,l]=YJ(i);for(let u=0;u<this.hashCount;u++){const f=this.pe(o,l,u);if(!this.ye(f))return!1}return!0}static create(e,i,o){const l=e%8==0?0:8-e%8,u=new Uint8Array(Math.ceil(e/8)),f=new Bj(u,l,i);return o.forEach((y=>f.insert(y))),f}insert(e){if(this.fe===0)return;const i=qJ(e),[o,l]=YJ(i);for(let u=0;u<this.hashCount;u++){const f=this.pe(o,l,u);this.we(f)}}we(e){const i=Math.floor(e/8),o=e%8;this.bitmap[i]|=1<<o}}class EC extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PN{constructor(e,i,o,l,u){this.snapshotVersion=e,this.targetChanges=i,this.targetMismatches=o,this.documentUpdates=l,this.resolvedLimboDocuments=u}static createSynthesizedRemoteEventForCurrentChange(e,i,o){const l=new Map;return l.set(e,XR.createSynthesizedTargetChangeForCurrentChange(e,i,o)),new PN(lr.min(),l,new ks(Or),Qf(),zr())}}class XR{constructor(e,i,o,l,u){this.resumeToken=e,this.current=i,this.addedDocuments=o,this.modifiedDocuments=l,this.removedDocuments=u}static createSynthesizedTargetChangeForCurrentChange(e,i,o){return new XR(o,i,zr(),zr(),zr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BO{constructor(e,i,o,l){this.Se=e,this.removedTargetIds=i,this.key=o,this.be=l}}class Vse{constructor(e,i){this.targetId=e,this.De=i}}class jse{constructor(e,i,o=Fa.EMPTY_BYTE_STRING,l=null){this.state=e,this.targetIds=i,this.resumeToken=o,this.cause=l}}class XJ{constructor(){this.ve=0,this.Ce=JJ(),this.Fe=Fa.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=zr(),i=zr(),o=zr();return this.Ce.forEach(((l,u)=>{switch(u){case 0:e=e.add(l);break;case 2:i=i.add(l);break;case 1:o=o.add(l);break;default:Zn(38017,{changeType:u})}})),new XR(this.Fe,this.Me,e,i,o)}ke(){this.xe=!1,this.Ce=JJ()}qe(e,i){this.xe=!0,this.Ce=this.Ce.insert(e,i)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,bi(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}}class KFe{constructor(e){this.We=e,this.Ge=new Map,this.ze=Qf(),this.je=oO(),this.Je=oO(),this.He=new ks(Or)}Ye(e){for(const i of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(i,e.be):this.Xe(i,e.key,e.be);for(const i of e.removedTargetIds)this.Xe(i,e.key,e.be)}et(e){this.forEachTarget(e,(i=>{const o=this.tt(i);switch(e.state){case 0:this.nt(i)&&o.Be(e.resumeToken);break;case 1:o.Ue(),o.Oe||o.ke(),o.Be(e.resumeToken);break;case 2:o.Ue(),o.Oe||this.removeTarget(i);break;case 3:this.nt(i)&&(o.Ke(),o.Be(e.resumeToken));break;case 4:this.nt(i)&&(this.rt(i),o.Be(e.resumeToken));break;default:Zn(56790,{state:e.state})}}))}forEachTarget(e,i){e.targetIds.length>0?e.targetIds.forEach(i):this.Ge.forEach(((o,l)=>{this.nt(l)&&i(l)}))}it(e){const i=e.targetId,o=e.De.count,l=this.st(i);if(l){const u=l.target;if(d5(u))if(o===0){const f=new xn(u.path);this.Xe(i,f,hc.newNoDocument(f,lr.min()))}else bi(o===1,20013,{expectedCount:o});else{const f=this.ot(i);if(f!==o){const y=this._t(e),v=y?this.ut(y,e,f):1;if(v!==0){this.rt(i);const b=v===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(i,b)}}}}}_t(e){const i=e.De.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:o="",padding:l=0},hashCount:u=0}=i;let f,y;try{f=Fg(o).toUint8Array()}catch(v){if(v instanceof lse)return Ug("Decoding the base64 bloom filter in existence filter failed ("+v.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw v}try{y=new Bj(f,l,u)}catch(v){return Ug(v instanceof EC?"BloomFilter error: ":"Applying bloom filter failed: ",v),null}return y.fe===0?null:y}ut(e,i,o){return i.De.count===o-this.ht(e,i.targetId)?0:2}ht(e,i){const o=this.We.getRemoteKeysForTarget(i);let l=0;return o.forEach((u=>{const f=this.We.lt(),y=`projects/${f.projectId}/databases/${f.database}/documents/${u.path.canonicalString()}`;e.mightContain(y)||(this.Xe(i,u,null),l++)})),l}Pt(e){const i=new Map;this.Ge.forEach(((u,f)=>{const y=this.st(f);if(y){if(u.current&&d5(y.target)){const v=new xn(y.target.path);this.Tt(v).has(f)||this.It(f,v)||this.Xe(f,v,hc.newNoDocument(v,e))}u.Ne&&(i.set(f,u.Le()),u.ke())}}));let o=zr();this.Je.forEach(((u,f)=>{let y=!0;f.forEachWhile((v=>{const b=this.st(v);return!b||b.purpose==="TargetPurposeLimboResolution"||(y=!1,!1)})),y&&(o=o.add(u))})),this.ze.forEach(((u,f)=>f.setReadTime(e)));const l=new PN(e,i,this.He,this.ze,o);return this.ze=Qf(),this.je=oO(),this.Je=oO(),this.He=new ks(Or),l}Ze(e,i){if(!this.nt(e))return;const o=this.It(e,i.key)?2:0;this.tt(e).qe(i.key,o),this.ze=this.ze.insert(i.key,i),this.je=this.je.insert(i.key,this.Tt(i.key).add(e)),this.Je=this.Je.insert(i.key,this.dt(i.key).add(e))}Xe(e,i,o){if(!this.nt(e))return;const l=this.tt(e);this.It(e,i)?l.qe(i,1):l.Qe(i),this.Je=this.Je.insert(i,this.dt(i).delete(e)),this.Je=this.Je.insert(i,this.dt(i).add(e)),o&&(this.ze=this.ze.insert(i,o))}removeTarget(e){this.Ge.delete(e)}ot(e){const i=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+i.addedDocuments.size-i.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let i=this.Ge.get(e);return i||(i=new XJ,this.Ge.set(e,i)),i}dt(e){let i=this.Je.get(e);return i||(i=new Yo(Or),this.Je=this.Je.insert(e,i)),i}Tt(e){let i=this.je.get(e);return i||(i=new Yo(Or),this.je=this.je.insert(e,i)),i}nt(e){const i=this.st(e)!==null;return i||fn("WatchChangeAggregator","Detected inactive target",e),i}st(e){const i=this.Ge.get(e);return i&&i.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new XJ),this.We.getRemoteKeysForTarget(e).forEach((i=>{this.Xe(e,i,null)}))}It(e,i){return this.We.getRemoteKeysForTarget(e).has(i)}}function oO(){return new ks(xn.comparator)}function JJ(){return new ks(xn.comparator)}const qFe={asc:"ASCENDING",desc:"DESCENDING"},YFe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},XFe={and:"AND",or:"OR"};class JFe{constructor(e,i){this.databaseId=e,this.useProto3Json=i}}function p5(n,e){return n.useProto3Json||bN(e)?e:{value:e}}function Rk(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Fse(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function QFe(n,e){return Rk(n,e.toTimestamp())}function Mp(n){return bi(!!n,49232),lr.fromTimestamp((function(i){const o=jg(i);return new as(o.seconds,o.nanos)})(n))}function zj(n,e){return f5(n,e).canonicalString()}function f5(n,e){const i=(function(l){return new Ji(["projects",l.projectId,"databases",l.database])})(n).child("documents");return e===void 0?i:i.child(e)}function Bse(n){const e=Ji.fromString(n);return bi($se(e),10190,{key:e.toString()}),e}function m5(n,e){return zj(n.databaseId,e.path)}function $U(n,e){const i=Bse(e);if(i.get(1)!==n.databaseId.projectId)throw new sn(Tt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+n.databaseId.projectId);if(i.get(3)!==n.databaseId.database)throw new sn(Tt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+n.databaseId.database);return new xn(Wse(i))}function zse(n,e){return zj(n.databaseId,e)}function ZFe(n){const e=Bse(n);return e.length===4?Ji.emptyPath():Wse(e)}function g5(n){return new Ji(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Wse(n){return bi(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function QJ(n,e,i){return{name:m5(n,e),fields:i.value.mapValue.fields}}function e4e(n,e){let i;if("targetChange"in e){e.targetChange;const o=(function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:Zn(39313,{state:b})})(e.targetChange.targetChangeType||"NO_CHANGE"),l=e.targetChange.targetIds||[],u=(function(b,C){return b.useProto3Json?(bi(C===void 0||typeof C=="string",58123),Fa.fromBase64String(C||"")):(bi(C===void 0||C instanceof Buffer||C instanceof Uint8Array,16193),Fa.fromUint8Array(C||new Uint8Array))})(n,e.targetChange.resumeToken),f=e.targetChange.cause,y=f&&(function(b){const C=b.code===void 0?Tt.UNKNOWN:Use(b.code);return new sn(C,b.message||"")})(f);i=new jse(o,l,u,y||null)}else if("documentChange"in e){e.documentChange;const o=e.documentChange;o.document,o.document.name,o.document.updateTime;const l=$U(n,o.document.name),u=Mp(o.document.updateTime),f=o.document.createTime?Mp(o.document.createTime):lr.min(),y=new Sl({mapValue:{fields:o.document.fields}}),v=hc.newFoundDocument(l,u,f,y),b=o.targetIds||[],C=o.removedTargetIds||[];i=new BO(b,C,v.key,v)}else if("documentDelete"in e){e.documentDelete;const o=e.documentDelete;o.document;const l=$U(n,o.document),u=o.readTime?Mp(o.readTime):lr.min(),f=hc.newNoDocument(l,u),y=o.removedTargetIds||[];i=new BO([],y,f.key,f)}else if("documentRemove"in e){e.documentRemove;const o=e.documentRemove;o.document;const l=$U(n,o.document),u=o.removedTargetIds||[];i=new BO([],u,l,null)}else{if(!("filter"in e))return Zn(11601,{At:e});{e.filter;const o=e.filter;o.targetId;const{count:l=0,unchangedNames:u}=o,f=new GFe(l,u),y=o.targetId;i=new Vse(y,f)}}return i}function t4e(n,e){let i;if(e instanceof YR)i={update:QJ(n,e.key,e.value)};else if(e instanceof jj)i={delete:m5(n,e.key)};else if(e instanceof Xg)i={update:QJ(n,e.key,e.data),updateMask:u4e(e.fieldMask)};else{if(!(e instanceof BFe))return Zn(16599,{Rt:e.type});i={verify:m5(n,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map((o=>(function(u,f){const y=f.transform;if(y instanceof Tk)return{fieldPath:f.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(y instanceof jS)return{fieldPath:f.field.canonicalString(),appendMissingElements:{values:y.elements}};if(y instanceof FS)return{fieldPath:f.field.canonicalString(),removeAllFromArray:{values:y.elements}};if(y instanceof Ck)return{fieldPath:f.field.canonicalString(),increment:y.Ee};throw Zn(20930,{transform:f.transform})})(0,o)))),e.precondition.isNone||(i.currentDocument=(function(l,u){return u.updateTime!==void 0?{updateTime:QFe(l,u.updateTime)}:u.exists!==void 0?{exists:u.exists}:Zn(27497)})(n,e.precondition)),i}function n4e(n,e){return n&&n.length>0?(bi(e!==void 0,14353),n.map((i=>(function(l,u){let f=l.updateTime?Mp(l.updateTime):Mp(u);return f.isEqual(lr.min())&&(f=Mp(u)),new VFe(f,l.transformResults||[])})(i,e)))):[]}function r4e(n,e){return{documents:[zse(n,e.path)]}}function i4e(n,e){const i={structuredQuery:{}},o=e.path;let l;e.collectionGroup!==null?(l=o,i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(l=o.popLast(),i.structuredQuery.from=[{collectionId:o.lastSegment()}]),i.parent=zse(n,l);const u=(function(b){if(b.length!==0)return Hse(yh.create(b,"and"))})(e.filters);u&&(i.structuredQuery.where=u);const f=(function(b){if(b.length!==0)return b.map((C=>(function(O){return{field:D0(O.field),direction:a4e(O.dir)}})(C)))})(e.orderBy);f&&(i.structuredQuery.orderBy=f);const y=p5(n,e.limit);return y!==null&&(i.structuredQuery.limit=y),e.startAt&&(i.structuredQuery.startAt=(function(b){return{before:b.inclusive,values:b.position}})(e.startAt)),e.endAt&&(i.structuredQuery.endAt=(function(b){return{before:!b.inclusive,values:b.position}})(e.endAt)),{Vt:i,parent:l}}function s4e(n){let e=ZFe(n.parent);const i=n.structuredQuery,o=i.from?i.from.length:0;let l=null;if(o>0){bi(o===1,65062);const C=i.from[0];C.allDescendants?l=C.collectionId:e=e.child(C.collectionId)}let u=[];i.where&&(u=(function(R){const O=Gse(R);return O instanceof yh&&Ese(O)?O.getFilters():[O]})(i.where));let f=[];i.orderBy&&(f=(function(R){return R.map((O=>(function(D){return new bR(L0(D.field),(function(B){switch(B){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(D.direction))})(O)))})(i.orderBy));let y=null;i.limit&&(y=(function(R){let O;return O=typeof R=="object"?R.value:R,bN(O)?null:O})(i.limit));let v=null;i.startAt&&(v=(function(R){const O=!!R.before,L=R.values||[];return new bk(L,O)})(i.startAt));let b=null;return i.endAt&&(b=(function(R){const O=!R.before,L=R.values||[];return new bk(L,O)})(i.endAt)),CFe(e,l,f,u,y,"F",v,b)}function o4e(n,e){const i=(function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Zn(28987,{purpose:l})}})(e.purpose);return i==null?null:{"goog-listen-tags":i}}function Gse(n){return n.unaryFilter!==void 0?(function(i){switch(i.unaryFilter.op){case"IS_NAN":const o=L0(i.unaryFilter.field);return Po.create(o,"==",{doubleValue:NaN});case"IS_NULL":const l=L0(i.unaryFilter.field);return Po.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const u=L0(i.unaryFilter.field);return Po.create(u,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const f=L0(i.unaryFilter.field);return Po.create(f,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Zn(61313);default:return Zn(60726)}})(n):n.fieldFilter!==void 0?(function(i){return Po.create(L0(i.fieldFilter.field),(function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Zn(58110);default:return Zn(50506)}})(i.fieldFilter.op),i.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(i){return yh.create(i.compositeFilter.filters.map((o=>Gse(o))),(function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return Zn(1026)}})(i.compositeFilter.op))})(n):Zn(30097,{filter:n})}function a4e(n){return qFe[n]}function c4e(n){return YFe[n]}function l4e(n){return XFe[n]}function D0(n){return{fieldPath:n.canonicalString()}}function L0(n){return ja.fromServerFormat(n.fieldPath)}function Hse(n){return n instanceof Po?(function(i){if(i.op==="=="){if(jJ(i.value))return{unaryFilter:{field:D0(i.field),op:"IS_NAN"}};if(VJ(i.value))return{unaryFilter:{field:D0(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(jJ(i.value))return{unaryFilter:{field:D0(i.field),op:"IS_NOT_NAN"}};if(VJ(i.value))return{unaryFilter:{field:D0(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:D0(i.field),op:c4e(i.op),value:i.value}}})(n):n instanceof yh?(function(i){const o=i.getFilters().map((l=>Hse(l)));return o.length===1?o[0]:{compositeFilter:{op:l4e(i.op),filters:o}}})(n):Zn(54877,{filter:n})}function u4e(n){const e=[];return n.fields.forEach((i=>e.push(i.canonicalString()))),{fieldPaths:e}}function $se(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ig{constructor(e,i,o,l,u=lr.min(),f=lr.min(),y=Fa.EMPTY_BYTE_STRING,v=null){this.target=e,this.targetId=i,this.purpose=o,this.sequenceNumber=l,this.snapshotVersion=u,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=y,this.expectedCount=v}withSequenceNumber(e){return new Ig(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,i){return new Ig(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ig(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ig(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d4e{constructor(e){this.gt=e}}function h4e(n){const e=s4e({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?wk(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p4e{constructor(){this.Dn=new f4e}addToCollectionParentIndex(e,i){return this.Dn.add(i),At.resolve()}getCollectionParents(e,i){return At.resolve(this.Dn.getEntries(i))}addFieldIndex(e,i){return At.resolve()}deleteFieldIndex(e,i){return At.resolve()}deleteAllFieldIndexes(e){return At.resolve()}createTargetIndexes(e,i){return At.resolve()}getDocumentsMatchingTarget(e,i){return At.resolve(null)}getIndexType(e,i){return At.resolve(0)}getFieldIndexes(e,i){return At.resolve([])}getNextCollectionGroupToUpdate(e){return At.resolve(null)}getMinOffset(e,i){return At.resolve(Vg.min())}getMinOffsetFromCollectionGroup(e,i){return At.resolve(Vg.min())}updateCollectionGroup(e,i,o){return At.resolve()}updateIndexEntries(e,i){return At.resolve()}}class f4e{constructor(){this.index={}}add(e){const i=e.lastSegment(),o=e.popLast(),l=this.index[i]||new Yo(Ji.comparator),u=!l.has(o);return this.index[i]=l.add(o),u}has(e){const i=e.lastSegment(),o=e.popLast(),l=this.index[i];return l&&l.has(o)}getEntries(e){return(this.index[e]||new Yo(Ji.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZJ={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Kse=41943040;class yl{static withCacheSize(e){return new yl(e,yl.DEFAULT_COLLECTION_PERCENTILE,yl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,i,o){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */yl.DEFAULT_COLLECTION_PERCENTILE=10,yl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,yl.DEFAULT=new yl(Kse,yl.DEFAULT_COLLECTION_PERCENTILE,yl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),yl.DISABLED=new yl(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BS{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new BS(0)}static ur(){return new BS(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eQ="LruGarbageCollector",m4e=1048576;function tQ([n,e],[i,o]){const l=Or(n,i);return l===0?Or(e,o):l}class g4e{constructor(e){this.Tr=e,this.buffer=new Yo(tQ),this.Ir=0}dr(){return++this.Ir}Er(e){const i=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(i);else{const o=this.buffer.last();tQ(i,o)<0&&(this.buffer=this.buffer.delete(o).add(i))}}get maxValue(){return this.buffer.last()[0]}}class _4e{constructor(e,i,o){this.garbageCollector=e,this.asyncQueue=i,this.localStore=o,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){fn(eQ,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(i){rb(i)?fn(eQ,"Ignoring IndexedDB error during garbage collection: ",i):await nb(i)}await this.Rr(3e5)}))}}class y4e{constructor(e,i){this.Vr=e,this.params=i}calculateTargetCount(e,i){return this.Vr.mr(e).next((o=>Math.floor(i/100*o)))}nthSequenceNumber(e,i){if(i===0)return At.resolve(SN.ue);const o=new g4e(i);return this.Vr.forEachTarget(e,(l=>o.Er(l.sequenceNumber))).next((()=>this.Vr.gr(e,(l=>o.Er(l))))).next((()=>o.maxValue))}removeTargets(e,i,o){return this.Vr.removeTargets(e,i,o)}removeOrphanedDocuments(e,i){return this.Vr.removeOrphanedDocuments(e,i)}collect(e,i){return this.params.cacheSizeCollectionThreshold===-1?(fn("LruGarbageCollector","Garbage collection skipped; disabled"),At.resolve(ZJ)):this.getCacheSize(e).next((o=>o<this.params.cacheSizeCollectionThreshold?(fn("LruGarbageCollector",`Garbage collection skipped; Cache size ${o} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ZJ):this.pr(e,i)))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,i){let o,l,u,f,y,v,b;const C=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((R=>(R>this.params.maximumSequenceNumbersToCollect?(fn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${R}`),l=this.params.maximumSequenceNumbersToCollect):l=R,f=Date.now(),this.nthSequenceNumber(e,l)))).next((R=>(o=R,y=Date.now(),this.removeTargets(e,o,i)))).next((R=>(u=R,v=Date.now(),this.removeOrphanedDocuments(e,o)))).next((R=>(b=Date.now(),N0()<=Fr.DEBUG&&fn("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-C}ms
	Determined least recently used ${l} in `+(y-f)+`ms
	Removed ${u} targets in `+(v-y)+`ms
	Removed ${R} documents in `+(b-v)+`ms
Total Duration: ${b-C}ms`),At.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:u,documentsRemoved:R}))))}}function E4e(n,e){return new y4e(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v4e{constructor(){this.changes=new hE((e=>e.toString()),((e,i)=>e.isEqual(i))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,i){this.assertNotApplied(),this.changes.set(e,hc.newInvalidDocument(e).setReadTime(i))}getEntry(e,i){this.assertNotApplied();const o=this.changes.get(i);return o!==void 0?At.resolve(o):this.getFromCache(e,i)}getEntries(e,i){return this.getAllFromCache(e,i)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S4e{constructor(e,i){this.overlayedDocument=e,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b4e{constructor(e,i,o,l){this.remoteDocumentCache=e,this.mutationQueue=i,this.documentOverlayCache=o,this.indexManager=l}getDocument(e,i){let o=null;return this.documentOverlayCache.getOverlay(e,i).next((l=>(o=l,this.remoteDocumentCache.getEntry(e,i)))).next((l=>(o!==null&&zC(o.mutation,l,du.empty(),as.now()),l)))}getDocuments(e,i){return this.remoteDocumentCache.getEntries(e,i).next((o=>this.getLocalViewOfDocuments(e,o,zr()).next((()=>o))))}getLocalViewOfDocuments(e,i,o=zr()){const l=Ny();return this.populateOverlays(e,l,i).next((()=>this.computeViews(e,i,l,o).next((u=>{let f=yC();return u.forEach(((y,v)=>{f=f.insert(y,v.overlayedDocument)})),f}))))}getOverlayedDocuments(e,i){const o=Ny();return this.populateOverlays(e,o,i).next((()=>this.computeViews(e,i,o,zr())))}populateOverlays(e,i,o){const l=[];return o.forEach((u=>{i.has(u)||l.push(u)})),this.documentOverlayCache.getOverlays(e,l).next((u=>{u.forEach(((f,y)=>{i.set(f,y)}))}))}computeViews(e,i,o,l){let u=Qf();const f=BC(),y=(function(){return BC()})();return i.forEach(((v,b)=>{const C=o.get(b.key);l.has(b.key)&&(C===void 0||C.mutation instanceof Xg)?u=u.insert(b.key,b):C!==void 0?(f.set(b.key,C.mutation.getFieldMask()),zC(C.mutation,b,C.mutation.getFieldMask(),as.now())):f.set(b.key,du.empty())})),this.recalculateAndSaveOverlays(e,u).next((v=>(v.forEach(((b,C)=>f.set(b,C))),i.forEach(((b,C)=>{var R;return y.set(b,new S4e(C,(R=f.get(b))!==null&&R!==void 0?R:null))})),y)))}recalculateAndSaveOverlays(e,i){const o=BC();let l=new ks(((f,y)=>f-y)),u=zr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,i).next((f=>{for(const y of f)y.keys().forEach((v=>{const b=i.get(v);if(b===null)return;let C=o.get(v)||du.empty();C=y.applyToLocalView(b,C),o.set(v,C);const R=(l.get(y.batchId)||zr()).add(v);l=l.insert(y.batchId,R)}))})).next((()=>{const f=[],y=l.getReverseIterator();for(;y.hasNext();){const v=y.getNext(),b=v.key,C=v.value,R=Ase();C.forEach((O=>{if(!u.has(O)){const L=Lse(i.get(O),o.get(O));L!==null&&R.set(O,L),u=u.add(O)}})),f.push(this.documentOverlayCache.saveOverlays(e,b,R))}return At.waitFor(f)})).next((()=>o))}recalculateAndSaveOverlaysForDocumentKeys(e,i){return this.remoteDocumentCache.getEntries(e,i).next((o=>this.recalculateAndSaveOverlays(e,o)))}getDocumentsMatchingQuery(e,i,o,l){return(function(f){return xn.isDocumentKey(f.path)&&f.collectionGroup===null&&f.filters.length===0})(i)?this.getDocumentsMatchingDocumentQuery(e,i.path):wse(i)?this.getDocumentsMatchingCollectionGroupQuery(e,i,o,l):this.getDocumentsMatchingCollectionQuery(e,i,o,l)}getNextDocuments(e,i,o,l){return this.remoteDocumentCache.getAllFromCollectionGroup(e,i,o,l).next((u=>{const f=l-u.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,i,o.largestBatchId,l-u.size):At.resolve(Ny());let y=yR,v=u;return f.next((b=>At.forEach(b,((C,R)=>(y<R.largestBatchId&&(y=R.largestBatchId),u.get(C)?At.resolve():this.remoteDocumentCache.getEntry(e,C).next((O=>{v=v.insert(C,O)}))))).next((()=>this.populateOverlays(e,b,u))).next((()=>this.computeViews(e,v,b,zr()))).next((C=>({batchId:y,changes:Ise(C)})))))}))}getDocumentsMatchingDocumentQuery(e,i){return this.getDocument(e,new xn(i)).next((o=>{let l=yC();return o.isFoundDocument()&&(l=l.insert(o.key,o)),l}))}getDocumentsMatchingCollectionGroupQuery(e,i,o,l){const u=i.collectionGroup;let f=yC();return this.indexManager.getCollectionParents(e,u).next((y=>At.forEach(y,(v=>{const b=(function(R,O){return new ib(O,null,R.explicitOrderBy.slice(),R.filters.slice(),R.limit,R.limitType,R.startAt,R.endAt)})(i,v.child(u));return this.getDocumentsMatchingCollectionQuery(e,b,o,l).next((C=>{C.forEach(((R,O)=>{f=f.insert(R,O)}))}))})).next((()=>f))))}getDocumentsMatchingCollectionQuery(e,i,o,l){let u;return this.documentOverlayCache.getOverlaysForCollection(e,i.path,o.largestBatchId).next((f=>(u=f,this.remoteDocumentCache.getDocumentsMatchingQuery(e,i,o,u,l)))).next((f=>{u.forEach(((v,b)=>{const C=b.getKey();f.get(C)===null&&(f=f.insert(C,hc.newInvalidDocument(C)))}));let y=yC();return f.forEach(((v,b)=>{const C=u.get(v);C!==void 0&&zC(C.mutation,b,du.empty(),as.now()),RN(i,b)&&(y=y.insert(v,b))})),y}))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w4e{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,i){return At.resolve(this.Br.get(i))}saveBundleMetadata(e,i){return this.Br.set(i.id,(function(l){return{id:l.id,version:l.version,createTime:Mp(l.createTime)}})(i)),At.resolve()}getNamedQuery(e,i){return At.resolve(this.Lr.get(i))}saveNamedQuery(e,i){return this.Lr.set(i.name,(function(l){return{name:l.name,query:h4e(l.bundledQuery),readTime:Mp(l.readTime)}})(i)),At.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T4e{constructor(){this.overlays=new ks(xn.comparator),this.kr=new Map}getOverlay(e,i){return At.resolve(this.overlays.get(i))}getOverlays(e,i){const o=Ny();return At.forEach(i,(l=>this.getOverlay(e,l).next((u=>{u!==null&&o.set(l,u)})))).next((()=>o))}saveOverlays(e,i,o){return o.forEach(((l,u)=>{this.wt(e,i,u)})),At.resolve()}removeOverlaysForBatchId(e,i,o){const l=this.kr.get(o);return l!==void 0&&(l.forEach((u=>this.overlays=this.overlays.remove(u))),this.kr.delete(o)),At.resolve()}getOverlaysForCollection(e,i,o){const l=Ny(),u=i.length+1,f=new xn(i.child("")),y=this.overlays.getIteratorFrom(f);for(;y.hasNext();){const v=y.getNext().value,b=v.getKey();if(!i.isPrefixOf(b.path))break;b.path.length===u&&v.largestBatchId>o&&l.set(v.getKey(),v)}return At.resolve(l)}getOverlaysForCollectionGroup(e,i,o,l){let u=new ks(((b,C)=>b-C));const f=this.overlays.getIterator();for(;f.hasNext();){const b=f.getNext().value;if(b.getKey().getCollectionGroup()===i&&b.largestBatchId>o){let C=u.get(b.largestBatchId);C===null&&(C=Ny(),u=u.insert(b.largestBatchId,C)),C.set(b.getKey(),b)}}const y=Ny(),v=u.getIterator();for(;v.hasNext()&&(v.getNext().value.forEach(((b,C)=>y.set(b,C))),!(y.size()>=l)););return At.resolve(y)}wt(e,i,o){const l=this.overlays.get(o.key);if(l!==null){const f=this.kr.get(l.largestBatchId).delete(o.key);this.kr.set(l.largestBatchId,f)}this.overlays=this.overlays.insert(o.key,new WFe(i,o));let u=this.kr.get(i);u===void 0&&(u=zr(),this.kr.set(i,u)),this.kr.set(i,u.add(o.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C4e{constructor(){this.sessionToken=Fa.EMPTY_BYTE_STRING}getSessionToken(e){return At.resolve(this.sessionToken)}setSessionToken(e,i){return this.sessionToken=i,At.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wj{constructor(){this.qr=new Yo(_a.Qr),this.$r=new Yo(_a.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,i){const o=new _a(e,i);this.qr=this.qr.add(o),this.$r=this.$r.add(o)}Kr(e,i){e.forEach((o=>this.addReference(o,i)))}removeReference(e,i){this.Wr(new _a(e,i))}Gr(e,i){e.forEach((o=>this.removeReference(o,i)))}zr(e){const i=new xn(new Ji([])),o=new _a(i,e),l=new _a(i,e+1),u=[];return this.$r.forEachInRange([o,l],(f=>{this.Wr(f),u.push(f.key)})),u}jr(){this.qr.forEach((e=>this.Wr(e)))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){const i=new xn(new Ji([])),o=new _a(i,e),l=new _a(i,e+1);let u=zr();return this.$r.forEachInRange([o,l],(f=>{u=u.add(f.key)})),u}containsKey(e){const i=new _a(e,0),o=this.qr.firstAfterOrEqual(i);return o!==null&&e.isEqual(o.key)}}class _a{constructor(e,i){this.key=e,this.Hr=i}static Qr(e,i){return xn.comparator(e.key,i.key)||Or(e.Hr,i.Hr)}static Ur(e,i){return Or(e.Hr,i.Hr)||xn.comparator(e.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R4e{constructor(e,i){this.indexManager=e,this.referenceDelegate=i,this.mutationQueue=[],this.er=1,this.Yr=new Yo(_a.Qr)}checkEmpty(e){return At.resolve(this.mutationQueue.length===0)}addMutationBatch(e,i,o,l){const u=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const f=new zFe(u,i,o,l);this.mutationQueue.push(f);for(const y of l)this.Yr=this.Yr.add(new _a(y.key,u)),this.indexManager.addToCollectionParentIndex(e,y.key.path.popLast());return At.resolve(f)}lookupMutationBatch(e,i){return At.resolve(this.Zr(i))}getNextMutationBatchAfterBatchId(e,i){const o=i+1,l=this.Xr(o),u=l<0?0:l;return At.resolve(this.mutationQueue.length>u?this.mutationQueue[u]:null)}getHighestUnacknowledgedBatchId(){return At.resolve(this.mutationQueue.length===0?xj:this.er-1)}getAllMutationBatches(e){return At.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,i){const o=new _a(i,0),l=new _a(i,Number.POSITIVE_INFINITY),u=[];return this.Yr.forEachInRange([o,l],(f=>{const y=this.Zr(f.Hr);u.push(y)})),At.resolve(u)}getAllMutationBatchesAffectingDocumentKeys(e,i){let o=new Yo(Or);return i.forEach((l=>{const u=new _a(l,0),f=new _a(l,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([u,f],(y=>{o=o.add(y.Hr)}))})),At.resolve(this.ei(o))}getAllMutationBatchesAffectingQuery(e,i){const o=i.path,l=o.length+1;let u=o;xn.isDocumentKey(u)||(u=u.child(""));const f=new _a(new xn(u),0);let y=new Yo(Or);return this.Yr.forEachWhile((v=>{const b=v.key.path;return!!o.isPrefixOf(b)&&(b.length===l&&(y=y.add(v.Hr)),!0)}),f),At.resolve(this.ei(y))}ei(e){const i=[];return e.forEach((o=>{const l=this.Zr(o);l!==null&&i.push(l)})),i}removeMutationBatch(e,i){bi(this.ti(i.batchId,"removed")===0,55003),this.mutationQueue.shift();let o=this.Yr;return At.forEach(i.mutations,(l=>{const u=new _a(l.key,i.batchId);return o=o.delete(u),this.referenceDelegate.markPotentiallyOrphaned(e,l.key)})).next((()=>{this.Yr=o}))}rr(e){}containsKey(e,i){const o=new _a(i,0),l=this.Yr.firstAfterOrEqual(o);return At.resolve(i.isEqual(l&&l.key))}performConsistencyCheck(e){return this.mutationQueue.length,At.resolve()}ti(e,i){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){const i=this.Xr(e);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I4e{constructor(e){this.ni=e,this.docs=(function(){return new ks(xn.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,i){const o=i.key,l=this.docs.get(o),u=l?l.size:0,f=this.ni(i);return this.docs=this.docs.insert(o,{document:i.mutableCopy(),size:f}),this.size+=f-u,this.indexManager.addToCollectionParentIndex(e,o.path.popLast())}removeEntry(e){const i=this.docs.get(e);i&&(this.docs=this.docs.remove(e),this.size-=i.size)}getEntry(e,i){const o=this.docs.get(i);return At.resolve(o?o.document.mutableCopy():hc.newInvalidDocument(i))}getEntries(e,i){let o=Qf();return i.forEach((l=>{const u=this.docs.get(l);o=o.insert(l,u?u.document.mutableCopy():hc.newInvalidDocument(l))})),At.resolve(o)}getDocumentsMatchingQuery(e,i,o,l){let u=Qf();const f=i.path,y=new xn(f.child("__id-9223372036854775808__")),v=this.docs.getIteratorFrom(y);for(;v.hasNext();){const{key:b,value:{document:C}}=v.getNext();if(!f.isPrefixOf(b.path))break;b.path.length>f.length+1||rFe(nFe(C),o)<=0||(l.has(C.key)||RN(i,C))&&(u=u.insert(C.key,C.mutableCopy()))}return At.resolve(u)}getAllFromCollectionGroup(e,i,o,l){Zn(9500)}ri(e,i){return At.forEach(this.docs,(o=>i(o)))}newChangeBuffer(e){return new A4e(this)}getSize(e){return At.resolve(this.size)}}class A4e extends v4e{constructor(e){super(),this.Or=e}applyChanges(e){const i=[];return this.changes.forEach(((o,l)=>{l.isValidDocument()?i.push(this.Or.addEntry(e,l)):this.Or.removeEntry(o)})),At.waitFor(i)}getFromCache(e,i){return this.Or.getEntry(e,i)}getAllFromCache(e,i){return this.Or.getEntries(e,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P4e{constructor(e){this.persistence=e,this.ii=new hE((i=>Mj(i)),Uj),this.lastRemoteSnapshotVersion=lr.min(),this.highestTargetId=0,this.si=0,this.oi=new Wj,this.targetCount=0,this._i=BS.ar()}forEachTarget(e,i){return this.ii.forEach(((o,l)=>i(l))),At.resolve()}getLastRemoteSnapshotVersion(e){return At.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return At.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),At.resolve(this.highestTargetId)}setTargetsMetadata(e,i,o){return o&&(this.lastRemoteSnapshotVersion=o),i>this.si&&(this.si=i),At.resolve()}hr(e){this.ii.set(e.target,e);const i=e.targetId;i>this.highestTargetId&&(this._i=new BS(i),this.highestTargetId=i),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,i){return this.hr(i),this.targetCount+=1,At.resolve()}updateTargetData(e,i){return this.hr(i),At.resolve()}removeTargetData(e,i){return this.ii.delete(i.target),this.oi.zr(i.targetId),this.targetCount-=1,At.resolve()}removeTargets(e,i,o){let l=0;const u=[];return this.ii.forEach(((f,y)=>{y.sequenceNumber<=i&&o.get(y.targetId)===null&&(this.ii.delete(f),u.push(this.removeMatchingKeysForTargetId(e,y.targetId)),l++)})),At.waitFor(u).next((()=>l))}getTargetCount(e){return At.resolve(this.targetCount)}getTargetData(e,i){const o=this.ii.get(i)||null;return At.resolve(o)}addMatchingKeys(e,i,o){return this.oi.Kr(i,o),At.resolve()}removeMatchingKeys(e,i,o){this.oi.Gr(i,o);const l=this.persistence.referenceDelegate,u=[];return l&&i.forEach((f=>{u.push(l.markPotentiallyOrphaned(e,f))})),At.waitFor(u)}removeMatchingKeysForTargetId(e,i){return this.oi.zr(i),At.resolve()}getMatchingKeysForTargetId(e,i){const o=this.oi.Jr(i);return At.resolve(o)}containsKey(e,i){return At.resolve(this.oi.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qse{constructor(e,i){this.ai={},this.overlays={},this.ui=new SN(0),this.ci=!1,this.ci=!0,this.li=new C4e,this.referenceDelegate=e(this),this.hi=new P4e(this),this.indexManager=new p4e,this.remoteDocumentCache=(function(l){return new I4e(l)})((o=>this.referenceDelegate.Pi(o))),this.serializer=new d4e(i),this.Ti=new w4e(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let i=this.overlays[e.toKey()];return i||(i=new T4e,this.overlays[e.toKey()]=i),i}getMutationQueue(e,i){let o=this.ai[e.toKey()];return o||(o=new R4e(i,this.referenceDelegate),this.ai[e.toKey()]=o),o}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,i,o){fn("MemoryPersistence","Starting transaction:",e);const l=new O4e(this.ui.next());return this.referenceDelegate.Ii(),o(l).next((u=>this.referenceDelegate.di(l).next((()=>u)))).toPromise().then((u=>(l.raiseOnCommittedEvent(),u)))}Ei(e,i){return At.or(Object.values(this.ai).map((o=>()=>o.containsKey(e,i))))}}class O4e extends sFe{constructor(e){super(),this.currentSequenceNumber=e}}class Gj{constructor(e){this.persistence=e,this.Ai=new Wj,this.Ri=null}static Vi(e){return new Gj(e)}get mi(){if(this.Ri)return this.Ri;throw Zn(60996)}addReference(e,i,o){return this.Ai.addReference(o,i),this.mi.delete(o.toString()),At.resolve()}removeReference(e,i,o){return this.Ai.removeReference(o,i),this.mi.add(o.toString()),At.resolve()}markPotentiallyOrphaned(e,i){return this.mi.add(i.toString()),At.resolve()}removeTarget(e,i){this.Ai.zr(i.targetId).forEach((l=>this.mi.add(l.toString())));const o=this.persistence.getTargetCache();return o.getMatchingKeysForTargetId(e,i.targetId).next((l=>{l.forEach((u=>this.mi.add(u.toString())))})).next((()=>o.removeTargetData(e,i)))}Ii(){this.Ri=new Set}di(e){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return At.forEach(this.mi,(o=>{const l=xn.fromPath(o);return this.fi(e,l).next((u=>{u||i.removeEntry(l,lr.min())}))})).next((()=>(this.Ri=null,i.apply(e))))}updateLimboDocument(e,i){return this.fi(e,i).next((o=>{o?this.mi.delete(i.toString()):this.mi.add(i.toString())}))}Pi(e){return 0}fi(e,i){return At.or([()=>At.resolve(this.Ai.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(e,i),()=>this.persistence.Ei(e,i)])}}class Ik{constructor(e,i){this.persistence=e,this.gi=new hE((o=>cFe(o.path)),((o,l)=>o.isEqual(l))),this.garbageCollector=E4e(this,i)}static Vi(e,i){return new Ik(e,i)}Ii(){}di(e){return At.resolve()}forEachTarget(e,i){return this.persistence.getTargetCache().forEachTarget(e,i)}mr(e){const i=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next((o=>i.next((l=>o+l))))}yr(e){let i=0;return this.gr(e,(o=>{i++})).next((()=>i))}gr(e,i){return At.forEach(this.gi,((o,l)=>this.Sr(e,o,l).next((u=>u?At.resolve():i(l)))))}removeTargets(e,i,o){return this.persistence.getTargetCache().removeTargets(e,i,o)}removeOrphanedDocuments(e,i){let o=0;const l=this.persistence.getRemoteDocumentCache(),u=l.newChangeBuffer();return l.ri(e,(f=>this.Sr(e,f,i).next((y=>{y||(o++,u.removeEntry(f,lr.min()))})))).next((()=>u.apply(e))).next((()=>o))}markPotentiallyOrphaned(e,i){return this.gi.set(i,e.currentSequenceNumber),At.resolve()}removeTarget(e,i){const o=i.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,o)}addReference(e,i,o){return this.gi.set(o,e.currentSequenceNumber),At.resolve()}removeReference(e,i,o){return this.gi.set(o,e.currentSequenceNumber),At.resolve()}updateLimboDocument(e,i){return this.gi.set(i,e.currentSequenceNumber),At.resolve()}Pi(e){let i=e.key.toString().length;return e.isFoundDocument()&&(i+=VO(e.data.value)),i}Sr(e,i,o){return At.or([()=>this.persistence.Ei(e,i),()=>this.persistence.getTargetCache().containsKey(e,i),()=>{const l=this.gi.get(i);return At.resolve(l!==void 0&&l>o)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hj{constructor(e,i,o,l){this.targetId=e,this.fromCache=i,this.Is=o,this.ds=l}static Es(e,i){let o=zr(),l=zr();for(const u of i.docChanges)switch(u.type){case 0:o=o.add(u.doc.key);break;case 1:l=l.add(u.doc.key)}return new Hj(e,i.fromCache,o,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k4e{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N4e{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=(function(){return lVe()?8:oFe(fc())>0?6:4})()}initialize(e,i){this.gs=e,this.indexManager=i,this.As=!0}getDocumentsMatchingQuery(e,i,o,l){const u={result:null};return this.ps(e,i).next((f=>{u.result=f})).next((()=>{if(!u.result)return this.ys(e,i,l,o).next((f=>{u.result=f}))})).next((()=>{if(u.result)return;const f=new k4e;return this.ws(e,i,f).next((y=>{if(u.result=y,this.Rs)return this.Ss(e,i,f,y.size)}))})).next((()=>u.result))}Ss(e,i,o,l){return o.documentReadCount<this.Vs?(N0()<=Fr.DEBUG&&fn("QueryEngine","SDK will not create cache indexes for query:",x0(i),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),At.resolve()):(N0()<=Fr.DEBUG&&fn("QueryEngine","Query:",x0(i),"scans",o.documentReadCount,"local documents and returns",l,"documents as results."),o.documentReadCount>this.fs*l?(N0()<=Fr.DEBUG&&fn("QueryEngine","The SDK decides to create cache indexes for query:",x0(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Lp(i))):At.resolve())}ps(e,i){if(WJ(i))return At.resolve(null);let o=Lp(i);return this.indexManager.getIndexType(e,o).next((l=>l===0?null:(i.limit!==null&&l===1&&(i=wk(i,null,"F"),o=Lp(i)),this.indexManager.getDocumentsMatchingTarget(e,o).next((u=>{const f=zr(...u);return this.gs.getDocuments(e,f).next((y=>this.indexManager.getMinOffset(e,o).next((v=>{const b=this.bs(i,y);return this.Ds(i,b,f,v.readTime)?this.ps(e,wk(i,null,"F")):this.vs(e,b,i,v)}))))})))))}ys(e,i,o,l){return WJ(i)||l.isEqual(lr.min())?At.resolve(null):this.gs.getDocuments(e,o).next((u=>{const f=this.bs(i,u);return this.Ds(i,f,o,l)?At.resolve(null):(N0()<=Fr.DEBUG&&fn("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),x0(i)),this.vs(e,f,i,tFe(l,yR)).next((y=>y)))}))}bs(e,i){let o=new Yo(Cse(e));return i.forEach(((l,u)=>{RN(e,u)&&(o=o.add(u))})),o}Ds(e,i,o,l){if(e.limit===null)return!1;if(o.size!==i.size)return!0;const u=e.limitType==="F"?i.last():i.first();return!!u&&(u.hasPendingWrites||u.version.compareTo(l)>0)}ws(e,i,o){return N0()<=Fr.DEBUG&&fn("QueryEngine","Using full collection scan to execute query:",x0(i)),this.gs.getDocumentsMatchingQuery(e,i,Vg.min(),o)}vs(e,i,o,l){return this.gs.getDocumentsMatchingQuery(e,o,l).next((u=>(i.forEach((f=>{u=u.insert(f.key,f)})),u)))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $j="LocalStore",x4e=3e8;class D4e{constructor(e,i,o,l){this.persistence=e,this.Cs=i,this.serializer=l,this.Fs=new ks(Or),this.Ms=new hE((u=>Mj(u)),Uj),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(o)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new b4e(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(i=>e.collect(i,this.Fs)))}}function L4e(n,e,i,o){return new D4e(n,e,i,o)}async function Yse(n,e){const i=pr(n);return await i.persistence.runTransaction("Handle user change","readonly",(o=>{let l;return i.mutationQueue.getAllMutationBatches(o).next((u=>(l=u,i.Ns(e),i.mutationQueue.getAllMutationBatches(o)))).next((u=>{const f=[],y=[];let v=zr();for(const b of l){f.push(b.batchId);for(const C of b.mutations)v=v.add(C.key)}for(const b of u){y.push(b.batchId);for(const C of b.mutations)v=v.add(C.key)}return i.localDocuments.getDocuments(o,v).next((b=>({Bs:b,removedBatchIds:f,addedBatchIds:y})))}))}))}function M4e(n,e){const i=pr(n);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",(o=>{const l=e.batch.keys(),u=i.Os.newChangeBuffer({trackRemovals:!0});return(function(y,v,b,C){const R=b.batch,O=R.keys();let L=At.resolve();return O.forEach((D=>{L=L.next((()=>C.getEntry(v,D))).next((U=>{const B=b.docVersions.get(D);bi(B!==null,48541),U.version.compareTo(B)<0&&(R.applyToRemoteDocument(U,b),U.isValidDocument()&&(U.setReadTime(b.commitVersion),C.addEntry(U)))}))})),L.next((()=>y.mutationQueue.removeMutationBatch(v,R)))})(i,o,e,u).next((()=>u.apply(o))).next((()=>i.mutationQueue.performConsistencyCheck(o))).next((()=>i.documentOverlayCache.removeOverlaysForBatchId(o,l,e.batch.batchId))).next((()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(o,(function(y){let v=zr();for(let b=0;b<y.mutationResults.length;++b)y.mutationResults[b].transformResults.length>0&&(v=v.add(y.batch.mutations[b].key));return v})(e)))).next((()=>i.localDocuments.getDocuments(o,l)))}))}function Xse(n){const e=pr(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(i=>e.hi.getLastRemoteSnapshotVersion(i)))}function U4e(n,e){const i=pr(n),o=e.snapshotVersion;let l=i.Fs;return i.persistence.runTransaction("Apply remote event","readwrite-primary",(u=>{const f=i.Os.newChangeBuffer({trackRemovals:!0});l=i.Fs;const y=[];e.targetChanges.forEach(((C,R)=>{const O=l.get(R);if(!O)return;y.push(i.hi.removeMatchingKeys(u,C.removedDocuments,R).next((()=>i.hi.addMatchingKeys(u,C.addedDocuments,R))));let L=O.withSequenceNumber(u.currentSequenceNumber);e.targetMismatches.get(R)!==null?L=L.withResumeToken(Fa.EMPTY_BYTE_STRING,lr.min()).withLastLimboFreeSnapshotVersion(lr.min()):C.resumeToken.approximateByteSize()>0&&(L=L.withResumeToken(C.resumeToken,o)),l=l.insert(R,L),(function(U,B,Y){return U.resumeToken.approximateByteSize()===0||B.snapshotVersion.toMicroseconds()-U.snapshotVersion.toMicroseconds()>=x4e?!0:Y.addedDocuments.size+Y.modifiedDocuments.size+Y.removedDocuments.size>0})(O,L,C)&&y.push(i.hi.updateTargetData(u,L))}));let v=Qf(),b=zr();if(e.documentUpdates.forEach((C=>{e.resolvedLimboDocuments.has(C)&&y.push(i.persistence.referenceDelegate.updateLimboDocument(u,C))})),y.push(V4e(u,f,e.documentUpdates).next((C=>{v=C.Ls,b=C.ks}))),!o.isEqual(lr.min())){const C=i.hi.getLastRemoteSnapshotVersion(u).next((R=>i.hi.setTargetsMetadata(u,u.currentSequenceNumber,o)));y.push(C)}return At.waitFor(y).next((()=>f.apply(u))).next((()=>i.localDocuments.getLocalViewOfDocuments(u,v,b))).next((()=>v))})).then((u=>(i.Fs=l,u)))}function V4e(n,e,i){let o=zr(),l=zr();return i.forEach((u=>o=o.add(u))),e.getEntries(n,o).next((u=>{let f=Qf();return i.forEach(((y,v)=>{const b=u.get(y);v.isFoundDocument()!==b.isFoundDocument()&&(l=l.add(y)),v.isNoDocument()&&v.version.isEqual(lr.min())?(e.removeEntry(y,v.readTime),f=f.insert(y,v)):!b.isValidDocument()||v.version.compareTo(b.version)>0||v.version.compareTo(b.version)===0&&b.hasPendingWrites?(e.addEntry(v),f=f.insert(y,v)):fn($j,"Ignoring outdated watch update for ",y,". Current version:",b.version," Watch version:",v.version)})),{Ls:f,ks:l}}))}function j4e(n,e){const i=pr(n);return i.persistence.runTransaction("Get next mutation batch","readonly",(o=>(e===void 0&&(e=xj),i.mutationQueue.getNextMutationBatchAfterBatchId(o,e))))}function F4e(n,e){const i=pr(n);return i.persistence.runTransaction("Allocate target","readwrite",(o=>{let l;return i.hi.getTargetData(o,e).next((u=>u?(l=u,At.resolve(l)):i.hi.allocateTargetId(o).next((f=>(l=new Ig(e,f,"TargetPurposeListen",o.currentSequenceNumber),i.hi.addTargetData(o,l).next((()=>l)))))))})).then((o=>{const l=i.Fs.get(o.targetId);return(l===null||o.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(i.Fs=i.Fs.insert(o.targetId,o),i.Ms.set(e,o.targetId)),o}))}async function _5(n,e,i){const o=pr(n),l=o.Fs.get(e),u=i?"readwrite":"readwrite-primary";try{i||await o.persistence.runTransaction("Release target",u,(f=>o.persistence.referenceDelegate.removeTarget(f,l)))}catch(f){if(!rb(f))throw f;fn($j,`Failed to update sequence numbers for target ${e}: ${f}`)}o.Fs=o.Fs.remove(e),o.Ms.delete(l.target)}function nQ(n,e,i){const o=pr(n);let l=lr.min(),u=zr();return o.persistence.runTransaction("Execute query","readwrite",(f=>(function(v,b,C){const R=pr(v),O=R.Ms.get(C);return O!==void 0?At.resolve(R.Fs.get(O)):R.hi.getTargetData(b,C)})(o,f,Lp(e)).next((y=>{if(y)return l=y.lastLimboFreeSnapshotVersion,o.hi.getMatchingKeysForTargetId(f,y.targetId).next((v=>{u=v}))})).next((()=>o.Cs.getDocumentsMatchingQuery(f,e,i?l:lr.min(),i?u:zr()))).next((y=>(B4e(o,IFe(e),y),{documents:y,qs:u})))))}function B4e(n,e,i){let o=n.xs.get(e)||lr.min();i.forEach(((l,u)=>{u.readTime.compareTo(o)>0&&(o=u.readTime)})),n.xs.set(e,o)}class rQ{constructor(){this.activeTargetIds=xFe()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class z4e{constructor(){this.Fo=new rQ,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,i,o){}addLocalQueryTarget(e,i=!0){return i&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,i,o){this.Mo[e]=i}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new rQ,Promise.resolve()}handleUserChange(e,i,o){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W4e{xo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iQ="ConnectivityMonitor";class sQ{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){fn(iQ,"Network connectivity changed: AVAILABLE");for(const e of this.ko)e(0)}Lo(){fn(iQ,"Network connectivity changed: UNAVAILABLE");for(const e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let aO=null;function y5(){return aO===null?aO=(function(){return 268435456+Math.round(2147483648*Math.random())})():aO++,"0x"+aO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KU="RestConnection",G4e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class H4e{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const i=e.ssl?"https":"http",o=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.$o=i+"://"+e.host,this.Uo=`projects/${o}/databases/${l}`,this.Ko=this.databaseId.database===vk?`project_id=${o}`:`project_id=${o}&database_id=${l}`}Wo(e,i,o,l,u){const f=y5(),y=this.Go(e,i.toUriEncodedString());fn(KU,`Sending RPC '${e}' ${f}:`,y,o);const v={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(v,l,u);const{host:b}=new URL(y),C=tm(b);return this.jo(e,y,v,o,C).then((R=>(fn(KU,`Received RPC '${e}' ${f}: `,R),R)),(R=>{throw Ug(KU,`RPC '${e}' ${f} failed with error: `,R,"url: ",y,"request:",o),R}))}Jo(e,i,o,l,u,f){return this.Wo(e,i,o,l,u)}zo(e,i,o){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+tb})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach(((l,u)=>e[u]=l)),o&&o.headers.forEach(((l,u)=>e[u]=l))}Go(e,i){const o=G4e[e];return`${this.$o}/v1/${i}:${o}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $4e{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ac="WebChannelConnection";class K4e extends H4e{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,i,o,l,u){const f=y5();return new Promise(((y,v)=>{const b=new Jie;b.setWithCredentials(!0),b.listenOnce(Qie.COMPLETE,(()=>{try{switch(b.getLastErrorCode()){case UO.NO_ERROR:const R=b.getResponseJson();fn(ac,`XHR for RPC '${e}' ${f} received:`,JSON.stringify(R)),y(R);break;case UO.TIMEOUT:fn(ac,`RPC '${e}' ${f} timed out`),v(new sn(Tt.DEADLINE_EXCEEDED,"Request time out"));break;case UO.HTTP_ERROR:const O=b.getStatus();if(fn(ac,`RPC '${e}' ${f} failed with status:`,O,"response text:",b.getResponseText()),O>0){let L=b.getResponseJson();Array.isArray(L)&&(L=L[0]);const D=L==null?void 0:L.error;if(D&&D.status&&D.message){const U=(function(Y){const W=Y.toLowerCase().replace(/_/g,"-");return Object.values(Tt).indexOf(W)>=0?W:Tt.UNKNOWN})(D.status);v(new sn(U,D.message))}else v(new sn(Tt.UNKNOWN,"Server responded with status "+b.getStatus()))}else v(new sn(Tt.UNAVAILABLE,"Connection failed."));break;default:Zn(9055,{c_:e,streamId:f,l_:b.getLastErrorCode(),h_:b.getLastError()})}}finally{fn(ac,`RPC '${e}' ${f} completed.`)}}));const C=JSON.stringify(l);fn(ac,`RPC '${e}' ${f} sending request:`,l),b.send(i,"POST",C,o,15)}))}P_(e,i,o){const l=y5(),u=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],f=tse(),y=ese(),v={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(v.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(v.useFetchStreams=!0),this.zo(v.initMessageHeaders,i,o),v.encodeInitMessageHeaders=!0;const C=u.join("");fn(ac,`Creating RPC '${e}' stream ${l}: ${C}`,v);const R=f.createWebChannel(C,v);this.T_(R);let O=!1,L=!1;const D=new $4e({Ho:B=>{L?fn(ac,`Not sending because RPC '${e}' stream ${l} is closed:`,B):(O||(fn(ac,`Opening RPC '${e}' stream ${l} transport.`),R.open(),O=!0),fn(ac,`RPC '${e}' stream ${l} sending:`,B),R.send(B))},Yo:()=>R.close()}),U=(B,Y,W)=>{B.listen(Y,(ne=>{try{W(ne)}catch(le){setTimeout((()=>{throw le}),0)}}))};return U(R,_C.EventType.OPEN,(()=>{L||(fn(ac,`RPC '${e}' stream ${l} transport opened.`),D.s_())})),U(R,_C.EventType.CLOSE,(()=>{L||(L=!0,fn(ac,`RPC '${e}' stream ${l} transport closed`),D.__(),this.I_(R))})),U(R,_C.EventType.ERROR,(B=>{L||(L=!0,Ug(ac,`RPC '${e}' stream ${l} transport errored. Name:`,B.name,"Message:",B.message),D.__(new sn(Tt.UNAVAILABLE,"The operation could not be completed")))})),U(R,_C.EventType.MESSAGE,(B=>{var Y;if(!L){const W=B.data[0];bi(!!W,16349);const ne=W,le=(ne==null?void 0:ne.error)||((Y=ne[0])===null||Y===void 0?void 0:Y.error);if(le){fn(ac,`RPC '${e}' stream ${l} received error:`,le);const re=le.status;let me=(function(Q){const ie=Co[Q];if(ie!==void 0)return Use(ie)})(re),q=le.message;me===void 0&&(me=Tt.INTERNAL,q="Unknown error status: "+re+" with message "+le.message),L=!0,D.__(new sn(me,q)),R.close()}else fn(ac,`RPC '${e}' stream ${l} received:`,W),D.a_(W)}})),U(y,Zie.STAT_EVENT,(B=>{B.stat===o5.PROXY?fn(ac,`RPC '${e}' stream ${l} detected buffering proxy`):B.stat===o5.NOPROXY&&fn(ac,`RPC '${e}' stream ${l} detected no buffering proxy`)})),setTimeout((()=>{D.o_()}),0),D}terminate(){this.u_.forEach((e=>e.close())),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter((i=>i===e))}}function qU(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ON(n){return new JFe(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jse{constructor(e,i,o=1e3,l=1.5,u=6e4){this.Fi=e,this.timerId=i,this.d_=o,this.E_=l,this.A_=u,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();const i=Math.floor(this.R_+this.p_()),o=Math.max(0,Date.now()-this.m_),l=Math.max(0,i-o);l>0&&fn("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.R_} ms, delay with jitter: ${i} ms, last attempt: ${o} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,l,(()=>(this.m_=Date.now(),e()))),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oQ="PersistentStream";class Qse{constructor(e,i,o,l,u,f,y,v){this.Fi=e,this.w_=o,this.S_=l,this.connection=u,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=y,this.listener=v,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Jse(e,i)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,(()=>this.L_())))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,i){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():i&&i.code===Tt.RESOURCE_EXHAUSTED?(Jf(i.toString()),Jf("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):i&&i.code===Tt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(i)}U_(){}auth(){this.state=1;const e=this.K_(this.b_),i=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([o,l])=>{this.b_===i&&this.W_(o,l)}),(o=>{e((()=>{const l=new sn(Tt.UNKNOWN,"Fetching auth token failed: "+o.message);return this.G_(l)}))}))}W_(e,i){const o=this.K_(this.b_);this.stream=this.z_(e,i),this.stream.Zo((()=>{o((()=>this.listener.Zo()))})),this.stream.e_((()=>{o((()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,(()=>(this.x_()&&(this.state=3),Promise.resolve()))),this.listener.e_())))})),this.stream.n_((l=>{o((()=>this.G_(l)))})),this.stream.onMessage((l=>{o((()=>++this.C_==1?this.j_(l):this.onNext(l)))}))}O_(){this.state=5,this.F_.g_((async()=>{this.state=0,this.start()}))}G_(e){return fn(oQ,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return i=>{this.Fi.enqueueAndForget((()=>this.b_===e?i():(fn(oQ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class q4e extends Qse{constructor(e,i,o,l,u,f){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,o,l,f),this.serializer=u}z_(e,i){return this.connection.P_("Listen",e,i)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();const i=e4e(this.serializer,e),o=(function(u){if(!("targetChange"in u))return lr.min();const f=u.targetChange;return f.targetIds&&f.targetIds.length?lr.min():f.readTime?Mp(f.readTime):lr.min()})(e);return this.listener.J_(i,o)}H_(e){const i={};i.database=g5(this.serializer),i.addTarget=(function(u,f){let y;const v=f.target;if(y=d5(v)?{documents:r4e(u,v)}:{query:i4e(u,v).Vt},y.targetId=f.targetId,f.resumeToken.approximateByteSize()>0){y.resumeToken=Fse(u,f.resumeToken);const b=p5(u,f.expectedCount);b!==null&&(y.expectedCount=b)}else if(f.snapshotVersion.compareTo(lr.min())>0){y.readTime=Rk(u,f.snapshotVersion.toTimestamp());const b=p5(u,f.expectedCount);b!==null&&(y.expectedCount=b)}return y})(this.serializer,e);const o=o4e(this.serializer,e);o&&(i.labels=o),this.k_(i)}Y_(e){const i={};i.database=g5(this.serializer),i.removeTarget=e,this.k_(i)}}class Y4e extends Qse{constructor(e,i,o,l,u,f){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,o,l,f),this.serializer=u}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,i){return this.connection.P_("Write",e,i)}j_(e){return bi(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,bi(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){bi(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();const i=n4e(e.writeResults,e.commitTime),o=Mp(e.commitTime);return this.listener.ta(o,i)}na(){const e={};e.database=g5(this.serializer),this.k_(e)}X_(e){const i={streamToken:this.lastStreamToken,writes:e.map((o=>t4e(this.serializer,o)))};this.k_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X4e{}class J4e extends X4e{constructor(e,i,o,l){super(),this.authCredentials=e,this.appCheckCredentials=i,this.connection=o,this.serializer=l,this.ra=!1}ia(){if(this.ra)throw new sn(Tt.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,i,o,l){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([u,f])=>this.connection.Wo(e,f5(i,o),l,u,f))).catch((u=>{throw u.name==="FirebaseError"?(u.code===Tt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new sn(Tt.UNKNOWN,u.toString())}))}Jo(e,i,o,l,u){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([f,y])=>this.connection.Jo(e,f5(i,o),l,f,y,u))).catch((f=>{throw f.name==="FirebaseError"?(f.code===Tt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new sn(Tt.UNKNOWN,f.toString())}))}terminate(){this.ra=!0,this.connection.terminate()}}class Q4e{constructor(e,i){this.asyncQueue=e,this.onlineStateHandler=i,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve()))))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){const i=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(Jf(i),this._a=!1):fn("OnlineStateTracker",i)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oE="RemoteStore";class Z4e{constructor(e,i,o,l,u){this.localStore=e,this.datastore=i,this.asyncQueue=o,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=u,this.Ea.xo((f=>{o.enqueueAndForget((async()=>{pE(this)&&(fn(oE,"Restarting streams for network reachability change."),await(async function(v){const b=pr(v);b.Ia.add(4),await JR(b),b.Aa.set("Unknown"),b.Ia.delete(4),await kN(b)})(this))}))})),this.Aa=new Q4e(o,l)}}async function kN(n){if(pE(n))for(const e of n.da)await e(!0)}async function JR(n){for(const e of n.da)await e(!1)}function Zse(n,e){const i=pr(n);i.Ta.has(e.targetId)||(i.Ta.set(e.targetId,e),Xj(i)?Yj(i):sb(i).x_()&&qj(i,e))}function Kj(n,e){const i=pr(n),o=sb(i);i.Ta.delete(e),o.x_()&&eoe(i,e),i.Ta.size===0&&(o.x_()?o.B_():pE(i)&&i.Aa.set("Unknown"))}function qj(n,e){if(n.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(lr.min())>0){const i=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(i)}sb(n).H_(e)}function eoe(n,e){n.Ra.$e(e),sb(n).Y_(e)}function Yj(n){n.Ra=new KFe({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.Ta.get(e)||null,lt:()=>n.datastore.serializer.databaseId}),sb(n).start(),n.Aa.aa()}function Xj(n){return pE(n)&&!sb(n).M_()&&n.Ta.size>0}function pE(n){return pr(n).Ia.size===0}function toe(n){n.Ra=void 0}async function e6e(n){n.Aa.set("Online")}async function t6e(n){n.Ta.forEach(((e,i)=>{qj(n,e)}))}async function n6e(n,e){toe(n),Xj(n)?(n.Aa.la(e),Yj(n)):n.Aa.set("Unknown")}async function r6e(n,e,i){if(n.Aa.set("Online"),e instanceof jse&&e.state===2&&e.cause)try{await(async function(l,u){const f=u.cause;for(const y of u.targetIds)l.Ta.has(y)&&(await l.remoteSyncer.rejectListen(y,f),l.Ta.delete(y),l.Ra.removeTarget(y))})(n,e)}catch(o){fn(oE,"Failed to remove targets %s: %s ",e.targetIds.join(","),o),await Ak(n,o)}else if(e instanceof BO?n.Ra.Ye(e):e instanceof Vse?n.Ra.it(e):n.Ra.et(e),!i.isEqual(lr.min()))try{const o=await Xse(n.localStore);i.compareTo(o)>=0&&await(function(u,f){const y=u.Ra.Pt(f);return y.targetChanges.forEach(((v,b)=>{if(v.resumeToken.approximateByteSize()>0){const C=u.Ta.get(b);C&&u.Ta.set(b,C.withResumeToken(v.resumeToken,f))}})),y.targetMismatches.forEach(((v,b)=>{const C=u.Ta.get(v);if(!C)return;u.Ta.set(v,C.withResumeToken(Fa.EMPTY_BYTE_STRING,C.snapshotVersion)),eoe(u,v);const R=new Ig(C.target,v,b,C.sequenceNumber);qj(u,R)})),u.remoteSyncer.applyRemoteEvent(y)})(n,i)}catch(o){fn(oE,"Failed to raise snapshot:",o),await Ak(n,o)}}async function Ak(n,e,i){if(!rb(e))throw e;n.Ia.add(1),await JR(n),n.Aa.set("Offline"),i||(i=()=>Xse(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{fn(oE,"Retrying IndexedDB access"),await i(),n.Ia.delete(1),await kN(n)}))}function noe(n,e){return e().catch((i=>Ak(n,i,e)))}async function NN(n){const e=pr(n),i=zg(e);let o=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:xj;for(;i6e(e);)try{const l=await j4e(e.localStore,o);if(l===null){e.Pa.length===0&&i.B_();break}o=l.batchId,s6e(e,l)}catch(l){await Ak(e,l)}roe(e)&&ioe(e)}function i6e(n){return pE(n)&&n.Pa.length<10}function s6e(n,e){n.Pa.push(e);const i=zg(n);i.x_()&&i.Z_&&i.X_(e.mutations)}function roe(n){return pE(n)&&!zg(n).M_()&&n.Pa.length>0}function ioe(n){zg(n).start()}async function o6e(n){zg(n).na()}async function a6e(n){const e=zg(n);for(const i of n.Pa)e.X_(i.mutations)}async function c6e(n,e,i){const o=n.Pa.shift(),l=Fj.from(o,e,i);await noe(n,(()=>n.remoteSyncer.applySuccessfulWrite(l))),await NN(n)}async function l6e(n,e){e&&zg(n).Z_&&await(async function(o,l){if((function(f){return HFe(f)&&f!==Tt.ABORTED})(l.code)){const u=o.Pa.shift();zg(o).N_(),await noe(o,(()=>o.remoteSyncer.rejectFailedWrite(u.batchId,l))),await NN(o)}})(n,e),roe(n)&&ioe(n)}async function aQ(n,e){const i=pr(n);i.asyncQueue.verifyOperationInProgress(),fn(oE,"RemoteStore received new credentials");const o=pE(i);i.Ia.add(3),await JR(i),o&&i.Aa.set("Unknown"),await i.remoteSyncer.handleCredentialChange(e),i.Ia.delete(3),await kN(i)}async function u6e(n,e){const i=pr(n);e?(i.Ia.delete(2),await kN(i)):e||(i.Ia.add(2),await JR(i),i.Aa.set("Unknown"))}function sb(n){return n.Va||(n.Va=(function(i,o,l){const u=pr(i);return u.ia(),new q4e(o,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,l)})(n.datastore,n.asyncQueue,{Zo:e6e.bind(null,n),e_:t6e.bind(null,n),n_:n6e.bind(null,n),J_:r6e.bind(null,n)}),n.da.push((async e=>{e?(n.Va.N_(),Xj(n)?Yj(n):n.Aa.set("Unknown")):(await n.Va.stop(),toe(n))}))),n.Va}function zg(n){return n.ma||(n.ma=(function(i,o,l){const u=pr(i);return u.ia(),new Y4e(o,u.connection,u.authCredentials,u.appCheckCredentials,u.serializer,l)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:o6e.bind(null,n),n_:l6e.bind(null,n),ea:a6e.bind(null,n),ta:c6e.bind(null,n)}),n.da.push((async e=>{e?(n.ma.N_(),await NN(n)):(await n.ma.stop(),n.Pa.length>0&&(fn(oE,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))}))),n.ma}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jj{constructor(e,i,o,l,u){this.asyncQueue=e,this.timerId=i,this.targetTimeMs=o,this.op=l,this.removalCallback=u,this.deferred=new zf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((f=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,i,o,l,u){const f=Date.now()+o,y=new Jj(e,i,f,l,u);return y.start(o),y}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new sn(Tt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Qj(n,e){if(Jf("AsyncQueue",`${e}: ${n}`),rb(n))return new sn(Tt.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ES{static emptySet(e){return new ES(e.comparator)}constructor(e){this.comparator=e?(i,o)=>e(i,o)||xn.comparator(i.key,o.key):(i,o)=>xn.comparator(i.key,o.key),this.keyedMap=yC(),this.sortedSet=new ks(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const i=this.keyedMap.get(e);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((i,o)=>(e(i),!1)))}add(e){const i=this.delete(e.key);return i.copy(i.keyedMap.insert(e.key,e),i.sortedSet.insert(e,null))}delete(e){const i=this.get(e);return i?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(i)):this}isEqual(e){if(!(e instanceof ES)||this.size!==e.size)return!1;const i=this.sortedSet.getIterator(),o=e.sortedSet.getIterator();for(;i.hasNext();){const l=i.getNext().key,u=o.getNext().key;if(!l.isEqual(u))return!1}return!0}toString(){const e=[];return this.forEach((i=>{e.push(i.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,i){const o=new ES;return o.comparator=this.comparator,o.keyedMap=e,o.sortedSet=i,o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cQ{constructor(){this.fa=new ks(xn.comparator)}track(e){const i=e.doc.key,o=this.fa.get(i);o?e.type!==0&&o.type===3?this.fa=this.fa.insert(i,e):e.type===3&&o.type!==1?this.fa=this.fa.insert(i,{type:o.type,doc:e.doc}):e.type===2&&o.type===2?this.fa=this.fa.insert(i,{type:2,doc:e.doc}):e.type===2&&o.type===0?this.fa=this.fa.insert(i,{type:0,doc:e.doc}):e.type===1&&o.type===0?this.fa=this.fa.remove(i):e.type===1&&o.type===2?this.fa=this.fa.insert(i,{type:1,doc:o.doc}):e.type===0&&o.type===1?this.fa=this.fa.insert(i,{type:2,doc:e.doc}):Zn(63341,{At:e,ga:o}):this.fa=this.fa.insert(i,e)}pa(){const e=[];return this.fa.inorderTraversal(((i,o)=>{e.push(o)})),e}}class zS{constructor(e,i,o,l,u,f,y,v,b){this.query=e,this.docs=i,this.oldDocs=o,this.docChanges=l,this.mutatedKeys=u,this.fromCache=f,this.syncStateChanged=y,this.excludesMetadataChanges=v,this.hasCachedResults=b}static fromInitialDocuments(e,i,o,l,u){const f=[];return i.forEach((y=>{f.push({type:0,doc:y})})),new zS(e,i,ES.emptySet(i),f,o,l,!0,!1,u)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&CN(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const i=this.docChanges,o=e.docChanges;if(i.length!==o.length)return!1;for(let l=0;l<i.length;l++)if(i[l].type!==o[l].type||!i[l].doc.isEqual(o[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d6e{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some((e=>e.ba()))}}class h6e{constructor(){this.queries=lQ(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(i,o){const l=pr(i),u=l.queries;l.queries=lQ(),u.forEach(((f,y)=>{for(const v of y.wa)v.onError(o)}))})(this,new sn(Tt.ABORTED,"Firestore shutting down"))}}function lQ(){return new hE((n=>Tse(n)),CN)}async function Zj(n,e){const i=pr(n);let o=3;const l=e.query;let u=i.queries.get(l);u?!u.Sa()&&e.ba()&&(o=2):(u=new d6e,o=e.ba()?0:1);try{switch(o){case 0:u.ya=await i.onListen(l,!0);break;case 1:u.ya=await i.onListen(l,!1);break;case 2:await i.onFirstRemoteStoreListen(l)}}catch(f){const y=Qj(f,`Initialization of query '${x0(e.query)}' failed`);return void e.onError(y)}i.queries.set(l,u),u.wa.push(e),e.va(i.onlineState),u.ya&&e.Ca(u.ya)&&tF(i)}async function eF(n,e){const i=pr(n),o=e.query;let l=3;const u=i.queries.get(o);if(u){const f=u.wa.indexOf(e);f>=0&&(u.wa.splice(f,1),u.wa.length===0?l=e.ba()?0:1:!u.Sa()&&e.ba()&&(l=2))}switch(l){case 0:return i.queries.delete(o),i.onUnlisten(o,!0);case 1:return i.queries.delete(o),i.onUnlisten(o,!1);case 2:return i.onLastRemoteStoreUnlisten(o);default:return}}function p6e(n,e){const i=pr(n);let o=!1;for(const l of e){const u=l.query,f=i.queries.get(u);if(f){for(const y of f.wa)y.Ca(l)&&(o=!0);f.ya=l}}o&&tF(i)}function f6e(n,e,i){const o=pr(n),l=o.queries.get(e);if(l)for(const u of l.wa)u.onError(i);o.queries.delete(e)}function tF(n){n.Da.forEach((e=>{e.next()}))}var E5,uQ;(uQ=E5||(E5={})).Fa="default",uQ.Cache="cache";class nF{constructor(e,i,o){this.query=e,this.Ma=i,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=o||{}}Ca(e){if(!this.options.includeMetadataChanges){const o=[];for(const l of e.docChanges)l.type!==3&&o.push(l);e=new zS(e.query,e.docs,e.oldDocs,o,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let i=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),i=!0):this.Ba(e,this.onlineState)&&(this.La(e),i=!0),this.Oa=e,i}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let i=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),i=!0),i}Ba(e,i){if(!e.fromCache||!this.ba())return!0;const o=i!=="Offline";return(!this.options.ka||!o)&&(!e.docs.isEmpty()||e.hasCachedResults||i==="Offline")}Na(e){if(e.docChanges.length>0)return!0;const i=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}La(e){e=zS.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==E5.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class soe{constructor(e){this.key=e}}class ooe{constructor(e){this.key=e}}class m6e{constructor(e,i){this.query=e,this.Ha=i,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=zr(),this.mutatedKeys=zr(),this.Xa=Cse(e),this.eu=new ES(this.Xa)}get tu(){return this.Ha}nu(e,i){const o=i?i.ru:new cQ,l=i?i.eu:this.eu;let u=i?i.mutatedKeys:this.mutatedKeys,f=l,y=!1;const v=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,b=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(e.inorderTraversal(((C,R)=>{const O=l.get(C),L=RN(this.query,R)?R:null,D=!!O&&this.mutatedKeys.has(O.key),U=!!L&&(L.hasLocalMutations||this.mutatedKeys.has(L.key)&&L.hasCommittedMutations);let B=!1;O&&L?O.data.isEqual(L.data)?D!==U&&(o.track({type:3,doc:L}),B=!0):this.iu(O,L)||(o.track({type:2,doc:L}),B=!0,(v&&this.Xa(L,v)>0||b&&this.Xa(L,b)<0)&&(y=!0)):!O&&L?(o.track({type:0,doc:L}),B=!0):O&&!L&&(o.track({type:1,doc:O}),B=!0,(v||b)&&(y=!0)),B&&(L?(f=f.add(L),u=U?u.add(C):u.delete(C)):(f=f.delete(C),u=u.delete(C)))})),this.query.limit!==null)for(;f.size>this.query.limit;){const C=this.query.limitType==="F"?f.last():f.first();f=f.delete(C.key),u=u.delete(C.key),o.track({type:1,doc:C})}return{eu:f,ru:o,Ds:y,mutatedKeys:u}}iu(e,i){return e.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(e,i,o,l){const u=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;const f=e.ru.pa();f.sort(((C,R)=>(function(L,D){const U=B=>{switch(B){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Zn(20277,{At:B})}};return U(L)-U(D)})(C.type,R.type)||this.Xa(C.doc,R.doc))),this.su(o),l=l!=null&&l;const y=i&&!l?this.ou():[],v=this.Za.size===0&&this.current&&!l?1:0,b=v!==this.Ya;return this.Ya=v,f.length!==0||b?{snapshot:new zS(this.query,e.eu,u,f,e.mutatedKeys,v===0,b,!1,!!o&&o.resumeToken.approximateByteSize()>0),_u:y}:{_u:y}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new cQ,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach((i=>this.Ha=this.Ha.add(i))),e.modifiedDocuments.forEach((i=>{})),e.removedDocuments.forEach((i=>this.Ha=this.Ha.delete(i))),this.current=e.current)}ou(){if(!this.current)return[];const e=this.Za;this.Za=zr(),this.eu.forEach((o=>{this.au(o.key)&&(this.Za=this.Za.add(o.key))}));const i=[];return e.forEach((o=>{this.Za.has(o)||i.push(new ooe(o))})),this.Za.forEach((o=>{e.has(o)||i.push(new soe(o))})),i}uu(e){this.Ha=e.qs,this.Za=zr();const i=this.nu(e.documents);return this.applyChanges(i,!0)}cu(){return zS.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}}const rF="SyncEngine";class g6e{constructor(e,i,o){this.query=e,this.targetId=i,this.view=o}}class _6e{constructor(e){this.key=e,this.lu=!1}}class y6e{constructor(e,i,o,l,u,f){this.localStore=e,this.remoteStore=i,this.eventManager=o,this.sharedClientState=l,this.currentUser=u,this.maxConcurrentLimboResolutions=f,this.hu={},this.Pu=new hE((y=>Tse(y)),CN),this.Tu=new Map,this.Iu=new Set,this.du=new ks(xn.comparator),this.Eu=new Map,this.Au=new Wj,this.Ru={},this.Vu=new Map,this.mu=BS.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}}async function E6e(n,e,i=!0){const o=hoe(n);let l;const u=o.Pu.get(e);return u?(o.sharedClientState.addLocalQueryTarget(u.targetId),l=u.view.cu()):l=await aoe(o,e,i,!0),l}async function v6e(n,e){const i=hoe(n);await aoe(i,e,!0,!1)}async function aoe(n,e,i,o){const l=await F4e(n.localStore,Lp(e)),u=l.targetId,f=n.sharedClientState.addLocalQueryTarget(u,i);let y;return o&&(y=await S6e(n,e,u,f==="current",l.resumeToken)),n.isPrimaryClient&&i&&Zse(n.remoteStore,l),y}async function S6e(n,e,i,o,l){n.gu=(R,O,L)=>(async function(U,B,Y,W){let ne=B.view.nu(Y);ne.Ds&&(ne=await nQ(U.localStore,B.query,!1).then((({documents:q})=>B.view.nu(q,ne))));const le=W&&W.targetChanges.get(B.targetId),re=W&&W.targetMismatches.get(B.targetId)!=null,me=B.view.applyChanges(ne,U.isPrimaryClient,le,re);return hQ(U,B.targetId,me._u),me.snapshot})(n,R,O,L);const u=await nQ(n.localStore,e,!0),f=new m6e(e,u.qs),y=f.nu(u.documents),v=XR.createSynthesizedTargetChangeForCurrentChange(i,o&&n.onlineState!=="Offline",l),b=f.applyChanges(y,n.isPrimaryClient,v);hQ(n,i,b._u);const C=new g6e(e,i,f);return n.Pu.set(e,C),n.Tu.has(i)?n.Tu.get(i).push(e):n.Tu.set(i,[e]),b.snapshot}async function b6e(n,e,i){const o=pr(n),l=o.Pu.get(e),u=o.Tu.get(l.targetId);if(u.length>1)return o.Tu.set(l.targetId,u.filter((f=>!CN(f,e)))),void o.Pu.delete(e);o.isPrimaryClient?(o.sharedClientState.removeLocalQueryTarget(l.targetId),o.sharedClientState.isActiveQueryTarget(l.targetId)||await _5(o.localStore,l.targetId,!1).then((()=>{o.sharedClientState.clearQueryState(l.targetId),i&&Kj(o.remoteStore,l.targetId),v5(o,l.targetId)})).catch(nb)):(v5(o,l.targetId),await _5(o.localStore,l.targetId,!0))}async function w6e(n,e){const i=pr(n),o=i.Pu.get(e),l=i.Tu.get(o.targetId);i.isPrimaryClient&&l.length===1&&(i.sharedClientState.removeLocalQueryTarget(o.targetId),Kj(i.remoteStore,o.targetId))}async function T6e(n,e,i){const o=k6e(n);try{const l=await(function(f,y){const v=pr(f),b=as.now(),C=y.reduce(((L,D)=>L.add(D.key)),zr());let R,O;return v.persistence.runTransaction("Locally write mutations","readwrite",(L=>{let D=Qf(),U=zr();return v.Os.getEntries(L,C).next((B=>{D=B,D.forEach(((Y,W)=>{W.isValidDocument()||(U=U.add(Y))}))})).next((()=>v.localDocuments.getOverlayedDocuments(L,D))).next((B=>{R=B;const Y=[];for(const W of y){const ne=FFe(W,R.get(W.key).overlayedDocument);ne!=null&&Y.push(new Xg(W.key,ne,gse(ne.value.mapValue),dd.exists(!0)))}return v.mutationQueue.addMutationBatch(L,b,Y,y)})).next((B=>{O=B;const Y=B.applyToLocalDocumentSet(R,U);return v.documentOverlayCache.saveOverlays(L,B.batchId,Y)}))})).then((()=>({batchId:O.batchId,changes:Ise(R)})))})(o.localStore,e);o.sharedClientState.addPendingMutation(l.batchId),(function(f,y,v){let b=f.Ru[f.currentUser.toKey()];b||(b=new ks(Or)),b=b.insert(y,v),f.Ru[f.currentUser.toKey()]=b})(o,l.batchId,i),await QR(o,l.changes),await NN(o.remoteStore)}catch(l){const u=Qj(l,"Failed to persist write");i.reject(u)}}async function coe(n,e){const i=pr(n);try{const o=await U4e(i.localStore,e);e.targetChanges.forEach(((l,u)=>{const f=i.Eu.get(u);f&&(bi(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1,22616),l.addedDocuments.size>0?f.lu=!0:l.modifiedDocuments.size>0?bi(f.lu,14607):l.removedDocuments.size>0&&(bi(f.lu,42227),f.lu=!1))})),await QR(i,o,e)}catch(o){await nb(o)}}function dQ(n,e,i){const o=pr(n);if(o.isPrimaryClient&&i===0||!o.isPrimaryClient&&i===1){const l=[];o.Pu.forEach(((u,f)=>{const y=f.view.va(e);y.snapshot&&l.push(y.snapshot)})),(function(f,y){const v=pr(f);v.onlineState=y;let b=!1;v.queries.forEach(((C,R)=>{for(const O of R.wa)O.va(y)&&(b=!0)})),b&&tF(v)})(o.eventManager,e),l.length&&o.hu.J_(l),o.onlineState=e,o.isPrimaryClient&&o.sharedClientState.setOnlineState(e)}}async function C6e(n,e,i){const o=pr(n);o.sharedClientState.updateQueryState(e,"rejected",i);const l=o.Eu.get(e),u=l&&l.key;if(u){let f=new ks(xn.comparator);f=f.insert(u,hc.newNoDocument(u,lr.min()));const y=zr().add(u),v=new PN(lr.min(),new Map,new ks(Or),f,y);await coe(o,v),o.du=o.du.remove(u),o.Eu.delete(e),iF(o)}else await _5(o.localStore,e,!1).then((()=>v5(o,e,i))).catch(nb)}async function R6e(n,e){const i=pr(n),o=e.batch.batchId;try{const l=await M4e(i.localStore,e);uoe(i,o,null),loe(i,o),i.sharedClientState.updateMutationState(o,"acknowledged"),await QR(i,l)}catch(l){await nb(l)}}async function I6e(n,e,i){const o=pr(n);try{const l=await(function(f,y){const v=pr(f);return v.persistence.runTransaction("Reject batch","readwrite-primary",(b=>{let C;return v.mutationQueue.lookupMutationBatch(b,y).next((R=>(bi(R!==null,37113),C=R.keys(),v.mutationQueue.removeMutationBatch(b,R)))).next((()=>v.mutationQueue.performConsistencyCheck(b))).next((()=>v.documentOverlayCache.removeOverlaysForBatchId(b,C,y))).next((()=>v.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,C))).next((()=>v.localDocuments.getDocuments(b,C)))}))})(o.localStore,e);uoe(o,e,i),loe(o,e),o.sharedClientState.updateMutationState(e,"rejected",i),await QR(o,l)}catch(l){await nb(l)}}function loe(n,e){(n.Vu.get(e)||[]).forEach((i=>{i.resolve()})),n.Vu.delete(e)}function uoe(n,e,i){const o=pr(n);let l=o.Ru[o.currentUser.toKey()];if(l){const u=l.get(e);u&&(i?u.reject(i):u.resolve(),l=l.remove(e)),o.Ru[o.currentUser.toKey()]=l}}function v5(n,e,i=null){n.sharedClientState.removeLocalQueryTarget(e);for(const o of n.Tu.get(e))n.Pu.delete(o),i&&n.hu.pu(o,i);n.Tu.delete(e),n.isPrimaryClient&&n.Au.zr(e).forEach((o=>{n.Au.containsKey(o)||doe(n,o)}))}function doe(n,e){n.Iu.delete(e.path.canonicalString());const i=n.du.get(e);i!==null&&(Kj(n.remoteStore,i),n.du=n.du.remove(e),n.Eu.delete(i),iF(n))}function hQ(n,e,i){for(const o of i)o instanceof soe?(n.Au.addReference(o.key,e),A6e(n,o)):o instanceof ooe?(fn(rF,"Document no longer in limbo: "+o.key),n.Au.removeReference(o.key,e),n.Au.containsKey(o.key)||doe(n,o.key)):Zn(19791,{yu:o})}function A6e(n,e){const i=e.key,o=i.path.canonicalString();n.du.get(i)||n.Iu.has(o)||(fn(rF,"New document in limbo: "+i),n.Iu.add(o),iF(n))}function iF(n){for(;n.Iu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Iu.values().next().value;n.Iu.delete(e);const i=new xn(Ji.fromString(e)),o=n.mu.next();n.Eu.set(o,new _6e(i)),n.du=n.du.insert(i,o),Zse(n.remoteStore,new Ig(Lp(TN(i.path)),o,"TargetPurposeLimboResolution",SN.ue))}}async function QR(n,e,i){const o=pr(n),l=[],u=[],f=[];o.Pu.isEmpty()||(o.Pu.forEach(((y,v)=>{f.push(o.gu(v,e,i).then((b=>{var C;if((b||i)&&o.isPrimaryClient){const R=b?!b.fromCache:(C=i==null?void 0:i.targetChanges.get(v.targetId))===null||C===void 0?void 0:C.current;o.sharedClientState.updateQueryState(v.targetId,R?"current":"not-current")}if(b){l.push(b);const R=Hj.Es(v.targetId,b);u.push(R)}})))})),await Promise.all(f),o.hu.J_(l),await(async function(v,b){const C=pr(v);try{await C.persistence.runTransaction("notifyLocalViewChanges","readwrite",(R=>At.forEach(b,(O=>At.forEach(O.Is,(L=>C.persistence.referenceDelegate.addReference(R,O.targetId,L))).next((()=>At.forEach(O.ds,(L=>C.persistence.referenceDelegate.removeReference(R,O.targetId,L)))))))))}catch(R){if(!rb(R))throw R;fn($j,"Failed to update sequence numbers: "+R)}for(const R of b){const O=R.targetId;if(!R.fromCache){const L=C.Fs.get(O),D=L.snapshotVersion,U=L.withLastLimboFreeSnapshotVersion(D);C.Fs=C.Fs.insert(O,U)}}})(o.localStore,u))}async function P6e(n,e){const i=pr(n);if(!i.currentUser.isEqual(e)){fn(rF,"User change. New user:",e.toKey());const o=await Yse(i.localStore,e);i.currentUser=e,(function(u,f){u.Vu.forEach((y=>{y.forEach((v=>{v.reject(new sn(Tt.CANCELLED,f))}))})),u.Vu.clear()})(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(e,o.removedBatchIds,o.addedBatchIds),await QR(i,o.Bs)}}function O6e(n,e){const i=pr(n),o=i.Eu.get(e);if(o&&o.lu)return zr().add(o.key);{let l=zr();const u=i.Tu.get(e);if(!u)return l;for(const f of u){const y=i.Pu.get(f);l=l.unionWith(y.view.tu)}return l}}function hoe(n){const e=pr(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=coe.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=O6e.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=C6e.bind(null,e),e.hu.J_=p6e.bind(null,e.eventManager),e.hu.pu=f6e.bind(null,e.eventManager),e}function k6e(n){const e=pr(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=R6e.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=I6e.bind(null,e),e}class Pk{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ON(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,i){return null}Fu(e,i){return null}vu(e){return L4e(this.persistence,new N4e,e.initialUser,this.serializer)}Du(e){return new qse(Gj.Vi,this.serializer)}bu(e){return new z4e}async terminate(){var e,i;(e=this.gcScheduler)===null||e===void 0||e.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Pk.provider={build:()=>new Pk};class N6e extends Pk{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,i){bi(this.persistence.referenceDelegate instanceof Ik,46915);const o=this.persistence.referenceDelegate.garbageCollector;return new _4e(o,e.asyncQueue,i)}Du(e){const i=this.cacheSizeBytes!==void 0?yl.withCacheSize(this.cacheSizeBytes):yl.DEFAULT;return new qse((o=>Ik.Vi(o,i)),this.serializer)}}class S5{async initialize(e,i){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=o=>dQ(this.syncEngine,o,1),this.remoteStore.remoteSyncer.handleCredentialChange=P6e.bind(null,this.syncEngine),await u6e(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new h6e})()}createDatastore(e){const i=ON(e.databaseInfo.databaseId),o=(function(u){return new K4e(u)})(e.databaseInfo);return(function(u,f,y,v){return new J4e(u,f,y,v)})(e.authCredentials,e.appCheckCredentials,o,i)}createRemoteStore(e){return(function(o,l,u,f,y){return new Z4e(o,l,u,f,y)})(this.localStore,this.datastore,e.asyncQueue,(i=>dQ(this.syncEngine,i,0)),(function(){return sQ.C()?new sQ:new W4e})())}createSyncEngine(e,i){return(function(l,u,f,y,v,b,C){const R=new y6e(l,u,f,y,v,b);return C&&(R.fu=!0),R})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,i)}async terminate(){var e,i;await(async function(l){const u=pr(l);fn(oE,"RemoteStore shutting down."),u.Ia.add(5),await JR(u),u.Ea.shutdown(),u.Aa.set("Unknown")})(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}S5.provider={build:()=>new S5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sF{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):Jf("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,i){setTimeout((()=>{this.muted||e(i)}),0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wg="FirestoreClient";class x6e{constructor(e,i,o,l,u){this.authCredentials=e,this.appCheckCredentials=i,this.asyncQueue=o,this.databaseInfo=l,this.user=dc.UNAUTHENTICATED,this.clientId=Nj.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=u,this.authCredentials.start(o,(async f=>{fn(Wg,"Received user=",f.uid),await this.authCredentialListener(f),this.user=f})),this.appCheckCredentials.start(o,(f=>(fn(Wg,"Received new app check token=",f),this.appCheckCredentialListener(f,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new zf;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(i){const o=Qj(i,"Failed to shutdown persistence");e.reject(o)}})),e.promise}}async function YU(n,e){n.asyncQueue.verifyOperationInProgress(),fn(Wg,"Initializing OfflineComponentProvider");const i=n.configuration;await e.initialize(i);let o=i.initialUser;n.setCredentialChangeListener((async l=>{o.isEqual(l)||(await Yse(e.localStore,l),o=l)})),e.persistence.setDatabaseDeletedListener((()=>{Ug("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then((()=>{fn("Terminating Firestore due to IndexedDb database deletion completed successfully")})).catch((l=>{Ug("Terminating Firestore due to IndexedDb database deletion failed",l)}))})),n._offlineComponents=e}async function pQ(n,e){n.asyncQueue.verifyOperationInProgress();const i=await D6e(n);fn(Wg,"Initializing OnlineComponentProvider"),await e.initialize(i,n.configuration),n.setCredentialChangeListener((o=>aQ(e.remoteStore,o))),n.setAppCheckTokenChangeListener(((o,l)=>aQ(e.remoteStore,l))),n._onlineComponents=e}async function D6e(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){fn(Wg,"Using user provided OfflineComponentProvider");try{await YU(n,n._uninitializedComponentsProvider._offline)}catch(e){const i=e;if(!(function(l){return l.name==="FirebaseError"?l.code===Tt.FAILED_PRECONDITION||l.code===Tt.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11})(i))throw i;Ug("Error using user provided cache. Falling back to memory cache: "+i),await YU(n,new Pk)}}else fn(Wg,"Using default OfflineComponentProvider"),await YU(n,new N6e(void 0));return n._offlineComponents}async function poe(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(fn(Wg,"Using user provided OnlineComponentProvider"),await pQ(n,n._uninitializedComponentsProvider._online)):(fn(Wg,"Using default OnlineComponentProvider"),await pQ(n,new S5))),n._onlineComponents}function L6e(n){return poe(n).then((e=>e.syncEngine))}async function Ok(n){const e=await poe(n),i=e.eventManager;return i.onListen=E6e.bind(null,e.syncEngine),i.onUnlisten=b6e.bind(null,e.syncEngine),i.onFirstRemoteStoreListen=v6e.bind(null,e.syncEngine),i.onLastRemoteStoreUnlisten=w6e.bind(null,e.syncEngine),i}function M6e(n,e,i={}){const o=new zf;return n.asyncQueue.enqueueAndForget((async()=>(function(u,f,y,v,b){const C=new sF({next:O=>{C.Ou(),f.enqueueAndForget((()=>eF(u,R)));const L=O.docs.has(y);!L&&O.fromCache?b.reject(new sn(Tt.UNAVAILABLE,"Failed to get document because the client is offline.")):L&&O.fromCache&&v&&v.source==="server"?b.reject(new sn(Tt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(O)},error:O=>b.reject(O)}),R=new nF(TN(y.path),C,{includeMetadataChanges:!0,ka:!0});return Zj(u,R)})(await Ok(n),n.asyncQueue,e,i,o))),o.promise}function U6e(n,e,i={}){const o=new zf;return n.asyncQueue.enqueueAndForget((async()=>(function(u,f,y,v,b){const C=new sF({next:O=>{C.Ou(),f.enqueueAndForget((()=>eF(u,R))),O.fromCache&&v.source==="server"?b.reject(new sn(Tt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(O)},error:O=>b.reject(O)}),R=new nF(y,C,{includeMetadataChanges:!0,ka:!0});return Zj(u,R)})(await Ok(n),n.asyncQueue,e,i,o))),o.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function foe(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fQ=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const moe="firestore.googleapis.com",mQ=!0;class gQ{constructor(e){var i,o;if(e.host===void 0){if(e.ssl!==void 0)throw new sn(Tt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=moe,this.ssl=mQ}else this.host=e.host,this.ssl=(i=e.ssl)!==null&&i!==void 0?i:mQ;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Kse;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<m4e)throw new sn(Tt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Zje("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=foe((o=e.experimentalLongPollingOptions)!==null&&o!==void 0?o:{}),(function(u){if(u.timeoutSeconds!==void 0){if(isNaN(u.timeoutSeconds))throw new sn(Tt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (must not be NaN)`);if(u.timeoutSeconds<5)throw new sn(Tt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (minimum allowed value is 5)`);if(u.timeoutSeconds>30)throw new sn(Tt.INVALID_ARGUMENT,`invalid long polling timeout: ${u.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(o,l){return o.timeoutSeconds===l.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class xN{constructor(e,i,o,l){this._authCredentials=e,this._appCheckCredentials=i,this._databaseId=o,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gQ({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new sn(Tt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new sn(Tt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gQ(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(o){if(!o)return new Gje;switch(o.type){case"firstParty":return new qje(o.sessionIndex||"0",o.iamToken||null,o.authTokenFactory||null);case"provider":return o.client;default:throw new sn(Tt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(i){const o=fQ.get(i);o&&(fn("ComponentProvider","Removing Datastore"),fQ.delete(i),o.terminate())})(this),Promise.resolve()}}function V6e(n,e,i,o={}){var l;n=Rl(n,xN);const u=tm(e),f=n._getSettings(),y=Object.assign(Object.assign({},f),{emulatorOptions:n._getEmulatorOptions()}),v=`${e}:${i}`;u&&(fN(`https://${v}`),mN("Firestore",!0)),f.host!==moe&&f.host!==v&&Ug("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const b=Object.assign(Object.assign({},f),{host:v,ssl:u,emulatorOptions:o});if(!Kf(b,y)&&(n._setSettings(b),o.mockUserToken)){let C,R;if(typeof o.mockUserToken=="string")C=o.mockUserToken,R=dc.MOCK_USER;else{C=cie(o.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const O=o.mockUserToken.sub||o.mockUserToken.user_id;if(!O)throw new sn(Tt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");R=new dc(O)}n._authCredentials=new Hje(new rse(C,R))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class im{constructor(e,i,o){this.converter=i,this._query=o,this.type="query",this.firestore=e}withConverter(e){return new im(this.firestore,e,this._query)}}class Hs{constructor(e,i,o){this.converter=i,this._key=o,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ng(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Hs(this.firestore,e,this._key)}toJSON(){return{type:Hs._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,i,o){if(qR(i,Hs._jsonSchema))return new Hs(e,o||null,new xn(Ji.fromString(i.referencePath)))}}Hs._jsonSchemaVersion="firestore/documentReference/1.0",Hs._jsonSchema={type:Oo("string",Hs._jsonSchemaVersion),referencePath:Oo("string")};class Ng extends im{constructor(e,i,o){super(e,i,TN(o)),this._path=o,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Hs(this.firestore,null,new xn(e))}withConverter(e){return new Ng(this.firestore,e,this._path)}}function Uc(n,e,...i){if(n=Ui(n),sse("collection","path",e),n instanceof xN){const o=Ji.fromString(e,...i);return PJ(o),new Ng(n,null,o)}{if(!(n instanceof Hs||n instanceof Ng))throw new sn(Tt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=n._path.child(Ji.fromString(e,...i));return PJ(o),new Ng(n.firestore,null,o)}}function _r(n,e,...i){if(n=Ui(n),arguments.length===1&&(e=Nj.newId()),sse("doc","path",e),n instanceof xN){const o=Ji.fromString(e,...i);return AJ(o),new Hs(n,null,new xn(o))}{if(!(n instanceof Hs||n instanceof Ng))throw new sn(Tt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const o=n._path.child(Ji.fromString(e,...i));return AJ(o),new Hs(n.firestore,n instanceof Ng?n.converter:null,new xn(o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _Q="AsyncQueue";class yQ{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Jse(this,"async_queue_retry"),this.oc=()=>{const o=qU();o&&fn(_Q,"Visibility state changed to "+o.visibilityState),this.F_.y_()},this._c=e;const i=qU();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;const i=qU();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise((()=>{}));const i=new zf;return this.uc((()=>this.Xu&&this.rc?Promise.resolve():(e().then(i.resolve,i.reject),i.promise))).then((()=>i.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Zu.push(e),this.cc())))}async cc(){if(this.Zu.length!==0){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!rb(e))throw e;fn(_Q,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_((()=>this.cc()))}}uc(e){const i=this._c.then((()=>(this.nc=!0,e().catch((o=>{throw this.tc=o,this.nc=!1,Jf("INTERNAL UNHANDLED ERROR: ",EQ(o)),o})).then((o=>(this.nc=!1,o))))));return this._c=i,i}enqueueAfterDelay(e,i,o){this.ac(),this.sc.indexOf(e)>-1&&(i=0);const l=Jj.createAndSchedule(this,e,i,o,(u=>this.lc(u)));return this.ec.push(l),l}ac(){this.tc&&Zn(47125,{hc:EQ(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do e=this._c,await e;while(e!==this._c)}Tc(e){for(const i of this.ec)if(i.timerId===e)return!0;return!1}Ic(e){return this.Pc().then((()=>{this.ec.sort(((i,o)=>i.targetTimeMs-o.targetTimeMs));for(const i of this.ec)if(i.skipDelay(),e!=="all"&&i.timerId===e)break;return this.Pc()}))}dc(e){this.sc.push(e)}lc(e){const i=this.ec.indexOf(e);this.ec.splice(i,1)}}function EQ(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vQ(n){return(function(i,o){if(typeof i!="object"||i===null)return!1;const l=i;for(const u of o)if(u in l&&typeof l[u]=="function")return!0;return!1})(n,["next","error","complete"])}class Zf extends xN{constructor(e,i,o,l){super(e,i,o,l),this.type="firestore",this._queue=new yQ,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new yQ(e),this._firestoreClient=void 0,await e}}}function M0(n,e){const i=typeof n=="object"?n:gN(),o=typeof n=="string"?n:vk,l=WR(i,"firestore").getImmediate({identifier:o});if(!l._initialized){const u=vj("firestore");u&&V6e(l,...u)}return l}function DN(n){if(n._terminated)throw new sn(Tt.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||j6e(n),n._firestoreClient}function j6e(n){var e,i,o;const l=n._freezeSettings(),u=(function(y,v,b,C){return new dFe(y,v,b,C.host,C.ssl,C.experimentalForceLongPolling,C.experimentalAutoDetectLongPolling,foe(C.experimentalLongPollingOptions),C.useFetchStreams,C.isUsingEmulator)})(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((i=l.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((o=l.localCache)===null||o===void 0)&&o._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new x6e(n._authCredentials,n._appCheckCredentials,n._queue,u,n._componentsProvider&&(function(y){const v=y==null?void 0:y._online.build();return{_offline:y==null?void 0:y._offline.build(v),_online:v}})(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class od{constructor(e){this._byteString=e}static fromBase64String(e){try{return new od(Fa.fromBase64String(e))}catch(i){throw new sn(Tt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(e){return new od(Fa.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:od._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(qR(e,od._jsonSchema))return od.fromBase64String(e.bytes)}}od._jsonSchemaVersion="firestore/bytes/1.0",od._jsonSchema={type:Oo("string",od._jsonSchemaVersion),bytes:Oo("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LN{constructor(...e){for(let i=0;i<e.length;++i)if(e[i].length===0)throw new sn(Tt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ja(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZR{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Up{constructor(e,i){if(!isFinite(e)||e<-90||e>90)throw new sn(Tt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(i)||i<-180||i>180)throw new sn(Tt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=e,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Or(this._lat,e._lat)||Or(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Up._jsonSchemaVersion}}static fromJSON(e){if(qR(e,Up._jsonSchema))return new Up(e.latitude,e.longitude)}}Up._jsonSchemaVersion="firestore/geoPoint/1.0",Up._jsonSchema={type:Oo("string",Up._jsonSchemaVersion),latitude:Oo("number"),longitude:Oo("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vp{constructor(e){this._values=(e||[]).map((i=>i))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(o,l){if(o.length!==l.length)return!1;for(let u=0;u<o.length;++u)if(o[u]!==l[u])return!1;return!0})(this._values,e._values)}toJSON(){return{type:Vp._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(qR(e,Vp._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((i=>typeof i=="number")))return new Vp(e.vectorValues);throw new sn(Tt.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Vp._jsonSchemaVersion="firestore/vectorValue/1.0",Vp._jsonSchema={type:Oo("string",Vp._jsonSchemaVersion),vectorValues:Oo("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F6e=/^__.*__$/;class B6e{constructor(e,i,o){this.data=e,this.fieldMask=i,this.fieldTransforms=o}toMutation(e,i){return this.fieldMask!==null?new Xg(e,this.data,this.fieldMask,i,this.fieldTransforms):new YR(e,this.data,i,this.fieldTransforms)}}class goe{constructor(e,i,o){this.data=e,this.fieldMask=i,this.fieldTransforms=o}toMutation(e,i){return new Xg(e,this.data,this.fieldMask,i,this.fieldTransforms)}}function _oe(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Zn(40011,{Ec:n})}}class MN{constructor(e,i,o,l,u,f){this.settings=e,this.databaseId=i,this.serializer=o,this.ignoreUndefinedProperties=l,u===void 0&&this.Ac(),this.fieldTransforms=u||[],this.fieldMask=f||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new MN(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var i;const o=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.Rc({path:o,mc:!1});return l.fc(e),l}gc(e){var i;const o=(i=this.path)===null||i===void 0?void 0:i.child(e),l=this.Rc({path:o,mc:!1});return l.Ac(),l}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return kk(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find((i=>e.isPrefixOf(i)))!==void 0||this.fieldTransforms.find((i=>e.isPrefixOf(i.field)))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if(_oe(this.Ec)&&F6e.test(e))throw this.wc('Document fields cannot begin and end with "__"')}}class z6e{constructor(e,i,o){this.databaseId=e,this.ignoreUndefinedProperties=i,this.serializer=o||ON(e)}Dc(e,i,o,l=!1){return new MN({Ec:e,methodName:i,bc:o,path:ja.emptyPath(),mc:!1,Sc:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function UN(n){const e=n._freezeSettings(),i=ON(n._databaseId);return new z6e(n._databaseId,!!e.ignoreUndefinedProperties,i)}function yoe(n,e,i,o,l,u={}){const f=n.Dc(u.merge||u.mergeFields?2:0,e,i,l);cF("Data must be an object, but it was:",f,o);const y=voe(o,f);let v,b;if(u.merge)v=new du(f.fieldMask),b=f.fieldTransforms;else if(u.mergeFields){const C=[];for(const R of u.mergeFields){const O=b5(e,R,i);if(!f.contains(O))throw new sn(Tt.INVALID_ARGUMENT,`Field '${O}' is specified in your field mask but missing from your input data.`);boe(C,O)||C.push(O)}v=new du(C),b=f.fieldTransforms.filter((R=>v.covers(R.field)))}else v=null,b=f.fieldTransforms;return new B6e(new Sl(y),v,b)}class VN extends ZR{_toFieldTransform(e){if(e.Ec!==2)throw e.Ec===1?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof VN}}function Eoe(n,e,i){return new MN({Ec:3,bc:e.settings.bc,methodName:n._methodName,mc:i},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class oF extends ZR{constructor(e,i){super(e),this.vc=i}_toFieldTransform(e){const i=Eoe(this,e,!0),o=this.vc.map((u=>fE(u,i))),l=new jS(o);return new Dse(e.path,l)}isEqual(e){return e instanceof oF&&Kf(this.vc,e.vc)}}class aF extends ZR{constructor(e,i){super(e),this.vc=i}_toFieldTransform(e){const i=Eoe(this,e,!0),o=this.vc.map((u=>fE(u,i))),l=new FS(o);return new Dse(e.path,l)}isEqual(e){return e instanceof aF&&Kf(this.vc,e.vc)}}function W6e(n,e,i,o){const l=n.Dc(1,e,i);cF("Data must be an object, but it was:",l,o);const u=[],f=Sl.empty();Yg(o,((v,b)=>{const C=lF(e,v,i);b=Ui(b);const R=l.gc(C);if(b instanceof VN)u.push(C);else{const O=fE(b,R);O!=null&&(u.push(C),f.set(C,O))}}));const y=new du(u);return new goe(f,y,l.fieldTransforms)}function G6e(n,e,i,o,l,u){const f=n.Dc(1,e,i),y=[b5(e,o,i)],v=[l];if(u.length%2!=0)throw new sn(Tt.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let O=0;O<u.length;O+=2)y.push(b5(e,u[O])),v.push(u[O+1]);const b=[],C=Sl.empty();for(let O=y.length-1;O>=0;--O)if(!boe(b,y[O])){const L=y[O];let D=v[O];D=Ui(D);const U=f.gc(L);if(D instanceof VN)b.push(L);else{const B=fE(D,U);B!=null&&(b.push(L),C.set(L,B))}}const R=new du(b);return new goe(C,R,f.fieldTransforms)}function H6e(n,e,i,o=!1){return fE(i,n.Dc(o?4:3,e))}function fE(n,e){if(Soe(n=Ui(n)))return cF("Unsupported field value:",e,n),voe(n,e);if(n instanceof ZR)return(function(o,l){if(!_oe(l.Ec))throw l.wc(`${o._methodName}() can only be used with update() and set()`);if(!l.path)throw l.wc(`${o._methodName}() is not currently supported inside arrays`);const u=o._toFieldTransform(l);u&&l.fieldTransforms.push(u)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return(function(o,l){const u=[];let f=0;for(const y of o){let v=fE(y,l.yc(f));v==null&&(v={nullValue:"NULL_VALUE"}),u.push(v),f++}return{arrayValue:{values:u}}})(n,e)}return(function(o,l){if((o=Ui(o))===null)return{nullValue:"NULL_VALUE"};if(typeof o=="number")return DFe(l.serializer,o);if(typeof o=="boolean")return{booleanValue:o};if(typeof o=="string")return{stringValue:o};if(o instanceof Date){const u=as.fromDate(o);return{timestampValue:Rk(l.serializer,u)}}if(o instanceof as){const u=new as(o.seconds,1e3*Math.floor(o.nanoseconds/1e3));return{timestampValue:Rk(l.serializer,u)}}if(o instanceof Up)return{geoPointValue:{latitude:o.latitude,longitude:o.longitude}};if(o instanceof od)return{bytesValue:Fse(l.serializer,o._byteString)};if(o instanceof Hs){const u=l.databaseId,f=o.firestore._databaseId;if(!f.isEqual(u))throw l.wc(`Document reference is for database ${f.projectId}/${f.database} but should be for database ${u.projectId}/${u.database}`);return{referenceValue:zj(o.firestore._databaseId||l.databaseId,o._key.path)}}if(o instanceof Vp)return(function(f,y){return{mapValue:{fields:{[fse]:{stringValue:mse},[Sk]:{arrayValue:{values:f.toArray().map((b=>{if(typeof b!="number")throw y.wc("VectorValues must only contain numeric values.");return Vj(y.serializer,b)}))}}}}}})(o,l);throw l.wc(`Unsupported field value: ${vN(o)}`)})(n,e)}function voe(n,e){const i={};return cse(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Yg(n,((o,l)=>{const u=fE(l,e.Vc(o));u!=null&&(i[o]=u)})),{mapValue:{fields:i}}}function Soe(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof as||n instanceof Up||n instanceof od||n instanceof Hs||n instanceof ZR||n instanceof Vp)}function cF(n,e,i){if(!Soe(i)||!ose(i)){const o=vN(i);throw o==="an object"?e.wc(n+" a custom object"):e.wc(n+" "+o)}}function b5(n,e,i){if((e=Ui(e))instanceof LN)return e._internalPath;if(typeof e=="string")return lF(n,e);throw kk("Field path arguments must be of type string or ",n,!1,void 0,i)}const $6e=new RegExp("[~\\*/\\[\\]]");function lF(n,e,i){if(e.search($6e)>=0)throw kk(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,i);try{return new LN(...e.split("."))._internalPath}catch{throw kk(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,i)}}function kk(n,e,i,o,l){const u=o&&!o.isEmpty(),f=l!==void 0;let y=`Function ${e}() called with invalid data`;i&&(y+=" (via `toFirestore()`)"),y+=". ";let v="";return(u||f)&&(v+=" (found",u&&(v+=` in field ${o}`),f&&(v+=` in document ${l}`),v+=")"),new sn(Tt.INVALID_ARGUMENT,y+n+v)}function boe(n,e){return n.some((i=>i.isEqual(e)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class woe{constructor(e,i,o,l,u){this._firestore=e,this._userDataWriter=i,this._key=o,this._document=l,this._converter=u}get id(){return this._key.path.lastSegment()}get ref(){return new Hs(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new K6e(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const i=this._document.data.field(jN("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i)}}}class K6e extends woe{data(){return super.data()}}function jN(n,e){return typeof e=="string"?lF(n,e):e instanceof LN?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Toe(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new sn(Tt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class uF{}class dF extends uF{}function Nk(n,e,...i){let o=[];e instanceof uF&&o.push(e),o=o.concat(i),(function(u){const f=u.filter((v=>v instanceof hF)).length,y=u.filter((v=>v instanceof FN)).length;if(f>1||f>0&&y>0)throw new sn(Tt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(o);for(const l of o)n=l._apply(n);return n}class FN extends dF{constructor(e,i,o){super(),this._field=e,this._op=i,this._value=o,this.type="where"}static _create(e,i,o){return new FN(e,i,o)}_apply(e){const i=this._parse(e);return Roe(e._query,i),new im(e.firestore,e.converter,h5(e._query,i))}_parse(e){const i=UN(e.firestore);return(function(u,f,y,v,b,C,R){let O;if(b.isKeyField()){if(C==="array-contains"||C==="array-contains-any")throw new sn(Tt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${C}' queries on documentId().`);if(C==="in"||C==="not-in"){wQ(R,C);const D=[];for(const U of R)D.push(bQ(v,u,U));O={arrayValue:{values:D}}}else O=bQ(v,u,R)}else C!=="in"&&C!=="not-in"&&C!=="array-contains-any"||wQ(R,C),O=H6e(y,f,R,C==="in"||C==="not-in");return Po.create(b,C,O)})(e._query,"where",i,e.firestore._databaseId,this._field,this._op,this._value)}}function SQ(n,e,i){const o=e,l=jN("where",n);return FN._create(l,o,i)}class hF extends uF{constructor(e,i){super(),this.type=e,this._queryConstraints=i}static _create(e,i){return new hF(e,i)}_parse(e){const i=this._queryConstraints.map((o=>o._parse(e))).filter((o=>o.getFilters().length>0));return i.length===1?i[0]:yh.create(i,this._getOperator())}_apply(e){const i=this._parse(e);return i.getFilters().length===0?e:((function(l,u){let f=l;const y=u.getFlattenedFilters();for(const v of y)Roe(f,v),f=h5(f,v)})(e._query,i),new im(e.firestore,e.converter,h5(e._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class pF extends dF{constructor(e,i){super(),this._field=e,this._direction=i,this.type="orderBy"}static _create(e,i){return new pF(e,i)}_apply(e){const i=(function(l,u,f){if(l.startAt!==null)throw new sn(Tt.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(l.endAt!==null)throw new sn(Tt.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new bR(u,f)})(e._query,this._field,this._direction);return new im(e.firestore,e.converter,(function(l,u){const f=l.explicitOrderBy.concat([u]);return new ib(l.path,l.collectionGroup,f,l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)})(e._query,i))}}function q6e(n,e="asc"){const i=e,o=jN("orderBy",n);return pF._create(o,i)}class fF extends dF{constructor(e,i,o){super(),this.type=e,this._limit=i,this._limitType=o}static _create(e,i,o){return new fF(e,i,o)}_apply(e){return new im(e.firestore,e.converter,wk(e._query,this._limit,this._limitType))}}function Coe(n){return eFe("limit",n),fF._create("limit",n,"F")}function bQ(n,e,i){if(typeof(i=Ui(i))=="string"){if(i==="")throw new sn(Tt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!wse(e)&&i.indexOf("/")!==-1)throw new sn(Tt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const o=e.path.child(Ji.fromString(i));if(!xn.isDocumentKey(o))throw new sn(Tt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${o}' is not because it has an odd number of segments (${o.length}).`);return UJ(n,new xn(o))}if(i instanceof Hs)return UJ(n,i._key);throw new sn(Tt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${vN(i)}.`)}function wQ(n,e){if(!Array.isArray(n)||n.length===0)throw new sn(Tt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Roe(n,e){const i=(function(l,u){for(const f of l)for(const y of f.getFlattenedFilters())if(u.indexOf(y.op)>=0)return y.op;return null})(n.filters,(function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(i!==null)throw i===e.op?new sn(Tt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new sn(Tt.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${i.toString()}' filters.`)}class Y6e{convertValue(e,i="none"){switch(Bg(e)){case 0:return null;case 1:return e.booleanValue;case 2:return uo(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,i);case 5:return e.stringValue;case 6:return this.convertBytes(Fg(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,i);case 11:return this.convertObject(e.mapValue,i);case 10:return this.convertVectorValue(e.mapValue);default:throw Zn(62114,{value:e})}}convertObject(e,i){return this.convertObjectMap(e.fields,i)}convertObjectMap(e,i="none"){const o={};return Yg(e,((l,u)=>{o[l]=this.convertValue(u,i)})),o}convertVectorValue(e){var i,o,l;const u=(l=(o=(i=e.fields)===null||i===void 0?void 0:i[Sk].arrayValue)===null||o===void 0?void 0:o.values)===null||l===void 0?void 0:l.map((f=>uo(f.doubleValue)));return new Vp(u)}convertGeoPoint(e){return new Up(uo(e.latitude),uo(e.longitude))}convertArray(e,i){return(e.values||[]).map((o=>this.convertValue(o,i)))}convertServerTimestamp(e,i){switch(i){case"previous":const o=wN(e);return o==null?null:this.convertValue(o,i);case"estimate":return this.convertTimestamp(ER(e));default:return null}}convertTimestamp(e){const i=jg(e);return new as(i.seconds,i.nanos)}convertDocumentKey(e,i){const o=Ji.fromString(e);bi($se(o),9688,{name:e});const l=new vR(o.get(1),o.get(3)),u=new xn(o.popFirst(5));return l.isEqual(i)||Jf(`Document ${u} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ioe(n,e,i){let o;return o=n?i&&(i.merge||i.mergeFields)?n.toFirestore(e,i):n.toFirestore(e):e,o}class vC{constructor(e,i){this.hasPendingWrites=e,this.fromCache=i}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class $y extends woe{constructor(e,i,o,l,u,f){super(e,i,o,l,f),this._firestore=e,this._firestoreImpl=e,this.metadata=u}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const i=new zO(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,i={}){if(this._document){const o=this._document.data.field(jN("DocumentSnapshot.get",e));if(o!==null)return this._userDataWriter.convertValue(o,i.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new sn(Tt.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,i={};return i.type=$y._jsonSchemaVersion,i.bundle="",i.bundleSource="DocumentSnapshot",i.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?i:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),i.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),i)}}$y._jsonSchemaVersion="firestore/documentSnapshot/1.0",$y._jsonSchema={type:Oo("string",$y._jsonSchemaVersion),bundleSource:Oo("string","DocumentSnapshot"),bundleName:Oo("string"),bundle:Oo("string")};class zO extends $y{data(e={}){return super.data(e)}}class Ky{constructor(e,i,o,l){this._firestore=e,this._userDataWriter=i,this._snapshot=l,this.metadata=new vC(l.hasPendingWrites,l.fromCache),this.query=o}get docs(){const e=[];return this.forEach((i=>e.push(i))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,i){this._snapshot.docs.forEach((o=>{e.call(i,new zO(this._firestore,this._userDataWriter,o.key,o,new vC(this._snapshot.mutatedKeys.has(o.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const i=!!e.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new sn(Tt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=(function(l,u){if(l._snapshot.oldDocs.isEmpty()){let f=0;return l._snapshot.docChanges.map((y=>{const v=new zO(l._firestore,l._userDataWriter,y.doc.key,y.doc,new vC(l._snapshot.mutatedKeys.has(y.doc.key),l._snapshot.fromCache),l.query.converter);return y.doc,{type:"added",doc:v,oldIndex:-1,newIndex:f++}}))}{let f=l._snapshot.oldDocs;return l._snapshot.docChanges.filter((y=>u||y.type!==3)).map((y=>{const v=new zO(l._firestore,l._userDataWriter,y.doc.key,y.doc,new vC(l._snapshot.mutatedKeys.has(y.doc.key),l._snapshot.fromCache),l.query.converter);let b=-1,C=-1;return y.type!==0&&(b=f.indexOf(y.doc.key),f=f.delete(y.doc.key)),y.type!==1&&(f=f.add(y.doc),C=f.indexOf(y.doc.key)),{type:X6e(y.type),doc:v,oldIndex:b,newIndex:C}}))}})(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new sn(Tt.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Ky._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Nj.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const i=[],o=[],l=[];return this.docs.forEach((u=>{u._document!==null&&(i.push(u._document),o.push(this._userDataWriter.convertObjectMap(u._document.data.value.mapValue.fields,"previous")),l.push(u.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function X6e(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Zn(61501,{type:n})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xo(n){n=Rl(n,Hs);const e=Rl(n.firestore,Zf);return M6e(DN(e),n._key).then((i=>Ooe(e,n,i)))}Ky._jsonSchemaVersion="firestore/querySnapshot/1.0",Ky._jsonSchema={type:Oo("string",Ky._jsonSchemaVersion),bundleSource:Oo("string","QuerySnapshot"),bundleName:Oo("string"),bundle:Oo("string")};class mF extends Y6e{constructor(e){super(),this.firestore=e}convertBytes(e){return new od(e)}convertReference(e){const i=this.convertDocumentKey(e,this.firestore._databaseId);return new Hs(this.firestore,null,i)}}function hd(n){n=Rl(n,im);const e=Rl(n.firestore,Zf),i=DN(e),o=new mF(e);return Toe(n._query),U6e(i,n._query).then((l=>new Ky(e,o,n,l)))}function Gg(n,e,i){n=Rl(n,Hs);const o=Rl(n.firestore,Zf),l=Ioe(n.converter,e,i);return zN(o,[yoe(UN(o),"setDoc",n._key,l,n.converter!==null,i).toMutation(n._key,dd.none())])}function ko(n,e,i,...o){n=Rl(n,Hs);const l=Rl(n.firestore,Zf),u=UN(l);let f;return f=typeof(e=Ui(e))=="string"||e instanceof LN?G6e(u,"updateDoc",n._key,e,i,o):W6e(u,"updateDoc",n._key,e),zN(l,[f.toMutation(n._key,dd.exists(!0))])}function BN(n){return zN(Rl(n.firestore,Zf),[new jj(n._key,dd.none())])}function Aoe(n,e){const i=Rl(n.firestore,Zf),o=_r(n),l=Ioe(n.converter,e);return zN(i,[yoe(UN(n.firestore),"addDoc",o._key,l,n.converter!==null,{}).toMutation(o._key,dd.exists(!1))]).then((()=>o))}function Poe(n,...e){var i,o,l;n=Ui(n);let u={includeMetadataChanges:!1,source:"default"},f=0;typeof e[f]!="object"||vQ(e[f])||(u=e[f++]);const y={includeMetadataChanges:u.includeMetadataChanges,source:u.source};if(vQ(e[f])){const R=e[f];e[f]=(i=R.next)===null||i===void 0?void 0:i.bind(R),e[f+1]=(o=R.error)===null||o===void 0?void 0:o.bind(R),e[f+2]=(l=R.complete)===null||l===void 0?void 0:l.bind(R)}let v,b,C;if(n instanceof Hs)b=Rl(n.firestore,Zf),C=TN(n._key.path),v={next:R=>{e[f]&&e[f](Ooe(b,n,R))},error:e[f+1],complete:e[f+2]};else{const R=Rl(n,im);b=Rl(R.firestore,Zf),C=R._query;const O=new mF(b);v={next:L=>{e[f]&&e[f](new Ky(b,O,R,L))},error:e[f+1],complete:e[f+2]},Toe(n._query)}return(function(O,L,D,U){const B=new sF(U),Y=new nF(L,B,D);return O.asyncQueue.enqueueAndForget((async()=>Zj(await Ok(O),Y))),()=>{B.Ou(),O.asyncQueue.enqueueAndForget((async()=>eF(await Ok(O),Y)))}})(DN(b),C,y,v)}function zN(n,e){return(function(o,l){const u=new zf;return o.asyncQueue.enqueueAndForget((async()=>T6e(await L6e(o),l,u))),u.promise})(DN(n),e)}function Ooe(n,e,i){const o=i.docs.get(e._key),l=new mF(n);return new $y(n,l,e._key,o,new vC(i.hasPendingWrites,i.fromCache),e.converter)}function J6e(...n){return new oF("arrayUnion",n)}function koe(...n){return new aF("arrayRemove",n)}(function(e,i=!0){(function(l){tb=l})(dE),Mg(new qf("firestore",((o,{instanceIdentifier:l,options:u})=>{const f=o.getProvider("app").getImmediate(),y=new Zf(new $je(o.getProvider("auth-internal")),new Yje(f,o.getProvider("app-check-internal")),(function(b,C){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new sn(Tt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new vR(b.options.projectId,C)})(f,l),f);return u=Object.assign({useFetchStreams:i},u),y._setSettings(u),y}),"PUBLIC").setMultipleInstances(!0)),ud(wJ,TJ,e),ud(wJ,TJ,"esm2017")})();var Q6e="firebase",Z6e="11.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ud(Q6e,Z6e,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eBe="type.googleapis.com/google.protobuf.Int64Value",tBe="type.googleapis.com/google.protobuf.UInt64Value";function Noe(n,e){const i={};for(const o in n)n.hasOwnProperty(o)&&(i[o]=e(n[o]));return i}function xk(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>xk(e));if(typeof n=="function"||typeof n=="object")return Noe(n,e=>xk(e));throw new Error("Data cannot be encoded in JSON: "+n)}function WS(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case eBe:case tBe:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>WS(e)):typeof n=="function"||typeof n=="object"?Noe(n,e=>WS(e)):n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gF="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TQ={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class wl extends Eh{constructor(e,i,o){super(`${gF}/${e}`,i||""),this.details=o,Object.setPrototypeOf(this,wl.prototype)}}function nBe(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function Dk(n,e){let i=nBe(n),o=i,l;try{const u=e&&e.error;if(u){const f=u.status;if(typeof f=="string"){if(!TQ[f])return new wl("internal","internal");i=TQ[f],o=f}const y=u.message;typeof y=="string"&&(o=y),l=u.details,l!==void 0&&(l=WS(l))}}catch{}return i==="ok"?null:new wl(i,o,l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rBe{constructor(e,i,o,l){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,vl(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=i.getImmediate({optional:!0}),this.messaging=o.getImmediate({optional:!0}),this.auth||i.get().then(u=>this.auth=u,()=>{}),this.messaging||o.get().then(u=>this.messaging=u,()=>{}),this.appCheck||l==null||l.get().then(u=>this.appCheck=u,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const i=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return i.error?null:i.token}return null}async getContext(e){const i=await this.getAuthToken(),o=await this.getMessagingToken(),l=await this.getAppCheckToken(e);return{authToken:i,messagingToken:o,appCheckToken:l}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w5="us-central1",iBe=/^data: (.*?)(?:\n|$)/;function sBe(n){let e=null;return{promise:new Promise((i,o)=>{e=setTimeout(()=>{o(new wl("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}class oBe{constructor(e,i,o,l,u=w5,f=(...y)=>fetch(...y)){this.app=e,this.fetchImpl=f,this.emulatorOrigin=null,this.contextProvider=new rBe(e,i,o,l),this.cancelAllRequests=new Promise(y=>{this.deleteService=()=>Promise.resolve(y())});try{const y=new URL(u);this.customDomain=y.origin+(y.pathname==="/"?"":y.pathname),this.region=w5}catch{this.customDomain=null,this.region=u}}_delete(){return this.deleteService()}_url(e){const i=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${i}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${i}.cloudfunctions.net/${e}`}}function aBe(n,e,i){const o=tm(e);n.emulatorOrigin=`http${o?"s":""}://${e}:${i}`,o&&(fN(n.emulatorOrigin),mN("Functions",!0))}function cBe(n,e,i){const o=l=>uBe(n,e,l,{});return o.stream=(l,u)=>hBe(n,e,l,u),o}async function lBe(n,e,i,o){i["Content-Type"]="application/json";let l;try{l=await o(n,{method:"POST",body:JSON.stringify(e),headers:i})}catch{return{status:0,json:null}}let u=null;try{u=await l.json()}catch{}return{status:l.status,json:u}}async function xoe(n,e){const i={},o=await n.contextProvider.getContext(e.limitedUseAppCheckTokens);return o.authToken&&(i.Authorization="Bearer "+o.authToken),o.messagingToken&&(i["Firebase-Instance-ID-Token"]=o.messagingToken),o.appCheckToken!==null&&(i["X-Firebase-AppCheck"]=o.appCheckToken),i}function uBe(n,e,i,o){const l=n._url(e);return dBe(n,l,i,o)}async function dBe(n,e,i,o){i=xk(i);const l={data:i},u=await xoe(n,o),f=o.timeout||7e4,y=sBe(f),v=await Promise.race([lBe(e,l,u,n.fetchImpl),y.promise,n.cancelAllRequests]);if(y.cancel(),!v)throw new wl("cancelled","Firebase Functions instance was deleted.");const b=Dk(v.status,v.json);if(b)throw b;if(!v.json)throw new wl("internal","Response is not valid JSON object.");let C=v.json.data;if(typeof C>"u"&&(C=v.json.result),typeof C>"u")throw new wl("internal","Response is missing data field.");return{data:WS(C)}}function hBe(n,e,i,o){const l=n._url(e);return pBe(n,l,i,o||{})}async function pBe(n,e,i,o){var l;i=xk(i);const u={data:i},f=await xoe(n,o);f["Content-Type"]="application/json",f.Accept="text/event-stream";let y;try{y=await n.fetchImpl(e,{method:"POST",body:JSON.stringify(u),headers:f,signal:o==null?void 0:o.signal})}catch(L){if(L instanceof Error&&L.name==="AbortError"){const U=new wl("cancelled","Request was cancelled.");return{data:Promise.reject(U),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(U)}}}}}}const D=Dk(0,null);return{data:Promise.reject(D),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(D)}}}}}}let v,b;const C=new Promise((L,D)=>{v=L,b=D});(l=o==null?void 0:o.signal)===null||l===void 0||l.addEventListener("abort",()=>{const L=new wl("cancelled","Request was cancelled.");b(L)});const R=y.body.getReader(),O=fBe(R,v,b,o==null?void 0:o.signal);return{stream:{[Symbol.asyncIterator](){const L=O.getReader();return{async next(){const{value:D,done:U}=await L.read();return{value:D,done:U}},async return(){return await L.cancel(),{done:!0,value:void 0}}}}},data:C}}function fBe(n,e,i,o){const l=(f,y)=>{const v=f.match(iBe);if(!v)return;const b=v[1];try{const C=JSON.parse(b);if("result"in C){e(WS(C.result));return}if("message"in C){y.enqueue(WS(C.message));return}if("error"in C){const R=Dk(0,C);y.error(R),i(R);return}}catch(C){if(C instanceof wl){y.error(C),i(C);return}}},u=new TextDecoder;return new ReadableStream({start(f){let y="";return v();async function v(){if(o!=null&&o.aborted){const b=new wl("cancelled","Request was cancelled");return f.error(b),i(b),Promise.resolve()}try{const{value:b,done:C}=await n.read();if(C){y.trim()&&l(y.trim(),f),f.close();return}if(o!=null&&o.aborted){const O=new wl("cancelled","Request was cancelled");f.error(O),i(O),await n.cancel();return}y+=u.decode(b,{stream:!0});const R=y.split(`
`);y=R.pop()||"";for(const O of R)O.trim()&&l(O.trim(),f);return v()}catch(b){const C=b instanceof wl?b:Dk(0,null);f.error(C),i(C)}}},cancel(){return n.cancel()}})}const CQ="@firebase/functions",RQ="0.12.9";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mBe="auth-internal",gBe="app-check-internal",_Be="messaging-internal";function yBe(n){const e=(i,{instanceIdentifier:o})=>{const l=i.getProvider("app").getImmediate(),u=i.getProvider(mBe),f=i.getProvider(_Be),y=i.getProvider(gBe);return new oBe(l,u,f,y,o)};Mg(new qf(gF,e,"PUBLIC").setMultipleInstances(!0)),ud(CQ,RQ,n),ud(CQ,RQ,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EBe(n=gN(),e=w5){const o=WR(Ui(n),gF).getImmediate({identifier:e}),l=vj("functions");return l&&vBe(o,...l),o}function vBe(n,e,i){aBe(Ui(n),e,i)}function _F(n,e,i){return cBe(Ui(n),e)}yBe();const SBe=[{key:"VITE_FIREBASE_API_KEY",value:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU"},{key:"VITE_FIREBASE_AUTH_DOMAIN",value:"disruptive-metaverse.firebaseapp.com"},{key:"VITE_FIREBASE_PROJECT_ID",value:"disruptive-metaverse"},{key:"VITE_FIREBASE_STORAGE_BUCKET",value:"disruptive-metaverse.appspot.com"},{key:"VITE_FIREBASE_MESSAGING_SENDER_ID",value:"294433070603"},{key:"VITE_FIREBASE_APP_ID",value:"1:294433070603:web:136cddd196eea9614fb10e"}],bBe=SBe.filter(n=>!n.value),WO={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"};if(!WO.apiKey||!WO.authDomain||!WO.projectId){const n="CRITICAL: Missing required Firebase configuration. In development, set environment variables. In production builds, config should be available.";throw H.error(n),console.error(n),new Error("Missing required Firebase configuration")}bBe.length>0?H.log("Firebase: Using fallback configuration for production build (this is normal)"):H.log("Firebase: Initializing with environment configuration");let cO,yF,Xn,WN;try{cO=die(WO),yF=LS(cO),Xn=M0(cO),WN=EBe(cO),H.log("Firebase initialized successfully")}catch(n){H.error("Failed to initialize Firebase:",n),console.error("Failed to initialize Firebase:",n)}const SC=n=>!0,IQ=(n,e)=>{const o=(n+e.charAt(0)).toLowerCase().replace(/[^a-z0-9]/g,"").substring(0,11),l=Math.floor(1e3+Math.random()*9e3);return o+l},Doe=async n=>{try{if(!n||typeof n!="string"||n.trim()==="")return H.error("userFirestore: Invalid username provided to isUsernameTaken"),!0;const e=n.toLowerCase().trim();H.log(`userFirestore: Checking if username "${e}" is taken`);const i=Uc(Xn,"users"),o=Nk(i,Coe(100)),l=await hd(o);let u=!1;return l.forEach(f=>{const y=f.data();y.username&&y.username.toLowerCase()===e&&(u=!0)}),H.log(`userFirestore: Username "${e}" is ${u?"taken":"available"}`),u}catch(e){return H.error("userFirestore: Error checking username availability:",e),!0}},wBe=async(n,e)=>{let i=IQ(n,e),o=0;const l=10;for(;o<l;){if(!await Doe(i))return i;i=IQ(n,e),o++}return i+Math.floor(Math.random()*100)},Vc=async n=>{try{H.log("userFirestore: Get user PUBLIC profile data for user ID: "+n);const e=_r(Xn,"users",n),i=await Xo(e);if(i.exists()){const o=i.data();return H.log("userFirestore: Found PUBLIC Profile for : "+o.Nickname),delete o.email,delete o.emailVerified,o}else return H.error("userFirestore: user profile document not found"),null}catch(e){throw H.error("userFirestore: Error fetching user public profile data:",e),e}},TBe=async(n,e,i)=>{try{if(H.log("userFirestore: Starting registerUser process"),H.log("userFirestore: Fields in additionalData:",Object.keys(i||{}).join(", ")),!i)throw H.error("userFirestore: additionalData is null or undefined"),new Error("Registration data is missing");const o={firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:i.username||"",Nickname:i.Nickname||"",rpmURL:i.rpmURL||"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb"};H.log("userFirestore: Critical fields captured for registration"),H.log("userFirestore: Creating user auth record");const u=(await I3e(yF,n,e)).user;await jie(u),H.log("userFirestore: Verification email sent"),H.log("userFirestore: Waiting for Cloud Function to create initial document..."),await new Promise(L=>setTimeout(L,5e3));const f=_r(Xn,"users",u.uid),y=await Xo(f);if(y.exists()){H.log("userFirestore: Found document created by Cloud Function, updating with missing fields");const L=y.data(),D={};L.firstName||(D.firstName=o.firstName),L.lastName||(D.lastName=o.lastName),L.Nickname||(D.Nickname=o.Nickname),L.username||(D.username=o.username),L.companyName||(D.companyName=o.companyName),L.linkedInProfile||(D.linkedInProfile=o.linkedInProfile),L.rpmURL||(D.rpmURL=o.rpmURL),Object.keys(D).length>0&&(H.log("userFirestore: Updating document with fields:",Object.keys(D).join(", ")),await ko(f,{...D,lastUpdated:new Date}))}else{H.error("userFirestore: Cloud Function failed to create user document, creating manually"),await Gg(f,{...o,id:u.uid,groups:["users"],createdAt:new Date,lastUpdated:new Date});const L=_r(Xn,"users",u.uid,"private","data");await Gg(L,{email:u.email,emailVerified:!1})}const v=await Xo(f);if(!v.exists())throw new Error("User document does not exist even after creation attempts");let b=v.data();b.firstName||(b.firstName=o.firstName),b.lastName||(b.lastName=o.lastName),b.Nickname||(b.Nickname=o.Nickname),b.username||(b.username=o.username),b.companyName||(b.companyName=o.companyName);let C=!1,R={};for(const L in o)(!b[L]||b[L]==="")&&(R[L]=o[L],C=!0);(!b.groups||!b.groups.includes("users"))&&(R.groups=b.groups?[...b.groups,"users"]:["users"],C=!0,H.log("userFirestore: Adding user to users group")),C&&(H.log("userFirestore: Updating user document with missing fields"),H.log("userFirestore: Fields being updated:",Object.keys(R).join(", ")),await ko(f,R),b=(await Xo(f)).data());const O={...u,...b,firstName:o.firstName,lastName:o.lastName,Nickname:o.Nickname,username:o.username,companyName:o.companyName,linkedInProfile:o.linkedInProfile};return H.log("userFirestore: Registration complete, returning user data"),H.log("userFirestore: Fields included in return data:",Object.keys(O).join(", ")),O}catch(o){throw H.error("userFirestore: Error creating user:",o),o}},Loe=async(n,e)=>{try{H.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const i=_r(Xn,"users",n);await ko(i,{rpmURL:e,lastUpdated:new Date().toISOString()}),H.log("userFirestore: rpmURL updated successfully.")}catch(i){throw H.error("userFirestore: Error updating rpmURL:",i),i}},CBe=async(n,e)=>{try{const i=await Vc(n);return i&&i.groups?i.groups.includes(e):!1}catch(i){return H.error("userFirestore: Error checking group membership:",i),!1}};var RBe={};const AQ=()=>{const n=typeof process<"u"&&RBe&&!1;return typeof window<"u"&&new URLSearchParams(window.location.search).has("dev_mode"),n};typeof AQ=="function"&&AQ();const IBe=async(n,e)=>{if(!n||!n.uid)return!1;try{if(n.groups){const l=`space_${e}_owners`;if(n.groups.includes(l))return!0}const o=LS().currentUser;if(o&&o.uid===n.uid)try{const u=(await o.getIdTokenResult(!0)).claims.groups||[],f=`space_${e}_owners`;if(u.includes(f))return!0}catch(l){console.error("Error getting token result:",l)}return!1}catch(i){return H.error("Error checking space owner permissions:",i),!1}},GN=async(n,e)=>{try{if(H.log(`userPermissions: Checking if user ${n} belongs to group ${e}`),e==="users")return H.log(`userPermissions: TESTING MODE - Always allowing access to 'users' group for user ${n}`),!0;if(n){const i=await Vc(n);if(H.log(`userPermissions: User profile for ${n}:`,i),i&&i.groups&&Array.isArray(i.groups)){if(H.log(`userPermissions: User ${n} has groups:`,i.groups),i.groups.includes(e))return H.log(`userPermissions: User ${n} belongs to group ${e} (from user document)`),!0}else H.log(`userPermissions: User ${n} has no groups or groups is not an array`);if(e==="disruptiveAdmin")try{const l=LS().currentUser;if(l&&l.uid===n){const u=await l.getIdTokenResult();if(H.log(`userPermissions: Token claims for ${n}:`,u.claims),u.claims&&u.claims.groups&&Array.isArray(u.claims.groups)&&u.claims.groups.includes(e))return H.log(`userPermissions: User ${n} belongs to group ${e} (from token claims)`),!0}}catch(o){H.error("userPermissions: Error checking token claims:",o)}}return H.log(`userPermissions: User ${n} does not belong to group ${e}`),!1}catch(i){return H.error("userPermissions: Error checking if user belongs to group:",i),!1}},ABe=["name","rpmURL","Nickname","username","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups","isGuest","guestSpaceId","guestSessionStart"],fh={sendUserToUnity:"sendUserToUnity",playerInstantiated:"playerInstantiated",firstSceneLoaded:"firstSceneLoaded"};class PBe{constructor(){this.events={}}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i)}publish(e,i){const o=this.events[e];o?(o.forEach(l=>{l(i)}),H.log(`EventBus: Published event '${e}'`)):H.log(`EventBus: No subscribers for event '${e}'`)}unsubscribe(e,i){var l;const o=(l=this.events[e])==null?void 0:l.indexOf(i);o>-1&&this.events[e].splice(o,1)}}const mh=new PBe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Moe="firebasestorage.googleapis.com",Uoe="storageBucket",OBe=120*1e3,kBe=600*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs extends Eh{constructor(e,i,o=0){super(XU(e),`Firebase Storage: ${i} (${XU(e)})`),this.status_=o,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,qs.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return XU(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Ks;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Ks||(Ks={}));function XU(n){return"storage/"+n}function EF(){const n="An unknown error occurred, please check the error payload for server response.";return new qs(Ks.UNKNOWN,n)}function NBe(n){return new qs(Ks.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function xBe(n){return new qs(Ks.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function DBe(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new qs(Ks.UNAUTHENTICATED,n)}function LBe(){return new qs(Ks.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function MBe(n){return new qs(Ks.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function UBe(){return new qs(Ks.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function VBe(){return new qs(Ks.CANCELED,"User canceled the upload/download.")}function jBe(n){return new qs(Ks.INVALID_URL,"Invalid URL '"+n+"'.")}function FBe(n){return new qs(Ks.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function BBe(){return new qs(Ks.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Uoe+"' property when initializing the app?")}function zBe(){return new qs(Ks.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function WBe(){return new qs(Ks.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function GBe(n){return new qs(Ks.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function T5(n){return new qs(Ks.INVALID_ARGUMENT,n)}function Voe(){return new qs(Ks.APP_DELETED,"The Firebase app was deleted.")}function HBe(n){return new qs(Ks.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function WC(n,e){return new qs(Ks.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function XT(n){throw new qs(Ks.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hu{constructor(e,i){this.bucket=e,this.path_=i}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,i){let o;try{o=hu.makeFromUrl(e,i)}catch{return new hu(e,"")}if(o.path==="")return o;throw FBe(e)}static makeFromUrl(e,i){let o=null;const l="([A-Za-z0-9.\\-_]+)";function u(le){le.path.charAt(le.path.length-1)==="/"&&(le.path_=le.path_.slice(0,-1))}const f="(/(.*))?$",y=new RegExp("^gs://"+l+f,"i"),v={bucket:1,path:3};function b(le){le.path_=decodeURIComponent(le.path)}const C="v[A-Za-z0-9_]+",R=i.replace(/[.]/g,"\\."),O="(/([^?#]*).*)?$",L=new RegExp(`^https?://${R}/${C}/b/${l}/o${O}`,"i"),D={bucket:1,path:3},U=i===Moe?"(?:storage.googleapis.com|storage.cloud.google.com)":i,B="([^?#]*)",Y=new RegExp(`^https?://${U}/${l}/${B}`,"i"),ne=[{regex:y,indices:v,postModify:u},{regex:L,indices:D,postModify:b},{regex:Y,indices:{bucket:1,path:2},postModify:b}];for(let le=0;le<ne.length;le++){const re=ne[le],me=re.regex.exec(e);if(me){const q=me[re.indices.bucket];let J=me[re.indices.path];J||(J=""),o=new hu(q,J),re.postModify(o);break}}if(o==null)throw jBe(e);return o}}class $Be{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KBe(n,e,i){let o=1,l=null,u=null,f=!1,y=0;function v(){return y===2}let b=!1;function C(...B){b||(b=!0,e.apply(null,B))}function R(B){l=setTimeout(()=>{l=null,n(L,v())},B)}function O(){u&&clearTimeout(u)}function L(B,...Y){if(b){O();return}if(B){O(),C.call(null,B,...Y);return}if(v()||f){O(),C.call(null,B,...Y);return}o<64&&(o*=2);let ne;y===1?(y=2,ne=0):ne=(o+Math.random())*1e3,R(ne)}let D=!1;function U(B){D||(D=!0,O(),!b&&(l!==null?(B||(y=2),clearTimeout(l),R(0)):B||(y=1)))}return R(0),u=setTimeout(()=>{f=!0,U(!0)},i),U}function qBe(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YBe(n){return n!==void 0}function XBe(n){return typeof n=="object"&&!Array.isArray(n)}function vF(n){return typeof n=="string"||n instanceof String}function PQ(n){return SF()&&n instanceof Blob}function SF(){return typeof Blob<"u"}function OQ(n,e,i,o){if(o<e)throw T5(`Invalid value for '${n}'. Expected ${e} or greater.`);if(o>i)throw T5(`Invalid value for '${n}'. Expected ${i} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HN(n,e,i){let o=e;return i==null&&(o=`https://${e}`),`${i}://${o}/v0${n}`}function joe(n){const e=encodeURIComponent;let i="?";for(const o in n)if(n.hasOwnProperty(o)){const l=e(o)+"="+e(n[o]);i=i+l+"&"}return i=i.slice(0,-1),i}var qy;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(qy||(qy={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JBe(n,e){const i=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,u=e.indexOf(n)!==-1;return i||l||u}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QBe{constructor(e,i,o,l,u,f,y,v,b,C,R,O=!0,L=!1){this.url_=e,this.method_=i,this.headers_=o,this.body_=l,this.successCodes_=u,this.additionalRetryCodes_=f,this.callback_=y,this.errorCallback_=v,this.timeout_=b,this.progressCallback_=C,this.connectionFactory_=R,this.retry=O,this.isUsingEmulator=L,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((D,U)=>{this.resolve_=D,this.reject_=U,this.start_()})}start_(){const e=(o,l)=>{if(l){o(!1,new lO(!1,null,!0));return}const u=this.connectionFactory_();this.pendingConnection_=u;const f=y=>{const v=y.loaded,b=y.lengthComputable?y.total:-1;this.progressCallback_!==null&&this.progressCallback_(v,b)};this.progressCallback_!==null&&u.addUploadProgressListener(f),u.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&u.removeUploadProgressListener(f),this.pendingConnection_=null;const y=u.getErrorCode()===qy.NO_ERROR,v=u.getStatus();if(!y||JBe(v,this.additionalRetryCodes_)&&this.retry){const C=u.getErrorCode()===qy.ABORT;o(!1,new lO(!1,null,C));return}const b=this.successCodes_.indexOf(v)!==-1;o(!0,new lO(b,u))})},i=(o,l)=>{const u=this.resolve_,f=this.reject_,y=l.connection;if(l.wasSuccessCode)try{const v=this.callback_(y,y.getResponse());YBe(v)?u(v):u()}catch(v){f(v)}else if(y!==null){const v=EF();v.serverResponse=y.getErrorText(),this.errorCallback_?f(this.errorCallback_(y,v)):f(v)}else if(l.canceled){const v=this.appDelete_?Voe():VBe();f(v)}else{const v=UBe();f(v)}};this.canceled_?i(!1,new lO(!1,null,!0)):this.backoffId_=KBe(e,i,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&qBe(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class lO{constructor(e,i,o){this.wasSuccessCode=e,this.connection=i,this.canceled=!!o}}function ZBe(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function e8e(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function t8e(n,e){e&&(n["X-Firebase-GMPID"]=e)}function n8e(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function r8e(n,e,i,o,l,u,f=!0,y=!1){const v=joe(n.urlParams),b=n.url+v,C=Object.assign({},n.headers);return t8e(C,e),ZBe(C,i),e8e(C,u),n8e(C,o),new QBe(b,n.method,C,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,f,y)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i8e(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function s8e(...n){const e=i8e();if(e!==void 0){const i=new e;for(let o=0;o<n.length;o++)i.append(n[o]);return i.getBlob()}else{if(SF())return new Blob(n);throw new qs(Ks.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function o8e(n,e,i){return n.webkitSlice?n.webkitSlice(e,i):n.mozSlice?n.mozSlice(e,i):n.slice?n.slice(e,i):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function a8e(n){if(typeof atob>"u")throw GBe("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rp={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class JU{constructor(e,i){this.data=e,this.contentType=i||null}}function c8e(n,e){switch(n){case Rp.RAW:return new JU(Foe(e));case Rp.BASE64:case Rp.BASE64URL:return new JU(Boe(n,e));case Rp.DATA_URL:return new JU(u8e(e),d8e(e))}throw EF()}function Foe(n){const e=[];for(let i=0;i<n.length;i++){let o=n.charCodeAt(i);if(o<=127)e.push(o);else if(o<=2047)e.push(192|o>>6,128|o&63);else if((o&64512)===55296)if(!(i<n.length-1&&(n.charCodeAt(i+1)&64512)===56320))e.push(239,191,189);else{const u=o,f=n.charCodeAt(++i);o=65536|(u&1023)<<10|f&1023,e.push(240|o>>18,128|o>>12&63,128|o>>6&63,128|o&63)}else(o&64512)===56320?e.push(239,191,189):e.push(224|o>>12,128|o>>6&63,128|o&63)}return new Uint8Array(e)}function l8e(n){let e;try{e=decodeURIComponent(n)}catch{throw WC(Rp.DATA_URL,"Malformed data URL.")}return Foe(e)}function Boe(n,e){switch(n){case Rp.BASE64:{const l=e.indexOf("-")!==-1,u=e.indexOf("_")!==-1;if(l||u)throw WC(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case Rp.BASE64URL:{const l=e.indexOf("+")!==-1,u=e.indexOf("/")!==-1;if(l||u)throw WC(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let i;try{i=a8e(e)}catch(l){throw l.message.includes("polyfill")?l:WC(n,"Invalid character found")}const o=new Uint8Array(i.length);for(let l=0;l<i.length;l++)o[l]=i.charCodeAt(l);return o}class zoe{constructor(e){this.base64=!1,this.contentType=null;const i=e.match(/^data:([^,]+)?,/);if(i===null)throw WC(Rp.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const o=i[1]||null;o!=null&&(this.base64=h8e(o,";base64"),this.contentType=this.base64?o.substring(0,o.length-7):o),this.rest=e.substring(e.indexOf(",")+1)}}function u8e(n){const e=new zoe(n);return e.base64?Boe(Rp.BASE64,e.rest):l8e(e.rest)}function d8e(n){return new zoe(n).contentType}function h8e(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tg{constructor(e,i){let o=0,l="";PQ(e)?(this.data_=e,o=e.size,l=e.type):e instanceof ArrayBuffer?(i?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),o=this.data_.length):e instanceof Uint8Array&&(i?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),o=e.length),this.size_=o,this.type_=l}size(){return this.size_}type(){return this.type_}slice(e,i){if(PQ(this.data_)){const o=this.data_,l=o8e(o,e,i);return l===null?null:new Tg(l)}else{const o=new Uint8Array(this.data_.buffer,e,i-e);return new Tg(o,!0)}}static getBlob(...e){if(SF()){const i=e.map(o=>o instanceof Tg?o.data_:o);return new Tg(s8e.apply(null,i))}else{const i=e.map(f=>vF(f)?c8e(Rp.RAW,f).data:f.data_);let o=0;i.forEach(f=>{o+=f.byteLength});const l=new Uint8Array(o);let u=0;return i.forEach(f=>{for(let y=0;y<f.length;y++)l[u++]=f[y]}),new Tg(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Woe(n){let e;try{e=JSON.parse(n)}catch{return null}return XBe(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p8e(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function f8e(n,e){const i=e.split("/").filter(o=>o.length>0).join("/");return n.length===0?i:n+"/"+i}function Goe(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m8e(n,e){return e}class Nc{constructor(e,i,o,l){this.server=e,this.local=i||e,this.writable=!!o,this.xform=l||m8e}}let uO=null;function g8e(n){return!vF(n)||n.length<2?n:Goe(n)}function Hoe(){if(uO)return uO;const n=[];n.push(new Nc("bucket")),n.push(new Nc("generation")),n.push(new Nc("metageneration")),n.push(new Nc("name","fullPath",!0));function e(u,f){return g8e(f)}const i=new Nc("name");i.xform=e,n.push(i);function o(u,f){return f!==void 0?Number(f):f}const l=new Nc("size");return l.xform=o,n.push(l),n.push(new Nc("timeCreated")),n.push(new Nc("updated")),n.push(new Nc("md5Hash",null,!0)),n.push(new Nc("cacheControl",null,!0)),n.push(new Nc("contentDisposition",null,!0)),n.push(new Nc("contentEncoding",null,!0)),n.push(new Nc("contentLanguage",null,!0)),n.push(new Nc("contentType",null,!0)),n.push(new Nc("metadata","customMetadata",!0)),uO=n,uO}function _8e(n,e){function i(){const o=n.bucket,l=n.fullPath,u=new hu(o,l);return e._makeStorageReference(u)}Object.defineProperty(n,"ref",{get:i})}function y8e(n,e,i){const o={};o.type="file";const l=i.length;for(let u=0;u<l;u++){const f=i[u];o[f.local]=f.xform(o,e[f.server])}return _8e(o,n),o}function $oe(n,e,i){const o=Woe(e);return o===null?null:y8e(n,o,i)}function E8e(n,e,i,o){const l=Woe(e);if(l===null||!vF(l.downloadTokens))return null;const u=l.downloadTokens;if(u.length===0)return null;const f=encodeURIComponent;return u.split(",").map(b=>{const C=n.bucket,R=n.fullPath,O="/b/"+f(C)+"/o/"+f(R),L=HN(O,i,o),D=joe({alt:"media",token:b});return L+D})[0]}function v8e(n,e){const i={},o=e.length;for(let l=0;l<o;l++){const u=e[l];u.writable&&(i[u.server]=n[u.local])}return JSON.stringify(i)}class bF{constructor(e,i,o,l){this.url=e,this.method=i,this.handler=o,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Koe(n){if(!n)throw EF()}function S8e(n,e){function i(o,l){const u=$oe(n,l,e);return Koe(u!==null),u}return i}function b8e(n,e){function i(o,l){const u=$oe(n,l,e);return Koe(u!==null),E8e(u,l,n.host,n._protocol)}return i}function qoe(n){function e(i,o){let l;return i.getStatus()===401?i.getErrorText().includes("Firebase App Check token is invalid")?l=LBe():l=DBe():i.getStatus()===402?l=xBe(n.bucket):i.getStatus()===403?l=MBe(n.path):l=o,l.status=i.getStatus(),l.serverResponse=o.serverResponse,l}return e}function Yoe(n){const e=qoe(n);function i(o,l){let u=e(o,l);return o.getStatus()===404&&(u=NBe(n.path)),u.serverResponse=l.serverResponse,u}return i}function w8e(n,e,i){const o=e.fullServerUrl(),l=HN(o,n.host,n._protocol),u="GET",f=n.maxOperationRetryTime,y=new bF(l,u,b8e(n,i),f);return y.errorHandler=Yoe(e),y}function T8e(n,e){const i=e.fullServerUrl(),o=HN(i,n.host,n._protocol),l="DELETE",u=n.maxOperationRetryTime;function f(v,b){}const y=new bF(o,l,f,u);return y.successCodes=[200,204],y.errorHandler=Yoe(e),y}function C8e(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function R8e(n,e,i){const o=Object.assign({},i);return o.fullPath=n.path,o.size=e.size(),o.contentType||(o.contentType=C8e(null,e)),o}function I8e(n,e,i,o,l){const u=e.bucketOnlyServerUrl(),f={"X-Goog-Upload-Protocol":"multipart"};function y(){let ne="";for(let le=0;le<2;le++)ne=ne+Math.random().toString().slice(2);return ne}const v=y();f["Content-Type"]="multipart/related; boundary="+v;const b=R8e(e,o,l),C=v8e(b,i),R="--"+v+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+C+`\r
--`+v+`\r
Content-Type: `+b.contentType+`\r
\r
`,O=`\r
--`+v+"--",L=Tg.getBlob(R,o,O);if(L===null)throw zBe();const D={name:b.fullPath},U=HN(u,n.host,n._protocol),B="POST",Y=n.maxUploadRetryTime,W=new bF(U,B,S8e(n,i),Y);return W.urlParams=D,W.headers=f,W.body=L.uploadData(),W.errorHandler=qoe(e),W}class A8e{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=qy.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=qy.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=qy.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,i,o,l,u){if(this.sent_)throw XT("cannot .send() more than once");if(tm(e)&&o&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(i,e,!0),u!==void 0)for(const f in u)u.hasOwnProperty(f)&&this.xhr_.setRequestHeader(f,u[f].toString());return l!==void 0?this.xhr_.send(l):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw XT("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw XT("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw XT("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw XT("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class P8e extends A8e{initXhr(){this.xhr_.responseType="text"}}function wF(){return new P8e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aE{constructor(e,i){this._service=e,i instanceof hu?this._location=i:this._location=hu.makeFromUrl(i,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,i){return new aE(e,i)}get root(){const e=new hu(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Goe(this._location.path)}get storage(){return this._service}get parent(){const e=p8e(this._location.path);if(e===null)return null;const i=new hu(this._location.bucket,e);return new aE(this._service,i)}_throwIfRoot(e){if(this._location.path==="")throw HBe(e)}}function O8e(n,e,i){n._throwIfRoot("uploadBytes");const o=I8e(n.storage,n._location,Hoe(),new Tg(e,!0),i);return n.storage.makeRequestWithTokens(o,wF).then(l=>({metadata:l,ref:n}))}function k8e(n){n._throwIfRoot("getDownloadURL");const e=w8e(n.storage,n._location,Hoe());return n.storage.makeRequestWithTokens(e,wF).then(i=>{if(i===null)throw WBe();return i})}function N8e(n){n._throwIfRoot("deleteObject");const e=T8e(n.storage,n._location);return n.storage.makeRequestWithTokens(e,wF)}function x8e(n,e){const i=f8e(n._location.path,e),o=new hu(n._location.bucket,i);return new aE(n.storage,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D8e(n){return/^[A-Za-z]+:\/\//.test(n)}function L8e(n,e){return new aE(n,e)}function Xoe(n,e){if(n instanceof TF){const i=n;if(i._bucket==null)throw BBe();const o=new aE(i,i._bucket);return e!=null?Xoe(o,e):o}else return e!==void 0?x8e(n,e):n}function M8e(n,e){if(e&&D8e(e)){if(n instanceof TF)return L8e(n,e);throw T5("To use ref(service, url), the first argument must be a Storage instance.")}else return Xoe(n,e)}function kQ(n,e){const i=e==null?void 0:e[Uoe];return i==null?null:hu.makeFromBucketSpec(i,n)}function U8e(n,e,i,o={}){n.host=`${e}:${i}`;const l=tm(e);l&&(fN(`https://${n.host}/b`),mN("Storage",!0)),n._isUsingEmulator=!0,n._protocol=l?"https":"http";const{mockUserToken:u}=o;u&&(n._overrideAuthToken=typeof u=="string"?u:cie(u,n.app.options.projectId))}class TF{constructor(e,i,o,l,u,f=!1){this.app=e,this._authProvider=i,this._appCheckProvider=o,this._url=l,this._firebaseVersion=u,this._isUsingEmulator=f,this._bucket=null,this._host=Moe,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=OBe,this._maxUploadRetryTime=kBe,this._requests=new Set,l!=null?this._bucket=hu.makeFromBucketSpec(l,this._host):this._bucket=kQ(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=hu.makeFromBucketSpec(this._url,e):this._bucket=kQ(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){OQ("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){OQ("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const i=await e.getToken();if(i!==null)return i.accessToken}return null}async _getAppCheckToken(){if(vl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new aE(this,e)}_makeRequest(e,i,o,l,u=!0){if(this._deleted)return new $Be(Voe());{const f=r8e(e,this._appId,o,l,i,this._firebaseVersion,u,this._isUsingEmulator);return this._requests.add(f),f.getPromise().then(()=>this._requests.delete(f),()=>this._requests.delete(f)),f}}async makeRequestWithTokens(e,i){const[o,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,i,o,l).getPromise()}}const NQ="@firebase/storage",xQ="0.13.14";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Joe="storage";function CF(n,e,i){return n=Ui(n),O8e(n,e,i)}function $N(n){return n=Ui(n),k8e(n)}function RF(n){return n=Ui(n),N8e(n)}function mE(n,e){return n=Ui(n),M8e(n,e)}function gE(n=gN(),e){n=Ui(n);const o=WR(n,Joe).getImmediate({identifier:e}),l=vj("storage");return l&&V8e(o,...l),o}function V8e(n,e,i,o={}){U8e(n,e,i,o)}function j8e(n,{instanceIdentifier:e}){const i=n.getProvider("app").getImmediate(),o=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new TF(i,o,l,e,dE)}function F8e(){Mg(new qf(Joe,j8e,"PUBLIC").setMultipleInstances(!0)),ud(NQ,xQ,""),ud(NQ,xQ,"esm2017")}F8e();const GO=async n=>{const e=gE(),i=mE(e,n);try{return await $N(i)}catch(o){throw H.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",o),o}},Qoe="rateLimits",B8e={guestUserCreate:{windowMs:60*1e3,maxAttempts:10},fileUpload:{windowMs:60*1e3,maxAttempts:10},chatMessage:{windowMs:10*1e3,maxAttempts:20},spaceJoin:{windowMs:60*1e3,maxAttempts:5}};function z8e(){try{const n=localStorage.getItem(Qoe);return n?JSON.parse(n):{}}catch(n){return console.error("Error reading rate limit data:",n),{}}}function W8e(n){try{localStorage.setItem(Qoe,JSON.stringify(n))}catch(e){console.error("Error saving rate limit data:",e)}}function IF(n,e=""){const i=B8e[n];if(!i)return console.warn(`No rate limit config for action type: ${n}`),{allowed:!0,retryAfter:null,message:null};const o=Date.now(),l=e?`${n}_${e}`:n,u=z8e(),f=u[l]||{attempts:[]},y=o-i.windowMs,v=f.attempts.filter(b=>b>y);if(v.length>=i.maxAttempts){const b=v[0],C=Math.ceil((b+i.windowMs-o)/1e3);return{allowed:!1,retryAfter:C,message:`Too many attempts. Please wait ${C} seconds before trying again.`}}return v.push(o),u[l]={attempts:v},W8e(u),{allowed:!0,retryAfter:null,message:null}}let C5={};const mo=async(n,e=0)=>{var f,y,v,b,C;const u=R=>R?300*Math.pow(2,e):300*(e+1);try{if(e===0){const L=LS();if(L.currentUser)try{await L.currentUser.getIdToken(!0),await new Promise(D=>setTimeout(D,300))}catch{await new Promise(U=>setTimeout(U,300))}else await new Promise(D=>setTimeout(D,800))}const R=_r(Xn,"spaces",n),O=await Promise.race([Xo(R),new Promise((L,D)=>setTimeout(()=>D(new Error("Firestore query timeout")),8e3))]);if(O.exists()){let L=O.data();const D=L.name,U=L.description;if(L.webglBuildId){const B=_r(Xn,"webglBuilds",L.webglBuildId),Y=await Xo(B);if(Y.exists()){const W=Y.data();L={...L,...W,name:D||W.name,description:U||W.description}}else H.warn(`spacesFirestore: No document found for webglBuildId: ${L.webglBuildId}`)}return L=await G8e(L),L=H8e(L),H.log(`spacesFirestore: Caching space data for: ${n}`),C5[n]=L,L}else{if(e<4){const L=u(!1);return H.log(`spacesFirestore: Space not found, retrying (${e+1}/4) after ${L}ms: ${n} - might be timing/permission issue`),await new Promise(D=>setTimeout(D,L)),mo(n,e+1)}return H.warn(`spacesFirestore: No document found for item ID: ${n} (after 4 attempts)`),null}}catch(R){const O=R.code==="permission-denied"||R.code==="permissions"||((f=R.message)==null?void 0:f.toLowerCase().includes("permission"))||((y=R.message)==null?void 0:y.toLowerCase().includes("insufficient permissions"));if(H.log(`spacesFirestore: Error fetching space (attempt ${e+1}):`,{code:R.code,message:R.message,itemId:n,isPermissionError:O}),e<4&&(R.code==="unavailable"||R.code==="deadline-exceeded"||O||(v=R.message)!=null&&v.includes("network")||(b=R.message)!=null&&b.includes("timeout")||(C=R.message)!=null&&C.includes("Firestore query timeout"))){const L=u(O);if(H.log(`spacesFirestore: ${O?"Permission":"Transient"} error, retrying (${e+1}/4) after ${L}ms: ${R.code||R.message}`),O){const D=LS();if(D.currentUser){const U=e===0?500:300;if(await new Promise(B=>setTimeout(B,U)),e===0)try{await D.currentUser.getIdToken(!0),await new Promise(B=>setTimeout(B,300))}catch{}}else{const U=1200*Math.pow(2,e);H.log(`spacesFirestore: Guest user permission error, waiting ${U}ms for Firestore rules to evaluate (attempt ${e+1})`),await new Promise(B=>setTimeout(B,U))}}return await new Promise(D=>setTimeout(D,L)),mo(n,e+1)}throw H.error("spacesFirestore: Error fetching item data (final):",R),R}},G8e=async n=>{const i=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async o=>{const l=n[o];l&&l.startsWith("gs://")&&(n[o]=await GO(l))});return await Promise.all(i),n},H8e=n=>{const{gsUrlCode:e,gsUrlData:i,gsUrlFramework:o,gsUrlLoader:l,...u}=n;return{...u,codeUrl:e,dataUrl:i,frameworkUrl:o,loaderUrl:l}};let QU={};const Zoe=async n=>{H.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(QU[n])return H.log("spacesFirestore: Returning cached videos for space:",n),QU[n];const e=Uc(Xn,`spaces/${n}/videos`),i=await hd(e),o=[];return i.forEach(l=>{o.push({id:l.id,...l.data()})}),QU[n]=o,o}catch(e){throw H.error("spacesFirestore: Error fetching Space videos from Firestore:",e),e}},$8e=async(n,e)=>{try{const i=IF("fileUpload",n);if(!i.allowed)throw new Error(i.message);if(!n||!e)throw new Error("Missing required parameters: spaceId and logoFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const o=5*1024*1024;if(e.size>o)throw new Error("File size must be less than 5MB");const l=gE(),u=Date.now(),f=e.name.split(".").pop(),y=`logo_${u}.${f}`,v=mE(l,`spaces/${n}/logo/${y}`);H.log(`Uploading logo for space ${n}`);const b=await CF(v,e),C=await $N(b.ref),R=_r(Xn,"spaces",n);return await ko(R,{logoUrl:C,logoGsUrl:`gs://${b.ref.bucket}/${b.ref.fullPath}`,logoFileName:y,updatedAt:new Date().toISOString()}),H.log(`Successfully uploaded logo for space ${n}`),C}catch(i){throw H.error("Error uploading space logo:",i),i}},K8e=async n=>{try{const e=_r(Xn,"spaces",n),i=await Xo(e);if(!i.exists())return H.warn(`No space found with ID: ${n}`),!1;const o=i.data();if(o.logoGsUrl){const l=gE(),u=mE(l,o.logoGsUrl);try{await RF(u),H.log(`Deleted logo file from storage: ${o.logoGsUrl}`)}catch(f){H.warn(`Could not delete logo file from storage: ${f.message}`)}}return await ko(e,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),H.log(`Successfully removed logo for space ${n}`),!0}catch(e){throw H.error("Error deleting space logo:",e),e}},q8e=async(n,e)=>{try{const i=IF("fileUpload",n);if(!i.allowed)throw new Error(i.message);if(!n||!e)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!e.type.startsWith("image/"))throw new Error("File must be an image");const o=10*1024*1024;if(e.size>o)throw new Error("File size must be less than 10MB");const l=gE(),u=Date.now(),f=e.name.split(".").pop(),y=`background_${u}.${f}`,v=mE(l,`spaces/${n}/background/${y}`);H.log(`Uploading background for space ${n}`);const b=await CF(v,e),C=await $N(b.ref),R=_r(Xn,"spaces",n);return await ko(R,{backgroundUrl:C,backgroundGsUrl:`gs://${b.ref.bucket}/${b.ref.fullPath}`,backgroundFileName:y,gsUrlLoadingBackground:`gs://${b.ref.bucket}/${b.ref.fullPath}`,updatedAt:new Date().toISOString()}),H.log(`Successfully uploaded background for space ${n}`),C}catch(i){throw H.error("Error uploading space background:",i),i}},Y8e=async n=>{try{const e=_r(Xn,"spaces",n),i=await Xo(e);if(!i.exists())return H.warn(`No space found with ID: ${n}`),!1;const o=i.data();if(o.backgroundGsUrl){const l=gE(),u=mE(l,o.backgroundGsUrl);try{await RF(u),H.log(`Deleted background file from storage: ${o.backgroundGsUrl}`)}catch(f){H.warn(`Could not delete background file from storage: ${f.message}`)}}return await ko(e,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),H.log(`Successfully removed background for space ${n}`),!0}catch(e){throw H.error("Error deleting space background:",e),e}},X8e=async(n,e)=>{try{if(!n||!e||!e.uid)throw new Error("Missing required parameters");const i=_r(Xn,`spaces/${n}/BannedUsers`,e.uid),o=Object.entries({...e,bannedAt:e.bannedAt||new Date().toISOString()}).reduce((l,[u,f])=>(f!==void 0&&(l[u]=f),l),{});await Gg(i,o);try{const l=_r(Xn,"users",e.uid),u=await Xo(l);if(u.exists()){const f=u.data(),y=Array.isArray(f.groups)?f.groups:[],v=`space_${n}_banned`;y.includes(v)||await ko(l,{groups:[...y,v]})}}catch(l){H.error("spacesFirestore: failed to add banned group to user",l)}return H.log(`spacesFirestore: Added banned user ${e.uid} to space ${n}`),!0}catch(i){throw H.error("spacesFirestore: Error adding banned user:",i),i}},Q0=async(n,e)=>{try{H.log(`spacesFirestore: Updating settings for space: ${n}`,e);const i=_r(Xn,"spaces",n);return await ko(i,{...e,updatedAt:new Date().toISOString()}),C5[n]&&delete C5[n],!0}catch(i){throw H.error("spacesFirestore: Error updating space settings:",i),i}},J8e=async(n,e)=>Q0(n,{accessibleToAllUsers:e}),R5=async(n,e)=>Q0(n,{HLSStreamURL:e}),eae=async n=>{try{const e=_r(Xn,"spaces",n),i=await Xo(e);return i.exists()&&i.data().HLSStreamURL||null}catch(e){throw H.error("spacesFirestore: Error getting HLS stream:",e),e}},Q8e=async(n,e)=>(H.warn("uploadSpaceVideoBackground: Not implemented in simplified stub."),null),Z8e=async n=>(H.warn("deleteSpaceVideoBackground: Not implemented in simplified stub."),null),eze=["https://models.readyplayer.me/682b6c39994f7261dd46350d.glb","https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb","https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb","https://models.readyplayer.me/67c884144c4878c55e515ff5.glb","https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb","https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb","https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb","https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb","https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb","https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb"],tze=()=>Math.floor(1e3+Math.random()*9e3).toString(),nze=()=>`Visitor_${tze()}`,rze=()=>eze[0],ize=()=>{const n=Date.now(),e=Math.floor(Math.random()*1e4);return`guest_${n}_${e}`},DQ=n=>{const e=ize(),i=nze(),o=rze(),l=new Date().toISOString(),u={uid:e,email:null,emailVerified:!1,name:i,username:i,Nickname:i,displayName:i,firstName:"Guest",lastName:"User",companyName:"",linkedInProfile:"",rpmURL:o,groups:["guests"],created_on:l,isGuest:!0,guestSpaceId:n,guestSessionStart:l,height_cm:null};return H.log("guestUserGenerator: Created guest user:",{uid:e,username:i,rpmURL:o,spaceId:n}),H.log("guestUserGenerator: FULL guest user object:",u),H.log("guestUserGenerator: Environment check - window.location:",window.location.href),H.log("guestUserGenerator: Nickname field:",u.Nickname),H.log("guestUserGenerator: rpmURL field:",u.rpmURL),u},sze=n=>n&&(n.isGuest===!0||n.uid&&n.uid.startsWith("guest_")),ls=k.createContext(null),oze=k.createContext(null),aze=({children:n})=>{const[e,i]=k.useState(null),o=k.useRef(null),[l,u]=k.useState(!0),[f,y]=k.useState(!1),[v,b]=k.useState(null),C=k.useRef(null),R=LS(),O=Se=>Se?Se.Nickname?Se.Nickname:`${Se.firstName} ${Se.lastName}`:"Anon",L=async()=>{try{const Se=D();if(!Se){H.log("UserProvider: No space ID found, skipping guest user creation");return}if(v&&v.guestSpaceId===Se){H.log("UserProvider: Guest user already exists for this space");return}const Ie=IF("guestUserCreate",Se);if(!Ie.allowed){H.warn("UserProvider: Guest user creation rate limited:",Ie.message),console.warn(Ie.message);return}try{const we=await mo(Se);if(!we){H.log("UserProvider: Space data not found, denying guest access");return}if(!we.allowGuestUsers){H.log("UserProvider: Guest users explicitly not allowed for this space");return}H.log("UserProvider: Guest users confirmed allowed for space:",Se)}catch{H.log("UserProvider: Cannot verify space guest settings, denying guest access for security");return}const Fe=DQ(Se);b(Fe),C.current=Fe,H.log("UserProvider: Created guest user:",Fe.username),W(Fe)}catch(Se){H.error("UserProvider: Error creating guest user:",Se)}},D=()=>{try{const Se=document.getElementById("webgl-root");if(Se){const be=Se.getAttribute("data-space-id");if(be)return H.log("UserProvider: Found space ID from webgl-root element:",be),be}const Ie=window.location.href,Fe=window.location.pathname,we=window.location.search;H.log("UserProvider: No space ID in DOM element, trying URL extraction"),H.log("UserProvider: URL:",Ie);const Re=Fe.match(/\/(w|embed)\/([^\/]+)/);if(Re)return H.log("UserProvider: Found space ID from path pattern:",Re[2]),Re[2];const Te=new URLSearchParams(we),Ne=Te.get("spaceId")||Te.get("space");return Ne?(H.log("UserProvider: Found space ID from URL params:",Ne),Ne):Ie.includes("localhost")||Ie.includes("web.app")||Ie.includes("firebaseapp.com")?(H.log("UserProvider: Using default space ID for development/hosting"),"SpacesMetaverse_SDK"):(H.log("UserProvider: No space ID found"),null)}catch(Se){return H.error("UserProvider: Error getting space ID:",Se),null}};k.useEffect(()=>{let Se=!0;const Ie=k3e(R,async we=>{var Re;if(H.log("UserProvider: Firebase onAuthStateChanged() fired"),we){const Te={uid:we.uid,email:we.email,emailVerified:we.emailVerified,displayName:((Re=we.email)==null?void 0:Re.split("@")[0])||"User"};Se&&(i(Te),o.current=Te,u(!1));try{const Ne=await Vc(we.uid);if(!Se)return;const be=O(Ne),xe={uid:we.uid,email:we.email,emailVerified:we.emailVerified,...Ne,displayName:be||Te.displayName};H.log(`UserProvider: User authenticated: ${we.uid}`),i(xe),o.current=xe,W(xe)}catch(Ne){H.warn("UserProvider: Profile fetch failed, using minimal user data:",Ne.message),Se&&W(Te)}}else{if(!Se)return;i(null),o.current=null,u(!1),L().catch(Te=>{H.error("UserProvider: Error creating guest user:",Te)})}}),Fe=we=>{H.log("UserProvider: Override settings updated, refreshing user data for Unity"),W()};return window.addEventListener("SpaceOverrideUpdated",Fe),()=>{Se=!1,Ie&&Ie(),window.removeEventListener("SpaceOverrideUpdated",Fe)}},[]);const U=async(Se,Ie,Fe)=>{try{y(!0),H.log("UserProvider: Starting registration process"),H.log("UserProvider: Registration includes fields:",Object.keys(Fe||{}).join(", "));const we={...Fe},Re=["firstName","lastName","username","companyName","linkedInProfile"],Te=Re.filter(ft=>!we[ft]);Te.length>0&&H.warn(`UserProvider: Registration missing fields: ${Te.join(", ")}`);const Ne=we.firstName&&we.lastName?`${we.firstName}${we.lastName.charAt(0).toUpperCase()}`:"";H.log("UserProvider: Generated default nickname for registration");const be={firstName:"",lastName:"",companyName:"",linkedInProfile:"",username:"",Nickname:we.Nickname||Ne,groups:["users"],rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",...we};H.log("UserProvider: Prepared registration data with fields:",Object.keys(be).join(", "));const xe=await TBe(Se,Ie,be);H.log("UserProvider: Registration successful, received user data");const je=Re.filter(ft=>!xe[ft]);je.length>0&&H.warn(`UserProvider: Returned user data missing fields: ${je.join(", ")}`),["firstName","lastName","Nickname","username","companyName"].forEach(ft=>{xe[ft]||(H.warn(`UserProvider: ${ft} is missing in returned data, using original value`),xe[ft]=be[ft])});const dt={uid:xe.uid,email:xe.email,...xe,displayName:O(xe)};return H.log("UserProvider: Created user object with fields:",Object.keys(dt).join(", ")),i(dt),o.current=dt,H.log("UserProvider: User registered successfully with groups:",be.groups),await new Promise(ft=>setTimeout(ft,2e3)),y(!1),dt}catch(we){throw y(!1),H.error("UserProvider: Error during registration:",we),we}},B=async(Se,Ie,Fe)=>{try{if(H.log("UserProvider: Signing in user"),!Fe)throw new Error("CAPTCHA verification is required");const Re=(await A3e(R,Se,Ie)).user;return H.log("UserProvider: User signed in successfully:",Re.uid),Re}catch(we){throw H.error("UserProvider: Error signing in:",we),we}},Y=async()=>{try{await N3e(R),i(null),H.log("UserProvider: User signed out.")}catch(Se){throw H.error("UserProvider: Error signing out:",Se),Se}},W=async(Se=null)=>{let Ie=Se||o.current||C.current;if(!Ie&&!Se&&(H.log("UserProvider: No user available, attempting to create guest user for Unity request"),await L(),Ie=C.current),Ie){const Fe=ne(Ie);try{const we=D();if(we){const Re=await mo(we);if(Re&&Re.Override&&Re.Override.enabled===!0)if(H.log("UserProvider: Override is enabled for space:",we),Re.Override.customPlayers&&Re.Override.customPlayers.length>0){const Te=Math.floor(Math.random()*Re.Override.customPlayers.length),Ne=Re.Override.customPlayers[Te].url;Ne&&(H.log("UserProvider: Applying Override RPM URL:",Ne),H.log("UserProvider: Original RPM URL was:",Fe.rpmURL),Fe.rpmURL=Ne)}else H.log("UserProvider: Override enabled but no custom player URLs configured")}}catch(we){H.error("UserProvider: Error checking Override settings, using original RPM URL:",we)}H.log("UserProvider: sendUserToUnity() - Raw user data:",{uid:Ie.uid,username:Ie.username,Nickname:Ie.Nickname,displayName:Ie.displayName,rpmURL:Ie.rpmURL,isGuest:Ie.isGuest||!1}),H.log("UserProvider: sendUserToUnity() - Filtered data being sent to Unity:",Fe),Ie.isGuest&&(H.log("UserProvider: GUEST USER - Verifying required fields:"),H.log("UserProvider: GUEST - Nickname in filtered data:",Fe.Nickname),H.log("UserProvider: GUEST - rpmURL in filtered data:",Fe.rpmURL),H.log("UserProvider: GUEST - uid in filtered data:",Fe.uid),(!Fe.Nickname||!Fe.rpmURL)&&(H.error("UserProvider: GUEST USER MISSING REQUIRED FIELDS!"),H.error("UserProvider: Missing Nickname:",!Fe.Nickname),H.error("UserProvider: Missing rpmURL:",!Fe.rpmURL))),mh.publish(fh.sendUserToUnity,Fe)}else H.log("UserProvider: No current user or guest user to send to Unity.")},ne=Se=>{const Ie={},Fe=[...ABe,"uid"];return H.log("UserProvider: Properties to send to Unity:",Fe),H.log("UserProvider: Available properties in user object:",Object.keys(Se)),Fe.forEach(we=>{Se.hasOwnProperty(we)?(Ie[we]=Se[we],H.log(`UserProvider: Including field '${we}' with value:`,Se[we])):H.log(`UserProvider: Field '${we}' not found in user object`)}),H.log("UserProvider: Final filtered user object:",Ie),Ie},le=async Se=>!e||!e.uid?!1:await GN(e.uid,Se),re=async Se=>{try{return!e||!e.uid?!1:e.groups&&e.groups.includes(`space_${Se}_banned`)?!0:(await Xo(_r(Xn,`spaces/${Se}/BannedUsers`,e.uid))).exists()}catch(Ie){return Ie.code!=="permission-denied"&&H.error("UserProvider: isUserBannedFromSpace error:",Ie),!1}},me=async Se=>{if(!e||!e.uid)return!1;try{if(await re(Se))return H.warn(`UserProvider: User ${e.uid} banned from ${Se}`),!1;const Ie=await mo(Se);if(Ie.usersAllowed.includes(e.uid)||Ie.userAdmin.includes(e.uid)||Ie.usersModerators.includes(e.uid))return!0;if(e.groups&&Array.isArray(e.groups)){const we=`space_${Se}_owners`,Re=`space_${Se}_hosts`;if(e.groups.includes(we)||e.groups.includes(Re))return H.log(`UserProvider: User ${e.uid} has access to space ${Se} as owner/host`),!0}return Ie.accessibleToAllUsers===!0&&e.groups?e.groups.includes("users"):!1}catch(Ie){return H.error("UserProvider: Error verifying user access to space:",Ie),!1}},q=async Se=>{if(!e||!e.uid)return!1;try{return(await mo(Se)).userAdmin.includes(e.uid)}catch(Ie){return H.error("UserProvider: Error verifying user admin status for space:",Ie),!1}},J=async Se=>{if(!e||!e.uid)return!1;try{return(await mo(Se)).usersModerators.includes(e.uid)}catch(Ie){return H.error("UserProvider: Error verifying user moderator status for space:",Ie),!1}},Q=async()=>{try{const Se=R.currentUser;return Se&&!Se.emailVerified?(await jie(Se),H.log("UserProvider: Verification email resent to user:",Se.uid),!0):!1}catch(Se){throw H.error("UserProvider: Error resending verification email:",Se),Se}},ie=async()=>{try{const Se=R.currentUser;if(!Se)return H.warn("UserProvider: updateUser called but no current user exists"),null;H.log("UserProvider: Updating user data from Firestore");const Ie=await Vc(Se.uid);if(!Ie)return H.error("UserProvider: Failed to fetch updated user profile"),null;const Fe=O(Ie),we={uid:Se.uid,email:Se.email,emailVerified:Se.emailVerified,...Ie,displayName:Fe};return H.log("UserProvider: User data updated with fields:",Object.keys(we).join(", ")),i(we),o.current=we,W(we),we}catch(Se){throw H.error("UserProvider: Error updating user data:",Se),Se}},pe=()=>e||v,de=async Se=>{try{const Ie=DQ(Se);return b(Ie),C.current=Ie,W(Ie),Ie}catch(Ie){throw H.error("UserProvider: Error creating manual guest user:",Ie),Ie}},he=()=>{b(null),C.current=null,H.log("UserProvider: Guest user cleared")};return S.jsx(oze.Provider,{value:{registrationInProgress:f},children:S.jsx(ls.Provider,{value:{user:e,guestUser:v,currentUser:pe(),loading:l,register:U,signIn:B,signOut:Y,sendUserToUnity:W,isUserInGroup:le,userHasAccessToSpace:me,userIsAdminOfSpace:q,userIsModeratorOfSpace:J,resendVerificationEmail:Q,updateUser:ie,isUserBannedFromSpace:re,createGuestUser:de,clearGuestUser:he,isGuestUser:Se=>sze(Se||pe())},children:n})})},tae=k.createContext(),vh=()=>k.useContext(tae),cze=({children:n})=>{const[e,i]=k.useState(!1),o=k.useRef(null),[l,u]=k.useState(!1);k.useEffect(()=>{const v=()=>{const b=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);u(b)};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const f=k.useCallback(v=>{o.current=v},[]),y=k.useCallback(()=>{const v=o.current;if(!v)return;const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){const C=v.querySelector("video")||v;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(C.webkitEnterFullscreen)try{C.webkitEnterFullscreen(),i(!0);return}catch(R){console.error("iOS fullscreen error:",R)}try{if(C.webkitRequestFullscreen){C.webkitRequestFullscreen(),i(!0);return}}catch(R){console.error("iOS fallback fullscreen error:",R)}}if(/Android/i.test(navigator.userAgent))try{b?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),i(!1)):(v.requestFullscreen?v.requestFullscreen():v.webkitRequestFullscreen?v.webkitRequestFullscreen():v.mozRequestFullScreen?v.mozRequestFullScreen():v.msRequestFullscreen&&v.msRequestFullscreen(),i(!0));return}catch(R){console.error("Android fullscreen error:",R)}}try{b?document.exitFullscreen?document.exitFullscreen().then(()=>{i(!1)}).catch(C=>console.error("Error exiting fullscreen:",C)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),i(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),i(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),i(!1)):v.requestFullscreen?v.requestFullscreen().then(()=>{i(!0)}).catch(C=>console.error("Error entering fullscreen:",C)):v.webkitRequestFullscreen?(v.webkitRequestFullscreen(),i(!0)):v.mozRequestFullScreen?(v.mozRequestFullScreen(),i(!0)):v.msRequestFullscreen&&(v.msRequestFullscreen(),i(!0))}catch(C){console.error("Fullscreen error:",C)}},[l]);return k.useEffect(()=>{const v=()=>{const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;i(!!b)};return document.addEventListener("fullscreenchange",v),document.addEventListener("webkitfullscreenchange",v),document.addEventListener("mozfullscreenchange",v),document.addEventListener("MSFullscreenChange",v),()=>{document.removeEventListener("fullscreenchange",v),document.removeEventListener("webkitfullscreenchange",v),document.removeEventListener("mozfullscreenchange",v),document.removeEventListener("MSFullscreenChange",v)}},[]),S.jsx(tae.Provider,{value:{isFullscreen:e,toggleFullscreen:y,fullscreenRef:o,setFullscreenRef:f,isMobile:l},children:S.jsx("div",{ref:f,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})};var eI=n=>n.type==="checkbox",xy=n=>n instanceof Date,xc=n=>n==null;const nae=n=>typeof n=="object";var No=n=>!xc(n)&&!Array.isArray(n)&&nae(n)&&!xy(n),lze=n=>No(n)&&n.target?eI(n.target)?n.target.checked:n.target.value:n,uze=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,dze=(n,e)=>n.has(uze(e)),hze=n=>{const e=n.constructor&&n.constructor.prototype;return No(e)&&e.hasOwnProperty("isPrototypeOf")},AF=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function ma(n){let e;const i=Array.isArray(n),o=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)e=new Date(n);else if(!(AF&&(n instanceof Blob||o))&&(i||No(n)))if(e=i?[]:Object.create(Object.getPrototypeOf(n)),!i&&!hze(n))e=n;else for(const l in n)n.hasOwnProperty(l)&&(e[l]=ma(n[l]));else return n;return e}var KN=n=>/^\w*$/.test(n),Ro=n=>n===void 0,PF=n=>Array.isArray(n)?n.filter(Boolean):[],OF=n=>PF(n.replace(/["|']|\]/g,"").split(/\.|\[/)),Tn=(n,e,i)=>{if(!e||!No(n))return i;const o=(KN(e)?[e]:OF(e)).reduce((l,u)=>xc(l)?l:l[u],n);return Ro(o)||o===n?Ro(n[e])?i:n[e]:o},yp=n=>typeof n=="boolean",ms=(n,e,i)=>{let o=-1;const l=KN(e)?[e]:OF(e),u=l.length,f=u-1;for(;++o<u;){const y=l[o];let v=i;if(o!==f){const b=n[y];v=No(b)||Array.isArray(b)?b:isNaN(+l[o+1])?{}:[]}if(y==="__proto__"||y==="constructor"||y==="prototype")return;n[y]=v,n=n[y]}};const LQ={BLUR:"blur",FOCUS_OUT:"focusout"},dh={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},If={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},pze=gi.createContext(null);pze.displayName="HookFormContext";var fze=(n,e,i,o=!0)=>{const l={defaultValues:e._defaultValues};for(const u in n)Object.defineProperty(l,u,{get:()=>{const f=u;return e._proxyFormState[f]!==dh.all&&(e._proxyFormState[f]=!o||dh.all),n[f]}});return l};const mze=typeof window<"u"?gi.useLayoutEffect:gi.useEffect;var lu=n=>typeof n=="string",gze=(n,e,i,o,l)=>lu(n)?(o&&e.watch.add(n),Tn(i,n,l)):Array.isArray(n)?n.map(u=>(o&&e.watch.add(u),Tn(i,u))):(o&&(e.watchAll=!0),i),I5=n=>xc(n)||!nae(n);function Cg(n,e,i=new WeakSet){if(I5(n)||I5(e))return n===e;if(xy(n)&&xy(e))return n.getTime()===e.getTime();const o=Object.keys(n),l=Object.keys(e);if(o.length!==l.length)return!1;if(i.has(n)||i.has(e))return!0;i.add(n),i.add(e);for(const u of o){const f=n[u];if(!l.includes(u))return!1;if(u!=="ref"){const y=e[u];if(xy(f)&&xy(y)||No(f)&&No(y)||Array.isArray(f)&&Array.isArray(y)?!Cg(f,y,i):f!==y)return!1}}return!0}var _ze=(n,e,i,o,l)=>e?{...i[n],types:{...i[n]&&i[n].types?i[n].types:{},[o]:l||!0}}:{},GC=n=>Array.isArray(n)?n:[n],MQ=()=>{let n=[];return{get observers(){return n},next:l=>{for(const u of n)u.next&&u.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(u=>u!==l)}}),unsubscribe:()=>{n=[]}}};function rae(n,e){const i={};for(const o in n)if(n.hasOwnProperty(o)){const l=n[o],u=e[o];if(l&&No(l)&&u){const f=rae(l,u);No(f)&&(i[o]=f)}else n[o]&&(i[o]=u)}return i}var _l=n=>No(n)&&!Object.keys(n).length,kF=n=>n.type==="file",hh=n=>typeof n=="function",Lk=n=>{if(!AF)return!1;const e=n?n.ownerDocument:0;return n instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},iae=n=>n.type==="select-multiple",NF=n=>n.type==="radio",yze=n=>NF(n)||eI(n),ZU=n=>Lk(n)&&n.isConnected;function Eze(n,e){const i=e.slice(0,-1).length;let o=0;for(;o<i;)n=Ro(n)?o++:n[e[o++]];return n}function vze(n){for(const e in n)if(n.hasOwnProperty(e)&&!Ro(n[e]))return!1;return!0}function To(n,e){const i=Array.isArray(e)?e:KN(e)?[e]:OF(e),o=i.length===1?n:Eze(n,i),l=i.length-1,u=i[l];return o&&delete o[u],l!==0&&(No(o)&&_l(o)||Array.isArray(o)&&vze(o))&&To(n,i.slice(0,-1)),n}var Sze=n=>{for(const e in n)if(hh(n[e]))return!0;return!1};function sae(n){return Array.isArray(n)||No(n)&&!Sze(n)}function A5(n,e={}){for(const i in n)sae(n[i])?(e[i]=Array.isArray(n[i])?[]:{},A5(n[i],e[i])):xc(n[i])||(e[i]=!0);return e}function U0(n,e,i){i||(i=A5(e));for(const o in n)sae(n[o])?Ro(e)||I5(i[o])?i[o]=A5(n[o],Array.isArray(n[o])?[]:{}):U0(n[o],xc(e)?{}:e[o],i[o]):i[o]=!Cg(n[o],e[o]);return i}const UQ={value:!1,isValid:!1},VQ={value:!0,isValid:!0};var oae=n=>{if(Array.isArray(n)){if(n.length>1){const e=n.filter(i=>i&&i.checked&&!i.disabled).map(i=>i.value);return{value:e,isValid:!!e.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!Ro(n[0].attributes.value)?Ro(n[0].value)||n[0].value===""?VQ:{value:n[0].value,isValid:!0}:VQ:UQ}return UQ},aae=(n,{valueAsNumber:e,valueAsDate:i,setValueAs:o})=>Ro(n)?n:e?n===""?NaN:n&&+n:i&&lu(n)?new Date(n):o?o(n):n;const jQ={isValid:!1,value:null};var cae=n=>Array.isArray(n)?n.reduce((e,i)=>i&&i.checked&&!i.disabled?{isValid:!0,value:i.value}:e,jQ):jQ;function FQ(n){const e=n.ref;return kF(e)?e.files:NF(e)?cae(n.refs).value:iae(e)?[...e.selectedOptions].map(({value:i})=>i):eI(e)?oae(n.refs).value:aae(Ro(e.value)?n.ref.value:e.value,n)}var bze=(n,e,i,o)=>{const l={};for(const u of n){const f=Tn(e,u);f&&ms(l,u,f._f)}return{criteriaMode:i,names:[...n],fields:l,shouldUseNativeValidation:o}},Mk=n=>n instanceof RegExp,JT=n=>Ro(n)?n:Mk(n)?n.source:No(n)?Mk(n.value)?n.value.source:n.value:n,BQ=n=>({isOnSubmit:!n||n===dh.onSubmit,isOnBlur:n===dh.onBlur,isOnChange:n===dh.onChange,isOnAll:n===dh.all,isOnTouch:n===dh.onTouched});const zQ="AsyncFunction";var wze=n=>!!n&&!!n.validate&&!!(hh(n.validate)&&n.validate.constructor.name===zQ||No(n.validate)&&Object.values(n.validate).find(e=>e.constructor.name===zQ)),Tze=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate),WQ=(n,e,i)=>!i&&(e.watchAll||e.watch.has(n)||[...e.watch].some(o=>n.startsWith(o)&&/^\.\w+/.test(n.slice(o.length))));const HC=(n,e,i,o)=>{for(const l of i||Object.keys(n)){const u=Tn(n,l);if(u){const{_f:f,...y}=u;if(f){if(f.refs&&f.refs[0]&&e(f.refs[0],l)&&!o)return!0;if(f.ref&&e(f.ref,f.name)&&!o)return!0;if(HC(y,e))break}else if(No(y)&&HC(y,e))break}}};function GQ(n,e,i){const o=Tn(n,i);if(o||KN(i))return{error:o,name:i};const l=i.split(".");for(;l.length;){const u=l.join("."),f=Tn(e,u),y=Tn(n,u);if(f&&!Array.isArray(f)&&i!==u)return{name:i};if(y&&y.type)return{name:u,error:y};if(y&&y.root&&y.root.type)return{name:`${u}.root`,error:y.root};l.pop()}return{name:i}}var Cze=(n,e,i,o)=>{i(n);const{name:l,...u}=n;return _l(u)||Object.keys(u).length>=Object.keys(e).length||Object.keys(u).find(f=>e[f]===(!o||dh.all))},Rze=(n,e,i)=>!n||!e||n===e||GC(n).some(o=>o&&(i?o===e:o.startsWith(e)||e.startsWith(o))),Ize=(n,e,i,o,l)=>l.isOnAll?!1:!i&&l.isOnTouch?!(e||n):(i?o.isOnBlur:l.isOnBlur)?!n:(i?o.isOnChange:l.isOnChange)?n:!0,Aze=(n,e)=>!PF(Tn(n,e)).length&&To(n,e),Pze=(n,e,i)=>{const o=GC(Tn(n,i));return ms(o,"root",e[i]),ms(n,i,o),n};function HQ(n,e,i="validate"){if(lu(n)||Array.isArray(n)&&n.every(lu)||yp(n)&&!n)return{type:i,message:lu(n)?n:"",ref:e}}var k0=n=>No(n)&&!Mk(n)?n:{value:n,message:""},$Q=async(n,e,i,o,l,u)=>{const{ref:f,refs:y,required:v,maxLength:b,minLength:C,min:R,max:O,pattern:L,validate:D,name:U,valueAsNumber:B,mount:Y}=n._f,W=Tn(i,U);if(!Y||e.has(U))return{};const ne=y?y[0]:f,le=de=>{l&&ne.reportValidity&&(ne.setCustomValidity(yp(de)?"":de||""),ne.reportValidity())},re={},me=NF(f),q=eI(f),J=me||q,Q=(B||kF(f))&&Ro(f.value)&&Ro(W)||Lk(f)&&f.value===""||W===""||Array.isArray(W)&&!W.length,ie=_ze.bind(null,U,o,re),pe=(de,he,Se,Ie=If.maxLength,Fe=If.minLength)=>{const we=de?he:Se;re[U]={type:de?Ie:Fe,message:we,ref:f,...ie(de?Ie:Fe,we)}};if(u?!Array.isArray(W)||!W.length:v&&(!J&&(Q||xc(W))||yp(W)&&!W||q&&!oae(y).isValid||me&&!cae(y).isValid)){const{value:de,message:he}=lu(v)?{value:!!v,message:v}:k0(v);if(de&&(re[U]={type:If.required,message:he,ref:ne,...ie(If.required,he)},!o))return le(he),re}if(!Q&&(!xc(R)||!xc(O))){let de,he;const Se=k0(O),Ie=k0(R);if(!xc(W)&&!isNaN(W)){const Fe=f.valueAsNumber||W&&+W;xc(Se.value)||(de=Fe>Se.value),xc(Ie.value)||(he=Fe<Ie.value)}else{const Fe=f.valueAsDate||new Date(W),we=Ne=>new Date(new Date().toDateString()+" "+Ne),Re=f.type=="time",Te=f.type=="week";lu(Se.value)&&W&&(de=Re?we(W)>we(Se.value):Te?W>Se.value:Fe>new Date(Se.value)),lu(Ie.value)&&W&&(he=Re?we(W)<we(Ie.value):Te?W<Ie.value:Fe<new Date(Ie.value))}if((de||he)&&(pe(!!de,Se.message,Ie.message,If.max,If.min),!o))return le(re[U].message),re}if((b||C)&&!Q&&(lu(W)||u&&Array.isArray(W))){const de=k0(b),he=k0(C),Se=!xc(de.value)&&W.length>+de.value,Ie=!xc(he.value)&&W.length<+he.value;if((Se||Ie)&&(pe(Se,de.message,he.message),!o))return le(re[U].message),re}if(L&&!Q&&lu(W)){const{value:de,message:he}=k0(L);if(Mk(de)&&!W.match(de)&&(re[U]={type:If.pattern,message:he,ref:f,...ie(If.pattern,he)},!o))return le(he),re}if(D){if(hh(D)){const de=await D(W,i),he=HQ(de,ne);if(he&&(re[U]={...he,...ie(If.validate,he.message)},!o))return le(he.message),re}else if(No(D)){let de={};for(const he in D){if(!_l(de)&&!o)break;const Se=HQ(await D[he](W,i),ne,he);Se&&(de={...Se,...ie(he,Se.message)},le(Se.message),o&&(re[U]=de))}if(!_l(de)&&(re[U]={ref:ne,...de},!o))return re}}return le(!0),re};const Oze={mode:dh.onSubmit,reValidateMode:dh.onChange,shouldFocusError:!0};function kze(n={}){let e={...Oze,...n},i={submitCount:0,isDirty:!1,isReady:!1,isLoading:hh(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},o={},l=No(e.defaultValues)||No(e.values)?ma(e.defaultValues||e.values)||{}:{},u=e.shouldUnregister?{}:ma(l),f={action:!1,mount:!1,watch:!1},y={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},v,b=0;const C={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let R={...C};const O={array:MQ(),state:MQ()},L=e.criteriaMode===dh.all,D=ve=>De=>{clearTimeout(b),b=setTimeout(ve,De)},U=async ve=>{if(!e.disabled&&(C.isValid||R.isValid||ve)){const De=e.resolver?_l((await q()).errors):await Q(o,!0);De!==i.isValid&&O.state.next({isValid:De})}},B=(ve,De)=>{!e.disabled&&(C.isValidating||C.validatingFields||R.isValidating||R.validatingFields)&&((ve||Array.from(y.mount)).forEach(Ke=>{Ke&&(De?ms(i.validatingFields,Ke,De):To(i.validatingFields,Ke))}),O.state.next({validatingFields:i.validatingFields,isValidating:!_l(i.validatingFields)}))},Y=(ve,De=[],Ke,Ot,Et=!0,Pt=!0)=>{if(Ot&&Ke&&!e.disabled){if(f.action=!0,Pt&&Array.isArray(Tn(o,ve))){const Ut=Ke(Tn(o,ve),Ot.argA,Ot.argB);Et&&ms(o,ve,Ut)}if(Pt&&Array.isArray(Tn(i.errors,ve))){const Ut=Ke(Tn(i.errors,ve),Ot.argA,Ot.argB);Et&&ms(i.errors,ve,Ut),Aze(i.errors,ve)}if((C.touchedFields||R.touchedFields)&&Pt&&Array.isArray(Tn(i.touchedFields,ve))){const Ut=Ke(Tn(i.touchedFields,ve),Ot.argA,Ot.argB);Et&&ms(i.touchedFields,ve,Ut)}(C.dirtyFields||R.dirtyFields)&&(i.dirtyFields=U0(l,u)),O.state.next({name:ve,isDirty:pe(ve,De),dirtyFields:i.dirtyFields,errors:i.errors,isValid:i.isValid})}else ms(u,ve,De)},W=(ve,De)=>{ms(i.errors,ve,De),O.state.next({errors:i.errors})},ne=ve=>{i.errors=ve,O.state.next({errors:i.errors,isValid:!1})},le=(ve,De,Ke,Ot)=>{const Et=Tn(o,ve);if(Et){const Pt=Tn(u,ve,Ro(Ke)?Tn(l,ve):Ke);Ro(Pt)||Ot&&Ot.defaultChecked||De?ms(u,ve,De?Pt:FQ(Et._f)):Se(ve,Pt),f.mount&&U()}},re=(ve,De,Ke,Ot,Et)=>{let Pt=!1,Ut=!1;const cn={name:ve};if(!e.disabled){if(!Ke||Ot){(C.isDirty||R.isDirty)&&(Ut=i.isDirty,i.isDirty=cn.isDirty=pe(),Pt=Ut!==cn.isDirty);const _t=Cg(Tn(l,ve),De);Ut=!!Tn(i.dirtyFields,ve),_t?To(i.dirtyFields,ve):ms(i.dirtyFields,ve,!0),cn.dirtyFields=i.dirtyFields,Pt=Pt||(C.dirtyFields||R.dirtyFields)&&Ut!==!_t}if(Ke){const _t=Tn(i.touchedFields,ve);_t||(ms(i.touchedFields,ve,Ke),cn.touchedFields=i.touchedFields,Pt=Pt||(C.touchedFields||R.touchedFields)&&_t!==Ke)}Pt&&Et&&O.state.next(cn)}return Pt?cn:{}},me=(ve,De,Ke,Ot)=>{const Et=Tn(i.errors,ve),Pt=(C.isValid||R.isValid)&&yp(De)&&i.isValid!==De;if(e.delayError&&Ke?(v=D(()=>W(ve,Ke)),v(e.delayError)):(clearTimeout(b),v=null,Ke?ms(i.errors,ve,Ke):To(i.errors,ve)),(Ke?!Cg(Et,Ke):Et)||!_l(Ot)||Pt){const Ut={...Ot,...Pt&&yp(De)?{isValid:De}:{},errors:i.errors,name:ve};i={...i,...Ut},O.state.next(Ut)}},q=async ve=>{B(ve,!0);const De=await e.resolver(u,e.context,bze(ve||y.mount,o,e.criteriaMode,e.shouldUseNativeValidation));return B(ve),De},J=async ve=>{const{errors:De}=await q(ve);if(ve)for(const Ke of ve){const Ot=Tn(De,Ke);Ot?ms(i.errors,Ke,Ot):To(i.errors,Ke)}else i.errors=De;return De},Q=async(ve,De,Ke={valid:!0})=>{for(const Ot in ve){const Et=ve[Ot];if(Et){const{_f:Pt,...Ut}=Et;if(Pt){const cn=y.array.has(Pt.name),_t=Et._f&&wze(Et._f);_t&&C.validatingFields&&B([Pt.name],!0);const wn=await $Q(Et,y.disabled,u,L,e.shouldUseNativeValidation&&!De,cn);if(_t&&C.validatingFields&&B([Pt.name]),wn[Pt.name]&&(Ke.valid=!1,De))break;!De&&(Tn(wn,Pt.name)?cn?Pze(i.errors,wn,Pt.name):ms(i.errors,Pt.name,wn[Pt.name]):To(i.errors,Pt.name))}!_l(Ut)&&await Q(Ut,De,Ke)}}return Ke.valid},ie=()=>{for(const ve of y.unMount){const De=Tn(o,ve);De&&(De._f.refs?De._f.refs.every(Ke=>!ZU(Ke)):!ZU(De._f.ref))&&lt(ve)}y.unMount=new Set},pe=(ve,De)=>!e.disabled&&(ve&&De&&ms(u,ve,De),!Cg(Ne(),l)),de=(ve,De,Ke)=>gze(ve,y,{...f.mount?u:Ro(De)?l:lu(ve)?{[ve]:De}:De},Ke,De),he=ve=>PF(Tn(f.mount?u:l,ve,e.shouldUnregister?Tn(l,ve,[]):[])),Se=(ve,De,Ke={})=>{const Ot=Tn(o,ve);let Et=De;if(Ot){const Pt=Ot._f;Pt&&(!Pt.disabled&&ms(u,ve,aae(De,Pt)),Et=Lk(Pt.ref)&&xc(De)?"":De,iae(Pt.ref)?[...Pt.ref.options].forEach(Ut=>Ut.selected=Et.includes(Ut.value)):Pt.refs?eI(Pt.ref)?Pt.refs.forEach(Ut=>{(!Ut.defaultChecked||!Ut.disabled)&&(Array.isArray(Et)?Ut.checked=!!Et.find(cn=>cn===Ut.value):Ut.checked=Et===Ut.value||!!Et)}):Pt.refs.forEach(Ut=>Ut.checked=Ut.value===Et):kF(Pt.ref)?Pt.ref.value="":(Pt.ref.value=Et,Pt.ref.type||O.state.next({name:ve,values:ma(u)})))}(Ke.shouldDirty||Ke.shouldTouch)&&re(ve,Et,Ke.shouldTouch,Ke.shouldDirty,!0),Ke.shouldValidate&&Te(ve)},Ie=(ve,De,Ke)=>{for(const Ot in De){if(!De.hasOwnProperty(Ot))return;const Et=De[Ot],Pt=ve+"."+Ot,Ut=Tn(o,Pt);(y.array.has(ve)||No(Et)||Ut&&!Ut._f)&&!xy(Et)?Ie(Pt,Et,Ke):Se(Pt,Et,Ke)}},Fe=(ve,De,Ke={})=>{const Ot=Tn(o,ve),Et=y.array.has(ve),Pt=ma(De);ms(u,ve,Pt),Et?(O.array.next({name:ve,values:ma(u)}),(C.isDirty||C.dirtyFields||R.isDirty||R.dirtyFields)&&Ke.shouldDirty&&O.state.next({name:ve,dirtyFields:U0(l,u),isDirty:pe(ve,Pt)})):Ot&&!Ot._f&&!xc(Pt)?Ie(ve,Pt,Ke):Se(ve,Pt,Ke),WQ(ve,y)&&O.state.next({...i,name:ve}),O.state.next({name:f.mount?ve:void 0,values:ma(u)})},we=async ve=>{f.mount=!0;const De=ve.target;let Ke=De.name,Ot=!0;const Et=Tn(o,Ke),Pt=_t=>{Ot=Number.isNaN(_t)||xy(_t)&&isNaN(_t.getTime())||Cg(_t,Tn(u,Ke,_t))},Ut=BQ(e.mode),cn=BQ(e.reValidateMode);if(Et){let _t,wn;const Nt=De.type?FQ(Et._f):lze(ve),Ht=ve.type===LQ.BLUR||ve.type===LQ.FOCUS_OUT,Lr=!Tze(Et._f)&&!e.resolver&&!Tn(i.errors,Ke)&&!Et._f.deps||Ize(Ht,Tn(i.touchedFields,Ke),i.isSubmitted,cn,Ut),wi=WQ(Ke,y,Ht);ms(u,Ke,Nt),Ht?(!De||!De.readOnly)&&(Et._f.onBlur&&Et._f.onBlur(ve),v&&v(0)):Et._f.onChange&&Et._f.onChange(ve);const ti=re(Ke,Nt,Ht),Vi=!_l(ti)||wi;if(!Ht&&O.state.next({name:Ke,type:ve.type,values:ma(u)}),Lr)return(C.isValid||R.isValid)&&(e.mode==="onBlur"?Ht&&U():Ht||U()),Vi&&O.state.next({name:Ke,...wi?{}:ti});if(!Ht&&wi&&O.state.next({...i}),e.resolver){const{errors:us}=await q([Ke]);if(Pt(Nt),Ot){const _o=GQ(i.errors,o,Ke),Wr=GQ(us,o,_o.name||Ke);_t=Wr.error,Ke=Wr.name,wn=_l(us)}}else B([Ke],!0),_t=(await $Q(Et,y.disabled,u,L,e.shouldUseNativeValidation))[Ke],B([Ke]),Pt(Nt),Ot&&(_t?wn=!1:(C.isValid||R.isValid)&&(wn=await Q(o,!0)));Ot&&(Et._f.deps&&(!Array.isArray(Et._f.deps)||Et._f.deps.length>0)&&Te(Et._f.deps),me(Ke,wn,_t,ti))}},Re=(ve,De)=>{if(Tn(i.errors,De)&&ve.focus)return ve.focus(),1},Te=async(ve,De={})=>{let Ke,Ot;const Et=GC(ve);if(e.resolver){const Pt=await J(Ro(ve)?ve:Et);Ke=_l(Pt),Ot=ve?!Et.some(Ut=>Tn(Pt,Ut)):Ke}else ve?(Ot=(await Promise.all(Et.map(async Pt=>{const Ut=Tn(o,Pt);return await Q(Ut&&Ut._f?{[Pt]:Ut}:Ut)}))).every(Boolean),!(!Ot&&!i.isValid)&&U()):Ot=Ke=await Q(o);return O.state.next({...!lu(ve)||(C.isValid||R.isValid)&&Ke!==i.isValid?{}:{name:ve},...e.resolver||!ve?{isValid:Ke}:{},errors:i.errors}),De.shouldFocus&&!Ot&&HC(o,Re,ve?Et:y.mount),Ot},Ne=(ve,De)=>{let Ke={...f.mount?u:l};return De&&(Ke=rae(De.dirtyFields?i.dirtyFields:i.touchedFields,Ke)),Ro(ve)?Ke:lu(ve)?Tn(Ke,ve):ve.map(Ot=>Tn(Ke,Ot))},be=(ve,De)=>({invalid:!!Tn((De||i).errors,ve),isDirty:!!Tn((De||i).dirtyFields,ve),error:Tn((De||i).errors,ve),isValidating:!!Tn(i.validatingFields,ve),isTouched:!!Tn((De||i).touchedFields,ve)}),xe=ve=>{ve&&GC(ve).forEach(De=>To(i.errors,De)),O.state.next({errors:ve?i.errors:{}})},je=(ve,De,Ke)=>{const Ot=(Tn(o,ve,{_f:{}})._f||{}).ref,Et=Tn(i.errors,ve)||{},{ref:Pt,message:Ut,type:cn,..._t}=Et;ms(i.errors,ve,{..._t,...De,ref:Ot}),O.state.next({name:ve,errors:i.errors,isValid:!1}),Ke&&Ke.shouldFocus&&Ot&&Ot.focus&&Ot.focus()},nt=(ve,De)=>hh(ve)?O.state.subscribe({next:Ke=>"values"in Ke&&ve(de(void 0,De),Ke)}):de(ve,De,!0),dt=ve=>O.state.subscribe({next:De=>{Rze(ve.name,De.name,ve.exact)&&Cze(De,ve.formState||C,jt,ve.reRenderRoot)&&ve.callback({values:{...u},...i,...De,defaultValues:l})}}).unsubscribe,ft=ve=>(f.mount=!0,R={...R,...ve.formState},dt({...ve,formState:R})),lt=(ve,De={})=>{for(const Ke of ve?GC(ve):y.mount)y.mount.delete(Ke),y.array.delete(Ke),De.keepValue||(To(o,Ke),To(u,Ke)),!De.keepError&&To(i.errors,Ke),!De.keepDirty&&To(i.dirtyFields,Ke),!De.keepTouched&&To(i.touchedFields,Ke),!De.keepIsValidating&&To(i.validatingFields,Ke),!e.shouldUnregister&&!De.keepDefaultValue&&To(l,Ke);O.state.next({values:ma(u)}),O.state.next({...i,...De.keepDirty?{isDirty:pe()}:{}}),!De.keepIsValid&&U()},gt=({disabled:ve,name:De})=>{(yp(ve)&&f.mount||ve||y.disabled.has(De))&&(ve?y.disabled.add(De):y.disabled.delete(De))},at=(ve,De={})=>{let Ke=Tn(o,ve);const Ot=yp(De.disabled)||yp(e.disabled);return ms(o,ve,{...Ke||{},_f:{...Ke&&Ke._f?Ke._f:{ref:{name:ve}},name:ve,mount:!0,...De}}),y.mount.add(ve),Ke?gt({disabled:yp(De.disabled)?De.disabled:e.disabled,name:ve}):le(ve,!0,De.value),{...Ot?{disabled:De.disabled||e.disabled}:{},...e.progressive?{required:!!De.required,min:JT(De.min),max:JT(De.max),minLength:JT(De.minLength),maxLength:JT(De.maxLength),pattern:JT(De.pattern)}:{},name:ve,onChange:we,onBlur:we,ref:Et=>{if(Et){at(ve,De),Ke=Tn(o,ve);const Pt=Ro(Et.value)&&Et.querySelectorAll&&Et.querySelectorAll("input,select,textarea")[0]||Et,Ut=yze(Pt),cn=Ke._f.refs||[];if(Ut?cn.find(_t=>_t===Pt):Pt===Ke._f.ref)return;ms(o,ve,{_f:{...Ke._f,...Ut?{refs:[...cn.filter(ZU),Pt,...Array.isArray(Tn(l,ve))?[{}]:[]],ref:{type:Pt.type,name:ve}}:{ref:Pt}}}),le(ve,!1,void 0,Pt)}else Ke=Tn(o,ve,{}),Ke._f&&(Ke._f.mount=!1),(e.shouldUnregister||De.shouldUnregister)&&!(dze(y.array,ve)&&f.action)&&y.unMount.add(ve)}}},Ct=()=>e.shouldFocusError&&HC(o,Re,y.mount),En=ve=>{yp(ve)&&(O.state.next({disabled:ve}),HC(o,(De,Ke)=>{const Ot=Tn(o,Ke);Ot&&(De.disabled=Ot._f.disabled||ve,Array.isArray(Ot._f.refs)&&Ot._f.refs.forEach(Et=>{Et.disabled=Ot._f.disabled||ve}))},0,!1))},Gt=(ve,De)=>async Ke=>{let Ot;Ke&&(Ke.preventDefault&&Ke.preventDefault(),Ke.persist&&Ke.persist());let Et=ma(u);if(O.state.next({isSubmitting:!0}),e.resolver){const{errors:Pt,values:Ut}=await q();i.errors=Pt,Et=ma(Ut)}else await Q(o);if(y.disabled.size)for(const Pt of y.disabled)To(Et,Pt);if(To(i.errors,"root"),_l(i.errors)){O.state.next({errors:{}});try{await ve(Et,Ke)}catch(Pt){Ot=Pt}}else De&&await De({...i.errors},Ke),Ct(),setTimeout(Ct);if(O.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:_l(i.errors)&&!Ot,submitCount:i.submitCount+1,errors:i.errors}),Ot)throw Ot},Xt=(ve,De={})=>{Tn(o,ve)&&(Ro(De.defaultValue)?Fe(ve,ma(Tn(l,ve))):(Fe(ve,De.defaultValue),ms(l,ve,ma(De.defaultValue))),De.keepTouched||To(i.touchedFields,ve),De.keepDirty||(To(i.dirtyFields,ve),i.isDirty=De.defaultValue?pe(ve,ma(Tn(l,ve))):pe()),De.keepError||(To(i.errors,ve),C.isValid&&U()),O.state.next({...i}))},st=(ve,De={})=>{const Ke=ve?ma(ve):l,Ot=ma(Ke),Et=_l(ve),Pt=Et?l:Ot;if(De.keepDefaultValues||(l=Ke),!De.keepValues){if(De.keepDirtyValues){const Ut=new Set([...y.mount,...Object.keys(U0(l,u))]);for(const cn of Array.from(Ut))Tn(i.dirtyFields,cn)?ms(Pt,cn,Tn(u,cn)):Fe(cn,Tn(Pt,cn))}else{if(AF&&Ro(ve))for(const Ut of y.mount){const cn=Tn(o,Ut);if(cn&&cn._f){const _t=Array.isArray(cn._f.refs)?cn._f.refs[0]:cn._f.ref;if(Lk(_t)){const wn=_t.closest("form");if(wn){wn.reset();break}}}}if(De.keepFieldsRef)for(const Ut of y.mount)Fe(Ut,Tn(Pt,Ut));else o={}}u=e.shouldUnregister?De.keepDefaultValues?ma(l):{}:ma(Pt),O.array.next({values:{...Pt}}),O.state.next({values:{...Pt}})}y={mount:De.keepDirtyValues?y.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},f.mount=!C.isValid||!!De.keepIsValid||!!De.keepDirtyValues,f.watch=!!e.shouldUnregister,O.state.next({submitCount:De.keepSubmitCount?i.submitCount:0,isDirty:Et?!1:De.keepDirty?i.isDirty:!!(De.keepDefaultValues&&!Cg(ve,l)),isSubmitted:De.keepIsSubmitted?i.isSubmitted:!1,dirtyFields:Et?{}:De.keepDirtyValues?De.keepDefaultValues&&u?U0(l,u):i.dirtyFields:De.keepDefaultValues&&ve?U0(l,ve):De.keepDirty?i.dirtyFields:{},touchedFields:De.keepTouched?i.touchedFields:{},errors:De.keepErrors?i.errors:{},isSubmitSuccessful:De.keepIsSubmitSuccessful?i.isSubmitSuccessful:!1,isSubmitting:!1,defaultValues:l})},hn=(ve,De)=>st(hh(ve)?ve(u):ve,De),an=(ve,De={})=>{const Ke=Tn(o,ve),Ot=Ke&&Ke._f;if(Ot){const Et=Ot.refs?Ot.refs[0]:Ot.ref;Et.focus&&(Et.focus(),De.shouldSelect&&hh(Et.select)&&Et.select())}},jt=ve=>{i={...i,...ve}},St={control:{register:at,unregister:lt,getFieldState:be,handleSubmit:Gt,setError:je,_subscribe:dt,_runSchema:q,_focusError:Ct,_getWatch:de,_getDirty:pe,_setValid:U,_setFieldArray:Y,_setDisabledField:gt,_setErrors:ne,_getFieldArray:he,_reset:st,_resetDefaultValues:()=>hh(e.defaultValues)&&e.defaultValues().then(ve=>{hn(ve,e.resetOptions),O.state.next({isLoading:!1})}),_removeUnmounted:ie,_disableForm:En,_subjects:O,_proxyFormState:C,get _fields(){return o},get _formValues(){return u},get _state(){return f},set _state(ve){f=ve},get _defaultValues(){return l},get _names(){return y},set _names(ve){y=ve},get _formState(){return i},get _options(){return e},set _options(ve){e={...e,...ve}}},subscribe:ft,trigger:Te,register:at,handleSubmit:Gt,watch:nt,setValue:Fe,getValues:Ne,reset:hn,resetField:Xt,clearErrors:xe,unregister:lt,setError:je,setFocus:an,getFieldState:be};return{...St,formControl:St}}function lae(n={}){const e=gi.useRef(void 0),i=gi.useRef(void 0),[o,l]=gi.useState({isDirty:!1,isValidating:!1,isLoading:hh(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,isReady:!1,defaultValues:hh(n.defaultValues)?void 0:n.defaultValues});if(!e.current)if(n.formControl)e.current={...n.formControl,formState:o},n.defaultValues&&!hh(n.defaultValues)&&n.formControl.reset(n.defaultValues,n.resetOptions);else{const{formControl:f,...y}=kze(n);e.current={...y,formState:o}}const u=e.current.control;return u._options=n,mze(()=>{const f=u._subscribe({formState:u._proxyFormState,callback:()=>l({...u._formState}),reRenderRoot:!0});return l(y=>({...y,isReady:!0})),u._formState.isReady=!0,f},[u]),gi.useEffect(()=>u._disableForm(n.disabled),[u,n.disabled]),gi.useEffect(()=>{n.mode&&(u._options.mode=n.mode),n.reValidateMode&&(u._options.reValidateMode=n.reValidateMode)},[u,n.mode,n.reValidateMode]),gi.useEffect(()=>{n.errors&&(u._setErrors(n.errors),u._focusError())},[u,n.errors]),gi.useEffect(()=>{n.shouldUnregister&&u._subjects.state.next({values:u._getWatch()})},[u,n.shouldUnregister]),gi.useEffect(()=>{if(u._proxyFormState.isDirty){const f=u._getDirty();f!==o.isDirty&&u._subjects.state.next({isDirty:f})}},[u,o.isDirty]),gi.useEffect(()=>{n.values&&!Cg(n.values,i.current)?(u._reset(n.values,{keepFieldsRef:!0,...u._options.resetOptions}),i.current=n.values,l(f=>({...f}))):u._resetDefaultValues()},[u,n.values]),gi.useEffect(()=>{u._state.mount||(u._setValid(),u._state.mount=!0),u._state.watch&&(u._state.watch=!1,u._subjects.state.next({...u._formState})),u._removeUnmounted()}),e.current.formState=fze(o,u),e.current}var Nze=["sitekey","onChange","theme","type","tabindex","onExpired","onErrored","size","stoken","grecaptcha","badge","hl","isolated"];function P5(){return P5=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},P5.apply(this,arguments)}function xze(n,e){if(n==null)return{};var i={},o=Object.keys(n),l,u;for(u=0;u<o.length;u++)l=o[u],!(e.indexOf(l)>=0)&&(i[l]=n[l]);return i}function dO(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Dze(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,O5(n,e)}function O5(n,e){return O5=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,l){return o.__proto__=l,o},O5(n,e)}var qN=(function(n){Dze(e,n);function e(){var o;return o=n.call(this)||this,o.handleExpired=o.handleExpired.bind(dO(o)),o.handleErrored=o.handleErrored.bind(dO(o)),o.handleChange=o.handleChange.bind(dO(o)),o.handleRecaptchaRef=o.handleRecaptchaRef.bind(dO(o)),o}var i=e.prototype;return i.getCaptchaFunction=function(l){return this.props.grecaptcha?this.props.grecaptcha.enterprise?this.props.grecaptcha.enterprise[l]:this.props.grecaptcha[l]:null},i.getValue=function(){var l=this.getCaptchaFunction("getResponse");return l&&this._widgetId!==void 0?l(this._widgetId):null},i.getWidgetId=function(){return this.props.grecaptcha&&this._widgetId!==void 0?this._widgetId:null},i.execute=function(){var l=this.getCaptchaFunction("execute");if(l&&this._widgetId!==void 0)return l(this._widgetId);this._executeRequested=!0},i.executeAsync=function(){var l=this;return new Promise(function(u,f){l.executionResolve=u,l.executionReject=f,l.execute()})},i.reset=function(){var l=this.getCaptchaFunction("reset");l&&this._widgetId!==void 0&&l(this._widgetId)},i.forceReset=function(){var l=this.getCaptchaFunction("reset");l&&l()},i.handleExpired=function(){this.props.onExpired?this.props.onExpired():this.handleChange(null)},i.handleErrored=function(){this.props.onErrored&&this.props.onErrored(),this.executionReject&&(this.executionReject(),delete this.executionResolve,delete this.executionReject)},i.handleChange=function(l){this.props.onChange&&this.props.onChange(l),this.executionResolve&&(this.executionResolve(l),delete this.executionReject,delete this.executionResolve)},i.explicitRender=function(){var l=this.getCaptchaFunction("render");if(l&&this._widgetId===void 0){var u=document.createElement("div");this._widgetId=l(u,{sitekey:this.props.sitekey,callback:this.handleChange,theme:this.props.theme,type:this.props.type,tabindex:this.props.tabindex,"expired-callback":this.handleExpired,"error-callback":this.handleErrored,size:this.props.size,stoken:this.props.stoken,hl:this.props.hl,badge:this.props.badge,isolated:this.props.isolated}),this.captcha.appendChild(u)}this._executeRequested&&this.props.grecaptcha&&this._widgetId!==void 0&&(this._executeRequested=!1,this.execute())},i.componentDidMount=function(){this.explicitRender()},i.componentDidUpdate=function(){this.explicitRender()},i.handleRecaptchaRef=function(l){this.captcha=l},i.render=function(){var l=this.props;l.sitekey,l.onChange,l.theme,l.type,l.tabindex,l.onExpired,l.onErrored,l.size,l.stoken,l.grecaptcha,l.badge,l.hl,l.isolated;var u=xze(l,Nze);return k.createElement("div",P5({},u,{ref:this.handleRecaptchaRef}))},e})(k.Component);qN.displayName="ReCAPTCHA";qN.propTypes={sitekey:Nn.string.isRequired,onChange:Nn.func,grecaptcha:Nn.object,theme:Nn.oneOf(["dark","light"]),type:Nn.oneOf(["image","audio"]),tabindex:Nn.number,onExpired:Nn.func,onErrored:Nn.func,size:Nn.oneOf(["compact","normal","invisible"]),stoken:Nn.string,hl:Nn.string,badge:Nn.oneOf(["bottomright","bottomleft","inline"]),isolated:Nn.bool};qN.defaultProps={onChange:function(){},theme:"light",type:"image",tabindex:0,size:"normal",badge:"bottomright"};function k5(){return k5=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},k5.apply(this,arguments)}function Lze(n,e){if(n==null)return{};var i={},o=Object.keys(n),l,u;for(u=0;u<o.length;u++)l=o[u],!(e.indexOf(l)>=0)&&(i[l]=n[l]);return i}function Mze(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}var ah={},Uze=0;function Vze(n,e){return e=e||{},function(o){var l=o.displayName||o.name||"Component",u=(function(y){Mze(v,y);function v(C,R){var O;return O=y.call(this,C,R)||this,O.state={},O.__scriptURL="",O}var b=v.prototype;return b.asyncScriptLoaderGetScriptLoaderID=function(){return this.__scriptLoaderID||(this.__scriptLoaderID="async-script-loader-"+Uze++),this.__scriptLoaderID},b.setupScriptURL=function(){return this.__scriptURL=typeof n=="function"?n():n,this.__scriptURL},b.asyncScriptLoaderHandleLoad=function(R){var O=this;this.setState(R,function(){return O.props.asyncScriptOnLoad&&O.props.asyncScriptOnLoad(O.state)})},b.asyncScriptLoaderTriggerOnScriptLoaded=function(){var R=ah[this.__scriptURL];if(!R||!R.loaded)throw new Error("Script is not loaded.");for(var O in R.observers)R.observers[O](R);delete window[e.callbackName]},b.componentDidMount=function(){var R=this,O=this.setupScriptURL(),L=this.asyncScriptLoaderGetScriptLoaderID(),D=e,U=D.globalName,B=D.callbackName,Y=D.scriptId;if(U&&typeof window[U]<"u"&&(ah[O]={loaded:!0,observers:{}}),ah[O]){var W=ah[O];if(W&&(W.loaded||W.errored)){this.asyncScriptLoaderHandleLoad(W);return}W.observers[L]=function(q){return R.asyncScriptLoaderHandleLoad(q)};return}var ne={};ne[L]=function(q){return R.asyncScriptLoaderHandleLoad(q)},ah[O]={loaded:!1,observers:ne};var le=document.createElement("script");le.src=O,le.async=!0;for(var re in e.attributes)le.setAttribute(re,e.attributes[re]);Y&&(le.id=Y);var me=function(J){if(ah[O]){var Q=ah[O],ie=Q.observers;for(var pe in ie)J(ie[pe])&&delete ie[pe]}};B&&typeof window<"u"&&(window[B]=function(){return R.asyncScriptLoaderTriggerOnScriptLoaded()}),le.onload=function(){var q=ah[O];q&&(q.loaded=!0,me(function(J){return B?!1:(J(q),!0)}))},le.onerror=function(){var q=ah[O];q&&(q.errored=!0,me(function(J){return J(q),!0}))},document.body.appendChild(le)},b.componentWillUnmount=function(){var R=this.__scriptURL;if(e.removeOnUnmount===!0)for(var O=document.getElementsByTagName("script"),L=0;L<O.length;L+=1)O[L].src.indexOf(R)>-1&&O[L].parentNode&&O[L].parentNode.removeChild(O[L]);var D=ah[R];D&&(delete D.observers[this.asyncScriptLoaderGetScriptLoaderID()],e.removeOnUnmount===!0&&delete ah[R])},b.render=function(){var R=e.globalName,O=this.props;O.asyncScriptOnLoad;var L=O.forwardedRef,D=Lze(O,["asyncScriptOnLoad","forwardedRef"]);return R&&typeof window<"u"&&(D[R]=typeof window[R]<"u"?window[R]:void 0),D.ref=L,k.createElement(o,D)},v})(k.Component),f=k.forwardRef(function(y,v){return k.createElement(u,k5({},y,{forwardedRef:v}))});return f.displayName="AsyncScriptLoader("+l+")",f.propTypes={asyncScriptOnLoad:Nn.func},HIe(f,o)}}var N5="onloadcallback",jze="grecaptcha";function x5(){return typeof window<"u"&&window.recaptchaOptions||{}}function Fze(){var n=x5(),e=n.useRecaptchaNet?"recaptcha.net":"www.google.com";return n.enterprise?"https://"+e+"/recaptcha/enterprise.js?onload="+N5+"&render=explicit":"https://"+e+"/recaptcha/api.js?onload="+N5+"&render=explicit"}const uae=Vze(Fze,{callbackName:N5,globalName:jze,attributes:x5().nonce?{nonce:x5().nonce}:{}})(qN),YN=(n,e="generic-modal")=>{k.useEffect(()=>{if(!window.unityInstance)return;const i=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),H.log(`Unity input disabled for ${e}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=e}catch(l){H.error(`Failed to disable Unity input for ${e}:`,l)}},o=()=>{try{window.unityInputDisabledBy===e?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),H.log(`Unity input re-enabled (was disabled by ${e})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):H.log(`Not re-enabling Unity input for ${e} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){H.error(`Failed to enable Unity input for ${e}:`,l)}};return n?i():o(),()=>{n&&o()}},[n,e])},dae=({isOpen:n,onClose:e,userData:i,onConfirm:o,fullscreenRef:l})=>{const[u,f]=k.useState((i==null?void 0:i.username)||""),[y,v]=k.useState((i==null?void 0:i.Nickname)||""),[b,C]=k.useState(!1),[R,O]=k.useState(null),[L,D]=k.useState(!1),U=Ea(),B=le=>!(!le||le.trim()===""||!/^[a-z0-9]{1,15}$/.test(le)),Y=async le=>{var re,me;if(!B(le))return!le||le.trim()===""?O("Username cannot be empty"):O("Username must be 1-15 characters, lowercase letters and numbers only"),!1;C(!0),O(null);try{let q=!1,J=0;const Q=3;for(;J<Q;)try{q=await Doe(le);break}catch(ie){if(H.error(`Attempt ${J+1}: Error checking username:`,ie),J++,J>=Q)throw ie;await new Promise(pe=>setTimeout(pe,1e3))}return q?(O("Username is already taken"),!1):!0}catch(q){return H.error("Error checking username after retries:",q),q.code==="permission-denied"||(re=q.message)!=null&&re.includes("permissions")?O("Username check unavailable. Please try again or pick a unique name."):O("Error checking username availability. Please try again."),q.code==="permission-denied"||((me=q.message)==null?void 0:me.includes("permissions"))}finally{C(!1)}};k.useEffect(()=>{if(!u){O("Username cannot be empty");return}if(u!==(i==null?void 0:i.username)){const le=setTimeout(async()=>{await Y(u)},500);return()=>clearTimeout(le)}},[u]),k.useEffect(()=>{if(i&&i.firstName&&i.lastName){const le=`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`;v(le)}},[i]);const W=async()=>{D(!0);try{if(!await Y(u)){D(!1);return}if(y.length>15){O("Display Name must be at most 15 characters"),D(!1);return}SC(y),H.log("UsernameConfirmation: Preparing to confirm user registration");const re=i.firstName&&i.lastName?`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`:"",me={...i,firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:u,Nickname:y||re,email:i.email,password:i.password};H.log("UsernameConfirmation: Processed registration data with fields:",Object.keys(me).join(", ")),await o(me),e()}catch(le){H.error("Error during username confirmation:",le),U({title:"Error",description:"An error occurred. Please try again.",status:"error",duration:3e3,isClosable:!0})}finally{D(!1)}},ne=()=>{L||e()};return S.jsxs(Is,{isOpen:n,onClose:ne,size:"md",portalProps:{containerRef:l},isCentered:!0,motionPreset:"slideInBottom",closeOnOverlayClick:!L,closeOnEsc:!L,children:[S.jsx(Os,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsxs(As,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",children:[S.jsxs(Jo,{children:[S.jsx(fR,{size:"lg",mb:2,children:"Customize Your Profile"}),S.jsx(qe,{fontSize:"sm",color:"gray.400",children:"Set your username and nickname"})]}),S.jsx($s,{color:"gray.400",isDisabled:L}),S.jsx(Ps,{children:S.jsxs(hr,{spacing:6,align:"stretch",children:[S.jsxs(Br,{isInvalid:!!R,children:[S.jsx(os,{children:"Username"}),S.jsxs(Ag,{children:[S.jsx(cj,{bg:"gray.700",color:"gray.400",border:"none",children:"@"}),S.jsx(Li,{placeholder:"username",value:u,onChange:le=>f(le.target.value.toLowerCase()),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15})]}),R?S.jsx(Sp,{children:R}):S.jsx(aS,{color:"gray.400",children:"Lowercase letters and numbers only, max 15 characters"})]}),S.jsxs(Br,{children:[S.jsx(os,{children:"Nickname"}),S.jsx(Li,{placeholder:"Nickname",value:y,onChange:le=>v(le.target.value),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15}),S.jsx(aS,{color:"gray.400",children:"This is the name shown to others, max 15 characters"})]})]})}),S.jsx(gh,{children:S.jsxs(Mi,{gap:3,width:"100%",children:[S.jsx($n,{variant:"outline",onClick:ne,flex:"1",isDisabled:L,children:"Back"}),S.jsx($n,{colorScheme:"blue",onClick:W,isLoading:L||b,isDisabled:!!R||!u||L,flex:"2",children:"Finish"})]})})]})]})};dae.propTypes={isOpen:Nn.bool.isRequired,onClose:Nn.func.isRequired,userData:Nn.object.isRequired,onConfirm:Nn.func.isRequired,fullscreenRef:Nn.object};const Bze="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function xF({mode:n,label:e,buttonProps:i={},isOpen:o,onClose:l}){const{register:u,handleSubmit:f,formState:{errors:y}}=lae(),{register:v}=k.useContext(ls),b=Ea(),{fullscreenRef:C}=vh(),[R,O]=k.useState(!1),[L,D]=k.useState(!1),[U,B]=k.useState(null),Y=k.useRef(null),[W,ne]=k.useState(!1),[le,re]=k.useState(null),[me,q]=k.useState(!1),J=o!==void 0?o:R,Q=l||(()=>O(!1));YN(J||W),k.useEffect(()=>{!J&&Y.current&&(Y.current.reset(),B(null))},[J]);const ie=Ie=>{B(Ie)},pe=async Ie=>{H.log("Register.jsx: Processing registration form submission");const{email:Fe,password:we,confirmPassword:Re,...Te}=Ie;if(H.log("Register.jsx: Registration data fields:",Object.keys(Te).join(", ")),!U){b({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}if(we!==Re){b({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}SC(Te.firstName),SC(Te.lastName),SC(Te.companyName),D(!0);try{const Ne=await wBe(Te.firstName||"",Te.lastName||""),be=Te.firstName&&Te.lastName?`${Te.firstName}${Te.lastName.charAt(0).toUpperCase()}`:"";be&&SC(be),H.log("Register.jsx: Generated username and nickname for new user");const xe={...Te,firstName:Te.firstName||"",lastName:Te.lastName||"",companyName:Te.companyName||"",linkedInProfile:Te.linkedInProfile||"",email:Fe,password:we,username:Ne,Nickname:be,captchaToken:U};H.log("Register.jsx: Prepared registration data with fields:",Object.keys(xe).join(", ")),re(xe),ne(!0)}catch(Ne){H.error("User: Registration Error:",Ne);let be="An error occurred during registration. Please try again.",xe=!1;Ne.code==="auth/email-already-in-use"?(be="This email address is already registered. Please sign in instead.",xe=!0):Ne.code==="auth/invalid-email"?be="The email address is not valid. Please check and try again.":Ne.code==="auth/weak-password"?be="The password is too weak. Please choose a stronger password.":Ne.message&&(be=Ne.message),b({title:"Registration Failed",description:S.jsxs(S.Fragment,{children:[be,xe&&S.jsx(qe,{mt:2,children:S.jsx(uu,{color:"blue.400",onClick:()=>{Q(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Go to Sign In"})})]}),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{D(!1),Y.current&&Y.current.reset()}},de=async Ie=>{D(!0);try{H.log("Register.jsx: Completing registration with confirmed username");const{email:Fe,password:we,...Re}=Ie,Te={...Re,firstName:Re.firstName||"",lastName:Re.lastName||"",companyName:Re.companyName||"",linkedInProfile:Re.linkedInProfile||"",username:Re.username||"",Nickname:Re.Nickname||""};H.log("Register.jsx: Final registration data includes fields:",Object.keys(Te).join(", "));const Ne=await v(Fe,we,Te);Q(),ne(!1),H.log("User: Registration process complete."),b({title:"Registration Successful",description:"Please check your email for a verification link. You'll need to verify your email before signing in.",status:"success",duration:8e3,isClosable:!0,position:"top"}),re(null),q(!1)}catch(Fe){H.error("User: Registration Error during final step:",Fe);let we="An error occurred during registration. Please try again.";Fe.code==="auth/email-already-in-use"?we="This email address is already in use. Please try another one.":Fe.message&&(we=Fe.message),b({title:"Registration Failed",description:we,status:"error",duration:5e3,isClosable:!0,position:"top"}),ne(!1),re(null),q(!1)}finally{D(!1)}},he=()=>{l?l():O(!R)},Se=n==="link"?S.jsx(uu,{variant:"header",onClick:he,children:e}):S.jsx($n,{onClick:he,...i,children:e});return S.jsxs(S.Fragment,{children:[!o&&Se,S.jsxs(Is,{isOpen:J&&!W,onClose:Q,size:"md",portalProps:{containerRef:C},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[S.jsx(Os,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsxs(As,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:Ie=>{Ie.stopPropagation()},children:[S.jsxs(Jo,{p:8,textAlign:"center",children:[S.jsx(fR,{size:"lg",mb:2,color:"white",children:"Create Account"}),S.jsx(qe,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),S.jsx($s,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(Ps,{px:8,children:S.jsx("form",{onSubmit:f(pe),children:S.jsxs(hr,{spacing:4,children:[S.jsxs(Br,{isInvalid:y.companyName,isRequired:!0,children:[S.jsx(Li,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("companyName",{required:"Company name is required",setValueAs:Ie=>Ie===""?"":Ie})}),S.jsx(Sp,{children:y.companyName&&y.companyName.message})]}),S.jsxs(Mi,{gap:4,w:"100%",children:[S.jsxs(Br,{isInvalid:y.firstName,isRequired:!0,children:[S.jsx(Li,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("firstName",{required:"First name is required",setValueAs:Ie=>Ie===""?"":Ie})}),S.jsx(Sp,{children:y.firstName&&y.firstName.message})]}),S.jsxs(Br,{isInvalid:y.lastName,isRequired:!0,children:[S.jsx(Li,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("lastName",{required:"Last name is required",setValueAs:Ie=>Ie===""?"":Ie})}),S.jsx(Sp,{children:y.lastName&&y.lastName.message})]})]}),S.jsxs(Br,{isInvalid:y.email,isRequired:!0,children:[S.jsx(Li,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),S.jsx(Sp,{children:y.email&&y.email.message})]}),S.jsxs(Mi,{gap:4,w:"100%",children:[S.jsxs(Br,{isInvalid:y.password,isRequired:!0,children:[S.jsx(Li,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),S.jsx(Sp,{children:y.password&&y.password.message})]}),S.jsxs(Br,{isInvalid:y.confirmPassword,isRequired:!0,children:[S.jsx(Li,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("confirmPassword",{required:"Confirm password is required"})}),S.jsx(Sp,{children:y.confirmPassword&&y.confirmPassword.message})]})]}),S.jsx(Br,{children:S.jsx(Li,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...u("linkedInProfile",{setValueAs:Ie=>Ie===""?"":Ie})})}),S.jsx($e,{width:"100%",display:"flex",justifyContent:"center",my:4,children:S.jsx(uae,{ref:Y,sitekey:Bze,onChange:ie,theme:"dark"})})]})})}),S.jsxs(gh,{px:8,pb:8,flexDirection:"column",gap:4,children:[S.jsx($n,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:f(pe),isLoading:L,loadingText:"Processing",isDisabled:!U,children:"Next: Set Your Username"}),S.jsxs(qe,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",S.jsx(uu,{color:"blue.400",onClick:()=>{Q(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]}),W&&S.jsx(dae,{isOpen:W,onClose:()=>ne(!1),userData:le,onConfirm:de,fullscreenRef:C,isRegistering:me})]})}xF.propTypes={mode:Nn.oneOf(["button","link"]),label:Nn.string,buttonProps:Nn.object,isOpen:Nn.bool,onClose:Nn.func};const zze=Wp({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),Wze=Wp({viewBox:"0 0 14 14",d:"M14,7.77 L14,6.17 L12.06,5.53 L11.61,4.44 L12.49,2.6 L11.36,1.47 L9.55,2.38 L8.46,1.93 L7.77,0.01 L6.17,0.01 L5.54,1.95 L4.43,2.4 L2.59,1.52 L1.46,2.65 L2.37,4.46 L1.92,5.55 L0,6.23 L0,7.82 L1.94,8.46 L2.39,9.55 L1.51,11.39 L2.64,12.52 L4.45,11.61 L5.54,12.06 L6.23,13.98 L7.82,13.98 L8.45,12.04 L9.56,11.59 L11.4,12.47 L12.53,11.34 L11.61,9.53 L12.08,8.44 L14,7.75 L14,7.77 Z M7,10 C5.34,10 4,8.66 4,7 C4,5.34 5.34,4 7,4 C8.66,4 10,5.34 10,7 C10,8.66 8.66,10 7,10 Z",displayName:"SettingsIcon"}),Gze=Wp({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),Hze=Wp({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),$ze=Wp({d:"M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z",displayName:"ArrowForwardIcon"}),KQ=Wp({d:"M0.913134,0.920639 C1.49851,0.331726 2.29348,0 3.12342,0 L10.8766,0 C11.7065,0 12.5015,0.331725 13.0869,0.920639 C13.6721,1.50939 14,2.30689 14,3.13746 L14,8.12943 C13.9962,8.51443 13.9059,8.97125 13.7629,9.32852 C13.6128,9.683 13.3552,10.0709 13.0869,10.3462 C12.813,10.6163 12.4265,10.8761 12.0734,11.0274 C11.7172,11.1716 11.2607,11.263 10.8766,11.2669 L10.1234,11.2669 L10.1234,12.5676 L10.1209,12.5676 C10.1204,12.793 10.0633,13.0791 9.97807,13.262 C9.8627,13.466 9.61158,13.7198 9.40818,13.8382 L9.40824,13.8383 C9.4077,13.8386 9.40716,13.8388 9.40661,13.8391 C9.40621,13.8393 9.4058,13.8396 9.40539,13.8398 L9.40535,13.8397 C9.22958,13.9254 8.94505,13.9951 8.75059,14 L8.74789,14 C8.35724,13.9963 7.98473,13.8383 7.71035,13.5617 L5.39553,11.2669 L3.12342,11.2669 C2.29348,11.2669 1.49851,10.9352 0.913134,10.3462 C0.644826,10.0709 0.387187,9.683 0.23711,9.32852 C0.0941235,8.97125 0.00379528,8.51443 0,8.12943 L0,3.13746 C0,2.30689 0.327915,1.50939 0.913134,0.920639 Z M3.12342,1.59494 C2.71959,1.59494 2.33133,1.75628 2.04431,2.04503 C1.75713,2.33395 1.59494,2.72681 1.59494,3.13746 L1.59494,8.12943 C1.59114,8.35901 1.62114,8.51076 1.71193,8.72129 C1.79563,8.9346 1.88065,9.06264 2.04431,9.22185 C2.33133,9.5106 2.71959,9.67195 3.12342,9.67195 L5.72383,9.67195 C5.93413,9.67195 6.13592,9.75502 6.28527,9.90308 L8.52848,12.1269 L8.52848,10.4694 C8.52848,10.029 8.88552,9.67195 9.32595,9.67195 L10.8766,9.67195 C11.1034,9.67583 11.2517,9.64614 11.4599,9.55518 C11.6712,9.47132 11.7976,9.38635 11.9557,9.22185 C12.1193,9.06264 12.2044,8.9346 12.2881,8.72129 C12.3789,8.51076 12.4089,8.35901 12.4051,8.12943 L12.4051,3.13746 C12.4051,2.72681 12.2429,2.33394 11.9557,2.04503 C11.6687,1.75628 11.2804,1.59494 10.8766,1.59494 L3.12342,1.59494 Z",displayName:"ChatIcon",viewBox:"0 0 14 14"}),qQ=Wp({displayName:"EmailIcon",path:S.jsxs("g",{fill:"currentColor",children:[S.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),S.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),Kze=Wp({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),qze=Wp({displayName:"QuestionOutlineIcon",path:S.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[S.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),S.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),S.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),Yze=Wp({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"}),Xze="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function wR({mode:n="button",label:e="Sign In",buttonProps:i={},initialIsOpen:o=!1}){const{signIn:l,createGuestUser:u}=k.useContext(ls),{fullscreenRef:f}=vh(),y=Ea(),{register:v,handleSubmit:b,formState:{errors:C}}=lae(),[R,O]=k.useState(!1),[L,D]=k.useState(o),[U,B]=k.useState(!1),[Y,W]=k.useState(!1),[ne,le]=k.useState(""),[re,me]=k.useState(!1),[q,J]=k.useState(null),[Q,ie]=k.useState(!1),[pe,de]=k.useState(!1),he=k.useRef(null);YN(L||Y),k.useEffect(()=>{L&&(async()=>{try{const nt=window.location.pathname.match(/\/(w|embed)\/([^\/]+)/);if(nt){const dt=nt[2],ft=await mo(dt);ie((ft==null?void 0:ft.allowGuestUsers)||!1)}}catch(je){H.error("SignIn: Error checking guest access:",je),ie(!1)}})()},[L]),k.useEffect(()=>{const xe=()=>{D(!0)};return window.addEventListener("openSignInModal",xe),()=>{window.removeEventListener("openSignInModal",xe)}},[]);const Se=xe=>{J(xe)},Ie=async xe=>{if(!q){y({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}O(!0);try{await l(xe.email,xe.password,q),H.log("User: Sign-in process complete."),D(!1),window.location.reload()}catch(je){H.error("User: SignIn Error:",je);const nt=je.message||"An error occurred while logging in. Please check your credentials.",dt=nt.includes("verify your email");y({title:dt?"Email Verification Required":"Error",description:nt,status:dt?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:f.current})}finally{O(!1),he.current&&he.current.reset()}},Fe=async()=>{if(!ne){y({title:"Email Required",description:"Please enter your email address to reset your password.",status:"warning",duration:3e3,isClosable:!0,position:"top",container:f.current});return}try{me(!0),await R3e(yF,ne),y({title:"Password Reset Email Sent",description:"Check your email for instructions to reset your password.",status:"success",duration:5e3,isClosable:!0,position:"top",container:f.current}),W(!1)}catch(xe){H.error("User: Reset Password Error:",xe),y({title:"Error",description:xe.message||"Failed to send password reset email. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:f.current})}finally{me(!1)}},we=()=>D(xe=>!xe),Re=()=>{D(!1),B(!0)},Te=()=>{W(!0)},Ne=async()=>{try{de(!0);const je=window.location.pathname.match(/\/(w|embed)\/([^\/]+)/);if(je){const nt=je[2];await u(nt),y({title:"Welcome, Guest!",description:"You're now entering as a guest user.",status:"success",duration:3e3,isClosable:!0,position:"top",container:f.current}),D(!1),window.location.reload()}}catch(xe){H.error("SignIn: Error creating guest user:",xe),y({title:"Error",description:"Failed to create guest user. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:f.current})}finally{de(!1)}},be=n==="link"?S.jsx(uu,{variant:"header",onClick:we,children:e}):S.jsx($n,{onClick:we,...i,children:e});return S.jsxs(S.Fragment,{children:[be,S.jsxs(Is,{isOpen:L,onClose:we,size:"md",portalProps:{containerRef:f},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[S.jsx(Os,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsx("form",{onSubmit:b(Ie),children:S.jsxs(As,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:xe=>{xe.stopPropagation()},children:[S.jsxs(Jo,{p:8,textAlign:"center",children:[S.jsx(fR,{size:"lg",mb:2,color:"white",children:"Welcome Back"}),S.jsx(qe,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),S.jsx($s,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(Ps,{px:8,pb:8,children:S.jsxs(hr,{spacing:4,children:[S.jsxs(Br,{isInvalid:C.email,children:[S.jsxs(Ag,{children:[S.jsx(uS,{pointerEvents:"none",children:S.jsx(qQ,{color:"gray.500"})}),S.jsx(Li,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...v("email",{required:"Email is required."})})]}),S.jsx(Sp,{children:C.email&&C.email.message})]}),S.jsxs(Br,{isInvalid:C.password,children:[S.jsxs(Ag,{children:[S.jsx(uS,{pointerEvents:"none",children:S.jsx(Gze,{color:"gray.500"})}),S.jsx(Li,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...v("password",{required:"Password is required."})})]}),S.jsx(Sp,{children:C.password&&C.password.message})]}),S.jsx($e,{alignSelf:"flex-end",children:S.jsx(uu,{color:"blue.400",fontSize:"sm",onClick:Te,children:"Forgot Password?"})}),S.jsx(Mi,{width:"100%",justifyContent:"center",my:4,children:S.jsx(uae,{ref:he,sitekey:Xze,onChange:Se,theme:"dark"})})]})}),S.jsxs(gh,{px:8,pb:8,flexDirection:"column",gap:4,children:[S.jsx($n,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:R,loadingText:"Signing In",isDisabled:!q,children:"Sign In"}),Q&&S.jsx($n,{colorScheme:"gray",variant:"outline",size:"lg",width:"100%",onClick:Ne,isLoading:pe,loadingText:"Creating Guest Account...",_hover:{bg:"gray.700"},children:"Continue as Guest"}),S.jsxs(qe,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",S.jsx(uu,{color:"blue.400",onClick:Re,children:"Sign Up"})]})]})]})})]}),S.jsxs(Is,{isOpen:Y,onClose:()=>W(!1),size:"md",portalProps:{containerRef:f},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[S.jsx(Os,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),S.jsxs(As,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:xe=>{xe.stopPropagation()},children:[S.jsxs(Jo,{p:8,textAlign:"center",children:[S.jsx(fR,{size:"lg",mb:2,color:"white",children:"Reset Password"}),S.jsx(qe,{fontSize:"sm",color:"gray.400",children:"Enter your email to receive password reset instructions"})]}),S.jsx($s,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(Ps,{px:8,pb:4,children:S.jsx(Br,{children:S.jsxs(Ag,{children:[S.jsx(uS,{pointerEvents:"none",children:S.jsx(qQ,{color:"gray.500"})}),S.jsx(Li,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},value:ne,onChange:xe=>le(xe.target.value)})]})})}),S.jsxs(gh,{px:8,pb:8,flexDirection:"column",gap:4,children:[S.jsx($n,{colorScheme:"blue",size:"lg",width:"100%",onClick:Fe,isLoading:re,loadingText:"Sending",children:"Send Reset Link"}),S.jsxs(qe,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Remember your password?"," ",S.jsx(uu,{color:"blue.400",onClick:()=>W(!1),children:"Back to Sign In"})]})]})]})]}),S.jsx(xF,{mode:"link",isOpen:U,onClose:()=>B(!1)})]})}wR.propTypes={mode:Nn.oneOf(["button","link"]),label:Nn.string,buttonProps:Nn.object,initialIsOpen:Nn.bool};var eV={},Af={},QT={},YQ;function Jze(){if(YQ)return QT;YQ=1,Object.defineProperty(QT,"__esModule",{value:!0}),QT.useCanvasIdentifier=void 0;var n=em(),e=0,i="react-unity-webgl-canvas",o=function(l){var u=(0,n.useState)(0),f=u[0],y=u[1],v=(0,n.useCallback)(function(){y(function(C){return C+1})},[]);if(l!==void 0)return[l,v];var b=(0,n.useMemo)(function(){return[i,e].join("-")},[f]);return[b,v]};return QT.useCanvasIdentifier=o,QT}var ZT={},eC={},XQ;function hae(){return XQ||(XQ=1,Object.defineProperty(eC,"__esModule",{value:!0}),eC.isBrowserEnvironment=void 0,eC.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),eC}var JQ;function Qze(){if(JQ)return ZT;JQ=1,Object.defineProperty(ZT,"__esModule",{value:!0}),ZT.useUnityLoader=void 0;var n=em(),e=hae(),i=function(o){var l=(0,n.useState)("Loading"),u=l[0],f=l[1];return(0,n.useEffect)(function(){if(e.isBrowserEnvironment!==!1){if(o===null){f("Idle");return}var y=window.document.querySelector('script[src="'.concat(o,'"]'));y===null?(y=window.document.createElement("script"),y.type="text/javascript",y.src=o,y.async=!0,y.setAttribute("data-status","loading"),window.document.body.appendChild(y),y.addEventListener("load",function(){return y==null?void 0:y.setAttribute("data-status","loaded")}),y.addEventListener("error",function(){return y==null?void 0:y.setAttribute("data-status","error")})):f(y.getAttribute("data-status")==="loaded"?"Loaded":"Error");var v=function(b){return f(b.type==="load"?"Loaded":"Error")};return y.addEventListener("load",v),y.addEventListener("error",v),function(){y!==null&&(y.removeEventListener("load",v),y.removeEventListener("error",v),y.remove())}}},[o]),u};return ZT.useUnityLoader=i,ZT}var QQ;function Zze(){if(QQ)return Af;QQ=1;var n=Af&&Af.__awaiter||function(f,y,v,b){function C(R){return R instanceof v?R:new v(function(O){O(R)})}return new(v||(v=Promise))(function(R,O){function L(B){try{U(b.next(B))}catch(Y){O(Y)}}function D(B){try{U(b.throw(B))}catch(Y){O(Y)}}function U(B){B.done?R(B.value):C(B.value).then(L,D)}U((b=b.apply(f,y||[])).next())})},e=Af&&Af.__generator||function(f,y){var v={label:0,sent:function(){if(R[0]&1)throw R[1];return R[1]},trys:[],ops:[]},b,C,R,O=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return O.next=L(0),O.throw=L(1),O.return=L(2),typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function L(U){return function(B){return D([U,B])}}function D(U){if(b)throw new TypeError("Generator is already executing.");for(;O&&(O=0,U[0]&&(v=0)),v;)try{if(b=1,C&&(R=U[0]&2?C.return:U[0]?C.throw||((R=C.return)&&R.call(C),0):C.next)&&!(R=R.call(C,U[1])).done)return R;switch(C=0,R&&(U=[U[0]&2,R.value]),U[0]){case 0:case 1:R=U;break;case 4:return v.label++,{value:U[1],done:!1};case 5:v.label++,C=U[1],U=[0];continue;case 7:U=v.ops.pop(),v.trys.pop();continue;default:if(R=v.trys,!(R=R.length>0&&R[R.length-1])&&(U[0]===6||U[0]===2)){v=0;continue}if(U[0]===3&&(!R||U[1]>R[0]&&U[1]<R[3])){v.label=U[1];break}if(U[0]===6&&v.label<R[1]){v.label=R[1],R=U;break}if(R&&v.label<R[2]){v.label=R[2],v.ops.push(U);break}R[2]&&v.ops.pop(),v.trys.pop();continue}U=y.call(f,v)}catch(B){U=[6,B],C=0}finally{b=R=0}if(U[0]&5)throw U[1];return{value:U[0]?U[1]:void 0,done:!0}}};Object.defineProperty(Af,"__esModule",{value:!0}),Af.Unity=void 0;var i=em(),o=Jze(),l=Qze(),u=(0,i.forwardRef)(function(f,y){var v=(0,i.useState)(null),b=v[0],C=v[1],R=(0,i.useState)(null),O=R[0],L=R[1],D=(0,o.useCanvasIdentifier)(f.id),U=D[0],B=D[1],Y=(0,l.useUnityLoader)(f.unityProvider.loaderUrl),W=(0,i.useCallback)(function(ne){f.unityProvider.setLoadingProgression(ne),ne===1&&f.unityProvider.setIsLoaded(!0)},[f.unityProvider]);return(0,i.useEffect)(function(){var ne=function(){return n(void 0,void 0,void 0,function(){var re,me,q,J,Q;return e(this,function(ie){switch(ie.label){case 0:if(!b||O||Y!=="Loaded")return[2];console.log("React Unity WebGL: Initializing Unity instance..."),f.unityProvider.setUnityInstance(null),L(null),f.unityProvider.setLoadingProgression(0),(Q=(J=f.unityProvider).setIsLoaded)===null||Q===void 0||Q.call(J,!1),f.unityProvider.setInitialisationError(void 0),B(),re={companyName:f.unityProvider.companyName,productName:f.unityProvider.productName,productVersion:f.unityProvider.productVersion,dataUrl:f.unityProvider.dataUrl,frameworkUrl:f.unityProvider.frameworkUrl,codeUrl:f.unityProvider.codeUrl,workerUrl:f.unityProvider.workerUrl,memoryUrl:f.unityProvider.memoryUrl,symbolsUrl:f.unityProvider.symbolsUrl,streamingAssetsUrl:f.unityProvider.streamingAssetsUrl,devicePixelRatio:f.devicePixelRatio,webglContextAttributes:f.unityProvider.webglContextAttributes,cacheControl:f.unityProvider.cacheControl,autoSyncPersistentDataPath:f.unityProvider.autoSyncPersistentDataPath,matchWebGLToCanvasSize:f.matchWebGLToCanvasSize,disabledCanvasEvents:f.disabledCanvasEvents},Object.keys(re).forEach(function(pe){(re[pe]===null||re[pe]===void 0)&&delete re[pe]}),ie.label=1;case 1:return ie.trys.push([1,3,,4]),[4,window.createUnityInstance(b,re,W)];case 2:return me=ie.sent(),L(me),f.unityProvider.setUnityInstance(me),[3,4];case 3:return q=ie.sent(),console.error("React Unity WebGL: Error initializing Unity instance:",q),f.unityProvider.setInitialisationError(q),[3,4];case 4:return[2]}})})},le=function(){return n(void 0,void 0,void 0,function(){var re,me,q;return e(this,function(J){switch(J.label){case 0:return!O||!b?[2]:(console.log("React Unity WebGL: Detaching Unity instance..."),f.unityProvider.setUnityInstance(null),L(null),f.unityProvider.setLoadingProgression(0),(q=(me=f.unityProvider).setIsLoaded)===null||q===void 0||q.call(me,!1),f.unityProvider.setInitialisationError(void 0),re=document.createElement("canvas"),re.id=b.id,re.setAttribute("react-unity-webgl-role","cleanup"),re.style.display="none",document.body.appendChild(re),O.Module.canvas=re,L(null),[4,O.Quit()]);case 1:return J.sent(),document.body.removeChild(re),[2]}})})};return ne(),function(){le()}},[b,O,Y,f.unityProvider]),(0,i.useImperativeHandle)(y,function(){return b}),(0,i.createElement)("canvas",{ref:C,id:U,style:f.style,className:f.className,tabIndex:f.tabIndex})});return Af.Unity=u,Af}var tC={},wy={},ZQ;function e9e(){if(ZQ)return wy;ZQ=1;var n=wy&&wy.__spreadArray||function(f,y,v){if(v||arguments.length===2)for(var b=0,C=y.length,R;b<C;b++)(R||!(b in y))&&(R||(R=Array.prototype.slice.call(y,0,b)),R[b]=y[b]);return f.concat(R||Array.prototype.slice.call(y))};Object.defineProperty(wy,"__esModule",{value:!0}),wy.useEventSystem=void 0;var e=em(),i=hae(),o=[],l=function(f){for(var y=[],v=1;v<arguments.length;v++)y[v-1]=arguments[v];var b=void 0;return o.forEach(function(C){b=C.apply(void 0,n([f],y,!1))}),b};i.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=l);var u=function(){var f=(0,e.useRef)([]),y=(0,e.useCallback)(function(C,R){f.current=n(n([],f.current,!0),[{eventName:C,callback:R}],!1)},[f]),v=(0,e.useCallback)(function(C,R){f.current=f.current.filter(function(O){return O.eventName!==C&&O.callback!==R})},[f]),b=(0,e.useCallback)(function(C){for(var R=[],O=1;O<arguments.length;O++)R[O-1]=arguments[O];var L=f.current.find(function(D){return D.eventName===C});if(!(typeof L>"u"))return L.callback.apply(L,R)},[f]);return(0,e.useEffect)(function(){return o.push(b),function(){o.splice(o.indexOf(b),1)}},[b]),{addEventListener:y,removeEventListener:v}};return wy.useEventSystem=u,wy}var eZ;function t9e(){if(eZ)return tC;eZ=1,Object.defineProperty(tC,"__esModule",{value:!0}),tC.useUnityContext=void 0;var n=em(),e=e9e(),i=function(o){var l=(0,n.useState)(null),u=l[0],f=l[1],y=(0,n.useState)(0),v=y[0],b=y[1],C=(0,n.useState)(!1),R=C[0],O=C[1],L=(0,n.useState)(),D=L[0],U=L[1],B=(0,e.useEventSystem)(),Y=(0,n.useRef)({companyName:o.companyName,productName:o.productName,productVersion:o.productVersion,codeUrl:o.codeUrl,dataUrl:o.dataUrl,frameworkUrl:o.frameworkUrl,loaderUrl:o.loaderUrl,memoryUrl:o.memoryUrl,symbolsUrl:o.symbolsUrl,streamingAssetsUrl:o.streamingAssetsUrl,workerUrl:o.workerUrl,webglContextAttributes:o.webglContextAttributes,cacheControl:o.cacheControl,autoSyncPersistentDataPath:o.autoSyncPersistentDataPath,setUnityInstance:f,setLoadingProgression:b,setIsLoaded:O,setInitialisationError:U}),W=(0,n.useCallback)(function(J){return u==null?void 0:u.SetFullscreen(J?1:0)},[u]),ne=(0,n.useCallback)(function(){var J;return(J=u==null?void 0:u.Module.canvas)===null||J===void 0?void 0:J.requestPointerLock()},[u]),le=(0,n.useCallback)(function(J,Q,ie){return u==null?void 0:u.SendMessage(J,Q,ie)},[u]),re=(0,n.useCallback)(function(J,Q){var ie;return(ie=u==null?void 0:u.Module.canvas)===null||ie===void 0?void 0:ie.toDataURL(J,Q)},[u]),me=(0,n.useCallback)(function(){var J;return(J=u==null?void 0:u.Quit())!==null&&J!==void 0?J:Promise.reject()},[u]),q=(0,n.useCallback)(function(){var J;return(J=u==null?void 0:u.GetMetricsInfo)===null||J===void 0?void 0:J.call(u)},[u]);return{unityProvider:Y.current,loadingProgression:v,isLoaded:R,initialisationError:D,requestFullscreen:W,requestPointerLock:ne,sendMessage:le,takeScreenshot:re,unload:me,getMetricsInfo:q,addEventListener:B.addEventListener,removeEventListener:B.removeEventListener,UNSAFE__unityInstance:u}};return tC.useUnityContext=i,tC}var nC={},tZ;function n9e(){if(tZ)return nC;tZ=1,Object.defineProperty(nC,"__esModule",{value:!0}),nC.useUnityMetricsInfo=void 0;var n=em(),e=function(i,o){var l=(0,n.useState)({}),u=l[0],f=l[1];return(0,n.useEffect)(function(){var y=setInterval(function(){var v=i();typeof v>"u"||f(v)},o.interval||1e3);return function(){clearInterval(y)}},[i,o.interval]),u};return nC.useUnityMetricsInfo=e,nC}var nZ;function r9e(){return nZ||(nZ=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityMetricsInfo=n.useUnityContext=n.Unity=void 0;var e=Zze();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return e.Unity}});var i=t9e();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return i.useUnityContext}});var o=n9e();Object.defineProperty(n,"useUnityMetricsInfo",{enumerable:!0,get:function(){return o.useUnityMetricsInfo}})})(eV)),eV}var pae=r9e();const ch="[UnityProvider]",D5=k.createContext(),i9e=({spaceID:n,children:e,loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u,loadingBackground:f,showLoginButton:y,showDisruptiveLogo:v})=>{H.log(`${ch} Initializing with spaceID:`,n),H.log(`${ch} Unity URLs:`,{loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u});const{unityProvider:b,loadingProgression:C,isLoaded:R,sendMessage:O,addEventListener:L,removeEventListener:D,error:U}=pae.useUnityContext({loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u}),B={unityProvider:b,loadingProgression:C,isLoaded:R,sendMessage:O,addEventListener:L,removeEventListener:D,error:U,spaceID:n},Y=k.useRef(null),W=k.useRef(Date.now());k.useEffect(()=>{const me=()=>{document.hidden?(H.log(`${ch} Page hidden, starting keep-alive`),ne()):(H.log(`${ch} Page visible, stopping keep-alive`),le())};return document.addEventListener("visibilitychange",me),()=>{document.removeEventListener("visibilitychange",me),le()}},[]),k.useEffect(()=>{const me=()=>{W.current=Date.now(),document.hidden&&O("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",me),window.addEventListener("keydown",me),window.addEventListener("touchstart",me),()=>{window.removeEventListener("mousemove",me),window.removeEventListener("keydown",me),window.removeEventListener("touchstart",me)}},[O]);const ne=()=>{Y.current||(Y.current=setInterval(()=>{R&&document.hidden&&(O("WebGLInputManager","KeepAlive"),H.debug(`${ch} Sent keep-alive message`))},1e4))},le=()=>{Y.current&&(clearInterval(Y.current),Y.current=null)};k.useEffect(()=>(H.log(`${ch} Component mounted`),()=>{H.log(`${ch} Component unmounting`),le()}),[]),k.useEffect(()=>{H.log(`${ch} Loading progress:`,C)},[C]),k.useEffect(()=>{if(R){H.log(`${ch} Unity instance loaded for:`,n);const me={SendMessage:O,Module:b==null?void 0:b.Module};window.unityInstance=me,window.registerUnityInstance&&window.registerUnityInstance(me),document.hidden&&ne()}},[R,n,O,b]),k.useEffect(()=>{U&&H.error(`${ch} Unity error:`,U)},[U]),H.log(`${ch} Rendering provider with instance:`,B),k.useEffect(()=>{H.log("UnityProvider: Unity build URLs:",{loaderUrl:i,dataUrl:o,frameworkUrl:l,codeUrl:u})},[i,o,l,u]);const re=[];if(i||re.push("loaderUrl"),o||re.push("dataUrl"),l||re.push("frameworkUrl"),u||re.push("codeUrl"),re.length>0)return H.error(`UnityProvider: Missing required Unity build URLs: ${re.join(", ")}`),S.jsx(D5.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${re.join(", ")}`),spaceID:n},children:e});try{return k.useEffect(()=>{H.log("UnityProvider: Unity context created:",b),b?H.log("UnityProvider: Unity provider is available"):H.error("UnityProvider: Unity provider is not available"),R?H.log("UnityProvider: Unity is loaded"):H.log("UnityProvider: Unity is not loaded yet")},[b,R]),S.jsx(D5.Provider,{value:B,children:e})}catch(me){return H.error("UnityProvider: Error creating Unity context:",me),S.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[S.jsx("h3",{children:"Unity Error"}),S.jsxs("p",{children:["Error creating Unity context: ",me.message]}),S.jsx("p",{children:"Please check the console for more details."})]})}},xo=()=>k.useContext(D5);var fae={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},rZ=gi.createContext&&gi.createContext(fae),xg=function(){return xg=Object.assign||function(n){for(var e,i=1,o=arguments.length;i<o;i++){e=arguments[i];for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&(n[l]=e[l])}return n},xg.apply(this,arguments)},s9e=function(n,e){var i={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&e.indexOf(o)<0&&(i[o]=n[o]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,o=Object.getOwnPropertySymbols(n);l<o.length;l++)e.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(n,o[l])&&(i[o[l]]=n[o[l]]);return i};function mae(n){return n&&n.map(function(e,i){return gi.createElement(e.tag,xg({key:i},e.attr),mae(e.child))})}function ir(n){return function(e){return gi.createElement(o9e,xg({attr:xg({},n.attr)},e),mae(n.child))}}function o9e(n){var e=function(i){var o=n.attr,l=n.size,u=n.title,f=s9e(n,["attr","size","title"]),y=l||i.size||"1em",v;return i.className&&(v=i.className),n.className&&(v=(v?v+" ":"")+n.className),gi.createElement("svg",xg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,o,f,{className:v,style:xg(xg({color:n.color||i.color},i.style),n.style),height:y,width:y,xmlns:"http://www.w3.org/2000/svg"}),u&&gi.createElement("title",null,u),n.children)};return rZ!==void 0?gi.createElement(rZ.Consumer,null,function(i){return e(i)}):e(fae)}function gae(n){return ir({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function a9e(n){return ir({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"}}]})(n)}function c9e(n){return ir({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(n)}function iZ(n){return ir({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"}}]})(n)}function l9e(n){return ir({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"}}]})(n)}function sZ(n){return ir({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"}}]})(n)}function u9e(n){return ir({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M160 224v64h320v-64c0-35.3 28.7-64 64-64h32c0-53-43-96-96-96H160c-53 0-96 43-96 96h32c35.3 0 64 28.7 64 64zm416-32h-32c-17.7 0-32 14.3-32 32v96H128v-96c0-17.7-14.3-32-32-32H64c-35.3 0-64 28.7-64 64 0 23.6 13 44 32 55.1V432c0 8.8 7.2 16 16 16h64c8.8 0 16-7.2 16-16v-16h384v16c0 8.8 7.2 16 16 16h64c8.8 0 16-7.2 16-16V311.1c19-11.1 32-31.5 32-55.1 0-35.3-28.7-64-64-64z"}}]})(n)}function Uk(n){return ir({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function d9e(n){return ir({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M239.1 6.3l-208 78c-18.7 7-31.1 25-31.1 45v225.1c0 18.2 10.3 34.8 26.5 42.9l208 104c13.5 6.8 29.4 6.8 42.9 0l208-104c16.3-8.1 26.5-24.8 26.5-42.9V129.3c0-20-12.4-37.9-31.1-44.9l-208-78C262 2.2 250 2.2 239.1 6.3zM256 68.4l192 72v1.1l-192 78-192-78v-1.1l192-72zm32 356V275.5l160-65v133.9l-160 80z"}}]})(n)}function h9e(n){return ir({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 448h-80V113.45C544 86.19 522.47 64 496 64H384v64h96v384h144c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16zM312.24 1.01l-192 49.74C105.99 54.44 96 67.7 96 82.92V448H16c-8.84 0-16 7.16-16 16v32c0 8.84 7.16 16 16 16h336V33.18c0-21.58-19.56-37.41-39.76-32.17zM264 288c-13.25 0-24-14.33-24-32s10.75-32 24-32 24 14.33 24 32-10.75 32-24 32z"}}]})(n)}function _ae(n){return ir({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function p9e(n){return ir({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function yae(n){return ir({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function f9e(n){return ir({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function m9e(n){return ir({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function Eae(n){return ir({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function vae(n){return ir({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function g9e(n){return ir({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function _9e(n){return ir({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function y9e(n){return ir({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function Vk(n){return ir({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function E9e(n){return ir({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"}}]})(n)}function v9e(n){return ir({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M296 384h-80c-13.3 0-24-10.7-24-24V192h-87.7c-17.8 0-26.7-21.5-14.1-34.1L242.3 5.7c7.5-7.5 19.8-7.5 27.3 0l152.2 152.2c12.6 12.6 3.7 34.1-14.1 34.1H320v168c0 13.3-10.7 24-24 24zm216-8v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h136v8c0 30.9 25.1 56 56 56h80c30.9 0 56-25.1 56-56v-8h136c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"}}]})(n)}function S9e(n){return ir({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208H432c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h192c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function b9e(n){return ir({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function w9e(n){return ir({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M634.91 154.88C457.74-8.99 182.19-8.93 5.09 154.88c-6.66 6.16-6.79 16.59-.35 22.98l34.24 33.97c6.14 6.1 16.02 6.23 22.4.38 145.92-133.68 371.3-133.71 517.25 0 6.38 5.85 16.26 5.71 22.4-.38l34.24-33.97c6.43-6.39 6.3-16.82-.36-22.98zM320 352c-35.35 0-64 28.65-64 64s28.65 64 64 64 64-28.65 64-64-28.65-64-64-64zm202.67-83.59c-115.26-101.93-290.21-101.82-405.34 0-6.9 6.1-7.12 16.69-.57 23.15l34.44 33.99c6 5.92 15.66 6.32 22.05.8 83.95-72.57 209.74-72.41 293.49 0 6.39 5.52 16.05 5.13 22.05-.8l34.44-33.99c6.56-6.46 6.33-17.06-.56-23.15z"}}]})(n)}function T9e(n){return ir({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M507.73 109.1c-2.24-9.03-13.54-12.09-20.12-5.51l-74.36 74.36-67.88-11.31-11.31-67.88 74.36-74.36c6.62-6.62 3.43-17.9-5.66-20.16-47.38-11.74-99.55.91-136.58 37.93-39.64 39.64-50.55 97.1-34.05 147.2L18.74 402.76c-24.99 24.99-24.99 65.51 0 90.5 24.99 24.99 65.51 24.99 90.5 0l213.21-213.21c50.12 16.71 107.47 5.68 147.37-34.22 37.07-37.07 49.7-89.32 37.91-136.73zM64 472c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24z"}}]})(n)}const za=()=>{const{sendMessage:n,isLoaded:e}=xo(),i=k.useRef([]),o=k.useCallback(()=>{if(e)for(;i.current.length>0;){const{eventName:u,data:f}=i.current.shift();H.log("useSendUnityEvent: Processing queued event to Unity:",u,f);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:u,data:JSON.stringify(f)}))}catch(y){H.error("useSendUnityEvent: Error sending event to Unity:",y),i.current.unshift({eventName:u,data:f});break}}},[n,e]);return k.useEffect(()=>{const u=setInterval(()=>{o()},1e3);return()=>clearInterval(u)},[o]),k.useCallback((u,f)=>{H.log("useSendUnityEvent: Queuing event for Unity:",u),i.current.push({eventName:u,data:f}),o()},[o])},jc=()=>{const{addEventListener:n,removeEventListener:e}=xo();return k.useCallback((i,o)=>{const l=u=>{H.log(i+" unity message received.");let f=null;if(u)try{f=JSON.parse(u)}catch(y){H.warn("Failed to parse JSON data from Unity message:",y)}o(f)};return n(i,l),()=>{e(i,l)}},[n,e])},Sae=()=>{const[n,e]=k.useState({}),[i,o]=k.useState(!1),[l,u]=k.useState(null),[f,y]=k.useState(0),v=za(),b=jc(),{spaceID:C,sendMessage:R,isLoaded:O}=xo(),L=k.useCallback((Y,W)=>{if(!Y)return;H.log(`useHLSStream: Sending stream URL to Unity: ${Y} for player ${W}`);const ne={identifier:"LiveProjector",playerIndex:W.toString(),streamUrl:Y};if(v("SetHLSStream",ne),O&&R)try{H.log("useHLSStream: Sending with ReactIncomingEvent approach"),R("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:"SetHLSStream",data:JSON.stringify(ne)})),H.log("useHLSStream: Sending with direct HLSStream approach"),R("HLSStream","SetHLSStream",JSON.stringify({identifier:"LiveProjector",playerIndex:W.toString(),streamUrl:Y})),H.log("useHLSStream: Sending with most direct approach possible"),R("LiveProjector","SetStreamUrl",Y),R("HLSStreamClient","SetStreamUrl",JSON.stringify({Index:W.toString(),Url:Y}))}catch(le){H.error("useHLSStream: Error with direct message:",le)}else H.warn("useHLSStream: Unity not loaded, could not send direct message")},[v,R,O]);k.useEffect(()=>{C&&D(C)},[C]);const D=async Y=>{try{if(!Y){H.warn("useHLSStream: Cannot load stream from Firebase - no spaceID");return}o(!0),H.log(`useHLSStream: Loading stream from Firebase for space ${Y}`);const W=await eae(Y);if(W&&W.streamUrl)if(H.log(`useHLSStream: Loaded stream data from Firebase for space ${Y}`,W),u(W),O)H.log("useHLSStream: Unity is loaded, sending stream URL to Unity after delay"),setTimeout(()=>{L(W.streamUrl,W.playerIndex||"0")},500),setTimeout(()=>{H.log("useHLSStream: Sending backup stream URL to Unity after longer delay"),L(W.streamUrl,W.playerIndex||"0")},2e3);else{H.warn("useHLSStream: Unity is not loaded yet, will try again later");const ne=setInterval(()=>{O&&(H.log("useHLSStream: Unity is now loaded, sending stream URL to Unity"),L(W.streamUrl,W.playerIndex||"0"),clearInterval(ne))},1e3);setTimeout(()=>{clearInterval(ne)},3e4)}else H.log(`useHLSStream: No saved stream found for space ${Y}`),u(null)}catch(W){H.error(`useHLSStream: Error loading stream from Firebase for space ${Y}`,W)}finally{o(!1)}},U=k.useCallback(async()=>{C&&(H.log(`useHLSStream: Forcing reload of stream data for space ${C}`),y(Y=>Y+1),await D(C))},[C]),B=k.useCallback(async(Y,W=0,ne={})=>{try{if(!Y||!Y.trim()){H.error("useHLSStream: Invalid stream URL");return}o(!0),H.log(`useHLSStream: Setting HLS stream URL for LiveProjector[${W}]`,Y);const{enabled:le=!0,rtmpUrl:re="",streamKey:me="",skipSendToUnity:q=!1}=ne;if(q||L(Y,W),C)try{const J={streamUrl:Y,playerIndex:W.toString(),enabled:le,rtmpUrl:re,streamKey:me,updatedAt:new Date().toISOString()};H.log(`useHLSStream: Saving stream URL to Firebase for space ${C}`,J),await R5(C,J),u(J)}catch(J){throw H.error(`useHLSStream: Error saving stream URL to Firebase for space ${C}`,J),J}else H.warn("useHLSStream: No spaceID available, stream URL not saved to Firebase")}finally{o(!1)}},[L,C]);return k.useEffect(()=>{const W=b("SetHLSStream",ne=>{if(ne)try{H.log("useHLSStream: Received player status update",ne);const{identifier:le,playerIndex:re,isReady:me,isPlaying:q}=ne,J=`${le}_${re}`;e(Q=>({...Q,[J]:{identifier:le,playerIndex:re,isReady:me,isPlaying:q}}))}catch(le){H.error("useHLSStream: Error handling player status update",le)}});return()=>{W()}},[b]),k.useEffect(()=>{if(l&&l.streamUrl){H.log("useHLSStream: Resending saved stream URL to Unity");const Y=setTimeout(()=>{L(l.streamUrl,l.playerIndex||"0")},1e3);return()=>clearTimeout(Y)}},[l,n,L,f]),k.useEffect(()=>{const Y=W=>{if(W.detail){if(H.log("useHLSStream: Received stream update event",W.detail),C===W.detail.spaceId)H.log(`useHLSStream: Stream update is for our space ${C}, loading stream data`),D(C);else if(W.detail.streamUrl){H.log(`useHLSStream: Using stream URL directly from event: ${W.detail.streamUrl}`);const ne=W.detail.playerIndex||"0";L(W.detail.streamUrl,ne),u(W.detail)}}};return window.addEventListener("SpaceHLSStreamUpdated",Y),window.addEventListener("SpaceStreamUpdated",Y),()=>{window.removeEventListener("SpaceHLSStreamUpdated",Y),window.removeEventListener("SpaceStreamUpdated",Y)}},[C,L]),{setHLSStreamUrl:B,playerStatus:n,isLoading:i,savedStreamData:l,reloadStreamData:U}},C9e=()=>{const[n,e]=k.useState(!1),i=jc();return k.useEffect(()=>{const l=i("FirstSceneLoaded",()=>{H.log("FirstSceneLoaded unity message received."),e(!0)});return()=>{l()}},[i]),n},R9e=()=>{const[n,e]=k.useState(null),i=jc();return k.useEffect(()=>{const u=i("OpenNameplateModal",f=>{if(!f){H.warn("Received empty data in nameplate click handler");return}try{const y=typeof f=="string"?JSON.parse(f):f;let v=y.uid||y.playerId;v&&v.startsWith("[Player:")&&(H.warn("PlayerId is in [Player:X] format, cannot extract UID"),v=null),e({playerName:y.playerName,playerId:y.playerId,uid:v,isLocalPlayer:y.isLocalPlayer})}catch(y){H.error("Error processing nameplate data:",y)}});return()=>{typeof u=="function"&&u()}},[i]),[n,()=>{e(null)}]},I9e=()=>{const n=jc(),{sendUserToUnity:e}=k.useContext(ls);return k.useEffect(()=>{const o=n("RequestUserForUnity",async()=>{H.log("React: Request from Unity to send user data"),await e()});return()=>{o()}},[n,e]),!0},oZ=async(n,e,i,o={})=>{try{const{mediaType:l="image",displayAsVideo:u=!1,directUrl:f=null}=o;if(!n||!e)throw new Error("Missing required parameters: spaceId and mediaScreenId");let y=null;if(i){const v=checkClientRateLimit("fileUpload",n);if(!v.allowed)throw new Error(v.message);if(!i.type.startsWith("image/"))throw new Error("File must be an image");const b=10*1024*1024;if(i.size>b)throw new Error("File size must be less than 10MB");const C=gE(),R=Date.now(),O=i.name.split(".").pop(),L=`${e}_${R}.${O}`,D=mE(C,`spaces/${n}/mediaScreens/${L}`);H.log(`Uploading image for media screen ${e} in space ${n}`);const U=await CF(D,i);y=await $N(U.ref);const B=_r(Xn,`spaces/${n}/mediaScreens`,e);await Gg(B,{imageUrl:y,gsUrl:`gs://${U.ref.bucket}/${U.ref.fullPath}`,fileName:L,mediaType:l,displayAsVideo:u,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(f){y=f;const v=_r(Xn,`spaces/${n}/mediaScreens`,e);await Gg(v,{videoUrl:f,mediaType:l,displayAsVideo:u,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return H.log(`Successfully uploaded ${l} for media screen ${e} (display as video: ${u})`),y}catch(l){throw H.error(`Error uploading media screen ${(o==null?void 0:o.mediaType)||"image"}:`,l),l}},DF=async n=>{H.log(`Getting media screen images for space: ${n}`);try{const e=Uc(Xn,`spaces/${n}/mediaScreens`),i=await hd(e),o=[];return i.forEach(l=>{o.push({id:l.id,...l.data()})}),o}catch(e){throw H.error("Error fetching media screen images from Firestore:",e),e}},cE=async(n,e)=>{try{const i=_r(Xn,`spaces/${n}/mediaScreens`,e),o=await Xo(i);return o.exists()?{id:o.id,...o.data()}:(H.warn(`No media screen found with ID: ${e}`),null)}catch(i){throw H.error("Error fetching media screen image:",i),i}},A9e=async(n,e)=>{try{const i=await cE(n,e);if(!i)return H.warn(`No media screen found with ID: ${e} to delete`),!1;if(i.gsUrl){const l=gE(),u=mE(l,i.gsUrl);try{await RF(u),H.log(`Deleted file from storage: ${i.gsUrl}`)}catch(f){H.warn(`Could not delete file from storage: ${f.message}`)}}const o=_r(Xn,`spaces/${n}/mediaScreens`,e);return i.mediaType==="video"?(await ko(o,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),H.log(`Successfully removed video for media screen ${e}`)):(await ko(o,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),H.log(`Successfully removed image for media screen ${e}`)),!0}catch(i){throw H.error("Error deleting media screen image:",i),i}},P9e=async(n,e,i)=>{try{if(!n||!e||typeof i!="boolean")throw new Error("Missing or invalid required parameters");const o=await cE(n,e);if(!o||!o.imageUrl&&!o.videoUrl)return H.warn(`No media screen content found with ID: ${e} to update`),!1;const l=_r(Xn,`spaces/${n}/mediaScreens`,e);return await ko(l,{displayAsVideo:i,updatedAt:new Date().toISOString()}),H.log(`Successfully updated display mode for media screen ${e} to ${i?"video":"image"}`),!0}catch(o){throw H.error("Error updating media screen display mode:",o),o}},O9e=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},bae=()=>{const{spaceID:n}=xo(),e=za(),[i,o]=k.useState(!1);k.useEffect(()=>{if(window.isPlayerInstantiated){H.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),o(!0);return}const l=()=>{H.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),k.useEffect(()=>{if(!i){H.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}H.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=await DF(n);H.log("Fetched Media Screen Images",u),u.forEach(f=>{const{id:y,imageUrl:v,displayAsVideo:b,videoUrl:C}=f;let R=null;(!b||!C)&&(R=v?O9e(v):null),e("SetMediaScreenImage",{mediaScreenId:y,imageUrl:R,videoUrl:C||null,displayAsVideo:b||!1,timestamp:Date.now()}),H.log(`Sent media screen data for ${y} to Unity (displayAsVideo: ${b})`),b&&C&&(e("SetMediaScreenDisplayMode",{mediaScreenId:y,displayAsVideo:!0,videoUrl:C,timestamp:Date.now()}),H.log(`Set display mode to video for screen ${y}`))})}catch(u){H.error("Error fetching media screen images:",u)}})()},[e,n,i])},k9e=()=>{const{spaceID:n}=xo(),e=za(),[i,o]=k.useState(!1);k.useEffect(()=>{if(window.isPlayerInstantiated){H.log("useUnityThumbnails: Unity already ready (via window flag)"),o(!0);return}const l=()=>{H.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),k.useEffect(()=>{if(!i){H.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}H.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=await Zoe(n),f=async b=>{const C=`https://vimeo.com/api/oembed.json?url=${b}`,R=await fetch(C);if(!R.ok)throw new Error(`Failed to fetch thumbnail: ${R.statusText}`);const O=await R.json(),L=O.thumbnail_url.replace(/_\d+x\d+/,""),D=["640x360","295x166"];let U=null;for(let B of D){const Y=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${L}_${B}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(Y,{method:"HEAD"})).ok){U=Y;break}}catch(W){console.warn(`Failed to validate thumbnail URL: ${Y}`,W)}}return U||O.thumbnail_url},y=u.map(async b=>{const C=await f(b.url);return{gameObjectName:b.id,thumbnailUrl:C}}),v=await Promise.all(y);H.log("Fetched Thumbnails",v),v.forEach(({gameObjectName:b,thumbnailUrl:C})=>{e("SetThumbnail",{gameObjectName:b,thumbnailUrl:C})})}catch(u){H.error("Error fetching thumbnails:",u)}})()},[e,n,i])},wae=()=>{const[n,e]=k.useState([]),i=jc();return k.useEffect(()=>{let o=!0,l=null;const u=()=>{window.unityInstance&&(H.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},f=L=>{if(o){H.log("UpdatePlayerList unity message received.");try{let D=[];if(typeof L=="object"&&L!==null?D=L.players||[]:D=JSON.parse(L).players||[],Array.isArray(D)){const U=Array.from(new Map(D.map(B=>[B.playerId,B])).values());e(U),l&&(clearTimeout(l),l=null)}}catch(D){H.error("Error handling player list data:",D),l||(l=setTimeout(u,1e3))}}},y=()=>{H.log("Player disconnected, requesting fresh player list"),u()},v=()=>{H.log("Player left, requesting fresh player list"),u()};u();const b=i("UpdatePlayerList",f),C=i("PlayerDisconnected",y),R=i("PlayerLeft",v),O=setInterval(u,5e3);return()=>{o=!1,l&&clearTimeout(l),typeof b=="function"&&b(),typeof C=="function"&&C(),typeof R=="function"&&R(),clearInterval(O)}},[i]),n},Tae=()=>{const n=za(),e=k.useCallback((o,l,u,f,y,v)=>{const b=u||{x:0,y:1.5,z:0},C=f||{x:0,y:0,z:0},R=y||{x:1,y:1,z:1};try{const O={portalId:o,prefabName:l||"PortalObjectPrefab",position:b,rotation:C,scale:R,initialImageUrl:v};return H.log("Sending portal placement to Unity:",O),n("PlacePortalPrefab",O),!0}catch(O){return H.error("Error placing portal:",O),!1}},[n]),i=k.useCallback((o,l,u,f,y,v)=>{const b=u||{x:0,y:1.5,z:0},C=f||{x:0,y:0,z:0},R=y||{x:1,y:1,z:1};try{const O={portalId:o,prefabName:l||"PortalObjectPrefab",position:b,rotation:C,scale:R,initialImageUrl:v},L={eventName:"PlacePortalPrefab",data:JSON.stringify(O)};return H.log("Directly sending portal placement to Unity:",O),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(L)),!0}catch(O){return H.error("Error directly placing portal:",O),!1}},[]);return{placePortal:e,directPlacePortal:i,isUnityLoaded:!0}},Cae=()=>{const n=za(),e=k.useCallback((o,l,u,f,y)=>{const v=u||{x:0,y:0,z:0},b=f||{x:0,y:0,z:0},C=y||{x:1,y:1,z:1};try{const R={hotspotId:o,glbUrl:l,position:v,rotation:b,scale:C};return H.log("Sending seating hotspot placement to Unity:",R),n("SeatingHotspot",R),!0}catch(R){return H.error("Error placing seating hotspot:",R),!1}},[n]),i=k.useCallback((o,l,u,f,y)=>{const v=u||{x:0,y:0,z:0},b=f||{x:0,y:0,z:0},C=y||{x:1,y:1,z:1};try{const R={hotspotId:o,glbUrl:l,position:v,rotation:b,scale:C},O={eventName:"SeatingHotspot",data:JSON.stringify(R)};return H.log("Directly sending seating hotspot placement to Unity:",R),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(O)),!0}catch(R){return H.error("Error directly placing seating hotspot:",R),!1}},[]);return{placeCatalogueItem:e,directPlaceCatalogueItem:i,isUnityLoaded:!0}},N9e=_F(WN,"trackAnalytics"),x9e=_F(WN,"createAnalyticsSession"),D9e=_F(WN,"endAnalyticsSession"),L9e=async(n,e={})=>{try{H.log(`Creating secure analytics session for space ${n}`);const i=await x9e({spaceId:n,sessionData:{userAgent:typeof navigator<"u"?navigator.userAgent:"unknown",deviceType:typeof navigator<"u"&&/Mobile|Android|iPhone|iPad/.test(navigator.userAgent)?"mobile":"desktop",sessionType:"webgl",startUrl:typeof window<"u"?window.location.href:"unknown",referrer:typeof document<"u"?document.referrer:"unknown",...e}});return H.log(`Secure analytics session created: ${i.data.sessionId}`),i.data.sessionId}catch(i){throw H.error("Error creating secure analytics session:",i),i}},M9e=async(n,e,i,o={})=>{try{H.log(`Tracking secure analytics event: ${i} in space ${n}`);const l=await N9e({spaceId:n,sessionId:e,eventType:i,eventData:{...o,timestamp:new Date().toISOString(),clientSide:!0}});return H.log(`Secure analytics event tracked: ${i} (${l.data.eventId})`),l.data.eventId}catch(l){throw H.error("Error tracking secure analytics event:",l),l}},U9e=async(n,e)=>{try{if(H.log(`Ending secure analytics session: ${e} in space ${n}`),!n||!e)throw H.error("endAnalyticsSessionSecure: Missing required parameters",{spaceId:n,sessionId:e,spaceIdType:typeof n,sessionIdType:typeof e}),new Error(`Missing required parameters: spaceId=${n}, sessionId=${e}`);await D9e({spaceId:n,sessionId:e}),H.log(`Secure analytics session ended: ${e}`)}catch(i){throw H.error("Error ending secure analytics session:",i),i}},ho={UNITY:{VIDEO_PLAY:"unity_video_play",VIDEO_PAUSE:"unity_video_pause",VIDEO_COMPLETE:"unity_video_complete",PORTAL_CLICK:"unity_portal_click",PORTAL_NAVIGATE:"unity_portal_navigate",MEDIA_SCREEN_CLICK:"unity_media_screen_click",NAMEPLATE_CLICK:"unity_nameplate_click",OBJECT_INTERACT:"unity_object_interact",PLAYER_MOVE:"unity_player_move",PLAYER_SPAWN:"unity_player_spawn",SPACE_LOAD:"unity_space_load",SPACE_READY:"unity_space_ready"},REACT:{MODAL_OPEN:"react_modal_open",MODAL_CLOSE:"react_modal_close",UI_CLICK:"react_ui_click",USER_LOGIN:"react_user_login",USER_LOGOUT:"react_user_logout",SPACE_ENTER:"react_space_enter",SPACE_EXIT:"react_space_exit",CHAT_MESSAGE:"react_chat_message",UPLOAD_START:"react_upload_start",UPLOAD_COMPLETE:"react_upload_complete",SETTINGS_CHANGE:"react_settings_change",VIDEO_CLICK:"react_video_click",VIDEO_CLOSE:"react_video_close",BUTTON_CLICK:"react_button_click",FORM_SUBMIT:"react_form_submit",ERROR_OCCURRED:"react_error_occurred"}},po={NAVIGATION:"navigation",MEDIA_INTERACTION:"media_interaction",SOCIAL_INTERACTION:"social_interaction",UI_INTERACTION:"ui_interaction",SYSTEM_EVENT:"system_event",USER_BEHAVIOR:"user_behavior",CONTENT_INTERACTION:"content_interaction",PERFORMANCE:"performance"},V9e=async(n,e,i={})=>{try{return H.log(`Creating secure analytics session for user ${e} in space ${n}`),await L9e(n,i)}catch(o){throw H.error("Error creating analytics session:",o),o}},bC=async(n,e,i,o={})=>{try{return H.log(`Tracking secure analytics event: ${i} in space ${n}`),await M9e(n,e,i,o)}catch(l){throw H.error("Error tracking analytics event:",l),l}},aZ=async(n,e)=>{try{H.log(`Ending secure analytics session: ${e} in space ${n}`),await U9e(n,e)}catch(i){throw H.error("Error ending analytics session:",i),i}},j9e=async(n,e,i,o)=>bC(n,e,ho.UNITY.VIDEO_PLAY,{userId:i,category:po.MEDIA_INTERACTION,source:"unity",videoId:o.gameObjectName,videoUrl:o.videoUrl,spaceId:n,...o}),_E=(n,e={})=>{const{user:i}=k.useContext(ls),o=k.useRef(null),[l,u]=k.useState(!1),[f,y]=k.useState(!1),v=k.useRef(!1),b=k.useRef(!1),C=k.useRef(!1),R=k.useRef(!1),{autoStart:O=!0,sessionMetadata:L={},enableDebugLogs:D=!1}=e;k.useEffect(()=>(i&&n&&O&&!o.current&&!C.current&&U(),()=>{o.current&&!R.current&&(D&&H.log("Component unmounting, ending analytics session"),B())}),[i,n,O,D]),k.useEffect(()=>{const q=()=>{document.hidden&&o.current&&!R.current&&(D&&H.log("Page hidden, ending analytics session"),B())},J=()=>{o.current&&!R.current&&(D&&H.log("Page unloading, ending analytics session"),B())};return document.addEventListener("visibilitychange",q),window.addEventListener("beforeunload",J),()=>{document.removeEventListener("visibilitychange",q),window.removeEventListener("beforeunload",J)}},[D]);const U=k.useCallback(async()=>{if(!i||!n||o.current||C.current){D&&H.log("Analytics session already initializing or initialized, skipping");return}try{C.current=!0,y(!0);const q=await V9e(n,i.uid,{unityVersion:window.unityVersion||"unknown",reactVersion:"18.x",startUrl:window.location.href,referrer:document.referrer,...L});o.current=q,u(!0),v.current?D&&H.log(" Analytics: Space entry already tracked for this session, skipping duplicate"):(await bC(n,q,ho.REACT.SPACE_ENTER,{userId:i.uid,category:po.NAVIGATION,source:"react",spaceId:n,timestamp:new Date().toISOString()}),v.current=!0,D&&H.log(` Analytics: Space entry tracked for session ${q}`)),D&&H.log(`Analytics session initialized: ${q} for space ${n}`)}catch(q){H.error("Failed to initialize analytics session:",q),y(!1)}finally{C.current=!1}},[i,n,L,D]),B=k.useCallback(async()=>{if(D&&H.log("endSession called with:",{sessionId:o.current,spaceId:n,sessionIdType:typeof o.current,spaceIdType:typeof n}),!o.current||!n){D&&H.log("endSession: Missing required parameters, skipping",{sessionId:o.current,spaceId:n});return}if(R.current){D&&H.log("endSession: Already ending session, skipping duplicate call");return}try{R.current=!0,b.current?D&&H.log(" Analytics: Space exit already tracked for this session, skipping duplicate"):(await bC(n,o.current,ho.REACT.SPACE_EXIT,{userId:i==null?void 0:i.uid,category:po.NAVIGATION,source:"react",spaceId:n,timestamp:new Date().toISOString()}),b.current=!0,D&&H.log(` Analytics: Space exit tracked for session ${o.current}`));const q=o.current;q&&n&&(await aZ(n,q),D&&H.log(`Analytics session ended: ${q}`)),o.current=null,u(!1),y(!1),v.current=!1,b.current=!1}catch(q){H.error("Failed to end analytics session:",q)}finally{R.current=!1}},[n,i==null?void 0:i.uid,D,bC,aZ]),Y=k.useCallback(async(q,J={})=>{if(!o.current||!n||!f)return D&&H.warn("Cannot track event: No active analytics session"),null;try{const Q=await bC(n,o.current,q,{userId:i==null?void 0:i.uid,spaceId:n,timestamp:new Date().toISOString(),...J});return D&&H.log(`Analytics event tracked: ${q}`,J),Q}catch(Q){return H.error("Failed to track analytics event:",Q),null}},[n,i==null?void 0:i.uid,f,D]),W=k.useCallback(async q=>{if(!o.current||!n||!f)return D&&H.warn("Cannot track video play: No active analytics session"),null;try{const J=await j9e(n,o.current,i==null?void 0:i.uid,q);return D&&H.log("Video play event tracked:",q),J}catch(J){return H.error("Failed to track video play event:",J),null}},[n,i==null?void 0:i.uid,f,D]),ne=k.useCallback(async(q,J={})=>Y(q,{...J,source:"unity",category:J.category||po.USER_BEHAVIOR}),[Y]),le=k.useCallback(async(q,J={})=>Y(q,{...J,source:"react",category:J.category||po.UI_INTERACTION}),[Y]),re=k.useCallback(async(q,J,Q={})=>{const ie=q==="open"?ho.REACT.MODAL_OPEN:ho.REACT.MODAL_CLOSE;return le(ie,{modalName:J,action:q,category:po.UI_INTERACTION,...Q})},[le]),me=k.useCallback(async()=>{o.current&&await B(),await U()},[B,U]);return{isInitialized:l,isTracking:f,sessionId:o.current,track:Y,trackVideoPlay:W,trackUnityEvent:ne,trackReactEvent:le,trackModal:re,initializeSession:U,endSession:B,restartSession:me,isReady:l&&f&&o.current!==null}},F9e=n=>{const[e,i]=k.useState(null),{user:o}=k.useContext(ls),l=jc(),{spaceID:u}=xo(),{trackUnityEvent:f,isReady:y}=_E(u,{enableDebugLogs:!0});return k.useEffect(()=>{let b=!0;const R=l("PlayVideo",async O=>{try{const{gameObjectName:L}=O;if(!L){H.error("Game object name is missing in Unity event data.");return}const D=await Zoe(u);H.log("SPACES VIDEOS",D);const U=D.find(B=>B.id===L);U&&b?(i(U.url),H.log("Video URL set to:",U.url),y&&o&&(f(ho.UNITY.VIDEO_PLAY,{category:po.MEDIA_INTERACTION,videoId:L,videoUrl:U.url,videoTitle:U.title||U.name||L,isEditMode:!1,spaceId:u,timestamp:new Date().toISOString(),videoData:{gameObjectName:L,videoMetadata:U}}),H.log(" Analytics: Video play event tracked for:",L))):console.error("Video not found for game object:",L)}catch(L){console.error("Error fetching space videos:",L)}});return()=>{b=!1,R()}},[l,u,n]),[e,()=>{i(null)}]},B9e=()=>{const[n,e]=k.useState(null),[i,o]=k.useState(!1),[l,u]=k.useState(null),f=jc(),y=za();k.useEffect(()=>f("KickPlayerResult",R=>{H.log("KickPlayerResult event received:",R),R?(e(R),o(!1),R.success?u(null):u(R.errorMessage||"Failed to kick player")):(H.error("Invalid KickPlayerResult data from Unity"),u("Invalid result from Unity"),o(!1))}),[f]);const v=k.useCallback((C,R)=>{var O;try{if(!C){u("Player UID is required");return}o(!0),u(null),e(null);const L={uid:C,requestedBy:R||((O=window.currentUser)==null?void 0:O.uid)};H.log("Sending KickPlayer event to Unity:",L),y("KickPlayer",L)}catch(L){H.error("Error kicking player:",L),u(L.message||"Failed to send kick request"),o(!1)}},[y]),b=k.useCallback(()=>{e(null),u(null),o(!1)},[]);return{kickPlayer:v,isKicking:i,kickResult:n,error:l,resetKickState:b}},z9e=n=>{const{placePortal:e}=Tae();k.useEffect(()=>{const i=async()=>{try{const o=Uc(Xn,"spaces",n,"portals"),l=await hd(o);if(l.empty){H.log("useSpacePortals: No portals found for space:",n);return}H.log(`useSpacePortals: Found ${l.size} portals for space ${n}`),l.forEach(u=>{const f=u.data();H.log(`useSpacePortals: Placing portal ${f.portalId} in Unity:`,f),e(f.portalId,f.prefabName,f.position,f.rotation,f.scale)})}catch(o){H.error("useSpacePortals: Error loading portals:",o)}};if(window.unityInstance)H.log("useSpacePortals: Unity is ready, loading portals"),i();else{const o=()=>{H.log("useSpacePortals: Unity ready event received, loading portals"),i()};return window.addEventListener("PlayerInstantiated",o),()=>{window.removeEventListener("PlayerInstantiated",o)}}},[n,e])},Rae=async(n,e)=>{let i=null,o=null;try{if(!n||!e)throw new Error(`Invalid parameters: spaceId=${n}, portalId=${e}`);const u=_r(Xn,"spaces",n,"portals",e),f=await Xo(u);if(f.exists()){const y=f.data();i=y.targetSpaceId,o=y.targetSpaceName}else{console.warn(" Portal document not found in Firestore for:",e);const y=e.split("_");y.length>=3&&(i=y[2])}}catch(u){console.error(" Error fetching portal data from Firestore:",u);const f=e.split("_");f.length>=3&&(i=f[2])}return{targetSpaceId:i,targetSpaceName:o}},W9e=()=>{const[n,e]=k.useState(null),{user:i}=k.useContext(ls),o=jc(),{spaceID:l}=xo(),{trackUnityEvent:u,isReady:f}=_E(l,{enableDebugLogs:!0});return k.useEffect(()=>{const b=o("PortalClicked",async C=>{try{const R=typeof C=="string"?JSON.parse(C):C;if(e(R),f&&i&&R&&R.portalId)try{const{targetSpaceId:O,targetSpaceName:L}=await Rae(l,R.portalId);await u(ho.UNITY.PORTAL_CLICK,{category:po.NAVIGATION,portalId:R.portalId,targetSpaceId:O,targetSpaceName:L,sourceSpaceId:l,isEditMode:!0,timestamp:new Date().toISOString()})}catch(O){console.error(" Analytics: Error tracking portal click:",O);try{await u(ho.UNITY.PORTAL_CLICK,{category:po.NAVIGATION,portalId:R.portalId,targetSpaceId:null,targetSpaceName:null,sourceSpaceId:l,isEditMode:!0,timestamp:new Date().toISOString()})}catch(L){console.error(" Analytics: Failed to track portal click even with fallback:",L)}}}catch(R){console.error("Error parsing portal click data:",R,"Data:",C)}});return()=>{typeof b=="function"&&b()}},[o,f,i,l,u]),{clickedPortal:n,clearClickedPortal:()=>{e(null)},isAnalyticsReady:f,trackPortalClick:u}},G9e=()=>{const{user:n}=k.useContext(ls),e=jc(),{spaceID:i}=xo(),{trackUnityEvent:o,isReady:l}=_E(i,{enableDebugLogs:!0});k.useEffect(()=>{const f=e("PortalNavigate",async y=>{try{const v=typeof y=="string"?JSON.parse(y):y;if(!v.portalId){console.error("Portal ID is missing from portal data");return}let b=null,C=null;try{const R=await Rae(i,v.portalId);b=R.targetSpaceId,C=R.targetSpaceName}catch(R){console.error("Error fetching portal analytics data:",R);const O=v.portalId.split("_");O.length>=3&&(b=O[2])}if(b){if(l&&n&&v)try{await o(ho.UNITY.PORTAL_NAVIGATE,{category:po.NAVIGATION,portalId:v.portalId,targetSpaceId:b,targetSpaceName:C,sourceSpaceId:i,isEditMode:!1,navigationType:"direct",timestamp:new Date().toISOString()})}catch(R){console.error(" Analytics: Error tracking portal navigation:",R)}window.location.href=`/?spaceId=${b}`}else console.error("Could not determine target space ID from portal:",v.portalId)}catch(v){console.error("Error handling portal navigation:",v)}});return()=>{typeof f=="function"&&f()}},[e,l,n,i,o])},H9e=n=>{const{placeCatalogueItem:e}=Cae(),i=za();k.useEffect(()=>{const o=async()=>{try{const l=Uc(Xn,"spaces",n,"catalogue"),u=await hd(l);u.empty||(H.log(`useSpaceCatalogueItems: Initial load ${u.size} items for space ${n}`),u.forEach(f=>{const y=f.data();e(y.itemId,y.glbUrl,y.position,y.rotation,y.scale)})),Poe(l,f=>{f.docChanges().forEach(y=>{const v=y.doc.data();if(y.type==="added")H.log("useSpaceCatalogueItems: Realtime add",v.itemId),e(v.itemId,v.glbUrl,v.position,v.rotation,v.scale);else if(y.type==="modified")H.log("useSpaceCatalogueItems: Realtime modify",v.itemId),i("UpdateCatalogueItem",{hotspotId:v.itemId,position:v.position,rotation:v.rotation,scale:v.scale});else if(y.type==="removed"){const b=(v==null?void 0:v.itemId)||y.doc.id;H.log("useSpaceCatalogueItems: Realtime remove",b),i("DeleteCatalogueItem",{hotspotId:b})}})})}catch(l){H.error("useSpaceCatalogueItems: Error loading catalogue items:",l)}};if(window.unityInstance)H.log("useSpaceCatalogueItems: Unity is ready, loading catalogue items"),o();else{const l=()=>{H.log("useSpaceCatalogueItems: Unity ready event received, loading catalogue items"),o()};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}}},[n,e,i])},Iae=()=>{const[n,e]=k.useState(null),i=jc();return k.useEffect(()=>{H.log("Setting up seating hotspot click listener...");const u=i("SeatingHotspotClicked",async f=>{H.log(" Seating hotspot click event received from Unity:",f);try{const y=typeof f=="string"?JSON.parse(f):f;H.log(" Parsed Unity click data:",y);const v=y.hotspotId.split("_");if(v.length>=3){const b=v.slice(1,-1).join("_");H.log(" Extracted spaceId:",b);const C=_r(Xn,"spaces",b,"catalogue",y.hotspotId);H.log(" Fetching from Firebase path:",`spaces/${b}/catalogue/${y.hotspotId}`);const R=await Xo(C);if(R.exists()){const O=R.data();H.log(" Fetched Firebase data:",O),H.log(" Firebase position:",O.position),H.log(" Unity position:",y.position);const L={...y,position:O.position||y.position,rotation:O.rotation||y.rotation,scale:O.scale||y.scale};H.log(" Combined data being set:",L),e(L)}else H.warn(" Item not found in Firebase:",y.hotspotId),e(y)}else H.error(" Invalid hotspot ID format:",y.hotspotId),e(y)}catch(y){H.error(" Error handling seating hotspot click:",y,"Data:",f)}});return()=>{H.log("Cleaning up seating hotspot click listener"),typeof u=="function"&&u()}},[i]),{clickedItem:n,clearClickedItem:()=>{H.log("Clearing clicked item state"),e(null)}}},$9e=n=>({opacity:1});function K9e(){const{loadingProgression:n,isLoaded:e,error:i,spaceID:o}=xo(),{user:l}=k.useContext(ls),[u,f]=k.useState(!1),[y,v]=k.useState(!1),[b,C]=k.useState(!1),[R,O]=k.useState(!1),L=k.useRef(!1),D=k.useRef(!1),U=k.useRef(null),B=k.useRef(null),Y=k.useRef(null),W=jc(),ne=k.useRef(null),le=k.useRef(null),re=k.useRef(null);k.useRef(null),k.useEffect(()=>{(async()=>{if(!l&&n===0)try{const Q=await mo(o);Q&&Q.allowGuestUsers===!0?f(!1):f(!0)}catch(Q){console.error("LoaderProgress: Cannot verify space guest access, showing sign-in prompt for security:",Q),f(!0)}else f(!1)})()},[l,n,o]),k.useEffect(()=>{const J=document.createElement("style");return J.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(J),ne.current=J,()=>{ne.current&&document.head.removeChild(ne.current)}},[]),k.useEffect(()=>{const J=()=>{const Q=document.getElementById("unity-canvas"),ie=document.getElementById("unity-container");Q&&(U.current=Q,Q.style.zIndex="1"),ie&&(B.current=ie,ie.style.zIndex="1"),Q&&ie&&re.current&&(clearInterval(re.current),re.current=null)};return J(),re.current=setInterval(J,100),()=>{re.current&&(clearInterval(re.current),re.current=null)}},[]),k.useEffect(()=>{window.isFirstSceneLoaded&&(D.current=!0,O(!0));const Q=W("FirstSceneLoaded",()=>{D.current=!0,O(!0),window.isFirstSceneLoaded=!0}),ie=setTimeout(()=>{D.current||(D.current=!0,O(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{Q(),clearTimeout(ie)}},[W]),k.useEffect(()=>{window.isPlayerInstantiated&&(L.current=!0,C(!0),D.current||(D.current=!0,O(!0),window.isFirstSceneLoaded=!0));const J=()=>{L.current=!0,C(!0),D.current||(D.current=!0,O(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",J);const Q=W("PlayerInstantiated",J),ie=setTimeout(()=>{L.current||(L.current=!0,C(!0),D.current||(D.current=!0,O(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",J),Q(),clearTimeout(ie)}},[W]),k.useEffect(()=>(R&&b&&(le.current&&clearTimeout(le.current),le.current=setTimeout(()=>{U.current&&(U.current.style.opacity="1",U.current.style.removeProperty("opacity")),B.current&&(B.current.style.opacity="1",B.current.style.removeProperty("opacity")),Y.current&&(Y.current.style.opacity="0",Y.current.style.pointerEvents="none",setTimeout(()=>{Y.current&&(Y.current.style.display="none")},1500))},2e3)),()=>{le.current&&clearTimeout(le.current)}),[R,b]);const me=()=>e?e&&!R&&!b?"Scene initializing":R&&!b?"Player initializing":"Ready":"World loading",q=()=>e?e&&!R&&!b?85:R&&!b?95:100:n*80;return S.jsx(S.Fragment,{children:u?S.jsx($e,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:S.jsxs(hr,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[S.jsx(qe,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),S.jsx(qe,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),S.jsx($n,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>v(!0),children:"Sign In"})]})}):S.jsx($e,{ref:Y,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:S.jsxs(Mi,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[S.jsx(qe,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),S.jsx(qe,{fontSize:"sm",children:me()}),S.jsx(Hy,{value:q(),size:"lg",width:"100%",marginY:2})]})})})}function Aae({mode:n="button",label:e="Sign Out"}){const i=Ea(),{signOut:o}=k.useContext(ls),{fullscreenRef:l}=vh(),u=async()=>{try{await o(),i({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(y){console.error("SignOut Error:",y),i({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},f=n==="link"?S.jsx(uu,{variant:"header",onClick:u,style:{cursor:"pointer"},children:e}):null;return S.jsx(S.Fragment,{children:f})}Aae.propTypes={mode:Nn.oneOf(["button","link"]),label:Nn.string};function q9e(){const{user:n,currentUser:e,isGuestUser:i}=k.useContext(ls),[o,l]=k.useState(!1),[u,f]=k.useState(!1),[y,v]=k.useState(!0),[b,C]=k.useState(null);return k.useEffect(()=>{const O=(()=>{try{const L=document.getElementById("webgl-root");if(L){const W=L.getAttribute("data-space-id");if(W)return W}const U=window.location.pathname.match(/\/(w|embed)\/([^\/]+)/);if(U)return U[2];const B=new URLSearchParams(window.location.search),Y=B.get("spaceId")||B.get("space");return Y||null}catch(L){return console.error("AuthenticationButton: Error getting space ID:",L),null}})();C(O)},[]),k.useEffect(()=>{const R=async()=>{if(b)try{const L=await mo(b);l((L==null?void 0:L.allowGuestUsers)||!1),f((L==null?void 0:L.hideGuestSignInButton)||!1),v((L==null?void 0:L.showAuthButton)!==void 0?L.showAuthButton:!0)}catch(L){console.error("AuthenticationButton: Error fetching space data:",L),l(!1),f(!1)}};R();const O=()=>{R()};return window.addEventListener("SpaceSettingsChanged",O),()=>{window.removeEventListener("SpaceSettingsChanged",O)}},[b]),n&&e&&!i(e)?y?S.jsx("div",{children:S.jsx(Aae,{})}):null:e&&i(e)?u?null:S.jsx("div",{children:S.jsx(wR,{mode:"button",label:"Sign In",buttonProps:{bg:"black",color:"white",borderRadius:"lg",_hover:{bg:"gray.800"},_active:{bg:"gray.900"}}})}):o||!y?null:S.jsxs("div",{children:[S.jsx(xF,{}),S.jsx(wR,{})]})}function Y9e(){const{fullscreenRef:n}=vh(),[e,i]=k.useState(!1),o=()=>{i(!e)};return S.jsxs(S.Fragment,{children:[S.jsx(Ff,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:S.jsx(ya,{"aria-label":"Controller Help",icon:S.jsx(qze,{}),onClick:o,variant:"iconButton"})}),S.jsxs(Is,{isOpen:e,onClose:o,size:"md",portalProps:{containerRef:n},children:[S.jsx(Os,{}),S.jsxs(As,{children:[S.jsx(Jo,{children:"Notes"}),S.jsx($s,{}),S.jsx(Ps,{children:S.jsx(qe,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),S.jsx(gh,{children:S.jsx($n,{variant:"primary",onClick:o,children:"Close"})})]})]})]})}function Pae({open:n,onClose:e}){const i=k.useRef(null),o=za(),{user:l}=k.useContext(ls),u=v=>{i.current&&!i.current.contains(v.target)&&e()},f=async v=>{const b=y(v);if((b==null?void 0:b.source)==="readyplayerme"&&(b.eventName==="v1.frame.ready"&&i.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),b.eventName==="v1.avatar.exported")){const C=b.data.url;if(o("AvatarUrlFromReact",{url:C}),l&&l.uid)try{await Loe(l.uid,C),e()}catch(R){console.error("Error updating RPM URL:",R)}else console.error("No authenticated user found to update rpmURL.")}},y=v=>{try{return JSON.parse(v.data)}catch{return null}};return k.useEffect(()=>(n&&(document.addEventListener("mousedown",u),window.addEventListener("message",f)),()=>{document.removeEventListener("mousedown",u),window.removeEventListener("message",f)}),[n]),n&&S.jsx(Al,{children:S.jsx($e,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:v=>v.stopPropagation(),children:S.jsx($e,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:S.jsx("iframe",{ref:i,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function X9e({isOpen:n,onClose:e}){const[i,o]=k.useState(!1),[l,u]=k.useState(null),{user:f}=k.useContext(ls),y=za(),v=D=>{D.stopPropagation(),o(!0)},b=()=>{o(!1),e()},C=async D=>{if(u(D),f&&f.uid)try{await Loe(f.uid,D.url),y("AvatarUrlFromReact",{url:D.url}),e()}catch(U){console.error("Error updating RPM URL:",U)}else console.error("No authenticated user found to update rpmURL.")},R=Rg("gray.200","whiteAlpha.300"),O="rgba(0, 0, 0, 0.3)",L=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return S.jsxs(S.Fragment,{children:[S.jsx(Al,{children:S.jsxs(Is,{isOpen:n,onClose:e,isCentered:!0,size:"xl",zIndex:9999,children:[S.jsx(Os,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(As,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",maxW:"900px",children:[S.jsx(Jo,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",children:"Customise Your Avatar"}),S.jsx($s,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(Ps,{pb:4,children:S.jsxs(hr,{spacing:4,align:"stretch",children:[S.jsx(qe,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),S.jsxs(oj,{columns:5,spacing:2,children:[S.jsx($e,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:R,borderRadius:"lg",overflow:"hidden",onClick:v,_hover:{bg:O},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:S.jsxs(hr,{spacing:1,children:[S.jsx(Zt,{as:_9e,boxSize:4}),S.jsx(qe,{fontSize:"xs",children:"Create Custom Avatar"})]})}),L.map(D=>S.jsxs($e,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===D.id?"blue.400":R,borderRadius:"lg",overflow:"hidden",onClick:()=>C(D),_hover:{bg:O},transition:"all 0.2s",aspectRatio:"1",children:[S.jsx(Cp,{src:D.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:D.name,width:"100%",height:"100%",objectFit:"cover"}),S.jsx($e,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:S.jsx(qe,{fontSize:"xs",children:D.name})})]},D.id))]})]})})]})]})}),i&&S.jsx(Pae,{open:i,onClose:b})]})}function J9e(){const{fullscreenRef:n}=vh(),[e,i]=k.useState(!1),[o,l]=k.useState(!1),[u,f]=k.useState(!1),[y,v]=k.useState(!1),{user:b,currentUser:C,isGuestUser:R}=k.useContext(ls),[O,L]=k.useState(null),[D,U]=k.useState(!0),B=(re,me)=>!re||!me?"?":`${re.charAt(0)}${me.charAt(0)}`.toUpperCase(),Y=re=>{if(!re)return"G";if(re.startsWith("Visitor_")){const me=re.split("_")[1];return`V${me?me.charAt(0):""}`}return re.charAt(0).toUpperCase()},W=async()=>{if(U(!0),b!=null&&b.uid)try{const re=await Vc(b.uid);L({rpmURL:re.rpmURL?re.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:re.firstName,lastName:re.lastName,isGuest:!1})}catch(re){console.error("Error fetching profile data:",re)}else C&&R(C)&&L({rpmURL:C.rpmURL?C.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:"Guest",lastName:"User",username:C.username||C.Nickname,isGuest:!0});U(!1)};k.useEffect(()=>{W()},[b==null?void 0:b.uid,C==null?void 0:C.uid,C==null?void 0:C.rpmURL]),k.useEffect(()=>{const re=()=>{i(!0)};return window.addEventListener("PlayerInstantiated",re),()=>{window.removeEventListener("PlayerInstantiated",re)}},[]);const ne=()=>l(!o),le=()=>{l(!1),W()};return e?S.jsxs(S.Fragment,{children:[S.jsx(Ff,{label:O!=null&&O.isGuest?"Guest Avatar":"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:y,portalProps:{containerRef:n},children:S.jsxs($e,{position:"relative",onMouseEnter:()=>{f(!0),v(!0)},onMouseLeave:()=>{f(!1),v(!1)},cursor:O!=null&&O.isGuest?"default":"pointer",onClick:O!=null&&O.isGuest?void 0:ne,children:[S.jsx(cd,{src:D||O==null?void 0:O.rpmURL,size:"md",borderRadius:"full",bg:"white",name:!D&&O?O.isGuest?Y(O.username):B(O.firstName,O.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),u&&!(O!=null&&O.isGuest)&&S.jsx($e,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:S.jsx(qe,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),S.jsx(X9e,{isOpen:o,onClose:le})]}):null}function Q9e(n){return ir({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function Z9e(n){return ir({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function eWe(){const{isFullscreen:n,toggleFullscreen:e,fullscreenRef:i,isMobile:o}=vh(),l=Ea();k.useEffect(()=>{const f=y=>{console.error("Fullscreen error:",y),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",f),document.addEventListener("webkitfullscreenerror",f),document.addEventListener("mozfullscreenerror",f),document.addEventListener("MSFullscreenError",f),()=>{document.removeEventListener("fullscreenerror",f),document.removeEventListener("webkitfullscreenerror",f),document.removeEventListener("mozfullscreenerror",f),document.removeEventListener("MSFullscreenError",f)}},[l]);const u=()=>{i.current?(o&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),e()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return S.jsx(Ff,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:i},children:S.jsx(ya,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?S.jsx(Q9e,{}):S.jsx(Z9e,{}),onClick:u,variant:"iconButton",size:o?"lg":"md"})})}const cZ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function tWe(){const{isOpen:n,onOpen:e,onClose:i}=pd(),{fullscreenRef:o}=vh(),[l,u]=F9e(!1),{user:f}=k.useContext(ls),{spaceID:y}=xo(),{trackReactEvent:v,isReady:b}=_E(y,{enableDebugLogs:!0});k.useEffect(()=>{H.log("VideoPlayer: Current video URL:",l),l&&(H.log("VideoPlayer: Opening modal for video URL:",l),e(),b&&f&&(v(ho.REACT.VIDEO_CLICK,{category:po.MEDIA_INTERACTION,action:"video_player_open",videoUrl:l,context:"video_player_modal",spaceId:y,timestamp:new Date().toISOString()}),H.log(" Analytics: Video click event tracked for modal open:",l)))},[l,e,v,b,f,y]);const C=()=>{H.log("VideoPlayer: Closing modal"),b&&f&&l&&(v(ho.REACT.VIDEO_CLOSE,{category:po.MEDIA_INTERACTION,action:"video_player_close",videoUrl:l,context:"video_player_modal",spaceId:y,timestamp:new Date().toISOString()}),H.log(" Analytics: Video close event tracked for modal close:",l)),u(),i()};return S.jsx(Al,{containerRef:o,children:S.jsxs(Is,{isOpen:n,onClose:C,size:"lg",isCentered:!0,portalProps:{containerRef:o},children:[S.jsx(Os,{bg:"rgba(0, 0, 0, 0.8)"}),S.jsxs(As,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[S.jsx($s,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),S.jsx(Ps,{p:0,width:"100%",children:l&&S.jsx($e,{style:cZ.iframeContainer,children:S.jsx("iframe",{src:l,style:cZ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function nWe({isOpen:n,onClose:e,playerName:i,playerId:o,uid:l}){const[u,f]=k.useState(null),[y,v]=k.useState(!0),[b,C]=k.useState(null),R=()=>{const L=window.location.pathname.split("/");return L[L.length-1]||window.spaceID||"default-space-id"};k.useEffect(()=>{n&&(async()=>{var D,U;if(v(!0),C(null),!l){H.warn("NameplateModal: No UID provided for player:",i),C("No user ID available for this player"),v(!1);return}try{H.log("NameplateModal: Fetching profile for UID:",l);const B=await Vc(l);if(!B)C("Could not find profile data for this player");else{const Y=R(),W=`space_${Y}_owners`,ne=`space_${Y}_hosts`,le=(D=B.groups)!=null&&D.includes(W)?"owner":(U=B.groups)!=null&&U.includes(ne)?"host":null;f({firstName:B.firstName,lastName:B.lastName,linkedInProfile:B.linkedInProfile,websiteUrl:B.websiteUrl,rpmURL:B.rpmURL?B.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,role:le})}}catch(B){H.error("Error fetching profile data:",B),C("Error loading profile data")}finally{v(!1)}})()},[l,n,i]);const O=({role:L})=>L==="owner"?S.jsxs(Cn,{spacing:1,bg:"green.800",px:3,py:1,borderRadius:"md",children:[S.jsx(Zt,{as:Uk,color:"green.300"}),S.jsx(Dc,{colorScheme:"green",variant:"solid",children:"Owner"})]}):L==="host"?S.jsxs(Cn,{spacing:1,bg:"purple.800",px:3,py:1,borderRadius:"md",children:[S.jsx(Zt,{as:Vk,color:"purple.300"}),S.jsx(Dc,{colorScheme:"purple",variant:"solid",children:"Host"})]}):null;return S.jsxs(Is,{isOpen:n,onClose:e,isCentered:!0,size:"md",children:[S.jsx(Os,{backdropFilter:"blur(4px)"}),S.jsxs(As,{bg:"rgba(0,0,0,0.85)",color:"white",border:"none",borderRadius:"xl",children:[S.jsx($s,{}),S.jsx(Ps,{p:6,children:y?S.jsx(Rne,{py:8,children:S.jsx(_d,{size:"xl",color:"blue.400"})}):b?S.jsxs(Jy,{status:"warning",variant:"solid",borderRadius:"md",children:[S.jsx(Qy,{}),b]}):S.jsxs(hr,{align:"center",spacing:3,children:[S.jsx(cd,{size:"lg",src:u==null?void 0:u.rpmURL,bg:"whiteAlpha.400",name:i}),S.jsx(qe,{fontWeight:"bold",children:i}),S.jsx(O,{role:u==null?void 0:u.role}),(u==null?void 0:u.firstName)&&S.jsxs(qe,{fontSize:"sm",color:"gray.300",children:[u.firstName," ",u.lastName]}),S.jsxs(Cn,{spacing:4,pt:2,children:[(u==null?void 0:u.linkedInProfile)&&S.jsx(uu,{href:u.linkedInProfile,isExternal:!0,children:S.jsx(Zt,{as:gae,boxSize:5})}),(u==null?void 0:u.websiteUrl)&&S.jsx(uu,{href:u.websiteUrl,isExternal:!0,children:S.jsx(Zt,{as:yae,boxSize:5})})]})]})})]})]})}const rWe=({isVisible:n,onToggleVisibility:e,spaceID:i})=>{const[o]=JDe("(max-width: 768px)"),[l,u]=k.useState(!1);k.useEffect(()=>{u(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent||""))},[]);const f=o||l,y=wae(),[v,b]=k.useState(!1),[C,R]=k.useState([]),[O,L]=k.useState(!1),[D,U]=k.useState({}),[B,Y]=k.useState({}),[W,ne]=k.useState(!1),le=Ea(),[re,me]=k.useState(null),[q,J]=k.useState(null),{isOpen:Q,onOpen:ie,onClose:pe}=pd(),[de,he]=k.useState(null),{isOpen:Se,onOpen:Ie,onClose:Fe}=pd(),[we,Re]=k.useState(null),Te=window.currentUser||{},be=i||window.spaceID||window.location.pathname.split("/").pop()||"fallback-space-id";k.useEffect(()=>{mo(be).then(st=>ne(!!(st!=null&&st.voiceDisabled)))},[be]),k.useEffect(()=>{const st=()=>b(!0);return window.addEventListener("PlayerInstantiated",st),window.isPlayerInstantiated&&b(!0),()=>window.removeEventListener("PlayerInstantiated",st)},[]),k.useEffect(()=>{const st={};y.forEach(hn=>{var an;hn.uid&&((an=window.agoraClient)!=null&&an.client)&&(st[hn.uid]=hn.isLocalPlayer?window.agoraClient.client.uid:hn.uid)}),Y(st)},[y]),k.useEffect(()=>{const st=setInterval(()=>{var hn;if(window.agoraClient){L(!!window.agoraClient.isVoiceEnabled);const an={};(hn=window.agoraClient.client)==null||hn.remoteUsers.forEach(jt=>{an[jt.uid]=!!jt.audioTrack&&!jt.audioTrack.muted}),U(an)}},500);return()=>clearInterval(st)},[]),k.useEffect(()=>{(async()=>{const hn=await Promise.all(y.map(async an=>{var jt,on;if(!an.uid)return an;try{const St=await Vc(an.uid),ve=`space_${be}_owners`,De=`space_${be}_hosts`,Ke=(jt=St.groups)!=null&&jt.includes(ve)?"owner":(on=St.groups)!=null&&on.includes(De)?"host":null,Ot=St.rpmURL?St.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):void 0;return{...an,...St,rpmURL:Ot,role:Ke}}catch{return an}}));R(hn)})()},[y,be]);const{kickPlayer:xe,isKicking:je,kickResult:nt,error:dt,resetKickState:ft}=B9e();k.useEffect(()=>{nt!=null&&nt.success&&(re||we)&&(re&&(le({title:"Remove Successful",description:`${re} has been removed.`,status:"success",duration:3e3,isClosable:!0}),me(null)),we&&(le({title:"Ban Successful",description:`${we} has been banned.`,status:"success",duration:3e3,isClosable:!0}),Re(null)),ft()),dt&&(le({title:"Error",description:dt,status:"error",duration:3e3,isClosable:!0}),me(null),Re(null),ft())},[nt,dt,re,we,le,ft]);const lt=st=>st.isLocalPlayer||st.uid===Te.uid,gt=st=>lt(st)?O:D[B[st.uid]],at=({role:st})=>st==="owner"?S.jsx(Zt,{as:Uk,color:"green.400",boxSize:3,ml:1}):st==="host"?S.jsx(Zt,{as:Vk,color:"purple.400",boxSize:3,ml:1}):null,Ct=({role:st})=>st==="owner"?S.jsxs(Cn,{spacing:1,bg:"green.800",px:3,py:1,borderRadius:"md",children:[S.jsx(Zt,{as:Uk,color:"green.300"}),S.jsx(Dc,{colorScheme:"green",variant:"solid",children:"Owner"})]}):st==="host"?S.jsxs(Cn,{spacing:1,bg:"purple.800",px:3,py:1,borderRadius:"md",children:[S.jsx(Zt,{as:Vk,color:"purple.300"}),S.jsx(Dc,{colorScheme:"purple",variant:"solid",children:"Host"})]}):null,En=()=>{q&&(me(q.playerName),xe(q.uid,Te.uid),pe())},Gt=async()=>{de&&(Re(de.playerName),await X8e(be,{uid:de.uid,playerName:de.playerName,bannedAt:new Date().toISOString(),...Te.uid&&{bannedBy:Te.uid}}),xe(de.uid,Te.uid),Fe())},Xt=(st,hn)=>{var jt;if(!(((jt=C.find(on=>on.isLocalPlayer))==null?void 0:jt.role)==="owner"))return le({title:"Permission Denied",status:"error",duration:3e3,isClosable:!0});st==="remove"?(J(hn),ie()):st==="ban"&&(he(hn),Ie())};return S.jsxs(S.Fragment,{children:[S.jsxs($e,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:v&&n&&!f?"visible":"hidden",role:"group",children:[S.jsx($e,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:S.jsx(ya,{icon:S.jsx(Kze,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:e})}),S.jsxs(qe,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",y.length]}),S.jsx($e,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:S.jsx(hr,{align:"stretch",spacing:1,width:"100%",children:C.sort((st,hn)=>st.isLocalPlayer?-1:hn.isLocalPlayer?1:0).map((st,hn)=>{var St;const an=lt(st),jt=((St=C.find(ve=>ve.isLocalPlayer))==null?void 0:St.role)==="owner"&&!an&&st.role!=="owner",on=!W&&gt(st);return S.jsx($e,{children:S.jsxs(Ure,{placement:"left",trigger:"hover",children:[S.jsx(zre,{children:S.jsxs(Cn,{p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},children:[S.jsx(cd,{size:"xs",bg:"whiteAlpha.400",src:st.rpmURL,name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),S.jsx(qe,{fontSize:"xs",children:st.playerName}),S.jsx(at,{role:st.role}),S.jsx(MC,{}),!W&&(on?S.jsx($e,{color:"green.400",children:S.jsx(vae,{})}):S.jsx($e,{color:"red.400",children:S.jsx(Eae,{})})),an?S.jsx(qe,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"}):jt?S.jsxs(XS,{children:[S.jsx(JS,{as:ya,"aria-label":"Options",icon:S.jsx(_ae,{}),variant:"ghost",size:"xs",color:"gray.300",ml:1,minW:"16px",h:"16px",p:0}),S.jsxs(QS,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[S.jsx(NS,{icon:S.jsx(S9e,{}),onClick:()=>Xt("remove",st),bg:"black",color:"white",_hover:{bg:"gray.800"},fontSize:"sm",children:"Remove"}),S.jsx(NS,{icon:S.jsx(c9e,{}),onClick:()=>Xt("ban",st),bg:"black",color:"white",_hover:{bg:"gray.800"},fontSize:"sm",children:"Ban"})]})]}):null]})}),S.jsx(Bre,{bg:"rgba(0,0,0,0.85)",color:"white",border:"none",p:4,minW:"220px",children:S.jsx(jre,{children:S.jsxs(hr,{align:"center",spacing:3,children:[S.jsx(cd,{size:"lg",src:st.rpmURL}),S.jsx(qe,{fontWeight:"bold",children:st.playerName}),S.jsx(Ct,{role:st.role}),st.firstName&&S.jsxs(qe,{fontSize:"sm",color:"gray.300",children:[st.firstName," ",st.lastName]}),S.jsxs(Cn,{spacing:4,pt:2,children:[st.linkedInProfile&&S.jsx(uu,{href:st.linkedInProfile,isExternal:!0,children:S.jsx(Zt,{as:gae})}),st.websiteUrl&&S.jsx(uu,{href:st.websiteUrl,isExternal:!0,children:S.jsx(Zt,{as:yae})})]})]})})})]})},hn)})})})]}),S.jsxs(Is,{isOpen:Q,onClose:pe,isCentered:!0,children:[S.jsx(Os,{}),S.jsxs(As,{bg:"gray.800",color:"white",children:[S.jsx(Jo,{children:"Confirm Removal"}),S.jsx($s,{}),S.jsx(Ps,{children:S.jsxs(qe,{children:["Remove ",q==null?void 0:q.playerName," from the room?"]})}),S.jsxs(gh,{children:[S.jsx($n,{colorScheme:"red",onClick:En,isLoading:je,mr:3,children:"Remove"}),S.jsx($n,{bg:"white",color:"gray.800",onClick:pe,_hover:{bg:"gray.200"},children:"Cancel"})]})]})]}),S.jsxs(Is,{isOpen:Se,onClose:Fe,isCentered:!0,children:[S.jsx(Os,{}),S.jsxs(As,{bg:"gray.800",color:"white",children:[S.jsx(Jo,{children:"Confirm Ban"}),S.jsx($s,{}),S.jsx(Ps,{children:S.jsxs(qe,{children:["Ban ",de==null?void 0:de.playerName," from the room? They will not be able to re-enter."]})}),S.jsxs(gh,{children:[S.jsx($n,{colorScheme:"red",onClick:Gt,isLoading:je,mr:3,children:"Ban"}),S.jsx($n,{bg:"white",color:"gray.800",onClick:Fe,_hover:{bg:"gray.200"},children:"Cancel"})]})]})]})]})};var HO={exports:{}},iWe=HO.exports,lZ;function sWe(){return lZ||(lZ=1,(function(n,e){(function(i,o){n.exports=o()})(iWe,(function(){function i(t,r){return r.forEach((function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach((function(a){if(a!=="default"&&!(a in t)){var c=Object.getOwnPropertyDescriptor(s,a);Object.defineProperty(t,a,c.get?c:{enumerable:!0,get:function(){return s[a]}})}}))})),Object.freeze(t)}var o=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Py<"u"?Py:typeof self<"u"?self:{};function l(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var u=function(t){try{return!!t()}catch{return!0}},f=!u((function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")})),y=f,v=Function.prototype,b=v.call,C=y&&v.bind.bind(b,b),R=y?C:function(t){return function(){return b.apply(t,arguments)}},O=R({}.isPrototypeOf),L=function(t){return t&&t.Math===Math&&t},D=L(typeof globalThis=="object"&&globalThis)||L(typeof window=="object"&&window)||L(typeof self=="object"&&self)||L(typeof o=="object"&&o)||L(typeof o=="object"&&o)||(function(){return this})()||Function("return this")(),U=f,B=Function.prototype,Y=B.apply,W=B.call,ne=typeof Reflect=="object"&&Reflect.apply||(U?W.bind(Y):function(){return W.apply(Y,arguments)}),le=R,re=le({}.toString),me=le("".slice),q=function(t){return me(re(t),8,-1)},J=q,Q=R,ie=function(t){if(J(t)==="Function")return Q(t)},pe=typeof document=="object"&&document.all,de=pe===void 0&&pe!==void 0?function(t){return typeof t=="function"||t===pe}:function(t){return typeof t=="function"},he={},Se=!u((function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})),Ie=f,Fe=Function.prototype.call,we=Ie?Fe.bind(Fe):function(){return Fe.apply(Fe,arguments)},Re={},Te={}.propertyIsEnumerable,Ne=Object.getOwnPropertyDescriptor,be=Ne&&!Te.call({1:2},1);Re.f=be?function(t){var r=Ne(this,t);return!!r&&r.enumerable}:Te;var xe,je,nt=function(t,r){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},dt=u,ft=q,lt=Object,gt=R("".split),at=dt((function(){return!lt("z").propertyIsEnumerable(0)}))?function(t){return ft(t)==="String"?gt(t,""):lt(t)}:lt,Ct=function(t){return t==null},En=Ct,Gt=TypeError,Xt=function(t){if(En(t))throw new Gt("Can't call method on "+t);return t},st=at,hn=Xt,an=function(t){return st(hn(t))},jt=de,on=function(t){return typeof t=="object"?t!==null:jt(t)},St={},ve=St,De=D,Ke=de,Ot=function(t){return Ke(t)?t:void 0},Et=function(t,r){return arguments.length<2?Ot(ve[t])||Ot(De[t]):ve[t]&&ve[t][r]||De[t]&&De[t][r]},Pt=D.navigator,Ut=Pt&&Pt.userAgent,cn=Ut?String(Ut):"",_t=D,wn=cn,Nt=_t.process,Ht=_t.Deno,Lr=Nt&&Nt.versions||Ht&&Ht.version,wi=Lr&&Lr.v8;wi&&(je=(xe=wi.split("."))[0]>0&&xe[0]<4?1:+(xe[0]+xe[1])),!je&&wn&&(!(xe=wn.match(/Edge\/(\d+)/))||xe[1]>=74)&&(xe=wn.match(/Chrome\/(\d+)/))&&(je=+xe[1]);var ti=je,Vi=ti,us=u,_o=D.String,Wr=!!Object.getOwnPropertySymbols&&!us((function(){var t=Symbol("symbol detection");return!_o(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&Vi&&Vi<41})),Do=Wr&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Fc=Et,Yr=de,yo=O,Ys=Object,Zi=Do?function(t){return typeof t=="symbol"}:function(t){var r=Fc("Symbol");return Yr(r)&&yo(r.prototype,Ys(t))},Bc=String,Eo=function(t){try{return Bc(t)}catch{return"Object"}},yu=de,Wa=Eo,Ns=TypeError,Kt=function(t){if(yu(t))return t;throw new Ns(Wa(t)+" is not a function")},zc=Kt,Zo=Ct,Ga=function(t,r){var s=t[r];return Zo(s)?void 0:zc(s)},Wc=we,ea=de,ta=on,yd=TypeError,Sh={exports:{}},Pl=D,bh=Object.defineProperty,xs=D,Ol=function(t,r){try{bh(Pl,t,{value:r,configurable:!0,writable:!0})}catch{Pl[t]=r}return r},na="__core-js_shared__",Ed=Sh.exports=xs[na]||Ol(na,{});(Ed.versions||(Ed.versions=[])).push({version:"3.42.0",mode:"pure",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var kl=Sh.exports,Nl=kl,va=function(t,r){return Nl[t]||(Nl[t]=r||{})},xl=Xt,wh=Object,Xs=function(t){return wh(xl(t))},Xr=Xs,Th=R({}.hasOwnProperty),Mr=Object.hasOwn||function(t,r){return Th(Xr(t),r)},mc=R,ra=0,vd=Math.random(),Je=mc(1 .toString),qt=function(t){return"Symbol("+(t===void 0?"":t)+")_"+Je(++ra+vd,36)},Kn=va,$i=Mr,gs=qt,Gc=Wr,Ch=Do,gc=D.Symbol,Hc=Kn("wks"),Dl=Ch?gc.for||gc:gc&&gc.withoutSetter||gs,Cr=function(t){return $i(Hc,t)||(Hc[t]=Gc&&$i(gc,t)?gc[t]:Dl("Symbol."+t)),Hc[t]},Ll=we,_c=on,Ki=Zi,li=Ga,Gr=function(t,r){var s,a;if(ea(s=t.toString)&&!ta(a=Wc(s,t))||ea(s=t.valueOf)&&!ta(a=Wc(s,t)))return a;throw new yd("Can't convert object to primitive value")},Ml=TypeError,Eu=Cr("toPrimitive"),ui=function(t,r){if(!_c(t)||Ki(t))return t;var s,a=li(t,Eu);if(a){if(s=Ll(a,t,r),!_c(s)||Ki(s))return s;throw new Ml("Can't convert object to primitive value")}return Gr(t)},vu=Zi,yr=function(t){var r=ui(t,"string");return vu(r)?r:r+""},Ul=on,Rh=D.document,Ih=Ul(Rh)&&Ul(Rh.createElement),Su=function(t){return Ih?Rh.createElement(t):{}},sm=Su,Gp=!Se&&!u((function(){return Object.defineProperty(sm("div"),"a",{get:function(){return 7}}).a!==7})),Hp=Se,Sa=we,_s=Re,ba=nt,wa=an,bu=yr,Ta=Mr,Ha=Gp,$p=Object.getOwnPropertyDescriptor;he.f=Hp?$p:function(t,r){if(t=wa(t),r=bu(r),Ha)try{return $p(t,r)}catch{}if(Ta(t,r))return ba(!Sa(_s.f,t,r),t[r])};var $c=u,Ds=de,Jg=/#|\.prototype\./,Vl=function(t,r){var s=wu[jl(t)];return s===yc||s!==om&&(Ds(r)?$c(r):!!r)},jl=Vl.normalize=function(t){return String(t).replace(Jg,".").toLowerCase()},wu=Vl.data={},om=Vl.NATIVE="N",yc=Vl.POLYFILL="P",Ca=Vl,Fl=Kt,Ce=f,Me=ie(ie.bind),ct=function(t,r){return Fl(t),r===void 0?t:Ce?Me(t,r):function(){return t.apply(r,arguments)}},Yt={},ar=Se&&u((function(){return Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype!==42})),Ur=on,si=String,tr=TypeError,nr=function(t){if(Ur(t))return t;throw new tr(si(t)+" is not an object")},Pi=Se,Js=Gp,Kc=ar,Lo=nr,Tu=yr,Ls=TypeError,Ec=Object.defineProperty,am=Object.getOwnPropertyDescriptor,qc="enumerable",Qg="configurable",Ah="writable";Yt.f=Pi?Kc?function(t,r,s){if(Lo(t),r=Tu(r),Lo(s),typeof t=="function"&&r==="prototype"&&"value"in s&&Ah in s&&!s[Ah]){var a=am(t,r);a&&a[Ah]&&(t[r]=s.value,s={configurable:Qg in s?s[Qg]:a[Qg],enumerable:qc in s?s[qc]:a[qc],writable:!1})}return Ec(t,r,s)}:Ec:function(t,r,s){if(Lo(t),r=Tu(r),Lo(s),Js)try{return Ec(t,r,s)}catch{}if("get"in s||"set"in s)throw new Ls("Accessors not supported");return"value"in s&&(t[r]=s.value),t};var Sd=Yt,Ph=nt,vc=Se?function(t,r,s){return Sd.f(t,r,Ph(1,s))}:function(t,r,s){return t[r]=s,t},Cu=D,Zg=ne,yE=ie,cm=de,lm=he.f,EE=Ca,$a=St,vE=ct,bd=vc,e_=Mr,t_=function(t){var r=function(s,a,c){if(this instanceof r){switch(arguments.length){case 0:return new t;case 1:return new t(s);case 2:return new t(s,a)}return new t(s,a,c)}return Zg(t,this,arguments)};return r.prototype=t.prototype,r},Hn=function(t,r){var s,a,c,d,h,m,g,E,w,I=t.target,A=t.global,N=t.stat,G=t.proto,F=A?Cu:N?Cu[I]:Cu[I]&&Cu[I].prototype,z=A?$a:$a[I]||bd($a,I,{})[I],ee=z.prototype;for(d in r)a=!(s=EE(A?d:I+(N?".":"#")+d,t.forced))&&F&&e_(F,d),m=z[d],a&&(g=t.dontCallGetSet?(w=lm(F,d))&&w.value:F[d]),h=a&&g?g:r[d],(s||G||typeof m!=typeof h)&&(E=t.bind&&a?vE(h,Cu):t.wrap&&a?t_(h):G&&cm(h)?yE(h):h,(t.sham||h&&h.sham||m&&m.sham)&&bd(E,"sham",!0),bd(z,d,E),G&&(e_($a,c=I+"Prototype")||bd($a,c,{}),bd($a[c],d,h),t.real&&ee&&(s||!ee[d])&&bd(ee,d,h)))},Ra=Math.ceil,SE=Math.floor,bE=Math.trunc||function(t){var r=+t;return(r>0?SE:Ra)(r)},Ru=bE,P=function(t){var r=+t;return r!=r||r===0?0:Ru(r)},$=P,se=Math.max,Ee=Math.min,Ye=function(t,r){var s=$(t);return s<0?se(s+r,0):Ee(s,r)},ht=P,$t=Math.min,oi=function(t){var r=ht(t);return r>0?$t(r,9007199254740991):0},Qs=oi,fr=function(t){return Qs(t.length)},vo=an,Ms=Ye,Yc=fr,Ka=function(t){return function(r,s,a){var c=vo(r),d=Yc(c);if(d===0)return!t&&-1;var h,m=Ms(a,d);if(t&&s!=s){for(;d>m;)if((h=c[m++])!=h)return!0}else for(;d>m;m++)if((t||m in c)&&c[m]===s)return t||m||0;return!t&&-1}},wd={includes:Ka(!0),indexOf:Ka(!1)},um=wd.includes;Hn({target:"Array",proto:!0,forced:u((function(){return!Array(1).includes()}))},{includes:function(t){return um(this,t,arguments.length>1?arguments[1]:void 0)}});var tI=D,nI=St,Sc=function(t,r){var s=nI[t+"Prototype"],a=s&&s[r];if(a)return a;var c=tI[t],d=c&&c.prototype;return d&&d[r]},dm=Sc("Array","includes"),XN=on,JN=q,QN=Cr("match"),ob=function(t){var r;return XN(t)&&((r=t[QN])!==void 0?!!r:JN(t)==="RegExp")},rI=ob,n_=TypeError,hm={};hm[Cr("toStringTag")]="z";var ab=String(hm)==="[object z]",wE=ab,ZN=de,r_=q,cb=Cr("toStringTag"),lb=Object,iI=r_((function(){return arguments})())==="Arguments",Td=wE?r_:function(t){var r,s,a;return t===void 0?"Undefined":t===null?"Null":typeof(s=(function(c,d){try{return c[d]}catch{}})(r=lb(t),cb))=="string"?s:iI?r_(r):(a=r_(r))==="Object"&&ZN(r.callee)?"Arguments":a},sI=Td,ex=String,qa=function(t){if(sI(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return ex(t)},tx=Cr("match"),nx=Hn,rx=function(t){if(rI(t))throw new n_("The method doesn't accept regular expressions");return t},Bl=Xt,pm=qa,oI=function(t){var r=/./;try{"/./"[t](r)}catch{try{return r[tx]=!1,"/./"[t](r)}catch{}}return!1},aI=R("".indexOf);nx({target:"String",proto:!0,forced:!oI("includes")},{includes:function(t){return!!~aI(pm(Bl(this)),pm(rx(t)),arguments.length>1?arguments[1]:void 0)}});var cI=Sc("String","includes"),ub=O,db=dm,ix=cI,hb=Array.prototype,Oh=String.prototype,pb=function(t){var r=t.includes;return t===hb||ub(hb,t)&&r===hb.includes?db:typeof t=="string"||t===Oh||ub(Oh,t)&&r===Oh.includes?ix:r},rt=l(pb),fb=Kt,lI=Xs,TE=at,fm=fr,CE=TypeError,mb="Reduce of empty array with no initial value",RE=function(t){return function(r,s,a,c){var d=lI(r),h=TE(d),m=fm(d);if(fb(s),m===0&&a<2)throw new CE(mb);var g=t?m-1:0,E=t?-1:1;if(a<2)for(;;){if(g in h){c=h[g],g+=E;break}if(g+=E,t?g<0:m<=g)throw new CE(mb)}for(;t?g>=0:m>g;g+=E)g in h&&(c=s(c,h[g],g,d));return c}},uI={left:RE(!1)},dI=u,i_=function(t,r){var s=[][t];return!!s&&dI((function(){s.call(null,r||function(){return 1},1)}))},mm=D,hI=cn,pI=q,zl=function(t){return hI.slice(0,t.length)===t},s_=zl("Bun/")?"BUN":zl("Cloudflare-Workers")?"CLOUDFLARE":zl("Deno/")?"DENO":zl("Node.js/")?"NODE":mm.Bun&&typeof Bun.version=="string"?"BUN":mm.Deno&&typeof Deno.version=="object"?"DENO":pI(mm.process)==="process"?"NODE":mm.window&&mm.document?"BROWSER":"REST",gm=s_==="NODE",sx=uI.left;Hn({target:"Array",proto:!0,forced:!gm&&ti>79&&ti<83||!i_("reduce")},{reduce:function(t){var r=arguments.length;return sx(this,t,r,r>1?arguments[1]:void 0)}});var ox=Sc("Array","reduce"),o_=O,ax=ox,IE=Array.prototype,fI=function(t){var r=t.reduce;return t===IE||o_(IE,t)&&r===IE.reduce?ax:r},Oi=fI,Ya=l(Oi),AE=q,Cd=Array.isArray||function(t){return AE(t)==="Array"},mI=Hn,gb=Cd,a_=R([].reverse),c_=[1,2];mI({target:"Array",proto:!0,forced:String(c_)===String(c_.reverse())},{reverse:function(){return gb(this)&&(this.length=this.length),a_(this)}});var _m=Sc("Array","reverse"),gI=O,cx=_m,_b=Array.prototype,_I=function(t){var r=t.reverse;return t===_b||gI(_b,t)&&r===_b.reverse?cx:r},l_=_I,u_=l(l_),yb=qt,PE=va("keys"),ym=function(t){return PE[t]||(PE[t]=yb(t))},Eb=!u((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),lx=Mr,yI=de,ux=Xs,dx=Eb,OE=ym("IE_PROTO"),Iu=Object,EI=Iu.prototype,kh=dx?Iu.getPrototypeOf:function(t){var r=ux(t);if(lx(r,OE))return r[OE];var s=r.constructor;return yI(s)&&r instanceof s?s.prototype:r instanceof Iu?EI:null},Au=R,d_=Kt,Rd=on,vb=function(t){return Rd(t)||t===null},hx=String,px=TypeError,Kp=function(t,r,s){try{return Au(d_(Object.getOwnPropertyDescriptor(t,r)[s]))}catch{}},h_=on,Em=Xt,kE=function(t){if(vb(t))return t;throw new px("Can't set "+hx(t)+" as a prototype")},Sb=Object.setPrototypeOf||("__proto__"in{}?(function(){var t,r=!1,s={};try{(t=Kp(Object.prototype,"__proto__","set"))(s,[]),r=s instanceof Array}catch{}return function(a,c){return Em(a),kE(c),h_(a)&&(r?t(a,c):a.__proto__=c),a}})():void 0),Id={},Wl={},Ti=Mr,ki=an,Nh=wd.indexOf,ia=Wl,Ia=R([].push),xh=function(t,r){var s,a=ki(t),c=0,d=[];for(s in a)!Ti(ia,s)&&Ti(a,s)&&Ia(d,s);for(;r.length>c;)Ti(a,s=r[c++])&&(~Nh(d,s)||Ia(d,s));return d},Dh=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Xa=xh,NE=Dh.concat("length","prototype");Id.f=Object.getOwnPropertyNames||function(t){return Xa(t,NE)};var vm={};vm.f=Object.getOwnPropertySymbols;var vI=Et,xE=Id,SI=vm,Ad=nr,DE=R([].concat),bb=vI("Reflect","ownKeys")||function(t){var r=xE.f(Ad(t)),s=SI.f;return s?DE(r,s(t)):r},wb=Mr,fx=bb,Lh=he,Sm=Yt,Mh={},LE=xh,ME=Dh,Aa=Object.keys||function(t){return LE(t,ME)},Xc=Se,qp=ar,Pd=Yt,Od=nr,Yp=an,bI=Aa;Mh.f=Xc&&!qp?Object.defineProperties:function(t,r){Od(t);for(var s,a=Yp(r),c=bI(r),d=c.length,h=0;d>h;)Pd.f(t,s=c[h++],a[s]);return t};var bm,UE=Et("document","documentElement"),bc=nr,wc=Mh,ji=Dh,Gl=Wl,wI=UE,TI=Su,p_="prototype",f_="script",Tb=ym("IE_PROTO"),wm=function(){},Cb=function(t){return"<"+f_+">"+t+"</"+f_+">"},Xp=function(t){t.write(Cb("")),t.close();var r=t.parentWindow.Object;return t=null,r},Tm=function(){try{bm=new ActiveXObject("htmlfile")}catch{}var t,r,s;Tm=typeof document<"u"?document.domain&&bm?Xp(bm):(r=TI("iframe"),s="java"+f_+":",r.style.display="none",wI.appendChild(r),r.src=String(s),(t=r.contentWindow.document).open(),t.write(Cb("document.F=Object")),t.close(),t.F):Xp(bm);for(var a=ji.length;a--;)delete Tm[p_][ji[a]];return Tm()};Gl[Tb]=!0;var m_=Object.create||function(t,r){var s;return t!==null?(wm[p_]=bc(t),s=new wm,wm[p_]=null,s[Tb]=t):s=Tm(),r===void 0?s:wc.f(s,r)},g_=on,VE=vc,Rb=Error,CI=R("".replace),Cm=String(new Rb("zxcasd").stack),Ib=/\n\s*at [^:]*:[^\n]*/,jE=Ib.test(Cm),FE=nt,Rm=!u((function(){var t=new Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",FE(1,7)),t.stack!==7)})),Ab=vc,Pb=function(t,r){if(jE&&typeof t=="string"&&!Rb.prepareStackTrace)for(;r--;)t=CI(t,Ib,"");return t},Ob=Rm,BE=Error.captureStackTrace,Hl={},Jc=Hl,Jp=Cr("iterator"),kb=Array.prototype,Nb=function(t){return t!==void 0&&(Jc.Array===t||kb[Jp]===t)},kd=Td,Nd=Ga,xb=Ct,RI=Hl,xd=Cr("iterator"),$l=function(t){if(!xb(t))return Nd(t,xd)||Nd(t,"@@iterator")||RI[kd(t)]},zE=we,II=Kt,WE=nr,AI=Eo,__=$l,Pu=TypeError,Qp=function(t,r){var s=arguments.length<2?__(t):r;if(II(s))return WE(zE(s,t));throw new Pu(AI(t)+" is not iterable")},y_=we,Uh=nr,Db=Ga,Zp=function(t,r,s){var a,c;Uh(t);try{if(!(a=Db(t,"return"))){if(r==="throw")throw s;return s}a=y_(a,t)}catch(d){c=!0,a=d}if(r==="throw")throw s;if(c)throw a;return Uh(a),s},PI=ct,Lb=we,es=nr,GE=Eo,Mb=Nb,Ub=fr,E_=O,Vb=Qp,ef=$l,qi=Zp,Zs=TypeError,ys=function(t,r){this.stopped=t,this.result=r},v_=ys.prototype,Dd=function(t,r,s){var a,c,d,h,m,g,E,w=s&&s.that,I=!(!s||!s.AS_ENTRIES),A=!(!s||!s.IS_RECORD),N=!(!s||!s.IS_ITERATOR),G=!(!s||!s.INTERRUPTED),F=PI(r,w),z=function(Z){return a&&qi(a,"normal",Z),new ys(!0,Z)},ee=function(Z){return I?(es(Z),G?F(Z[0],Z[1],z):F(Z[0],Z[1])):G?F(Z,z):F(Z)};if(A)a=t.iterator;else if(N)a=t;else{if(!(c=ef(t)))throw new Zs(GE(t)+" is not iterable");if(Mb(c)){for(d=0,h=Ub(t);h>d;d++)if((m=ee(t[d]))&&E_(v_,m))return m;return new ys(!1)}a=Vb(t,c)}for(g=A?t.next:a.next;!(E=Lb(g,a)).done;){try{m=ee(E.value)}catch(Z){qi(a,"throw",Z)}if(typeof m=="object"&&m&&E_(v_,m))return m}return new ys(!1)},S_=qa,mx=Hn,sa=O,jb=kh,Im=Sb,Fb=function(t,r,s){for(var a=fx(r),c=Sm.f,d=Lh.f,h=0;h<a.length;h++){var m=a[h];wb(t,m)||s&&wb(s,m)||c(t,m,d(r,m))}},Kl=m_,Ja=vc,tf=nt,Bb=function(t,r){g_(r)&&"cause"in r&&VE(t,"cause",r.cause)},zb=function(t,r,s,a){Ob&&(BE?BE(t,r):Ab(t,"stack",Pb(s,a)))},OI=Dd,kI=function(t,r){return t===void 0?arguments.length<2?"":r:S_(t)},NI=Cr("toStringTag"),b_=Error,xI=[].push,nf=function(t,r){var s,a=sa(HE,this);Im?s=Im(new b_,a?jb(this):HE):(s=a?this:Kl(HE),Ja(s,NI,"Error")),r!==void 0&&Ja(s,"message",kI(r)),zb(s,nf,s.stack,1),arguments.length>2&&Bb(s,arguments[2]);var c=[];return OI(t,xI,{that:c}),Ja(s,"errors",c),s};Im?Im(nf,b_):Fb(nf,b_,{name:!0});var HE=nf.prototype=Kl(b_.prototype,{constructor:tf(1,nf),message:tf(1,""),name:tf(1,"AggregateError")});mx({global:!0},{AggregateError:nf});var w_,Ld,T_,$E=de,C_=D.WeakMap,DI=$E(C_)&&/native code/.test(String(C_)),KE=D,LI=on,MI=vc,qE=Mr,YE=kl,Wb=ym,UI=Wl,Gb="Object already initialized",XE=KE.TypeError,gx=KE.WeakMap;if(DI||YE.state){var ql=YE.state||(YE.state=new gx);ql.get=ql.get,ql.has=ql.has,ql.set=ql.set,w_=function(t,r){if(ql.has(t))throw new XE(Gb);return r.facade=t,ql.set(t,r),r},Ld=function(t){return ql.get(t)||{}},T_=function(t){return ql.has(t)}}else{var Am=Wb("state");UI[Am]=!0,w_=function(t,r){if(qE(t,Am))throw new XE(Gb);return r.facade=t,MI(t,Am,r),r},Ld=function(t){return qE(t,Am)?t[Am]:{}},T_=function(t){return qE(t,Am)}}var rf,Hb,$b,Vh={set:w_,get:Ld,has:T_,enforce:function(t){return T_(t)?Ld(t):w_(t,{})},getterFor:function(t){return function(r){var s;if(!LI(r)||(s=Ld(r)).type!==t)throw new XE("Incompatible receiver, "+t+" required");return s}}},Pm=Se,_x=Mr,VI=Function.prototype,yx=Pm&&Object.getOwnPropertyDescriptor,Qc=_x(VI,"name"),JE={PROPER:Qc&&(function(){}).name==="something",CONFIGURABLE:Qc&&(!Pm||Pm&&yx(VI,"name").configurable)},QE=vc,Md=function(t,r,s,a){return a&&a.enumerable?t[r]=s:QE(t,r,s),t},jI=u,FI=de,Kb=on,Om=m_,ZE=kh,qb=Md,Yb=Cr("iterator"),Xb=!1;[].keys&&("next"in($b=[].keys())?(Hb=ZE(ZE($b)))!==Object.prototype&&(rf=Hb):Xb=!0);var BI=!Kb(rf)||jI((function(){var t={};return rf[Yb].call(t)!==t}));FI((rf=BI?{}:Om(rf))[Yb])||qb(rf,Yb,(function(){return this}));var Jb={IteratorPrototype:rf,BUGGY_SAFARI_ITERATORS:Xb},zI=Td,WI=ab?{}.toString:function(){return"[object "+zI(this)+"]"},Ex=ab,Qa=Yt.f,Pa=vc,GI=Mr,HI=WI,Qb=Cr("toStringTag"),Ou=function(t,r,s,a){var c=s?t:t&&t.prototype;c&&(GI(c,Qb)||Qa(c,Qb,{configurable:!0,value:r}),a&&!Ex&&Pa(c,"toString",HI))},$I=Jb.IteratorPrototype,Zb=m_,KI=nt,ew=Ou,qI=Hl,YI=function(){return this},R_=function(t,r,s,a){var c=r+" Iterator";return t.prototype=Zb($I,{next:KI(+!a,s)}),ew(t,c,!1,!0),qI[c]=YI,t},tw=Hn,XI=we,nw=JE,ev=R_,vx=kh,JI=Ou,tv=Md,rw=Hl,nv=Jb,Ud=nw.PROPER,rv=nv.BUGGY_SAFARI_ITERATORS,iv=Cr("iterator"),sv="keys",I_="values",iw="entries",A_=function(){return this},Mo=function(t,r,s,a,c,d,h){ev(s,r,a);var m,g,E,w=function(ee){if(ee===c&&F)return F;if(!rv&&ee&&ee in N)return N[ee];switch(ee){case sv:case I_:case iw:return function(){return new s(this,ee)}}return function(){return new s(this)}},I=r+" Iterator",A=!1,N=t.prototype,G=N[iv]||N["@@iterator"]||c&&N[c],F=!rv&&G||w(c),z=r==="Array"&&N.entries||G;if(z&&(m=vx(z.call(new t)))!==Object.prototype&&m.next&&(JI(m,I,!0,!0),rw[I]=A_),Ud&&c===I_&&G&&G.name!==I_&&(A=!0,F=function(){return XI(G,this)}),c)if(g={values:w(I_),keys:d?F:w(sv),entries:w(iw)},h)for(E in g)(rv||A||!(E in N))&&tv(N,E,g[E]);else tw({target:r,proto:!0,forced:rv||A},g);return h&&N[iv]!==F&&tv(N,iv,F,{}),rw[r]=F,g},ov=function(t,r){return{value:t,done:r}},Sx=an,P_=Hl,Uo=Vh;Yt.f;var bx=Mo,dn=ov,sf="Array Iterator",sw=Uo.set,QI=Uo.getterFor(sf);bx(Array,"Array",(function(t,r){sw(this,{type:sf,target:Sx(t),index:0,kind:r})}),(function(){var t=QI(this),r=t.target,s=t.index++;if(!r||s>=r.length)return t.target=null,dn(void 0,!0);switch(t.kind){case"keys":return dn(s,!1);case"values":return dn(r[s],!1)}return dn([s,r[s]],!1)}),"values"),P_.Arguments=P_.Array;var wx=Yt,jh=function(t,r,s){return wx.f(t,r,s)},av=Et,ow=jh,ZI=Se,aw=Cr("species"),eA=O,cw=TypeError,O_=function(t,r){if(eA(r,t))return t;throw new cw("Incorrect invocation")},Vo=de,Tc=kl,Fh=R(Function.toString);Vo(Tc.inspectSource)||(Tc.inspectSource=function(t){return Fh(t)});var lw=Tc.inspectSource,tA=R,Yl=u,uw=de,ku=Td,Tx=lw,dw=function(){},hw=Et("Reflect","construct"),cv=/^\s*(?:class|function)\b/,nA=tA(cv.exec),Cx=!cv.test(dw),Bh=function(t){if(!uw(t))return!1;try{return hw(dw,[],t),!0}catch{return!1}},lv=function(t){if(!uw(t))return!1;switch(ku(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Cx||!!nA(cv,Tx(t))}catch{return!0}};lv.sham=!0;var oa,Rr,eo,ds,Us=!hw||Yl((function(){var t;return Bh(Bh.call)||!Bh(Object)||!Bh((function(){t=!0}))||t}))?lv:Bh,Cc=Us,km=Eo,to=TypeError,Nm=nr,of=function(t){if(Cc(t))return t;throw new to(km(t)+" is not a constructor")},uv=Ct,pw=Cr("species"),af=function(t,r){var s,a=Nm(t).constructor;return a===void 0||uv(s=Nm(a)[pw])?r:of(s)},Es=R([].slice),fw=TypeError,Zc=function(t,r){if(t<r)throw new fw("Not enough arguments");return t},Nu=/(?:ipad|iphone|ipod).*applewebkit/i.test(cn),aa=D,mw=ne,zh=ct,k_=de,Wh=Mr,N_=u,xm=UE,gw=Es,x_=Su,dv=Zc,Oa=Nu,Gh=gm,Rc=aa.setImmediate,ca=aa.clearImmediate,rA=aa.process,D_=aa.Dispatch,_w=aa.Function,iA=aa.MessageChannel,Hh=aa.String,hv=0,cf={},$h="onreadystatechange";N_((function(){oa=aa.location}));var L_=function(t){if(Wh(cf,t)){var r=cf[t];delete cf[t],r()}},Vd=function(t){return function(){L_(t)}},yw=function(t){L_(t.data)},Ew=function(t){aa.postMessage(Hh(t),oa.protocol+"//"+oa.host)};Rc&&ca||(Rc=function(t){dv(arguments.length,1);var r=k_(t)?t:_w(t),s=gw(arguments,1);return cf[++hv]=function(){mw(r,void 0,s)},Rr(hv),hv},ca=function(t){delete cf[t]},Gh?Rr=function(t){rA.nextTick(Vd(t))}:D_&&D_.now?Rr=function(t){D_.now(Vd(t))}:iA&&!Oa?(ds=(eo=new iA).port2,eo.port1.onmessage=yw,Rr=zh(ds.postMessage,ds)):aa.addEventListener&&k_(aa.postMessage)&&!aa.importScripts&&oa&&oa.protocol!=="file:"&&!N_(Ew)?(Rr=Ew,aa.addEventListener("message",yw,!1)):Rr=$h in x_("script")?function(t){xm.appendChild(x_("script"))[$h]=function(){xm.removeChild(this),L_(t)}}:function(t){setTimeout(Vd(t),0)});var Dm={set:Rc,clear:ca},M_=D,Rx=Se,Ix=Object.getOwnPropertyDescriptor,vw=function(t){if(!Rx)return M_[t];var r=Ix(M_,t);return r&&r.value},Sw=function(){this.head=null,this.tail=null};Sw.prototype={add:function(t){var r={item:t,next:null},s=this.tail;s?s.next=r:this.head=r,this.tail=r},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var el,bw,Kh,pv,ts,sA=Sw,oA=/ipad|iphone|ipod/i.test(cn)&&typeof Pebble<"u",Ax=/web0s(?!.*chrome)/i.test(cn),Lm=D,aA=vw,ww=ct,Tw=Dm.set,tl=sA,Cw=Nu,Px=oA,qh=Ax,Mm=gm,Yh=Lm.MutationObserver||Lm.WebKitMutationObserver,U_=Lm.document,fv=Lm.process,Um=Lm.Promise,Rw=aA("queueMicrotask");if(!Rw){var Vm=new tl,mv=function(){var t,r;for(Mm&&(t=fv.domain)&&t.exit();r=Vm.get();)try{r()}catch(s){throw Vm.head&&el(),s}t&&t.enter()};Cw||Mm||qh||!Yh||!U_?!Px&&Um&&Um.resolve?((pv=Um.resolve(void 0)).constructor=Um,ts=ww(pv.then,pv),el=function(){ts(mv)}):Mm?el=function(){fv.nextTick(mv)}:(Tw=ww(Tw,Lm),el=function(){Tw(mv)}):(bw=!0,Kh=U_.createTextNode(""),new Yh(mv).observe(Kh,{characterData:!0}),el=function(){Kh.data=bw=!bw}),Rw=function(t){Vm.head||el(),Vm.add(t)}}var Iw=Rw,lf=function(t){try{return{error:!1,value:t()}}catch(r){return{error:!0,value:r}}},xu=D.Promise,gv=D,jm=xu,Aw=de,Ox=Ca,cA=lw,Pw=Cr,V_=s_,j_=ti,F_=jm&&jm.prototype,lA=Pw("species"),uA=Aw(gv.PromiseRejectionEvent),_v=Ox("Promise",(function(){var t=cA(jm),r=t!==String(jm);if(!r&&j_===66||!F_.catch||!F_.finally)return!0;if(!j_||j_<51||!/native code/.test(t)){var s=new jm((function(c){c(1)})),a=function(c){c((function(){}),(function(){}))};if((s.constructor={})[lA]=a,!(s.then((function(){}))instanceof a))return!0}return!(r||V_!=="BROWSER"&&V_!=="DENO"||uA)})),B_={CONSTRUCTOR:_v,REJECTION_EVENT:uA},Za={},dA=Kt,yv=TypeError,p=function(t){var r,s;this.promise=new t((function(a,c){if(r!==void 0||s!==void 0)throw new yv("Bad Promise constructor");r=a,s=c})),this.resolve=dA(r),this.reject=dA(s)};Za.f=function(t){return new p(t)};var _,T,x=Hn,j=gm,K=D,fe=we,Oe=Md,Ve=Ou,ut=function(t){var r=av(t);ZI&&r&&!r[aw]&&ow(r,aw,{configurable:!0,get:function(){return this}})},xt=Kt,Dt=de,kt=on,ln=O_,gn=af,yn=Dm.set,ns=Iw,Qe=function(t,r){try{arguments.length===1?console.error(t):console.error(t,r)}catch{}},Be=lf,it=sA,Vt=Vh,vn=xu,On=B_,kn=Za,jn="Promise",no=On.CONSTRUCTOR,Jr=On.REJECTION_EVENT,Du=Vt.getterFor(jn),kx=Vt.set,Fae=vn&&vn.prototype,Ow=vn,Nx=Fae,jF=K.TypeError,xx=K.document,Dx=K.process,Lx=kn.f,Bae=Lx,zae=!!(xx&&xx.createEvent&&K.dispatchEvent),FF="unhandledrejection",BF=function(t){var r;return!(!kt(t)||!Dt(r=t.then))&&r},zF=function(t,r){var s,a,c,d=r.value,h=r.state===1,m=h?t.ok:t.fail,g=t.resolve,E=t.reject,w=t.domain;try{m?(h||(r.rejection===2&&Gae(r),r.rejection=1),m===!0?s=d:(w&&w.enter(),s=m(d),w&&(w.exit(),c=!0)),s===t.promise?E(new jF("Promise-chain cycle")):(a=BF(s))?fe(a,s,g,E):g(s)):E(d)}catch(I){w&&!c&&w.exit(),E(I)}},WF=function(t,r){t.notified||(t.notified=!0,ns((function(){for(var s,a=t.reactions;s=a.get();)zF(s,t);t.notified=!1,r&&!t.rejection&&Wae(t)})))},GF=function(t,r,s){var a,c;zae?((a=xx.createEvent("Event")).promise=r,a.reason=s,a.initEvent(t,!1,!0),K.dispatchEvent(a)):a={promise:r,reason:s},!Jr&&(c=K["on"+t])?c(a):t===FF&&Qe("Unhandled promise rejection",s)},Wae=function(t){fe(yn,K,(function(){var r,s=t.facade,a=t.value;if(HF(t)&&(r=Be((function(){j?Dx.emit("unhandledRejection",a,s):GF(FF,s,a)})),t.rejection=j||HF(t)?2:1,r.error))throw r.value}))},HF=function(t){return t.rejection!==1&&!t.parent},Gae=function(t){fe(yn,K,(function(){var r=t.facade;j?Dx.emit("rejectionHandled",r):GF("rejectionhandled",r,t.value)}))},Ev=function(t,r,s){return function(a){t(r,a,s)}},vv=function(t,r,s){t.done||(t.done=!0,s&&(t=s),t.value=r,t.state=2,WF(t,!0))},Mx=function(t,r,s){if(!t.done){t.done=!0,s&&(t=s);try{if(t.facade===r)throw new jF("Promise can't be resolved itself");var a=BF(r);a?ns((function(){var c={done:!1};try{fe(a,r,Ev(Mx,c,t),Ev(vv,c,t))}catch(d){vv(c,d,t)}})):(t.value=r,t.state=1,WF(t,!1))}catch(c){vv({done:!1},c,t)}}};no&&(Nx=(Ow=function(t){ln(this,Nx),xt(t),fe(_,this);var r=Du(this);try{t(Ev(Mx,r),Ev(vv,r))}catch(s){vv(r,s)}}).prototype,(_=function(t){kx(this,{type:jn,done:!1,notified:!1,parent:!1,reactions:new it,rejection:!1,state:0,value:null})}).prototype=Oe(Nx,"then",(function(t,r){var s=Du(this),a=Lx(gn(this,Ow));return s.parent=!0,a.ok=!Dt(t)||t,a.fail=Dt(r)&&r,a.domain=j?Dx.domain:void 0,s.state===0?s.reactions.add(a):ns((function(){zF(a,s)})),a.promise})),T=function(){var t=new _,r=Du(t);this.promise=t,this.resolve=Ev(Mx,r),this.reject=Ev(vv,r)},kn.f=Lx=function(t){return t===Ow||t===void 0?new T(t):Bae(t)}),x({global:!0,wrap:!0,forced:no},{Promise:Ow}),Ve(Ow,jn,!1,!0),ut(jn);var $F=Cr("iterator"),KF=!1;try{var Hae=0,qF={next:function(){return{done:!!Hae++}},return:function(){KF=!0}};qF[$F]=function(){return this},Array.from(qF,(function(){throw 2}))}catch{}var $ae=xu,Kae=function(t,r){try{if(!r&&!KF)return!1}catch{return!1}var s=!1;try{var a={};a[$F]=function(){return{next:function(){return{done:s=!0}}}},t(a)}catch{}return s},hA=B_.CONSTRUCTOR||!Kae((function(t){$ae.all(t).then(void 0,(function(){}))})),qae=we,Yae=Kt,Xae=Za,Jae=lf,Qae=Dd;Hn({target:"Promise",stat:!0,forced:hA},{all:function(t){var r=this,s=Xae.f(r),a=s.resolve,c=s.reject,d=Jae((function(){var h=Yae(r.resolve),m=[],g=0,E=1;Qae(t,(function(w){var I=g++,A=!1;E++,qae(h,r,w).then((function(N){A||(A=!0,m[I]=N,--E||a(m))}),c)})),--E||a(m)}));return d.error&&c(d.value),s.promise}});var Zae=Hn,ece=B_.CONSTRUCTOR;xu&&xu.prototype,Zae({target:"Promise",proto:!0,forced:ece,real:!0},{catch:function(t){return this.then(void 0,t)}});var tce=we,nce=Kt,rce=Za,ice=lf,sce=Dd;Hn({target:"Promise",stat:!0,forced:hA},{race:function(t){var r=this,s=rce.f(r),a=s.reject,c=ice((function(){var d=nce(r.resolve);sce(t,(function(h){tce(d,r,h).then(s.resolve,a)}))}));return c.error&&a(c.value),s.promise}});var oce=Za;Hn({target:"Promise",stat:!0,forced:B_.CONSTRUCTOR},{reject:function(t){var r=oce.f(this);return(0,r.reject)(t),r.promise}});var ace=nr,cce=on,lce=Za,YF=function(t,r){if(ace(t),cce(r)&&r.constructor===t)return r;var s=lce.f(t);return(0,s.resolve)(r),s.promise},uce=Hn,dce=xu,hce=B_.CONSTRUCTOR,pce=YF,fce=Et("Promise"),mce=!hce;uce({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return pce(mce&&this===fce?dce:this,t)}});var gce=we,_ce=Kt,yce=Za,Ece=lf,vce=Dd;Hn({target:"Promise",stat:!0,forced:hA},{allSettled:function(t){var r=this,s=yce.f(r),a=s.resolve,c=s.reject,d=Ece((function(){var h=_ce(r.resolve),m=[],g=0,E=1;vce(t,(function(w){var I=g++,A=!1;E++,gce(h,r,w).then((function(N){A||(A=!0,m[I]={status:"fulfilled",value:N},--E||a(m))}),(function(N){A||(A=!0,m[I]={status:"rejected",reason:N},--E||a(m))}))})),--E||a(m)}));return d.error&&c(d.value),s.promise}});var Sce=we,bce=Kt,wce=Et,Tce=Za,Cce=lf,Rce=Dd,XF="No one promise resolved";Hn({target:"Promise",stat:!0,forced:hA},{any:function(t){var r=this,s=wce("AggregateError"),a=Tce.f(r),c=a.resolve,d=a.reject,h=Cce((function(){var m=bce(r.resolve),g=[],E=0,w=1,I=!1;Rce(t,(function(A){var N=E++,G=!1;w++,Sce(m,r,A).then((function(F){G||I||(I=!0,c(F))}),(function(F){G||I||(G=!0,g[N]=F,--w||d(new s(g,XF)))}))})),--w||d(new s(g,XF))}));return h.error&&d(h.value),a.promise}});var Ice=Hn,Ace=ne,Pce=Es,Oce=Za,kce=Kt,JF=lf,Ux=D.Promise,QF=!1;Ice({target:"Promise",stat:!0,forced:!Ux||!Ux.try||JF((function(){Ux.try((function(t){QF=t===8}),8)})).error||!QF},{try:function(t){var r=arguments.length>1?Pce(arguments,1):[],s=Oce.f(this),a=JF((function(){return Ace(kce(t),void 0,r)}));return(a.error?s.reject:s.resolve)(a.value),s.promise}});var Nce=Za;Hn({target:"Promise",stat:!0},{withResolvers:function(){var t=Nce.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var xce=Hn,Vx=xu,Dce=u,Lce=Et,Mce=de,Uce=af,ZF=YF,Vce=Vx&&Vx.prototype;xce({target:"Promise",proto:!0,real:!0,forced:!!Vx&&Dce((function(){Vce.finally.call({then:function(){}},(function(){}))}))},{finally:function(t){var r=Uce(this,Lce("Promise")),s=Mce(t);return this.then(s?function(a){return ZF(r,t()).then((function(){return a}))}:t,s?function(a){return ZF(r,t()).then((function(){throw a}))}:t)}});var jx=R,jce=P,Fce=qa,Bce=Xt,zce=jx("".charAt),e4=jx("".charCodeAt),Wce=jx("".slice),t4=function(t){return function(r,s){var a,c,d=Fce(Bce(r)),h=jce(s),m=d.length;return h<0||h>=m?t?"":void 0:(a=e4(d,h))<55296||a>56319||h+1===m||(c=e4(d,h+1))<56320||c>57343?t?zce(d,h):a:t?Wce(d,h,h+2):c-56320+(a-55296<<10)+65536}},Fx={codeAt:t4(!1),charAt:t4(!0)},Gce=Fx.charAt,Hce=qa,n4=Vh,$ce=Mo,r4=ov,i4="String Iterator",Kce=n4.set,qce=n4.getterFor(i4);$ce(String,"String",(function(t){Kce(this,{type:i4,string:Hce(t),index:0})}),(function(){var t,r=qce(this),s=r.string,a=r.index;return a>=s.length?r4(void 0,!0):(t=Gce(s,a),r.index+=t.length,r4(t,!1))}));var Yce=St.Promise,Xce={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Jce=D,Qce=Ou,s4=Hl;for(var Bx in Xce)Qce(Jce[Bx],Bx),s4[Bx]=s4.Array;var o4=Yce,mt=l(o4),Zce=Sc("Array","values"),ele=Td,tle=Mr,nle=O,rle=Zce,zx=Array.prototype,ile={DOMTokenList:!0,NodeList:!0},sle=function(t){var r=t.values;return t===zx||nle(zx,t)&&r===zx.values||tle(ile,ele(t))?rle:r},Ic=l(sle),a4=Eo,ole=TypeError,c4=Es,ale=Math.floor,Wx=function(t,r){var s=t.length;if(s<8)for(var a,c,d=1;d<s;){for(c=d,a=t[d];c&&r(t[c-1],a)>0;)t[c]=t[--c];c!==d++&&(t[c]=a)}else for(var h=ale(s/2),m=Wx(c4(t,0,h),r),g=Wx(c4(t,h),r),E=m.length,w=g.length,I=0,A=0;I<E||A<w;)t[I+A]=I<E&&A<w?r(m[I],g[A])<=0?m[I++]:g[A++]:I<E?m[I++]:g[A++];return t},l4=Wx,u4=cn.match(/firefox\/(\d+)/i),cle=!!u4&&+u4[1],lle=/MSIE|Trident/.test(cn),d4=cn.match(/AppleWebKit\/(\d+)\./),ule=!!d4&&+d4[1],dle=Hn,h4=R,hle=Kt,ple=Xs,p4=fr,fle=function(t,r){if(!delete t[r])throw new ole("Cannot delete property "+a4(r)+" of "+a4(t))},f4=qa,Gx=u,mle=l4,gle=i_,m4=cle,_le=lle,g4=ti,_4=ule,Fm=[],y4=h4(Fm.sort),yle=h4(Fm.push),Ele=Gx((function(){Fm.sort(void 0)})),vle=Gx((function(){Fm.sort(null)})),Sle=gle("sort"),E4=!Gx((function(){if(g4)return g4<70;if(!(m4&&m4>3)){if(_le)return!0;if(_4)return _4<603;var t,r,s,a,c="";for(t=65;t<76;t++){switch(r=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(a=0;a<47;a++)Fm.push({k:r+a,v:s})}for(Fm.sort((function(d,h){return h.v-d.v})),a=0;a<Fm.length;a++)r=Fm[a].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}}));dle({target:"Array",proto:!0,forced:Ele||!vle||!Sle||!E4},{sort:function(t){t!==void 0&&hle(t);var r=ple(this);if(E4)return t===void 0?y4(r):y4(r,t);var s,a,c=[],d=p4(r);for(a=0;a<d;a++)a in r&&yle(c,r[a]);for(mle(c,(function(h){return function(m,g){return g===void 0?-1:m===void 0?1:h!==void 0?+h(m,g)||0:f4(m)>f4(g)?1:-1}})(t)),s=p4(c),a=0;a<s;)r[a]=c[a++];for(;a<d;)fle(r,a++);return r}});var ble=Sc("Array","sort"),wle=O,Tle=ble,Hx=Array.prototype,Cle=function(t){var r=t.sort;return t===Hx||wle(Hx,t)&&r===Hx.sort?Tle:r},z_=l(Cle),Rle=Hn,Ile=R,Ale=Ye,Ple=RangeError,v4=String.fromCharCode,S4=String.fromCodePoint,Ole=Ile([].join);Rle({target:"String",stat:!0,forced:!!S4&&S4.length!==1},{fromCodePoint:function(t){for(var r,s=[],a=arguments.length,c=0;a>c;){if(r=+arguments[c++],Ale(r,1114111)!==r)throw new Ple(r+" is not a valid code point");s[c]=r<65536?v4(r):v4(55296+((r-=65536)>>10),r%1024+56320)}return Ole(s,"")}});var kle=u,Nle=Cr("iterator"),pA=!kle((function(){var t=new URL("b?a=1&b=2&c=3","https://a"),r=t.searchParams,s=new URLSearchParams("a=1&a=2&b=3"),a="";return t.pathname="c%20d",r.forEach((function(c,d){r.delete("b"),a+=d+c})),s.delete("a",2),s.delete("b",void 0),!t.toJSON||!s.has("a",1)||s.has("a",2)||!s.has("a",void 0)||s.has("b")||!r.size&&!0||!r.sort||t.href!=="https://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[Nle]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://").host!=="xn--e1aybc"||new URL("https://a#").hash!=="#%D0%B1"||a!=="a1c3"||new URL("https://x",void 0).host!=="x"})),xle=Md,$x=Hn,b4=D,Kx=vw,Dle=Et,fA=we,jd=R,kw=Se,w4=pA,T4=Md,Lle=jh,Mle=function(t,r,s){for(var a in r)s&&s.unsafe&&t[a]?t[a]=r[a]:xle(t,a,r[a],s);return t},Ule=Ou,Vle=R_,qx=Vh,C4=O_,Yx=de,jle=Mr,Fle=ct,Ble=Td,zle=nr,R4=on,Ac=qa,Wle=m_,I4=nt,A4=Qp,Gle=$l,mA=ov,Sv=Zc,Hle=l4,$le=Cr("iterator"),bv="URLSearchParams",P4=bv+"Iterator",O4=qx.set,Lu=qx.getterFor(bv),Kle=qx.getterFor(P4),k4=Kx("fetch"),gA=Kx("Request"),Nw=Kx("Headers"),Xx=gA&&gA.prototype,N4=Nw&&Nw.prototype,qle=b4.TypeError,Yle=b4.encodeURIComponent,Xle=String.fromCharCode,Jle=Dle("String","fromCodePoint"),Qle=parseInt,_A=jd("".charAt),x4=jd([].join),Bm=jd([].push),D4=jd("".replace),Zle=jd([].shift),L4=jd([].splice),M4=jd("".split),U4=jd("".slice),eue=jd(/./.exec),tue=/\+/g,nue=/^[0-9a-f]+$/i,V4=function(t,r){var s=U4(t,r,r+2);return eue(nue,s)?Qle(s,16):NaN},rue=function(t){for(var r=0,s=128;s>0&&(t&s)!=0;s>>=1)r++;return r},iue=function(t){var r=null;switch(t.length){case 1:r=t[0];break;case 2:r=(31&t[0])<<6|63&t[1];break;case 3:r=(15&t[0])<<12|(63&t[1])<<6|63&t[2];break;case 4:r=(7&t[0])<<18|(63&t[1])<<12|(63&t[2])<<6|63&t[3]}return r>1114111?null:r},j4=function(t){for(var r=(t=D4(t,tue," ")).length,s="",a=0;a<r;){var c=_A(t,a);if(c==="%"){if(_A(t,a+1)==="%"||a+3>r){s+="%",a++;continue}var d=V4(t,a+1);if(d!=d){s+=c,a++;continue}a+=2;var h=rue(d);if(h===0)c=Xle(d);else{if(h===1||h>4){s+="",a++;continue}for(var m=[d],g=1;g<h&&!(++a+3>r||_A(t,a)!=="%");){var E=V4(t,a+1);if(E!=E){a+=3;break}if(E>191||E<128)break;Bm(m,E),a+=2,g++}if(m.length!==h){s+="";continue}var w=iue(m);w===null?s+="":c=Jle(w)}}s+=c,a++}return s},sue=/[!'()~]|%20/g,oue={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},aue=function(t){return oue[t]},F4=function(t){return D4(Yle(t),sue,aue)},Jx=Vle((function(t,r){O4(this,{type:P4,target:Lu(t).entries,index:0,kind:r})}),bv,(function(){var t=Kle(this),r=t.target,s=t.index++;if(!r||s>=r.length)return t.target=null,mA(void 0,!0);var a=r[s];switch(t.kind){case"keys":return mA(a.key,!1);case"values":return mA(a.value,!1)}return mA([a.key,a.value],!1)}),!0),B4=function(t){this.entries=[],this.url=null,t!==void 0&&(R4(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?_A(t,0)==="?"?U4(t,1):t:Ac(t)))};B4.prototype={type:bv,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var r,s,a,c,d,h,m,g=this.entries,E=Gle(t);if(E)for(s=(r=A4(t,E)).next;!(a=fA(s,r)).done;){if(d=(c=A4(zle(a.value))).next,(h=fA(d,c)).done||(m=fA(d,c)).done||!fA(d,c).done)throw new qle("Expected sequence with length 2");Bm(g,{key:Ac(h.value),value:Ac(m.value)})}else for(var w in t)jle(t,w)&&Bm(g,{key:w,value:Ac(t[w])})},parseQuery:function(t){if(t)for(var r,s,a=this.entries,c=M4(t,"&"),d=0;d<c.length;)(r=c[d++]).length&&(s=M4(r,"="),Bm(a,{key:j4(Zle(s)),value:j4(x4(s,"="))}))},serialize:function(){for(var t,r=this.entries,s=[],a=0;a<r.length;)t=r[a++],Bm(s,F4(t.key)+"="+F4(t.value));return x4(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var yA=function(){C4(this,wv);var t=O4(this,new B4(arguments.length>0?arguments[0]:void 0));kw||(this.size=t.entries.length)},wv=yA.prototype;if(Mle(wv,{append:function(t,r){var s=Lu(this);Sv(arguments.length,2),Bm(s.entries,{key:Ac(t),value:Ac(r)}),kw||this.length++,s.updateURL()},delete:function(t){for(var r=Lu(this),s=Sv(arguments.length,1),a=r.entries,c=Ac(t),d=s<2?void 0:arguments[1],h=d===void 0?d:Ac(d),m=0;m<a.length;){var g=a[m];if(g.key!==c||h!==void 0&&g.value!==h)m++;else if(L4(a,m,1),h!==void 0)break}kw||(this.size=a.length),r.updateURL()},get:function(t){var r=Lu(this).entries;Sv(arguments.length,1);for(var s=Ac(t),a=0;a<r.length;a++)if(r[a].key===s)return r[a].value;return null},getAll:function(t){var r=Lu(this).entries;Sv(arguments.length,1);for(var s=Ac(t),a=[],c=0;c<r.length;c++)r[c].key===s&&Bm(a,r[c].value);return a},has:function(t){for(var r=Lu(this).entries,s=Sv(arguments.length,1),a=Ac(t),c=s<2?void 0:arguments[1],d=c===void 0?c:Ac(c),h=0;h<r.length;){var m=r[h++];if(m.key===a&&(d===void 0||m.value===d))return!0}return!1},set:function(t,r){var s=Lu(this);Sv(arguments.length,1);for(var a,c=s.entries,d=!1,h=Ac(t),m=Ac(r),g=0;g<c.length;g++)(a=c[g]).key===h&&(d?L4(c,g--,1):(d=!0,a.value=m));d||Bm(c,{key:h,value:m}),kw||(this.size=c.length),s.updateURL()},sort:function(){var t=Lu(this);Hle(t.entries,(function(r,s){return r.key>s.key?1:-1})),t.updateURL()},forEach:function(t){for(var r,s=Lu(this).entries,a=Fle(t,arguments.length>1?arguments[1]:void 0),c=0;c<s.length;)a((r=s[c++]).value,r.key,this)},keys:function(){return new Jx(this,"keys")},values:function(){return new Jx(this,"values")},entries:function(){return new Jx(this,"entries")}},{enumerable:!0}),T4(wv,$le,wv.entries,{}),T4(wv,"toString",(function(){return Lu(this).serialize()}),{enumerable:!0}),kw&&Lle(wv,"size",{get:function(){return Lu(this).entries.length},configurable:!0,enumerable:!0}),Ule(yA,bv),$x({global:!0,forced:!w4},{URLSearchParams:yA}),!w4&&Yx(Nw)){var cue=jd(N4.has),lue=jd(N4.set),z4=function(t){if(R4(t)){var r,s=t.body;if(Ble(s)===bv)return r=t.headers?new Nw(t.headers):new Nw,cue(r,"content-type")||lue(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Wle(t,{body:I4(0,Ac(s)),headers:I4(0,r)})}return t};if(Yx(k4)&&$x({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return k4(t,arguments.length>1?z4(arguments[1]):{})}}),Yx(gA)){var Qx=function(t){return C4(this,Xx),new gA(t,arguments.length>1?z4(arguments[1]):{})};Xx.constructor=Qx,Qx.prototype=Xx,$x({global:!0,dontCallGetSet:!0,forced:!0},{Request:Qx})}}var Mu,uue={URLSearchParams:yA,getState:Lu},due=St.URLSearchParams,W4=Se,hue=R,pue=we,fue=u,Zx=Aa,mue=vm,gue=Re,_ue=Xs,yue=at,Tv=Object.assign,G4=Object.defineProperty,Eue=hue([].concat),vue=!Tv||fue((function(){if(W4&&Tv({b:1},Tv(G4({},"a",{enumerable:!0,get:function(){G4(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},r={},s=Symbol("assign detection"),a="abcdefghijklmnopqrst";return t[s]=7,a.split("").forEach((function(c){r[c]=c})),Tv({},t)[s]!==7||Zx(Tv({},r)).join("")!==a}))?function(t,r){for(var s=_ue(t),a=arguments.length,c=1,d=mue.f,h=gue.f;a>c;)for(var m,g=yue(arguments[c++]),E=d?Eue(Zx(g),d(g)):Zx(g),w=E.length,I=0;w>I;)m=E[I++],W4&&!pue(h,g,m)||(s[m]=g[m]);return s}:Tv,Sue=nr,bue=Zp,wue=Se,Tue=Yt,Cue=nt,eD=function(t,r,s){wue?Tue.f(t,r,Cue(0,s)):t[r]=s},Rue=ct,Iue=we,Aue=Xs,Pue=function(t,r,s,a){try{return a?r(Sue(s)[0],s[1]):r(s)}catch(c){bue(t,"throw",c)}},Oue=Nb,kue=Us,Nue=fr,H4=eD,xue=Qp,Due=$l,$4=Array,W_=R,tD=2147483647,Lue=/[^\0-\u007E]/,K4=/[.\u3002\uFF0E\uFF61]/g,q4="Overflow: input needs wider integers to process",Y4=RangeError,Mue=W_(K4.exec),Cv=Math.floor,nD=String.fromCharCode,X4=W_("".charCodeAt),J4=W_([].join),zm=W_([].push),Uue=W_("".replace),Vue=W_("".split),jue=W_("".toLowerCase),Q4=function(t){return t+22+75*(t<26)},Fue=function(t,r,s){var a=0;for(t=s?Cv(t/700):t>>1,t+=Cv(t/r);t>455;)t=Cv(t/35),a+=36;return Cv(a+36*t/(t+38))},Bue=function(t){var r=[];t=(function(ee){for(var Z=[],ae=0,ye=ee.length;ae<ye;){var _e=X4(ee,ae++);if(_e>=55296&&_e<=56319&&ae<ye){var ue=X4(ee,ae++);(64512&ue)==56320?zm(Z,((1023&_e)<<10)+(1023&ue)+65536):(zm(Z,_e),ae--)}else zm(Z,_e)}return Z})(t);var s,a,c=t.length,d=128,h=0,m=72;for(s=0;s<t.length;s++)(a=t[s])<128&&zm(r,nD(a));var g=r.length,E=g;for(g&&zm(r,"-");E<c;){var w=tD;for(s=0;s<t.length;s++)(a=t[s])>=d&&a<w&&(w=a);var I=E+1;if(w-d>Cv((tD-h)/I))throw new Y4(q4);for(h+=(w-d)*I,d=w,s=0;s<t.length;s++){if((a=t[s])<d&&++h>tD)throw new Y4(q4);if(a===d){for(var A=h,N=36;;){var G=N<=m?1:N>=m+26?26:N-m;if(A<G)break;var F=A-G,z=36-G;zm(r,nD(Q4(G+F%z))),A=Cv(F/z),N+=36}zm(r,nD(Q4(A))),m=Fue(h,I,E===g),h=0,E++}}h++,d++}return J4(r,"")},zue=Hn,rD=Se,Wue=pA,iD=D,Z4=ct,Uu=R,EA=Md,Vu=jh,Gue=O_,sD=Mr,oD=vue,Rv=function(t){var r=Aue(t),s=kue(this),a=arguments.length,c=a>1?arguments[1]:void 0,d=c!==void 0;d&&(c=Rue(c,a>2?arguments[2]:void 0));var h,m,g,E,w,I,A=Due(r),N=0;if(!A||this===$4&&Oue(A))for(h=Nue(r),m=s?new this(h):$4(h);h>N;N++)I=d?c(r[N],N):r[N],H4(m,N,I);else for(m=s?new this:[],w=(E=xue(r,A)).next;!(g=Iue(w,E)).done;N++)I=d?Pue(E,c,[g.value,N],!0):g.value,H4(m,N,I);return m.length=N,m},Fd=Es,Hue=Fx.codeAt,$ue=function(t){var r,s,a=[],c=Vue(Uue(jue(t),K4,"."),".");for(r=0;r<c.length;r++)s=c[r],zm(a,Mue(Lue,s)?"xn--"+Bue(s):s);return J4(a,".")},uf=qa,Kue=Ou,que=Zc,e6=uue,t6=Vh,Yue=t6.set,vA=t6.getterFor("URL"),Xue=e6.URLSearchParams,Jue=e6.getState,xw=iD.URL,aD=iD.TypeError,SA=iD.parseInt,Que=Math.floor,n6=Math.pow,ju=Uu("".charAt),Bd=Uu(/./.exec),Dw=Uu([].join),Zue=Uu(1 .toString),ede=Uu([].pop),Iv=Uu([].push),cD=Uu("".replace),tde=Uu([].shift),nde=Uu("".split),Lw=Uu("".slice),bA=Uu("".toLowerCase),rde=Uu([].unshift),lD="Invalid scheme",G_="Invalid host",r6="Invalid port",i6=/[a-z]/i,ide=/[\d+-.a-z]/i,uD=/\d/,sde=/^0x/i,ode=/^[0-7]+$/,ade=/^\d+$/,s6=/^[\da-f]+$/i,cde=/[\0\t\n\r #%/:<>?@[\\\]^|]/,lde=/[\0\t\n\r #/:<>?@[\\\]^|]/,ude=/^[\u0000-\u0020]+/,dde=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,hde=/[\t\n\r]/g,Mw=function(t){var r,s,a,c;if(typeof t=="number"){for(r=[],s=0;s<4;s++)rde(r,t%256),t=Que(t/256);return Dw(r,".")}if(typeof t=="object"){for(r="",a=(function(d){for(var h=null,m=1,g=null,E=0,w=0;w<8;w++)d[w]!==0?(E>m&&(h=g,m=E),g=null,E=0):(g===null&&(g=w),++E);return E>m?g:h})(t),s=0;s<8;s++)c&&t[s]===0||(c&&(c=!1),a===s?(r+=s?":":"::",c=!0):(r+=Zue(t[s],16),s<7&&(r+=":")));return"["+r+"]"}return t},wA={},o6=oD({},wA,{" ":1,'"':1,"<":1,">":1,"`":1}),a6=oD({},o6,{"#":1,"?":1,"{":1,"}":1}),dD=oD({},a6,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Wm=function(t,r){var s=Hue(t,0);return s>32&&s<127&&!sD(r,t)?t:encodeURIComponent(t)},TA={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Uw=function(t,r){var s;return t.length===2&&Bd(i6,ju(t,0))&&((s=ju(t,1))===":"||!r&&s==="|")},c6=function(t){var r;return t.length>1&&Uw(Lw(t,0,2))&&(t.length===2||(r=ju(t,2))==="/"||r==="\\"||r==="?"||r==="#")},pde=function(t){return t==="."||bA(t)==="%2e"},hD={},l6={},pD={},u6={},d6={},fD={},h6={},p6={},CA={},RA={},mD={},gD={},_D={},yD={},f6={},ED={},Av={},Xh={},m6={},H_={},df={},vD=function(t,r,s){var a,c,d,h=uf(t);if(r){if(c=this.parse(h))throw new aD(c);this.searchParams=null}else{if(s!==void 0&&(a=new vD(s,!0)),c=this.parse(h,null,a))throw new aD(c);(d=Jue(new Xue)).bindURL(this),this.searchParams=d}};vD.prototype={type:"URL",parse:function(t,r,s){var a,c,d,h,m,g=this,E=r||hD,w=0,I="",A=!1,N=!1,G=!1;for(t=uf(t),r||(g.scheme="",g.username="",g.password="",g.host=null,g.port=null,g.path=[],g.query=null,g.fragment=null,g.cannotBeABaseURL=!1,t=cD(t,ude,""),t=cD(t,dde,"$1")),t=cD(t,hde,""),a=Rv(t);w<=a.length;){switch(c=a[w],E){case hD:if(!c||!Bd(i6,c)){if(r)return lD;E=pD;continue}I+=bA(c),E=l6;break;case l6:if(c&&(Bd(ide,c)||c==="+"||c==="-"||c==="."))I+=bA(c);else{if(c!==":"){if(r)return lD;I="",E=pD,w=0;continue}if(r&&(g.isSpecial()!==sD(TA,I)||I==="file"&&(g.includesCredentials()||g.port!==null)||g.scheme==="file"&&!g.host))return;if(g.scheme=I,r)return void(g.isSpecial()&&TA[g.scheme]===g.port&&(g.port=null));I="",g.scheme==="file"?E=yD:g.isSpecial()&&s&&s.scheme===g.scheme?E=u6:g.isSpecial()?E=p6:a[w+1]==="/"?(E=d6,w++):(g.cannotBeABaseURL=!0,Iv(g.path,""),E=m6)}break;case pD:if(!s||s.cannotBeABaseURL&&c!=="#")return lD;if(s.cannotBeABaseURL&&c==="#"){g.scheme=s.scheme,g.path=Fd(s.path),g.query=s.query,g.fragment="",g.cannotBeABaseURL=!0,E=df;break}E=s.scheme==="file"?yD:fD;continue;case u6:if(c!=="/"||a[w+1]!=="/"){E=fD;continue}E=CA,w++;break;case d6:if(c==="/"){E=RA;break}E=Xh;continue;case fD:if(g.scheme=s.scheme,c===Mu)g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Fd(s.path),g.query=s.query;else if(c==="/"||c==="\\"&&g.isSpecial())E=h6;else if(c==="?")g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Fd(s.path),g.query="",E=H_;else{if(c!=="#"){g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Fd(s.path),g.path.length--,E=Xh;continue}g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,g.path=Fd(s.path),g.query=s.query,g.fragment="",E=df}break;case h6:if(!g.isSpecial()||c!=="/"&&c!=="\\"){if(c!=="/"){g.username=s.username,g.password=s.password,g.host=s.host,g.port=s.port,E=Xh;continue}E=RA}else E=CA;break;case p6:if(E=CA,c!=="/"||ju(I,w+1)!=="/")continue;w++;break;case CA:if(c!=="/"&&c!=="\\"){E=RA;continue}break;case RA:if(c==="@"){A&&(I="%40"+I),A=!0,d=Rv(I);for(var F=0;F<d.length;F++){var z=d[F];if(z!==":"||G){var ee=Wm(z,dD);G?g.password+=ee:g.username+=ee}else G=!0}I=""}else if(c===Mu||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(A&&I==="")return"Invalid authority";w-=Rv(I).length+1,I="",E=mD}else I+=c;break;case mD:case gD:if(r&&g.scheme==="file"){E=ED;continue}if(c!==":"||N){if(c===Mu||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()){if(g.isSpecial()&&I==="")return G_;if(r&&I===""&&(g.includesCredentials()||g.port!==null))return;if(h=g.parseHost(I))return h;if(I="",E=Av,r)return;continue}c==="["?N=!0:c==="]"&&(N=!1),I+=c}else{if(I==="")return G_;if(h=g.parseHost(I))return h;if(I="",E=_D,r===gD)return}break;case _D:if(!Bd(uD,c)){if(c===Mu||c==="/"||c==="?"||c==="#"||c==="\\"&&g.isSpecial()||r){if(I!==""){var Z=SA(I,10);if(Z>65535)return r6;g.port=g.isSpecial()&&Z===TA[g.scheme]?null:Z,I=""}if(r)return;E=Av;continue}return r6}I+=c;break;case yD:if(g.scheme="file",c==="/"||c==="\\")E=f6;else{if(!s||s.scheme!=="file"){E=Xh;continue}switch(c){case Mu:g.host=s.host,g.path=Fd(s.path),g.query=s.query;break;case"?":g.host=s.host,g.path=Fd(s.path),g.query="",E=H_;break;case"#":g.host=s.host,g.path=Fd(s.path),g.query=s.query,g.fragment="",E=df;break;default:c6(Dw(Fd(a,w),""))||(g.host=s.host,g.path=Fd(s.path),g.shortenPath()),E=Xh;continue}}break;case f6:if(c==="/"||c==="\\"){E=ED;break}s&&s.scheme==="file"&&!c6(Dw(Fd(a,w),""))&&(Uw(s.path[0],!0)?Iv(g.path,s.path[0]):g.host=s.host),E=Xh;continue;case ED:if(c===Mu||c==="/"||c==="\\"||c==="?"||c==="#"){if(!r&&Uw(I))E=Xh;else if(I===""){if(g.host="",r)return;E=Av}else{if(h=g.parseHost(I))return h;if(g.host==="localhost"&&(g.host=""),r)return;I="",E=Av}continue}I+=c;break;case Av:if(g.isSpecial()){if(E=Xh,c!=="/"&&c!=="\\")continue}else if(r||c!=="?")if(r||c!=="#"){if(c!==Mu&&(E=Xh,c!=="/"))continue}else g.fragment="",E=df;else g.query="",E=H_;break;case Xh:if(c===Mu||c==="/"||c==="\\"&&g.isSpecial()||!r&&(c==="?"||c==="#")){if((m=bA(m=I))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(g.shortenPath(),c==="/"||c==="\\"&&g.isSpecial()||Iv(g.path,"")):pde(I)?c==="/"||c==="\\"&&g.isSpecial()||Iv(g.path,""):(g.scheme==="file"&&!g.path.length&&Uw(I)&&(g.host&&(g.host=""),I=ju(I,0)+":"),Iv(g.path,I)),I="",g.scheme==="file"&&(c===Mu||c==="?"||c==="#"))for(;g.path.length>1&&g.path[0]==="";)tde(g.path);c==="?"?(g.query="",E=H_):c==="#"&&(g.fragment="",E=df)}else I+=Wm(c,a6);break;case m6:c==="?"?(g.query="",E=H_):c==="#"?(g.fragment="",E=df):c!==Mu&&(g.path[0]+=Wm(c,wA));break;case H_:r||c!=="#"?c!==Mu&&(c==="'"&&g.isSpecial()?g.query+="%27":g.query+=c==="#"?"%23":Wm(c,wA)):(g.fragment="",E=df);break;case df:c!==Mu&&(g.fragment+=Wm(c,o6))}w++}},parseHost:function(t){var r,s,a;if(ju(t,0)==="["){if(ju(t,t.length-1)!=="]"||(r=(function(c){var d,h,m,g,E,w,I,A=[0,0,0,0,0,0,0,0],N=0,G=null,F=0,z=function(){return ju(c,F)};if(z()===":"){if(ju(c,1)!==":")return;F+=2,G=++N}for(;z();){if(N===8)return;if(z()!==":"){for(d=h=0;h<4&&Bd(s6,z());)d=16*d+SA(z(),16),F++,h++;if(z()==="."){if(h===0||(F-=h,N>6))return;for(m=0;z();){if(g=null,m>0){if(!(z()==="."&&m<4))return;F++}if(!Bd(uD,z()))return;for(;Bd(uD,z());){if(E=SA(z(),10),g===null)g=E;else{if(g===0)return;g=10*g+E}if(g>255)return;F++}A[N]=256*A[N]+g,++m!=2&&m!==4||N++}if(m!==4)return;break}if(z()===":"){if(F++,!z())return}else if(z())return;A[N++]=d}else{if(G!==null)return;F++,G=++N}}if(G!==null)for(w=N-G,N=7;N!==0&&w>0;)I=A[N],A[N--]=A[G+w-1],A[G+--w]=I;else if(N!==8)return;return A})(Lw(t,1,-1)),!r))return G_;this.host=r}else if(this.isSpecial()){if(t=$ue(t),Bd(cde,t)||(r=(function(c){var d,h,m,g,E,w,I,A=nde(c,".");if(A.length&&A[A.length-1]===""&&A.length--,(d=A.length)>4)return c;for(h=[],m=0;m<d;m++){if((g=A[m])==="")return c;if(E=10,g.length>1&&ju(g,0)==="0"&&(E=Bd(sde,g)?16:8,g=Lw(g,E===8?1:2)),g==="")w=0;else{if(!Bd(E===10?ade:E===8?ode:s6,g))return c;w=SA(g,E)}Iv(h,w)}for(m=0;m<d;m++)if(w=h[m],m===d-1){if(w>=n6(256,5-d))return null}else if(w>255)return null;for(I=ede(h),m=0;m<h.length;m++)I+=h[m]*n6(256,3-m);return I})(t),r===null))return G_;this.host=r}else{if(Bd(lde,t))return G_;for(r="",s=Rv(t),a=0;a<s.length;a++)r+=Wm(s[a],wA);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return sD(TA,this.scheme)},shortenPath:function(){var t=this.path,r=t.length;!r||this.scheme==="file"&&r===1&&Uw(t[0],!0)||t.length--},serialize:function(){var t=this,r=t.scheme,s=t.username,a=t.password,c=t.host,d=t.port,h=t.path,m=t.query,g=t.fragment,E=r+":";return c!==null?(E+="//",t.includesCredentials()&&(E+=s+(a?":"+a:"")+"@"),E+=Mw(c),d!==null&&(E+=":"+d)):r==="file"&&(E+="//"),E+=t.cannotBeABaseURL?h[0]:h.length?"/"+Dw(h,"/"):"",m!==null&&(E+="?"+m),g!==null&&(E+="#"+g),E},setHref:function(t){var r=this.parse(t);if(r)throw new aD(r);this.searchParams.update()},getOrigin:function(){var t=this.scheme,r=this.port;if(t==="blob")try{return new Pv(t.path[0]).origin}catch{return"null"}return t!=="file"&&this.isSpecial()?t+"://"+Mw(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(uf(t)+":",hD)},getUsername:function(){return this.username},setUsername:function(t){var r=Rv(uf(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<r.length;s++)this.username+=Wm(r[s],dD)}},getPassword:function(){return this.password},setPassword:function(t){var r=Rv(uf(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<r.length;s++)this.password+=Wm(r[s],dD)}},getHost:function(){var t=this.host,r=this.port;return t===null?"":r===null?Mw(t):Mw(t)+":"+r},setHost:function(t){this.cannotBeABaseURL||this.parse(t,mD)},getHostname:function(){var t=this.host;return t===null?"":Mw(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,gD)},getPort:function(){var t=this.port;return t===null?"":uf(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=uf(t))===""?this.port=null:this.parse(t,_D))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+Dw(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,Av))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=uf(t))===""?this.query=null:(ju(t,0)==="?"&&(t=Lw(t,1)),this.query="",this.parse(t,H_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=uf(t))!==""?(ju(t,0)==="#"&&(t=Lw(t,1)),this.fragment="",this.parse(t,df)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Pv=function(t){var r=Gue(this,Pc),s=que(arguments.length,1)>1?arguments[1]:void 0,a=Yue(r,new vD(t,!1,s));rD||(r.href=a.serialize(),r.origin=a.getOrigin(),r.protocol=a.getProtocol(),r.username=a.getUsername(),r.password=a.getPassword(),r.host=a.getHost(),r.hostname=a.getHostname(),r.port=a.getPort(),r.pathname=a.getPathname(),r.search=a.getSearch(),r.searchParams=a.getSearchParams(),r.hash=a.getHash())},Pc=Pv.prototype,Fu=function(t,r){return{get:function(){return vA(this)[t]()},set:r&&function(s){return vA(this)[r](s)},configurable:!0,enumerable:!0}};if(rD&&(Vu(Pc,"href",Fu("serialize","setHref")),Vu(Pc,"origin",Fu("getOrigin")),Vu(Pc,"protocol",Fu("getProtocol","setProtocol")),Vu(Pc,"username",Fu("getUsername","setUsername")),Vu(Pc,"password",Fu("getPassword","setPassword")),Vu(Pc,"host",Fu("getHost","setHost")),Vu(Pc,"hostname",Fu("getHostname","setHostname")),Vu(Pc,"port",Fu("getPort","setPort")),Vu(Pc,"pathname",Fu("getPathname","setPathname")),Vu(Pc,"search",Fu("getSearch","setSearch")),Vu(Pc,"searchParams",Fu("getSearchParams")),Vu(Pc,"hash",Fu("getHash","setHash"))),EA(Pc,"toJSON",(function(){return vA(this).serialize()}),{enumerable:!0}),EA(Pc,"toString",(function(){return vA(this).serialize()}),{enumerable:!0}),xw){var g6=xw.createObjectURL,_6=xw.revokeObjectURL;g6&&EA(Pv,"createObjectURL",Z4(g6,xw)),_6&&EA(Pv,"revokeObjectURL",Z4(_6,xw))}Kue(Pv,"URL"),zue({global:!0,forced:!Wue,sham:!rD},{URL:Pv});var fde=Hn,y6=u,mde=Zc,E6=qa,gde=pA,SD=Et("URL"),_de=gde&&y6((function(){SD.canParse()})),yde=y6((function(){return SD.canParse.length!==1}));fde({target:"URL",stat:!0,forced:!_de||yde},{canParse:function(t){var r=mde(arguments.length,1),s=E6(t),a=r<2||arguments[1]===void 0?void 0:E6(arguments[1]);try{return!!new SD(s,a)}catch{return!1}}});var Ede=Hn,vde=Zc,v6=qa,Sde=pA,bde=Et("URL");Ede({target:"URL",stat:!0,forced:!Sde},{parse:function(t){var r=vde(arguments.length,1),s=v6(t),a=r<2||arguments[1]===void 0?void 0:v6(arguments[1]);try{return new bde(s,a)}catch{return null}}});var IA=l(St.URL);let S6=!0,b6=!0;function AA(t,r,s){const a=t.match(r);return a&&a.length>=s&&parseInt(a[s],10)}function $_(t,r,s){if(!t.RTCPeerConnection)return;const a=t.RTCPeerConnection.prototype,c=a.addEventListener;a.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const g=E=>{const w=s(E);w&&(m.handleEvent?m.handleEvent(w):m(w))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,g),c.apply(this,[h,g])};const d=a.removeEventListener;a.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return d.apply(this,arguments);if(!this._eventMap[r].has(m))return d.apply(this,arguments);const g=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,d.apply(this,[h,g])},Object.defineProperty(a,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function wde(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(S6=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function Tde(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(b6=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function w6(){if(typeof window=="object"){if(S6)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function bD(t,r){b6&&console.warn(t+" is deprecated, please use "+r+" instead.")}function T6(t){return Object.prototype.toString.call(t)==="[object Object]"}function C6(t){var r;return T6(t)?Ya(r=Object.keys(t)).call(r,(function(s,a){const c=T6(t[a]),d=c?C6(t[a]):t[a],h=c&&!Object.keys(d).length;return d===void 0||h?s:Object.assign(s,{[a]:d})}),{}):t}function wD(t,r,s){r&&!s.has(r.id)&&(s.set(r.id,r),Object.keys(r).forEach((a=>{a.endsWith("Id")?wD(t,t.get(r[a]),s):a.endsWith("Ids")&&r[a].forEach((c=>{wD(t,t.get(c),s)}))})))}function R6(t,r,s){const a=s?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const d=[];return t.forEach((h=>{h.type==="track"&&h.trackIdentifier===r.id&&d.push(h)})),d.forEach((h=>{t.forEach((m=>{m.type===a&&m.trackId===h.id&&wD(t,m,c)}))})),c}const I6=w6;function A6(t,r){const s=t&&t.navigator;if(!s.mediaDevices)return;const a=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach((g=>{if(g==="require"||g==="advanced"||g==="mediaSource")return;const E=typeof h[g]=="object"?h[g]:{ideal:h[g]};E.exact!==void 0&&typeof E.exact=="number"&&(E.min=E.max=E.exact);const w=function(I,A){return I?I+A.charAt(0).toUpperCase()+A.slice(1):A==="deviceId"?"sourceId":A};if(E.ideal!==void 0){m.optional=m.optional||[];let I={};typeof E.ideal=="number"?(I[w("min",g)]=E.ideal,m.optional.push(I),I={},I[w("max",g)]=E.ideal,m.optional.push(I)):(I[w("",g)]=E.ideal,m.optional.push(I))}E.exact!==void 0&&typeof E.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[w("",g)]=E.exact):["min","max"].forEach((I=>{E[I]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[w(I,g)]=E[I])}))})),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const g=function(E,w,I){w in E&&!(I in E)&&(E[I]=E[w],delete E[w])};g((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),g(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=a(h.audio)}if(h&&typeof h.video=="object"){let g=h.video.facingMode;g=g&&(typeof g=="object"?g:{ideal:g});const E=r.version<66;if(g&&(g.exact==="user"||g.exact==="environment"||g.ideal==="user"||g.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||E)){let w;if(delete h.video.facingMode,g.exact==="environment"||g.ideal==="environment"?w=["back","rear"]:g.exact!=="user"&&g.ideal!=="user"||(w=["front"]),w)return s.mediaDevices.enumerateDevices().then((I=>{I=I.filter((N=>N.kind==="videoinput"));let A=I.find((N=>w.some((G=>{var F;return rt(F=N.label.toLowerCase()).call(F,G)}))));return!A&&I.length&&rt(w).call(w,"back")&&(A=I[I.length-1]),A&&(h.video.deviceId=g.exact?{exact:A.deviceId}:{ideal:A.deviceId}),h.video=a(h.video),I6("chrome: "+JSON.stringify(h)),m(h)}))}h.video=a(h.video)}return I6("chrome: "+JSON.stringify(h)),m(h)},d=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(h,m,g){c(h,(E=>{s.webkitGetUserMedia(E,m,(w=>{g&&g(d(w))}))}))}).bind(s),s.mediaDevices.getUserMedia){const h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(m){return c(m,(g=>h(g).then((E=>{if(g.audio&&!E.getAudioTracks().length||g.video&&!E.getVideoTracks().length)throw E.getTracks().forEach((w=>{w.stop()})),new DOMException("","NotFoundError");return E}),(E=>mt.reject(d(E))))))}}}function P6(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function O6(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",(a=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((h=>h.track&&h.track.id===a.track.id)):{track:a.track};const d=new Event("track");d.track=a.track,d.receiver=c,d.transceiver={receiver:c},d.streams=[s.stream],this.dispatchEvent(d)})),s.stream.getTracks().forEach((a=>{let c;c=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((h=>h.track&&h.track.id===a.id)):{track:a};const d=new Event("track");d.track=a,d.receiver=c,d.transceiver={receiver:c},d.streams=[s.stream],this.dispatchEvent(d)}))},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else $_(t,"track",(r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r)))}function k6(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const r=function(c,d){return{track:d,get dtmf(){return this._dtmf===void 0&&(d.kind==="audio"?this._dtmf=c.createDTMFSender(d):this._dtmf=null),this._dtmf},_pc:c}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(h,m){let g=c.apply(this,arguments);return g||(g=r(this,h),this._senders.push(g)),g};const d=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(h){d.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach((d=>{this._senders.push(r(this,d))}))};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],a.apply(this,[c]),c.getTracks().forEach((d=>{const h=this._senders.find((m=>m.track===d));h&&this._senders.splice(this._senders.indexOf(h),1)}))}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const r=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach((a=>a._pc=this)),s},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function N6(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[s,a,c]=arguments;if(arguments.length>0&&typeof s=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof s!="function"))return r.apply(this,[]);const d=function(m){const g={};return m.result().forEach((E=>{const w={id:E.id,timestamp:E.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[E.type]||E.type};E.names().forEach((I=>{w[I]=E.stat(I)})),g[w.id]=w})),g},h=function(m){return new Map(Object.keys(m).map((g=>[g,m[g]])))};if(arguments.length>=2){const m=function(g){a(h(d(g)))};return r.apply(this,[m,s])}return new mt(((m,g)=>{r.apply(this,[function(E){m(h(d(E)))},g])})).then(a,c)}}function x6(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const s=t.RTCPeerConnection.prototype.getSenders;s&&(t.RTCPeerConnection.prototype.getSenders=function(){const c=s.apply(this,[]);return c.forEach((d=>d._pc=this)),c});const a=t.RTCPeerConnection.prototype.addTrack;a&&(t.RTCPeerConnection.prototype.addTrack=function(){const c=a.apply(this,arguments);return c._pc=this,c}),t.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then((d=>R6(d,c.track,!0)))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const s=t.RTCPeerConnection.prototype.getReceivers;s&&(t.RTCPeerConnection.prototype.getReceivers=function(){const a=s.apply(this,[]);return a.forEach((c=>c._pc=this)),a}),$_(t,"track",(a=>(a.receiver._pc=a.srcElement,a))),t.RTCRtpReceiver.prototype.getStats=function(){const a=this;return this._pc.getStats().then((c=>R6(c,a.track,!1)))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const s=arguments[0];let a,c,d;return this.getSenders().forEach((h=>{h.track===s&&(a?d=!0:a=h)})),this.getReceivers().forEach((h=>(h.track===s&&(c?d=!0:c=h),h.track===s))),d||a&&c?mt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):a?a.getStats():c?c.getStats():mt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function D6(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((d=>this._shimmedLocalStreams[d][0]))};const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(d,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const s=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(d){this._shimmedLocalStreams=this._shimmedLocalStreams||{},d.getTracks().forEach((g=>{if(this.getSenders().find((w=>w.track===g)))throw new DOMException("Track already exists.","InvalidAccessError")}));const h=this.getSenders();s.apply(this,arguments);const m=this.getSenders().filter((g=>h.indexOf(g)===-1));this._shimmedLocalStreams[d.id]=[d].concat(m)};const a=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[d.id],a.apply(this,arguments)};const c=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(d){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},d&&Object.keys(this._shimmedLocalStreams).forEach((h=>{const m=this._shimmedLocalStreams[h].indexOf(d);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]})),c.apply(this,arguments)}}function L6(t,r){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&r.version>=65)return D6(t);const s=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const g=s.apply(this);return this._reverseStreams=this._reverseStreams||{},g.map((E=>this._reverseStreams[E.id]))};const a=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(g){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.getTracks().forEach((E=>{if(this.getSenders().find((I=>I.track===E)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[g.id]){const E=new t.MediaStream(g.getTracks());this._streams[g.id]=E,this._reverseStreams[E.id]=g,g=E}a.apply(this,[g])};const c=t.RTCPeerConnection.prototype.removeStream;function d(g,E){let w=E.sdp;return Object.keys(g._reverseStreams||[]).forEach((I=>{const A=g._reverseStreams[I],N=g._streams[A.id];w=w.replace(new RegExp(N.id,"g"),A.id)})),new RTCSessionDescription({type:E.type,sdp:w})}t.RTCPeerConnection.prototype.removeStream=function(g){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[g.id]||g]),delete this._reverseStreams[this._streams[g.id]?this._streams[g.id].id:g.id],delete this._streams[g.id]},t.RTCPeerConnection.prototype.addTrack=function(g,E){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const w=[].slice.call(arguments,1);if(w.length!==1||!w[0].getTracks().find((N=>N===g)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((N=>N.track===g)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const A=this._streams[E.id];if(A)A.addTrack(g),mt.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const N=new t.MediaStream([g]);this._streams[E.id]=N,this._reverseStreams[N.id]=E,this.addStream(N)}return this.getSenders().find((N=>N.track===g))},["createOffer","createAnswer"].forEach((function(g){const E=t.RTCPeerConnection.prototype[g],w={[g](){const I=arguments;return arguments.length&&typeof arguments[0]=="function"?E.apply(this,[A=>{const N=d(this,A);I[0].apply(null,[N])},A=>{I[1]&&I[1].apply(null,A)},arguments[2]]):E.apply(this,arguments).then((A=>d(this,A)))}};t.RTCPeerConnection.prototype[g]=w[g]}));const h=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(g,E){let w=E.sdp;return Object.keys(g._reverseStreams||[]).forEach((I=>{const A=g._reverseStreams[I],N=g._streams[A.id];w=w.replace(new RegExp(A.id,"g"),N.id)})),new RTCSessionDescription({type:E.type,sdp:w})})(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const g=m.get.apply(this);return g.type===""?g:d(this,g)}}),t.RTCPeerConnection.prototype.removeTrack=function(g){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!g._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(g._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let E;this._streams=this._streams||{},Object.keys(this._streams).forEach((w=>{this._streams[w].getTracks().find((I=>g.track===I))&&(E=this._streams[w])})),E&&(E.getTracks().length===1?this.removeStream(this._reverseStreams[E.id]):E.removeTrack(g.track),this.dispatchEvent(new Event("negotiationneeded")))}}function TD(t,r){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(s){const a=t.RTCPeerConnection.prototype[s],c={[s](){return arguments[0]=new(s==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};t.RTCPeerConnection.prototype[s]=c[s]}))}function M6(t,r){$_(t,"negotiationneeded",(s=>{const a=s.target;if(!(r.version<72||a.getConfiguration&&a.getConfiguration().sdpSemantics==="plan-b")||a.signalingState==="stable")return s}))}var U6=Object.freeze({__proto__:null,fixNegotiationNeeded:M6,shimAddTrackRemoveTrack:L6,shimAddTrackRemoveTrackWithNative:D6,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof r=="function"?t.navigator.mediaDevices.getDisplayMedia=function(s){return r(s).then((a=>{const c=s.video&&s.video.width,d=s.video&&s.video.height,h=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxFrameRate:h||3}},c&&(s.video.mandatory.maxWidth=c),d&&(s.video.mandatory.maxHeight=d),t.navigator.mediaDevices.getUserMedia(s)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:k6,shimGetStats:N6,shimGetUserMedia:A6,shimMediaStream:P6,shimOnTrack:O6,shimPeerConnection:TD,shimSenderReceiverGetStats:x6});function V6(t,r){const s=t&&t.navigator,a=t&&t.MediaStreamTrack;if(s.getUserMedia=function(c,d,h){bD("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(c).then(d,h)},!(r.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const c=function(h,m,g){m in h&&!(g in h)&&(h[g]=h[m],delete h[m])},d=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),d(h)},a&&a.prototype.getSettings){const h=a.prototype.getSettings;a.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(a&&a.prototype.applyConstraints){const h=a.prototype.applyConstraints;a.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function j6(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function CD(t,r){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(c){const d=t.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};t.RTCPeerConnection.prototype[c]=h[c]}));const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[c,d,h]=arguments;return a.apply(this,[c||null]).then((m=>{if(r.version<53&&!d)try{m.forEach((g=>{g.type=s[g.type]||g.type}))}catch(g){if(g.name!=="TypeError")throw g;m.forEach(((E,w)=>{m.set(w,Object.assign({},E,{type:s[E.type]||E.type}))}))}return m})).then(d,h)}}function F6(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){const a=r.apply(this,[]);return a.forEach((c=>c._pc=this)),a});const s=t.RTCPeerConnection.prototype.addTrack;s&&(t.RTCPeerConnection.prototype.addTrack=function(){const a=s.apply(this,arguments);return a._pc=this,a}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):mt.resolve(new Map)}}function B6(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){const s=r.apply(this,[]);return s.forEach((a=>a._pc=this)),s}),$_(t,"track",(s=>(s.receiver._pc=s.srcElement,s))),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function z6(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(r){bD("removeStream","removeTrack"),this.getSenders().forEach((s=>{var a;s.track&&rt(a=r.getTracks()).call(a,s.track)&&this.removeTrack(s)}))})}function W6(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function G6(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const a=s.length>0;a&&s.forEach((d=>{if("rid"in d&&!/^[a-z0-9]{0,16}$/i.test(d.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in d&&!(parseFloat(d.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in d&&!(parseFloat(d.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const c=r.apply(this,arguments);if(a){const{sender:d}=c,h=d.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=s,d.sendEncodings=s,this.setParametersPromises.push(d.setParameters(h).then((()=>{delete d.sendEncodings})).catch((()=>{delete d.sendEncodings}))))}return c})}function H6(t){if(typeof t!="object"||!t.RTCRtpSender)return;const r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){const s=r.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function $6(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?mt.all(this.setParametersPromises).then((()=>r.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):r.apply(this,arguments)}}function K6(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?mt.all(this.setParametersPromises).then((()=>r.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):r.apply(this,arguments)}}var q6=Object.freeze({__proto__:null,shimAddTransceiver:G6,shimCreateAnswer:K6,shimCreateOffer:$6,shimGetDisplayMedia:function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const a=new DOMException("getDisplayMedia without video constraints is undefined");return a.name="NotFoundError",a.code=8,mt.reject(a)}return s.video===!0?s.video={mediaSource:r}:s.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:H6,shimGetUserMedia:V6,shimOnTrack:j6,shimPeerConnection:CD,shimRTCDataChannel:W6,shimReceiverGetStats:B6,shimRemoveStream:z6,shimSenderGetStats:F6});function Y6(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const r=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(s){var a;this._localStreams||(this._localStreams=[]),rt(a=this._localStreams).call(a,s)||this._localStreams.push(s),s.getAudioTracks().forEach((c=>r.call(this,c,s))),s.getVideoTracks().forEach((c=>r.call(this,c,s)))},t.RTCPeerConnection.prototype.addTrack=function(s){for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];return c&&c.forEach((h=>{var m;this._localStreams?rt(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]})),r.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(r);if(s===-1)return;this._localStreams.splice(s,1);const a=r.getTracks();this.getSenders().forEach((c=>{rt(a).call(a,c.track)&&this.removeTrack(c)}))})}}function X6(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=a=>{a.streams.forEach((c=>{var d;if(this._remoteStreams||(this._remoteStreams=[]),rt(d=this._remoteStreams).call(d,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)}))})}});const r=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(a){a.streams.forEach((c=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(c)>=0)return;s._remoteStreams.push(c);const d=new Event("addstream");d.stream=c,s.dispatchEvent(d)}))}),r.apply(s,arguments)}}}function J6(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,s=r.createOffer,a=r.createAnswer,c=r.setLocalDescription,d=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(g,E){const w=arguments.length>=2?arguments[2]:arguments[0],I=s.apply(this,[w]);return E?(I.then(g,E),mt.resolve()):I},r.createAnswer=function(g,E){const w=arguments.length>=2?arguments[2]:arguments[0],I=a.apply(this,[w]);return E?(I.then(g,E),mt.resolve()):I};let m=function(g,E,w){const I=c.apply(this,[g]);return w?(I.then(E,w),mt.resolve()):I};r.setLocalDescription=m,m=function(g,E,w){const I=d.apply(this,[g]);return w?(I.then(E,w),mt.resolve()):I},r.setRemoteDescription=m,m=function(g,E,w){const I=h.apply(this,[g]);return w?(I.then(E,w),mt.resolve()):I},r.addIceCandidate=m}function Q6(t){const r=t&&t.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const s=r.mediaDevices,a=s.getUserMedia.bind(s);r.mediaDevices.getUserMedia=c=>a(Z6(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(s,a,c){r.mediaDevices.getUserMedia(s).then(a,c)}).bind(r))}function Z6(t){return t&&t.video!==void 0?Object.assign({},t,{video:C6(t.video)}):t}function eB(t){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection;t.RTCPeerConnection=function(s,a){if(s&&s.iceServers){const c=[];for(let d=0;d<s.iceServers.length;d++){let h=s.iceServers[d];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(bD("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(s.iceServers[d])}s.iceServers=c}return new r(s,a)},t.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function tB(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function nB(t){const r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const a=this.getTransceivers().find((d=>d.receiver.track.kind==="audio"));s.offerToReceiveAudio===!1&&a?a.direction==="sendrecv"?a.setDirection?a.setDirection("sendonly"):a.direction="sendonly":a.direction==="recvonly"&&(a.setDirection?a.setDirection("inactive"):a.direction="inactive"):s.offerToReceiveAudio!==!0||a||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const c=this.getTransceivers().find((d=>d.receiver.track.kind==="video"));s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function rB(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var iB=Object.freeze({__proto__:null,shimAudioContext:rB,shimCallbacksAPI:J6,shimConstraints:Z6,shimCreateOfferLegacy:nB,shimGetUserMedia:Q6,shimLocalStreamsAPI:Y6,shimRTCIceServerUrls:eB,shimRemoteStreamsAPI:X6,shimTrackEventTransceiver:tB}),sB=`	
\v\f\r \u2028\u2029\uFEFF`,Cde=Xt,Rde=qa,RD=sB,oB=R("".replace),Ide=RegExp("^["+RD+"]+"),Ade=RegExp("(^|[^"+RD+"])["+RD+"]+$"),Pde=function(t){return function(r){var s=Rde(Cde(r));return 1&t&&(s=oB(s,Ide,"")),2&t&&(s=oB(s,Ade,"$1")),s}},Ode={trim:Pde(3)},kde=JE.PROPER,Nde=u,aB=sB,xde=Ode.trim;Hn({target:"String",proto:!0,forced:(function(t){return Nde((function(){return!!aB[t]()||""[t]()!==""||kde&&aB[t].name!==t}))})("trim")},{trim:function(){return xde(this)}});var Dde=Sc("String","trim"),Lde=O,Mde=Dde,ID=String.prototype,Ude=function(t){var r=t.trim;return typeof t=="string"||t===ID||Lde(ID,t)&&r===ID.trim?Mde:r},jo=l(Ude),cB={exports:{}};(function(t){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(s){return s.trim().split(`
`).map((a=>a.trim()))},r.splitSections=function(s){return s.split(`
m=`).map(((a,c)=>(c>0?"m="+a:a).trim()+`\r
`))},r.getDescription=function(s){const a=r.splitSections(s);return a&&a[0]},r.getMediaSections=function(s){const a=r.splitSections(s);return a.shift(),a},r.matchPrefix=function(s,a){return r.splitLines(s).filter((c=>c.indexOf(a)===0))},r.parseCandidate=function(s){let a;a=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const c={foundation:a[0],component:{1:"rtp",2:"rtcp"}[a[1]]||a[1],protocol:a[2].toLowerCase(),priority:parseInt(a[3],10),ip:a[4],address:a[4],port:parseInt(a[5],10),type:a[7]};for(let d=8;d<a.length;d+=2)switch(a[d]){case"raddr":c.relatedAddress=a[d+1];break;case"rport":c.relatedPort=parseInt(a[d+1],10);break;case"tcptype":c.tcpType=a[d+1];break;case"ufrag":c.ufrag=a[d+1],c.usernameFragment=a[d+1];break;default:c[a[d]]===void 0&&(c[a[d]]=a[d+1])}return c},r.writeCandidate=function(s){const a=[];a.push(s.foundation);const c=s.component;c==="rtp"?a.push(1):c==="rtcp"?a.push(2):a.push(c),a.push(s.protocol.toUpperCase()),a.push(s.priority),a.push(s.address||s.ip),a.push(s.port);const d=s.type;return a.push("typ"),a.push(d),d!=="host"&&s.relatedAddress&&s.relatedPort&&(a.push("raddr"),a.push(s.relatedAddress),a.push("rport"),a.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(a.push("tcptype"),a.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(a.push("ufrag"),a.push(s.usernameFragment||s.ufrag)),"candidate:"+a.join(" ")},r.parseIceOptions=function(s){return s.substring(14).split(" ")},r.parseRtpMap=function(s){let a=s.substring(9).split(" ");const c={payloadType:parseInt(a.shift(),10)};return a=a[0].split("/"),c.name=a[0],c.clockRate=parseInt(a[1],10),c.channels=a.length===3?parseInt(a[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(s){let a=s.payloadType;s.preferredPayloadType!==void 0&&(a=s.preferredPayloadType);const c=s.channels||s.numChannels||1;return"a=rtpmap:"+a+" "+s.name+"/"+s.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(s){const a=s.substring(9).split(" ");return{id:parseInt(a[0],10),direction:a[0].indexOf("/")>0?a[0].split("/")[1]:"sendrecv",uri:a[1],attributes:a.slice(2).join(" ")}},r.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},r.parseFmtp=function(s){const a={};let c;const d=s.substring(s.indexOf(" ")+1).split(";");for(let h=0;h<d.length;h++)c=d[h].trim().split("="),a[c[0].trim()]=c[1];return a},r.writeFmtp=function(s){let a="",c=s.payloadType;if(s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const d=[];Object.keys(s.parameters).forEach((h=>{s.parameters[h]!==void 0?d.push(h+"="+s.parameters[h]):d.push(h)})),a+="a=fmtp:"+c+" "+d.join(";")+`\r
`}return a},r.parseRtcpFb=function(s){const a=s.substring(s.indexOf(" ")+1).split(" ");return{type:a.shift(),parameter:a.join(" ")}},r.writeRtcpFb=function(s){let a="",c=s.payloadType;return s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach((d=>{a+="a=rtcp-fb:"+c+" "+d.type+(d.parameter&&d.parameter.length?" "+d.parameter:"")+`\r
`})),a},r.parseSsrcMedia=function(s){const a=s.indexOf(" "),c={ssrc:parseInt(s.substring(7,a),10)},d=s.indexOf(":",a);return d>-1?(c.attribute=s.substring(a+1,d),c.value=s.substring(d+1)):c.attribute=s.substring(a+1),c},r.parseSsrcGroup=function(s){const a=s.substring(13).split(" ");return{semantics:a.shift(),ssrcs:a.map((c=>parseInt(c,10)))}},r.getMid=function(s){const a=r.matchPrefix(s,"a=mid:")[0];if(a)return a.substring(6)},r.parseFingerprint=function(s){const a=s.substring(14).split(" ");return{algorithm:a[0].toLowerCase(),value:a[1].toUpperCase()}},r.getDtlsParameters=function(s,a){return{role:"auto",fingerprints:r.matchPrefix(s+a,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(s,a){let c="a=setup:"+a+`\r
`;return s.fingerprints.forEach((d=>{c+="a=fingerprint:"+d.algorithm+" "+d.value+`\r
`})),c},r.parseCryptoLine=function(s){const a=s.substring(9).split(" ");return{tag:parseInt(a[0],10),cryptoSuite:a[1],keyParams:a[2],sessionParams:a.slice(3)}},r.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?r.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const a=s.substring(7).split("|");return{keyMethod:"inline",keySalt:a[0],lifeTime:a[1],mkiValue:a[2]?a[2].split(":")[0]:void 0,mkiLength:a[2]?a[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},r.getCryptoParameters=function(s,a){return r.matchPrefix(s+a,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(s,a){const c=r.matchPrefix(s+a,"a=ice-ufrag:")[0],d=r.matchPrefix(s+a,"a=ice-pwd:")[0];return c&&d?{usernameFragment:c.substring(12),password:d.substring(10)}:null},r.writeIceParameters=function(s){let a="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(a+=`a=ice-lite\r
`),a},r.parseRtpParameters=function(s){const a={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(s)[0].split(" ");a.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],g=r.matchPrefix(s,"a=rtpmap:"+m+" ")[0];if(g){const E=r.parseRtpMap(g),w=r.matchPrefix(s,"a=fmtp:"+m+" ");switch(E.parameters=w.length?r.parseFmtp(w[0]):{},E.rtcpFeedback=r.matchPrefix(s,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),a.codecs.push(E),E.name.toUpperCase()){case"RED":case"ULPFEC":a.fecMechanisms.push(E.name.toUpperCase())}}}r.matchPrefix(s,"a=extmap:").forEach((h=>{a.headerExtensions.push(r.parseExtmap(h))}));const d=r.matchPrefix(s,"a=rtcp-fb:* ").map(r.parseRtcpFb);return a.codecs.forEach((h=>{d.forEach((m=>{h.rtcpFeedback.find((g=>g.type===m.type&&g.parameter===m.parameter))||h.rtcpFeedback.push(m)}))})),a},r.writeRtpDescription=function(s,a){let c="";c+="m="+s+" ",c+=a.codecs.length>0?"9":"0",c+=" "+(a.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=a.codecs.map((h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType)).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,a.codecs.forEach((h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)}));let d=0;return a.codecs.forEach((h=>{h.maxptime>d&&(d=h.maxptime)})),d>0&&(c+="a=maxptime:"+d+`\r
`),a.headerExtensions&&a.headerExtensions.forEach((h=>{c+=r.writeExtmap(h)})),c},r.parseRtpEncodingParameters=function(s){const a=[],c=r.parseRtpParameters(s),d=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(s,"a=ssrc:").map((A=>r.parseSsrcMedia(A))).filter((A=>A.attribute==="cname")),g=m.length>0&&m[0].ssrc;let E;const w=r.matchPrefix(s,"a=ssrc-group:FID").map((A=>A.substring(17).split(" ").map((N=>parseInt(N,10)))));w.length>0&&w[0].length>1&&w[0][0]===g&&(E=w[0][1]),c.codecs.forEach((A=>{if(A.name.toUpperCase()==="RTX"&&A.parameters.apt){let N={ssrc:g,codecPayloadType:parseInt(A.parameters.apt,10)};g&&E&&(N.rtx={ssrc:E}),a.push(N),d&&(N=JSON.parse(JSON.stringify(N)),N.fec={ssrc:g,mechanism:h?"red+ulpfec":"red"},a.push(N))}})),a.length===0&&g&&a.push({ssrc:g});let I=r.matchPrefix(s,"b=");return I.length&&(I=I[0].indexOf("b=TIAS:")===0?parseInt(I[0].substring(7),10):I[0].indexOf("b=AS:")===0?1e3*parseInt(I[0].substring(5),10)*.95-16e3:void 0,a.forEach((A=>{A.maxBitrate=I}))),a},r.parseRtcpParameters=function(s){const a={},c=r.matchPrefix(s,"a=ssrc:").map((m=>r.parseSsrcMedia(m))).filter((m=>m.attribute==="cname"))[0];c&&(a.cname=c.value,a.ssrc=c.ssrc);const d=r.matchPrefix(s,"a=rtcp-rsize");a.reducedSize=d.length>0,a.compound=d.length===0;const h=r.matchPrefix(s,"a=rtcp-mux");return a.mux=h.length>0,a},r.writeRtcpParameters=function(s){let a="";return s.reducedSize&&(a+=`a=rtcp-rsize\r
`),s.mux&&(a+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(a+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),a},r.parseMsid=function(s){let a;const c=r.matchPrefix(s,"a=msid:");if(c.length===1)return a=c[0].substring(7).split(" "),{stream:a[0],track:a[1]};const d=r.matchPrefix(s,"a=ssrc:").map((h=>r.parseSsrcMedia(h))).filter((h=>h.attribute==="msid"));return d.length>0?(a=d[0].value.split(" "),{stream:a[0],track:a[1]}):void 0},r.parseSctpDescription=function(s){const a=r.parseMLine(s),c=r.matchPrefix(s,"a=max-message-size:");let d;c.length>0&&(d=parseInt(c[0].substring(19),10)),isNaN(d)&&(d=65536);const h=r.matchPrefix(s,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:a.fmt,maxMessageSize:d};const m=r.matchPrefix(s,"a=sctpmap:");if(m.length>0){const g=m[0].substring(10).split(" ");return{port:parseInt(g[0],10),protocol:g[1],maxMessageSize:d}}},r.writeSctpDescription=function(s,a){let c=[];return c=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+a.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+a.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+a.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+a.port+" "+a.protocol+` 65535\r
`],a.maxMessageSize!==void 0&&c.push("a=max-message-size:"+a.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(s,a,c){let d;const h=a!==void 0?a:2;return d=s||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+d+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(s,a){const c=r.splitLines(s);for(let d=0;d<c.length;d++)switch(c[d]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[d].substring(2)}return a?r.getDirection(a):"sendrecv"},r.getKind=function(s){return r.splitLines(s)[0].split(" ")[0].substring(2)},r.isRejected=function(s){return s.split(" ",2)[1]==="0"},r.parseMLine=function(s){const a=r.splitLines(s)[0].substring(2).split(" ");return{kind:a[0],port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},r.parseOLine=function(s){const a=r.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:a[0],sessionId:a[1],sessionVersion:parseInt(a[2],10),netType:a[3],addressType:a[4],address:a[5]}},r.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const a=r.splitLines(s);for(let c=0;c<a.length;c++)if(a[c].length<2||a[c].charAt(1)!=="=")return!1;return!0},t.exports=r})(cB);var lB=cB.exports,Ov=l(lB),Vde=i({__proto__:null,default:Ov},[lB]);function PA(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const r=t.RTCIceCandidate;t.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const a=new r(s),c=Ov.parseCandidate(s.candidate),d=Object.assign(a,c);return d.toJSON=function(){return{candidate:d.candidate,sdpMid:d.sdpMid,sdpMLineIndex:d.sdpMLineIndex,usernameFragment:d.usernameFragment}},d}return new r(s)},t.RTCIceCandidate.prototype=r.prototype,$_(t,"icecandidate",(s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new t.RTCIceCandidate(s.candidate),writable:"false"}),s)))}function AD(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||$_(t,"icecandidate",(r=>{if(r.candidate){const s=Ov.parseCandidate(r.candidate.candidate);s.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return r}))}function OA(t,r){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(m){if(!m||!m.sdp)return!1;const g=Ov.splitSections(m.sdp);return g.shift(),g.some((E=>{const w=Ov.parseMLine(E);return w&&w.kind==="application"&&w.protocol.indexOf("SCTP")!==-1}))},a=function(m){const g=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(g===null||g.length<2)return-1;const E=parseInt(g[1],10);return E!=E?-1:E},c=function(m){let g=65536;return r.browser==="firefox"&&(g=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),g},d=function(m,g){let E=65536;r.browser==="firefox"&&r.version===57&&(E=65535);const w=Ov.matchPrefix(m.sdp,"a=max-message-size:");return w.length>0?E=parseInt(w[0].substr(19),10):r.browser==="firefox"&&g!==-1&&(E=2147483637),E},h=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const m=a(arguments[0]),g=c(m),E=d(arguments[0],m);let w;w=g===0&&E===0?Number.POSITIVE_INFINITY:g===0||E===0?Math.max(g,E):Math.min(g,E);const I={};Object.defineProperty(I,"maxMessageSize",{get:()=>w}),this._sctp=I}return h.apply(this,arguments)}}function kA(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function r(a,c){const d=a.send;a.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(a.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return d.apply(a,arguments)}}const s=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const a=s.apply(this,arguments);return r(a,this),a},$_(t,"datachannel",(a=>(r(a.channel,a.target),a)))}function PD(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const r=t.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((s=>{const a=r[s];r[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const d=c.target;if(d._lastConnectionState!==d.connectionState){d._lastConnectionState=d.connectionState;const h=new Event("connectionstatechange",c);d.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),a.apply(this,arguments)}}))}function OD(t,r){if(!t.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(a){if(a&&a.sdp&&a.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=a.sdp.split(`
`).filter((d=>jo(d).call(d)!=="a=extmap-allow-mixed")).join(`
`);t.RTCSessionDescription&&a instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:a.type,sdp:c}):a.sdp=c}return s.apply(this,arguments)}}function NA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?mt.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),mt.resolve())})}function xA(t,r){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const s=t.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let a=arguments[0]||{};if(typeof a!="object"||a.type&&a.sdp)return s.apply(this,arguments);if(a={type:a.type,sdp:a.sdp},!a.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":a.type="offer";break;default:a.type="answer"}return a.sdp||a.type!=="offer"&&a.type!=="answer"?s.apply(this,[a]):(a.type==="offer"?this.createOffer:this.createAnswer).apply(this).then((c=>s.apply(this,[c])))})}var jde=Object.freeze({__proto__:null,removeExtmapAllowMixed:OD,shimAddIceCandidateNullOrEmpty:NA,shimConnectionState:PD,shimMaxMessageSize:OA,shimParameterlessSetLocalDescription:xA,shimRTCIceCandidate:PA,shimRTCIceCandidateRelayProtocol:AD,shimSendThrowTypeError:kA});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=w6,a=(function(d){const h={browser:null,version:null};if(d===void 0||!d.navigator)return h.browser="Not a browser.",h;const{navigator:m}=d;if(m.mozGetUserMedia)h.browser="firefox",h.version=AA(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||d.isSecureContext===!1&&d.webkitRTCPeerConnection)h.browser="chrome",h.version=AA(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!d.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=AA(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=d.RTCRtpTransceiver&&"currentDirection"in d.RTCRtpTransceiver.prototype}return h})(t),c={browserDetails:a,commonShim:jde,extractVersion:AA,disableLog:wde,disableWarnings:Tde,sdp:Vde};switch(a.browser){case"chrome":if(!U6||!TD||!r.shimChrome)return s("Chrome shim is not included in this adapter release."),c;if(a.version===null)return s("Chrome shim can not determine version, not shimming."),c;s("adapter.js shimming chrome."),c.browserShim=U6,NA(t,a),xA(t),A6(t,a),P6(t),TD(t,a),O6(t),L6(t,a),k6(t),N6(t),x6(t),M6(t,a),PA(t),AD(t),PD(t),OA(t,a),kA(t),OD(t,a);break;case"firefox":if(!q6||!CD||!r.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox."),c.browserShim=q6,NA(t,a),xA(t),V6(t,a),CD(t,a),j6(t),z6(t),F6(t),B6(t),W6(t),G6(t),H6(t),$6(t),K6(t),PA(t),PD(t),OA(t,a),kA(t);break;case"safari":if(!iB||!r.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari."),c.browserShim=iB,NA(t,a),xA(t),eB(t),nB(t),J6(t),Y6(t),X6(t),tB(t),Q6(t),rB(t),PA(t),AD(t),OA(t,a),kA(t),OD(t,a);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var kD=D;Hn({global:!0,forced:kD.globalThis!==kD},{globalThis:kD});var uB=l(D),ND={exports:{}};(function(t,r){(function(s,a){var c="function",d="undefined",h="object",m="string",g="major",E="model",w="name",I="type",A="vendor",N="version",G="architecture",F="console",z="mobile",ee="tablet",Z="smarttv",ae="wearable",ye="embedded",_e="Amazon",ue="Apple",Ae="ASUS",Ue="BlackBerry",We="Browser",Ze="Chrome",_n="Firefox",Sn="Google",Qt="Huawei",rr="LG",Jn="Microsoft",co="Motorola",ze="Opera",ot="Samsung",bt="Sharp",He="Sony",V="Xiaomi",ce="Zebra",ge="Facebook",tt="Chromium OS",un="Mac OS",Ir=" Browser",zi=function(Di){for(var Wi={},xr=0;xr<Di.length;xr++)Wi[Di[xr].toUpperCase()]=Di[xr];return Wi},ou=function(Di,Wi){return typeof Di===m&&ed(Wi).indexOf(ed(Di))!==-1},ed=function(Di){return Di.toLowerCase()},BT=function(Di,Wi){if(typeof Di===m)return Di=Di.replace(/^\s\s*/,""),typeof Wi===d?Di:Di.substring(0,500)},vy=function(Di,Wi){for(var xr,oc,rh,vi,Cf,Un,ih=0;ih<Wi.length&&!Cf;){var Sy=Wi[ih],pp=Wi[ih+1];for(xr=oc=0;xr<Sy.length&&!Cf&&Sy[xr];)if(Cf=Sy[xr++].exec(Di))for(rh=0;rh<pp.length;rh++)Un=Cf[++oc],typeof(vi=pp[rh])===h&&vi.length>0?vi.length===2?typeof vi[1]==c?this[vi[0]]=vi[1].call(this,Un):this[vi[0]]=vi[1]:vi.length===3?typeof vi[1]!==c||vi[1].exec&&vi[1].test?this[vi[0]]=Un?Un.replace(vi[1],vi[2]):a:this[vi[0]]=Un?vi[1].call(this,Un,vi[2]):a:vi.length===4&&(this[vi[0]]=Un?vi[3].call(this,Un.replace(vi[1],vi[2])):a):this[vi]=Un||a;ih+=2}},w0=function(Di,Wi){for(var xr in Wi)if(typeof Wi[xr]===h&&Wi[xr].length>0){for(var oc=0;oc<Wi[xr].length;oc++)if(ou(Wi[xr][oc],Di))return xr==="?"?a:xr}else if(ou(Wi[xr],Di))return xr==="?"?a:xr;return Wi.hasOwnProperty("*")?Wi["*"]:Di},xP={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},DP={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[N,[w,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[N,[w,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[w,N],[/opios[\/ ]+([\w\.]+)/i],[N,[w,ze+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[N,[w,ze+" GX"]],[/\bopr\/([\w\.]+)/i],[N,[w,ze]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[N,[w,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[N,[w,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[w,N],[/quark(?:pc)?\/([-\w\.]+)/i],[N,[w,"Quark"]],[/\bddg\/([\w\.]+)/i],[N,[w,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[N,[w,"UC"+We]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[N,[w,"WeChat"]],[/konqueror\/([\w\.]+)/i],[N,[w,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[N,[w,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[N,[w,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[N,[w,"Smart Lenovo "+We]],[/(avast|avg)\/([\w\.]+)/i],[[w,/(.+)/,"$1 Secure "+We],N],[/\bfocus\/([\w\.]+)/i],[N,[w,_n+" Focus"]],[/\bopt\/([\w\.]+)/i],[N,[w,ze+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[N,[w,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[N,[w,"Dolphin"]],[/coast\/([\w\.]+)/i],[N,[w,ze+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[N,[w,"MIUI"+Ir]],[/fxios\/([\w\.-]+)/i],[N,[w,_n]],[/\bqihoobrowser\/?([\w\.]*)/i],[N,[w,"360"]],[/\b(qq)\/([\w\.]+)/i],[[w,/(.+)/,"$1Browser"],N],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[w,/(.+)/,"$1"+Ir],N],[/samsungbrowser\/([\w\.]+)/i],[N,[w,ot+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[N,[w,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[w,"Sogou Mobile"],N],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[w,N],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[w],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[N,w],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[w,ge],N],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[w,N],[/\bgsa\/([\w\.]+) .*safari\//i],[N,[w,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[N,[w,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[N,[w,Ze+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[w,Ze+" WebView"],N],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[N,[w,"Android "+We]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[w,N],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[N,[w,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[N,w],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[w,[N,w0,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[w,N],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[w,"Netscape"],N],[/(wolvic|librewolf)\/([\w\.]+)/i],[w,N],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[N,[w,_n+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[w,[N,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[w,[N,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[G,"amd64"]],[/(ia32(?=;))/i],[[G,ed]],[/((?:i[346]|x)86)[;\)]/i],[[G,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[G,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[G,"armhf"]],[/windows (ce|mobile); ppc;/i],[[G,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[G,/ower/,"",ed]],[/(sun4\w)[;\)]/i],[[G,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[G,ed]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[E,[A,ot],[I,ee]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[E,[A,ot],[I,z]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[E,[A,ue],[I,z]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[E,[A,ue],[I,ee]],[/(macintosh);/i],[E,[A,ue]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[E,[A,bt],[I,z]],[/(?:honor)([-\w ]+)[;\)]/i],[E,[A,"Honor"],[I,z]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[E,[A,Qt],[I,ee]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[E,[A,Qt],[I,z]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[E,/_/g," "],[A,V],[I,z]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[E,/_/g," "],[A,V],[I,ee]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[E,[A,"OPPO"],[I,z]],[/\b(opd2\d{3}a?) bui/i],[E,[A,"OPPO"],[I,ee]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[E,[A,"Vivo"],[I,z]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[E,[A,"Realme"],[I,z]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[E,[A,co],[I,z]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[E,[A,co],[I,ee]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[E,[A,rr],[I,ee]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[E,[A,rr],[I,z]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[E,[A,"Lenovo"],[I,ee]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[E,/_/g," "],[A,"Nokia"],[I,z]],[/(pixel c)\b/i],[E,[A,Sn],[I,ee]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[E,[A,Sn],[I,z]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[E,[A,He],[I,z]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[E,"Xperia Tablet"],[A,He],[I,ee]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[E,[A,"OnePlus"],[I,z]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[E,[A,_e],[I,ee]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[E,/(.+)/g,"Fire Phone $1"],[A,_e],[I,z]],[/(playbook);[-\w\),; ]+(rim)/i],[E,A,[I,ee]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[E,[A,Ue],[I,z]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[E,[A,Ae],[I,ee]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[E,[A,Ae],[I,z]],[/(nexus 9)/i],[E,[A,"HTC"],[I,ee]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[A,[E,/_/g," "],[I,z]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[E,[A,"TCL"],[I,ee]],[/(itel) ((\w+))/i],[[A,ed],E,[I,w0,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[E,[A,"Acer"],[I,ee]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[E,[A,"Meizu"],[I,z]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[E,[A,"Ulefone"],[I,z]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[E,[A,"Energizer"],[I,z]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[E,[A,"Cat"],[I,z]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[E,[A,"Smartfren"],[I,z]],[/droid.+; (a(?:015|06[35]|142p?))/i],[E,[A,"Nothing"],[I,z]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[A,E,[I,z]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[A,E,[I,ee]],[/(surface duo)/i],[E,[A,Jn],[I,ee]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[E,[A,"Fairphone"],[I,z]],[/(u304aa)/i],[E,[A,"AT&T"],[I,z]],[/\bsie-(\w*)/i],[E,[A,"Siemens"],[I,z]],[/\b(rct\w+) b/i],[E,[A,"RCA"],[I,ee]],[/\b(venue[\d ]{2,7}) b/i],[E,[A,"Dell"],[I,ee]],[/\b(q(?:mv|ta)\w+) b/i],[E,[A,"Verizon"],[I,ee]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[E,[A,"Barnes & Noble"],[I,ee]],[/\b(tm\d{3}\w+) b/i],[E,[A,"NuVision"],[I,ee]],[/\b(k88) b/i],[E,[A,"ZTE"],[I,ee]],[/\b(nx\d{3}j) b/i],[E,[A,"ZTE"],[I,z]],[/\b(gen\d{3}) b.+49h/i],[E,[A,"Swiss"],[I,z]],[/\b(zur\d{3}) b/i],[E,[A,"Swiss"],[I,ee]],[/\b((zeki)?tb.*\b) b/i],[E,[A,"Zeki"],[I,ee]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[A,"Dragon Touch"],E,[I,ee]],[/\b(ns-?\w{0,9}) b/i],[E,[A,"Insignia"],[I,ee]],[/\b((nxa|next)-?\w{0,9}) b/i],[E,[A,"NextBook"],[I,ee]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[A,"Voice"],E,[I,z]],[/\b(lvtel\-)?(v1[12]) b/i],[[A,"LvTel"],E,[I,z]],[/\b(ph-1) /i],[E,[A,"Essential"],[I,z]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[E,[A,"Envizen"],[I,ee]],[/\b(trio[-\w\. ]+) b/i],[E,[A,"MachSpeed"],[I,ee]],[/\btu_(1491) b/i],[E,[A,"Rotor"],[I,ee]],[/(shield[\w ]+) b/i],[E,[A,"Nvidia"],[I,ee]],[/(sprint) (\w+)/i],[A,E,[I,z]],[/(kin\.[onetw]{3})/i],[[E,/\./g," "],[A,Jn],[I,z]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[E,[A,ce],[I,ee]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[E,[A,ce],[I,z]],[/smart-tv.+(samsung)/i],[A,[I,Z]],[/hbbtv.+maple;(\d+)/i],[[E,/^/,"SmartTV"],[A,ot],[I,Z]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[A,rr],[I,Z]],[/(apple) ?tv/i],[A,[E,ue+" TV"],[I,Z]],[/crkey/i],[[E,Ze+"cast"],[A,Sn],[I,Z]],[/droid.+aft(\w+)( bui|\))/i],[E,[A,_e],[I,Z]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[E,[A,bt],[I,Z]],[/(bravia[\w ]+)( bui|\))/i],[E,[A,He],[I,Z]],[/(mitv-\w{5}) bui/i],[E,[A,V],[I,Z]],[/Hbbtv.*(technisat) (.*);/i],[A,E,[I,Z]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[A,BT],[E,BT],[I,Z]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[I,Z]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[A,E,[I,F]],[/droid.+; (shield) bui/i],[E,[A,"Nvidia"],[I,F]],[/(playstation [345portablevi]+)/i],[E,[A,He],[I,F]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[E,[A,Jn],[I,F]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[E,[A,ot],[I,ae]],[/((pebble))app/i],[A,E,[I,ae]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[E,[A,ue],[I,ae]],[/droid.+; (glass) \d/i],[E,[A,Sn],[I,ae]],[/droid.+; (wt63?0{2,3})\)/i],[E,[A,ce],[I,ae]],[/droid.+; (glass) \d/i],[E,[A,Sn],[I,ae]],[/(pico) (4|neo3(?: link|pro)?)/i],[A,E,[I,ae]],[/; (quest( \d| pro)?)/i],[E,[A,ge],[I,ae]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[A,[I,ye]],[/(aeobc)\b/i],[E,[A,_e],[I,ye]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[E,[I,z]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[E,[I,ee]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[I,ee]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[I,z]],[/(android[-\w\. ]{0,9});.+buil/i],[E,[A,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[N,[w,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[w,N],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[N,[w,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[w,N],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[N,w]],os:[[/microsoft (windows) (vista|xp)/i],[w,N],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[w,[N,w0,xP]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[N,w0,xP],[w,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[N,/_/g,"."],[w,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[w,un],[N,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[N,w],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[w,N],[/\(bb(10);/i],[N,[w,Ue]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[N,[w,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[N,[w,_n+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[N,[w,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[N,[w,"watchOS"]],[/crkey\/([\d\.]+)/i],[N,[w,Ze+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[w,tt],N],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[w,N],[/(sunos) ?([\w\.\d]*)/i],[[w,"Solaris"],N],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[w,N]]},au=function(Di,Wi){if(typeof Di===h&&(Wi=Di,Di=a),!(this instanceof au))return new au(Di,Wi).getResult();var xr=typeof s!==d&&s.navigator?s.navigator:a,oc=Di||(xr&&xr.userAgent?xr.userAgent:""),rh=xr&&xr.userAgentData?xr.userAgentData:a,vi=Wi?(function(Un,ih){var Sy={};for(var pp in Un)ih[pp]&&ih[pp].length%2==0?Sy[pp]=ih[pp].concat(Un[pp]):Sy[pp]=Un[pp];return Sy})(DP,Wi):DP,Cf=xr&&xr.userAgent==oc;return this.getBrowser=function(){var Un={};return Un[w]=a,Un[N]=a,vy.call(Un,oc,vi.browser),Un[g]=(function(ih){return typeof ih===m?ih.replace(/[^\d\.]/g,"").split(".")[0]:a})(Un[N]),Cf&&xr&&xr.brave&&typeof xr.brave.isBrave==c&&(Un[w]="Brave"),Un},this.getCPU=function(){var Un={};return Un[G]=a,vy.call(Un,oc,vi.cpu),Un},this.getDevice=function(){var Un={};return Un[A]=a,Un[E]=a,Un[I]=a,vy.call(Un,oc,vi.device),Cf&&!Un[I]&&rh&&rh.mobile&&(Un[I]=z),Cf&&Un[E]=="Macintosh"&&xr&&typeof xr.standalone!==d&&xr.maxTouchPoints&&xr.maxTouchPoints>2&&(Un[E]="iPad",Un[I]=ee),Un},this.getEngine=function(){var Un={};return Un[w]=a,Un[N]=a,vy.call(Un,oc,vi.engine),Un},this.getOS=function(){var Un={};return Un[w]=a,Un[N]=a,vy.call(Un,oc,vi.os),Cf&&!Un[w]&&rh&&rh.platform&&rh.platform!="Unknown"&&(Un[w]=rh.platform.replace(/chrome os/i,tt).replace(/macos/i,un)),Un},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return oc},this.setUA=function(Un){return oc=typeof Un===m&&Un.length>500?BT(Un,500):Un,this},this.setUA(oc),this};au.VERSION="0.7.40",au.BROWSER=zi([w,N,g]),au.CPU=zi([G]),au.DEVICE=zi([E,A,I,F,z,Z,ee,ae,ye]),au.ENGINE=au.OS=zi([w,N]),t.exports&&(r=t.exports=au),r.UAParser=au;var Tf=typeof s!==d&&(s.jQuery||s.Zepto);if(Tf&&!Tf.ua){var LP=new au;Tf.ua=LP.getResult(),Tf.ua.get=function(){return LP.getUA()},Tf.ua.set=function(Di){LP.setUA(Di);var Wi=LP.getResult();for(var xr in Wi)Tf.ua[xr]=Wi[xr]}}})(typeof window=="object"?window:o)})(ND,ND.exports);var Fde=l(ND.exports),dB=Dm.clear;Hn({global:!0,bind:!0,forced:D.clearImmediate!==dB},{clearImmediate:dB});var hB=D,Bde=ne,zde=de,Wde=s_,Gde=cn,Hde=Es,$de=Zc,Kde=hB.Function,qde=/MSIE .\./.test(Gde)||Wde==="BUN"&&(function(){var t=hB.Bun.version.split(".");return t.length<3||t[0]==="0"&&(t[1]<3||t[1]==="3"&&t[2]==="0")})(),Yde=Hn,pB=D,fB=Dm.set,Xde=function(t,r){var s=1;return qde?function(a,c){var d=$de(arguments.length,1)>s,h=zde(a)?a:Kde(a),m=d?Hde(arguments,s):[],g=d?function(){Bde(h,this,m)}:h;return t(g)}:t},mB=pB.setImmediate?Xde(fB):fB;Yde({global:!0,bind:!0,forced:pB.setImmediate!==mB},{setImmediate:mB});var gB=l(St.setImmediate),Jde=D,Qde=Iw,Zde=Kt,ehe=Zc,the=Se;Hn({global:!0,dontCallGetSet:!0,forced:u((function(){return the&&Object.getOwnPropertyDescriptor(Jde,"queueMicrotask").value.length!==1}))},{queueMicrotask:function(t){ehe(arguments.length,1),Qde(Zde(t))}});var _B=l(St.queueMicrotask);function yB(t,r){return function(){return t.apply(r,arguments)}}const{toString:nhe}=Object.prototype,{getPrototypeOf:xD}=Object,{iterator:DA,toStringTag:EB}=Symbol,LA=(DD=Object.create(null),t=>{const r=nhe.call(t);return DD[r]||(DD[r]=r.slice(8,-1).toLowerCase())});var DD;const zd=t=>(t=t.toLowerCase(),r=>LA(r)===t),MA=t=>r=>typeof r===t,{isArray:kv}=Array,Vw=MA("undefined"),vB=zd("ArrayBuffer"),rhe=MA("string"),nl=MA("function"),SB=MA("number"),UA=t=>t!==null&&typeof t=="object",VA=t=>{if(LA(t)!=="object")return!1;const r=xD(t);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||EB in t||DA in t)},ihe=zd("Date"),she=zd("File"),ohe=zd("Blob"),ahe=zd("FileList"),che=zd("URLSearchParams"),[lhe,uhe,dhe,hhe]=["ReadableStream","Request","Response","Headers"].map(zd);function jw(t,r){let s,a,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),kv(t))for(s=0,a=t.length;s<a;s++)r.call(null,t[s],s,t);else{const d=c?Object.getOwnPropertyNames(t):Object.keys(t),h=d.length;let m;for(s=0;s<h;s++)m=d[s],r.call(null,t[m],m,t)}}function bB(t,r){r=r.toLowerCase();const s=Object.keys(t);let a,c=s.length;for(;c-- >0;)if(a=s[c],r===a.toLowerCase())return a;return null}const K_=uB!==void 0?uB:typeof self<"u"?self:typeof window<"u"?window:Py,wB=t=>!Vw(t)&&t!==K_,phe=(LD=typeof Uint8Array<"u"&&xD(Uint8Array),t=>LD&&t instanceof LD);var LD;const fhe=zd("HTMLFormElement"),TB=(t=>{let{hasOwnProperty:r}=t;return(s,a)=>r.call(s,a)})(Object.prototype),mhe=zd("RegExp"),CB=(t,r)=>{const s=Object.getOwnPropertyDescriptors(t),a={};jw(s,((c,d)=>{let h;(h=r(c,d,t))!==!1&&(a[d]=h||c)})),Object.defineProperties(t,a)},ghe=zd("AsyncFunction"),RB=(IB=typeof gB=="function",AB=nl(K_.postMessage),IB?gB:AB?(MD="axios@".concat(Math.random()),jA=[],K_.addEventListener("message",(t=>{let{source:r,data:s}=t;r===K_&&s===MD&&jA.length&&jA.shift()()}),!1),t=>{jA.push(t),K_.postMessage(MD,"*")}):t=>setTimeout(t));var IB,AB,MD,jA;const _he=_B!==void 0?_B.bind(K_):typeof process<"u"&&process.nextTick||RB;var pt={isArray:kv,isArrayBuffer:vB,isBuffer:function(t){return t!==null&&!Vw(t)&&t.constructor!==null&&!Vw(t.constructor)&&nl(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let r;return t&&(typeof FormData=="function"&&t instanceof FormData||nl(t.append)&&((r=LA(t))==="formdata"||r==="object"&&nl(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&vB(t.buffer),r},isString:rhe,isNumber:SB,isBoolean:t=>t===!0||t===!1,isObject:UA,isPlainObject:VA,isReadableStream:lhe,isRequest:uhe,isResponse:dhe,isHeaders:hhe,isUndefined:Vw,isDate:ihe,isFile:she,isBlob:ohe,isRegExp:mhe,isFunction:nl,isStream:t=>UA(t)&&nl(t.pipe),isURLSearchParams:che,isTypedArray:phe,isFileList:ahe,forEach:jw,merge:function t(){const{caseless:r}=wB(this)&&this||{},s={},a=(c,d)=>{const h=r&&bB(s,d)||d;VA(s[h])&&VA(c)?s[h]=t(s[h],c):VA(c)?s[h]=t({},c):kv(c)?s[h]=c.slice():s[h]=c};for(let c=0,d=arguments.length;c<d;c++)arguments[c]&&jw(arguments[c],a);return s},extend:function(t,r,s){let{allOwnKeys:a}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return jw(r,((c,d)=>{s&&nl(c)?t[d]=yB(c,s):t[d]=c}),{allOwnKeys:a}),t},trim:t=>jo(t)?jo(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,r,s,a)=>{t.prototype=Object.create(r.prototype,a),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:r.prototype}),s&&Object.assign(t.prototype,s)},toFlatObject:(t,r,s,a)=>{let c,d,h;const m={};if(r=r||{},t==null)return r;do{for(c=Object.getOwnPropertyNames(t),d=c.length;d-- >0;)h=c[d],a&&!a(h,t,r)||m[h]||(r[h]=t[h],m[h]=!0);t=s!==!1&&xD(t)}while(t&&(!s||s(t,r))&&t!==Object.prototype);return r},kindOf:LA,kindOfTest:zd,endsWith:(t,r,s)=>{t=String(t),(s===void 0||s>t.length)&&(s=t.length),s-=r.length;const a=t.indexOf(r,s);return a!==-1&&a===s},toArray:t=>{if(!t)return null;if(kv(t))return t;let r=t.length;if(!SB(r))return null;const s=new Array(r);for(;r-- >0;)s[r]=t[r];return s},forEachEntry:(t,r)=>{const s=(t&&t[DA]).call(t);let a;for(;(a=s.next())&&!a.done;){const c=a.value;r.call(t,c[0],c[1])}},matchAll:(t,r)=>{let s;const a=[];for(;(s=t.exec(r))!==null;)a.push(s);return a},isHTMLForm:fhe,hasOwnProperty:TB,hasOwnProp:TB,reduceDescriptors:CB,freezeMethods:t=>{CB(t,((r,s)=>{if(nl(t)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const a=t[s];nl(a)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))}))},toObjectSet:(t,r)=>{const s={},a=c=>{c.forEach((d=>{s[d]=!0}))};return kv(t)?a(t):a(String(t).split(r)),s},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(r,s,a){return s.toUpperCase()+a})),noop:()=>{},toFiniteNumber:(t,r)=>t!=null&&Number.isFinite(t=+t)?t:r,findKey:bB,global:K_,isContextDefined:wB,isSpecCompliantForm:function(t){return!!(t&&nl(t.append)&&t[EB]==="FormData"&&t[DA])},toJSONObject:t=>{const r=new Array(10),s=(a,c)=>{if(UA(a)){if(r.indexOf(a)>=0)return;if(!("toJSON"in a)){r[c]=a;const d=kv(a)?[]:{};return jw(a,((h,m)=>{const g=s(h,c+1);!Vw(g)&&(d[m]=g)})),r[c]=void 0,d}}return a};return s(t,0)},isAsyncFn:ghe,isThenable:t=>t&&(UA(t)||nl(t))&&nl(t.then)&&nl(t.catch),setImmediate:RB,asap:_he,isIterable:t=>t!=null&&nl(t[DA])};function Er(t,r,s,a,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",r&&(this.code=r),s&&(this.config=s),a&&(this.request=a),c&&(this.response=c,this.status=c.status?c.status:null)}pt.inherits(Er,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:pt.toJSONObject(this.config),code:this.code,status:this.status}}});const PB=Er.prototype,OB={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((t=>{OB[t]={value:t}})),Object.defineProperties(Er,OB),Object.defineProperty(PB,"isAxiosError",{value:!0}),Er.from=(t,r,s,a,c,d)=>{const h=Object.create(PB);return pt.toFlatObject(t,h,(function(m){return m!==Error.prototype}),(m=>m!=="isAxiosError")),Er.call(h,t.message,r,s,a,c),h.cause=t,h.name=t.name,d&&Object.assign(h,d),h};function UD(t){return pt.isPlainObject(t)||pt.isArray(t)}function kB(t){return pt.endsWith(t,"[]")?t.slice(0,-2):t}function NB(t,r,s){return t?t.concat(r).map((function(a,c){return a=kB(a),!s&&c?"["+a+"]":a})).join(s?".":""):r}const yhe=pt.toFlatObject(pt,{},null,(function(t){return/^is[A-Z]/.test(t)}));function FA(t,r,s){if(!pt.isObject(t))throw new TypeError("target must be an object");r=r||new FormData;const a=(s=pt.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(A,N){return!pt.isUndefined(N[A])}))).metaTokens,c=s.visitor||E,d=s.dots,h=s.indexes,m=(s.Blob||typeof Blob<"u"&&Blob)&&pt.isSpecCompliantForm(r);if(!pt.isFunction(c))throw new TypeError("visitor must be a function");function g(A){if(A===null)return"";if(pt.isDate(A))return A.toISOString();if(!m&&pt.isBlob(A))throw new Er("Blob is not supported. Use a Buffer instead.");return pt.isArrayBuffer(A)||pt.isTypedArray(A)?m&&typeof Blob=="function"?new Blob([A]):Buffer.from(A):A}function E(A,N,G){let F=A;if(A&&!G&&typeof A=="object"){if(pt.endsWith(N,"{}"))N=a?N:N.slice(0,-2),A=JSON.stringify(A);else if(pt.isArray(A)&&(function(z){return pt.isArray(z)&&!z.some(UD)})(A)||(pt.isFileList(A)||pt.endsWith(N,"[]"))&&(F=pt.toArray(A)))return N=kB(N),F.forEach((function(z,ee){!pt.isUndefined(z)&&z!==null&&r.append(h===!0?NB([N],ee,d):h===null?N:N+"[]",g(z))})),!1}return!!UD(A)||(r.append(NB(G,N,d),g(A)),!1)}const w=[],I=Object.assign(yhe,{defaultVisitor:E,convertValue:g,isVisitable:UD});if(!pt.isObject(t))throw new TypeError("data must be an object");return(function A(N,G){if(!pt.isUndefined(N)){if(w.indexOf(N)!==-1)throw Error("Circular reference detected in "+G.join("."));w.push(N),pt.forEach(N,(function(F,z){(!(pt.isUndefined(F)||F===null)&&c.call(r,F,pt.isString(z)?jo(z).call(z):z,G,I))===!0&&A(F,G?G.concat(z):[z])})),w.pop()}})(t),r}function xB(t){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,(function(s){return r[s]}))}function VD(t,r){this._pairs=[],t&&FA(t,this,r)}const DB=VD.prototype;function Ehe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function LB(t,r,s){if(!r)return t;const a=s&&s.encode||Ehe;pt.isFunction(s)&&(s={serialize:s});const c=s&&s.serialize;let d;if(d=c?c(r,s):pt.isURLSearchParams(r)?r.toString():new VD(r,s).toString(a),d){const h=t.indexOf("#");h!==-1&&(t=t.slice(0,h)),t+=(t.indexOf("?")===-1?"?":"&")+d}return t}DB.append=function(t,r){this._pairs.push([t,r])},DB.toString=function(t){const r=t?function(s){return t.call(this,s,xB)}:xB;return this._pairs.map((function(s){return r(s[0])+"="+r(s[1])}),"").join("&")};var MB=class{constructor(){this.handlers=[]}use(t,r,s){return this.handlers.push({fulfilled:t,rejected:r,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){pt.forEach(this.handlers,(function(r){r!==null&&t(r)}))}},UB={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},VB={exports:{}},vhe=Hn,She=Se,jB=Yt.f;vhe({target:"Object",stat:!0,forced:Object.defineProperty!==jB,sham:!She},{defineProperty:jB});var FB=St.Object,bhe=VB.exports=function(t,r,s){return FB.defineProperty(t,r,s)};FB.defineProperty.sham&&(bhe.sham=!0);var BB=l(VB.exports),whe=TypeError,zB=Cd,The=Us,Che=on,Rhe=Cr("species"),WB=Array,Ihe=function(t){var r;return zB(t)&&(r=t.constructor,(The(r)&&(r===WB||zB(r.prototype))||Che(r)&&(r=r[Rhe])===null)&&(r=void 0)),r===void 0?WB:r},GB=function(t,r){return new(Ihe(t))(r===0?0:r)},Ahe=u,Phe=ti,Ohe=Cr("species"),HB=function(t){return Phe>=51||!Ahe((function(){var r=[];return(r.constructor={})[Ohe]=function(){return{foo:1}},r[t](Boolean).foo!==1}))},khe=Hn,Nhe=u,xhe=Cd,Dhe=on,Lhe=Xs,Mhe=fr,$B=function(t){if(t>9007199254740991)throw whe("Maximum allowed index exceeded");return t},KB=eD,Uhe=GB,Vhe=HB,jhe=ti,qB=Cr("isConcatSpreadable"),Fhe=jhe>=51||!Nhe((function(){var t=[];return t[qB]=!1,t.concat()[0]!==t})),Bhe=function(t){if(!Dhe(t))return!1;var r=t[qB];return r!==void 0?!!r:xhe(t)};khe({target:"Array",proto:!0,forced:!Fhe||!Vhe("concat")},{concat:function(t){var r,s,a,c,d,h=Lhe(this),m=Uhe(h,0),g=0;for(r=-1,a=arguments.length;r<a;r++)if(Bhe(d=r===-1?h:arguments[r]))for(c=Mhe(d),$B(g+c),s=0;s<c;s++,g++)s in d&&KB(m,g,d[s]);else $B(g+1),KB(m,g++,d);return m.length=g,m}});var YB={},zhe=q,Whe=an,XB=Id.f,Ghe=Es,JB=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];YB.f=function(t){return JB&&zhe(t)==="Window"?(function(r){try{return XB(r)}catch{return Ghe(JB)}})(t):XB(Whe(t))};var Nv={},Hhe=Cr;Nv.f=Hhe;var QB=St,$he=Mr,Khe=Nv,qhe=Yt.f,vs=function(t){var r=QB.Symbol||(QB.Symbol={});$he(r,t)||qhe(r,t,{value:Khe.f(t)})},Yhe=we,Xhe=Et,Jhe=Cr,Qhe=Md,ZB=function(){var t=Xhe("Symbol"),r=t&&t.prototype,s=r&&r.valueOf,a=Jhe("toPrimitive");r&&!r[a]&&Qhe(r,a,(function(c){return Yhe(s,this)}),{})},Zhe=ct,epe=at,tpe=Xs,npe=fr,rpe=GB,e8=R([].push),ipe=function(t){var r=t===1,s=t===2,a=t===3,c=t===4,d=t===6,h=t===7,m=t===5||d;return function(g,E,w,I){for(var A,N,G=tpe(g),F=epe(G),z=npe(F),ee=Zhe(E,w),Z=0,ae=I||rpe,ye=r?ae(g,z):s||h?ae(g,0):void 0;z>Z;Z++)if((m||Z in F)&&(N=ee(A=F[Z],Z,G),t))if(r)ye[Z]=N;else if(N)switch(t){case 3:return!0;case 5:return A;case 6:return Z;case 2:e8(ye,A)}else switch(t){case 4:return!1;case 7:e8(ye,A)}return d?-1:a||c?c:ye}},t8={forEach:ipe(0)},BA=Hn,Fw=D,jD=we,spe=R,xv=Se,Dv=Wr,ope=u,la=Mr,ape=O,FD=nr,zA=an,BD=yr,cpe=qa,zD=nt,Lv=m_,n8=Aa,lpe=Id,r8=YB,upe=vm,i8=he,s8=Yt,dpe=Mh,o8=Re,a8=Md,hpe=jh,WD=va,c8=Wl,l8=qt,ppe=Cr,fpe=Nv,mpe=vs,gpe=ZB,_pe=Ou,u8=Vh,WA=t8.forEach,rl=ym("hidden"),GA="Symbol",Bw="prototype",ype=u8.set,d8=u8.getterFor(GA),Wd=Object[Bw],q_=Fw.Symbol,HA=q_&&q_[Bw],Epe=Fw.RangeError,vpe=Fw.TypeError,GD=Fw.QObject,h8=i8.f,Y_=s8.f,p8=r8.f,Spe=o8.f,f8=spe([].push),hf=WD("symbols"),zw=WD("op-symbols"),bpe=WD("wks"),HD=!GD||!GD[Bw]||!GD[Bw].findChild,m8=function(t,r,s){var a=h8(Wd,r);a&&delete Wd[r],Y_(t,r,s),a&&t!==Wd&&Y_(Wd,r,a)},$D=xv&&ope((function(){return Lv(Y_({},"a",{get:function(){return Y_(this,"a",{value:7}).a}})).a!==7}))?m8:Y_,KD=function(t,r){var s=hf[t]=Lv(HA);return ype(s,{type:GA,tag:t,description:r}),xv||(s.description=r),s},$A=function(t,r,s){t===Wd&&$A(zw,r,s),FD(t);var a=BD(r);return FD(s),la(hf,a)?(s.enumerable?(la(t,rl)&&t[rl][a]&&(t[rl][a]=!1),s=Lv(s,{enumerable:zD(0,!1)})):(la(t,rl)||Y_(t,rl,zD(1,Lv(null))),t[rl][a]=!0),$D(t,a,s)):Y_(t,a,s)},qD=function(t,r){FD(t);var s=zA(r),a=n8(s).concat(E8(s));return WA(a,(function(c){xv&&!jD(g8,s,c)||$A(t,c,s[c])})),t},g8=function(t){var r=BD(t),s=jD(Spe,this,r);return!(this===Wd&&la(hf,r)&&!la(zw,r))&&(!(s||!la(this,r)||!la(hf,r)||la(this,rl)&&this[rl][r])||s)},_8=function(t,r){var s=zA(t),a=BD(r);if(s!==Wd||!la(hf,a)||la(zw,a)){var c=h8(s,a);return!c||!la(hf,a)||la(s,rl)&&s[rl][a]||(c.enumerable=!0),c}},y8=function(t){var r=p8(zA(t)),s=[];return WA(r,(function(a){la(hf,a)||la(c8,a)||f8(s,a)})),s},E8=function(t){var r=t===Wd,s=p8(r?zw:zA(t)),a=[];return WA(s,(function(c){!la(hf,c)||r&&!la(Wd,c)||f8(a,hf[c])})),a};Dv||(q_=function(){if(ape(HA,this))throw new vpe("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?cpe(arguments[0]):void 0,r=l8(t),s=function(a){var c=this===void 0?Fw:this;c===Wd&&jD(s,zw,a),la(c,rl)&&la(c[rl],r)&&(c[rl][r]=!1);var d=zD(1,a);try{$D(c,r,d)}catch(h){if(!(h instanceof Epe))throw h;m8(c,r,d)}};return xv&&HD&&$D(Wd,r,{configurable:!0,set:s}),KD(r,t)},a8(HA=q_[Bw],"toString",(function(){return d8(this).tag})),a8(q_,"withoutSetter",(function(t){return KD(l8(t),t)})),o8.f=g8,s8.f=$A,dpe.f=qD,i8.f=_8,lpe.f=r8.f=y8,upe.f=E8,fpe.f=function(t){return KD(ppe(t),t)},xv&&hpe(HA,"description",{configurable:!0,get:function(){return d8(this).description}})),BA({global:!0,wrap:!0,forced:!Dv,sham:!Dv},{Symbol:q_}),WA(n8(bpe),(function(t){mpe(t)})),BA({target:GA,stat:!0,forced:!Dv},{useSetter:function(){HD=!0},useSimple:function(){HD=!1}}),BA({target:"Object",stat:!0,forced:!Dv,sham:!xv},{create:function(t,r){return r===void 0?Lv(t):qD(Lv(t),r)},defineProperty:$A,defineProperties:qD,getOwnPropertyDescriptor:_8}),BA({target:"Object",stat:!0,forced:!Dv},{getOwnPropertyNames:y8}),gpe(),_pe(q_,GA),c8[rl]=!0;var v8=Wr&&!!Symbol.for&&!!Symbol.keyFor,wpe=Hn,Tpe=Et,Cpe=Mr,Rpe=qa,S8=va,Ipe=v8,YD=S8("string-to-symbol-registry"),Ape=S8("symbol-to-string-registry");wpe({target:"Symbol",stat:!0,forced:!Ipe},{for:function(t){var r=Rpe(t);if(Cpe(YD,r))return YD[r];var s=Tpe("Symbol")(r);return YD[r]=s,Ape[s]=r,s}});var Ppe=Hn,Ope=Mr,kpe=Zi,Npe=Eo,xpe=v8,b8=va("symbol-to-string-registry");Ppe({target:"Symbol",stat:!0,forced:!xpe},{keyFor:function(t){if(!kpe(t))throw new TypeError(Npe(t)+" is not a symbol");if(Ope(b8,t))return b8[t]}});var w8=Cd,Dpe=de,T8=q,Lpe=qa,C8=R([].push),Mpe=Hn,R8=Et,I8=ne,Upe=we,Ww=R,A8=u,P8=de,O8=Zi,k8=Es,Vpe=function(t){if(Dpe(t))return t;if(w8(t)){for(var r=t.length,s=[],a=0;a<r;a++){var c=t[a];typeof c=="string"?C8(s,c):typeof c!="number"&&T8(c)!=="Number"&&T8(c)!=="String"||C8(s,Lpe(c))}var d=s.length,h=!0;return function(m,g){if(h)return h=!1,g;if(w8(this))return g;for(var E=0;E<d;E++)if(s[E]===m)return g}}},jpe=Wr,Fpe=String,Gm=R8("JSON","stringify"),KA=Ww(/./.exec),N8=Ww("".charAt),Bpe=Ww("".charCodeAt),zpe=Ww("".replace),Wpe=Ww(1 .toString),Gpe=/[\uD800-\uDFFF]/g,x8=/^[\uD800-\uDBFF]$/,D8=/^[\uDC00-\uDFFF]$/,L8=!jpe||A8((function(){var t=R8("Symbol")("stringify detection");return Gm([t])!=="[null]"||Gm({a:t})!=="{}"||Gm(Object(t))!=="{}"})),M8=A8((function(){return Gm("\uDF06\uD834")!=='"\\udf06\\ud834"'||Gm("\uDEAD")!=='"\\udead"'})),Hpe=function(t,r){var s=k8(arguments),a=Vpe(r);if(P8(a)||t!==void 0&&!O8(t))return s[1]=function(c,d){if(P8(a)&&(d=Upe(a,this,Fpe(c),d)),!O8(d))return d},I8(Gm,null,s)},$pe=function(t,r,s){var a=N8(s,r-1),c=N8(s,r+1);return KA(x8,t)&&!KA(D8,c)||KA(D8,t)&&!KA(x8,a)?"\\u"+Wpe(Bpe(t,0),16):t};Gm&&Mpe({target:"JSON",stat:!0,forced:L8||M8},{stringify:function(t,r,s){var a=k8(arguments),c=I8(L8?Hpe:Gm,null,a);return M8&&typeof c=="string"?zpe(c,Gpe,$pe):c}});var U8=vm,Kpe=Xs;Hn({target:"Object",stat:!0,forced:!Wr||u((function(){U8.f(1)}))},{getOwnPropertySymbols:function(t){var r=U8.f;return r?r(Kpe(t)):[]}}),vs("asyncIterator"),vs("hasInstance"),vs("isConcatSpreadable"),vs("iterator"),vs("match"),vs("matchAll"),vs("replace"),vs("search"),vs("species"),vs("split");var qpe=ZB;vs("toPrimitive"),qpe();var Ype=Et,Xpe=Ou;vs("toStringTag"),Xpe(Ype("Symbol"),"Symbol"),vs("unscopables"),Ou(D.JSON,"JSON",!0);var Jpe=St.Symbol,Qpe=Cr,Zpe=Yt.f,V8=Qpe("metadata"),j8=Function.prototype;j8[V8]===void 0&&Zpe(j8,V8,{value:null}),vs("asyncDispose"),vs("dispose"),vs("metadata");var efe=Jpe,tfe=R,XD=Et("Symbol"),nfe=XD.keyFor,rfe=tfe(XD.prototype.valueOf),F8=XD.isRegisteredSymbol||function(t){try{return nfe(rfe(t))!==void 0}catch{return!1}};Hn({target:"Symbol",stat:!0},{isRegisteredSymbol:F8});for(var ife=va,B8=Et,sfe=R,ofe=Zi,afe=Cr,qA=B8("Symbol"),z8=qA.isWellKnownSymbol,W8=B8("Object","getOwnPropertyNames"),cfe=sfe(qA.prototype.valueOf),G8=ife("wks"),JD=0,H8=W8(qA),lfe=H8.length;JD<lfe;JD++)try{var $8=H8[JD];ofe(qA[$8])&&afe($8)}catch{}var K8=function(t){if(z8&&z8(t))return!0;try{for(var r=cfe(t),s=0,a=W8(G8),c=a.length;s<c;s++)if(G8[a[s]]==r)return!0}catch{}return!1};Hn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:K8}),vs("customMatcher"),vs("observable"),Hn({target:"Symbol",stat:!0},{isRegistered:F8}),Hn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:K8}),vs("matcher"),vs("metadataKey"),vs("patternMatch"),vs("replaceAll");var Mv=l(efe),q8=l(Nv.f("iterator"));function Gw(t){return Gw=typeof Mv=="function"&&typeof q8=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Mv=="function"&&r.constructor===Mv&&r!==Mv.prototype?"symbol":typeof r},Gw(t)}var ufe=l(Nv.f("toPrimitive"));function dfe(t){var r=(function(s,a){if(Gw(s)!="object"||!s)return s;var c=s[ufe];if(c!==void 0){var d=c.call(s,a);if(Gw(d)!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(s)})(t,"string");return Gw(r)=="symbol"?r:r+""}function X(t,r,s){return(r=dfe(r))in t?BB(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}var Y8=l(due),hfe={isBrowser:!0,classes:{URLSearchParams:Y8!==void 0?Y8:VD,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const QD=typeof window<"u"&&typeof document<"u",ZD=typeof navigator=="object"&&navigator||void 0,pfe=QD&&(!ZD||["ReactNative","NativeScript","NS"].indexOf(ZD.product)<0),ffe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",mfe=QD&&window.location.href||"http://localhost";function X8(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function J8(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?X8(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):X8(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}var ec=J8(J8({},Object.freeze({__proto__:null,hasBrowserEnv:QD,hasStandardBrowserEnv:pfe,hasStandardBrowserWebWorkerEnv:ffe,navigator:ZD,origin:mfe})),hfe),gfe=nr,_fe=we,yfe=Mr,Efe=O,vfe=function(){var t=gfe(this),r="";return t.hasIndices&&(r+="d"),t.global&&(r+="g"),t.ignoreCase&&(r+="i"),t.multiline&&(r+="m"),t.dotAll&&(r+="s"),t.unicode&&(r+="u"),t.unicodeSets&&(r+="v"),t.sticky&&(r+="y"),r},Q8=RegExp.prototype,Z8=function(t){var r=t.flags;return r!==void 0||"flags"in Q8||yfe(t,"flags")||!Efe(Q8,t)?r:_fe(vfe,t)},Sfe=Fx.charAt,ez=we,bfe=nr,wfe=de,Tfe=q,Cfe=/./.exec,Rfe=TypeError,Ife=Hn,tz=we,nz=ie,Afe=R_,YA=ov,rz=Xt,iz=oi,Hw=qa,Pfe=nr,Ofe=on,kfe=q,Nfe=ob,sz=Z8,xfe=Ga,Dfe=u,Lfe=af,Mfe=function(t,r,s){return r+(s?Sfe(t,r).length:1)},Ufe=function(t,r){var s=t.exec;if(wfe(s)){var a=ez(s,t,r);return a!==null&&bfe(a),a}if(Tfe(t)==="RegExp")return ez(Cfe,t,r);throw new Rfe("RegExp#exec called on incompatible receiver")},oz=Vh,Vfe=Cr("matchAll"),az="RegExp String",cz=az+" Iterator",jfe=oz.set,Ffe=oz.getterFor(cz),Bfe=TypeError,eL=nz("".indexOf),XA=nz("".matchAll),tL=!!XA&&!Dfe((function(){XA("a",/./)})),zfe=Afe((function(t,r,s,a){jfe(this,{type:cz,regexp:t,string:r,global:s,unicode:a,done:!1})}),az,(function(){var t=Ffe(this);if(t.done)return YA(void 0,!0);var r=t.regexp,s=t.string,a=Ufe(r,s);return a===null?(t.done=!0,YA(void 0,!0)):t.global?(Hw(a[0])===""&&(r.lastIndex=Mfe(s,iz(r.lastIndex),t.unicode)),YA(a,!1)):(t.done=!0,YA(a,!1))})),lz=function(t){var r,s,a,c=Pfe(this),d=Hw(t),h=Lfe(c,RegExp),m=Hw(sz(c));return r=new h(h===RegExp?c.source:c,m),s=!!~eL(m,"g"),a=!!~eL(m,"u"),r.lastIndex=iz(c.lastIndex),new zfe(r,d,s,a)};Ife({target:"String",proto:!0,forced:tL},{matchAll:function(t){var r,s,a,c,d=rz(this);if(Ofe(t)){if(Nfe(t)&&(r=Hw(rz(sz(t))),!~eL(r,"g")))throw new Bfe("`.matchAll` does not allow non-global regexes");if(tL)return XA(d,t);if((a=xfe(t,Vfe))===void 0&&kfe(t)==="RegExp"&&(a=lz),a)return tz(a,t,d)}else if(tL)return XA(d,t);return s=Hw(d),c=new RegExp(t,"g"),tz(lz,c,s)}});var Wfe=Sc("String","matchAll"),Gfe=O,Hfe=Wfe,nL=String.prototype,$fe=function(t){var r=t.matchAll;return typeof t=="string"||t===nL||Gfe(nL,t)&&r===nL.matchAll?Hfe:r},Kfe=l($fe);function uz(t){function r(s,a,c,d){let h=s[d++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),g=d>=s.length;return h=!h&&pt.isArray(c)?c.length:h,g?(pt.hasOwnProp(c,h)?c[h]=[c[h],a]:c[h]=a,!m):(c[h]&&pt.isObject(c[h])||(c[h]=[]),r(s,a,c[h],d)&&pt.isArray(c[h])&&(c[h]=(function(E){const w={},I=Object.keys(E);let A;const N=I.length;let G;for(A=0;A<N;A++)G=I[A],w[G]=E[G];return w})(c[h])),!m)}if(pt.isFormData(t)&&pt.isFunction(t.entries)){const s={};return pt.forEachEntry(t,((a,c)=>{r((function(d){return Kfe(pt).call(pt,/\w+|\[(\w*)]/g,d).map((h=>h[0]==="[]"?"":h[1]||h[0]))})(a),c,s,0)})),s}return null}const rL={transitional:UB,adapter:["xhr","http","fetch"],transformRequest:[function(t,r){const s=r.getContentType()||"",a=s.indexOf("application/json")>-1,c=pt.isObject(t);if(c&&pt.isHTMLForm(t)&&(t=new FormData(t)),pt.isFormData(t))return a?JSON.stringify(uz(t)):t;if(pt.isArrayBuffer(t)||pt.isBuffer(t)||pt.isStream(t)||pt.isFile(t)||pt.isBlob(t)||pt.isReadableStream(t))return t;if(pt.isArrayBufferView(t))return t.buffer;if(pt.isURLSearchParams(t))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let d;if(c){if(s.indexOf("application/x-www-form-urlencoded")>-1)return(function(h,m){return FA(h,new ec.classes.URLSearchParams,Object.assign({visitor:function(g,E,w,I){return ec.isNode&&pt.isBuffer(g)?(this.append(E,g.toString("base64")),!1):I.defaultVisitor.apply(this,arguments)}},m))})(t,this.formSerializer).toString();if((d=pt.isFileList(t))||s.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return FA(d?{"files[]":t}:t,h&&new h,this.formSerializer)}}return c||a?(r.setContentType("application/json",!1),(function(h,m,g){if(pt.isString(h))try{return(m||JSON.parse)(h),jo(pt).call(pt,h)}catch(E){if(E.name!=="SyntaxError")throw E}return(g||JSON.stringify)(h)})(t)):t}],transformResponse:[function(t){const r=this.transitional||rL.transitional,s=r&&r.forcedJSONParsing,a=this.responseType==="json";if(pt.isResponse(t)||pt.isReadableStream(t))return t;if(t&&pt.isString(t)&&(s&&!this.responseType||a)){const c=!(r&&r.silentJSONParsing)&&a;try{return JSON.parse(t)}catch(d){if(c)throw d.name==="SyntaxError"?Er.from(d,Er.ERR_BAD_RESPONSE,this,null,this.response):d}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ec.classes.FormData,Blob:ec.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};pt.forEach(["delete","get","head","post","put","patch"],(t=>{rL.headers[t]={}}));var iL=rL;const qfe=pt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),dz=Symbol("internals");function $w(t){var r;return t&&jo(r=String(t)).call(r).toLowerCase()}function JA(t){return t===!1||t==null?t:pt.isArray(t)?t.map(JA):String(t)}function sL(t,r,s,a,c){return pt.isFunction(a)?a.call(this,r,s):(c&&(r=s),pt.isString(r)?pt.isString(a)?r.indexOf(a)!==-1:pt.isRegExp(a)?a.test(r):void 0:void 0)}class QA{constructor(r){r&&this.set(r)}set(r,s,a){const c=this;function d(g,E,w){const I=$w(E);if(!I)throw new Error("header name must be a non-empty string");const A=pt.findKey(c,I);(!A||c[A]===void 0||w===!0||w===void 0&&c[A]!==!1)&&(c[A||E]=JA(g))}const h=(g,E)=>pt.forEach(g,((w,I)=>d(w,I,E)));if(pt.isPlainObject(r)||r instanceof this.constructor)h(r,s);else if(pt.isString(r)&&(r=jo(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(jo(m=r).call(m)))h((g=>{const E={};let w,I,A;return g&&g.split(`
`).forEach((function(N){var G,F;A=N.indexOf(":"),w=jo(G=N.substring(0,A)).call(G).toLowerCase(),I=jo(F=N.substring(A+1)).call(F),!w||E[w]&&qfe[w]||(w==="set-cookie"?E[w]?E[w].push(I):E[w]=[I]:E[w]=E[w]?E[w]+", "+I:I)})),E})(r),s);else if(pt.isObject(r)&&pt.isIterable(r)){let g,E,w={};for(const I of r){if(!pt.isArray(I))throw TypeError("Object iterator must return a key-value pair");w[E=I[0]]=(g=w[E])?pt.isArray(g)?[...g,I[1]]:[g,I[1]]:I[1]}h(w,s)}else r!=null&&d(s,r,a);var m;return this}get(r,s){if(r=$w(r)){const a=pt.findKey(this,r);if(a){const c=this[a];if(!s)return c;if(s===!0)return(function(d){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let g;for(;g=m.exec(d);)h[g[1]]=g[2];return h})(c);if(pt.isFunction(s))return s.call(this,c,a);if(pt.isRegExp(s))return s.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,s){if(r=$w(r)){const a=pt.findKey(this,r);return!(!a||this[a]===void 0||s&&!sL(0,this[a],a,s))}return!1}delete(r,s){const a=this;let c=!1;function d(h){if(h=$w(h)){const m=pt.findKey(a,h);!m||s&&!sL(0,a[m],m,s)||(delete a[m],c=!0)}}return pt.isArray(r)?r.forEach(d):d(r),c}clear(r){const s=Object.keys(this);let a=s.length,c=!1;for(;a--;){const d=s[a];r&&!sL(0,this[d],d,r,!0)||(delete this[d],c=!0)}return c}normalize(r){const s=this,a={};return pt.forEach(this,((c,d)=>{var h;const m=pt.findKey(a,d);if(m)return s[m]=JA(c),void delete s[d];const g=r?(function(E){return jo(E).call(E).toLowerCase().replace(/([a-z\d])(\w*)/g,((w,I,A)=>I.toUpperCase()+A))})(d):jo(h=String(d)).call(h);g!==d&&delete s[d],s[g]=JA(c),a[g]=!0})),this}concat(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return this.constructor.concat(this,...s)}toJSON(r){const s=Object.create(null);return pt.forEach(this,((a,c)=>{a!=null&&a!==!1&&(s[c]=r&&pt.isArray(a)?a.join(", "):a)})),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((r=>{let[s,a]=r;return s+": "+a})).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const s=new this(r);for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];return c.forEach((h=>s.set(h))),s}static accessor(r){const s=(this[dz]=this[dz]={accessors:{}}).accessors,a=this.prototype;function c(d){const h=$w(d);s[h]||((function(m,g){const E=pt.toCamelCase(" "+g);["get","set","has"].forEach((w=>{Object.defineProperty(m,w+E,{value:function(I,A,N){return this[w].call(this,g,I,A,N)},configurable:!0})}))})(a,d),s[h]=!0)}return pt.isArray(r)?r.forEach(c):c(r),this}}QA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),pt.reduceDescriptors(QA.prototype,((t,r)=>{let{value:s}=t,a=r[0].toUpperCase()+r.slice(1);return{get:()=>s,set(c){this[a]=c}}})),pt.freezeMethods(QA);var Gd=QA;function oL(t,r){const s=this||iL,a=r||s,c=Gd.from(a.headers);let d=a.data;return pt.forEach(t,(function(h){d=h.call(s,d,c.normalize(),r?r.status:void 0)})),c.normalize(),d}function hz(t){return!(!t||!t.__CANCEL__)}function Uv(t,r,s){Er.call(this,t??"canceled",Er.ERR_CANCELED,r,s),this.name="CanceledError"}function pz(t,r,s){const a=s.config.validateStatus;s.status&&a&&!a(s.status)?r(new Er("Request failed with status code "+s.status,[Er.ERR_BAD_REQUEST,Er.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):t(s)}pt.inherits(Uv,Er,{__CANCEL__:!0});const ZA=function(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,a=0;const c=(function(d,h){d=d||10;const m=new Array(d),g=new Array(d);let E,w=0,I=0;return h=h!==void 0?h:1e3,function(A){const N=Date.now(),G=g[I];E||(E=N),m[w]=A,g[w]=N;let F=I,z=0;for(;F!==w;)z+=m[F++],F%=d;if(w=(w+1)%d,w===I&&(I=(I+1)%d),N-E<h)return;const ee=G&&N-G;return ee?Math.round(1e3*z/ee):void 0}})(50,250);return(function(d,h){let m,g,E=0,w=1e3/h;const I=function(A){E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,g&&(clearTimeout(g),g=null),d.apply(null,A)};return[function(){const A=Date.now(),N=A-E;for(var G=arguments.length,F=new Array(G),z=0;z<G;z++)F[z]=arguments[z];N>=w?I(F,A):(m=F,g||(g=setTimeout((()=>{g=null,I(m)}),w-N)))},()=>m&&I(m)]})((d=>{const h=d.loaded,m=d.lengthComputable?d.total:void 0,g=h-a,E=c(g);a=h,t({loaded:h,total:m,progress:m?h/m:void 0,bytes:g,rate:E||void 0,estimated:E&&m&&h<=m?(m-h)/E:void 0,event:d,lengthComputable:m!=null,[r?"download":"upload"]:!0})}),s)},fz=(t,r)=>{const s=t!=null;return[a=>r[0]({lengthComputable:s,total:t,loaded:a}),r[1]]},mz=t=>function(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return pt.asap((()=>t(...s)))};var Yfe=ec.hasStandardBrowserEnv?((t,r)=>s=>(s=new IA(s,ec.origin),t.protocol===s.protocol&&t.host===s.host&&(r||t.port===s.port)))(new IA(ec.origin),ec.navigator&&/(msie|trident)/i.test(ec.navigator.userAgent)):()=>!0,Xfe=ec.hasStandardBrowserEnv?{write(t,r,s,a,c,d){const h=[t+"="+encodeURIComponent(r)];pt.isNumber(s)&&h.push("expires="+new Date(s).toGMTString()),pt.isString(a)&&h.push("path="+a),pt.isString(c)&&h.push("domain="+c),d===!0&&h.push("secure"),document.cookie=h.join("; ")},read(t){const r=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function gz(t,r,s){let a=!(function(c){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(c)})(r);return t&&(a||s==0)?(function(c,d){return d?c.replace(/\/?\/$/,"")+"/"+d.replace(/^\/+/,""):c})(t,r):r}function _z(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}const yz=t=>t instanceof Gd?(function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?_z(Object(a),!0).forEach((function(c){X(r,c,a[c])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):_z(Object(a)).forEach((function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(a,c))}))}return r})({},t):t;function X_(t,r){r=r||{};const s={};function a(E,w,I,A){return pt.isPlainObject(E)&&pt.isPlainObject(w)?pt.merge.call({caseless:A},E,w):pt.isPlainObject(w)?pt.merge({},w):pt.isArray(w)?w.slice():w}function c(E,w,I,A){return pt.isUndefined(w)?pt.isUndefined(E)?void 0:a(void 0,E,0,A):a(E,w,0,A)}function d(E,w){if(!pt.isUndefined(w))return a(void 0,w)}function h(E,w){return pt.isUndefined(w)?pt.isUndefined(E)?void 0:a(void 0,E):a(void 0,w)}function m(E,w,I){return I in r?a(E,w):I in t?a(void 0,E):void 0}const g={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(E,w,I)=>c(yz(E),yz(w),0,!0)};return pt.forEach(Object.keys(Object.assign({},t,r)),(function(E){const w=g[E]||c,I=w(t[E],r[E],E);pt.isUndefined(I)&&w!==m||(s[E]=I)})),s}var Ez=t=>{const r=X_({},t);let s,{data:a,withXSRFToken:c,xsrfHeaderName:d,xsrfCookieName:h,headers:m,auth:g}=r;if(r.headers=m=Gd.from(m),r.url=LB(gz(r.baseURL,r.url,r.allowAbsoluteUrls),t.params,t.paramsSerializer),g&&m.set("Authorization","Basic "+btoa((g.username||"")+":"+(g.password?unescape(encodeURIComponent(g.password)):""))),pt.isFormData(a)){if(ec.hasStandardBrowserEnv||ec.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((s=m.getContentType())!==!1){const[E,...w]=s?s.split(";").map((I=>jo(I).call(I))).filter(Boolean):[];m.setContentType([E||"multipart/form-data",...w].join("; "))}}if(ec.hasStandardBrowserEnv&&(c&&pt.isFunction(c)&&(c=c(r)),c||c!==!1&&Yfe(r.url))){const E=d&&h&&Xfe.read(h);E&&m.set(d,E)}return r},Jfe=typeof XMLHttpRequest<"u"&&function(t){return new mt((function(r,s){const a=Ez(t);let c=a.data;const d=Gd.from(a.headers).normalize();let h,m,g,E,w,{responseType:I,onUploadProgress:A,onDownloadProgress:N}=a;function G(){E&&E(),w&&w(),a.cancelToken&&a.cancelToken.unsubscribe(h),a.signal&&a.signal.removeEventListener("abort",h)}let F=new XMLHttpRequest;function z(){if(!F)return;const Z=Gd.from("getAllResponseHeaders"in F&&F.getAllResponseHeaders());pz((function(ae){r(ae),G()}),(function(ae){s(ae),G()}),{data:I&&I!=="text"&&I!=="json"?F.response:F.responseText,status:F.status,statusText:F.statusText,headers:Z,config:t,request:F}),F=null}F.open(a.method.toUpperCase(),a.url,!0),F.timeout=a.timeout,"onloadend"in F?F.onloadend=z:F.onreadystatechange=function(){F&&F.readyState===4&&(F.status!==0||F.responseURL&&F.responseURL.indexOf("file:")===0)&&setTimeout(z)},F.onabort=function(){F&&(s(new Er("Request aborted",Er.ECONNABORTED,t,F)),F=null)},F.onerror=function(){s(new Er("Network Error",Er.ERR_NETWORK,t,F)),F=null},F.ontimeout=function(){let Z=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const ae=a.transitional||UB;a.timeoutErrorMessage&&(Z=a.timeoutErrorMessage),s(new Er(Z,ae.clarifyTimeoutError?Er.ETIMEDOUT:Er.ECONNABORTED,t,F)),F=null},c===void 0&&d.setContentType(null),"setRequestHeader"in F&&pt.forEach(d.toJSON(),(function(Z,ae){F.setRequestHeader(ae,Z)})),pt.isUndefined(a.withCredentials)||(F.withCredentials=!!a.withCredentials),I&&I!=="json"&&(F.responseType=a.responseType),N&&([g,w]=ZA(N,!0),F.addEventListener("progress",g)),A&&F.upload&&([m,E]=ZA(A),F.upload.addEventListener("progress",m),F.upload.addEventListener("loadend",E)),(a.cancelToken||a.signal)&&(h=Z=>{F&&(s(!Z||Z.type?new Uv(null,t,F):Z),F.abort(),F=null)},a.cancelToken&&a.cancelToken.subscribe(h),a.signal&&(a.signal.aborted?h():a.signal.addEventListener("abort",h)));const ee=(function(Z){const ae=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Z);return ae&&ae[1]||""})(a.url);ee&&ec.protocols.indexOf(ee)===-1?s(new Er("Unsupported protocol "+ee+":",Er.ERR_BAD_REQUEST,t)):F.send(c||null)}))},Qfe=(t,r)=>{const{length:s}=t=t?t.filter(Boolean):[];if(r||s){let a,c=new AbortController;const d=function(E){if(!a){a=!0,m();const w=E instanceof Error?E:this.reason;c.abort(w instanceof Er?w:new Uv(w instanceof Error?w.message:w))}};let h=r&&setTimeout((()=>{h=null,d(new Er("timeout ".concat(r," of ms exceeded"),Er.ETIMEDOUT))}),r);const m=()=>{t&&(h&&clearTimeout(h),h=null,t.forEach((E=>{E.unsubscribe?E.unsubscribe(d):E.removeEventListener("abort",d)})),t=null)};t.forEach((E=>E.addEventListener("abort",d)));const{signal:g}=c;return g.unsubscribe=()=>pt.asap(m),g}},aL=l(o4),vz=Nv.f("asyncIterator"),Zfe=l(vz);function cL(t,r){this.v=t,this.k=r}function Xl(t){return function(){return new Kw(t.apply(this,arguments))}}function Kw(t){var r,s;function a(d,h){try{var m=t[d](h),g=m.value,E=g instanceof cL;aL.resolve(E?g.v:g).then((function(w){if(E){var I=d==="return"?"return":"next";if(!g.k||w.done)return a(I,w);w=t[I](w).value}c(m.done?"return":"normal",w)}),(function(w){a("throw",w)}))}catch(w){c("throw",w)}}function c(d,h){switch(d){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?a(r.key,r.arg):s=null}this._invoke=function(d,h){return new aL((function(m,g){var E={key:d,arg:h,resolve:m,reject:g,next:null};s?s=s.next=E:(r=s=E,a(d,h))}))},typeof t.return!="function"&&(this.return=void 0)}function Fn(t){return new cL(t,0)}function e1(t){var r={},s=!1;function a(c,d){return s=!0,d=new aL((function(h){h(t[c](d))})),{done:!1,value:new cL(d,1)}}return r[Mv!==void 0&&q8||"@@iterator"]=function(){return this},r.next=function(c){return s?(s=!1,c):a("next",c)},typeof t.throw=="function"&&(r.throw=function(c){if(s)throw s=!1,c;return a("throw",c)}),typeof t.return=="function"&&(r.return=function(c){return s?(s=!1,c):a("return",c)}),r}Kw.prototype[typeof Mv=="function"&&Zfe||"@@asyncIterator"]=function(){return this},Kw.prototype.next=function(t){return this._invoke("next",t)},Kw.prototype.throw=function(t){return this._invoke("throw",t)},Kw.prototype.return=function(t){return this._invoke("return",t)};var lL=l(vz);function uL(t){var r,s,a,c=2;for(typeof Symbol<"u"&&(s=lL,a=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(a&&(r=t[a])!=null)return new t1(r.call(t));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function t1(t){function r(s){if(Object(s)!==s)return mt.reject(new TypeError(s+" is not an object."));var a=s.done;return mt.resolve(s.value).then((function(c){return{value:c,done:a}}))}return t1=function(s){this.s=s,this.n=s.next},t1.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?mt.resolve({value:s,done:!0}):r(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?mt.reject(s):r(a.apply(this.s,arguments))}},new t1(t)}const eme=function*(t,r){let s=t.byteLength;if(!r||s<r)return void(yield t);let a,c=0;for(;c<s;)a=c+r,yield t.slice(c,a),c=a},tme=(function(){var t=Xl((function*(r,s){var a,c=!1,d=!1;try{for(var h,m=uL(nme(r));c=!(h=yield Fn(m.next())).done;c=!1){const g=h.value;yield*e1(uL(eme(g,s)))}}catch(g){d=!0,a=g}finally{try{c&&m.return!=null&&(yield Fn(m.return()))}finally{if(d)throw a}}}));return function(r,s){return t.apply(this,arguments)}})(),nme=(function(){var t=Xl((function*(r){if(r[lL])return void(yield*e1(uL(r)));const s=r.getReader();try{for(;;){const{done:a,value:c}=yield Fn(s.read());if(a)break;yield c}}finally{yield Fn(s.cancel())}}));return function(r){return t.apply(this,arguments)}})(),Sz=(t,r,s,a)=>{const c=tme(t,r);let d,h=0,m=g=>{d||(d=!0,a&&a(g))};return new ReadableStream({async pull(g){try{const{done:E,value:w}=await c.next();if(E)return m(),void g.close();let I=w.byteLength;if(s){let A=h+=I;s(A)}g.enqueue(new Uint8Array(w))}catch(E){throw m(E),E}},cancel:g=>(m(g),c.return())},{highWaterMark:2})};function bz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function wz(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?bz(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):bz(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}const n1=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Tz=n1&&typeof ReadableStream=="function",rme=n1&&(typeof TextEncoder=="function"?(Cz=new TextEncoder,t=>Cz.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var Cz;const Rz=function(t){try{for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];return!!t(...s)}catch{return!1}},ime=Tz&&Rz((()=>{let t=!1;const r=new Request(ec.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!r})),dL=Tz&&Rz((()=>pt.isReadableStream(new Response("").body))),r1={stream:dL&&(t=>t.body)};var Iz;n1&&(Iz=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((t=>{!r1[t]&&(r1[t]=pt.isFunction(Iz[t])?r=>r[t]():(r,s)=>{throw new Er("Response type '".concat(t,"' is not supported"),Er.ERR_NOT_SUPPORT,s)})})));const sme=async(t,r)=>{const s=pt.toFiniteNumber(t.getContentLength());return s??(async a=>a==null?0:pt.isBlob(a)?a.size:pt.isSpecCompliantForm(a)?(await new Request(ec.origin,{method:"POST",body:a}).arrayBuffer()).byteLength:pt.isArrayBufferView(a)||pt.isArrayBuffer(a)?a.byteLength:(pt.isURLSearchParams(a)&&(a+=""),pt.isString(a)?(await rme(a)).byteLength:void 0))(r)};var ome=n1&&(async t=>{let{url:r,method:s,data:a,signal:c,cancelToken:d,timeout:h,onDownloadProgress:m,onUploadProgress:g,responseType:E,headers:w,withCredentials:I="same-origin",fetchOptions:A}=Ez(t);E=E?(E+"").toLowerCase():"text";let N,G=Qfe([c,d&&d.toAbortSignal()],h);const F=G&&G.unsubscribe&&(()=>{G.unsubscribe()});let z;try{if(g&&ime&&s!=="get"&&s!=="head"&&(z=await sme(w,a))!==0){let _e,ue=new Request(r,{method:"POST",body:a,duplex:"half"});if(pt.isFormData(a)&&(_e=ue.headers.get("content-type"))&&w.setContentType(_e),ue.body){const[Ae,Ue]=fz(z,ZA(mz(g)));a=Sz(ue.body,65536,Ae,Ue)}}pt.isString(I)||(I=I?"include":"omit");const ee="credentials"in Request.prototype;N=new Request(r,wz(wz({},A),{},{signal:G,method:s.toUpperCase(),headers:w.normalize().toJSON(),body:a,duplex:"half",credentials:ee?I:void 0}));let Z=await fetch(N);const ae=dL&&(E==="stream"||E==="response");if(dL&&(m||ae&&F)){const _e={};["status","statusText","headers"].forEach((We=>{_e[We]=Z[We]}));const ue=pt.toFiniteNumber(Z.headers.get("content-length")),[Ae,Ue]=m&&fz(ue,ZA(mz(m),!0))||[];Z=new Response(Sz(Z.body,65536,Ae,(()=>{Ue&&Ue(),F&&F()})),_e)}E=E||"text";let ye=await r1[pt.findKey(r1,E)||"text"](Z,t);return!ae&&F&&F(),await new mt(((_e,ue)=>{pz(_e,ue,{data:ye,headers:Gd.from(Z.headers),status:Z.status,statusText:Z.statusText,config:t,request:N})}))}catch(ee){throw F&&F(),ee&&ee.name==="TypeError"&&/Load failed|fetch/i.test(ee.message)?Object.assign(new Er("Network Error",Er.ERR_NETWORK,t,N),{cause:ee.cause||ee}):Er.from(ee,ee&&ee.code,t,N)}});const hL={http:null,xhr:Jfe,fetch:ome};pt.forEach(hL,((t,r)=>{if(t){try{Object.defineProperty(t,"name",{value:r})}catch{}Object.defineProperty(t,"adapterName",{value:r})}}));const Az=t=>"- ".concat(t),ame=t=>pt.isFunction(t)||t===null||t===!1;var Pz={getAdapter:t=>{t=pt.isArray(t)?t:[t];const{length:r}=t;let s,a;const c={};for(let d=0;d<r;d++){let h;if(s=t[d],a=s,!ame(s)&&(a=hL[(h=String(s)).toLowerCase()],a===void 0))throw new Er("Unknown adapter '".concat(h,"'"));if(a)break;c[h||"#"+d]=a}if(!a){const d=Object.entries(c).map((h=>{let[m,g]=h;return"adapter ".concat(m," ")+(g===!1?"is not supported by the environment":"is not available in the build")}));throw new Er("There is no suitable adapter to dispatch the request "+(r?d.length>1?`since :
`+d.map(Az).join(`
`):" "+Az(d[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return a},adapters:hL};function pL(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Uv(null,t)}function Oz(t){return pL(t),t.headers=Gd.from(t.headers),t.data=oL.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Pz.getAdapter(t.adapter||iL.adapter)(t).then((function(r){return pL(t),r.data=oL.call(t,t.transformResponse,r),r.headers=Gd.from(r.headers),r}),(function(r){return hz(r)||(pL(t),r&&r.response&&(r.response.data=oL.call(t,t.transformResponse,r.response),r.response.headers=Gd.from(r.response.headers))),mt.reject(r)}))}const kz="1.9.0",i1={};["object","boolean","number","function","string","symbol"].forEach(((t,r)=>{i1[t]=function(s){return typeof s===t||"a"+(r<1?"n ":" ")+t}}));const Nz={};i1.transitional=function(t,r,s){function a(c,d){return"[Axios v"+kz+"] Transitional option '"+c+"'"+d+(s?". "+s:"")}return(c,d,h)=>{if(t===!1)throw new Er(a(d," has been removed"+(r?" in "+r:"")),Er.ERR_DEPRECATED);return r&&!Nz[d]&&(Nz[d]=!0,console.warn(a(d," has been deprecated since v"+r+" and will be removed in the near future"))),!t||t(c,d,h)}},i1.spelling=function(t){return(r,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(t)),!0)};var s1={assertOptions:function(t,r,s){if(typeof t!="object")throw new Er("options must be an object",Er.ERR_BAD_OPTION_VALUE);const a=Object.keys(t);let c=a.length;for(;c-- >0;){const d=a[c],h=r[d];if(h){const m=t[d],g=m===void 0||h(m,d,t);if(g!==!0)throw new Er("option "+d+" must be "+g,Er.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new Er("Unknown option "+d,Er.ERR_BAD_OPTION)}},validators:i1};const Jh=s1.validators;let o1=class{constructor(t){this.defaults=t||{},this.interceptors={request:new MB,response:new MB}}async request(t,r){try{return await this._request(t,r)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const c=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?c&&!String(s.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+c):s.stack=c}catch{}}throw s}}_request(t,r){typeof t=="string"?(r=r||{}).url=t:r=t||{},r=X_(this.defaults,r);const{transitional:s,paramsSerializer:a,headers:c}=r;s!==void 0&&s1.assertOptions(s,{silentJSONParsing:Jh.transitional(Jh.boolean),forcedJSONParsing:Jh.transitional(Jh.boolean),clarifyTimeoutError:Jh.transitional(Jh.boolean)},!1),a!=null&&(pt.isFunction(a)?r.paramsSerializer={serialize:a}:s1.assertOptions(a,{encode:Jh.function,serialize:Jh.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),s1.assertOptions(r,{baseUrl:Jh.spelling("baseURL"),withXsrfToken:Jh.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let d=c&&pt.merge(c.common,c[r.method]);c&&pt.forEach(["delete","get","head","post","put","patch","common"],(N=>{delete c[N]})),r.headers=Gd.concat(d,c);const h=[];let m=!0;this.interceptors.request.forEach((function(N){typeof N.runWhen=="function"&&N.runWhen(r)===!1||(m=m&&N.synchronous,h.unshift(N.fulfilled,N.rejected))}));const g=[];let E;this.interceptors.response.forEach((function(N){g.push(N.fulfilled,N.rejected)}));let w,I=0;if(!m){const N=[Oz.bind(this),void 0];for(N.unshift.apply(N,h),N.push.apply(N,g),w=N.length,E=mt.resolve(r);I<w;)E=E.then(N[I++],N[I++]);return E}w=h.length;let A=r;for(I=0;I<w;){const N=h[I++],G=h[I++];try{A=N(A)}catch(F){G.call(this,F);break}}try{E=Oz.call(this,A)}catch(N){return mt.reject(N)}for(I=0,w=g.length;I<w;)E=E.then(g[I++],g[I++]);return E}getUri(t){return LB(gz((t=X_(this.defaults,t)).baseURL,t.url,t.allowAbsoluteUrls),t.params,t.paramsSerializer)}};pt.forEach(["delete","get","head","options"],(function(t){o1.prototype[t]=function(r,s){return this.request(X_(s||{},{method:t,url:r,data:(s||{}).data}))}})),pt.forEach(["post","put","patch"],(function(t){function r(s){return function(a,c,d){return this.request(X_(d||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:a,data:c}))}}o1.prototype[t]=r(),o1.prototype[t+"Form"]=r(!0)}));var a1=o1;class fL{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let s;this.promise=new mt((function(c){s=c}));const a=this;this.promise.then((c=>{if(!a._listeners)return;let d=a._listeners.length;for(;d-- >0;)a._listeners[d](c);a._listeners=null})),this.promise.then=c=>{let d;const h=new mt((m=>{a.subscribe(m),d=m})).then(c);return h.cancel=function(){a.unsubscribe(d)},h},r((function(c,d,h){a.reason||(a.reason=new Uv(c,d,h),s(a.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const s=this._listeners.indexOf(r);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const r=new AbortController,s=a=>{r.abort(a)};return this.subscribe(s),r.signal.unsubscribe=()=>this.unsubscribe(s),r.signal}static source(){let r;return{token:new fL((function(a){r=a})),cancel:r}}}var cme=fL;const mL={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(mL).forEach((t=>{let[r,s]=t;mL[s]=r}));var lme=mL;const So=(function t(r){const s=new a1(r),a=yB(a1.prototype.request,s);return pt.extend(a,a1.prototype,s,{allOwnKeys:!0}),pt.extend(a,s,null,{allOwnKeys:!0}),a.create=function(c){return t(X_(r,c))},a})(iL);So.Axios=a1,So.CanceledError=Uv,So.CancelToken=cme,So.isCancel=hz,So.VERSION=kz,So.toFormData=FA,So.AxiosError=Er,So.Cancel=So.CanceledError,So.all=function(t){return mt.all(t)},So.spread=function(t){return function(r){return t.apply(null,r)}},So.isAxiosError=function(t){return pt.isObject(t)&&t.isAxiosError===!0},So.mergeConfig=X_,So.AxiosHeaders=Gd,So.formToJSON=t=>uz(pt.isHTMLForm(t)?new FormData(t):t),So.getAdapter=Pz.getAdapter,So.HttpStatusCode=lme,So.default=So;var ka=So;const ume=()=>{};function qw(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:ume};return t.promise=new mt(((r,s)=>{t.resolve=a=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,r(a),t.value=a)},t.reject=a=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,s(a))}})),t}const c1=new Map,l1=new Map,Qh=new Map;let rs=(function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t})({}),qn=(function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t})({});const xz=new Fde;let Hd=xz.getResult(),gL=null;function Ln(t){if(!gL){Hd=xz.getResult();const r=(function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return qn.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return qn.CHROME;case"Safari":case"Mobile Safari":return qn.SAFARI;case"Edge":return qn.EDGE;case"Firefox":return qn.FIREFOX;case"QQ":case"QQBrowser":return qn.QQ;case"Opera":return qn.OPERA;case"WeChat":return qn.WECHAT;default:return m.browser.name||""}})(Hd),s=Dz(Hd),a=(function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""})(Hd),c=Hd.os.version,d=Dz(Hd,!1),h=Hd.device.type;if(!(r&&s&&a&&c))return{name:r,version:s,os:a,osVersion:c,browserVersion:d,deviceType:h};gL={name:r,version:s,os:a,osVersion:c,browserVersion:d,deviceType:h}}return gL}function Dz(t){let r,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",s?r.split(".")[0]:r}function u1(){return Ln().os}function Lz(){const t=Ln();return"".concat(t.os," ").concat(t.osVersion)}function d1(){const t=Ln();return!!(Hd.engine.name==="WebKit"&&t.os===rs.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==qn.SAFARI||bo()&&t.name!==qn.SAFARI)}function pf(){return Ln().name===qn.CHROME}function Vs(){return Ln().name===qn.SAFARI}function Mz(){const t=Ln();if(t.name!==qn.SAFARI||!t.browserVersion)return!1;const r=t.browserVersion.split(".");return Number(r[0])>15||Number(r[0])===15&&Number(r[1])>=4}function Uz(){return Ln().name===qn.EDGE}function ni(){return Ln().name===qn.FIREFOX}function bo(){return Ln().os===rs.IOS}function Vv(t){const r=Ln();return!(r.name!==qn.CHROME||!r.osVersion)&&Number(r.version)>=t}function Vz(t){const r=Ln();return!(r.name!==qn.CHROME||!r.osVersion)&&Number(r.version)<t}function _L(t,r,s){const a=Ln();return!(a.name!==t||!a.osVersion)&&(s?Number(a.version)>=r&&Number(a.version)<=s:Number(a.version)===r)}function yL(t){const r=Ln();return!(r.name!==qn.EDGE||!r.osVersion)&&Number(r.version)>=t}function EL(t){const r=Ln();return!(r.name!==qn.FIREFOX||!r.osVersion)&&Number(r.version)>=t}function jz(t){const r=Ln();return!(r.name!==qn.SAFARI||!r.osVersion)&&Number(r.version)>=t}function Fz(t,r,s){const a=Ln();if(a.os!==rs.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return s?r&&Number(c[0])===t&&Number(c[1])>r||Number(c[0])>t:r?Number(c[0])===t&&Number(c[1])>=r||Number(c[0])>t:Number(c[0])>=t}function Bz(t,r,s){const a=Ln();if(a.os!==rs.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t}function vL(t,r,s){const a=Ln();if(a.name!==qn.SAFARI||!a.osVersion||!a.browserVersion)return!1;const c=a.browserVersion.split(".");return s?r&&Number(c[0])===t&&Number(c[1])<r||Number(c[0])<t:r?Number(c[0])===t&&Number(c[1])<=r||Number(c[0])<t:Number(c[0])<=t}function SL(t){const r=Ln();return!(r.name!==qn.OPERA||!r.osVersion)&&Number(r.version)>=t}function zz(){const t=Ln();if(t.os!==rs.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function jv(){const t=Ln();if(t.os!==rs.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15}function bL(){const t=Ln();if(t.os!==rs.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===16}function Wz(){const t=Ln();if(t.os!==rs.IOS||!t.osVersion)return!1;const r=t.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function Bu(){return Vs()&&navigator.maxTouchPoints>0}function Gz(){return Ln().name===qn.WECHAT}function Hz(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function wL(){const t=u1();return(function(){const{deviceType:r}=Ln();return r==="mobile"||r==="tablet"})()||t===rs.ANDROID||t===rs.IOS||t===rs.HARMONY_OS}function ff(){const t=Ln();return t.name!==qn.EDGE&&t.name!==qn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function h1(){return u1()===rs.ANDROID}function Yw(){const t=Ln();return h1()&&(t.name===qn.CHROME||t.name===qn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function tn(t,r,s){return(r=(function(a){var c=(function(d,h){if(typeof d!="object"||!d)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var g=m.call(d,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)})(a);return typeof c=="symbol"?c:c+""})(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function $z(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function et(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?$z(Object(s),!0).forEach((function(a){tn(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):$z(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}let te=(function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t})({}),Le=class extends Error{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(r),tn(this,"code",void 0),tn(this,"message",void 0),tn(this,"data",void 0),tn(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return t==="error"&&(r||console).error(this.toString()),t==="warning"&&(r||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function $d(t,r){if(typeof t!="boolean")throw new Le(te.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Yi(t,r,s){if(!rt(s).call(s,t))throw new Le(te.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(s)))}function vr(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<s||t>a||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!(function(c){return typeof c=="number"&&c%1==0})(t))throw new Le(te.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(s,", ").concat(a,"]. integer only"))}function TL(t,r){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new Le(te.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));t.min!==void 0&&vr(t.min,"".concat(r,".min"),0,1/0),t.max!==void 0&&vr(t.max,"".concat(r,".max"),1,1/0),t.exact!==void 0&&vr(t.exact,"".concat(r,".exact"),1,1/0),t.ideal!==void 0&&vr(t.ideal,"".concat(r,".ideal"),1,1/0)}else vr(t,r,1,1/0)}function Ss(t,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new Le(te.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!Kz(t,s,a,c))throw new Le(te.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(s,",").concat(a,"].").concat(c?" ASCII characters only.":""))}function mf(t,r){if(!Array.isArray(t))throw new Le(te.INVALID_PARAMS,"".concat(r," should be an array"))}function ri(t){return t==null}function Kz(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,a=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=s&&t.length>=r&&(!a||(function(c){if(typeof c!="string")return!1;for(let d=0;d<c.length;d+=1){const h=c.charCodeAt(d);if(h<0||h>255)return!1}return!0})(t))}var Xw=(function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t})(Xw||{}),CL=(function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t})(CL||{});const qz=new class{constructor(){tn(this,"_clientSize",null),tn(this,"getClientWidth",(()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)),tn(this,"getClientHeight",(()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight)),tn(this,"getStyle",(t=>window.getComputedStyle(t,null))),tn(this,"checkCssVisibleProperty",(t=>{var r;let s=!0;const a=this.getStyle(t),{display:c,visibility:d,opacity:h,filter:m}=a;return(c==="none"||rt(r=["hidden","collapse"]).call(r,d)||Number(h)<.1)&&(s=!1),!!s&&(m&&m.split(" ").filter((g=>{var E;const w=g.split("(")[0];return rt(E=["brightness","blur","opacity"]).call(E,w)})).map((g=>{const[E,w]=g.split(/\(|\)/);return[E,Number(w.match(/^[0-9\.]+/))]})).forEach((g=>{const[E,w]=g;switch(E){case"brightness":(w<.1||w>3)&&(s=!1);break;case"blur":w>3&&(s=!1);break;case"opacity":w<.1&&(s=!1)}})),s)})),tn(this,"checkPropertyUpToAllParentNodes",((t,r)=>{let s=!0,a=!0;const c=h=>r(h);let d=t;for(;d&&a;)c(d)||(s=!1,a=!1),d=d.parentElement,d||(a=!1);return s})),tn(this,"checkActualCssVisibleIncludeInherit",(t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty))),tn(this,"getSizeAboutClient",(t=>{const{width:r,height:s,left:a,right:c,top:d,bottom:h}=t.getBoundingClientRect(),m=this.getClientWidth(),g=this.getClientHeight();return{width:r,height:s,left:a,right:c,top:d,bottom:h,clientWidth:m,clientHeight:g,clientMin:Math.min(m,g)}})),tn(this,"checkActualSize",(()=>{const{width:t,height:r,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(t,r,s)})),tn(this,"elementFromPoint",((t,r)=>document.elementFromPoint?document.elementFromPoint(t,r):null)),tn(this,"checkCoverForAPoint",((t,r,s)=>{const a=this.elementFromPoint(t,r);return a!==null&&a!==s})),tn(this,"getPointPositionList",(()=>{const{width:t,height:r,left:s,top:a}=this._clientSize,c=t/6,d=r/6,h=[],m=10**6;for(let g=0;g<5;g++)for(let E=0;E<5;E++){const w=(s*m+(g===0?.1:g===4?(c*g*m-1e5)/m:c*g)*m)/m,I=(a*m+(E===0?.1:E===4?(d*E*m-1e5)/m:d*E)*m)/m;h.push({x:w,y:I})}return[...h]})),tn(this,"checkElementCover",(t=>this.getPointPositionList().map((r=>this.checkCoverForAPoint(r.x,r.y,t))).filter((r=>!!r)).length>6)),tn(this,"checkSizeIsVisible",((t,r,s)=>(t>50||s/t<=10)&&(r>50||s/r<=10))),tn(this,"checkSizeOfPartInClient",(()=>{const{left:t,right:r,top:s,bottom:a,clientHeight:c,clientWidth:d,clientMin:h}=this._clientSize;let m,g,E,w;if(t<0)m=0;else{if(!(t<d))return!1;m=t}if(r<0)return!1;if(g=r<d?r:d,s<0)E=0;else{if(!(s<c))return!1;E=s}if(a<0)return!1;w=a<c?a:c;const I=g-m,A=w-E;return this.checkSizeIsVisible(I,A,h)})),tn(this,"returnHiddenResult",(t=>(this._clientSize=null,{visible:!1,reason:t}))),tn(this,"checkOneElementVisible",(t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(Xw.COVERED);{const r=this.checkActualSize(),s=this.checkSizeOfPartInClient();return r&&!s?this.returnHiddenResult(Xw.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Xw.SIZE)}}return this.returnHiddenResult(Xw.STYLE)}return this.returnHiddenResult(CL.UNMOUNTED)}return this.returnHiddenResult(CL.INVALID_HTML_ELEMENT)})),tn(this,"checkElementIsMountedOnDom",(t=>this.checkPropertyUpToAllParentNodes(t,(r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))))}};function RL(t){return new TextEncoder().encode(t)}const Yz=function(t,r){const s=new Uint8Array(t.byteLength+r.byteLength);return s.set(new Uint8Array(t),0),s.set(new Uint8Array(r),t.byteLength),s},IL=async t=>(function(r,s){let a="";return new Uint8Array(r).forEach((c=>{a+=c.toString(s).padStart(2,"0")})),a})(await crypto.subtle.digest("SHA-256",RL(t)),16);class Qr{constructor(){tn(this,"_events",{}),tn(this,"addListener",this.on)}getListeners(r){return this._events[r]?this._events[r].map((s=>s.listener)):[]}on(r,s){this._events[r]||(this._events[r]=[]);const a=this._events[r];this._indexOfListener(a,s)===-1&&a.push({listener:s,once:!1})}once(r,s){this._events[r]||(this._events[r]=[]);const a=this._events[r];this._indexOfListener(a,s)===-1&&a.push({listener:s,once:!0})}off(r,s){if(!this._events[r])return;const a=this._events[r],c=this._indexOfListener(a,s);c!==-1&&a.splice(c,1),this._events[r].length===0&&delete this._events[r]}removeAllListeners(r){r?delete this._events[r]:this._events={}}emit(r){this._events[r]||(this._events[r]=[]);const s=this._events[r].map((h=>h));for(var a=arguments.length,c=new Array(a>1?a-1:0),d=1;d<a;d++)c[d-1]=arguments[d];for(let h=0;h<s.length;h+=1){const m=s[h];m.once&&this.off(r,m.listener),m.listener.apply(this,c||[])}}safeEmit(r){for(var s=arguments.length,a=new Array(s>1?s-1:0),c=1;c<s;c++)a[c-1]=arguments[c];[...this._events[r]||[]].forEach((d=>{d.once&&this.off(r,d.listener);try{d.listener.apply(this,a)}catch(h){console.error("safeEmit event:".concat(r," error ").concat(h==null?void 0:h.toString()))}}))}_indexOfListener(r,s){let a=r.length;for(;a--;)if(r[a].listener===s)return a;return-1}}let Jw=null;function Xz(){if(Jw)return Jw;if(window.electron)return Jw=window.electron;if(!window.require)return null;try{return Jw=window.require("electron"),Jw}catch{return null}}let di=(function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",t.PRELOAD_MEDIA_FAILED="preloadMediaFailed",t.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",t})({}),Hr=(function(t){return t.TRACER="tracer",t})({});function Jz(t){return vr(t.timeout,"config.timeout",0,1e5),vr(t.timeoutFactor,"config.timeoutFactor",0,100,!1),vr(t.maxRetryCount,"config.maxRetryConfig",0,1/0),vr(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let dme=(function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t})({}),sr=(function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t})({});function Qw(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach((r=>{if(!r.urls)throw Error()}))}catch{return!1}return!0}function Qz(t){return Ss(t.turnServerURL,"turnServerURL"),Ss(t.username,"username"),Ss(t.password,"password"),t.udpport&&vr(t.udpport,"udpport",1,99999,!0),t.forceturn&&$d(t.forceturn,"forceturn"),t.security&&$d(t.security,"security"),t.tcpport&&vr(t.tcpport,"tcpport",1,99999,!0),!0}function AL(t){return t.level!==void 0&&Yi(t.level,"level",[1,2,3]),t.delay!==void 0&&vr(t.delay,"delay",0,3e3,!0),!0}let An=(function(t){return t.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",t.AUDIO_METADATA="audio-metadata",t.AUDIO_PTS="audio-pts",t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t})({}),js=(function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",t})({}),Oc=(function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t})({}),Fv=(function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t})({});function Fs(t,r){for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return t.getListeners(r).length===0?mt.reject(new Le(te.UNEXPECTED_ERROR,"can not emit promise")):new mt(((d,h)=>{t.emit(r,...a,d,h)}))}function br(t,r){if(t.getListeners(r).length===0)return mt.resolve();for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return Fs(t,r,...a)}function il(t,r){if(t.getListeners(r).length===0)return null;for(var s=arguments.length,a=new Array(s>2?s-2:0),c=2;c<s;c++)a[c-2]=arguments[c];return Zw(t,r,...a)}function Zw(t,r){let s=null,a=null;for(var c=arguments.length,d=new Array(c>2?c-2:0),h=2;h<c;h++)d[h-2]=arguments[h];if(t.emit(r,...d,(m=>{s=m}),(m=>{a=m})),a!==null)throw a;if(s===null)throw new Le(te.UNEXPECTED_ERROR,"handler is not sync");return s}const Ci=new class extends Qr{set networkState(t){this.emit(Fv.NETWORK_STATE_CHANGE,t,this._networkState),t===Oc.ONLINE?this.emit(Fv.ONLINE):t===Oc.OFFLINE&&(this.onlineWaiter=new mt((r=>{this.once(Fv.ONLINE,(()=>{this.onlineWaiter=void 0,r(Oc.ONLINE)}))})),this.emit(Fv.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===Oc.ONLINE}constructor(){super(),tn(this,"_moduleName","network-indicator"),tn(this,"_networkState",Oc.ONLINE),tn(this,"onlineWaiter",void 0),window.addEventListener("online",(()=>{this.networkState=Oc.ONLINE})),window.addEventListener("offline",(()=>{this.networkState=Oc.OFFLINE}))}};function p1(t,r){const s=t.indexOf(r);s!==-1&&t.splice(s,1)}function Bv(t){const r=[];return t.forEach((s=>{r.indexOf(s)===-1&&r.push(s)})),r}function f1(t){mt!==void 0?mt.resolve().then(t):setTimeout(t,0)}function $r(t){return JSON.parse(JSON.stringify(t))}function J_(t){try{return $r(t)}catch{return t}}const Zz={};function Hm(t,r){Zz[r]||(Zz[r]=!0,t())}function Q_(t){const r=window.atob(t),s=new Uint8Array(new ArrayBuffer(r.length));for(let a=0;a<r.length;a+=1)s[a]=r.charCodeAt(a);return s}function $m(t){let r="";for(let s=0;s<t.length;s+=1)r+=String.fromCharCode(t[s]);return window.btoa(r)}function e9(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(t);if(s.length>r)s=s.slice(0,r);else if(s.length<r){const a=new Uint8Array(r);a.set(s),s=a}return s}function t9(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=Ya(r).call(r,((h,m)=>h+m.length),0),c=new Uint8Array(new ArrayBuffer(a));let d=0;return r.forEach((h=>{c.set(h,d),d+=h.length})),c}function Zh(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function n9(t){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach((s=>{r+=typeof s=="string"?Zh(s):s.size})),r+138}function hme(t){const r=new Le(te.TIMEOUT,"timeout");return new mt(((s,a)=>{window.setTimeout((()=>a(r)),t)}))}function bs(t){return new mt((r=>{window.setTimeout(r,t)}))}function wr(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,t).toLowerCase();return s.length===t?"".concat(r).concat(s):"".concat(r).concat(s)+wr(t-s.length,"")}function Z_(){return wr(32,"").toUpperCase()}const m1=()=>{},r9=new class{constructor(){tn(this,"fnMap",new Map)}throttleByKey(t,r,s,a){for(var c=arguments.length,d=new Array(c>4?c-4:0),h=4;h<c;h++)d[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==s){m.fn(...m.args),clearTimeout(m.timer);const g=window.setTimeout((()=>{const E=this.fnMap.get(r);E&&E.fn(...E.args),this.fnMap.delete(r)}),s);this.fnMap.set(r,{fn:t,threshold:s,timer:g,args:d,skipFn:a})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,et(et({},m),{},{fn:t,args:d,skipFn:a}))}else{const m=window.setTimeout((()=>{const g=this.fnMap.get(r);g&&g.fn(...g.args),this.fnMap.delete(r)}),s);this.fnMap.set(r,{fn:t,threshold:s,timer:m,args:d,skipFn:a})}}},i9=r9.throttleByKey.bind(r9);function s9(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function PL(t,r){if(!s9(t)||!s9(r)||Array.isArray(t)&&!Array.isArray(r)||!Array.isArray(t)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(t)){const s=[...t];for(let a=0;a<r.length;a++)s[a]=PL(t[a],r[a]);return s}{const s=et({},t);for(const a in r)Object.prototype.hasOwnProperty.call(r,a)&&(Object.prototype.hasOwnProperty.call(t,a)?s[a]=PL(t[a],r[a]):s[a]=r[a]);return s}}function o9(t,r){let s=[0];if(s=new Array(r).fill(0),t===0)return s;let a=0;for(;t>0&&(s[a]=255&t,t>>=8,a++,a!==r););return s}function zv(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function OL(t){return Ya(t).call(t,((r,s)=>r+s),0)}function a9(t){const r="0123456789abcdef";function s(ae){let ye,_e="";for(ye=0;ye<=3;ye++)_e+=r.charAt(ae>>8*ye+4&15)+r.charAt(ae>>8*ye&15);return _e}function a(ae,ye){const _e=(65535&ae)+(65535&ye);return(ae>>16)+(ye>>16)+(_e>>16)<<16|65535&_e}function c(ae,ye,_e,ue,Ae,Ue){return a((function(We,Ze){return We<<Ze|We>>>32-Ze})(a(a(ye,ae),a(ue,Ue)),Ae),_e)}function d(ae,ye,_e,ue,Ae,Ue,We){return c(ye&_e|~ye&ue,ae,ye,Ae,Ue,We)}function h(ae,ye,_e,ue,Ae,Ue,We){return c(ye&ue|_e&~ue,ae,ye,Ae,Ue,We)}function m(ae,ye,_e,ue,Ae,Ue,We){return c(ye^_e^ue,ae,ye,Ae,Ue,We)}function g(ae,ye,_e,ue,Ae,Ue,We){return c(_e^(ye|~ue),ae,ye,Ae,Ue,We)}const E=(function(ae){let ye;const _e=1+(ae.length+8>>6),ue=new Array(16*_e);for(ye=0;ye<16*_e;ye++)ue[ye]=0;for(ye=0;ye<ae.length;ye++)ue[ye>>2]|=ae.charCodeAt(ye)<<ye%4*8;return ue[ye>>2]|=128<<ye%4*8,ue[16*_e-2]=8*ae.length,ue})(t);let w,I,A,N,G,F=1732584193,z=-271733879,ee=-1732584194,Z=271733878;for(w=0;w<E.length;w+=16)I=F,A=z,N=ee,G=Z,F=d(F,z,ee,Z,E[w+0],7,-680876936),Z=d(Z,F,z,ee,E[w+1],12,-389564586),ee=d(ee,Z,F,z,E[w+2],17,606105819),z=d(z,ee,Z,F,E[w+3],22,-1044525330),F=d(F,z,ee,Z,E[w+4],7,-176418897),Z=d(Z,F,z,ee,E[w+5],12,1200080426),ee=d(ee,Z,F,z,E[w+6],17,-1473231341),z=d(z,ee,Z,F,E[w+7],22,-45705983),F=d(F,z,ee,Z,E[w+8],7,1770035416),Z=d(Z,F,z,ee,E[w+9],12,-1958414417),ee=d(ee,Z,F,z,E[w+10],17,-42063),z=d(z,ee,Z,F,E[w+11],22,-1990404162),F=d(F,z,ee,Z,E[w+12],7,1804603682),Z=d(Z,F,z,ee,E[w+13],12,-40341101),ee=d(ee,Z,F,z,E[w+14],17,-1502002290),z=d(z,ee,Z,F,E[w+15],22,1236535329),F=h(F,z,ee,Z,E[w+1],5,-165796510),Z=h(Z,F,z,ee,E[w+6],9,-1069501632),ee=h(ee,Z,F,z,E[w+11],14,643717713),z=h(z,ee,Z,F,E[w+0],20,-373897302),F=h(F,z,ee,Z,E[w+5],5,-701558691),Z=h(Z,F,z,ee,E[w+10],9,38016083),ee=h(ee,Z,F,z,E[w+15],14,-660478335),z=h(z,ee,Z,F,E[w+4],20,-405537848),F=h(F,z,ee,Z,E[w+9],5,568446438),Z=h(Z,F,z,ee,E[w+14],9,-1019803690),ee=h(ee,Z,F,z,E[w+3],14,-187363961),z=h(z,ee,Z,F,E[w+8],20,1163531501),F=h(F,z,ee,Z,E[w+13],5,-1444681467),Z=h(Z,F,z,ee,E[w+2],9,-51403784),ee=h(ee,Z,F,z,E[w+7],14,1735328473),z=h(z,ee,Z,F,E[w+12],20,-1926607734),F=m(F,z,ee,Z,E[w+5],4,-378558),Z=m(Z,F,z,ee,E[w+8],11,-2022574463),ee=m(ee,Z,F,z,E[w+11],16,1839030562),z=m(z,ee,Z,F,E[w+14],23,-35309556),F=m(F,z,ee,Z,E[w+1],4,-1530992060),Z=m(Z,F,z,ee,E[w+4],11,1272893353),ee=m(ee,Z,F,z,E[w+7],16,-155497632),z=m(z,ee,Z,F,E[w+10],23,-1094730640),F=m(F,z,ee,Z,E[w+13],4,681279174),Z=m(Z,F,z,ee,E[w+0],11,-358537222),ee=m(ee,Z,F,z,E[w+3],16,-722521979),z=m(z,ee,Z,F,E[w+6],23,76029189),F=m(F,z,ee,Z,E[w+9],4,-640364487),Z=m(Z,F,z,ee,E[w+12],11,-421815835),ee=m(ee,Z,F,z,E[w+15],16,530742520),z=m(z,ee,Z,F,E[w+2],23,-995338651),F=g(F,z,ee,Z,E[w+0],6,-198630844),Z=g(Z,F,z,ee,E[w+7],10,1126891415),ee=g(ee,Z,F,z,E[w+14],15,-1416354905),z=g(z,ee,Z,F,E[w+5],21,-57434055),F=g(F,z,ee,Z,E[w+12],6,1700485571),Z=g(Z,F,z,ee,E[w+3],10,-1894986606),ee=g(ee,Z,F,z,E[w+10],15,-1051523),z=g(z,ee,Z,F,E[w+1],21,-2054922799),F=g(F,z,ee,Z,E[w+8],6,1873313359),Z=g(Z,F,z,ee,E[w+15],10,-30611744),ee=g(ee,Z,F,z,E[w+6],15,-1560198380),z=g(z,ee,Z,F,E[w+13],21,1309151649),F=g(F,z,ee,Z,E[w+4],6,-145523070),Z=g(Z,F,z,ee,E[w+11],10,-1120210379),ee=g(ee,Z,F,z,E[w+2],15,718787259),z=g(z,ee,Z,F,E[w+9],21,-343485551),F=a(F,I),z=a(z,A),ee=a(ee,N),Z=a(Z,G);return s(F)+s(z)+s(ee)+s(Z)}let pme=1,c9=console,ro=class{static setLogger(t){c9=t}constructor(t,r){tn(this,"id",void 0),tn(this,"lockingPromise",mt.resolve()),tn(this,"locks",0),tn(this,"name",""),tn(this,"lockId",void 0),this.lockId=pme++,t&&(this.name=t),r&&(this.id=r),this.logger("created")}logger(t,r){const s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),a=t==="created"?"is ".concat(t,"."):"is ".concat(t,", current queue ").concat(this.locks,". ").concat(r??"");c9.debug("".concat(s," ").concat(a))}setId(t){this.id=t}get isLocked(){return this.locks>0}lock(t){let r;this.locks+=1,this.logger("locked",t);const s=new mt((c=>{r=()=>{this.locks-=1,this.logger("unlocked",t),c()}})),a=this.lockingPromise.then((()=>r));return this.lockingPromise=this.lockingPromise.then((()=>s)),a}};function Wv(t,r){return function(s,a,c){const d=c.value;if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(t));const m=await h.lock("From ".concat(t,".").concat(a));try{for(var g=arguments.length,E=new Array(g),w=0;w<g;w++)E[w]=arguments[w];return await d.apply(this,E)}finally{m()}},c}}const Ni={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function kL(t,r){const s=Math.floor(r.timeout*Math.pow(r.timeoutFactor,t));return Math.min(r.maxRetryTimeout,s)}function Kd(t,r,s,a){const c=Object.assign({},Ni,a);let d=c.timeout;const h=async()=>{await(function(E){return new mt((w=>{window.setTimeout(w,E)}))})(d),d*=c.timeoutFactor,d=Math.min(c.maxRetryTimeout,d)};let m=!1;const g=new mt((async(E,w)=>{r=r||(()=>!1),s=s||(()=>!0);for(let I=0;I<c.maxRetryCount;I+=1){if(m)return w(new Le(te.OPERATION_ABORTED));try{const A=await t();if(!r(A,I)||I+1===c.maxRetryCount)return E(A);await h()}catch(A){if(!s(A,I)||I+1===c.maxRetryCount)return w(A);await h()}}}));return g.cancel=()=>m=!0,g}let g1,l9=class{constructor(t){tn(this,"input",[]),tn(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:Ya(t=this.input).call(t,((r,s)=>r+s))/this.input.length}},_1=0,NL=0;function xL(t,r,s,a){return new mt(((c,d)=>{r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),_1+=Zh(r.data)):s&&(r.data.size?_1+=r.data.size:r.data instanceof FormData?_1+=n9(r.data):_1+=Zh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,ka.request(r).then((h=>{typeof h.data=="string"?NL+=Zh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?NL+=h.data.byteLength:NL+=Zh(JSON.stringify(h.data)),c(h.data)})).catch((h=>{ka.isCancel(h)?d(new Le(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new Le(te.NETWORK_TIMEOUT,h.message)):h.response?d(new Le(te.NETWORK_RESPONSE_ERROR,h.response.status)):d(new Le(te.NETWORK_ERROR,h.message))}))}))}async function fme(t,r){const s=new Blob([r.data],{type:"buffer"});return await xL(t,et(et({},r),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const u9=()=>window.isSecureContext!==void 0;function zu(t){if(Array.isArray(t))return t.map((s=>s));if(!d9(t))return t;const r={};for(const s in t){const a=t[s];d9(a)||Array.isArray(a)?r[s]=zu(a):r[s]=a}return r}function d9(t){return!(typeof t!="object"||Array.isArray(t)||!t)}let DL=class{constructor(t){tn(this,"input",[]),tn(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const ep={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},eT={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:ep,remoteCandidate:ep},updateInterval:0},h9={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},p9={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},f9={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},m9={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let LL=class{constructor(t,r){tn(this,"onFirstVideoReceived",void 0),tn(this,"onFirstVideoDecoded",void 0),tn(this,"onFirstAudioReceived",void 0),tn(this,"onFirstVideoDecodedTimeout",void 0),tn(this,"onFirstAudioDecoded",void 0),tn(this,"onSelectedLocalCandidateChanged",void 0),tn(this,"onSelectedRemoteCandidateChanged",void 0),tn(this,"videoIsReady",!1),tn(this,"videoIsReady2",{}),tn(this,"pc",void 0),tn(this,"options",void 0),tn(this,"intervalTimer",void 0),tn(this,"stats",zu(eT)),tn(this,"isFirstVideoReceived",{}),tn(this,"isFirstVideoDecoded",{}),tn(this,"isFirstAudioReceived",{}),tn(this,"isFirstAudioDecoded",{}),tn(this,"isFirstVideoDecodedTimeout",{}),tn(this,"lossRateWindowStats",[]),this.pc=t,this.options=r,this.intervalTimer=window.setInterval((async()=>{this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new mt((t=>{t({local:et({},ep),remote:et({},ep)})}))}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,r){this.videoIsReady2[t]=r}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let a=0,c=0,d=0,h=0;for(const m of s)t[m].forEach(((g,E)=>{if(!this.lossRateWindowStats[r-1][m][E]||!this.lossRateWindowStats[0][m][E])return;const w=this.lossRateWindowStats[r-1][m][E].packets-this.lossRateWindowStats[0][m][E].packets,I=this.lossRateWindowStats[r-1][m][E].packetsLost-this.lossRateWindowStats[0][m][E].packetsLost;m==="videoSend"||m==="audioSend"?(a+=w,d+=I):(c+=w,h+=I),Number.isNaN(w)||Number.isNaN(w)?g.packetLostRate=0:g.packetLostRate=w<=0||I<=0?0:I/(w+I)}));t.sendPacketLossRate=a<=0||d<=0?0:d/(a+d),t.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},mme=class extends LL{constructor(){super(...arguments),tn(this,"_stats",eT),tn(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),r=this.statsResponsesToObjects(t);this._stats=zu(eT);const s=r.filter((c=>c.type==="ssrc"));this.processSSRCStats(s);const a=r.find((c=>c.type==="VideoBwe"));a&&this.processBandwidthStats(a),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach((r=>{var s;const a=rt(s=r.id).call(s,"send");switch("".concat(r.mediaType,"_").concat(a?"send":"recv")){case"video_send":{const c=zu(p9);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=zu(h9),d=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),d){const h=d.stats,m=Date.now()-d.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(d.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<d.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:et({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=zu(m9);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=zu(f9);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}}))}_getStats(){return new mt(((t,r)=>{this.pc.getStats(t,r)}))}statsResponsesToObjects(t){const r=[];return t.result().forEach((s=>{const a={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach((c=>{a[c]=s.stat(c)})),r.push(a)})),r}},tT=(function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t})({}),y1=(function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t})({}),ML=(function(t){return t[t.new=0]="new",t[t.connecting=1]="connecting",t[t.connected=2]="connected",t[t.disconnected=3]="disconnected",t[t.failed=4]="failed",t[t.closed=5]="closed",t})({}),sl=(function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t})({});var Gv=(function(t){return t[t.kNone=1]="kNone",t[t.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",t[t.kBytesToBits=8]="kBytesToBits",t})(Gv||{});function nT(t,r,s,a){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Gv.kNone;if(!r)return;const d=Number(r[s]);if(typeof d!="number")return;const h=Number(r[a]);if(typeof h!="number")return;if(!t)return h?d/h*c:void 0;const m=Number(t[s]);if(typeof m!="number")return;const g=Number(t[a]);if(typeof g!="number")return;const E=h-g;return E?(d-m)/E*c:void 0}let g9=class extends LL{constructor(){super(...arguments),tn(this,"_stats",eT),tn(this,"report",void 0),tn(this,"lastDecodeVideoReceiverStats",new Map),tn(this,"lastVideoFramesRecv",new Map),tn(this,"lastVideoFramesSent",new Map),tn(this,"lastVideoFramesDecode",new Map),tn(this,"lastVideoFramesOutput",new Map),tn(this,"lastVideoJBDelay",new Map),tn(this,"lastAudioJBDelay",new Map),tn(this,"mediaBytesSent",new Map),tn(this,"mediaBytesRetransmit",new Map),tn(this,"mediaBytesTargetEncode",new Map),tn(this,"lastDecodeAudioReceiverStats",new Map),tn(this,"lastAudioConcealment",new Map),tn(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=zu(eT),this.report.forEach((t=>{switch(t.type){case sl.OUTBOUND:case sl.INBOUND:{const r=t.mediaType||t.kind,s=!r&&"frameWidth"in t,a=!r&&!("frameWidth"in t);t.type===sl.OUTBOUND?r==="audio"||a?this.processAudioOutboundStats(t):(r==="video"||s)&&this.processVideoOutboundStats(t):t.type===sl.INBOUND&&(r==="audio"||a?this.processAudioInboundStats(t):(r==="video"||s)&&this.processVideoInboundStats(t));break}case sl.TRANSPORT:{const r=this.report.get(t.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case sl.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}})),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),r={local:et({},ep),remote:et({},ep)};return t.forEach((s=>{let a;if(s.type===sl.TRANSPORT&&(a=t.get(s.selectedCandidatePairId)),s.type===sl.CANDIDATE_PAIR&&s.selected&&(a=s),a){const c=(d,h)=>{d.type=h.type,d.id=h.id,h.address&&(d.address=h.address),h.candidateType&&(d.candidateType=h.candidateType),h.port&&(d.port=h.port),h.priority&&(d.priority=h.priority),h.protocol&&(d.protocol=h.protocol),h.relayProtocol&&(d.relayProtocol=h.relayProtocol)};if(a.localCandidateId){const d=t.get(a.localCandidateId);d&&c(r.local,d)}if(a.remoteCandidateId){const d=t.get(a.remoteCandidateId);d&&c(r.remote,d)}}})),r}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach((r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)})),this._stats.audioSend.forEach((r=>{t.currentRoundTripTime&&(r.rttMs=1e3*t.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const r=this.report.get(t.localCandidateId);r&&this.processCandidateStats(r)}if(t.remoteCandidateId){const r=this.report.get(t.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(t){let r;t.type===sl.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),t.type===sl.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=t.type,r.id=t.id,t.address&&(r.address=t.address),t.candidateType&&(r.candidateType=t.candidateType),t.port&&(r.port=t.port),t.priority&&(r.priority=t.priority),t.protocol&&(r.protocol=t.protocol),t.relayProtocol&&(r.relayProtocol=t.relayProtocol),t.type===sl.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(et({},r),et({},this.stats.selectedCandidatePair.localCandidate)),t.type===sl.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(et({},r),et({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let r=this._stats.audioRecv.find((a=>a.ssrc===t.ssrc));r||(r=zu(m9),this._stats.audioRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.packetsDiscarded=t.packetsDiscarded,r.bytes=t.bytesReceived,r.jitterMs=1e3*t.jitter,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived,r.totalProcessingDelay=t.totalProcessingDelay,r.jitterBufferEmittedCount=t.jitterBufferEmittedCount;const s=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=nT(s,r,"totalProcessingDelay","jitterBufferEmittedCount",Gv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(t,t.trackId,r),this.calculateAudioFreeze(r,s,t),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),r.receivedFrames||(r.receivedFrames=t.packetsReceived),r.droppedFrames||(r.droppedFrames=t.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof t.concealedSamples=="number"&&(r.concealedSamples=t.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,et({},r))}calculateAudioFreeze(t,r,s){const a=this.lastAudioConcealment.get(t.ssrc);if(r!=null&&a!=null){const c=a.lts,d=s.timestamp,h=d-c;if(h<=0)return;const m=t.concealedSamples-r.concealedSamples-0,g=a.nonSilent+m,E=t.totalSamplesReceived-r.totalSamplesReceived;if(E<=0)return;const w=80*E/h,I=200*E/h,A=h/E;let N=0;t.freezeSamples80=r.freezeSamples80,t.freezeMs80=r.freezeMs80,g>w&&(a.plc80>0?(t.freezeSamples80+=m,t.freezeMs80+=Math.round(m*A)):(t.freezeSamples80+=g,t.freezeMs80+=Math.round(g*A)),N=a.plc80+1);let G=0;t.freezeSamples200=r.freezeSamples200,t.freezeMs200=r.freezeMs200,g>I&&(a.plc200>0?(t.freezeSamples200+=m,t.freezeMs200+=Math.round(m*A)):(t.freezeSamples200+=g,t.freezeMs200+=Math.round(g*A)),G=a.plc200+1),this.lastAudioConcealment.set(t.ssrc,{nonSilent:m,lts:d,plc80:N,plc200:G})}else t.freezeSamples80=0,t.freezeSamples200=0,t.freezeMs80=0,t.freezeMs200=0,this.lastAudioConcealment.set(t.ssrc,{nonSilent:0,lts:s.timestamp,plc80:0,plc200:0})}processVideoInboundStats(t){let r=this._stats.videoRecv.find((h=>h.ssrc===t.ssrc));r||(r=zu(h9),this._stats.videoRecv.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsReceived,r.packetsLost=t.packetsLost,r.bytes=t.bytesReceived,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.framesDecodeCount=t.framesDecoded,r.framesDroppedCount=t.framesDropped,r.totalInterFrameDelay=t.totalInterFrameDelay,r.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay,r.totalFreezesDuration=t.totalFreezesDuration,r.totalProcessingDelay=t.totalProcessingDelay,r.packetsDiscarded=t.packetsDiscarded,r.framesAssembledFromMultiplePackets=t.framesAssembledFromMultiplePackets,r.totalAssemblyTime=t.totalAssemblyTime,r.keyFramesDecoded=t.keyFramesDecoded,r.retransmittedBytesReceived=t.retransmittedBytesReceived,r.retransmittedPacketsReceived=t.retransmittedPacketsReceived;const s=this.lastDecodeVideoReceiverStats.get(r.ssrc),a=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),d=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(s){const h=s.stats,m=d-s.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(s.stats.framesDecodeCount>t.framesDecoded?r.qpSumPerFrame=t.qpSum/t.framesDecoded:r.qpSumPerFrame=(t.qpSum-s.qpSum)/(t.framesDecoded-s.stats.framesDecodeCount))}t.totalDecodeTime&&(r.decodeMs=1e3*t.totalDecodeTime,r.avgDecodeMs=nT(s==null?void 0:s.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=nT(s==null?void 0:s.stats,r,"totalProcessingDelay","framesDecodeCount",Gv.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=nT(s==null?void 0:s.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Gv.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=nT(s==null?void 0:s.stats,r,"totalInterFrameDelay","framesDecodeCount",Gv.kMillisecondsFromSeconds),a&&d-a.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-a.count)/((d-a.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:r.decodeFrameRate})):a?r.decodeFrameRate=a.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:d,rate:0}),r.framesDroppedCount&&t.framesReceived&&(c&&d-c.lts>=800?(r.outputFrameRate=Math.round((t.framesReceived-r.framesDroppedCount-c.count)/((d-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:d,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:t.framesReceived-r.framesDroppedCount,lts:d,rate:0})),this.processVideoTrackReceiverStats(t,t.trackId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(r.framesRateFirefox=t.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:et({},r),lts:s?s.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let r=this._stats.videoSend.find((a=>a.ssrc===t.ssrc));r||(r=zu(p9),this._stats.videoSend.push(r));const s=this.mediaBytesSent.get(t.ssrc);if(s)s.add(t.bytesSent);else{const a=new DL(10);a.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,a)}if(t.retransmittedBytesSent!==void 0){const a=this.mediaBytesRetransmit.get(t.ssrc);if(a)a.add(t.retransmittedBytesSent);else{const c=new DL(10);c.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,c)}}if(t.totalEncodedBytesTarget){const a=this.mediaBytesTargetEncode.get(t.ssrc);if(a)a.add(t.totalEncodedBytesTarget);else{const c=new DL(10);c.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,c)}}if(r.ssrc=t.ssrc,r.bytes=t.bytesSent,r.packets=t.packetsSent,r.firsCount=t.firCount,r.nacksCount=t.nackCount,r.plisCount=t.pliCount,r.frameCount=t.framesEncoded,r.adaptionChangeReason=t.qualityLimitationReason,r.scalabilityMode=t.scalabilityMode,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,r.hugeFramesSent=t.hugeFramesSent,r.keyFramesEncoded=t.keyFramesEncoded,r.targetBitrate=t.targetBitrate,t.totalEncodeTime&&t.framesEncoded){const a=this.lastEncoderMs.get(t.ssrc);if(!a||a.lastFrameCount>t.framesEncoded)r.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const c=t.framesEncoded-a.lastFrameCount,d=t.totalEncodeTime-a.lastEncoderTime;r.avgEncodeMs=1e3*d/c}}if(t.framesEncoded&&t.qpSum){const a=this.lastEncoderMs.get(t.ssrc);!a||a.lastFrameCount>t.framesEncoded?r.qpSumPerFrame=t.qpSum/t.framesEncoded:r.qpSumPerFrame=(t.qpSum-a.lastQpSum)/(t.framesEncoded-a.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,r),this.processVideoTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const a=this.findRemoteStatsId(t.ssrc,sl.REMOTE_INBOUND);a&&this.processRemoteInboundStats(a,r)}}processAudioOutboundStats(t){let r=this._stats.audioSend.find((s=>s.ssrc===t.ssrc));if(r||(r=zu(f9),this._stats.audioSend.push(r)),r.ssrc=t.ssrc,r.packets=t.packetsSent,r.bytes=t.bytesSent,r.retransmittedBytesSent=t.retransmittedBytesSent,r.retransmittedPacketsSent=t.retransmittedPacketsSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,r),t.codecId&&(r.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,r),t.remoteId)this.processRemoteInboundStats(t.remoteId,r);else{const s=this.findRemoteStatsId(t.ssrc,sl.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}findRemoteStatsId(t,r){var s;const a=Array.from(Ic(s=this.report).call(s)).find((c=>c.type===r&&c.ssrc===t));return a?a.id:null}processVideoMediaSource(t,r){const s=this.report.get(t);s&&s.width&&s.height&&s.framesPerSecond&&(r.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(t,r){const s=this.report.get(t);s&&(r.inputLevel=s.audioLevel)}processVideoTrackSenderStats(t,r,s){var a,c,d,h;const m=r?this.report.get(r):void 0,g=(a=m==null?void 0:m.framesSent)!==null&&a!==void 0?a:t.framesSent;if(typeof g!="number")return;let E=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:t.frameWidth,w=(d=m==null?void 0:m.frameHeight)!==null&&d!==void 0?d:t.frameHeight,I=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:t.framesPerSecond;if(typeof E=="number"&&typeof w=="number"||(E=0,w=0),I==null){const A=Date.now(),N=this.lastVideoFramesSent.get(s.ssrc);N&&A-N.lts>=800?(I=Math.round((g-N.count)/((A-N.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:g,lts:A,rate:I})):N?I=N.rate:this.lastVideoFramesSent.set(s.ssrc,{count:g,lts:A,rate:0})}s.sentFrame={width:E,height:w,frameRate:Math.max(0,I)}}processVideoTrackReceiverStats(t,r,s){var a,c,d,h,m;const g=r?this.report.get(r):void 0,E=(a=g==null?void 0:g.framesReceived)!==null&&a!==void 0?a:t.framesReceived,w=(c=g==null?void 0:g.frameWidth)!==null&&c!==void 0?c:t.frameWidth,I=(d=g==null?void 0:g.frameHeight)!==null&&d!==void 0?d:t.frameHeight,A=(h=g==null?void 0:g.jitterBufferDelay)!==null&&h!==void 0?h:t.jitterBufferDelay,N=(m=g==null?void 0:g.jitterBufferEmittedCount)!==null&&m!==void 0?m:t.jitterBufferEmittedCount;if(typeof E=="number"){const G=this.lastVideoFramesRecv.get(s.ssrc),F=Date.now();s.framesReceivedCount=E;let z=0;G&&F-G.lts>=800?(z=Math.round((E-G.count)/((F-G.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:E,lts:F,rate:z})):G?z=G.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:E,lts:F,rate:0}),s.receivedFrame={width:w||0,height:I||0,frameRate:z||0},s.decodedFrame={width:w||0,height:I||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:w||0,height:I||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(A&&N){const G=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let F=G.jitterBufferMs;const z=N-G.jitterBufferEmittedCount;z>0&&(F=1e3*(A-G.jitterBufferDelay)/z),s.jitterBufferMs=F,s.currentDelayMs=Math.round(F),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:A,jitterBufferEmittedCount:N,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(t,r,s){var a,c,d,h;const m=r?this.report.get(r):void 0,g=(a=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:t.echoReturnLoss)!==null&&a!==void 0?a:0,E=(d=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:t.echoReturnLossEnhancement)!==null&&d!==void 0?d:0;s.aecReturnLoss=g,s.aecReturnLossEnhancement=E}processAudioTrackReceiverStats(t,r,s){var a,c,d,h,m,g,E,w,I;const A=r?this.report.get(r):void 0,N=(a=A==null?void 0:A.removedSamplesForAcceleration)!==null&&a!==void 0?a:t.removedSamplesForAcceleration,G=(c=A==null?void 0:A.totalSamplesReceived)!==null&&c!==void 0?c:t.totalSamplesReceived,F=(d=A==null?void 0:A.jitterBufferDelay)!==null&&d!==void 0?d:t.jitterBufferDelay,z=(h=A==null?void 0:A.jitterBufferEmittedCount)!==null&&h!==void 0?h:t.jitterBufferEmittedCount,ee=(m=A==null?void 0:A.audioLevel)!==null&&m!==void 0?m:t==null?void 0:t.audioLevel,Z=(g=A==null?void 0:A.totalSamplesDuration)!==null&&g!==void 0?g:t==null?void 0:t.totalSamplesDuration,ae=(E=A==null?void 0:A.concealedSamples)!==null&&E!==void 0?E:t.concealedSamples,ye=(w=A==null?void 0:A.silentConcealedSamples)!==null&&w!==void 0?w:t.silentConcealedSamples,_e=(I=A==null?void 0:A.concealmentEvents)!==null&&I!==void 0?I:t.concealmentEvents;if(typeof G=="number"&&(s.totalSamplesReceived=G),typeof ye=="number"&&(s.silentConcealedSamples=ye),typeof _e=="number"&&(s.concealmentEvents=_e),typeof ae=="number"&&(s.concealedSamples=ae),N&&G&&(s.accelerateRate=N/G),F&&z){const Ae=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let Ue=Ae.jitterBufferMs;const We=z-Ae.jitterBufferEmittedCount;We>0&&(Ue=1e3*(F-Ae.jitterBufferDelay)/We),s.jitterBufferMs=Math.round(Ue),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:F,jitterBufferEmittedCount:z,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=ee;let ue=1920;Z&&G&&(ue=G/Z/50,s.receivedFrames=Math.round(G/ue)),ae&&(s.droppedFrames=Math.round(ae/ue))}processRemoteInboundStats(t,r){const s=this.report.get(t);s&&(r.packetsLost=s.packetsLost,s.roundTripTime&&(r.rttMs=1e3*s.roundTripTime),s.jitter&&(r.jitterMs=1e3*s.jitter),s.timestamp&&(r.timestamp=s.timestamp))}getCodecFromCodecStats(t){const r=this.report.get(t);if(!r)return"";const s=r.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let t=0,r=null,s=null;this.mediaBytesSent.forEach((c=>{t+=c.diffMean()})),this.mediaBytesRetransmit.forEach((c=>{r=r===null?c.diffMean():r+c.diffMean()})),this.mediaBytesTargetEncode.forEach((c=>{s=s===null?c.diffMean():s+c.diffMean()}));const a=r!==null?t-r:t;this._stats.bitrate={actualEncoded:8*a/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},gme=class extends LL{updateStats(){return mt.resolve()}};function UL(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const d=(function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null})();return d?d<76?new mme(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new g9(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):(function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof mt||(function(g){return!!g&&(typeof g=="object"||typeof g=="function")&&typeof g.then=="function"})(m))})(t)?new g9(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c}):new gme(t,{updateInterval:r,lossRateInterval:s,freezeRateLimit:a,firstVideoDecodedTimeout:c})}const _9="websdk_ng_install_id";function VL(){try{if(oe("INSTALL_ID"))return oe("INSTALL_ID");let t=window.localStorage.getItem(_9);return t||(t=Z_(),window.localStorage.setItem(_9,t)),mr("INSTALL_ID",t),t}catch{return}}const Jl=(function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const r=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const s=r[1],a=r[2];return"".concat(s,".").concat(a)}return"4.0.0.999"})("4.24.0"),jL=(function(){try{return JSON.parse("true")===!0}catch{return!0}})();let ey=(function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t})({});const Bs=(function(){const t="us".concat("erna","me"),r="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const a=s.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const d=c.join(""),h={};return h[t]=a,h[r]=d,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})})();window.DEFAULT_TURN_CONFIG=Bs;const E1={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},FL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},BL="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",zL={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},Vr=et(et(et(et({},zL),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:FL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},E1),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function mr(t,r,s){var a,c,d;rt(a=Object.keys(Vr)).call(a,t)&&(!s&&rt(c=Object.keys(qd)).call(c,t)||(Vr[t]=r,t!=="ENABLE_VIDEO_SEI"&&t!=="ENABLE_AUDIO_TOPN"&&t!=="ENABLE_AUDIO_METADATA"&&t!=="ENABLE_AUDIO_PTS"||r!==!0||(Vr.ENABLE_ENCODED_TRANSFORM=!0),t==="USE_NEW_NETWORK_CONFIG"&&r&&(d=!!r,Vr.USE_NEW_NETWORK_CONFIG=d,d&&(Vr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Vr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Vr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Vr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Vr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Vr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Vr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&r&&(Vr.ENABLE_INSTANT_VIDEO=!0,Vr.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&r&&(Vr.ENABLE_AUT_CC=!0),t==="NEW_FORCE_TURN"&&r&&(Vr.NEW_TURN_MODE||(Vr.NEW_TURN_MODE=4))))}function oe(t){return Vr[t]}jL||(Vr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Vr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Vr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Vr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Vr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Vr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Vr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Vr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Vr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Vr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Vr.AREAS=["NORTH_AMERICA","OVERSEA"]);let y9=(function(t){return t[t.REALTIME=1]="REALTIME",t})({});const qd={};var nn=(function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",t.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",t.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",t.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",t.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",t.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",t.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t})(nn||{});let rT=(function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t})({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const E9=128,_me=96,v9=1e3,Hv=10;let yme=0;var S9=(()=>{var t={8:(a,c,d)=>{d.r(c),d.d(c,{Parser:()=>We,Printer:()=>rr,parse:()=>ot,print:()=>bt});const h=`
`,m="".concat("\r").concat(h),g=" ";let E;function w(He){return He>="0"&&He<="9"}function I(He){return He>="!"&&He<="~"}function A(He){return I(He)||He>=""&&He<=""}function N(He){return He==="!"||He>="#"&&He<="'"||He>="*"&&He<="+"||He>="-"&&He<="."||He>="0"&&He<="9"||He>="A"&&He<="Z"||He>="^"&&He<="~"}function G(He){return He>="1"&&He<="9"}function F(He){return He>="A"&&He<="Z"||He>="a"&&He<="z"}function z(He){return He==="d"||He==="h"||He==="m"||He==="s"}function ee(He){return He>""&&He<"	"||He>"\v"&&He<"\f"||He>""&&He<""}function Z(He){return F(He)||w(He)||He==="+"||He==="/"}function ae(He){return w(He)||F(He)||He==="+"||He==="/"||He==="-"||He==="_"}function ye(He){return F(He)||w(He)||He==="+"||He==="/"}function _e(He,V){var ce=Object.keys(He);if(Object.getOwnPropertySymbols){var ge=Object.getOwnPropertySymbols(He);V&&(ge=ge.filter((function(tt){return Object.getOwnPropertyDescriptor(He,tt).enumerable}))),ce.push.apply(ce,ge)}return ce}function ue(He){for(var V=1;V<arguments.length;V++){var ce=arguments[V]!=null?arguments[V]:{};V%2?_e(Object(ce),!0).forEach((function(ge){Ae(He,ge,ce[ge])})):Object.getOwnPropertyDescriptors?Object.defineProperties(He,Object.getOwnPropertyDescriptors(ce)):_e(Object(ce)).forEach((function(ge){Object.defineProperty(He,ge,Object.getOwnPropertyDescriptor(ce,ge))}))}return He}function Ae(He,V,ce){return V in He?Object.defineProperty(He,V,{value:ce,enumerable:!0,configurable:!0,writable:!0}):He[V]=ce,He}(function(He){He.VERSION="v",He.ORIGIN="o",He.SESSION_NAME="s",He.INFORMATION="i",He.URI="u",He.EMAIL="e",He.PHONE="p",He.CONNECTION="c",He.BANDWIDTH="b",He.TIME="t",He.REPEAT="r",He.ZONE_ADJUSTMENTS="z",He.KEY="k",He.ATTRIBUTE="a",He.MEDIA="m"})(E||(E={}));class Ue{consumeText(V,ce){let ge=ce;for(;ge<V.length;){const tt=V[ge];if(tt==="\0"||tt==="\r"||tt===h)break;ge+=1}if(ge-ce==0)throw new Error("Invalid text, at ".concat(V));return ge}consumeUnicastAddress(V,ce,ge){return this.consumeTill(V,ce,g)}consumeOneOrMore(V,ce,ge){let tt=ce;for(;ge(V[tt]);)tt++;if(tt-ce==0)throw new Error("Invalid rule at ".concat(ce,"."));return tt}consumeSpace(V,ce){if(V[ce]===g)return ce+1;throw new Error("Invalid space at ".concat(ce,"."))}consumeIP4Address(V,ce){let ge=ce;for(let tt=0;tt<4;tt++)if(ge=this.consumeDecimalUChar(V,ge),tt!==3){if(V[ge]!==".")throw new Error("Invalid IP4 address.");ge++}return ge}consumeDecimalUChar(V,ce){let ge=ce;for(let un=0;un<3&&w(V[ge]);un++,ge++);if(ge-ce==0)throw new Error("Invalid decimal uchar.");const tt=parseInt(V.slice(ce,ge));if(tt>=0&&tt<=255)return ge;throw new Error("Invalid decimal uchar")}consumeIP6Address(V,ce){let ge=this.consumeHexpart(V,ce);return V[ge]===":"&&(ge+=1,ge=this.consumeIP4Address(V,ge)),ge}consumeHexpart(V,ce){let ge=ce;if(V[ge]===":"&&V[ge+1]===":"){ge+=2;try{ge=this.consumeHexseq(V,ge)}catch{}return ge}if(ge=this.consumeHexseq(V,ge),V[ge]===":"&&V[ge+1]===":"){ge+=2;try{ge=this.consumeHexseq(V,ge)}catch{}return ge}return ge}consumeHexseq(V,ce){let ge=ce;for(;ge=this.consumeHex4(V,ge),V[ge]===":"&&V[ge+1]!==":";)ge+=1;return ge}consumeHex4(V,ce){let ge=0;for(;ge<4;ge++)if(!((tt=V[ce+ge])>="0"&&tt<="9"||tt>="a"&&tt<="f"||tt>="A"&&tt<="F")){if(ge===0)throw new Error("Invalid hex 4");break}var tt;return ce+ge}consumeFQDN(V,ce){let ge=ce;for(;w(V[ge])||F(V[ge])||V[ge]==="-"||V[ge]===".";)ge+=1;if(ge-ce<4)throw new Error("Invalid FQDN");return ge}consumeExtnAddr(V,ce){return this.consumeOneOrMore(V,ce,A)}consumeMulticastAddress(V,ce,ge){switch(ge){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(V,ce);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(V,ce);default:try{return this.consumeFQDN(V,ce)}catch{return this.consumeExtnAddr(V,ce)}}}consumeIP6MulticastAddress(V,ce){const ge=this.consumeHexpart(V,ce);return V[ge]==="/"?this.consumeInteger(V,ge+1):ge}consumeIP4MulticastAddress(V,ce){let ge=ce+3;const tt=V.slice(ce,ge),un=parseInt(tt);if(un<224||un>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Ir=0;Ir<3;Ir++){if(V[ge]!==".")throw new Error("Invalid IP4 multicast address.");ge+=1,ge=this.consumeDecimalUChar(V,ge)}return V[ge]==="/"&&(ge+=1),ge=this.consumeTTL(V,ge),V[ge]==="/"&&(ge=this.consumeInteger(V,ge)),ge}consumeInteger(V,ce){if(!G(V[ce]))throw new Error("Invalid integer.");for(ce+=1;w(V[ce]);)ce+=1;return ce}consumeTTL(V,ce){if(V[ce]==="0")return ce+1;if(!G(V[ce]))throw new Error("Invalid TTL.");ce+=1;for(let ge=0;ge<2&&w(V[ce]);ge++)ce+=1;return ce}consumeToken(V,ce){return this.consumeOneOrMore(V,ce,N)}consumeTime(V,ce){let ge=ce;if(V[ge]==="0")return ge+1;for(G(V[ge])&&(ge+=1);w(V[ge]);)ge++;if(ge-ce<10)throw new Error("Invalid time");return ge}consumeAddress(V,ce){return this.consumeTill(V,ce,g)}consumeTypedTime(V,ce){let ge=ce;return ge=this.consumeOneOrMore(V,ge,w),z(V[ge])?ge+1:ge}consumeRepeatInterval(V,ce){if(!G(V[ce]))throw new Error("Invalid repeat interval");for(ce+=1;w(V[ce]);)ce+=1;return z(V[ce])&&(ce+=1),ce}consumePort(V,ce){return this.consumeOneOrMore(V,ce,w)}consume(V,ce,ge){for(let tt=0;tt<ge.length;tt++){if(ce+tt>=V.length)throw new Error("consume exceeding value length");if(V[ce+tt]!==ge[tt])throw new Error("consume ".concat(ge," failed at ").concat(tt))}return ce+ge.length}consumeTill(V,ce,ge){let tt=ce;for(;tt<V.length&&(typeof ge!="string"||V[tt]!==ge)&&(typeof ge!="function"||!ge(V[tt]));)tt++;return tt}}class We extends Ue{constructor(){super(),Ae(this,"records",[]),Ae(this,"currentLine",0)}parse(V){const ce=this.probeEOL(V);this.records=V.split(ce).filter((Tf=>!!jo(Tf).call(Tf))).map(this.parseLine),this.currentLine=0;const ge=this.parseVersion(),tt=this.parseOrigin(),un=this.parseSessionName(),Ir=this.parseInformation(),zi=this.parseUri(),ou=this.parseEmail(),ed=this.parsePhone(),BT=this.parseConnection(),vy=this.parseBandWidth(),w0=this.parseTimeFields(),xP=this.parseKey(),DP=this.parseSessionAttribute(),au=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ge,origin:tt,sessionName:un,information:Ir,uri:zi,emails:ou,phones:ed,connection:BT,bandwidths:vy,timeFields:w0,key:xP,attributes:DP,mediaDescriptions:au}}getCurrentRecord(){const V=this.records[this.currentLine];if(!V)throw new Error("Record doesn't exit.");return V}probeEOL(V){for(let ce=0;ce<V.length;ce++)if(V[ce]===h)return V[ce-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(V,ce){if(V.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const ge=V[0];if(V[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ge,value:V.slice(2),line:ce,cur:0}}parseSessionAttribute(){const V=new _n;for(;this.currentLine<this.records.length;){const ce=this.getCurrentRecord();if(ce.type!==E.ATTRIBUTE)break;const ge={attField:this.extractOneOrMore(ce,(tt=>N(tt)&&tt!==":")),_cur:0};ce.value[ce.cur]===":"&&(ce.cur+=1,ge.attValue=this.extractOneOrMore(ce,ee)),V.parse(ge),this.currentLine++}return V.digest()}parseMediaAttributes(V){const ce=new Sn(V);for(;this.currentLine<this.records.length;){const ge=this.getCurrentRecord();if(ge.type!==E.ATTRIBUTE)break;const tt={attField:this.extractOneOrMore(ge,(un=>N(un)&&un!==":")),_cur:0};ge.value[ge.cur]===":"&&(ge.cur+=1,tt.attValue=this.extractOneOrMore(ge,ee)),ce.parse(tt),this.currentLine++}return ce.digest()}parseKey(){const V=this.getCurrentRecord();if(V.type===E.KEY){if(V.value==="prompt"||V.value==="clear:"||V.value==="base64:"||V.value==="uri:")return V.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const V=this.getCurrentRecord();if(V.type===E.ZONE_ADJUSTMENTS){const ce=[];for(;;)try{const ge=this.extract(V,this.consumeTime);this.consumeSpaceForRecord(V);let tt=!1;V.value[V.cur]==="-"&&(tt=!0,V.cur+=1);const un=this.extract(V,this.consumeTypedTime);ce.push({time:ge,typedTime:un,back:tt})}catch{break}if(ce.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ce}return[]}parseRepeat(){const V=[];for(;;){const ce=this.getCurrentRecord();if(ce.type!==E.REPEAT)break;{const ge=this.extract(ce,this.consumeRepeatInterval),tt=this.parseTypedTime(ce);V.push({repeatInterval:ge,typedTimes:tt}),this.currentLine++}}return V}parseTypedTime(V){const ce=[];for(;;)try{this.consumeSpaceForRecord(V),ce.push(this.extract(V,this.consumeTypedTime))}catch{break}if(ce.length===0)throw new Error("Invalid typed time.");return ce}parseTime(){const V=this.getCurrentRecord(),ce=this.extract(V,this.consumeTime);this.consumeSpaceForRecord(V);const ge=this.extract(V,this.consumeTime);return this.currentLine++,{startTime:ce,stopTime:ge}}parseBandWidth(){const V=[];for(;this.currentLine<this.records.length;){const ce=this.getCurrentRecord();if(ce.type!==E.BANDWIDTH)break;{const ge=this.extractOneOrMore(ce,N);if(ce.value[ce.cur]!==":")throw new Error("Invalid bandwidth field.");ce.cur++;const tt=this.extractOneOrMore(ce,w);V.push({bwtype:ge,bandwidth:tt}),this.currentLine++}}return V}parseVersion(){const V=this.getCurrentRecord();if(V.type!==E.VERSION)throw new Error("first sdp record must be version");const ce=V.value.slice(0,this.consumeOneOrMore(V.value,0,w));if(ce.length!==V.value.length)throw new Error('invalid proto version, "v='.concat(V.value,'"'));return this.currentLine++,ce}parseOrigin(){const V=this.getCurrentRecord();if(V.type!==E.ORIGIN)throw new Error("second line of sdp must be origin");const ce=this.extractOneOrMore(V,A);this.consumeSpaceForRecord(V);const ge=this.extractOneOrMore(V,w);this.consumeSpaceForRecord(V);const tt=this.extractOneOrMore(V,w);this.consumeSpaceForRecord(V);const un=this.extractOneOrMore(V,N);this.consumeSpaceForRecord(V);const Ir=this.extractOneOrMore(V,N);this.consumeSpaceForRecord(V);const zi=this.extract(V,this.consumeUnicastAddress);return this.currentLine++,{username:ce,sessId:ge,sessVersion:tt,nettype:un,addrtype:Ir,unicastAddress:zi}}parseSessionName(){const V=this.getCurrentRecord();if(V.type===E.SESSION_NAME){const ce=this.extract(V,this.consumeText);return this.currentLine++,ce}}parseInformation(){const V=this.getCurrentRecord();if(V.type!==E.INFORMATION)return;const ce=this.extract(V,this.consumeText);return this.currentLine++,ce}parseUri(){const V=this.getCurrentRecord();if(V.type===E.URI)return this.currentLine++,V.value}parseEmail(){const V=[];for(;;){const ce=this.getCurrentRecord();if(ce.type!==E.EMAIL)break;V.push(ce.value),this.currentLine++}return V}parsePhone(){const V=[];for(;;){const ce=this.getCurrentRecord();if(ce.type!==E.PHONE)break;V.push(ce.value),this.currentLine++}return V}parseConnection(){const V=this.getCurrentRecord();if(V.type===E.CONNECTION){const ce=this.extractOneOrMore(V,N);this.consumeSpaceForRecord(V);const ge=this.extractOneOrMore(V,N);this.consumeSpaceForRecord(V);const tt=this.extract(V,this.consumeAddress);return this.currentLine++,{nettype:ce,addrtype:ge,address:tt}}}parseMedia(){const V=this.getCurrentRecord(),ce=this.extract(V,this.consumeToken);this.consumeSpaceForRecord(V);let ge=this.extract(V,this.consumePort);V.value[V.cur]==="/"&&(V.cur+=1,ge+=this.extract(V,this.consumeInteger)),this.consumeSpaceForRecord(V);const tt=[];for(tt.push(this.extract(V,this.consumeToken));V.value[V.cur]==="/";)V.cur+=1,tt.push(this.extract(V,this.consumeToken));if(tt.length===0)throw new Error("Invalid proto");const un=this.parseFmt(V);return this.currentLine++,{mediaType:ce,port:ge,protos:tt,fmts:un}}parseTimeFields(){const V=[];for(;this.getCurrentRecord().type===E.TIME;){const ce=this.parseTime(),ge=this.parseRepeat(),tt=this.parseZone();V.push({time:ce,repeats:ge,zones:tt})}return V}parseMediaDescription(){const V=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.MEDIA;){const ce=this.parseMedia(),ge=this.parseInformation(),tt=this.parseConnections(),un=this.parseBandWidth(),Ir=this.parseKey(),zi=this.parseMediaAttributes(ce);V.push({media:ce,information:ge,connections:tt,bandwidths:un,key:Ir,attributes:zi})}return V}parseConnections(){const V=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.CONNECTION;)V.push(this.parseConnection());return V}parseFmt(V){const ce=[];for(;;)try{this.consumeSpaceForRecord(V),ce.push(this.extract(V,this.consumeToken))}catch{break}if(ce.length===0)throw new Error("Invalid fmts");return ce}extract(V,ce){for(var ge=arguments.length,tt=new Array(ge>2?ge-2:0),un=2;un<ge;un++)tt[un-2]=arguments[un];const Ir=ce.call(this,V.value,V.cur,...tt),zi=V.value.slice(V.cur,Ir);return V.cur=Ir,zi}extractOneOrMore(V,ce){const ge=this.consumeOneOrMore(V.value,V.cur,ce),tt=V.value.slice(V.cur,ge);return V.cur=ge,tt}consumeSpaceForRecord(V){if(V.value[V.cur]!==g)throw new Error("Invalid space at ".concat(V.cur,"."));V.cur+=1}}class Ze extends Ue{constructor(){super(...arguments),Ae(this,"attributes",void 0),Ae(this,"digested",!1)}extractOneOrMore(V,ce,ge){const tt=this.consumeOneOrMore(V.attValue,V._cur,ce),un=V.attValue.slice(V._cur,tt),[Ir,zi]=ge||[];if(typeof Ir=="number"&&un.length<Ir)throw new Error("error in length, should be more or equal than ".concat(Ir," characters."));if(typeof zi=="number"&&un.length>zi)throw new Error("error in length, should be less or equal than ".concat(zi," characters."));return V._cur=tt,un}consumeAttributeSpace(V){if(V.attValue[V._cur]!==g)throw new Error("Invalid space at ".concat(V._cur,"."));V._cur+=1}extract(V,ce){if(!V.attValue)throw new Error("Nothing to extract from attValue.");for(var ge=arguments.length,tt=new Array(ge>2?ge-2:0),un=2;un<ge;un++)tt[un-2]=arguments[un];const Ir=ce.call(this,V.attValue,V._cur,...tt),zi=V.attValue.slice(V._cur,Ir);return V._cur=Ir,zi}atEnd(V){if(!V.attValue)throw new Error;return V._cur>=V.attValue.length}peekChar(V){if(!V.attValue)throw new Error;return V.attValue[V._cur]}peek(V,ce){if(!V.attValue)throw new Error;for(let ge=0;ge<ce.length;ge++)if(ce[ge]!==V.attValue[V._cur+ge])return!1;return!0}parseIceUfrag(V){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(V,Z,[4,256])}parseIcePwd(V){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(V,Z,[22,256])}parseIceOptions(V){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ce=[];for(;!this.atEnd(V);){ce.push(this.extractOneOrMore(V,Z));try{this.consumeAttributeSpace(V)}catch(ge){if(this.atEnd(V))break;throw ge}}this.attributes.iceOptions=ce}parseFingerprint(V){const ce=this.extract(V,this.consumeToken);this.consumeAttributeSpace(V);const ge=this.extract(V,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ce,fingerprint:ge})}parseExtmap(V){const ce=this.extractOneOrMore(V,w);let ge;this.peekChar(V)==="/"&&(this.extract(V,this.consume,"/"),ge=this.extract(V,this.consumeToken)),this.consumeAttributeSpace(V);const tt=this.extract(V,this.consumeTill,g),un=ue(ue({entry:parseInt(ce,10)},ge&&{direction:ge}),{},{extensionName:tt});this.peekChar(V)===g&&(this.consumeAttributeSpace(V),un.extensionAttributes=this.extract(V,this.consumeTill)),this.attributes.extmaps.push(un)}parseSetup(V){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ce=this.extract(V,this.consumeTill);if(ce!=="active"&&ce!=="passive"&&ce!=="actpass"&&ce!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ce}}class _n extends Ze{constructor(){super(...arguments),Ae(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(V){if(this.digested)throw new Error("already digested");try{switch(V.attField){case"group":this.parseGroup(V);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(V);break;case"ice-pwd":this.parseIcePwd(V);break;case"ice-options":this.parseIceOptions(V);break;case"fingerprint":this.parseFingerprint(V);break;case"setup":this.parseSetup(V);break;case"tls-id":this.parseTlsId(V);break;case"identity":this.parseIdentity(V);break;case"extmap":this.parseExtmap(V);break;case"msid-semantic":this.parseMsidSemantic(V);break;default:V.ignored=!0,this.attributes.unrecognized.push(V)}}catch(ce){throw console.error("parsing session attribute ".concat(V.attField,' error, "a=').concat(V.attField,":").concat(V.attValue,'"')),ce}if(!V.ignored&&V.attValue&&!this.atEnd(V))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(V){const ce=this.extract(V,this.consumeToken),ge=[];for(;!this.atEnd(V)&&this.peekChar(V)===g;)this.consumeAttributeSpace(V),ge.push(this.extract(V,this.consumeToken));this.attributes.groups.push({semantic:ce,identificationTag:ge})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(V){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(V,ae)}parseIdentity(V){const ce=this.extractOneOrMore(V,ye),ge=[];for(;!this.atEnd(V)&&this.peekChar(V)===g;){this.consumeAttributeSpace(V);const tt=this.extract(V,this.consumeToken);this.extract(V,this.consume,"=");const un=this.extractOneOrMore(V,(Ir=>Ir!==g&&ee(Ir)));ge.push({name:tt,value:un})}this.attributes.identities.push({assertionValue:ce,extensions:ge})}parseMsidSemantic(V){this.peekChar(V)===g&&this.consumeAttributeSpace(V);const ce={semantic:this.extract(V,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(V)}catch{break}if(this.peekChar(V)==="*"){this.extract(V,this.consume,"*"),ce.applyForAll=!0;break}{const ge=this.extract(V,this.consumeTill,g);ce.identifierList.push(ge)}}this.attributes.msidSemantic=ce}}class Sn extends Ze{constructor(V){super(),Ae(this,"attributes",void 0),V.protos.indexOf("RTP")!==-1||V.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(V){if(this.digested)throw new Error("already digested");try{switch(V.attField){case"extmap":this.parseExtmap(V);break;case"setup":this.parseSetup(V);break;case"ice-ufrag":this.parseIceUfrag(V);break;case"ice-pwd":this.parseIcePwd(V);break;case"ice-options":this.parseIceOptions(V);break;case"candidate":this.parseCandidate(V);break;case"remote-candidate":this.parseRemoteCandidate(V);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(V);break;case"rtpmap":this.parseRtpmap(V);break;case"ptime":this.parsePtime(V);break;case"maxptime":this.parseMaxPtime(V);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(V);break;case"ssrc":this.parseSSRC(V);break;case"fmtp":this.parseFmtp(V);break;case"rtcp-fb":this.parseRtcpFb(V);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(V);break;case"mid":this.parseMid(V);break;case"msid":this.parseMsid(V);break;case"imageattr":this.parseImageAttr(V);break;case"rid":this.parseRid(V);break;case"simulcast":this.parseSimulcast(V);break;case"sctp-port":this.parseSctpPort(V);break;case"max-message-size":this.parseMaxMessageSize(V);break;case"ssrc-group":this.parseSSRCGroup(V);break;default:V.ignored=!0,this.attributes.unrecognized.push(V)}}catch(ce){throw console.error("parsing media attribute ".concat(V.attField,' error, "a=').concat(V.attField,":").concat(V.attValue,'"')),ce}if(!V.ignored&&V.attValue&&!this.atEnd(V))throw new Error("attribute parsing error")}parseCandidate(V){const ce=this.extractOneOrMore(V,Z,[1,32]);this.consumeAttributeSpace(V);const ge=this.extractOneOrMore(V,w,[1,5]);this.consumeAttributeSpace(V);const tt=this.extract(V,this.consumeToken);this.consumeAttributeSpace(V);const un=this.extractOneOrMore(V,w,[1,10]);this.consumeAttributeSpace(V);const Ir=this.extract(V,this.consumeAddress);this.consumeAttributeSpace(V);const zi=this.extract(V,this.consumePort);this.consumeAttributeSpace(V),this.extract(V,this.consume,"typ"),this.consumeAttributeSpace(V);const ou={foundation:ce,componentId:ge,transport:tt,priority:un,connectionAddress:Ir,port:zi,type:this.extract(V,this.consumeToken),extension:{}};for(this.peek(V," raddr")&&(this.extract(V,this.consume," raddr"),this.consumeAttributeSpace(V),ou.relAddr=this.extract(V,this.consumeAddress)),this.peek(V," rport")&&(this.extract(V,this.consume," rport"),this.consumeAttributeSpace(V),ou.relPort=this.extract(V,this.consumePort));this.peekChar(V)===g;){this.consumeAttributeSpace(V);const ed=this.extract(V,this.consumeToken);this.consumeAttributeSpace(V),ou.extension[ed]=this.extractOneOrMore(V,I)}this.attributes.candidates.push(ou)}parseRemoteCandidate(V){const ce=[];for(;;){const ge=this.extractOneOrMore(V,w,[1,5]);this.consumeAttributeSpace(V);const tt=this.extract(V,this.consumeAddress);this.consumeAttributeSpace(V);const un=this.extract(V,this.consumePort);ce.push({componentId:ge,connectionAddress:tt,port:un});try{this.consumeAttributeSpace(V)}catch{break}}this.attributes.remoteCandidatesList.push(ce)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(V){const ce=this.extract(V,this.consumeToken);this.consumeAttributeSpace(V);const ge=this.extract(V,this.consumeTill,"/");this.extract(V,this.consume,"/");const tt={encodingName:ge,clockRate:this.extractOneOrMore(V,w)};this.atEnd(V)||this.peekChar(V)!=="/"||(this.extract(V,this.consume,"/"),tt.encodingParameters=parseInt(this.extract(V,this.consumeTill),10));const un=this.attributes.payloads.find((Ir=>Ir.payloadType===parseInt(ce,10)));un?un.rtpMap=tt:this.attributes.payloads.push({payloadType:parseInt(ce,10),rtpMap:tt,rtcpFeedbacks:[]})}parsePtime(V){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(V,this.consumeTill)}parseMaxPtime(V){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(V,this.consumeTill)}parseDirection(V){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=V.attField}parseSSRC(V){const ce=this.extractOneOrMore(V,w);this.consumeAttributeSpace(V);const ge=this.extract(V,this.consumeTill,":");let tt;this.peekChar(V)===":"&&(this.extract(V,this.consume,":"),tt=this.extract(V,this.consumeTill));const un=this.attributes.ssrcs.find((Ir=>Ir.ssrcId===parseInt(ce,10)));un?un.attributes[ge]=tt:this.attributes.ssrcs.push({ssrcId:parseInt(ce,10),attributes:{[ge]:tt}})}parseFmtp(V){const ce=this.extract(V,this.consumeTill,g);this.consumeAttributeSpace(V);const ge=this.extract(V,this.consumeTill),tt={};ge.split(";").forEach((Ir=>{let[zi,ou]=Ir.split("=");zi=jo(zi).call(zi);const ed=typeof ou=="string"?jo(ou).call(ou):null;typeof zi=="string"&&zi.length>0&&(tt[zi]=ed)}));const un=this.attributes.payloads.find((Ir=>Ir.payloadType===parseInt(ce,10)));un?un.fmtp={parameters:tt}:this.attributes.payloads.push({payloadType:parseInt(ce,10),rtcpFeedbacks:[],fmtp:{parameters:tt}})}parseFmtParameters(V){const ce={},ge=this.extract(V,this.consumeTill,"=");V._cur++;const tt=this.extract(V,this.consumeTill,";");for(ce[ge]=tt;V.attValue[V._cur]===";";){const un=this.extract(V,this.consumeTill,"=");V._cur++;const Ir=this.extract(V,this.consumeTill,";");ce[un]=Ir}return ce}parseRtcpFb(V){let ce="";ce=this.peekChar(V)==="*"?this.extract(V,this.consume,"*"):this.extract(V,this.consumeTill,g),this.consumeAttributeSpace(V);const ge=this.extract(V,this.consumeTill,g);let tt;if(ge==="trr-int")tt={type:ge,interval:this.extract(V,this.consumeTill)};else{const un={type:ge};this.peekChar(V)===g&&(this.consumeAttributeSpace(V),un.parameter=this.extract(V,this.consumeToken),this.peekChar(V)===g&&(un.additional=this.extract(V,this.consumeTill))),tt=un}if(ce==="*")this.attributes.rtcpFeedbackWildcards.push(tt);else{const un=this.attributes.payloads.find((Ir=>Ir.payloadType===parseInt(ce,10)));un?un.rtcpFeedbacks.push(tt):this.attributes.payloads.push({payloadType:parseInt(ce,10),rtcpFeedbacks:[tt]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(V){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ce={port:this.extract(V,this.consumePort)};this.peekChar(V)===g&&(this.consumeAttributeSpace(V),ce.netType=this.extractOneOrMore(V,N),this.consumeAttributeSpace(V),ce.addressType=this.extractOneOrMore(V,N),this.consumeAttributeSpace(V),ce.address=this.extract(V,this.consumeAddress)),this.attributes.rtcp=ce}parseMsid(V){const ce={id:this.extractOneOrMore(V,N,[1,64])};this.peekChar(V)===g&&(this.consumeAttributeSpace(V),ce.appdata=this.extractOneOrMore(V,N,[1,64])),this.attributes.msids.push(ce)}parseImageAttr(V){this.attributes.imageattr.push(V.attValue)}parseRid(V){const ce=this.extractOneOrMore(V,(tt=>F(tt)||w(tt)||tt==="_"||tt==="-"));this.consumeAttributeSpace(V);const ge={id:ce,direction:this.extract(V,this.consumeToken),params:[]};if(this.peekChar(V)===g){if(this.consumeAttributeSpace(V),this.peek(V,"pt=")){this.extract(V,this.consume,"pt=");const tt=[];for(;;){const un=this.extract(V,this.consumeToken);tt.push(un);try{this.extract(V,this.consume,",")}catch{break}}ge.payloads=tt,this.peekChar(V)===g&&this.extract(V,this.consume,g)}for(;;){const tt=this.extract(V,this.consumeToken);switch(tt){case"depend":{const un={type:tt,rids:this.extract(V,this.consume,"=").split(",")};ge.params.push(un);break}default:{const un={type:tt};this.peekChar(V)==="="&&(this.extract(V,this.consume,"="),un.val=this.extract(V,this.consumeTill,";")),ge.params.push(un)}}try{this.extract(V,this.consume,";")}catch{break}}}this.attributes.rids.push(ge)}parseSimulcast(V){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=V.attValue,this.extract(V,this.consumeTill)}parseSctpPort(V){this.attributes.sctpPort=this.extractOneOrMore(V,w,[1,5])}parseMaxMessageSize(V){this.attributes.maxMessageSize=this.extractOneOrMore(V,w,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(V){this.attributes.mid=this.extract(V,this.consumeToken)}parseSSRCGroup(V){const ce=this.extract(V,this.consumeToken),ge=[];for(;;)try{this.consumeAttributeSpace(V);const tt=this.extract(V,this.consumeInteger);ge.push(parseInt(tt,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ce,ssrcIds:ge})}}function Qt(He,V,ce){return V in He?Object.defineProperty(He,V,{value:ce,enumerable:!0,configurable:!0,writable:!0}):He[V]=ce,He}class rr{constructor(){Qt(this,"eol",m)}print(V,ce){let ge="";return ce&&(this.eol=ce),ge+=this.printVersion(V.version),ge+=this.printOrigin(V.origin),ge+=this.printSessionName(V.sessionName),ge+=this.printInformation(V.information),ge+=this.printUri(V.uri),ge+=this.printEmail(V.emails),ge+=this.printPhone(V.phones),ge+=this.printConnection(V.connection),ge+=this.printBandwidth(V.bandwidths),ge+=this.printTimeFields(V.timeFields),ge+=this.printKey(V.key),ge+=this.printSessionAttributes(V.attributes),ge+=this.printMediaDescription(V.mediaDescriptions),ge}printVersion(V){return"v=".concat(V).concat(this.eol)}printOrigin(V){return"o=".concat(V.username," ").concat(V.sessId," ").concat(V.sessVersion," ").concat(V.nettype," ").concat(V.addrtype," ").concat(V.unicastAddress).concat(this.eol)}printSessionName(V){return V?"s=".concat(V).concat(this.eol):""}printInformation(V){return V?"i=".concat(V).concat(this.eol):""}printUri(V){return V?"u=".concat(V).concat(this.eol):""}printEmail(V){let ce="";for(const ge of V)ce+="e=".concat(ge).concat(this.eol);return ce}printPhone(V){let ce="";for(const ge of V)ce+="e=".concat(ge).concat(this.eol);return ce}printConnection(V){return V?"c=".concat(V.nettype," ").concat(V.addrtype," ").concat(V.address).concat(this.eol):""}printBandwidth(V){let ce="";for(const ge of V)ce+="b=".concat(ge.bwtype,":").concat(ge.bandwidth).concat(this.eol);return ce}printTimeFields(V){let ce="";for(const ge of V){ce+="t=".concat(ge.time.startTime," ").concat(ge.time.startTime).concat(this.eol);for(const tt of ge.repeats)ce+="r=".concat(tt.repeatInterval," ").concat(tt.typedTimes.join(" ")).concat(this.eol);ge.zoneAdjustments&&(ce+="z=",ce+="z=".concat(ge.zoneAdjustments.map((tt=>"".concat(tt.time," ").concat(tt.back?"-":""," ").concat(tt.typedTime))).join(" ")).concat(this.eol),ce+=this.eol)}return ce}printKey(V){return V?"k=".concat(V).concat(this.eol):""}printAttributes(V){let ce="";for(const ge of V)ce+="a=".concat(ge.attField).concat(ge.attValue?":".concat(ge.attValue):"").concat(this.eol);return ce}printMediaDescription(V){let ce="";for(const ge of V)ce+=this.printMedia(ge.media),ce+=this.printInformation(ge.information),ce+=this.printConnections(ge.connections),ce+=this.printBandwidth(ge.bandwidths),ce+=this.printKey(ge.key),ce+=this.printMediaAttributes(ge);return ce}printConnections(V){let ce="";for(const ge of V)ce+=this.printConnection(ge);return ce}printMedia(V){return"m=".concat(V.mediaType," ").concat(V.port," ").concat(V.protos.join("/")," ").concat(V.fmts.join(" ")).concat(this.eol)}printSessionAttributes(V){return new co(this.eol).print(V)}printMediaAttributes(V){return new ze(this.eol).print(V)}}class Jn{constructor(V){Qt(this,"eol",void 0),this.eol=V}printIceUfrag(V){return V===void 0?"":"a=ice-ufrag:".concat(V).concat(this.eol)}printIcePwd(V){return V===void 0?"":"a=ice-pwd:".concat(V).concat(this.eol)}printIceOptions(V){return V===void 0?"":"a=ice-options:".concat(V.join(g)).concat(this.eol)}printFingerprints(V){return V.length>0?V.map((ce=>"a=fingerprint:".concat(ce.hashFunction).concat(g).concat(ce.fingerprint))).join(this.eol)+this.eol:""}printExtmap(V){return V.map((ce=>"a=extmap:".concat(ce.entry).concat(ce.direction?"/".concat(ce.direction):"").concat(g).concat(ce.extensionName).concat(ce.extensionAttributes?"".concat(g).concat(ce.extensionAttributes):"").concat(this.eol))).join("")}printSetup(V){return V===void 0?"":"a=setup:".concat(V).concat(this.eol)}printUnrecognized(V){return V.map((ce=>"a=".concat(ce.attField).concat(ce.attValue?":".concat(ce.attValue):"").concat(this.eol))).join("")}}class co extends Jn{print(V){let ce="";return ce+=this.printGroups(V.groups),ce+=this.printMsidSemantic(V.msidSemantic),ce+=this.printIceLite(V.iceLite),ce+=this.printIceUfrag(V.iceUfrag),ce+=this.printIcePwd(V.icePwd),ce+=this.printIceOptions(V.iceOptions),ce+=this.printFingerprints(V.fingerprints),ce+=this.printSetup(V.setup),ce+=this.printTlsId(V.tlsId),ce+=this.printIdentity(V.identities),ce+=this.printExtmap(V.extmaps),ce+=this.printUnrecognized(V.unrecognized),ce}printGroups(V){let ce="";return V.length>0&&(ce+=V.map((ge=>"a=group:".concat(ge.semantic).concat(ge.identificationTag.map((tt=>"".concat(g).concat(tt))).join("")).concat(this.eol))).join("")),ce}printIceLite(V){return V===void 0?"":"a=ice-lite"+this.eol}printTlsId(V){return V?"a=tls-id:".concat(V).concat(this.eol):""}printIdentity(V){return V.length===0?"":V.map((ce=>"a=identity:".concat(ce.assertionValue).concat(ce.extensions.map((ge=>"".concat(g).concat(ge.name).concat(ge.value?"=".concat(ge.value):"")))))).join(this.eol)+this.eol}printMsidSemantic(V){if(!V)return"";let ce="a=msid-semantic:".concat(V.semantic);return V.applyForAll?ce+="".concat(g,"*"):V.identifierList.length>0&&(ce+=V.identifierList.map((ge=>"".concat(g).concat(ge)))),ce+this.eol}}class ze extends Jn{print(V){const ce=V.attributes;let ge="";return ge+=this.printRTCP(ce.rtcp),ge+=this.printIceUfrag(ce.iceUfrag),ge+=this.printIcePwd(ce.icePwd),ge+=this.printIceOptions(ce.iceOptions),ge+=this.printCandidates(ce.candidates),ge+=this.printRemoteCandidatesList(ce.remoteCandidatesList),ge+=this.printEndOfCandidates(ce.endOfCandidates),ge+=this.printFingerprints(ce.fingerprints),ge+=this.printSetup(ce.setup),ge+=this.printMid(ce.mid),ge+=this.printExtmap(ce.extmaps),ge+=this.printRTPRelated(ce),ge+=this.printPtime(ce.ptime),ge+=this.printMaxPtime(ce.maxPtime),ge+=this.printDirection(ce.direction),ge+=this.printSSRCGroups(ce.ssrcGroups),ge+=this.printSSRC(ce.ssrcs),ge+=this.printRTCPMux(ce.rtcpMux),ge+=this.printRTCPMuxOnly(ce.rtcpMuxOnly),ge+=this.printRTCPRsize(ce.rtcpRsize),ge+=this.printMSId(ce.msids),ge+=this.printImageattr(ce.imageattr),ge+=this.printRid(ce.rids),ge+=this.printSimulcast(ce.simulcast),ge+=this.printSCTPPort(ce.sctpPort),ge+=this.printMaxMessageSize(ce.maxMessageSize),ge+=this.printUnrecognized(ce.unrecognized),ge}printCandidates(V){return V.map((ce=>"a=candidate:".concat(ce.foundation).concat(g).concat(ce.componentId).concat(g).concat(ce.transport).concat(g).concat(ce.priority).concat(g).concat(ce.connectionAddress).concat(g).concat(ce.port).concat(g,"typ").concat(g).concat(ce.type).concat(ce.relAddr?"".concat(g,"raddr").concat(g).concat(ce.relAddr):"").concat(ce.relPort?"".concat(g,"rport").concat(g).concat(ce.relPort):"").concat(Object.keys(ce.extension).map((ge=>"".concat(g).concat(ge).concat(g).concat(ce.extension[ge]))).join("")).concat(this.eol))).join("")}printRemoteCandidatesList(V){return V.map((ce=>"a=remote-candidates:".concat(ce.join(g)).concat(this.eol))).join("")}printEndOfCandidates(V){return V===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(V){if(!V.payloads)return"";const ce=V.payloads;let ge="";ge+=V.rtcpFeedbackWildcards.map((tt=>this.printRTCPFeedback("*",tt))).join("");for(const tt of ce)ge+=this.printRtpMap(tt.payloadType,tt.rtpMap),ge+=this.printFmtp(tt.payloadType,tt.fmtp),ge+=tt.rtcpFeedbacks.map((un=>this.printRTCPFeedback(tt.payloadType,un))).join("");return ge}printFmtp(V,ce){if(!ce)return"";const ge=Object.keys(ce.parameters);return ge.length===1&&ce.parameters[ge[0]]===null?"a=fmtp:".concat(V).concat(g).concat(ge[0]).concat(this.eol):"a=fmtp:".concat(V).concat(g).concat(Object.keys(ce.parameters).map((tt=>"".concat(tt,"=").concat(ce.parameters[tt]))).join(";")).concat(this.eol)}printRtpMap(V,ce){return ce?"a=rtpmap:".concat(V).concat(g).concat(ce.encodingName,"/").concat(ce.clockRate).concat(ce.encodingParameters?"/".concat(ce.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(V,ce){let ge="a=rtcp-fb:".concat(V).concat(g),tt=ce;return tt.type==="trr-int"?ge+="ttr-int".concat(g).concat(tt.interval):(ge+="".concat(tt.type),tt.parameter&&(ge+="".concat(g).concat(tt.parameter),tt.additional&&(ge+="".concat(g).concat(tt.additional)))),ge+this.eol}printPtime(V){return V===void 0?"":"a=ptime:".concat(V).concat(this.eol)}printMaxPtime(V){return V===void 0?"":"a=maxptime:".concat(V).concat(this.eol)}printDirection(V){return V===void 0?"":"a=".concat(V).concat(this.eol)}printSSRC(V){return V.map((ce=>Object.keys(ce.attributes).map((ge=>"a=ssrc:".concat(ce.ssrcId.toString(10)).concat(g).concat(ge).concat(ce.attributes[ge]?":".concat(ce.attributes[ge]):"").concat(this.eol))).join(""))).join("")}printRTCPMux(V){return V===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(V){return V===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(V){return V===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(V){if(V===void 0)return"";let ce="a=rtcp:".concat(V.port);return V.netType&&(ce+="".concat(g).concat(V.netType)),V.addressType&&(ce+="".concat(g).concat(V.addressType)),V.address&&(ce+="".concat(g).concat(V.address)),ce+this.eol}printMSId(V){return V.map((ce=>"a=msid:".concat(ce.id).concat(ce.appdata?"".concat(g).concat(ce.appdata):"").concat(this.eol))).join("")}printImageattr(V){return V.map((ce=>"a=imageattr:".concat(ce).concat(this.eol))).join("")}printRid(V){return V.map((ce=>{let ge="a=rid:".concat(ce.id).concat(g).concat(ce.direction);return ce.payloads&&(ge+="".concat(g,"pt=").concat(ce.payloads.join(","))),ce.params.length>0&&(ge+="".concat(g).concat(ce.params.map((tt=>tt.type==="depend"?"depend=".concat(tt.rids.join(",")):"".concat(tt.type,"=").concat(tt.val))).join(";"))),ge+this.eol})).join("")}printSimulcast(V){return V===void 0?"":"a=simulcast:".concat(V).concat(this.eol)}printSCTPPort(V){return V===void 0?"":"a=sctp-port:".concat(V).concat(this.eol)}printMaxMessageSize(V){return V===void 0?"":"a=max-message-size:".concat(V).concat(this.eol)}printMid(V){return V===void 0?"":"a=mid:".concat(V).concat(this.eol)}printSSRCGroups(V){return V.map((ce=>"a=ssrc-group:".concat(ce.semantic).concat(ce.ssrcIds.map((ge=>"".concat(g).concat(ge.toString(10)))).join("")).concat(this.eol))).join("")}}function ot(He){return new We().parse(He)}function bt(He,V){return new rr().print(He,V)}}},r={};function s(a){if(r[a])return r[a].exports;var c=r[a]={exports:{}};return t[a](c,c.exports,s),c.exports}return s.d=(a,c)=>{for(var d in c)s.o(c,d)&&!s.o(a,d)&&Object.defineProperty(a,d,{enumerable:!0,get:c[d]})},s.o=(a,c)=>Object.prototype.hasOwnProperty.call(a,c),s.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},s(8)})();function tc(t){return S9.parse(t)}function Km(t,r){return S9.print(t,r)}var Eme=Sc("Array","keys"),vme=Td,Sme=Mr,bme=O,wme=Eme,WL=Array.prototype,Tme={DOMTokenList:!0,NodeList:!0},Cme=function(t){var r=t.keys;return t===WL||bme(WL,t)&&r===WL.keys||Sme(Tme,vme(t))?wme:r},nc=l(Cme);function ii(t,r,s){return(r=(function(a){var c=(function(d,h){if(typeof d!="object"||!d)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var g=m.call(d,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)})(a);return typeof c=="symbol"?c:c+""})(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function b9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function mn(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?b9(Object(s),!0).forEach((function(a){ii(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):b9(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}const w9=new class extends Qr{constructor(){super(...arguments),ii(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:r}=t;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class Rme{constructor(r){ii(this,"logger",void 0),ii(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.debug(...this.prefixLists,...s)}info(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.info(...this.prefixLists,...s)}warning(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.warning(...this.prefixLists,...s)}error(){for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];this.logger.error(...this.prefixLists,...s)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function GL(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function T9(){const t=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const Ql={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},v1=Date.now(),iT=t=>{for(const r in Ql)if(Object.prototype.hasOwnProperty.call(Ql,r)&&Ql[r]===t)return r;return"DEFAULT"},M=new class{constructor(){ii(this,"proxyServerURL",void 0),ii(this,"logLevel",Ql.DEBUG),ii(this,"uploadState","collecting"),ii(this,"uploadLogWaitingList",[]),ii(this,"uploadLogUploadingList",[]),ii(this,"uploadErrorCount",0),ii(this,"currentLogID",0),ii(this,"url",void 0),ii(this,"extLog",((t,r)=>{this.appendLogToWaitingList(t,...r)}))}debug(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Ql.DEBUG].concat(r);this.log.apply(this,a)}info(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Ql.INFO].concat(r);this.log.apply(this,a)}warning(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Ql.WARNING].concat(r);this.log.apply(this,a)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Ql.ERROR].concat(r);this.log.apply(this,a)}upload(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];const a=[Ql.DEBUG].concat(r);this.uploadLog.apply(this,a)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){mr("UPLOAD_LOG",!0)}disableLogUpload(){mr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new Rme(this).prefix(t)}log(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-v1<100)return void setTimeout((()=>{this.log(...r)}),Date.now()-v1);const a=Math.max(0,Math.min(4,r[0]));if(r[0]=GL()+" Agora-SDK [".concat(iT(a),"]:"),this.appendLogToWaitingList(a,...r),a<this.logLevel)return;const c=GL()+" %cAgora-SDK [".concat(iT(a),"]:");let d=[];if(!oe("USE_NEW_LOG"))switch(a){case Ql.DEBUG:d=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,d);break;case Ql.INFO:d=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,d);break;case Ql.WARNING:d=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,d);break;case Ql.ERROR:d=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,d)}}uploadLog(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];if(Date.now()-v1<100)return void setTimeout((()=>{this.uploadLog(...r)}),Date.now()-v1);const a=Math.max(0,Math.min(4,r[0]));r[0]=GL()+" Agora-SDK [".concat(iT(a),"]:"),this.appendLogToWaitingList(a,...r)}appendLogToWaitingList(t){if(!oe("UPLOAD_LOG"))return;for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];Array.isArray(s[0])?s[0][0]=T9()+" Agora-SDK [".concat(iT(t),"]:"):s[0]=T9()+" Agora-SDK [".concat(iT(t),"]:");let c="";s.forEach((d=>{typeof d=="object"&&(d=JSON.stringify(d)),c+="".concat(d," ")})),this.uploadLogWaitingList.push({payload_str:c,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,r={sdk_version:Jl,process_id:oe("PROCESS_ID"),payload:JSON.stringify(t)};return Kd((async()=>{const s=await ka.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(oe("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(oe("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(s.data!=="OK"){const a=new Error("unexpected upload log response");throw a.response=s,a}}),(()=>(this.uploadLogUploadingList=[],!1)),(s=>{const a={status:-1,message:s.message,errorRange:t.map((c=>c.log_item_id))};return s.response?(a.status=s.response.status,a.data=s.response.data,a.headers=s.response.headers):s.request&&(a.status=s.request.status),w9.reportLogUploadError(a),!0}),{timeout:oe("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:oe("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,oe("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout((()=>this.uploadLogInterval()),oe("UPLOAD_LOG_INTERVAL"))})).catch((t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout((()=>this.uploadLogInterval()),oe("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((()=>this.uploadLogInterval()),oe("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))}};var C9;function Ime(t){return Ss(t.reportId,"params.reportId",0,100,!1),Ss(t.category,"params.category",0,100,!1),Ss(t.event,"params.event",0,100,!1),Ss(t.label,"params.label",0,100,!1),vr(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(C9={}).FREE="free",C9.UPLOADING="uploading",(function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"})({});const Ame={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Xi=(function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t.AB_TEST="ab_test",t})({}),jr=(function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t.AB_TEST="io.agora.pb.Wrtc.ABTest",t})({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Pme=(function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t})({});function Wt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,s,a){const c=a.value;if(typeof c=="function"){const d=t.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);a.value=function(){for(var h,m=arguments.length,g=new Array(m),E=0;E<m;E++)g[E]=arguments[E];let w=g;if(t.argsMap)try{w=t.argsMap(this,...g)}catch(A){M.warning(A),w=[]}try{JSON.stringify(w)}catch{M.warning("arguments for method ".concat(d,".").concat(String(s)," not serializable for apiInvoke.")),w=[]}const I=(t.report||It).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(d,".").concat(String(s)),options:w,tag:Hr.TRACER,reportResult:t.reportResult},t.throttleTime);try{const A=c.apply(this,g);return A instanceof mt?A.then((N=>(I.onSuccess(t.reportResult&&N),N))).catch((N=>{throw I.onError(N),N})):(I.onSuccess(t.reportResult&&A),A)}catch(A){throw I.onError(A),A}}}return a}}const It=new class{constructor(){ii(this,"baseInfoMap",new Map),ii(this,"proxyServer",void 0),ii(this,"eventUploadTimer",void 0),ii(this,"setSessionIdTimer",void 0),ii(this,"url",void 0),ii(this,"sids",new Set),ii(this,"backupUrl",void 0),ii(this,"_appId",void 0),ii(this,"_aid",0),ii(this,"keyEventUploadPendingItems",[]),ii(this,"normalEventUploadPendingItems",[]),ii(this,"apiInvokeUploadPendingItems",[]),ii(this,"apiInvokeCount",0),ii(this,"apiInvokeLoggedCount",0),ii(this,"ltsList",[]),ii(this,"lastSendNormalEventTime",Date.now()),ii(this,"customReportCounterTimer",void 0),ii(this,"customReportCount",0),ii(this,"extApiInvoke",(async t=>{for(const r of t){const s=mn(mn({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Hr.TRACER});this.sendApiInvoke(s)}})),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),oe("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),oe("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}setAppId(t){this._appId=t,this._aid=parseInt(t.replace(/[a-fA-F0-9]{8}/g,(r=>{let[s,a]=r;return s+a})),16)||0}reportApiInvoke(t,r,s){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const a=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,d=!!oe("SHOW_REPORT_INVOKER_LOG"),h=!!oe("SHOW_REPORT_USER_INVOKER_LOG"),m=d||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const g=this.apiInvokeLoggedCount;function E(N,G){if(m){let F="[apiInvoke-".concat(g,"]");if(r.id&&(F+="[".concat(r.id,"]")),r.name&&(F+="[".concat(r.name,"]"),r.name===di.JOIN))return M.info("".concat(F," ").concat(N));M.info("".concat(F," ").concat(N),N==="start"?r.options:G||"")}}const w=()=>({tag:r.tag,invokeId:c,sid:t,name:r.name,apiInvokeTime:a,options:r.options,states:r.states||null});E("start");let I=!1;bs(r.timeout).then((()=>{I||(this.sendApiInvoke(mn(mn({},w()),{},{error:te.API_INVOKE_TIMEOUT,success:!1})),E("timeout"))}));const A=new Le(te.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:N=>{const G=()=>{if(I)throw A;return I=!0,this.sendApiInvoke(mn(mn({},w()),{},{success:!0},r.reportResult&&{result:N})),E("onSuccess"),N};return s?i9(G,r.name+"Success",s,(()=>I=!0)):G()},onError:N=>{const G=()=>{if(I)throw N;I=!0,this.sendApiInvoke(mn(mn({},w()),{},{success:!1,error:N})),E("onFailure",N.toString())};return s?i9(G,r.name+"Error",s,(()=>I=!0)):G()}}}sessionInit(t,r){if(this.baseInfoMap.has(t))return;const s=Date.now(),a=this.createBaseInfo(t,s);a.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:oe("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:jL?"global":"oversea",areas:oe("AREAS")&&oe("AREAS").join(",")},r.extend),{stringUid:d,channelProfile:h,channelMode:m,isABTestSuccess:g,lsid:E,clientRole:w}=r,I=Date.now(),A=mn(mn({},a),{},{eventType:Xi.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:BL,lts:I,elapse:I-s,extend:JSON.stringify(c),mode:r.mode,process:oe("PROCESS_ID"),appType:oe("APP_TYPE"),success:!0,version:Jl,stringUid:d,channelProfile:h,channelMode:m,isABTestSuccess:g,lsid:E,clientType:rt(N=window.navigator.userAgent).call(N,"AgoraWebView")?42:20,clientRole:w,serviceId:oe("PROCESS_ID"),extensionID:oe("PLUGIN_INFO").join(",")||""});var N;this.send({type:jr.SESSION,data:A},!0)}joinChooseServer(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn({},a),{},{role:r.role,eventType:Xi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-s.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0,resourceTimingInfo:r.resourceTimingInfo||void 0});this.send({type:jr.JOIN_CHOOSE_SERVER,data:d},!0)}reqUserAccount(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn({},a),{},{eventType:Xi.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-s.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:jr.REQ_USER_ACCOUNT,data:d},!0)}joinGateway(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info;r.vid&&(a.vid=r.vid),a.uid=r.uid,a.cid=r.cid;const c=Date.now(),{firstSuccess:d,addr:h,isProxy:m}=r,g=c-s.startTime,E=mn(mn({},a),{},{eventType:Xi.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:g,eventElapse:c-r.lts,firstSuccess:d,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:VL(),isABTestSuccess:r.isABTestSuccess?1:0}),w=E.success?1:0;if(r.succ&&(s.lastJoinSuccessTime=c),d)this.send({type:jr.JOIN_GATEWAY,data:E},!0);else{let I;if(h)if(m){const N=h.match(/h=(\d{1,3}-){3}\d{1,3}/g),G=h.match(/p=[0-9]{1,6}/g);I={isSuccess:w,gatewayIp:N&&N.length?N[0].split("=")[1].replace(/-/g,"."):"",port:G&&G.length?G[0].split("=")[1]:"",isProxy:m?1:0}}else{const N=h.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),G=h.match(/(:|p=)[0-9]{1,6}/g);I={isSuccess:w,gatewayIp:N&&N.length?N[0].split("//")[1].replace(/-/g,"."):"",port:G&&G.length?G[0].split(/:|p=/g)[1]:"",isProxy:m?1:0}}else I={isSuccess:w,gatewayIp:"",port:"",isProxy:m?1:0};delete E.success,delete E.eventType,delete E.firstSuccess,E.vid=Number(E.vid);const A=Object.assign({},E,I,{eventType:Xi.REJOIN_GATEWAY});this.send({type:jr.RE_JOIN_GATEWAY,data:A},!0)}}joinChannelTimeout(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=Date.now(),c=mn(mn({},s.info),{},{lts:a,timeout:r,elapse:a-s.startTime});this.send({type:jr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn({},a),{},{eventType:Xi.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-s.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:jr.PUBLISH,data:d},!0)}subscribe(t,r,s){const a=this.baseInfoMap.get(t);if(!a)return;const c=a.info,d=Date.now(),h=mn(mn({},c),{},{eventType:Xi.SUBSCRIBE,lts:d,eventElapse:r.eventElapse,elapse:d-a.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:jr.SUBSCRIBE,data:h},!0)}wsCompressorInit(t){var r;const s=[...nc(r=this.baseInfoMap).call(r)],a=s.length?s[0]:"UnableToGetSid",c=this.baseInfoMap.get(a);if(!c)return;const d=c.info,h=Date.now(),m=mn(mn({},d),{},{eventType:Xi.WS_COMPRESSOR_INIT,lts:h,eventElapse:t.eventElapse,elapse:h-c.startTime,status:t.status?1:2});this.send({type:jr.WS_COMPRESSOR_INIT,data:m},!0)}firstXLAPeerFirstVideoFrame(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=r.peerPubStatusMs-(s.lastJoinSuccessTime||c),h=mn(mn({},a),{},{elapse:c-s.startTime,eventType:Xi.XLA_PEER_FIRST_VIDEO_FRAME,lts:c,peer:r.peer,width:r.width,height:r.height,ssrc:r.ssrc,p2pid:r.p2pid,peerPublishDuration:r.peerPublishDuration,joinChannelSuccessElapse:d,peerPubStatusMs:r.peerPubStatusMs-r.joinChannelStart,availablePublish:r.peerPublishDuration>d?1:0,preloadStart:Math.max(r.preloadStart-r.joinChannelStart,0),preloadEnd:Math.max(r.preloadEnd-r.joinChannelStart,0),encrypt:Math.max(r.apStart-r.joinChannelStart,0),ap:Math.max(r.apEnd-r.joinChannelStart,0),sua:Math.max(r.suaEnd-r.joinChannelStart,0),beforeConnect:Math.max(r.beforeConnect-r.joinChannelStart,0),peerRecevier:Math.max(r.peerReceiver-r.joinChannelStart,0),ice:Math.max(r.ice-r.joinChannelStart,0),pc:Math.max(r.pc-r.joinChannelStart,0),signalConnected:Math.max(r.signalConnected-r.joinChannelStart,0),joinReq:Math.max(r.joinReq-r.joinChannelStart,0),joinRes:Math.max(r.joinRes-r.joinChannelStart,0),userJoinNotify:Math.max(r.userJoinNotify-r.joinChannelStart,0),videoSsrcNotify:Math.max(r.videoAddNotify-r.joinChannelStart,0),subscribeDelayMs:Math.max(r.subscribeStart-r.videoAddNotify,0),subscribeStart:Math.max(r.subscribeStart-r.joinChannelStart,0),subscribeEnd:Math.max(r.subscribeEnd-r.joinChannelStart,0),firstReceived:Math.max(r.firstReceived-r.joinChannelStart,0),firstDecoded:Math.max(r.firstDecoded-r.joinChannelStart,0),firstPreRender:Math.max(r.firstPreRender-r.joinChannelStart,0),firstRender:Math.max(r.firstRender-r.joinChannelStart,0),playDelayMs:Math.max(r.playStart-r.subscribeEnd,0),playStart:Math.max(r.playStart-r.joinChannelStart,0),playEnd:Math.max(r.playEnd-r.joinChannelStart,0),isPreSub:r.isPreSub?1:0,isPrePc:r.isPrePc?1:0,isPreInstantVideo:r.isPreInstantVideo?1:0});this.send({type:jr.XLA_PEER_FIRST_VIDEO_FRAME,data:h},!0)}firstRemoteVideoDecode(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=mn(mn(mn({},d),a),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((a.firstFrame||h)-c.startTime,0),apEnd:Math.max(a.apEnd-c.startTime,0),apStart:Math.max(a.apStart-c.startTime,0),joinGwEnd:Math.max(a.joinGwEnd-c.startTime,0),joinGwStart:Math.max(a.joinGwStart-c.startTime,0),pcEnd:Math.max(a.pcEnd-c.startTime,0),pcStart:Math.max(a.pcStart-c.startTime,0),subscriberEnd:Math.max(a.subscriberEnd-c.startTime,0),subscriberStart:Math.max(a.subscriberStart-c.startTime,0),videoAddNotify:Math.max(a.videoAddNotify-c.startTime,0)});this.send({type:s,data:m},!0)}firstRemoteFrame(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=mn(mn(mn({},d),a),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:s,data:m},!0)}abTest(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn(mn({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-s.startTime,eventType:Xi.AB_TEST,lts:c});this.send({type:jr.AB_TEST,data:d},!0)}pcStats(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn(mn({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),elapse:c-s.startTime,eventType:Xi.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:jr.PC_STATS,data:d},!0)}updateRemoteRTPCapabilities(t,r){if(t){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn(mn({},a),r),{},{vid:a.vid===void 0?0:Number(a.vid),eventType:Xi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:jr.UPDATE_REMOTE_RTPCAPABILITIES,data:d},!0)}}onGatewayStream(t,r,s,a){const c=this.baseInfoMap.get(t);if(!c)return;const d=c.info,h=Date.now(),m=mn(mn(mn({},d),a),{},{eventType:r,lts:h});this.send({type:s,data:m},!0)}streamSwitch(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn({},a),{},{eventType:Xi.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-s.startTime,success:r.succ});this.send({type:jr.STREAM_SWITCH,data:d},!0)}requestProxyAppCenter(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn({},a),{},{eventType:Xi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:jr.REQUEST_PROXY_APPCENTER,data:d},!0)}requestProxyWorkerManager(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn({},a),{},{eventType:Xi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:jr.REQUEST_PROXY_WORKER_MANAGER,data:d},!0)}setProxyServer(t){this.proxyServer=t,t?M.debug("reportProxyServerurl: ".concat(t)):M.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn({},a),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-s.startTime,joinChannelSuccessElapse:c-(s.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:jr.PEER_PUBLISH_STATUS,data:d},!0)}workerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now();(function(d,h,m){const g=d[h];if(!g||typeof g!="string")return[d];d[h]="";const E=Zh(JSON.stringify(d));let w=0;const I=[];let A=0;for(let N=0;N<g.length;N++)A+=g.charCodeAt(N)<=127?1:3,A<=m-E||(I[I.length]=et(et({},d),{},{[h]:g.substring(w,N)}),w=N,A=g.charCodeAt(N)<=127?1:3);return w!==g.length-1&&(I[I.length]=et(et({},d),{},{[h]:g.substring(w)})),I})(mn(mn(mn({},a),r),{},{elapse:c-s.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach((d=>this.send({type:jr.WORKER_EVENT,data:d},!0)))}apworkerEvent(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn(mn({},a),r),{},{elapse:c-s.startTime,lts:c});this.send({type:jr.AP_WORKER_EVENT,data:d},!0)}joinWebProxyAP(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn(mn({},a),r),{},{elapse:c-s.startTime,lts:c,extend:r.extend||void 0});this.send({type:jr.JOIN_WEB_PROXY_AP,data:d},!0)}WebSocketQuit(t,r){const s=this.baseInfoMap.get(t);if(!s)return;const a=s.info,c=Date.now(),d=mn(mn(mn({},a),r),{},{elapse:c-s.startTime,lts:c});this.send({type:jr.WEBSOCKET_QUIT,data:d},!0)}async sendCustomReportMessage(t,r){if(this.customReportCount+=r.length,this.customReportCount>oe("CUSTOM_REPORT_LIMIT"))throw new Le(te.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((()=>{this.customReportCount=0}),5e3));const s=Date.now(),a=r.map((c=>({type:jr.USER_ANALYTICS,data:mn(mn({sid:t},c),{},{lts:s})})));try{oe("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(a):await this.postDataToStatsCollector(a)}catch(c){throw M.error("send custom report message failed",c.toString()),new Le(te.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(t){const r=oe("NOT_REPORT_EVENT");if(t.tag&&rt(r)&&rt(r).call(r,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const s=this.baseInfoMap.get(t.sid);if(!s)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:a,uid:c,cid:d}=s.info;let h;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof Le){const{code:g,message:E}=t.error;h=g||E||t.error.toString()}else h=t.error.toString();const m={invokeId:t.invokeId,sid:t.sid,cname:a,cid:d,uid:c,lts:t.lts,success:t.success,elapse:t.lts-s.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?h:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:jr.API_INVOKE,data:m},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const r=Array.from(this.sids).find((s=>s!==null));r&&t.forEach((s=>{s&&(s.sid=r,this.sendApiInvoke(Object.assign({},s)))})),t.length=0}send(t,r){if(r)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>oe("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,r){const s=[],a=[];for(;t.length;){const d=t.shift();s.length<20?s.push(d):a.push(d)}t.push(...a);for(const d of[...s]){var c;this.ltsList.indexOf(d.data.lts)!==-1?(d.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(d.data.lts)):(this.ltsList.push(d.data.lts),z_(c=this.ltsList).call(c,((h,m)=>h-m)))}return r||(this.lastSendNormalEventTime=Date.now()),oe("ENABLE_EVENT_REPORT")&&s.length&&(oe("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((d=>h=>{oe("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(d):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(d),this.normalEventUploadPendingItems.length>oe("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-oe("NORMAL_EVENT_QUEUE_CAPACITY")),M.warning("report: drop normal events"))))})(s)),t}async postDataToStatsCollector2(t){Ci.networkState===Oc.OFFLINE&&await mt.race([Ci.onlineWaiter,bs(2*Ni.maxRetryTimeout)]);const r=c=>{let d=new Uint8Array;return c.forEach((h=>{const m=RL(JSON.stringify(h.data)),g=new ArrayBuffer(5),E=(I=>{let A=0;return Object.entries(jr).forEach((N=>{let[G,F]=N;F===I.type&&(A=Pme[G])})),A})(h),w=new DataView(g);w.setUint16(0,m.byteLength,!0),w.setUint8(2,255&E),w.setUint8(3,E>>>8&255),w.setUint8(4,E>>>16&255),d=Yz(d,new Uint8Array(g)),d=Yz(d,m)})),d},s="event";let a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(oe("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let c=0;c<2;c+=1){c===1&&(a=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(oe("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await xL(a,{timeout:1e4,data:r(t),headers:mn(mn({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(d){if(c===1)throw d;continue}return}}async postDataToStatsCollector(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=(m=>{const g=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return g&&g.info.vid&&+g.info.vid||0})(t[0]),a=s?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map((m=>JSON.stringify(m))),vid:s,aid:a};Ci.networkState===Oc.OFFLINE&&await mt.race([Ci.onlineWaiter,bs(2*Ni.maxRetryTimeout)]);const d=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("EVENT_REPORT_DOMAIN"),"&p=").concat(oe("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(oe("EVENT_REPORT_DOMAIN"),":").concat(oe("STATS_COLLECTOR_PORT")).concat(d));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(oe("STATS_COLLECTOR_PORT"),"&d=").concat(d):"https://".concat(oe("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(oe("STATS_COLLECTOR_PORT")).concat(d)));try{r?await fme(h,{timeout:1e4,data:c}):await xL(h,{timeout:1e4,data:c})}catch(g){if(m===1)throw g;continue}return}}createBaseInfo(t,r){const s=Object.assign({},Ame);return s.sid=t,this.baseInfoMap.set(t,{info:s,startTime:r}),s}reportResourceTiming(t,r){const s=performance.getEntriesByName(t),a=s[s.length-1];a&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:a,tag:Hr.TRACER}).onSuccess()}};w9.on("REPORT_LOG_UPLOAD",(t=>{t.networkState=Ci.networkState,It.reportApiInvoke(null,{name:"logUploadError",options:t,tag:Hr.TRACER}).onSuccess("logUploadError")}));class ke extends Le{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),ii(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,M)}throw(){super.throw(M)}}const ws={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Bn(){return ws}function R9(){return"setSinkId"in HTMLAudioElement.prototype&&(!oe("RESTRICTION_SET_PLAYBACK_DEVICE")||(pf()||Uz())&&!wL())}function S1(){return!ws.supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&ff()}function HL(t){return!(ni()||Vz(87)||S1()||!oe("ENABLE_PRE_SUB")&&(t==null||!t.autoSubscribe||oe("FORCE_DISABLE_AUTO_SUB")))}function I9(t){return!!oe("ENABLE_INSTANT_VIDEO")||!(t==null||!t.autoSubscribe||oe("FORCE_DISABLE_AUTO_SUB"))}let Ts=(function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t})({});function $v(t,r,s){return{sampleRate:t,stereo:r,bitrate:s}}function zn(t,r,s,a,c){return{width:t,height:r,frameRate:s,bitrateMin:a,bitrateMax:c}}function Wu(t,r,s,a,c){return{width:{max:t},height:{max:r},frameRate:s,bitrateMin:a,bitrateMax:c}}function $L(t,r){return{numSpatialLayers:t,numTemporalLayers:r}}const Ome={"90p":zn(160,90),"90p_1":zn(160,90),"120p":zn(160,120,15,30,65),"120p_1":zn(160,120,15,30,65),"120p_3":zn(120,120,15,30,50),"120p_4":zn(212,120),"180p":zn(320,180,15,30,140),"180p_1":zn(320,180,15,30,140),"180p_3":zn(180,180,15,30,100),"180p_4":zn(240,180,15,30,120),"240p":zn(320,240,15,40,200),"240p_1":zn(320,240,15,40,200),"240p_3":zn(240,240,15,40,140),"240p_4":zn(424,240,15,40,220),"360p":zn(640,360,15,80,400),"360p_1":zn(640,360,15,80,400),"360p_3":zn(360,360,15,80,260),"360p_4":zn(640,360,30,80,600),"360p_6":zn(360,360,30,80,400),"360p_7":zn(480,360,15,80,320),"360p_8":zn(480,360,30,80,490),"360p_9":zn(640,360,15,80,800),"360p_10":zn(640,360,24,80,800),"360p_11":zn(640,360,24,80,1e3),"480p":zn(640,480,15,100,500),"480p_1":zn(640,480,15,100,500),"480p_2":zn(640,480,30,100,1e3),"480p_3":zn(480,480,15,100,400),"480p_4":zn(640,480,30,100,750),"480p_6":zn(480,480,30,100,600),"480p_8":zn(848,480,15,100,610),"480p_9":zn(848,480,30,100,930),"480p_10":zn(640,480,10,100,400),"720p":zn(1280,720,15,120,1130),"720p_auto":zn(1280,720,30,900,3e3),"720p_1":zn(1280,720,15,120,1130),"720p_2":zn(1280,720,30,120,2e3),"720p_3":zn(1280,720,30,120,1710),"720p_5":zn(960,720,15,120,910),"720p_6":zn(960,720,30,120,1380),"1080p":zn(1920,1080,15,120,2080),"1080p_1":zn(1920,1080,15,120,2080),"1080p_2":zn(1920,1080,30,120,3e3),"1080p_3":zn(1920,1080,30,120,3150),"1080p_5":zn(1920,1080,60,120,4780),"1440p":zn(2560,1440,30,120,4850),"1440p_1":zn(2560,1440,30,120,4850),"1440p_2":zn(2560,1440,60,120,7350),"4k":zn(3840,2160,30,120,8910),"4k_1":zn(3840,2160,30,120,8910),"4k_3":zn(3840,2160,60,120,13500)},kme={"480p":Wu(640,480,5),"480p_1":Wu(640,480,5),"480p_2":Wu(640,480,30),"480p_3":Wu(640,480,15),"720p":Wu(1280,720,5),"720p_auto":zn(1280,720,30,900,3e3),"720p_1":Wu(1280,720,5),"720p_2":Wu(1280,720,30),"720p_3":Wu(1280,720,15),"1080p":Wu(1920,1080,5),"1080p_1":Wu(1920,1080,5),"1080p_2":Wu(1920,1080,30),"1080p_3":Wu(1920,1080,15)},Nme={"1SL1TL":$L(1,1),"3SL3TL":$L(3,3),"2SL3TL":$L(2,3)};function Gu(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},Ome[t]):t}function KL(t){return typeof t=="string"?Object.assign({},kme[t]):t}function b1(t){return typeof t=="string"?Object.assign({},Nme[t]):t}const xme={speech_low_quality:$v(16e3,!1),speech_standard:$v(32e3,!1,18),music_standard:$v(48e3,!1),standard_stereo:$v(48e3,!0,56),high_quality:$v(48e3,!1,128),high_quality_stereo:$v(48e3,!0,192)};function w1(t){return typeof t=="string"?Object.assign({},xme[t]):t}const Kv=[];function A9(t){return Yi(t,"mediaSource",["screen","window","application"]),!0}let wt=(function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t})({}),Sr=(function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t})({}),qv=(function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t})({}),Dme=(function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t})({}),Lme=(function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t})({}),ty=(function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t})({}),Yv=(function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t})({}),Zl=(function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t.PLAY_START="play-start",t.PLAY_END="play-end",t.FIRST_FRAME_RENDER="first-frame-render",t})({}),Xv=(function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t})({}),ol=(function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t})({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const qL={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},YL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},P9={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Mme={uplinkNetworkQuality:0,downlinkNetworkQuality:0},O9={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let ua=(function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t})({}),al=(function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t})({}),sT=(function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t})({}),ny=(function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t})({}),io=(function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t})({}),tp=(function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t})({});const XL={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let T1=(function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t})({});function Dn(t,r,s,a,c){var d,h,m={};return Object.keys(a).forEach((function(g){m[g]=a[g]})),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=Ya(d=u_(h=s.slice()).call(h)).call(d,(function(g,E){return E(t,r,g)||g}),m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0?(Object.defineProperty(t,r,m),null):m}function Pe(t,r,s){return(r=(function(a){var c=(function(d,h){if(typeof d!="object"||!d)return d;var m=d[Symbol.toPrimitive];if(m!==void 0){var g=m.call(d,"string");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(d)})(a);return typeof c=="symbol"?c:c+""})(r))in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function k9(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function Ar(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?k9(Object(s),!0).forEach((function(a){Pe(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):k9(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}class N9 extends Qr{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(ty.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,s){super(),Pe(this,"trackMediaType",void 0),Pe(this,"_ID",void 0),Pe(this,"_rtpTransceiver",void 0),Pe(this,"_lowRtpTransceiver",void 0),Pe(this,"_hints",[]),Pe(this,"_isClosed",!1),Pe(this,"_originMediaStreamTrack",void 0),Pe(this,"mediaStreamTrack",void 0),Pe(this,"_external",{}),this._ID=s||wr(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,(function(a){rt(Kv).call(Kv,a)||Kv.push(a)})(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||Hm((()=>{var s;It.reportApiInvoke(null,{name:di.GET_MEDIA_STREAM_TRACK,options:[],tag:Hr.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")}),this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===qv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,(function(r){const s=Kv.indexOf(r);s!==-1&&Kv.splice(s,1)})(this),this.emit(Yv.CLOSED),this.removeAllListeners(ty.SEI_RECEIVED)}_updateRtpTransceiver(r,s){if(s===qv.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(ty.TRANSCEIVER_UPDATED,r,s)}}class Jv extends N9{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,s){super(r,s),Pe(this,"_enabled",!0),Pe(this,"_muted",!1),Pe(this,"_isExternalTrack",!1),Pe(this,"_isClosed",!1),Pe(this,"_enabledMutex",void 0),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_handleTrackEnded",(()=>{this.onTrackEnded()})),this._enabledMutex=new ro("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,s;return(r=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,M.debug("[".concat(this.getTrackId(),"] close")),this.emit(wt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=a,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await br(this,wt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){M.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Yv.TRACK_ENDED)}stateCheck(r,s){if(M.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(s,"]")),$d(s,r),this._enabled&&this._muted&&r==="enabled"&&s===!1)throw new Le(te.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",M);if(!this._enabled&&!this._muted&&r==="muted"&&s===!0)throw new Le(te.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",M)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():mt.resolve([])}}const x9=window.AudioContext||window.webkitAudioContext;let cl=null;const gr=new class extends Qr{constructor(){super(...arguments),Pe(this,"prevState",void 0),Pe(this,"curState",void 0),Pe(this,"currentTime",void 0),Pe(this,"currentTimeStuckAt",void 0),Pe(this,"interruptDetectorTrack",void 0),Pe(this,"onLocalAudioTrackMute",(()=>{M.info("ios15-interruption-start"),this.emit(Ts.IOS_15_16_INTERRUPTION_START)})),Pe(this,"onLocalAudioTrackUnmute",(async()=>{M.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?M.info("ios15-interruption-end-canceled"):(cl&&await cl.suspend(),this.emit(Ts.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){M.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){M.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Qv(){if(!cl){if((function(){if(!x9)return void M.error("your browser is not support web audio");M.info("create audio context");const t=Ar({},oe("WEBAUDIO_INIT_OPTIONS"));M.debug("audio context init option:",JSON.stringify(t)),cl=new x9(t),gr.curState=cl.state,cl.onstatechange=()=>{gr.prevState=gr.curState,gr.curState=cl?cl.state:void 0;const{prevState:r,curState:s}=gr,a=s==="running",c=s==="interrupted",d=r==="running",h=r==="suspended",m=r==="interrupted",g=Ln().osVersion;(bo()||Bu())&&d&&c&&(M.info("ios".concat(g,"-interruption-start")),gr.emit(Ts.IOS_INTERRUPTION_START)),(bo()||Bu())&&(h||m)&&a&&(M.info("ios".concat(g,"-interruption-end")),gr.emit(Ts.IOS_INTERRUPTION_END)),r!==s&&gr.emit(Ts.STATE_CHANGE,s,r)},setInterval((()=>{var r;const s=(r=cl)===null||r===void 0?void 0:r.currentTime;gr.currentTime!==s?(gr.currentTimeStuckAt&&(M.debug("AudioContext current time resume at ".concat(s)),gr.currentTimeStuckAt=void 0),gr.currentTime=s):(s!==gr.currentTimeStuckAt&&(It.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:Hr.TRACER}).onSuccess(),M.warning("AudioContext current time stuck at ".concat(s))),gr.currentTimeStuckAt=s)}),5e3),(async function(r){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let a,c=!1,d=!1,h=!1;function m(F){r.state==="running"?g(!1):bo()||Bu()?r.state==="suspended"&&(g(!0),F&&r.resume().then(E,E)):r.state!=="closed"&&(g(!0),F&&r.resume().then(E,E))}function g(F){if(c!==F){c=F;for(let z=0,ee=s;z<ee.length;z+=1){const Z=ee[z];F?window.addEventListener(Z,w,{capture:!0,passive:!0}):window.removeEventListener(Z,w,{capture:!0,passive:!0})}}}function E(){m(!1)}function w(){m(!0)}function I(F){if(!h)if(a.paused)if(F){let z;A(!1),h=!0;try{z=a.play(),z?z.then(N,N):(a.addEventListener("playing",N),a.addEventListener("abort",N),a.addEventListener("error",N))}catch{N()}}else A(!0);else A(!1)}function A(F){if(d!==F){d=F;for(let z=0,ee=s;z<ee.length;z++){const Z=ee[z];F?window.addEventListener(Z,G,{capture:!0,passive:!0}):window.removeEventListener(Z,G,{capture:!0,passive:!0})}}}function N(){a.removeEventListener("playing",N),a.removeEventListener("abort",N),a.removeEventListener("error",N),h=!1,I(!1)}function G(){I(!0)}if(bo()){const F=r.createMediaStreamDestination(),z=document.createElement("div");z.innerHTML="<audio x-webkit-airplay='deny'></audio>",a=z.children.item(0),a.controls=!1,a.disableRemotePlayback=!0,a.preload="auto",a.srcObject=F.stream,I(!0)}gr.on(Ts.STATE_CHANGE,(function(){m(!0)})),m(!1)})(cl)})(),!cl)throw new Le(te.NOT_SUPPORTED,"can not create audio context");return cl}return cl}function ry(t){if((function(){if(JL!==null)return JL;const a=Qv(),c=a.createBufferSource(),d=a.createGain(),h=a.createGain();c.connect(d),c.connect(h),c.disconnect(d);let m=!1;try{c.disconnect(d)}catch{m=!0}return c.disconnect(),JL=m,m})())return;const r=t.connect,s=t.disconnect;t.connect=(a,c,d)=>{var h;return t._inputNodes||(t._inputNodes=[]),rt(h=t._inputNodes).call(h,a)||(a instanceof AudioNode?(t._inputNodes.push(a),r.call(t,a,c,d)):r.call(t,a,c)),t},t.disconnect=(a,c,d)=>{s.call(t),a?p1(t._inputNodes,a):t._inputNodes=[];for(const h of t._inputNodes)r.call(t,h)}}let JL=null;function QL(t,r){let s=!1;const a=1/r;if(oe("DISABLE_WEBAUDIO")){const c=window.setInterval((()=>{s?window.clearInterval(c):t(performance.now()/1e3)}),1e3*a)}else{const c=Qv();let d=c.createGain();d.gain.value=0,d.connect(c.destination);const h=()=>{if(s)return void(d=null);const m=c.createOscillator();m.onended=h,m.connect(d),m.start(0),m.stop(c.currentTime+a),t(c.currentTime)};h()}return()=>{s=!0}}class D9{constructor(){Pe(this,"context",void 0),Pe(this,"analyserNode",void 0),Pe(this,"sourceNode",void 0),this.context=Qv(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||bo()||Bu()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const a=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(a);for(let c=0;c<r.length;++c)r[c]=a[c]/128-1}const s=Ya(r).call(r,((a,c)=>a+c*c),0)/r.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,s;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{M.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class L9 extends Qr{get processSourceNode(){return this.sourceNode}set processedNode(r){var s;if(!this.isDestroyed&&this._processedNode!==r){try{var a;(a=this.sourceNode)===null||a===void 0||a.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Pe(this,"outputNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"isPlayed",!1),Pe(this,"sourceNode",void 0),Pe(this,"context",void 0),Pe(this,"audioBufferNode",void 0),Pe(this,"destNode",void 0),Pe(this,"audioOutputLevel",0),Pe(this,"volumeLevelAnalyser",void 0),Pe(this,"_processedNode",void 0),Pe(this,"playNode",void 0),Pe(this,"isDestroyed",!1),Pe(this,"onNoAudioInput",void 0),Pe(this,"isNoAudioInput",!1),Pe(this,"_noAudioInputCount",0),this.context=Qv(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),ry(this.outputNode),this.volumeLevelAnalyser=new D9}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(ol.ON_AUDIO_BUFFER,(function(a){for(let c=0;c<a.outputBuffer.numberOfChannels;c+=1){const d=a.outputBuffer.getChannelData(c);for(let h=0;h<d.length;h+=1)d[h]=0}return a.inputBuffer})(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Bn().webAudioMediaStreamDest)throw new Le(te.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&f1((()=>{gr.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;bo()||Bu()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let a;s.getFloatTimeDomainData?(a=new Float32Array(s.fftSize),s.getFloatTimeDomainData(a)):(a=new Uint8Array(s.fftSize),s.getByteTimeDomainData(a));let c=!1;for(let d=0;d<a.length;d++)a[d]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await bs(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,s;(r=this.processedNode)===null||r===void 0||r.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class M9 extends L9{get isFreeze(){return!1}constructor(r,s,a){var c;if(super(),Pe(this,"sourceNode",void 0),Pe(this,"track",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"audioElement",void 0),Pe(this,"isCurrentTrackCloned",!1),Pe(this,"isRemoteTrack",!1),Pe(this,"originVolumeLevelAnalyser",void 0),Pe(this,"rebuildWebAudio",(async()=>{if(M.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void M.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then((()=>M.info("resume success"))),M.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const g=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(g),ry(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const E=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(E,this.context.currentTime),ry(this.outputNode),this.emit(ol.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=g,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()})),r.kind!=="audio")throw new Le(te.UNEXPECTED_ERROR);this.track=r;const d=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(d),ry(this.sourceNode),a){const m=a.clone();m.enabled=!0,this.clonedTrack=m,M.debug("create an unmuted track ".concat(m.id," from the original track ").concat(a.id," to get the volume"));const g=this.context.createMediaStreamSource(new MediaStream([m]));ry(g),this.originVolumeLevelAnalyser=new D9,this.originVolumeLevelAnalyser.updateSource(g)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=d;const h=Ln();s&&h.os===rs.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(gr.on(Ts.STATE_CHANGE,(()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()})),this.checkHasAudioInput().then((m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)})))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const s=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(s),ry(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ol.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),gr.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const s=r.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),M.debug("create an unmuted track ".concat(s.id," from the original track ").concat(r.id," to get the volume"));const a=this.context.createMediaStreamSource(new MediaStream([s]));ry(a),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(a)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function U9(t,r,s){const a=(d,h)=>d?typeof d!="number"?d.max||d.exact||d.ideal||d.min||h:d:h,c={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:a(r.height,1080),maxWidth:a(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Ume(t,r){const s=await V9(t.mediaSource),{sourceId:a,audio:c}=await(function(d){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new mt(((m,g)=>{const E=document.createElement("div");E.innerText="share screen",E.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const w=document.createElement("div");w.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const I=document.createElement("div");I.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",I.setAttribute("style","height: 12%;");const A=document.createElement("div");A.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const N=document.createElement("div");N.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const G=document.createElement("button");G.innerHTML="cancel",G.setAttribute("style","width: 85px;"),G.onclick=()=>{document.body.removeChild(ee);const Z=new Error("NotAllowedError");Z.name="NotAllowedError",g(Z)};let F=h;const z=document.createElement("div");if(h){const Z=document.createElement("input");Z.setAttribute("type","checkbox");const ae=document.createElement("span");Z.setAttribute("style","margin-right: 6px;"),ae.innerText="Share audio",Z.checked=F,Z.onchange=()=>{F=Z.checked},z.appendChild(Z),z.appendChild(ae)}N.appendChild(z),N.appendChild(G),w.appendChild(I),w.appendChild(A),w.appendChild(N);const ee=document.createElement("div");ee.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),ee.appendChild(E),ee.appendChild(w),document.body.appendChild(ee),d.map((Z=>{if(Z.id){const ae=document.createElement("div");ae.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let ye=Z.thumbnail;try{const{width:_e}=ye.getSize();_e>1920&&(ye=ye.resize({width:1920}))}catch(_e){throw _e&&_e.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),_e}ae.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+ye.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Z.name.replace(/[\u00A0-\u9999<>\&]/g,(function(_e){return"&#"+_e.charCodeAt(0)+";"}))+"</span>",ae.onclick=()=>{document.body.removeChild(ee),m({sourceId:Z.id,audio:F})},A.appendChild(ae)}}))}))})(s,r);return await U9(a,t,c)}async function V9(t){let r=["window","screen"];t!=="application"&&t!=="window"||(r=["window"]),t==="screen"&&(r=["screen"]);const s=Xz();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new Le(te.ELECTRON_IS_NULL);let a=null;try{var c;a=((c=s.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{a=null}a&&a.then||(a=new mt(((d,h)=>{s.desktopCapturer.getSources({types:r},((m,g)=>{m?h(m):d(g)}))})));try{return await a}catch(d){throw new Le(te.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,d.toString())}}const ZL=new ro("safari");let j9=!1,F9=!1;async function ll(t,r){let s=0,a=null;for(;s<2;)try{a=await Vme(t,r,s>0);break}catch(c){if(c instanceof Le)throw M.error("[".concat(r,"] ").concat(c.toString())),c;const d=C1(c.name||c.code||c,c.message);if(d.code===te.MEDIA_OPTION_INVALID){M.debug("[".concat(r,"] detect media option invalid, retry")),s+=1,await bs(500);continue}throw M.error("[".concat(r,"] ").concat(d.toString())),d}if(!a)throw new Le(te.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return a}async function Vme(t,r,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Le(te.NOT_SUPPORTED,"can not find getUserMedia");s&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const a=Bn(),c=new MediaStream;if(t.audioSource&&c.addTrack(t.audioSource),t.videoSource&&c.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return M.debug("Using Video Source/ Audio Source"),c;if(t.screen)if(Xz())t.screen.sourceId?Zv(c,await U9(t.screen.sourceId,t.screen,!!t.screenAudio)):Zv(c,await Ume(t.screen,!!t.screenAudio));else if(pf()&&t.screen.extensionId&&t.screen.mandatory){if(!a.getStreamFromExtension)throw new Le(te.NOT_SUPPORTED,"This browser does not support screen sharing");M.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const A=await(h=t.screen.extensionId,m=r,new mt(((N,G)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},(F=>{if(!F||!F.streamId)return M.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),F),void G(new Le(te.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));N(F.streamId)}))}catch(F){M.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),F.toString()),G(new Le(te.CHROME_PLUGIN_NOT_INSTALL))}})));t.screen.mandatory.chromeMediaSourceId=A,Zv(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(a.getDisplayMedia){var d;t.screen.mediaSource&&A9(t.screen.mediaSource);const A={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(d=t.screen.displaySurface)!==null&&d!==void 0?d:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:N,surfaceSwitching:G,systemAudio:F,preferCurrentTab:z}=t.screen,ee={selfBrowserSurface:N,surfaceSwitching:G,systemAudio:F,preferCurrentTab:z};!N&&delete ee.selfBrowserSurface,!G&&delete ee.surfaceSwitching,!F&&delete ee.systemAudio,!z&&delete ee.preferCurrentTab,M.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:A,audio:t.screenAudio,controls:ee})),Zv(c,await navigator.mediaDevices.getDisplayMedia(Ar({video:A,audio:t.screenAudio},ee)))}else{if(!ni())throw M.error("[".concat(r,"] This browser does not support screenSharing")),new Le(te.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&A9(t.screen.mediaSource);const A={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};M.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(A))),Zv(c,await navigator.mediaDevices.getUserMedia(A))}}var h,m;if(!t.video&&!t.audio)return c;let g={video:t.video,audio:t.audio},E=oe("MEDIA_DEVICE_CONSTRAINTS");if(E)try{typeof E=="string"&&(E=JSON.parse(E)),g=PL(g,E)}catch{}M.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(g)),Ln();let w,I=null;(Vs()||bo()||d1())&&(I=await ZL.lock());try{w=await navigator.mediaDevices.getUserMedia(g)}catch(A){throw I&&I(),A}return g.audio&&(j9=!0),g.video&&(F9=!0),Zv(c,w),I&&I(),c}function C1(t,r){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Le(te.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new Le(te.DEVICE_NOT_FOUND,"".concat(t,": ").concat(r));case"NotSupportedError":return new Le(te.NOT_SUPPORTED,"".concat(t,": ").concat(r));case"NotReadableError":return new Le(te.NOT_READABLE,"".concat(t,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Le(te.PERMISSION_DENIED,"".concat(t,": ").concat(r));case"ConstraintNotSatisfiedError":return new Le(te.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(r));default:return M.error("getUserMedia unexpected error",t),new Le(te.UNEXPECTED_ERROR,"".concat(t,": ").concat(r))}}function Zv(t,r){const s=t.getVideoTracks()[0],a=t.getAudioTracks()[0],c=r.getVideoTracks()[0],d=r.getAudioTracks()[0];d&&(a&&t.removeTrack(a),t.addTrack(d)),c&&(s&&t.removeTrack(s),t.addTrack(c))}const ul=new class extends Qr{get state(){return this._state}set state(t){t!==this._state&&(this.emit(ny.STATE_CHANGE,t),this._state=t)}constructor(){super(),Pe(this,"_state",sT.IDLE),Pe(this,"isAccessMicrophonePermission",!1),Pe(this,"isAccessCameraPermission",!1),Pe(this,"lastAccessMicrophonePermission",!1),Pe(this,"lastAccessCameraPermission",!1),Pe(this,"checkdeviceMatched",!1),Pe(this,"deviceInfoMap",new Map),this.init().then((()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval((()=>{(oe("ENUMERATE_DEVICES_INTERVAL")||(h1()||u1()===rs.HARMONY_OS)&&ff())&&this.updateDevicesInfo()}),oe("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((t=>M.error(t.toString())))}async enumerateDevices(t,r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Le(te.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const a=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(a);let d=!this.isAccessMicrophonePermission&&t,h=!this.isAccessCameraPermission&&r;c.audio&&(d=!1),c.video&&(h=!1);let m=null,g=null,E=null;if(!s&&(d||h)){if(ZL.isLocked&&(M.debug("[device manager] wait GUM lock"),(await ZL.lock())(),M.debug("[device manager] GUM unlock")),j9&&(d=!1,this.isAccessMicrophonePermission=!0),F9&&(h=!1,this.isAccessCameraPermission=!0),M.debug("[device manager] check media device permissions",t,r,d,h),d&&h){try{E=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(w){const I=C1(w.name||w.code||w,w.message);if(I.code===te.PERMISSION_DENIED)throw I;M.warning("getUserMedia failed in getDevices",I)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(d){try{m=await navigator.mediaDevices.getUserMedia({audio:t})}catch(w){const I=C1(w.name||w.code||w,w.message);if(I.code===te.PERMISSION_DENIED)throw I;M.warning("getUserMedia failed in getDevices",I)}this.isAccessMicrophonePermission=!0}else if(h){try{g=await navigator.mediaDevices.getUserMedia({video:r})}catch(w){const I=C1(w.name||w.code||w,w.message);if(I.code===te.PERMISSION_DENIED)throw I;M.warning("getUserMedia failed in getDevices",I)}this.isAccessCameraPermission=!0}M.debug("[device manager] mic permission",t,"cam permission",r)}try{const w=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach((I=>I.stop())),g&&g.getTracks().forEach((I=>I.stop())),E&&E.getTracks().forEach((I=>I.stop())),m=null,g=null,E=null,w}catch(w){return m&&m.getTracks().forEach((I=>I.stop())),g&&g.getTracks().forEach((I=>I.stop())),E&&E.getTracks().forEach((I=>I.stop())),m=null,g=null,E=null,new Le(te.ENUMERATE_DEVICES_FAILED,w.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter((r=>r.kind==="audioinput"))}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter((r=>r.kind==="videoinput"))}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter((r=>r.kind==="audiooutput"))}searchDeviceIdByName(t){let r=null;return this.deviceInfoMap.forEach((s=>{s.device.label===t&&(r=s.device.deviceId)})),r}async getDeviceById(t){const r=(await this.enumerateDevices(!0,!0,!0)).find((s=>s.deviceId===t));if(!r)throw new Le(te.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return r}async init(){this.state=sT.INITING;try{await this.updateDevicesInfo(),this.state=sT.INITEND}catch(t){throw M.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=sT.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Le(te.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),r=Date.now(),s=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=t.find((h=>h.kind==="audioinput"&&h.deviceId==="default")),d=t.find((h=>h.kind==="audiooutput"&&h.deviceId==="default"));c&&d?d.groupId===c.groupId?M.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is the same group")):M.debug("[device-check] default input ".concat(c.label," and output ").concat(d.label," is not the same group")):M.debug("[device-check] default input or output not found")}const a=this.checkMediaDeviceInfoIsOk(t);if(t.forEach((c=>{if(!c.deviceId)return;const d=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((d?d.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),s.push(h)}d&&(d.updateAt=r)})),this.deviceInfoMap.forEach(((c,d)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",s.push(c))})),this.state!==sT.INITEND)return a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach((c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(ny.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(ny.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(ny.PLAYOUT_DEVICE_CHANGED,c)}})),a.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),a.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const r=t.filter((c=>c.kind==="audioinput")),s=t.filter((c=>c.kind==="videoinput")),a={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){a.audio=!0;break}for(const c of s)if(c.label&&c.deviceId){a.video=!0;break}return a}};let e2=!1;const dl=new class extends Qr{constructor(){super(...arguments),Pe(this,"onAutoplayFailed",void 0),Pe(this,"onAudioAutoplayFailed",void 0)}};function B9(){if(Ln(),!e2){const t=r=>{r.preventDefault(),e2=!1,Yw()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};e2=!0,Yw()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),M.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),dl.onAutoplayFailed?dl.onAutoplayFailed():dl.onAudioAutoplayFailed?M.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):M.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),dl.emit("autoplay-failed")}}function z9(t,r,s,a){if(!t)return;const c=It.getBaseInfoBySessionId(t);if(!c)return;const d=c.info,h=Date.now(),m=Ar(Ar({},d),{},{vid:d.vid===void 0?0:Number(d.vid),lts:h,elapse:h-c.startTime,cbRegistered:dl.onAutoplayFailed||dl.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:r,trackId:a,extend:void 0});It.send({type:jr.AUTOPLAY_FAILED,data:m},!0)}const jme=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Na=new class{constructor(){Pe(this,"onAutoplayFailed",void 0),Pe(this,"elementMap",new Map),Pe(this,"elementStateMap",new Map),Pe(this,"elementsNeedToResume",[]),Pe(this,"sinkIdMap",new Map),Pe(this,"autoResumeAfterInterruption",(t=>{Array.from(this.elementMap.entries()).forEach((r=>{let[s,a]=r;const c=this.elementStateMap.get(s),d=a.srcObject.getAudioTracks()[0],h=d&&d.readyState;if(M.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(t)),h==="live"){if(t)return a.pause(),void a.play();if(gr.curState==="running")return jv()?(a.pause(),void a.play()):void(c&&c==="paused"&&a.play())}}))})),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{Array.from(this.elementMap.entries()).forEach((t=>{let[r,s]=t;const a=s.srcObject.getAudioTracks()[0];a&&a.readyState==="live"&&(M.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())}))})),this.autoResumeAudioElement(),gr.on(Ts.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),gr.on(Ts.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),gr.on(Ts.STATE_CHANGE,(()=>{bo()&&gr.prevState==="suspended"&&gr.curState==="running"&&this.autoResumeAfterInterruption()}))}async setSinkID(t,r){const s=this.elementMap.get(t);if(this.sinkIdMap.set(t,r),s)try{await s.setSinkId(r)}catch(a){throw new Le(te.PERMISSION_DENIED,"can not set sink id: "+a.toString())}}play(t,r,s,a){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([t]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,io.INIT),this.setVolume(r,s);const d=this.sinkIdMap.get(r);if(d)try{c.setSinkId(d).catch((m=>{M.warning("[".concat(r,"] set sink id failed"),m.toString())}))}catch(m){M.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch((m=>{a&&z9(a,"audio",m.message,r),M.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(M.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),f1((()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),B9()})))}))}updateTrack(t,r){const s=this.elementMap.get(t);s&&(s.srcObject=new MediaStream([r]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,r){const s=this.elementMap.get(t);s&&(r=Math.max(0,Math.min(100,r)),s.volume=r/100)}stop(t){const r=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!r)return;const s=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(s,1),r.srcObject=null,r.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,r){jme.forEach((s=>{r.addEventListener(s,(a=>{const c=this.elementStateMap.get(t),d=a.type==="pause"?"paused":a.type;if(M.debug("[".concat(t,"] audio-element-status change ").concat(c," => ").concat(d)),a.type==="error"){const h=r==null?void 0:r.error;h&&M.error("[".concat(t,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(t,d)}))}))}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach((r=>{r.play().then((s=>{M.debug("Auto resume audio element success")})).catch((s=>{M.warning("Auto resume audio element failed!",s)}))})),this.elementsNeedToResume=[]};new mt((r=>{document.body?r():window.addEventListener("load",(()=>r()))})).then((()=>{Yw()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))}))}};function ai(){return function(t,r,s){const a=s.value;return typeof a=="function"&&(s.value=function(){this._isClosed&&new Le(te.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",M);for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];const m=a.apply(this,d);return m instanceof mt?new mt(((g,E)=>{m.then(g).catch(E)})):m}),s}}class W9 extends Qr{constructor(r){super(),Pe(this,"name","VideoProcessorDestination"),Pe(this,"ID","0"),Pe(this,"_source",void 0),Pe(this,"videoContext",void 0),Pe(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Le(te.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Le(te.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(ua.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(ua.ON_TRACK,void 0)}}class G9 extends Qr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"usageRegistry",[]),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"_chained",!1),this.trackId=r,this.direction=s}async getConstraints(){return await Fs(this,al.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,s){var a;return M.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),br(this,al.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ic(a=this.constraintsMap).call(a)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return M.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),br(this,al.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ic(s=this.constraintsMap).call(s)))}registerStats(r,s,a){this.statsRegistry.find((c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s))||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:a})}unregisterStats(r,s){const a=this.statsRegistry.findIndex((c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s));a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:a,type:c,cb:d}of this.statsRegistry)try{const h=d();r.push({processorID:s,processorName:a,type:c,stats:h})}catch(h){M.error(new Le(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find((a=>a.processorID===r.ID&&a.processorName===r.name))||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex((a=>a.processorID===r.ID&&a.processorName===r.name));s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let a=s();a instanceof mt&&(a=await a),r.push(Ar(Ar({},a),{},{direction:this.direction}))}catch(a){M.error("gather extension usage error",a)}return r}getDirection(){return this.direction}}class H9 extends Qr{constructor(r){super(),Pe(this,"name","AudioProcessorDestination"),Pe(this,"ID","0"),Pe(this,"inputTrack",void 0),Pe(this,"inputNode",void 0),Pe(this,"audioProcessorContext",void 0),Pe(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Le(te.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Le(te.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(ua.ON_TRACK,void 0),this.emit(ua.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(ua.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(ua.ON_NODE,this.inputNode))}}class $9 extends Qr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s,a){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"audioContext",void 0),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"usageRegistry",[]),Pe(this,"_chained",!1),this.audioContext=r,this.trackId=s,this.direction=a}async getConstraints(){return Fs(this,al.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,s){var a;return M.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),br(this,al.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ic(a=this.constraintsMap).call(a)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),br(this,al.REQUEST_UPDATE_CONSTRAINTS,Array.from(Ic(s=this.constraintsMap).call(s)))}registerStats(r,s,a){this.statsRegistry.find((c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s))||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:a})}unregisterStats(r,s){const a=this.statsRegistry.findIndex((c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s));a!==-1&&this.statsRegistry.splice(a,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:a,type:c,cb:d}of this.statsRegistry)try{const h=d();r.push({processorID:s,processorName:a,type:c,stats:h})}catch(h){M.error(new Le(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find((a=>a.processorID===r.ID&&a.processorName===r.name))||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex((a=>a.processorID===r.ID&&a.processorName===r.name));s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let a=s();a instanceof mt&&(a=await a),r.push(Ar(Ar({},a),{},{direction:this.direction}))}catch(a){M.error("gather extension usage error",a)}return r}getDirection(){return this.direction}}class t2 extends Qr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Pe(this,"context",void 0),Pe(this,"processSourceNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"processedNode",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"outputNode",void 0),this.outputNode=new Fme}setVolume(){}createOutputTrack(){throw new Le(te.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Fme{disconnect(){}connect(){}}function K9(t){return new mt(((r,s)=>{let a=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const d=bo()?"canplay":"playing";c.addEventListener(d,(()=>{const h=c.videoWidth,m=c.videoHeight;!h&&ni()||(a=!0,c.srcObject=null,c.remove(),r([h,m]))})),c.srcObject=new MediaStream([t]),c.play().catch(m1),setTimeout((()=>{a||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))}),4e3)}))}function R1(t){const r={};t.facingMode&&(r.facingMode=t.facingMode),t.cameraId&&(r.deviceId={exact:t.cameraId});const s=Gu(t.encoderConfig);return s.width!=null&&(r.width=s.width),s.height!=null&&(r.height=s.height),!Hz()&&s.frameRate&&(r.frameRate=s.frameRate),Uz()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),ni()&&(r.frameRate={ideal:30,max:30}),r}function q9(t){const r={};return Hz()||(t.AGC!==void 0&&(r.autoGainControl=t.AGC),t.AEC!==void 0&&(r.echoCancellation=t.AEC),t.ANS!==void 0&&(r.noiseSuppression=t.ANS,pf()&&t.ANS&&(r.googHighpassFilter=t.ANS))),r}function Y9(t){const r=q9(t);if(t.encoderConfig){const s=w1(t.encoderConfig);r.channelCount=s.stereo?2:1,r.sampleRate=s.sampleRate,r.sampleSize=s.sampleSize}return t.microphoneId&&(r.deviceId={exact:t.microphoneId}),h1()&&(r.sampleRate=void 0),r}const Bme=t=>{const r=t._encoderConfig;if(!r)return;const{frameRate:s,width:a,height:c}=t.getMediaStreamTrackSettings();let{frameRate:d=s,width:h=a,height:m=c}=r;if(!d||!h||!m)return;h=zv(h),m=zv(m),d=zv(d);const{max:g,min:E}=(function(N,G,F){const z=200*Math.pow(F/15,.6)*Math.pow(N*G/640/360,.75);return{min:Math.floor(z),max:Math.floor(4*z)}})(h,m,d),{bitrateMax:w,bitrateMin:I}=r||{};w||M.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(d,"] => [brMax: ").concat(w,", brMin: ").concat(I,"]"));const{maxFramerate:A}=oe("ENCODER_CONFIG_LIMIT");return A&&typeof A=="number"&&(d=Math.min(d,A)),{frameRate:d,bitrateMax:w||g,bitrateMin:I||E,scaleResolutionDownBy:1,scale:0}},X9=async(t,r,s)=>await(async(a,c,d)=>{const h=(function(E){const w=[];for(let I=0;I<E.length;I+=2)w.push(parseInt(E.slice(I,I+2),16));return Uint8Array.from(w)})(a9(""+c+d)).slice(0,16),m=h.slice(0,12),g=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},g,a))})(t.buffer,r,s),n2=t=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new mt(((s,a)=>{r.toBlob((async c=>{if(r.remove(),c){const d=await J9(c);s({buffer:d,width:r.width,height:r.height})}else a(new Le(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),t,1)}))},J9=async t=>{const r=await t.arrayBuffer();return new Uint8Array(r)};var Q9,Z9,eW,tW,nW,rW,iW,sW,oW,aW,cW,lW,uW,dW,hW,pW,fW,mW,Zr,gW,_W,yW,EW,vW,SW,np,bW,wW,TW,CW,RW,IW,AW,PW,OW,kW,NW,xW,DW,zs;let ci=(Q9=Wt({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),Z9=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),eW=ai(),tW=Wv("LocalAudioTrack","_enabledMutex"),nW=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),rW=ai(),iW=Wv("LocalAudioTrack","_enabledMutex"),sW=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),oW=ai(),aW=ai(),cW=ai(),lW=Wt({argsMap:t=>[t.getTrackId()]}),uW=ai(),dW=Wt({argsMap:t=>[t.getTrackId()]}),hW=ai(),pW=Wt({argsMap:t=>[t.getTrackId()]}),fW=Wt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),mW=Wt({argsMap:t=>[t.getTrackId()]}),Dn((Zr=class extends Jv{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Na.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,r,s,a){super(t,s),Pe(this,"trackMediaType",Xv.AUDIO),Pe(this,"_encoderConfig",void 0),Pe(this,"_trackSource",void 0),Pe(this,"metadata",[]),Pe(this,"_enabled",!0),Pe(this,"_volume",100),Pe(this,"_useAudioElement",!0),Pe(this,"_bypassWebAudio",!1),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_processorDestination",void 0),Pe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!a,this._trackSource=new t2,oe("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),oe("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Vs()&&!cl?setTimeout((()=>this.initWebAudio())):this.initWebAudio()}setVolume(t){vr(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Na.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void M.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,br(this,wt.NEED_REPLACE_TRACK,this).then((()=>{M.debug("[".concat(this.getTrackId(),"] replace web audio track success"))})).catch((s=>{M.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)})))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!R9())throw new Le(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Na.setSinkID(this.getTrackId(),t)}async setEnabled(t,r,s){return this._setEnabled(t,r,s)}async _setEnabled(t,r,s){if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(M.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await br(this,wt.NEED_ENABLE_TRACK,this),M.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(a){throw s||(this._enabled=!1),M.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await br(this,wt.NEED_DISABLE_TRACK,this)}catch(a){throw s||(this._enabled=!0),M.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,M.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await br(this,wt.NEED_MUTE_TRACK,this):await br(this,wt.NEED_UNMUTE_TRACK,this))}getStats(){return Hm((()=>{M.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning"),il(this,wt.GET_STATS)||Ar({},qL)}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(ol.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(ol.ON_AUDIO_BUFFER),this._source.on(ol.ON_AUDIO_BUFFER,(s=>t(s)))}play(){M.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(M.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Na.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){M.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Na.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];M.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Na.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,r){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await br(this,wt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return mt.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new Le(te.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(t){t.on(ua.ON_TRACK,(async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await br(this,wt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await br(this,wt.NEED_REPLACE_TRACK,this))})),t.on(ua.ON_NODE,(r=>{this._source.processedNode=r}))}unbindProcessorDestinationEvents(t){t.removeAllListeners(ua.ON_TRACK),t.removeAllListeners(ua.ON_NODE)}bindProcessorContextEvents(t){t.on(al.REQUEST_CONSTRAINTS,(async r=>{r(this._originMediaStreamTrack.getSettings())}))}unbindProcessorContextEvents(t){t.removeAllListeners(al.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof t2&&(this._trackSource=new M9(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new $9(this._source.context,this.getTrackId(),"local"),r=new H9(t);return this._processorContext=t,this._processorDestination=r,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(r),this._source.on(ol.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})})),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Na.stop(this.getTrackId()),this._source.play()),br(this,wt.NEED_REPLACE_MIXING_TRACK,this).then((()=>{M.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))})).catch((s=>{M.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)}))),{processorContext:t,processorDestination:r}}}).prototype,"setVolume",[Q9],Object.getOwnPropertyDescriptor(Zr.prototype,"setVolume"),Zr.prototype),Dn(Zr.prototype,"setPlaybackDevice",[Z9,eW],Object.getOwnPropertyDescriptor(Zr.prototype,"setPlaybackDevice"),Zr.prototype),Dn(Zr.prototype,"setEnabled",[tW,nW,rW],Object.getOwnPropertyDescriptor(Zr.prototype,"setEnabled"),Zr.prototype),Dn(Zr.prototype,"setMuted",[iW,sW,oW],Object.getOwnPropertyDescriptor(Zr.prototype,"setMuted"),Zr.prototype),Dn(Zr.prototype,"getStats",[aW],Object.getOwnPropertyDescriptor(Zr.prototype,"getStats"),Zr.prototype),Dn(Zr.prototype,"setAudioFrameCallback",[cW],Object.getOwnPropertyDescriptor(Zr.prototype,"setAudioFrameCallback"),Zr.prototype),Dn(Zr.prototype,"play",[lW,uW],Object.getOwnPropertyDescriptor(Zr.prototype,"play"),Zr.prototype),Dn(Zr.prototype,"stop",[dW,hW],Object.getOwnPropertyDescriptor(Zr.prototype,"stop"),Zr.prototype),Dn(Zr.prototype,"close",[pW],Object.getOwnPropertyDescriptor(Zr.prototype,"close"),Zr.prototype),Dn(Zr.prototype,"pipe",[fW],Object.getOwnPropertyDescriptor(Zr.prototype,"pipe"),Zr.prototype),Dn(Zr.prototype,"unpipe",[mW],Object.getOwnPropertyDescriptor(Zr.prototype,"unpipe"),Zr.prototype),Zr),oT=(gW=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),_W=ai(),yW=Wv("MicrophoneAudioTrack","_enabledMutex"),EW=Wt({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),vW=ai(),SW=Wt({argsMap:t=>[t.getTrackId()]}),Dn((np=class extends ci{get __className__(){return"MicrophoneAudioTrack"}constructor(t,r,s,a){super(t,r.encoderConfig?w1(r.encoderConfig):{},a,oe("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Pe(this,"_config",void 0),Pe(this,"_deviceName","default"),Pe(this,"_constraints",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_enabled",!0),this._config=r,this._constraints=s,this._originalConstraints=s,this._deviceName=t.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(jv()||bL())&&gr.bindInterruptDetectorTrack(this)}async setDevice(t){if(M.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const r=await ul.getDeviceById(t),s={};s.audio=Ar({},this._constraints),s.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let a=null;try{a=await ll(s,this.getTrackId())}catch(c){throw M.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),a=await ll({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw M.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await ul.getDeviceById(t);this._deviceName=r.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(r){throw M.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}M.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,r,s){if(r)return M.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!s){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(M.info("[".concat(this.getTrackId(),"] start setEnabled"),t),oe("AUTO_RESET_AUDIO_ROUTE")&&(bo()||Bu())){const h=navigator.audioSession;h&&(t||(h.type="playback"),h.type="auto")}if(!t){var a;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(a=this._source.clonedTrack)===null||a===void 0||a.stop(),s||(this._enabled=!1);try{await br(this,wt.NEED_DISABLE_TRACK,this)}catch(h){throw M.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Ar({},this._constraints),d=ul.searchDeviceIdByName(this._deviceName);d&&!c.deviceId&&(c.deviceId=d);try{s||(this._enabled=!0);const h=await ll({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await br(this,wt.NEED_ENABLE_TRACK,this)}catch(h){throw s||(this._enabled=!1),M.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}M.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(jv()||bL())&&gr.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((bo()||Bu())&&this._enabled&&!this._isClosed&&gr.duringInterruption){const t=async()=>{gr.off(Ts.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(M.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};gr.on(Ts.IOS_INTERRUPTION_END,t)}else M.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Yv.TRACK_ENDED)}async renewMediaStreamTrack(t){const r=t||this._constraints,s=ul.searchDeviceIdByName(this._deviceName);if(s&&!r.deviceId&&(r.deviceId=s),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const a=await ll({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(al.REQUEST_UPDATE_CONSTRAINTS,(async(r,s,a)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){a(c)}}))}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(al.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[gW,_W],Object.getOwnPropertyDescriptor(np.prototype,"setDevice"),np.prototype),Dn(np.prototype,"setEnabled",[yW,EW,vW],Object.getOwnPropertyDescriptor(np.prototype,"setEnabled"),np.prototype),Dn(np.prototype,"close",[SW],Object.getOwnPropertyDescriptor(np.prototype,"close"),np.prototype),np),zme=(bW=Wt({argsMap:(t,r)=>[t.getTrackId(),r,t.duration]}),wW=ai(),TW=Wt({argsMap:t=>[t.getTrackId()]}),CW=ai(),RW=Wt({argsMap:t=>[t.getTrackId()]}),IW=ai(),AW=Wt({argsMap:t=>[t.getTrackId()]}),PW=ai(),OW=Wt({argsMap:t=>[t.getTrackId()]}),kW=ai(),NW=Wt({argsMap:t=>[t.getTrackId()]}),xW=Wt({argsMap:t=>[t.getTrackId()]}),DW=ai(),Dn((zs=class extends ci{get __className__(){return"BufferSourceAudioTrack"}constructor(t,r,s,a){super(r.createOutputTrack(),s,a),Pe(this,"source",void 0),Pe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=r,this._bufferSource.on(ol.AUDIO_SOURCE_STATE_CHANGE,(c=>{this.safeEmit(Yv.SOURCE_STATE_CHANGE,c)}));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){vr(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[bW,wW],Object.getOwnPropertyDescriptor(zs.prototype,"startProcessAudioBuffer"),zs.prototype),Dn(zs.prototype,"pauseProcessAudioBuffer",[TW,CW],Object.getOwnPropertyDescriptor(zs.prototype,"pauseProcessAudioBuffer"),zs.prototype),Dn(zs.prototype,"seekAudioBuffer",[RW,IW],Object.getOwnPropertyDescriptor(zs.prototype,"seekAudioBuffer"),zs.prototype),Dn(zs.prototype,"resumeProcessAudioBuffer",[AW,PW],Object.getOwnPropertyDescriptor(zs.prototype,"resumeProcessAudioBuffer"),zs.prototype),Dn(zs.prototype,"stopProcessAudioBuffer",[OW,kW],Object.getOwnPropertyDescriptor(zs.prototype,"stopProcessAudioBuffer"),zs.prototype),Dn(zs.prototype,"close",[NW],Object.getOwnPropertyDescriptor(zs.prototype,"close"),zs.prototype),Dn(zs.prototype,"setAudioBufferPlaybackSpeed",[xW,DW],Object.getOwnPropertyDescriptor(zs.prototype,"setAudioBufferPlaybackSpeed"),zs.prototype),zs);class Fi extends ci{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=Qv().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,wr(8,"track-mix-")),Pe(this,"trackList",void 0),Pe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(M.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):M.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){M.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}p1(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach((s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(r.stereo=!0))})),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach((s=>{s instanceof Fi?s.emit(ty.TRANSCEIVER_UPDATED,r):s._updateRtpTransceiver(r)})))}}class Wme extends L9{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(ol.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Pe(this,"audioBuffer",void 0),Pe(this,"sourceNode",void 0),Pe(this,"startPlayTime",0),Pe(this,"startPlayOffset",0),Pe(this,"pausePlayTime",0),Pe(this,"options",void 0),Pe(this,"currentLoopCount",0),Pe(this,"currentPlaybackSpeed",100),Pe(this,"_currentState","stopped"),this.audioBuffer=r,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):M.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const LW=new Map;function MW(t,r){if(t.length===0||r.length===0)return 1/0;const s=OL(t),a=OL(r);return Math.floor(a/s)}class r2{get rendFrameRate(){const r=Math.max(1,MW(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/r)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:io.DESTROYED}set videoElementStatus(r){r!==this._videoElementStatus&&(M.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var s;r!==this._videoState&&(this._videoState=r,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(r){Pe(this,"trackId",void 0),Pe(this,"config",void 0),Pe(this,"onFirstVideoFrameDecoded",void 0),Pe(this,"onFirstVideoFrameRender",void 0),Pe(this,"onVideoStateChanged",void 0),Pe(this,"freezeTimeCounterList",[]),Pe(this,"renderFreezeAccTime",0),Pe(this,"renderFreezeAccTime2",0),Pe(this,"isKeepLastFrame",!1),Pe(this,"isDestroyed",!1),Pe(this,"timeUpdatedCount",0),Pe(this,"freezeTime",0),Pe(this,"playbackTime",0),Pe(this,"lastTimeUpdatedTime",0),Pe(this,"autoplayFailed",!1),Pe(this,"videoTrack",void 0),Pe(this,"videoElement",void 0),Pe(this,"cacheVideoElement",void 0),Pe(this,"internal",!1),Pe(this,"_render_interframe_delays",[]),Pe(this,"_render_interframe_delays_sizes",[]),Pe(this,"_videoState",tp.VideoStateStopped),Pe(this,"videoElementCheckInterval",void 0),Pe(this,"videoElementFreezeTimeout",void 0),Pe(this,"_videoElementStatus",io.NONE),Pe(this,"_isInPage",!0),Pe(this,"isGettingVideoDimensions",!1),Pe(this,"startGetVideoDimensions",(()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return M.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()})),Pe(this,"autoResumeAfterInterruption",(()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&gr.curState==="running"&&(M.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Lz())),Wz()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),Pe(this,"handleVideoEvents",(s=>{switch(s.type){case"play":case"playing":s.type==="play"&&M.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=io.PLAYING;break;case"loadeddata":if(this.videoState=tp.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=io.CANPLAY;break;case"stalled":this.videoElementStatus=io.STALLED;break;case"suspend":this.videoElementStatus=io.SUSPEND;break;case"pause":this.videoElementStatus=io.PAUSED,bo()||Bu()||Vs()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(M.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=io.WAITING;break;case"abort":this.videoElementStatus=io.ABORT;break;case"ended":this.videoElementStatus=io.ENDED;break;case"emptied":this.videoElementStatus=io.EMPTIED;break;case"error":{const a=this.videoElement.error;a&&(this.videoElementStatus=io.ERROR,M.error("[".concat(this.trackId,"] media error: ").concat(a.message," (").concat(a.code,")")));break}case"timeupdate":{const a=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=a);const c=a-this.lastTimeUpdatedTime,d=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=a,rp.lastVisibleTime<rp.lastHiddenTime||d<rp.lastHiddenTime||d<rp.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(c>oe("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}})),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(M.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Lz())),Wz()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),gr.on(Ts.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),gr.on(Ts.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const s=this.videoElement.play();s&&s.catch&&s.catch((c=>{r&&z9(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(M.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):M.warning("[".concat(this.trackId,"] play warning: "),c)}));const a=Ln();if((a.name==="Safari"&&Number(a.version)===15||jv())&&s&&s.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const s=r.getContext("2d");if(!s)return M.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,r.width,r.height);const a=s.getImageData(0,0,r.width,r.height);return r.remove(),a}async getCurrentFrameToUint8Array(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const a=document.createElement("canvas");a.width=this.videoElement.videoWidth,a.height=this.videoElement.videoHeight;const c=a.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,a.width,a.height),new mt(((d,h)=>{a.toBlob((async m=>{if(a.remove(),m){const g=await J9(m);d({buffer:g,width:a.width,height:a.height})}else h(new Le(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),r,s<0?.1:s>1?1:s)}))):await n2(r)}destroy(){this.isDestroyed=!0,gr.off(Ts.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),gr.off(Ts.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=tp.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=io.INIT,!this.videoElementCheckInterval&&(UW.forEach((d=>{this.videoElement.addEventListener(d,this.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((()=>{this._isInPage=(function(d){return d!==document.body&&document.body.contains(d)})(this.videoElement)}),1e3),oe("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,s;let d;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,oe("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===tp.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=tp.VideoStateFrozen:document.addEventListener("visibilitychange",h))},g=(E,w)=>{if(this.videoElementStatus===io.PLAYING){if(d){const N=w.presentationTime-d.presentationTime,G=w.presentedFrames-d.presentedFrames;this._render_interframe_delays_sizes.push(G),this._render_interframe_delays.push(N);const F=OL(this._render_interframe_delays_sizes),z=F-this._render_interframe_delays_sizes[0];if(F>30&&z>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===tp.VideoStateStarting&&(this.videoState=tp.VideoStateDecoding),this.videoState===tp.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,oe("VIDEO_FREEZE_DURATION"))),N<oe("VIDEO_FREEZE_DURATION")&&this.videoState===tp.VideoStateFrozen&&(this.videoState=tp.VideoStateDecoding),N>oe("VIDEO_FREEZE_DURATION")&&rp.lastVisibleTime>=rp.lastHiddenTime&&d.timestamp>rp.lastVisibleTime&&d.timestamp>rp.lastHiddenTime){const ee=Math.min(66,MW(this._render_interframe_delays_sizes,this._render_interframe_delays)),Z=Math.max(0,N-(G-1)*ee);this.renderFreezeAccTime2+=Z>ee?Z:0,this.renderFreezeAccTime+=N}}d=Ar(Ar({},w),{},{timestamp:E})}else this.isSkipCalcRenderFreezeTime()&&(d=Ar(Ar({},w),{},{timestamp:E}));var I,A;oe("ENABLE_VIDEO_FRAME_CALLBACK")&&((I=(A=this.videoElement).requestVideoFrameCallback)===null||I===void 0||I.call(A,g))};(r=(s=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(s,g)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),h1()&&!oe("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const a=Ln();a.name==="Safari"&&Number(a.version)===15||jv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,ni()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,ni()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch((d=>{M.debug("[".concat(this.trackId,"] playback interrupted"),d.toString())}))}resetVideoElement(){UW.forEach((r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=io.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===io.DESTROYED||this.internal}handleAutoPlayFailed(){const r=s=>{s.preventDefault(),this.videoElement.play().then((()=>{M.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))})).catch((a=>{M.error(a)})),this.autoplayFailed=!1,Yw()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};Yw()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),B9()}}const UW=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class i2 extends r2{constructor(r){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(r),Pe(this,"container",void 0),Pe(this,"slot",void 0),this.slot=r.element,this.internal=s,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const s=r.element;var a;!this.internal||this.slot?(s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()):(this.slot=s,s&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(a=this.slot)===null||a===void 0||a.appendChild(this.container)):this.createElements())}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var s;let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,a):await n2(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var r;this.container.remove(),(r=this.slot)===null||r===void 0||r.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var r;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",oe("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(r=this.slot)===null||r===void 0||r.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var VW,jW,FW,BW,zW,WW,GW,HW,$W,KW,qW,YW,XW,JW,QW,ZW,eG,tG,nG,rG,iG,sG,oG,aG,cG,lG,uG,dG,Rn,hG,pG,fG,mG,gG,_G,yG,EG,hl;let kr=(VW=Wt({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),jW=ai(),FW=Wt({argsMap:t=>[t.getTrackId()]}),BW=Wv("LocalVideoTrack","_enabledMutex"),zW=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),WW=ai(),GW=Wv("LocalVideoTrack","_enabledMutex"),HW=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),$W=ai(),KW=Wt({argsMap:(t,r)=>[t.getTrackId(),r,t._saveEncodeBitrateRatio]}),qW=ai(),YW=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),XW=ai(),JW=ai(),QW=Wt({argsMap:(t,r,s)=>[t.getTrackId(),r,s]}),ZW=ai(),eG=ai(),tG=ai(),nG=Wt({argsMap:t=>[t.getTrackId()]}),rG=ai(),iG=ai(),sG=ai(),oG=ai(),aG=ai(),cG=Wt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),lG=Wt({argsMap:t=>[t.getTrackId()]}),uG=Wt({argsMap:t=>[t.getTrackId()]}),dG=Wt({argsMap:(t,r,s)=>[t.getTrackId(),r.label,s]}),Rn=class Oae extends Jv{get videoHeight(){if(Vs()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(Vs()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==io.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,s,a,c,d,h){if(super(r,d),Pe(this,"trackMediaType",Xv.VIDEO),Pe(this,"_player",void 0),Pe(this,"isUseScaleResolutionDownBy",!1),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),Pe(this,"_encoderConfig",void 0),Pe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Pe(this,"_optimizationMode",void 0),Pe(this,"_saveEncodeBitrateRatio",1),Pe(this,"_videoHeight",void 0),Pe(this,"_videoWidth",void 0),Pe(this,"_forceBitrateLimit",void 0),Pe(this,"_enabled",!0),Pe(this,"_processorDestination",void 0),Pe(this,"_processorContext",void 0),Vs()){const{width:m,height:g}=r.getSettings();this._videoWidth=m,this._videoHeight=g}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=a,this._optimizationMode=c,this._hints=h||[],s&&this._hints.indexOf(Sr.CUSTOM_TRACK)!==-1?this._encoderConfig=$r(s):this._encoderConfig=s,this._hints.indexOf(Sr.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(_L(qn.CHROME,115)&&u1().indexOf("Windows")!==-1){const m=(function(g,E){if("VideoFrame"in window&&"TransformStream"in window&&Bn().supportWebRTCInsertableStream){const w=new MediaStreamTrackProcessor(g),I=new MediaStreamTrackGenerator({kind:"video"});let A,N,G=Date.now();const F=()=>{z&&(clearInterval(z),z=void 0),A&&(A.close(),A=void 0),g.stop(),N=void 0,I.removeEventListener("ended",F)};let z=window.setInterval((()=>{if(N&&A&&Date.now()-G>1e3)try{I.readyState==="live"?N.enqueue(A.clone()):F()}catch{F()}}),1e3);const ee=new TransformStream({transform:(Z,ae)=>{I.readyState==="live"?(N=ae,G=Date.now(),A===void 0?(A=Z,ae.enqueue(Z.clone())):(ae.enqueue(A),A=Z)):Z.close()}});return I.addEventListener("ended",F),w.readable.pipeThrough(ee).pipeTo(I.writable),I}})(r);m&&(M.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}s&&this._hints.indexOf(Sr.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new G9(this.getTrackId(),"local"),this._processorDestination=new W9(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(M.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}M.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const a=Ar(Ar(Ar({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(a):(r instanceof HTMLVideoElement?this._player=new r2(a):this._player=new i2(a),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Yv.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}}),oe("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,M.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(M.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await br(this,wt.NEED_DISABLE_TRACK,this)}catch(a){throw M.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}return s||(this._enabled=!1),void M.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await br(this,wt.NEED_ENABLE_TRACK,this)}catch(a){throw M.error("[".concat(this.getTrackId(),"] setEnabled to true error"),a.toString()),a}M.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,M.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await br(this,wt.NEED_MUTE_TRACK,this):await br(this,wt.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*r),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*r),M.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(r)),this._saveEncodeBitrateRatio=1;try{await br(this,wt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(M)}}}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=Gu(r),oe("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const a=R1({encoderConfig:r});(Vs()||bo()||Bu())&&(a.deviceId=void 0),M.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(a));try{await this._originMediaStreamTrack.applyConstraints(a),this.updateMediaStreamTrackResolution()}catch(c){const d=new Le(te.UNEXPECTED_ERROR,c.toString());throw M.error("[".concat(this.getTrackId(),"] applyConstraints error"),d.toString()),d}}this._encoderConfig=r,this._hints.indexOf(Sr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await br(this,wt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(a){return a.throw(M)}}getStats(){return Hm((()=>{M.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning"),il(this,wt.GET_STATS)||Ar({},YL)}async setBeautyEffect(r){M.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,s):await n2(r)}async findClosestProfile(){const{width:r,height:s,frameRate:a}=this.getMediaStreamTrackSettings(),{width:c,height:d,frameRate:h}=this._encoderConfig||{},m=zv(this._videoWidth||r||c||0),g=zv(this._videoHeight||s||d||0),E=(function(w,I,A){if(!Array.isArray(oe("VIDEO_ENCODER_CONFIG_LIST"))||oe("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const N=Math.min(w,I);return!(N>=480)&&Ar(Ar({},oe("VIDEO_ENCODER_CONFIG_LIST").find((G=>G.height>N))),{},{frameRate:A})})(m,g,zv(a||h||15));if(E)return M.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(m,"x").concat(g," => ").concat(JSON.stringify(E))),this.setEncoderConfiguration(E)}async setBitrateLimit(r){M.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void M.error(te.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=r,await br(this,wt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(a){throw this._optimizationMode=s,M.error("[".concat(this.getTrackId(),"] set optimization mode failed"),a.toString()),a}M.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return M.error(te.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,M.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){K9(this._originMediaStreamTrack).then((r=>{let[s,a]=r;this._videoHeight=a,this._videoWidth=s})).catch(m1)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");M.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=Gu(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(Sr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await br(this,wt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(M)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:s,frameRate:a}=this.getMediaStreamTrackSettings();if(!r||!s||!a)return;const{bitrateMax:c,bitrateMin:d}=this._encoderConfig;if(d==null||c==null){const{max:h,min:m}=(function(g,E,w,I,A){const N=oe("BITRATE_ADAPTER_TYPE");if(N==="DEFAULT_BITRATE")return{min:I,max:A};if(A===void 0){const G=Math.floor(200*Math.pow(w/15,.6)*Math.pow(g*E/640/360,.75));A=N==="STANDARD_BITRATE"?4*G:2*G,I=I??G}else I=I??Math.floor(A/10);return{min:I,max:A}})(r,s,a,d,c);if(this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,oe("VIDEO_STANDARD_BITRATE_VERSION")&&d==null&&c==null){const[g,E]=(function(w,I,A){const N=4*Math.floor(2e5*Math.pow(A/15,.6)*Math.pow(w*I/230400,.75)),G=w*I,F=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),z=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let ee=Ic(F).call(F).next().value,Z=1;if(F.has(G))ee=F.get(G);else{var ae;const Ze=z_(ae=Array.from(F.entries())).call(ae,((Sn,Qt)=>{let[rr]=Sn,[Jn]=Qt;return rr-Jn})),_n=Ze.find((Sn=>{let[Qt]=Sn;return Qt>G}));if(_n){const Sn=Ze.indexOf(_n);if(Sn>0){const Qt=Ze[Sn-1],rr=(G-Qt[0])/(_n[0]-Qt[0]);ee=Qt[1]+rr*(_n[1]-Qt[1])}else ee=_n[1]}else ee=Ze[Ze.length-1][1]}if(z.has(G))Z=z.get(G);else{var ye;const Ze=z_(ye=Array.from(z.entries())).call(ye,((Sn,Qt)=>{let[rr]=Sn,[Jn]=Qt;return rr-Jn})),_n=Ze.find((Sn=>{let[Qt]=Sn;return Qt>G}));if(_n){const Sn=Ze.indexOf(_n);if(Sn>0){const Qt=Ze[Sn-1],rr=(G-Qt[0])/(_n[0]-Qt[0]);Z=Qt[1]+rr*(_n[1]-Qt[1])}else Z=_n[1]}else Z=Ze[Ze.length-1][1]}const _e=oe("VIDEO_NEW_BITRATE_RATIO");_e&&_e>0&&(ee=_e/100);const ue=Math.floor(N*ee),Ae=Math.floor(65e4*Math.pow(w*I/230400,.5)*Math.pow(A/15,.69));let Ue=ue;const We=oe("VIDEO_STANDARD_BITRATE_VERSION");return We&&We>0&&(We===1?Ue=N:We===2?Ue=ue:We===3&&(Ue=Ae)),[Math.floor(Ue/1e3),Z]})(r,s,a);this._encoderConfig.bitrateMax=g,this._encoderConfig.bitrateMin=m?Math.min(m,g):g,this._saveEncodeBitrateRatio=E,M.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(r,", h: ").concat(s,", fps: ").concat(a,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else M.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(s,", fps: ").concat(a,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var r,s;const a=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:a==null?void 0:a.parentElement},{element:d,slot:h}=c;if(this.isPlaying&&d instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=qz.checkOneElementVisible(d),g=Object.assign({},m);if(g.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=g.visible;const E=It.reportApiInvoke(null,{tag:Hr.TRACER,name:di.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});g.visible?E.onSuccess("Video is visible"):E.onSuccess("Invisible because of ".concat(g.reason))}return g}return}catch(a){throw new Le(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,a.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;r&&(a=Ar(Ar({},a),Gu(r))),a=J_(a);const c=wr(8,"track-video-cloned-"),d=new Oae(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,a,J_(this._scalabilityMode),this._optimizationMode,c,J_(this._hints));return r&&a&&d.setEncoderConfiguration(a),M.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),d}async replaceTrack(r,s){if(!(r instanceof MediaStreamTrack))throw new Le(te.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new Le(te.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(Hm((()=>{It.reportApiInvoke(null,{name:di.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Hr.TRACER}).onSuccess("")}),this._mediaStreamTrack.id||this.getTrackId()),!oe("ENABLE_VIDEO_SEI")||!oe("ENABLE_ENCODED_TRANSFORM"))return void M.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new Le(te.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const s=this.getRTCRtpTransceiver();if(!s)return void M.warning("Video track is not published, SEI can not be send");const a=s.sender.getParameters();if(a.codecs.length===0)return;const c=a.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"||c==="video/h265"?this.safeEmit("sei-to-send",r):M.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(ua.ON_TRACK,(async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await br(this,wt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await br(this,wt.NEED_REPLACE_TRACK,this))}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ua.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(al.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(al.REQUEST_CONSTRAINTS)}},Dn(Rn.prototype,"play",[VW,jW],Object.getOwnPropertyDescriptor(Rn.prototype,"play"),Rn.prototype),Dn(Rn.prototype,"stop",[FW],Object.getOwnPropertyDescriptor(Rn.prototype,"stop"),Rn.prototype),Dn(Rn.prototype,"setEnabled",[BW,zW,WW],Object.getOwnPropertyDescriptor(Rn.prototype,"setEnabled"),Rn.prototype),Dn(Rn.prototype,"setMuted",[GW,HW,$W],Object.getOwnPropertyDescriptor(Rn.prototype,"setMuted"),Rn.prototype),Dn(Rn.prototype,"setSaveEncodeBitrateRatio",[KW,qW],Object.getOwnPropertyDescriptor(Rn.prototype,"setSaveEncodeBitrateRatio"),Rn.prototype),Dn(Rn.prototype,"setEncoderConfiguration",[YW,XW],Object.getOwnPropertyDescriptor(Rn.prototype,"setEncoderConfiguration"),Rn.prototype),Dn(Rn.prototype,"getStats",[JW],Object.getOwnPropertyDescriptor(Rn.prototype,"getStats"),Rn.prototype),Dn(Rn.prototype,"setBeautyEffect",[QW,ZW],Object.getOwnPropertyDescriptor(Rn.prototype,"setBeautyEffect"),Rn.prototype),Dn(Rn.prototype,"getCurrentFrameData",[eG],Object.getOwnPropertyDescriptor(Rn.prototype,"getCurrentFrameData"),Rn.prototype),Dn(Rn.prototype,"getCurrentFrameImage",[tG],Object.getOwnPropertyDescriptor(Rn.prototype,"getCurrentFrameImage"),Rn.prototype),Dn(Rn.prototype,"findClosestProfile",[nG,rG],Object.getOwnPropertyDescriptor(Rn.prototype,"findClosestProfile"),Rn.prototype),Dn(Rn.prototype,"setBitrateLimit",[iG],Object.getOwnPropertyDescriptor(Rn.prototype,"setBitrateLimit"),Rn.prototype),Dn(Rn.prototype,"setOptimizationMode",[sG],Object.getOwnPropertyDescriptor(Rn.prototype,"setOptimizationMode"),Rn.prototype),Dn(Rn.prototype,"setScalabiltyMode",[oG],Object.getOwnPropertyDescriptor(Rn.prototype,"setScalabiltyMode"),Rn.prototype),Dn(Rn.prototype,"updateMediaStreamTrackResolution",[aG],Object.getOwnPropertyDescriptor(Rn.prototype,"updateMediaStreamTrackResolution"),Rn.prototype),Dn(Rn.prototype,"pipe",[cG],Object.getOwnPropertyDescriptor(Rn.prototype,"pipe"),Rn.prototype),Dn(Rn.prototype,"unpipe",[lG],Object.getOwnPropertyDescriptor(Rn.prototype,"unpipe"),Rn.prototype),Dn(Rn.prototype,"close",[uG],Object.getOwnPropertyDescriptor(Rn.prototype,"close"),Rn.prototype),Dn(Rn.prototype,"replaceTrack",[dG],Object.getOwnPropertyDescriptor(Rn.prototype,"replaceTrack"),Rn.prototype),Rn),I1=(hG=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),pG=ai(),fG=Wv("CameraVideoTrack","_enabledMutex"),mG=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),gG=ai(),_G=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),yG=ai(),EG=Wt({argsMap:t=>[t.getTrackId()]}),hl=class kae extends kr{get __className__(){return"CameraVideoTrack"}constructor(r,s,a,c,d,h){super(r,Gu(s.encoderConfig),c,d,h),Pe(this,"_config",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_constraints",void 0),Pe(this,"_enabled",!0),Pe(this,"_deviceName","default"),Pe(this,"tryResumeVideoForIOS15_16WeChat",(async()=>{(jv()||bL())&&!(function(){const m=Ln();if(m.os!==rs.IOS||!m.osVersion)return!1;const g=m.osVersion.split(".");return Number(g[0])===15&&Number(g[1])>=2})()&&Gz()&&this._enabled&&!this._isClosed&&(M.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())})),this._config=s,this._originalConstraints=a,this._constraints=a,this._deviceName=r.label,this._encoderConfig=Gu(this._config.encoderConfig),gr.on(Ts.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),gr.on(Ts.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(M.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const s=await ul.getDeviceById(r),a={};a.video=Ar({},this._constraints),a.video.deviceId={exact:r},a.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await ll(a,this.getTrackId())}catch(d){throw M.error("[".concat(this.getTrackId(),"] setDevice failed"),d.toString()),c=await ll({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),d}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw M.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await ul.getDeviceById(r);this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw M.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}M.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){M.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const s={video:Ar(Ar({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let a=null;try{a=await ll(s,this.getTrackId())}catch(c){throw M.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),a=await ll({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=Ar({},s.video),M.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(M.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const a=await ll({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(a.getVideoTracks()[0],!1)}await br(this,wt.NEED_ENABLE_TRACK,this)}catch(a){throw M.error("[".concat(this.getTrackId(),"] setEnabled true error"),a.toString()),a}this.updateMediaStreamTrackResolution(),M.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await br(this,wt.NEED_DISABLE_TRACK,this)}catch(a){throw M.error("[".concat(this.getTrackId(),"] setEnabled to false error"),a.toString()),a}M.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=Gu(r),oe("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const a=$r(this._config);a.encoderConfig=r;const c=R1(a);(Vs()||bo()||Bu())&&(c.deviceId=void 0),M.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(d){const h=new Le(te.UNEXPECTED_ERROR,d.toString());throw M.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=a,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(Sr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await br(this,wt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return d.throw(M)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((bo()||Bu())&&this._enabled&&!this._isClosed&&gr.duringInterruption){const r=async()=>{gr.off(Ts.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(M.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};gr.on(Ts.IOS_INTERRUPTION_END,r)}else M.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Yv.TRACK_ENDED)}async renewMediaStreamTrack(r){const s=r||this._constraints,a=ul.searchDeviceIdByName(this._deviceName);if(a&&!s.deviceId&&(s.deviceId={exact:a}),this._enabled){const c=await ll({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),gr.off(Ts.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),gr.off(Ts.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],a=this._encoderConfig;r&&(a=Ar(Ar({},a),Gu(r))),a=J_(a);const c=wr(8,"track-cam-cloned-"),d=new kae(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,J_(Ar(Ar({},this._config),{},{encoderConfig:a})),J_(this._constraints),J_(this._scalabilityMode),this._optimizationMode,c);return r&&a&&d.setEncoderConfiguration(a),M.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),d}bindProcessorContextEvents(){this.processorContext.on(al.REQUEST_UPDATE_CONSTRAINTS,(async(r,s,a)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){a(c)}})),this.processorContext.on(al.REQUEST_CONSTRAINTS,(async r=>{r(this._originMediaStreamTrack.getSettings())}))}},Dn(hl.prototype,"setDevice",[hG,pG],Object.getOwnPropertyDescriptor(hl.prototype,"setDevice"),hl.prototype),Dn(hl.prototype,"setEnabled",[fG,mG,gG],Object.getOwnPropertyDescriptor(hl.prototype,"setEnabled"),hl.prototype),Dn(hl.prototype,"setEncoderConfiguration",[_G,yG],Object.getOwnPropertyDescriptor(hl.prototype,"setEncoderConfiguration"),hl.prototype),Dn(hl.prototype,"close",[EG],Object.getOwnPropertyDescriptor(hl.prototype,"close"),hl.prototype),hl);function s2(t,r,s,a){s.optimizationMode&&(a&&a.width&&a.height?(s.encoderConfig=Ar(Ar({},a),{},{bitrateMin:a.bitrateMin,bitrateMax:a.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(r.contentHint=s.optimizationMode,r.contentHint===s.optimizationMode?M.debug("[".concat(t,"] set content hint to"),s.optimizationMode):M.debug("[".concat(t,"] set content hint failed")))):M.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var vG,SG,bG,wG,eu,TG,CG,RG,IG,AG,PG,Fo;class OG extends N9{getUserId(){return this._userId}constructor(r,s,a,c){super(r,"track-".concat(r.kind,"-").concat(s,"-").concat(c.clientId,"_").concat(wr(5,""))),Pe(this,"_userId",void 0),Pe(this,"_uintId",void 0),Pe(this,"_isDestroyed",!1),Pe(this,"store",void 0),Pe(this,"processor",void 0),Pe(this,"processorContext",void 0),this._userId=s,this._uintId=a,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,M.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let e0=(vG=Wt({argsMap:(t,r,s)=>[t.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),SG=Wt({argsMap:t=>[t.getTrackId()]}),bG=Wt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),wG=Wt({argsMap:t=>[t.getTrackId()]}),Dn((eu=class extends OG{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==io.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,r,s,a,c){super(t,r,s,a),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),Pe(this,"trackMediaType",Xv.VIDEO),Pe(this,"_videoWidth",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_player",void 0),Pe(this,"_prePlayer",void 0),Pe(this,"processorDestination",void 0),Pe(this,"processorContext",void 0),this._prePlayer=c,this.updateMediaStreamTrackResolution(),this.processorContext=new G9(this.getTrackId(),"remote"),this.processorDestination=new W9(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Hm((()=>{M.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),il(this,wt.GET_STATS)||Ar({},O9)}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Zl.PLAY_START),typeof t=="string"){const a=document.getElementById(t);a?t=a:(M.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}M.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const s=Ar(Ar({fit:"cover"},r),{},{trackId:this.getTrackId(),element:t});if(this._player)this._player.updateConfig(s);else{let a=!1,c=!1;t instanceof HTMLVideoElement?(this._player=new r2(s),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,c=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,a=this._player.videoState>0,this._player.updateConfig(s)):this._player=new i2(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Zl.FIRST_FRAME_DECODED),c&&this.safeEmit(Zl.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=d=>{this.safeEmit(Zl.VIDEO_STATE_CHANGED,d)},a&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const a=this.getVideoElementVisibleStatus();this.safeEmit(Zl.VIDEO_ELEMENT_VISIBLE_STATUS,a)}catch{}}),oe("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Zl.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,M.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){K9(this._originMediaStreamTrack).then((t=>{let[r,s]=t;this._videoHeight=s,this._videoWidth=r})).catch(m1)}_updatePlayerSource(){M.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,r;const s=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),a={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:c,slot:d}=a;if(this.isPlaying&&c instanceof HTMLVideoElement&&d instanceof HTMLElement){const h=qz.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const g=It.reportApiInvoke(null,{tag:Hr.TRACER,name:di.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?g.onSuccess("Video is visible"):g.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new Le(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ua.ON_TRACK,(async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ua.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(ty.SEI_RECEIVED,t)}}).prototype,"play",[vG],Object.getOwnPropertyDescriptor(eu.prototype,"play"),eu.prototype),Dn(eu.prototype,"stop",[SG],Object.getOwnPropertyDescriptor(eu.prototype,"stop"),eu.prototype),Dn(eu.prototype,"pipe",[bG],Object.getOwnPropertyDescriptor(eu.prototype,"pipe"),eu.prototype),Dn(eu.prototype,"unpipe",[wG],Object.getOwnPropertyDescriptor(eu.prototype,"unpipe"),eu.prototype),eu),t0=(TG=Wt({argsMap:(t,r)=>[t.getTrackId(),r],throttleTime:300}),CG=Wt({argsMap:(t,r)=>[t.getTrackId(),r]}),RG=Wt({argsMap:t=>[t.getTrackId()]}),IG=Wt({argsMap:t=>[t.getTrackId()]}),AG=Wt({argsMap:(t,r)=>[t.getTrackId(),r.name]}),PG=Wt({argsMap:t=>[t.getTrackId()]}),Dn((Fo=class extends OG{get isPlaying(){return this._useAudioElement?Na.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,r,s,a){super(t,r,s,a),Pe(this,"trackMediaType",Xv.AUDIO),Pe(this,"_source",void 0),Pe(this,"_useAudioElement",!0),Pe(this,"_volume",100),Pe(this,"processorContext",void 0),Pe(this,"processorDestination",void 0),Pe(this,"_played",!1),Pe(this,"_bypassWebAudio",!1),oe("DISABLE_WEBAUDIO")?(this._source=new t2,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new M9(t,!0),oe("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ol.RECEIVE_TRACK_BUFFER,(()=>{this.safeEmit(Zl.FIRST_FRAME_DECODED)})),this.processorContext=new $9(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new H9(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ol.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))}setAudioFrameCallback(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(ol.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(ol.ON_AUDIO_BUFFER),this._source.on(ol.ON_AUDIO_BUFFER,(s=>t(s)))}setVolume(t){this._volume=t,this._useAudioElement?Na.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!R9())throw new Le(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Na.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Hm((()=>{M.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),il(this,wt.GET_STATS)||Ar({},P9)}play(){M.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(M.debug("[".concat(this.getTrackId(),"] use audio element to play")),Na.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){M.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Na.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];M.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Na.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ua.ON_TRACK,(async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})),this.processorDestination.on(ua.ON_NODE,(t=>{this._source.processedNode=t;const r=!t;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ua.ON_TRACK),this.processorDestination.removeAllListeners(ua.ON_NODE)}}).prototype,"setVolume",[TG],Object.getOwnPropertyDescriptor(Fo.prototype,"setVolume"),Fo.prototype),Dn(Fo.prototype,"setPlaybackDevice",[CG],Object.getOwnPropertyDescriptor(Fo.prototype,"setPlaybackDevice"),Fo.prototype),Dn(Fo.prototype,"play",[RG],Object.getOwnPropertyDescriptor(Fo.prototype,"play"),Fo.prototype),Dn(Fo.prototype,"stop",[IG],Object.getOwnPropertyDescriptor(Fo.prototype,"stop"),Fo.prototype),Dn(Fo.prototype,"pipe",[AG],Object.getOwnPropertyDescriptor(Fo.prototype,"pipe"),Fo.prototype),Dn(Fo.prototype,"unpipe",[PG],Object.getOwnPropertyDescriptor(Fo.prototype,"unpipe"),Fo.prototype),Fo);const rp=new class extends Qr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Pe(this,"_lastHiddenTime",0),Pe(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",(()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),M.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)}))}};class kG extends Qr{constructor(r,s){super(),Pe(this,"trackMediaType",Xv.DATA),Pe(this,"_version",1),Pe(this,"_type",3),Pe(this,"_config",void 0),Pe(this,"_originDataChannel",void 0),Pe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Pe(this,"_dataStreamPacketHandler",{serialize:a=>a,deserialize:a=>a}),Pe(this,"_datachannelEventMap",new Map),this._config=r,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return oe("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new mt(((r,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const a=setTimeout((()=>{var c;s(new Le(te.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))}),1e4);this._originDataChannel.onopen=()=>{clearTimeout(a),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(a),new Le(te.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new Le(te.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))}))}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[T1.OPEN,T1.CLOSE,T1.ERROR].forEach((s=>{const a=()=>{this.emit(s)};this._datachannelEventMap.set(s,a),r.addEventListener(s,a)}))}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach((s=>{let[a,c]=s;r.removeEventListener(a,c)})),this._datachannelEventMap.clear()}}class Gme extends kG{constructor(r){super(r),Pe(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const a=s.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(a).getUint8(3);if(c!==this.id)return void(oe("SHOW_DATASTREAM2_LOG")&&M.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let d=s.data.slice(this._dataStreamPacketHeader.byteLength);d=this._dataStreamPacketHandler.deserialize(d),this.emit(T1.MESSAGE,d)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Hme extends kG{send(r){if(this._originDataChannel){let s=r;s=this._dataStreamPacketHandler.serialize(r);const a=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);a.set(new Uint8Array(this._dataStreamPacketHeader),0),a.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(a.buffer)}}}function A1(){const t=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout((()=>IA.revokeObjectURL(t)),0),new Worker(IA.createObjectURL(t))}const NG=71,o2=1,a2=2,c2=1,xG=2;var qm=(function(t){return t[t.AUDIO_LEVEL=1]="AUDIO_LEVEL",t[t.METADATA=2]="METADATA",t[t.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",t})(qm||{});function l2(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=t.getUint8(0);if(s!==NG)return;const a=t.getUint16(1),c=o2+a2+a,d=new Uint8Array(t.byteLength-c);d.set(new Uint8Array(t.buffer,c,t.byteLength-c));const h={m:s,tlvLen:a,tlv:[],frame:d};let m=o2+a2;for(;m<c;){const g=t.getUint8(m),E=t.getUint16(m+c2),w=c2+xG;if(g===qm.AUDIO_LEVEL){let I=t.getUint8(m+w);for(let A=1;A<E;A++)I=I<<8|t.getUint8(m+w+A);h.tlv.push({tag:g,length:E,value:r?127^I>>1:127&I})}else if(g===qm.METADATA||g===qm.AUDIO_64_BIT_PTS){const I=new Uint8Array(E);for(let A=0;A<E;A++)I[A]=t.getUint8(m+w+A);h.tlv.push({tag:g,length:E,value:I})}m+=w+E}return h}const P1=new Map,O1=127,iy=1e-10,u2=139/13,k1=new Map;function d2(t,r,s){const a="".concat(t,"-").concat(r,"-").concat(s);let c=0;return k1.has(a)?c=k1.get(a):(c=Math.log((function(h,m){const g=h-m;m<g&&(m=g);let E=1;for(let w=h,I=1;w>m;w--,I++)E=E*w/I;return E})(r,t))+t*Math.log(.5)+(r-t)*Math.log(1-.5)-Math.log(s)+s*t,k1.set(a,c)),c<iy&&(c=iy),c}function DG(t,r,s){const a=r.length,c=t.length/a;let d=!1;for(let h=0,m=0;h<a;h++){let g=0;for(let E=m+c;m<E;m++)t[m]>s&&g++;r[h]!==g&&(r[h]=g,d=!0)}return d}window.cache=k1;let $me=0;class LG{constructor(r){Pe(this,"id",void 0),Pe(this,"immediates",[]),Pe(this,"lastNonSilence",-1),Pe(this,"immediateSpeechActivityScore",iy),Pe(this,"lastLevelChangedTime",Date.now()),Pe(this,"levels",[]),Pe(this,"longs",[]),Pe(this,"longSpeechActivityScore",iy),Pe(this,"mediums",[]),Pe(this,"mediumSpeechActivityScore",iy),Pe(this,"minLevel",0),Pe(this,"nextMinLevel",0),Pe(this,"nextMinLevelWindowLength",0),Pe(this,"energyScore",0),this.id=r||"".concat($me++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,s=this.levels,a=this.minLevel+u2;let c=!1;for(let d=0;d<r.length;++d){let h=s[d];h<a&&(h=0);const m=Math.floor(h/u2);r[d]!==m&&(r[d]=m,c=!0)}return c}computeLongs(){return DG(this.mediums,this.longs,4)}computeMediums(){return DG(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=d2(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=d2(this.longs[0],10,47),this.longSpeechActivityScore>iy&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=d2(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(u_(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let a=r;return r<0&&(a=0),r>O1&&(a=O1),this.levels.unshift(a),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(a),a>=this.minLevel+u2?a:a/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>O1&&(s=O1),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Kme{constructor(r){Pe(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const s=this.algorithm.runInDecisionMaker(this);s<=0?r=!0:setTimeout(this.execute.bind(this),s)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class h2{constructor(r,s,a){Pe(this,"isDominant",void 0),Pe(this,"energyRanking",void 0),Pe(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=s,this.energyScore=a}}class qme extends Qr{constructor(r){super(),Pe(this,"dominantId",null),Pe(this,"lastDecisionTime",0),Pe(this,"lastLevelChangedTime",0),Pe(this,"lastLevelIdleTime",0),Pe(this,"relativeSpeechActivities",[]),Pe(this,"speakers",new Map),Pe(this,"enableSilence",!1),Pe(this,"timeoutToSilenceInterval",0),Pe(this,"decisionMaker",null),Pe(this,"loudest",[]),Pe(this,"numLoudestToTrack",3),Pe(this,"energyExpireTimeMs",250),Pe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,s!=null&&(this.energyExpireTimeMs=s),a!=null&&(this.energyAlphaPct=a),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some((s=>s.id===r))}levelChanged(r,s){const a=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<a&&(this.lastLevelChangedTime=a,this.maybeStartDecisionMaker());const d=c.levelChanged(s,a);return this.updateLoudestList(c,d,a)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach((s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)}))}removeSpeakers(r){r.forEach((s=>{this.speakers.delete(s.id)}))}getOrCreateSpeaker(r){let s=this.speakers.get(r);return s||(s=new LG(r),this.speakers.set(r,s),this.maybeStartDecisionMaker()),s}updateLoudestList(r,s,a){const c=r.id===this.dominantId;if(s<0){let g=0;for(;g<this.loudest.length&&this.loudest[g]!==r;)++g;return new h2(c,g,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new h2(c,0,r.energyScore);const d=a-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const g=this.loudest[h];if(g.getLastLevelChangedTime()<d&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(g.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new h2(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Kme(this),this.decisionMaker.execute())}makeDecision(r){let s=null,a=null;const c=this.speakers.size;let d=null;if(c===0)d=null;else if(c===1){var h;const m=Ic(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(d=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(d=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const w=this.speakers.entries().next();w.value&&(d=w.value[0],m=w.value[1])}else d=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const g=this.relativeSpeechActivities;let E=2;for(const w of this.speakers.entries()){const[I,A]=w;if(A===m)continue;A.evaluateSpeechActivityScores(r);for(let z=0;z<g.length;++z){const ee=m==null?iy:m.getSpeechActivityScore(z);g[z]=Math.log(A.getSpeechActivityScore(z)/ee)}const N=g[0],G=g[1],F=g[2];N>3&&G>2&&F>0&&G>E&&(E=G,d=I)}this.enableSilence&&m!=null&&d===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(d=null)}d==null&&!this.enableSilence||d===this.dominantId||(s=this.dominantId,this.dominantId=d,a=this.dominantId),a==null&&!this.enableSilence||a===s||this.emit("ActiveSpeakerChanged",a)}_runInDecisionMaker(){const r=Date.now(),s=300-(r-this.lastLevelIdleTime);let a=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):a=s;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&a>c&&(a=c),a}timeoutIdleLevels(r){const s=[];for(const c of Ic(a=this.speakers).call(a)){var a;const d=r-c.getLastLevelChangedTime();36e5<d&&(this.dominantId==null||c.id!==this.dominantId)?s.push(c.id):300<d&&c.levelTimedOut()}s.forEach((c=>this.speakers.delete(c)))}}const n0=new Map;let Yd=null,N1=null;const MG=3;let sy=[];const Xd=new Map,x1=new Map;class Yme{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,s){Pe(this,"id",void 0),Pe(this,"track",void 0),Pe(this,"score",0),Pe(this,"active",!0),Pe(this,"muted",!1),Pe(this,"timer",0),Pe(this,"actives",0),Pe(this,"inactives",0),this.id=r,this.track=s,this.setActive(Xd.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:s,inactives:a}=(function(){const c=[],d=[];return Array.from(Ic(Xd).call(Xd)).forEach((h=>{h.active?c.push(h):d.push(h)})),{actives:c,inactives:d}})();if(s.length>3){let c;s.forEach((d=>{(!c||c.score>d.score)&&(c=d)})),c&&c.setActive(!1)}if(s.length<3&&a.length>0){let c;a.forEach((d=>{(!c||c.score<d.score)&&d.id!==this.id&&(c=d)})),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=(function(s){let a;return Array.from(Ic(Xd).call(Xd)).forEach((c=>{!c.active||c.id===s||c.samples<40||(!a||c.score<a.score)&&(a=c)})),a})(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=(function(s){let a;return Array.from(Ic(Xd).call(Xd)).forEach((c=>{c.active||c.id===s||c.samples<40||(!a||c.score>a.score)&&(a=c)})),a})(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout((()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()}),1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let D1;function UG(t){const r=Xd.get(t);r&&(Xd.delete(t),r.clearTimer())}const L1=new Map,Xme=new Map,p2="video/h264",f2="video/h265";function VG(t,r,s){let a=new Uint8Array(t,r,s),c=[],d=0;for(;c.length<s;)d+3<s&&a[d]===0&&a[d+1]===0&&a[d+2]===3&&(a[d+3]===0||a[d+3]===1||a[d+3]===2||a[d+3]===3)?(c.push(a[d],a[d+1],a[d+3]),d+=4):(c.push(a[d]),d++);return new Uint8Array(c)}function jG(t){const r=t.length;let s=[],a=0;for(;a<r;)a+2<r&&t[a]===0&&t[a+1]===0&&(t[a+2]===0||t[a+2]===1||t[a+2]===2||t[a+2]===3)?(s.push(t[a],t[a+1],3,t[a+2]),a+=3):(s.push(t[a]),a++);return new Uint8Array(s)}function FG(t){if(t.length<5)return"";let r=-1;for(let c=0;c<t.length-3;c++){if(t[c]===0&&t[c+1]===0&&t[c+2]===1){r=c;break}if(c<t.length-4&&t[c]===0&&t[c+1]===0&&t[c+2]===0&&t[c+3]===1){r=c;break}}if(r===-1)return"";const s=r+(t[r+2]===0?4:3);if(s>=t.length)return"";const a=t[s];return 128&a?"":(a>>1&63)>=32||s+1<t.length&&(248&t[s+1])==0?f2:(31&a)<=31?p2:""}const M1=new Map,aT=new Map;(function(){const t=Ln();ws.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),ws.getStreamFromExtension=t.name===qn.CHROME&&Number(t.version)>34,ws.supportUnifiedPlan=(function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let s=!1;try{r.addTransceiver("audio"),s=!0}catch{}return r.close(),s})(),ws.supportMinBitrate=t.name===qn.CHROME||t.name===qn.EDGE,ws.supportSetRtpSenderParameters=(function(){const r=Ln();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!ff()||!(!Vs()&&!d1())||r.name===qn.FIREFOX&&Number(r.version)>=64)})(),t.name===qn.SAFARI&&(Number(t.version)>=14?ws.supportDualStream=!0:ws.supportDualStream=!1),ws.webAudioMediaStreamDest=(function(){const r=Ln();return!(r.name===qn.SAFARI&&Number(r.version)<12)})(),ws.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",ws.supportWebGL=typeof WebGLRenderingContext<"u",ws.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,ff()||(ws.webAudioWithAEC=!0),ws.supportShareAudio=(function(){const r=Ln();return(r.os===rs.WIN_10||r.os===rs.WIN_81||r.os===rs.WIN_7||r.os===rs.LINUX||r.os===rs.MAC_OS||r.os===rs.CHROMIUM_OS)&&r.name===qn.CHROME&&Number(r.version)>=74})(),ws.supportDataChannel=!!(Vv(76)||EL(68)||jz(14)),ws.supportPCSetConfiguration=(function(){const r=window.RTCPeerConnection;return!ni()&&!!r&&r.prototype.setConfiguration instanceof Function})(),ws.supportWebRTCEncodedTransform=Vv(87)||Mz()||EL(117),ws.supportWebRTCInsertableStream=(function(){const r=Ln();return(r.name===qn.CHROME||r.name===qn.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window})(),ws.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,ws.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,f1((()=>{ws.supportDualStreamEncoding=(function(){const r=Ln();return!!oe("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&oe("CHROME_DUAL_STREAM_USE_ENCODING"))})(),M.debug("browser ua: ",navigator.userAgent),M.info("browser info: ",t),M.info("browser compatibility: ",ws)}))})();const Jme=["CHINA","GLOBAL"],BG=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],oy=[],r0=[];function ay(t,r){return!!r&&oy.some((s=>s.uid===t&&s.channelName===r))}function m2(){return r0.length>0}var Qme=t8.forEach,zG=i_("forEach")?[].forEach:function(t){return Qme(this,t,arguments.length>1?arguments[1]:void 0)};Hn({target:"Array",proto:!0,forced:[].forEach!==zG},{forEach:zG});var Zme=Sc("Array","forEach"),ege=Td,tge=Mr,nge=O,rge=Zme,g2=Array.prototype,ige={DOMTokenList:!0,NodeList:!0},sge=function(t){var r=t.forEach;return t===g2||nge(g2,t)&&r===g2.forEach||tge(ige,ege(t))?rge:r},oge=l(sge),age=Xs,WG=Aa;Hn({target:"Object",stat:!0,forced:u((function(){WG(1)}))},{keys:function(t){return WG(age(t))}});var cge=l(St.Object.keys),lge=l(Oi),uge=l(l_),dge=Hn,GG=Cd,hge=Us,pge=on,HG=Ye,fge=fr,mge=an,gge=eD,_ge=Cr,yge=Es,Ege=HB("slice"),vge=_ge("species"),_2=Array,Sge=Math.max;dge({target:"Array",proto:!0,forced:!Ege},{slice:function(t,r){var s,a,c,d=mge(this),h=fge(d),m=HG(t,h),g=HG(r===void 0?h:r,h);if(GG(d)&&(s=d.constructor,(hge(s)&&(s===_2||GG(s.prototype))||pge(s)&&(s=s[vge])===null)&&(s=void 0),s===_2||s===void 0))return yge(d,m,g);for(a=new(s===void 0?_2:s)(Sge(g-m,0)),c=0;m<g;m++,c++)m in d&&gge(a,c,d[m]);return a.length=c,a}});var bge=Sc("Array","slice"),wge=O,Tge=bge,y2=Array.prototype,Cge=function(t){var r=t.slice;return t===y2||wge(y2,t)&&r===y2.slice?Tge:r},Rge=l(Cge);function Rt(t,r,s,a,c){var d,h,m,g={};return oge(d=cge(a)).call(d,(function(E){g[E]=a[E]})),g.enumerable=!!g.enumerable,g.configurable=!!g.configurable,("value"in g||g.initializer)&&(g.writable=!0),g=lge(h=uge(m=Rge(s).call(s)).call(m)).call(h,(function(E,w){return w(t,r,E)||E}),g),c&&g.initializer!==void 0&&(g.value=g.initializer?g.initializer.call(c):void 0,g.initializer=void 0),g.initializer===void 0?(BB(t,r,g),null):g}let U1=(function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t})({}),E2=(function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t})({}),Hu=(function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t})({}),da=(function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t})({}),Ft=(function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t})({}),Pr=(function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t})({}),en=(function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t})({}),Jt=(function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t.DOWNGRADE_CODEC="downgrade_codec",t})({}),cT=(function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t})({}),Pn=(function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t})({}),ha=(function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t})({}),pn=(function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t})({});function V1(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw M.error("Invalid Channel Name ".concat(t)),new ke(te.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function j1(t){if(r=t,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||Kz(t,1,255)))throw new ke(te.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof t=="string"&&M.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let gf=(function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t})({});const Ige={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},v2={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function S2(t,r){Ss(t.url,"".concat(r,".url"),1,1e3,!1),ri(t.x)||vr(t.x,"".concat(r,".x"),0,1e4),ri(t.y)||vr(t.y,"".concat(r,".y"),0,1e4),ri(t.width)||vr(t.width,"".concat(r,".width"),0,1e4),ri(t.height)||vr(t.height,"".concat(r,".height"),0,1e4),ri(t.zOrder)||vr(t.zOrder,"".concat(r,".zOrder"),0,255),ri(t.alpha)||vr(t.alpha,"".concat(r,".alpha"),0,1,!1)}const Age={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Ym=(function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t})({}),b2=(function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t})({}),Bi=(function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t})({});function $G(t){if(!t.channelName)throw new ke(te.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new ke(te.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&Ss(t.token,"info.token",1,2047),j1(t.uid),V1(t.channelName),!0}let pa=(function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t})({}),_f=(function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t})({}),rc=(function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t})({}),i0=(function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t})({}),cr=(function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t})({}),hs=(function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t.UPDATE_GATEWAY_CONFIG="update-gateway-config",t})({}),F1=(function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t})({}),is=(function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t})({}),er=(function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t})({});const KG=[er.AFRICA,er.ASIA,er.CHINA,er.EUROPE,er.GLOBAL,er.INDIA,er.JAPAN,er.NORTH_AMERICA,er.OCEANIA,er.OVERSEA,er.SOUTH_AMERICA];let so=(function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t})({});const B1={CHINA:{},ASIA:{CODE:so.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:so.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:so.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:so.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:so.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:so.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:so.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:so.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:so.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:so.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:so.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:so.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:so.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};jL&&(B1.CHINA={CODE:so.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let lT=(function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",t})({});function qG(t){return!!t&&!(!t.uplink||!t.id)&&t.uplink.max_bitrate!==void 0&&t.uplink.min_bitrate!==void 0}class YG extends Qr{constructor(r,s){super(),X(this,"onICEConnectionStateChange",void 0),X(this,"onConnectionStateChange",void 0),X(this,"onDTLSTransportStateChange",void 0),X(this,"onDTLSTransportError",void 0),X(this,"onICETransportStateChange",void 0),X(this,"onFirstAudioReceived",void 0),X(this,"onFirstVideoReceived",void 0),X(this,"onFirstAudioDecoded",void 0),X(this,"onFirstVideoDecoded",void 0),X(this,"onFirstVideoRender",void 0),X(this,"onFirstVideoDecodedTimeout",void 0),X(this,"onSelectedLocalCandidateChanged",void 0),X(this,"onSelectedRemoteCandidateChanged",void 0),X(this,"onICECandidateError",void 0),X(this,"getLocalVideoStats",void 0)}}class XG extends YG{constructor(r,s){super(r,s),X(this,"establishPromise",void 0)}}let vt=(function(t){return t.VIDEO="video",t.AUDIO="audio",t})({}),oo=(function(t){return t.UDP_RELAY="udp_relay",t.UDP_TCP_RELAY="udp_tcp_relay",t.TCP_RELAY="tcp_relay",t.RELAY="relay",t})({}),yf=(function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.TCP_RESTART=3]="TCP_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t})({});const JG=["disconnected","failed"];let Xe=(function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t})({}),or=(function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t})({}),Lt=(function(t){return t.AudioMetadata="audioMetadata",t.AudioPts="audioPts",t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t})({}),$u=(function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t})({}),Ku=(function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t})({}),ps=(function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t})({}),QG=(function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t})({}),ip=(function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t})({}),tu=(function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t})({}),Jd=(function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t})({}),s0=(function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t})({}),Ei=(function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t})({}),o0=(function(t){return t.ABORT="abort",t})({}),Xm=(function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t})({}),Pge=(function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t})({});const Oge={[U1.ACCESS_POINT]:{[da.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[da.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[da.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[da.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[da.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[da.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[da.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[da.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[da.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[da.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[da.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[da.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[da.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[da.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[da.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[da.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[da.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[da.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[U1.UNILBS]:{[Hu.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Hu.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Hu.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Hu.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Hu.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Hu.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Hu.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Hu.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Hu.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Hu.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Hu.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Hu.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[U1.STRING_UID_ALLOCATOR]:{[E2.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[E2.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[E2.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function a0(t){const r=Oge[Math.floor(t/1e4)];if(!r)return{desc:"unknown error",retry:!1};const s=r[t%1e4];if(!s){if(Math.floor(t/1e4)===U1.ACCESS_POINT){const a=t%1e4;if(a.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(a.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}const kge={[Ft.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Ft.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Ft.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Ft.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Ft.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Ft.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Ft.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Ft.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Ft.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Ft.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Ft.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Ft.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Ft.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Ft.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Ft.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Ft.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Ft.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Ft.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Ft.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Ft.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Ft.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Ft.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Ft.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Ft.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Ft.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Ft.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Ft.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Ft.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Ft.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Ft.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Ft.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Ft.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Ft.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Ft.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Ft.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Ft.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Ft.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Ft.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Ft.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Ft.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Ft.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Ft.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ft.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Ft.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Ft.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Ft.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Ft.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Ft.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Ft.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Ft.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Ft.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Ft.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Ft.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Ft.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Ft.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Ft.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Ft.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Ft.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Ft.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Ft.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Ft.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Ft.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Ft.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Ft.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function uT(t){return kge[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function ZG(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function w2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?ZG(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):ZG(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}function T2(t,r){if(typeof t=="string")return t;const{proxy:s,host:a,port:c}=t;if(r){const d=oe("JOIN_GATEWAY_FALLBACK_PORT")||443;return d===443?"wss://".concat(a,"/ws/?p=").concat(Number(c)+150):"wss://".concat(a,":").concat(d,"/ws/?p=").concat(Number(c)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(a,"&p=").concat(c):"wss://".concat(a,":").concat(c)}const Nge=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,xge=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Dge=/wss:\/\/(.+):([0-9]+)\/?/,Lge=/wss:\/\/(.[^\/]+)\/?/;let Mge=0;class Uge{constructor(r,s){X(this,"id",0),X(this,"store",void 0),X(this,"recordIndex",void 0),X(this,"websockets",[]),X(this,"try443PortDuration",2e3),X(this,"forceCloseWSDuration",5e3),X(this,"try443PortTimeout",null),X(this,"forceCloseTimeout",null),X(this,"isTry443PortFailed",!1),X(this,"isNormalPortFailed",!1),X(this,"useDoubleDomain",!1),X(this,"useProxy",!1),X(this,"startTime",Date.now()),this.id=++Mge,this.try443PortDuration=oe("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach((r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()})),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const s=Date.now()-this.startTime;for(var a=arguments.length,c=new Array(a),d=0;d<a;d++)c[d]=arguments[d];M.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...c)}createWebSocket(r,s,a){this.logger("createWebSocket:",r,{isTry443Port:s,hasTimeoutDetection:a});const c=oe("GATEWAY_DOMAINS"),d=Date.now(),h=[],m=c.find((A=>{var N;return rt(N=r.host).call(N,A)}));m||(this.useDoubleDomain=!1);const g=[];if(this.useDoubleDomain)c.forEach((A=>{g.push(T2(w2(w2({},r),{},{host:r.host.replace(m,A)}),s))}));else{const A=w2({},r);if(s&&m){const N=c.find((G=>G!==m));N&&(A.host=A.host.replace(m,N))}g.push(T2(A,s))}try{g.forEach((A=>{const N=new WebSocket(A);N.binaryType="arraybuffer",h.push(N),this.logger("ws is connecting:",N.url)}))}catch(A){if(this.logger("ws create failed"),h.forEach((N=>N.close())),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,s,a);if(!s&&Number(r.port)!==443)return this.createWebSocket(r,!0,a);throw new ke(te.WS_ERR,"init websocket failed! Error: ".concat(A.toString()))}const E=qw();this.store&&this.store.recordJoinChannelService({urls:h.map((A=>A.url)),service:"gateway"},this.recordIndex),h.forEach((A=>{A.onopen=()=>{this.logger("onopen: ws ".concat(A.url," open cost ").concat(Date.now()-d,"ms")),this.websockets.forEach((N=>{N!==A&&(N.onopen=null,N.onclose=null,N.onmessage=null,N.close(),this.logger("close backup websocket: ".concat(N.url)))})),this.websockets.length=0,E.resolve(A)},A.onclose=N=>{this.logger("onclose: ws ".concat(A.url," closed cost ").concat(Date.now()-d,"ms state: ").concat(A.readyState));const G=h.every((F=>F.readyState===WebSocket.CLOSED||F.readyState===WebSocket.CLOSING));this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat(G)),G&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(N.reason)),E.reject({code:N.code,reason:F1.A_ROUND_WS_FAILED})):!s&&G&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),I()),s?this.isTry443PortFailed=G:this.isNormalPortFailed=G},A.onmessage=N=>this.logger("".concat(A.url," onmessage: ").concat(N.data))})),this.websockets.push(...h);const w=()=>{this.websockets.forEach((A=>A.readyState!==WebSocket.OPEN&&A.close()))},I=()=>{if(E.isResolved)return w();Ln().os===rs.MAC_OS&&ni()&&w(),this.createWebSocket(r,!0,!0).then((A=>{E.resolve(A)})).catch((A=>{this.isNormalPortFailed&&E.reject(A),this.logger("try 443 port to create ws failed")})),this.forceCloseTimeout=window.setTimeout((()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",E.isResolved),this.forceCloseTimeout=null,w()}),this.forceCloseWSDuration)};return a||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout((()=>{this.forceCloseTimeout=null,w()}),this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout((()=>{this.logger("2s timeout, isWebsocket created: ",E.isResolved),this.try443PortTimeout=null,I()}),this.try443PortDuration)})(),E.promise}chooseBestWebsocket(r,s,a,c){return this.useDoubleDomain=!!s,typeof r=="string"&&(r=(function(d){let h,m,g;return[,h,m,g]=d.match(Nge)||[],h||([,m,g]=d.match(xge)||[]),m&&g||([,m,g]=d.match(Dge)||[]),m&&g||([,m]=d.match(Lge)||[]),m||M.warning("un-destructible url: ",d),{proxy:h,host:m,port:g||"443"}})(r)),this.recordIndex=c,this.useProxy=!!r.proxy,a&&this.useProxy&&(M.warn("cannot use 443 only when use proxy"),a=!1),this.createWebSocket(r,!!a,!1).finally((()=>this.clearTimeout()))}}function e7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}class t7 extends Qr{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var s;rt(s=["tryNext","recover"]).call(s,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(pn.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(pn.CONNECTED):this._state==="closed"?this.emit(pn.CLOSED):this._state==="failed"&&this.emit(pn.FAILED))}resetReconnectCount(r){M.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,s){let a=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],d=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),X(this,"_websocketUrl",null),X(this,"connectionID",0),X(this,"currentURLIndex",0),X(this,"urls",[]),X(this,"_reconnectMode","tryNext"),X(this,"reconnectReason",void 0),X(this,"_initMutex",void 0),X(this,"name",void 0),X(this,"_state","closed"),X(this,"reconnectInterrupter",void 0),X(this,"websocket",void 0),X(this,"retryConfig",void 0),X(this,"reconnectCount",0),X(this,"forceCloseTimeout",5e3),X(this,"onlineReconnectListener",void 0),X(this,"useCompress",void 0),X(this,"tryDoubleDomain",!1),X(this,"use443PortOnly",!1),X(this,"wsInflateLength",0),X(this,"wsDeflateLength",0),X(this,"closeEstablishingWs",(()=>{})),X(this,"store",void 0),X(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=(function(I){for(var A=1;A<arguments.length;A++){var N=arguments[A]!=null?arguments[A]:{};A%2?e7(Object(N),!0).forEach((function(G){X(I,G,N[G])})):Object.getOwnPropertyDescriptors?Object.defineProperties(I,Object.getOwnPropertyDescriptors(N)):e7(Object(N)).forEach((function(G){Object.defineProperty(I,G,Object.getOwnPropertyDescriptor(N,G))}))}return I})({},s),this.useCompress=a,this.tryDoubleDomain=c,this.use443PortOnly=d,this._initMutex=new ro("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:g}=s,E=Math.max(300,Math.floor(3*m/5)),w=Math.max(1.2,Math.floor(8*g)/10);Oc.ONLINE&&(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=w),Ci.on(Fv.NETWORK_STATE_CHANGE,((I,A)=>{I!==A&&(this.resetReconnectCount("network state change: ".concat(A," -> ").concat(I)),I===Oc.ONLINE?(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=w):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=g))}))}getConnection(){return this.websocket||void 0}async init(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const a=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=r,this.state="connecting";try{var c;const d=qw(),h=this.urls[this.currentURLIndex];(c=this.store)===null||c===void 0||c.beforeConnect(),(function(m){return!(S1()||oe("USE_NEW_TOKEN")||!oe("ENABLE_PREALLOC_PC")&&(m==null||!m.autoSubscribe||oe("FORCE_DISABLE_AUTO_SUB")))})(this.store)&&this.emit(QG.PRE_CONNECT_PC),this.createWebSocketConnection(h).then(d.resolve).catch(d.reject),this.once(pn.CLOSED,(()=>{d.reject(new Le(te.WS_DISCONNECT))})),this.once(pn.CONNECTED,d.resolve),await d.promise}catch{}finally{a()}}close(r,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const a=this.websocket;s?setTimeout((()=>a.close()),500):a.close(),this.websocket=void 0,this._websocketUrl=null}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,s){if(!this.websocket)return void M.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),M.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);const a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),a&&a.bind(this.websocket)({code:9999,reason:s})}sendMessage(r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Le(te.WS_ABORT,"websocket is not ready");try{s||(r=JSON.stringify(r)),this.websocket.send(r)}catch(a){throw new Le(te.WS_ERR,"send websocket message error"+a.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var s;const a=qw();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=w=>{var I;(I=this.store)===null||I===void 0||I.signalChannelOpen(),M.debug("[".concat(this.name,"] websocket opened:"),w),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),a.resolve()},d=async w=>{var I;if(M.debug("[".concat(this.name,"] websocket close ").concat((I=this.websocket)===null||I===void 0?void 0:I.url,", code: ").concat(w.code,", reason: ").concat(w.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)a.reject(new Le(te.WS_DISCONNECT,"websocket close: ".concat(w.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=w.reason,this.state="reconnecting");const A=il(this,pn.WILL_RECONNECT,this.reconnectMode,w.reason)||this.reconnectMode,N=await this.reconnectWithAction(A);if(this.state==="closed")return void M.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!N)return a.reject(new Le(te.WS_DISCONNECT,"websocket reconnect failed: ".concat(w.code))),this.close(!0);a.resolve()}},h=w=>{this.emit(pn.ON_MESSAGE,w)},m=w=>{M.warn("[".concat(this.connectionID,"] ws open error ").concat(w))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),oe("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=oe("GATEWAY_WSS_ADDRESS")),M.debug("[".concat(this.name,"] start connect, url:"),r);const g=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var E;this._websocketUrl=T2(r);const w=await this.chooseBestWebsocketConnection(r);this.websocket=w,c&&c(this.websocket.url),this.websocket.onclose=d,this.websocket.onmessage=h,this.websocket.onerror=m,(E=this.store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:"success"},g),this.joinGatewayRecordIndex=g}catch(w){const I=this.state==="closed",A=w instanceof Le,N=A&&w.code===te.WS_ABORT,G=A&&w.code===te.WS_ERR,F=A?w.message:w&&(w.reason||w.toString());M.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(F)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:N?"aborted":"error",errors:[w]},g),I||G?(a.reject(I?new Le(te.WS_DISCONNECT,"websocket is closed: ".concat(F)):new Le(te.WS_ERR,"init websocket failed: ".concat(F))),G&&M.error("[".concat(this.name,"] init websocket failed: ").concat(F))):d&&d(w)}return a.promise}async reconnectWithAction(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;M.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||Ci.isOnline||!Ci.onlineWaiter||(this.onlineReconnectListener=Ci.onlineWaiter.then((()=>{this.onlineReconnectListener=void 0})));let a=!0;if(this.reconnectInterrupter=()=>a=!1,s){const h=kL(this.reconnectCount,this.retryConfig);M.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await mt.race([bs(h),this.onlineReconnectListener||new mt((()=>{}))])}if(this._state==="closed"||!a)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(pn.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);M.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(M.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Fs(this,pn.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var d;M.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(d=h.data)===null||d===void 0?void 0:d.desc;return Array.isArray(m)&&rt(m).call(m,"dynamic key expired")?(this.emit(pn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,s)}return!0}}class C2 extends t7{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){const a=qw(),c=(function(h,m){return new Uge(h,m)})(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{M.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),a.reject(new Le(te.WS_ABORT,"choose best websocket aborted"))};const d=oe("GATEWAY_DOMAINS");return M.debug("[choose-best-ws] currentDomain: ",r,", domains: ",d,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,s).then(a.resolve).catch(a.reject),a.promise.finally((()=>{this.closeEstablishingWs=void 0}))}}class dT extends t7{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){return new mt(((a,c)=>{let d=!1;const h=[];this.closeEstablishingWs=()=>{M.debug("[choose-best-ws] close establishing websockets"),h.forEach((G=>{G.onclose=null,G.onopen=null,G.onmessage=null,G.close()})),c(new Le(te.WS_ABORT,"choose best websocket aborted"))};const m=oe("GATEWAY_DOMAINS");let g;const E=r.indexOf("?h="),w=m.find((G=>E!==-1?rt(r).call(r,G,E):rt(r).call(r,G)));M.debug("[choose-best-ws] currentDomain: ",w,", domains: ",m);let I=!this.tryDoubleDomain||!w;if(!I&&w){var A;const G=Date.now();try{m.forEach((F=>{const z=E===-1?r.replace(w,F):r.substr(0,E)+r.substr(E).replace(w,F),ee=new WebSocket(z);ee.binaryType="arraybuffer",h.push(ee),M.debug("[choose-best-ws] ws is connecting:",ee.url)}))}catch{for(M.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach((z=>z.close()));h.length;)h.pop();I=!0}(A=this.store)===null||A===void 0||A.recordJoinChannelService({urls:h.map((F=>F.url)),service:"gateway"},s),h.forEach((F=>{F.onopen=()=>{if(d)return;const z=Date.now()-G;M.debug("[choose-best-ws] ws open cost ".concat(z,"ms")),h.filter((ee=>ee!==F)).forEach((ee=>{M.debug("[choose-best-ws]close backup websocket: ".concat(ee.url)),ee.close()})),d=!0,a(F)},F.onclose=z=>{g=z,!d&&(h.find((ee=>!(ee.readyState===WebSocket.CLOSED||ee.readyState===WebSocket.CLOSING)))||(M.debug("[choose-best-ws] all websocket is closed"),d=!0,c(g)))},F.onmessage=z=>{M.debug("[choose-best-ws]".concat(F.url," onmessage: ").concat(z.data))}})),bs(this.forceCloseTimeout).then((()=>{h.forEach((F=>{F.readyState!==WebSocket.OPEN&&F.close()}))}))}if(I){var N;let G;M.debug("[choose-best-ws] use single url: ",r),(N=this.store)===null||N===void 0||N.recordJoinChannelService({urls:[r],service:"gateway"},s);try{G=new WebSocket(r),h.push(G),G.binaryType="arraybuffer"}catch(F){const z=new Le(te.WS_ERR,"init websocket failed! Error: ".concat(F.toString()));return M.error("[".concat(this.name,"]").concat(z)),void c(z)}G.onopen=()=>{a(G)},G.onclose=F=>{c(F)},G.onmessage=F=>{M.debug("[choose-best-ws]".concat(G.url," onmessage: ").concat(F.data))},bs(this.forceCloseTimeout).then((()=>{G&&G.readyState!==WebSocket.OPEN&&G.close()}))}})).then((a=>(this.closeEstablishingWs=void 0,a))).catch((a=>{throw this.closeEstablishingWs=void 0,a}))}}class Vge extends Qr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===Pr.CONNECTED?this.emit(en.WS_CONNECTED):r===Pr.RECONNECTING?this.emit(en.WS_RECONNECTING,this._websocketReconnectReason):r===Pr.CLOSED&&this.emit(en.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),X(this,"_disconnectedReason",void 0),X(this,"_websocketReconnectReason",void 0),X(this,"_connectionState",Pr.CLOSED),X(this,"reconnectToken",void 0),X(this,"websocket",void 0),X(this,"openConnectionTime",void 0),X(this,"clientId",void 0),X(this,"lastMsgTime",Date.now()),X(this,"uploadCache",[]),X(this,"uploadCacheInterval",void 0),X(this,"rttRolling",new l9(5)),X(this,"pingpongTimer",void 0),X(this,"wsInflateDataTimer",void 0),X(this,"pingpongTimeoutCount",0),X(this,"ortc",void 0),X(this,"joinResponse",void 0),X(this,"multiIpOption",void 0),X(this,"initError",void 0),X(this,"spec",void 0),X(this,"store",void 0),X(this,"onWebsocketMessage",(a=>{if(a.data instanceof ArrayBuffer)return void this.emit(en.ON_BINARY_DATA,a.data);const c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===Pn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Pn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(sr.UID_BANNED);break;case 15:this.close(sr.IP_BANNED);break;case 16:this.close(sr.CHANNEL_BANNED)}if(c._type===Pn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Ft.ERR_LICENSE_MISSING:this.close(sr.LICENSE_MISSING);break;case Ft.ERR_LICENSE_EXPIRED:this.close(sr.LICENSE_EXPIRED);break;case Ft.ERR_LICENSE_MINUTES_EXCEEDED:this.close(sr.LICENSE_MINUTES_EXCEEDED);break;case Ft.ERR_LICENSE_PERIOD_INVALID:this.close(sr.LICENSE_PERIOD_INVALID);break;case Ft.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(sr.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ft.ERR_LICENSE_ILLEGAL:this.close(sr.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new C2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,oe("JOIN_GATEWAY_USE_DUAL_DOMAIN"),oe("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===Pr.CONNECTED&&this.reconnect("retry",js.OFFLINE)}))}async request(r,s,a,c){const d=wr(6,""),h={_id:d,_type:r,_message:s},m=this.websocket.connectionID,g=()=>new mt(((G,F)=>{if(this.connectionState===Pr.CONNECTED)return G();const z=()=>{this.off(en.WS_CLOSED,ee),G()},ee=()=>{this.off(en.WS_CONNECTED,z),F(new ke(te.WS_ABORT))};this.once(en.WS_CONNECTED,z),this.once(en.WS_CLOSED,ee),r!==Jt.PUBLISH&&r!==Jt.PUBLISH_DATASTREAM&&r!==Jt.SUBSCRIBE&&r!==Jt.SUBSCRIBE_DATASTREAM&&r!==Jt.UNSUBSCRIBE&&r!==Jt.UNSUBSCRIBE_DATASTREAM&&r!==Jt.UNPUBLISH&&r!==Jt.UNPUBLISH_DATASTREAM&&r!==Jt.CONTROL&&r!==Jt.RESTART_ICE||this.once(en.DISCONNECT_P2P,(()=>{F(new ke(te.DISCONNECT_P2P))})),r!==Jt.PUBLISH&&r!==Jt.RESTART_ICE||this.once(en.ABORT_P2P_EXECUTION,(()=>{F(new ke(te.DISCONNECT_P2P))}))}));if(this.connectionState!==Pr.CONNECTING&&this.connectionState!==Pr.RECONNECTING||r===Jt.JOIN||r===Jt.REJOIN||await g(),this.websocket.sendMessage(h,!0),c)return;const E=new mt(((G,F)=>{let z=!1;const ee=(ae,ye)=>{z=!0,G({isSuccess:ae==="success",message:ye||{}}),this.off(en.WS_CLOSED,Z),this.off(en.WS_RECONNECTING,Z),this.emit(en.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(d),ee);const Z=()=>{F(new ke(te.WS_ABORT,"type: ".concat(r))),this.off(en.WS_CLOSED,Z),this.off(en.WS_RECONNECTING,Z),this.off("res-@".concat(d),ee)};this.once(en.WS_CLOSED,Z),this.once(en.WS_RECONNECTING,Z),bs(oe("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==m||z||(M.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(en.REQUEST_TIMEOUT,r,s))}))}));let w=null;try{w=await E}catch(G){if(this.connectionState===Pr.CLOSED||r===Jt.LEAVE)throw new ke(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?G.throw():r===Jt.JOIN||r===Jt.REJOIN?null:(await g(),await this.request(r,s))}if(w.isSuccess)return w.message;const I=Number(w.message.error_code||w.message.code),A=uT(I),N=new ke(te.UNEXPECTED_RESPONSE,"".concat(A.desc,": ").concat(w.message.error_str),{code:I,data:w.message,desc:A.desc});return A.action==="success"?w.message:(M.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(I,", message: ").concat(A.desc,", action: ").concat(A.action)),I===Ft.ERR_TOO_MANY_BROADCASTERS?((r===Jt.JOIN||r===Jt.REJOIN)&&(this.initError=N,this.close()),N.throw()):A.action==="failed"?N.throw():A.action==="quit"?(this.initError=N,this.close(),N.throw()):(I===Ft.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=w.message.option,M.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",js.MULTI_IP)):this.reconnect(A.action,js.SERVER_ERROR),r===Jt.JOIN||r===Jt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new mt((a=>{const c=d=>{(!s||s(d))&&(this.off(r,c),a(d))};this.on(r,c)}))}uploadWRTCStats(r){if(!this.store.sessionId)return void M.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(cT.WRTC_STATS,s)}upload(r,s){const a={_type:r,_message:s};try{this.websocket.sendMessage(a)}catch{const d=oe("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==Pr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)}),oe("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const a={_type:r,_message:s};this.websocket.sendMessage(a)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new mt(((s,a)=>{this.once(en.WS_CONNECTED,(()=>s(this.joinResponse))),this.once(en.WS_CLOSED,(c=>a(this.initError||new ke(te.WS_ABORT,c)))),this.connectionState=Pr.CONNECTING,this.websocket.init(r).catch(a),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval((()=>{this.handleWsInflateData()}),2e4)}))}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||sr.LEAVE,this.connectionState=Pr.CLOSED,M.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(en.ABORT_P2P_EXECUTION),this.store.signalConnected();const r=await Fs(this,en.REQUEST_JOIN_INFO);this.store.joinReq();const s=await this.request(Jt.JOIN,r);if(this.ortc=r==null?void 0:r.ortc,this.store.joinRep(),!s)return this.emit(en.REPORT_JOIN_GATEWAY,F1.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(en.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Pr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new ke(te.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=Zw(this,en.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const s=await this.request(Jt.REJOIN,r);return!!s&&(this.connectionState=Pr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach((a=>{this.emit(Pn.ON_USER_ONLINE,{uid:a.uid}),a.audio&&this.emit(Pn.ON_ADD_AUDIO_STREAM,{uid:a.uid,uint_id:a.uint_id,audio:!0,ssrcId:a.audio_ssrc}),a.video&&this.emit(Pn.ON_ADD_VIDEO_STREAM,{uid:a.uid,uint_id:a.uint_id,video:!0,ssrcId:a.video_ssrc}),a.audio_mute?this.emit(Pn.MUTE_AUDIO,{uid:a.uid}):this.emit(Pn.UNMUTE_AUDIO,{uid:a.uid}),a.video_mute?this.emit(Pn.MUTE_VIDEO,{uid:a.uid}):this.emit(Pn.UNMUTE_VIDEO,{uid:a.uid}),a.audio_enable_local?this.emit(Pn.ENABLE_LOCAL_AUDIO,{uid:a.uid}):this.emit(Pn.DISABLE_LOCAL_AUDIO,{uid:a.uid}),a.video_enable_local?this.emit(Pn.ENABLE_LOCAL_VIDEO,{uid:a.uid}):this.emit(Pn.DISABLE_LOCAL_VIDEO,{uid:a.uid}),a.audio||a.video||this.emit(Pn.ON_REMOVE_STREAM,{uid:a.uid,uint_id:a.uint_id})})),!0)}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}async downgradeCodec(r){if(!this.ortc)return!1;const s={downgrade_codec:r,ortc:this.ortc};return!!await this.request(Jt.DOWNGRADE_CODEC,s)}handleNotification(r){M.debug("[".concat(this.clientId,"] receive notification: "),r);const s=uT(r.code);if(r.code===28&&"detail"in r&&(M.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(en.RECOVER_NOTIFICATION,r.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(sr.UID_BANNED),void this.close()):void this.reconnect(s.action,js.SERVER_ERROR);M.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=oe("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(M.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>oe("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",js.TIMEOUT):this.request(Jt.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const a=Date.now()-s;this.rttRolling.add(a),oe("REPORT_STATS")&&this.send(Jt.PING_BACK,{pingpongElapse:a})})).catch((a=>{}))}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:s}=this.websocket.getWsInflateData();r!==0&&s!==0&&this.upload(cT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(pn.RECONNECT_CREATE_CONNECTION,(r=>{this.emit(en.WS_RECONNECT_CREATE_CONNECTION,r)})),this.websocket.on(pn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(pn.CLOSED,(()=>{this.connectionState=Pr.CLOSED})),this.websocket.on(pn.FAILED,(()=>{this._disconnectedReason=sr.NETWORK_ERROR,this.connectionState=Pr.CLOSED})),this.websocket.on(pn.RECONNECTING,(r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===Pr.CONNECTED?this.connectionState=Pr.RECONNECTING:this.connectionState=Pr.CONNECTING})),this.websocket.on(pn.WILL_RECONNECT,((r,s,a)=>{const c=Zw(this,en.IS_P2P_DISCONNECTED),d=c||r!=="retry";c&&r==="retry"&&(M.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",s=F1.P2P_DISCONNECTED),d&&(M.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(en.REPORT_JOIN_GATEWAY,s||F1.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(en.DISCONNECT_P2P)),a(r)})),this.websocket.on(pn.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((r=>{M.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",js.SERVER_ERROR)})):this.join().catch((r=>{if(this.emit(en.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof ke){if(r.code===te.UNEXPECTED_RESPONSE&&r.data.code===Ft.ERR_NO_AUTHORIZED)return this.initError=new ke(te.TOKEN_EXPIRE,"dynamic key expired"),void this.close(sr.TOKEN_EXPIRE);M.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",js.SERVER_ERROR):(this.initError=r,this.close())}}))})),this.websocket.on(pn.REQUEST_NEW_URLS,((r,s)=>{Fs(this,en.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)})),this.websocket.on(pn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(Pn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(QG.PRE_CONNECT_PC,(()=>{this.emit(en.PRE_CONNECT_PC)}))}}let jge=(function(t){return t.NATIVE_RTC="native_rtc",t.NATIVE_RTM="native_rtm",t.WEB_RTC="web_rtc",t.WEB_RTM="web_rtm",t})({}),Ri=(function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t})({});function n7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function z1(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?n7(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):n7(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}function Jm(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(oe("TURN_DOMAIN")):(M.debug("Cannot recognized as ip address: ".concat(t,", use as host2")),t)}function W1(t){try{const r=oe("GATEWAY_DOMAINS").concat(oe("TURN_DOMAIN")).find((s=>rt(t).call(t,s)));return r?t.split(".".concat(r))[0].replace(/-/g,"."):t}catch{return M.debug("serverUrlToIp error, fallback to url",t),t}}function R2(t,r){t.addresses||(t.addresses=[]);const s=(function(m,g){if(oe("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map((I=>{let{ip:A,port:N}=I;return{address:"".concat(A,":").concat(N)}}));const E=oe("GATEWAY_DOMAINS");let w=E[1]&&rt(g).call(g,E[1])?1:0;return m.map((I=>{let{domain_prefix:A,port:N,ip:G}=I;if(A)return{address:"".concat(A,".").concat(E[w++%E.length],":").concat(N)};const F=/^[\.\:\d]+$/.test(G),z=F?"".concat(G.replace(/[^\d]/g,"-"),".").concat(E[w++%E.length],":").concat(N):"".concat(G,":").concat(N);return F||M.debug("Cannot recognized as ip address: ".concat(G,", use as host3")),{ip:G,port:N,address:z}}))})(t.addresses,r),a=Array.isArray(t.detail)&&t.detail[18];if(a&&typeof a=="string"){const m=a.split(";");for(let g=0;g<m.length;g++){var c;const E=jo(c=m[g]).call(c);s[g]&&E&&(s[g].ip6=E)}}const d=t.detail&&t.detail.candidate;let h;if(d){const[m,g]=d.split(":");m&&g&&(h={port:Number(g),ip:m,address:"".concat(m,":").concat(g)})}return{gatewayAddrs:s,apGatewayAddress:h,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function kc(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function r7(t){const r=t._encoderConfig;if(!r)return{};const s={resolution:r.width&&r.height?"".concat(kc(r.width),"x").concat(kc(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(s.maxFrameRate=r.frameRate,s.minFrameRate=r.frameRate):r.frameRate&&(s.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,s.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),s}function i7(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function hT(t,r){let s,a,c;switch(r){case Ri.CHOOSE_SERVER:a=4096,c="choose server";break;case Ri.CLOUD_PROXY:a=1048576,c="proxy";break;case Ri.CLOUD_PROXY_5:a=4194304,c="proxy5";break;case Ri.CLOUD_PROXY_FALLBACK:a=4194310,c="proxy fallback";break;default:throw new ke(te.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach((d=>{d.buffer&&d.buffer.flag===a&&(s={code:d.buffer.code,addresses:(d.buffer.edges_services||[]).map((h=>z1(z1({},h),{},{ticket:d.buffer.cert}))),server_ts:t.enter_ts,uid:d.buffer.uid,cid:d.buffer.cid,cname:d.buffer.cname,detail:z1(z1({},d.buffer.detail),t.detail),flag:d.buffer.flag,opid:t.opid,cert:d.buffer.cert})})),!s)throw new ke(te.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return s}async function s7(t,r){return await mt.all(t.addresses.map((async s=>({address:Jm(s.ip),tcpport:s.port,udpport:s.port,username:r&&oe("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():Bs.username,password:r&&oe("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await IL(r.toString()):Bs.password}))))}function I2(t,r){const s=r.getMediaStreamTrack(!0).getSettings(),a=r.videoHeight||s.height,c=r.videoWidth||s.width;return a&&c?Math.max(Math.min(a,c)/Math.min(kc(t.height),kc(t.width)),1):(M.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Qm(t){let{candidateType:r,relayProtocol:s,type:a,address:c,port:d,protocol:h}=t;const m={candidateType:r,relayProtocol:s,protocol:h};if(a!=="local-candidate"){const g=c.split(".");g.length>=4&&(g[1]="*",g[2]="*"),m.address=g.join("."),m.port=d}return m}function cy(t){const r=t.split(":"),s=t.split(/[-.]/),a=rt(t).call(t,"-")?"-":".";let c=t;return r.length>1?s.length>1?(s[1]="**",c=s[0]+a+"**:"+r[r.length-1]):c=r.length>2?r[0]+a+"**:"+r[r.length-1]:"**:"+r[r.length-1]:s.length>1&&(c=s[0]+a+"**"),c}function G1(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:oe("SVC_MODE");if(oe("ENABLE_SVC"))return(function(r){return r in y1})(t)?t:y1.L1T3}const o7={[vt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[vt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function H1(t,r,s){r.forEach((a=>{var c;const d=o7[t].find((m=>{var g;let{key:E}=m;return rt(g=a.extensionName).call(g,E)}));if(!d)return;const h=s.find((m=>{let{extensionName:g}=m;return rt(g).call(g,d.key)}));h&&rt(c=h.extensionName).call(c,"gdpr_forbidden")&&(a.extensionName=h.extensionName)}))}function c0(t,r){r.forEach((s=>{var a;const c=o7[t].find((d=>{var h;let{key:m}=d;return rt(h=s.extensionName).call(h,m)}));rt(a=s.extensionName).call(a,"gdpr_forbidden")&&c&&(s.extensionName=c.extensionName)}))}function a7(t){return t==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||rt(t).call(t,"abs-send-time")}function $1(t){return t==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||rt(t).call(t,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function c7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function l7(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?c7(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):c7(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}function pT(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:d,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:g,unsupportedVideoUplinkCodec:E,unsupportedVideoDownlinkCodec:w}=r,{useXR:I}=s;let A=[],N=[],G=[],F=[],z=!1,ee=!1;if(tc(t).mediaDescriptions.forEach((ae=>{a&&a!==ae.attributes.direction||(ae.media.mediaType!=="video"||z||(N=ae.attributes.payloads,F=ae.attributes.extmaps,z=!0),ae.media.mediaType!=="audio"||ee||(A=ae.attributes.payloads,G=ae.attributes.extmaps,ee=!0))})),!F||N.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!G||A.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(N.forEach((ae=>{var ye;(ye=ae.rtpMap)!==null&&ye!==void 0&&ye.clockRate&&(ae.rtpMap.clockRate=parseInt(ae.rtpMap.clockRate)),I&&ae.rtcpFeedbacks.push({type:"rrtr"})})),A.forEach((ae=>{var ye;(ye=ae.rtpMap)!==null&&ye!==void 0&&ye.clockRate&&(ae.rtpMap.clockRate=parseInt(ae.rtpMap.clockRate)),I&&ae.rtcpFeedbacks.push({type:"rrtr"})})),c&&(A=A.filter((ae=>{var ye;return((ye=ae.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLowerCase())!=="rtx"})),N=N.filter((ae=>{var ye;return((ye=ae.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLowerCase())!=="rtx"}))),d){const ae=N.filter((ue=>{var Ae;return/(red)|(ulpfec)|(flexfec)/i.test(((Ae=ue.rtpMap)===null||Ae===void 0?void 0:Ae.encodingName)||"")})),ye=eg(ae,N).map((ue=>ue.payloadType)),_e=[...ae.map((ue=>ue.payloadType)),...ye];N=N.filter((ue=>!rt(_e).call(_e,ue.payloadType)))}if(h&&(A=A.filter((ae=>{var ye;return!/(red)|(ulpfec)|(flexfec)/i.test(((ye=ae.rtpMap)===null||ye===void 0?void 0:ye.encodingName)||"")}))),m&&(m==null?void 0:m.length)>0&&(A=A.filter((ae=>{var ye;return rt(m).call(m,((ye=ae.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLowerCase())||"")}))),g&&(g==null?void 0:g.length)>0){const ae=N.filter((ye=>{var _e;return rt(g).call(g,((_e=ye.rtpMap)===null||_e===void 0?void 0:_e.encodingName.toLowerCase())||"")}));N=ae.concat(c?[]:eg(ae,N))}const Z=oe("UNSUPPORTED_VIDEO_CODEC");if(Z&&Z.length>0){const ae=N.filter((ue=>ue.rtpMap&&rt(Z).call(Z,ue.rtpMap.encodingName.toLowerCase()))),ye=eg(ae,N),_e=ae.concat(ye).map((ue=>ue.payloadType));N=N.filter((ue=>!rt(_e).call(_e,ue.payloadType))),M.debug("unsupportedVideoCodec: ".concat(Z,", toBeRemoved: ").concat(_e))}if(E&&E.length>0&&a==="sendonly"){const ae=N.filter((ue=>ue.rtpMap&&rt(E).call(E,ue.rtpMap.encodingName.toLowerCase()))),ye=eg(ae,N),_e=ae.concat(ye).map((ue=>ue.payloadType));N=N.filter((ue=>!rt(_e).call(_e,ue.payloadType))),M.debug("unsupportedVideoUplinkCodec: ".concat(E,", toBeRemoved: ").concat(_e))}if(w&&w.length>0&&a==="recvonly"){const ae=N.filter((ue=>ue.rtpMap&&rt(w).call(w,ue.rtpMap.encodingName.toLowerCase()))),ye=eg(ae,N),_e=ae.concat(ye).map((ue=>ue.payloadType));N=N.filter((ue=>!rt(_e).call(_e,ue.payloadType))),M.debug("unsupportedVideoDownlinkCodec: ".concat(w,", toBeRemoved: ").concat(_e))}return{audioCodecs:A,videoCodecs:N,audioExtensions:G,videoExtensions:F}}function Zm(t){const r=tc(t);let s,a;for(const c of r.mediaDescriptions){if(!s){const d=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!d||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:d,icePwd:h}}if(!a){const d=c.attributes.fingerprints;d.length>0&&(a={fingerprints:d})}}if(!a&&r.attributes.fingerprints.length>0&&(a={fingerprints:r.attributes.fingerprints}),!a||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:a}}function u7(t,r){const s=[],a=t.attributes.ssrcGroups.filter((h=>h.semantic==="FID")),c=t.attributes.ssrcGroups.find((h=>h.semantic==="SIM")),d=t.attributes.ssrcs;if(c)c.ssrcIds.forEach((h=>{var m;const g=(m=a.find((E=>E.ssrcIds[0]===h)))===null||m===void 0?void 0:m.ssrcIds[1];s.push({ssrcId:h,rtx:r?g:void 0})}));else if(a.length>0){const h=a[0].ssrcIds[0],m=a[0].ssrcIds[1];s.push({ssrcId:h,rtx:r?m:void 0})}else{if(d.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:d[0].ssrcId})}return s}function d7(t,r,s){const{cname:a}=t;let c=[];r&&(c=h7(r)),c.length===0&&(c=t.iceParameters.candidates.map((w=>({foundation:w.foundation,componentId:"1",transport:w.protocol,priority:w.priority.toString(),connectionAddress:w.ip,port:w.port.toString(),type:w.type,extension:{}}))),M.debug("Using candidates from gateway."));const d={fingerprints:t.dtlsParameters.fingerprints.map((w=>({hashFunction:w.algorithm,fingerprint:w.fingerprint})))},h={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let m;switch(t.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const g=q1(t.rtpCapabilities),E=[];return Array.isArray(s)&&s.length>0&&s.forEach((w=>{E.push({kind:vt.VIDEO,ssrcMsg:[{ssrcId:w.v,rtx:w.v_rtx}],mslabel:"".concat(w.v,"_").concat(w.a)},{kind:vt.AUDIO,ssrcMsg:[{ssrcId:w.a}],mslabel:"".concat(w.v,"_").concat(w.a)})})),{dtlsParameters:d,iceParameters:h,candidates:c,rtpCapabilities:g,setup:m,cname:a,preSSRCs:E}}function h7(t){let r=[];return t.ip&&typeof t.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],M.debug("Using remote candidate from AP ".concat(cy(t.ip),":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),M.debug("Using IPV6 remote candidate from AP ".concat(cy(t.ip6),":").concat(t.port)))),r}function fT(t,r,s){const a=[],c=[];return t.forEach((d=>{let{ssrcId:h,rtx:m}=d;const g=wr(8,"track-"),E={ssrcId:h,attributes:l7({label:g,mslabel:s=s||wr(10,""),msid:"".concat(s," ").concat(g)},r&&{cname:r})};if(a.push(E),m!==void 0){const w={ssrcId:m,attributes:l7({label:g,mslabel:s,msid:"".concat(s," ").concat(g)},r&&{cname:r})};a.push(w),c.push({semantic:"FID",ssrcIds:[h,m]})}})),t.length>1&&c.push({semantic:"SIM",ssrcIds:t.map((d=>{let{ssrcId:h}=d;return h}))}),{ssrcs:a,ssrcGroups:c}}function l0(t,r){r instanceof ci&&t.attributes.payloads.forEach((s=>{var a;const c=(a=s.rtpMap)===null||a===void 0?void 0:a.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),c==="opus"&&typeof oe("OPUS_PTIME")=="number"?s.fmtp.parameters.ptime=oe("OPUS_PTIME"):s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const d=r._encoderConfig;d&&(c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(d.bitrate&&!ni()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*d.bitrate))),d.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(d.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(d.sampleRate)),d.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1")),r instanceof oT&&c==="opus"&&r._config.DTX&&(s.fmtp.parameters.usedtx="1"))}))}function A2(t){const r=t.attributes.unrecognized.findIndex((s=>s.attField==="x-google-flag"&&s.attValue==="conference"));r!==-1&&t.attributes.unrecognized.splice(r,1)}function P2(t,r){var s;if(!(r instanceof kr&&r._encoderConfig&&r._hints.indexOf(Sr.SCREEN_TRACK)===-1))return;const a=r._encoderConfig;Bn().supportMinBitrate&&a.bitrateMin&&t.attributes.payloads.forEach((c=>{var d,h;rt(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(a.bitrateMin))})),Bn().supportMinBitrate&&!rt(s=r._hints).call(s,Sr.LOW_STREAM)&&a.bitrateMax&&t.attributes.payloads.forEach((c=>{var d,h;rt(d=["h264","h265","vp8","vp9","av1"]).call(d,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(oe("X_GOOGLE_START_BITRATE")||Math.floor(a.bitrateMax)))}))}function p7(t){if(t.media.mediaType!=="video")return;const r=Ln();if(r.name!==qn.SAFARI&&r.os!==rs.IOS)return;const s=t.attributes.extmaps.findIndex((a=>/video-orientation/g.test(a.extensionName)));s!==-1&&t.attributes.extmaps.splice(s,1)}function K1(t,r,s){if(!r)return;let a,c;if(t.media.mediaType==="video"?(a=s.videoExtensions,c=s.videoCodecs):(a=s.audioExtensions,c=s.audioCodecs),r.twcc===!0){const d=a.find((h=>$1(h.extensionName)));if(d){const h=d.extensionName;t.attributes.extmaps.find((g=>$1(g.extensionName)))||t.attributes.extmaps.push({entry:d.entry,extensionName:h}),(function(g,E){return E.filter((w=>!!g.find((I=>I.payloadType===w.payloadType&&!!I.rtcpFeedbacks.find((A=>A.type==="transport-cc"))))))})(c,t.attributes.payloads).forEach((g=>{g.rtcpFeedbacks.find((E=>E.type==="transport-cc"))||g.rtcpFeedbacks.push({type:"transport-cc"})}))}}else if(r.twcc===!1){const d=t.attributes.extmaps.findIndex((h=>$1(h.extensionName)));d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach((h=>{const m=h.rtcpFeedbacks.findIndex((g=>g.type==="transport-cc"));m!==-1&&h.rtcpFeedbacks.splice(m,1)}))}if(r.remb===!0){const d=a.find((h=>a7(h.extensionName)));if(d){const h=d.extensionName;t.attributes.extmaps.find((g=>g.extensionName===h))||t.attributes.extmaps.push({entry:d.entry,extensionName:h}),(function(g,E){return E.filter((w=>!!g.find((I=>I.payloadType===w.payloadType&&!!I.rtcpFeedbacks.find((A=>A.type==="goog-remb"))))))})(c,t.attributes.payloads).forEach((g=>{g.rtcpFeedbacks.find((E=>E.type==="goog-remb"))||g.rtcpFeedbacks.push({type:"goog-remb"})}))}}else if(r.remb===!1){const d=t.attributes.extmaps.findIndex((h=>a7(h.extensionName)));d!==-1&&t.attributes.extmaps.splice(d,1),t.attributes.payloads.forEach((h=>{const m=h.rtcpFeedbacks.findIndex((g=>g.type==="goog-remb"));m!==-1&&h.rtcpFeedbacks.splice(m,1)}))}}function f7(t,r,s){if(ni()||t.media.mediaType!=="video"||!(r instanceof kr)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!oe("SIMULCAST")||s==="vp9"&&oe("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const a=s==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=t.attributes.ssrcs[0],d=t.attributes.ssrcGroups.find((m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId)),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<a;m++)t.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:$r(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),d&&(t.attributes.ssrcs.push({ssrcId:d.ssrcIds[1]+m,attributes:$r(c.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,d.ssrcIds[1]+m]}));t.attributes.ssrcGroups.unshift(h)}async function m7(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const a=(await s.createOffer()).sdp,{send:c,recv:d,sendrecv:h}=(function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},E=arguments.length>2?arguments[2]:void 0;const w=pT(E,m,g,"sendonly"),I=pT(E,m,g,"recvonly"),A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(qu(w,I,"videoExtensions",A,N,G),qu(w,I,"videoCodecs",A,N,G),qu(w,I,"audioExtensions",A,N,G),qu(w,I,"audioCodecs",A,N,G),oe("RAISE_H264_BASELINE_PRIORITY")){const F=[],z=[];if(G.videoCodecs.forEach(((ee,Z)=>{var ae;if(((ae=ee.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLocaleLowerCase())==="h264"){var ye,_e;const ue=G.videoCodecs[Z+1],Ae=ue&&v7(ee,ue),Ue=(ye=ee.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"],We=(_e=ee.fmtp)===null||_e===void 0?void 0:_e.parameters["packetization-mode"];!Ue||Ue!==oe("FIRST_H264_PROFILE_LEVEL_ID")||oe("FIRST_PACKETIZATION_MODE")&&We!==oe("FIRST_PACKETIZATION_MODE")?Ae?z.push([ee,ue]):z.push([ee]):Ae?F.push([ee,ue]):F.push([ee])}})),F.length>0&&z.length>0){M.debug("raising H264 baseline profile priority"),G.videoCodecs.forEach(((Z,ae)=>{var ye;if(((ye=Z.rtpMap)===null||ye===void 0?void 0:ye.encodingName.toLocaleLowerCase())==="h264"){const _e=v7(Z,G.videoCodecs[ae+1]),ue=F.shift()||z.shift()||[];ue.length>0&&(_e?G.videoCodecs.splice(ae,2,...ue):G.videoCodecs.splice(ae,1,...ue))}}));const ee=N.videoCodecs.filter((Z=>{var ae,ye;return((ae=Z.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLocaleLowerCase())==="h264"&&((ye=Z.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"])!==oe("FIRST_H264_PROFILE_LEVEL_ID")}));if(ee.length>0){const Z=eg(ee,N.videoCodecs).map((ye=>ye.payloadType)),ae=[...ee.map((ye=>ye.payloadType)),...Z];N.videoCodecs=N.videoCodecs.filter((ye=>!rt(ae).call(ae,ye.payloadType)))}oe("FILTER_SEND_H264_BASELINE")&&(A.videoCodecs=A.videoCodecs.filter((Z=>{var ae,ye;return!(((ae=Z.rtpMap)===null||ae===void 0?void 0:ae.encodingName.toLocaleLowerCase())==="h264"&&((ye=Z.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"])!==oe("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:A,recv:N,sendrecv:G}}return{send:A,recv:N,sendrecv:G}})(t,r,a);try{s.close()}catch{}return{send:c,recv:d,sendrecv:h}}function g7(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=pT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(qu(t,r,"videoExtensions",s,a,c),qu(t,r,"videoCodecs",s,a,c),qu(t,r,"audioExtensions",s,a,c),qu(t,r,"audioCodecs",s,a,c),oe("RAISE_H264_BASELINE_PRIORITY")){const d=c.videoCodecs.findIndex((h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f"));if(d!==-1){const h=c.videoCodecs.findIndex((m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"));if(h<d){M.debug("raising H264 baseline profile priority");const m=c.videoCodecs[d];c.videoCodecs.splice(d,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(a.videoCodecs=a.videoCodecs.filter((m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f"))))}}return{send:s,recv:a,sendrecv:c}}function qu(t,r,s,a,c,d){if(s==="videoExtensions"||s==="audioExtensions"){const h=[];return t[s].forEach((m=>{r[s].some(((g,E)=>{if(m.entry===g.entry&&m.extensionName===g.extensionName)return h.push(E),!0}))?d[s].push(m):a[s].push(m)})),void r[s].forEach(((m,g)=>{h.indexOf(g)===-1&&c[s].push(m)}))}if(s==="videoCodecs"||s==="audioCodecs"){const h=[];return t[s].forEach((m=>{r[s].some(((g,E)=>{if(m.payloadType===g.payloadType&&JSON.stringify(m)===JSON.stringify(g))return h.push(E),!0}))?d[s].push(m):a[s].push(m)})),void r[s].forEach(((m,g)=>{h.indexOf(g)===-1&&c[s].push(m)}))}}function q1(t){const{send:r,recv:s,sendrecv:a}=t;if(!a){if(!r||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:s}}let c,d;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...a.audioCodecs],c.videoCodecs=[...r.videoCodecs,...a.videoCodecs],c.audioExtensions=[...r.audioExtensions,...a.audioExtensions],c.videoExtensions=[...r.videoExtensions,...a.videoExtensions]):c=a,s?(d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d.audioCodecs=[...s.audioCodecs,...a.audioCodecs],d.videoCodecs=[...s.videoCodecs,...a.videoCodecs],d.audioExtensions=[...s.audioExtensions,...a.audioExtensions],d.videoExtensions=[...s.videoExtensions,...a.videoExtensions]):d=a,{send:c,recv:d}}function u0(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter((r=>{var s;return((s=r.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"})).forEach((r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"}))}function mT(t,r,s,a){let c=[];if(t===vt.VIDEO){if(oe("H264_PROFILE_LEVEL_ID")&&a==="h264"&&(c=r.videoCodecs.filter((d=>{var h;return rt(h=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"").call(h,a)&&d&&d.fmtp&&d.fmtp.parameters["profile-level-id"]===oe("H264_PROFILE_LEVEL_ID")}))),!Array.isArray(c)||c.length===0){let d=[];const h=[],m=[],g=[];if(s.videoCodecs.forEach((E=>{const w=E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||"";rt(w).call(w,a)?d.push(E):rt(w).call(w,"vp9")?h.push(E):rt(w).call(w,"vp8")?m.push(E):rt(w).call(w,"h264")&&g.push(E)})),d.length===0){let E="";h.length!==0?(d=h,E="vp9"):m.length!==0?(d=m,E="vp8"):g.length!==0&&(d=g,E="h264"),M.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(E))}d.length!==0&&(c=r.videoCodecs.filter((E=>d.some((w=>w.payloadType===E.payloadType)))))}if(c.length===0&&(M.warning("codec ".concat(a," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),oe("USE_PUB_RTX")||oe("USE_SUB_RTX")){const d=eg(c,r.videoCodecs);c=[...c,...d]}}else{c=r.audioCodecs.filter((h=>{var m;return rt(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,a)}));const d=r.audioCodecs.filter((h=>{var m;return rt(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,"red")}));c.length===0&&(M.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter((h=>{var m;return rt(m=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(m,"opus")}))),oe("ENABLE_AUDIO_RED")&&d.length!==0&&(c=[...d,...c])}return c}function eg(t,r){const s=t.map((a=>a.payloadType.toString()));return r.filter((a=>a.rtpMap&&a.rtpMap.encodingName==="rtx"&&a.fmtp&&a.fmtp.parameters.apt&&rt(s).call(s,a.fmtp&&a.fmtp.parameters.apt)))}async function tg(t,r,s){const a=r.toString(),c=y7(a,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:a});const d=await t.createAnswer();if(!d.sdp)throw new Error("cannot get answer sdp");let h=d.sdp;h=_7(h,s||{}),c==null||c(h||""),await t.setLocalDescription({type:"answer",sdp:h})}function _7(t,r,s){const a=tc(t),{useXR:c}=r;return a.mediaDescriptions.forEach((d=>{var h;d.attributes.mid&&(Array.isArray(s)&&!rt(s).call(s,d.attributes.mid)||(d.media.mediaType==="audio"&&u0(d),c&&rt(h=["audio","video"]).call(h,d.media.mediaType)&&d.attributes.payloads.forEach((m=>{m.rtcpFeedbacks.findIndex((g=>g.type==="rrtr"))===-1&&m.rtcpFeedbacks.push({type:"rrtr"})}))))})),Km(a)}function y7(t,r,s,a){if(oe("SDP_LOGGING"))return M.upload("exchanging ".concat(s," ").concat(r," SDP during P2PConnection.").concat(a,`
`),t),r==="offer"?c=>{y7(c,"answer",s==="local"?"remote":"local",a)}:void 0}function E7(t){const r=oe("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some((s=>rt(t).call(t,s)))}function v7(t,r){try{var s;return((s=t.fmtp)===null||s===void 0?void 0:s.parameters.apt)===r.payloadType.toString()}catch{return!1}}function S7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function pl(t,r){return typeof oe(t)===r?oe(t):void 0}function Fge(){try{const t=oe("EXPERIMENTS")||{};return typeof t=="string"||Array.isArray(t)?{}:(function(r){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?S7(Object(a),!0).forEach((function(c){X(r,c,a[c])})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):S7(Object(a)).forEach((function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(a,c))}))}return r})({},t)}catch(t){return M.debug("handle gateway attributes failed: ",t),{}}}const b7={};function ng(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&M.debug("install service ".concat(t.name)),b7[t.name]=t}function Ef(t){const r=b7[t];if(!r)throw new Le(te.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return r}function w7(t,r){return Ef("DataStream").create(t,r)}function Y1(){return Ef("InterceptFrame").create()}function T7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function wo(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?T7(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):T7(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}const O2=new Map;class Bge extends Qr{get state(){return this._state}set state(r){if(r===this._state)return;const s=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(hs.CONNECTION_STATE_CHANGE,r,s,this._disconnectedReason):this.emit(hs.CONNECTION_STATE_CHANGE,r,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){M.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,s){var a,c,d;super(),X(this,"store",void 0),X(this,"joinInfo",void 0),X(this,"key",void 0),X(this,"ntpOffset",0),X(this,"signal",void 0),X(this,"role",void 0),X(this,"isPreallocation",void 0),X(this,"isPreSub",void 0),X(this,"inChannelInfo",{joinAt:null,duration:0}),X(this,"spec",void 0),X(this,"_state","DISCONNECTED"),X(this,"_statsCollector",void 0),X(this,"_disconnectedReason",void 0),X(this,"isSignalRecover",!1),X(this,"hasChangeBGPAddress",!1),X(this,"trafficStatsInterval",void 0),X(this,"networkQualityInterval",void 0),X(this,"_joinGatewayStartTime",0),X(this,"_signalTimeout",!1),X(this,"_clientRoleOptions",void 0),X(this,"_isProactiveJoin",!1),this.store=r,this.spec=s,this.signal=this.store.useP2P?(a={spec:wo(wo({},s),{},{retryConfig:s.websocketRetryConfig}),store:r},(c=(d=Ef("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(d,a)):new Vge(wo(wo({},s),{},{retryConfig:s.websocketRetryConfig}),r),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}async join(r,s,a){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let d=O2.get(r.cname);if(d||(d=new Map,O2.set(r.cname,d)),this._isProactiveJoin=!0,d.has(r.uid)){const E=new ke(te.UID_CONFLICT);throw It.joinGateway(r.sid,{lts:c,succ:!1,ec:E.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),E}d.set(r.uid,!0),this.joinInfo=r,this.key=s;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{M.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const E=r.gatewayAddrs.map((w=>{let{address:I}=w;const[A,N]=I.split(":"),G={host:A,port:N};return r.proxyServer&&(G.proxy=r.proxyServer),G}));h=(await this.signal.init(E)).uid,M.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(E){var g;throw M.error("[".concat(this.store.clientId,"] User join failed"),E.toString()),It.joinGateway(r.sid,{lts:c,succ:!1,ec:((g=E.data)===null||g===void 0?void 0:g.desc)||E.code,errorMsg:E.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,isProxy:!!m,signalChannel:"0",preload:r.preload}),d.delete(r.uid),this.signal.close(),E}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),M.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((()=>{this.updateTrafficStats().catch((E=>{M.warning("[".concat(this.store.clientId,"] get traffic stats error"),E.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(hs.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(hs.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(hs.NETWORK_QUALITY,{uplinkNetworkQuality:i7(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:i7(this._statsCollector.trafficStats.B_dnq)}):this.emit(hs.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==sr.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==Pr.CONNECTED||await(function(a,c){return c===1/0?a:mt.race([a,hme(c)])})(this.signal.request(Jt.LEAVE,void 0,!0),3e3)}catch(a){M.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),a)}this.signal.close(s),s!==sr.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:oe("PUB_EXTEND"),twcc:!!oe("PUBLISH_TWCC"),rtx:!!oe("USE_PUB_RTX")};try{return(await this.signal.request(Jt.PUBLISH,c,!0))._message}catch(d){if(a&&d.data&&d.data.code===Ft.ERR_PUBLISH_REQUEST_INVALID)return M.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),d.toString()),await this.tryUnpubBeforeRepub(r,s),this.publish(r,s,!1);throw d}}async publishDataChannel(r,s,a){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const d={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(c=s.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(Jt.PUBLISH_DATASTREAM,d,!0)}catch(h){if(a&&h.data&&h.data.code===Ft.ERR_PUBLISH_REQUEST_INVALID)return M.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,s),this.publishDataChannel(r,s,!1);throw h}}async unpublish(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Jt.UNPUBLISH,{stream_id:s,ortc:r},!0)}catch(a){M.warning("[".concat(this.store.clientId,"] unpublish warning: "),a)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await mt.all(r.map((s=>this.signal.request(Jt.UNPUBLISH_DATASTREAM,{channel_id:s},!0))))}catch(s){M.warning("unpublish datachannels warning: ",s)}}async presubscribe(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!oe("SUBSCRIBE_TWCC"),rtx:!!oe("USE_SUB_RTX")||void 0,extend:oe("SUB_EXTEND"),svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return await this.signal.request(Jt.PRE_SUBSCRIBE,c,!0)}catch(d){if(a&&d.data&&d.data.code===Ft.ERR_SUBSCRIBE_REQUEST_INVALID)return M.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),d.toString()),this.presubscribe(r,s,!1);throw d}}async subscribe(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!oe("SUBSCRIBE_TWCC"),rtx:!!oe("USE_SUB_RTX"),extend:oe("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return(await this.signal.request(Jt.SUBSCRIBE,c,!0))._message}catch(d){if(a&&d.data&&d.data.code===Ft.ERR_SUBSCRIBE_REQUEST_INVALID)return M.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),d.toString()),await this.tryUnsubBeforeResub(r,s),await this.subscribe(r,s,!1);throw d}}async subscribeDataChannel(r,s,a){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(Jt.SUBSCRIBE_DATASTREAM,c,!0)}catch(d){if(a&&d.data&&d.data.code===Ft.ERR_SUBSCRIBE_REQUEST_INVALID)return M.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),d.toString()),await this.tryUnsubDataChannelBeforeResub(r,s),await this.subscribeDataChannel(r,s,!1);throw d}}async subscribeAll(r,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const a={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!oe("USE_SUB_RTX"),twcc:!!oe("SUBSCRIBE_TWCC"),svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return await this.signal.request(Jt.SUBSCRIBE_STREAMS,a,!0)}catch(c){if(s&&c.data&&c.data.code===Ft.ERR_SUBSCRIBE_REQUEST_INVALID)return M.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const s=(function(a){if(!(a.bitrateMax&&a.bitrateMin&&a.frameRate&&a.height&&a.width))return;let c=a.frameRate,d=a.width,h=a.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,d||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:d,height:h,fps:c,start_bps:1e3*a.bitrateMax,min_bps:1e3*a.bitrateMin,target_bps:1e3*a.bitrateMax}:void 0})(r);if(s)return this.signal.request(Jt.SET_VIDEO_PROFILE,s);M.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,s){try{await this.signal.request(Jt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:s},!0)}catch(a){M.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),a)}}async unsubscribeDataChannel(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await mt.all(r.map((a=>this.signal.request(Jt.UNSUBSCRIBE_DATASTREAM,{stream_id:a,uid:s},!0))))}catch(a){M.warning("unsubscribeDataChannel warning: ",a)}}async massUnsubscribe(r){try{await this.signal.request(Jt.UNSUBSCRIBE_STREAMS,r,!0)}catch(s){M.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(r){const{iceParameters:s,dtlsParameters:a,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(Jt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:a,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Jt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(Jt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,s){s&&(this._clientRoleOptions=Object.assign({},s)),oe("CLIENT_ROLE_OPTIONS")&&(M.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(oe("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},oe("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),oe("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},oe("CLIENT_ROLE_OPTIONS")),M.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(oe("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let a,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(a=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0;const d=Object.assign({},s);delete d.delay,delete d.level,await this.signal.request(Jt.SET_CLIENT_ROLE,wo(wo({role:r,level:c,delay:a},d),{},{client_ts:Date.now()})),this.role=r}async setRemoteVideoStreamType(r,s){await this.signal.request(Jt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:s})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(Jt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,s){await this.signal.request(Jt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:s})}async pickSVCLayer(r,s){await this.signal.request(Jt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(r){await this.signal.request(Jt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,s,a){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,s,a)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),wo({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Jt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=O2.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=(function(s){let a;return a=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),a?{username:Bs.username,password:Bs.password,turnServerURL:a[2],tcpport:parseInt(a[3])+30,udpport:parseInt(a[3])+30,forceturn:!1}:null})((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(wo(wo({},Bs),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(Jt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach((s=>{const a=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find((c=>c.peer_uid===s.peer_uid));a&&a.B_st!==s.B_st&&f1((()=>{this.emit(hs.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)}))})),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){var s,a;if(!this.joinInfo||!this.key)throw new ke(te.UNEXPECTED_ERROR,"can not generate join message, no join info");const c=Object.assign({},this.joinInfo.apResponse);let d=oe("REPORT_APP_SCENARIO");if(typeof d!="string")try{d=JSON.stringify(d)}catch{d=void 0}var h;d&&d.length>128&&(d=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(hs.UPDATE_GATEWAY_CONFIG),h=this.store.clientId,rt(r0).call(r0,h)||r0.push(h);const m=HL(this.store),g=!((s=this.isPreallocation)===null||s===void 0||!s.call(this)),E=I9(this.store),w=Fge(),I=Vv(87)||Mz()||EL(117),A=((function(){const G=Ln();if(G.name!==qn.SAFARI||!G.browserVersion)return!1;const F=G.browserVersion.split(".");return Number(F[0])>18||Number(F[0])===18&&Number(F[1])>=4})()||Fz(18,4,!1))&&vL(18,6,!0)&&this.spec.codec==="h264"&&oe("ENABLE_ABSSENDTIME_AS_SENTTS"),N=wo({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Jl,browser:navigator.userAgent,process_id:oe("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:c,extend:oe("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:d,attributes:{userAttributes:wo(wo({enableEncodedTransform:(!!oe("ENABLE_AUDIO_METADATA")||!!oe("ENABLE_AUDIO_PTS"))&&I||!!oe("ENABLE_AUDIO_TOPN")&&_L(qn.CHROME,87,116)||void 0,enableAudioMetadata:!!oe("ENABLE_AUDIO_METADATA")&&I,enableAudioPts:!!oe("ENABLE_AUDIO_PTS")&&I,topnSmoothLevel:oe("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:oe("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:oe("TOPN_SWITCH_HOLD_MS"),topnAudioGain:oe("TOPN_AUDIO_GAIN"),enablePublishedUserList:oe("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:oe("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:pl("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:pl("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:pl("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:oe("USE_PUB_RTX")===!0||oe("USE_SUB_RTX")===!0||void 0,disableFEC:oe("DISABLE_FEC"),enableNTPReport:!!oe("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:E,enableFulllinkAvSync:!!oe("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:pl("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!oe("FORCE_ENABLE_AUT_CC")||!S1()&&(!!oe("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!oe("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:pl("USE_XR","boolean"),enableLossbasedBwe:pl("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!oe("FORCE_ENABLE_AUT_CC")||!S1()&&(!!oe("ENABLE_AUT_CC")||void 0),enableCCFallback:pl("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:g,preSubNum:m?pl("PRE_SUB_NUM","number"):void 0,enablePubTWCC:pl("PUBLISH_TWCC","boolean"),enableSubTWCC:pl("SUBSCRIBE_TWCC","boolean"),enablePubRTX:pl("USE_PUB_RTX","boolean"),enableSubRTX:pl("USE_SUB_RTX","boolean"),enableSubSVC:oe("ENABLE_SVC")?oe("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0,enableSvcExtended:oe("ENABLE_SVC")&&Array.isArray(oe("SVC_EXTENDED"))&&oe("SVC_EXTENDED").length!==0?oe("SVC_EXTENDED"):void 0},w),{},{audioDuplicate:pl("ENABLE_AUDIO_RED","boolean")?(a=pl("AUDIO_DUPLICATE_NUM","number"))!==null&&a!==void 0?a:2:void 0,senttsUsesAbsSendTime:!!A||void 0})},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(N.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(N.aes_mode=this.joinInfo.aesmode,oe("ENCRYPT_AES")?(N.aes_secret=this.joinInfo.aespassword,N.aes_encrypt=!0):N.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(N.aes_salt=this.joinInfo.aessalt)),c.addresses[this.signal.websocket.currentURLIndex]&&(N.ap_response.ticket=c.addresses[this.signal.websocket.currentURLIndex].ticket,delete c.addresses),this.joinInfo.defaultVideoStream!==void 0&&(N.default_video_stream=this.joinInfo.defaultVideoStream),N}getRejoinMessage(){if(!this.joinInfo)throw new ke(te.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(en.WS_RECONNECT_CREATE_CONNECTION,(r=>{this.joinGatewayStartTime=Date.now()})),this.signal.on(en.WS_RECONNECTING,(r=>{this.joinInfo&&It.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||js.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",It.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())})),this.signal.on(en.WS_CLOSED,(r=>{let s;switch(r){case sr.LEAVE:s=js.LEAVE;break;case sr.UID_BANNED:case sr.IP_BANNED:case sr.CHANNEL_BANNED:case sr.SERVER_ERROR:s=js.SERVER_ERROR;break;case sr.FALLBACK:s=js.FALLBACK;break;case sr.LICENSE_MISSING:case sr.LICENSE_EXPIRED:case sr.LICENSE_MINUTES_EXCEEDED:case sr.LICENSE_PERIOD_INVALID:case sr.LICENSE_MULTIPLE_SDK_SERVICE:case sr.LICENSE_ILLEGAL:case sr.TOKEN_EXPIRE:s=r;break;default:s=js.NETWORK_ERROR}M.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+js.NETWORK_ERROR)),this.joinInfo&&It.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===sr.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=r,r!==sr.FALLBACK&&(this.state="DISCONNECTED"),this.reset()})),this.signal.on(en.WS_CONNECTED,(()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=oe("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(M.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(It.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void M.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));mr("EVENT_REPORT_DOMAIN",r[1]),mr("EVENT_REPORT_BACKUP_DOMAIN",r[1]),mr("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}})),this.signal.on(Pn.ON_UPLINK_STATS,(r=>{this._statsCollector.updateUplinkStats(r)})),this.signal.on(en.REQUEST_RECOVER,((r,s,a)=>{if(!this.joinInfo)return a(new ke(te.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Fs(this,hs.REQUEST_NEW_GATEWAY_LIST).then(s).catch(a)})),this.signal.on(en.REQUEST_JOIN_INFO,(async(r,s,a)=>{var c,d,h;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const m=$r((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(oe("NEW_TURN_MODE")&&m&&((d=this.joinInfo)===null||d===void 0?void 0:d.cloudProxyServer)==="disabled"){var g;let A=m.servers.map((F=>"turnServerURL"in F&&oe("USE_TURN_IP")?wo(wo({},F),{},{turnServerURL:W1(F.turnServerURL)}):F)),N=(g=m.serversFromGateway)===null||g===void 0?void 0:g.map((F=>oe("USE_TURN_IP")?wo(wo({},F),{},{turnServerURL:W1(F.turnServerURL)}):F));const G=this.signal.currentURLIndex;A.length>0&&(A=[A[G%A.length]],m.servers=A),Array.isArray(N)&&N.length>0&&(N=[N[0]],m.serversFromGateway=N),M.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(G))}const{iceParameters:E,dtlsParameters:w,rtpCapabilities:I}=await Fs(this,hs.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:m,cloudProxyServer:(h=this.joinInfo)===null||h===void 0?void 0:h.cloudProxyServer});try{r(this.getJoinMessage({ortc:{iceParameters:E,dtlsParameters:w,rtpCapabilities:I,version:"2"}}))}catch(A){s(A)}})),this.signal.on(en.REQUEST_REJOIN_INFO,(r=>{r(this.getRejoinMessage())})),this.signal.on(en.REPORT_JOIN_GATEWAY,((r,s)=>{if(!this.joinInfo)return;let a,c="";var d;r instanceof ke?(a=((d=r.data)===null||d===void 0?void 0:d.desc)||r.code,c=r.message):a=r,It.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:a,errorMsg:c,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})})),this.signal.on(en.IS_P2P_DISCONNECTED,(r=>{r(Zw(this,hs.IS_P2P_DISCONNECTED))})),this.signal.on(en.DISCONNECT_P2P,(()=>{this.emit(hs.DISCONNECT_P2P)})),this.signal.on(en.REQUEST_SUCCESS,(()=>{this._signalTimeout=!1})),this.signal.on(en.REQUEST_TIMEOUT,(()=>{this._signalTimeout=!0})),this.signal.on(en.JOIN_RESPONSE,(r=>{const s=this.getCurrentGatewayAddress();this.emit(hs.JOIN_RESPONSE,r,s)})),this.signal.on(en.PRE_CONNECT_PC,(async()=>{if(this.joinInfo){var r,s;this.updateTurnConfigFromSignal();const c=this.getCurrentGatewayAddress(),d=$r((r=this.joinInfo)===null||r===void 0?void 0:r.turnServer);if(oe("NEW_TURN_MODE")&&d&&((s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer)==="disabled"){var a;let m=d.servers.map((w=>"turnServerURL"in w&&oe("USE_TURN_IP")?wo(wo({},w),{},{turnServerURL:W1(w.turnServerURL)}):w)),g=(a=d.serversFromGateway)===null||a===void 0?void 0:a.map((w=>oe("USE_TURN_IP")?wo(wo({},w),{},{turnServerURL:W1(w.turnServerURL)}):w));const E=this.signal.currentURLIndex;m.length>0&&(m=[m[E%m.length]],d.servers=m),Array.isArray(g)&&g.length>0&&(g=[g[0]],d.serversFromGateway=g),M.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(E,",in pre pc"))}const h=oe("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(c&&h){const m=h7(c);this.emit(hs.PRE_CONNECT_PC,{candidates:m,fingerprint:h,turnServer:d})}}})),this.signal.on(en.RECOVER_NOTIFICATION,(r=>{this.joinInfo&&typeof oe("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(oe("AP_REQUEST_DETAIL"),";").concat(r))}))}async tryUnsubBeforeResub(r,s){try{await this.signal.request(Jt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[s]},!0)}catch(a){throw M.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),a),a}}async tryUnsubDataChannelBeforeResub(r,s){try{await this.signal.request(Jt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(a){throw M.warning("unsubscribe datachannel warning",a),a}}async tryUnpubBeforeRepub(r,s){try{await this.signal.request(Jt.UNPUBLISH,{stream_id:r,ortc:s},!0)}catch(a){throw M.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),a),a}}async tryUnpubDataChannelBeforeRepub(r,s){try{await this.signal.request(Jt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(a){throw M.warning("unpublish datastream warning: ",a),a}}async tryMassUnsubBeforeResub(r){const s={users:r.map((a=>({stream_id:a.stream_id,stream_type:a.stream_type})))};try{await this.signal.request(Jt.UNSUBSCRIBE_STREAMS,s,!0)}catch(a){throw M.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),a),a}}async muteLocal(r,s){const a={action:r.find((c=>c.stream_type===cr.Audio))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Jt.CONTROL,a,!0,!0)}catch(c){throw M.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,s){const a={action:r.find((c=>c.stream_type===cr.Audio))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Jt.CONTROL,a,!0,!0)}catch(c){throw M.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,s){const a={action:r===vt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Jt.CONTROL,a,!0,!0)}catch(c){throw M.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,s){const a={action:r===vt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Jt.CONTROL,a,!0,!0)}catch(c){throw M.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,s){this.signal.upload(r,s)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(Jt.RESTART_ICE,s,!0)}catch(a){throw M.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),a),a}}reconnect(r,s){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,s||js.P2P_FAILED)}getCurrentGatewayAddress(){var r,s;if(!oe("GATEWAY_WSS_ADDRESS"))return oe("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(M.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(Jt.SET_PARAMETER,{enablePublishAudioFilter:r})}downgradeCodec(r){this.signal.downgradeCodec(r)}}let X1=0,k2=0;function Qd(t,r,s,a){return new mt(((c,d)=>{r.timeout=r.timeout||oe("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),X1+=Zh(r.data)):s&&(r.data.size?X1+=r.data.size:r.data instanceof FormData?X1+=n9(r.data):X1+=Zh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=t,ka.request(r).then((h=>{typeof h.data=="string"?k2+=Zh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?k2+=h.data.byteLength:k2+=Zh(JSON.stringify(h.data)),a&&c({data:h.data,headers:h.headers}),c(h.data)})).catch((h=>{ka.isCancel(h)?d(new ke(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?d(new ke(te.NETWORK_TIMEOUT,h.message)):h.response?d(new ke(te.NETWORK_RESPONSE_ERROR,h.response.status)):d(new ke(te.NETWORK_ERROR,h.message))}))}))}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function r(ze){var ot=0;return function(){return ot<ze.length?{done:!1,value:ze[ot++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(ze,ot,bt){return ze==Array.prototype||ze==Object.prototype||(ze[ot]=bt.value),ze},a,c=(function(ze){ze=[typeof globalThis=="object"&&globalThis,ze,typeof window=="object"&&window,typeof self=="object"&&self,typeof o=="object"&&o];for(var ot=0;ot<ze.length;++ot){var bt=ze[ot];if(bt&&bt.Math==Math)return bt}throw Error("Cannot find global object")})(this);function d(ze,ot){if(ot)e:{var bt=c;ze=ze.split(".");for(var He=0;He<ze.length-1;He++){var V=ze[He];if(!(V in bt))break e;bt=bt[V]}(ot=ot(He=bt[ze=ze[ze.length-1]]))!=He&&ot!=null&&s(bt,ze,{configurable:!0,writable:!0,value:ot})}}function h(ze){return(ze={next:ze})[Symbol.iterator]=function(){return this},ze}function m(ze){var ot=typeof Symbol<"u"&&Symbol.iterator&&ze[Symbol.iterator];return ot?ot.call(ze):{next:r(ze)}}if(d("Symbol",(function(ze){function ot(V,ce){this.A=V,s(this,"description",{configurable:!0,writable:!0,value:ce})}if(ze)return ze;ot.prototype.toString=function(){return this.A};var bt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",He=0;return function V(ce){if(this instanceof V)throw new TypeError("Symbol is not a constructor");return new ot(bt+(ce||"")+"_"+He++,ce)}})),d("Symbol.iterator",(function(ze){if(ze)return ze;ze=Symbol("Symbol.iterator");for(var ot="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),bt=0;bt<ot.length;bt++){var He=c[ot[bt]];typeof He=="function"&&typeof He.prototype[ze]!="function"&&s(He.prototype,ze,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return ze})),typeof Object.setPrototypeOf=="function")a=Object.setPrototypeOf;else{var g;e:{var E={};try{E.__proto__={a:!0},g=E.a;break e}catch{}g=!1}a=g?function(ze,ot){if(ze.__proto__=ot,ze.__proto__!==ot)throw new TypeError(ze+" is not extensible");return ze}:null}var w=a;function I(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function A(ze){if(ze.m)throw new TypeError("Generator is already running");ze.m=!0}function N(ze,ot){return ze.h=3,{value:ot}}function G(ze){this.g=new I,this.G=ze}function F(ze,ot,bt,He){try{var V=ot.call(ze.g.j,bt);if(!(V instanceof Object))throw new TypeError("Iterator result "+V+" is not an object");if(!V.done)return ze.g.m=!1,V;var ce=V.value}catch(ge){return ze.g.j=null,ze.g.s(ge),z(ze)}return ze.g.j=null,He.call(ze.g,ce),z(ze)}function z(ze){for(;ze.g.h;)try{var ot=ze.G(ze.g);if(ot)return ze.g.m=!1,{value:ot.value,done:!1}}catch(bt){ze.g.v=void 0,ze.g.s(bt)}if(ze.g.m=!1,ze.g.l){if(ot=ze.g.l,ze.g.l=null,ot.F)throw ot.D;return{value:ot.return,done:!0}}return{value:void 0,done:!0}}function ee(ze){this.next=function(ot){return ze.o(ot)},this.throw=function(ot){return ze.s(ot)},this.return=function(ot){return(function(bt,He){A(bt.g);var V=bt.g.j;return V?F(bt,"return"in V?V.return:function(ce){return{value:ce,done:!0}},He,bt.g.return):(bt.g.return(He),z(bt))})(ze,ot)},this[Symbol.iterator]=function(){return this}}function Z(ze,ot){return ot=new ee(new G(ot)),w&&ze.prototype&&w(ot,ze.prototype),ot}if(I.prototype.o=function(ze){this.v=ze},I.prototype.s=function(ze){this.l={D:ze,F:!0},this.h=this.C||this.u},I.prototype.return=function(ze){this.l={return:ze},this.h=this.u},G.prototype.o=function(ze){return A(this.g),this.g.j?F(this,this.g.j.next,ze,this.g.o):(this.g.o(ze),z(this))},G.prototype.s=function(ze){return A(this.g),this.g.j?F(this,this.g.j.throw,ze,this.g.o):(this.g.s(ze),z(this))},d("Array.prototype.entries",(function(ze){return ze||function(){return(function(ot,bt){ot instanceof String&&(ot+="");var He=0,V=!1,ce={next:function(){if(!V&&He<ot.length){var ge=He++;return{value:bt(ge,ot[ge]),done:!1}}return V=!0,{done:!0,value:void 0}}};return ce[Symbol.iterator]=function(){return ce},ce})(this,(function(ot,bt){return[ot,bt]}))}})),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ae=function(ze,ot){for(var bt=0;bt<ze.length;bt++)ot(ze[bt])},ye=function(ze){return ze.replace(/\r?\n|\r/g,`\r
`)},_e=function(ze,ot,bt){return ot instanceof Blob?(bt=bt!==void 0?bt+"":typeof ot.name=="string"?ot.name:"blob",ot.name===bt&&Object.prototype.toString.call(ot)!=="[object Blob]"||(ot=new File([ot],bt)),[String(ze),ot]):[String(ze),String(ot)]},ue=function(ze,ot){if(ze.length<ot)throw new TypeError(ot+" argument required, but only "+ze.length+" present.")},Ae=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ue=Ae.FormData,We=Ae.XMLHttpRequest&&Ae.XMLHttpRequest.prototype.send,Ze=Ae.Request&&Ae.fetch,_n=Ae.navigator&&Ae.navigator.sendBeacon,Sn=Ae.Element&&Ae.Element.prototype,Qt=Ae.Symbol&&Symbol.toStringTag;Qt&&(Blob.prototype[Qt]||(Blob.prototype[Qt]="Blob"),"File"in Ae&&!File.prototype[Qt]&&(File.prototype[Qt]="File"));try{new File([],"")}catch{Ae.File=function(ot,bt,He){return ot=new Blob(ot,He||{}),Object.defineProperties(ot,{name:{value:bt},lastModified:{value:+(He&&He.lastModified!==void 0?new Date(He.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Qt&&Object.defineProperty(ot,Qt,{value:"File"}),ot}}var rr=function(ze){return ze.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Jn=function(ze){this.i=[];var ot=this;ze&&ae(ze.elements,(function(bt){if(bt.name&&!bt.disabled&&bt.type!=="submit"&&bt.type!=="button"&&!bt.matches("form fieldset[disabled] *"))if(bt.type==="file"){var He=bt.files&&bt.files.length?bt.files:[new File([],"",{type:"application/octet-stream"})];ae(He,(function(V){ot.append(bt.name,V)}))}else bt.type==="select-multiple"||bt.type==="select-one"?ae(bt.options,(function(V){!V.disabled&&V.selected&&ot.append(bt.name,V.value)})):bt.type==="checkbox"||bt.type==="radio"?bt.checked&&ot.append(bt.name,bt.value):(He=bt.type==="textarea"?ye(bt.value):bt.value,ot.append(bt.name,He))}))};if((t=Jn.prototype).append=function(ze,ot,bt){ue(arguments,2),this.i.push(_e(ze,ot,bt))},t.delete=function(ze){ue(arguments,1);var ot=[];ze=String(ze),ae(this.i,(function(bt){bt[0]!==ze&&ot.push(bt)})),this.i=ot},t.entries=function ze(){var ot,bt=this;return Z(ze,(function(He){if(He.h==1&&(ot=0),He.h!=3)return ot<bt.i.length?He=N(He,bt.i[ot]):(He.h=0,He=void 0),He;ot++,He.h=2}))},t.forEach=function(ze,ot){ue(arguments,1);for(var bt=m(this),He=bt.next();!He.done;He=bt.next()){var V=m(He.value);He=V.next().value,V=V.next().value,ze.call(ot,V,He,this)}},t.get=function(ze){ue(arguments,1);var ot=this.i;ze=String(ze);for(var bt=0;bt<ot.length;bt++)if(ot[bt][0]===ze)return ot[bt][1];return null},t.getAll=function(ze){ue(arguments,1);var ot=[];return ze=String(ze),ae(this.i,(function(bt){bt[0]===ze&&ot.push(bt[1])})),ot},t.has=function(ze){ue(arguments,1),ze=String(ze);for(var ot=0;ot<this.i.length;ot++)if(this.i[ot][0]===ze)return!0;return!1},t.keys=function ze(){var ot,bt,He,V,ce=this;return Z(ze,(function(ge){if(ge.h==1&&(ot=m(ce),bt=ot.next()),ge.h!=3)return bt.done?void(ge.h=0):(He=bt.value,V=m(He),N(ge,V.next().value));bt=ot.next(),ge.h=2}))},t.set=function(ze,ot,bt){ue(arguments,2),ze=String(ze);var He=[],V=_e(ze,ot,bt),ce=!0;ae(this.i,(function(ge){ge[0]===ze?ce&&(ce=!He.push(V)):He.push(ge)})),ce&&He.push(V),this.i=He},t.values=function ze(){var ot,bt,He,V,ce=this;return Z(ze,(function(ge){if(ge.h==1&&(ot=m(ce),bt=ot.next()),ge.h!=3)return bt.done?void(ge.h=0):(He=bt.value,(V=m(He)).next(),N(ge,V.next().value));bt=ot.next(),ge.h=2}))},Jn.prototype._asNative=function(){for(var ze=new Ue,ot=m(this),bt=ot.next();!bt.done;bt=ot.next()){var He=m(bt.value);bt=He.next().value,He=He.next().value,ze.append(bt,He)}return ze},Jn.prototype._blob=function(){var ze="----formdata-polyfill-"+Math.random(),ot=[],bt="--"+ze+`\r
Content-Disposition: form-data; name="`;return this.forEach((function(He,V){return typeof He=="string"?ot.push(bt+rr(ye(V))+`"\r
\r
`+ye(He)+`\r
`):ot.push(bt+rr(ye(V))+'"; filename="'+rr(He.name)+`"\r
Content-Type: `+(He.type||"application/octet-stream")+`\r
\r
`,He,`\r
`)})),ot.push("--"+ze+"--"),new Blob(ot,{type:"multipart/form-data; boundary="+ze})},Jn.prototype[Symbol.iterator]=function(){return this.entries()},Jn.prototype.toString=function(){return"[object FormData]"},Sn&&!Sn.matches&&(Sn.matches=Sn.matchesSelector||Sn.mozMatchesSelector||Sn.msMatchesSelector||Sn.oMatchesSelector||Sn.webkitMatchesSelector||function(ze){for(var ot=(ze=(this.document||this.ownerDocument).querySelectorAll(ze)).length;0<=--ot&&ze.item(ot)!==this;);return-1<ot}),Qt&&(Jn.prototype[Qt]="FormData"),We){var co=Ae.XMLHttpRequest.prototype.setRequestHeader;Ae.XMLHttpRequest.prototype.setRequestHeader=function(ze,ot){co.call(this,ze,ot),ze.toLowerCase()==="content-type"&&(this.B=!0)},Ae.XMLHttpRequest.prototype.send=function(ze){ze instanceof Jn?(ze=ze._blob(),this.B||this.setRequestHeader("Content-Type",ze.type),We.call(this,ze)):We.call(this,ze)}}Ze&&(Ae.fetch=function(ze,ot){return ot&&ot.body&&ot.body instanceof Jn&&(ot.body=ot.body._blob()),Ze.call(this,ze,ot)}),_n&&(Ae.navigator.sendBeacon=function(ze,ot){return ot instanceof Jn&&(ot=ot._asNative()),_n.call(this,ze,ot)}),Ae.FormData=Jn}})();const gT=()=>{const t=oe("AREAS");return t.length===0&&t.push(er.GLOBAL),Ya(t).call(t,((r,s,a)=>{const c=C7(s);return c?a===0?c:"".concat(r,",").concat(c):r}),"")},C7=t=>t===er.OVERSEA?"".concat(so.ASIA,",").concat(so.EUROPE,",").concat(so.AFRICA,",").concat(so.NORTH_AMERICA,",").concat(so.SOUTH_AMERICA,",").concat(so.OCEANIA):so[t],zge=t=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map((s=>{const a=B1[s],c=Object.keys(a);c&&c.map((d=>{d!=="CODE"&&(r[d]=r[d].concat(a[d]))}))})),r},J1={GLOBAL:{ASIA:[er.CHINA,er.JAPAN,er.INDIA,er.KOREA,er.HKMC],EUROPE:[],NORTH_AMERICA:[er.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Q1=Object.keys(J1[er.GLOBAL]),N2=[er.CHINA,er.NORTH_AMERICA,er.EUROPE,er.ASIA,er.JAPAN,er.INDIA,er.OCEANIA,er.SOUTH_AMERICA,er.AFRICA,er.KOREA,er.HKMC,er.US],Wge=function(t,r){let s=[];if(rt(t).call(t,er.GLOBAL)){const d=[er.GLOBAL,er.OVERSEA],h=Object.keys(B1);if(r===er.GLOBAL)throw new ke(te.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===er.CHINA)s=[er.OVERSEA];else if(c=r,rt(Q1).call(Q1,c)){const m=(a=r,J1[er.GLOBAL][a]||[]),g=[...d,r,...m];s=h.filter((E=>!rt(g).call(g,E)))}else if((function(m){let g=!1;return Q1.forEach((E=>{var w;rt(w=J1[er.GLOBAL][E]).call(w,m)&&(g=!0)})),g})(r)){const m=(function(E){let w;return Q1.forEach((I=>{var A;rt(A=J1[er.GLOBAL][I]).call(A,E)&&(w=I)})),w})(r),g=[...d,m,r];s=h.filter((E=>!rt(g).call(g,E)))}else s=t;s=(function(m){const g=[];return N2.forEach((E=>{rt(m).call(m,E)&&g.push(E)})),g.concat(m.filter((E=>!rt(N2).call(N2,E))))})(s)}else s=t;var a,c;return s};function R7(t){var r,s;if(!t&&rt(r=oe("AREAS")).call(r,er.EXTENSIONS))return M.debug("update area from ap : reset"),void x2(Jme,!0);if(!rt(s=oe("AREAS")).call(s,er.GLOBAL)||!t)return;let a=B1.EXTENSIONS;a&&(a={CODE:C7(er.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},M.debug("update area from ap success: ".concat(t,",config is "),a),mr("AREAS",[er.EXTENSIONS],!0),Object.keys(a).map((c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?mr(c,a[c][0]):mr(c,a[c])})))}function x2(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=It.reportApiInvoke(null,{name:di.SET_AREA,options:t,tag:Hr.TRACER});try{let a=[];if(typeof t=="string"&&(a=[t]),Array.isArray(t)&&(t.forEach((d=>{if(!rt(KG).call(KG,d))throw new ke(te.INVALID_PARAMS,"invalid area code")})),a=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:d,excludedArea:h}=t;if(!d)throw new ke(te.INVALID_PARAMS,"area code is needed");let m=d;typeof d=="string"&&(m=[d]),a=h?Wge(m,h):m}if(!r){if(qd.AREAS){const d=new ke(te.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(d),void M.warning("setArea is prohibited because of config-distribute")}if(rt(a).call(a,er.GLOBAL)&&oe("AREAS")===er.EXTENSIONS){const d=new ke(te.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(d),void M.warning("setArea is prohibited because of ap extensions")}}mr("AREAS",a,r);const c=zge(a);Object.keys(c).map((d=>{d==="LOG_UPLOAD_SERVER"||d==="EVENT_REPORT_DOMAIN"||d==="EVENT_REPORT_BACKUP_DOMAIN"||d==="PROXY_SERVER_TYPE3"?mr(d,c[d][0]):mr(d,c[d])})),M.debug("set area success:",a.join(","))}catch(a){throw s.onError(a),a}s.onSuccess()}function I7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function sp(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?I7(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):I7(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}let D2=1;function Gge(t,r,s,a,c){D2+=1;const d={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:D2,requestId:D2,version:Jl,cname:s.cname},h={service_name:r,json_body:JSON.stringify(d)};let m,g,E=t[0];return Kd((async()=>{m=Date.now();const w=await Qd(E,{data:h,cancelToken:a,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(g=Date.now()-m,w.code!==0){const N=new ke(te.UNEXPECTED_RESPONSE,"live streaming ap error, code"+w.code,{retry:!0,responseTime:g});throw M.error(N.toString()),N}const I=JSON.parse(w.json_body);if(I.code!==200){const N=new ke(te.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(I.code,", reason: ").concat(I.reason),{code:I.code,responseTime:g});throw M.error(N.toString()),N}if(!I.servers||I.servers.length===0){const N=new ke(te.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:I.code,responseTime:g});throw M.error(N.toString()),N}const A=(function(N,G){return{addressList:N.servers.map((F=>"wss://".concat(F.address.replace(/\./g,"-"),".").concat(oe("WORKER_DOMAIN"),":").concat(F.wss,"?serviceName=").concat(encodeURIComponent(G)))),workerToken:N.workerToken,vid:N.vid}})(I,r);return oe("LIVE_STREAMING_ADDRESS")&&(A.addressList=oe("LIVE_STREAMING_ADDRESS")instanceof Array?oe("LIVE_STREAMING_ADDRESS"):[oe("LIVE_STREAMING_ADDRESS")]),sp(sp({},A),{},{responseTime:g})}),((w,I)=>(It.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(w.addressList),firstSuccess:I===0,responseTime:g,serverIp:t[I%t.length]}),!1)),((w,I)=>(It.apworkerEvent(s.sid,{success:!1,sc:w.data&&w.data.code||200,serviceName:r,responseTime:g,serverIp:t[I%t.length]}),!!(w.code!==te.OPERATION_ABORTED&&w.code!==te.UNEXPECTED_RESPONSE||w.data&&w.data.retry)&&(E=t[(I+1)%t.length],!0))),c)}let L2=1;function A7(t,r,s,a){let{url:c,areaCode:d}=t;const{clientId:h,sid:m}=r,g=Date.now();let E;const w=r.role,[I,A]=U2(r,d,[Ri.CHOOSE_SERVER]);let N=Ci.networkState;return Kd((async()=>{N&&Ci.networkState===Oc.OFFLINE&&Ci.onlineWaiter&&await mt.race([Ci.onlineWaiter,bs(a&&a.maxRetryTimeout||Ni.maxRetryTimeout)]),N=Ci.networkState;const{data:G,headers:F}=await Qd(c,{data:I,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);E=F.http3==="1"?1:-1,It.reportResourceTiming(c,m),O7(G,c,r,g,[Ri.CHOOSE_SERVER],E);const z=hT(G,Ri.CHOOSE_SERVER);return M2(z),R2(z,c)}),(G=>(G&&It.joinChooseServer(m,{role:w,lts:g,succ:!0,csAddr:c,opid:A,serverList:G.gatewayAddrs.map((F=>F.address)),ec:null,cid:G.cid.toString(),uid:G.uid.toString(),csIp:G.csIp,unilbsServerIds:[Ri.CHOOSE_SERVER].toString(),isHttp3:E,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:G.res.detail&&G.res.detail[38]}),!1)),(G=>G.code!==te.OPERATION_ABORTED&&(G.code===te.CAN_NOT_GET_GATEWAY_SERVER?G.data.retry:(It.joinChooseServer(m,{role:w,lts:g,succ:!1,csAddr:c,serverList:null,opid:A,ec:G.code,csIp:G.data&&G.data.csIp,unilbsServerIds:[Ri.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:N}),isHttp3:E,corssRegionTagReq:r.apRequestDetail}),M.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),G),!0))),a)}function P7(t,r,s,a){let c,{url:d,areaCode:h,serviceIds:m}=t;const g=Date.now(),E=r.role,[w,I]=U2(r,h,m);let A;return Kd((async()=>{A&&Ci.networkState===Oc.OFFLINE&&Ci.onlineWaiter&&await mt.race([Ci.onlineWaiter,bs(a&&a.maxRetryTimeout||Ni.maxRetryTimeout)]),A=Ci.networkState;const{data:N,headers:G}=await Qd(d,{data:w,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=G.http3==="1"?1:-1,It.reportResourceTiming(d,r.sid),O7(N,d,r,g,m,c);const F=hT(N,Ri.CHOOSE_SERVER),z=hT(N,r.cloudProxyServer==="proxy5"?Ri.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?Ri.CLOUD_PROXY:Ri.CLOUD_PROXY_FALLBACK),ee=performance.getEntriesByName(d),Z=ee[ee.length-1];let ae;return Z&&(ae={name:Z.name,protocol:"nextHopProtocol"in Z?Z.nextHopProtocol:"",dnscost:"domainLookupEnd"in Z&&"domainLookupStart"in Z&&typeof Z.domainLookupEnd=="number"&&typeof Z.domainLookupStart=="number"?Z.domainLookupEnd-Z.domainLookupStart:-1,tcpTlsCost:"connectEnd"in Z&&"connectStart"in Z&&typeof Z.connectEnd=="number"&&typeof Z.connectStart=="number"?Z.connectEnd-Z.connectStart:-1,reqCost:"requestStart"in Z&&typeof Z.requestStart=="number"&&"responseEnd"in Z&&typeof Z.responseEnd=="number"?Z.responseEnd-Z.requestStart:-1,handleCost:"leave_ts"in N&&"enter_ts"in N&&typeof N.leave_ts=="number"&&typeof N.enter_ts=="number"?N.leave_ts-N.enter_ts:-1}),M2(F),{gatewayInfo:R2(F,d),proxyInfo:z,url:d,resourceTimingInfo:ae}}),(N=>(N.gatewayInfo&&It.joinChooseServer(r.sid,{role:E,lts:g,succ:!0,csAddr:d,serverList:N.gatewayInfo.gatewayAddrs.map((G=>G.address)),ec:null,opid:I,cid:N.gatewayInfo.cid.toString(),uid:N.gatewayInfo.uid.toString(),csIp:N.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:N.gatewayInfo.res.detail&&N.gatewayInfo.res.detail[38],resourceTimingInfo:N.resourceTimingInfo?JSON.stringify(N.resourceTimingInfo):void 0}),N.proxyInfo&&It.joinWebProxyAP(r.sid,{lts:g,sucess:1,apServerAddr:d,turnServerAddrList:N.proxyInfo.addresses.map((G=>G.ip)).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1)),(N=>N.code!==te.OPERATION_ABORTED&&(N.code===te.CAN_NOT_GET_GATEWAY_SERVER?N.data.retry:(It.joinWebProxyAP(r.sid,{lts:g,sucess:0,apServerAddr:d,turnServerAddrList:null,errorCode:N.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:A})}),M.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),N),!0))),a)}const O7=(t,r,s,a,c,d)=>{const{sid:h,clientId:m,cloudProxyServer:g}=s,E=[],w=I=>{I.flag===4096?It.joinChooseServer(h,{role:s.role,lts:a,succ:!1,csAddr:r,opid:t.opid,serverList:null,ec:I.error.message,csIp:I.error.data&&I.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:d,corssRegionTagReq:s.apRequestDetail}):I.flag!==1048576&&I.flag!==4194304&&I.flag!==4194310||It.joinWebProxyAP(h,{lts:a,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:I.error.code,eventType:g,unilbsServerIds:c.toString()})};if(t.response_body.forEach((I=>{const A=I.buffer.code;if(I.uri===23&&A===0&&!I.buffer.edges_services)if(I.buffer.flag===4194310)M.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),I.buffer.edges_services=[];else{const N={error:new ke(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:I.buffer.flag};E.push(N),w(N)}if(A!==0){const N=a0(A),G={error:new ke(te.CAN_NOT_GET_GATEWAY_SERVER,N.desc,{desc:N.desc,retry:N.retry,csIp:t.detail[502]}),flag:I.buffer.flag};I.buffer.flag===4194310?M.warning(G.error.toString()):E.push(G),w(G)}})),E.length)throw M.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(E.map((I=>"flag: ".concat(I.flag,", message: ").concat(I.error.message,", retry: ").concat(I.error.data.retry))).join(" | "))),new ke(te.CAN_NOT_GET_GATEWAY_SERVER,E.map((I=>"flag: ".concat(I.flag,", message: ").concat(I.error.message))).join(" | "),{retry:!!E.find((I=>I.error.data.retry)),csIp:t.detail[502],desc:[...new Set(E.map((I=>{var A;return I==null||(A=I.error)===null||A===void 0||(A=A.data)===null||A===void 0?void 0:A.desc})).filter((I=>!!I)))]})},M2=t=>{var r,s,a,c;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new ke(te.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(oe("AP_AREA")&&((a=t.detail)!==null&&a!==void 0&&a[23]&&typeof((c=t.detail)===null||c===void 0?void 0:c[23])=="string"?R7(t.detail[23].toLowerCase()):R7()),(r=t.detail)!==null&&r!==void 0&&r[19]&&typeof((s=t.detail)===null||s===void 0?void 0:s[19])=="string"){const h=t.detail[19],m=h==null?void 0:h.split(";");for(let g=0;g<m.length;g++){var d;const E=jo(d=m[g]).call(d);t.addresses[g]&&m&&(t.addresses[g].fingerprint=E)}}if(oe("GATEWAY_ADDRESS")&&oe("GATEWAY_ADDRESS").length>0){M.debug("assign gateway address to",oe("GATEWAY_ADDRESS"));const h=oe("GATEWAY_ADDRESS").map((m=>{var g,E;const w=(g=(E=t.addresses.find((I=>I.ip===m.ip&&I.port===m.port)))===null||E===void 0?void 0:E.fingerprint)!==null&&g!==void 0?g:"";return{ip:m.ip,port:m.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:w}}));t.addresses=h}},Hge=(t,r)=>{if(t.response_body&&t.response_body.length){const s=t.response_body[0];if(s.buffer.code!==0){const a=a0(s.buffer.code);throw new ke(te.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(a.desc),{retry:a.retry})}return s.buffer.ticket}throw M.debug("update ticket request received ap response without response body:",r),new ke(te.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},U2=(t,r,s)=>{const a=Math.floor(Math.random()*1e12),c=t.role==="host"?"1":t.role==="audience"?"2":void 0,d={appid:t.appId,client_ts:Date.now(),opid:a,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:sp(sp(sp({6:t.stringUid,11:r,12:oe("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:s,uid:t.uid||0}}]};d.request_bodies.forEach((m=>{t.multiIP&&t.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))}));const h=new FormData;return h.append("request",JSON.stringify(d)),[h,a]},$ge=(t,r)=>{const s=Math.floor(Math.random()*1e12),a={appid:t.appId,client_ts:Date.now(),opid:s,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:r,uid:t.uid||0,edges_services:t.apResponse.addresses.map((d=>({ip:d.ip,port:d.port})))}}]},c=new FormData;return c.append("request",JSON.stringify(a)),[c,s]};let d0=0;function h0(t){return mt.all(t.map((r=>r.then((s=>{throw s}),(s=>s))))).then((r=>{throw r}),(r=>r))}const _T=async t=>{let{fragementLength:r,referenceList:s,asyncMapHandler:a,allFailedhandler:c,promisesCollector:d}=t,h=0;const m=r;let g,E=0;const w=async()=>{const I=(()=>{const A=h*m,N=A+m;return s.slice(A,N).map(a)})();d&&d.push(...I);try{g=await h0(I)}catch(A){if(E+=m,h++,!(E>=s.length))return void await w();c(A)}I.forEach((A=>A.cancel()))};return await w(),g},k7=async t=>{let{referenceList:r,asyncMapHandler:s,closeFn:a}=t;const c=r.length;let d=0;const h=async()=>{const m=s(r.shift());try{return await m}catch(g){if(d++,d>=c||a!=null&&a(g))throw g;return h()}};return h()};async function Kge(){if(typeof VideoDecoder>"u")return!0;let t;const r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],s=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],a=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],c=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],d=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],h=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new mt(((g,E)=>{let w;(async function(){t&&t.state!=="closed"||await(async function(){t=new VideoDecoder({output:A=>{A.close(),clearTimeout(w),g(!0)},error:A=>{clearTimeout(w),g(!1)}}),await t.configure({codec:"av01.0.05M.08",width:160,height:90})})();const I=[r,s,a,c,d,h];for(let A=0;A<I.length;A++){const N=new EncodedVideoChunk({type:A==0?"key":"delta",timestamp:33333*A,duration:33333,data:new Uint8Array(I[A])});try{await t.decode(N)}catch{return void g(!1)}}})(),w=setTimeout((()=>{g(!1)}),5e3)}))}async function V2(t,r,s,a){return{gatewayInfo:await(async function(d,h,m,g){let E=null;const w=[],I=async()=>{const N=oe("WEBCS_DOMAIN").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map((z=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(z+"/api/v2/transpond/webrtc?v=2"):"https://".concat(z,"/api/v2/transpond/webrtc?v=2"),areaCode:gT()}))),G=g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map((z=>z.url))}),F=await _T({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:z=>(M.debug("[".concat(d.clientId,"] Connect to choose_server:"),z.url),A7(z,d,h,m)),allFailedhandler:z=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:z},G),z[0]},promisesCollector:w});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},G),F},A=async()=>{if(await bs(1e3),E!==null)return E;const N=oe("WEBCS_DOMAIN_BACKUP_LIST").map((z=>({url:d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(z+"/api/v2/transpond/webrtc?v=2"):"https://".concat(z,"/api/v2/transpond/webrtc?v=2"),areaCode:gT()}))),G=g.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map((z=>z.url))}),F=await _T({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:z=>(M.debug("[".concat(d.clientId,"] Connect to backup choose_server:"),z.url),A7(z,d,h,m)),allFailedhandler:z=>{throw g.recordJoinChannelService({endTs:Date.now(),status:"error",errors:z},G),z[0]},promisesCollector:w});return g.recordJoinChannelService({endTs:Date.now(),status:"success"},G),F};try{return E=await h0([I(),A()]),w.length&&w.forEach((N=>N.cancel&&typeof N.cancel=="function"&&N.cancel())),E}catch(N){throw N[0]}})(t,r,s,a)}}async function N7(t,r,s,a,c){const d=t.cloudProxyServer;if(d==="disabled"){if(t.useLocalAccessPoint)return await V2(t,r,s,c);if(oe("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:A,proxyInfo:N}=await L7(t,r,s,c);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:A};const G=N.map((F=>({turnServerURL:F.address,tcpport:F.tcpport||Bs.tcpport,udpport:F.udpport||Bs.udpport,username:F.username||Bs.username,password:F.password||Bs.password,forceturn:!1,security:!0})));if(c.useP2P){var h;const F=(h=t.uid)!==null&&h!==void 0?h:A.uid,z="glb:".concat(F.toString()),ee=await IL(z),Z=N.map((ae=>({turnServerURL:ae.address,tcpport:ae.tcpport||Bs.tcpport,udpport:ae.udpport||Bs.udpport,username:z,password:ee,forceturn:!1,security:!0})));G.push(...Z)}return t.turnServer={mode:"manual",servers:G},{gatewayInfo:A}}return await V2(t,r,s,c)}const{proxyInfo:m,gatewayInfo:g}=await L7(t,r,s,c),E={gatewayInfo:g},w=m.map((A=>({turnServerURL:A.address,tcpport:d==="proxy3"?void 0:A.tcpport?A.tcpport:Bs.tcpport,udpport:d==="proxy4"?void 0:A.udpport?A.udpport:Bs.udpport,username:A.username||Bs.username,password:A.password||Bs.password,forceturn:d!=="proxy4",security:d==="proxy5"})));if(c.useP2P){var I;const A=(I=t.uid)!==null&&I!==void 0?I:g.uid,N="glb:".concat(A.toString()),G=await IL(N),F=m.map((z=>({turnServerURL:z.address,tcpport:d==="proxy3"?void 0:z.tcpport||Bs.tcpport,udpport:d==="proxy4"?void 0:z.udpport||Bs.udpport,username:N,password:G,forceturn:d!=="proxy4",security:d==="proxy5"})));w.push(...F)}return t.turnServer={mode:"manual",servers:w},M.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(d)),E}async function x7(t,r,s,a,c){const d=oe("ACCOUNT_REGISTER").slice(0,oe("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?d.map((g=>"https://".concat(r.proxyServer,"/ap/?url=").concat(g+"/api/v1"))):d.map((g=>"https://".concat(g,"/api/v1")));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const g=await(async function(E,w,I,A,N){const G=Date.now(),F={sid:I.sid,opid:10,appid:I.appId,string_uid:w};let z=E[0];const ee=await Kd((()=>Qd(z+"".concat(z.indexOf("?")===-1?"?":"&","action=stringuid"),{data:F,cancelToken:A,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})),((Z,ae)=>{if(Z.code===0){if(Z.uid<=0||Z.uid>=Math.pow(2,32))throw M.error("Invalid Uint Uid ".concat(w," => ").concat(Z.uid),Z),It.reqUserAccount(F.sid,{lts:G,success:!1,serverAddr:z,stringUid:F.string_uid,uid:Z.uid,errorCode:te.INVALID_UINT_UID_FROM_STRING_UID,extend:F}),new ke(te.INVALID_UINT_UID_FROM_STRING_UID);return It.reqUserAccount(F.sid,{lts:G,success:!0,serverAddr:z,stringUid:F.string_uid,uid:Z.uid,errorCode:null,extend:F}),!1}const ye=a0(Z.code);return ye.retry&&(z=E[(ae+1)%E.length]),It.reqUserAccount(F.sid,{lts:G,success:!1,serverAddr:z,stringUid:F.string_uid,uid:Z.uid,errorCode:ye.desc,extend:F}),ye.retry}),((Z,ae)=>Z.code!==te.OPERATION_ABORTED&&(It.reqUserAccount(F.sid,{lts:G,success:!1,serverAddr:z,stringUid:F.string_uid,uid:null,errorCode:Z.code,extend:F}),z=E[(ae+1)%E.length],!0)),N);if(ee.code!==0){const Z=a0(ee.code);throw new ke(te.UNEXPECTED_RESPONSE,Z.desc)}return ee})(h,t,r,s,a);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),g.uid}catch(g){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[g]},m),g}}async function qge(t,r,s){const a=oe("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?a.map((d=>"https://".concat(r.proxyServer,"/ap/?url=").concat(d+"/api/v1"))):a.map((d=>"https://".concat(d,"/api/v1")));try{return await k7({referenceList:c,asyncMapHandler:h=>(async function(m,g,E,w){const I=Date.now(),A={sid:E.sid,opid:10,appid:E.appId,string_uid:g};try{const N=await Qd(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:A,cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(N.code!==0){const G=a0(N.code);throw new ke(te.UNEXPECTED_RESPONSE,"preload sua error:".concat(G.desc),G)}if(N.uid<=0||N.uid>=Math.pow(2,32))throw new ke(te.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:I,url:m,req:A,uid:N.uid,elapse:Date.now()-I}}catch(N){throw N}})(h,t,r,s),closeFn:h=>h.code===te.OPERATION_ABORTED||h.code===te.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(d){throw d}}async function Yge(t,r,s){const a=oe("CDS_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map((g=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v1"):"https://".concat(g,"/api/v1?action=config"))),c=a.map((g=>(function(E,w,I,A){const N=Ln(),G={flag:64,cipher_method:0,features:sp(sp(sp(sp(sp({install_id:VL(),device:N.name,system:N.os,system_general:navigator.userAgent,vendor:w.appId,version:Jl,cname:w.cname,session_id:w.sid,proxyServer:w.proxyServer,sdk_type:jge.WEB_RTC,browser_name:N.name,browser_version:N.version,user_agent:navigator.userAgent,channel_name:w.cname},w.stringUid&&{string_uid:w.stringUid}),w.uid&&{uid:w.uid+""}),N.os&&{os_name:N.os}),N.osVersion&&{os_version:N.osVersion}),{},{detail:""})};return Kd((()=>Qd(E,{data:G,timeout:1e3,cancelToken:I,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})),void 0,(F=>F.code!==te.OPERATION_ABORTED),A)})(g,t,r,s)));let d=null,h=null,m={};try{d=await h0(c)}catch(g){if(g.code===te.OPERATION_ABORTED)throw g;h=g}if(c.forEach((g=>g.cancel())),It.reportApiInvoke(t.sid,{name:di.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:d}}).onSuccess(),d&&d.test_tags)try{m=(function(g){if(!g.test_tags)return{};const E=g.test_tags,w=Object.keys(E),I={};return w.forEach((A=>{var N;const G=jo(N=A.slice(4)).call(N),F=JSON.parse(E[A]),z=F[1];I[G]={tag:F[0]||"",value:z}})),I})(d)}catch{}return m}async function D7(t,r){const s=oe("WEBCS_DOMAIN").concat(oe("WEBCS_DOMAIN_BACKUP_LIST")).map((a=>({url:"https://".concat(a,"/api/v2/transpond/webrtc?v=2"),areaCode:gT(),serviceIds:[Ri.CHOOSE_SERVER,Ri.CLOUD_PROXY_FALLBACK]})));try{return await k7({referenceList:s,asyncMapHandler:c=>(async function(d,h,m){let g,{url:E,areaCode:w,serviceIds:I}=d;const A=Date.now(),[N,G]=U2(h,w,I);let F=Ci.networkState;try{F&&Ci.networkState===Oc.OFFLINE&&Ci.onlineWaiter&&await mt.race([Ci.onlineWaiter,bs(Ni.maxRetryTimeout)]),F=Ci.networkState;const{data:z,headers:ee}=await Qd(E,{data:N,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g=ee.http3==="1"?1:-1,(_e=>{const ue=[];if(_e.response_body.forEach((Ae=>{const Ue=Ae.buffer.code;if(Ae.uri===23&&Ue===0&&!Ae.buffer.edges_services)if(Ae.buffer.flag===4194310)Ae.buffer.edges_services=[];else{const We={error:new ke(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:_e.detail[502]}),flag:Ae.buffer.flag};ue.push(We)}if(Ue!==0){const We=a0(Ue),Ze={error:new ke(te.CAN_NOT_GET_GATEWAY_SERVER,We.desc,{desc:We.desc,retry:We.retry,csIp:_e.detail[502]}),flag:Ae.buffer.flag};Ae.buffer.flag===4194310?M.warning(Ze.error.toString()):ue.push(Ze)}})),ue.length)throw new ke(te.CAN_NOT_GET_GATEWAY_SERVER,ue.map((Ae=>"flag: ".concat(Ae.flag,", message: ").concat(Ae.error.message))).join(" | "),{retry:!!ue.find((Ae=>Ae.error.data.retry)),csIp:_e.detail[502],desc:[...new Set(ue.map((Ae=>{var Ue;return Ae==null||(Ue=Ae.error)===null||Ue===void 0||(Ue=Ue.data)===null||Ue===void 0?void 0:Ue.desc})).filter((Ae=>!!Ae)))]})})(z);const ae=hT(z,Ri.CHOOSE_SERVER),ye=hT(z,Ri.CLOUD_PROXY_FALLBACK);return M2(ae),{gatewayInfo:R2(ae,E),proxyInfo:ye,opid:G,requestTime:A,url:E,isHttp3:g,elapse:Date.now()-A}}catch(z){throw z}})(c,t,r),closeFn:c=>c.code===te.OPERATION_ABORTED||c.code===te.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(a){throw a}}async function L7(t,r,s,a){const c=oe("PROXY_SERVER_TYPE3"),d=(N,G,F)=>{let z=F||c;return Array.isArray(z)&&(z=G%2==0&&c[1]||c[0]),"https://".concat(z,"/ap/?url=").concat(N)};let h=null;const m=[],g=async()=>{const N=oe("WEBCS_DOMAIN").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(((z,ee)=>{let Z;return Z=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(z,"/api/v2/transpond/webrtc?v=2"),ee,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(z,"/api/v2/transpond/webrtc?v=2"):d("".concat(z,"/api/v2/transpond/webrtc?v=2"),ee),{url:Z,areaCode:gT(),serviceIds:[Ri.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Ri.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Ri.CLOUD_PROXY:Ri.CLOUD_PROXY_FALLBACK]}})),G=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map((z=>z.url))}),F=await _T({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:z=>(M.debug("[".concat(t.clientId,"] Connect to choose_server:"),z.url),P7(z,t,r,s)),allFailedhandler:z=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:z},G),z[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},G),F},E=async()=>{if(await bs(1e3),h!==null)return h;const N=oe("WEBCS_DOMAIN_BACKUP_LIST").map(((z,ee)=>{let Z;return Z=t.cloudProxyServer==="disabled"&&t.proxyServer?d("".concat(z,"/api/v2/transpond/webrtc?v=2"),ee,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(z,"/api/v2/transpond/webrtc?v=2"):d("".concat(z,"/api/v2/transpond/webrtc?v=2"),ee),{url:Z,areaCode:gT(),serviceIds:[Ri.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Ri.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Ri.CLOUD_PROXY:Ri.CLOUD_PROXY_FALLBACK]}})),G=a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:N.map((z=>z.url))}),F=await _T({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:N,asyncMapHandler:z=>(M.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),z.url),P7(z,t,r,s)),allFailedhandler:z=>{throw a.recordJoinChannelService({endTs:Date.now(),status:"error",errors:z},G),z[0]},promisesCollector:m});return a.recordJoinChannelService({endTs:Date.now(),status:"success"},G),F};let w,I,A;try{({gatewayInfo:w,proxyInfo:I,url:A}=await h0([g(),E()]))}catch(N){throw N[0]}if(m.length&&m.forEach((N=>N.cancel&&typeof N.cancel=="function"&&N.cancel())),!w||!I)throw new ke(te.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=A,t.cloudProxyServer!=="disabled"&&Array.isArray(c)&&A){const N=/^https?:\/\/(.+?)(\/.*)?$/.exec(A)[1];rt(c).call(c,N)&&(t.proxyServer=N,M.setProxyServer(N),It.setProxyServer(N))}return h={gatewayInfo:w,proxyInfo:await s7(I,w.uid)},h}async function Xge(t,r,s){const a=oe("UAP_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map((d=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(d+"/api/v1?action=uap"):"https://".concat(d,"/api/v1?action=uap"))),c=a.map((d=>(function(h,m,g,E){const w={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:Jl,cname:m.cname,uid:m.uid.toString(),requestId:L2,seq:L2};L2+=1;const I={service_name:"tele_channel",json_body:JSON.stringify(w)};return Kd((async()=>{const A=await Qd(h,{data:I,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(A.code!==0){const G=new ke(te.UNEXPECTED_RESPONSE,"cross channel ap error, code"+A.code,{retry:!0});throw M.error(G.toString()),G}const N=JSON.parse(A.json_body);if(N.code!==200){const G=new ke(te.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(N.code,", reason: ").concat(N.reason));throw M.error(G.toString()),G}if(!N.servers||N.servers.length===0){const G=new ke(te.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw M.error(G.toString()),G}return{vid:N.vid,workerToken:N.workerToken,addressList:(oe("CHANNEL_MEDIA_RELAY_SERVERS")||N.servers).map((G=>"wss://".concat(G.address.replace(/\./g,"-"),".").concat(oe("WORKER_DOMAIN"),":").concat(G.wss)))}}),void 0,(A=>!!(A.code!==te.OPERATION_ABORTED&&A.code!==te.UNEXPECTED_RESPONSE||A.data&&A.data.retry)),E)})(d,t,r,s)));try{const d=await h0(c);return c.forEach((h=>h.cancel())),d}catch(d){throw d[0]}}async function Jge(t,r,s){let a=null;const c=[],d=async h=>{const m=oe(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((g=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(g+"/api/v2/transpond/webrtc?v=2"):"https://".concat(g,"/api/v2/transpond/webrtc?v=2")));return h&&(await bs(1e3),a!==null)?a:await _T({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:g=>(M.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),g),(function(E,w,I,A){const[N]=$ge(w,[Ri.CHOOSE_SERVER]);let G=Ci.networkState;return Kd((async()=>{G&&Ci.networkState===Oc.OFFLINE&&Ci.onlineWaiter&&await mt.race([Ci.onlineWaiter,bs(A&&A.maxRetryTimeout||Ni.maxRetryTimeout)]),G=Ci.networkState;const F=await Qd(E,{data:N,cancelToken:I,headers:{"Content-Type":"multipart/form-data;"}},!0);return Hge(F,E)}),(()=>!1),(F=>F.code!==te.OPERATION_ABORTED&&(F.code===te.UPDATE_TICKET_FAILED?F.data.retry:(M.warning("[".concat(w.clientId,"] update ticket network error, retry"),F),!0))),A)})(g,t,r,s)),allFailedhandler:g=>{throw g[0]},promisesCollector:c})};try{return a=await h0([d(!1),d(!0)]),c.length&&c.forEach((h=>h.cancel&&typeof h.cancel=="function"&&h.cancel())),a}catch(h){throw h[0]}}function M7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function j2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?M7(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):M7(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}class Qge extends Qr{get isSuccess(){return!!this.configs}constructor(r,s){super(),X(this,"configs",void 0),X(this,"store",void 0),X(this,"joinInfo",void 0),X(this,"cancelToken",void 0),X(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),X(this,"interval",void 0),X(this,"mutex",void 0),X(this,"mutableParamsRead",!1),X(this,"configCache",{}),X(this,"limit_bitrate",void 0),this.mutex=new ro("config-distribute",r),this.store=s}startGetConfigDistribute(r,s){this.joinInfo=r,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),oe("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((()=>{this.updateConfigDistribute()}),oe("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,It.reportApiInvoke(null,{options:void 0,name:di.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Hr.TRACER}).onSuccess(JSON.stringify(qd))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void M.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const s=await this.mutex.lock();try{r=await Yge(this.joinInfo,this.cancelToken,this.retryConfig),M.debug("[config-distribute] get config distribute",JSON.stringify(r));const a=(function(c){var d;const h=z_(d=Object.keys(c).filter((E=>/^webrtc_ng_global_parameter/.test(E)))).call(d);for(let E=0;E<h.length;E++)for(let w=h.length-1;w>E;w--){const I=h[w],A=c[I].value;if(typeof A.__priority=="number"){const N=A.__priority,G=h[w-1],F=c[G].value;if(typeof F.__priority=="number"){if(!(N>F.__priority))continue;{const z=I;h[w]=h[w-1],h[w-1]=z}}else{const z=I;h[w]=h[w-1],h[w-1]=z}}}const m=Date.now();let g={};return h.forEach((E=>{const w=c[E].value.__expires;w&&w<=m||(g[E]=c[E])})),g})(r);this.cacheGlobalParameterConfig(a),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=a}catch(a){const c=new ke(te.NETWORK_RESPONSE_ERROR,a);M.warning("[config-distribute] ".concat(c.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){qG(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(lT.UPDATE_BITRATE_LIMIT,r):this.emit(lT.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&j2({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const s={},a=Object.keys(r),c=[];a.forEach((d=>{const h=r[d].value;s[d]=h;const m=h.__id;if(m&&this.configCache[d]&&this.configCache[d].__id===m)return;const g=h.__type,E=r[d].value,w=r[d].tag;let I=0;g?g===y9.REALTIME&&(I=1):Object.keys(E).some((A=>Object.prototype.hasOwnProperty.call(zL,A)||!m2()&&Object.prototype.hasOwnProperty.call(E1,A)?(I=1,!0):void 0)),c.push({tag:w,isApplied:I,feature:d,params:JSON.stringify(h)})})),c.forEach((d=>{let{tag:h,feature:m,params:g,isApplied:E}=d;this.store.sessionId&&It.abTest(this.store.sessionId,{intSucc:1,isApplied:E,tag:h,feature:m,params:g,cid:this.store.cid,uid:this.store.intUid})})),this.configCache=s}catch(s){M.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(r){const s=(function(c){const d={};return Object.keys(c).forEach((h=>{const m=c[h].value,g=m.__expires,E=m.__type;Object.keys(m).forEach((w=>{w==="__id"||w==="__type"||w==="__priority"||w==="__expires"||Object.prototype.hasOwnProperty.call(d,w)||(d[w]=j2(j2({value:m[w]},g&&{expires:g}),E&&{type:E}))}))})),d})(r);try{var a;const c=(a=s.LIMIT_BITRATE)===null||a===void 0?void 0:a.value;delete s.LIMIT_BITRATE,c&&qG(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(r),(function(m){try{const g=Date.now();Object.keys(m).forEach((E=>{const{value:w,type:I,expires:A}=m[E];A&&A<=g||((I===y9.REALTIME||Object.prototype.hasOwnProperty.call(zL,E))&&(qd[E]=w,Vr[E]=w,M.debug("Update realtime parameters from config distribute",E,w)),I||m2()||!Object.prototype.hasOwnProperty.call(E1,E)||(qd[E]=w,Vr[E]=w,M.debug("Update gateway parameters from config distribute",E,w)))}))}catch(g){M.error("Error update config immediately: ".concat(m),g.message)}})(s);const d=JSON.stringify(s),h=window.btoa(d);window.localStorage.setItem("websdk_ng_global_parameter",h),M.debug("Caching global parameters ".concat(d))}catch(c){M.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const s=Date.now();Object.keys(r).forEach((a=>{if(a==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Vr,a)){const{value:c,expires:d}=r[a];if(d&&d<=s)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(Vr[a],c)||(qd[a]=c,Vr[a]=c,this.emit(lT.UPDATE_CLIENT_ROLE_OPTIONS,c),M.debug("Updating client role options: ".concat(JSON.stringify(c))))}}))}catch(s){M.error("Error handling global parameter config:",s.message)}}}class Zge extends Qr{constructor(){super(...arguments),X(this,"resultStorage",new Map)}setLocalAudioStats(r,s,a){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(a,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(a,s))}setLocalVideoStats(r,s,a){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(a,s)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(a,s)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(a)),!s.muted&&this.record("VIDEO_ENCODE_FAILED",r,this.checResolutionSent(a))}setRemoteAudioStats(r,s){const a=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",a,this.checkAudioOutputLevel(s))}setRemoteVideoStats(r,s){const a=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",a,this.checkVideoDecode(s))}record(r,s,a){if(oe("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(!c)return;c.result.push(a);const d=r==="VIDEO_ENCODE_FAILED"?oe("ENCODE_EXCEPTION_TIMES"):5;if(c.result.length>=d){var h;const m=rt(h=c.result).call(h,!0);c.isPrevNormal&&!m&&this.emit("exception",F2[r],r,s),!c.isPrevNormal&&m&&this.emit("exception",F2[r]+2e3,r+"_RECOVER",s),c.isPrevNormal=m,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,s){return s instanceof Fi&&!s.isActive||!!s.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,s){let a=null;s._encoderConfig&&s._encoderConfig.frameRate&&(a=kc(s._encoderConfig.frameRate));const c=r.captureFrameRate;return!a||!c||!(a>10&&c<5||a<10&&a>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checResolutionSent(r){var s;return!(!r.codecType||rt(s=oe("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(s,r.codecType.toLocaleLowerCase()))||!r.captureFrameRate||r.sendFrameRate!==0||r.sendResolutionWidth!==0||r.sendResolutionHeight!==0}checkSendVideoBitrate(r,s){return!!s.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,s){return s instanceof Fi&&!s.isActive||!!s.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const F2={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},ao=new class{markSubscribeStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(r))}markPublishStart(t,r){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(r))}measureFromSubscribeStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(r));if(s.length>0){const a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}measureFromPublishStart(t,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(r));if(s.length>0){const a=s[s.length-1];return Math.round(performance.now()-a.startTime)}return 0}};function U7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function ly(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?U7(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):U7(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}class yT{constructor(r){X(this,"store",void 0),X(this,"onStatsException",void 0),X(this,"onUploadPublishDuration",void 0),X(this,"onStatsChanged",void 0),X(this,"onVideoCodecChanged",void 0),X(this,"localStats",new Map),X(this,"remoteStats",new Map),X(this,"updateStatsInterval",void 0),X(this,"trafficStats",void 0),X(this,"trafficStatsPeerList",[]),X(this,"uplinkStats",void 0),X(this,"exceptionMonitor",void 0),X(this,"p2pChannel",void 0),X(this,"scalabilityMode",y1.L1T1),X(this,"updateStats",(()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))})),this.store=r,this.exceptionMonitor=new Zge,this.exceptionMonitor.on("exception",((s,a,c)=>{this.onStatsException&&this.onStatsException(s,a,c)}))}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Xe.LocalAudioTrack)||ly({},qL)}getLocalVideoTrackStats(){return this.localStats.get(Xe.LocalVideoTrack)||ly({},YL)}getRemoteAudioTrackStats(r){const s=(d,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find((g=>g.peer_uid===d));return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},a={};if(r){var c;const d=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;d&&(a[r]=s(r,d))}else Array.from(this.remoteStats.entries()).forEach((d=>{let[h,{audioStats:m}]=d;m&&(a[h]=s(h,m))}));return a}getRemoteNetworkQualityStats(r){const s={};if(r){var a;const c=(a=this.remoteStats.get(r))===null||a===void 0?void 0:a.networkStats;c&&(s[r]=c)}else Array.from(this.remoteStats.entries()).forEach((c=>{let[d,{networkStats:h}]=c;h&&(s[d]=h)}));return s}getRemoteVideoTrackStats(r){const s=(d,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find((g=>g.peer_uid===d));return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},a={};if(r){var c;const d=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;d&&(a[r]=s(r,d))}else Array.from(this.remoteStats.entries()).forEach((d=>{let[h,{videoStats:m}]=d;m&&(a[h]=s(h,m))}));return a}getRTCStats(){let r=0,s=0,a=0,c=0;const d=this.localStats.get(Xe.LocalAudioTrack);d&&(r+=d.sendBytes,s+=d.sendBitrate);const h=this.localStats.get(Xe.LocalVideoTrack);h&&(r+=h.sendBytes,s+=h.sendBitrate);const m=this.localStats.get(Xe.LocalVideoLowTrack);m&&(r+=m.sendBytes,s+=m.sendBitrate),this.remoteStats.forEach((E=>{let{audioStats:w,videoStats:I}=E;w&&(a+=w.receiveBytes,c+=w.receiveBitrate),I&&(a+=I.receiveBytes,c+=I.receiveBitrate)}));let g=1;return this.trafficStats&&(g+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:g,SendBitrate:s,SendBytes:r,RecvBytes:a,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter((s=>s.B_ppad!==void 0||s.B_ppvd!==void 0)),r.peer_delay.filter((s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1)).forEach((s=>{var a;const c=(a=this.p2pChannel)===null||a===void 0?void 0:a.getRemoteMedia(s.peer_uid),d=c!=null&&c.videoSSRC?ao.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?ao.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,d>h?d:h),this.trafficStatsPeerList.push(s.peer_uid))})),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&M.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,s,a){if(!r)return!1;const c=!!a&&s.framesDecodeFreezeTime>a.framesDecodeFreezeTime,d=!a||s.framesDecodeCount>a.framesDecodeCount;return c||!d}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach((s=>{let[a,c]=s;switch(a){case Xe.LocalVideoTrack:case Xe.LocalVideoLowTrack:{const m=c,g=ly({},YL),E=r.getStats(),w=r.getLocalMedia(a);if(E){const I=E.videoSend.find((A=>A.ssrc===(w==null?void 0:w.ssrcs[0].ssrcId)));if(I){const A=r.getLocalVideoSize(),N=r.getEncoderConfig(Xe.LocalVideoTrack);var d;(I.codec==="H264"||I.codec==="H265"||I.codec==="VP8"||I.codec==="VP9"||I.codec==="AV1X"||I.codec==="AV1")&&(g.codecType=I.codec,(m==null?void 0:m.codecType)!==I.codec&&((d=this.onVideoCodecChanged)===null||d===void 0||d.call(this,I.codec.toLocaleLowerCase()))),g.sendBytes=I.bytes,g.sendBitrate=m?8*Math.max(0,g.sendBytes-m.sendBytes):0,I.inputFrame?(g.captureFrameRate=I.inputFrame.frameRate,g.captureResolutionHeight=I.inputFrame.height,g.captureResolutionWidth=I.inputFrame.width):A&&(g.captureResolutionWidth=A.width,g.captureResolutionHeight=A.height),I.sentFrame?(g.sendFrameRate=I.sentFrame.frameRate,g.sendResolutionHeight=I.sentFrame.height,g.sendResolutionWidth=I.sentFrame.width):A&&(g.sendResolutionWidth=A.width,g.sendResolutionHeight=A.height),I.avgEncodeMs&&(g.encodeDelay=I.avgEncodeMs),N&&N.bitrateMax?g.targetSendBitrate=1e3*N.bitrateMax:I.targetBitrate&&(g.targetSendBitrate=I.targetBitrate),g.sendPackets=I.packets,g.sendPacketsLost=I.packetsLost,g.sendJitterMs=I.jitterMs,g.sendRttMs=I.rttMs,g.totalDuration=m?m.totalDuration+1:1,g.totalFreezeTime=m?m.totalFreezeTime:0,this.isLocalVideoFreeze(I)&&(g.totalFreezeTime+=1),I.scalabilityMode&&this.scalabilityMode!==I.scalabilityMode&&(M.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(I.scalabilityMode)),this.scalabilityMode=I.scalabilityMode)}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var h;this.localStats.set(a,g),((m==null?void 0:m.sendResolutionWidth)!==g.sendResolutionWidth||(m==null?void 0:m.sendResolutionHeight)!==g.sendResolutionHeight)&&((h=this.onStatsChanged)===null||h===void 0||h.call(this,"resolution",{width:g.sendResolutionWidth,height:g.sendResolutionHeight})),g&&w&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,w.track,g);break}case Xe.LocalAudioTrack:{const m=c,g=ly({},qL),E=r.getStats(),w=r.getLocalMedia(a);if(E){const I=E.audioSend.find((A=>A.ssrc===(w==null?void 0:w.ssrcs[0].ssrcId)));if(I){if(I.codec!=="opus"&&I.codec!=="aac"&&I.codec!=="PCMU"&&I.codec!=="PCMA"&&I.codec!=="G722"||(g.codecType=I.codec),I.inputLevel)g.sendVolumeLevel=Math.round(32767*I.inputLevel);else{const A=r.getLocalAudioVolume();A&&(g.sendVolumeLevel=Math.round(32767*A))}g.sendBytes=I.bytes,g.sendPackets=I.packets,g.sendPacketsLost=I.packetsLost,g.sendJitterMs=I.jitterMs,g.sendRttMs=I.rttMs,g.sendBitrate=m?8*Math.max(0,g.sendBytes-m.sendBytes):0}}this.trafficStats&&(g.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Xe.LocalAudioTrack,g),g&&w&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,w.track,g);break}}}))}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach((s=>{var a,c;let[d,{videoStats:h,audioStats:m,videoPcStats:g}]=s;const E=m,w=h,I=g,A=ly({},P9),N=ly({},O9),G=ly({},Mme),{audioTrack:F,videoTrack:z,audioSSRC:ee,videoSSRC:Z}=r.getRemoteMedia(d);let ae;ae=this.store.useP2P?r.getStats(!0):r.getStats();const ye=(a=ae)===null||a===void 0?void 0:a.audioRecv.find((Ue=>Ue.ssrc===ee)),_e=(c=ae)===null||c===void 0?void 0:c.videoRecv.find((Ue=>Ue.ssrc===Z)),ue=this.trafficStats&&this.trafficStats.peer_delay.find((Ue=>Ue.peer_uid===d));if(ye&&(ye.codec!=="opus"&&ye.codec!=="aac"&&ye.codec!=="PCMU"&&ye.codec!=="PCMA"&&ye.codec!=="G722"||(A.codecType=ye.codec),ye.outputLevel?A.receiveLevel=Math.round(32767*ye.outputLevel):F&&(A.receiveLevel=Math.round(32767*F.getVolumeLevel())),A.receiveBytes=ye.bytes,A.receivePackets=ye.packets,A.receivePacketsLost=ye.packetsLost,A.receivePacketsDiscarded=ye.packetsDiscarded,A.packetLossRate=A.receivePacketsLost/(A.receivePackets+A.receivePacketsLost),A.receiveBitrate=E?8*Math.max(0,A.receiveBytes-E.receiveBytes):0,A.totalDuration=E?E.totalDuration+1:1,A.totalFreezeTime=E?E.totalFreezeTime:0,A.freezeRate=A.totalFreezeTime/A.totalDuration,A.receiveDelay=ye.jitterBufferMs,A.totalDuration>10&&yT.isRemoteAudioFreeze(F)&&(A.totalFreezeTime+=1)),_e){var Ae;_e.codec!=="H264"&&_e.codec!=="H265"&&_e.codec!=="VP8"&&_e.codec!=="VP9"&&_e.codec!=="AV1X"&&_e.codec!=="AV1"||(N.codecType=_e.codec),N.receiveBytes=_e.bytes,N.receiveBitrate=w?8*Math.max(0,N.receiveBytes-w.receiveBytes):0,N.decodeFrameRate=_e.decodeFrameRate<0?0:_e.decodeFrameRate,N.renderFrameRate=_e.decodeFrameRate<0?0:_e.decodeFrameRate,_e.outputFrame&&(N.renderFrameRate=_e.outputFrame.frameRate),_e.receivedFrame?(N.receiveFrameRate=_e.receivedFrame.frameRate,N.receiveResolutionHeight=_e.receivedFrame.height,N.receiveResolutionWidth=_e.receivedFrame.width):z&&(N.receiveResolutionHeight=z._videoHeight||0,N.receiveResolutionWidth=z._videoWidth||0),_e.framesRateFirefox!==void 0&&(N.receiveFrameRate=Math.round(_e.framesRateFirefox)),N.receivePackets=_e.packets,N.receivePacketsLost=_e.packetsLost,N.packetLossRate=N.receivePacketsLost/(N.receivePackets+N.receivePacketsLost);const Ue=w?w.totalFreezeTime:0,We=w?w.totalDuration:0;N.totalDuration=w?w.totalDuration+1:1,N.totalFreezeTime=(Ae=_e.totalFreezesDuration)!==null&&Ae!==void 0?Ae:Ue||0,N.receiveDelay=_e.jitterBufferMs||0;const Ze=!!Z&&r.getRemoteVideoIsReady(Z);_e.totalFreezesDuration===void 0&&z&&Ze&&yT.isRemoteVideoFreeze(z,_e,I)&&(N.totalFreezeTime+=1),N.freezeRate=Math.max(0,Math.min((N.totalFreezeTime-Ue)/(N.totalDuration-We),1))}ue&&(A.end2EndDelay=ue.B_ad,N.end2EndDelay=ue.B_vd,A.transportDelay=ue.B_ed,N.transportDelay=ue.B_ed,A.currentPacketLossRate=ue.B_ealr4/100,N.currentPacketLossRate=ue.B_evlr4/100,G.uplinkNetworkQuality=ue.B_punq?ue.B_punq:0,G.downlinkNetworkQuality=ue.B_pdnq?ue.B_pdnq:0),this.remoteStats.set(d,{audioStats:A,videoStats:N,videoPcStats:_e,networkStats:G}),F&&this.exceptionMonitor.setRemoteAudioStats(F,A),z&&this.exceptionMonitor.setRemoteVideoStats(z,N)}))}}class V7{constructor(){X(this,"destChannelMediaInfos",new Map),X(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){$G(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){$G(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){V1(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function j7(t){if(!(t instanceof V7))return new ke(te.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=t.getSrcChannelMediaInfo(),s=t.getDestChannelMediaInfo();if(!r)return new ke(te.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new ke(te.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class rg{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,s){X(this,"uid",void 0),X(this,"_uintid",void 0),X(this,"_trust_in_room_",!0),X(this,"_trust_audio_enabled_state_",!0),X(this,"_trust_video_enabled_state_",!0),X(this,"_trust_audio_mute_state_",!0),X(this,"_trust_video_mute_state_",!0),X(this,"_audio_muted_",!1),X(this,"_video_muted_",!1),X(this,"_audio_enabled_",!0),X(this,"_video_enabled_",!0),X(this,"_audio_added_",!1),X(this,"_video_added_",!1),X(this,"_is_pre_created",!1),X(this,"_video_pre_subscribed",!1),X(this,"_audio_pre_subscribed",!1),X(this,"_trust_video_stream_added_state_",!0),X(this,"_trust_audio_stream_added_state_",!0),X(this,"_audioTrack",void 0),X(this,"_videoTrack",void 0),X(this,"_dataChannels",[]),X(this,"_audioSSRC",void 0),X(this,"_videoSSRC",void 0),X(this,"_audioOrtc",void 0),X(this,"_videoOrtc",void 0),X(this,"_cname",void 0),X(this,"_rtxSsrcId",void 0),X(this,"_videoMid",void 0),X(this,"_audioMid",void 0),this.uid=r,this._uintid=s}}function F7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function B2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?F7(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):F7(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}const Z1="9",z2=2e4,eP=4e4;function B7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function vf(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?B7(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):B7(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}var p0=(function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t})(p0||{});const tP=new Map;function z7(t,r,s,a){let{scale:c}=t;if(c===0&&a===p0.UP||c>=r.length-1&&a===p0.DOWN)return t;let d=vf(vf({},t),{},{scale:a===p0.DOWN?++c:--c});switch(s){case"maintain-framerate":d=vf(vf({},d),r[c].motion);break;case"maintain-resolution":d=vf(vf({},d),r[c].detail);break;case"balanced":d=vf(vf({},d),r[c].balanced)}return d}function W7(t,r){if(r){const s={overUse:0,underUse:0,adaptationList:G7(r)};tP.set(t,s)}else tP.delete(t)}function G7(t){const r=vf({},t),{bitrateMax:s,frameRate:a,scaleResolutionDownBy:c,bitrateMin:d}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:g,BITRATE_MIN_THRESHOLD:E,BITRATE_MAX_THRESHOLD:w,BWE_SCALE_UP_THRESHOLD:I,BWE_SCALE_DOWN_THRESHOLD:A,PERF_SCALE_DOWN_THRESHOLD:N,PERF_SCALE_UP_THRESHOLD:G,BALANCE_BITRATE_FACTOR:F,BALANCE_FRAMERATE_FACTOR:z,BALANCE_RESOLUTION_FACTOR:ee,MOTION_RESOLUTION_FACTOR:Z,MOTION_BITRATE_FACTOR:ae,DETAIL_FRAMERATE_FACTOR:ye,DETAIL_BITRATE_FACTOR:_e}=FL,ue=Math.min(r.frameRate,m),Ae=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(A,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(N,1)*ue),fps_up:a},balanced:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d},motion:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d},detail:{scaleResolutionDownBy:1,frameRate:a,bitrateMax:s,bitrateMin:d}}];for(let Ue=1;Ue<=g;Ue++){const We={bwe_up:Math.round(Math.pow(I,Ue)*s),bwe_down:Math.round(Math.pow(A,Ue+1)*s),fps_up:Math.round(Math.pow(G,Ue)*ue),fps_down:Math.round(Math.pow(N,Ue+1)*ue)},Ze={scaleResolutionDownBy:c/Math.pow(ee,Ue),frameRate:Math.max(Math.round(Math.pow(z,Ue)*a),h),bitrateMax:Math.max(Math.round(Math.pow(F,Ue)*s),w),bitrateMin:Math.max(Math.round(Math.pow(F,Ue)*d),E)},_n={scaleResolutionDownBy:c/Math.pow(Z,Ue),frameRate:a,bitrateMax:Math.max(Math.round(Math.pow(ae,Ue)*s),w),bitrateMin:Math.max(Math.round(Math.pow(ae,Ue)*d),E)},Sn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(ye,Ue)*a),h),bitrateMax:Math.max(Math.round(Math.pow(_e,Ue)*s),w),bitrateMin:Math.max(Math.round(Math.pow(_e,Ue)*d),E)};Ae.push({scale:Ue,threshold:We,balanced:Ze,motion:_n,detail:Sn})}return Ae}function e_e(t,r,s,a,c,d){const h=tP.get(t)||{overUse:0,underUse:0,adaptationList:G7(c)},{adaptationList:m}=h;tP.set(t,h);const{OVERUSE_TIMES_THRESHOLD:g,UNDERUSE_TIMES_THRESHOLD:E}=FL,{scale:w}=a;let I,A;return typeof r=="number"&&r>0&&(function(N,G,F,z){if(G>=F.length)return!1;let{threshold:{fps_down:ee}}=F[G];return oe("FORCE_AG_HIGH_FRAMERATE")&&z==="maintain-framerate"&&(ee=F[0].threshold.fps_down),N<ee})(r,w,m,d)&&(h.overUse++,A=tT.CPU,h.overUse>g)||typeof s=="number"&&s>0&&(function(N,G,F){if(G>=F.length)return!1;const{threshold:{bwe_down:z}}=F[G];return N<z})(s,w,m)&&(h.overUse++,A=tT.BANDWIDTH,h.overUse>g)?(h.overUse=0,h.underUse=0,I=z7(a,m,d,p0.DOWN),[I,A]):(typeof r=="number"&&r>0&&typeof s=="number"&&s>0&&(function(N,G,F,z){if(G===0)return;let{threshold:{fps_up:ee}}=F[G];return oe("FORCE_AG_HIGH_FRAMERATE")&&z==="maintain-framerate"&&(ee=F[1].threshold.fps_up),N>ee})(r,w,m,d)&&(function(N,G,F){if(G===0)return;const{threshold:{bwe_up:z}}=F[G];return N>z})(s,w,m)&&(h.underUse++,h.underUse>E&&(h.overUse=0,h.underUse=0,I=z7(a,m,d,p0.UP),I.scale===0&&(A=tT.NONE))),[I,A])}function H7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function W2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?H7(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):H7(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}const nP=new Map;function rP(t,r){const s=nP.get(t);if(s){const{timer:a}=s;window.clearTimeout(a),nP.delete(t)}r.qualityLimitationReason=tT.NONE,W7(t)}function t_e(t,r){var s;let a;switch(r){case Xe.LocalAudioTrack:a=cr.Audio;break;case Xe.LocalVideoTrack:a=rt(s=t._hints).call(s,Sr.SCREEN_TRACK)?cr.Screen:cr.High;break;case Xe.LocalVideoLowTrack:a=cr.Low}return a}function G2(t){const r=Bn();if(t.some((s=>s._bypassWebAudio)))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function H2(t,r){G2(t);const s=new Fi;return t.forEach((a=>s.addAudioTrack(a))),s}const n_e=!Bn().supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&ff();function iP(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;return n_e?(s={spec:r,store:t},Ef("PlanBConnection").create(s)):new nu(r,t)}function $2(t){return t&&(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")}function $7(t){try{if(t.iceServers)return!1;if(t.turnServer&&t.turnServer.mode!=="off"){if(Qw(t.turnServer.servers))return!1;if(oe("FORCE_TURN_TCP")||t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).some((r=>r.forceturn)))return!0}return!1}catch{return!1}}var Mn;function K7(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function Zd(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?K7(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):K7(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}let nu=(Mn=class Iy extends XG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map((r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"")).filter((r=>{var s;return rt(s=Object.keys(rT)).call(s,r)})))]}constructor(r,s){super(r,s),X(this,"id",wr(5,"connection-")),X(this,"store",void 0),X(this,"peerConnection",void 0),X(this,"forceTurn",!1),X(this,"remoteSDP",void 0),X(this,"initialOffer",void 0),X(this,"transportEventReceiver",void 0),X(this,"statsFilter",void 0),X(this,"extension",{useXR:oe("USE_XR")}),X(this,"localCapabilities",void 0),X(this,"remoteCodecs",void 0),X(this,"localCandidateCount",0),X(this,"allCandidatesReceived",!1),X(this,"isPreallocation",!1),X(this,"preMediaMap",new Map),X(this,"dataStreamChannelMap",new Map),X(this,"establishPromise",void 0),X(this,"recoveredDataChannelIds",[]),X(this,"currentDataChannelId",1),X(this,"supportAV1RtpSpec",!1),X(this,"mutex",void 0),X(this,"qualityLimitationReason",tT.NONE),X(this,"isFirstConnected",!1),this.store=s,this.forceTurn=$7(r),this.mutex=new ro("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Iy.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=UL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,ni()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,r.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(r){return this.preMediaMap.get(r)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(r,s){if(this.remoteCodecs=s,!this.remoteSDP)return void M.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(r,s,this.store.codec)){const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}else M.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Zm(a.sdp),d=await m7({filterRTX:!oe("USE_PUB_RTX")&&!oe("USE_SUB_RTX"),filterVideoFec:oe("FILTER_VIDEO_FEC"),filterAudioFec:oe("FILTER_AUDIO_FEC"),filterVideoCodec:oe("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:oe("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:oe("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=q1(d),this.initialOffer=a,oe("ENABLE_SVC")&&this.store.codec=="av1"){const m=await(async function(){try{const g=new RTCPeerConnection;g.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:y1.L1T3}]});const E=await g.createOffer();if(!E.sdp)return void g.close();const w=tc(E.sdp).mediaDescriptions[0];if(!w)return;const I=w.attributes.extmaps.find((A=>A.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"));return g.close(),I}catch{return}})();var r;m&&(this.supportAV1RtpSpec=!0,(r=d.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return a.sdp&&E7(a.sdp)&&(h=$r(d),(s=h).send&&(c0(vt.VIDEO,s.send.videoExtensions),c0(vt.AUDIO,s.send.audioExtensions)),s.recv&&(c0(vt.VIDEO,s.recv.videoExtensions),c0(vt.AUDIO,s.recv.audioExtensions)),s.sendrecv&&(c0(vt.VIDEO,s.sendrecv.videoExtensions),c0(vt.AUDIO,s.sendrecv.audioExtensions))),Zd(Zd({},c),{},{rtpCapabilities:h||d,offerSDP:a.sdp})}catch(a){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,a.toString())}var s}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&E7(this.initialOffer.sdp)&&(s=r.rtpCapabilities,a=this.localCapabilities,s.send&&(H1(vt.VIDEO,s.send.videoExtensions,a.send.videoExtensions),H1(vt.AUDIO,s.send.audioExtensions,a.send.audioExtensions)),s.recv&&(H1(vt.VIDEO,s.recv.videoExtensions,a.recv.videoExtensions),H1(vt.AUDIO,s.recv.audioExtensions,a.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return $r(this._localCapabilities)}get rtpCapabilities(){return $r(this._rtpCapabilities)}get candidates(){return $r(this._candidates)}get iceParameters(){return $r(this._iceParameters)}get dtlsParameters(){return $r(this._dtlsParameters)}constructor(g){let E=arguments.length>1&&arguments[1]!==void 0&&arguments[1],w=arguments.length>2&&arguments[2]!==void 0&&arguments[2];X(this,"sessionDesc",void 0),X(this,"_localCapabilities",void 0),X(this,"_rtpCapabilities",void 0),X(this,"_candidates",void 0),X(this,"_originCandidates",void 0),X(this,"_iceParameters",void 0),X(this,"_isUseExtmapAllowMixed",void 0),X(this,"_isUseLocalCodecs",void 0),X(this,"_dtlsParameters",void 0),X(this,"setup",void 0),X(this,"currentMidIndex",void 0),X(this,"cname",void 0),X(this,"useLocalCodecsMids",[]),X(this,"preloadSsrcs",[]),X(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=E,this._isUseLocalCodecs=w,g=$r(g);const{iceParameters:I,dtlsParameters:A,candidates:N,rtpCapabilities:G,setup:F,localCapabilities:z,cname:ee}=g;this._rtpCapabilities=G,this._candidates=N,this._originCandidates=$r(N),this._iceParameters=I,this._dtlsParameters=A,this._localCapabilities=z,this.setup=F,this.cname=ee,[this.sessionDesc]=this.updateRemoteRTPCapabilities(G),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(g){return g.length===this.preloadSsrcs.length&&g.every((E=>{var w;return rt(w=this.preloadSsrcs).call(w,E)}))}preloadRemoteMedia(g){let E=0;const w=[],I=[];for(;g>0;){const A=[B2({ssrcId:eP+E},oe("USE_SUB_RTX")?{rtx:eP+E+1}:{})],N="".concat(eP+E,"_").concat(z2+E),{ssrcs:G,ssrcGroups:F}=fT(A,this.cname,oe("SYNC_GROUP")?N:void 0),z=this.preCreateOrRecycleSendMedia("video",G,F,void 0),ee=[{ssrcId:z2+E}],Z="".concat(eP+E,"_").concat(z2+E),{ssrcs:ae,ssrcGroups:ye}=fT(ee,this.cname,oe("SYNC_GROUP")?Z:void 0),_e=this.preCreateOrRecycleSendMedia("audio",ae,ye,void 0);g--,E+=2,w.push(z,_e),I.push(G[0].ssrcId,ae[0].ssrcId)}return this.useLocalCodecsMids.push(...w),this.preloadSsrcs=I,{mids:w,preSSRCs:I,isAvailable:!0}}preCreateOrRecycleSendMedia(g,E,w,I){const A=this.rtpCapabilities.send.videoCodecs,N=this._isUseLocalCodecs||A.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;M.debug("create or recycle send media without remote rtp capabilities, ssrcs ",E[0].ssrcId);const G=g===vt.VIDEO?N.videoCodecs:N.audioCodecs,F=g===vt.VIDEO?N.videoExtensions:N.audioExtensions;this.currentMidIndex+=1;const z="".concat(this.currentMidIndex);let ee={media:{mediaType:g,port:Z1,protos:["UDP","TLS","RTP","SAVPF"],fmts:G.map((Z=>Z.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:F,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:w,rtcpFeedbackWildcards:[],payloads:G,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(z)}};return ee=this.mungSendMediaDesc(ee,I),this.sessionDesc.mediaDescriptions.push(ee),this.updateBundleMids(),z}toString(){return Km(this.sessionDesc)}send(g,E,w,I){const{ssrcs:A,ssrcGroups:N}=fT(E,this.cname,oe("SYNC_GROUP")?w:void 0),G=this.findPreloadMediaDesc(A);if(G){if(ni()&&this.firefoxSsrcMidMap.set(A[0].ssrcId,G.attributes.mid),I&&(I.twcc||I.remb)){const F=this.sessionDesc.mediaDescriptions.indexOf(G);return this.sessionDesc.mediaDescriptions[F]=this.mungSendMediaDesc(G,I),{mid:G.attributes.mid,needExchangeSDP:!0}}return{mid:G.attributes.mid,needExchangeSDP:!1}}{const F=this.findAvailableMediaIndex(g,A);let z;return F===-1||F===1&&(Vs()||(function(){const ee=Ln();return!(ee.name!==qn.CHROME||!ee.osVersion)&&Number(ee.version)<=90})()||oe("ENABLE_ENCODED_TRANSFORM")&&pf())||F===0&&!(function(ee){const Z=Ln();return!(Z.name!==qn.FIREFOX||!Z.osVersion)&&Number(Z.version)===ee})(138)&&oe("USE_SUB_RTX")||zz()?(z=this.createOrRecycleSendMedia(g,A,N,"sendonly",I),this.updateBundleMids()):(z=$r(this.sessionDesc.mediaDescriptions[F]),z.attributes.direction="sendonly",z.attributes.ssrcs=A,z.attributes.ssrcGroups=N,this.sessionDesc.mediaDescriptions[F]=this.mungSendMediaDesc(z,I)),ni()&&this.firefoxSsrcMidMap.set(A[0].ssrcId,z.attributes.mid),{mid:z.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:g,needExchangeSDP:E}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:g.attributes.mid,needExchangeSDP:E}}batchSend(g){const E=g.map((A=>{let{kind:N,ssrcMsg:G,mslabel:F}=A;return this.send(N,G,F)})),w=[];let I=!1;return E.forEach((A=>{let{mid:N,needExchangeSDP:G}=A;G&&(I=!0),w.push(N)})),{mids:w,needExchangeSDP:I}}stopSending(g){const E=this.sessionDesc.mediaDescriptions.filter((w=>w.attributes.mid&&g.indexOf(w.attributes.mid)!==-1));if(E.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");E.forEach((w=>{w.attributes.mid==="0"||ni()||zz()?w.attributes.ssrcs=[]:(w.attributes.ssrcs=[],w.attributes.direction="inactive",w.media.port="0")})),this.updateBundleMids()}mute(g){const E=this.sessionDesc.mediaDescriptions.find((w=>w.attributes.mid===g));if(!E)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.mute."));E.attributes.direction="inactive"}unmute(g){const E=this.sessionDesc.mediaDescriptions.find((w=>w.attributes.mid===g));if(!E)throw new Error("mediaDescription not found with ".concat(g," in remote SDP when calling RemoteSDP.unmute."));E.attributes.direction="sendonly"}muteRemote(g){const E=this.sessionDesc.mediaDescriptions.filter((w=>rt(g).call(g,w.attributes.mid||"")));if(E.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");E.forEach((w=>{w.attributes.direction="inactive"}))}unmuteRemote(g){const E=this.sessionDesc.mediaDescriptions.filter((w=>rt(g).call(g,w.attributes.mid||"")));if(E.length!==g.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");E.forEach((w=>{w.attributes.direction="recvonly"}))}receive(g,E,w,I){g.forEach(((A,N)=>{this.createOrRecycleRecvMedia(A,[],"recvonly",E,w,I[N])})),this.updateBundleMids()}stopReceiving(g){const E=this.sessionDesc.mediaDescriptions.filter((w=>g.indexOf(w.attributes.mid)!==-1));if(E.length!==g.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");E.forEach((w=>{w.media.port="0",w.attributes.direction="inactive"})),this.updateBundleMids()}updateRemoteRTPCapabilities(g){const E=this.sessionDesc||tc((w=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(w?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var w;this._rtpCapabilities=g;let I=!1;const A=this.rtpCapabilities.send,N=this.localCapabilities.send,G=this.localCapabilities.recv,F=G.videoCodecs,z=G.audioCodecs,ee=G.videoExtensions,Z=G.audioExtensions;for(const ue of E.mediaDescriptions){var ae;if(ue.attributes.direction!=="sendonly"||typeof ue.attributes.mid!="string"||!rt(ae=this.useLocalCodecsMids).call(ae,ue.attributes.mid)){if(I=!0,ue.attributes.iceUfrag=this._iceParameters.iceUfrag,ue.attributes.icePwd=this._iceParameters.icePwd,ue.attributes.fingerprints=this._dtlsParameters.fingerprints,ue.attributes.candidates=this._candidates,ue.attributes.setup=this.setup,ue.media.mediaType==="application"&&(ue.attributes.sctpPort="5000"),ue.media.mediaType==="video")if(this._isUseLocalCodecs&&ue.attributes.direction==="sendonly"){var ye;ue.media.fmts=F.map((Ue=>Ue.payloadType.toString(10))),ue.attributes.payloads=F,ue.attributes.extmaps=ee;const Ae=ue.attributes.mid;typeof Ae!="string"||rt(ye=this.useLocalCodecsMids).call(ye,Ae)||this.useLocalCodecsMids.push(Ae)}else if(A.videoCodecs.length===0){const Ae=N.videoCodecs.filter((Ue=>{var We,Ze;return(We=Ue.rtpMap)===null||We===void 0?void 0:rt(Ze=We.encodingName.toLowerCase()).call(Ze,"vp8")}))||[N.videoCodecs[0]];ue.media.fmts=Ae.map((Ue=>Ue.payloadType.toString(10))),ue.attributes.payloads=Ae,ue.attributes.extmaps=[]}else ue.media.fmts=A.videoCodecs.map((Ae=>Ae.payloadType.toString(10))),ue.attributes.payloads=A.videoCodecs,ue.attributes.extmaps=A.videoExtensions;if(ue.media.mediaType==="audio")if(this._isUseLocalCodecs&&ue.attributes.direction==="sendonly"){var _e;ue.media.fmts=z.map((Ue=>Ue.payloadType.toString(10))),ue.attributes.payloads=z,ue.attributes.extmaps=Z;const Ae=ue.attributes.mid;typeof Ae!="string"||rt(_e=this.useLocalCodecsMids).call(_e,Ae)||this.useLocalCodecsMids.push(Ae)}else if(A.audioCodecs.length===0){const Ae=N.audioCodecs.filter((Ue=>{var We,Ze;return(We=Ue.rtpMap)===null||We===void 0?void 0:rt(Ze=We.encodingName.toLowerCase()).call(Ze,"opus")}))||[N.audioCodecs[0]];ue.media.fmts=Ae.map((Ue=>Ue.payloadType.toString(10))),ue.attributes.payloads=Ae,ue.attributes.extmaps=[]}else ue.media.fmts=A.audioCodecs.map((Ae=>Ae.payloadType.toString(10))),ue.attributes.payloads=A.audioCodecs,ue.attributes.extmaps=A.audioExtensions,u0(ue)}}return this.sessionDesc=E,this.currentMidIndex=E.mediaDescriptions.length-1,[this.sessionDesc,I]}updateCandidates(g){const E=this._originCandidates.filter((I=>I.transport==="udp")),w=[];if(E.forEach((I=>{w.push(B2(B2({},I),{},{foundation:"tcpcandidate",priority:Number(I.priority)-1+"",transport:"tcp",port:Number(I.port)+90+""}))})),E.length!==0){switch(g){case oo.TCP_RELAY:this._candidates=w;break;case oo.UDP_TCP_RELAY:case oo.RELAY:this._candidates=[...E,...w];break;default:this._candidates=E}for(const I of this.sessionDesc.mediaDescriptions)I.attributes.candidates=this.candidates}}restartICE(g){g=$r(g),this._iceParameters=g,this.sessionDesc.mediaDescriptions.forEach((E=>{E.attributes.iceUfrag=g.iceUfrag,E.attributes.icePwd=g.icePwd}))}predictReceivingMids(g){const E=[];for(let w=0;w<g;w++)E.push((this.currentMidIndex+w+1).toString(10));return E}findAvailableMediaIndex(g,E){return this.sessionDesc.mediaDescriptions.findIndex((w=>{const I=w.media.mediaType===g&&w.media.port!=="0"&&(w.attributes.direction==="sendonly"||w.attributes.direction==="sendrecv")&&w.attributes.ssrcs.length===0;if(ni()){if(I){const A=this.firefoxSsrcMidMap.get(E[0].ssrcId);return!(A||w.attributes.mid!=="0"&&w.attributes.mid!=="1")||!(!A||A!==w.attributes.mid)}return!1}return I}))}createOrRecycleDataChannel(){for(const w of this.sessionDesc.mediaDescriptions)if(w.media.mediaType==="application")return{mediaDesc:w,needExchangeSDP:!1};this.currentMidIndex+=1;const g="".concat(this.currentMidIndex),E={media:{mediaType:"application",port:Z1,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(g),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(E),{mediaDesc:E,needExchangeSDP:!0}}createOrRecycleRecvMedia(g,E,w,I,A,N){const G=g._mediaStreamTrack.kind,F=this.rtpCapabilities.recv,z=mT(G,F,this.localCapabilities.send,G===vt.VIDEO?I:A),ee=G===vt.VIDEO?F.videoExtensions:F.audioExtensions;this.currentMidIndex+=1;const Z="".concat(this.currentMidIndex);let ae={media:{mediaType:G,port:Z1,protos:["UDP","TLS","RTP","SAVPF"],fmts:z.map((_e=>_e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:ee,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:z,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:w,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Z)}};ae=this.mungRecvMediaDsec(ae,g,N);const ye=this.findFirstClosedMedia(G);if(ye){const _e=this.sessionDesc.mediaDescriptions.indexOf(ye);this.sessionDesc.mediaDescriptions[_e]=ae}else this.sessionDesc.mediaDescriptions.push(ae);return ae}updateRemoteDtlsParameters(g){const E=new Set(this._dtlsParameters.fingerprints.map((A=>A.fingerprint))),w=new Set(g.map((A=>A.fingerprint)));let I=!1;E.size!==w.size&&(I=!0);for(const A of E)w.has(A)||(I=!0);return I}updateRemoteCodec(g,E,w){const I=[...new Set(this._rtpCapabilities.recv.videoCodecs.map((ae=>ae.rtpMap&&ae.rtpMap.encodingName.toLowerCase()||"")).filter((ae=>{var ye;return rt(ye=Object.keys(rT)).call(ye,ae)})))],A=new Set(E);if(I.every((ae=>A.has(ae))))return M.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(E)),!1;const N=this._rtpCapabilities.recv.videoCodecs.filter((ae=>E.some((ye=>{var _e;return rt(_e=ae.rtpMap&&ae.rtpMap.encodingName.toLowerCase()||"").call(_e,ye)}))));if(N.length===0)return M.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(I," codecs: ").concat(E)),!1;const G=[...new Set(N.map((ae=>ae.rtpMap&&ae.rtpMap.encodingName.toLowerCase()||"")))];let F;if(M.debug("updateRemoteCodec, from ".concat(I," to ").concat(G)),g.length===0)F=this.sessionDesc.mediaDescriptions.filter((ae=>ae.media.mediaType==="video"&&ae.attributes.direction==="recvonly"));else if(F=this.sessionDesc.mediaDescriptions.filter((ae=>ae.attributes.mid&&ae.media.mediaType==="video"&&rt(g).call(g,ae.attributes.mid)&&ae.attributes.direction==="recvonly")),F.length!==g.length)return M.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(g,", codecs: ").concat(E)),!1;if(oe("USE_PUB_RTX")||oe("USE_SUB_RTX")){const ae=eg(N,this.rtpCapabilities.recv.videoCodecs);N.push(...ae)}this._rtpCapabilities.recv.videoCodecs=N;const z=this.localCapabilities.send,ee=this.rtpCapabilities.recv,Z=mT(vt.VIDEO,ee,z,w);return F.forEach((ae=>{const ye=Z.map((_e=>_e.payloadType.toString(10)));M.debug("updateRemoteCodec mid: ".concat(ae.attributes.mid,", from"),ae.attributes.payloads,"to",Z),ae.attributes.payloads=Z,ae.media.fmts=ye})),!0}createOrRecycleSendMedia(g,E,w,I,A){const N=this.rtpCapabilities.send.videoCodecs,G=this._isUseLocalCodecs||N.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,F=g===vt.VIDEO?G.videoCodecs:G.audioCodecs,z=g===vt.VIDEO?G.videoExtensions:G.audioExtensions;this.currentMidIndex+=1;const ee="".concat(this.currentMidIndex);let Z={media:{mediaType:g,port:Z1,protos:["UDP","TLS","RTP","SAVPF"],fmts:F.map((ye=>ye.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:z,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:w,rtcpFeedbackWildcards:[],payloads:F,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:I,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ee)}};Z=this.mungSendMediaDesc(Z,A);const ae=this.findFirstClosedMedia(g);if(ae){const ye=this.sessionDesc.mediaDescriptions.indexOf(ae);this.sessionDesc.mediaDescriptions[ye]=Z}else this.sessionDesc.mediaDescriptions.push(Z);return Z}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((g=>g.media.port!=="0")).map((g=>g.attributes.mid))}mungRecvMediaDsec(g,E,w){const I=$r(g);return A2(I),l0(I,E),P2(I,E),p7(I),K1(I,w,this.localCapabilities.send),I}mungSendMediaDesc(g,E){const w=$r(g);return K1(w,E,this.localCapabilities.recv),u0(w),w}updateRecvMedia(g,E){const w=this.sessionDesc.mediaDescriptions.findIndex((I=>I.attributes.mid===g));if(w!==-1){const I=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[w],E);this.sessionDesc.mediaDescriptions[w]=I}}bumpMid(g){this.currentMidIndex+=g}findFirstClosedMedia(g){return this.sessionDesc.mediaDescriptions.find((E=>ni()?E.media.port==="0"&&E.media.mediaType===g:E.media.port==="0"))}findPreloadMediaDesc(g){return this.sessionDesc.mediaDescriptions.find((E=>{var w;return((w=E.attributes)===null||w===void 0||(w=w.ssrcs[0])===null||w===void 0?void 0:w.ssrcId)===g[0].ssrcId}))}getSSRC(g){var E;return(E=this.sessionDesc.mediaDescriptions.find((w=>w.attributes.mid===g)))===null||E===void 0?void 0:E.attributes.ssrcs}}(Zd(Zd({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!oe("ENABLE_PRE_SUB_WITH_PRE_PC")||!oe("PRE_USE_LOCAL_CODECS"))&&HL(this.store)),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),d=_7(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(d||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:d}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),HL(this.store))if(r.preallocation&&oe("ENABLE_PRE_SUB_WITH_PRE_PC")){const g=oe("PRE_SUB_NUM"),{mids:E,preSSRCs:w}=this.remoteSDP.preloadRemoteMedia(g);await tg(this.peerConnection,this.remoteSDP,this.extension),M.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(w)),this.presetMedia(E,w)}else{const{preSSRCs:g=[]}=r,E=g.map((I=>I.ssrcMsg[0].ssrcId));if(g.length===0)return;const{mids:w}=this.remoteSDP.batchSend(g.map((I=>Object.assign({},I))));await tg(this.peerConnection,this.remoteSDP,this.extension),M.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(E)),this.presetMedia(w,E)}}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var s,a}presetMedia(r,s){r.forEach(((a,c)=>{this.peerConnection.getTransceivers().forEach((d=>{if(d.mid!=null&&a===d.mid&&d.receiver.track){const h=d.receiver.track;let m;h.kind==="video"&&oe("ENABLE_PRE_RENDER")&&(m=new i2({trackId:"track-".concat(h.kind,"-unknown-").concat(this.store.clientId,"_").concat(wr(5,""))},!0),m.updateVideoTrack(h),m.onFirstVideoFrameRender=()=>{var g;const E=this.preMediaMap.get(s[c]);E&&(E.firstVideoRender=Date.now()),(g=this.onFirstVideoRender)===null||g===void 0||g.call(this,s[c])},m.play(this.store.sessionId||void 0)),this.preMediaMap.set(s[c],{mid:a,track:h,player:m,transceiver:d})}})),this.store.peerReceiver()}))}checkDtlsParameters(r){return!!this.remoteSDP&&r.length>0&&this.remoteSDP.updateRemoteDtlsParameters(r)}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let s=!1;const{rtpCapabilities:a}=r;if([,s]=this.remoteSDP.updateRemoteRTPCapabilities(a),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const h=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);s=s||h}const{preSSRCs:c=[]}=r,d=c.map((h=>h.ssrcMsg[0].ssrcId));if(!this.remoteSDP.checkPreloadSsrcs(d)){const h=[],m=[];if(Array.from(this.preMediaMap.entries()).every((g=>{let[E,{mid:w,player:I,track:A}]=g;return h.push(w),m.push(E),this.preMediaMap.delete(E),I&&I.destroy(),!0})),h.length>0&&(this.remoteSDP.stopSending(h),await tg(this.peerConnection,this.remoteSDP,this.extension),M.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(m)),It.reportApiInvoke(this.store.sessionId,{name:di.PRELOAD_MEDIA_FAILED,options:[c,m],tag:Hr.TRACER}).onSuccess()),c.length>0){const{mids:g}=this.remoteSDP.batchSend(c.map((E=>Object.assign({},E))));await tg(this.peerConnection,this.remoteSDP,this.extension),M.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(d)),this.presetMedia(g,d)}}s?(await tg(this.peerConnection,this.remoteSDP,this.extension),M.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):M.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(r,s,a){var c=this;return Xl((function*(){const d=yield Fn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=G1();r.forEach((z=>{const ee=c.peerConnection.addTransceiver(z._mediaStreamTrack,Zd({direction:"sendonly"},z.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(ee),z._updateRtpTransceiver(ee)})),ni()&&oe("SIMULCAST")===!0&&(yield Fn(c.applySimulcastForFirefox(h,r)));const g=yield Fn(c.peerConnection.createOffer()),E=c.remoteSDP.predictReceivingMids(r.length),w=c.mungSendOfferSDP(g.sdp,r,E),I=tc(w),A=E.map((z=>{const ee=I.mediaDescriptions.find((Z=>Z.attributes.mid===z));if(!ee)throw new Error("Cannot extract ssrc from mediaDescription.");return u7(ee,oe("USE_PUB_RTX"))}));let N;try{N=yield A}catch(z){N=[],c.remoteSDP.receive(r,s,a,N);const ee=c.remoteSDP.toString();throw yield Fn(c.peerConnection.setLocalDescription({type:"offer",sdp:w})),yield Fn(c.peerConnection.setRemoteDescription({type:"answer",sdp:ee})),yield Fn(c.stopSending(E,!0)),z}c.remoteSDP.receive(r,s,a,N);const G=c.remoteSDP.toString(),F=c.logSDPExchange(w,"offer","local","send");return yield Fn(c.peerConnection.setLocalDescription({type:"offer",sdp:w})),yield Fn(c.applySimulcastEncodings(h,r)),yield Fn(c.applySendEncodings(h,r)),F==null||F(G),yield Fn(c.peerConnection.setRemoteDescription({type:"answer",sdp:G})),h.map(((z,ee)=>{const Z=E[ee];return{localSSRC:A[ee],id:Z,transceiver:z}}))}catch(h){throw h instanceof Le?h:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}}))()}async createDataChannels(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let a=this.dataStreamChannelMap.get(r);if(a&&a.readyState==="open")M.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const d=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof d!="number")throw new Error("create DataChannel error, because cannot get dc id");a=this.peerConnection.createDataChannel("datastream-channel",{id:d,negotiated:!0,ordered:!1,maxRetransmits:oe("DATASTREAM_MAX_RETRANSMITS")}),a.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,a)}s.forEach((d=>{d._updateOriginDataChannel(a)}));const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),M.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else M.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(a){throw a instanceof Le?a:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(a.toString()))}}async stopDataChannels(r){try{const s=this.dataStreamChannelMap.get(r);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(r)}catch(s){throw s instanceof Le?s:new Le(te.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(r,s){const a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter((g=>r.indexOf(g.mid)!==-1));if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map((g=>{var E;rP(this.id+g.mid,this),g.direction="inactive",(E=g.stop)===null||E===void 0||E.call(g)}));const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);h&&(await tg(this.peerConnection,this.remoteSDP,this.extension),M.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find((g=>g.mid===d));if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:d,transceiver:m}}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:a}=this.remoteSDP.batchSend(r);return a&&(await tg(this.peerConnection,this.remoteSDP,this.extension),M.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map((c=>{const d=this.peerConnection.getTransceivers().find((h=>h.mid===c));if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:c,transceiver:d}}))}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach((d=>{Array.from(this.preMediaMap.entries()).some((h=>{let[m,{mid:g,player:E}]=h;if(g===d)return this.preMediaMap.delete(m),E&&E.destroy(),!0}))})),this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter((h=>h.mid&&r.indexOf(h.mid)!==-1));if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map((h=>{h.direction="inactive"}));const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter((h=>h.mid&&r.indexOf(h.mid)!==-1));if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map((async(h,m)=>{h.direction="sendonly"}));const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const d=this.remoteSDP.toString();c==null||c(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return Xl((function*(){const a=yield Fn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Bn().supportPCSetConfiguration,d=oe("FORCE_TURN_TCP")||s.forceTurn;if(r===oo.RELAY&&!c)return;if(c&&!d){const I=r===oo.RELAY?"relay":"all",A=s.peerConnection.getConfiguration();A.iceTransportPolicy!==I&&(M.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(A.iceTransportPolicy,"] to [").concat(I,"]")),A.iceTransportPolicy=I,s.peerConnection.setConfiguration(A))}s.remoteSDP.updateCandidates(r);const h=yield Fn(s.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Zm(h.sdp),{remoteIceParameters:g}=yield m.iceParameters;s.remoteSDP.restartICE(g);const E=s.remoteSDP.toString(),w=s.logSDPExchange(h.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield Fn(s.peerConnection.setLocalDescription(h)),w==null||w(E),yield Fn(s.peerConnection.setRemoteDescription({type:"answer",sdp:E}))}catch(c){M.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}}))()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(oo.TCP_RELAY),await tg(this.peerConnection,this.remoteSDP,this.extension)}catch(s){M.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach((s=>{rP(this.id+s.mid,this)})),this.preMediaMap.forEach((s=>{let{player:a}=s;a&&a.destroy()})),this.preMediaMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Zd(Zd({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Le(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getTransceivers().filter((c=>c.mid===r));a.length===1&&(this.isVP8Simulcast(s)?ni()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getTransceivers().find((c=>c.mid===s));a&&await a.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:a,remote:c}=s.getSelectedCandidatePair();return{local:Zd(Zd({},ep),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:Zd(Zd({},ep),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var s;const a="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"",d=cy(r.url||"");M.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(a,"), url: ").concat(d||"",", host_candidate:").concat(c)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,a)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),oe("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[]},a=r.cloudProxyServer||"disabled";return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&(Qw(r.turnServer.servers)?s.iceServers=r.turnServer.servers:oe("NEW_TURN_MODE")&&s.iceServers&&a==="disabled"?(oe("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&s.iceServers.push(...Iy.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):s.iceServers.push(...Iy.newTurnServerConfigToIceServers(r.turnServer.servers)),oe("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...Iy.turnServerConfigToIceServers(r.turnServer.servers)),oe("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...Iy.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),oe("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach((c=>{c.forceturn&&(s.iceTransportPolicy="relay")})))),oe("ENABLE_ENCODED_TRANSFORM")&&Bn().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach((a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Jm(a.turnServerURL),":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&!oe("FORCE_TURN_TCP")&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))})),s}static newTurnServerConfigToIceServers(r){const s=[];return r.forEach((a=>{const c=oe("NEW_TURN_MODE");c===1?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}):c===2?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}):c===3?s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Jm(a.turnServerURL),":443?transport=tcp")}):c===4&&(s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=udp")}),s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":3478?transport=tcp")}),s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(Jm(a.turnServerURL),":443?transport=tcp")}))})),s}tryBindTransportEvents(r){const s=r.transport;if(s){this.transportEventReceiver=r,s.onstatechange=()=>{var c;s!=null&&s.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,s.state))},s.onerror=c=>{var d;(d=this.onDTLSTransportError)===null||d===void 0||d.call(this,"error"in c?c.error:c)};const a=s.iceTransport;a&&(a.onstatechange=()=>{const c=s==null?void 0:s.iceTransport.state;var d;c&&((d=this.onICETransportStateChange)===null||d===void 0||d.call(this,c))},a.getSelectedCandidatePair&&(a.onselectedcandidatepairchange=()=>{if(a.getSelectedCandidatePair()){const{local:c,remote:d}=a.getSelectedCandidatePair()||{};if(c&&d){const h=c.address+":"+c.port,m=d.address+":"+d.port;M.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(cy(h)),", remote ").concat(JSON.stringify(cy(m))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var a,c;if(s||(s=this.peerConnection.getSenders().find((z=>z.track===r._mediaStreamTrack))),!s)return M.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return M.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Bn().supportSetRtpSenderParameters)return M.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const d={},h={};switch(r._optimizationMode){case"motion":d.degradationPreference="maintain-framerate";break;case"detail":d.degradationPreference="maintain-resolution";break;case"balanced":d.degradationPreference="balanced"}const m=(function(F,z){return F.getTransceivers().find((ee=>ee.sender.track===z||ee.receiver.track===z))})(this.peerConnection,r._mediaStreamTrack),g=Bme(r);if((function(F){var z;return!(!oe("ENABLE_AG_ADAPTATION")||!(F instanceof I1||rt(z=F._hints).call(z,Sr.CUSTOM_TRACK))||!oe("FORCE_SUPPORT_AG_ADAPTATION")&&!(Fz(14,0,!1)&&Bz(17,4)||jz(14)&&vL(17,4,!0)))})(r)&&m&&s&&g&&this.getLocalVideoStats&&rt(a=["vp8","vp9"]).call(a,this.store.codec)){var E;const F=d.degradationPreference||(rt(E=r._hints).call(E,Sr.CUSTOM_TRACK)?oe("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(z,ee,Z,ae,ye,_e){if(rP(z,Z),ye(ee),ae!=="balanced"&&ae!=="maintain-framerate"&&ae!=="maintain-resolution")return;let ue=-1;W7(z,ee);const Ae=window.setInterval((()=>{const We=nP.get(z);if(!oe("ENABLE_AG_ADAPTATION")||!We)return rP(z,Z),void ye(ee);const Ze=_e();if(Ze.sendPackets>0&&Ze.OutgoingAvailableBandwidth>0){if(ue===-1)return void(ue=Date.now());if(Date.now()-ue<1e3)return;const _n=Ze.sendFrameRate,Sn=Ze.OutgoingAvailableBandwidth,[Qt,rr]=e_e(z,_n,Sn,We.adaptationConfig,ee,ae);rr&&(Z.qualityLimitationReason=rr),Qt&&We.adaptationConfig.scale!==Qt.scale&&(M.debug("[".concat(z,"] applyAdaptation: ").concat(Z.qualityLimitationReason,`
           sendFps `).concat(_n,", bwe ").concat(Sn,", switch from ").concat(We.adaptationConfig.scale," to ").concat(Qt.scale," ")),We.adaptationConfig=W2(W2({},We.adaptationConfig),Qt),ye(Qt))}}),oe("CHECK_LOCAL_STATS_INTERVAL")),Ue=W2({},ee);nP.set(z,{timer:Ae,adaptationConfig:Ue,originConfig:ee,adaptationFunc:ye}),M.debug("[".concat(z,"] start adaptation, originConfig: ").concat(JSON.stringify(ee),", degradationPreference: ").concat(ae))})(this.id+m.mid,g,this,F,(z=>{s&&this.updateAdaptation(s,z)}),this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var w;const{bitrateMax:F,frameRate:z,scaleResolutionDownBy:ee}=r._encoderConfig;F&&(h.maxBitrate=1e3*F),(rt(w=r._hints).call(w,Sr.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(z&&(h.maxFramerate=kc(z)),ee&&ee>=1&&(h.scaleResolutionDownBy=ee))}const{maxFramerate:I}=oe("ENCODER_CONFIG_LIMIT");if(I&&typeof I=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,I):I),oe("DSCP_TYPE")&&ff()){var A;const F=oe("DSCP_TYPE");rt(A=["very-low","low","medium","high"]).call(A,F)&&(h.networkPriority=F)}const N=s.getParameters(),G=(c=N.encodings)===null||c===void 0?void 0:c[0];ni()&&!G&&(d.encodings=[h]),G&&Object.assign(G,h),Object.assign(N,d),M.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(N.encodings))),await s.setParameters(N),await(async function(F,z,ee){try{var Z;if(!Bn().supportSetRtpSenderParameters||!(function(Ae){return Ae==="vp9"||Ae==="av1"})(F)||!oe("ENABLE_SVC"))return;const ae={},ye={},_e=z.getParameters(),ue=(Z=_e.encodings)===null||Z===void 0?void 0:Z[0];ye.scalabilityMode=G1(ee),ue&&Object.assign(ue,ye),Object.assign(_e,ae),await z.setParameters(_e),M.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(_e.encodings)))}catch(ae){M.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",ae)}})(this.store.codec,s,oe("SVC_MODE"))}async updateAdaptation(r,s){var a,c;if(!r)return M.debug("[updateAdaptation] no rtpSender found");if(!Bn().supportSetRtpSenderParameters)return M.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const d={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:g}=s;h&&(d.maxBitrate=1e3*h),m&&(d.maxFramerate=kc(m)),g&&g>=1&&rt(a=["vp8","vp9"]).call(a,this.store.codec)&&(d.scaleResolutionDownBy=g);const E=r.getParameters(),w=(c=E.encodings)===null||c===void 0?void 0:c[0];w&&Object.assign(w,d),Object.assign(E,{});try{await r.setParameters(E),M.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(E.encodings)))}catch(I){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?M.debug("[updateAdaptation] peerConnection not connected}"):M.debug("[updateAdaptation] updateRtpSenderEncodings failed",I):M.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,s){try{if(!Bn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],d=s[a];d instanceof kr&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{M.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,a){const c=tc(r);return s.forEach(((d,h)=>{const m=a[h],g=c.mediaDescriptions.find((E=>E.attributes.mid===m));g&&(l0(g,d),f7(g,d,this.store.codec))})),Km(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let g=0;g<r.length;g++){var a,c,d,h,m;const E=r[g],w=s[g];if(w instanceof kr&&!rt(a=w._hints).call(a,Sr.LOW_STREAM)&&(c=w._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=w._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=w._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=w._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const I={},A={high:1e3*(w._encoderConfig.bitrateMax-50),medium:5e4};I.encodings=[{rid:"m",active:!0,maxBitrate:A.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:A.high}];const N=E.sender.getParameters();await E.sender.setParameters(Object.assign(N,I))}}}async applySimulcastEncodings(r,s){if(!ni()&&r.length===s.length)for(let a=0;a<r.length;a++){const c=s[a];if(c instanceof kr&&this.isVP8Simulcast(c)){const d=r[a],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=d.sender.getParameters();await d.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(r){var s,a,c,d,h;return!!(r instanceof kr&&oe("SIMULCAST")&&this.store.codec==="vp8"&&!rt(s=r._hints).call(s,Sr.LOW_STREAM)&&(a=r._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=r._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,a,c){if(oe("SDP_LOGGING"))return M.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(r){if(Bn().supportPCSetConfiguration){const s=Iy.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}r.isPreallocation&&(this.isPreallocation=!0)}},Rt(Mn.prototype,"updateRemoteRTPCapabilities",[xa],Object.getOwnPropertyDescriptor(Mn.prototype,"updateRemoteRTPCapabilities"),Mn.prototype),Rt(Mn.prototype,"connect",[xa],Object.getOwnPropertyDescriptor(Mn.prototype,"connect"),Mn.prototype),Rt(Mn.prototype,"updateRemoteConnect",[xa],Object.getOwnPropertyDescriptor(Mn.prototype,"updateRemoteConnect"),Mn.prototype),Rt(Mn.prototype,"createDataChannels",[xa],Object.getOwnPropertyDescriptor(Mn.prototype,"createDataChannels"),Mn.prototype),Rt(Mn.prototype,"receive",[xa],Object.getOwnPropertyDescriptor(Mn.prototype,"receive"),Mn.prototype),Rt(Mn.prototype,"batchReceive",[xa],Object.getOwnPropertyDescriptor(Mn.prototype,"batchReceive"),Mn.prototype),Rt(Mn.prototype,"stopReceiving",[xa],Object.getOwnPropertyDescriptor(Mn.prototype,"stopReceiving"),Mn.prototype),Rt(Mn.prototype,"muteRemote",[xa],Object.getOwnPropertyDescriptor(Mn.prototype,"muteRemote"),Mn.prototype),Rt(Mn.prototype,"unmuteRemote",[xa],Object.getOwnPropertyDescriptor(Mn.prototype,"unmuteRemote"),Mn.prototype),Rt(Mn.prototype,"muteLocal",[xa],Object.getOwnPropertyDescriptor(Mn.prototype,"muteLocal"),Mn.prototype),Rt(Mn.prototype,"unmuteLocal",[xa],Object.getOwnPropertyDescriptor(Mn.prototype,"unmuteLocal"),Mn.prototype),Rt(Mn.prototype,"close",[xa],Object.getOwnPropertyDescriptor(Mn.prototype,"close"),Mn.prototype),Rt(Mn.prototype,"updateEncoderConfig",[xa],Object.getOwnPropertyDescriptor(Mn.prototype,"updateEncoderConfig"),Mn.prototype),Rt(Mn.prototype,"updateSendParameters",[xa],Object.getOwnPropertyDescriptor(Mn.prototype,"updateSendParameters"),Mn.prototype),Rt(Mn.prototype,"replaceTrack",[xa],Object.getOwnPropertyDescriptor(Mn.prototype,"replaceTrack"),Mn.prototype),Rt(Mn.prototype,"updateAdaptation",[xa],Object.getOwnPropertyDescriptor(Mn.prototype,"updateAdaptation"),Mn.prototype),Rt(Mn.prototype,"getRemoteSSRC",[xa],Object.getOwnPropertyDescriptor(Mn.prototype,"getRemoteSSRC"),Mn.prototype),Mn);function xa(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}function K2(t,r){let s=document.createElement("video"),a=document.createElement("canvas");s.setAttribute("style","display:none"),a.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),a.width=kc(r.width),a.height=kc(r.height);const c=kc(r.framerate||15);document.body.append(s),document.body.append(a);let d=t._mediaStreamTrack;s.srcObject=new MediaStream([d]),s.play();const h=a.getContext("2d");if(!h)throw new ke(te.UNEXPECTED_ERROR,"can not get canvas context");const m=Bn(),g=a.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];g.canvas||(g.canvas=a),a.startCapture=()=>{if(!s)return a.stopCapture&&a.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const w=s.videoWidth,I=s.videoHeight/w,A=a.width*I;Math.abs(A-a.height)>=2&&(M.debug("adjust low stream resolution","".concat(a.width,"x").concat(a.height," -> ").concat(a.width,"x").concat(A)),a.height=A)}h.drawImage(s,0,0,a.width,a.height),g.requestFrame&&g.requestFrame(),d!==t._mediaStreamTrack&&(d=t._mediaStreamTrack,s.srcObject=new MediaStream([d]))},a.stopCapture=QL((()=>a.startCapture&&a.startCapture()),c);const E=g.stop;return g.stop=()=>{E.call(g),s&&(s.remove(),s.srcObject=null,s=null),a&&(a.width=0,a.remove(),a.stopCapture&&a.stopCapture(),a.startCapture=void 0,a.stopCapture=void 0,a=null),M.debug("clean low stream renderer")},g}var q7=(function(t){return t[t.Video_Send_Type=190]="Video_Send_Type",t})(q7||{}),eh=(function(t){return t[t.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",t[t.Video_Send_Freeze=2082]="Video_Send_Freeze",t[t.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",t[t.Video_Recv_Freeze=2084]="Video_Recv_Freeze",t[t.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",t[t.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",t[t.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",t[t.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",t})(eh||{}),rn=(function(t){return t[t.Video_Send_Retransmit=2062]="Video_Send_Retransmit",t[t.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",t[t.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",t[t.Video_Send_Transmit=2066]="Video_Send_Transmit",t[t.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",t[t.Video_Capture_Height=2033]="Video_Capture_Height",t[t.Video_Capture_Width=2035]="Video_Capture_Width",t[t.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",t[t.Video_Send_Low_Height=2073]="Video_Send_Low_Height",t[t.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",t[t.Video_Send_Low_Width=2077]="Video_Send_Low_Width",t[t.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",t[t.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",t[t.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",t[t.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",t[t.Video_Send_Width=2003]="Video_Send_Width",t[t.Video_Send_Height=2004]="Video_Send_Height",t[t.Video_Send_Disabled=2095]="Video_Send_Disabled",t[t.Video_Send_Adaptation=2032]="Video_Send_Adaptation",t[t.Video_Send_Player_Status=2128]="Video_Send_Player_Status",t[t.Video_Send_Nacks=2009]="Video_Send_Nacks",t[t.Video_Send_Plis=2010]="Video_Send_Plis",t[t.Video_Send_Firs=2011]="Video_Send_Firs",t[t.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",t[t.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",t[t.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",t[t.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",t[t.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",t[t.Video_Send_Bitrate=2012]="Video_Send_Bitrate",t[t.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",t[t.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",t[t.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",t[t.Audio_Send_Level=2038]="Audio_Send_Level",t[t.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",t[t.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",t[t.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",t[t.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",t[t.Audio_Send_Freeze=2081]="Audio_Send_Freeze",t[t.Audio_Send_Disabled=2096]="Audio_Send_Disabled",t[t.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",t[t.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",t[t.Video_Recv_Height=2019]="Video_Recv_Height",t[t.Video_Recv_Width=2018]="Video_Recv_Width",t[t.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",t[t.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",t[t.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",t[t.Video_Recv_Nacks=2026]="Video_Recv_Nacks",t[t.Video_Recv_Plis=2027]="Video_Recv_Plis",t[t.Video_Recv_Firs=2028]="Video_Recv_Firs",t[t.Video_Recv_Disabled=2101]="Video_Recv_Disabled",t[t.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",t[t.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",t[t.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",t[t.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",t[t.Audio_Render_Level=2043]="Audio_Render_Level",t[t.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",t[t.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",t[t.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",t[t.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",t[t.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",t[t.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",t[t.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",t[t.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",t[t.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",t[t.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",t[t.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",t[t.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",t})(rn||{}),Cs=(function(t){return t[t.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",t[t.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",t[t.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",t[t.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",t[t.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",t[t.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",t[t.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",t[t.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",t[t.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",t[t.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",t[t.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",t[t.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",t[t.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",t[t.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",t[t.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",t[t.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",t[t.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",t[t.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",t[t.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",t[t.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",t[t.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",t})(Cs||{}),Da=(function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t[t.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",t})(Da||{}),sP=(function(t){return t[t.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",t})(sP||{});const uy=1e3,oP=6,ET=3,r_e=Math.max(oP,ET,60);function Bt(t,r,s){s!=null&&Number.isFinite(s)&&(t[r]=Math.round(Math.max(0,s)))}function Y7(t){const r={[Da.CONN_TYPE]:0,[Da.RTT]:t.rtt,[Da.STATS_UPDATE_INTERVAL]:t.updateInterval?Math.round(Math.max(0,t.updateInterval)):void 0};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const s=t.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(r[Da.CONN_TYPE]=1),s==="tcp"&&(r[Da.CONN_TYPE]=3),s==="tls"&&(r[Da.CONN_TYPE]=4);break}case"srflx":r[Da.CONN_TYPE]=2;break;case"unknown":r[Da.CONN_TYPE]=5;break;default:r[Da.CONN_TYPE]=0}return r}function X7(t){let r=0;switch(t){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class J7 extends Qr{constructor(r){super(),X(this,"store",void 0),X(this,"uploadWRTCStatsTimer",void 0),X(this,"uploadOutboundDenoiserStatsTimer",void 0),X(this,"uploadExtStatsTimer",void 0),X(this,"uploadExtUsageStatsTimer",void 0),X(this,"uploadInboundExtStatsTimer",void 0),X(this,"requestStats",void 0),X(this,"requestTransportStats",void 0),X(this,"requestLocalMedia",void 0),X(this,"requestRemoteMedia",void 0),X(this,"requestAllTracks",void 0),X(this,"requestVideoIsReady",void 0),X(this,"requestUploadStats",void 0),X(this,"requestUpload",void 0),X(this,"uploadOutboundStarted",!1),X(this,"uploadInboundStarted",!1),X(this,"uploadTransportStarted",!1),X(this,"uploadBaseStatsStarted",!1),X(this,"uploadExtensionUsageStarted",!1),X(this,"lastRecvStats",void 0),X(this,"lastSendStats",void 0),X(this,"lastRefRecvStats",void 0),X(this,"lastRefSendStats",void 0),X(this,"lastNormalRecvStats",void 0),X(this,"lastNormalSendStats",void 0),X(this,"lastExtendStats",{}),X(this,"needUploadStats",{}),X(this,"needUploadRenderFreezeTime",!0),X(this,"lastUploadCompensateTime",-1),X(this,"uploadCompensateDeltaTime",0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const s=r%ET==0,a=r%oP==0,c=r%60==0;let d,h;if(this.uploadTransportStarted&&(d=this.requestStats(),this.store.useP2P&&(h=this.requestStats(!0))),!d&&this.uploadOutboundStarted&&(d=this.requestStats()),!h&&this.uploadInboundStarted&&(h=this.requestStats(!0)),d||h){var m;const g={};if(this.uploadTransportStarted&&d){const w=this.getTransportStats(d,h,s);w&&(g.misc=[w])}if(this.uploadOutboundStarted&&d){const w=this.getOutboundStats(d,a?this.lastNormalSendStats:void 0,s?this.lastRefSendStats:void 0,this.lastSendStats,c);w&&(g.outbound=[w])}if(this.uploadInboundStarted&&h){this.uploadCompensateStats(r);const w=this.getInboundStats(h,a?this.lastNormalRecvStats:void 0,s?this.lastRefRecvStats:void 0,this.lastRecvStats);w&&(g.inbound=w)}const E=(m=this.requestTransportStats)===null||m===void 0?void 0:m.call(this).connectState;E&&(Array.isArray(g.misc)?g.misc[0]&&g.misc[0].addition&&(g.misc[0].addition[sP.RTC_PEER_CONNECTION_STATE]=ML[E]):g.misc=[{addition:{[sP.RTC_PEER_CONNECTION_STATE]:ML[E]}}]),this.needUploadStats.sendType&&(Array.isArray(g.outbound)&&g.outbound[0]&&g.outbound[0].high&&(g.outbound[0].high[q7.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(g)}this.lastRecvStats=h,this.lastSendStats=d,a&&(this.lastNormalRecvStats=h,this.lastNormalSendStats=d),s&&(this.lastRefRecvStats=h,this.lastRefSendStats=d)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval((()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,a;const c=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(c&&((a=this.requestUploadStats)===null||a===void 0||a.call(this,{misc:[{addition:{[sP.RTC_PEER_CONNECTION_STATE]:ML[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===r_e+1&&(r=1)}),uy)}uploadCompensateStats(r){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const s=r%ET==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!s)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const a=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=a,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const c=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*c;const d=this.requestStats(!0);new Array(c).fill(0).forEach((()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const h={};if(this.uploadInboundStarted&&d){const m=this.requestRemoteMedia()||[],g=[];m.forEach((E=>{let[w,I]=E;const A={peer:w.uid};if(w._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(w._videoSSRC)&&I.has(vt.VIDEO)&&w.videoTrack){const N=(function(G,F,z){if(!F.videoRecv.find((Z=>Z.ssrc===G)))return;const ee={};if(z&&z._player){const Z=z._player,{renderFreezeAccTime2:ae,videoElementStatus:ye}=Z;if(rp.visibility==="visible"&&ye===io.PLAYING&&Bn().supportRequestVideoFrameCallback){const _e=Math.min(6e3,ae);Z.renderFreezeAccTime2=Math.max(0,ae-_e),Bt(ee,eh.Video_Render_Freeze_Time_Render2,_e),oe("USE_NEW_RENDER_FREEZE_TIME")&&Bt(ee,eh.Video_Render_Freeze_Time_Render,_e)}}return ee})(w._videoSSRC,d,w.videoTrack);N&&(A.video=N)}A.video&&g.push(A)})),g.length>0&&(h.inbound=g,this.requestUploadStats(h))}}))}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(r,s,a){if(!this.requestStats)return;if(!a)return r.rtt==null?void 0:{addition:{[Da.RTT]:r.rtt,[Da.CONN_TYPE]:void 0,[Da.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=Y7(r);if(this.store.useP2P){if(s){const d=Y7(s);c[Da.CONN_TYPE]+=d[Da.CONN_TYPE]<<3}c[Da.CONN_TYPE]+=110}else c[Da.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,s,a,c,d){if(!this.requestUploadStats||!this.requestLocalMedia)return;const h=this.requestLocalMedia();if(!h||h.length===0)return;let m,g,E;return h.forEach((w=>{let[I,{track:A,ssrcs:N}]=w;switch(I){case Xe.LocalVideoLowTrack:case Xe.LocalVideoTrack:if(I===Xe.LocalVideoTrack){var G;const F=(function(ae,ye,_e,ue,Ae,Ue){const We=ye.videoSend.find((Qt=>Qt.ssrc===ae));if(!We)return;const Ze={},{sentFrame:_n,inputFrame:Sn}=We;if(ue&&(Bt(Ze,eh.Video_Send_Qp_Sum,We.qpSumPerFrame),Sn&&_n)){const Qt=Sn.frameRate,rr=_n.frameRate;Ze[eh.Video_Send_Freeze]=(function(Jn,co){let ze=!0;return ze=!(Jn<=5)&&(Jn<=10?co<3:Jn<=20?co<4:co<5),ze})(Qt,rr)?1:0}if(Ae){switch(_n&&(Bt(Ze,rn.Video_Send_Height,_n.height),Bt(Ze,rn.Video_Send_Width,_n.width),Bt(Ze,rn.Video_Send_Frame_Rate,_n.frameRate)),Ze[rn.Video_Send_Disabled]=_e._originMediaStreamTrack&&!_e._originMediaStreamTrack.enabled||_e._mediaStreamTrack&&!_e._mediaStreamTrack.enabled?1:0,We.adaptionChangeReason){case"none":Ze[rn.Video_Send_Adaptation]=0;break;case"cpu":Ze[rn.Video_Send_Adaptation]=1;break;case"bandwidth":Ze[rn.Video_Send_Adaptation]=2;break;case"other":Ze[rn.Video_Send_Adaptation]=3}let Qt=0;We.adaptionChangeReason&&(Qt+=X7(We.adaptionChangeReason)),ye.qualityLimitationReason&&(Qt+=X7(ye.qualityLimitationReason)<<3),Ze[rn.Video_Send_Adaptation]=Qt,Ze[rn.Video_Send_Player_Status]=XL[_e._player?_e._player.videoElementStatus:"uninit"],Bt(Ze,rn.Video_Send_Nacks,We.nacksCount),Bt(Ze,rn.Video_Send_Plis,We.plisCount),Bt(Ze,rn.Video_Send_Firs,We.firsCount),Bt(Ze,rn.Video_Send_Avg_Encode,We.avgEncodeMs),Bt(Ze,rn.Video_Send_Huge_Frame_Sent,We.hugeFramesSent),Bt(Ze,rn.Video_Send_Bytes_Retransmit,We.retransmittedBytesSent),Bt(Ze,rn.Video_Send_Packages_Retransmit,We.retransmittedPacketsSent),Bt(Ze,rn.Video_Send_Key_Frames_Encoded,We.keyFramesEncoded);const rr=Ae.videoSend.find((Jn=>Jn.ssrc===ae));if(rr){let Jn=uy*ET;rr.timestamp&&We.timestamp&&(Jn=We.timestamp-rr.timestamp),rr.packets!=null&&We.packets!=null&&Bt(Ze,rn.Video_Send_Package_Rate,1e3*(We.packets-rr.packets)/Jn),We.packetsLost!=null&&rr.packetsLost!=null&&Bt(Ze,rn.Video_Send_Package_Lost,We.packetsLost-rr.packetsLost),rr.bytes!=null&&We.bytes!=null&&Bt(Ze,rn.Video_Send_Bitrate,8*(We.bytes-rr.bytes)/Jn)}}return Ze})(N[0].ssrcId,r,A,s,a),z=A.__className__==="CameraVideoTrack"?3:rt(G=A._hints).call(G,Sr.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==z||d)&&(this.needUploadStats={sendType:z},this.lastExtendStats.sendType=z);const ee=A&&(function(ae,ye,_e,ue){const Ae=ye.videoSend.find((We=>We.ssrc===ae));if(!Ae)return null;const Ue={};if(ue){const We=Ae.inputFrame,Ze=We&&We.height||_e.videoHeight||0,_n=We&&We.width||_e.videoWidth||0,Sn=We&&We.frameRate||0;Bt(Ue,rn.Video_Capture_Height,Ze),Bt(Ue,rn.Video_Capture_Width,_n),Bt(Ue,rn.Video_Capture_Frame_Rate,Sn)}return Ue})(N[0].ssrcId,r,A,!!a),Z=(function(ae,ye){const _e={};return ye&&(Bt(_e,rn.Video_Send_Retransmit,ae.bitrate.retransmit),Bt(_e,rn.Video_Send_Target_Encoded,ae.bitrate.targetEncoded),Bt(_e,rn.Video_Send_Actual_Encoded,ae.bitrate.actualEncoded),Bt(_e,rn.Video_Send_Transmit,ae.bitrate.transmit),Bt(_e,rn.Video_Send_Bandwidth,ae.sendBandwidth)),_e})(r,!!a);g=Object.assign({},F,ee,Z)}else E=(function(F,z,ee,Z,ae){const ye=z.videoSend.find((ue=>ue.ssrc===F));if(!ye)return;const _e={};if(Z){const ue=ye.sentFrame;ue&&(Bt(_e,rn.Video_Send_Low_Height,ue.height),Bt(_e,rn.Video_Send_Low_Width,ue.width),Bt(_e,rn.Video_Send_Low_Frame_Rate,ue.frameRate));const Ae=Z.videoSend.find((Ue=>Ue.ssrc===F));if(Ae){let Ue=uy*oP;Ae.timestamp&&ye.timestamp&&(Ue=ye.timestamp-Ae.timestamp),Ae.packets!=null&&ye.packets!=null&&Bt(_e,rn.Video_Send_Low_Package_Rate,1e3*(ye.packets-Ae.packets)/Ue),ye.packetsLost!=null&&Ae.packetsLost!=null&&Bt(_e,rn.Video_Send_Low_Package_Lost,ye.packetsLost-Ae.packetsLost),Ae.bytes!=null&&ye.bytes!=null&&Bt(_e,rn.Video_Send_Low_Bitrate,8*(ye.bytes-Ae.bytes)/Ue)}}return _e})(N[0].ssrcId,r,0,a);break;case Xe.LocalAudioTrack:m=A&&(function(F,z,ee,Z,ae,ye){const _e=z.audioSend.find((Ae=>Ae.ssrc===F));if(!_e)return;const ue={};if(ae){ue[rn.Audio_Send_Disabled]=ee._originMediaStreamTrack&&!ee._originMediaStreamTrack.enabled||ee._mediaStreamTrack&&!ee._mediaStreamTrack.enabled?1:0;const Ae=100*ee._source.getAccurateVolumeLevel(),Ue=_e.inputLevel;if(Ue!=null){const Ze=Math.ceil(50*Math.log10(100*Ue+1));Bt(ue,rn.Audio_Send_Level,Ze)}Bt(ue,rn.Audio_Capture_PCM_Level,Ae),Bt(ue,rn.Audio_Send_AEC_Return_Loss,_e.aecReturnLoss),Bt(ue,rn.Audio_Send_AEC_Return_Loss_Enhancement,_e.aecReturnLossEnhancement),Bt(ue,rn.Audio_Send_Bytes_Retransmit,_e.retransmittedBytesSent),Bt(ue,rn.Audio_Send_Packages_Retransmit,_e.retransmittedPacketsSent),ue[rn.Audio_Send_Freeze]=0;const We=ae.audioSend.find((Ze=>Ze.ssrc===F));if(We){let Ze=uy*oP;We.timestamp&&_e.timestamp&&(Ze=_e.timestamp-We.timestamp),We.bytes!=null&&_e.bytes!=null&&Bt(ue,rn.Audio_Send_Bitrate,8*(_e.bytes-We.bytes)/Ze),We.packets!=null&&_e.packets!=null&&Bt(ue,rn.Audio_Send_Package_Rate,1e3*(_e.packets-We.packets)/Ze)}}return ue})(N[0].ssrcId,r,A,0,a)}})),{high:g,low:E,audio:m}}getInboundStats(r,s,a,c){if(!this.requestRemoteMedia)return;const d=this.requestRemoteMedia()||[],h=[];return d.forEach((m=>{let[g,E]=m;const w={peer:g.uid};if(E.has(vt.VIDEO)&&g.videoTrack){const I=g._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(g._videoSSRC)||!1,A=g.videoTrack?(function(N,G,F,z,ee,Z,ae,ye){const _e=G.videoRecv.find((Qt=>Qt.ssrc===N));if(!_e)return;const ue={},{receivedFrame:Ae,outputFrame:Ue,decodeFrameRate:We}=_e;Bt(ue,Cs.Video_Render_Frame_Rate_Decode,We),_e.framesRateFirefox&&Bt(ue,Cs.Video_Recv_Frame_Rate,_e.framesRateFirefox),Ae&&Bt(ue,Cs.Video_Recv_Frame_Rate,Ae.frameRate),Bt(ue,Cs.Video_Recv_Frame_Dropped,_e.framesDroppedCount),Bt(ue,Cs.Video_Recv_Bytes_Retransmit,_e.retransmittedBytesReceived),Bt(ue,Cs.Video_Recv_Packages_Retransmit,_e.retransmittedPacketsReceived),Bt(ue,Cs.Video_Recv_Packages_Discarded,_e.packetsDiscarded),Bt(ue,Cs.Video_Recv_Avg_Decode,_e.avgDecodeMs),Bt(ue,Cs.Video_Recv_Avg_Processing_Delay,_e.avgProcessingDelayMs),Bt(ue,Cs.Video_Recv_Avg_Assembly_Time,_e.avgFramesAssembledFromMultiplePacketsMs),Bt(ue,Cs.Video_Recv_Avg_Inter_Frame_Delay,_e.avgInterFrameDelayMs),Bt(ue,Cs.Video_Recv_Key_Frames_Decoded,_e.keyFramesDecoded);const Ze=ye&&ye.videoRecv.find((Qt=>Qt.ssrc===N));if(Ze){const Qt=G.timestamp-ye.timestamp||uy;_e.packetsLost!=null&&Ze.packetsLost!=null&&Bt(ue,Cs.Video_Recv_Package_Lost,_e.packetsLost-Ze.packetsLost),Ze.bytes!=null&&_e.bytes!=null&&Bt(ue,Cs.Video_Recv_Bitrate,8*(_e.bytes-Ze.bytes)/Qt),Ze.packets!=null&&_e.packets!=null&&Bt(ue,Cs.Video_Recv_Package_Rate,1e3*(_e.packets-Ze.packets)/Qt)}const _n=Z&&Z.videoRecv.find((Qt=>Qt.ssrc===N));if(_n&&(Bt(ue,eh.Video_Recv_Qp_Sum,_e.qpSumPerFrame),ue[eh.Video_Recv_Freeze]=z&&yT.isRemoteVideoFreeze(F,_e,_n)?1:0),ae){var Sn;const Qt=ae.videoRecv.find((Jn=>Jn.ssrc===N));Ae?(Bt(ue,rn.Video_Recv_Height,Ae.height),Bt(ue,rn.Video_Recv_Width,Ae.width)):F&&(Bt(ue,rn.Video_Recv_Height,F._videoHeight||0),Bt(ue,rn.Video_Recv_Width,F._videoWidth||0)),Ue&&Bt(ue,rn.Video_Recv_Frame_Rate_Output,Ue.frameRate);const rr=(Sn=F._player)===null||Sn===void 0?void 0:Sn.rendFrameRate.toFixed(0);if(rr&&Bt(ue,rn.Video_Render_Frame_Rate_Render,+rr),Bt(ue,rn.Video_Recv_Jitter_Buffer,_e.jitterBufferMs),Bt(ue,rn.Video_Recv_Current_Delay,_e.currentDelayMs),Bt(ue,rn.Video_Recv_Firs,_e.firsCount),Bt(ue,rn.Video_Recv_Nacks,_e.nacksCount),Bt(ue,rn.Video_Recv_Plis,_e.plisCount),F){ue[rn.Video_Recv_Disabled]=F._originMediaStreamTrack.enabled&&F._mediaStreamTrack.enabled?0:1;const Jn=F._player;if(Jn){const{freezeTimeCounterList:co,renderFreezeAccTime:ze,renderFreezeAccTime2:ot,videoElementStatus:bt}=Jn;if(co&&co.length>0&&Bt(ue,eh.Video_Render_Freeze_Time,co.splice(0,1)[0]),ee&&rp.visibility==="visible"&&bt===io.PLAYING&&Bn().supportRequestVideoFrameCallback){const He=Math.min(6e3,ot);Jn.renderFreezeAccTime2=Math.max(0,ot-He),Bt(ue,eh.Video_Render_Freeze_Time_Render2,He);const V=Math.min(6e3,ze);Jn.renderFreezeAccTime=Math.max(0,ze-V),Bt(ue,eh.Video_Render_Freeze_Time_Render,oe("USE_NEW_RENDER_FREEZE_TIME")?He:V)}if(typeof _e.totalFreezesDuration=="number"){const He=Qt&&Qt.totalFreezesDuration?_e.totalFreezesDuration-Qt.totalFreezesDuration:_e.totalFreezesDuration;Bt(ue,rn.Video_Render_Freeze_Duration,1e3*He)}}}if(ue[rn.Video_Recv_Player_Status]=XL[F._player?F._player.videoElementStatus:"uninit"],Qt&&_e.totalInterFrameDelay!==void 0&&_e.totalSquaredInterFrameDelay!==void 0&&Qt.totalInterFrameDelay!==void 0&&Qt.totalSquaredInterFrameDelay!==void 0){const Jn=_e.totalInterFrameDelay-Qt.totalInterFrameDelay,co=_e.totalSquaredInterFrameDelay-Qt.totalSquaredInterFrameDelay,ze=_e.framesDecodeCount-Qt.framesDecodeCount,ot=Jn/ze*1e3,bt=Math.round(1e3*Math.sqrt((co-Math.pow(Jn,2)/ze)/ze));!isNaN(bt)&&ot+bt>Math.max(3*ot,ot+150)&&(ue[rn.Video_Recv_I_Frame_Delay]=bt)}}return ue})(g._videoSSRC,r,g.videoTrack,I===!0,this.needUploadRenderFreezeTime,s,a,c):void 0;A&&(w.video=A)}if(E.has(vt.AUDIO)&&g.audioTrack){const I=g.audioTrack?(function(A,N,G,F,z,ee){const Z=N.audioRecv.find((ue=>ue.ssrc===A));if(!Z)return;const ae={};Bt(ae,Cs.Audio_Recv_Jitter,Z.jitterMs),Bt(ae,Cs.Audio_Recv_Bytes_Retransmit,Z.retransmittedBytesReceived),Bt(ae,Cs.Audio_Recv_Packages_Retransmit,Z.retransmittedPacketsReceived),Bt(ae,Cs.Audio_Recv_Packages_Discarded,Z.packetsDiscarded),Bt(ae,Cs.Audio_Recv_Avg_Processing_Delay,Z.avgProcessingDelayMs);const ye=ee&&ee.audioRecv.find((ue=>ue.ssrc===A));if(ye){const ue=uy;Z.packets!=null&&ye.packets!=null&&Bt(ae,Cs.Audio_Recv_Package_Rate,1e3*(Z.packets-ye.packets)/ue),Z.packetsLost!=null&&ye.packetsLost!=null&&Bt(ae,Cs.Audio_Recv_Package_Lost,Z.packetsLost-ye.packetsLost)}if(F){const{receivedFrames:ue,droppedFrames:Ae}=Z;ue!=null&&Ae!=null&&(ae[eh.Audio_Recv_Freeze]=(_e=ue)===0||100*Ae/_e>20?1:0)}var _e;if(z){const ue=100*G._source.getAccurateVolumeLevel(),Ae=Z.outputLevel;if(Ae!=null){const We=Math.ceil(50*Math.log10(100*Ae+1));Bt(ae,rn.Audio_Render_Level,We)}Bt(ae,rn.Audio_Recv_PCM_Level,ue),G&&(ae[rn.Audio_Recv_Disabled]=G._originMediaStreamTrack.enabled&&G._mediaStreamTrack.enabled?0:1),Bt(ae,rn.Audio_Recv_Jitter_Buffer,Z.jitterBufferMs),Bt(ae,rn.Audio_Recv_Current_Delay,Z.jitterBufferMs),ae[rn.Audio_Recv_Player_Status]=XL[Na.getPlayerState(G.getTrackId())];const Ue=z.audioRecv.find((We=>We.ssrc===A));if(Ue){Ue.bytes!=null&&Z.bytes!=null&&Bt(ae,rn.Audio_Recv_Bitrate,8*(Z.bytes-Ue.bytes)/(uy*ET));const We=Z.concealedSamples-Ue.concealedSamples;We>0&&Bt(ae,rn.Audio_Recv_Concealed_Samples,We);const Ze=Z.totalSamplesReceived-Ue.totalSamplesReceived;Ze>0&&Bt(ae,rn.Audio_Recv_Total_Samples_Received,Ze);const _n=Z.freezeSamples80-Ue.freezeSamples80;_n>0&&Bt(ae,rn.Audio_Render_Freeze_Samples_80ms,_n);const Sn=Z.freezeSamples200-Ue.freezeSamples200;Sn>0&&Bt(ae,rn.Audio_Render_Freeze_Samples_200ms,Sn);const Qt=Z.freezeMs80-Ue.freezeMs80;Bt(ae,rn.Audio_Render_Freeze_Time_80ms,Qt<0?0:Qt);const rr=Z.freezeMs200-Ue.freezeMs200;Bt(ae,rn.Audio_Render_Freeze_Time_200ms,rr<0?0:rr)}}return ae})(g._audioSSRC,r,g.audioTrack,s,a,c):void 0;I&&(w.audio=I)}(w.video||w.audio)&&h.push(w)})),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval((()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find((s=>s instanceof oT));if(r&&r._external.getDenoiserStats){const s=r._external.getDenoiserStats();s&&this.requestUpload(cT.DENOISER_STATS,s)}}),2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval((()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach((r=>{r.getProcessorStats().forEach((s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)}))}))}),2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval((()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach((r=>{let[s,a]=r;a.has(vt.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach((c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})),a.has(vt.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach((c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}))}))}),2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval((async()=>{const s=Date.now(),a={connectionInterval:oe("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s};let c=[];const d=this.requestAllTracks&&this.requestAllTracks()||[];for(const E of d)!E.muted&&E.enabled&&(c=c.concat(await E.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[E,w]of h)w.has(vt.VIDEO)&&E.videoTrack&&(c=c.concat(await E.videoTrack.getProcessorUsage())),w.has(vt.AUDIO)&&E.audioTrack&&(c=c.concat(await E.audioTrack.getProcessorUsage()));if(c.length===0)return;a.details=(function(E,w){const I={};for(const{id:F,value:z,level:ee,direction:Z}of E){var A;const ae=(A=w.get(F))!==null&&A!==void 0?A:0,ye=z===2?ae+oe("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ae;var N,G;w.set(F,ye),I[F]?(z===2&&(I[F].value=z),ee>I[F].level&&(I[F].level=ee),Z==="remote"&&(I[F].remoteUidCount+=1),I[F].totalTs=(N=w.get(F))!==null&&N!==void 0?N:0):I[F]={value:z,level:ee,remoteUidCount:Z==="local"?0:1,totalTs:(G=w.get(F))!==null&&G!==void 0?G:0}}return Object.keys(I).map((F=>{const{level:z,value:ee,totalTs:Z}=I[F];return{id:F,level:z,value:ee,totalTs:Z}}))})(c,r);const m=Date.now(),g=m>s?m:s+1;this.requestUpload&&this.requestUpload(cT.EXTENSION_USAGE_STATS,{usageStats:a,sendTs:g})}),oe("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const i_e=oe("ICE_RESTART_INTERVAL");let aP=new Map,f0=new Map,ig=[oo.UDP_TCP_RELAY,oo.TCP_RELAY,oo.RELAY],q2=oe("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Bn().supportPCSetConfiguration;function Q7(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=aP.get(t.id);s&&(window.clearTimeout(s),aP.delete(t.id));const a=f0.get(t.id);r&&a&&a.index===ig.length-1&&(M.debug("[".concat(t.id,"] reset ICE restart policy")),f0.delete(t.id))}function Z7(t,r,s){if(aP.size===0&&f0.size===0&&(Array.isArray(oe("RESTART_SEQUENCE"))&&oe("RESTART_SEQUENCE").length>0&&!(function(m,g){if(m.length!==g.length)return!1;for(let E=0;E<m.length;E+=1){const w=m[E];if(m.filter((I=>I===w)).length!==g.filter((I=>I===w)).length)return!1}return!0})(ig,oe("RESTART_SEQUENCE"))&&(ig=oe("RESTART_SEQUENCE").filter((m=>{var g;if(rt(g=Object.values(oo)).call(g,m))return!0})),M.debug("use reconnection policy from config distribution, queues: ".concat(ig.join(" => ")))),q2=oe("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Bn().supportPCSetConfiguration),ig.length===0)return void s();let a,{index:c=0,type:d}=f0.get(t.id)||{};if(q2&&d===oo.RELAY)return void s();let h=d&&c>=ig.length-1;if(q2)d=oo.RELAY;else{if(h)return void s();d?(c++,d=ig[c]):(d=ig[0],c=0)}M.debug("[".concat(t.id,"] choose ICE restart policy: ").concat(d,", index: ").concat(c)),r(d),f0.set(t.id,{index:c,type:d}),a=window.setTimeout((()=>Z7(t,r,s)),i_e),aP.set(t.id,a)}var In;function eH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function op(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?eH(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):eH(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}function tH(t){var r,s,a,c=2;for(typeof Symbol<"u"&&(s=lL,a=Symbol.iterator);c--;){if(s&&(r=t[s])!=null)return r.call(t);if(a&&(r=t[a])!=null)return new cP(r.call(t));s="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}function cP(t){function r(s){if(Object(s)!==s)return mt.reject(new TypeError(s+" is not an object."));var a=s.done;return mt.resolve(s.value).then((function(c){return{value:c,done:a}}))}return cP=function(s){this.s=s,this.n=s.next},cP.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var a=this.s.return;return a===void 0?mt.resolve({value:s,done:!0}):r(a.apply(this.s,arguments))},throw:function(s){var a=this.s.return;return a===void 0?mt.reject(s):r(a.apply(this.s,arguments))}},new cP(t)}let vT=(In=class extends Qr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Lt.StateChange,r,this._state)}constructor(t,r){super(),X(this,"isPlanB",void 0),X(this,"store",void 0),X(this,"statsUploader",void 0),X(this,"connection",void 0),X(this,"localTrackMap",new Map),X(this,"remoteUserMap",new Map),X(this,"localDataChannels",[]),X(this,"remoteDataChannelMap",new Map),X(this,"pendingLocalTracks",[]),X(this,"pendingRemoteTracks",[]),X(this,"pendingLocalDataChannels",[]),X(this,"pendingRemoteDataChannels",[]),X(this,"statsCollector",void 0),X(this,"shouldForwardP2PCreation",void 0),X(this,"iceFailedCount",0),X(this,"dtlsFailedCount",0),X(this,"mutex",void 0),X(this,"_state",or.Disconnected),X(this,"_pcStatsUploadType",oe("NEW_ICE_RESTART")?yf.FIRST_CONNECTION:yf.OLD_FIRST_CONNECTION),X(this,"_isStartRestartIce",!1),X(this,"_restartTimer",void 0),X(this,"_isTryConnecting",!1),X(this,"_iceError",null),X(this,"_forceTurn",!1),X(this,"_isWaitPcToRePub",!1),X(this,"handleMuteLocalTrack",(async(s,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==or.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(s);if(h.length===0)return void a();const m=h.find((E=>E[0]==="videoLowTrack"));if(m){const E=m[1];this.store.enableInstantMuteRestore?(E.track._originMediaStreamTrack.enabled=!1,M.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):E.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?M.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(h.map((E=>{let[,{id:w}]=E;return w})));const g=this.createMuteMessage(h);await br(this,Lt.RequestMuteLocal,g),a()}catch(h){c(h)}finally{d()}})),X(this,"handleUnmuteLocalTrack",(async(s,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==or.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();const m=h.find((E=>E[0]==="videoLowTrack"));if(m){const E=m[1];if(this.store.enableInstantMuteRestore)E.track._originMediaStreamTrack.enabled=!0,M.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(E.track._originMediaStreamTrack.stop(),!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bn().supportDualStreamEncoding){const w=s._mediaStreamTrack.clone();E.track._mediaStreamTrack=w,E.track._originMediaStreamTrack=w}else{const w=K2(s,Zw(this,Lt.RequestLowStreamParameter));E.track._mediaStreamTrack=w,E.track._originMediaStreamTrack=w}await new mt(((w,I)=>{this.handleReplaceTrack(E.track,w,I,!0)}))}}this.store.enableInstantMuteRestore?M.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(h.map((E=>{let[,{id:w}]=E;return w})));const g=this.createUnmuteMessage(h);await br(this,Lt.RequestUnmuteLocal,g),a()}catch(h){c(h)}finally{d()}})),X(this,"handleUpdateVideoEncoder",(async(s,a,c,d)=>{let h;d||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(Xe.LocalVideoTrack);if(!this.connection||!g||g.track!==s||this.state!==or.Connected)return void a();const{id:E,track:w}=g;await this.connection.updateSendParameters(E,w),await this.connection.updateEncoderConfig(E,w),this.emit(Lt.UpdateVideoEncoder,w),a()}catch(g){c(g)}finally{var m;(m=h)===null||m===void 0||m()}})),X(this,"handleUpdateVideoSendParameters",(async(s,a,c)=>{const d=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Xe.LocalVideoTrack);if(!this.connection||!h||h.track!==s||this.state!==or.Connected)return void a();const{id:m,track:g}=h;await this.connection.updateSendParameters(m,g),a()}catch(h){c(h)}finally{d()}})),X(this,"handleReplaceMixingTrack",(async(s,a,c,d)=>{if(!this.connection||this.state!==or.Connected)return void a();const h=H2([s]);let m;M.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof d=="boolean"&&d||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,h),a()}catch(E){c(E)}finally{var g;(g=m)===null||g===void 0||g()}})),X(this,"handleReplaceTrack",(async(s,a,c,d)=>{let h;M.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const E=Array.from(this.localTrackMap.entries()).find((w=>{let[,{track:I}]=w;return s===I}));if(!this.connection||!E||this.state!==or.Connected)return void a();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(s,E[1].id)),this.isPlanB){const w=E[1];w.id=s._mediaStreamTrack.id,this.localTrackMap.set(E[0],w)}if(E[0]===Xe.LocalVideoTrack&&!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bn().supportDualStreamEncoding){const w=this.localTrackMap.get(Xe.LocalVideoLowTrack);if(w){const I=s._mediaStreamTrack.clone();w.track._originMediaStreamTrack.stop(),w.track._mediaStreamTrack=I,w.track._originMediaStreamTrack=I,await new mt(((A,N)=>{this.handleReplaceTrack(w.track,A,N,!0)}))}}a()}catch(E){c(E)}finally{var g;(g=h)===null||g===void 0||g()}})),X(this,"handleGetRTCStats",(s=>{s(this.statsCollector.getRTCStats())})),X(this,"handleGetLocalVideoStats",(s=>{s(this.statsCollector.getLocalVideoTrackStats())})),X(this,"handleGetLocalAudioStats",(s=>{s(this.statsCollector.getLocalAudioTrackStats())})),X(this,"handleGetRemoteVideoStats",(s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid])),X(this,"handleGetRemoteAudioStats",(s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid])),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new J7(this.store),this.bindStatsUploaderEvents(),this.mutex=new ro("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Bn().supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&ff(),this.shouldForwardP2PCreation=oe("FORWARD_P2P_CREATION")&&Bn().supportPCSetConfiguration&&wL(),this.shouldForwardP2PCreation&&(this.connection=iP(this.store),this.emit(Lt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(t,r){var s;this.state=or.New,this._forceTurn=$7(t),M.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const a=this.shouldForwardP2PCreation&&((s=this.connection)===null||s===void 0?void 0:s.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||a||r)&&((a||r)&&this.connection&&(M.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=iP(this.store,t),this.emit(Lt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=oe("NEW_ICE_RESTART")?yf.FIRST_CONNECTION:yf.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===or.Connected){if(this.connection instanceof nu&&this.connection.checkDtlsParameters(t.dtlsParameters.fingerprints))return M.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),It.reportApiInvoke(this.store.sessionId,{name:di.MISMATCH_DTLS_PARAMETERS,options:[t.dtlsParameters.fingerprints],tag:Hr.TRACER}).onSuccess(),void setTimeout((()=>{this.emit(Lt.RequestReconnect)}));await this.connection.updateRemoteConnect(t)}else this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=or.Connected}updateRemoteRTPCapabilities(t){const r=Array.from(this.localTrackMap.entries()).filter((c=>{var d;let[h]=c;return rt(d=[Xe.LocalVideoLowTrack,Xe.LocalVideoTrack]).call(d,h)})),s=r.map((c=>{let[,{id:d}]=c;return d})),a=r.map((c=>{let[d]=c;return d}));if(this.connection instanceof nu){if(It.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(a),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!rt(t).call(t,this.store.codec)){const c=["vp9","vp8","h264"].find((d=>rt(t).call(t,d)));c&&(this.store.codec=c,M.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(s,t)}}async getEstablishParams(){var t;if(this.connection instanceof nu&&this.connection.peerConnectionState!=="closed"&&rt(t=[or.New,or.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==or.Connected){if(this.state===or.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach((s=>{var a;rt(a=this.pendingLocalDataChannels).call(a,s)||this.pendingLocalDataChannels.push(s)})),[]}const r=this.filterTobePublishedDataChannels(t);return r.length===0?[]:(r.forEach((s=>{const a=Date.now();this.store.publish(s.id.toString(),"datachannel",a)})),await this.connection.createDataChannels(this.store.uid,r),r.forEach((s=>{this.localDataChannels.push(s);const a=Date.now();this.store.publish(s.id+"","datachannel",void 0,a)})),t.map((s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId}))))}publish(t,r,s){var a=this;return Xl((function*(){const c=yield Fn(a.mutex.lock("From P2PChannel.publish"));try{var d;const h=a.connection&&rt(d=["disconnected","failed"]).call(d,a.connection.peerConnectionState);if(!a.connection||a.state!==or.Connected||h){if(a.state===or.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");a.throwIfTrackTypeNotMatch(t);const g=t.filter((E=>a.pendingLocalTracks.indexOf(E)===-1));return a.pendingLocalTracks=a.pendingLocalTracks.concat(g),void(h&&(a._isWaitPcToRePub=!0))}a.store.pubId=a.store.pubId+1,ao.markPublishStart(a.store.clientId,a.store.pubId);const m=a.filterTobePublishedTracks(t,r,s);if(m.length===0)return void(yield Fn(a.tryToUnmuteAudio(t)));yield*e1(tH(a.doPublish(a.connection,m)))}finally{c()}}))()}doPublish(t,r){var s=this;return Xl((function*(){r.forEach((A=>{let{track:N,type:G}=A;const F=Date.now();s.store.publish(N.getTrackId(),G===Xe.LocalAudioTrack?"audio":"video",F)})),s.bindLocalTrackEvents(r);const a=r.map((A=>{let{track:N}=A;return N})),c=yield Fn(t.send(a,s.store.codec,s.store.audioCodec)),d=(yield Fn(c.next())).value,h=s.createGatewayPublishMessage(r,d);let m;try{m=yield h}catch(A){throw c.throw(A),(A==null?void 0:A.code)===te.WS_ABORT&&r.forEach((N=>{let{track:G}=N;s.pendingLocalTracks.indexOf(G)===-1&&s.pendingLocalTracks.push(G)})),s.unbindLocalTrackEvents(r),A}const g=s.mapPubResToRemoteConfig(h,m,a),E=(yield Fn(c.next(g))).value;if(s.state===or.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");oe("ENABLE_VIDEO_SEI");const w=oe("ENABLE_ENCODED_TRANSFORM"),I=oe("ENABLE_AUDIO_METADATA");a.forEach((async A=>{const N=A.getRTCRtpTransceiver();if(!N||!w)return;const{interceptLocalVideoFrame:G,interceptLocalAudioFrame:F}=Y1();A.trackMediaType===vt.VIDEO?await G(N.sender,A):A.trackMediaType===vt.AUDIO&&await F(N.sender,{metadata:I?()=>{const z=A.metadata.shift();return z&&z.value}:void 0})})),r.forEach((A=>{let{type:N}=A;s.statsCollector.addLocalStats(N)})),s.assignLocalTracks(r,E),s.statsUploader.startUploadOutboundStats(),r.forEach((A=>{let{track:N,type:G}=A;const F=Date.now();s.store.publish(N.getTrackId(),G===Xe.LocalAudioTrack?"audio":"video",void 0,F)}))}))()}async updateVideoStreamParameter(t,r){const s=this.localTrackMap.get(r);if(!s||!this.connection)return;if(!(s.track instanceof kr))return M.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:a}=s,c=(function(d,h){const m={};return d.height&&d.width&&(m.scaleResolutionDownBy=I2(d,h)),m.maxFramerate=d.framerate?kc(d.framerate):void 0,m.maxBitrate=d.bitrate?1e3*d.bitrate:void 0,m})(t,a);if(a._encoderConfig||(a._encoderConfig={}),r!==Xe.LocalVideoLowTrack||!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(a._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const d=a._originMediaStreamTrack;if(!d.canvas)return M.warn("[".concat(a.getTrackId(),"] no canvas on track"));(function(h,m){const g=h.canvas;m.width&&(g.width=kc(m.width)),m.height&&(g.height=kc(m.height)),m.framerate&&(g.stopCapture&&g.stopCapture(),g.stopCapture=QL((()=>{!g.startCapture&&g.stopCapture&&g.stopCapture(),g.startCapture&&g.startCapture()}),kc(m.framerate)))})(d,t)}c.maxBitrate!=null&&(a._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(a._encoderConfig.frameRate&&typeof a._encoderConfig.frameRate=="object"?a._encoderConfig.frameRate.max=c.maxFramerate:a._encoderConfig.frameRate={max:c.maxFramerate}),M.debug("[".concat(a.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(a._encoderConfig))),await this.connection.updateRtpSenderEncodings(a)}publishLowStream(t){var r=this;return Xl((function*(){if(!r.connection||r.state!==or.Connected)return;const s=yield Fn(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get(Xe.LocalVideoTrack);if(!c)throw new Le(te.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(Xe.LocalVideoLowTrack))throw new Le(te.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const d=[{track:r.getLowVideoTrack(c.track,t),type:Xe.LocalVideoLowTrack}];if(yield*e1(tH(r.doPublish(r.connection,d))),c.track.muted||!c.track.enabled){var a;const h=(a=r.localTrackMap.get(Xe.LocalVideoLowTrack))===null||a===void 0?void 0:a.id;h!==void 0&&(yield Fn(r.connection.muteLocal([h])))}}finally{s()}}))()}async republish(){this.pendingLocalTracks.length>0&&(M.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Fs(this,Lt.RequestRePublish,this.pendingLocalTracks),this.emit(Lt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(M.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Fs(this,Lt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(t){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:s,kind:a}=this.pendingRemoteTracks[r];(a!==vt.AUDIO||s._audio_added_&&s._audioSSRC)&&(a!==vt.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(t)await Fs(this,Lt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:s}of this.pendingRemoteTracks)await this.subscribe(r,s,s===vt.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach((r=>{let{user:s}=r;this.emit(Lt.MediaReconnectEnd,s.uid)})),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==or.Connected)return void t.forEach((a=>{const c=this.pendingLocalTracks.indexOf(a);c!==-1&&this.pendingLocalTracks.splice(c,1)}));const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find((a=>a[0]==="videoLowTrack"));return s&&s[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(t){if(!this.connection||this.state!==or.Connected)return void t.forEach((s=>{const a=this.pendingLocalDataChannels.indexOf(s);a!==-1&&this.pendingLocalDataChannels.splice(a,1)}));const r=this.filterTobeUnpublishedDataChannels(t);return r.length!==0?(r.forEach((s=>{const a=this.localDataChannels.indexOf(s);a!==-1&&this.localDataChannels.splice(a,1)})),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map((s=>s.id))):void 0}async unpublishLowStream(){if(!this.connection||this.state!==or.Connected)return;const t=this.localTrackMap.get(Xe.LocalVideoLowTrack);if(!t)return;t.track.close();const r=[[Xe.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,r)}async doUnpublish(t,r){const s=this.createGatewayUnpublishMessage(r);return await t.stopSending(r.map((a=>{let[,{id:c}]=a;return c}))),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map((a=>{let[c,{track:d}]=a;return{type:c,track:d}}))),r.forEach((a=>{let[c]=a;this.statsCollector.removeLocalStats(c)})),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(t,r){if(!this.connection||this.state!==or.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const s=r.filter((a=>{var c;return!((c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.get(a.id))}));if(s.length!==0)return await this.connection.createDataChannels(t.uid,s),s.forEach((a=>{var c;this.remoteDataChannelMap.has(t)?(c=this.remoteDataChannelMap.get(t))===null||c===void 0||c.set(a.id,a):this.remoteDataChannelMap.set(t,new Map([[a.id,a]]));const d=this.pendingRemoteDataChannels.findIndex((h=>{let{user:m,id:g}=h;return m.uid===t.uid&&g===a.id}));d!==-1&&this.pendingRemoteDataChannels.splice(d,1)})),s.map((a=>a.id))}async subscribe(t,r,s,a,c){var d;if(!this.connection||this.state!==or.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((d=this.remoteUserMap.get(t))!==null&&d!==void 0&&d.has(r))return;let h,m,g,E;const w=this.connection.getPreMedia(s);if(w)M.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),g=w.transceiver,h=w.track,m=w.mid,E=w.player,w.firstVideoRender&&this.store.firstVideoFrameDecoded(t.uid,{firstPreRender:w.firstVideoRender});else if(c){const N=c.find((F=>{let{stream_type:z}=F;return z===r}));if(!N)throw new Le(te.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const G=await this.connection.receive(r,N.ssrcs,String(t._uintid),N.attributes);this.connection instanceof nu&&(g=G.transceiver),h=G.track,m=G.id}else{const N=await this.connection.receive(r,[{ssrcId:s,rtx:a}],String(t._uintid),void 0);this.connection instanceof nu&&(g=N.transceiver),h=N.track,m=N.id}if(r===vt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(h):(t._audioTrack=new t0(h,t.uid,t._uintid,this.store),M.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),g&&t._audioTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(h):(t._videoTrack=new e0(h,t.uid,t._uintid,this.store,E),M.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId())),t._videoTrack.once(Zl.PLAY_START,(()=>{this.store.firstVideoFrameDecoded(t.uid,{playStart:Date.now()})})),t._videoTrack.once(Zl.PLAY_END,(()=>{this.store.firstVideoFrameDecoded(t.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(t)})),E?t._videoTrack.once(Zl.FIRST_FRAME_RENDER,(()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)})):t._videoTrack.once(Zl.FIRST_FRAME_DECODED,(()=>{this.store.firstVideoFrameDecoded(t.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(t)}))),g&&t._videoTrack._updateRtpTransceiver(g),this.bindRemoteTrackEvents(t,t._videoTrack)),g&&oe("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:N,interceptRemoteAudioFrame:G}=Y1();r==vt.VIDEO?await N(g.receiver,{onSei:oe("ENABLE_VIDEO_SEI")&&(F=>{var z;return(z=t._videoTrack)===null||z===void 0?void 0:z._onSei(F)})}):r==vt.AUDIO&&await G(g.receiver,{enableTopn:!!oe("ENABLE_AUDIO_TOPN"),enableMetadata:!!oe("ENABLE_AUDIO_METADATA"),enablePts:!!oe("ENABLE_AUDIO_PTS"),onMetadata:F=>{this.safeEmit(Lt.AudioMetadata,F)},onPts:F=>{this.safeEmit(Lt.AudioPts,F)}})}const I=this.remoteUserMap.get(t);I?I.set(r,m):this.remoteUserMap.set(t,new Map([[r,m]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const A=this.pendingRemoteTracks.findIndex((N=>{let{user:G,kind:F}=N;return G.uid===t.uid&&r===F}));A!==-1&&(this.pendingRemoteTracks.splice(A,1),this.emit(Lt.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==or.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter((c=>{var d;let{user:h,mediaType:m}=c;return!((d=this.remoteUserMap.get(h))!==null&&d!==void 0&&d.has(m))}));const r=[],s=new Map;t.forEach((c=>{if(!this.connection)return;const d=this.connection.getPreMedia(c.ssrcId);if(d){const{track:h,mid:m,transceiver:g,player:E}=d;s.set(c.ssrcId,{track:h,id:m,transceiver:g,player:E})}else r.push(c)}));const a=await this.connection.batchReceive(r.map((c=>{let{user:d,mediaType:h,ssrcId:m,rtxSsrcId:g}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:g}],mslabel:String(d._uintid)}})));r.forEach(((c,d)=>{s.set(c.ssrcId,a[d])}));for(const{user:c,mediaType:d,ssrcId:h}of t){const m=s.get(h);if(!m)return void M.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(d,", ").concat(h));const{track:g,id:E,transceiver:w,player:I}=m;if(w&&oe("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:G,interceptRemoteAudioFrame:F}=Y1();d==vt.VIDEO?await G(w.receiver,{onSei:oe("ENABLE_VIDEO_SEI")&&(z=>{var ee;return(ee=c._videoTrack)===null||ee===void 0?void 0:ee._onSei(z)})}):d==vt.AUDIO&&await F(w.receiver,{enableTopn:!!oe("ENABLE_AUDIO_TOPN"),enableMetadata:!!oe("ENABLE_AUDIO_METADATA"),enablePts:!!oe("ENABLE_AUDIO_PTS"),onMetadata:z=>{this.safeEmit(Lt.AudioMetadata,z)},onPts:z=>{this.safeEmit(Lt.AudioPts,z)}})}if(d===vt.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(g):(c._audioTrack=new t0(g,c.uid,c._uintid,this.store),M.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),w&&c._audioTrack._updateRtpTransceiver(w),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(g):(c._videoTrack=new e0(g,c.uid,c._uintid,this.store,I),M.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),w&&c._videoTrack._updateRtpTransceiver(w),this.bindRemoteTrackEvents(c,c._videoTrack)),oe("ENABLE_VIDEO_SEI")&&w){const{interceptRemoteVideoFrame:G,interceptRemoteAudioFrame:F}=Y1();d==vt.VIDEO?await G(w.receiver,{onSei:z=>{var ee;(ee=c._videoTrack)===null||ee===void 0||ee._onSei(z)}}):d==vt.AUDIO&&await F(w.receiver)}const A=this.remoteUserMap.get(c);A?A.set(d,E):this.remoteUserMap.set(c,new Map([[d,E]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const N=this.pendingRemoteTracks.findIndex((G=>{let{user:F,kind:z}=G;return F.uid===c.uid&&d===z}));N!==-1&&(this.pendingRemoteTracks.splice(N,1),this.emit(Lt.MediaReconnectEnd,c.uid))}}async unsubscribe(t,r,s){const a=this.pendingRemoteTracks.filter((h=>{let{user:m,kind:g}=h;return r!==void 0?m.uid===t.uid&&r===g:m.uid===t.uid}));if(a.forEach((h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)})),this.connection&&this.state===or.Connected||s||a.forEach((h=>{let{kind:m}=h;var g;if(m===vt.AUDIO)(g=t._audioTrack)===null||g===void 0||g._destroy(),t._audioTrack=void 0;else if(m===vt.VIDEO){var E;(E=t._videoTrack)===null||E===void 0||E._destroy(),t._videoTrack=void 0}})),!this.connection||this.state!==or.Connected)return;const c=this.filterTobeUnSubscribedTracks(t,r);if(c.length===0)return;await this.connection.stopReceiving(c.map((h=>{let[,{id:m}]=h;return m})));const d=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach((h=>{let[m,{kind:g}]=h;var E,w;if(g===vt.VIDEO&&m._videoSSRC&&((E=this.connection)===null||E===void 0||E.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),g===vt.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),s||((w=m._videoTrack)===null||w===void 0||w._destroy(),m._videoTrack=void 0);else if(g===vt.AUDIO){var I;this.unbindRemoteTrackEvents(m._audioTrack),!s&&((I=m._audioTrack)===null||I===void 0||I._destroy(),m._audioTrack=void 0)}})),d}async unsubscribeDataChannel(t,r){if(r.forEach((c=>{const d=this.pendingRemoteDataChannels.findIndex((h=>h.id===c.id));d!==-1&&this.pendingRemoteDataChannels.splice(d,1)})),!this.connection)return;const s=this.filterTobeUnSubscribedDataChannels(t,r);if(s.length===0)return;r.forEach((c=>{c._close()}));const a=this.remoteDataChannelMap.get(t);return s.forEach((c=>{a&&a.delete(c.id)})),a&&a.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),s.map((c=>c.id))}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let r=[];for(const{user:c,mediaType:d}of t){const h=this.pendingRemoteTracks.filter((m=>{let{user:g,kind:E}=m;return d!==void 0?g.uid===c.uid&&d===E:g.uid===c.uid}));h.forEach((m=>{const g=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(g,1)})),r=r.concat(h)}if(!this.connection||this.state!==or.Connected)return void r.forEach((c=>{let{user:d,kind:h}=c;var m;if(h===vt.AUDIO)(m=d._audioTrack)===null||m===void 0||m._destroy(),d._audioTrack=void 0;else if(h===vt.VIDEO){var g;(g=d._videoTrack)===null||g===void 0||g._destroy(),d._videoTrack=void 0}}));const s=Ya(t).call(t,((c,d)=>{let{user:h,mediaType:m}=d;const g=this.filterTobeUnSubscribedTracks(h,m);return c.concat(g)}),[]);if(s.length===0)return;await this.connection.stopReceiving(s.map((c=>{let[,{id:d}]=c;return d})));const a=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach((c=>{let[d,{kind:h}]=c;var m,g;if(h===vt.VIDEO&&d._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),h===vt.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),(g=d._videoTrack)===null||g===void 0||g._destroy(),d._videoTrack=void 0;else if(h===vt.AUDIO){var E;this.unbindRemoteTrackEvents(d._audioTrack),(E=d._audioTrack)===null||E===void 0||E._destroy(),d._audioTrack=void 0}})),a}isPreSubScribe(t){return!this.connection||this.state!==or.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void M.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void M.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const a=r===vt.VIDEO?t._videoSSRC:t._audioSSRC;a!==void 0&&this.connection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.connection)return;const s=this.remoteUserMap.get(t);if(!s)return void M.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||M.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}addAudioMetadata(t){const r=this.localTrackMap.get(Xe.LocalAudioTrack),s=r&&r.track;s&&s.metadata.push(t)}getAllTracks(t){const r=this.localTrackMap.get(Xe.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Fi){const s=r.track;return Array.from(this.localTrackMap.entries()).filter((a=>{let[c]=a;return c!==Xe.LocalAudioTrack})).filter((a=>{let[c]=a;return!(t&&c===Xe.LocalVideoLowTrack)})).map((a=>{let[,{track:c}]=a;return c})).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter((s=>{let[a]=s;return!(t&&a===Xe.LocalVideoLowTrack)})).map((s=>{let[,{track:a}]=s;return a}))}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,r,s,a,c){if(t){const h=this.localTrackMap.get(Xe.LocalAudioTrack),m=a?this.localTrackMap.get(Xe.LocalVideoLowTrack):this.localTrackMap.get(Xe.LocalVideoTrack);It.publish(this.store.sessionId,{eventElapse:ao.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(Sr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;s||(s=[]);const h=s.find((g=>g instanceof ci)),m=a?(d=this.localTrackMap.get(Xe.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find((g=>g instanceof kr));It.publish(this.store.sessionId,{eventElapse:ao.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(Sr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,a){const c=a===vt.VIDEO?s._videoSSRC:s._audioSSRC;c&&It.subscribe(this.store.sessionId,{succ:t,ec:r,video:a===vt.VIDEO,audio:a===vt.AUDIO,peerid:s.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:ao.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){M.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new ro("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=iP(this.store),this.emit(Lt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Xe.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Fi){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach((s=>{r.removeAudioTrack(s)}))}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=or.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Xe.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Xe.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof kr||r&&r.track instanceof ci?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(nc(r=this.remoteUserMap).call(r)).find((a=>a.uid===t));return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map((s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}}));const r=this.localTrackMap.get(Xe.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=z_(t).call(t,((s,a)=>s.level-a.level)),t}async disconnectForReconnect(){this.connection&&(M.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=or.Reconnecting,oe("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())})),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=iP(this.store),this.emit(Lt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach((t=>{var r;let[s,{track:a}]=t;switch(s){case Xe.LocalVideoTrack:rt(r=a._hints).call(r,Sr.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Xe.LocalAudioTrack:a instanceof Fi?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Xe.LocalVideoLowTrack:}})),this.emit(Lt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((t=>{let[r,s]=t;Array.from(nc(s).call(s)).forEach((a=>{this.setPendingRemoteMedia(r,a)})),this.emit(Lt.MediaReconnectStart,r.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach((t=>{this.pendingLocalDataChannels.push(t)})),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach((t=>{let[r,s]=t;Array.from(nc(s).call(s)).forEach((a=>{this.setPendingRemoteDataChannel(r,a)}))})),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),M.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,r){for(const s of this.pendingRemoteDataChannels){const{user:a,id:c}=s;if((t instanceof rg?t.uid:t)===a.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(t,r){this.hasPendingRemoteDataChannel(t,r)||this.pendingRemoteDataChannels.push({user:t,id:r})}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:a,kind:c}=s;if((t instanceof rg?t.uid:t)===a.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}restartICE(t){var r=this;return Xl((function*(){if(!r.connection||r.state!==or.Connected)return;const s=yield Fn(r.mutex.lock("From P2PChannel.restartICE"));let a;try{a=yield Fn(r.connection.restartICE(t));const d=yield Fn(a.next());if(d.done)return;const h=d.value,m=yield h;switch($2(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),t){case oo.UDP_TCP_RELAY:r._pcStatsUploadType=yf.UDP_TCP_RESTART;break;case oo.TCP_RELAY:r._pcStatsUploadType=yf.TCP_RESTART;break;case oo.RELAY:r._pcStatsUploadType=yf.RELAY_RESTART;break;default:r._pcStatsUploadType=yf.OLD_RESTART}r._isTryConnecting=!0,a.next(m)}catch(d){var c;(c=a)===null||c===void 0||c.throw(d)}finally{s()}}))()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),r=this.localTrackMap.get(Xe.LocalVideoTrack),s=this.localTrackMap.get(Xe.LocalAudioTrack),a=t.videoSend.find((N=>N.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId))),c=t.audioSend.find((N=>N.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId)));if(!a||!c)return 1;const d=il(this,Lt.NeedSignalRTT),h=a?a.rttMs:void 0,m=c?c.rttMs:void 0,g=h&&m?(h+m)/2:h||m,E=(g&&d?(g+d)/2:g||d)||0,w=100*t.sendPacketLossRate*.7/50+.3*E/1500,I=w<.17?1:w<.36?2:w<.59?3:w<.1?4:5,A=r==null?void 0:r.track;if(A&&A._encoderConfig&&A._hints.indexOf(Sr.SCREEN_TRACK)===-1){const N=A._encoderConfig.bitrateMax,G=t.bitrate.actualEncoded;if(N&&G){const F=(1e3*N-G)/(1e3*N);return BG[F<.15?0:F<.3?1:F<.45?2:F<.6?3:4][I]}}return I}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach((s=>{let[a]=s;const c=a._audioSSRC,d=a._videoSSRC,h=t.audioRecv.find((G=>G.ssrc===c)),m=t.videoRecv.find((G=>G.ssrc===d));if(!h&&!m)return void(r+=1);const g=il(this,Lt.NeedSignalRTT),E=t.rtt,w=(E&&g?(E+g)/2:E||g)||0,I=h?h.jitterMs:void 0,A=t.recvPacketLossRate;let N=.7*A*100/50+.3*w/1500;I&&(N=.6*A*100/50+.2*w/1500+.2*I/400),r+=N<.1?1:N<.17?2:N<.36?3:N<.59?4:5})),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new mt(((r,s)=>{this.handleMuteLocalTrack(t,r,s)}))}async replaceTrack(t,r){var s;if(M.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==or.Connected)return;const a=Array.from(this.localTrackMap.entries()).find((d=>{let[,{track:h}]=d;return t===h}));if(!a)return;const c=a[0];if(t!==r&&(this.unbindLocalTrackEvents([{track:t,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),a[1].track=r),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(r,a[1].id)),this.isPlanB){const d=a[1];d.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,d)}if(c===Xe.LocalVideoTrack&&!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bn().supportDualStreamEncoding){const d=this.localTrackMap.get(Xe.LocalVideoLowTrack);if(d){const h=t._mediaStreamTrack.clone();d.track._originMediaStreamTrack.stop(),d.track._mediaStreamTrack=h,d.track._originMediaStreamTrack=h,await new mt(((m,g)=>{this.handleReplaceTrack(d.track,m,g,!0)}))}}}filterTobePublishedTracks(t,r,s){const a=[],c=this.getAllTracks();t=Bv(t=t.filter((g=>c.indexOf(g)===-1)));let d,h=!1;const m=this.localTrackMap.get(Xe.LocalAudioTrack);for(const g of t){if(g instanceof kr&&(this.localTrackMap.has(Xe.LocalVideoTrack)||h?new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:g,type:Xe.LocalVideoTrack}),h=!0),r)){const E=this.getLowVideoTrack(g,s);a.push({track:E,type:Xe.LocalVideoLowTrack})}if(g instanceof ci)if(m){const E=m.track;if(E instanceof Fi)G2([g]),E.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0);else{const w=H2([E,g]);M.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(w.getTrackId(),"]")),this.replaceTrack(E,w)}}else d instanceof Fi?(G2([g]),d.addAudioTrack(g)):d||!g._useAudioElement&&Bn().webAudioMediaStreamDest&&!g._bypassWebAudio?d=H2(d?[g,d]:[g]):d=g}return d&&(M.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(d.getTrackId(),"]")),a.push({track:d,type:Xe.LocalAudioTrack})),a}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=Bv(t=t.filter((a=>s.indexOf(a)!==-1)));for(const a of t){if(a instanceof ci){const c=this.localTrackMap.get(Xe.LocalAudioTrack);if(!c)continue;c.track instanceof Fi?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(r.push([Xe.LocalAudioTrack,c]),c.track.close())):r.push([Xe.LocalAudioTrack,c])}if(a instanceof kr){const c=this.localTrackMap.get(Xe.LocalVideoTrack);if(!c)continue;r.push([Xe.LocalVideoTrack,c]);const d=this.localTrackMap.get(Xe.LocalVideoLowTrack);d&&r.push([Xe.LocalVideoLowTrack,d])}}return r}filterTobePublishedDataChannels(t){return t=(t=Bv(t)).filter((r=>this.localDataChannels.findIndex((s=>s.id===r.id))===-1))}filterTobeUnpublishedDataChannels(t){return t=(t=(t=Bv(t)).filter((r=>this.localDataChannels.indexOf(r)!==-1))).filter((r=>r._originDataChannel))}bindLocalTrackEvents(t){t.forEach((r=>{let{track:s,type:a}=r;switch(a){case Xe.LocalVideoTrack:s.addListener(wt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(wt.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(wt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(wt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(wt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Xe.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Xe.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(t,r){t instanceof Fi?t.trackList.forEach((s=>{s.addListener(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(wt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(t.addListener(wt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(t.addListener(wt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(wt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map((r=>{let[s,{track:a}]=r;return{track:a,type:s}}))),t.forEach((r=>{let{track:s,type:a}=r;switch(a){case Xe.LocalVideoTrack:s.off(wt.GET_STATS,this.handleGetLocalVideoStats),s.off(wt.GET_RTC_STATS,this.handleGetRTCStats),s.off(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(wt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(wt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(wt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Xe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Xe.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(t){t instanceof Fi?t.trackList.forEach((r=>{r.off(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(wt.GET_STATS,this.handleGetLocalAudioStats),r.off(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(t.off(wt.GET_STATS,this.handleGetLocalAudioStats),t.off(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(wt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(wt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof e0&&r.addListener(wt.GET_STATS,(s=>{s(this.handleGetRemoteVideoStats(t))})),r instanceof t0&&r.addListener(wt.GET_STATS,(s=>{s(this.handleGetRemoteAudioStats(t))}))}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(wt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((t=>{let[r,s]=t;s.has(vt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(vt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)}))}createGatewayPublishMessage(t,r){return t.map(((s,a)=>{var c;let d,h,{track:m,type:g}=s;switch(g){case Xe.LocalAudioTrack:d=cr.Audio,h={dtx:m instanceof oT&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Xe.LocalVideoTrack:d=rt(c=m._hints).call(c,Sr.SCREEN_TRACK)?cr.Screen:cr.High,h=op(op({},r7(m)),{},{codec:this.store.codec,svc_mode:G1()});break;case Xe.LocalVideoLowTrack:d=cr.Low,h=op(op({},r7(m)),{},{codec:this.store.codec,svc_mode:G1()})}return{stream_type:d,attributes:h,ssrcs:r[a]}}))}createGatewayUnpublishMessage(t){return t.map((r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalVideoTrack:a=rt(s=d._hints).call(s,Sr.SCREEN_TRACK)?cr.Screen:cr.High;break;case Xe.LocalAudioTrack:a=cr.Audio;break;case Xe.LocalVideoLowTrack:a=cr.Low}return{stream_type:a,ssrcs:h,mid:m}}))}assignLocalTracks(t,r){t.forEach(((s,a)=>{let{track:c,type:d}=s;this.localTrackMap.set(d,{track:c,id:r[a].id,ssrcs:r[a].localSSRC})}))}withdrawLocalTracks(t){t.forEach((r=>{let[s]=r;this.localTrackMap.delete(s)}))}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{if(M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(Lt.PeerConnectionStateChange,r),r==="connecting"&&t instanceof nu&&!ni()&&oe("FIRST_TCP_CANDIDATE")&&window.setTimeout((()=>{r==="connecting"&&t.extendCandidate()}),oe("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),t instanceof nu&&Q7(t,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=yf.DISCONNECTED_OR_FAILED,il(this,Lt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const s=this.pendingLocalTracks.map((c=>c.getTrackId())),a=this.pendingLocalDataChannels.map((c=>"dc_".concat(c.id)));It.reportApiInvoke(this.store.sessionId,{name:di.REPUB_AFTER_PC_CONNECTED,options:s.concat(a),tag:Hr.TRACER}).onSuccess(),this.republish()}if(oe("NEW_ICE_RESTART")&&t instanceof nu&&!ni()&&!this._forceTurn){if(rt(JG).call(JG,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=c=>{$2(t)&&(M.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),il(this,Lt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Lt.RequestRestartICE,c))},a=()=>{$2(t)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),M.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout((()=>this.emit(Lt.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout((()=>{Z7(t,s,a)}),800))}}else{if(r==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout((()=>{t.iceConnectionState==="disconnected"&&oe("ICE_RESTART")&&il(this,Lt.QueryClientConnectionState)==="CONNECTED"&&this.emit(Lt.RequestRestartICE)}),800),void setTimeout((()=>{t.peerConnectionState==="disconnected"&&(M.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout((()=>this.emit(Lt.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())}),4e3);r==="failed"&&(M.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout((()=>this.emit(Lt.P2PLost)),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),It.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Hr.TRACER}).onSuccess(),this.emit(Lt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const a=Array.from(nc(s=this.remoteUserMap).call(s)).find((d=>d._audioSSRC===r));var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(Zl.FIRST_FRAME_DECODED),It.firstRemoteFrame(this.store.sessionId,Xi.FIRST_AUDIO_DECODE,jr.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:ao.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const a=Array.from(nc(s=this.remoteUserMap).call(s)).find((c=>c._audioSSRC===r));a&&It.firstRemoteFrame(this.store.sessionId,Xi.FIRST_AUDIO_RECEIVED,jr.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:ao.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,a)=>{var c;const d=Array.from(nc(c=this.remoteUserMap).call(c)).find((h=>h._videoSSRC===r));d&&this.store.firstVideoFrameDecoded(d.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(r,s,a)},t.onFirstVideoRender=r=>{var s;const a=Array.from(nc(s=this.remoteUserMap).call(s)).find((c=>c._videoSSRC===r));a&&(this.store.firstVideoFrameDecoded(a.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(a))},t.onFirstVideoReceived=r=>{var s;const a=Array.from(nc(s=this.remoteUserMap).call(s)).find((c=>c._videoSSRC===r));a&&(this.store.firstVideoFrameDecoded(a.uid,{firstReceived:Date.now()}),It.firstRemoteFrame(this.store.sessionId,Xi.FIRST_VIDEO_RECEIVED,jr.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:ao.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onSelectedLocalCandidateChanged=(r,s)=>{const a=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&a===c||this.emit(Lt.ConnectionTypeChange,a),M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Qm(s))," -> ").concat(JSON.stringify(Qm(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Qm(s))," -> ").concat(JSON.stringify(Qm(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return op(op({},r),s)},t.onICECandidateError=r=>{this._iceError=r}}resetConnection(t){t instanceof nu&&(function(r){f0.delete(r.id),Q7(r)})(t),t.close(),this.emit(Lt.PeerConnectionStateChange,"closed"),(function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0})(t),this._isWaitPcToRePub=!1}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(Xe.LocalAudioTrack);if(t instanceof ci&&(s==null?void 0:s.track)instanceof Fi)return s.track.isActive||r.push([Xe.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find((c=>{let[,{track:d}]=c;return t===d}));if(a&&(r.push(a),a[0]===Xe.LocalVideoTrack)){const c=this.localTrackMap.get(Xe.LocalVideoLowTrack);c&&r.push([Xe.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(Xe.LocalAudioTrack);if(t instanceof ci&&(s==null?void 0:s.track)instanceof Fi)return s.track.isActive&&r.push([Xe.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find((c=>{let[,{track:d}]=c;return t===d}));if(a)if(a[0]===Xe.LocalVideoTrack){r.push(a);const c=this.localTrackMap.get(Xe.LocalVideoLowTrack);c&&r.push([Xe.LocalVideoLowTrack,c])}else r.push(a);return r}createMuteMessage(t){return t.map((r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalAudioTrack:a=cr.Audio;break;case Xe.LocalVideoTrack:a=rt(s=d._hints).call(s,Sr.SCREEN_TRACK)?cr.Screen:cr.High;break;case Xe.LocalVideoLowTrack:a=cr.Low}return{stream_type:a,ssrcs:h,mid:m}}))}createUnmuteMessage(t){return t.map((r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalAudioTrack:a=cr.Audio;break;case Xe.LocalVideoTrack:a=rt(s=d._hints).call(s,Sr.SCREEN_TRACK)?cr.Screen:cr.High;break;case Xe.LocalVideoLowTrack:a=cr.Low}return{stream_type:a,ssrcs:h,mid:m}}))}filterTobeUnSubscribedTracks(t,r){const s=[],a=this.remoteUserMap.get(t);if(!a)return s;if(r){const c=a.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(a.entries()).forEach((c=>{let[d,h]=c;s.push([t,{kind:d,id:h}])}));return s}filterTobeUnSubscribedDataChannels(t,r){const s=[];return r.forEach((a=>{var c;(c=this.remoteDataChannelMap.get(t))!==null&&c!==void 0&&c.has(a.id)&&s.push(a)})),s}createUnsubscribeMessage(t){const r=[];return t.forEach((s=>{let[a,{kind:c,id:d}]=s;switch(c){case vt.VIDEO:return void(a._videoSSRC&&r.push({stream_type:vt.VIDEO,ssrcId:a._videoSSRC}));case vt.AUDIO:return void(a._audioSSRC&&r.push({stream_type:vt.AUDIO,ssrcId:a._audioSSRC}))}})),r}createUnsubscribeAllMessage(t){const r=new Map;return t.forEach((s=>{let[a,{kind:c}]=s;if(r.has(a)){let d=r.get(a);c===vt.VIDEO?d|=is.Video:d|=is.Audio,r.set(a,d)}else c===vt.VIDEO?r.set(a,is.Video):r.set(a,is.Audio)})),{users:Array.from(r.entries()).map((s=>{let[a,c]=s;return{stream_id:a.uid,stream_type:c}}))}}withdrawRemoteTracks(t){t.forEach((r=>{let[s,{kind:a}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))}))}async updateBitrateLimit(t){const r=this.localTrackMap.get(Xe.LocalVideoTrack),s=this.localTrackMap.get(Xe.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new mt(((a,c)=>{this.handleUpdateVideoEncoder(r.track,a,c,!0)}))),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new mt(((a,c)=>{this.handleUpdateVideoEncoder(s.track,a,c,!0)})))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof nu&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof nu&&this.connection.isPreSub()}mapPubResToRemoteConfig(t,r,s){return t.map(((a,c)=>{var d;let{stream_type:h}=a;const m=(d=r.find((g=>{let{stream_type:E}=g;return h===E})))===null||d===void 0?void 0:d.attributes;if(m&&oe("DISABLE_SCREEN_SHARE_REMB")){const g=s[c]._hints;(rt(g).call(g,Sr.SCREEN_TRACK)||rt(g).call(g,Sr.SCREEN_LOW_TRACK))&&(m.remb=!1,M.debug("disable remb for screen share, hints:",g))}return m}))}async tryToUnmuteAudio(t){for(let s=0;s<t.length;s++)if(t[s]instanceof ci){var r;const a=this.filterTobeUnmutedTracks(t[s]);if(a.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(a.map((d=>{let[,{id:h}]=d;return h}))));const c=this.createUnmuteMessage(a);return void await br(this,Lt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Lt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Lt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var t;return{connectState:((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await bs(kL(this.dtlsFailedCount,Ni)),this.emit(Lt.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),r.length>0&&await Fs(this,Lt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(Lt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Xe.LocalVideoTrack)||this.pendingLocalTracks.some((t=>t instanceof kr))}throwIfTrackTypeNotMatch(t){if(t.filter((r=>r instanceof kr)).length>1)throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter((r=>r instanceof ci)).length>1&&(t.some((r=>r instanceof ci&&r._bypassWebAudio))||!Bn().webAudioMediaStreamDest))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof kr&&this.pendingLocalTracks.some((s=>s instanceof kr)))throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof ci&&this.pendingLocalTracks.some((s=>s instanceof ci))&&(!Bn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some((s=>s instanceof ci&&s._bypassWebAudio))))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){var s;const a=!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bn().supportDualStreamEncoding,c=op(op({},{width:160,height:120,framerate:15,bitrate:50}),r);let d;d=a?t._mediaStreamTrack.clone():K2(t,c);const h=wr(8,"track-low-"),m=new kr(d,op(op({},a&&{scaleResolutionDownBy:I2(c,t)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(ty.TRANSCEIVER_UPDATED,(g=>{t._updateRtpTransceiver(g,qv.LOW_STREAM)})),m._hints.push(Sr.LOW_STREAM),rt(s=t._hints).call(s,Sr.SCREEN_TRACK)&&m._hints.push(Sr.SCREEN_LOW_TRACK),t.on("sei-to-send",(g=>{m.emit("sei-to-send",g)})),t.addListener(wt.NEED_CLOSE,(()=>{m.close()})),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,r,s){let a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof nu){var c,d,h,m;const g=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:E,dtlsTransportState:w,peerConnectionState:I}=this.connection,{local:A,remote:N}=await this.connection.getSelectedCandidatePair();It.pcStats(this.store.sessionId,{startTime:g,eventElapse:t-g||0,iceconnectionsate:E,dtlsstate:w,connectionstate:I,intSucc:r?1:2,error:this._iceError||a||"",selectedLocalCandidateProtocol:(c=A==null?void 0:A.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(d=A.candidateType)!==null&&d!==void 0?d:"",selectedLocalCandidateAddress:"".concat(A.address,":").concat(A.port),selectedRemoteCandidateProtocol:(h=N.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=N.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(N.address,":").concat(N.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(t){const r=this.store.keyMetrics,s=r.firstVideoFrameDecoded.find((w=>w.userId===t.uid));if(!s)return;const{isInternalUpload:a,isExternalUpload:c}=s;if(a&&c)return;const{subscribeEnd:d,firstPreRender:h,peerPublishDuration:m,peerPubStatusMs:g}=s;let{firstRender:E=0}=s;if(d&&(E||h)&&m&&g){s.isInternalUpload=!0;const{playEnd:w}=s;w&&(s.isExternalUpload=!0);const{firstPreRender:I=0}=s;E=I||E;const A=t.videoTrack,N={peer:t._uintid,width:(A==null?void 0:A._videoWidth)||0,height:(A==null?void 0:A._videoHeight)||0,ssrc:t._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:m,peerPubStatusMs:g,joinChannelStart:r.joinStart||0,preloadStart:r.preloadStart||0,preloadEnd:r.preloadEnd||0,apStart:r.requestAPStart||0,apEnd:r.requestAPEnd||0,suaEnd:r.requestSUAEnd||0,beforeConnect:r.beforeConnect||0,peerReceiver:r.peerReceiver||0,ice:r.iceConnectionEnd||0,pc:r.peerConnectionEnd||0,signalConnected:r.signalConnected||0,joinReq:r.joinReq||0,joinRes:r.joinRep||0,userJoinNotify:s.userJoinNotify||0,videoAddNotify:s.videoAddNotify||0,subscribeStart:s.subscribeStart||0,subscribeEnd:s.subscribeEnd||0,firstReceived:s.firstReceived||0,firstDecoded:s.firstDecoded||0,firstPreRender:I||0,firstRender:w?Math.max(E,w):Math.max(E,d),playStart:s.playStart||0,playEnd:s.playEnd||0,isPreSub:!(!t._videoSSRC||!this.isPreSubScribe(t._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:I9(this.store)};It.firstXLAPeerFirstVideoFrame(this.store.sessionId,N)}}reportVideoFirstFrameDecoded(t,r,s,a){var c;const d=Array.from(nc(c=this.remoteUserMap).call(c)).find((h=>h._videoSSRC===t));if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find((g=>g.userId===d.uid&&g.type==="video"));It.firstRemoteVideoDecode(this.store.sessionId,Xi.FIRST_VIDEO_DECODE,jr.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:s,subscribeElapse:ao.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:a?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.connection)return!1;const a=this.remoteUserMap.get(t);if(!a)return!1;const c=a.get(r);if(!c)return!1;const d=await this.connection.getRemoteSSRC(c);return d!==void 0&&d!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach((t=>{let[r,{track:s}]=t;r===Xe.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,qv.LOW_STREAM):s._updateRtpTransceiver(void 0)}))}},Rt(In.prototype,"startP2PConnection",[Bo],Object.getOwnPropertyDescriptor(In.prototype,"startP2PConnection"),In.prototype),Rt(In.prototype,"connect",[Bo],Object.getOwnPropertyDescriptor(In.prototype,"connect"),In.prototype),Rt(In.prototype,"updateRemoteRTPCapabilities",[Bo],Object.getOwnPropertyDescriptor(In.prototype,"updateRemoteRTPCapabilities"),In.prototype),Rt(In.prototype,"publishDataChannel",[Bo],Object.getOwnPropertyDescriptor(In.prototype,"publishDataChannel"),In.prototype),Rt(In.prototype,"unpublish",[Bo],Object.getOwnPropertyDescriptor(In.prototype,"unpublish"),In.prototype),Rt(In.prototype,"unpublishDataChannel",[Bo],Object.getOwnPropertyDescriptor(In.prototype,"unpublishDataChannel"),In.prototype),Rt(In.prototype,"unpublishLowStream",[Bo],Object.getOwnPropertyDescriptor(In.prototype,"unpublishLowStream"),In.prototype),Rt(In.prototype,"subscribeDataChannel",[Bo],Object.getOwnPropertyDescriptor(In.prototype,"subscribeDataChannel"),In.prototype),Rt(In.prototype,"subscribe",[Bo],Object.getOwnPropertyDescriptor(In.prototype,"subscribe"),In.prototype),Rt(In.prototype,"massSubscribe",[Bo],Object.getOwnPropertyDescriptor(In.prototype,"massSubscribe"),In.prototype),Rt(In.prototype,"unsubscribe",[Bo],Object.getOwnPropertyDescriptor(In.prototype,"unsubscribe"),In.prototype),Rt(In.prototype,"unsubscribeDataChannel",[Bo],Object.getOwnPropertyDescriptor(In.prototype,"unsubscribeDataChannel"),In.prototype),Rt(In.prototype,"massUnsubscribe",[Bo],Object.getOwnPropertyDescriptor(In.prototype,"massUnsubscribe"),In.prototype),Rt(In.prototype,"muteRemote",[Bo],Object.getOwnPropertyDescriptor(In.prototype,"muteRemote"),In.prototype),Rt(In.prototype,"unmuteRemote",[Bo],Object.getOwnPropertyDescriptor(In.prototype,"unmuteRemote"),In.prototype),Rt(In.prototype,"hasRemoteMediaWithLock",[Bo],Object.getOwnPropertyDescriptor(In.prototype,"hasRemoteMediaWithLock"),In.prototype),Rt(In.prototype,"disconnectForReconnect",[Bo],Object.getOwnPropertyDescriptor(In.prototype,"disconnectForReconnect"),In.prototype),Rt(In.prototype,"updateBitrateLimit",[Bo],Object.getOwnPropertyDescriptor(In.prototype,"updateBitrateLimit"),In.prototype),Rt(In.prototype,"remoteMediaSsrcChanged",[Bo],Object.getOwnPropertyDescriptor(In.prototype,"remoteMediaSsrcChanged"),In.prototype),In);function Bo(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}function nH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function rH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?nH(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):nH(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}const s_e=Date.now(),o_e=20,Y2=new Map,lP=new Map;async function iH(t){const r=Y2.get(t),s=Array.isArray(r)&&r[r.length-1],a=lP.get(t);if(!s)return void(a.isSyncing=!1);const c={uid:s.uid,payload:s.payload};a.firstRecvTs===0&&(a.firstRecvTs=s.recvTs,a.firstSendTs=s.sendTs);const d=s.sendTs-a.firstSendTs,h=d-(Date.now()-a.firstRecvTs);h>0&&(a.firstRecvTs=Date.now()-d);let m=s.mediaDelay+h;m<=0?(r.pop(),sH(s.context,c),m=0):m=Math.min(m,o_e),setTimeout((()=>r.length&&iH(t)),m)}function sH(t,r){t.safeEmit(An.STREAM_MESSAGE,r.uid,r.payload),t.onStreamMessage&&t.onStreamMessage(r)}function a_e(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return sH(s,{uid:t.uid,payload:t.payload});const a="".concat(s.id,"-").concat(t.uid),c=Y2.get(a)||[],d=c.findIndex((E=>t.sendTs>=E.sendTs)),h=rH(rH({},t),{},{context:s,mediaDelay:r,recvTs:Date.now()});d===-1?c.push(h):c.splice(d,0,h),Y2.set(a,c);let m=!1;var g;lP.has(a)?m=!((g=lP.get(a))===null||g===void 0||!g.isSyncing):lP.set(a,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||iH(a)}const c_e=Ln().name;function oH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function aH(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?oH(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):oH(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}const m0="websdk_ng_cache_parameter",l_e=oe("MAX_PRELOAD_ASYNC_LENGTH"),u_e=1e4,dy=new Map,hy=[];let X2=null,J2=0,Q2=0;const uP=new Map,d_e=(function(t,r){const s=[];let a=0;const c=async()=>{const d=s.shift();d&&await d(),s.length>0&&a<r?c():a--};return async function(){for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];return new mt((async(g,E)=>{s.push((async()=>{try{const w=await t(...h);g(w)}catch(w){E(w)}})),a<r&&(a++,c())}))}})(cH,l_e),Z2=ka.CancelToken.source();async function cH(t,r,s,a,c,d){try{if(!oe("ENABLE_PRELOAD"))return;if(!Bn().supportWebCrypto)return void Hm((()=>{M.warn("Your browser does not support preloading, this feature  be run in a secure environment")}),"preload_webcrypto_not_supported");if(!s&&s!==null)throw new Le(te.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&Ss(s,"token",1,2047),Ss(t,"appid",1,2047),V1(r),a&&j1(a);const h=Z_();M.debug("preload channel ".concat(r,", uid is ").concat(a));const m={appId:t,cname:r,token:s||t,uid:typeof a!="string"?a:null,sid:h,proxyServer:c};let g,E;typeof a=="string"?(m.stringUid=a,[E,g]=await mt.all([qge(a,{sid:h,appId:t},Z2.token),D7(aH(aH({},m),{},{token:s||t,uid:0}),Z2.token)]),m.uid=E.uid,g.gatewayInfo.uid=m.uid,g.gatewayInfo.res.uid=m.uid):(d&&(m.stringUid=d),g=await D7(m,Z2.token));const w={sid:h,appId:t,cname:r,token:s||t,uid:m.stringUid||a,intUid:m.uid||g.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:E,ap:g};await(async function(I){let A;try{I.uid&&uH({appId:I.appId,cname:I.cname,token:I.token,uid:I.uid,stringUid:I.stringUid});const N=fH(I),G=await(async function(z,ee){try{const Z=await window.crypto.subtle.importKey("raw",e9(ee),"AES-GCM",!1,["encrypt"]),ae=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},Z,Q_(window.btoa(JSON.stringify(z))));return $m(new Uint8Array(ae))}catch{return}})(I,I.token||I.appId);if(!G)return;A=pH(m0);const F=A?JSON.parse(A):[];F.push({[N]:G}),F.length>oe("AP_CACHE_NUM")&&F.shift(),dP(m0,JSON.stringify(F))}catch(N){M.warn("Error caching server parameters:",N.message),dP(m0,"")}})(w),J2++}catch(h){throw Q2++,(function(m){X2||(X2=window.setTimeout((()=>{let E="";uP.forEach(((w,I)=>{E+="".concat(I,": ").concat(w," ;")})),It.reportApiInvoke(null,{name:di.PRELOAD,options:{success:J2,failed:Q2,err:E}}).onError(m),J2=0,Q2=0,uP.clear(),X2=null}),u_e));const g=uP.get(m.code)||0;uP.set(m.code,g+1)})(h),h}}async function lH(t){try{if(oe("AP_REQUEST_DETAIL")||oe("ENABLE_ROLE_SELECT_EDGE"))return;const r=uH(t);if(!r||t.cloudProxyServer!=="disabled")return;const s=await(async function(a,c){try{const d=await window.crypto.subtle.importKey("raw",e9(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},d,Q_(a));return JSON.parse(window.atob($m(new Uint8Array(h))))}catch{return}})(r,t.token||t.appId);if(!s||!(function(a,c){return a.cname===c.cname&&a.appId===c.appId&&a.token===c.token?c.stringUid?a.stringUid===c.stringUid:typeof c.uid=="number"?a.uid===c.uid:a.uid==c.uid:!1})(s,t))return;if(s&&Date.now()-s.ts<oe("AP_CACHE_LIFETIME"))return s}catch(r){M.warn("Error get preloadInfo",r.message)}}function uH(t){let r;try{if(r=pH(m0),!r)return;const s=JSON.parse(r),a=fH(t),c=(function(h,m){for(let g=h.length-1;g>=0;g--)if(m(h[g]))return g;return-1})(s,(h=>a in h));if(c===-1)return;const d=s.splice(c,1)[0];return dP(m0,JSON.stringify(s)),d[a]}catch(s){M.warn("Error delete preload info: ".concat(r),s.message),dP(m0,"")}}function eM(t){if(t){let r=dy.get(t);r&&(window.clearTimeout(r),r=null,dy.delete(t)),rt(hy).call(hy,t)||t.cloudProxyServer!=="disabled"||hy.push(t)}if(dy.size<oe("AP_CACHE_NUM")&&hy.length>0){const r=hy.shift();dy.set(r,window.setTimeout((async()=>{const{appId:s,cname:a,token:c,stringUid:d,uid:h,proxyServer:m}=r;try{await d_e(s,a,c,h,m,d),dy.has(r)&&eM(r)}catch(g){M.warn("update preload failed",g.message),dH(r)}}),oe("AP_UPDATE_INTERVAL")))}}function dH(t){const r=hy.indexOf(t);r!==-1&&hy.splice(r,1);let s=dy.get(t);s&&(window.clearTimeout(s),s=null,dy.delete(t),eM())}function hH(t,r){const s=t.sua,a=t.ap;r&&s&&It.reqUserAccount(t.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:r,uid:t.intUid,errorCode:null,extend:s.req}),It.reportResourceTiming(t.ap.url,t.sid),It.joinWebProxyAP(t.sid,{lts:a.requestTime,elapse:a.elapse,sucess:1,apServerAddr:a.url,turnServerAddrList:a.proxyInfo.addresses.map((c=>c.ip)).join(","),eventType:"disabled",unilbsServerIds:[Ri.CHOOSE_SERVER,Ri.CLOUD_PROXY_FALLBACK].toString()}),It.joinChooseServer(t.sid,{lts:a.requestTime,elapse:a.elapse,succ:!0,csAddr:a.url,opid:a.opid,serverList:a.gatewayInfo.gatewayAddrs.map((c=>c.address)),ec:null,cid:a.gatewayInfo.cid.toString(),uid:a.gatewayInfo.uid.toString(),csIp:a.gatewayInfo.csIp,unilbsServerIds:[Ri.CHOOSE_SERVER].toString(),isHttp3:a.isHttp3})}function pH(t){return window.atob(window.localStorage.getItem(t)||"")}function dP(t,r){window.localStorage.setItem(t,window.btoa(r))}function fH(t){let r="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(r+="_s_".concat(t.uid)),typeof t.uid=="number"&&(r+="_".concat(t.uid)),t.token&&(r+="_".concat(t.token)),a9(r)}function h_e(t){let r=(function(){const s=m_e.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}})();return(function(s,a){let c=s.appId;c!==void 0&&(Ii(a,10),sg(a,c));let d=s.cid;d!==void 0&&(Ii(a,16),Ii(a,d));let h=s.cname;h!==void 0&&(Ii(a,26),sg(a,h));let m=s.deviceId;m!==void 0&&(Ii(a,34),sg(a,m));let g=s.elapse;g!==void 0&&(Ii(a,40),og(a,g));let E=s.fileSize;E!==void 0&&(Ii(a,48),og(a,g0(E)));let w=s.height;w!==void 0&&(Ii(a,56),og(a,g0(w)));let I=s.jpg;I!==void 0&&(Ii(a,66),Ii(a,I.length),gH(a,I));let A=s.networkType;A!==void 0&&(Ii(a,72),og(a,g0(A)));let N=s.osType;N!==void 0&&(Ii(a,80),og(a,g0(N)));let G=s.requestId;G!==void 0&&(Ii(a,90),sg(a,G));let F=s.sdkVersion;F!==void 0&&(Ii(a,98),sg(a,F));let z=s.sequence;z!==void 0&&(Ii(a,104),og(a,g0(z)));let ee=s.sid;ee!==void 0&&(Ii(a,114),sg(a,ee));let Z=s.timestamp;Z!==void 0&&(Ii(a,120),og(a,Z));let ae=s.uid;ae!==void 0&&(Ii(a,128),Ii(a,ae));let ye=s.vid;ye!==void 0&&(Ii(a,136),Ii(a,ye));let _e=s.width;_e!==void 0&&(Ii(a,144),og(a,g0(_e)));let ue=s.service;ue!==void 0&&(Ii(a,152),Ii(a,ue));let Ae=s.callbackData;Ae!==void 0&&(Ii(a,162),Ii(a,Ae.length),gH(a,Ae));let Ue=s.ticket;Ue!==void 0&&(Ii(a,170),sg(a,Ue));let We=s.vendorConfigs;We!==void 0&&(Ii(a,178),sg(a,We))})(t,r),(function(s){let a=s.bytes,c=s.limit;return a.length===c?a:a.subarray(0,c)})(r)}function p_e(t){return(function(s){let a={};e:for(;!g_e(s);){let c=ST(s);switch(c>>>3){case 0:break e;case 1:a.code=ST(s);break;case 2:a.msg=_H(s,ST(s));break;case 3:a.requestId=_H(s,ST(s));break;case 4:a.timestamp=__e(s,!1);break;default:f_e(s,7&c)}}return a})({bytes:r=t,offset:0,limit:r.length});var r}function f_e(t,r){switch(r){case 0:for(;128&Yu(t););break;case 2:tM(t,ST(t));break;case 5:tM(t,4);break;case 1:tM(t,8);break;default:throw new Error("Unimplemented type: "+r)}}function g0(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let m_e=[];function tM(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function g_e(t){return t.offset>=t.limit}function hP(t,r){let s=t.bytes,a=t.offset,c=t.limit,d=a+r;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),t.bytes=h}return t.offset=d,d>c&&(t.limit=d),a}function mH(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function gH(t,r){let s=hP(t,r.length);t.bytes.set(r,s)}function _H(t,r){let s=mH(t,r),a=String.fromCharCode,c=t.bytes,d="",h="";for(let m=0;m<r;m++){let g,E,w,I,A=c[m+s];(128&A)==0?h+=a(A):(224&A)==192?m+1>=r?h+=d:(g=c[m+s+1],(192&g)!=128?h+=d:(I=(31&A)<<6|63&g,I<128?h+=d:(h+=a(I),m++))):(240&A)==224?m+2>=r?h+=d:(g=c[m+s+1],E=c[m+s+2],(49344&(g|E<<8))!=32896?h+=d:(I=(15&A)<<12|(63&g)<<6|63&E,I<2048||I>=55296&&I<=57343?h+=d:(h+=a(I),m+=2))):(248&A)==240?m+3>=r?h+=d:(g=c[m+s+1],E=c[m+s+2],w=c[m+s+3],(12632256&(g|E<<8|w<<16))!=8421504?h+=d:(I=(7&A)<<18|(63&g)<<12|(63&E)<<6|63&w,I<65536||I>1114111?h+=d:(I-=65536,h+=a(55296+(I>>10),56320+(1023&I)),m+=3))):h+=d}return h}function sg(t,r){let s=r.length,a=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}Ii(t,a);let c=hP(t,a),d=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?d[c++]=m:(m<2048?d[c++]=m>>6&31|192:(m<65536?d[c++]=m>>12&15|224:(d[c++]=m>>18&7|240,d[c++]=m>>12&63|128),d[c++]=m>>6&63|128),d[c++]=63&m|128)}}function Yu(t){return t.bytes[mH(t,1)]}function yH(t,r){let s=hP(t,1);t.bytes[s]=r}function ST(t){let r,s=0,a=0;do r=Yu(t),s<32&&(a|=(127&r)<<s),s+=7;while(128&r);return a}function Ii(t,r){for(r>>>=0;r>=128;)yH(t,127&r|128),r>>>=7;yH(t,r)}function __e(t,r){let s,a=0,c=0,d=0;return s=Yu(t),a=127&s,128&s&&(s=Yu(t),a|=(127&s)<<7,128&s&&(s=Yu(t),a|=(127&s)<<14,128&s&&(s=Yu(t),a|=(127&s)<<21,128&s&&(s=Yu(t),c=127&s,128&s&&(s=Yu(t),c|=(127&s)<<7,128&s&&(s=Yu(t),c|=(127&s)<<14,128&s&&(s=Yu(t),c|=(127&s)<<21,128&s&&(s=Yu(t),d=127&s,128&s&&(s=Yu(t),d|=(127&s)<<7))))))))),{low:a|c<<28,high:c>>>4|d<<24,unsigned:r}}function og(t,r){let s=r.low>>>0,a=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,d=c===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=hP(t,d),m=t.bytes;switch(d){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=d!==9?128|c:127&c;case 8:m[h+7]=d!==8?a>>>21|128:a>>>21&127;case 7:m[h+6]=d!==7?a>>>14|128:a>>>14&127;case 6:m[h+5]=d!==6?a>>>7|128:a>>>7&127;case 5:m[h+4]=d!==5?128|a:127&a;case 4:m[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:m[h]=d!==1?128|s:127&s}}const EH={},vH={},pP=4294967296,y_e=pP*pP,SH=y_e/2;wH(0,!0);const bH=wH(0),E_e=bT(0,-2147483648,!1),v_e=bT(-1,2147483647,!1);function wH(t,r){let s,a,c;return r?(c=0<=(t>>>=0)&&t<256)&&(a=vH[t],a)?a:(s=bT(t,0,!0),c&&(vH[t]=s),s):(c=-128<=(t|=0)&&t<128)&&(a=EH[t],a)?a:(s=bT(t,t<0?-1:0,!1),c&&(EH[t]=s),s)}function bT(t,r,s){return{low:0|t,high:0|r,unsigned:!!s}}function TH(t,r){if(isNaN(t))return bH;{if(t<=-SH)return E_e;if(t+1>=SH)return v_e}return t<0?bH:bT(t%pP|0,t/pP|0,r)}function CH(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}class nM extends Qr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(Jd.CONNECTION_STATE_CHANGE,r,s)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this._qualityRatio}),6e4))}constructor(r){var s;super(),X(this,"name","AgoraRTCImageModeration"),X(this,"_connectionState",tu.CONNECTING),X(this,"_sequence",0),X(this,"_moderationStartTime",void 0),X(this,"_workerConnection",void 0),X(this,"_workerMessageLengthLimit",void 0),X(this,"_qualityRatio",void 0),X(this,"_connectInfo",void 0),X(this,"_cancelTokenSource",ka.CancelToken.source()),X(this,"_retryConfig",void 0),X(this,"_moderationInterval",void 0),X(this,"_moderationTimer",null),X(this,"_moderationMode",1),X(this,"_quality",1),X(this,"_qualityTimer",null),X(this,"_ticket",void 0),X(this,"_moderationIntervalMinimum",void 0),X(this,"_uploadFailedNum",0),X(this,"_uploadNum",0),X(this,"_uploadTimer",null),X(this,"_extraInfo",void 0),X(this,"_vendor",""),X(this,"_encoder",new TextEncoder),X(this,"_moderationId",void 0),X(this,"inspectImage",(()=>{if(this.connectionState!==tu.CONNECTED)throw new ke(te.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval((()=>{this.connectionState===tu.CONNECTED?this.requestToInspectImage():M.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)}),this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()})),this._moderationId=wr(5,"image-moderation-"),this._workerMessageLengthLimit=oe("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=oe("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=oe("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new dT("worker-"+this._moderationId,Ni),this.on(Jd.STATE_CHANGE,((a,c)=>{M.debug("[".concat(this._moderationId,"] Moderation operation :").concat(s0[a]," ").concat(c||""))})),this.handleWorkerEvents()}async init(r,s){this.emit(Jd.STATE_CHANGE,s0.CONNECT_AP),this._connectInfo=r;const a=this._cancelTokenSource.token;return this._retryConfig=s,new mt(((c,d)=>{this.on(Jd.CONNECTION_STATE_CHANGE,((h,m)=>{h===tu.CONNECTED&&c()})),this.requestAP(r,a,s).then((h=>{this.connectWorker(h)})).catch((h=>{d(h)}))}))}updateConfig(r){var s;this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),M.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===tu.CONNECTED&&this.inspectImage()}async requestAP(r,s,a){const c=oe("WEBCS_DOMAIN").map((g=>"https://".concat(g,"/api/v1"))),d=await(function(g,E,w,I){let{appId:A,areaCode:N,cname:G,sid:F,token:z,uid:ee}=E;d0++;const Z="moderation_plugin",ae={service_name:Z,json_body:JSON.stringify({appId:A,areaCode:N,cname:G,command:"allocateEdge",requestId:d0,seq:d0,sid:F,appToken:z,ts:Date.now(),uid:ee+""})};let ye,_e,ue=g[0];return Kd((async()=>{ye=Date.now();const Ae=await Qd(ue,{data:ae,cancelToken:w,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(_e=Date.now()-ye,Ae.code!==0){const Ze=new ke(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Ae.code,{retry:!0,responseTime:_e});throw M.error(Ze.toString()),Ze}const Ue=JSON.parse(Ae.json_body);if(Ue.code!==200){const Ze=new ke(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ue.code,", reason: ").concat(Ue.reason),{code:Ue.code,responseTime:_e});throw M.error(Ze.toString()),Ze}if(!Ue.servers||!Array.isArray(Ue.servers)||Ue.servers.length===0){const Ze=new ke(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ue.code,responseTime:_e});throw M.error(Ze.toString()),Ze}if(!Ue.servers.some((Ze=>!!Ze.wss))){const Ze=new ke(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ue.code,responseTime:_e});throw M.error(Ze.toString()),Ze}const We=oe("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ue.servers.map((Ze=>{let{address:_n,wss:Sn}=Ze;if(_n&&Sn)return"wss://".concat(_n.replace(/\./g,"-"),".").concat(We,":").concat(Sn,"/moderation")})).filter((Ze=>!!Ze)),workerToken:Ue.workerToken,vid:Ue.vid,ticket:Ue.appTicket,responseTime:_e}}),((Ae,Ue)=>(It.apworkerEvent(F,{success:!0,sc:200,serviceName:Z,responseDetail:JSON.stringify(Ae.addressList),firstSuccess:Ue===0,responseTime:_e,serverIp:g[Ue%g.length]}),!1)),((Ae,Ue)=>(It.apworkerEvent(F,{success:!1,sc:Ae.data&&Ae.data.code||200,serviceName:Z,responseTime:_e,serverIp:g[Ue%g.length]}),!!(Ae.code!==te.OPERATION_ABORTED&&Ae.code!==te.UNEXPECTED_RESPONSE||Ae.data&&Ae.data.retry)&&(ue=g[(Ue+1)%g.length],!0))),I)})(c,r,s,a);this.emit(Jd.STATE_CHANGE,s0.AP_CONNECTED);const{addressList:h,ticket:m}=d;return this._ticket=m,h}async connectWorker(r){this.emit(Jd.STATE_CHANGE,s0.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(pn.CONNECTED,(async()=>{this.emit(Jd.STATE_CHANGE,s0.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=tu.CONNECTED})),this._workerConnection.on(pn.CLOSED,(()=>{this.connectionState=tu.CLOSED})),this._workerConnection.on(pn.FAILED,(()=>{this.connectionState=tu.CLOSED})),this._workerConnection.on(pn.RECONNECTING,(()=>{this.connectionState=this.connectionState===tu.CONNECTED?tu.RECONNECTING:tu.CONNECTING})),this._workerConnection.on(pn.ON_MESSAGE,(async r=>{if(r.data instanceof ArrayBuffer){const s=p_e(new Uint8Array(r.data));oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&M.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,M.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout((()=>{It.reportApiInvoke(this._connectInfo.sid||null,{name:di.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:Hr.TRACER}).onError(new ke(te.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null}),oe("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else M.error("[".concat(this._moderationId,"] Unexpected message type from worker"))})),this._workerConnection.on(pn.WILL_RECONNECT,((r,s,a)=>{r==="recover"&&a(r),a("tryNext")})),this._workerConnection.on(pn.REQUEST_NEW_URLS,((r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)}))}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=il(this,Jd.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&M.debug("Only the track being played can be inspected"));this._sequence++;const a=await this.generateRequestData(r,s);this._workerConnection.sendMessage(a,!0,!0)}else oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&M.debug("Only the track being published can be inspected")}async generateRequestData(r,s){let{appId:a,cname:c,cid:d,vid:h,sid:m,uid:g}=s;const E=Date.now(),w=await r.getCurrentFrameImage("image/jpeg",this.quality),I=await X9(w,a,c),A=this._sequence+"-"+d+"-"+g+"-"+E+"-"+wr(12,""),N={appId:a,cid:d,cname:c,deviceId:"",elapse:nM.intToLong(Number(E-this._moderationStartTime)),fileSize:w.buffer.byteLength,height:w.height,width:w.width,jpg:I,networkType:6,osType:7,requestId:A,sdkVersion:"4.24.0",sequence:this._sequence,sid:m,timestamp:TH(E),uid:g,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete N.callbackData;const G=h_e(N);if(G.byteLength<this._workerMessageLengthLimit){if(oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const F=(function(z){for(var ee=1;ee<arguments.length;ee++){var Z=arguments[ee]!=null?arguments[ee]:{};ee%2?CH(Object(Z),!0).forEach((function(ae){X(z,ae,Z[ae])})):Object.getOwnPropertyDescriptors?Object.defineProperties(z,Object.getOwnPropertyDescriptors(Z)):CH(Object(Z)).forEach((function(ae){Object.defineProperty(z,ae,Object.getOwnPropertyDescriptor(Z,ae))}))}return z})({},N);delete F.jpg,M.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(F))}return G}{const F=this.quality*this._qualityRatio;return this.quality=F,await this.generateRequestData(r,{appId:a,cname:c,cid:d,vid:h,sid:m,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=ka.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=tu.CLOSED,this.emit(Jd.STATE_CHANGE,s0.CLOSED)}}function RH(t){if(vr(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new ke(te.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new ke(te.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const S_e={name:"ImageModeration",create:function(t){let{config:r}=t;return RH(r),new nM(r)}};var IH,AH,PH,OH,kH,NH,xH,DH,LH,MH,UH,VH,jH,FH,BH,zH,WH,GH,HH,$H,KH,qH,YH,XH,JH,QH,ZH,e$,t$,n$,r$,i$,s$,o$,a$,c$,l$,u$,d$,h$,p$,yt;function f$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function Xu(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?f$(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):f$(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}ro.setLogger(M);let b_e=(IH=Wt(),AH=Wt({argsMap:(t,r)=>{if(!Array.isArray(r)){if(!(r instanceof Jv))return[r];r=[r]}return r.map((s=>s?Object(s).toString():"null"))}}),PH=Wt({argsMap:(t,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==Xv.DATA?(Array.isArray(r)||(r=[r]),r.map((s=>s.getTrackId()))):[r.getChannelId()])}),OH=Wt({argsMap:(t,r,s,a)=>[typeof r=="object"?r.uid:r,s,a]}),kH=Wt({argsMap:(t,r,s)=>[r,s]}),NH=Wt({argsMap:(t,r)=>r.map((s=>{let{user:a,mediaType:c}=s;return[a==null?void 0:a.uid,c]}))}),xH=Wt({argsMap:(t,r,s,a)=>[typeof r=="object"?r.uid:r,s,a]}),DH=Wt({argsMap:(t,r)=>r.map((s=>{let{user:a,mediaType:c}=s;return{uid:a==null?void 0:a.uid,mediaType:c}}))}),LH=Wt(),MH=Wt(),UH=Wt(),VH=Wt(),jH=Wt(),FH=Wt(),BH=Wt(),zH=Wt(),WH=Wt(),GH=Wt(),HH=Wt(),$H=Wt(),KH=Wt(),qH=Wt(),YH=Wt(),XH=Wt({argsMap:(t,r)=>[r]}),JH=Wt(),QH=Wt(),ZH=Wt(),e$=Wt(),t$=Wt(),n$=Wt(),r$=Wt(),i$=Wt(),s$=Wt({argsMap:(t,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),o$=Wt(),a$=Wt(),c$=Wt(),l$=Wt(),u$=Wt(),d$=Wt(),h$=Wt({reportResult:!0}),p$=Wt(),yt=class extends Qr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t,r){let s;if(super(),X(this,"store",void 0),X(this,"_uid",void 0),X(this,"_channelName",void 0),X(this,"_uintUid",void 0),X(this,"_users",[]),X(this,"_config",void 0),X(this,"_clientId",void 0),X(this,"_appId",void 0),X(this,"_sessionId",null),X(this,"_key",void 0),X(this,"_rtmConfig",{}),X(this,"_joinInfo",void 0),X(this,"_gateway",void 0),X(this,"_statsCollector",void 0),X(this,"_configDistribute",void 0),X(this,"_leaveMutex",void 0),X(this,"_publishMutex",void 0),X(this,"_renewTokenMutex",void 0),X(this,"_subscribeMutex",void 0),X(this,"_encryptionMode","none"),X(this,"_encryptionSecret",null),X(this,"_encryptionSalt",null),X(this,"_encryptDataStream",!1),X(this,"_encryptDataStreamKey",null),X(this,"_encryptDataStreamIv",null),X(this,"_proxyServer",void 0),X(this,"_turnServer",{servers:[],mode:"auto"}),X(this,"_cloudProxyServerMode","disabled"),X(this,"_isDualStreamEnabled",!1),X(this,"_defaultStreamFallbackType",void 0),X(this,"_lowStreamParameter",void 0),X(this,"_streamFallbackTypeCacheMap",new Map),X(this,"_remoteStreamTypeCacheMap",new Map),X(this,"_axiosCancelSource",ka.CancelToken.source()),X(this,"_audioVolumeIndicationInterval",void 0),X(this,"_networkQualityInterval",void 0),X(this,"_userOfflineTimeout",void 0),X(this,"_streamRemovedTimeout",void 0),X(this,"_liveTranscodeStreamingClient",void 0),X(this,"_liveRawStreamingClient",void 0),X(this,"_channelMediaRelayClient",void 0),X(this,"_networkQualitySensitivity","normal"),X(this,"_p2pChannel",void 0),X(this,"_useLocalAccessPoint",!1),X(this,"_setLocalAPVersion",void 0),X(this,"_joinAndNotLeaveYet",!1),X(this,"_numberOfJoinCount",0),X(this,"_joinResponse",null),X(this,"_remoteDefaultVideoStreamType",void 0),X(this,"_inspect",void 0),X(this,"_moderation",void 0),X(this,"_license",void 0),X(this,"_pendingPublishedUsers",[]),X(this,"ntpAlignErrorCount",0),X(this,"remoteInboundOffset",0),X(this,"_peerConnectionState",void 0),X(this,"_handleLocalTrackEnable",((c,d,h)=>{this.publish(c,!1).then(d).catch(h)})),X(this,"_handleLocalTrackDisable",((c,d,h)=>{this.unpublish(c).then(d).catch(h)})),X(this,"_handleUserOnline",(c=>{if(oe("BLOCK_LOCAL_CLIENT")&&ay(c.uid,this.channelName))return void M.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&M.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const d=this._users.find((h=>h.uid===c.uid));if(d)d._trust_in_room_=!0,d._is_pre_created&&(d._is_pre_created=!1,this.safeEmit(An.USER_JOINED,d));else{const h=new rg(c.uid,c.uint_id||c.uid);this._users.push(h),M.debug("[".concat(this._clientId,"] user online"),c.uid),this.store.firstVideoFrameDecoded(h.uid,{userJoinNotify:Date.now()}),this.safeEmit(An.USER_JOINED,h)}})),X(this,"_handleUserOffline",(c=>{if(oe("BLOCK_LOCAL_CLIENT")&&ay(c.uid,this.channelName))return;const d=this._users.find((h=>h.uid===c.uid));d&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),d._audio_pre_subscribed||d._video_pre_subscribed?d._is_pre_created=!0:p1(this._users,d),this._remoteStreamTypeCacheMap.delete(d.uid),this._streamFallbackTypeCacheMap.delete(d.uid),M.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(An.USER_LEAVED,d,c.reason))})),X(this,"_handleAddAudioOrVideoStream",((c,d,h,m,g,E,w,I)=>{if(oe("BLOCK_LOCAL_CLIENT")&&ay(d,this.channelName))return;const A=this._users.find((G=>G.uid===d));if(!A)return void M.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));M.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(A.uid,c,void 0,void 0,void 0,Date.now()),c==="video"&&this.store.firstVideoFrameDecoded(A.uid,{videoAddNotify:Date.now()});const N=c==="audio"?A.hasAudio:A.hasVideo;if(A._uintid||(A._uintid=E||d),c==="audio"?A._trust_audio_stream_added_state_=!0:A._trust_video_stream_added_state_=!0,c==="audio"?(A._audio_added_=!0,h!==void 0&&(A._audioSSRC=h),m!==void 0&&(A._cname=m),w&&(A._audioOrtc=w)):(A._video_added_=!0,h!==void 0&&(A._videoSSRC=h),m!==void 0&&(A._cname=m),I!==void 0&&(A._rtxSsrcId=I),w&&(A._videoOrtc=w)),(c==="audio"?A.hasAudio:A.hasVideo)&&!N&&(M.info("[".concat(this._clientId,"] remote user ").concat(A.uid," published ").concat(c)),this.safeEmit(An.USER_PUBLISHED,A,c)),c==="video"?It.onGatewayStream(this._sessionId,Xi.ON_ADD_VIDEO_STREAM,jr.ON_ADD_VIDEO_STREAM,{peer:E||d,ssrc:A._videoSSRC}):It.onGatewayStream(this._sessionId,Xi.ON_ADD_AUDIO_STREAM,jr.ON_ADD_AUDIO_STREAM,{peer:E||d,ssrc:A._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(A,c,h).then((G=>{if(G&&(M.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(A.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof vT))return this._p2pChannel.unsubscribe(A,c,!0).then((()=>this._subscribe(A,c,!0).catch((F=>{M.error("[".concat(this._clientId,"] resubscribe error"),F.toString())}))))})),this._p2pChannel.hasPendingRemoteMedia(A,c)&&(M.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(A.uid," after reconnect.")),this._subscribe(A,c,!0).catch((G=>{M.error("[".concat(this._clientId,"] resubscribe error"),G.toString())}))),c==="video"&&!Vs()&&!bo()){const G=this._getEncodingName(g);(G==null?void 0:G.toLocaleLowerCase())==rT.av1&&Kge().then((F=>{F||this._gateway.downgradeCodec(G)}))}})),X(this,"_handleRemoveStream",(c=>{if(oe("BLOCK_LOCAL_CLIENT")&&ay(c.uid,this.channelName))return;const d=this._users.find((m=>m.uid===c.uid));if(!d)return void M.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));M.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};d.hasAudio&&d.hasVideo?h=()=>{M.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(An.USER_UNPUBLISHED,d,"audio"),M.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(An.USER_UNPUBLISHED,d,"video")}:d.hasVideo?h=()=>{M.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished video track")),this.safeEmit(An.USER_UNPUBLISHED,d,"video")}:d.hasAudio&&(h=()=>{M.info("[".concat(this._clientId,"] remote user ").concat(d.uid," unpublished audio track")),this.safeEmit(An.USER_UNPUBLISHED,d,"audio")}),d._video_pre_subscribed||d._audio_pre_subscribed||(d._trust_audio_stream_added_state_=!0,d._trust_video_stream_added_state_=!0,d._audio_added_=!1,d._video_added_=!1,this._p2pChannel instanceof vT&&this._p2pChannel.unsubscribe(d).then((m=>{if(m)return this._gateway.unsubscribe(m,d.uid)})),d._audioSSRC=void 0,d._videoSSRC=void 0,d._audioOrtc=void 0,d._videoOrtc=void 0,d._rtxSsrcId=void 0),It.onGatewayStream(this._sessionId,Xi.ON_REMOVE_STREAM,jr.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()})),X(this,"_handleSetStreamLocalEnable",((c,d,h)=>{if(oe("BLOCK_LOCAL_CLIENT")&&ay(d,this.channelName))return;const m=this._users.find((w=>w.uid===d));if(!m)return void M.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));M.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(d));const g=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const w=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===w)return;{const I=m._audio_enabled_?"enable-local-audio":"disable-local-audio";M.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(d,", msg: ").concat(I)),this.safeEmit(An.USER_INFO_UPDATED,d,I)}}else{m._trust_video_enabled_state_=!0;const w=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===w)return;{const I=m._video_enabled_?"enable-local-video":"disable-local-video";M.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(d,", msg: ").concat(I)),this.safeEmit(An.USER_INFO_UPDATED,d,I)}}const E=c==="audio"?m.hasAudio:m.hasVideo;return g!==E?!g&&E?(M.info("[".concat(this._clientId,"] remote user ").concat(d," published ").concat(c)),void this.safeEmit(An.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),M.info("[".concat(this._clientId,"] remote user ").concat(d," unpublished ").concat(c)),void this.safeEmit(An.USER_UNPUBLISHED,m,c)):void 0})),X(this,"_handleMuteStream",((c,d,h)=>{if(oe("BLOCK_LOCAL_CLIENT")&&ay(c,this.channelName))return;M.debug("[".concat(this._clientId,"] receive mute message"),c,d,h);const m=this._users.find((w=>w.uid===c));if(!m)return void M.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const g=d==="audio"?m.hasAudio:m.hasVideo;if(d==="audio"){m._trust_audio_mute_state_=!0;const w=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===w)return;{const I=m._audio_muted_?"mute-audio":"unmute-audio";M.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(I)),this.safeEmit(An.USER_INFO_UPDATED,c,I)}}else{m._trust_video_mute_state_=!0;const w=m._video_muted_;if(m._video_muted_=h,m._video_muted_===w)return;{const I=m._video_muted_?"mute-video":"unmute-video";M.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(I)),this.safeEmit(An.USER_INFO_UPDATED,c,I)}}const E=d==="audio"?m.hasAudio:m.hasVideo;if(g!==E){if(!g&&E)return(d==="audio"?m._audioSSRC:m._videoSSRC)?(M.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(d)),void this.safeEmit(An.USER_PUBLISHED,m,d)):void M.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(d," unmute message  before add stream message, ").concat(d," SSRC doesn't exist yet."));d==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),d==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,d),M.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(d)),this.safeEmit(An.USER_UNPUBLISHED,m,d)}})),X(this,"_handleP2PLost",(async c=>{M.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():M.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)})),X(this,"_handleTokenWillExpire",(()=>{M.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(An.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),X(this,"_handleBeforeUnload",(c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),M.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))})),X(this,"_handleUpdateNetworkQuality",(()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(An.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(An.NETWORK_QUALITY,c)})),X(this,"_handleP2PAddAudioOrVideoStream",((c,d,h,m)=>{const g=this._users.find((w=>w.uid===d));if(!g)return void M.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));M.debug("[".concat(this._clientId,"] stream added with uid ").concat(d,", type ").concat(c)),this.store.subscribe(g.uid,c,void 0,void 0,void 0,Date.now());const E=c==="audio"?g.hasAudio:g.hasVideo;c==="audio"?g._trust_audio_stream_added_state_=!0:g._trust_video_stream_added_state_=!0,c==="audio"?(g._audio_added_=!0,h!==void 0&&(g._audioSSRC=h),m!==void 0&&(g._audioMid=m)):(g._video_added_=!0,h!==void 0&&(g._videoSSRC=h),m!==void 0&&(g._videoMid=m)),(c==="audio"?g.hasAudio:g.hasVideo)&&!E&&(M.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published ").concat(c)),this.safeEmit(An.USER_PUBLISHED,g,c)),this._p2pChannel.hasPendingRemoteMedia(g,c)&&(M.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(g.uid," after reconnect.")),this._subscribe(g,c,!0).catch((w=>{M.error("[".concat(this._clientId,"] resubscribe error"),w.toString())})))})),this._config=t,this._clientId=r||wr(5,"client-"),this.store=new class{constructor(c,d,h,m){tn(this,"state",void 0),this.state={codec:c,audioCodec:d,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:ey.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(c){this.state=(function(d,h){switch(h.type){case nn.SET_SESSION_ID:return et(et({},d),{},{sessionId:h.sessionId});case nn.SET_P2P_ID:return et(et({},d),{},{p2pId:h.p2pId});case nn.SET_UID:return et(et({},d),{},{uid:h.uid});case nn.SET_INT_UID:return et(et({},d),{},{intUid:h.intUid});case nn.SET_PUB_ID:return et(et({},d),{},{pubId:h.pubId});case nn.KEY_METRIC_CLIENT_CREATED:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{clientCreated:h.metric})});case nn.KEY_METRIC_JOIN_START:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{joinStart:h.metric})});case nn.KEY_METRIC_PRELOAD_START:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{preloadStart:h.metric})});case nn.KEY_METRIC_PRELOAD_END:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{preloadEnd:h.metric})});case nn.KEY_METRIC_JOIN_END:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{joinEnd:h.metric})});case nn.KEY_METRIC_REQUEST_AP_START:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{requestAPStart:h.metric})});case nn.KEY_METRIC_REQUEST_AP_END:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{requestAPEnd:h.metric})});case nn.KEY_METRIC_REQUEST_SUA_END:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{requestSUAEnd:h.metric})});case nn.KEY_METRIC_BEFORE_CONNECT:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{beforeConnect:h.metric})});case nn.KEY_METRIC_PEER_RECEIVER:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{peerReceiver:h.metric})});case nn.KEY_METRIC_SIGNAL_CONNECTED:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{signalConnected:h.metric})});case nn.KEY_METRIC_JOIN_REQ:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{joinReq:h.metric})});case nn.KEY_METRIC_JOIN_REP:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{joinRep:h.metric})});case nn.KEY_METRIC_JOIN_GATEWAY_START:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{joinGatewayStart:h.metric})});case nn.KEY_METRIC_JOIN_GATEWAY_END:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{joinGatewayEnd:h.metric})});case nn.KEY_METRIC_PEER_CONNECTION_START:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{peerConnectionStart:h.metric})});case nn.KEY_METRIC_PEER_CONNECTION_END:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{peerConnectionEnd:h.metric})});case nn.KEY_METRIC_DESCRIPTION_START:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{descriptionStart:h.metric})});case nn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{signalChannelOpen:h.metric})});case nn.KEY_METRIC_ICE_CONNECTION_END:return et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{iceConnectionEnd:h.metric})});case nn.KEY_METRIC_PUBLISH:{const m=d.keyMetrics.publish,g=m.findIndex((E=>E.trackId===h.metric.trackId));return g!==-1?(m[g]=et(et({},m[g]),h.metric),et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{publish:[...m]})})):et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{publish:[...d.keyMetrics.publish,h.metric]})})}case nn.KEY_METRIC_SUBSCRIBE:{const m=d.keyMetrics.subscribe,g=m.findIndex((E=>E.userId===h.metric.userId&&E.type===h.metric.type));return g!==-1?(m[g]=et(et({},m[g]),h.metric),et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{subscribe:[...m]})})):et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{subscribe:[...d.keyMetrics.subscribe,h.metric]})})}case nn.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const m=d.keyMetrics.firstVideoFrameDecoded,g=m.findIndex((E=>E.userId===h.metric.userId));return g!==-1?(m[g]=et(et({},m[g]),h.metric),et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{firstVideoFrameDecoded:[...m]})})):et(et({},d),{},{keyMetrics:et(et({},d.keyMetrics),{},{firstVideoFrameDecoded:[...d.keyMetrics.firstVideoFrameDecoded,h.metric]})})}case nn.RESET_FIRST_VIDEO_FRAME_DECODED:return d.keyMetrics.firstVideoFrameDecoded=[],d;case nn.SET_CLOUD_PROXY_SERVER_MODE:return d.cloudProxyServerMode=h.mode,d;case nn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?d.joinChannelServiceRecords=[...d.joinChannelServiceRecords,h.record]:(d.joinChannelServiceRecords[h.index]=et(et({},d.joinChannelServiceRecords[h.index]),h.record),d.joinChannelServiceRecords=[...d.joinChannelServiceRecords]),d;case nn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return d.joinChannelServiceRecords=[],d;case nn.RESET_KEY_METRICS:return d.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},d;case nn.SET_USE_P2P:return et(et({},d),{},{useP2P:h.val});case nn.SET_TRANSPORT_TYPE:return et(et({},d),{},{p2pTransport:h.val});default:return d}})(this.state,c)}set autoSubscribe(c){this.state.autoSubscribe=c}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(c){this.state.enableInstantMuteRestore=c}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(c){this.dispatch({type:nn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:nn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:nn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:nn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:nn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:nn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:nn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:nn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:nn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:nn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:nn.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:nn.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:nn.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:nn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:nn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:nn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:nn.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:nn.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:nn.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:nn.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:nn.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:nn.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:nn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:nn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:nn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:nn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(c,d){this.dispatch({type:nn.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:et({userId:c},d)})}descriptionStart(){this.dispatch({type:nn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:nn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:nn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,d,h,m){this.dispatch({type:nn.KEY_METRIC_PUBLISH,metric:et(et({trackId:c,type:d},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,d,h,m,g,E,w){this.dispatch({type:nn.KEY_METRIC_SUBSCRIBE,metric:et(et(et(et(et({userId:c,type:d},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),g&&{firstFrame:g}),E&&{streamAdded:E}),w&&{firstDecoded:w})})}massSubscribe(c,d,h,m){c.forEach((g=>{this.dispatch({type:nn.KEY_METRIC_SUBSCRIBE,metric:et(et(et({userId:g.userId,type:g.type},d&&{subscribeStart:d}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})}))}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,d){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map((h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2"))));try{return typeof d!="number"?(this.dispatch({type:nn.RECORD_JOIN_CHANNEL_SERVICE,record:et(et({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(d<0||d>=this.state.joinChannelServiceRecords.length||this.dispatch({type:nn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:d}),d)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:nn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:nn.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:nn.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(t.codec,t.audioCodec,t.mode,this._clientId),this._leaveMutex=new ro("client-leave",this._clientId),this._publishMutex=new ro("client-publish",this._clientId),this._renewTokenMutex=new ro("client-renewtoken",this._clientId),this._subscribeMutex=new ro("client-subscribe",this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),M.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Jl," build: ").concat(BL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{AL(t.clientRoleOptions),s=Object.assign({},t.clientRoleOptions)}catch(c){M.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var a;this._statsCollector=new yT(this.store),this._statsCollector.onStatsException=(c,d,h)=>{M.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(d,", uid: ").concat(h)),c===F2.VIDEO_ENCODE_FAILED&&this.localTracks.forEach((m=>{m instanceof I1&&oe("ENABLE_ENCODE_EXCEPTION")&&m.findClosestProfile()})),this.safeEmit(An.EXCEPTION,{code:c,msg:d,uid:h})},this._statsCollector.onUploadPublishDuration=(c,d,h,m)=>{const g=this._users.find((E=>E.uid===c));g&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(g._uintid,{peerPublishDuration:h,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(g)),It.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:d,videoPublishDuration:h,peer:g._uintid}))},this._statsCollector.onVideoCodecChanged=c=>{if(oe("VIDEO_STANDARD_BITRATE_VERSION")&&(c==="av1"||c==="h265"||c==="h264")){const d=this.localTracks.find((h=>h instanceof kr));d&&d._saveEncodeBitrateRatio!==1&&d.setSaveEncodeBitrateRatio(c==="h264"?oe("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=t.mode==="p2p",this._gateway=new Bge(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||Ni,httpRetryConfig:t.httpRetryConfig||Ni,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:s}),this._configDistribute=new Qge(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(a={store:this.store,statsCollector:this._statsCollector},Ef("P2PChannel").create(a)),this._handleP2PEvents()):this._p2pChannel=new vT(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,r,s,a,c){let d=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];mr("JOIN_GATEWAY_USE_443PORT_ONLY",d),mr("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof C2&&(m.use443PortOnly=d,m.tryDoubleDomain=h),(async function(g,E,w){c1.get(g)||c1.set(g,[]),l1.get(g)||l1.set(g,E),Qh.get(g)||Qh.set(g,0);const I=c1.get(g),A=l1.get(g);if(!I||!A)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Qh.get(g)===A){const ee=qw();I.push(ee),await ee.promise}Qh.set(g,Qh.get(g)+1);for(var N=arguments.length,G=new Array(N>3?N-3:0),F=3;F<N;F++)G[F-3]=arguments[F];const z=await w(...G);return Qh.set(g,Qh.get(g)-1),Qh.get(g)===A-1&&I.length>0&&(I[0].resolve(),I.shift()),Qh.get(g)===0&&(c1.set(g,[]),l1.set(g,0),Qh.set(g,0)),z})("client.join",oe("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,r,s,a,c)}async join(t,r,s,a,c){const d=++this._numberOfJoinCount;this.store.joinStart(),a&&(this.store.uid=a);const h=(g1||g1||(g1=(window.location.protocol.split(":")[0]||"").toUpperCase(),g1))==="HTTPS",m=u9()?window.isSecureContext:"Browser Not Support";(!u9()&&!h||!window.isSecureContext)&&M.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let g;It.setAppId(t);try{if(!s&&s!==null)throw new ke(te.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));if(s&&Ss(s,"token",1,2047),Ss(t,"appid",1,2047),V1(r),a&&j1(a),c)if(typeof c=="string")Ss(c,"optionalInfo",1,256),g=c;else{if(typeof c!="object")throw new ke(te.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:z,enableInstantMuteRestore:ee}=c;z&&($d(z,"autoSubscribe"),M.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(z)),this.store.autoSubscribe=z),ee&&($d(ee,"enableInstantMuteRestore"),M.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(ee)),this.store.enableInstantMuteRestore=ee)}}}catch(z){throw It.reportApiInvoke(Z_(),{name:di.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:Hr.TRACER}).onError(z),z}if(this._leaveMutex.isLocked&&(M.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),M.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const z=new ke(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw It.reportApiInvoke(Z_(),{name:di.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:Hr.TRACER}).onError(z),z}this._gateway.state="CONNECTING",this.store.preloadStart();const E=await lH({appId:t,cname:r,uid:a,stringUid:typeof a=="string"?a:void 0,token:s||t,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new ke(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const w=(E==null?void 0:E.sid)||Z_();M.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(d)),this._sessionId||(this._sessionId=w,this.store.sessionId=this._sessionId);const I=It.reportApiInvoke(w,{id:this._clientId,name:di.JOIN,options:[t,r,s,a],states:{isHttps:h,isSecureContext:m},tag:Hr.TRACER}),A=Xu(Xu(Xu({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:t,sid:this._sessionId,cname:r,uid:typeof a!="string"?a:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:g,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!E},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:oe("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(A.setLocalAPVersion=this._setLocalAPVersion),typeof a=="string"&&(A.stringUid=a,this._uintUid?(A.uid=this._uintUid,this._uintUid=void 0):A.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(A.aesmode=this._encryptionMode,A.aespassword=await(async z=>{const ee=(function(_e){const ue=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),Ae=new Uint8Array(new ArrayBuffer(ue.length));for(let Ue=0;Ue<ue.length;Ue+=1)Ae[Ue]=ue.charCodeAt(Ue);return Ae})(),Z=await window.crypto.subtle.importKey("spki",ee,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),ae=RL(z),ye=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Z,ae);return(function(_e){let ue="";for(let Ae=0;Ae<_e.length;Ae+=1)ue+=String.fromCharCode(_e[Ae]);return window.btoa(ue)})(new Uint8Array(ye))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new ke(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(A.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const z=new TextEncoder,ee=oe("USE_PURE_ENCRYPTION_MASTER_KEY")?z.encode(A.appId+this._encryptionSecret+this._encryptionSecret):z.encode(A.appId+A.cname+this._encryptionSecret);this._encryptDataStreamIv=await(async function(Z,ae,ye){const _e=await window.crypto.subtle.importKey("raw",ae,"PBKDF2",!1,["deriveBits","deriveKey"]),ue=Z==="aes-128-gcm2"?128:256,Ae=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:v9,hash:"SHA-256",salt:ye},_e,ue+_me);return new Uint8Array(Ae).subarray(ue/8)})(this._encryptionMode,ee,Q_(this._encryptionSalt)),this._encryptDataStreamKey=await(async function(Z,ae,ye){const _e=await window.crypto.subtle.importKey("raw",ae,"PBKDF2",!1,["deriveBits","deriveKey"]),ue=Z==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:v9,hash:"SHA-256",salt:ye},_e,{name:"AES-GCM",length:ue},!0,["encrypt","decrypt"])})(this._encryptionMode,ee,Q_(this._encryptionSalt))}else m?M.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):M.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,M.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:t,stringUid:A.stringUid});const N=this._sessionId;setTimeout((()=>{this.connectionState==="CONNECTING"&&N===this._sessionId&&It.joinChannelTimeout(this._sessionId,5)}),5e3);try{var G;let z;const ee=A.cloudProxyServer;if(rt(G=["proxy3","proxy4","proxy5"]).call(G,ee)){const ue=oe("PROXY_SERVER_TYPE3");Array.isArray(ue)?A.proxyServer=ue[0]:A.proxyServer=ue}if(It.setProxyServer(A.proxyServer),M.setProxyServer(A.proxyServer),this.store.requestAPStart(),E){if(M.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(A.stringUid?", ".concat(A.stringUid," => ").concat(E.intUid):""," ")),A.stringUid&&!A.uid&&(A.uid=E.intUid),z={gatewayInfo:E.ap.gatewayInfo},oe("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&A.turnServer.mode==="auto")if(E.ap.proxyInfo.addresses.length===0)M.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ue=(await s7(E.ap.proxyInfo,E.ap.gatewayInfo.uid)).map((Ae=>({turnServerURL:Ae.address,tcpport:Ae.tcpport||Bs.tcpport,udpport:Ae.udpport||Bs.udpport,username:Ae.username||Bs.username,password:Ae.password||Bs.password,forceturn:!1,security:!0})));A.turnServer={mode:"manual",servers:ue}}hH(E,A.stringUid)}else{if(A.stringUid&&!A.uid){let ue;[ue,z]=await mt.all([x7(A.stringUid,A,this._axiosCancelSource.token,this._config.httpRetryConfig||Ni,this.store).finally((()=>{this.store.requestSUAEnd()})),N7(A,this._axiosCancelSource.token,this._config.httpRetryConfig||Ni,!0,this.store).finally((()=>{this.store.requestAPEnd()}))]),M.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(A.stringUid," => ").concat(ue)),A.uid=ue,z.gatewayInfo.uid=ue,z.gatewayInfo.res.uid=ue}else z=await N7(A,this._axiosCancelSource.token,this._config.httpRetryConfig||Ni,!0,this.store);if(!this._joinAndNotLeaveYet)throw new ke(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout((()=>{this._configDistribute.startGetConfigDistribute(A,this._axiosCancelSource.token),this._configDistribute.on(lT.UPDATE_BITRATE_LIMIT,(ue=>{this._p2pChannel.updateBitrateLimit(ue)})),this._configDistribute.on(lT.UPDATE_CLIENT_ROLE_OPTIONS,(ue=>{this._setClientRoleOptions(ue)}))}),0),this._key=s||t;const Z=z.gatewayInfo,ae=A.uid?A.uid:Z.uid;this._joinInfo=Xu(Xu({},A),{},{cid:Z.cid,uid:ae,vid:Z.vid,apResponse:Z.res,apGatewayAddress:Z.apGatewayAddress,uni_lbs_ip:Z.uni_lbs_ip,gatewayAddrs:Z.gatewayAddrs}),this.store.intUid=ae,this.store.cid=Z.cid;const ye=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new ke(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));I.onSuccess(ye),this._appId=t,this._channelName=A.cname,this._uid=ye,this.store.uid=ye,setTimeout((()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Vs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()}),0);const _e=A.stringUid?"string uid: ".concat(A.stringUid,",uid: ").concat(A.uid):"uid: ".concat(this._uid);return M.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(_e)),setTimeout((()=>{M.startUpload()}),5e3),this.store.joinEnd(),F=this,rt(oy).call(oy,F)||oy.push(F),this._cloudProxyServerMode==="disabled"&&Bn().supportWebCrypto&&oe("ENABLE_PRELOAD")&&eM(this._joinInfo),ye}catch(z){const ee=Array.isArray(z)?z[0]:z;throw ee&&ee.code===te.OPERATION_ABORTED?M.warning("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),ee):M.error("[".concat(this._clientId,"] join number: ").concat(d,", Joining channel failed, rollback"),ee),ee.code!==te.OPERATION_ABORTED&&this._numberOfJoinCount===d&&(this._gateway.state="DISCONNECTED",this._reset()),I.onError(ee),ee}var F}_joinGateway(){if(!this._joinInfo||!this._key)throw new ke(te.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!oe("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){M.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Vs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),(function(r){const s=oy.indexOf(r);s!==-1&&oy.splice(s,1)})(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return M.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED",sr.LEAVE),M.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof Jv))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new ke(te.INVALID_PARAMS,"param list is empty");const s=t;if(this._gateway.role==="audience")throw new ke(te.INVALID_OPERATION,"audience can not publish stream");for(const c of s){if(!(c instanceof Jv))throw new ke(te.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new ke(te.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}M.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map((c=>"".concat(c.getTrackId()," ")))));const a=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&s.forEach((c=>{const d=this._configDistribute.getBitrateLimit();c instanceof kr&&d&&c.setBitrateLimit(d.uplink)}));try{await this._publishHighStream(s),M.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map((c=>"".concat(c.getTrackId()," ")))))}catch(c){throw M.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{a()}}async _publishDataChannel(t){if(t==null)throw new ke(te.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(t)));vr(t.id,"id",0,65535,!0),$d(t.ordered,"ordered"),Ss(t.metadata,"metadata",0,512),M.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex((c=>c.id===t.id))!==-1)throw new ke(te.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new ke(te.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&oe("FORCE_TURN")&&!oe("TURN_ENABLE_TCP")&&!oe("TURN_ENABLE_UDP"))throw new ke(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const s=(function(c){return w7(c,!1)})(t),a=await this._p2pChannel.publishDataChannel([s]);if(a.length>0){if(typeof s._originDataChannelId!="number")throw M.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new ke(te.CREATE_DATACHANNEL_ERROR);try{await mt.all(a.map((c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0)))),await s._waitTillOpen()}catch(c){if(c.code!==te.DISCONNECT_P2P)throw c}}return M.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw M.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{r()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new ke(te.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(t)if(Array.isArray(t))r=t;else{if(!(t instanceof Jv))return this._unpublishDataChannel([t]);r=[t]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);M.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map((a=>"".concat(a.getTrackId()," ")))," "));const s=await this._publishMutex.lock();try{if(this.store.useP2P){const a=await this._p2pChannel.unpublish(r);a&&await this._gateway.sendExtensionMessage(Ei.UNPUBLISH,{unpubMsg:a},!0)}else{const a=await this._p2pChannel.unpublish(r);a&&await this._gateway.unpublish(a,this._uid),M.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map((c=>"".concat(c.getTrackId())))))}}catch(a){throw M.error("[".concat(this._clientId,"] unpublish error"),a.toString()),a}finally{s&&s()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),M.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map((s=>"".concat(s.id," ")))," "));const r=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublishDataChannel(t);s&&await this._gateway.unpublishDataChannel(s),M.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map((a=>"".concat(a.id)))))}catch(s){throw M.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{r&&r()}}async subscribe(t,r,s){if(!(t instanceof rg)){const a=this.remoteUsers.find((c=>c.uid===t));if(!a)throw new ke(te.INVALID_REMOTE_USER,"user is not in the channel");t=a}return r==="datachannel"?this._subscribeDataChannel(t,s):this._subscribe(t,r)}async presubscribe(t,r){if(Yi(r,"mediaType",["audio","video"]),this.store.useP2P)throw new ke(te.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new ke(te.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const s=r===vt.AUDIO,a=r===vt.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:d,ortc:h,rtxSsrcId:m,cname:g,uint_id:E}=await this._gateway.presubscribe(t,r,!0);if(d==null)throw new ke(te.UNEXPECTED_RESPONSE,"no ssrc id");let w=this._users.find((A=>A.uid===t));w||(w=new rg(t,E||t),w._is_pre_created=!0,this._users.push(w)),g&&(w._cname=g),w._uintid||(w._uintid=E||t),s&&(w._audioSSRC=d,w._audio_pre_subscribed=!0,h&&(w._audioOrtc=h)),a&&(w._videoSSRC=d,w._video_pre_subscribed=!0,h&&(w._videoOrtc=h),m!=null&&(w._rtxSsrcId=m)),M.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(d)),await this._p2pChannel.subscribe(w,r,d,m,h);const I=s?w._audioTrack:w._videoTrack;if(!I)throw new ke(te.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(w._trust_audio_stream_added_state_=!0,w._audio_added_=!0),a&&(w._trust_video_stream_added_state_=!0,w._video_added_=!0),I}catch(d){throw M.error("[".concat(this._clientId,"] presub user ").concat(t," error"),d),d}finally{c()}}async _subscribeDataChannel(t,r){var s;if(vr(r,"channelId",0,65535,!0),!this._joinInfo)throw new ke(te.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find((m=>m===t)))throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new ke(te.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new ke(te.INVALID_REMOTE_USER,"user is not published");const c=(s=t._dataChannels)===null||s===void 0?void 0:s.find((m=>m.id===r));if(!c)throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new ke(te.REMOTE_USER_IS_NOT_PUBLISHED);const d=await this._subscribeMutex.lock();M.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(t,[c]);if(m&&rt(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new ke(te.CREATE_DATACHANNEL_ERROR);const g={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(t.uid,g,!0),await c._waitTillOpen()}catch(g){if((g==null?void 0:g.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[c]),g;await this._p2pChannel.unsubscribeDataChannel(t,[c]),this._p2pChannel.setPendingRemoteDataChannel(t,c.id)}return M.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),c}finally{d()}}async _p2pSubscribe(t,r,s){if(Yi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new ke(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((d=>d===t))){const d=new ke(te.INVALID_REMOTE_USER,"user is not in the channel");throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),d}if(!t.hasAudio&&!t.hasVideo){const d=new ke(te.INVALID_REMOTE_USER,"user is not published");throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),d}if(!s&&(r==="audio"&&!t.hasAudio||r==="video"&&!t.hasVideo)){const d=new ke(te.REMOTE_USER_IS_NOT_PUBLISHED);throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),d}const c=await this._subscribeMutex.lock();M.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const h=r==="audio"?t._audioSSRC:t._videoSSRC,m=r==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(t,r,h,m)}catch(h){throw h}M.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch((h=>{M.warning("[".concat(this._clientId,"] auto set fallback failed"),h)}));const d=r==="audio"?t._audioTrack:t._videoTrack;if(!d)throw new ke(te.UNEXPECTED_ERROR,"can not find remote track in user object");return d}catch(d){throw M.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),d),d}finally{c()}}async _subscribe(t,r,s){if(this.store.useP2P)return this._p2pSubscribe(t,r);if(Yi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new ke(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((E=>E===t))){const E=new ke(te.INVALID_REMOTE_USER,"user is not in the channel");throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),E}if(!t.hasAudio&&!t.hasVideo){const E=new ke(te.INVALID_REMOTE_USER,"user is not published");throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),E}if(!(s||(r!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(r!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const E=new ke(te.REMOTE_USER_IS_NOT_PUBLISHED);throw M.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(r,", remote track is not published")),E}let c=r==="audio"?t._audioSSRC:t._videoSSRC,d=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?vt.AUDIO:vt.VIDEO,ssrcId:c};r==="video"&&this.store.firstVideoFrameDecoded(t.uid,{subscribeStart:Date.now()});const g=await this._subscribeMutex.lock();M.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,r))await this._p2pChannel.unmuteRemote(t,r);else try{const w=r==="audio"?t._audioSSRC:t._videoSSRC;w!==void 0&&w!==c&&(c=w,d=r==="audio"?t._audioOrtc:t._videoOrtc,h=r==="video"?t._rtxSsrcId:void 0,m={stream_type:r==="audio"?vt.AUDIO:vt.VIDEO,ssrcId:c}),ao.markSubscribeStart(this.store.clientId,c),this.store.subscribe(t.uid,r,Date.now()),await this._p2pChannel.subscribe(t,r,c,h,d);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(t.uid,m,!0)}catch(I){if((I==null?void 0:I.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,r),I;await this._p2pChannel.unsubscribe(t,r,!0),this._p2pChannel.setPendingRemoteMedia(t,r)}this.store.subscribe(t.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,r)}catch(w){throw this._p2pChannel.reportSubscribeEvent(!1,w==null?void 0:w.code,t,r),w}M.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch((w=>{M.warning("[".concat(this._clientId,"] auto set fallback failed"),w)}));const E=r==="audio"?t._audioTrack:t._videoTrack;if(!E)throw new ke(te.UNEXPECTED_ERROR,"can not find remote track in user object");return r==="video"&&(this.store.firstVideoFrameDecoded(t.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(t)),E}catch(E){throw M.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),E),E}finally{g()}}async massSubscribe(t){if(mf(t,"subscribeList"),!this._joinInfo)throw new ke(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),s=new Map,a=await this._subscribeMutex.lock();M.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map((m=>{let{user:g,mediaType:E}=m;return"user: ".concat(g==null?void 0:g.uid,", mediaType: ").concat(E)})).join("; ")));const c=(t=[...t]).map((m=>{let{user:g,mediaType:E}=m;return{user:g,mediaType:E}})),d=await this._p2pChannel.globalLock();try{var h;for(let g=t.length-1;g>=0;g--){const E=t[g],{user:w,mediaType:I}=E;if(Yi(I,"mediaType",["audio","video"]),!w){const F=new ke(te.INVALID_PARAMS,"user property does not exist in subscribeList item");throw M.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),F}if(!this._users.find((F=>F===w))){const F=new ke(te.INVALID_REMOTE_USER,"user is not in the channel");M.error("[".concat(this._clientId,"] can not massSubscribe ").concat(w.uid,", this user is not in the channel")),c[g].error=F,t.splice(g,1);continue}if(I==="audio"&&(!w.hasAudio||w._audioSSRC===void 0)||I==="video"&&(!w.hasVideo||w._videoSSRC===void 0)){const F=new ke(te.REMOTE_USER_IS_NOT_PUBLISHED);M.error("[".concat(this._clientId,"] can not subscribe ").concat(w.uid," with mediaType ").concat(I,", remote user is not published")),c[g].error=F,t.splice(g,1);continue}const N=is.Video|is.LwoVideo,G=s.get(w);if(G){if(I==="video"?G&N:G&is.Audio){t.splice(g,1),M.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(w.uid,", mediaType:").concat(I," twice"));continue}s.set(w,G|(I==="video"?N:is.Audio))}else s.set(w,I==="video"?N:is.Audio)}for(let g=t.length-1;g>=0;g--){const E=t[g],{user:w,mediaType:I}=E,A=is.Video|is.LwoVideo;if(this._p2pChannel.hasRemoteMedia(w,I)){await this._p2pChannel.unmuteRemoteNoLock(w,I);const N=s.get(w);s.set(w,I==="video"?N^A:N^is.Audio),t.splice(g,1)}}this.store.massSubscribe(t.map((g=>({userId:g.user.uid,type:g.mediaType}))),r);let m=Ya(h=Array.from(s.entries())).call(h,((g,E)=>{let[w,I]=E;if(I===0)return g;const A={stream_id:w.uid,stream_type:I};return I&is.Audio&&(A.audio_ssrc=w._audioSSRC),I&is.Video&&(A.video_ssrc=w._videoSSRC),g.push(A),g}),[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map((E=>{let{user:w,mediaType:I}=E;return{user:w,mediaType:I,ssrcId:I===vt.VIDEO?w._videoSSRC:w._audioSSRC,rtxSsrcId:I===vt.VIDEO?w._rtxSsrcId:void 0}})));const g=new Map;if(m=m.filter((E=>E.video_ssrc&&!this._p2pChannel.isPreSubScribe(E.video_ssrc)||E.audio_ssrc&&!this._p2pChannel.isPreSubScribe(E.audio_ssrc)||!E.video_ssrc&&!E.audio_ssrc)),m.length>0){const E=await this._gateway.subscribeAll(m,!0);((E==null?void 0:E.users)||[]).forEach((w=>{let{stream_id:I,video_error_code:A,audio_error_code:N,error_code:G}=w;(A||N||G)&&g.set(I,{video_error_code:A,audio_error_code:N,error_code:G})}))}if(Array.from(g.entries()).length>0){const E=[];Array.from(g.entries()).forEach((w=>{let[I,A]=w;const N=this.remoteUsers.find((G=>G.uid===I));if(N){let G;A.error_code||A.video_error_code&&A.audio_error_code?G=void 0:A.video_error_code?G=vt.VIDEO:A.audio_error_code&&(G=vt.AUDIO),E.push({user:N,mediaType:G})}})),E.length>0&&await this._p2pChannel.massUnsubscribeNoLock(E)}for(const E of c){const w=g.get(E.user.uid);if(w){const I=w.error_code||E.mediaType==="audio"&&w.audio_error_code||E.mediaType==="video"&&w.video_error_code;if(I){const A=uT(I);M.error("user:".concat(E.user.uid," mediaType:").concat(E.mediaType," has massSubscribe error ").concat(A.desc)),E.error=new ke(te.SUBSCRIBE_FAILED,"code ".concat(I,": ").concat(A.desc))}}E.error||(E.mediaType==="video"?E.track=E.user.videoTrack:E.track=E.user.audioTrack)}return this.store.massSubscribe(c.filter((E=>!E.error)).map((E=>({userId:E.user.uid,type:E.mediaType}))),void 0,Date.now()),c.forEach((E=>{var w;It.subscribe(this.store.sessionId,{succ:!!E.error,ec:((w=E.error)===null||w===void 0?void 0:w.code)||null,video:E.mediaType===vt.VIDEO,audio:E.mediaType===vt.AUDIO,peerid:E.user.uid,subscribeRequestid:E.mediaType===vt.VIDEO?E.user._videoSSRC:E.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(E.user._videoSSRC)},!0)})),M.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map((E=>{let{user:w,mediaType:I}=E;return"user: ".concat(w==null?void 0:w.uid,", mediaType: ").concat(I)})).join("; "))),c}catch(g){throw await this._p2pChannel.massUnsubscribeNoLock(t),g}}finally{d(),a()}}async unsubscribe(t,r,s){if(!(t instanceof rg)){const d=this.remoteUsers.find((h=>h.uid===t));if(!d)throw new ke(te.INVALID_REMOTE_USER,"user is not in the channel");t=d}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(t,s)}else await this._unsubscribeDataChannel(t,s);if(r&&Yi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new ke(te.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find((d=>d===t))){const d=new ke(te.INVALID_REMOTE_USER,"user is not in the channel");throw M.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),d}M.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(t,r);else{const d=await this._p2pChannel.unsubscribe(t,r);d&&await this._gateway.unsubscribe(d,t.uid),r&&r!=="audio"||(t._audio_pre_subscribed=!1),r&&r!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&p1(this._users,t),M.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(r))}}catch(d){if(d.code===te.DISCONNECT_P2P)return void M.warning("disconnecting p2p, abort unsubscribe request.");throw M.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),d.toString()),d}finally{c()}}async _unsubscribeDataChannel(t,r){if(r&&vr(r,"id",0,65535,!0),!this._joinInfo)throw new ke(te.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find((c=>c===t))){const c=new ke(te.INVALID_REMOTE_USER,"user is not in the channel");throw M.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),c}let a;if(typeof r=="number"){const c=t._dataChannels.find((d=>d.id===r));c&&(a=[c])}else a=t._dataChannels;if(a===void 0){const c=new ke(te.REMOTE_USER_IS_NOT_PUBLISHED);throw M.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(r,", remote datachannel is not published")),c}M.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(a.map((c=>c.id))));try{const c=await this._p2pChannel.unsubscribeDataChannel(t,a);c&&await this._gateway.unsubscribeDataChannel(c,t.uid),M.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===te.DISCONNECT_P2P)return void M.warning("disconnecting p2p, abort unsubscribe request.");throw M.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),c.toString()),c}}async massUnsubscribe(t){if(mf(t,"unsubscribeList"),!this._joinInfo)throw new ke(te.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");M.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map((s=>{let{user:a,mediaType:c}=s;return"user: ".concat(a==null?void 0:a.uid,", mediaType: ").concat(c,";")})).join())),t=[...t];const r=new Map;for(let s=t.length-1;s>=0;s--){const{user:a,mediaType:c}=t[s];if(!a){const m=new ke(te.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw M.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(Yi(c,"mediaType",["video","audio",void 0]),!this._users.find((m=>m===a))){M.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(a.uid,", user is not in the channel")),t.splice(s,1);continue}const h=is.Video|is.LwoVideo;if(r.has(a)){const m=r.get(a);let g;switch(c){case"video":g=m&h;break;case"audio":g=m&is.Audio;break;default:g=m&(is.Audio|h)}if(g){M.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(a.uid,",mediaType:").concat(c," twice.")),t.splice(s,1);continue}c?c==="audio"?r.set(a,m|is.Audio):c==="video"&&r.set(a,m|h):r.set(a,m|is.Audio|h)}else c?c==="audio"?r.set(a,is.Audio):c==="video"&&r.set(a,h):r.set(a,is.Audio|h)}try{const s=await this._p2pChannel.massUnsubscribe(t);s&&await this._gateway.massUnsubscribe(s),M.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map((a=>{let{user:c,mediaType:d}=a;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(d,";")})).join()))}catch(s){if(s.code===te.DISCONNECT_P2P)return void M.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw M.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(t){(function(s){if(!s)throw new Le(te.INVALID_PARAMS);ri(s.width)||TL(s.width,"streamParameter.width"),ri(s.height)||TL(s.height,"streamParameter.height"),ri(s.framerate)||TL(s.framerate,"streamParameter.framerate"),ri(s.bitrate)||vr(s.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&M.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),M.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&t.bitrate&&r.bitrate<t.bitrate&&(t.bitrate=r.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,Xe.LocalVideoLowTrack)}async enableDualStream(){if(!Bn().supportDualStream)throw It.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new ke(te.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new ke(te.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw It.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,It.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),M.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new ke(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Xe.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw It.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,It.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),M.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,r){if((function(a){Yi(a,"role",["audience","host"])})(t),r&&AL(r),this.mode==="rtc"||this.mode==="p2p")throw M.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new ke(te.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&t==="host")throw new ke(te.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new ke(te.INVALID_OPERATION,"can not set client role to audience when publishing stream");const s=this._config.role;this._joinInfo&&(this._joinInfo.role=t),t!==s&&oe("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(t,r),this._config.role=t,this._gateway.reconnect("recover",js.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(t,r),this._config.role=t),M.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(r&&r.level))}async _setClientRoleOptions(t){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{t&&AL(t),await this._gateway.setClientRole(this._config.role,t),r=!0}catch{}finally{M.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(t))}}getRemoteInboundOffset(){var t;const r=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!r||!r.timestamp)return 0;const s=r.timestamp-Date.now();return Math.abs(s)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,r){if(Ss(t,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new ke(te.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ke(te.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,It.setProxyServer(this._proxyServer),M.setProxyServer(this._proxyServer),M.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(t,r){if(Array.isArray(t)||(t=[t]),!r){if(this.connectionState!=="DISCONNECTED")throw new ke(te.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new ke(te.INVALID_OPERATION,"You have already set the proxy")}if(Qw(t))return this._turnServer={servers:t,mode:"original-manual"},void M.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(t.map((s=>s.urls)).join(","),"."));t.forEach((s=>Qz(s))),this._turnServer={servers:t,mode:"manual"},M.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new ke(te.INVALID_OPERATION,"you should set license before join channel");if(Ss(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new ke(te.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,M.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new ke(te.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new ke(te.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let s;switch(t===void 0&&(t=3),t){case 1:case 2:throw new ke(te.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new ke(te.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,M.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new ke(te.INVALID_OPERATION,"Stop proxy server after leave channel");It.setProxyServer(),M.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",M.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new ke(te.INVALID_PARAMS,"accessPoints is required.");mf(t.accessPoints.serverList,"accessPoints.serverList"),Ss(t.accessPoints.domain,"accessPoints.domain");const r=(A,N)=>{vr(A,N,0,65535,!0)};let s=443;if(t.accessPoints.port&&(r(t.accessPoints.port,"accessPoints.port"),s=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ke(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");oe("CLOSE_AFB_FOR_LOCAL_AP")&&(mr("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),mr("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const a=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=t.accessPoints.domain,d=t.accessPoints.serverList.map((A=>a.test(A)?"".concat(A.replace(/\./g,"-"),".").concat(c):A)),h=d.map((A=>"".concat(A,":").concat(s)));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,mr("WEBCS_DOMAIN",h),mr("WEBCS_DOMAIN_BACKUP_LIST",h),mr("GATEWAY_DOMAINS",[c]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(mf(t.report.hostname,"report.hostname"),mr("EVENT_REPORT_DOMAIN",t.report.hostname[0]),mr("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(mr("EVENT_REPORT_DOMAIN",d[0]),mr("EVENT_REPORT_BACKUP_DOMAIN",d[1]||d[0]));let m=6443;t.report&&t.report.port&&(r(t.report.port,"report.port"),m=t.report.port),mr("STATS_COLLECTOR_PORT",m),t.report?mr("ENABLE_EVENT_REPORT",!0):mr("ENABLE_EVENT_REPORT",!1);let g="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(mf(t.log.hostname,"log.hostname"),g=t.log.hostname[0]):g=d[0];let E=6444;t.log&&t.log.port&&(r(t.log.port,"log.port"),E=t.log.port),mr("LOG_UPLOAD_SERVER","".concat(g,":").concat(E));let w=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(mf(t.cds.hostname,"cds.hostname"),w=t.cds.hostname):w=d;let I=443;t.cds&&t.cds.port&&(r(t.cds.port,"cds.port"),I=t.cds.port),mr("CDS_AP",w.map((A=>"".concat(A,":").concat(I)))),t.cds?mr("ENABLE_CONFIG_DISTRIBUTE",!0):mr("ENABLE_CONFIG_DISTRIBUTE",!1),M.info("set local access point v2 success")}setLocalAccessPoints(t,r){if(mf(t,"serverList"),Ss(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new ke(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map((a=>s.test(a)?"".concat(a.replace(/\./g,"-"),".").concat(r):a)),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,mr("WEBCS_DOMAIN",t),mr("WEBCS_DOMAIN_BACKUP_LIST",t),mr("GATEWAY_DOMAINS",[r]),mr("EVENT_REPORT_DOMAIN",t[0]),mr("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),mr("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),M.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Yi(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw M.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else M.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,r){Yi(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,r),setTimeout((()=>{const s=this._users.find((a=>a.uid===t));s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()}),2e3)}catch(s){throw M.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}M.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(t,r)}async setStreamFallbackOption(t,r){Yi(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,r)}catch(s){throw M.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}M.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(t,r)}setEncryptionConfig(t,r,s,a){(function(d){Yi(d,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),Ss(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(rt(c).call(c,t)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new ke(te.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new ke(te.INVALID_PARAMS,"current encrypt mode does not need salt");if(a){if($d(a,"encryptDataStream"),!rt(c).call(c,t))throw new ke(te.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||M.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=r,s&&(this._encryptionSalt=$m(s))}async renewToken(t){if(Ss(t,"token",1,2047),!this._key||!this._joinInfo)throw new ke(te.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const s=await this._renewTokenMutex.lock();try{if(oe("USE_NEW_TOKEN")){M.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const a=await Jge(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ni);M.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:a})}else M.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});M.debug("[".concat(this._clientId,"] renewToken success"))}catch(a){throw this._key=r,this._joinInfo.token=r,M.error("[".concat(this._clientId,"] renewToken failed"),a.toString()),a}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?M.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(An.VOLUME_INDICATOR,t)}),oe("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return t.Duration=Math.round(r.duration/1e3),t}async startLiveStreaming(t,r){if(!r){if(this.codec!=="h264")throw new ke(te.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new ke(te.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new ke(te.LIVE_STREAMING_TASK_CONFLICT);const s=r?gf.TRANSCODE:gf.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(t,s)}setLiveTranscoding(t){return this._createLiveStreamingClient(gf.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((s=>s&&s.hasUrl(t)));if(!r.length)throw new ke(te.INVALID_PARAMS,"can not find live streaming url to stop");await mt.all(r.map((s=>s&&s.stopLiveStreamingTask(t))))}async startChannelMediaRelay(t){j7(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){j7(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(t){this._p2pChannel instanceof vT&&this._p2pChannel.addAudioMetadata(t)}async sendStreamMessage(t){var r;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new ke(te.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const c=new TextEncoder;t.payload=c.encode(t.payload)}let a=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&rt(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(a=!0,t.payload=await(async function(c,d,h){var m;const g=Ya(m=Array.from(h)).call(m,((F,z)=>F+z),0),E={serverTs:0,seq:yme++,length:h.length,checkSum:g},w=new Uint8Array(o9(g,2)),I=new ArrayBuffer(Hv),A=new DataView(I);A.setUint32(0,E.serverTs),A.setUint16(4,E.seq),A.setUint16(6,E.length),A.setUint16(8,E.checkSum);const N=16-h.length%16;h=t9(h,new Uint8Array(N));const G=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:E9,additionalData:w},d,h);return t9(new Uint8Array(I),new Uint8Array(G))})(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new ke(te.INVALID_PARAMS,a?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Jt.DATA_STREAM,{payload:$m(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-s_e},!s)}sendMetadata(t){if(!this._joinInfo)throw new ke(te.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new ke(te.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Jt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:$m(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(Ime),!this._joinInfo)throw new ke(te.INVALID_OPERATION,"can not send custom report, not joined");await It.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const t=this._statsCollector.getRemoteNetworkQualityStats();if(oe("DELETE_NEQ_AFTER_USER_LEAVE")){const r=this._users.map((s=>s.uid+""));Object.keys(t).forEach((s=>{rt(r).call(r,s)||delete t[s]}))}return t}async pickSVCLayer(t,r){Yi(r.spatialLayer,"spatialLayer",[0,1,2,3]),Yi(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,r)}catch(s){throw M.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(t){const{apRTM:r=!1,rtmFlag:s}=t;if($d(r,"apRTM"),vr(s,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=s,M.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(M.debug("[".concat(this._clientId,"] reset client")),(function(t){const r=r0.indexOf(t);r!==-1&&r0.splice(r,1)})(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=ka.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&dH(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&It.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach((t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach((r=>r._close())),t._dataChannels.length=0)})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new ro("client-publish",this._clientId),this._subscribeMutex=new ro("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,r){var s;const a=t||Z_();t?M.debug("[".concat(this._clientId,"] new Session ").concat(a)):M.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(a));const c=t?"":this._sessionId||"";this._sessionId=a,this.store.sessionId=a,It.addSid(a);const d={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};It.sessionInit(this._sessionId,Xu({cname:r.channel,appid:r.appId},d)),this._joinInfo&&(this._joinInfo.sid=a),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=a)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new ke(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&oe("FORCE_TURN")&&!oe("TURN_ENABLE_TCP")&&!oe("TURN_ENABLE_UDP"))throw new ke(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");M.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const a=(await s.next()).value;if(a){try{await this._gateway.sendExtensionMessage(Ei.PUBLISH,a,!0)}catch(c){throw s.throw(c),c}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const a=(await s.next()).value;if(a){var r;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==te.DISCONNECT_P2P)throw s.throw(d),d}await s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of t)c instanceof kr&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch((d=>{M.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))})),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,t),(s==null?void 0:s.code)===te.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new ke(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new ke(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));M.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),a=(await s.next()).value;if(a){var r;let c;try{c=await this._gateway.publish(this._uid,a,!0)}catch(d){if(d.code!==te.DISCONNECT_P2P)throw s.throw(d),d}s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===te.WS_ABORT)return;throw s}}_createLiveStreamingClient(t){const r=()=>{if(!this._joinInfo||!this._appId)return new ke(te.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=(a={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Ef("LiveStreaming").create(a));var a;return s.onLiveStreamError=(c,d)=>{It.reportApiInvoke(this._sessionId,{name:di.ON_LIVE_STREAM_ERROR,options:[c,d],tag:Hr.TRACER}).onSuccess(),this.safeEmit(An.LIVE_STREAMING_ERROR,c,d)},s.onLiveStreamWarning=(c,d)=>{It.reportApiInvoke(this._sessionId,{name:di.ON_LIVE_STREAM_WARNING,options:[c,d],tag:Hr.TRACER}).onSuccess(),this.safeEmit(An.LIVE_STREAMING_WARNING,c,d)},s.on(b2.REQUEST_WORKER_MANAGER_LIST,((c,d,h)=>{if(!this._joinInfo)return h(new ke(te.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,g,E,w){const I=oe("UAP_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map((A=>g.proxyServer?"https://".concat(g.proxyServer,"/ap/?url=").concat(A+"/api/v1?action=uap"):"https://".concat(A,"/api/v1?action=uap")));return await Gge(I,m,g,E,w)})(c,this._joinInfo,this._axiosCancelSource.token,Ni).then(d).catch(h)})),s};return t===gf.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new ke(te.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:s}=this.getLocalVideoStats(),a=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:s}},Ef("ChannelMediaRelay").create(t));a.on("state",(c=>{c===rc.RELAY_STATE_FAILURE&&a&&a.dispose(),this.safeEmit(An.CHANNEL_MEDIA_RELAY_STATE,c)})),a.on("event",(c=>{this.safeEmit(An.CHANNEL_MEDIA_RELAY_EVENT,c)})),this._channelMediaRelayClient=a,this._statsCollector.onStatsChanged=(c,d)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(d))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,r){const{added:s,deleted:a}=t,c=[];if(r){const d=[];this._users.forEach((h=>{h._dataChannels.forEach((m=>{s.every((g=>g.uid!==h._uintid||g.stream_id!==m.id))&&d.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})}))})),d.length>0&&this._handleUpdateDataChannel({added:[],deleted:d})}Array.isArray(s)&&s.length>0&&s.forEach((d=>{const{uid:h,stream_id:m,ordered:g,max_retrans_times:E,metadata:w}=d,I=this._users.find((A=>A._uintid===h));if(!I)return void M.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(M.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),rt(c).call(c,I)||c.push(I),I._uintid||(I._uintid=h),I._dataChannels.findIndex((A=>A.id===d.stream_id))===-1){const A={id:m,ordered:!!g,maxRetransmits:E,metadata:w},N=(function(G){return w7(G,!0)})(A);I._dataChannels.push(N),M.info("[".concat(this._clientId,"] remote user ").concat(I.uid," published datachannel")),r||this.safeEmit(An.USER_PUBLISHED,I,"datachannel",A)}this._p2pChannel.hasPendingRemoteDataChannel(I,d.stream_id)&&(M.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(I.uid," after reconnect.")),this._subscribeDataChannel(I,d.stream_id).catch((A=>{M.error("[".concat(this._clientId,"] resubscribe datachannel error"),A.toString())})))})),r&&(this.safeEmit(An.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(a)&&a.length>0&&a.forEach((d=>{const{uid:h,stream_id:m}=d,g=this._users.find((w=>w._uintid===h));if(!g)return void M.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const E=g._dataChannels.find((w=>w.id===d.stream_id));E&&(M.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(g,[E]).then((w=>{if(g._dataChannels=g._dataChannels.filter((I=>I!==E)),w)return this._gateway.unsubscribeDataChannel(w,g.uid)})),M.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(E.id)),this.safeEmit(An.USER_UNPUBLISHED,g,"datachannel",E._config))}))}_getEncodingName(t){var r;if(!this._joinResponse)return;const s=(r=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||r===void 0?void 0:r.videoCodecs;if(s)for(const c of s){var a;if(c.payloadType===t)return c==null||(a=c.rtpMap)===null||a===void 0?void 0:a.encodingName}}_handleRemoveDataChannels(t){const r=this._users.find((s=>s.uid===t.uid));if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){M.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const s=()=>{M.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach((a=>{this.safeEmit(An.USER_UNPUBLISHED,r,"datachannel",a._config)}))};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then((a=>{if(a)return this._gateway.unsubscribeDataChannel(a,r.uid)})),s()}}else M.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(hs.UPDATE_GATEWAY_CONFIG,(()=>{(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void M.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();Object.keys(r).forEach((a=>{const{value:c,type:d,expires:h}=r[a];h&&h<=s||d||m2()||!Object.prototype.hasOwnProperty.call(E1,a)||(qd[a]=c,Vr[a]=c,M.debug("Update gateway parameters from config distribute",a,c))}))}catch(r){M.error("Error update config from local cache",r.message)}})()})),this._gateway.on(hs.DISCONNECT_P2P,(async()=>{await this._p2pChannel.disconnectForReconnect()})),this._gateway.on(hs.CONNECTION_STATE_CHANGE,((t,r,s)=>{var a;if(s===sr.FALLBACK)return;const c=()=>{this.safeEmit(An.CONNECTION_STATE_CHANGE,t,r,s)};if(It.reportApiInvoke(this._sessionId||((a=this._gateway.joinInfo)===null||a===void 0?void 0:a.sid)||null,{name:di.CONNECTION_STATE_CHANGE,options:[t,r,s],tag:Hr.TRACER}).onSuccess(JSON.stringify({cur:t,prev:r,reason:s})),M.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void c();if(t==="RECONNECTING")this._users.forEach((h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)})),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var d;this._streamFallbackTypeCacheMap.forEach(((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch((g=>{M.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),g)}))})),this._remoteStreamTypeCacheMap.forEach(((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch((g=>{M.warning("[".concat(this._clientId,"] auto set remote stream type failed"),g)}))})),this._remoteDefaultVideoStreamType!==void 0&&((d=this._joinInfo)===null||d===void 0?void 0:d.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then((()=>{M.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((h=>{M.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))})),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout((()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter((h=>!h._trust_in_room_)).forEach((h=>{M.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})})))}),3e3),this._streamRemovedTimeout=window.setTimeout((()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach((h=>{h._trust_audio_mute_state_||(M.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,vt.AUDIO,!1)),h._trust_video_mute_state_||(M.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,vt.VIDEO,!1)),h._trust_audio_enabled_state_||(M.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(M.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(M.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(M.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(M.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))})))}),1e3))}c()})),this._gateway.on(hs.REQUEST_NEW_GATEWAY_LIST,(async(t,r)=>{if(!this._joinInfo)return r(new ke(te.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s;const a=await lH(Xu(Xu({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));a?(s=a.ap,hH(a),this._joinInfo.preload=!0):(s=await V2(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Ni,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);const c=[];s.gatewayInfo.gatewayAddrs.forEach((d=>{let{address:h}=d;const[m,g]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:g}):c.push({host:m,port:g})})),t(c)}catch(s){r(s)}})),this._gateway.on(hs.NETWORK_QUALITY,(t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(An.NETWORK_QUALITY,t)})),this._gateway.on(hs.STREAM_TYPE_CHANGE,((t,r)=>{this.safeEmit(An.STREAM_TYPE_CHANGED,t,r),It.reportApiInvoke(this._sessionId,{name:di.STREAM_TYPE_CHANGE,options:[t,r],tag:Hr.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:r}))})),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(hs.IS_P2P_DISCONNECTED,(t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)})),this._gateway.on(hs.REQUEST_P2P_CONNECTION_PARAMS,(async(t,r,s)=>{try{let a=await this._p2pChannel.getEstablishParams();a&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(a=await this._p2pChannel.startP2PConnection(t)),r(a)}catch(a){s(a)}})),this._gateway.on(hs.JOIN_RESPONSE,((t,r)=>{if(this.store.useP2P)return;let s;this._joinResponse=t,t.attributes?s=t.attributes.userAttributes.preSubSsrcs:M.debug("no attributes in joinResponse");const a=d7(t.ortc,r,s);this._p2pChannel.connect(a)})),this._gateway.on(hs.PRE_CONNECT_PC,(async t=>{const{candidates:r,fingerprint:s,turnServer:a}=t;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){const{cert:d,cid:h}=this._joinInfo.apResponse,m="".concat(h,"_").concat(d);if(m.length<4||m.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:a,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var c;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(h,"_").concat(d),icePwd:"".concat(h,"_").concat(d)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(c=oe("FINGERPRINT"))!==null&&c!==void 0?c:s}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(g){g.code&&g.code===te.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:a,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}}))}_handleGatewaySignalEvents(){this._gateway.signal.on(Pn.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Pn.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Pn.ON_ADD_AUDIO_STREAM,(t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc))),this._gateway.signal.on(Pn.ON_ADD_VIDEO_STREAM,(t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.pt,t.uint_id,t.ortc,t.rtxSsrcId))),this._gateway.signal.on(Pn.ON_REMOTE_DATASTREAM_UPDATE,(t=>{this._handleUpdateDataChannel(t)})),this._gateway.signal.on(Pn.ON_REMOTE_FULL_DATASTREAM_INFO,(t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)})),this._gateway.signal.on(Pn.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Pn.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Pn.MUTE_AUDIO,(t=>this._handleMuteStream(t.uid,vt.AUDIO,!0))),this._gateway.signal.on(Pn.UNMUTE_AUDIO,(t=>this._handleMuteStream(t.uid,vt.AUDIO,!1))),this._gateway.signal.on(Pn.MUTE_VIDEO,(t=>this._handleMuteStream(t.uid,vt.VIDEO,!0))),this._gateway.signal.on(Pn.UNMUTE_VIDEO,(t=>this._handleMuteStream(t.uid,vt.VIDEO,!1))),this._gateway.signal.on(Pn.RECEIVE_METADATA,(t=>{const r=Q_(t.metadata);this.safeEmit(An.RECEIVE_METADATA,t.uid,r)})),this._gateway.signal.on(Pn.ON_DATA_STREAM,(async t=>{var r;if(!t)return;let s=Q_(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&rt(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(t.payload.length<Hv)throw new ke(te.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(Hv));s=await(async function(d,h,m){const g=m.subarray(0,Hv),E=g.slice(8,Hv),w=(E[0]<<8)+E[1],I=(g[6]<<8)+g[7],A=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:d,tagLength:E9,additionalData:new Uint8Array(o9(w,2))},h,m.subarray(Hv));return new Uint8Array(A).subarray(0,I)})(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let a=0;if(t.ordered||t.syncWithAudio){const c=this._p2pChannel.getStats(),d=this.remoteUsers.find((m=>m.uid===t.uid)),h=c==null?void 0:c.audioRecv.find((m=>m.ssrc===(d==null?void 0:d._audioSSRC)));a=h==null?void 0:h.jitterBufferMs}(a==null||Number.isNaN(a))&&(a=0),a_e(Xu(Xu({},t),{},{payload:s}),a,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})})),this._gateway.signal.on(Pn.ON_CRYPT_ERROR,(()=>{Hm((()=>{M.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(An.CRYPT_ERROR)}),this._sessionId)})),this._gateway.signal.on(Pn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Pn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{M.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,sr.TOKEN_EXPIRE),this.safeEmit(An.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()})),this._gateway.signal.on(Pn.ON_STREAM_FALLBACK_UPDATE,(t=>{M.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(An.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")})),this._gateway.signal.on(Pn.ON_PUBLISH_STREAM,(t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),M.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))})),this._gateway.signal.on(Pn.ENABLE_LOCAL_VIDEO,(t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)})),this._gateway.signal.on(Pn.DISABLE_LOCAL_VIDEO,(t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)})),this._gateway.signal.on(en.REQUEST_TIMEOUT,((t,r)=>{if(this._joinInfo)switch(t){case Jt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var s,a;const d=c.some((g=>{let{stream_type:E}=g;return E===cr.Audio})),h=c.some((g=>{let{stream_type:E}=g;return E!==cr.Audio})),m=c.some((g=>{let{stream_type:E}=g;return E===cr.Screen||E===cr.ScreenLow}));r.state==="offer"&&It.publish(this._joinInfo.sid,{eventElapse:ao.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:te.TIMEOUT,audio:d,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:d?(s=c.find((g=>{let{stream_type:E}=g;return E===cr.Audio})))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:h?(a=c.find((g=>{let{stream_type:E}=g;return E!==cr.Audio})))===null||a===void 0||(a=a.ssrcs[0])===null||a===void 0?void 0:a.ssrcId.toString():void 0})}break}case Jt.SUBSCRIBE:r&&It.subscribe(this._joinInfo.sid,{succ:!1,ec:te.TIMEOUT,audio:r.stream_type===vt.AUDIO,video:r.stream_type===vt.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:ao.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}})),this._gateway.signal.on(Pn.ON_P2P_OK,(t=>{this.uid,this._uid})),this._gateway.signal.on(Pn.ON_PUBLISHED_USER_LIST,(t=>{if(t==null||!t.users)return;oe("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter((a=>!ay(a.string_id||a.stream_id,this.channelName))));const r=[],s=[];for(const a of t.users){let c=this._users.find((w=>w._uintid===a.stream_id));c?c._trust_in_room_=!0:(c=new rg(a.string_id||a.stream_id,a.stream_id),this._users.push(c),this.store.firstVideoFrameDecoded(c.uid,{userJoinNotify:Date.now()}),this.getListeners(An.PUBLISHED_USER_LIST).length===0&&(M.debug("[".concat(this._clientId,"] user online"),a.stream_id),this.safeEmit(An.USER_JOINED,c)));const d=is.Audio&a.stream_type,h=(is.Video|is.LwoVideo)&a.stream_type,m=(65280&a.stream_type)!=0,g=d&&c.hasAudio,E=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=a.video_ssrc,c._rtxSsrcId=a.video_rtx),d&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=a.audio_ssrc),d&&!g&&this.getListeners(An.PUBLISHED_USER_LIST).length===0&&(M.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(An.USER_PUBLISHED,c,"audio")),h&&!E&&this.getListeners(An.PUBLISHED_USER_LIST).length===0&&(M.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(An.USER_PUBLISHED,c,"video")),(d&&!g||h&&!E||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&s.push({user:c,mediaType:"video"}),d&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&s.push({user:c,mediaType:"audio"})}s.length>0&&(M.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map((a=>"user: ".concat(a.user.uid,", mediaType: ").concat(a.mediaType))).join("; ")," ")),this.massSubscribe(s).catch((a=>{M.error("[".concat(this._clientId,"] mass resubscribe error"),a.toString())}))),this.getListeners(An.PUBLISHED_USER_LIST).length>0?oe("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(M.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map((a=>a.uid)).join(", "))),this.safeEmit(An.PUBLISHED_USER_LIST,r)):M.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map((a=>a.uid)).join(", ")))})),this._gateway.signal.on(Pn.ON_RTP_CAPABILITY_CHANGE,(t=>{const{video_codec:r}=t;this._p2pChannel instanceof vT&&this._p2pChannel.updateRemoteRTPCapabilities(r.map((s=>s.toLowerCase())).filter((s=>{var a;return rt(a=Object.keys(rT)).call(a,s)})))}))}_handleP2PEvents(){this._gateway.signal.on(Pn.ON_USER_OFFLINE,(()=>{this._p2pChannel.disconnectForReconnect()})),this._gateway.signal.on(Ei.PUBLISH,((t,r,s)=>{const{uid:a}=t;t.forEach((c=>{const{kind:d,ssrcs:h,mid:m,isMuted:g}=c;this._handleP2PAddAudioOrVideoStream(d,a,h[0].ssrcId,m);const E=this._users.find((w=>w.uid===a));return E&&this.store.useP2P?this._p2pChannel.mockSubscribe(E,d,h[0].ssrcId,m).then((()=>{r()})).catch(s):r(),this._handleMuteStream(a,d,!!g)}))})),this._gateway.signal.on(Ei.CALL,(async(t,r,s)=>{if(this.store.useP2P)try{var a;r(await this._p2pChannel.startP2P({turnServer:(a=this._joinInfo)===null||a===void 0?void 0:a.turnServer},t))}catch(c){s(c)}})),this._gateway.signal.on(en.P2P_CONNECTION,(async t=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(t)})),this._gateway.signal.on(Ei.UNPUBLISH,(async(t,r,s)=>{if(this.store.useP2P){const{unpubMsg:a,uid:c}=t,d=this._users.find((h=>h.uid===c));if(!d)return M.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{a.forEach((async h=>{let{stream_type:m}=h;const g=m===cr.Audio?vt.AUDIO:vt.VIDEO;await this._p2pChannel.unsubscribe(d,g),this._handleMuteStream(c,g,!0)})),r()}catch(h){s(h)}}})),this._gateway.signal.on(Ei.CONTROL,(async(t,r)=>{const{action:s}=t;switch(s){case Xm.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,vt.VIDEO,!0);break;case Xm.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,vt.AUDIO,!0);break;case Xm.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,vt.VIDEO,!1);break;case Xm.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,vt.AUDIO,!1)}})),this._gateway.signal.on(Ei.RESTART_ICE,(async(t,r,s)=>{if(this.store.useP2P)try{const{direction:a,iceParameter:c}=t;a!==ha.SEND_ONLY||c?r(await this._p2pChannel.restartICE(a,c)):(this._p2pChannel.handleDisconnect(a),r())}catch(a){s(a)}})),this._gateway.signal.on(Ei.CANDIDATE,(t=>{if(this.store.useP2P){const{candidate:r,direction:s}=t;this._p2pChannel.addRemoteCandidate(r,s)}})),this._p2pChannel.on(Lt.RequestP2PRestartICE,(async(t,r,s)=>{try{const{direction:a}=t;r(await this._gateway.sendExtensionMessage(Ei.RESTART_ICE,t,a===ha.SEND_ONLY))}catch(a){s(a)}})),this._p2pChannel.on(Lt.LocalCandidate,(t=>{this._gateway.sendExtensionMessage(Ei.CANDIDATE,JSON.stringify(t),!0)})),this._p2pChannel.on(Lt.RequestP2PMuteLocal,(async(t,r,s)=>{try{await this._gateway.sendExtensionMessage(Ei.CONTROL,t,!0),r()}catch(a){s(a)}})),this._p2pChannel.on(Lt.RequestP2PUnmuteRemote,(async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()})),this._p2pChannel.on(Lt.RequestP2PMuteRemote,(async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()})),this._p2pChannel.on(Lt.StateChange,((t,r)=>{r===or.Connected&&this._p2pChannel.republish()}))}_handleP2PChannelEvents(){this._p2pChannel.on(Lt.PeerConnectionStateChange,(t=>{const r=this._peerConnectionState;t!==r&&(this.safeEmit(An.PEERCONNECTION_STATE_CHANGE,t,r),this._peerConnectionState=t)})),this._p2pChannel.on(Lt.RequestMuteLocal,(async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()})),this._p2pChannel.on(Lt.RequestUnmuteLocal,(async(t,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(a){a.code===te.DISCONNECT_P2P?r():s(a)}else r()})),this._p2pChannel.on(Lt.RequestRePublish,((t,r,s)=>{this.publish(t,!1).then(r).catch(s)})),this._p2pChannel.on(Lt.RequestRePublishDataChannel,((t,r,s)=>{mt.all(t.map((async a=>{const c=await this._p2pChannel.publishDataChannel([a]);try{c.forEach((d=>{this._uid&&this._gateway.publishDataChannel(this._uid,d,!0)}))}catch(d){if(d.code!==te.DISCONNECT_P2P)throw d}}))).then(r).catch(s)})),this._p2pChannel.on(Lt.RequestReSubscribe,(async(t,r,s)=>{try{for(const{user:a,kind:c}of t)c===vt.VIDEO?await this.subscribe(a,"video"):await this.subscribe(a,"audio");r()}catch(a){s(a)}})),this._p2pChannel.on(Lt.RequestUpload,((t,r)=>{this._gateway.upload(t,r)})),this._p2pChannel.on(Lt.RequestUploadStats,(t=>{this._gateway.uploadWRTCStats(t)})),this._p2pChannel.on(Lt.MediaReconnectStart,(t=>{this.safeEmit(An.MEDIA_RECONNECT_START,t)})),this._p2pChannel.on(Lt.MediaReconnectEnd,(t=>{this.safeEmit(An.MEDIA_RECONNECT_END,t)})),this._p2pChannel.on(Lt.NeedSignalRTT,(t=>{t(this._gateway.getSignalRTT())})),this._p2pChannel.on(Lt.RequestRestartICE,(async t=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(t),s=await r.next();if(s.done)return;const a=s.value;let c;try{c=await this._gateway.restartICE({iceParameters:a})}catch(h){return void r.throw(h)}const{iceParameters:d}=(function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}})(c);await r.next({remoteIceParameters:d})})),this._p2pChannel.on(Lt.RequestReconnect,(async()=>{this._gateway.reconnect()})),this._p2pChannel.on(Lt.RequestReconnectPC,(async()=>{var t;const{iceParameters:r,dtlsParameters:s,rtpCapabilities:a}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:c,gatewayAddress:d}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:s,rtpCapabilities:a}),h=d7(c,d);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()})),this._p2pChannel.on(Lt.RequestUnpublishForReconnectPC,(async(t,r,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),r()):s()})),this._p2pChannel.on(Lt.P2PLost,(()=>{this.safeEmit(An.P2P_LOST,this.store.uid)})),this._p2pChannel.on(Lt.UpdateVideoEncoder,(t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)})),this._p2pChannel.on(Lt.ConnectionTypeChange,(t=>{this.safeEmit(An.IS_USING_CLOUD_PROXY,t)})),this._p2pChannel.on(Lt.RequestLowStreamParameter,(t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(Lt.QueryClientConnectionState,(t=>{t(this.connectionState)})),this._p2pChannel.on(Lt.AudioMetadata,(t=>{this.safeEmit(An.AUDIO_METADATA,t)})),this._p2pChannel.on(Lt.AudioPts,(t=>{this.safeEmit(An.AUDIO_PTS,Number(t))}))}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new ke(te.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new ke(te.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const s=(r={config:t},Ef("ContentInspect").create(r));this._inspect=s,this.handleVideoInspectEvents(s);const{appId:a,cname:c,sid:d,token:h,uid:m,cid:g,vid:E}=this._joinInfo;await s.init({appId:a,areaCode:"",cname:c,sid:d,token:h,uid:m,cid:g,vid:E?Number(E):0},Ni)}catch(s){throw Array.isArray(s)?s[0]:s}var r}handleVideoInspectEvents(t){t.on(ps.CONNECTION_STATE_CHANGE,((r,s)=>{if(this.safeEmit(An.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,s),s===$u.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(An.CONTENT_INSPECT_ERROR,new ke(te.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}})),t.on(ps.INSPECT_RESULT,((r,s)=>{var a;if((s==null?void 0:s.code)===te.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return M.debug("Stop inspect content because that has left channel"),this==null||(a=this._inspect)===null||a===void 0||a.close(),void(this._inspect=void 0);this.safeEmit(An.CONTENT_INSPECT_RESULT,r,s)})),t.on(ps.CLIENT_LOCAL_VIDEO_TRACK,(r=>{r(this.localTracks.filter((s=>s.trackMediaType==="video"))[0])}))}async disableContentInspect(){if(!this._inspect)throw new ke(te.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,r){if($d(t,"enabled"),t){if(!r)throw new ke(te.INVALID_PARAMS,"config is required");if(RH(r),!this._joinInfo)throw new ke(te.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const a=(s={config:r},Ef("ImageModeration").create(s));this._moderation=a,this.handleImageModerationEvents(a);const{appId:c,cname:d,sid:h,token:m,uid:g,cid:E,vid:w}=this._joinInfo;await a.init({appId:c,areaCode:"",cname:d,sid:h,token:m,uid:g,cid:E,vid:w?Number(w):0},Ni)}}catch(a){throw Array.isArray(a)?a[0]:a}}else{var s;if(!this._moderation)throw new ke(te.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(a){throw Array.isArray(a)?a[0]:a}}}handleImageModerationEvents(t){t.on(Jd.CONNECTION_STATE_CHANGE,((r,s)=>{if(this.safeEmit(An.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,s),r===tu.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new ke(te.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}})),t.on(Jd.CLIENT_LOCAL_VIDEO_TRACK,(r=>{r(this.localTracks.filter((s=>s.trackMediaType==="video"))[0])}))}setP2PTransport(t){if((function(r){Yi(r,"transport",["default","auto","relay","sd-rtn"])})(t),this.mode!=="p2p")throw new ke(te.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,M.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return M.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){$d(t,"enabled"),mr("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,r){switch(r){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},Rt(yt.prototype,"leave",[IH],Object.getOwnPropertyDescriptor(yt.prototype,"leave"),yt.prototype),Rt(yt.prototype,"publish",[AH],Object.getOwnPropertyDescriptor(yt.prototype,"publish"),yt.prototype),Rt(yt.prototype,"unpublish",[PH],Object.getOwnPropertyDescriptor(yt.prototype,"unpublish"),yt.prototype),Rt(yt.prototype,"subscribe",[OH],Object.getOwnPropertyDescriptor(yt.prototype,"subscribe"),yt.prototype),Rt(yt.prototype,"presubscribe",[kH],Object.getOwnPropertyDescriptor(yt.prototype,"presubscribe"),yt.prototype),Rt(yt.prototype,"massSubscribe",[NH],Object.getOwnPropertyDescriptor(yt.prototype,"massSubscribe"),yt.prototype),Rt(yt.prototype,"unsubscribe",[xH],Object.getOwnPropertyDescriptor(yt.prototype,"unsubscribe"),yt.prototype),Rt(yt.prototype,"massUnsubscribe",[DH],Object.getOwnPropertyDescriptor(yt.prototype,"massUnsubscribe"),yt.prototype),Rt(yt.prototype,"setLowStreamParameter",[LH],Object.getOwnPropertyDescriptor(yt.prototype,"setLowStreamParameter"),yt.prototype),Rt(yt.prototype,"enableDualStream",[MH],Object.getOwnPropertyDescriptor(yt.prototype,"enableDualStream"),yt.prototype),Rt(yt.prototype,"disableDualStream",[UH],Object.getOwnPropertyDescriptor(yt.prototype,"disableDualStream"),yt.prototype),Rt(yt.prototype,"setClientRole",[VH],Object.getOwnPropertyDescriptor(yt.prototype,"setClientRole"),yt.prototype),Rt(yt.prototype,"_setClientRoleOptions",[jH],Object.getOwnPropertyDescriptor(yt.prototype,"_setClientRoleOptions"),yt.prototype),Rt(yt.prototype,"setProxyServer",[FH],Object.getOwnPropertyDescriptor(yt.prototype,"setProxyServer"),yt.prototype),Rt(yt.prototype,"setTurnServer",[BH],Object.getOwnPropertyDescriptor(yt.prototype,"setTurnServer"),yt.prototype),Rt(yt.prototype,"setLicense",[zH],Object.getOwnPropertyDescriptor(yt.prototype,"setLicense"),yt.prototype),Rt(yt.prototype,"startProxyServer",[WH],Object.getOwnPropertyDescriptor(yt.prototype,"startProxyServer"),yt.prototype),Rt(yt.prototype,"stopProxyServer",[GH],Object.getOwnPropertyDescriptor(yt.prototype,"stopProxyServer"),yt.prototype),Rt(yt.prototype,"setLocalAccessPointsV2",[HH],Object.getOwnPropertyDescriptor(yt.prototype,"setLocalAccessPointsV2"),yt.prototype),Rt(yt.prototype,"setLocalAccessPoints",[$H],Object.getOwnPropertyDescriptor(yt.prototype,"setLocalAccessPoints"),yt.prototype),Rt(yt.prototype,"setRemoteDefaultVideoStreamType",[KH],Object.getOwnPropertyDescriptor(yt.prototype,"setRemoteDefaultVideoStreamType"),yt.prototype),Rt(yt.prototype,"setRemoteVideoStreamType",[qH],Object.getOwnPropertyDescriptor(yt.prototype,"setRemoteVideoStreamType"),yt.prototype),Rt(yt.prototype,"setStreamFallbackOption",[YH],Object.getOwnPropertyDescriptor(yt.prototype,"setStreamFallbackOption"),yt.prototype),Rt(yt.prototype,"setEncryptionConfig",[XH],Object.getOwnPropertyDescriptor(yt.prototype,"setEncryptionConfig"),yt.prototype),Rt(yt.prototype,"renewToken",[JH],Object.getOwnPropertyDescriptor(yt.prototype,"renewToken"),yt.prototype),Rt(yt.prototype,"enableAudioVolumeIndicator",[QH],Object.getOwnPropertyDescriptor(yt.prototype,"enableAudioVolumeIndicator"),yt.prototype),Rt(yt.prototype,"startLiveStreaming",[ZH],Object.getOwnPropertyDescriptor(yt.prototype,"startLiveStreaming"),yt.prototype),Rt(yt.prototype,"setLiveTranscoding",[e$],Object.getOwnPropertyDescriptor(yt.prototype,"setLiveTranscoding"),yt.prototype),Rt(yt.prototype,"stopLiveStreaming",[t$],Object.getOwnPropertyDescriptor(yt.prototype,"stopLiveStreaming"),yt.prototype),Rt(yt.prototype,"startChannelMediaRelay",[n$],Object.getOwnPropertyDescriptor(yt.prototype,"startChannelMediaRelay"),yt.prototype),Rt(yt.prototype,"updateChannelMediaRelay",[r$],Object.getOwnPropertyDescriptor(yt.prototype,"updateChannelMediaRelay"),yt.prototype),Rt(yt.prototype,"stopChannelMediaRelay",[i$],Object.getOwnPropertyDescriptor(yt.prototype,"stopChannelMediaRelay"),yt.prototype),Rt(yt.prototype,"sendCustomReportMessage",[s$],Object.getOwnPropertyDescriptor(yt.prototype,"sendCustomReportMessage"),yt.prototype),Rt(yt.prototype,"pickSVCLayer",[o$],Object.getOwnPropertyDescriptor(yt.prototype,"pickSVCLayer"),yt.prototype),Rt(yt.prototype,"setRTMConfig",[a$],Object.getOwnPropertyDescriptor(yt.prototype,"setRTMConfig"),yt.prototype),Rt(yt.prototype,"enableContentInspect",[c$],Object.getOwnPropertyDescriptor(yt.prototype,"enableContentInspect"),yt.prototype),Rt(yt.prototype,"disableContentInspect",[l$],Object.getOwnPropertyDescriptor(yt.prototype,"disableContentInspect"),yt.prototype),Rt(yt.prototype,"setImageModeration",[u$],Object.getOwnPropertyDescriptor(yt.prototype,"setImageModeration"),yt.prototype),Rt(yt.prototype,"setP2PTransport",[d$],Object.getOwnPropertyDescriptor(yt.prototype,"setP2PTransport"),yt.prototype),Rt(yt.prototype,"getJoinChannelServiceRecords",[h$],Object.getOwnPropertyDescriptor(yt.prototype,"getJoinChannelServiceRecords"),yt.prototype),Rt(yt.prototype,"setPublishAudioFilterEnabled",[p$],Object.getOwnPropertyDescriptor(yt.prototype,"setPublishAudioFilterEnabled"),yt.prototype),yt);class wT{constructor(r,s){X(this,"id",0),X(this,"element",void 0),X(this,"peerPair",void 0),X(this,"context",void 0),X(this,"audioPlayerElement",void 0),X(this,"audioTrack",void 0),wT.count+=1,this.id=wT.count,this.element=r,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const s=document.createElement("audio");s.srcObject=new MediaStream([r.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const r=async(a,c)=>{const d=c==="offer"?await a.createOffer():await a.createAnswer();return await a.setLocalDescription(d),a.iceGatheringState==="complete"?a.localDescription:new mt((h=>{a.onicegatheringstatechange=()=>{a.iceGatheringState==="complete"&&h(a.localDescription)}}))},s=async(a,c)=>await a.setRemoteDescription(c);try{const a=await r(this.peerPair[0],"offer");await s(this.peerPair[1],a);const c=await r(this.peerPair[1],"answer");await s(this.peerPair[0],c)}catch(a){throw new ke(te.LOCAL_AEC_ERROR,a.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let s;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(s)}catch(c){throw new ke(te.LOCAL_AEC_ERROR,c.toString()).print()}if(!s)throw new ke(te.LOCAL_AEC_ERROR,"no dest node when local aec").print();const a=s.stream.getAudioTracks()[0];return this.audioTrack=a,a}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,s=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){M.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((r=>{r.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0}}var m$,fP;X(wT,"count",0);const w_e=window.AudioContext||window.webkitAudioContext,T_e=new(m$=Wt({report:It}),Rt((fP=class{constructor(){X(this,"units",[]),X(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return M.debug("the system does not need to process local aec"),-1;this.context||(this.context=new w_e);let r=this.units.find((s=>s&&s.getElement()===t));return r||(r=new wT(t,this.context),this.units.push(r)),r.startEchoCancellation(),M.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return Ln().name!==qn.SAFARI}}).prototype,"processExternalMediaAEC",[m$],Object.getOwnPropertyDescriptor(fP.prototype,"processExternalMediaAEC"),fP.prototype),fP);function g$(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function _$(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?g$(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):g$(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}const rM=window||document;function y$(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!rM)return;const s=xi._cspEventHandlerPointer;if(s&&r)return void console.error(s,r);const a=c=>{if(!(c&&c.blockedURI&&(xi.onSecurityPolicyViolation||xi.getListeners(ip.SECURITY_POLICY_VIOLATION).length>0)))return;const d=c.blockedURI;oe("CSP_DETECTED_HOSTNAME_LIST").some((h=>rt(d).call(d,h)))&&(xi.onSecurityPolicyViolation&&typeof xi.onSecurityPolicyViolation=="function"&&xi.onSecurityPolicyViolation(c),xi.getListeners(ip.SECURITY_POLICY_VIOLATION).length>0&&xi.safeEmit(ip.SECURITY_POLICY_VIOLATION,c))};s&&rM.removeEventListener("securitypolicyviolation",s),(r||t&&typeof t=="function"||xi.getListeners(ip.SECURITY_POLICY_VIOLATION).length>0)&&rM.addEventListener("securitypolicyviolation",a),xi._cspEventHandlerPointer=a}var C_e=O,R_e=Z8,E$=RegExp.prototype,I_e=function(t){return t===E$||C_e(E$,t)?R_e(t):t.flags},zo=l(I_e);function _0(t){let r=t.length;for(;--r>=0;)t[r]=0}const iM=256,v$=286,TT=30,CT=15,sM=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),mP=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),A_e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),S$=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Sf=new Array(576);_0(Sf);const RT=new Array(60);_0(RT);const IT=new Array(512);_0(IT);const AT=new Array(256);_0(AT);const oM=new Array(29);_0(oM);const gP=new Array(TT);function aM(t,r,s,a,c){this.static_tree=t,this.extra_bits=r,this.extra_base=s,this.elems=a,this.max_length=c,this.has_stree=t&&t.length}let b$,w$,T$;function cM(t,r){this.dyn_tree=t,this.max_code=0,this.stat_desc=r}_0(gP);const C$=t=>t<256?IT[t]:IT[256+(t>>>7)],PT=(t,r)=>{t.pending_buf[t.pending++]=255&r,t.pending_buf[t.pending++]=r>>>8&255},fl=(t,r,s)=>{t.bi_valid>16-s?(t.bi_buf|=r<<t.bi_valid&65535,PT(t,t.bi_buf),t.bi_buf=r>>16-t.bi_valid,t.bi_valid+=s-16):(t.bi_buf|=r<<t.bi_valid&65535,t.bi_valid+=s)},ap=(t,r,s)=>{fl(t,s[2*r],s[2*r+1])},R$=(t,r)=>{let s=0;do s|=1&t,t>>>=1,s<<=1;while(--r>0);return s>>>1},I$=(t,r,s)=>{const a=new Array(16);let c,d,h=0;for(c=1;c<=CT;c++)h=h+s[c-1]<<1,a[c]=h;for(d=0;d<=r;d++){let m=t[2*d+1];m!==0&&(t[2*d]=R$(a[m]++,m))}},A$=t=>{let r;for(r=0;r<v$;r++)t.dyn_ltree[2*r]=0;for(r=0;r<TT;r++)t.dyn_dtree[2*r]=0;for(r=0;r<19;r++)t.bl_tree[2*r]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},P$=t=>{t.bi_valid>8?PT(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},O$=(t,r,s,a)=>{const c=2*r,d=2*s;return t[c]<t[d]||t[c]===t[d]&&a[r]<=a[s]},lM=(t,r,s)=>{const a=t.heap[s];let c=s<<1;for(;c<=t.heap_len&&(c<t.heap_len&&O$(r,t.heap[c+1],t.heap[c],t.depth)&&c++,!O$(r,a,t.heap[c],t.depth));)t.heap[s]=t.heap[c],s=c,c<<=1;t.heap[s]=a},k$=(t,r,s)=>{let a,c,d,h,m=0;if(t.sym_next!==0)do a=255&t.pending_buf[t.sym_buf+m++],a+=(255&t.pending_buf[t.sym_buf+m++])<<8,c=t.pending_buf[t.sym_buf+m++],a===0?ap(t,c,r):(d=AT[c],ap(t,d+iM+1,r),h=sM[d],h!==0&&(c-=oM[d],fl(t,c,h)),a--,d=C$(a),ap(t,d,s),h=mP[d],h!==0&&(a-=gP[d],fl(t,a,h)));while(m<t.sym_next);ap(t,256,r)},uM=(t,r)=>{const s=r.dyn_tree,a=r.stat_desc.static_tree,c=r.stat_desc.has_stree,d=r.stat_desc.elems;let h,m,g,E=-1;for(t.heap_len=0,t.heap_max=573,h=0;h<d;h++)s[2*h]!==0?(t.heap[++t.heap_len]=E=h,t.depth[h]=0):s[2*h+1]=0;for(;t.heap_len<2;)g=t.heap[++t.heap_len]=E<2?++E:0,s[2*g]=1,t.depth[g]=0,t.opt_len--,c&&(t.static_len-=a[2*g+1]);for(r.max_code=E,h=t.heap_len>>1;h>=1;h--)lM(t,s,h);g=d;do h=t.heap[1],t.heap[1]=t.heap[t.heap_len--],lM(t,s,1),m=t.heap[1],t.heap[--t.heap_max]=h,t.heap[--t.heap_max]=m,s[2*g]=s[2*h]+s[2*m],t.depth[g]=(t.depth[h]>=t.depth[m]?t.depth[h]:t.depth[m])+1,s[2*h+1]=s[2*m+1]=g,t.heap[1]=g++,lM(t,s,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((w,I)=>{const A=I.dyn_tree,N=I.max_code,G=I.stat_desc.static_tree,F=I.stat_desc.has_stree,z=I.stat_desc.extra_bits,ee=I.stat_desc.extra_base,Z=I.stat_desc.max_length;let ae,ye,_e,ue,Ae,Ue,We=0;for(ue=0;ue<=CT;ue++)w.bl_count[ue]=0;for(A[2*w.heap[w.heap_max]+1]=0,ae=w.heap_max+1;ae<573;ae++)ye=w.heap[ae],ue=A[2*A[2*ye+1]+1]+1,ue>Z&&(ue=Z,We++),A[2*ye+1]=ue,ye>N||(w.bl_count[ue]++,Ae=0,ye>=ee&&(Ae=z[ye-ee]),Ue=A[2*ye],w.opt_len+=Ue*(ue+Ae),F&&(w.static_len+=Ue*(G[2*ye+1]+Ae)));if(We!==0){do{for(ue=Z-1;w.bl_count[ue]===0;)ue--;w.bl_count[ue]--,w.bl_count[ue+1]+=2,w.bl_count[Z]--,We-=2}while(We>0);for(ue=Z;ue!==0;ue--)for(ye=w.bl_count[ue];ye!==0;)_e=w.heap[--ae],_e>N||(A[2*_e+1]!==ue&&(w.opt_len+=(ue-A[2*_e+1])*A[2*_e],A[2*_e+1]=ue),ye--)}})(t,r),I$(s,E,t.bl_count)},N$=(t,r,s)=>{let a,c,d=-1,h=r[1],m=0,g=7,E=4;for(h===0&&(g=138,E=3),r[2*(s+1)+1]=65535,a=0;a<=s;a++)c=h,h=r[2*(a+1)+1],++m<g&&c===h||(m<E?t.bl_tree[2*c]+=m:c!==0?(c!==d&&t.bl_tree[2*c]++,t.bl_tree[32]++):m<=10?t.bl_tree[34]++:t.bl_tree[36]++,m=0,d=c,h===0?(g=138,E=3):c===h?(g=6,E=3):(g=7,E=4))},x$=(t,r,s)=>{let a,c,d=-1,h=r[1],m=0,g=7,E=4;for(h===0&&(g=138,E=3),a=0;a<=s;a++)if(c=h,h=r[2*(a+1)+1],!(++m<g&&c===h)){if(m<E)do ap(t,c,t.bl_tree);while(--m!=0);else c!==0?(c!==d&&(ap(t,c,t.bl_tree),m--),ap(t,16,t.bl_tree),fl(t,m-3,2)):m<=10?(ap(t,17,t.bl_tree),fl(t,m-3,3)):(ap(t,18,t.bl_tree),fl(t,m-11,7));m=0,d=c,h===0?(g=138,E=3):c===h?(g=6,E=3):(g=7,E=4)}};let D$=!1;const L$=(t,r,s,a)=>{fl(t,0+(a?1:0),3),P$(t),PT(t,s),PT(t,~s),s&&t.pending_buf.set(t.window.subarray(r,r+s),t.pending),t.pending+=s};var P_e=t=>{D$||((()=>{let r,s,a,c,d;const h=new Array(16);for(a=0,c=0;c<28;c++)for(oM[c]=a,r=0;r<1<<sM[c];r++)AT[a++]=c;for(AT[a-1]=c,d=0,c=0;c<16;c++)for(gP[c]=d,r=0;r<1<<mP[c];r++)IT[d++]=c;for(d>>=7;c<TT;c++)for(gP[c]=d<<7,r=0;r<1<<mP[c]-7;r++)IT[256+d++]=c;for(s=0;s<=CT;s++)h[s]=0;for(r=0;r<=143;)Sf[2*r+1]=8,r++,h[8]++;for(;r<=255;)Sf[2*r+1]=9,r++,h[9]++;for(;r<=279;)Sf[2*r+1]=7,r++,h[7]++;for(;r<=287;)Sf[2*r+1]=8,r++,h[8]++;for(I$(Sf,287,h),r=0;r<TT;r++)RT[2*r+1]=5,RT[2*r]=R$(r,5);b$=new aM(Sf,sM,257,v$,CT),w$=new aM(RT,mP,0,TT,CT),T$=new aM(new Array(0),A_e,0,19,7)})(),D$=!0),t.l_desc=new cM(t.dyn_ltree,b$),t.d_desc=new cM(t.dyn_dtree,w$),t.bl_desc=new cM(t.bl_tree,T$),t.bi_buf=0,t.bi_valid=0,A$(t)},O_e=(t,r,s,a)=>{let c,d,h=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(m=>{let g,E=4093624447;for(g=0;g<=31;g++,E>>>=1)if(1&E&&m.dyn_ltree[2*g]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(g=32;g<iM;g++)if(m.dyn_ltree[2*g]!==0)return 1;return 0})(t)),uM(t,t.l_desc),uM(t,t.d_desc),h=(m=>{let g;for(N$(m,m.dyn_ltree,m.l_desc.max_code),N$(m,m.dyn_dtree,m.d_desc.max_code),uM(m,m.bl_desc),g=18;g>=3&&m.bl_tree[2*S$[g]+1]===0;g--);return m.opt_len+=3*(g+1)+5+5+4,g})(t),c=t.opt_len+3+7>>>3,d=t.static_len+3+7>>>3,d<=c&&(c=d)):c=d=s+5,s+4<=c&&r!==-1?L$(t,r,s,a):t.strategy===4||d===c?(fl(t,2+(a?1:0),3),k$(t,Sf,RT)):(fl(t,4+(a?1:0),3),((m,g,E,w)=>{let I;for(fl(m,g-257,5),fl(m,E-1,5),fl(m,w-4,4),I=0;I<w;I++)fl(m,m.bl_tree[2*S$[I]+1],3);x$(m,m.dyn_ltree,g-1),x$(m,m.dyn_dtree,E-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),k$(t,t.dyn_ltree,t.dyn_dtree)),A$(t),a&&P$(t)},k_e=(t,r,s)=>(t.pending_buf[t.sym_buf+t.sym_next++]=r,t.pending_buf[t.sym_buf+t.sym_next++]=r>>8,t.pending_buf[t.sym_buf+t.sym_next++]=s,r===0?t.dyn_ltree[2*s]++:(t.matches++,r--,t.dyn_ltree[2*(AT[s]+iM+1)]++,t.dyn_dtree[2*C$(r)]++),t.sym_next===t.sym_end),N_e=t=>{fl(t,2,3),ap(t,256,Sf),(r=>{r.bi_valid===16?(PT(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(t)},x_e={_tr_init:P_e,_tr_stored_block:L$,_tr_flush_block:O_e,_tr_tally:k_e,_tr_align:N_e},OT=(t,r,s,a)=>{let c=65535&t|0,d=t>>>16&65535|0,h=0;for(;s!==0;){h=s>2e3?2e3:s,s-=h;do c=c+r[a++]|0,d=d+c|0;while(--h);c%=65521,d%=65521}return c|d<<16|0};const D_e=new Uint32Array((()=>{let t,r=[];for(var s=0;s<256;s++){t=s;for(var a=0;a<8;a++)t=1&t?3988292384^t>>>1:t>>>1;r[s]=t}return r})());var fa=(t,r,s,a)=>{const c=D_e,d=a+s;t^=-1;for(let h=a;h<d;h++)t=t>>>8^c[255&(t^r[h])];return-1^t},py={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},_P={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:L_e,_tr_stored_block:dM,_tr_flush_block:M_e,_tr_tally:ag,_tr_align:U_e}=x_e,{Z_NO_FLUSH:cg,Z_PARTIAL_FLUSH:V_e,Z_FULL_FLUSH:j_e,Z_FINISH:Ju,Z_BLOCK:M$,Z_OK:La,Z_STREAM_END:U$,Z_STREAM_ERROR:cp,Z_DATA_ERROR:F_e,Z_BUF_ERROR:hM,Z_DEFAULT_COMPRESSION:B_e,Z_FILTERED:z_e,Z_HUFFMAN_ONLY:yP,Z_RLE:W_e,Z_FIXED:G_e,Z_DEFAULT_STRATEGY:H_e,Z_UNKNOWN:$_e,Z_DEFLATED:EP}=_P,pM=286,K_e=30,q_e=19,Y_e=2*pM+1,X_e=15,fy=258,lp=262,y0=42,my=113,kT=666,gy=(t,r)=>(t.msg=py[r],r),V$=t=>2*t-(t>4?9:0),lg=t=>{let r=t.length;for(;--r>=0;)t[r]=0},J_e=t=>{let r,s,a,c=t.w_size;r=t.hash_size,a=r;do s=t.head[--a],t.head[a]=s>=c?s-c:0;while(--r);r=c,a=r;do s=t.prev[--a],t.prev[a]=s>=c?s-c:0;while(--r)};let ug=(t,r,s)=>(r<<t.hash_shift^s)&t.hash_mask;const ru=t=>{const r=t.state;let s=r.pending;s>t.avail_out&&(s=t.avail_out),s!==0&&(t.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+s),t.next_out),t.next_out+=s,r.pending_out+=s,t.total_out+=s,t.avail_out-=s,r.pending-=s,r.pending===0&&(r.pending_out=0))},iu=(t,r)=>{M_e(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,r),t.block_start=t.strstart,ru(t.strm)},hi=(t,r)=>{t.pending_buf[t.pending++]=r},NT=(t,r)=>{t.pending_buf[t.pending++]=r>>>8&255,t.pending_buf[t.pending++]=255&r},fM=(t,r,s,a)=>{let c=t.avail_in;return c>a&&(c=a),c===0?0:(t.avail_in-=c,r.set(t.input.subarray(t.next_in,t.next_in+c),s),t.state.wrap===1?t.adler=OT(t.adler,r,c,s):t.state.wrap===2&&(t.adler=fa(t.adler,r,c,s)),t.next_in+=c,t.total_in+=c,c)},j$=(t,r)=>{let s,a,c=t.max_chain_length,d=t.strstart,h=t.prev_length,m=t.nice_match;const g=t.strstart>t.w_size-lp?t.strstart-(t.w_size-lp):0,E=t.window,w=t.w_mask,I=t.prev,A=t.strstart+fy;let N=E[d+h-1],G=E[d+h];t.prev_length>=t.good_match&&(c>>=2),m>t.lookahead&&(m=t.lookahead);do if(s=r,E[s+h]===G&&E[s+h-1]===N&&E[s]===E[d]&&E[++s]===E[d+1]){d+=2,s++;do;while(E[++d]===E[++s]&&E[++d]===E[++s]&&E[++d]===E[++s]&&E[++d]===E[++s]&&E[++d]===E[++s]&&E[++d]===E[++s]&&E[++d]===E[++s]&&E[++d]===E[++s]&&d<A);if(a=fy-(A-d),d=A-fy,a>h){if(t.match_start=r,h=a,a>=m)break;N=E[d+h-1],G=E[d+h]}}while((r=I[r&w])>g&&--c!=0);return h<=t.lookahead?h:t.lookahead},E0=t=>{const r=t.w_size;let s,a,c;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=r+(r-lp)&&(t.window.set(t.window.subarray(r,r+r-a),0),t.match_start-=r,t.strstart-=r,t.block_start-=r,t.insert>t.strstart&&(t.insert=t.strstart),J_e(t),a+=r),t.strm.avail_in===0)break;if(s=fM(t.strm,t.window,t.strstart+t.lookahead,a),t.lookahead+=s,t.lookahead+t.insert>=3)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=ug(t,t.ins_h,t.window[c+1]);t.insert&&(t.ins_h=ug(t,t.ins_h,t.window[c+3-1]),t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<lp&&t.strm.avail_in!==0)},F$=(t,r)=>{let s,a,c,d=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,h=0,m=t.strm.avail_in;do{if(s=65535,c=t.bi_valid+42>>3,t.strm.avail_out<c||(c=t.strm.avail_out-c,a=t.strstart-t.block_start,s>a+t.strm.avail_in&&(s=a+t.strm.avail_in),s>c&&(s=c),s<d&&(s===0&&r!==Ju||r===cg||s!==a+t.strm.avail_in)))break;h=r===Ju&&s===a+t.strm.avail_in?1:0,dM(t,0,0,h),t.pending_buf[t.pending-4]=s,t.pending_buf[t.pending-3]=s>>8,t.pending_buf[t.pending-2]=~s,t.pending_buf[t.pending-1]=~s>>8,ru(t.strm),a&&(a>s&&(a=s),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+a),t.strm.next_out),t.strm.next_out+=a,t.strm.avail_out-=a,t.strm.total_out+=a,t.block_start+=a,s-=a),s&&(fM(t.strm,t.strm.output,t.strm.next_out,s),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s)}while(h===0);return m-=t.strm.avail_in,m&&(m>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=m&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-m,t.strm.next_in),t.strstart),t.strstart+=m,t.insert+=m>t.w_size-t.insert?t.w_size-t.insert:m),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),h?4:r!==cg&&r!==Ju&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(c=t.window_size-t.strstart,t.strm.avail_in>c&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,c+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),c>t.strm.avail_in&&(c=t.strm.avail_in),c&&(fM(t.strm,t.window,t.strstart,c),t.strstart+=c,t.insert+=c>t.w_size-t.insert?t.w_size-t.insert:c),t.high_water<t.strstart&&(t.high_water=t.strstart),c=t.bi_valid+42>>3,c=t.pending_buf_size-c>65535?65535:t.pending_buf_size-c,d=c>t.w_size?t.w_size:c,a=t.strstart-t.block_start,(a>=d||(a||r===Ju)&&r!==cg&&t.strm.avail_in===0&&a<=c)&&(s=a>c?c:a,h=r===Ju&&t.strm.avail_in===0&&s===a?1:0,dM(t,t.block_start,s,h),t.block_start+=s,ru(t.strm)),h?3:1)},mM=(t,r)=>{let s,a;for(;;){if(t.lookahead<lp){if(E0(t),t.lookahead<lp&&r===cg)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=ug(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),s!==0&&t.strstart-s<=t.w_size-lp&&(t.match_length=j$(t,s)),t.match_length>=3)if(a=ag(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=ug(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=ug(t,t.ins_h,t.window[t.strstart+1]);else a=ag(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(a&&(iu(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,r===Ju?(iu(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(iu(t,!1),t.strm.avail_out===0)?1:2},v0=(t,r)=>{let s,a,c;for(;;){if(t.lookahead<lp){if(E0(t),t.lookahead<lp&&r===cg)return 1;if(t.lookahead===0)break}if(s=0,t.lookahead>=3&&(t.ins_h=ug(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,s!==0&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-lp&&(t.match_length=j$(t,s),t.match_length<=5&&(t.strategy===z_e||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){c=t.strstart+t.lookahead-3,a=ag(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=c&&(t.ins_h=ug(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,a&&(iu(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(a=ag(t,0,t.window[t.strstart-1]),a&&iu(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(a=ag(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,r===Ju?(iu(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(iu(t,!1),t.strm.avail_out===0)?1:2};function up(t,r,s,a,c){this.good_length=t,this.max_lazy=r,this.nice_length=s,this.max_chain=a,this.func=c}const xT=[new up(0,0,0,0,F$),new up(4,4,8,4,mM),new up(4,5,16,8,mM),new up(4,6,32,32,mM),new up(4,4,16,16,v0),new up(8,16,32,32,v0),new up(8,16,128,128,v0),new up(8,32,128,256,v0),new up(32,128,258,1024,v0),new up(32,258,258,4096,v0)];function Q_e(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=EP,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Y_e),this.dyn_dtree=new Uint16Array(2*(2*K_e+1)),this.bl_tree=new Uint16Array(2*(2*q_e+1)),lg(this.dyn_ltree),lg(this.dyn_dtree),lg(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(X_e+1),this.heap=new Uint16Array(2*pM+1),lg(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*pM+1),lg(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const DT=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.status!==y0&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==my&&r.status!==kT?1:0},B$=t=>{if(DT(t))return gy(t,cp);t.total_in=t.total_out=0,t.data_type=$_e;const r=t.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?y0:my,t.adler=r.wrap===2?0:1,r.last_flush=-2,L_e(r),La},z$=t=>{const r=B$(t);return r===La&&(s=>{s.window_size=2*s.w_size,lg(s.head),s.max_lazy_match=xT[s.level].max_lazy,s.good_match=xT[s.level].good_length,s.nice_match=xT[s.level].nice_length,s.max_chain_length=xT[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(t.state),r},W$=(t,r,s,a,c,d)=>{if(!t)return cp;let h=1;if(r===B_e&&(r=6),a<0?(h=0,a=-a):a>15&&(h=2,a-=16),c<1||c>9||s!==EP||a<8||a>15||r<0||r>9||d<0||d>G_e||a===8&&h!==1)return gy(t,cp);a===8&&(a=9);const m=new Q_e;return t.state=m,m.strm=t,m.status=y0,m.wrap=h,m.gzhead=null,m.w_bits=a,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=d,m.method=s,z$(t)};var Z_e=(t,r)=>{if(DT(t)||r>M$||r<0)return t?gy(t,cp):cp;const s=t.state;if(!t.output||t.avail_in!==0&&!t.input||s.status===kT&&r!==Ju)return gy(t,t.avail_out===0?hM:cp);const a=s.last_flush;if(s.last_flush=r,s.pending!==0){if(ru(t),t.avail_out===0)return s.last_flush=-1,La}else if(t.avail_in===0&&V$(r)<=V$(a)&&r!==Ju)return gy(t,hM);if(s.status===kT&&t.avail_in!==0)return gy(t,hM);if(s.status===y0&&s.wrap===0&&(s.status=my),s.status===y0){let c=EP+(s.w_bits-8<<4)<<8,d=-1;if(d=s.strategy>=yP||s.level<2?0:s.level<6?1:s.level===6?2:3,c|=d<<6,s.strstart!==0&&(c|=32),c+=31-c%31,NT(s,c),s.strstart!==0&&(NT(s,t.adler>>>16),NT(s,65535&t.adler)),t.adler=1,s.status=my,ru(t),s.pending!==0)return s.last_flush=-1,La}if(s.status===57){if(t.adler=0,hi(s,31),hi(s,139),hi(s,8),s.gzhead)hi(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),hi(s,255&s.gzhead.time),hi(s,s.gzhead.time>>8&255),hi(s,s.gzhead.time>>16&255),hi(s,s.gzhead.time>>24&255),hi(s,s.level===9?2:s.strategy>=yP||s.level<2?4:0),hi(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(hi(s,255&s.gzhead.extra.length),hi(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=fa(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(hi(s,0),hi(s,0),hi(s,0),hi(s,0),hi(s,0),hi(s,s.level===9?2:s.strategy>=yP||s.level<2?4:0),hi(s,3),s.status=my,ru(t),s.pending!==0)return s.last_flush=-1,La}if(s.status===69){if(s.gzhead.extra){let c=s.pending,d=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+d>s.pending_buf_size;){let m=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+m),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>c&&(t.adler=fa(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex+=m,ru(t),s.pending!==0)return s.last_flush=-1,La;c=0,d-=m}let h=new Uint8Array(s.gzhead.extra);s.pending_buf.set(h.subarray(s.gzindex,s.gzindex+d),s.pending),s.pending+=d,s.gzhead.hcrc&&s.pending>c&&(t.adler=fa(t.adler,s.pending_buf,s.pending-c,c)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let c,d=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>d&&(t.adler=fa(t.adler,s.pending_buf,s.pending-d,d)),ru(t),s.pending!==0)return s.last_flush=-1,La;d=0}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,hi(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>d&&(t.adler=fa(t.adler,s.pending_buf,s.pending-d,d)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let c,d=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>d&&(t.adler=fa(t.adler,s.pending_buf,s.pending-d,d)),ru(t),s.pending!==0)return s.last_flush=-1,La;d=0}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,hi(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>d&&(t.adler=fa(t.adler,s.pending_buf,s.pending-d,d))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(ru(t),s.pending!==0))return s.last_flush=-1,La;hi(s,255&t.adler),hi(s,t.adler>>8&255),t.adler=0}if(s.status=my,ru(t),s.pending!==0)return s.last_flush=-1,La}if(t.avail_in!==0||s.lookahead!==0||r!==cg&&s.status!==kT){let c=s.level===0?F$(s,r):s.strategy===yP?((d,h)=>{let m;for(;;){if(d.lookahead===0&&(E0(d),d.lookahead===0)){if(h===cg)return 1;break}if(d.match_length=0,m=ag(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,m&&(iu(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===Ju?(iu(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(iu(d,!1),d.strm.avail_out===0)?1:2})(s,r):s.strategy===W_e?((d,h)=>{let m,g,E,w;const I=d.window;for(;;){if(d.lookahead<=fy){if(E0(d),d.lookahead<=fy&&h===cg)return 1;if(d.lookahead===0)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(E=d.strstart-1,g=I[E],g===I[++E]&&g===I[++E]&&g===I[++E])){w=d.strstart+fy;do;while(g===I[++E]&&g===I[++E]&&g===I[++E]&&g===I[++E]&&g===I[++E]&&g===I[++E]&&g===I[++E]&&g===I[++E]&&E<w);d.match_length=fy-(w-E),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(m=ag(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(m=ag(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),m&&(iu(d,!1),d.strm.avail_out===0))return 1}return d.insert=0,h===Ju?(iu(d,!0),d.strm.avail_out===0?3:4):d.sym_next&&(iu(d,!1),d.strm.avail_out===0)?1:2})(s,r):xT[s.level].func(s,r);if(c!==3&&c!==4||(s.status=kT),c===1||c===3)return t.avail_out===0&&(s.last_flush=-1),La;if(c===2&&(r===V_e?U_e(s):r!==M$&&(dM(s,0,0,!1),r===j_e&&(lg(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),ru(t),t.avail_out===0))return s.last_flush=-1,La}return r!==Ju?La:s.wrap<=0?U$:(s.wrap===2?(hi(s,255&t.adler),hi(s,t.adler>>8&255),hi(s,t.adler>>16&255),hi(s,t.adler>>24&255),hi(s,255&t.total_in),hi(s,t.total_in>>8&255),hi(s,t.total_in>>16&255),hi(s,t.total_in>>24&255)):(NT(s,t.adler>>>16),NT(s,65535&t.adler)),ru(t),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?La:U$)},eye=(t,r)=>{let s=r.length;if(DT(t))return cp;const a=t.state,c=a.wrap;if(c===2||c===1&&a.status!==y0||a.lookahead)return cp;if(c===1&&(t.adler=OT(t.adler,r,s,0)),a.wrap=0,s>=a.w_size){c===0&&(lg(a.head),a.strstart=0,a.block_start=0,a.insert=0);let g=new Uint8Array(a.w_size);g.set(r.subarray(s-a.w_size,s),0),r=g,s=a.w_size}const d=t.avail_in,h=t.next_in,m=t.input;for(t.avail_in=s,t.next_in=0,t.input=r,E0(a);a.lookahead>=3;){let g=a.strstart,E=a.lookahead-2;do a.ins_h=ug(a,a.ins_h,a.window[g+3-1]),a.prev[g&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=g,g++;while(--E);a.strstart=g,a.lookahead=2,E0(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,t.next_in=h,t.input=m,t.avail_in=d,a.wrap=c,La},LT={deflateInit:(t,r)=>W$(t,r,EP,15,8,H_e),deflateInit2:W$,deflateReset:z$,deflateResetKeep:B$,deflateSetHeader:(t,r)=>DT(t)||t.state.wrap!==2?cp:(t.state.gzhead=r,La),deflate:Z_e,deflateEnd:t=>{if(DT(t))return cp;const r=t.state.status;return t.state=null,r===my?gy(t,F_e):La},deflateSetDictionary:eye,deflateInfo:"pako deflate (from Nodeca project)"};const tye=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var vP={assign:function(t){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const s=r.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(const a in s)tye(s,a)&&(t[a]=s[a])}}return t},flattenChunks:t=>{let r=0;for(let a=0,c=t.length;a<c;a++)r+=t[a].length;const s=new Uint8Array(r);for(let a=0,c=0,d=t.length;a<d;a++){let h=t[a];s.set(h,c),c+=h.length}return s}};let G$=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{G$=!1}const MT=new Uint8Array(256);for(let t=0;t<256;t++)MT[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;MT[254]=MT[254]=1;var UT={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let r,s,a,c,d,h=t.length,m=0;for(c=0;c<h;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(a=t.charCodeAt(c+1),(64512&a)==56320&&(s=65536+(s-55296<<10)+(a-56320),c++)),m+=s<128?1:s<2048?2:s<65536?3:4;for(r=new Uint8Array(m),d=0,c=0;d<m;c++)s=t.charCodeAt(c),(64512&s)==55296&&c+1<h&&(a=t.charCodeAt(c+1),(64512&a)==56320&&(s=65536+(s-55296<<10)+(a-56320),c++)),s<128?r[d++]=s:s<2048?(r[d++]=192|s>>>6,r[d++]=128|63&s):s<65536?(r[d++]=224|s>>>12,r[d++]=128|s>>>6&63,r[d++]=128|63&s):(r[d++]=240|s>>>18,r[d++]=128|s>>>12&63,r[d++]=128|s>>>6&63,r[d++]=128|63&s);return r},buf2string:(t,r)=>{const s=r||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,r));let a,c;const d=new Array(2*s);for(c=0,a=0;a<s;){let h=t[a++];if(h<128){d[c++]=h;continue}let m=MT[h];if(m>4)d[c++]=65533,a+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&a<s;)h=h<<6|63&t[a++],m--;m>1?d[c++]=65533:h<65536?d[c++]=h:(h-=65536,d[c++]=55296|h>>10&1023,d[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&G$)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let g="";for(let E=0;E<m;E++)g+=String.fromCharCode(h[E]);return g})(d,c)},utf8border:(t,r)=>{(r=r||t.length)>t.length&&(r=t.length);let s=r-1;for(;s>=0&&(192&t[s])==128;)s--;return s<0||s===0?r:s+MT[t[s]]>r?s:r}},H$=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const $$=Object.prototype.toString,{Z_NO_FLUSH:nye,Z_SYNC_FLUSH:rye,Z_FULL_FLUSH:iye,Z_FINISH:sye,Z_OK:SP,Z_STREAM_END:oye,Z_DEFAULT_COMPRESSION:aye,Z_DEFAULT_STRATEGY:cye,Z_DEFLATED:lye}=_P;function bP(t){this.options=vP.assign({level:aye,method:lye,chunkSize:16384,windowBits:15,memLevel:8,strategy:cye},t||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new H$,this.strm.avail_out=0;let s=LT.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(s!==SP)throw new Error(py[s]);if(r.header&&LT.deflateSetHeader(this.strm,r.header),r.dictionary){let a;if(a=typeof r.dictionary=="string"?UT.string2buf(r.dictionary):$$.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,s=LT.deflateSetDictionary(this.strm,a),s!==SP)throw new Error(py[s]);this._dict_set=!0}}function uye(t,r){const s=new bP(r);if(s.push(t,!0),s.err)throw s.msg||py[s.err];return s.result}bP.prototype.push=function(t,r){const s=this.strm,a=this.options.chunkSize;let c,d;if(this.ended)return!1;for(d=r===~~r?r:r===!0?sye:nye,typeof t=="string"?s.input=UT.string2buf(t):$$.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),(d===rye||d===iye)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(c=LT.deflate(s,d),c===oye)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),c=LT.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===SP;if(s.avail_out!==0){if(d>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},bP.prototype.onData=function(t){this.chunks.push(t)},bP.prototype.onEnd=function(t){t===SP&&(this.result=vP.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var dye={deflate:uye};const wP=16209;var hye=function(t,r){let s,a,c,d,h,m,g,E,w,I,A,N,G,F,z,ee,Z,ae,ye,_e,ue,Ae,Ue,We;const Ze=t.state;s=t.next_in,Ue=t.input,a=s+(t.avail_in-5),c=t.next_out,We=t.output,d=c-(r-t.avail_out),h=c+(t.avail_out-257),m=Ze.dmax,g=Ze.wsize,E=Ze.whave,w=Ze.wnext,I=Ze.window,A=Ze.hold,N=Ze.bits,G=Ze.lencode,F=Ze.distcode,z=(1<<Ze.lenbits)-1,ee=(1<<Ze.distbits)-1;e:do{N<15&&(A+=Ue[s++]<<N,N+=8,A+=Ue[s++]<<N,N+=8),Z=G[A&z];t:for(;;){if(ae=Z>>>24,A>>>=ae,N-=ae,ae=Z>>>16&255,ae===0)We[c++]=65535&Z;else{if(!(16&ae)){if((64&ae)==0){Z=G[(65535&Z)+(A&(1<<ae)-1)];continue t}if(32&ae){Ze.mode=16191;break e}t.msg="invalid literal/length code",Ze.mode=wP;break e}ye=65535&Z,ae&=15,ae&&(N<ae&&(A+=Ue[s++]<<N,N+=8),ye+=A&(1<<ae)-1,A>>>=ae,N-=ae),N<15&&(A+=Ue[s++]<<N,N+=8,A+=Ue[s++]<<N,N+=8),Z=F[A&ee];n:for(;;){if(ae=Z>>>24,A>>>=ae,N-=ae,ae=Z>>>16&255,!(16&ae)){if((64&ae)==0){Z=F[(65535&Z)+(A&(1<<ae)-1)];continue n}t.msg="invalid distance code",Ze.mode=wP;break e}if(_e=65535&Z,ae&=15,N<ae&&(A+=Ue[s++]<<N,N+=8,N<ae&&(A+=Ue[s++]<<N,N+=8)),_e+=A&(1<<ae)-1,_e>m){t.msg="invalid distance too far back",Ze.mode=wP;break e}if(A>>>=ae,N-=ae,ae=c-d,_e>ae){if(ae=_e-ae,ae>E&&Ze.sane){t.msg="invalid distance too far back",Ze.mode=wP;break e}if(ue=0,Ae=I,w===0){if(ue+=g-ae,ae<ye){ye-=ae;do We[c++]=I[ue++];while(--ae);ue=c-_e,Ae=We}}else if(w<ae){if(ue+=g+w-ae,ae-=w,ae<ye){ye-=ae;do We[c++]=I[ue++];while(--ae);if(ue=0,w<ye){ae=w,ye-=ae;do We[c++]=I[ue++];while(--ae);ue=c-_e,Ae=We}}}else if(ue+=w-ae,ae<ye){ye-=ae;do We[c++]=I[ue++];while(--ae);ue=c-_e,Ae=We}for(;ye>2;)We[c++]=Ae[ue++],We[c++]=Ae[ue++],We[c++]=Ae[ue++],ye-=3;ye&&(We[c++]=Ae[ue++],ye>1&&(We[c++]=Ae[ue++]))}else{ue=c-_e;do We[c++]=We[ue++],We[c++]=We[ue++],We[c++]=We[ue++],ye-=3;while(ye>2);ye&&(We[c++]=We[ue++],ye>1&&(We[c++]=We[ue++]))}break}}break}}while(s<a&&c<h);ye=N>>3,s-=ye,N-=ye<<3,A&=(1<<N)-1,t.next_in=s,t.next_out=c,t.avail_in=s<a?a-s+5:5-(s-a),t.avail_out=c<h?h-c+257:257-(c-h),Ze.hold=A,Ze.bits=N};const TP=15,pye=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),fye=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),mye=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),gye=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var VT=(t,r,s,a,c,d,h,m)=>{const g=m.bits;let E,w,I,A,N,G,F=0,z=0,ee=0,Z=0,ae=0,ye=0,_e=0,ue=0,Ae=0,Ue=0,We=null;const Ze=new Uint16Array(16),_n=new Uint16Array(16);let Sn,Qt,rr,Jn=null;for(F=0;F<=TP;F++)Ze[F]=0;for(z=0;z<a;z++)Ze[r[s+z]]++;for(ae=g,Z=TP;Z>=1&&Ze[Z]===0;Z--);if(ae>Z&&(ae=Z),Z===0)return c[d++]=20971520,c[d++]=20971520,m.bits=1,0;for(ee=1;ee<Z&&Ze[ee]===0;ee++);for(ae<ee&&(ae=ee),ue=1,F=1;F<=TP;F++)if(ue<<=1,ue-=Ze[F],ue<0)return-1;if(ue>0&&(t===0||Z!==1))return-1;for(_n[1]=0,F=1;F<TP;F++)_n[F+1]=_n[F]+Ze[F];for(z=0;z<a;z++)r[s+z]!==0&&(h[_n[r[s+z]]++]=z);if(t===0?(We=Jn=h,G=20):t===1?(We=pye,Jn=fye,G=257):(We=mye,Jn=gye,G=0),Ue=0,z=0,F=ee,N=d,ye=ae,_e=0,I=-1,Ae=1<<ae,A=Ae-1,t===1&&Ae>852||t===2&&Ae>592)return 1;for(;;){Sn=F-_e,h[z]+1<G?(Qt=0,rr=h[z]):h[z]>=G?(Qt=Jn[h[z]-G],rr=We[h[z]-G]):(Qt=96,rr=0),E=1<<F-_e,w=1<<ye,ee=w;do w-=E,c[N+(Ue>>_e)+w]=Sn<<24|Qt<<16|rr|0;while(w!==0);for(E=1<<F-1;Ue&E;)E>>=1;if(E!==0?(Ue&=E-1,Ue+=E):Ue=0,z++,--Ze[F]==0){if(F===Z)break;F=r[s+h[z]]}if(F>ae&&(Ue&A)!==I){for(_e===0&&(_e=ae),N+=ee,ye=F-_e,ue=1<<ye;ye+_e<Z&&(ue-=Ze[ye+_e],!(ue<=0));)ye++,ue<<=1;if(Ae+=1<<ye,t===1&&Ae>852||t===2&&Ae>592)return 1;I=Ue&A,c[I]=ae<<24|ye<<16|N-d|0}}return Ue!==0&&(c[N+Ue]=F-_e<<24|64<<16|0),m.bits=ae,0};const{Z_FINISH:K$,Z_BLOCK:_ye,Z_TREES:CP,Z_OK:_y,Z_STREAM_END:yye,Z_NEED_DICT:Eye,Z_STREAM_ERROR:Qu,Z_DATA_ERROR:q$,Z_MEM_ERROR:Y$,Z_BUF_ERROR:vye,Z_DEFLATED:X$}=_P,RP=16180,IP=16190,bf=16191,gM=16192,_M=16194,AP=16199,PP=16200,yM=16206,fs=16209,J$=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function Sye(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const yy=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.mode<RP||r.mode>16211?1:0},Q$=t=>{if(yy(t))return Qu;const r=t.state;return t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=1&r.wrap),r.mode=RP,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,_y},Z$=t=>{if(yy(t))return Qu;const r=t.state;return r.wsize=0,r.whave=0,r.wnext=0,Q$(t)},eK=(t,r)=>{let s;if(yy(t))return Qu;const a=t.state;return r<0?(s=0,r=-r):(s=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?Qu:(a.window!==null&&a.wbits!==r&&(a.window=null),a.wrap=s,a.wbits=r,Z$(t))},tK=(t,r)=>{if(!t)return Qu;const s=new Sye;t.state=s,s.strm=t,s.window=null,s.mode=RP;const a=eK(t,r);return a!==_y&&(t.state=null),a};let EM,vM,nK=!0;const bye=t=>{if(nK){EM=new Int32Array(512),vM=new Int32Array(32);let r=0;for(;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(VT(1,t.lens,0,288,EM,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;VT(2,t.lens,0,32,vM,0,t.work,{bits:5}),nK=!1}t.lencode=EM,t.lenbits=9,t.distcode=vM,t.distbits=5},rK=(t,r,s,a)=>{let c;const d=t.state;return d.window===null&&(d.wsize=1<<d.wbits,d.wnext=0,d.whave=0,d.window=new Uint8Array(d.wsize)),a>=d.wsize?(d.window.set(r.subarray(s-d.wsize,s),0),d.wnext=0,d.whave=d.wsize):(c=d.wsize-d.wnext,c>a&&(c=a),d.window.set(r.subarray(s-a,s-a+c),d.wnext),(a-=c)?(d.window.set(r.subarray(s-a,s),0),d.wnext=a,d.whave=d.wsize):(d.wnext+=c,d.wnext===d.wsize&&(d.wnext=0),d.whave<d.wsize&&(d.whave+=c))),0};var wye=(t,r)=>{let s,a,c,d,h,m,g,E,w,I,A,N,G,F,z,ee,Z,ae,ye,_e,ue,Ae,Ue=0;const We=new Uint8Array(4);let Ze,_n;const Sn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(yy(t)||!t.output||!t.input&&t.avail_in!==0)return Qu;s=t.state,s.mode===bf&&(s.mode=gM),h=t.next_out,c=t.output,g=t.avail_out,d=t.next_in,a=t.input,m=t.avail_in,E=s.hold,w=s.bits,I=m,A=g,Ae=_y;e:for(;;)switch(s.mode){case RP:if(s.wrap===0){s.mode=gM;break}for(;w<16;){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}if(2&s.wrap&&E===35615){s.wbits===0&&(s.wbits=15),s.check=0,We[0]=255&E,We[1]=E>>>8&255,s.check=fa(s.check,We,2,0),E=0,w=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&E)<<8)+(E>>8))%31){t.msg="incorrect header check",s.mode=fs;break}if((15&E)!==X$){t.msg="unknown compression method",s.mode=fs;break}if(E>>>=4,w-=4,ue=8+(15&E),s.wbits===0&&(s.wbits=ue),ue>15||ue>s.wbits){t.msg="invalid window size",s.mode=fs;break}s.dmax=1<<s.wbits,s.flags=0,t.adler=s.check=1,s.mode=512&E?16189:bf,E=0,w=0;break;case 16181:for(;w<16;){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}if(s.flags=E,(255&zo(s))!==X$){t.msg="unknown compression method",s.mode=fs;break}if(57344&zo(s)){t.msg="unknown header flags set",s.mode=fs;break}s.head&&(s.head.text=E>>8&1),512&zo(s)&&4&s.wrap&&(We[0]=255&E,We[1]=E>>>8&255,s.check=fa(s.check,We,2,0)),E=0,w=0,s.mode=16182;case 16182:for(;w<32;){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}s.head&&(s.head.time=E),512&zo(s)&&4&s.wrap&&(We[0]=255&E,We[1]=E>>>8&255,We[2]=E>>>16&255,We[3]=E>>>24&255,s.check=fa(s.check,We,4,0)),E=0,w=0,s.mode=16183;case 16183:for(;w<16;){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}s.head&&(s.head.xflags=255&E,s.head.os=E>>8),512&zo(s)&&4&s.wrap&&(We[0]=255&E,We[1]=E>>>8&255,s.check=fa(s.check,We,2,0)),E=0,w=0,s.mode=16184;case 16184:if(1024&zo(s)){for(;w<16;){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}s.length=E,s.head&&(s.head.extra_len=E),512&zo(s)&&4&s.wrap&&(We[0]=255&E,We[1]=E>>>8&255,s.check=fa(s.check,We,2,0)),E=0,w=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&zo(s)&&(N=s.length,N>m&&(N=m),N&&(s.head&&(ue=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(a.subarray(d,d+N),ue)),512&zo(s)&&4&s.wrap&&(s.check=fa(s.check,a,N,d)),m-=N,d+=N,s.length-=N),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&zo(s)){if(m===0)break e;N=0;do ue=a[d+N++],s.head&&ue&&s.length<65536&&(s.head.name+=String.fromCharCode(ue));while(ue&&N<m);if(512&zo(s)&&4&s.wrap&&(s.check=fa(s.check,a,N,d)),m-=N,d+=N,ue)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&zo(s)){if(m===0)break e;N=0;do ue=a[d+N++],s.head&&ue&&s.length<65536&&(s.head.comment+=String.fromCharCode(ue));while(ue&&N<m);if(512&zo(s)&&4&s.wrap&&(s.check=fa(s.check,a,N,d)),m-=N,d+=N,ue)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&zo(s)){for(;w<16;){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}if(4&s.wrap&&E!==(65535&s.check)){t.msg="header crc mismatch",s.mode=fs;break}E=0,w=0}s.head&&(s.head.hcrc=zo(s)>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=bf;break;case 16189:for(;w<32;){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}t.adler=s.check=J$(E),E=0,w=0,s.mode=IP;case IP:if(s.havedict===0)return t.next_out=h,t.avail_out=g,t.next_in=d,t.avail_in=m,s.hold=E,s.bits=w,Eye;t.adler=s.check=1,s.mode=bf;case bf:if(r===_ye||r===CP)break e;case gM:if(s.last){E>>>=7&w,w-=7&w,s.mode=yM;break}for(;w<3;){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}switch(s.last=1&E,E>>>=1,w-=1,3&E){case 0:s.mode=16193;break;case 1:if(bye(s),s.mode=AP,r===CP){E>>>=2,w-=2;break e}break;case 2:s.mode=16196;break;case 3:t.msg="invalid block type",s.mode=fs}E>>>=2,w-=2;break;case 16193:for(E>>>=7&w,w-=7&w;w<32;){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}if((65535&E)!=(E>>>16^65535)){t.msg="invalid stored block lengths",s.mode=fs;break}if(s.length=65535&E,E=0,w=0,s.mode=_M,r===CP)break e;case _M:s.mode=16195;case 16195:if(N=s.length,N){if(N>m&&(N=m),N>g&&(N=g),N===0)break e;c.set(a.subarray(d,d+N),h),m-=N,d+=N,g-=N,h+=N,s.length-=N;break}s.mode=bf;break;case 16196:for(;w<14;){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}if(s.nlen=257+(31&E),E>>>=5,w-=5,s.ndist=1+(31&E),E>>>=5,w-=5,s.ncode=4+(15&E),E>>>=4,w-=4,s.nlen>286||s.ndist>30){t.msg="too many length or distance symbols",s.mode=fs;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;w<3;){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}s.lens[Sn[s.have++]]=7&E,E>>>=3,w-=3}for(;s.have<19;)s.lens[Sn[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,Ze={bits:s.lenbits},Ae=VT(0,s.lens,0,19,s.lencode,0,s.work,Ze),s.lenbits=Ze.bits,Ae){t.msg="invalid code lengths set",s.mode=fs;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;Ue=s.lencode[E&(1<<s.lenbits)-1],z=Ue>>>24,ee=Ue>>>16&255,Z=65535&Ue,!(z<=w);){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}if(Z<16)E>>>=z,w-=z,s.lens[s.have++]=Z;else{if(Z===16){for(_n=z+2;w<_n;){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}if(E>>>=z,w-=z,s.have===0){t.msg="invalid bit length repeat",s.mode=fs;break}ue=s.lens[s.have-1],N=3+(3&E),E>>>=2,w-=2}else if(Z===17){for(_n=z+3;w<_n;){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}E>>>=z,w-=z,ue=0,N=3+(7&E),E>>>=3,w-=3}else{for(_n=z+7;w<_n;){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}E>>>=z,w-=z,ue=0,N=11+(127&E),E>>>=7,w-=7}if(s.have+N>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=fs;break}for(;N--;)s.lens[s.have++]=ue}}if(s.mode===fs)break;if(s.lens[256]===0){t.msg="invalid code -- missing end-of-block",s.mode=fs;break}if(s.lenbits=9,Ze={bits:s.lenbits},Ae=VT(1,s.lens,0,s.nlen,s.lencode,0,s.work,Ze),s.lenbits=Ze.bits,Ae){t.msg="invalid literal/lengths set",s.mode=fs;break}if(s.distbits=6,s.distcode=s.distdyn,Ze={bits:s.distbits},Ae=VT(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,Ze),s.distbits=Ze.bits,Ae){t.msg="invalid distances set",s.mode=fs;break}if(s.mode=AP,r===CP)break e;case AP:s.mode=PP;case PP:if(m>=6&&g>=258){t.next_out=h,t.avail_out=g,t.next_in=d,t.avail_in=m,s.hold=E,s.bits=w,hye(t,A),h=t.next_out,c=t.output,g=t.avail_out,d=t.next_in,a=t.input,m=t.avail_in,E=s.hold,w=s.bits,s.mode===bf&&(s.back=-1);break}for(s.back=0;Ue=s.lencode[E&(1<<s.lenbits)-1],z=Ue>>>24,ee=Ue>>>16&255,Z=65535&Ue,!(z<=w);){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}if(ee&&(240&ee)==0){for(ae=z,ye=ee,_e=Z;Ue=s.lencode[_e+((E&(1<<ae+ye)-1)>>ae)],z=Ue>>>24,ee=Ue>>>16&255,Z=65535&Ue,!(ae+z<=w);){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}E>>>=ae,w-=ae,s.back+=ae}if(E>>>=z,w-=z,s.back+=z,s.length=Z,ee===0){s.mode=16205;break}if(32&ee){s.back=-1,s.mode=bf;break}if(64&ee){t.msg="invalid literal/length code",s.mode=fs;break}s.extra=15&ee,s.mode=16201;case 16201:if(s.extra){for(_n=s.extra;w<_n;){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}s.length+=E&(1<<s.extra)-1,E>>>=s.extra,w-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;Ue=s.distcode[E&(1<<s.distbits)-1],z=Ue>>>24,ee=Ue>>>16&255,Z=65535&Ue,!(z<=w);){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}if((240&ee)==0){for(ae=z,ye=ee,_e=Z;Ue=s.distcode[_e+((E&(1<<ae+ye)-1)>>ae)],z=Ue>>>24,ee=Ue>>>16&255,Z=65535&Ue,!(ae+z<=w);){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}E>>>=ae,w-=ae,s.back+=ae}if(E>>>=z,w-=z,s.back+=z,64&ee){t.msg="invalid distance code",s.mode=fs;break}s.offset=Z,s.extra=15&ee,s.mode=16203;case 16203:if(s.extra){for(_n=s.extra;w<_n;){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}s.offset+=E&(1<<s.extra)-1,E>>>=s.extra,w-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=fs;break}s.mode=16204;case 16204:if(g===0)break e;if(N=A-g,s.offset>N){if(N=s.offset-N,N>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=fs;break}N>s.wnext?(N-=s.wnext,G=s.wsize-N):G=s.wnext-N,N>s.length&&(N=s.length),F=s.window}else F=c,G=h-s.offset,N=s.length;N>g&&(N=g),g-=N,s.length-=N;do c[h++]=F[G++];while(--N);s.length===0&&(s.mode=PP);break;case 16205:if(g===0)break e;c[h++]=s.length,g--,s.mode=PP;break;case yM:if(s.wrap){for(;w<32;){if(m===0)break e;m--,E|=a[d++]<<w,w+=8}if(A-=g,t.total_out+=A,s.total+=A,4&s.wrap&&A&&(t.adler=s.check=zo(s)?fa(s.check,c,A,h-A):OT(s.check,c,A,h-A)),A=g,4&s.wrap&&(zo(s)?E:J$(E))!==s.check){t.msg="incorrect data check",s.mode=fs;break}E=0,w=0}s.mode=16207;case 16207:if(s.wrap&&zo(s)){for(;w<32;){if(m===0)break e;m--,E+=a[d++]<<w,w+=8}if(4&s.wrap&&E!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=fs;break}E=0,w=0}s.mode=16208;case 16208:Ae=yye;break e;case fs:Ae=q$;break e;case 16210:return Y$;default:return Qu}return t.next_out=h,t.avail_out=g,t.next_in=d,t.avail_in=m,s.hold=E,s.bits=w,(s.wsize||A!==t.avail_out&&s.mode<fs&&(s.mode<yM||r!==K$))&&rK(t,t.output,t.next_out,A-t.avail_out),I-=t.avail_in,A-=t.avail_out,t.total_in+=I,t.total_out+=A,s.total+=A,4&s.wrap&&A&&(t.adler=s.check=zo(s)?fa(s.check,c,A,t.next_out-A):OT(s.check,c,A,t.next_out-A)),t.data_type=s.bits+(s.last?64:0)+(s.mode===bf?128:0)+(s.mode===AP||s.mode===_M?256:0),(I===0&&A===0||r===K$)&&Ae===_y&&(Ae=vye),Ae},wf={inflateReset:Z$,inflateReset2:eK,inflateResetKeep:Q$,inflateInit:t=>tK(t,15),inflateInit2:tK,inflate:wye,inflateEnd:t=>{if(yy(t))return Qu;let r=t.state;return r.window&&(r.window=null),t.state=null,_y},inflateGetHeader:(t,r)=>{if(yy(t))return Qu;const s=t.state;return(2&s.wrap)==0?Qu:(s.head=r,r.done=!1,_y)},inflateSetDictionary:(t,r)=>{const s=r.length;let a,c,d;return yy(t)?Qu:(a=t.state,a.wrap!==0&&a.mode!==IP?Qu:a.mode===IP&&(c=1,c=OT(c,r,s,0),c!==a.check)?q$:(d=rK(t,r,s,s),d?(a.mode=16210,Y$):(a.havedict=1,_y)))},inflateInfo:"pako inflate (from Nodeca project)"},Tye=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const iK=Object.prototype.toString,{Z_NO_FLUSH:Cye,Z_FINISH:Rye,Z_OK:jT,Z_STREAM_END:SM,Z_NEED_DICT:bM,Z_STREAM_ERROR:Iye,Z_DATA_ERROR:sK,Z_MEM_ERROR:Aye}=_P;function OP(t){this.options=vP.assign({chunkSize:65536,windowBits:15,to:""},t||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||t&&t.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new H$,this.strm.avail_out=0;let s=wf.inflateInit2(this.strm,r.windowBits);if(s!==jT)throw new Error(py[s]);if(this.header=new Tye,wf.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=UT.string2buf(r.dictionary):iK.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(s=wf.inflateSetDictionary(this.strm,r.dictionary),s!==jT)))throw new Error(py[s])}function Pye(t,r){const s=new OP(r);if(s.push(t),s.err)throw s.msg||py[s.err];return s.result}OP.prototype.push=function(t,r){const s=this.strm,a=this.options.chunkSize,c=this.options.dictionary;let d,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?Rye:Cye,iK.call(t)==="[object ArrayBuffer]"?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),d=wf.inflate(s,h),d===bM&&c&&(d=wf.inflateSetDictionary(s,c),d===jT?d=wf.inflate(s,h):d===sK&&(d=bM));s.avail_in>0&&d===SM&&s.state.wrap>0&&t[s.next_in]!==0;)wf.inflateReset(s),d=wf.inflate(s,h);switch(d){case Iye:case sK:case bM:case Aye:return this.onEnd(d),this.ended=!0,!1}if(m=s.avail_out,s.next_out&&(s.avail_out===0||d===SM))if(this.options.to==="string"){let g=UT.utf8border(s.output,s.next_out),E=s.next_out-g,w=UT.buf2string(s.output,g);s.next_out=E,s.avail_out=a-E,E&&s.output.set(s.output.subarray(g,g+E),0),this.onData(w)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(d!==jT||m!==0){if(d===SM)return d=wf.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},OP.prototype.onData=function(t){this.chunks.push(t)},OP.prototype.onEnd=function(t){t===jT&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=vP.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Oye={inflate:Pye};const{deflate:kye}=dye,{inflate:Nye}=Oye;var xye=kye,Dye=Nye,oK=(function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t})(oK||{});class Lye{constructor(){X(this,"_sequence",0),X(this,"_startTime",Date.now()),X(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const g={id:0,length:4,data:m.buffer},E={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[g]};s.commonPacketHeader.extension=1,s.extension=E,s.payload=this.compress(r),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;oe("SHOW_DATASTREAM2_LOG")&&M.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));const a=new ArrayBuffer(s.commonPacketHeader.length),c=new Uint8Array(a),d=new DataView(a);let h=0;if(d.setUint16(h,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),h+=2,d.setUint32(h,s.commonPacketHeader.sequence,!0),h+=4,d.setUint16(h,s.commonStreamHeader,!0),h+=2,s.extension){const m=this.serializeExtension(s.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(s.payload),h),h+=s.payload.byteLength,h!==s.commonPacketHeader.length)throw Error("serialize error!");return a}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const s=new DataView(r);let a=0;const c=s.getUint16(a,!0);a+=2;const d={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:s.getUint16(a+2,!0)<<16|s.getUint16(a,!0)};let h,m;if(a+=4,oe("SHOW_DATASTREAM2_LOG")&&M.debug("receive data header: ".concat(JSON.stringify(d))),s.getUint16(a,!0),a+=2,d.extension){m=this.deserializeExtension(r.slice(a)),a+=2+m.length,h=r.slice(a);let g=!1;if(m.datas.length>0){const E=m.datas.find((w=>w.id===0));E&&(g=(1&new DataView(E.data).getUint32(0,!0))==1)}h=g?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:s,length:a,datas:c}=r,d=new ArrayBuffer(a+2),h=new Uint8Array(d),m=new DataView(d);let g=0;if(m.setUint8(g++,s),m.setUint8(g++,a),c.forEach((E=>{s?(m.setUint8(g++,E.id),m.setUint8(g++,E.length),h.set(new Uint8Array(E.data),g),g+=E.data.byteLength):(m.setUint8(g++,E.id|E.length<<4),h.set(new Uint8Array(E.data),g),g+=E.data.byteLength)})),g!==a+2)throw Error("serialize extension error, is ".concat(g,"!==").concat(a+2));return d}deserializeExtension(r){const s=new DataView(r);let a=0;const c=s.getUint8(a);a++;const d=s.getUint8(a);a++;const h=c===oK.TWO_BYTE,m=[],g=new DataView(r,2);let E=0;for(;E<d;){let w=0,I=0,A=new ArrayBuffer(0);h?(w=g.getUint8(E),E++,I=g.getUint8(E),E++):(w=15&g.getUint8(E),I=g.getUint8(E)>>4,E++),I>0&&(A=g.buffer.slice(E+2,E+2+I),E+=A.byteLength),m.push({id:w,length:I,data:A})}if(E!==d)throw Error("parse error");return{profile:c,length:d,datas:m}}decompress(r){return Dye(new Uint8Array(r))}compress(r){return xye(new Uint8Array(r))}}const Mye={name:"DataStream",create:(t,r)=>{const s=r?new Gme(t):new Hme(t);return s.useDataStream(new Lye),s}};class Uye extends Qr{constructor(r,s,a){super(),X(this,"ws",void 0),X(this,"requestId",1),X(this,"heartBeatTimer",void 0),X(this,"joinInfo",void 0),X(this,"clientId",void 0),X(this,"onOpen",(()=>{this.emit("open"),this.startHeartBeatCheck()})),X(this,"onClose",(c=>{this.emit("close"),this.dispose()})),X(this,"onMessage",(c=>{const d=JSON.parse(c.data);if(!d||d.command!=="serverResponse"||!d.requestId)return d&&d.command==="serverStatus"&&d.serverStatus&&d.serverStatus.command?(this.emit("status",d.serverStatus),void this.emit(d.serverStatus.command,d.serverStatus)):void 0;this.emit("req_".concat(d.requestId),d)})),this.joinInfo=r,this.clientId=s,this.ws=new dT("cross-channel-".concat(this.clientId),a),this.ws.on(pn.RECONNECTING,(()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")})),this.ws.on(pn.CONNECTED,this.onOpen),this.ws.on(pn.ON_MESSAGE,this.onMessage),this.ws.on(pn.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const s=this.requestId++;return r.requestId=s,r.seq=s,this.ws.sendMessage(r),s}waitStatus(r){return new mt(((s,a)=>{const c=window.setTimeout((()=>{a(new ke(te.TIMEOUT,"wait status timeout, status: ".concat(r)))}),5e3);this.once(r,(d=>{window.clearTimeout(c),d.state&&d.state!==0?a(new ke(te.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):s(void 0)})),this.once("dispose",(()=>{window.clearTimeout(c),a(new ke(te.WS_ABORT))}))}))}async request(r){if(this.ws.state==="closed")throw new ke(te.WS_DISCONNECT);const s=()=>new mt(((h,m)=>{this.ws.once(pn.CLOSED,(()=>m(new ke(te.WS_ABORT)))),this.ws.once(pn.CONNECTED,h)}));this.ws.state!=="connected"&&await s();const a=this.sendMessage(r),c=new mt(((h,m)=>{const g=()=>{m(new ke(te.WS_ABORT))};this.ws.once(pn.RECONNECTING,g),this.ws.once(pn.CLOSED,g),this.once("req_".concat(a),h),bs(3e3).then((()=>{this.removeAllListeners("req_".concat(a)),this.ws.off(pn.RECONNECTING,g),this.ws.off(pn.CLOSED,g),m(new ke(te.TIMEOUT,"cross channel ws request timeout"))}))})),d=await c;if(!d||d.code!==200)throw new ke(te.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(d)));return d}async connect(r){this.ws.removeAllListeners(pn.REQUEST_NEW_URLS),this.ws.on(pn.REQUEST_NEW_URLS,(s=>{s(r)})),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const s=this.requestId++;return r.requestId=s,this.ws.sendMessage(r),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Vye extends Qr{set state(r){r!==this._state&&(r!==rc.RELAY_STATE_FAILURE&&(this.errorCode=i0.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,s,a,c,d){super(),X(this,"joinInfo",void 0),X(this,"sid",void 0),X(this,"clientId",void 0),X(this,"cancelToken",ka.CancelToken.source()),X(this,"workerToken",void 0),X(this,"requestId",0),X(this,"signal",void 0),X(this,"prevChannelMediaConfig",void 0),X(this,"httpRetryConfig",void 0),X(this,"_resolution",void 0),X(this,"_state",rc.RELAY_STATE_IDLE),X(this,"errorCode",i0.RELAY_OK),X(this,"onStatus",(h=>{M.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",_f.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",_f.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=i0.SRC_TOKEN_EXPIRED,this.state=rc.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=i0.DEST_TOKEN_EXPIRED,this.state=rc.RELAY_STATE_FAILURE))})),X(this,"onReconnect",(async()=>{M.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",_f.NETWORK_DISCONNECTED),this.state=rc.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch((h=>{this.state!==rc.RELAY_STATE_IDLE&&(M.error("auto restart channel media relay failed",h.toString()),this.errorCode=i0.SERVER_CONNECTION_LOST,this.state=rc.RELAY_STATE_FAILURE)}))})),this.joinInfo=r,this.clientId=s,this.sid=Z_(),this.signal=new Uye(this.joinInfo,this.clientId,a),this.httpRetryConfig=c,this._resolution=d}async startChannelMediaRelay(r){if(this.state!==rc.RELAY_STATE_IDLE)throw new ke(te.INVALID_OPERATION);this.state=rc.RELAY_STATE_CONNECTING,await this.connect(),M.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new ke(te.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new ke(te.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new ke(te.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==rc.RELAY_STATE_RUNNING)throw new ke(te.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==rc.RELAY_STATE_RUNNING)throw new ke(te.INVALID_OPERATION);const s=this.genMessage(pa.SetVideoProfile);await this.signal.request(s),M.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),M.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=rc.RELAY_STATE_IDLE,this.dispose()}dispose(){M.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=ka.CancelToken.source(),this.state=rc.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await Xge(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",_f.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const s=this.genMessage(pa.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),M.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const a=this.genMessage(pa.SetSdkProfile,r);await this.signal.request(a),M.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(pa.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",_f.PACKET_JOINED_SRC_CHANNEL),M.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const d=this.genMessage(pa.SetSourceUserId,r);await this.signal.request(d),M.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(pa.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",_f.PACKET_JOINED_DEST_CHANNEL),M.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(pa.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",_f.PACKET_SENT_TO_DEST_CHANNEL),this.state=rc.RELAY_STATE_RUNNING,M.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const s=this.genMessage(pa.UpdateDestChannel,r);await this.signal.request(s),this.emit("event",_f.PACKET_UPDATE_DEST_CHANNEL),M.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(pa.StopPacketTransfer);await this.signal.request(r),M.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,s){const a=[],c=[],d=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Jl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.24.0"&&(h.sdkVersion="0.0.1");let m=null,g=null;switch(r){case pa.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case pa.SetSourceChannel:if(g=s&&s.getSrcChannelMediaInfo(),!g)throw new ke(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:g.channelName,token:g.token||this.joinInfo.appId},h;case pa.SetSourceUserId:if(g=s&&s.getSrcChannelMediaInfo(),!g)throw new ke(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:g.uid+""},h;case pa.SetDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new ke(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach((E=>{a.push(E.channelName),c.push(E.uid+""),d.push(E.token||this.joinInfo.appId)})),h.clientRequest={command:"SetDestChannel",channelName:a,uid:c,token:d},h;case pa.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case pa.Reconnect:return h.clientRequest={command:"Reconnect"},h;case pa.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case pa.UpdateDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new ke(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach((E=>{a.push(E.channelName),c.push(E.uid+""),d.push(E.token||this.joinInfo.appId)})),h.clientRequest={command:"UpdateDestChannel",channelName:a,uid:c,token:d},h;case pa.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const jye={name:"ChannelMediaRelay",create:function(t){return new Vye(t.joinInfo,t.clientId,t.websocketRetryConfig||Ni,t.httpRetryConfig||Ni,t.resolution)}};function aK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function FT(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?aK(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):aK(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}class Fye extends Qr{constructor(r,s,a,c){super(),X(this,"spec",void 0),X(this,"token",void 0),X(this,"websocket",void 0),X(this,"pingpongTimer",void 0),X(this,"reconnectMode","retry"),X(this,"serviceMode",void 0),X(this,"reqId",0),X(this,"commandReqId",0),X(this,"handleWebSocketOpen",(()=>{this.reconnectMode="retry",this.startPingPong()})),X(this,"handleWebSocketMessage",(d=>{if(!d.data)return;const h=JSON.parse(d.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(It.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===gf.TRANSCODE?1:2}),this.emit(Ym.PUBLISH_STREAM_STATUS,h))})),this.spec=s,this.token=r,this.serviceMode=c,this.websocket=new dT("live-streaming",a),this.websocket.on(pn.CONNECTED,this.handleWebSocketOpen),this.websocket.on(pn.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(pn.REQUEST_NEW_URLS,((d,h)=>{Fs(this,Ym.REQUEST_NEW_ADDRESS).then(d).catch(h)})),this.websocket.on(pn.RECONNECTING,(()=>{this.websocket.reconnectMode=this.reconnectMode}))}init(r){return this.websocket.init(r)}async request(r,s,a,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const d=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new ke(te.UNEXPECTED_ERROR);const m=FT({command:r,sdkVersion:Jl==="4.24.0"?"0.0.1":Jl,seq:h,requestId:h,allocate:a,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new ke(te.WS_DISCONNECT);const g=()=>new mt(((A,N)=>{this.websocket.once(pn.CLOSED,(()=>N(new ke(te.WS_ABORT)))),this.websocket.once(pn.CONNECTED,A)}));this.websocket.state!=="connected"&&await g(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const E=new mt(((A,N)=>{const G=()=>{N(new ke(te.WS_ABORT))};this.websocket.once(pn.RECONNECTING,G),this.websocket.once(pn.CLOSED,G),this.once("@".concat(h,"-").concat(this.spec.sid),(F=>{A(F)}))}));c&&It.workerEvent(this.spec.sid,FT(FT({},c),{},{requestId:d,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const w=Date.now();this.websocket.sendMessage(m);let I=null;try{I=await E}catch(A){if(this.websocket.state==="closed")throw A;return await g(),await this.request(r,s,a)}return c&&It.workerEvent(this.spec.sid,FT(FT({},c),{},{requestId:d,actionType:"response",payload:JSON.stringify(I.serverResponse),serverCode:I.code,success:I.code===200,responseTime:Date.now()-w})),I.code!==200&&this.handleResponseError(I),I}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=Jl==="4.24.0"?"0.0.1":Jl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case Bi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void M.warning("live stream response already exists stream");case Bi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Bi.LIVE_STREAM_RESPONSE_BAD_STREAM:case Bi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new ke(te.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case Bi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new ke(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Bi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new ke(te.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case Bi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new ke(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Ym.WARNING,s,r.serverResponse.url)}case Bi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new ke(te.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Ym.WARNING,s,r.serverResponse.url)}case Bi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new ke(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Bi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new ke(te.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case Bi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new ke(te.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Ym.WARNING,s,r.serverResponse.url)}case Bi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new ke(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case Bi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new ke(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Bi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Bi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new ke(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Bi.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new ke(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new ke(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Bi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new ke(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(m1)}),6e3)}}function cK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function ic(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?cK(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):cK(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}class Bye extends Qr{constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ni,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ni;super(),X(this,"onLiveStreamWarning",void 0),X(this,"onLiveStreamError",void 0),X(this,"spec",void 0),X(this,"retryTimeout",1e4),X(this,"connection",void 0),X(this,"httpRetryConfig",void 0),X(this,"wsRetryConfig",void 0),X(this,"streamingTasks",new Map),X(this,"isStartingStreamingTask",!1),X(this,"taskMutex",new ro("live-streaming")),X(this,"cancelToken",ka.CancelToken.source()),X(this,"transcodingConfig",void 0),X(this,"uapResponse",void 0),X(this,"lastTaskId",1),X(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=a,this.wsRetryConfig=s}async setTranscodingConfig(r){const s=ic(ic({},Age),r);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(M.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map((h=>ic(ic(ic({},Ige),h),{},{zOrder:h.zOrder?h.zOrder+1:1})))),(function(h){ri(h.width)||vr(h.width,"config.width",0,1e4),ri(h.height)||vr(h.height,"config.height",0,1e4),ri(h.videoBitrate)||vr(h.videoBitrate,"config.videoBitrate",1,1e6),ri(h.videoFrameRate)||vr(h.videoFrameRate,"config.videoFrameRate"),ri(h.lowLatency)||$d(h.lowLatency,"config.lowLatency"),ri(h.audioSampleRate)||Yi(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),ri(h.audioBitrate)||vr(h.audioBitrate,"config.audioBitrate",1,128),ri(h.audioChannels)||Yi(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),ri(h.videoGop)||vr(h.videoGop,"config.videoGop"),ri(h.videoCodecProfile)||Yi(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),ri(h.userCount)||vr(h.userCount,"config.userCount",0,17),ri(h.backgroundColor)||vr(h.backgroundColor,"config.backgroundColor",0,16777215),ri(h.userConfigExtraInfo)||Ss(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!ri(h.transcodingUsers)&&(mf(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach(((m,g)=>{j1(m.uid),ri(m.x)||vr(m.x,"transcodingUser[".concat(g,"].x"),0,1e4),ri(m.y)||vr(m.y,"transcodingUser[".concat(g,"].y"),0,1e4),ri(m.width)||vr(m.width,"transcodingUser[".concat(g,"].width"),0,1e4),ri(m.height)||vr(m.height,"transcodingUser[".concat(g,"].height"),0,1e4),ri(m.zOrder)||vr(m.zOrder-1,"transcodingUser[".concat(g,"].zOrder"),0,100),ri(m.alpha)||vr(m.alpha,"transcodingUser[".concat(g,"].alpha"),0,1,!1)}))),ri(h.watermark)||S2(h.watermark,"watermark"),ri(h.backgroundImage)||S2(h.backgroundImage,"backgroundImage"),h.images&&!ri(h.images)&&(mf(h.images,"config.images"),h.images.forEach(((m,g)=>{S2(m,"images[".concat(g,"]"))})))})(s);const a=[];s.images&&a.push(...s.images.map((h=>ic(ic(ic({},v2),h),{},{zOrder:255})))),s.backgroundImage&&(a.push(ic(ic(ic({},v2),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(a.push(ic(ic(ic({},v2),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=a,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map((h=>ic({},h))),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const c=(s.userConfigs||[]).map((h=>typeof h.uid=="number"?mt.resolve(h.uid):x7(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)));if((await mt.all(c)).forEach(((h,m)=>{s.userConfigs&&s.userConfigs[m]&&(s.userConfigs[m].uid=h)})),this.transcodingConfig=s,this.connection)try{var d;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Ic(d=this.streamingTasks).call(d)).map((m=>m.taskId)).join("#")});M.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((m=>{M.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then((()=>{M.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))})).catch((g=>{M.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,g.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,g)}))}))}}async startLiveStreamingTask(r,s,a){if(!this.transcodingConfig&&s===gf.TRANSCODE)throw new ke(te.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};M.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(s));const d=await this.taskMutex.lock();if(!this.connection&&a)return void d();if(this.streamingTasks.get(r)&&!a)return d(),new ke(te.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(m){throw d(),m}switch(s){case gf.TRANSCODE:c.transcodingConfig=ic({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new mt(((E,w)=>{bs(this.retryTimeout).then((()=>{if(a)return w(a);const I=this.statusError.get(r);return I?(this.statusError.delete(r),w(I)):void 0}))})),g=await mt.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:s===gf.TRANSCODE?1:2,requestByUser:!a,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,M.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(g.code)),this.streamingTasks.set(r,{clientRequest:c,mode:s,url:r,taskId:h}),d()}catch(m){if(d(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||a)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,s,m)):await this.startLiveStreamingTask(r,s,m)}}stopLiveStreamingTask(r){return new mt(((s,a)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new ke(te.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const d=c.mode;c.abortTask=()=>{M.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:d===gf.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then((h=>{M.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()})).catch(a)}))}resetAllTask(){var r;const s=Array.from(Ic(r=this.streamingTasks).call(r));this.terminate();for(const a of s)this.startLiveStreamingTask(a.url,a.mode).catch((c=>{this.onLiveStreamError&&this.onLiveStreamError(a.url,c)}))}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=ka.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new ke(te.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await Fs(this,b2.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=s,this.connection=new Fye(s.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(Ym.WARNING,((a,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,a))),this.connection.on(Ym.PUBLISH_STREAM_STATUS,(a=>this.handlePublishStreamServer(a))),this.connection.on(Ym.REQUEST_NEW_ADDRESS,((a,c)=>{if(!this.connection)return c(new ke(te.UNEXPECTED_ERROR,"can not get new live streaming address list"));Fs(this,b2.REQUEST_WORKER_MANAGER_LIST,r).then((d=>{this.uapResponse=d,a(d.addressList)})).catch(c)})),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(r){const s=r.serverStatus&&r.serverStatus.url||"empty_url",a=this.streamingTasks.get(s),c=r.reason;switch(r.code){case Bi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new ke(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(a)return M.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,h);if(!this.isStartingStreamingTask)return;this.statusError.set(s,h)}case Bi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new ke(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,h)}case Bi.LIVE_STREAM_RESPONSE_WORKER_LOST:case Bi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var d;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Ic(d=this.streamingTasks).call(d));for(const m of h)m.abortTask?m.abortTask():(M.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new ke(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then((()=>{M.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)})).catch((g=>{M.error(g.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,g)})));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const zye={name:"LiveStreaming",create:function(t){return new Bye(t.joinInfo,t.websocketRetryConfig||Ni,t.httpRetryConfig||Ni)}};function Wye(t){let r=dK();return(function(s,a){let c=s.appId;c!==void 0&&(ur(a,10),dp(a,c));let d=s.cid;d!==void 0&&(ur(a,16),ur(a,d));let h=s.cname;h!==void 0&&(ur(a,26),dp(a,h));let m=s.deviceId;m!==void 0&&(ur(a,34),dp(a,m));let g=s.elapse;g!==void 0&&(ur(a,40),dg(a,g));let E=s.fileSize;E!==void 0&&(ur(a,48),dg(a,S0(E)));let w=s.height;w!==void 0&&(ur(a,56),dg(a,S0(w)));let I=s.jpg;I!==void 0&&(ur(a,66),ur(a,I.length),(function(co,ze){let ot=b0(co,ze.length);co.bytes.set(ze,ot)})(a,I));let A=s.networkType;A!==void 0&&(ur(a,72),dg(a,S0(A)));let N=s.osType;N!==void 0&&(ur(a,80),dg(a,S0(N)));let G=s.requestId;G!==void 0&&(ur(a,90),dp(a,G));let F=s.sdkVersion;F!==void 0&&(ur(a,98),dp(a,F));let z=s.sequence;z!==void 0&&(ur(a,104),dg(a,S0(z)));let ee=s.sid;ee!==void 0&&(ur(a,114),dp(a,ee));let Z=s.timestamp;Z!==void 0&&(ur(a,120),dg(a,Z));let ae=s.uid;ae!==void 0&&(ur(a,128),ur(a,ae));let ye=s.vid;ye!==void 0&&(ur(a,136),ur(a,ye));let _e=s.width;_e!==void 0&&(ur(a,144),dg(a,S0(_e)));let ue=s.service;ue!==void 0&&(ur(a,152),ur(a,ue));let Ae=s.callbackData;Ae!==void 0&&(ur(a,162),dp(a,Ae));let Ue=s.jpgEncryption;Ue!==void 0&&(ur(a,168),ur(a,Ue));let We=s.requestType;We!==void 0&&(ur(a,176),ur(a,We));let Ze=s.scorePorn;Ze!==void 0&&(ur(a,185),IM(a,Ze));let _n=s.scoreSexy;_n!==void 0&&(ur(a,193),IM(a,_n));let Sn=s.scoreNeutral;Sn!==void 0&&(ur(a,201),IM(a,Sn));let Qt=s.scene;Qt!==void 0&&(ur(a,208),ur(a,Qt));let rr=s.ossFilePrefix;rr!==void 0&&(ur(a,218),dp(a,rr));let Jn=s.serviceVendor;if(Jn!==void 0)for(let co of Jn){ur(a,226);let ze=dK();$ye(co,ze),ur(a,ze.limit),Xye(a,ze),Yye(ze)}})(t,r),(function(s){let a=s.bytes,c=s.limit;return a.length===c?a:a.subarray(0,c)})(r)}function Gye(t){return(function(s){let a={};e:for(;!hK(s);){let c=hp(s);switch(c>>>3){case 0:break e;case 1:a.code=hp(s);break;case 2:a.msg=pK(s,hp(s));break;case 3:{let d=Kye(s);a.data=Hye(s),s.limit=d;break}default:lK(s,7&c)}}return a})({bytes:r=t,offset:0,limit:r.length});var r}function Hye(t){let r={};e:for(;!hK(t);){let s=hp(t);switch(s>>>3){case 0:break e;case 1:r.requestId=pK(t,hp(t));break;case 2:r.requestType=hp(t)>>>0;break;case 3:r.scorePorn=RM(t);break;case 4:r.scoreSexy=RM(t);break;case 5:r.scoreNeutral=RM(t);break;case 6:r.requestScene=hp(t)>>>0;break;case 7:r.scene=hp(t)>>>0;break;default:lK(t,7&s)}}return r}function $ye(t,r){let s=t.service;s!==void 0&&(ur(r,8),ur(r,s));let a=t.vendor;a!==void 0&&(ur(r,16),ur(r,a));let c=t.token;c!==void 0&&(ur(r,26),dp(r,c));let d=t.callbackUrl;d!==void 0&&(ur(r,34),dp(r,d))}function Kye(t){let r=hp(t),s=t.limit;return t.limit=t.offset+r,s}function lK(t,r){switch(r){case 0:for(;128&fK(t););break;case 2:TM(t,hp(t));break;case 5:TM(t,4);break;case 1:TM(t,8);break;default:throw new Error("Unimplemented type: "+r)}}let qye=new Float32Array(1);new Uint8Array(qye.buffer);let wM=new Float64Array(1),sc=new Uint8Array(wM.buffer);function S0(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let uK=[];function dK(){const t=uK.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function Yye(t){uK.push(t)}function TM(t,r){if(t.offset+r>t.limit)throw new Error("Skip past limit");t.offset+=r}function hK(t){return t.offset>=t.limit}function b0(t,r){let s=t.bytes,a=t.offset,c=t.limit,d=a+r;if(d>s.length){let h=new Uint8Array(2*d);h.set(s),t.bytes=h}return t.offset=d,d>c&&(t.limit=d),a}function CM(t,r){let s=t.offset;if(s+r>t.limit)throw new Error("Read past limit");return t.offset+=r,s}function pK(t,r){let s=CM(t,r),a=String.fromCharCode,c=t.bytes,d="",h="";for(let m=0;m<r;m++){let g,E,w,I,A=c[m+s];(128&A)==0?h+=a(A):(224&A)==192?m+1>=r?h+=d:(g=c[m+s+1],(192&g)!=128?h+=d:(I=(31&A)<<6|63&g,I<128?h+=d:(h+=a(I),m++))):(240&A)==224?m+2>=r?h+=d:(g=c[m+s+1],E=c[m+s+2],(49344&(g|E<<8))!=32896?h+=d:(I=(15&A)<<12|(63&g)<<6|63&E,I<2048||I>=55296&&I<=57343?h+=d:(h+=a(I),m+=2))):(248&A)==240?m+3>=r?h+=d:(g=c[m+s+1],E=c[m+s+2],w=c[m+s+3],(12632256&(g|E<<8|w<<16))!=8421504?h+=d:(I=(7&A)<<18|(63&g)<<12|(63&E)<<6|63&w,I<65536||I>1114111?h+=d:(I-=65536,h+=a(55296+(I>>10),56320+(1023&I)),m+=3))):h+=d}return h}function dp(t,r){let s=r.length,a=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),a+=m<128?1:m<2048?2:m<65536?3:4}ur(t,a);let c=b0(t,a),d=t.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?d[c++]=m:(m<2048?d[c++]=m>>6&31|192:(m<65536?d[c++]=m>>12&15|224:(d[c++]=m>>18&7|240,d[c++]=m>>12&63|128),d[c++]=m>>6&63|128),d[c++]=63&m|128)}}function Xye(t,r){let s=b0(t,r.limit),a=t.bytes,c=r.bytes;for(let d=0,h=r.limit;d<h;d++)a[d+s]=c[d]}function fK(t){return t.bytes[CM(t,1)]}function mK(t,r){let s=b0(t,1);t.bytes[s]=r}function RM(t){let r=CM(t,8),s=t.bytes;return sc[0]=s[r++],sc[1]=s[r++],sc[2]=s[r++],sc[3]=s[r++],sc[4]=s[r++],sc[5]=s[r++],sc[6]=s[r++],sc[7]=s[r++],wM[0]}function IM(t,r){let s=b0(t,8),a=t.bytes;wM[0]=r,a[s++]=sc[0],a[s++]=sc[1],a[s++]=sc[2],a[s++]=sc[3],a[s++]=sc[4],a[s++]=sc[5],a[s++]=sc[6],a[s++]=sc[7]}function hp(t){let r,s=0,a=0;do r=fK(t),s<32&&(a|=(127&r)<<s),s+=7;while(128&r);return a}function ur(t,r){for(r>>>=0;r>=128;)mK(t,127&r|128),r>>>=7;mK(t,r)}function dg(t,r){let s=r.low>>>0,a=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,d=c===0?a===0?s<16384?s<128?1:2:s<1<<21?3:4:a<16384?a<128?5:6:a<1<<21?7:8:c<128?9:10,h=b0(t,d),m=t.bytes;switch(d){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=d!==9?128|c:127&c;case 8:m[h+7]=d!==8?a>>>21|128:a>>>21&127;case 7:m[h+6]=d!==7?a>>>14|128:a>>>14&127;case 6:m[h+5]=d!==6?a>>>7|128:a>>>7&127;case 5:m[h+4]=d!==5?128|a:127&a;case 4:m[h+3]=d!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=d!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=d!==2?s>>>7|128:s>>>7&127;case 1:m[h]=d!==1?128|s:127&s}}function gK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}const Jye=new Map([["moderation",1],["supervise",2]]);class Qye extends Qr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(ps.CONNECTION_STATE_CHANGE,s,r)}get inspectType(){return this._inspectType}set inspectType(r){var s;this._inspectMode=Ya(s=r.map((a=>Jye.get(a)||0))).call(s,((a,c)=>a+c)),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this.qualityRatio}),6e4))}constructor(r){super(),X(this,"name","AgoraRTCVideoContentInspect"),X(this,"_connectionState",$u.CONNECTING),X(this,"_innerConnectionState",void 0),X(this,"sequence",0),X(this,"inspectStartTime",void 0),X(this,"workerManagerConnection",void 0),X(this,"workerConnection",void 0),X(this,"workerMessageLengthLimit",void 0),X(this,"inspectIntervalMinimum",void 0),X(this,"qualityRatio",void 0),X(this,"_connectInfo",void 0),X(this,"_cancelTokenSource",ka.CancelToken.source()),X(this,"_retryConfig",void 0),X(this,"wmSequence",0),X(this,"inspectInterval",void 0),X(this,"inspectTimer",null),X(this,"ossFilePrefix",void 0),X(this,"extraInfo",void 0),X(this,"_inspectType",void 0),X(this,"_inspectMode",void 0),X(this,"_quality",1),X(this,"qualityTimer",null),X(this,"_inspectId",void 0),X(this,"_needWorkUrlOnly",!1),X(this,"inspectImage",(()=>{if(this.connectionState!==$u.CONNECTED)throw new ke(te.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval((()=>{this.connectionState===$u.CONNECTED?this.requestToInspectImage():M.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)}),this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()})),this._inspectId=wr(5,"inspect-"),this.workerMessageLengthLimit=oe("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=oe("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=oe("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new dT("worker-manager-"+this._inspectId,Ni),this.on(ps.STATE_CHANGE,((s,a)=>{this._innerConnectionState=s,M.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Ku[s]," ").concat(a||""))})),this.handleWorkerManagerEvents(),this.workerConnection=new dT("worker-"+this._inspectId,Ni),this.handleWorkerEvents()}async init(r,s){this.emit(ps.STATE_CHANGE,Ku.CONNECT_AP),this._connectInfo=r;const a=this._cancelTokenSource.token;return this._retryConfig=s,new mt(((c,d)=>{this.on(ps.CONNECTION_STATE_CHANGE,((h,m)=>{m===$u.CONNECTED&&c()})),this.requestAP(r,a,s).then((h=>{this.connectWorkerManager(h)})).catch((h=>{d(h)}))}))}async requestAP(r,s,a){const c=oe("WEBCS_DOMAIN").map((m=>"https://".concat(m,"/api/v1"))),d=await(function(m,g,E,w){let{appId:I,areaCode:A,cname:N,sid:G,token:F,uid:z}=g;d0++;const ee="image_moderation_api",Z={service_name:ee,json_body:JSON.stringify({appId:I,areaCode:A,cname:N,command:"allocateEdge",requestId:d0,seq:d0,sid:G,token:F,ts:Date.now(),uid:z+""})};let ae,ye,_e=m[0];return Kd((async()=>{ae=Date.now();const ue=await Qd(_e,{data:Z,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ye=Date.now()-ae,ue.code!==0){const Ze=new ke(te.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ue.code,{retry:!0,responseTime:ye});throw M.error(Ze.toString()),Ze}const Ae=JSON.parse(ue.json_body);if(Ae.code!==200){const Ze=new ke(te.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Ae.code,", reason: ").concat(Ae.reason),{code:Ae.code,responseTime:ye});throw M.error(Ze.toString()),Ze}if(!Ae.servers||!Array.isArray(Ae.servers)||Ae.servers.length===0){const Ze=new ke(te.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Ae.code,responseTime:ye});throw M.error(Ze.toString()),Ze}const Ue=oe("VIDEO_INSPECT_WORKER_MANAGER_HOST"),We=oe("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Ae.servers.map((Ze=>{let{address:_n,wss:Sn}=Ze;if(_n&&Sn)return"wss://".concat(_n.replace(/\./g,"-"),".").concat(Ue,":").concat(We||Sn)})).filter((Ze=>!!Ze)),workerToken:Ae.workerToken,vid:Ae.vid,responseTime:ye}}),((ue,Ae)=>(It.apworkerEvent(G,{success:!0,sc:200,serviceName:ee,responseDetail:JSON.stringify(ue.addressList),firstSuccess:Ae===0,responseTime:ye,serverIp:m[Ae%m.length]}),!1)),((ue,Ae)=>(It.apworkerEvent(G,{success:!1,sc:ue.data&&ue.data.code||200,serviceName:ee,responseTime:ye,serverIp:m[Ae%m.length]}),!!(ue.code!==te.OPERATION_ABORTED&&ue.code!==te.UNEXPECTED_RESPONSE||ue.data&&ue.data.retry)&&(_e=m[(Ae+1)%m.length],!0))),w)})(c,r,s,a);this.emit(ps.STATE_CHANGE,Ku.AP_CONNECTED);const{addressList:h}=d;return this.wmSequence++,h}async connectWorkerManager(r){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(ps.STATE_CHANGE,Ku.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(pn.CONNECTED,(async()=>{this.emit(ps.STATE_CHANGE,Ku.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(pn.CLOSED,(()=>{this._innerConnectionState<Ku.GET_WORKER_MANAGER_RESPONSE&&M.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(pn.FAILED,(()=>{this._innerConnectionState<Ku.GET_WORKER_MANAGER_RESPONSE&&M.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(pn.RECONNECTING,(()=>{this._innerConnectionState<Ku.GET_WORKER_MANAGER_RESPONSE&&M.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(pn.ON_MESSAGE,(async r=>{this.emit(ps.STATE_CHANGE,Ku.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const a=JSON.parse(r.data);if(a.code!==200)throw M.error("[".concat(this._inspectId,"] Unexpected code ").concat(a.code," from worker manager")),new ke(te.UNEXPECTED_RESPONSE,"response code of worker is unexpected",a);if(!(a.serverResponse&&a.serverResponse.portWss&&s))throw M.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(a))),new ke(te.UNEXPECTED_RESPONSE,"response content of worker is unexpected",a);{const c=oe("VIDEO_INSPECT_WORKER_PORT")||a.serverResponse.portWss,d=s.replace(/:\d+\/?$/,":".concat(c));this.emit(ps.STATE_CHANGE,Ku.CONNECT_WORKER,d),this._needWorkUrlOnly?this.emit(ps.REQUEST_NEW_WORKER_URL,d):await this.connectWorker(d)}})),this.workerManagerConnection.on(pn.WILL_RECONNECT,((r,s,a)=>{a(r)})),this.workerManagerConnection.on(pn.REQUEST_NEW_URLS,((r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)}))}handleWorkerEvents(){this.workerConnection.on(pn.CONNECTED,(async()=>{this.emit(ps.STATE_CHANGE,Ku.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=$u.CONNECTED})),this.workerConnection.on(pn.ON_MESSAGE,(async r=>{if(r.data instanceof ArrayBuffer){const a=Gye(new Uint8Array(r.data));if(oe("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&M.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(a)),a.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(ps.INSPECT_RESULT,void 0,void 0);if(a.data&&a.data.scorePorn&&a.data.scoreSexy&&a.data.scoreNeutral){var s;const c={porn:a.data.scorePorn,sexy:a.data.scoreSexy,neutral:a.data.scoreNeutral},d=Ya(s=Object.keys(c)).call(s,((m,g)=>c[m]>c[g]?m:g),"porn"),h=Object.keys(c).find((m=>m===d));this.emit(ps.INSPECT_RESULT,h)}else this.emit(ps.INSPECT_RESULT,void 0,new ke(te.UNEXPECTED_RESPONSE,a.code+"","There is an unexpected data on message"))}else this.emit(ps.INSPECT_RESULT,void 0,new ke(te.UNEXPECTED_RESPONSE,a.code+"",a.msg))}else M.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(ps.INSPECT_RESULT,void 0,new ke(te.UNEXPECTED_RESPONSE,"invalid worker message type"))})),this.workerConnection.on(pn.CLOSED,(()=>{this.connectionState=$u.CLOSED})),this.workerConnection.on(pn.FAILED,(()=>{this.connectionState=$u.CLOSED})),this.workerConnection.on(pn.RECONNECTING,(()=>{this.connectionState=this.connectionState===$u.CONNECTED?$u.RECONNECTING:$u.CONNECTING})),this.workerConnection.on(pn.WILL_RECONNECT,((r,s,a)=>{r==="recover"&&a(r),a("tryNext")})),this.workerConnection.on(pn.REQUEST_NEW_URLS,((r,s)=>{this.workerManagerConnection.close(),this.once(ps.REQUEST_NEW_WORKER_URL,(a=>{r([a])})),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then((a=>{this.connectWorkerManager(a,!0)})).catch((a=>{s(a)}))}))}async requestToInspectImage(){this.sequence++;const r=il(this,ps.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(ps.INSPECT_RESULT,void 0,new ke(te.INVALID_OPERATION,"Only the track being played can be inspected"));const a=await this.generateRequestData(r,s);this.workerConnection.sendMessage(a,!0,!0)}else this.emit(ps.INSPECT_RESULT,void 0,new ke(te.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,s){let{appId:a,cname:c,cid:d,vid:h,sid:m,uid:g}=s;const E=Date.now(),w=await r.getCurrentFrameImage("image/jpeg",this.quality),I=await X9(w,a,c),A=this.sequence+"-"+d+"-"+g+"-"+E+"-"+wr(12,""),N={appId:a,cid:d,cname:c,deviceId:"",elapse:(G=Number(E-this.inspectStartTime),{low:G|=0,high:G>>31,unsigned:G>=0}),fileSize:I.byteLength,jpgEncryption:2,height:w.height,width:w.width,jpg:I,networkType:6,osType:7,requestId:A,sdkVersion:"4.24.0",sequence:this.sequence,sid:m,timestamp:TH(E),uid:g,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var G;this.extraInfo===void 0&&delete N.callbackData,this.ossFilePrefix===void 0&&delete N.ossFilePrefix;const F=Wye(N);if(F.byteLength<this.workerMessageLengthLimit){if(oe("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const z=(function(ee){for(var Z=1;Z<arguments.length;Z++){var ae=arguments[Z]!=null?arguments[Z]:{};Z%2?gK(Object(ae),!0).forEach((function(ye){X(ee,ye,ae[ye])})):Object.getOwnPropertyDescriptors?Object.defineProperties(ee,Object.getOwnPropertyDescriptors(ae)):gK(Object(ae)).forEach((function(ye){Object.defineProperty(ee,ye,Object.getOwnPropertyDescriptor(ae,ye))}))}return ee})({},N);delete z.jpg,M.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(z))}return F}{const z=this.quality*this.qualityRatio;return this.quality=z,await this.generateRequestData(r,{appId:a,cname:c,cid:d,vid:h,sid:m,uid:g})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=ka.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=$u.CLOSED,this.emit(ps.STATE_CHANGE,Ku.CLOSED)}}const Zye={name:"ContentInspect",create:function(t){let{config:r}=t;return(function(s){if(!s)throw new ke(te.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new ke(te.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const a=[...new Set(s.inspectType)];a.forEach((c=>{var d;if(!rt(d=["supervise","moderation"]).call(d,c))throw new ke(te.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))})),s.inspectType=a}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new ke(te.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")})(r),new Qye(r)}};var _K=l(St.Object.getOwnPropertySymbols),eEe=Hn,tEe=wd.indexOf,nEe=i_,AM=ie([].indexOf),yK=!!AM&&1/AM([1],1,-0)<0;eEe({target:"Array",proto:!0,forced:yK||!nEe("indexOf")},{indexOf:function(t){var r=arguments.length>1?arguments[1]:void 0;return yK?AM(this,t,r)||0:tEe(this,t,r)}});var rEe=Sc("Array","indexOf"),iEe=O,sEe=rEe,PM=Array.prototype,oEe=function(t){var r=t.indexOf;return t===PM||iEe(PM,t)&&r===PM.indexOf?sEe:r},EK=l(oEe);function aEe(t,r){if(t==null)return{};var s,a,c=(function(h,m){if(h==null)return{};var g={};for(var E in h)if({}.hasOwnProperty.call(h,E)){if(EK(m).call(m,E)!==-1)continue;g[E]=h[E]}return g})(t,r);if(_K){var d=_K(t);for(a=0;a<d.length;a++)s=d[a],EK(r).call(r,s)===-1&&{}.propertyIsEnumerable.call(t,s)&&(c[s]=t[s])}return c}let vK=class{get localCapabilities(){return $r(this._localCapabilities)}get rtpCapabilities(){return $r(this._rtpCapabilities)}get candidates(){return $r(this._candidates)}get iceParameters(){return $r(this._iceParameters)}get dtlsParameters(){return $r(this._dtlsParameters)}constructor(t){X(this,"sessionDesc",void 0),X(this,"_localCapabilities",void 0),X(this,"_rtpCapabilities",void 0),X(this,"_candidates",void 0),X(this,"_iceParameters",void 0),X(this,"_dtlsParameters",void 0),X(this,"setup",void 0),X(this,"currentMidIndex",void 0),X(this,"cname","o/i14u9pJrxRKAsu"),X(this,"firefoxSsrcMidMap",new Map),t=$r(t);const{remoteIceParameters:r,remoteDtlsParameters:s,candidates:a,remoteRTPCapabilities:c,localCapabilities:d,direction:h,setup:m,videoCodec:g,audioCodec:E}=t;let w;this.setup=m,w=h===ha.RECEIVE_ONLY?tc(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):tc(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=a,this._iceParameters=r,this._dtlsParameters=s,this._localCapabilities=d;const I=h===ha.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,A=h===ha.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,N=h===ha.RECEIVE_ONLY?c.send.videoCodecs:mT(vt.VIDEO,I,A,g),G=h===ha.RECEIVE_ONLY?c.send.audioCodecs:mT(vt.AUDIO,I,A,E);for(const F of w.mediaDescriptions)F.attributes.iceUfrag=r.iceUfrag,F.attributes.icePwd=r.icePwd,F.attributes.fingerprints=s.fingerprints,F.attributes.candidates=a,F.attributes.setup=this.setup,F.media.mediaType==="application"&&(F.attributes.sctpPort="5000"),F.media.mediaType==="video"&&(F.media.fmts=N.map((z=>z.payloadType.toString(10))),F.attributes.payloads=N,F.attributes.extmaps=I.videoExtensions),F.media.mediaType==="audio"&&(F.media.fmts=G.map((z=>z.payloadType.toString(10))),F.attributes.payloads=G,F.attributes.extmaps=I.audioExtensions,u0(F));this.sessionDesc=w,this.currentMidIndex=w.mediaDescriptions.length-1}toString(){return Km(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every((r=>this.hasMid(r))):this.sessionDesc.mediaDescriptions.some((r=>r.attributes.mid===t))}send(t,r,s,a,c){s=s.replace(/ /g,"-");const{ssrcs:d,ssrcGroups:h}=fT(r,this.cname,oe("SYNC_GROUP")?s:void 0),m=this.findPreloadMediaDesc(d);if(m){if(ni()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const g=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const g=this.findAvailableMediaIndex(t,d,a);let E;return g===-1?(E=this.createOrRecycleSendMedia(t,d,h,"sendonly",a,c),this.updateBundleMids()):(E=$r(this.sessionDesc.mediaDescriptions[g]),E.attributes.direction="sendonly",E.attributes.ssrcs=d,E.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[g]=this.mungSendMediaDesc(E,c)),ni()&&this.firefoxSsrcMidMap.set(d[0].ssrcId,E.attributes.mid),{needExchangeSDP:!0,mid:E.attributes.mid}}}stopSending(t){const r=this.sessionDesc.mediaDescriptions.filter((s=>s.attributes.mid&&t.indexOf(s.attributes.mid)!==-1));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach((s=>{s.attributes.ssrcs=[]})),this.updateBundleMids()}receive(t,r,s){const a=[];return t.forEach((c=>{const d=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(d);let m,g=!1;h===-1?(g=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,s),this.updateBundleMids()):(m=$r(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),a.push({mid:m.attributes.mid,needCreateTransceiver:g})})),a}stopReceiving(t){const r=this.sessionDesc.mediaDescriptions.filter((s=>t.indexOf(s.attributes.mid)!==-1));if(r.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach((s=>{s.media.port="0",s.attributes.direction="inactive"})),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:r,protocol:s,address:a,port:c,type:d,relatedAddress:h,relatedPort:m,priority:g}=new RTCIceCandidate(t),E={foundation:r??"",componentId:"1",transport:s??"",priority:g?g+"":"",connectionAddress:a??"",port:c?c+"":"",type:d?d+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some((w=>w.priority===E.priority&&w.connectionAddress===E.connectionAddress&&w.port===E.port))||(this._candidates.push(E),this.sessionDesc.mediaDescriptions.forEach((w=>{w.attributes.candidates=this.candidates})))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,r,s,a,c){const d=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=mT(d,h,this.localCapabilities.send,d===vt.AUDIO?c:a),g=d===vt.VIDEO?h.videoExtensions:h.audioExtensions,E="".concat(++this.currentMidIndex);let w={media:{mediaType:d,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map((A=>A.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(E)}};w=this.mungRecvMediaDsec(w,t);const I=this.findFirstClosedMedia(d);if(I){const A=this.sessionDesc.mediaDescriptions.indexOf(I);this.sessionDesc.mediaDescriptions[A]=w}else this.sessionDesc.mediaDescriptions.push(w);return w}muteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter((s=>rt(t).call(t,s.attributes.mid||"")));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach((s=>{s.attributes.direction="inactive"}))}unmuteRemote(t){const r=this.sessionDesc.mediaDescriptions.filter((s=>rt(t).call(t,s.attributes.mid||"")));if(r.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach((s=>{s.attributes.direction="recvonly"}))}findAvailableMediaIndex(t,r,s){return this.sessionDesc.mediaDescriptions.findIndex((a=>{const c=a.media.mediaType===t&&a.media.port!=="0"&&(a.attributes.direction==="sendonly"||a.attributes.direction==="sendrecv")&&a.attributes.ssrcs.length===0;if(ni()){if(c){const d=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(d||a.attributes.mid!=="0"&&a.attributes.mid!=="1")||!(!d||d!==a.attributes.mid)}return!1}return c&&a.attributes.mid===s}))}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex((r=>{const s=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&s}))}predictReceivingMids(t){const r=[];for(let s=0;s<t;s++)r.push((this.currentMidIndex+s+1).toString(10));return r}restartICE(t){t=$r(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach((r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd}))}createOrRecycleSendMedia(t,r,s,a,c,d){const h=this.rtpCapabilities.send,m=t===vt.VIDEO?h.videoCodecs:h.audioCodecs,g=t===vt.VIDEO?h.videoExtensions:h.audioExtensions;ni()&&(c="".concat(++this.currentMidIndex));let E={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map((I=>I.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:g,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:a,rtcpMux:!0,rtcpRsize:!0,mid:c}};E=this.mungSendMediaDesc(E,d);const w=this.findFirstClosedMedia(t);if(w){const I=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[I]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}mungRecvMediaDsec(t,r,s){const a=$r(t);return A2(a),l0(a,r),P2(a,r),p7(a),K1(a,s,this.localCapabilities.send),a}mungSendMediaDesc(t,r){const s=$r(t);return K1(s,r,this.localCapabilities.recv),u0(s),s}updateRecvMedia(t,r){const s=this.sessionDesc.mediaDescriptions.findIndex((a=>a.attributes.mid===t));if(s!==-1){const a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],r);this.sessionDesc.mediaDescriptions[s]=a}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((t=>t.media.port!=="0")).map((t=>t.attributes.mid))}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find((r=>{var s;return((s=r.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===t[0].ssrcId}))}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find((r=>ni()?r.media.port==="0"&&r.media.mediaType===t:r.media.port==="0"))}};const cEe=["sdp"];var Nr;function SK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function hg(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?SK(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):SK(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}let bK=(Nr=class V0 extends YG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,s,a){super(r,s),X(this,"direction",void 0),X(this,"name",void 0),X(this,"store",void 0),X(this,"spec",void 0),X(this,"peerConnection",void 0),X(this,"initialOffer",void 0),X(this,"transport",void 0),X(this,"statsFilter",void 0),X(this,"localCandidateCount",0),X(this,"_isInRestartIce",!1),X(this,"mutex",void 0),X(this,"onLocalCandidate",void 0),X(this,"remoteSDP",void 0),X(this,"pendingCandidates",[]),X(this,"localCapabilities",void 0),X(this,"isReady",!1),X(this,"restartCnt",0),X(this,"curTurnServerIndex",0),this.store=s,this.spec=r,this.mutex=new ro("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(V0.resolvePCConfiguration(r,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=a??ha.SEND_ONLY,this.name=this.direction===ha.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=UL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,ni()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const s=await m7();if(this.localCapabilities=q1(s),r){const{sdp:a}=r,c=aEe(r,cEe),d=(function(){const w={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},I=pT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},N={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(qu(I,w,"videoExtensions",A,N,G),qu(I,w,"videoCodecs",A,N,G),qu(I,w,"audioExtensions",A,N,G),qu(I,w,"audioCodecs",A,N,G),oe("RAISE_H264_BASELINE_PRIORITY")){const F=G.videoCodecs.findIndex((z=>z.rtpMap&&z.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&z.fmtp&&z.fmtp.parameters["profile-level-id"]==="42001f"));if(F!==-1){const z=G.videoCodecs.findIndex((ee=>ee.rtpMap&&ee.rtpMap.encodingName.toLocaleLowerCase()==="h264"));if(z<F){M.debug("raising H264 baseline profile priority");const ee=G.videoCodecs[F];G.videoCodecs.splice(F,1),G.videoCodecs.splice(z,0,ee)}z!==-1&&oe("FILTER_SEND_H264_BASELINE")&&(A.videoCodecs=A.videoCodecs.filter((ee=>!(ee.rtpMap&&ee.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&ee.fmtp&&ee.fmtp.parameters["profile-level-id"]!=="42001f"))))}}return{send:A,recv:N,sendrecv:G}})({},{},a);this.remoteSDP=new vK({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Zm(h.sdp);await this.peerConnection.setLocalDescription(h);const g=await g7({},{},h.sdp);this.localCapabilities=q1(g);const E=this.peerConnection.getTransceivers()[0];return E!=null&&E.receiver&&E.receiver.transport&&this.tryBindTransportEvents(E.receiver.transport),hg(hg({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const a=await this.peerConnection.createOffer();if(!a.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Zm(a.sdp);return this.initialOffer=a,hg(hg({},c),{},{sdp:a.sdp})}}catch(s){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:s,iceParameters:a,dtlsParameters:c}=r,d=await g7({},{},s);this.remoteSDP=new vK({remoteIceParameters:a,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:d,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach((s=>{this.peerConnection.addIceCandidate(s)})),this.pendingCandidates=[])}catch(s){throw new Le(te.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(r,s,a){var c=this;return Xl((function*(){const d=yield Fn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,s,a);r.forEach(((z,ee)=>{if(m[ee].needCreateTransceiver){const Z=c.peerConnection.addTransceiver(z._mediaStreamTrack,{direction:"sendonly"});h.push(Z),z._updateRtpTransceiver(Z)}else{const Z=c.peerConnection.getTransceivers().find((ae=>ae.mid===m[ee].mid));if(!Z)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[ee].mid));h.push(Z),z._updateRtpTransceiver(Z)}})),ni()&&oe("SIMULCAST")===!0&&(yield Fn(c.applySimulcastForFirefox(h,r)));const g=m.map((z=>z.mid)),E=yield Fn(c.peerConnection.createOffer()),w=c.mungSendOfferSDP(E.sdp,r,g),I=tc(w),A=g.map((z=>{const ee=I.mediaDescriptions.find((Z=>Z.attributes.mid===z));if(!ee)throw new Error("Cannot extract ssrc from mediaDescription.");return u7(ee,oe("USE_PUB_RTX"))})),N=h.map(((z,ee)=>{const Z=g[ee];return{localSSRC:A[ee],id:Z}}));yield Fn(c.peerConnection.setLocalDescription({type:"offer",sdp:w}));try{yield N}catch(z){const ee=c.remoteSDP.toString();throw yield Fn(c.peerConnection.setLocalDescription({type:"offer",sdp:w})),yield Fn(c.peerConnection.setRemoteDescription({type:"answer",sdp:ee})),yield Fn(c.stopSending(g,!0)),z}yield Fn(c.applySimulcastEncodings(h,r)),yield Fn(c.applySendEncodings(h,r));const G=c.remoteSDP.toString(),F=c.logSDPExchange(w,"offer","local","send");return F==null||F(G),yield Fn(c.setRemoteDescription({type:"answer",sdp:G})),h.map(((z,ee)=>{const Z=g[ee];return{localSSRC:A[ee],id:Z}}))}catch(h){throw h instanceof Le?h:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{d()}}))()}async stopSending(r,s){const a=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter((g=>r.indexOf(g.mid)!==-1));if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map((g=>{var E;g.direction="inactive",(E=g.stop)===null||E===void 0||E.call(g)}));const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{a&&a()}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);if(h){const g=this.remoteSDP.toString(),E=this.logSDPExchange(g,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:g});const w=await this.peerConnection.createAnswer(),I=this.mungReceiveAnswerSDP(w.sdp,d,r);E==null||E(I||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:I}),M.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else M.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find((g=>g.mid===d));if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async mockReceive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:d,needExchangeSDP:h}=this.remoteSDP.send(r,s,a,c);if(h){const m=this.remoteSDP.toString(),g=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const E=await this.peerConnection.createAnswer(),w=this.mungReceiveAnswerSDP(E.sdp,d,r);g==null||g(w||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:w}),M.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else M.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),a=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();a==null||a(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===ey.Auto&&(this.store.p2pTransport=ey.SdRtn,Bn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(V0.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Bn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(V0.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:a}=Zm(s.sdp);return this.store.descriptionStart(),this.direction===ha.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),a}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===ha.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:a}=Zm(s.sdp);return await this.peerConnection.setLocalDescription(s),a}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const d=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Le(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getTransceivers().filter((c=>c.mid===r));a.length===1&&(this.isVP8Simulcast(s)?ni()||await this.applySimulcastEncodings(a,[s]):await this.applySendEncodings(a,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getTransceivers().find((c=>c.mid===s));a&&await a.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:a,remote:c}=s.getSelectedCandidatePair();return{local:hg(hg({},ep),{},{candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port}),remote:hg(hg({},ep),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,s;rt(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var s;r.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var d;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(Qw(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...V0.turnServerConfigToIceServers(r.turnServer.servers,s,a)),oe("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...V0.turnServerConfigToIceServers(r.turnServer.serversFromGateway,s,a)),rt(d=[ey.Relay,ey.SdRtn]).call(d,s)&&(c.iceTransportPolicy="relay"),oe("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach((h=>{h.forceturn&&(c.iceTransportPolicy="relay")})))),oe("ENABLE_ENCODED_TRANSFORM")&&Bn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),M.debug("P2PConnection p2pTransport is ".concat(s)),c}static turnServerConfigToIceServers(r,s){let a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],d=r.filter((m=>m.tcpport));M.debug("P2PConnection turnServers is ".concat(d,", current index is ").concat(a));const h=d.length>a?d[a]:d[0];switch(s){case ey.SdRtn:const m=r.filter((E=>{var w;return rt(w=E.username).call(w,"glb:")&&E.turnServerURL==E.turnServerURL})),g=m.length>a?m[a]:m[0];g&&(c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(Jm(g.turnServerURL),":").concat(g.tcpport,"?transport=udp")}),c.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(Jm(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}));break;case ey.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Jm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Jm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var a;r!=null&&r.state&&((a=this.onDTLSTransportStateChange)===null||a===void 0||a.call(this,r.state))},r.onerror=a=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in a?a.error:a)};const s=r.iceTransport;s&&(s.onstatechange=()=>{const a=r==null?void 0:r.iceTransport.state;var c;a&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,a))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:a,remote:c}=s.getSelectedCandidatePair()||{};if(a&&c){const d=a.address+":"+a.port,h=c.address+":"+c.port;M.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(cy(d)),", remote ").concat(JSON.stringify(cy(h))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var a;if(s||(s=this.peerConnection.getSenders().find((w=>w.track===r._mediaStreamTrack))),!s)return M.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return M.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Bn().supportSetRtpSenderParameters)return M.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},d={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:w,frameRate:I,scaleResolutionDownBy:A}=r._encoderConfig;w&&(d.maxBitrate=1e3*w),rt(h=r._hints).call(h,Sr.LOW_STREAM)&&(I&&(d.maxFramerate=kc(I)),A&&A>=1&&(d.scaleResolutionDownBy=A))}if(oe("DSCP_TYPE")&&ff()){var m;const w=oe("DSCP_TYPE");rt(m=["very-low","low","medium","high"]).call(m,w)&&(d.networkPriority=w)}const g=s.getParameters(),E=(a=g.encodings)===null||a===void 0?void 0:a[0];ni()&&!E&&(c.encodings=[d]),E&&Object.assign(E,d),Object.assign(g,c),M.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(g.encodings))),await s.setParameters(g)}async applySendEncodings(r,s){try{if(!Bn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],d=s[a];d instanceof kr&&!this.isVP8Simulcast(d)&&await this.updateRtpSenderEncodings(d,c.sender)}}catch{M.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,a){const c=tc(r);return s.forEach(((d,h)=>{const m=a[h],g=c.mediaDescriptions.find((E=>E.attributes.mid===m));g&&(l0(g,d),f7(g,d,this.store.codec))})),Km(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let g=0;g<r.length;g++){var a,c,d,h,m;const E=r[g],w=s[g];if(w instanceof kr&&!rt(a=w._hints).call(a,Sr.LOW_STREAM)&&(c=w._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((d=w._encoderConfig)===null||d===void 0?void 0:d.bitrateMax)>200&&(h=w._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=w._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const I={},A={high:1e3*(w._encoderConfig.bitrateMax-50),medium:5e4};I.encodings=[{rid:"m",active:!0,maxBitrate:A.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:A.high}];const N=E.sender.getParameters();await E.sender.setParameters(Object.assign(N,I))}}}async applySimulcastEncodings(r,s){if(!ni()&&r.length===s.length)for(let a=0;a<r.length;a++){const c=s[a];if(c instanceof kr&&this.isVP8Simulcast(c)){const d=r[a],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const g=d.sender.getParameters();await d.sender.setParameters(Object.assign(g,h))}}}isVP8Simulcast(r){var s,a,c,d,h;return!!(r instanceof kr&&oe("SIMULCAST")&&this.store.codec==="vp8"&&!rt(s=r._hints).call(s,Sr.LOW_STREAM)&&(a=r._encoderConfig)!==null&&a!==void 0&&a.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(d=r._scalabilityMode)!==null&&d!==void 0&&d.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,a,c){if(oe("SDP_LOGGING"))return M.upload("[".concat(this.store.clientId,"] exchanging ").concat(a," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?d=>{this.logSDPExchange(d,"answer",a==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter((h=>h.mid&&r.indexOf(h.mid)!==-1));if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map((h=>{h.direction="inactive"}));const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.muteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter((h=>h.mid&&r.indexOf(h.mid)!==-1));if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map((async h=>{h.direction="sendonly"}));const a=await this.peerConnection.createOffer(),c=this.logSDPExchange(a.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(a),this.remoteSDP.unmuteRemote(r);const d=this.remoteSDP.toString();c==null||c(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(r,s){var a;if(s=s??((a=this.currentRemoteDescription)===null||a===void 0?void 0:a.sdp)){var c;const d=(c=tc(s).mediaDescriptions.find((h=>h.attributes.mid===r)))===null||c===void 0?void 0:c.attributes.ssrcs;return d==null?void 0:d[0].ssrcId}}async setRemoteDescription(r){var s;await this.peerConnection.setRemoteDescription(r),rt(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,s,a){const c=tc(r),d=c.mediaDescriptions.find((h=>h.attributes.mid===s));return d&&a===vt.AUDIO&&d.media.mediaType==="audio"&&u0(d),Km(c)}},Rt(Nr.prototype,"establish",[Zu],Object.getOwnPropertyDescriptor(Nr.prototype,"establish"),Nr.prototype),Rt(Nr.prototype,"connect",[Zu],Object.getOwnPropertyDescriptor(Nr.prototype,"connect"),Nr.prototype),Rt(Nr.prototype,"receive",[Zu],Object.getOwnPropertyDescriptor(Nr.prototype,"receive"),Nr.prototype),Rt(Nr.prototype,"mockReceive",[Zu],Object.getOwnPropertyDescriptor(Nr.prototype,"mockReceive"),Nr.prototype),Rt(Nr.prototype,"stopReceiving",[Zu],Object.getOwnPropertyDescriptor(Nr.prototype,"stopReceiving"),Nr.prototype),Rt(Nr.prototype,"restartICE",[Zu],Object.getOwnPropertyDescriptor(Nr.prototype,"restartICE"),Nr.prototype),Rt(Nr.prototype,"close",[Zu],Object.getOwnPropertyDescriptor(Nr.prototype,"close"),Nr.prototype),Rt(Nr.prototype,"updateEncoderConfig",[Zu],Object.getOwnPropertyDescriptor(Nr.prototype,"updateEncoderConfig"),Nr.prototype),Rt(Nr.prototype,"updateSendParameters",[Zu],Object.getOwnPropertyDescriptor(Nr.prototype,"updateSendParameters"),Nr.prototype),Rt(Nr.prototype,"replaceTrack",[Zu],Object.getOwnPropertyDescriptor(Nr.prototype,"replaceTrack"),Nr.prototype),Rt(Nr.prototype,"muteLocal",[Zu],Object.getOwnPropertyDescriptor(Nr.prototype,"muteLocal"),Nr.prototype),Rt(Nr.prototype,"unmuteLocal",[Zu],Object.getOwnPropertyDescriptor(Nr.prototype,"unmuteLocal"),Nr.prototype),Nr);function Zu(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}let th=(function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t})({});var wK,TK,CK,RK,IK,AK,PK,OK,kK,NK,xK,Kr;function DK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function kP(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?DK(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):DK(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}let lEe=(wK=nh(th.SEND_ONLY),TK=nh(th.SEND_ONLY),CK=nh(),RK=nh(th.RECEIVE_ONLY),IK=nh(th.RECEIVE_ONLY),AK=nh(th.RECEIVE_ONLY),PK=nh(th.RECEIVE_ONLY),OK=nh(th.RECEIVE_ONLY),kK=nh(th.RECEIVE_ONLY),NK=nh(),xK=nh(th.RECEIVE_ONLY),Kr=class extends Qr{get state(){return this._state}set state(t){const r=this._state;this._state=t,this.emit(Lt.StateChange,r,this._state)}constructor(t,r){super(),X(this,"isPlanB",!1),X(this,"store",void 0),X(this,"statsUploader",void 0),X(this,"sendConnection",void 0),X(this,"recvConnection",void 0),X(this,"localTrackMap",new Map),X(this,"remoteUserMap",new Map),X(this,"localDataChannels",[]),X(this,"pendingLocalTracks",[]),X(this,"pendingRemoteTracks",[]),X(this,"statsCollector",void 0),X(this,"dtlsFailedCount",0),X(this,"sendMutex",void 0),X(this,"recvMutex",void 0),X(this,"_state",or.Disconnected),X(this,"_restartStates",["disconnected","failed"]),X(this,"reconnectInterval",void 0),X(this,"uploadUnplinkStarted",!1),X(this,"uploadDownlinkStarted",!1),X(this,"uplinkStateUploadInterval",void 0),X(this,"downlinkStatsUploadInterval",void 0),X(this,"handleMuteLocalTrack",(async(s,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==or.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const g=this.filterTobeMutedTracks(s);if(g.length===0)return void a();const E=g.find((N=>N[0]==="videoLowTrack"));E&&E[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(g.map((N=>{let[,{id:G}]=N;return G})));let w=!1;var h,m;s.trackMediaType==="video"?w=!((h=this.localTrackMap.get(Xe.LocalAudioTrack))===null||h===void 0||!h.track._muted):w=((m=this.localTrackMap.get(Xe.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const I=this.createMuteMessage(g);await br(this,Lt.RequestMuteLocal,I);const A=s.trackMediaType==="video"?Xm.MUTE_LOCAL_VIDEO:Xm.MUTE_LOCAL_AUDIO;await br(this,Lt.RequestP2PMuteLocal,{action:A,message:I,isMuteAll:w}),a()}catch(g){c(g)}finally{d()}})),X(this,"handleUnmuteLocalTrack",(async(s,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==or.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void a();await this.sendConnection.unmuteLocal(h.map((E=>{let[,{id:w}]=E;return w})));const m=this.createUnmuteMessage(h),g=s.trackMediaType==="video"?Xm.UNMUTE_LOCAL_VIDEO:Xm.UNMUTE_LOCAL_AUDIO;await br(this,Lt.RequestP2PMuteLocal,{action:g,message:m}),a()}catch(h){c(h)}finally{d()}})),X(this,"handleUpdateVideoEncoder",(async(s,a,c,d)=>{let h;typeof d=="boolean"&&d||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const g=this.localTrackMap.get(Xe.LocalVideoTrack);if(!this.sendConnection||!g||g.track!==s||this.state!==or.Connected)return void a();const{id:E,track:w}=g;E&&(await this.sendConnection.updateSendParameters(E,w),await this.sendConnection.updateEncoderConfig(E,w),this.emit(Lt.UpdateVideoEncoder,w)),a()}catch(g){c(g)}finally{var m;(m=h)===null||m===void 0||m()}})),X(this,"handleUpdateVideoSendParameters",(async(s,a,c)=>{const d=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Xe.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==s||this.state!==or.Connected)return void a();const{id:m,track:g}=h;m&&await this.sendConnection.updateSendParameters(m,g),a()}catch(h){c(h)}finally{d()}})),X(this,"handleReplaceTrack",(async(s,a,c,d)=>{let h;M.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof d=="boolean"&&d||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const E=Array.from(this.localTrackMap.entries()).find((w=>{let[,{track:I}]=w;return s===I}));if(!this.sendConnection||!E||E[1].id===void 0||this.state!==or.Connected)return void a();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(s,E[1].id)),E[0]===Xe.LocalVideoTrack&&Bn().supportDualStreamEncoding){const w=this.localTrackMap.get(Xe.LocalVideoLowTrack);if(w){const I=s._mediaStreamTrack.clone();w.track._originMediaStreamTrack.stop(),w.track._mediaStreamTrack=I,w.track._originMediaStreamTrack=I,await new mt(((A,N)=>{this.handleReplaceTrack(w.track,A,N,!0)}))}}a()}catch(E){c(E)}finally{var g;(g=h)===null||g===void 0||g()}})),X(this,"handleGetLocalVideoStats",(s=>{s(this.statsCollector.getLocalVideoTrackStats())})),X(this,"handleGetLocalAudioStats",(s=>{s(this.statsCollector.getLocalAudioTrackStats())})),X(this,"handleGetRemoteVideoStats",(s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid])),X(this,"handleGetRemoteAudioStats",(s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid])),this.store=t,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new J7(t),this.bindStatsUploaderEvents(),this.sendMutex=new ro("P2PChannel2-send-mutex",t.clientId),this.recvMutex=new ro("P2PChannel2-recv-mutex",t.clientId),this.reconnectInterval=window.setInterval((()=>{[this.sendConnection,this.recvConnection].forEach((s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))}))}),oe("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,r){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,r){let s;try{if(r){this.recvConnection&&(M.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new bK(t,this.store,ha.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const a=await this.recvConnection.establish(r);return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}{this.state=or.New,this.sendConnection&&(M.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new bK(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const a=await this.sendConnection.establish();return{iceParameters:a.iceParameters,dtlsParameters:a.dtlsParameters,sdp:a.sdp}}}finally{s&&s()}}async p2pConnect(t){if(!this.sendConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=or.Connected}async addRemoteCandidate(t,r){if(r===ha.RECEIVE_ONLY){if(!this.sendConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,r,s){var a=this;return Xl((function*(){const c=yield Fn(a.sendMutex.lock("From P2PChannel.publish"));try{if(!a.sendConnection||a.state!==or.Connected){a.throwIfTrackTypeNotMatch(t);const E=t.filter((w=>a.pendingLocalTracks.indexOf(w)===-1));return void(a.pendingLocalTracks=a.pendingLocalTracks.concat(E))}a.store.pubId=a.store.pubId+1,ao.markPublishStart(a.store.clientId,a.store.pubId);const d=a.filterTobePublishedTracks(t,r,s);if(d.length===0)return void(yield Fn(a.tryToUnmuteAudio(t)));d.forEach((E=>{let{track:w,type:I}=E;const A=Date.now();a.store.publish(w.getTrackId(),I===Xe.LocalAudioTrack?"audio":"video",A)})),a.bindLocalTrackEvents(d);const h=yield Fn(a.sendConnection.send(d.map((E=>{let{track:w}=E;return w})),a.store.codec,a.store.audioCodec)),m=(yield Fn(h.next())).value,g=a.createGatewayPublishMessage(d,m);try{yield g}catch(E){throw h.throw(E),(E==null?void 0:E.code)===te.WS_ABORT&&d.forEach((w=>{let{track:I}=w;a.pendingLocalTracks.indexOf(I)===-1&&a.pendingLocalTracks.push(I)})),a.unbindLocalTrackEvents(d),E}yield Fn(h.next()),d.forEach((E=>{let{type:w}=E;a.statsCollector.addLocalStats(w)})),a.statsUploader.startUploadOutboundStats(),a.assignLocalTracks(d,m),d.forEach((E=>{let{track:w,type:I}=E;const A=Date.now();a.store.publish(w.getTrackId(),I===Xe.LocalAudioTrack?"audio":"video",void 0,A)})),a.startUploadUplinkState()}finally{c()}}))()}async unpublish(t){if(!this.sendConnection||this.state!==or.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter((c=>!rt(t).call(t,c))));const r=this.filterTobeUnpublishedTracks(t);if(r.length===0)return;const s=r.find((c=>c[0]==="videoLowTrack"));s&&s[1].track.close();const a=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map((c=>{let[,{id:d}]=c;return d}))),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map((c=>{let[d,{track:h}]=c;return{type:d,track:h}}))),r.forEach((c=>{let[d]=c;this.statsCollector.removeLocalStats(d)})),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===or.Connected)return s&&s[1].track.close(),a;t.forEach((c=>{const d=this.pendingLocalTracks.indexOf(c);d!==-1&&this.pendingLocalTracks.splice(d,1)}))}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const r=[],s=[];Array.from(this.localTrackMap.entries()).forEach((a=>{let[c,{track:d,ssrcs:h}]=a;const m={stream_type:t_e(d,c),ssrcs:h};d._muted||!d._enabled?r.push(m):s.push(m)})),r.length>0&&r.forEach((a=>{br(this,Lt.RequestMuteLocal,[a])})),s.length>0&&s.forEach((a=>{br(this,Lt.RequestUnmuteLocal,[a])}))};t(),this.uplinkStateUploadInterval=window.setInterval((()=>{t()}),3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Xl((function*(){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")}))()}async republish(){this.pendingLocalTracks.length>0&&(M.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Fs(this,Lt.RequestRePublish,this.pendingLocalTracks),this.emit(Lt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,r,s,a){var c;if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(t))!==null&&c!==void 0&&c.has(r))return;const{track:d,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:s}],String(t.uid),a);r===vt.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(d):(t._audioTrack=new t0(d,t.uid,t._uintid,this.store),M.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),m&&t._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=s,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(d):(t._videoTrack=new e0(d,t.uid,t._uintid,this.store),M.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),m&&t._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(t,t._videoTrack));const g=this.remoteUserMap.get(t);g?g.set(r,h):this.remoteUserMap.set(t,new Map([[r,h]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const E=this.pendingRemoteTracks.findIndex((w=>{let{user:I,kind:A}=w;return I.uid===t.uid&&r===A}));E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(Lt.MediaReconnectEnd,t.uid))}async mockSubscribe(t,r,s,a){if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:s}],String(t.uid),a)}async unsubscribe(t,r,s){const a=this.pendingRemoteTracks.filter((d=>{let{user:h,kind:m}=d;return r!==void 0?h.uid===t.uid&&r===m:h.uid===t.uid}));if(a.forEach((d=>{const h=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(h,1)})),this.recvConnection||s||a.forEach((d=>{let{kind:h}=d;var m;if(h===vt.AUDIO)(m=t._audioTrack)===null||m===void 0||m._destroy(),t._audioTrack=void 0;else if(h===vt.VIDEO){var g;(g=t._videoTrack)===null||g===void 0||g._destroy(),t._videoTrack=void 0}})),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(t,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map((d=>{let[,{id:h}]=d;return h}))),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach((d=>{let[h,{kind:m}]=d;var g,E;if(m===vt.VIDEO&&h._videoSSRC&&((g=this.recvConnection)===null||g===void 0||g.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===vt.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),s||((E=h._videoTrack)===null||E===void 0||E._destroy(),h._videoTrack=void 0);else if(m===vt.AUDIO){var w;this.unbindRemoteTrackEvents(h._audioTrack),!s&&((w=h._audioTrack)===null||w===void 0||w._destroy(),h._audioTrack=void 0)}})),c.forEach((d=>{let[,{kind:h}]=d;br(this,Lt.RequestP2PMuteRemote,h)})))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach((r=>{let[,s]=r;[vt.VIDEO,vt.AUDIO].forEach((a=>{s.has(a)?br(this,Lt.RequestP2PUnmuteRemote,a):br(this,Lt.RequestP2PMuteRemote,a)}))}));t(),this.downlinkStatsUploadInterval=window.setInterval((()=>{t()}),3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void M.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!s.get(r))return void M.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."));const a=r===vt.VIDEO?t._videoSSRC:t._audioSSRC;a!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(a,!1)}async unmuteRemote(t,r){return this.unmuteRemoteNoLock(t,r)}async unmuteRemoteNoLock(t,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(t);if(!s)return void M.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));s.get(r)||M.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(r,"."))}getAllTracks(t){const r=this.localTrackMap.get(Xe.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Fi){const s=r.track;return Array.from(this.localTrackMap.entries()).filter((a=>{let[c]=a;return c!==Xe.LocalAudioTrack})).filter((a=>{let[c]=a;return!(t&&c===Xe.LocalVideoLowTrack)})).map((a=>{let[,{track:c}]=a;return c})).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter((s=>{let[a]=s;return!(t&&a===Xe.LocalVideoLowTrack)})).map((s=>{let[,{track:a}]=s;return a}))}reportPublishEvent(t,r,s,a,c){if(t){const h=this.localTrackMap.get(Xe.LocalAudioTrack),m=a?this.localTrackMap.get(Xe.LocalVideoLowTrack):this.localTrackMap.get(Xe.LocalVideoTrack);It.publish(this.store.sessionId,{eventElapse:ao.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(Sr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var d;s||(s=[]);const h=s.find((g=>g instanceof ci)),m=a?(d=this.localTrackMap.get(Xe.LocalVideoTrack))===null||d===void 0?void 0:d.track:s.find((g=>g instanceof kr));It.publish(this.store.sessionId,{eventElapse:ao.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(Sr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(t,r,s,a){const c=a===vt.VIDEO?s._videoSSRC:s._audioSSRC;c&&It.subscribe(this.store.sessionId,{succ:t,ec:r,video:a===vt.VIDEO,audio:a===vt.AUDIO,peerid:s.uid,subscribeRequestid:a===vt.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:ao.measureFromSubscribeStart(this.store.clientId,c)})}reset(){M.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new ro("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new ro("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(Xe.LocalAudioTrack);if((t==null?void 0:t.track)instanceof Fi){if(t.track.trackList.length>0){const r=t.track;t.track.trackList.forEach((s=>{r.removeAudioTrack(s)}))}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=or.Disconnected}getStats(t){var r,s;return t?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(t){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(Xe.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(Xe.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const r=this.localTrackMap.get(t);return r&&r.track instanceof kr||r&&r.track instanceof ci?r.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(t,r){if(!t)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(t);return!!s&&(!r||s.has(r))}getRemoteMedia(t){var r;const s=Array.from(nc(r=this.remoteUserMap).call(r)).find((a=>a.uid===t));return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map((s=>{let[a]=s;return{uid:a.uid,level:a.audioTrack?100*a.audioTrack._source.getAccurateVolumeLevel():0}}));const r=this.localTrackMap.get(Xe.LocalAudioTrack);return r&&t.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=z_(t).call(t,((s,a)=>s.level-a.level)),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(M.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=or.Reconnecting,oe("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((t=>{let[r]=t;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())})),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach((t=>{var r;let[s,{track:a}]=t;switch(s){case Xe.LocalVideoTrack:rt(r=a._hints).call(r,Sr.LOW_STREAM)?a.close():this.pendingLocalTracks.push(a);break;case Xe.LocalAudioTrack:a instanceof Fi?this.pendingLocalTracks=this.pendingLocalTracks.concat(a.trackList):this.pendingLocalTracks.push(a);case Xe.LocalVideoLowTrack:}})),this.emit(Lt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((t=>{let[r,s]=t;Array.from(nc(s).call(s)).forEach((a=>{this.setPendingRemoteMedia(r,a)})),this.emit(Lt.MediaReconnectStart,r.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),M.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,r){for(const s of this.pendingRemoteTracks){const{user:a,kind:c}=s;if((t instanceof rg?t.uid:t)===a.uid&&r===c)return!0}return!1}setPendingRemoteMedia(t,r){this.hasPendingRemoteMedia(t,r)||this.pendingRemoteTracks.push({user:t,kind:r})}async restartICE(t,r){let s,a;if(t===ha.SEND_ONLY){if(!this.sendConnection)throw new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),a=this.sendConnection}else{if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),a=this.recvConnection}try{if(r){const c=await a.restartICE(r);return a.isInRestartIce=!1,c}{const c=await a.restartICE();if(c){const d=await Fs(this,Lt.RequestP2PRestartICE,{direction:ha.RECEIVE_ONLY,iceParameter:c});await a.restartICE(d),a.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),r=this.localTrackMap.get(Xe.LocalVideoTrack),s=this.localTrackMap.get(Xe.LocalAudioTrack),a=t.videoSend.find((N=>{var G;return N.ssrc===(r==null||(G=r.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)})),c=t.audioSend.find((N=>{var G;return N.ssrc===(s==null||(G=s.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)}));if(!a||!c)return 1;const d=il(this,Lt.NeedSignalRTT),h=a?a.rttMs:void 0,m=c?c.rttMs:void 0,g=h&&m?(h+m)/2:h||m,E=(g&&d?(g+d)/2:g||d)||0,w=100*t.sendPacketLossRate*.7/50+.3*E/1500,I=w<.17?1:w<.36?2:w<.59?3:w<.1?4:5,A=r==null?void 0:r.track;if(A&&A._encoderConfig&&A._hints.indexOf(Sr.SCREEN_TRACK)===-1){const N=A._encoderConfig.bitrateMax,G=t.bitrate.actualEncoded;if(N&&G){const F=(1e3*N-G)/(1e3*N);return BG[F<.15?0:F<.3?1:F<.45?2:F<.6?3:4][I]}}return I}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach((s=>{let[a]=s;const c=a._audioSSRC,d=a._videoSSRC,h=t.audioRecv.find((G=>G.ssrc===c)),m=t.videoRecv.find((G=>G.ssrc===d));if(!h&&!m)return void(r+=1);const g=il(this,Lt.NeedSignalRTT),E=t.rtt,w=(E&&g?(E+g)/2:E||g)||0,I=h?h.jitterMs:void 0,A=t.recvPacketLossRate;let N=.7*A*100/50+.3*w/1500;I&&(N=.6*A*100/50+.2*w/1500+.2*I/400),r+=N<.1?1:N<.17?2:N<.36?3:N<.59?4:5})),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(t){return new mt(((r,s)=>{this.handleMuteLocalTrack(t,r,s)}))}filterTobePublishedTracks(t,r,s){const a=[],c=Bn(),d=this.getAllTracks();t=Bv(t=t.filter((g=>d.indexOf(g)===-1)));let h=!1,m=!1;for(const g of t){if(g instanceof kr&&(this.localTrackMap.has(Xe.LocalVideoTrack)||h?new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(a.push({track:g,type:Xe.LocalVideoTrack}),h=!0),r)){const E=this.getLowVideoTrack(g,s);a.push({track:E,type:Xe.LocalVideoLowTrack})}if(g instanceof ci){const E=this.localTrackMap.get(Xe.LocalAudioTrack);if(E){if(!(E.track instanceof Fi))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(g),this.bindLocalAudioTrackEvents(g,!0)}else if(m){const w=a.find((I=>{let{type:A}=I;return A===Xe.LocalAudioTrack}));if(!(w.track instanceof Fi))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(g._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");w.track.addAudioTrack(g)}else{if(!c.webAudioMediaStreamDest||g instanceof Fi||g._bypassWebAudio)a.push({track:g,type:Xe.LocalAudioTrack});else{const w=new Fi;w.addAudioTrack(g),a.push({track:w,type:Xe.LocalAudioTrack})}m=!0}}}return a}filterTobeUnpublishedTracks(t){const r=[],s=this.getAllTracks();t=Bv(t=t.filter((a=>s.indexOf(a)!==-1)));for(const a of t){if(a instanceof ci){const c=this.localTrackMap.get(Xe.LocalAudioTrack);if(!c)continue;c.track instanceof Fi?(c.track.removeAudioTrack(a),this.unbindLocalAudioTrackEvents(a),c.track.trackList.length===0&&(r.push([Xe.LocalAudioTrack,c]),c.track.close())):r.push([Xe.LocalAudioTrack,c])}if(a instanceof kr){const c=this.localTrackMap.get(Xe.LocalVideoTrack);if(!c)continue;r.push([Xe.LocalVideoTrack,c]);const d=this.localTrackMap.get(Xe.LocalVideoLowTrack);d&&r.push([Xe.LocalVideoLowTrack,d])}}return r}bindLocalTrackEvents(t){t.forEach((r=>{let{track:s,type:a}=r;switch(a){case Xe.LocalVideoTrack:s.addListener(wt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(wt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(wt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(wt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Xe.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Xe.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(t,r){t instanceof Fi?t.trackList.forEach((s=>{s.addListener(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(wt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(t.addListener(wt.GET_STATS,this.handleGetLocalAudioStats),t.addListener(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||t.addListener(wt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map((r=>{let[s,{track:a}]=r;return{track:a,type:s}}))),t.forEach((r=>{let{track:s,type:a}=r;switch(a){case Xe.LocalVideoTrack:s.off(wt.GET_STATS,this.handleGetLocalVideoStats),s.off(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(wt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(wt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(wt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Xe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Xe.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(t){t instanceof Fi?t.trackList.forEach((r=>{r.off(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(wt.GET_STATS,this.handleGetLocalAudioStats),r.off(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(t.off(wt.GET_STATS,this.handleGetLocalAudioStats),t.off(wt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(wt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(wt.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(wt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(wt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,r){r instanceof e0&&r.addListener(wt.GET_STATS,(s=>{s(this.handleGetRemoteVideoStats(t))})),r instanceof t0&&r.addListener(wt.GET_STATS,(s=>{s(this.handleGetRemoteAudioStats(t))}))}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(wt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((t=>{let[r,s]=t;s.has(vt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(vt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)}))}createGatewayPublishMessage(t,r){return t.map(((s,a)=>{var c;let d,{track:h,type:m}=s;switch(m){case Xe.LocalAudioTrack:d=cr.Audio;break;case Xe.LocalVideoTrack:d=rt(c=h._hints).call(c,Sr.SCREEN_TRACK)?cr.Screen:cr.High;break;case Xe.LocalVideoLowTrack:d=cr.Low}return{kind:m===Xe.LocalAudioTrack?vt.AUDIO:vt.VIDEO,stream_type:d,mid:r[a].id,ssrcs:r[a].localSSRC,isMuted:h.muted||!h.enabled}}))}createGatewayUnpublishMessage(t){return t.map((r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalVideoTrack:a=rt(s=d._hints).call(s,Sr.SCREEN_TRACK)?cr.Screen:cr.High;break;case Xe.LocalAudioTrack:a=cr.Audio;break;case Xe.LocalVideoLowTrack:a=cr.Low}return{stream_type:a,ssrcs:h,mid:m}}))}assignLocalTracks(t,r){t.forEach(((s,a)=>{let{track:c,type:d}=s;this.localTrackMap.set(d,{track:c,id:r[a].id,ssrcs:r[a].localSSRC})}))}withdrawLocalTracks(t){t.forEach((r=>{let[s]=r;this.localTrackMap.delete(s)}))}bindConnectionEvents(t){t.onConnectionStateChange=async r=>{var s;M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(r,")")),this.emit(Lt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(t.isInRestartIce=!1),rt(s=this._restartStates).call(s,r)&&!t.isInRestartIce&&(r==="disconnected"&&await bs(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),It.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Hr.TRACER}).onSuccess(),this.emit(Lt.IceConnectionStateChange,r)},t.onICETransportStateChange=r=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},t.onDTLSTransportStateChange=r=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},t.onDTLSTransportError=r=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},t.onFirstAudioDecoded=r=>{var s;const a=Array.from(nc(s=this.remoteUserMap).call(s)).find((d=>d._audioSSRC===r));var c;a&&(this.store.subscribe(a.uid,"audio",void 0,void 0,void 0,Date.now()),(c=a.audioTrack)===null||c===void 0||c.emit(Zl.FIRST_FRAME_DECODED),It.firstRemoteFrame(this.store.sessionId,Xi.FIRST_AUDIO_DECODE,jr.FIRST_AUDIO_DECODE,{peer:a._uintid,subscribeElapse:ao.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=r=>{var s;const a=Array.from(nc(s=this.remoteUserMap).call(s)).find((c=>c._audioSSRC===r));a&&It.firstRemoteFrame(this.store.sessionId,Xi.FIRST_AUDIO_RECEIVED,jr.FIRST_AUDIO_RECEIVED,{peer:a._uintid,subscribeElapse:ao.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(r,s,a)=>{this.reportVideoFirstFrameDecoded(r,s,a)},t.onFirstVideoReceived=r=>{var s;const a=Array.from(nc(s=this.remoteUserMap).call(s)).find((c=>c._videoSSRC===r));a&&It.firstRemoteFrame(this.store.sessionId,Xi.FIRST_VIDEO_RECEIVED,jr.FIRST_VIDEO_RECEIVED,{peer:a._uintid,subscribeElapse:ao.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(r,s)=>{const a=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&a===c||this.emit(Lt.ConnectionTypeChange,a),M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Qm(s))," -> ").concat(JSON.stringify(Qm(r)),")"))},t.onSelectedRemoteCandidateChanged=(r,s)=>{M.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Qm(s))," -> ").concat(JSON.stringify(Qm(r)),")"))},t.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},t.onLocalCandidate=r=>{this.emit(Lt.LocalCandidate,{candidate:r,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const r=t===ha.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,M.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),t===ha.SEND_ONLY?this.restartICE(t):Fs(this,Lt.RequestP2PRestartICE,{direction:ha.SEND_ONLY}))}filterTobeMutedTracks(t){const r=[];if(this.getAllTracks().indexOf(t)===-1)return r;const s=this.localTrackMap.get(Xe.LocalAudioTrack);if(t instanceof ci&&(s==null?void 0:s.track)instanceof Fi)return s.track.isActive||r.push([Xe.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find((c=>{let[,{track:d}]=c;return t===d}));if(a&&(r.push(a),a[0]===Xe.LocalVideoTrack)){const c=this.localTrackMap.get(Xe.LocalVideoLowTrack);c&&r.push([Xe.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(t){const r=[],s=this.localTrackMap.get(Xe.LocalAudioTrack);if(t instanceof ci&&(s==null?void 0:s.track)instanceof Fi)return s.track.isActive&&r.push([Xe.LocalAudioTrack,s]),r;const a=Array.from(this.localTrackMap.entries()).find((c=>{let[,{track:d}]=c;return t===d}));if(a)if(a[0]===Xe.LocalVideoTrack){r.push(a);const c=this.localTrackMap.get(Xe.LocalVideoLowTrack);c&&r.push([Xe.LocalVideoLowTrack,c])}else r.push(a);return r}createMuteMessage(t){return t.map((r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalAudioTrack:a=cr.Audio;break;case Xe.LocalVideoTrack:a=rt(s=d._hints).call(s,Sr.SCREEN_TRACK)?cr.Screen:cr.High;break;case Xe.LocalVideoLowTrack:a=cr.Low}return{stream_type:a,ssrcs:h,mid:m}}))}createUnmuteMessage(t){return t.map((r=>{var s;let a,[c,{track:d,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalAudioTrack:a=cr.Audio;break;case Xe.LocalVideoTrack:a=rt(s=d._hints).call(s,Sr.SCREEN_TRACK)?cr.Screen:cr.High;break;case Xe.LocalVideoLowTrack:a=cr.Low}return{stream_type:a,ssrcs:h,mid:m}}))}filterTobeUnSubscribedTracks(t,r){const s=[],a=this.remoteUserMap.get(t);if(!a)return s;if(r){const c=a.get(r);if(!c)return s;s.push([t,{kind:r,id:c}])}else Array.from(a.entries()).forEach((c=>{let[d,h]=c;s.push([t,{kind:d,id:h}])}));return s}createUnsubscribeMessage(t){const r=[];return t.forEach((s=>{let[a,{kind:c,id:d}]=s;switch(c){case vt.VIDEO:return void(a._videoSSRC&&r.push({stream_type:vt.VIDEO,ssrcId:a._videoSSRC}));case vt.AUDIO:return void(a._audioSSRC&&r.push({stream_type:vt.AUDIO,ssrcId:a._audioSSRC}))}})),r}withdrawRemoteTracks(t){t.forEach((r=>{let[s,{kind:a}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(a),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))}))}async updateBitrateLimit(t){const r=this.localTrackMap.get(Xe.LocalVideoTrack),s=this.localTrackMap.get(Xe.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(t.uplink),await new mt(((a,c)=>{this.handleUpdateVideoEncoder(r.track,a,c,!0)}))),s&&t.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0}),await new mt(((a,c)=>{this.handleUpdateVideoEncoder(s.track,a,c,!0)})))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return t!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(t){for(let r=0;r<t.length;r++)if(t[r]instanceof ci){const s=this.filterTobeUnmutedTracks(t[r]);if(s.length===0)continue;const a=this.createUnmuteMessage(s);return void await br(this,Lt.RequestUnmuteLocal,a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter((t=>{let[,{ssrcs:r}]=t;return!!r})),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,r)=>this.emit(Lt.RequestUpload,t,r),this.statsUploader.requestUploadStats=t=>this.emit(Lt.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await bs(kL(this.dtlsFailedCount,Ni)),this.emit(Lt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Xe.LocalVideoTrack)||this.pendingLocalTracks.some((t=>t instanceof kr))}throwIfTrackTypeNotMatch(t){if(t.filter((r=>r instanceof kr)).length>1)throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter((r=>r instanceof ci)).length>1&&(t.some((r=>r instanceof ci&&r._bypassWebAudio))||!Bn().webAudioMediaStreamDest))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of t){if(r instanceof kr&&this.pendingLocalTracks.some((s=>s instanceof kr)))throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof ci&&this.pendingLocalTracks.some((s=>s instanceof ci))&&(!Bn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some((s=>s instanceof ci&&s._bypassWebAudio))))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,r){const s=!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Bn().supportDualStreamEncoding,a=kP(kP({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=s?t._mediaStreamTrack.clone():K2(t,a);const d=wr(8,"track-low-"),h=new kr(c,kP(kP({},s&&{scaleResolutionDownBy:I2(a,t)}),{},{frameRate:a.framerate,bitrateMax:a.bitrate,bitrateMin:a.bitrate}),void 0,void 0,d);return h.on(ty.TRANSCEIVER_UPDATED,(m=>{t._updateRtpTransceiver(m,qv.LOW_STREAM)})),h._hints.push(Sr.LOW_STREAM),t.addListener(wt.NEED_CLOSE,(()=>{h.close()})),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,r,s,a){var c;const d=Array.from(nc(c=this.remoteUserMap).call(c)).find((h=>h._videoSSRC===t));if(d){a||this.store.subscribe(d.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find((g=>g.userId===d.uid&&g.type==="video"));It.firstRemoteVideoDecode(this.store.sessionId,Xi.FIRST_VIDEO_DECODE,jr.FIRST_VIDEO_DECODE,{peer:d._uintid,videowidth:r,videoheight:s,subscribeElapse:ao.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:a?1:0})}}async remoteMediaSsrcChanged(t,r,s){if(!this.recvConnection)return!1;const a=this.remoteUserMap.get(t);if(!a)return!1;const c=a.get(r);if(!c)return!1;const d=await this.recvConnection.getRemoteSSRC(c);return d!==void 0&&d!==s}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new Le(te.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new Le(te.NOT_SUPPORTED)}async subscribeDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}async unsubscribeDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,r){throw new Le(te.NOT_SUPPORTED)}async preConnect(t){throw new Le(te.NOT_SUPPORTED)}getEstablishParams(){throw new Le(te.NOT_SUPPORTED)}async reSubscribe(t){throw new Le(te.NOT_SUPPORTED)}reportVideoFirstFrameRender(t){}async updateVideoStreamParameter(t,r){throw new Le(te.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach((t=>{let[r,{track:s}]=t;r===Xe.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,qv.LOW_STREAM):s._updateRtpTransceiver(void 0)}))}},Rt(Kr.prototype,"p2pConnect",[wK],Object.getOwnPropertyDescriptor(Kr.prototype,"p2pConnect"),Kr.prototype),Rt(Kr.prototype,"unpublish",[TK],Object.getOwnPropertyDescriptor(Kr.prototype,"unpublish"),Kr.prototype),Rt(Kr.prototype,"unpublishLowStream",[CK],Object.getOwnPropertyDescriptor(Kr.prototype,"unpublishLowStream"),Kr.prototype),Rt(Kr.prototype,"subscribe",[RK],Object.getOwnPropertyDescriptor(Kr.prototype,"subscribe"),Kr.prototype),Rt(Kr.prototype,"mockSubscribe",[IK],Object.getOwnPropertyDescriptor(Kr.prototype,"mockSubscribe"),Kr.prototype),Rt(Kr.prototype,"unsubscribe",[AK],Object.getOwnPropertyDescriptor(Kr.prototype,"unsubscribe"),Kr.prototype),Rt(Kr.prototype,"muteRemote",[PK],Object.getOwnPropertyDescriptor(Kr.prototype,"muteRemote"),Kr.prototype),Rt(Kr.prototype,"unmuteRemote",[OK],Object.getOwnPropertyDescriptor(Kr.prototype,"unmuteRemote"),Kr.prototype),Rt(Kr.prototype,"hasRemoteMediaWithLock",[kK],Object.getOwnPropertyDescriptor(Kr.prototype,"hasRemoteMediaWithLock"),Kr.prototype),Rt(Kr.prototype,"disconnectForReconnect",[NK],Object.getOwnPropertyDescriptor(Kr.prototype,"disconnectForReconnect"),Kr.prototype),Rt(Kr.prototype,"remoteMediaSsrcChanged",[xK],Object.getOwnPropertyDescriptor(Kr.prototype,"remoteMediaSsrcChanged"),Kr.prototype),Kr);function nh(t){return function(r,s,a){const c=r[s];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return a.value=async function(){for(var d=arguments.length,h=new Array(d),m=0;m<d;m++)h[m]=arguments[m];switch(t){case th.SEND_ONLY:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{g()}}case th.RECEIVE_ONLY:{const g=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{g()}}default:{const g=await this.sendMutex.lock("From P2PChannel2.".concat(s)),E=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{g(),E()}}}},a}}class Ey extends Qr{constructor(r,s){super(),X(this,"signal",void 0),X(this,"token",void 0),X(this,"tokenTimeout",void 0),X(this,"tokenInterval",void 0),X(this,"_sequence",0),X(this,"userMap",new Map),X(this,"encoder",new TextEncoder),this.signal=r,this.token=s;const a=()=>{this.signal.connectionState===Pr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(a,1e3):this.tokenInterval=window.setTimeout(a,3*oe("P2P_TOKEN_INTERVAL"))};a()}async send(r,s,a,c,d){var h;if(this.userMap.size===0)return;const m=Array.from(Ic(h=this.userMap).call(h))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),c=c??wr(6,""),d=d??this._sequence++;const g={_id:c,_type:r,_seq:d,_message:s,token:"".concat(this.token,"_").concat(m)};oe("SHOW_P2P_LOG")&&M.debug("send message",g,"noNeedResponse : ".concat(a)),this.splitMessage(JSON.stringify(g)).forEach((w=>{this.signal.request(Jt.DATA_STREAM,{payload:$m(this.encoder.encode(w))})}));const E=new mt(((w,I)=>{const A=window.setTimeout((()=>{this.off("res-@".concat(c,"_ack"),N),this.off("res-@".concat(c),F),this.off(o0.ABORT,G),M.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?I(new Le(te.INVALID_REMOTE_USER)):I(new Le(te.TIMEOUT))}),oe("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),N=()=>{A&&window.clearTimeout(A),this.off(o0.ABORT,G),a&&w()},G=()=>{A&&window.clearTimeout(A),this.off("res-@".concat(c,"_ack"),N),this.off("res-@".concat(c),F),I(new Le(te.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(o0.ABORT,G),this.once("res-@".concat(c,"_ack"),N);const F=(ee,Z)=>{z=!0,A&&window.clearTimeout(A),this.off("res-@".concat(c,"_ack"),N),this.off(o0.ABORT,G),ee==="success"?w(Z):I(new Le(te.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let z=!1;a||(this.once("res-@".concat(c),F),bs(oe("SIGNAL_REQUEST_TIMEOUT")).then((()=>{z||M.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(g))})))}));try{return await E}catch(w){if(w.code===te.TIMEOUT)return await this.send(r,s,a,c,d);throw w}}onMessage(r){var s;const{_uid:a}=r;let c,d=this.userMap.get(a);if(d)c=d.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==Ei.CHECK)return;const{token:E}=r;c=new Map,d={uid:a,isStart:!0,token:E,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(a,d),this.signal.emit(Pn.ON_USER_ONLINE,{uid:a}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:E,total:w}=r,I=(h=c.get(E))!==null&&h!==void 0?h:[];if(I.push(r),c.has(E)||c.set(E,I),I.length!==w)return;{const A=z_(I).call(I,((N,G)=>N.index-G.index)).map((N=>N.payload)).join("");c.delete(E),(r=JSON.parse(A))._uid=a}}const{_type:m,token:g}=r;if(rt(s=[Ei.ACK,Ei.CHECK]).call(s,m))return m===Ei.CHECK&&this.handleCheckToken(d,g),void this.receiveMessage(r);g==="".concat(d.token,"_").concat(this.token)?this.handleReceivedMessage(r):M.debug('Receive unexpected message", '.concat(g,", cur_token: ").concat(d.token,"_").concat(this.token),r)}check(){const r={_id:wr(6,""),token:this.token,_type:Ei.CHECK};oe("SHOW_P2P_LOG")&&M.debug("send message",r),this.signal.request(Jt.DATA_STREAM,{payload:$m(this.encoder.encode(JSON.stringify(r)))})}ack(r){const s={_id:r,_type:Ei.ACK,token:this.token};oe("SHOW_P2P_LOG")&&M.debug("send message",s),this.signal.request(Jt.DATA_STREAM,{payload:$m(this.encoder.encode(JSON.stringify(s)))})}response(r,s,a){this.send(Ei.RESPONSE,JSON.stringify({success:!a,message:s}),!0,r)}handleReceivedMessage(r){const s=()=>{this.userMap.forEach((E=>{const{receivedMessagesMap:w,nextExpectedSequenceNumber:I}=E;for(;w.has(I);){const A=w.get(I);w.delete(I),this.receiveMessage(A),E.nextExpectedSequenceNumber++}}))};if(!r)return void s();const{_uid:a,_seq:c}=r,d=this.userMap.get(a),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:g}=d;if(c<g)return this.ack(r._id),void M.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===g&&(this.receiveMessage(r),h.delete(g),d.nextExpectedSequenceNumber++,s())}receiveMessage(r){const{_id:s,_type:a,_message:c,_uid:d}=r;if(oe("SHOW_P2P_LOG")&&M.debug("receive message",r),s){let h;switch(r._type!==Ei.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case Ei.CANDIDATE:case Ei.CONTROL:this.signal.emit(a,h,d);break;case Ei.PUBLISH:case Ei.UNPUBLISH:case Ei.RESTART_ICE:case Ei.CALL:h.uid=d,Fs(this.signal,a,h).then((m=>{this.response(r._id,m)})).catch((()=>{this.response(r._id,void 0,!0)}));break;case Ei.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case Ei.RESPONSE:{const{success:m,message:g}=h;this.emit("res-@".concat(s),m?"success":"failed",g);break}}}}splitMessage(r){if(r.length<Ey.MAX_MESSAGE_SIZE)return[r];const s=[],{remoteToken:a}=JSON.parse(r),c=wr(6,"");let d=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){d++;const g={id:c,index:d,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(a)};JSON.stringify(g).length>Ey.MAX_MESSAGE_SIZE?h-=50:(s.push(g),r=r.slice(h))}return s.map((g=>JSON.stringify(g)))}handleCheckToken(r,s){return r.token!==s?(M.debug("token changed, from ".concat(r.token," to ").concat(s)),this.reset(r.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout((()=>{M.debug("token timeout, ".concat(s)),this.reset(r.uid)}),oe("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await Fs(this.signal,Ei.CALL,void 0),s=await this.send(Ei.CALL,r);this.signal.emit(en.P2P_CONNECTION,s,!0)}async reset(r,s){const a=this.userMap.get(r);a&&(this.emit(o0.ABORT),this.signal.emit(Pn.ON_USER_OFFLINE,{uid:a.uid,reason:Pge.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(M.debug("change local token from ".concat(s," to ").concat(s)),this.token=wr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(o0.ABORT)}}X(Ey,"MAX_SIZE",1),X(Ey,"MAX_MESSAGE_SIZE",1024);class uEe extends Qr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===Pr.CONNECTED?this.emit(en.WS_CONNECTED):r===Pr.RECONNECTING?this.emit(en.WS_RECONNECTING,this._websocketReconnectReason):r===Pr.CLOSED&&this.emit(en.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),X(this,"_disconnectedReason",void 0),X(this,"_websocketReconnectReason",void 0),X(this,"_connectionState",Pr.CLOSED),X(this,"reconnectToken",void 0),X(this,"p2pToken",void 0),X(this,"websocket",void 0),X(this,"openConnectionTime",void 0),X(this,"clientId",void 0),X(this,"lastMsgTime",Date.now()),X(this,"uploadCache",[]),X(this,"uploadCacheInterval",void 0),X(this,"rttRolling",new l9(5)),X(this,"pingpongTimer",void 0),X(this,"pingpongTimeoutCount",0),X(this,"joinResponse",void 0),X(this,"multiIpOption",void 0),X(this,"initError",void 0),X(this,"spec",void 0),X(this,"store",void 0),X(this,"_external_signal",void 0),X(this,"onWebsocketMessage",(a=>{if(a.data instanceof ArrayBuffer)return void this.emit(en.ON_BINARY_DATA,a.data);const c=JSON.parse(a.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const d="res-@".concat(c._id);this.emit(d,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case Pn.ON_DATA_STREAM:return void this.handleDataStream(c._message);case Pn.MUTE_AUDIO:case Pn.MUTE_VIDEO:case Pn.ON_P2P_LOST:case Pn.ON_USER_ONLINE:return;case Pn.ON_USER_OFFLINE:const{uid:d}=c._message;return M.debug("[".concat(this.clientId,"] user-offline uid: ").concat(d)),void this._external_signal.reset(d)}if(this.emit(c._type,c._message),c._type===Pn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Pn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(sr.UID_BANNED);break;case 15:this.close(sr.IP_BANNED);break;case 16:this.close(sr.CHANNEL_BANNED)}if(c._type===Pn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Ft.ERR_LICENSE_MISSING:this.close(sr.LICENSE_MISSING);break;case Ft.ERR_LICENSE_EXPIRED:this.close(sr.LICENSE_EXPIRED);break;case Ft.ERR_LICENSE_MINUTES_EXCEEDED:this.close(sr.LICENSE_MINUTES_EXCEEDED);break;case Ft.ERR_LICENSE_PERIOD_INVALID:this.close(sr.LICENSE_PERIOD_INVALID);break;case Ft.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(sr.LICENSE_MULTIPLE_SDK_SERVICE);break;case Ft.ERR_LICENSE_ILLEGAL:this.close(sr.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new C2("gateway-".concat(this.clientId),this.spec.retryConfig,!0,oe("JOIN_GATEWAY_USE_DUAL_DOMAIN"),oe("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===Pr.CONNECTED&&this.reconnect("retry",js.OFFLINE)})),this.p2pToken=wr(6,""),this._external_signal=new Ey(this,this.p2pToken)}async request(r,s,a,c){const d=wr(6,""),h={_id:d,_type:r,_message:s},m=this.websocket.connectionID,g=()=>new mt(((G,F)=>{if(this.connectionState===Pr.CONNECTED)return G();const z=()=>{this.off(en.WS_CLOSED,ee),G()},ee=()=>{this.off(en.WS_CONNECTED,z),F(new Le(te.WS_ABORT))};this.once(en.WS_CONNECTED,z),this.once(en.WS_CLOSED,ee)}));if(this.connectionState!==Pr.CONNECTING&&this.connectionState!==Pr.RECONNECTING||r===Jt.JOIN||r===Jt.REJOIN||await g(),this.websocket.sendMessage(h,!0),c)return;const E=new mt(((G,F)=>{let z=!1;const ee=(ae,ye)=>{z=!0,G({isSuccess:ae==="success",message:ye||{}}),this.off(en.WS_CLOSED,Z),this.off(en.WS_RECONNECTING,Z),this.emit(en.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(d),ee);const Z=()=>{F(new Le(te.WS_ABORT,"type: ".concat(r))),this.off(en.WS_CLOSED,Z),this.off(en.WS_RECONNECTING,Z),this.off("res-@".concat(d),ee)};this.once(en.WS_CLOSED,Z),this.once(en.WS_RECONNECTING,Z),bs(oe("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==m||z||(M.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(en.REQUEST_TIMEOUT,r,s))}))}));let w=null;try{w=await E}catch(G){if(this.connectionState===Pr.CLOSED||r===Jt.LEAVE)throw new Le(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||a?G.throw():r===Jt.JOIN||r===Jt.REJOIN?null:(await g(),await this.request(r,s))}if(w.isSuccess)return w.message;const I=Number(w.message.error_code||w.message.code),A=uT(I),N=new Le(te.UNEXPECTED_RESPONSE,"".concat(A.desc,": ").concat(w.message.error_str),{code:I,data:w.message,desc:A.desc});return A.action==="success"?w.message:(M.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(I,", message: ").concat(A.desc,", action: ").concat(A.action)),I===Ft.ERR_TOO_MANY_BROADCASTERS?((r===Jt.JOIN||r===Jt.REJOIN)&&(this.initError=N,this.close()),N.throw()):A.action==="failed"?N.throw():A.action==="quit"?(this.initError=N,this.close(),N.throw()):(I===Ft.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=w.message.option,M.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",js.MULTI_IP)):this.reconnect(A.action,js.SERVER_ERROR),r===Jt.JOIN||r===Jt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new mt((a=>{const c=d=>{(!s||s(d))&&(this.off(r,c),a(d))};this.on(r,c)}))}uploadWRTCStats(r){if(!this.store.sessionId)return void M.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(cT.WRTC_STATS,s)}upload(r,s){const a={_type:r,_message:s};try{this.websocket.sendMessage(a)}catch{const d=oe("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(a),this.uploadCache.length>d&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==Pr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)}),oe("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const a={_type:r,_message:s};this.websocket.sendMessage(a)}async sendExtensionMessage(r,s,a){return await this._external_signal.send(r,s,a)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new mt(((s,a)=>{this.once(en.WS_CONNECTED,(()=>s(this.joinResponse))),this.once(en.WS_CLOSED,(()=>a(this.initError||new Le(te.WS_ABORT)))),this.connectionState=Pr.CONNECTING,this.websocket.init(r).catch(a)}))}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||sr.LEAVE,this.connectionState=Pr.CLOSED,M.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=wr(6,""),this._external_signal.clear(),this._external_signal=new Ey(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(en.ABORT_P2P_EXECUTION);const r=await Fs(this,en.REQUEST_JOIN_INFO),s=await this.request(Jt.JOIN,r);if(!s)return this.emit(en.REPORT_JOIN_GATEWAY,te.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(en.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Pr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}async downgradeCodec(r){return!1}handleDataStream(r){try{var s;const a=Q_(r.payload),c=new TextDecoder().decode(a),d=JSON.parse(c);"total"in d&&"id"in d||rt(s=Object.values(Ei)).call(s,d._type)?(d._uid=r.uid,this._external_signal.onMessage(d)):this.emit(Pn.ON_DATA_STREAM,r)}catch{this.emit(Pn.ON_DATA_STREAM,r)}}handleNotification(r){M.debug("[".concat(this.clientId,"] receive notification: "),r);const s=uT(r.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(sr.UID_BANNED),void this.close()):void this.reconnect(s.action,js.SERVER_ERROR);M.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=oe("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(M.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>oe("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",js.TIMEOUT):this.request(Jt.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const a=Date.now()-s;this.rttRolling.add(a),oe("REPORT_STATS")&&this.send(Jt.PING_BACK,{pingpongElapse:a})})).catch((a=>{}))}handleWebsocketEvents(){this.websocket.on(pn.RECONNECT_CREATE_CONNECTION,(r=>{this.emit(en.WS_RECONNECT_CREATE_CONNECTION,r)})),this.websocket.on(pn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(pn.CLOSED,(()=>{this.connectionState=Pr.CLOSED})),this.websocket.on(pn.FAILED,(()=>{this._disconnectedReason=sr.NETWORK_ERROR,this.connectionState=Pr.CLOSED})),this.websocket.on(pn.RECONNECTING,(r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===Pr.CONNECTED?this.connectionState=Pr.RECONNECTING:this.connectionState=Pr.CONNECTING})),this.websocket.on(pn.WILL_RECONNECT,((r,s,a)=>{r!=="retry"?(M.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):M.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),a(r)})),this.websocket.on(pn.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.join().catch((r=>{if(this.emit(en.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Le&&r.code===te.UNEXPECTED_RESPONSE&&r.data.code===Ft.ERR_NO_AUTHORIZED)return M.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",js.SERVER_ERROR);M.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",js.SERVER_ERROR):(this.initError=r,this.close())}))})),this.websocket.on(pn.REQUEST_NEW_URLS,((r,s)=>{Fs(this,en.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)})),this.websocket.on(pn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(Pn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}const dEe={name:"P2PChannel",create:function(t){let{store:r,statsCollector:s}=t;return new lEe(r,s)},createSubmodule:function(t){let{store:r,spec:s}=t;return new uEe(s,r)}};function LK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function MK(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?LK(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):LK(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}class hEe{constructor(r){X(this,"sessionDesc",void 0),X(this,"localCapabilities",void 0),X(this,"rtpCapabilities",void 0),X(this,"candidates",void 0),X(this,"_originCandidates",void 0),X(this,"iceParameters",void 0),X(this,"dtlsParameters",void 0),X(this,"setup",void 0),X(this,"currentMidIndex",void 0),X(this,"cname",void 0),r=$r(r);const{iceParameters:s,dtlsParameters:a,candidates:c,rtpCapabilities:d,setup:h,localCapabilities:m,sdkCodec:g,cname:E}=r,w=tc(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=d,this.candidates=c,this._originCandidates=$r(c),this.iceParameters=s,this.dtlsParameters=a,this.setup=h,this.localCapabilities=m,this.cname=E;for(let I=0;I<w.mediaDescriptions.length;I++){const A=w.mediaDescriptions[I];if(A.attributes.iceUfrag=s.iceUfrag,A.attributes.icePwd=s.icePwd,A.attributes.fingerprints=a.fingerprints,A.attributes.candidates=c,A.attributes.setup=h,A.media.mediaType==="video"){A.media.fmts=d.videoCodecs.map((F=>F.payloadType.toString(10)));const N=d.videoCodecs.filter((F=>{var z,ee;return(z=F.rtpMap)===null||z===void 0?void 0:rt(ee=z.encodingName.toLowerCase()).call(ee,g)})),G=d.videoCodecs.filter((F=>!rt(N).call(N,F)));A.attributes.payloads=[...N,...G],A.attributes.extmaps=d.videoExtensions}A.media.mediaType==="audio"&&(A.media.fmts=d.audioCodecs.map((N=>N.payloadType.toString(10))),A.attributes.payloads=d.audioCodecs,A.attributes.extmaps=d.audioExtensions),w.mediaDescriptions[I]=this.mungMediaDesc(A)}this.sessionDesc=w,this.currentMidIndex=w.mediaDescriptions.length-1}toString(){return Km(this.sessionDesc)}send(r,s,a){const{ssrcs:c,ssrcGroups:d}=fT(s,this.cname),h=this.sessionDesc.mediaDescriptions.find((E=>r===vt.VIDEO?E.media.mediaType==="video":E.media.mediaType==="audio")),m=c[0].attributes.label,g=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(d),{id:m,mslabel:g}}batchSend(r){return r.map((s=>{let{kind:a,ssrcMsg:c}=s;return this.send(a,c,void 0)}))}stopSending(r){this.sessionDesc.mediaDescriptions.forEach((s=>{const a=[],c=[],d=[];s.attributes.ssrcs.forEach((h=>{rt(r).call(r,h.attributes.label||"")?d.push(h):a.push(h)})),s.attributes.ssrcGroups.forEach((h=>{var m;rt(m=d.map((g=>g.ssrcId))).call(m,h.ssrcIds[0])||c.push(h)})),s.attributes.ssrcs=a,s.attributes.ssrcGroups=c}))}mute(r){const s=this.sessionDesc.mediaDescriptions.find((a=>a.attributes.mid===r));if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(r){const s=this.sessionDesc.mediaDescriptions.find((a=>a.attributes.mid===r));if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(r,s,a){r.forEach(((c,d)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex((E=>E.attributes.mid===h.kind)),g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=g}))}stopReceiving(r){}updateCandidates(r){const s=this._originCandidates.filter((c=>c.transport==="udp")),a=[];if(s.forEach((c=>{a.push(MK(MK({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))})),s.length!==0){switch(r){case oo.TCP_RELAY:this.candidates=a;break;case oo.UDP_TCP_RELAY:case oo.RELAY:this.candidates=[...s,...a];break;default:this.candidates=s}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=$r(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach((s=>{s.attributes.iceUfrag=r.iceUfrag,s.attributes.icePwd=r.icePwd}))}predictReceivingMids(r){const s=[];for(let a=0;a<r;a++)s.push((this.currentMidIndex+a+1).toString(10));return s}mungRecvMediaDsec(r,s){const a=$r(r);return l0(a,s),P2(a,s),a}updateRecvMedia(r,s){const a=this.sessionDesc.mediaDescriptions.findIndex((c=>c.attributes.mid===r));if(a!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[a],s);this.sessionDesc.mediaDescriptions[a]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,s,a){const c=this.sessionDesc.mediaDescriptions.find((h=>r===vt.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio"));if(c){const h=c.attributes.ssrcs.find((m=>m.attributes.label===s));var d;h&&(h.attributes.label=a,(d=h.attributes.msid)===null||d===void 0||d.replace(s,a))}}mungMediaDesc(r){const s=$r(r);return A2(s),(function(a){const c=a.attributes.extmaps.find((d=>$1(d.extensionName)));c&&a.attributes.extmaps.splice(a.attributes.extmaps.indexOf(c),1),a.attributes.payloads.forEach((d=>{const h=d.rtcpFeedbacks.findIndex((m=>m.type==="transport-cc"));h!==-1&&d.rtcpFeedbacks.splice(h,1)}))})(s),s}getSSRC(r){for(const s of this.sessionDesc.mediaDescriptions)for(const a of s.attributes.ssrcs)if(a.attributes.label===r)return[a]}}var Tr;function UK(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);r&&(a=a.filter((function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable}))),s.push.apply(s,a)}return s}function NP(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?UK(Object(s),!0).forEach((function(a){X(t,a,s[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):UK(Object(s)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(s,a))}))}return t}let pEe=(Tr=class wC extends XG{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map((r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"")).filter((r=>{var s;return rt(s=Object.keys(rT)).call(s,r)})))]}constructor(r,s){super(r,s),X(this,"store",void 0),X(this,"peerConnection",void 0),X(this,"remoteSDP",void 0),X(this,"initialOffer",void 0),X(this,"statsFilter",void 0),X(this,"useRTX",!1),X(this,"localCapabilities",void 0),X(this,"localCandidateCount",0),X(this,"allCandidatesReceived",!1),X(this,"establishPromise",void 0),X(this,"mutex",void 0),this.store=s,this.mutex=new ro("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(wC.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=UL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,ni()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Zm(r.sdp),a=pT(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:oe("FILTER_VIDEO_FEC"),filterAudioFec:oe("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=a,this.initialOffer=r,NP(NP({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:a},offerSDP:r.sdp})}catch(r){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new hEe(NP(NP({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(r,s){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,s){var a=this;return Xl((function*(){const c=yield Fn(a.mutex.lock());try{if(!a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=r.map((A=>a.peerConnection.addTrack(A._mediaStreamTrack))),h=yield Fn(a.peerConnection.createOffer()),m=tc(h.sdp),g=r.map((A=>{const N=A._mediaStreamTrack,G=m.mediaDescriptions.find((F=>F.attributes.mid===N.kind));if(!G)throw new Error("Cannot extract ssrc from mediaDescription.");return(function(F,z,ee){const Z=F.attributes.ssrcs.filter((ye=>ye.attributes.label===z)),ae=F.attributes.ssrcGroups;if(Z.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ae&&Z.length>1){const ye=ae.find((_e=>_e.ssrcIds.indexOf(Z[0].ssrcId)!==-1));return ye?[{ssrcId:ye.ssrcIds[0],rtx:ee?ye.ssrcIds[1]:void 0}]:[{ssrcId:Z[0].ssrcId}]}return[{ssrcId:Z[0].ssrcId}]})(G,N.id,a.useRTX)}));let E;try{E=yield g}catch(A){throw d.forEach((N=>{Vs()&&N.replaceTrack(null),a.peerConnection.removeTrack(N)})),A}const w=a.mungSendOfferSDP(h.sdp,r);a.remoteSDP.receive(r,s,E);const I=a.remoteSDP.toString();return yield Fn(a.peerConnection.setLocalDescription({type:"offer",sdp:w})),yield Fn(a.applySendEncodings(d,r)),yield Fn(a.peerConnection.setRemoteDescription({type:"answer",sdp:I})),r.map(((A,N)=>{const G=A._mediaStreamTrack.id;return{localSSRC:g[N],id:G}}))}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{c()}}))()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter((d=>{var h;return r.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1}));if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map((d=>{Vs()&&d.replaceTrack(null),this.peerConnection.removeTrack(d)}));const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(r,s,a,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:d,mslabel:h}=this.remoteSDP.send(r,s,c),m=new mt(((w,I)=>{const A=setTimeout((()=>{I(new Error("Cannot receive track, id: ".concat(d)))}),1e4),N=G=>{const F=Ln();if((F.name==="Safari"&&Number(F.version)===11||bo())&&G.track.id!==d&&G.streams[0].id===h){var z;const ee=G.streams[0].getTracks()[0];return(z=this.remoteSDP)===null||z===void 0||z.updateTrackLabel(r,d,G.track.id),this.peerConnection.removeEventListener("track",N),clearTimeout(A),void w(ee)}if(G.track.id===d)return this.peerConnection.removeEventListener("track",N),clearTimeout(A),void w(G.track)};this.peerConnection.addEventListener("track",N)})),g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const E=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(E),{track:await m,id:d}}catch(d){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(d.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(a)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter((a=>{var c;return r.indexOf(((c=a.track)===null||c===void 0?void 0:c.id)||"")!==-1}));if(s.length!==r.length)throw new Error("sender' length doesn't match mids' length.");s.map((a=>{if(Vs()&&a.track)a.track.enabled=!1;else{const c=a.getParameters();c.encodings.forEach((d=>d.active=!1)),a.setParameters(c)}}))}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter((d=>{var h;return r.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1}));if(s.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");s.map((async d=>{if(Vs()&&d.track)d.track.enabled=!0;else{const h=d.getParameters();h.encodings.forEach((m=>m.active=!0)),await d.setParameters(h)}}));const a=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(a);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return Xl((function*(){const a=yield Fn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Bn().supportPCSetConfiguration;if(r===oo.RELAY&&!c)return;if(c){const E=s.peerConnection.getConfiguration(),w=r===oo.RELAY?"relay":"all";E.iceTransportPolicy!==w&&(M.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(E.iceTransportPolicy,"] to [").concat(w,"]")),E.iceTransportPolicy=w,s.peerConnection.setConfiguration(E))}r!==oo.RELAY&&s.remoteSDP.updateCandidates(r);const d=yield Fn(s.peerConnection.createOffer({iceRestart:!0}));if(!d.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Zm(d.sdp),{remoteIceParameters:m}=yield h.iceParameters;s.remoteSDP.restartICE(m);const g=s.remoteSDP.toString();yield Fn(s.peerConnection.setLocalDescription(d)),yield Fn(s.peerConnection.setRemoteDescription({type:"answer",sdp:g}))}catch(c){M.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{a()}}))()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const a=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(a.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const d=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(a){throw new Le(te.EXCHANGE_SDP_FAILED,a.toString())}}async updateSendParameters(r,s){const a=this.peerConnection.getSenders().filter((c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===r}));a.length===1&&await this.applySendEncodings(a,[s])}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const a=this.peerConnection.getSenders().find((c=>{var d;return((d=c.track)===null||d===void 0?void 0:d.id)===s}));a&&await a.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,s){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,M.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),oe("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(Qw(r.turnServer.servers)?s.iceServers=r.turnServer.servers:(s.iceServers&&s.iceServers.push(...wC.turnServerConfigToIceServers(r.turnServer.servers)),oe("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...wC.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach((a=>{a.forceturn&&(s.iceTransportPolicy="relay")})))),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach((a=>{a.security?a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turns:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}):(a.udpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.udpport,"?transport=udp")}),a.tcpport&&s.push({username:a.username,credential:a.password,credentialType:"password",urls:"turn:".concat(a.turnServerURL,":").concat(a.tcpport,"?transport=tcp")}))})),s}async updateRtpSenderEncodings(r,s){var a;if(s||(s=this.peerConnection.getSenders().find((E=>{var w;return((w=E.track)===null||w===void 0?void 0:w.id)===r._mediaStreamTrack.id}))),!s)return M.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!Bn().supportSetRtpSenderParameters)return M.warn("Browser not support set rtp-sender parameters");const c={},d={};if(r instanceof kr)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(oe("DSCP_TYPE")&&ff()){var h;const E=oe("DSCP_TYPE");rt(h=["very-low","low","medium","high"]).call(h,E)&&(d.networkPriority=E)}const m=s.getParameters(),g=(a=m.encodings)===null||a===void 0?void 0:a[0];g&&Object.assign(g,d),Object.assign(m,c),M.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await s.setParameters(m)}async applySendEncodings(r,s){try{if(!Bn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let a=0;a<r.length;a++){const c=r[a],d=s[a];c&&d&&await this.updateRtpSenderEncodings(d,c)}}catch{M.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s){const a=tc(r);return s.forEach(((c,d)=>{const h=c._mediaStreamTrack,m=a.mediaDescriptions.find((g=>g.attributes.mid===h.kind));m&&l0(m,c)})),Km(a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,a)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,a)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var a;(a=this.onSelectedLocalCandidateChanged)===null||a===void 0||a.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var a;(a=this.onSelectedRemoteCandidateChanged)===null||a===void 0||a.call(this,r,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(r).map(((d,h)=>{let{id:m,mslabel:g}=d;const{kind:E}=r[h];return new mt(((w,I)=>{const A=setTimeout((()=>{I(new Error("Cannot receive track, id: ".concat(m)))}),1e4),N=G=>{const F=Ln();if(F.name==="Safari"&&Number(F.version)===11&&G.track.id!==m&&G.streams[0].id===g){var z;const ee=G.streams[0].getTracks()[0];return(z=this.remoteSDP)===null||z===void 0||z.updateTrackLabel(E,m,G.track.id),this.peerConnection.removeEventListener("track",N),clearTimeout(A),void w({track:ee,id:m})}if(G.track.id===m)return this.peerConnection.removeEventListener("track",N),clearTimeout(A),void w({track:G.track,id:m})};this.peerConnection.addEventListener("track",N)}))})),a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await mt.all(s)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s==null?void 0:s[0].ssrcId}setConfiguration(r){if(Bn().supportPCSetConfiguration){const s=wC.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},Rt(Tr.prototype,"connect",[su],Object.getOwnPropertyDescriptor(Tr.prototype,"connect"),Tr.prototype),Rt(Tr.prototype,"stopSending",[su],Object.getOwnPropertyDescriptor(Tr.prototype,"stopSending"),Tr.prototype),Rt(Tr.prototype,"receive",[su],Object.getOwnPropertyDescriptor(Tr.prototype,"receive"),Tr.prototype),Rt(Tr.prototype,"stopReceiving",[su],Object.getOwnPropertyDescriptor(Tr.prototype,"stopReceiving"),Tr.prototype),Rt(Tr.prototype,"muteRemote",[su],Object.getOwnPropertyDescriptor(Tr.prototype,"muteRemote"),Tr.prototype),Rt(Tr.prototype,"unmuteRemote",[su],Object.getOwnPropertyDescriptor(Tr.prototype,"unmuteRemote"),Tr.prototype),Rt(Tr.prototype,"muteLocal",[su],Object.getOwnPropertyDescriptor(Tr.prototype,"muteLocal"),Tr.prototype),Rt(Tr.prototype,"unmuteLocal",[su],Object.getOwnPropertyDescriptor(Tr.prototype,"unmuteLocal"),Tr.prototype),Rt(Tr.prototype,"close",[su],Object.getOwnPropertyDescriptor(Tr.prototype,"close"),Tr.prototype),Rt(Tr.prototype,"updateEncoderConfig",[su],Object.getOwnPropertyDescriptor(Tr.prototype,"updateEncoderConfig"),Tr.prototype),Rt(Tr.prototype,"updateSendParameters",[su],Object.getOwnPropertyDescriptor(Tr.prototype,"updateSendParameters"),Tr.prototype),Rt(Tr.prototype,"replaceTrack",[su],Object.getOwnPropertyDescriptor(Tr.prototype,"replaceTrack"),Tr.prototype),Rt(Tr.prototype,"getRemoteSSRC",[su],Object.getOwnPropertyDescriptor(Tr.prototype,"getRemoteSSRC"),Tr.prototype),Tr);function su(t,r,s){const a=t[r];if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,d=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),g=0;g<h;g++)m[g]=arguments[g];return await a.apply(this,m)}finally{d()}},s}const fEe={name:"PlanBConnection",create:function(t){let{store:r,spec:s}=t;return new pEe(s,r)}},mEe={interceptLocalAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Bn().supportWebRTCEncodedTransform)return void M.warning("browser not support audio encoded transform");if(P1.has(t)||!t.track)return;const s={track:t.track};if(pf()){if(!t.createEncodedStreams)return void M.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void M.error("create audio-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(M.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const g=r.metadata&&r.metadata();g?(function(E,w){const{chunk:I,controller:A}=w,N=qm.METADATA;I.data=(function(G,F,z){const ee=z.byteLength,Z=ee+c2+xG,ae=o2+a2+Z,ye=new ArrayBuffer(G.byteLength+ae),_e=new DataView(ye);_e.setUint8(0,NG),_e.setUint16(1,Z),_e.setUint8(3,F),_e.setUint16(4,ee);for(let Ae=0;Ae<ee;Ae++)_e.setUint8(6+Ae,z[Ae]);const ue=new Uint8Array(_e.buffer);return ue.set(new Uint8Array(G),ae),ue.buffer})(I.data,N,E),A.enqueue(I)})(g,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(Vs()){if(typeof RTCRtpScriptTransform>"u")return void M.warning("browser not support RTCRtpScriptTransform");const c=A1(),d=new MessageChannel;await new mt((m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)}));const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:d.port2},[d.port2]);t.transform=h,await new mt((m=>c.onmessage=g=>{g.data==="started"&&m(void 0)})),d.port1.onmessage=m=>{var g;if(m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==s.track.id)M.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a);else if(m.data.getMetadata){const E=r.metadata&&r.metadata();E&&d.port1.postMessage({metadata:E})}},s.worker=c}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}const c=P1.get(t);if(c){P1.delete(t);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){M.warning(m&&m.message)}}}P1.set(t,s),t.track.addEventListener("ended",a)},interceptRemoteAudioFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Bn().supportWebRTCEncodedTransform)return void M.warning("browser not support audio encoded transform");if(L1.has(t))return;const s={track:t.track,onMetadata:r.onMetadata,onPts:r.onPts};if(pf()&&!bo()){if(!t.createEncodedStreams)return void M.warning("browser not support createEncodedStreams() API");_L(qn.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=t.createEncodedStreams()}catch(h){return void M.error("create audio-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(M.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)),r.enableTopn?(function(g,E,w){var I;const A=l2(new DataView(E.data));if(!A)return w.enqueue(E);const N=g.track.id;Xme.set(N,g.track);const G=(I=A.tlv.find((ye=>ye.tag===qm.AUDIO_LEVEL)))===null||I===void 0?void 0:I.value;let F=0;typeof G=="number"&&(F=127-G);const z=Math.round(Math.pow(10,F/60)-1),{selected:ee,speaker:Z}=(function(ye,_e){let ue=n0.get(ye);if(ue||(ue=(function(Ae){const Ue=new LG;return n0.set(Ae,Ue),Yd||(Yd=new qme(oe("TOPN_SILENCE_THRESHOLD")||500),Yd.on("ActiveSpeakerChanged",(We=>{We!=null&&(N1=We)}))),Yd.addSpeakers([Ue]),Ue})(ye)),n0.size<=MG)return{selected:!0,speaker:ue};if(!Yd)throw new Error("no active speaker detector");return Yd.levelChanged(ue.id,_e),sy=Yd.loudest.map((Ae=>Ae.id)),N1&&!rt(sy).call(sy,N1)&&sy.length>=MG&&sy.pop(),{selected:rt(sy).call(sy,ue.id)||ue.id===N1,speaker:ue}})(g,z),ae=(function(ye,_e,ue){const Ae=Xd.get(ye)||new Yme(ye,_e);return Ae.score=ue,Xd.set(ye,Ae),(function(Ue){if(x1.set(Ue,!0),!D1)return void(D1=Date.now());const We=Date.now();We-D1>1e3&&(x1.get(Ue)?x1.set(Ue,!1):(UG(Ue),x1.delete(Ue)),D1=We)})(ye),Ae})(N,g.track,Z.energyScore);ae.addSample(ee),ae.active&&(E.data=A.frame.buffer,w.enqueue(E))})(t,h,m):r.enableMetadata||r.enablePts?(function(g,E,w,I){const A=new DataView(g.data),N=A.getUint8(0);let G;if((128&N)!=0&&N!==71){const ee=(function(Z){if(Z.byteLength<=0)return[];const ae=[];let ye=0;for(;ye<Z.byteLength;){const ue=(128&Z.getUint8(ye))>>7,Ae=127&Z.getUint8(ye);if(!(ue&&ye+4<=Z.byteLength)){ye++;break}{const Ue=Z.getUint32(ye,!1),We=(16776192&Ue)>>10,Ze=1023&Ue;ae.push({pt:Ae,ts_offset:We,length:Ze,data:new Uint8Array}),ye+=4}}let _e=Z.byteLength-ye;for(const ue of ae){if(ue.length>_e)return console.warn("Broken red payload"),[];ue.length>0&&(ue.data=new Uint8Array(Z.buffer,Z.byteOffset+ye,ue.length),ye+=ue.length,_e-=ue.length)}if(_e>0){const ue={pt:ae.length>0?ae[ae.length-1].pt:0,ts_offset:0,length:_e,data:new Uint8Array(Z.buffer,Z.byteOffset+ye,_e)};ae.push(ue)}return ae})(A);if(ee.length>0){const Z=(function(ae){let ye=0;for(let Ae=0;Ae<ae.length;Ae++)ye+=Ae<ae.length-1?4:1,ye+=ae[Ae].length;const _e=new Uint8Array(ye);let ue=0;for(let Ae=0;Ae<ae.length;Ae++)if(Ae<ae.length-1){const Ue=(2147483648|(127&ae[Ae].pt)<<24|(262143&ae[Ae].ts_offset)<<10|1023&ae[Ae].length)>>>0;_e[ue++]=Ue>>24&255,_e[ue++]=Ue>>16&255,_e[ue++]=Ue>>8&255,_e[ue++]=255&Ue}else _e[ue++]=127&ae[Ae].pt;for(const Ae of ae)_e.set(Ae.data,ue),ue+=Ae.length;return _e})(ee.map((ae=>{const ye=new Uint8Array(ae.length);ye.set(ae.data);const _e=l2(new DataView(ye.buffer));return _e!=null&&_e.frame&&(ae.data=_e==null?void 0:_e.frame),G=_e,ae})));g.data=Z.buffer}}else G=l2(A),G&&(g.data=G.frame.buffer);if(E.enqueue(g),!G)return;const F=G.tlv.find((ee=>ee.tag===qm.METADATA));F&&w&&F.value instanceof Uint8Array&&w(F.value);const z=G.tlv.find((ee=>ee.tag===qm.AUDIO_64_BIT_PTS));z&&I&&z.value instanceof Uint8Array&&z.value.length==8&&I(new DataView(z.value.buffer).getBigUint64(0,!0))})(h,m,r.onMetadata,r.onPts):m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void M.warning("browser not support RTCRtpScriptTransform");const c=A1(),d=new MessageChannel;await new mt((m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)}));const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:d.port2},[d.port2]);t.transform=h,await new mt((m=>c.onmessage=g=>{g.data==="started"&&m(void 0)})),d.port1.onmessage=m=>{var g;m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==s.track.id?(M.debug("audio track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)):m.data.metadata&&s.onMetadata?s.onMetadata(m.data.metadata):m.data.pts&&s.onPts&&s.onPts(m.data.pts)},s.worker=c}function a(){t.track.removeEventListener("ended",a),(function(c){const d=L1.get(c);if(d){(function(g){const E=n0.get(g);E&&(n0.delete(g),Yd&&(Yd.removeSpeakers([E]),n0.size===0&&(Yd.destroy(),Yd=null)))})(c),UG(c.track.id),L1.delete(c);try{var h,m;(h=d.controller)===null||h===void 0||h.terminate(),(m=d.worker)===null||m===void 0||m.terminate()}catch(g){M.warning(g&&g.message)}}})(t)}L1.set(t,s),t.track.addEventListener("ended",a)},interceptLocalVideoFrame:async function(t,r){if(!Bn().supportWebRTCEncodedTransform)return void M.warning("browser not support video encoded transform");if(M1.has(t)||!t.track)return;const s={track:t.track};if(pf()){if(!t.createEncodedStreams)return void M.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(m){return void M.error("create video-encoded-streams error",m&&m.message)}const d=[];r.on("sei-to-send",(m=>{d.push(m)}));const h=new TransformStream({transform(m,g){s.controller||(s.controller=g),t.track&&t.track.id!==s.track.id&&(M.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const E=FG(new Uint8Array(m.data)),w=d.shift();if(w){const I=(function(A,N,G){switch(G){case p2:return(function(F,z){const ee=jG(z),Z=ee.length,ae=Math.floor(Z/255),ye=Z%255,_e=new Uint8Array(6+ae+1+Z+F.byteLength);_e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e[4]=6,_e[5]=101;let ue=0;for(;ue<ae;)_e[6+ue]=255,ue++;return _e[6+ue]=ye,ue++,_e.set(ee,6+ue),_e.set(new Uint8Array(F),6+ue+Z),_e.buffer})(A,N);case f2:return(function(F,z){const ee=jG(z),Z=ee.length,ae=Math.floor(Z/255),ye=Z%255,_e=new Uint8Array(7+ae+1+Z+1+F.byteLength);_e[0]=0,_e[1]=0,_e[2]=0,_e[3]=1,_e[4]=78,_e[5]=1,_e[6]=101;let ue=0;for(;ue<ae;)_e[7+ue]=255,ue++;return _e[7+ue]=ye,ue++,_e.set(ee,7+ue),ue+=Z,_e[7+ue]=128,ue++,_e.set(new Uint8Array(F),7+ue),_e.buffer})(A,N);default:return null}})(m.data,w,E);I&&(m.data=I)}g.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!Vs())return;{if(typeof RTCRtpScriptTransform>"u")return void M.warning("browser not support RTCRtpScriptTransform");const c=A1(),d=new MessageChannel;await new mt((m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)}));const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:d.port2},[d.port2]);t.transform=h,await new mt((m=>c.onmessage=g=>{g.data==="started"&&m(void 0)})),r.on("sei-to-send",(m=>{d.port1.postMessage({sei:m})})),d.port1.onmessage=m=>{var g;m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==s.track.id&&(M.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a))},s.worker=c}}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}const c=M1.get(t);if(c){M1.delete(t);try{var d,h;(d=c.controller)===null||d===void 0||d.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){M.warning(m&&m.message)}}}M1.set(t,s),t.track.addEventListener("ended",a)},interceptRemoteVideoFrame:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Bn().supportWebRTCEncodedTransform)return void M.warning("browser not support video encoded transform");if(!t.track)return;if(aT.has(t)){const c=aT.get(t);return void(c&&(c.onSei=r.onSei))}const s={track:t.track,onSei:r.onSei};if(pf()){if(!t.createEncodedStreams)return void M.warning("browser not support createEncodedStreams() API");let c=null;try{c=t.createEncodedStreams()}catch(h){return void M.error("create video-encoded-streams error",h&&h.message)}const d=new TransformStream({transform(h,m){s.controller||(s.controller=m),t.track&&t.track.id!==s.track.id&&(M.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a));const g=(function(E,w){switch(w){case p2:return(function(I){const A=new DataView(I.data);let N=0;for(;N+4<I.data.byteLength;){if(A.getUint8(N+0)===0&&A.getUint8(N+1)===0&&A.getUint8(N+2)===0&&A.getUint8(N+3)===1&&A.getUint8(N+4)===6){let G=N+6,F=0,z=0;for(;(z=A.getUint8(G++))===255;)F+=255;F+=z;const ee=VG(I.data,G,F);return new Uint8Array(ee)}N++}return null})(E);case f2:return(function(I){const A=new DataView(I.data);let N=0;for(;N+5<I.data.byteLength;){if(A.getUint8(N+0)===0&&A.getUint8(N+1)===0&&A.getUint8(N+2)===0&&A.getUint8(N+3)===1&&A.getUint8(N+4)===78&&A.getUint8(N+5)===1&&A.getUint8(N+6)===101){let G=N+7,F=0,z=0;for(;(z=A.getUint8(G++))===255;)F+=255;F+=z;const ee=VG(I.data,G,F);return new Uint8Array(ee)}N++}return null})(E);default:return null}})(h,FG(new Uint8Array(h.data)));g&&s.onSei&&s.onSei(g),m.enqueue(h)}});c.readable.pipeThrough(d).pipeTo(c.writable)}else if(Vs()){if(typeof RTCRtpScriptTransform>"u")return void M.warning("browser not support RTCRtpScriptTransform");const c=A1(),d=new MessageChannel;await new mt((m=>c.onmessage=g=>{g.data==="registered"&&m(void 0)}));const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:d.port2},[d.port2]);t.transform=h,await new mt((m=>c.onmessage=g=>{g.data==="started"&&m(void 0)})),d.port1.onmessage=m=>{var g;m.data.transformed&&t.track&&((g=t.track)===null||g===void 0?void 0:g.id)!==s.track.id?(M.debug("video track changed: ".concat(s.track.id," => ").concat(t.track.id)),s.track.removeEventListener("ended",a),s.track=t.track,s.track.addEventListener("ended",a)):m.data.sei&&s.onSei&&s.onSei(m.data.sei)},s.worker=c}function a(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",a)}(function(c){const d=aT.get(c);if(d){aT.delete(c);try{var h,m;(h=d.controller)===null||h===void 0||h.terminate(),(m=d.worker)===null||m===void 0||m.terminate()}catch(g){M.warning(g&&g.message)}}})(t)}aT.set(t,s),t.track.addEventListener("ended",a)}},gEe={name:"InterceptFrame",create:()=>mEe};VL(),mr("PROCESS_ID","process-".concat(wr(8,""),"-").concat(wr(4,""),"-").concat(wr(4,""),"-").concat(wr(4,""),"-").concat(wr(12,""))),(function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void M.error("Error loading sdk config",r.message)}if(t)try{const r=JSON.parse(window.atob(t)),s=Date.now();M.debug("Loading global parameters from cache",r),Object.keys(r).forEach((a=>{if(Object.prototype.hasOwnProperty.call(Vr,a)){const{value:c,expires:d}=r[a];if(d&&d<=s)return;qd[a]=c,Vr[a]=c}}))}catch(r){M.error("Error loading mutableParamsCache: ".concat(t),r.message)}})(),Array.isArray(qd.AREAS)&&qd.AREAS.length>0&&x2(qd.AREAS,!0);const VK=(t,r,s)=>{M.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(r))),mr(t,r,s)};ng(jye,!1),ng(zye,!1),ng(S_e,!1),ng(Zye,!1),ng(Mye,!1),ng(dEe,!1),ng(fEe,!1),ng(gEe,!1);const xi=(function(t){const r=new Qr,s=t,a={getListeners:r.getListeners.bind(r),on:(c,d)=>((function(h,m){h===ip.SECURITY_POLICY_VIOLATION&&y$(m,!0)})(c,d),r.on.bind(r)(c,d)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return _$(_$({},s),a)})({__TRACK_LIST__:Kv,VERSION:Jl,BUILD:BL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:VK,getParameter:oe,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let r=new RTCPeerConnection;const s=await(async function(a){let c;return Bn().supportUnifiedPlan?(a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"}),c=(await a.createOffer()).sdp):c=(await a.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c})(r);if(!s)return t;r.close(),r=null,t=(function(a){const c={video:[],audio:[]};return a.match(/ VP8/i)&&c.video.push("VP8"),a.match(/ VP9/i)&&c.video.push("VP9"),a.match(/ AV1/i)&&c.video.push("AV1"),a.match(/ H264/i)&&c.video.push("H264"),a.match(/ H265/i)&&c.video.push("H265"),a.match(/ opus/i)&&c.audio.push("OPUS"),a.match(/ PCMU/i)&&c.audio.push("PCMU"),a.match(/ PCMA/i)&&c.audio.push("PCMA"),a.match(/ G722/i)&&c.audio.push("G722"),c})(s)}catch(r){throw new ke(te.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return t},checkSystemRequirements:function(){const t=It.reportApiInvoke(null,{name:di.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Hr.TRACER});let r=!1;try{const d=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(d&&h&&m),r&&wL()&&Vz(75)&&new d().close()}catch(d){return M.error("check system requirement failed: ",d),!1}let s=!1;const a=Ln();a.name===qn.CHROME&&Number(a.version)>=58&&(Hd.engine.name!=="WebKit"||(function(){const d=Ln();if(d1()){if(d.os===rs.MAC_OS)return!0;if(d.os===rs.IOS){const h=Hd.os.version&&Hd.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1})())&&(s=!0),(a.name===qn.FIREFOX&&Number(a.version)>=56||a.name===qn.OPERA&&Number(a.version)>=45||a.name===qn.SAFARI&&Number(a.version)>=11||a.name==="WebKit"&&(bo()||Bu())&&a.osVersion&&Number(a.osVersion.split(".")[0])>=11||Gz()||Ln().name===qn.QQ)&&(s=!0),M.debug("checkSystemRequirements, api:",r,"browser",s);const c=r&&s;return t.onSuccess(c),c},getDevices:function(t){return ul.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return ul.getRecordingDevices(t)},getCameras:function(t){return ul.getCamerasDevices(t)},getElectronScreenSources:V9,getPlaybackDevices:function(t){return ul.getSpeakers(t)},createClient:function(){var t;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=wr(5,"client-"),a=It.reportApiInvoke(null,{id:s,name:di.CREATE_CLIENT,options:[r],tag:Hr.TRACER});try{(function(c){Yi(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Yi(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Yi(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&Ss(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&Qz(c.turnServer),c.httpRetryConfig!==void 0&&Jz(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&Jz(c.websocketRetryConfig)})(r)}catch(c){throw a.onError(c),c}return(Bz(16,0)||vL(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",M.debug("browser not support vp9, force use vp8")),mr("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),a.onSuccess(),new b_e(Xu(Xu({forceWaitGatewayResponse:!0},r),{},{role:rt(t=["rtc","p2p"]).call(t,r.mode)?"host":r.role||"audience"}),s)},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=oe("CAMERA_CAPTURE_CONFIG"),s=wr(8,"track-cam-"),a=It.reportApiInvoke(null,{id:s,tag:Hr.TRACER,name:di.CREATE_CAM_VIDEO_TRACK,options:[Ar({},t),r]});r&&(t.encoderConfig=r);const c=R1(t);let d=null;M.info("start create camera video track with config",JSON.stringify(t),"trackId",s);try{d=(await ll({video:c},s)).getVideoTracks()[0]||null}catch(m){throw a.onError(m),m}if(!d){const m=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return a.onError(m),m.throw(M)}if(t.optimizationMode&&s2(s,d,t,Gu(t.encoderConfig)),oe("USE_STANDARD_BITRATE_DEFAULT")){const m=Gu(t.encoderConfig);t.encoderConfig=m,delete m.bitrateMax,delete m.bitrateMin}const h=new I1(d,t,c,t.scalabiltyMode?b1(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return a.onSuccess(h.getTrackId()),M.info("create camera video success, trackId:",s),h},createCustomVideoTrack:function(t){const r=wr(8,"track-cus-"),s=It.reportApiInvoke(null,{id:r,tag:Hr.TRACER,name:di.CREATE_CUSTOM_VIDEO_TRACK,options:[t]});oe("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin);const a=new kr(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?b1(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,r,[Sr.CUSTOM_TRACK]);return s.onSuccess(a.getTrackId()),M.info("create custom video track success with config",t,"trackId",a.getTrackId()),a},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=typeof r=="object"?(function(A){return q9(A)})(r):void 0;s&&(r="auto");const a=wr(8,"track-scr-v-"),c=It.reportApiInvoke(null,{id:a,tag:Hr.TRACER,name:di.CREATE_SCREEN_VIDEO_TRACK,options:[Ar({},t),r]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const d=(function(A){const N={};A.screenSourceType&&(N.mediaSource=A.screenSourceType),A.extensionId&&pf()&&(N.extensionId=A.extensionId);const{displaySurface:G,selfBrowserSurface:F,surfaceSwitching:z,systemAudio:ee,preferCurrentTab:Z}=A;(Vv(107)||yL(107)||SL(93))&&(G&&(Yi(G,"displaySurface",["browser","window","monitor"]),N.displaySurface=G),F?(Yi(F,"selfBrowserSurface",["exclude","include"]),N.selfBrowserSurface=F):N.selfBrowserSurface="include",z&&(Yi(z,"surfaceSwitching",["exclude","include"]),N.surfaceSwitching=z)),(Vv(105)||yL(105)||SL(91))&&ee&&(Yi(ee,"systemAudio",["exclude","include"]),N.systemAudio=ee),(Vv(94)||yL(94)||SL(80))&&Z&&(N.preferCurrentTab=!0),A.electronScreenSourceId&&(N.sourceId=A.electronScreenSourceId);const ae=A.encoderConfig?KL(A.encoderConfig):null;return N.mandatory={chromeMediaSource:"desktop",maxWidth:ae?ae.width:void 0,maxHeight:ae?ae.height:void 0},ae&&(ae.frameRate&&(typeof ae.frameRate=="number"?(N.mandatory.maxFrameRate=ae.frameRate,N.mandatory.minFrameRate=ae.frameRate):(N.mandatory.maxFrameRate=ae.frameRate.max||ae.frameRate.ideal||ae.frameRate.exact||void 0,N.mandatory.minFrameRate=ae.frameRate.min||ae.frameRate.ideal||ae.frameRate.exact||void 0),N.frameRate=ae.frameRate),ae.width&&(N.width=ae.width),ae.height&&(N.height=ae.height)),N})(t);let h=null,m=null;const g=Bn();if(!g.supportShareAudio&&r==="enable"){const A=new Le(te.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(A),A.throw(M)}M.info("start create screen video track with config",t,"withAudio",r,"trackId",a);const E=g.supportShareAudio&&r!=="disable";try{const A=await ll({screen:d,screenAudio:E?s||!0:void 0},a);h=A.getVideoTracks()[0]||null,m=A.getAudioTracks()[0]||null}catch(A){throw c.onError(A),A}if(!h){const A=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(A),A.throw(M)}if(!m&&r==="enable"){h&&h.stop();const A=new Le(te.SHARE_AUDIO_NOT_ALLOWED);return c.onError(A),A.throw(M)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(s2(a,h,t,t.encoderConfig&&KL(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const w=new kr(h,t.encoderConfig?KL(t.encoderConfig):{},t.scalabiltyMode?b1(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,a,[Sr.SCREEN_TRACK]);if(!m)return c.onSuccess(w.getTrackId()),M.info("create screen video track success","video:",w.getTrackId()),w;const I=new ci(m,void 0,wr(8,"track-scr-a-"),!1);return c.onSuccess([w.getTrackId(),I.getTrackId()]),M.info("create screen video track success","video:",w.getTrackId(),"audio:",I.getTrackId()),[w,I]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=oe("CAMERA_CAPTURE_CONFIG"),a=wr(8,"track-mic-"),c=wr(8,"track-cam-"),d=It.reportApiInvoke(null,{id:"".concat(a,"-").concat(c),tag:Hr.TRACER,name:di.CREATE_MIC_AND_CAM_TRACKS,options:[t,r,s]});s&&(r.encoderConfig=s);const h=R1(r),m=Y9(t);let g=null,E=null;M.info("start create camera video track(".concat(c,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(r)));try{const A=await ll({audio:m,video:h},"".concat(a,"-").concat(c));g=A.getAudioTracks()[0],E=A.getVideoTracks()[0]}catch(A){throw d.onError(A),A}if(!g||!E){const A=new Le(te.UNEXPECTED_ERROR,"can not find tracks in media stream");return d.onError(A),A.throw(M)}if(r.optimizationMode&&s2(c,E,r,Gu(r.encoderConfig)),oe("USE_STANDARD_BITRATE_DEFAULT")){const A=Gu(r.encoderConfig);r.encoderConfig=A,delete A.bitrateMax,delete A.bitrateMin}const w=new oT(g,t,m,a),I=new I1(E,r,h,r.scalabiltyMode?b1(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return d.onSuccess([w.getTrackId(),I.getTrackId()]),M.info("create camera video track(".concat(c,") and microphone audio track(").concat(a,") success")),[w,I]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=wr(8,"track-mic-"),s=It.reportApiInvoke(null,{id:r,tag:Hr.TRACER,name:di.CREATE_MIC_AUDIO_TRACK,options:[t]}),a=Y9(t);let c=null;M.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{c=(await ll({audio:a},r)).getAudioTracks()[0]||null}catch(h){throw s.onError(h),h}if(!c){const h=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(h),h.throw(M)}const d=new oT(c,t,a,r);return s.onSuccess(d.getTrackId()),M.info("create microphone audio track success, trackId:",r),d},createCustomAudioTrack:function(t){const r=wr(8,"track-cus-"),s=It.reportApiInvoke(null,{id:r,tag:Hr.TRACER,name:di.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),a=new ci(t.mediaStreamTrack,t.encoderConfig?w1(t.encoderConfig):{},r,!1);return M.info("create custom audio track success with config",t,"trackId",a.getTrackId()),s.onSuccess(a.getTrackId()),a},createBufferSourceAudioTrack:async function(t){var r;const{cacheOnlineFile:s,encoderConfig:a}=t;let{source:c}=t;const d={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:s,encoderConfig:a},h=wr(8,"track-buf-"),m=It.reportApiInvoke(null,{id:h,tag:Hr.TRACER,name:di.CREATE_BUFFER_AUDIO_TRACK,options:[d]});if(oe("DISABLE_WEBAUDIO"))throw new Le(te.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");M.info("start create buffer source audio track with config",JSON.stringify(d),"trackId",h);const g=c;if(!(c instanceof AudioBuffer))try{c=await(async function(I,A){let N=null;if(typeof I=="string"){const F=LW.get(I);if(F)return M.debug("use cached audio resource: ",I),F;try{N=(await Kd((()=>ka.get(I,{responseType:"arraybuffer"})),void 0,void 0,{maxRetryCount:3})).data}catch(z){throw new Le(te.FETCH_AUDIO_FILE_FAILED,z.toString())}}else N=await new mt(((z,ee)=>{const Z=new FileReader;Z.onload=ae=>{ae.target?z(ae.target.result):ee(new Le(te.READ_LOCAL_AUDIO_FILE_ERROR))},Z.onerror=()=>{ee(new Le(te.READ_LOCAL_AUDIO_FILE_ERROR))},Z.readAsArrayBuffer(I)}));const G=await(function(F){const z=Qv();return new mt(((ee,Z)=>{z.decodeAudioData(F,(ae=>{ee(ae)}),(ae=>{Z(new Le(te.DECODE_AUDIO_FILE_FAILED,ae.toString()))}))}))})(N);return typeof I=="string"&&A&&LW.set(I,G),G})(c,s)}catch(I){return m.onError(I),I.throw(M)}const E=new Wme(c),w=new zme(g,E,a?w1(a):{},h);return M.info("create buffer source audio track success, trackId:",h),m.onSuccess(w.getTrackId()),w},setAppType:function(t){if(M.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw M.debug("Invalid appType"),new ke(te.INVALID_PARAMS,"invalid app type",t);mr("APP_TYPE",Math.floor(t))},setLogLevel:function(t){M.setLogLevel(t)},enableLogUpload:function(){oe("USE_NEW_LOG")?mr("UPLOAD_LOG",!0):M.enableLogUpload()},disableLogUpload:function(){oe("USE_NEW_LOG")?mr("UPLOAD_LOG",!1):M.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new V7},checkAudioTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=It.reportApiInvoke(null,{tag:Hr.TRACER,name:di.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof ci||t instanceof t0)){const g=new ke(te.INVALID_TRACK,"the parameter is not a audio track");return s.onError(g),g.throw()}r&&r<1e3&&(r=1e3);const a=t instanceof ci?t.getTrackLabel():"remote_track",c=t.getVolumeLevel();let d=c,h=c;const m=Date.now();return new mt((g=>{const E=setInterval((()=>{const w=t.getVolumeLevel();d=w>d?w:d,h=w<h?w:h;const I=d-h>1e-4,A=Date.now()-m;if(I||A>r){clearInterval(E);const N=I,G={duration:A,deviceLabel:a,maxVolumeLevel:d,result:N};M.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(G))),s.onSuccess(G),g(N)}}),200)}))},checkVideoTrackIsActive:async function(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=It.reportApiInvoke(null,{tag:Hr.TRACER,name:di.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(t instanceof kr||t instanceof e0)){const I=new ke(te.INVALID_TRACK,"the parameter is not a video track");return s.onError(I),I.throw()}r&&r<1e3&&(r=1e3);const a=t instanceof kr?t.getTrackLabel():"remote_track",c=t.getMediaStreamTrack(!0),d=document.createElement("video");d.style.width="1px",d.style.height="1px",d.setAttribute("muted",""),d.muted=!0,d.setAttribute("playsinline",""),d.controls=!1,(Vs()||d1())&&(d.style.opacity="0.01",d.style.position="fixed",d.style.left="0",d.style.top="0",document.body.appendChild(d)),d.srcObject=new MediaStream([c]),d.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,g=0;try{const I=Date.now();m=await(function(A,N,G,F){let z,ee=0,Z=null;return new mt(((ae,ye)=>{function _e(){ee>F&&z&&(z(),ae(ee));const ue=G.getContext("2d");if(!ue){const We=new ke(te.UNEXPECTED_ERROR,"can not get canvas 2d context.");return M.error(We.toString()),void ye(We)}ue.drawImage(A,0,0,160,120);const Ae=ue.getImageData(0,0,G.width,G.height),Ue=Math.floor(Ae.data.length/3);if(Z){for(let We=0;We<Ue;We+=3)if(Ae.data[We]!==Z[We])return ee+=1,void(Z=Ae.data);Z=Ae.data}else Z=Ae.data}setTimeout((()=>{z&&(z(),ae(ee))}),N),z=QL((()=>{_e()}),30)}))})(d,r,h,4),g=Date.now()-I}catch(I){throw s.onError(I),I}c_e===qn.SAFARI&&(d.pause(),d.remove()),d.srcObject=null;const E=m>4,w={duration:g,changedPicNum:m,deviceLabel:a,result:E};return M.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(w))),s.onSuccess(w),E},setArea:x2,audioElementPlayCenter:Na,resumeAudioContext:function(){Na.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){T_e.processExternalMediaAEC(t)},registerExtensions:function(t){const r=oe("PLUGIN_INFO")||[];t.forEach((s=>{"name"in s&&!rt(r).call(r,s.name)&&r.push(s.name);const a=s;a.__registered__=!0,a.logger.hookLog=M.extLog,a.reporter.hookApiInvoke=It.extApiInvoke,a.parameters&&Object.keys(a.parameters).forEach((c=>{a.parameters[c]=oe(c)}))})),VK("PLUGIN_INFO",r)},ChannelMediaRelayError:i0,ChannelMediaRelayEvent:_f,ChannelMediaRelayState:rc,RemoteStreamFallbackType:Lme,RemoteStreamType:Dme,ConnectionDisconnectedReason:sr,AudienceLatencyLevelType:dme,AREAS:er,preload:async function(t,r,s,a){return cH(t,r,s,a)}});return Object.defineProperties(xi,{onAudioAutoplayFailed:{get:()=>dl.onAudioAutoplayFailed,set:t=>{dl.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>dl.onAutoplayFailed,set:t=>{dl.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>xi._onSecurityPolicyViolation,set(t){xi._onSecurityPolicyViolation=t,y$(t)}},__CLIENT_LIST__:{get:()=>oe("SHOW_GLOBAL_CLIENT_LIST")?oy:[]}}),ul.on(ny.CAMERA_DEVICE_CHANGED,(t=>{M.info("camera device changed",JSON.stringify(t)),xi.onCameraChanged&&xi.onCameraChanged(t),xi.safeEmit(ip.CAMERA_CHANGED,t)})),ul.on(ny.RECORDING_DEVICE_CHANGED,(t=>{M.info("microphone device changed",JSON.stringify(t)),xi.onMicrophoneChanged&&xi.onMicrophoneChanged(t),xi.safeEmit(ip.MICROPHONE_CHANGED,t)})),ul.on(ny.PLAYOUT_DEVICE_CHANGED,(t=>{M.debug("playout device changed",JSON.stringify(t)),xi.onPlaybackDeviceChanged&&xi.onPlaybackDeviceChanged(t),xi.safeEmit(ip.PLAYBACK_DEVICE_CHANGED,t)})),Na.onAutoplayFailed=()=>{M.info("detect audio element autoplay failed"),dl.onAudioAutoplayFailed&&dl.onAudioAutoplayFailed()},gr.on("autoplay-failed",(()=>{M.info("detect webaudio autoplay failed"),dl.onAudioAutoplayFailed&&dl.onAudioAutoplayFailed(),xi.safeEmit(ip.AUTOPLAY_FAILED)})),gr.on(Ts.STATE_CHANGE,((t,r)=>{M.info("audio context state changed: ".concat(r," => ").concat(t)),xi.onAudioContextStateChanged&&xi.onAudioContextStateChanged(t,r),xi.safeEmit(ip.AUDIO_CONTEXT_STATE_CHANGED,t,r)})),Ci.on(Fv.NETWORK_STATE_CHANGE,((t,r)=>{M.info("[network-indicator] network state changed, ".concat(r," => ").concat(t))})),window&&(window.__ARTC__=xi),xi}))})(HO)),HO.exports}var oWe=sWe();const TR=Hg(oWe),aWe="9442a472625f44e7b2c5065b9f9b3988",cWe=TR.createClient({mode:"rtc",codec:"vp8"});let rC=null;const Nae=k.createContext(null),xae=({children:n,appId:e=aWe,channel:i=null,token:o=null,uid:l=null,enabled:u=!0,startMuted:f=!0,onClientReady:y=()=>{}})=>{const[v,b]=k.useState(!1),[C,R]=k.useState(!1),[O,L]=k.useState([]),[D,U]=k.useState(null),[B,Y]=k.useState(null),[W,ne]=k.useState(null),[le,re]=k.useState(!1),[me,q]=k.useState(!1),[J,Q]=k.useState(!1),[ie,pe]=k.useState(null),[de,he]=k.useState(!1),Se=Ea(),Ie=k.useRef(cWe),Fe=k.useRef({appId:e,channel:i,uid:l,enabled:u}),we=k.useRef(!1),Re=k.useRef(null);k.useRef(null),k.useEffect(()=>{Fe.current={appId:e,channel:i,uid:l,enabled:u}},[e,i,l,u]),k.useEffect(()=>{Y(i)},[i]),k.useEffect(()=>{if(!Ie.current)return;const lt=gt=>{H.log(`Connection state changed to: ${gt}`),gt==="DISCONNECTED"?(b(!1),H.log("Disconnected from Agora")):gt==="CONNECTED"&&(b(!0),U(null))};return Ie.current.on("connection-state-change",lt),()=>{Ie.current.off("connection-state-change",lt)}},[]),k.useEffect(()=>{if(!i||!u)return;const lt=async(Gt,Xt)=>{H.log(`User published: ${Gt.uid}, mediaType: ${Xt}`);try{await Ie.current.subscribe(Gt,Xt),Xt==="audio"&&Gt.audioTrack.play(),L(st=>st.some(hn=>hn.uid===Gt.uid)?st:[...st,Gt])}catch(st){H.error("Error subscribing to user:",st)}},gt=(Gt,Xt)=>{H.log(`User unpublished: ${Gt.uid}, mediaType: ${Xt}`),Xt==="audio"&&Gt.audioTrack&&Gt.audioTrack.stop()},at=Gt=>{H.log(`User joined: ${Gt.uid}`),L(Xt=>Xt.some(st=>st.uid===Gt.uid)?Xt:[...Xt,Gt])},Ct=Gt=>{H.log(`User left: ${Gt.uid}`),L(Xt=>Xt.filter(st=>st.uid!==Gt.uid))};return Ie.current.on("user-published",lt),Ie.current.on("user-unpublished",gt),Ie.current.on("user-joined",at),Ie.current.on("user-left",Ct),(async()=>{if(we.current){H.log("Already initializing, skipping duplicate initialization");return}we.current=!0;try{if(v&&Re.current===i){H.log(`Already joined to channel ${i}`),re(!0),y(Ie.current);return}if(Ie.current.connectionState==="CONNECTING"||Ie.current.connectionState==="CONNECTED")if(Re.current&&Re.current!==i){H.log("Connected to different channel, leaving first");try{await be()}catch(Gt){H.error("Error leaving channel:",Gt)}}else{b(!0),re(!0),Re.current=i,rC=i,y(Ie.current);return}H.log(`Joining channel ${i}`),await Ne(),H.log("Join channel completed")}catch(Gt){H.error("Error during initialization:",Gt)}finally{we.current=!1}})(),()=>{H.log("Cleaning up event listeners"),Ie.current.off("user-published",lt),Ie.current.off("user-unpublished",gt),Ie.current.off("user-joined",at),Ie.current.off("user-left",Ct)}},[i,u,l,y,v]);const Te=async()=>{if(!u||W)return W;H.log("Initializing microphone");try{const lt=await TR.createMicrophoneAudioTrack();return await lt.setMuted(f),ne(lt),H.log("Microphone initialized successfully"),lt}catch(lt){return H.error("Error initializing microphone:",lt),U("Failed to initialize microphone. Please check your permissions."),null}};k.useEffect(()=>{(async()=>{if(i)try{const Ct=await mo(i);Ct&&Ct.voiceDisabled?(H.log("Voice is disabled for this space"),he(!0),v&&await be()):he(!1)}catch(at){H.error("Error checking if voice is disabled:",at)}})();const gt=at=>{at.detail&&typeof at.detail.voiceDisabled=="boolean"&&(H.log("Voice setting changed:",at.detail.voiceDisabled),he(at.detail.voiceDisabled),at.detail.voiceDisabled&&v?be():!at.detail.voiceDisabled&&!v&&u&&i&&Ne())};return window.addEventListener("SpaceVoiceSettingChanged",gt),()=>{window.removeEventListener("SpaceVoiceSettingChanged",gt)}},[i,v,u]);const Ne=async()=>{if(!u)return H.log("Agora is disabled, not joining channel"),!1;if(de)return H.log("Voice is disabled for this space, not joining channel"),U("Voice chat is disabled for this space"),!1;if(!i)return H.error("AgoraProvider: No channel specified"),U("No channel specified"),!1;if(H.log(`joinChannel called for channel ${i} with UID ${l}`),H.log("Current state:",{isJoined:v,isJoining:me,connectionState:Ie.current.connectionState,joinedChannel:Re.current}),v&&Re.current===i)return H.log(`Already joined to channel: ${i}`),!0;if(me)return H.log("AgoraProvider: Already in the process of joining"),!1;if(Ie.current.connectionState==="CONNECTED")if(Re.current&&Re.current!==i){H.log("Connected to different channel, leaving first");try{await be()}catch(lt){H.error("Error leaving channel:",lt)}}else return H.log("Client already connected, setting joined state to true"),b(!0),re(!0),Re.current=i,rC=i,y(Ie.current),!0;if(Ie.current.connectionState==="CONNECTING")return H.log("Client already connecting, waiting for connection"),q(!0),new Promise(lt=>{const gt=setInterval(()=>{Ie.current.connectionState==="CONNECTED"&&(clearInterval(gt),b(!0),q(!1),re(!0),Re.current=i,rC=i,y(Ie.current),lt(!0))},500);setTimeout(()=>{clearInterval(gt),H.log("AgoraProvider: Connection timeout, considering join failed"),q(!1),lt(!1)},1e4)});try{if(H.log(`Joining channel: ${i} with UID: ${l||"random"}`),H.log(`Using appId: ${e}, Type: ${typeof e}, Length: ${e.length}`),!e||e.trim()===""){const gt="AgoraProvider: App ID is empty or invalid";return H.error(gt),U(gt),q(!1),!1}q(!0);const lt=l||Math.floor(Math.random()*1e6);return await Ie.current.join(e,i,o,lt),H.log(`Joined channel successfully with UID: ${Ie.current.uid}`),b(!0),q(!1),re(!0),Re.current=i,rC=i,y(Ie.current),!0}catch(lt){return H.error("Error joining channel:",lt),U(`Error joining channel: ${lt.toString()}`),q(!1),!1}},be=async()=>{if(v)try{W&&await Ie.current.unpublish(W),await Ie.current.leave(),rC=null,Re.current=null,H.log("Left channel successfully"),b(!1),L([])}catch(lt){H.error("Error leaving channel:",lt),U(lt.message||"Failed to leave channel")}};k.useEffect(()=>()=>{W&&W.close()},[]),k.useEffect(()=>{u&&i&&(!v||Re.current!==i)&&Ne()},[u,i,v]);const xe=()=>{if(!W)return!1;try{return W.isActive&&!W.muted}catch(lt){return H.error("Error checking microphone status:",lt),!1}};k.useEffect(()=>{const lt=()=>{const at=xe();at!==C&&(H.log("Syncing microphone state:",{actualStatus:at,currentState:C}),R(at),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:at}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=at,window.agoraClient.microphoneTrack=W))};W&&lt();const gt=setInterval(lt,1e3);return()=>{clearInterval(gt)}},[W,C]);const je=async()=>{var lt;if(de)return H.log("Voice is disabled for this space, cannot toggle"),Se({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const gt=C!==void 0?C:W?!W.muted:!1;if(H.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:C,currentState:gt,hasMicTrack:!!W,trackMuted:W==null?void 0:W.muted}),!W&&(H.log("AgoraProvider: No microphone track, initializing..."),!await Te()))return H.error("AgoraProvider: Failed to initialize microphone"),gt;const at=!gt;if(H.log("AgoraProvider: New voice state will be:",at),gt){if(W)try{H.log("AgoraProvider: Muting microphone track"),await W.setMuted(!0),W.muted||(H.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await W.setEnabled(!1)),H.log("AgoraProvider: Microphone track muted successfully, muted state:",W.muted)}catch(Ct){return H.error("Error muting track:",Ct),gt}}else if(W)try{Ie.current&&v&&!((lt=Ie.current.localTracks)!=null&&lt.includes(W))&&(H.log("AgoraProvider: Publishing microphone track"),await Ie.current.publish(W),H.log("AgoraProvider: Microphone track published successfully")),H.log("AgoraProvider: Unmuting microphone track"),await W.setMuted(!1),W.muted&&(H.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await W.setEnabled(!0)),H.log("AgoraProvider: Microphone track unmuted successfully, muted state:",W.muted)}catch(Ct){return H.error("Error unmuting track:",Ct),gt}return R(at),at}catch(gt){return H.error("Error toggling voice:",gt),C}},nt=async lt=>{try{ne(lt),H.log("Microphone track updated successfully")}catch(gt){throw H.error("Error updating microphone track:",gt),gt}},dt=async()=>{if(!Ie.current||!i)return H.error("AgoraProvider: Voice chat not connected"),!1;try{if(J)return H.log("AgoraProvider: Stopping screen share"),ie&&(Array.isArray(ie)?(await Ie.current.unpublish(ie),ie.forEach(lt=>lt.close())):(await Ie.current.unpublish(ie),ie.close()),pe(null)),Q(!1),H.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;H.log("AgoraProvider: Starting screen share");try{const lt=await TR.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return H.log("AgoraProvider: Screen track created:",lt),lt.on("track-ended",()=>{H.log("AgoraProvider: Screen sharing ended by browser UI"),Ie.current.unpublish(lt),lt.close(),pe(null),Q(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await Ie.current.publish(lt),pe(lt),Q(!0),H.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=lt,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(lt){return H.error("AgoraProvider: Error creating screen track:",lt),Q(!1),pe(null),!1}}catch(lt){return H.error("AgoraProvider: Error toggling screen share:",lt),Q(!1),pe(null),!1}};k.useEffect(()=>{if(H.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:Ie.current,isScreenSharing:!1,screenTrack:null};const lt=at=>{H.log("AgoraProvider: Received ToggleScreenShare event"),dt().then(Ct=>{at.detail&&at.detail.callback&&at.detail.callback(!0,Ct)}).catch(Ct=>{H.error("AgoraProvider: Error handling ToggleScreenShare event:",Ct),at.detail&&at.detail.callback&&at.detail.callback(!1,J)})},gt=at=>{H.log("AgoraProvider: Received JoinVoiceChat event"),Ne().then(Ct=>{at.detail&&at.detail.callback&&at.detail.callback(Ct)}).catch(Ct=>{H.error("AgoraProvider: Error handling JoinVoiceChat event:",Ct),at.detail&&at.detail.callback&&at.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",lt),window.addEventListener("JoinVoiceChat",gt),()=>{window.removeEventListener("ToggleScreenShare",lt),window.removeEventListener("JoinVoiceChat",gt),typeof window<"u"&&window.agoraClient&&(H.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(H.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),k.useEffect(()=>{H.log("AgoraProvider: Voice enabled state changed:",C),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=C,window.agoraClient.microphoneTrack=W,window.agoraClient.client=Ie.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:C}})),H.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:C}))},[C,W]);const ft={client:Ie.current,isJoined:v,isVoiceEnabled:C,users:O,error:D,channel:B,appId:e,toggleVoice:je,leaveChannel:be,joinChannel:Ne,microphoneTrack:W,isReady:le,createMicrophoneTrack:nt,isScreenSharing:J,screenTrack:ie,toggleScreenShare:dt,voiceDisabled:de};return S.jsx(Nae.Provider,{value:ft,children:n})},Dae=()=>{const n=k.useContext(Nae);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};xae.propTypes={children:Nn.node.isRequired,appId:Nn.string.isRequired,channel:Nn.string.isRequired,token:Nn.string,uid:Nn.oneOfType([Nn.string,Nn.number])};const lWe=()=>{var we,Re;const{client:n,isVoiceEnabled:e,isJoined:i,users:o,error:l,microphoneTrack:u,isReady:f,channel:y,appId:v,toggleVoice:b,joinChannel:C,leaveChannel:R,createMicrophoneTrack:O,isScreenSharing:L,screenTrack:D,toggleScreenShare:U,voiceDisabled:B}=Dae(),[Y,W]=k.useState(e!==void 0?e:((we=window.agoraClient)==null?void 0:we.isVoiceEnabled)||!1),[ne,le]=k.useState(L!==void 0?L:((Re=window.agoraClient)==null?void 0:Re.isScreenSharing)||!1),[re,me]=k.useState(B!==void 0?B:!1),[q,J]=k.useState(!0);k.useEffect(()=>{var Te;e!==void 0?W(e):((Te=window.agoraClient)==null?void 0:Te.isVoiceEnabled)!==void 0?W(window.agoraClient.isVoiceEnabled):u&&W(!u.muted)},[e,u]),k.useEffect(()=>{var Te;L!==void 0?le(L):((Te=window.agoraClient)==null?void 0:Te.isScreenSharing)!==void 0&&le(window.agoraClient.isScreenSharing)},[L]),k.useEffect(()=>{B!==void 0&&me(B)},[B]);const Q=k.useRef({isVoiceEnabled:Y,isScreenSharing:ne,isJoined:i,users:o,error:l,isReady:f,channel:y,appId:v,voiceDisabled:re});k.useEffect(()=>{Q.current={isVoiceEnabled:Y,isScreenSharing:ne,isJoined:i,users:o,error:l,isReady:f,channel:y,appId:v,voiceDisabled:re}},[Y,ne,i,o,l,f,y,v,re]),k.useEffect(()=>{const Te=setTimeout(()=>{J(!1)},5e3);return()=>clearTimeout(Te)},[]),k.useEffect(()=>{f&&J(!1)},[f]),k.useEffect(()=>{},[e,Y,L,ne,i,o,l,f,y,v,u,D]);const ie=async()=>{try{const Te=await b();if(Te!==void 0)W(Te);else{const Ne=!Y;W(Ne),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Ne)}return Te!==void 0?Te:!Y}catch(Te){return console.error("useVoiceChat: Error toggling voice:",Te),Y}},pe=async()=>{try{const Te=await U();if(Te!==void 0)le(Te);else{const Ne=!ne;le(Ne),window.agoraClient&&(window.agoraClient.isScreenSharing=Ne)}return Te!==void 0?Te:!ne}catch(Te){return console.error("useVoiceChat: Error toggling screen share:",Te),ne}},de=async()=>{Y&&u&&await ie()},he=async()=>{!Y&&u&&await ie()},Se=Te=>o.some(Ne=>{var be;return Ne.uid===Te&&((be=Ne.audioTrack)==null?void 0:be.isPlaying)}),Ie=k.useCallback(()=>{if(!u||!Y)return 0;try{return u.getVolumeLevel()}catch(Te){return console.error("Error getting volume level:",Te),0}},[u,Y]);return{isVoiceEnabled:Y,isScreenSharing:ne,isJoined:i,users:o,error:l,toggleVoice:ie,toggleScreenShare:pe,mute:de,unmute:he,isUserSpeaking:Se,getVolumeLevel:Ie,microphoneTrack:u,screenTrack:D,isLoading:q,channel:y,appId:v,joinChannel:C,leaveChannel:R,client:n,setMicrophoneDevice:async Te=>{try{if(!Te){console.error("No device ID provided");return}if(!n||!i){console.error("Client not initialized or not joined to a channel");return}u&&(Y&&await n.unpublish(u),await u.close());const Ne=await TR.createMicrophoneAudioTrack({microphoneId:Te,encoderConfig:"music_standard"});O&&await O(Ne),Y&&await n.publish(Ne)}catch(Ne){throw console.error("Error changing microphone device:",Ne),Ne}},voiceDisabled:re}},uWe=({size:n="md",tooltipPlacement:e="top",defaultMuted:i=!0,joinOnClick:o=!0,className:l="voice-button"})=>{const{isVoiceEnabled:u,toggleVoice:f,isJoined:y,joinChannel:v,channel:b,client:C,voiceDisabled:R}=lWe(),[O,L]=k.useState(!1),[D,U]=k.useState(!1);k.useEffect(()=>{const W=()=>{H.log("VoiceButton: Player instantiated, showing button"),U(!0)};return window.addEventListener("PlayerInstantiated",W),window.isPlayerInstantiated&&(H.log("VoiceButton: Player was already instantiated"),U(!0)),()=>{window.removeEventListener("PlayerInstantiated",W)}},[]),k.useEffect(()=>{},[u,y,b,C,D,R]);const B=async()=>{if(!(O||R)){L(!0);try{if(!y&&o)try{await v()}catch(ne){ne.message&&ne.message.includes("already in connecting/connected state")||console.error("VoiceButton: Error joining channel:",ne)}const W=await f()}catch(W){console.error("VoiceButton: Error toggling voice:",W)}finally{L(!1)}}},Y=()=>R?"Voice chat is disabled for this space":D?O?"Processing...":y?u?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!D||R?null:S.jsx(Ff,{label:Y(),placement:e,hasArrow:!0,children:S.jsxs($e,{position:"relative",cursor:"pointer",onClick:B,children:[S.jsx(cd,{size:n,borderRadius:"full",bg:u?"green.500":"red.500",icon:u?S.jsx(vae,{color:"white"}):S.jsx(Eae,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),O&&S.jsx($e,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:S.jsx(_d,{size:"sm",color:"white"})})]})})},dWe=gi.createContext({user:null}),hWe=({userNickname:n})=>{const{client:e,channel:i,screenTrack:o,isScreenSharing:l,toggleScreenShare:u}=Dae(),[f,y]=k.useState([]),[v,b]=k.useState(!1),[C,R]=k.useState(!0);k.useRef({});const O=k.useRef(null);k.useRef(null);const{user:L}=k.useContext(dWe)||{user:null},[D,U]=k.useState({}),B=k.useRef(o),[Y,W]=k.useState(null),{isOpen:ne,onOpen:le,onClose:re}=pd(),[me,q]=k.useState(!1),J=k.useRef(null),Q=k.useRef(null);k.useEffect(()=>{B.current=o},[o]),k.useEffect(()=>{if(!e||!i){b(!1);return}const Se=setTimeout(()=>{R(!1)},5e3);if(e.connectionState==="CONNECTED")b(!0),R(!1);else{b(!1);const Fe=we=>{we==="CONNECTED"?(b(!0),R(!1)):b(!1)};return e.on("connection-state-change",Fe),()=>{e.off("connection-state-change",Fe),clearTimeout(Se)}}return()=>{clearTimeout(Se)}},[e,i]),k.useEffect(()=>{const Se=async()=>{const Ie={...D};let Fe=!1;for(const we of f){if(D[we.uid])continue;let Re=null,Te=we.uid;if(typeof Te=="string"&&(Te.includes("-")?(Re=Te.split("-")[0],Te=Te.split("-")[1]):Te.includes("_")&&(Re=Te.split("_")[0],Te=Te.split("_")[1])),Te)try{const Ne=await Vc(Te);Ne&&Ne.Nickname?(Ie[we.uid]=Ne.Nickname,Fe=!0):Re?(Ie[we.uid]=Re,Fe=!0):(Ie[we.uid]="User",Fe=!0)}catch(Ne){console.error("Error fetching user profile:",Ne),Re?(Ie[we.uid]=Re,Fe=!0):(Ie[we.uid]="User",Fe=!0)}else Re?(Ie[we.uid]=Re,Fe=!0):(Ie[we.uid]="User",Fe=!0)}Fe&&U(Ie)};f.length>0&&Se()},[f,D]),k.useEffect(()=>{if(!e||!i||!v)return;const Se=async(we,Re)=>{if(Re==="video")try{await e.subscribe(we,Re),y(Te=>Te.some(Ne=>Ne.uid===we.uid)?Te:[...Te,we])}catch(Te){console.error("Error subscribing to remote video track:",Te)}},Ie=(we,Re)=>{if(Re==="video"){if(we.videoTrack)try{we.videoTrack.stop()}catch(Te){console.error("Error stopping video track:",Te)}if(y(Te=>Te.filter(Ne=>Ne.uid!==we.uid)),l&&B.current&&O.current)try{B.current.play(O.current)}catch(Te){console.error("Error replaying local screen track:",Te)}}},Fe=we=>{const Re=f.find(Te=>Te.uid===we.uid);if(Re&&Re.videoTrack)try{Re.videoTrack.stop()}catch(Te){console.error("Error stopping video track:",Te)}if(y(Te=>Te.filter(Ne=>Ne.uid!==we.uid)),l&&B.current&&O.current)try{B.current.play(O.current)}catch(Te){console.error("Error replaying local screen track:",Te)}};return e.on("user-published",Se),e.on("user-unpublished",Ie),e.on("user-left",Fe),()=>{e.off("user-published",Se),e.off("user-unpublished",Ie),e.off("user-left",Fe)}},[e,i,v,f,l]),k.useEffect(()=>{if(f.forEach(Se=>{if(Se.videoTrack)try{Se.videoTrack.play(`video-container-${Se.uid}`)}catch(Ie){console.error("Error playing video track:",Ie)}}),l&&B.current&&O.current)try{B.current.play(O.current)}catch(Se){console.error("Error replaying local screen track:",Se)}},[f,l]),k.useEffect(()=>{if(l&&o&&O.current)try{o.play(O.current)}catch(Se){console.error("Error playing local screen track:",Se)}},[l,o]),k.useEffect(()=>()=>{if(f.forEach(Se=>{if(Se.videoTrack)try{Se.videoTrack.stop()}catch(Ie){console.error("Error stopping video track on unmount:",Ie)}}),o)try{o.stop()}catch(Se){console.error("Error stopping local screen track on unmount:",Se)}},[f,o]);const ie=()=>{u()},pe=Se=>l&&L&&(Se===L.uid||Se===(e==null?void 0:e.uid))?n||"You":D[Se]?D[Se]:typeof Se=="string"?Se.includes("-")?Se.split("-")[0]:Se.includes("_")?Se.split("_")[0]:Se:"User",de=Se=>{W(Se),le()},he=()=>{W({isLocal:!0}),le()};return k.useEffect(()=>{ne&&Y?setTimeout(()=>{if(Y.isLocal&&B.current)try{B.current.play("modal-screen-container"),q(!0)}catch(Se){console.error("Error playing local screen in modal:",Se)}else if(Y.videoTrack)try{Y.videoTrack.play("modal-screen-container"),q(!0)}catch(Se){console.error("Error playing remote screen in modal:",Se)}},500):ne||(q(!1),W(null),setTimeout(()=>{if(l&&B.current)try{B.current.play("local-screen-container")}catch(Se){console.error("Error playing local screen in small container:",Se)}f.forEach(Se=>{if(Se.videoTrack)try{Se.videoTrack.play(`video-container-${Se.uid}`)}catch(Ie){console.error(`Error playing remote screen ${Se.uid} in small container:`,Ie)}})},500))},[ne,Y,l,f]),!v||C&&f.length===0&&!l||f.length===0&&!l?null:S.jsxs(S.Fragment,{children:[!ne&&S.jsxs($e,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:J,children:[l&&o&&S.jsxs($e,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:he,children:[S.jsx($e,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),S.jsx($e,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),f.map(Se=>{const Ie=D[Se.uid]||pe(Se.uid);return S.jsxs($e,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>de(Se),children:[S.jsx($e,{id:`video-container-${Se.uid}`,width:"100%",height:"100%",position:"relative"}),S.jsx($e,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${Ie}'s Screen`})]},Se.uid)})]}),ne&&S.jsx($e,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:re,children:S.jsxs($e,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:Se=>Se.stopPropagation(),children:[!me&&S.jsxs($e,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[S.jsx(_d,{size:"xl"}),S.jsx(qe,{mt:4,children:"Loading screen share..."})]}),S.jsx($e,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:Q}),S.jsx($e,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:re,children:""}),S.jsx($e,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:Y!=null&&Y.isLocal?n?`${n}'s Screen`:"Your Screen":`${D[Y==null?void 0:Y.uid]||pe(Y==null?void 0:Y.uid)}'s Screen`}),(Y==null?void 0:Y.isLocal)&&S.jsx($e,{position:"absolute",bottom:4,right:4,children:S.jsx($n,{colorScheme:"red",size:"sm",onClick:ie,children:"Stop Sharing"})})]})})]})},pWe=({onClose:n})=>{const e=Ea(),[i,o]=k.useState(!1),[l,u]=k.useState(!1);k.useEffect(()=>{const v=()=>{window.agoraClient&&u(!!window.agoraClient.isScreenSharing)};v();const b=setInterval(v,1e3),C=()=>{v()};return window.addEventListener("ScreenShareToggled",C),()=>{clearInterval(b),window.removeEventListener("ScreenShareToggled",C)}},[]);const f=async v=>{if(v.preventDefault(),v.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){e({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(o(!0),window.agoraClient.isJoined)y();else{const b=new CustomEvent("JoinVoiceChat",{detail:{callback:C=>{if(!C){console.error("ScreenShareMenuOption: Failed to join voice chat"),e({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),o(!1);return}y()}}});window.dispatchEvent(b)}}catch(b){console.error("Error in screen share handler:",b),o(!1),e({title:"Screen sharing error",description:b.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},y=async()=>{try{const v=new CustomEvent("ToggleScreenShare",{detail:{callback:(b,C)=>{o(!1),b?(u(C),e(C?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):e({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(v)}catch(v){console.error("Error toggling screen share:",v),o(!1),e({title:"Screen sharing error",description:v.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return S.jsx(qe,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:f,color:l?"red.300":"white",children:i?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function fWe({open:n,onClose:e}){const[i,o]=k.useState(0);return S.jsxs(Is,{isOpen:n,onClose:e,size:"md",isCentered:!0,children:[S.jsx(Os,{backdropFilter:"blur(4px)"}),S.jsxs(As,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[S.jsx(Jo,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),S.jsx($s,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),S.jsx(Ps,{p:0,display:"flex",children:S.jsxs(xS,{orientation:"vertical",variant:"unstyled",index:i,onChange:o,display:"flex",flexGrow:1,children:[S.jsxs(DS,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[S.jsxs(ga,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Zt,{as:m9e,mb:1}),S.jsx(qe,{fontSize:"xs",children:"Movement"})]}),S.jsxs(ga,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Zt,{as:g9e,mb:1}),S.jsx(qe,{fontSize:"xs",children:"Camera"})]}),S.jsxs(ga,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Zt,{as:p9e,mb:1}),S.jsx(qe,{fontSize:"xs",children:"Actions"})]}),S.jsxs(ga,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Zt,{as:f9e,mb:1}),S.jsx(qe,{fontSize:"xs",children:"Tips"})]})]}),S.jsxs(pR,{flexGrow:1,display:"flex",flexDirection:"column",children:[S.jsxs(uc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx(qe,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),S.jsxs(Mi,{wrap:"wrap",gap:3,children:[S.jsx(cu,{keyLabel:"W",description:"Move Forward"}),S.jsx(cu,{keyLabel:"A",description:"Move Left"}),S.jsx(cu,{keyLabel:"S",description:"Move Backward"}),S.jsx(cu,{keyLabel:"D",description:"Move Right"}),S.jsx(cu,{keyLabel:"Shift",description:"Run"}),S.jsx(cu,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),S.jsxs(uc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx(qe,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),S.jsxs(Mi,{wrap:"wrap",gap:3,children:[S.jsx(cu,{keyLabel:"Mouse",description:"Look Around"}),S.jsx(cu,{keyLabel:"Click + Drag",description:"Rotate Camera"}),S.jsx(cu,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),S.jsxs(uc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx(qe,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),S.jsxs(Mi,{wrap:"wrap",gap:3,children:[S.jsx(cu,{keyLabel:"E",description:"Interact"}),S.jsx(cu,{keyLabel:"F",description:"Emote Menu"}),S.jsx(cu,{keyLabel:"T",description:"Chat"}),S.jsx(cu,{keyLabel:"M",description:"Mute Mic"})]})]}),S.jsxs(uc,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[S.jsx(qe,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),S.jsxs(hr,{align:"stretch",spacing:2,children:[S.jsx(qe,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),S.jsx(qe,{fontSize:"xs",children:" Press ESC to access settings"}),S.jsx(qe,{fontSize:"xs",children:" Click on players to view their profile"}),S.jsx(qe,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const cu=({keyLabel:n,description:e})=>S.jsx($e,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:S.jsxs(Cn,{spacing:2,children:[S.jsx($e,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),S.jsx(qe,{fontSize:"xs",children:e})]})}),mWe=({isOpen:n,onClose:e,containerRef:i})=>{const[o,l]=k.useState([]),[u,f]=k.useState(""),[y,v]=k.useState(0),[b,C]=k.useState(100),[R,O]=k.useState(100),[L,D]=k.useState(!0),[U,B]=k.useState(!0),[Y,W]=k.useState(!1),[ne,le]=k.useState(null),[re,me]=k.useState(null),[q,J]=k.useState(null);k.useEffect(()=>{if(!n)return;(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const Se=await TR.getMicrophones();l(Se),Se.length>0&&f(Se[0].deviceId)}catch(Se){console.error("Error getting audio devices:",Se)}})()},[n]),k.useEffect(()=>{if(!n||!Y){v(0);return}let he;return(async()=>{try{const Ie=await navigator.mediaDevices.getUserMedia({audio:{deviceId:u?{exact:u}:void 0}});J(Ie);const Fe=new(window.AudioContext||window.webkitAudioContext),we=Fe.createAnalyser(),Re=Fe.createMediaStreamSource(Ie);we.fftSize=256,we.smoothingTimeConstant=.8,Re.connect(we),le(Fe),me(we);const Te=new Uint8Array(we.frequencyBinCount),Ne=()=>{we.getByteFrequencyData(Te);const be=Math.sqrt(Te.reduce((nt,dt)=>nt+dt*dt,0)/Te.length),je=Math.min(be*3,255)/255*100*(b/100);v(Math.min(je,100)),Y&&n&&(he=requestAnimationFrame(Ne))};Ne()}catch(Ie){console.error("Error setting up audio analysis:",Ie),v(0)}})(),()=>{he&&cancelAnimationFrame(he),q&&(q.getTracks().forEach(Ie=>Ie.stop()),J(null)),ne&&(ne.close(),le(null)),me(null),v(0)}},[Y,n,u,b]);const Q=he=>{const Se=he.target.value;f(Se)},ie=he=>{C(he)},pe=he=>{O(he)},de=()=>{W(!Y)};return S.jsx(Al,{containerRef:i,children:S.jsxs(Is,{isOpen:n,onClose:e,size:"md",isCentered:!0,children:[S.jsx(Os,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(As,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",maxW:"500px",children:[S.jsx(Jo,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",children:"Voice Chat Settings"}),S.jsx($s,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(Ps,{px:4,py:3,children:S.jsxs(hr,{spacing:4,align:"stretch",children:[S.jsxs(Br,{children:[S.jsxs(os,{fontSize:"sm",fontWeight:"500",color:"white",mb:2,children:["Microphone",S.jsx(Dc,{ml:2,bg:Y?"rgba(34, 197, 94, 0.2)":"rgba(239, 68, 68, 0.2)",color:Y?"#22c55e":"#ef4444",fontSize:"xs",px:2,py:1,borderRadius:"full",children:Y?"Enabled":"Muted"})]}),S.jsxs(Gre,{value:u,onChange:Q,bg:"rgba(255,255,255,0.05)",borderColor:"rgba(255,255,255,0.15)",_hover:{borderColor:"rgba(255,255,255,0.3)"},_focus:{borderColor:"rgba(255,255,255,0.5)",boxShadow:"0 0 0 1px rgba(255,255,255,0.3)"},borderRadius:"lg",size:"sm",fontSize:"xs",children:[o.map(he=>S.jsx("option",{value:he.deviceId,style:{backgroundColor:"#1a1a1a",color:"white"},children:he.label||`Microphone ${he.deviceId.slice(0,5)}...`},he.deviceId)),o.length===0&&S.jsx("option",{value:"",style:{backgroundColor:"#1a1a1a",color:"white"},children:"No microphones found"})]})]}),S.jsxs($e,{children:[S.jsx(qe,{fontSize:"sm",fontWeight:"500",color:"white",mb:2,children:"Microphone Level"}),S.jsx(Hy,{value:y,colorScheme:"green",size:"sm",borderRadius:"full",bg:"rgba(255,255,255,0.1)",hasStripe:y>20,isAnimated:y>20,sx:{"& > div":{backgroundColor:"#22c55e !important"}}})]}),S.jsxs(Br,{children:[S.jsxs(os,{fontSize:"sm",fontWeight:"500",color:"white",mb:2,children:["Microphone Volume: ",b,"%"]}),S.jsxs(hS,{value:b,onChange:ie,min:0,max:100,step:1,colorScheme:"gray",children:[S.jsx(fS,{bg:"rgba(255,255,255,0.1)",h:"6px",borderRadius:"full",children:S.jsx(mS,{})}),S.jsx(pS,{boxSize:4})]})]}),S.jsxs(Br,{children:[S.jsxs(os,{fontSize:"sm",fontWeight:"500",color:"white",mb:2,children:["Speaker Volume: ",R,"%"]}),S.jsxs(hS,{value:R,onChange:pe,min:0,max:100,step:1,colorScheme:"gray",children:[S.jsx(fS,{bg:"rgba(255,255,255,0.1)",h:"6px",borderRadius:"full",children:S.jsx(mS,{})}),S.jsx(pS,{boxSize:4})]})]}),S.jsxs(Br,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[S.jsx(os,{mb:"0",fontSize:"sm",fontWeight:"500",color:"white",children:"Microphone Enabled"}),S.jsx(sd,{isChecked:Y,onChange:de,colorScheme:"gray",size:"md"})]}),S.jsxs(Br,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[S.jsx(os,{mb:"0",fontSize:"sm",fontWeight:"500",color:"white",children:"Echo Cancellation"}),S.jsx(sd,{isChecked:L,onChange:()=>D(!L),colorScheme:"gray",size:"md"})]}),S.jsxs(Br,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[S.jsx(os,{mb:"0",fontSize:"sm",fontWeight:"500",color:"white",children:"Noise Suppression"}),S.jsx(sd,{isChecked:U,onChange:()=>B(!U),colorScheme:"gray",size:"md"})]}),S.jsx($e,{mt:2,p:3,bg:"rgba(255,255,255,0.05)",borderRadius:"lg",border:"1px solid rgba(255,255,255,0.1)",children:S.jsx(qe,{fontSize:"xs",color:"gray.400",children:"Note: These settings will be applied when you join a voice chat."})})]})})]})]})})};function gWe({open:n,onClose:e,containerRef:i}){const[o,l]=k.useState(!1),[u,f]=k.useState(100),[y,v]=k.useState(100),[b,C]=k.useState(100),R=za(),O=()=>{l(!0)},L=()=>{l(!1)},D=Y=>{f(Y),R("SetMasterVolume",{volume:Y/100})},U=Y=>{v(Y),R("SetMusicVolume",{volume:Y/100})},B=Y=>{C(Y),R("SetSFXVolume",{volume:Y/100})};return n?S.jsxs(S.Fragment,{children:[S.jsx(Al,{containerRef:i,children:S.jsx($e,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",backdropFilter:"blur(2px)",bg:"rgba(0, 0, 0, 0.3)",zIndex:"999",opacity:n?1:0,visibility:n?"visible":"hidden",transition:"opacity 0.3s ease-in-out, visibility 0.3s ease-in-out",pointerEvents:n?"auto":"none",onClick:e})}),S.jsx(Al,{containerRef:i,children:S.jsxs($e,{position:"absolute",top:"0",right:"0",bottom:"0",width:"35%",minWidth:"600px",bg:"rgba(26, 32, 44, 0.95)",backdropFilter:"blur(10px)",borderLeft:"1px solid rgba(255, 255, 255, 0.1)",zIndex:"1000",color:"white",overflowY:"auto",transform:n?"translateX(0)":"translateX(100%)",transition:"transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)",maxHeight:"100vh",children:[S.jsx($e,{p:4,borderBottom:"1px solid rgba(255, 255, 255, 0.1)",position:"sticky",top:"0",bg:"rgba(26, 32, 44, 0.95)",backdropFilter:"blur(10px)",zIndex:"1001",children:S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsx(qe,{fontSize:"xl",fontWeight:"bold",children:"Settings"}),S.jsx($n,{variant:"ghost",size:"xs",onClick:e,color:"white",_hover:{bg:"whiteAlpha.200"},"aria-label":"Close settings",minW:"auto",h:"auto",p:1,children:""})]})}),S.jsx($e,{p:4,children:S.jsxs(xS,{variant:"unstyled",colorScheme:"blue",children:[S.jsxs(DS,{mb:4,bg:"rgba(255, 255, 255, 0.1)",borderRadius:"md",p:.5,children:[S.jsx(ga,{_selected:{bg:"blue.500",color:"white",borderRadius:"sm"},color:"whiteAlpha.700",_hover:{color:"white"},flex:"1",fontWeight:"medium",fontSize:"sm",py:2,px:3,children:"Audio & Video"}),S.jsx(ga,{_selected:{bg:"blue.500",color:"white",borderRadius:"sm"},color:"whiteAlpha.700",_hover:{color:"white"},flex:"1",fontWeight:"medium",fontSize:"sm",py:2,px:3,children:"Graphics"})]}),S.jsxs(pR,{children:[S.jsx(uc,{p:0,children:S.jsxs(hr,{spacing:6,align:"stretch",children:[S.jsxs($e,{children:[S.jsx(qe,{fontSize:"lg",fontWeight:"bold",mb:4,color:"white",children:"Audio"}),S.jsxs(hr,{spacing:3,align:"stretch",children:[S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsx(qe,{fontSize:"sm",color:"white",minW:"120px",children:"Master Volume"}),S.jsxs(Cn,{spacing:3,flex:"1",justify:"flex-end",children:[S.jsxs(qe,{fontSize:"sm",color:"whiteAlpha.800",minW:"50px",textAlign:"right",children:[u,"%"]}),S.jsx($e,{width:"180px",children:S.jsxs(hS,{value:u,onChange:D,min:0,max:100,step:1,colorScheme:"blue",size:"sm",children:[S.jsx(fS,{bg:"whiteAlpha.300",h:"4px",children:S.jsx(mS,{})}),S.jsx(pS,{boxSize:4})]})})]})]}),S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsx(qe,{fontSize:"sm",color:"white",minW:"120px",children:"Music Volume"}),S.jsxs(Cn,{spacing:3,flex:"1",justify:"flex-end",children:[S.jsxs(qe,{fontSize:"sm",color:"whiteAlpha.800",minW:"50px",textAlign:"right",children:[y,"%"]}),S.jsx($e,{width:"180px",children:S.jsxs(hS,{value:y,onChange:U,min:0,max:100,step:1,colorScheme:"green",size:"sm",children:[S.jsx(fS,{bg:"whiteAlpha.300",h:"4px",children:S.jsx(mS,{})}),S.jsx(pS,{boxSize:4})]})})]})]}),S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsx(qe,{fontSize:"sm",color:"white",minW:"120px",children:"Sound Effects Volume"}),S.jsxs(Cn,{spacing:3,flex:"1",justify:"flex-end",children:[S.jsxs(qe,{fontSize:"sm",color:"whiteAlpha.800",minW:"50px",textAlign:"right",children:[b,"%"]}),S.jsx($e,{width:"180px",children:S.jsxs(hS,{value:b,onChange:B,min:0,max:100,step:1,colorScheme:"orange",size:"sm",children:[S.jsx(fS,{bg:"whiteAlpha.300",h:"4px",children:S.jsx(mS,{})}),S.jsx(pS,{boxSize:4})]})})]})]})]})]}),S.jsxs($e,{children:[S.jsx(qe,{fontSize:"lg",fontWeight:"bold",mb:4,color:"white",children:"Voice Chat"}),S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsx(qe,{fontSize:"sm",color:"white",children:"Microphone"}),S.jsx($n,{onClick:O,variant:"outline",size:"sm",colorScheme:"gray",borderColor:"whiteAlpha.400",color:"white",_hover:{bg:"whiteAlpha.200"},rightIcon:S.jsx($e,{as:"span",children:""}),px:4})]})]})]})}),S.jsx(uc,{p:0,children:S.jsxs(hr,{spacing:4,align:"stretch",children:[S.jsx(qe,{fontSize:"md",fontWeight:"semibold",children:"Graphics Settings"}),S.jsx($e,{p:4,bg:"whiteAlpha.100",borderRadius:"md",border:"1px solid",borderColor:"whiteAlpha.200",children:S.jsx(qe,{color:"whiteAlpha.700",fontSize:"sm",children:"Graphics settings will be available here."})})]})})]})]})})]})}),o&&S.jsx(mWe,{isOpen:o,onClose:L,containerRef:i})]}):null}function _We(n){return ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function yWe(n){return ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function uZ(n){return ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"2",width:"20",height:"20",rx:"2.18",ry:"2.18"}},{tag:"line",attr:{x1:"7",y1:"2",x2:"7",y2:"22"}},{tag:"line",attr:{x1:"17",y1:"2",x2:"17",y2:"22"}},{tag:"line",attr:{x1:"2",y1:"12",x2:"22",y2:"12"}},{tag:"line",attr:{x1:"2",y1:"7",x2:"7",y2:"7"}},{tag:"line",attr:{x1:"2",y1:"17",x2:"7",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"17",x2:"22",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"7",x2:"22",y2:"7"}}]})(n)}function Dy(n){return ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function EWe(n){return ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function vWe(n){return ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function SWe(n){return ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"}}]})(n)}function bWe(n){return ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function wWe(n){return ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function dZ(n){return ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"}}]})(n)}function Ly(n){return ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function $O(n){return ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function hZ(n){return ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"8.5",cy:"7",r:"4"}},{tag:"line",attr:{x1:"23",y1:"11",x2:"17",y2:"11"}}]})(n)}function tV(n){return ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"8.5",cy:"7",r:"4"}},{tag:"line",attr:{x1:"20",y1:"8",x2:"20",y2:"14"}},{tag:"line",attr:{x1:"23",y1:"11",x2:"17",y2:"11"}}]})(n)}function pZ(n){return ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function $C(n){return ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function TWe(n){return ir({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const CWe=async()=>{try{H.log("tagsFirestore: Fetching all tags");const n=Uc(Xn,"tags"),e=await hd(n),i=[];return e.forEach(o=>{i.push({id:o.id,...o.data()})}),i}catch(n){throw H.error("tagsFirestore: Error fetching tags:",n),n}},RWe=async n=>{try{H.log(`tagsFirestore: Fetching tag with ID: ${n}`);const e=_r(Xn,"tags",n),i=await Xo(e);return i.exists()?{id:i.id,...i.data()}:(H.warn(`tagsFirestore: Tag with ID ${n} not found`),null)}catch(e){throw H.error(`tagsFirestore: Error fetching tag with ID ${n}:`,e),e}},IWe=async({id:n,name:e,color:i,description:o})=>{try{H.log(`tagsFirestore: Creating new tag: ${e}`);const l={name:e,color:i||"#808080",description:o||"",createdAt:new Date,updatedAt:new Date};let u;if(n){const f=_r(Xn,"tags",n);await Gg(f,l),u=n}else{const f=Uc(Xn,"tags");u=(await Aoe(f,l)).id}return{id:u,...l}}catch(l){throw H.error("tagsFirestore: Error creating tag:",l),l}},AWe=async(n,e)=>{try{H.log(`tagsFirestore: Adding tag ${e} to space ${n}`);const i=_r(Xn,"tags",e);if(!(await Xo(i)).exists())throw new Error(`Tag with ID ${e} does not exist`);const l=_r(Xn,"spaces",n);return await ko(l,{tags:J6e(e)}),!0}catch(i){throw H.error(`tagsFirestore: Error adding tag ${e} to space ${n}:`,i),i}},PWe=async(n,e)=>{try{H.log(`tagsFirestore: Removing tag ${e} from space ${n}`);const i=_r(Xn,"spaces",n);return await ko(i,{tags:koe(e)}),!0}catch(i){throw H.error(`tagsFirestore: Error removing tag ${e} from space ${n}:`,i),i}},OWe=async n=>{try{H.log(`tagsFirestore: Getting tags for space ${n}`);const e=_r(Xn,"spaces",n),i=await Xo(e);if(!i.exists())throw new Error(`Space with ID ${n} not found`);const l=i.data().tags||[];if(l.length===0)return[];const u=[];for(const f of l){const y=await RWe(f);y&&u.push(y)}return u}catch(e){throw H.error(`tagsFirestore: Error getting tags for space ${n}:`,e),e}},kWe=async()=>{H.log("tagsFirestore: Initializing default tags");const n=[{id:"collaboration",name:"Collaboration",color:"#4287f5",description:"Spaces designed for team collaboration and meetings"},{id:"social",name:"Social",color:"#f54242",description:"Social gathering and networking spaces"},{id:"education",name:"Education",color:"#42f581",description:"Learning and educational environments"},{id:"events",name:"Events",color:"#f5a742",description:"Spaces optimized for hosting events"},{id:"showcase",name:"Showcase",color:"#9f42f5",description:"Spaces for exhibiting content and creations"},{id:"entertainment",name:"Entertainment",color:"#f542b3",description:"Entertainment and leisure spaces"},{id:"productivity",name:"Productivity",color:"#42dbf5",description:"Spaces focused on work and productivity"},{id:"featured",name:"Featured",color:"#f5f242",description:"Featured and highlighted spaces"}];try{let e=0,i=0;for(const o of n){H.log(`tagsFirestore: Processing tag: ${o.name}`);const l=_r(Xn,"tags",o.id);(await Xo(l)).exists()?(H.log(`tagsFirestore: Tag ${o.id} already exists, skipping`),i++):(await IWe(o),e++,H.log(`tagsFirestore: Created tag: ${o.name}`))}return H.log(`tagsFirestore: Tags initialization complete. Created: ${e}, Skipped: ${i}`),{created:e,skipped:i}}catch(e){throw H.error("tagsFirestore: Error initializing default tags:",e),e}},Lae=({spaceID:n})=>{const[e,i]=k.useState([]),[o,l]=k.useState([]),[u,f]=k.useState(!0),[y,v]=k.useState(!1),[b,C]=k.useState(!1),[R,O]=k.useState(null),{isOpen:L,onOpen:D,onClose:U}=pd(),B=Ea(),{user:Y}=k.useContext(ls),W=(Y==null?void 0:Y.groups)&&(Y.groups.includes("disruptiveAdmin")||Y.groups.includes("admin"));k.useEffect(()=>{ne()},[n]);const ne=async()=>{f(!0);try{let Q=[];try{Q=await CWe(),i(Q)}catch(ie){H.error("SpaceTagsManager: Error loading available tags:",ie),i([]),B({title:"Error loading tags",description:"Failed to load available tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}if(n)try{const ie=await OWe(n);l(ie)}catch(ie){H.error("SpaceTagsManager: Error loading space tags:",ie),l([]),B({title:"Error loading space tags",description:"Failed to load this space's tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}}catch(Q){H.error("SpaceTagsManager: Error in loadTags:",Q),B({title:"Error loading tags",description:"Failed to load tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}finally{f(!1)}},le=async()=>{C(!0),O(null);try{const Q=await kWe();O(Q),B({title:"Tags initialized",description:`Successfully created ${Q.created} tags. Skipped ${Q.skipped} existing tags.`,status:"success",duration:4e3,isClosable:!0}),await ne()}catch(Q){H.error("SpaceTagsManager: Error initializing tags:",Q),O(!1),B({title:"Error initializing tags",description:"Failed to initialize tags. Please try again later.",status:"error",duration:4e3,isClosable:!0})}finally{C(!1)}},re=async Q=>{if(!(!n||!Q)){v(!0);try{await AWe(n,Q);const ie=e.find(pe=>pe.id===Q);ie&&l(pe=>[...pe,ie]),B({title:"Tag added",description:"Tag has been added to the space.",status:"success",duration:2e3,isClosable:!0})}catch(ie){H.error(`SpaceTagsManager: Error adding tag ${Q} to space:`,ie),B({title:"Error adding tag",description:"Failed to add tag to the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},me=async Q=>{if(!(!n||!Q)){v(!0);try{await PWe(n,Q),l(ie=>ie.filter(pe=>pe.id!==Q)),B({title:"Tag removed",description:"Tag has been removed from the space.",status:"info",duration:2e3,isClosable:!0})}catch(ie){H.error(`SpaceTagsManager: Error removing tag ${Q} from space:`,ie),B({title:"Error removing tag",description:"Failed to remove tag from the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},q=()=>{const Q=o.map(ie=>ie.id);return e.filter(ie=>!Q.includes(ie.id))},J=q().length===0;return S.jsxs($e,{children:[S.jsx(Mi,{mb:3,justifyContent:"space-between",alignItems:"center",children:S.jsxs(Cn,{spacing:2,ml:"auto",children:[W&&S.jsx($n,{size:"xs",leftIcon:S.jsx(Wze,{}),onClick:D,variant:"outline",colorScheme:"purple",children:"Admin"}),S.jsxs(XS,{children:[S.jsx(JS,{as:$n,size:"xs",leftIcon:S.jsx(zze,{}),rightIcon:S.jsx(Hze,{}),isDisabled:u||y||J,children:J?"No Available Tags":"Add Tag"}),S.jsx(QS,{zIndex:1e3,bg:"gray.800",borderColor:"gray.700",color:"white",children:q().length>0?q().map(Q=>S.jsx(NS,{onClick:()=>re(Q.id),icon:S.jsx($e,{width:"12px",height:"12px",borderRadius:"full",bg:Q.color||"#888"}),_hover:{bg:"gray.700"},_focus:{bg:"gray.700"},_active:{bg:"gray.700"},_focusVisible:{bg:"gray.700"},bg:"gray.800",color:"white",children:Q.name},Q.id)):S.jsx(NS,{isDisabled:!0,bg:"gray.800",color:"gray.400",children:"No available tags to add"})})]})]})}),u?S.jsx(Mi,{justify:"center",py:4,children:S.jsx(_d,{size:"sm",color:"blue.300"})}):e.length===0?S.jsx($e,{children:S.jsxs(qe,{fontSize:"sm",color:"red.400",mb:2,children:["No tags have been created in the system yet.",W?" Use the Admin button to initialize tags.":" Ask an admin to initialize tags."]})}):o.length===0?S.jsx(qe,{fontSize:"sm",color:"gray.400",fontStyle:"italic",children:"No tags assigned to this space."}):S.jsx(tie,{spacing:2,children:o.map(Q=>S.jsx(Ej,{children:S.jsxs(Xre,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"gray",boxShadow:`0 0 0 1px ${Q.color||"#888"}`,children:[S.jsx($e,{width:"8px",height:"8px",borderRadius:"full",bg:Q.color||"#888",mr:1}),S.jsx(Jre,{children:Q.name}),S.jsx(Zre,{onClick:()=>me(Q.id),isDisabled:y})]})},Q.id))}),S.jsxs(Is,{isOpen:L,onClose:U,size:"md",children:[S.jsx(Os,{backdropFilter:"blur(4px)"}),S.jsxs(As,{bg:"gray.800",color:"white",children:[S.jsx(Jo,{fontSize:"md",children:"Tag System Administration"}),S.jsx($s,{}),S.jsxs(Ps,{children:[S.jsx(qe,{fontSize:"sm",mb:4,children:"Initialize the default tags in your Firestore database. This will create a set of predefined tags if they don't already exist."}),R&&S.jsxs(Jy,{status:"success",mb:4,borderRadius:"md",size:"sm",children:[S.jsx(Qy,{}),S.jsxs(qe,{fontSize:"sm",children:["Tags initialized. Created: ",S.jsx("b",{children:R.created}),", Skipped: ",S.jsx("b",{children:R.skipped})]})]}),S.jsx($n,{colorScheme:"blue",onClick:le,isLoading:b,loadingText:"Initializing...",size:"sm",width:"full",children:"Initialize Default Tags"})]}),S.jsx(gh,{children:S.jsx($n,{variant:"ghost",size:"sm",onClick:U,children:"Close"})})]})]})]})};Lae.propTypes={spaceID:Nn.string.isRequired};const NWe=({isOpen:n,onClose:e})=>{const{spaceID:i}=xo(),[o,l]=k.useState(0),[u,f]=k.useState(""),[y,v]=k.useState(""),[b,C]=k.useState(!1),[R,O]=k.useState(null),[L,D]=k.useState(null),[U,B]=k.useState(!1),[Y,W]=k.useState(0),[ne,le]=k.useState(null),re=k.useRef(null),[me,q]=k.useState(null),[J,Q]=k.useState(null),[ie,pe]=k.useState(!1),[de,he]=k.useState(0),[Se,Ie]=k.useState(null),Fe=k.useRef(null),[we,Re]=k.useState(null),[Te,Ne]=k.useState(null),[be,xe]=k.useState(!1),[je,nt]=k.useState(0),[dt,ft]=k.useState(null),lt=k.useRef(null),[gt,at]=k.useState([]),[Ct,En]=k.useState([]),[Gt,Xt]=k.useState(!1),[st,hn]=k.useState([]),[an,jt]=k.useState(null),[on,St]=k.useState(!1),[ve,De]=k.useState(!1),[Ke,Ot]=k.useState(!0),[Et,Pt]=k.useState(!1),[Ut,cn]=k.useState(!1),[_t,wn]=k.useState(!1),[Nt,Ht]=k.useState(!1),[Lr,wi]=k.useState(""),[ti,Vi]=k.useState(""),[us,_o]=k.useState(""),[Wr,Do]=k.useState(!1),{setHLSStreamUrl:Fc,savedStreamData:Yr}=Sae(),[yo,Ys]=k.useState(!1),[Zi,Bc]=k.useState([]),[Eo,yu]=k.useState(""),[Wa,Ns]=k.useState(!1),Kt=Ea();k.useEffect(()=>{n&&i&&zc()},[n,i]);const zc=async()=>{try{const Je=await mo(i);Je.logoUrl&&le(Je.logoUrl),Je.backgroundUrl&&Ie(Je.backgroundUrl),Je.videoBackgroundUrl&&ft(Je.videoBackgroundUrl),Je.voiceDisabled!==void 0&&St(Je.voiceDisabled),Je.textChatDisabled!==void 0&&De(Je.textChatDisabled),Je.accessibleToAllUsers!==void 0&&Ot(Je.accessibleToAllUsers),Je.allowGuestUsers!==void 0&&Pt(Je.allowGuestUsers),Je.hideGuestSignInButton!==void 0&&cn(Je.hideGuestSignInButton),f(Je.name||""),v(Je.description||""),Je.Override?(Ys(Je.Override.enabled===!0),Bc(Je.Override.customPlayers||[])):(Ys(!1),Bc([]));try{const qt=await eae(i);if(qt){wi(qt.streamUrl||""),Vi(qt.rtmpUrl||""),_o(qt.streamKey||"");const Kn=qt.enabled===!0;Ht(Kn),H.log("SpaceManageModal: Directly loaded streaming enabled state from Firebase:",{enabled:Kn,rawValue:qt.enabled})}else Ht(!1),H.log("SpaceManageModal: No stream data found in Firebase, defaulting enabled to false")}catch(qt){if(H.error("Error fetching stream data directly:",qt),Yr){wi(Yr.streamUrl||""),Vi(Yr.rtmpUrl||""),_o(Yr.streamKey||"");const Kn=Yr.enabled===!0;Ht(Kn),H.log("SpaceManageModal: Loaded streaming enabled state from savedStreamData:",{enabled:Kn,rawValue:Yr.enabled})}else Ht(!1),H.log("SpaceManageModal: No savedStreamData available, defaulting enabled to false")}Zo(Je)}catch(Je){H.error("Error fetching space data:",Je),Kt({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}};k.useEffect(()=>{if(Yr){if(!Wr){wi(Yr.streamUrl||""),Vi(Yr.rtmpUrl||""),_o(Yr.streamKey||"");const Je=Yr.enabled===!0;Ht(Je),H.log("SpaceManageModal: Updated streaming enabled state from savedStreamData:",{enabled:Je,rawValue:Yr.enabled})}}else n&&!Wr&&H.log("SpaceManageModal: No savedStreamData available but NOT defaulting enabled to false (preserving current state)")},[Yr,Wr,n]);const Zo=async Je=>{if(i&&n){Xt(!0);try{const qt=M0(),Kn=`space_${i}_owners`,$i=Nk(Uc(qt,"users"),SQ("groups","array-contains",Kn)),gs=await hd($i),Gc=[];for(const Ki of gs.docs){const li=Ki.data(),Gr=await Vc(Ki.id);Gc.push({uid:Ki.id,email:li.email,displayName:li.displayName||Gr.Nickname||"Unknown User",photoURL:li.photoURL||Gr.photoURL,firstName:Gr.firstName,lastName:Gr.lastName})}at(Gc);const Ch=`space_${i}_hosts`,gc=Nk(Uc(qt,"users"),SQ("groups","array-contains",Ch)),Hc=await hd(gc),Dl=[];for(const Ki of Hc.docs){const li=Ki.data(),Gr=await Vc(Ki.id);Dl.push({uid:Ki.id,email:li.email,displayName:li.displayName||Gr.Nickname||"Unknown User",photoURL:li.photoURL||Gr.photoURL,firstName:Gr.firstName,lastName:Gr.lastName})}En(Dl);const Cr=Uc(qt,`spaces/${i}/BannedUsers`),Ll=await hd(Cr),_c=[];for(const Ki of Ll.docs){const li=Ki.id;try{const Gr=await Vc(li);_c.push({uid:li,displayName:(Gr==null?void 0:Gr.Nickname)||li,firstName:Gr==null?void 0:Gr.firstName,lastName:Gr==null?void 0:Gr.lastName,photoURL:Gr==null?void 0:Gr.photoURL})}catch{_c.push({uid:li,displayName:li})}}hn(_c)}catch(qt){H.error("Error fetching space users:",qt),Kt({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{Xt(!1)}}};k.useEffect(()=>{i&&n&&o===4&&Zo()},[i,n,o]);const Ga=Je=>{const qt=Je.target.files[0];if(qt){if(!qt.type.startsWith("image/")){Kt({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}O(qt);const Kn=new FileReader;Kn.onloadend=()=>{D(Kn.result)},Kn.readAsDataURL(qt)}},Wc=Je=>{const qt=Je.target.files[0];if(qt){if(!qt.type.startsWith("image/")){Kt({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}q(qt);const Kn=new FileReader;Kn.onloadend=()=>{Q(Kn.result)},Kn.readAsDataURL(qt)}},ea=Je=>{const qt=Je.target.files[0];if(qt){if(!qt.type.startsWith("video/")){Kt({title:"Invalid file type",description:"Please select a video file",status:"error",duration:5e3,isClosable:!0});return}const Kn=5*1024*1024;if(qt.size>Kn){Kt({title:"File too large",description:"Video file must be smaller than 5MB",status:"error",duration:5e3,isClosable:!0});return}Re(qt);const $i=new FileReader;$i.onloadend=()=>{Ne($i.result)},$i.readAsDataURL(qt)}},ta=async()=>{if(!R){Kt({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{B(!0);const Je=setInterval(()=>{W(Kn=>{const $i=Kn+10;return $i>=90?90:$i})},300),qt=await $8e(i,R);clearInterval(Je),W(100),le(qt),Kt({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{O(null),D(null),W(0),B(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:qt}}))}catch(Je){console.error("Error uploading logo:",Je),Kt({title:"Upload failed",description:Je.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),B(!1),W(0)}},yd=async()=>{if(!me){Kt({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{pe(!0);const Je=setInterval(()=>{he(Kn=>{const $i=Kn+10;return $i>=90?90:$i})},300),qt=await q8e(i,me);clearInterval(Je),he(100),Ie(qt),Kt({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{q(null),Q(null),he(0),pe(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:qt}}))}catch(Je){console.error("Error uploading background:",Je),Kt({title:"Upload failed",description:Je.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),pe(!1),he(0)}},Sh=async()=>{if(ne)try{B(!0),await K8e(i),le(null),Kt({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),B(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(Je){console.error("Error deleting logo:",Je),Kt({title:"Deletion failed",description:Je.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),B(!1)}},Pl=async()=>{if(Se)try{pe(!0),await Y8e(i),Ie(null),Kt({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),pe(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(Je){console.error("Error deleting background:",Je),Kt({title:"Deletion failed",description:Je.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),pe(!1)}},bh=async()=>{if(!we){Kt({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{xe(!0);const Je=setInterval(()=>{nt(Kn=>{const $i=Kn+10;return $i>=90?90:$i})},300),qt=await Q8e(i,we);clearInterval(Je),nt(100),ft(qt),Kt({title:"Upload successful",description:"Space video background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{Re(null),Ne(null),nt(0),xe(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:qt}}))}catch(Je){console.error("Error uploading video background:",Je),Kt({title:"Upload failed",description:Je.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),xe(!1),nt(0)}},xs=async()=>{if(dt)try{xe(!0),await Z8e(i),ft(null),Kt({title:"Video background removed",description:"Space video background has been removed",status:"info",duration:5e3,isClosable:!0}),xe(!1),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:null}}))}catch(Je){console.error("Error deleting video background:",Je),Kt({title:"Deletion failed",description:Je.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),xe(!1)}},Ol=()=>{re.current&&re.current.click()},na=()=>{Fe.current&&Fe.current.click()},Ed=()=>{lt.current&&lt.current.click()},kl=async()=>{wn(!0);try{await Q0(i,{voiceDisabled:!on}),St(!on),Kt({title:"Settings Updated",description:`Voice chat has been ${on?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(Je){H.error("Error updating voice settings:",Je),Kt({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{wn(!1)}},Nl=async()=>{wn(!0);try{await Q0(i,{textChatDisabled:!ve}),De(!ve),window.dispatchEvent(new CustomEvent("SpaceTextChatSettingChanged",{detail:{spaceId:i,textChatDisabled:!ve}})),Kt({title:"Settings Updated",description:`Text chat has been ${ve?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(Je){H.error("Error updating text chat settings:",Je),Kt({title:"Error",description:"Failed to update text chat settings",status:"error",duration:3e3,isClosable:!0})}finally{wn(!1)}},va=async()=>{wn(!0);try{await J8e(i,!Ke),Ot(!Ke),Kt({title:"Settings Updated",description:`Space is now ${Ke?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(Je){H.error("Error updating accessibility settings:",Je),Kt({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{wn(!1)}},xl=async()=>{wn(!0);try{const Je=!Et,qt={allowGuestUsers:Je};Je||(qt.hideGuestSignInButton=!1,cn(!1)),await Q0(i,qt),Pt(Je),Kt({title:"Settings Updated",description:`Guest users are now ${Je?"allowed":"not allowed"} in this space.`,status:"success",duration:3e3,isClosable:!0})}catch(Je){H.error("Error updating guest user settings:",Je),Kt({title:"Error",description:"Failed to update guest user settings",status:"error",duration:3e3,isClosable:!0})}finally{wn(!1)}},wh=async()=>{wn(!0);try{await Q0(i,{hideGuestSignInButton:!Ut}),cn(!Ut),window.dispatchEvent(new CustomEvent("SpaceSettingsChanged",{detail:{spaceId:i,hideGuestSignInButton:!Ut}})),Kt({title:"Settings Updated",description:`Guest sign-in button is now ${Ut?"visible":"hidden"}.`,status:"success",duration:3e3,isClosable:!0})}catch(Je){H.error("Error updating sign-in button settings:",Je),Kt({title:"Error",description:"Failed to update sign-in button settings",status:"error",duration:3e3,isClosable:!0})}finally{wn(!1)}},Xs=async()=>{if(i){C(!0);try{const Je=M0(),qt=_r(Je,"spaces",i);await ko(qt,{name:u,description:y}),Kt({title:"Success",description:"Space details updated successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceDetailsUpdated",{detail:{name:u,description:y}}))}catch(Je){H.error("Error updating space details:",Je),Kt({title:"Error",description:"Failed to update space details",status:"error",duration:3e3,isClosable:!0})}finally{C(!1)}}},Xr=async()=>{if(i){Do(!0);try{const Je={enabled:Nt,streamUrl:Lr,rtmpUrl:ti,streamKey:us,playerIndex:"0",updatedAt:new Date().toISOString()};H.log("SpaceManageModal: Saving stream settings to Firebase:",{enabled:Nt,url:Lr,hasRtmp:!!ti,hasKey:!!us});try{await R5(i,Je),H.log("SpaceManageModal: Successfully updated stream settings in Firebase directly")}catch(qt){throw H.error("SpaceManageModal: Error updating stream settings directly in Firebase:",qt),qt}await Fc(Lr,0,{enabled:Nt,rtmpUrl:ti,streamKey:us}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:Nt,spaceId:i}})),Kt({title:"Success",description:`Stream settings updated successfully. Streaming is now ${Nt?"enabled":"disabled"}.`,status:"success",duration:3e3,isClosable:!0}),setTimeout(()=>{zc()},500)}catch(Je){H.error("Error updating stream settings:",Je),Kt({title:"Error",description:"Failed to update stream settings",status:"error",duration:3e3,isClosable:!0})}finally{Do(!1)}}},Th=async Je=>{try{jt(Je);const qt=M0();await BN(_r(qt,`spaces/${i}/BannedUsers`,Je));const Kn=_r(qt,"users",Je),$i=`space_${i}_banned`;await ko(Kn,{groups:koe($i)}),hn(gs=>gs.filter(Gc=>Gc.uid!==Je)),Kt({title:"User Unbanned",description:"User can now re-enter this space.",status:"success",duration:3e3,isClosable:!0})}catch(qt){H.error("Error unbanning user:",qt),Kt({title:"Error",description:"Failed to unban user",status:"error",duration:3e3,isClosable:!0})}finally{jt(null)}},Mr=()=>{if(!Eo.trim()){Kt({title:"URL Required",description:"Please enter a URL",status:"warning",duration:3e3,isClosable:!0});return}const Je={id:Date.now().toString(),url:Eo.trim(),createdAt:new Date().toISOString()};Bc(qt=>[...qt,Je]),yu("")},mc=Je=>{Bc(qt=>qt.filter(Kn=>Kn.id!==Je))},ra=async()=>{const Je=!yo;Ys(Je),Ns(!0);try{const qt=M0(),Kn=_r(qt,"spaces",i);await ko(Kn,{"Override.enabled":Je}),Kt({title:"Override "+(Je?"Enabled":"Disabled"),description:`Override is now ${Je?"enabled":"disabled"}.`,status:"success",duration:2e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceOverrideUpdated",{detail:{enabled:Je,customPlayers:Zi}}))}catch(qt){H.error("Error updating override enabled state:",qt),Ys(!Je),Kt({title:"Error",description:"Failed to update override state",status:"error",duration:3e3,isClosable:!0})}finally{Ns(!1)}},vd=async()=>{if(i){Ns(!0);try{const Je=M0(),qt=_r(Je,"spaces",i);await ko(qt,{"Override.enabled":yo,"Override.customPlayers":Zi}),Kt({title:"Success",description:"Override settings saved successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceOverrideUpdated",{detail:{enabled:yo,customPlayers:Zi}}))}catch(Je){H.error("Error updating override settings:",Je),Kt({title:"Error",description:"Failed to update override settings",status:"error",duration:3e3,isClosable:!0})}finally{Ns(!1)}}};return S.jsxs(Is,{isOpen:n,onClose:e,size:"lg",isCentered:!0,children:[S.jsx(Os,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(As,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",maxW:"800px",maxH:"90vh",overflow:"hidden",children:[S.jsx(Jo,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",borderBottom:"1px solid",borderColor:"whiteAlpha.200",children:"Manage Space"}),S.jsx($s,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(Ps,{p:0,display:"flex",overflow:"hidden",children:S.jsxs(xS,{orientation:"vertical",variant:"unstyled",index:o,onChange:l,display:"flex",width:"100%",height:"100%",children:[S.jsxs(DS,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",flexShrink:0,children:[S.jsxs(ga,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Zt,{as:EWe,mb:1}),S.jsx(qe,{fontSize:"xs",children:"Details"})]}),S.jsxs(ga,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Zt,{as:Dy,mb:1}),S.jsx(qe,{fontSize:"xs",children:"Logo"})]}),S.jsxs(ga,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Zt,{as:yWe,mb:1}),S.jsx(qe,{fontSize:"xs",children:"Background"})]}),S.jsxs(ga,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Zt,{as:bWe,mb:1}),S.jsx(qe,{fontSize:"xs",children:"Settings"})]}),S.jsxs(ga,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Zt,{as:pZ,mb:1}),S.jsx(qe,{fontSize:"xs",children:"Users"})]}),S.jsxs(ga,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Zt,{as:$C,mb:1}),S.jsx(qe,{fontSize:"xs",children:"Stream"})]}),S.jsxs(ga,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[S.jsx(Zt,{as:dZ,mb:1}),S.jsx(qe,{fontSize:"xs",children:"Custom"})]})]}),S.jsxs(pR,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"4px"}},children:[S.jsxs(uc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(qe,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Space Details"}),S.jsxs(hr,{spacing:4,align:"stretch",children:[S.jsxs(Br,{children:[S.jsx(os,{fontSize:"xs",color:"white",children:"Space Name"}),S.jsx(Li,{value:u,onChange:Je=>f(Je.target.value),placeholder:"Enter space name",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",maxLength:100})]}),S.jsxs(Br,{children:[S.jsx(os,{fontSize:"xs",color:"white",children:"Description"}),S.jsx(eie,{value:y,onChange:Je=>v(Je.target.value),placeholder:"Enter space description",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},rows:4,resize:"vertical",maxLength:500})]}),S.jsxs(Br,{children:[S.jsx(os,{fontSize:"xs",color:"white",children:"Space Tags"}),S.jsx($e,{p:3,bg:"whiteAlpha.50",borderWidth:"1px",borderColor:"whiteAlpha.200",borderRadius:"md",children:i?S.jsx(Lae,{spaceID:i}):S.jsxs(Jy,{status:"warning",variant:"subtle",borderRadius:"md",children:[S.jsx(Qy,{}),S.jsx(sk,{fontSize:"sm",children:"Space ID missing"}),S.jsx(ok,{fontSize:"xs",children:"Unable to load tags without a valid space ID."})]})})]}),S.jsx($n,{colorScheme:"blue",size:"sm",onClick:Xs,isLoading:b,loadingText:"Saving...",alignSelf:"flex-start",mt:2,children:"Save Details"})]})]}),S.jsxs(uc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(qe,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Space Logo"}),S.jsx(qe,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(ne||L)&&S.jsxs(Mi,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ne&&S.jsxs($e,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(qe,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),S.jsx(Cp,{src:ne,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),S.jsx($n,{mt:3,colorScheme:"red",leftIcon:S.jsx(Zt,{as:Ly}),onClick:Sh,isLoading:U,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),L&&S.jsxs($e,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(qe,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),S.jsx(Cp,{src:L,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),S.jsxs(Br,{children:[S.jsx(os,{fontSize:"xs",color:"white",children:"Upload New Logo"}),S.jsx(Li,{type:"file",accept:"image/*",onChange:Ga,ref:re,display:"none"}),U&&S.jsxs($e,{mt:3,mb:3,children:[S.jsxs(qe,{fontSize:"xs",mb:1,children:["Uploading... ",Y,"%"]}),S.jsx(Hy,{value:Y,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),S.jsxs(Cn,{mt:3,spacing:3,children:[S.jsx($n,{colorScheme:"blue",leftIcon:S.jsx(Zt,{as:Dy}),onClick:Ol,isDisabled:U,size:"sm",variant:"outline",children:"Browse"}),S.jsx($n,{colorScheme:"green",leftIcon:S.jsx(Zt,{as:$O}),onClick:ta,isLoading:U,loadingText:"Uploading...",isDisabled:!R||U,size:"sm",children:"Upload"})]}),S.jsx(aS,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),S.jsxs(uc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(qe,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Background"}),S.jsx(qe,{fontSize:"xs",mb:4,children:"Upload a background for your space. This will be displayed during loading."}),S.jsxs(xS,{variant:"enclosed",colorScheme:"blue",size:"md",mb:4,borderColor:"blue.300",children:[S.jsxs(DS,{children:[S.jsxs(ga,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[S.jsx(Zt,{as:Dy,mr:2}),"Image"]}),S.jsxs(ga,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[S.jsx(Zt,{as:uZ,mr:2}),"Video (max 5MB)"]})]}),S.jsxs(pR,{mt:4,children:[S.jsxs(uc,{p:0,children:[(Se||J)&&S.jsxs(Mi,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[Se&&S.jsxs($e,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(qe,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),S.jsx(Cp,{src:Se,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),S.jsx($n,{mt:3,colorScheme:"red",leftIcon:S.jsx(Zt,{as:Ly}),onClick:Pl,isLoading:ie,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),J&&S.jsxs($e,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(qe,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),S.jsx(Cp,{src:J,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),S.jsxs(Br,{children:[S.jsx(os,{fontSize:"xs",color:"white",children:"Upload New Background Image"}),S.jsx(Li,{type:"file",accept:"image/*",onChange:Wc,ref:Fe,display:"none"}),ie&&S.jsxs($e,{mt:3,mb:3,children:[S.jsxs(qe,{fontSize:"xs",mb:1,children:["Uploading... ",de,"%"]}),S.jsx(Hy,{value:de,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),S.jsxs(Cn,{mt:3,spacing:3,children:[S.jsx($n,{colorScheme:"blue",leftIcon:S.jsx(Zt,{as:Dy}),onClick:na,isDisabled:ie,size:"sm",variant:"outline",children:"Browse"}),S.jsx($n,{colorScheme:"green",leftIcon:S.jsx(Zt,{as:$O}),onClick:yd,isLoading:ie,loadingText:"Uploading...",isDisabled:!me||ie,size:"sm",children:"Upload"})]}),S.jsx(aS,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),S.jsxs(uc,{p:0,children:[(dt||Te)&&S.jsxs(Mi,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[dt&&S.jsxs($e,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(qe,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Video Background"}),S.jsx($e,{maxH:"160px",overflow:"hidden",position:"relative",children:S.jsx("video",{src:dt,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})}),S.jsx($n,{mt:3,colorScheme:"red",leftIcon:S.jsx(Zt,{as:Ly}),onClick:xs,isLoading:be,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Video"})]}),Te&&S.jsxs($e,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[S.jsx(qe,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),S.jsx($e,{maxH:"160px",overflow:"hidden",children:S.jsx("video",{src:Te,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})})]})]}),S.jsxs(Br,{children:[S.jsx(os,{fontSize:"xs",color:"white",children:"Upload New Video Background"}),S.jsx(Li,{type:"file",accept:"video/*",onChange:ea,ref:lt,display:"none"}),be&&S.jsxs($e,{mt:3,mb:3,children:[S.jsxs(qe,{fontSize:"xs",mb:1,children:["Uploading... ",je,"%"]}),S.jsx(Hy,{value:je,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),S.jsxs(Cn,{mt:3,spacing:3,children:[S.jsx($n,{colorScheme:"blue",leftIcon:S.jsx(Zt,{as:uZ}),onClick:Ed,isDisabled:be,size:"sm",variant:"outline",children:"Browse"}),S.jsx($n,{colorScheme:"green",leftIcon:S.jsx(Zt,{as:$O}),onClick:bh,isLoading:be,loadingText:"Uploading...",isDisabled:!we||be,size:"sm",children:"Upload"})]}),S.jsx(aS,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: MP4 format. Maximum file size: 5MB. Short looping videos work best."})]})]})]})]})]}),S.jsx(uc,{p:4,display:"flex",flexDirection:"column",children:S.jsxs(hr,{spacing:4,align:"stretch",children:[S.jsx($e,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsxs($e,{children:[S.jsxs(Cn,{mb:1,spacing:2,children:[S.jsxs($e,{position:"relative",w:"16px",h:"16px",children:[S.jsx(Zt,{as:TWe,color:on?"red.400":"green.400"}),on&&S.jsx($e,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),S.jsx(qe,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),S.jsx(qe,{fontSize:"xs",color:"whiteAlpha.800",children:on?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),S.jsx(sd,{isChecked:!on,onChange:kl,colorScheme:"green",size:"md",isDisabled:_t})]})}),S.jsx($e,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsxs($e,{children:[S.jsxs(Cn,{mb:1,spacing:2,children:[S.jsxs($e,{position:"relative",w:"16px",h:"16px",children:[S.jsx(Zt,{as:SWe,color:ve?"red.400":"green.400"}),ve&&S.jsx($e,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),S.jsx(qe,{fontSize:"sm",fontWeight:"600",children:"Text Chat"})]}),S.jsx(qe,{fontSize:"xs",color:"whiteAlpha.800",children:ve?"Text chat is currently disabled for all users in this space.":"Text chat is currently enabled for all users in this space."})]}),S.jsx(sd,{isChecked:!ve,onChange:Nl,colorScheme:"green",size:"md",isDisabled:_t})]})}),S.jsx($e,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsxs($e,{children:[S.jsxs(Cn,{mb:1,spacing:2,children:[S.jsx($e,{position:"relative",w:"16px",h:"16px",children:S.jsx(Zt,{as:pZ,color:Ke?"green.400":"red.400"})}),S.jsx(qe,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),S.jsx(qe,{fontSize:"xs",color:"whiteAlpha.800",children:Ke?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."})]}),S.jsx(sd,{isChecked:Ke,onChange:va,colorScheme:"green",size:"md",isDisabled:_t})]})}),S.jsxs($e,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsxs($e,{children:[S.jsxs(Cn,{mb:1,spacing:2,children:[S.jsx($e,{position:"relative",w:"16px",h:"16px",children:S.jsx(Zt,{as:tV,color:Et?"green.400":"red.400"})}),S.jsx(qe,{fontSize:"sm",fontWeight:"600",children:"Allow Guest Users"})]}),S.jsx(qe,{fontSize:"xs",color:"whiteAlpha.800",children:Et?"Unauthenticated users can enter as guests with usernames like 'Visitor_1234'.":"Only authenticated users can access this space."})]}),S.jsx(sd,{isChecked:Et,onChange:xl,colorScheme:"green",size:"md",isDisabled:_t})]}),Et&&S.jsx($e,{mt:3,pt:3,borderTop:"1px solid",borderColor:"whiteAlpha.200",children:S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsxs($e,{children:[S.jsxs(Cn,{mb:1,spacing:2,children:[S.jsx($e,{position:"relative",w:"14px",h:"14px",ml:1,children:S.jsx(Zt,{as:hZ,color:Ut?"orange.400":"gray.400",fontSize:"sm"})}),S.jsx(qe,{fontSize:"sm",fontWeight:"500",children:"Remove Sign In Button"})]}),S.jsx(qe,{fontSize:"xs",color:"whiteAlpha.700",ml:5,children:Ut?"Guest users won't see the sign-in button to upgrade their account.":"Guest users can see a sign-in button to upgrade to a full account."})]}),S.jsx(sd,{isChecked:Ut,onChange:wh,colorScheme:"orange",size:"sm",isDisabled:_t||!Et})]})})]})]})}),S.jsxs(uc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(qe,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Manage Users"}),S.jsx(qe,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),Gt?S.jsx(Mi,{justify:"center",align:"center",h:"200px",children:S.jsx(_d,{color:"blue.300"})}):S.jsxs(hr,{spacing:4,align:"stretch",children:[S.jsxs($e,{children:[S.jsxs(Cn,{mb:2,children:[S.jsx(Zt,{as:_We,color:"green.400"}),S.jsx(qe,{fontSize:"sm",fontWeight:"600",children:"Owners"}),S.jsx(Dc,{colorScheme:"green",ml:2,children:gt.length})]}),S.jsx($e,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:gt.length===0?S.jsx(qe,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):S.jsx(hr,{spacing:1,align:"stretch",children:gt.map(Je=>S.jsxs(Cn,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[S.jsx(cd,{size:"xs",src:Je.photoURL,name:Je.displayName}),S.jsxs($e,{children:[S.jsx(qe,{fontSize:"xs",children:Je.displayName}),S.jsx(qe,{fontSize:"xs",color:"whiteAlpha.600",children:Je.firstName&&Je.lastName?`${Je.firstName} ${Je.lastName}`:"Full name not available"})]}),S.jsx(MC,{}),S.jsx(Dc,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},Je.uid))})})]}),S.jsxs($e,{children:[S.jsxs(Cn,{mb:2,children:[S.jsx(Zt,{as:wWe,color:"purple.400"}),S.jsx(qe,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),S.jsx(Dc,{colorScheme:"purple",ml:2,children:Ct.length})]}),S.jsx($e,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:Ct.length===0?S.jsx(qe,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):S.jsx(hr,{spacing:1,align:"stretch",children:Ct.map(Je=>S.jsxs(Cn,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[S.jsx(cd,{size:"xs",src:Je.photoURL,name:Je.displayName}),S.jsxs($e,{children:[S.jsx(qe,{fontSize:"xs",children:Je.displayName}),S.jsx(qe,{fontSize:"xs",color:"whiteAlpha.600",children:Je.firstName&&Je.lastName?`${Je.firstName} ${Je.lastName}`:"Full name not available"})]}),S.jsx(MC,{}),S.jsx(Dc,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},Je.uid))})})]}),S.jsxs($e,{children:[S.jsxs(Cn,{mb:2,children:[S.jsx(Zt,{as:hZ,color:"red.400"}),S.jsx(qe,{fontSize:"sm",fontWeight:"600",children:"Banned Users"}),S.jsx(Dc,{colorScheme:"red",ml:2,children:st.length})]}),S.jsx($e,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:st.length===0?S.jsx(qe,{fontSize:"xs",color:"whiteAlpha.600",children:"No banned users"}):S.jsx(hr,{spacing:1,align:"stretch",children:st.map(Je=>S.jsxs(Cn,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[S.jsx(cd,{size:"xs",src:Je.photoURL,name:Je.displayName}),S.jsxs($e,{children:[S.jsx(qe,{fontSize:"xs",children:Je.displayName}),Je.firstName&&S.jsxs(qe,{fontSize:"xs",color:"whiteAlpha.600",children:[Je.firstName," ",Je.lastName]})]}),S.jsx(MC,{}),S.jsxs(Cn,{spacing:2,children:[S.jsx($n,{size:"xs",colorScheme:"green",isLoading:an===Je.uid,onClick:()=>Th(Je.uid),leftIcon:S.jsx(Zt,{as:tV}),children:"Unban"}),S.jsx(Dc,{colorScheme:"red",variant:"solid",fontSize:"2xs",children:"Banned"})]})]},Je.uid))})})]})]})]}),S.jsxs(uc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(qe,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Stream Settings"}),S.jsxs(hr,{spacing:4,align:"stretch",children:[S.jsx($e,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsx($e,{children:S.jsxs(Cn,{mb:1,spacing:2,children:[S.jsx($e,{position:"relative",w:"16px",h:"16px",children:S.jsx(Zt,{as:$C,color:Nt?"green.400":"red.400"})}),S.jsx(qe,{fontSize:"sm",fontWeight:"600",children:"Streaming Enabled"})]})}),S.jsx(sd,{isChecked:Nt,onChange:async()=>{const Je=!Nt;Ht(Je),Do(!0);try{H.log("SpaceManageModal: Auto-saving streaming enabled state:",Je);const qt={enabled:Je,streamUrl:Lr||"",rtmpUrl:ti||"",streamKey:us||"",playerIndex:"0",updatedAt:new Date().toISOString()};try{await R5(i,qt),H.log("SpaceManageModal: Successfully updated streaming enabled state in Firebase directly")}catch(Kn){throw H.error("SpaceManageModal: Error updating streaming state directly in Firebase:",Kn),Kn}await Fc(Lr,0,{enabled:Je,rtmpUrl:ti,streamKey:us}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:Je,spaceId:i}})),Kt({title:"Streaming "+(Je?"Enabled":"Disabled"),description:`Streaming is now ${Je?"enabled":"disabled"}.`,status:"success",duration:2e3,isClosable:!0})}catch(qt){H.error("Error auto-saving streaming state:",qt),Ht(!Je),Kt({title:"Error",description:"Failed to update streaming status",status:"error",duration:3e3,isClosable:!0})}finally{Do(!1),setTimeout(()=>{zc()},500)}},colorScheme:"green",size:"md",isDisabled:Wr})]})}),S.jsxs($e,{borderWidth:"1px",borderRadius:"md",p:4,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[S.jsx(qe,{fontSize:"sm",fontWeight:"600",mb:3,children:"Stream Configuration"}),S.jsxs(Br,{mb:4,children:[S.jsx(os,{fontSize:"xs",color:"white",children:"Stream URL"}),S.jsx(Li,{value:Lr,onChange:Je=>wi(Je.target.value),placeholder:"https://example.com/stream.m3u8",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Wr})]}),S.jsx(sR,{my:3,borderColor:"whiteAlpha.200"}),S.jsx(qe,{fontSize:"sm",fontWeight:"600",mb:3,children:"RTMP Configuration"}),S.jsxs(Br,{mb:3,children:[S.jsx(os,{fontSize:"xs",color:"white",children:"RTMP URL"}),S.jsx(Li,{value:ti,onChange:Je=>Vi(Je.target.value),placeholder:"rtmp://example.com/live",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Wr})]}),S.jsxs(Br,{mb:3,children:[S.jsx(os,{fontSize:"xs",color:"white",children:"Stream Key"}),S.jsx(Li,{value:us,onChange:Je=>_o(Je.target.value),placeholder:"xxxxxxxxxxxxxxxxxxxxxxxx",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Wr,type:"password"})]})]}),S.jsx($n,{colorScheme:"blue",size:"sm",onClick:Xr,isLoading:Wr,loadingText:"Saving...",alignSelf:"flex-start",mt:2,display:Nt?"inline-flex":"none",children:"Save Stream Settings"}),S.jsxs(Jy,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",mt:2,mb:8,children:[S.jsx(Qy,{color:"blue.300"}),S.jsxs($e,{children:[S.jsx(sk,{fontSize:"xs",fontWeight:"medium",children:"HLS Streaming"}),S.jsx(ok,{fontSize:"xs",children:"After saving, the stream will be available on all screens. Player index: 0"})]})]})]})]}),S.jsxs(uc,{p:4,display:"flex",flexDirection:"column",children:[S.jsx(qe,{fontSize:"sm",fontWeight:"600",mb:3,color:"white",children:"Override Settings"}),S.jsxs(hr,{spacing:4,align:"stretch",children:[S.jsx($e,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:S.jsxs(Cn,{justify:"space-between",align:"center",children:[S.jsx($e,{children:S.jsxs(Cn,{mb:1,spacing:2,children:[S.jsx($e,{position:"relative",w:"16px",h:"16px",children:S.jsx(Zt,{as:dZ,color:yo?"green.400":"red.400"})}),S.jsx(qe,{fontSize:"sm",fontWeight:"600",children:"Enable Override"})]})}),S.jsx(sd,{isChecked:yo,onChange:ra,colorScheme:"green",size:"md",isDisabled:Wa})]})}),S.jsxs($e,{borderWidth:"1px",borderRadius:"md",p:4,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[S.jsx(qe,{fontSize:"sm",fontWeight:"600",mb:3,children:"Add URL"}),S.jsxs(Cn,{spacing:3,children:[S.jsx(Br,{flex:"1",children:S.jsx(Li,{value:Eo,onChange:Je=>yu(Je.target.value),placeholder:"Enter URL",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",onKeyPress:Je=>{Je.key==="Enter"&&Mr()}})}),S.jsx($n,{colorScheme:"green",size:"sm",onClick:Mr,leftIcon:S.jsx(Zt,{as:tV}),flexShrink:0,children:"Add"})]})]}),S.jsxs($e,{borderWidth:"1px",borderRadius:"md",p:4,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[S.jsxs(Cn,{justify:"space-between",mb:3,children:[S.jsx(qe,{fontSize:"sm",fontWeight:"600",children:"URLs"}),S.jsx(Dc,{colorScheme:"blue",children:Zi.length})]}),Zi.length===0?S.jsx(qe,{fontSize:"xs",color:"whiteAlpha.600",children:"No URLs added yet."}):S.jsx(hr,{spacing:2,align:"stretch",maxH:"250px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"3px"}},children:Zi.map(Je=>S.jsx($e,{p:2,borderWidth:"1px",borderRadius:"md",borderColor:"whiteAlpha.200",bg:"whiteAlpha.50",_hover:{bg:"whiteAlpha.100"},children:S.jsxs(Cn,{justify:"space-between",align:"center",spacing:3,children:[S.jsx(qe,{fontSize:"sm",color:"white",flex:"1",isTruncated:!0,title:Je.url,children:Je.url}),S.jsx($n,{size:"xs",colorScheme:"red",variant:"ghost",onClick:()=>mc(Je.id),flexShrink:0,children:S.jsx(Zt,{as:Ly})})]})},Je.id))})]}),S.jsx($n,{colorScheme:"blue",size:"sm",onClick:vd,isLoading:Wa,loadingText:"Saving...",alignSelf:"flex-start",children:"Save Override Settings"})]})]})]})]})})]})]})},xWe=({onTogglePlayerList:n,spaceID:e,containerRef:i})=>{const{fullscreenRef:o}=vh(),[l,u]=k.useState(!0),[f,y]=k.useState(!1),[v,b]=k.useState(!1),[C,R]=k.useState(!1),[O,L]=k.useState(!1),[D,U]=k.useState(!1),[B,Y]=k.useState(null),[W,ne]=k.useState(!1),[le,re]=k.useState(!1),[me,q]=k.useState(!1),[J,Q]=k.useState(!1),ie=Ea(),{user:pe,currentUser:de,isGuestUser:he}=k.useContext(ls),Ie=pe!=null&&pe.Nickname?pe.Nickname:de&&he(de)?de.username||de.Nickname||"Guest User":"Unknown",[Fe,we]=k.useState(!1),Re=ft=>{if(!ft)return"G";if(ft.startsWith("Visitor_")){const lt=ft.split("_")[1];return`V${lt?lt.charAt(0):""}`}return ft.charAt(0).toUpperCase()},Te=async()=>{if(pe!=null&&pe.uid&&e)try{const ft=await Vc(pe.uid);let lt=!1,gt=!1;if(ft.groups){const Ct=`space_${e}_owners`,En=`space_${e}_hosts`;lt=ft.groups.includes(Ct),gt=ft.groups.includes(En)}const at=await GN(pe.uid,"disruptiveAdmin");if(Q(at),Y({rpmURL:ft.rpmURL?ft.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,isGuest:!1}),re(lt||at),q(gt),!lt&&!at&&W){ne(!1);const Ct=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(Ct),ie({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(ft){console.error("Error fetching profile data:",ft),re(!1),q(!1),Q(!1)}else if(de&&he(de)){if(Y({rpmURL:de.rpmURL?de.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,isGuest:!0}),re(!1),q(!1),Q(!1),W){ne(!1);const ft=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(ft)}}else Y(null),re(!1),q(!1),Q(!1)};k.useEffect(()=>{Te()},[pe==null?void 0:pe.uid,de==null?void 0:de.uid,de==null?void 0:de.rpmURL,e,W]),k.useEffect(()=>{const ft=()=>{u(!0)};return window.addEventListener("PlayerInstantiated",ft),()=>{window.removeEventListener("PlayerInstantiated",ft)}},[]),k.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&we(window.agoraClient.voiceDisabled)}catch(gt){console.error("Error checking if voice is disabled:",gt)}})();const lt=gt=>{gt.detail&&typeof gt.detail.voiceDisabled=="boolean"&&we(gt.detail.voiceDisabled)};return window.addEventListener("SpaceVoiceSettingChanged",lt),()=>{window.removeEventListener("SpaceVoiceSettingChanged",lt)}},[]);const Ne=()=>{b(!v),v||dt()},be=()=>R(!C),xe=()=>{U(!D),dt()},je=()=>{L(!1),Te()},nt=ft=>{ft.stopPropagation(),typeof n=="function"&&(H.log("CanvasMainMenu: Toggling player list"),n())},dt=()=>{y(!1)};return S.jsxs(S.Fragment,{children:[S.jsxs(XS,{isOpen:f,onClose:()=>y(!1),children:[S.jsx(JS,{as:ya,icon:S.jsx(Yze,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",_hover:{bg:f?"rgba(0,0,0,0.5)":"rgba(0,0,0,0.3)"},size:"md",onClick:()=>y(!f)}),S.jsx(Al,{containerRef:o,children:S.jsx(QS,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:3,borderRadius:"lg",zIndex:9999,transform:"none !important",children:S.jsxs(hr,{align:"stretch",spacing:3,children:[S.jsxs(Cn,{spacing:3,children:[S.jsx(cd,{size:"sm",src:B==null?void 0:B.rpmURL,bg:"white",name:B!=null&&B.isGuest?Re((de==null?void 0:de.username)||(de==null?void 0:de.Nickname)):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),S.jsxs(hr,{align:"start",spacing:0,children:[S.jsxs(Cn,{children:[S.jsx(qe,{fontWeight:"bold",fontSize:"sm",children:Ie}),le&&!J&&S.jsx(Ff,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:o},children:S.jsx($e,{display:"inline-block",children:S.jsx(Zt,{as:Uk,color:"green.400",boxSize:2.5})})}),!le&&me&&!J&&S.jsx(Ff,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:o},children:S.jsx($e,{display:"inline-block",children:S.jsx(Zt,{as:Vk,color:"purple.400",boxSize:2.5})})}),J&&S.jsx(Ff,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:o},children:S.jsx($e,{display:"inline-block",children:S.jsx(Zt,{as:y9e,color:"blue.400",boxSize:2.5})})})]}),S.jsx(qe,{fontSize:"xs",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),S.jsxs(Cn,{spacing:3,justify:"center",children:[S.jsx(ya,{icon:S.jsx(b9e,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:nt}),S.jsx(ya,{icon:S.jsx($e,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 2",_hover:{bg:"whiteAlpha.200"}}),S.jsx(ya,{icon:S.jsx($e,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),S.jsx(ya,{icon:S.jsx($e,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),S.jsx(sR,{borderColor:"whiteAlpha.300"}),S.jsxs(hr,{align:"stretch",spacing:1,children:[le&&S.jsx(qe,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:xe,children:"Manage Space"}),pe&&e&&!Fe&&S.jsx(pWe,{onClose:dt}),S.jsx(qe,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:Ne,children:"Settings"}),S.jsx(qe,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",onClick:()=>window.open("https://support.spacesmetaverse.com/","_blank"),children:"Support"}),S.jsx(qe,{fontSize:"sm",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:1.5,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),C&&S.jsx(fWe,{open:C,onClose:be}),v&&S.jsx(gWe,{open:v,onClose:Ne,containerRef:i}),O&&S.jsx(Pae,{open:O,onClose:je}),S.jsx(NWe,{isOpen:D,onClose:xe})]})},DWe=({isOpen:n,onClose:e,mediaScreenId:i,onImageChange:o})=>{const{spaceID:l}=xo(),u=za(),f=Ea(),y=k.useRef(null),v=k.useRef(null),b=k.useRef(),[C,R]=k.useState(null),[O,L]=k.useState(""),[D,U]=k.useState(!1),[B,Y]=k.useState(0),[W,ne]=k.useState(null),[le,re]=k.useState(!0),[me,q]=k.useState(!1),[J,Q]=k.useState(!1),[ie,pe]=k.useState(0),[de,he]=k.useState("image"),[Se,Ie]=k.useState(""),[Fe,we]=k.useState(!1);k.useEffect(()=>{(async()=>{if(n&&i&&l){re(!0);try{const Ct=await cE(l,i);if(Ct&&(Ct.imageUrl||Ct.videoUrl)){ne(Ct);const En=Ct.mediaType==="video";he(En?"video":"image"),we(Ct.displayAsVideo||!1),En&&Ct.videoUrl&&(Ie(Ct.videoUrl),pe(1))}else ne(null)}catch(Ct){H.error("Error fetching existing image:",Ct),ne(null)}finally{re(!1)}}})()},[n,i,l]),k.useEffect(()=>{n||(R(null),L(""),Y(0),Ie(""))},[n]);const Re=k.useCallback(at=>{at.preventDefault(),at.stopPropagation(),Q(!0)},[]),Te=k.useCallback(at=>{at.preventDefault(),at.stopPropagation(),Q(!1)},[]),Ne=k.useCallback(at=>{at.preventDefault(),at.stopPropagation()},[]),be=k.useCallback(at=>{if(at.preventDefault(),at.stopPropagation(),Q(!1),at.dataTransfer.files&&at.dataTransfer.files.length>0){const Ct=at.dataTransfer.files[0];xe(Ct)}},[]);k.useEffect(()=>{const at=v.current;if(at)return at.addEventListener("dragenter",Re),at.addEventListener("dragleave",Te),at.addEventListener("dragover",Ne),at.addEventListener("drop",be),()=>{at.removeEventListener("dragenter",Re),at.removeEventListener("dragleave",Te),at.removeEventListener("dragover",Ne),at.removeEventListener("drop",be)}},[Re,Te,Ne,be]);const xe=at=>{if(!at)return;if(!at.type.startsWith("image/")){f({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}R(at);const Ct=new FileReader;Ct.onloadend=()=>{L(Ct.result)},Ct.readAsDataURL(at)},je=at=>{const Ct=at.target.files[0];xe(Ct)},nt=async at=>{const Ct=at.target.checked;if(we(Ct),W)try{await P9e(l,i,Ct),Ct?u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:null,videoUrl:W.videoUrl||null,mediaType:W.mediaType||"image",displayAsVideo:!0}):u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:W.imageUrl||null,videoUrl:W.videoUrl||null,mediaType:W.mediaType||"image",displayAsVideo:!1}),ne({...W,displayAsVideo:Ct}),f({title:"Display mode updated",description:`The media screen will now be displayed as ${Ct?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),H.log(`Updated display mode for media screen ${i} to ${Ct?"video":"image"}`),o&&o({type:"update",mediaScreenId:i,displayAsVideo:Ct})}catch(En){H.error("Error updating display mode:",En),f({title:"Update failed",description:En.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),we(!Ct)}},dt=async()=>{if(de==="image"&&!C){f({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(de==="video"&&!Se){f({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{U(!0);const at=setInterval(()=>{Y(Xt=>{const st=Xt+10;return st>=90?90:st})},300);let Ct;de==="image"?Ct=await oZ(l,i,C,{mediaType:de,displayAsVideo:Fe}):(Ct=Se,await oZ(l,i,null,{mediaType:"video",directUrl:Se,displayAsVideo:Fe})),clearInterval(at),Y(100);let En=null,Gt=null;de==="image"?(En=Fe?null:Ct,Gt=(W==null?void 0:W.videoUrl)||null):(En=!Fe&&(W!=null&&W.imageUrl)?W.imageUrl:null,Gt=Ct),u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:En,videoUrl:Gt,mediaType:de,displayAsVideo:Fe}),H.log(`Uploaded and sent ${de} for media screen ${i} (display as video: ${Fe})`),o&&o({type:"upload",mediaScreenId:i,imageUrl:de==="image"?Ct:W==null?void 0:W.imageUrl,videoUrl:de==="video"?Ct:W==null?void 0:W.videoUrl,mediaType:de,displayAsVideo:Fe}),f({title:"Upload successful",description:`The ${de} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{R(null),L(""),U(!1),Y(0),e()},1e3)}catch(at){H.error(`Error uploading ${de}:`,at),f({title:"Upload failed",description:at.message||`An error occurred while uploading the ${de}`,status:"error",duration:5e3,isClosable:!0}),U(!1),Y(0)}},ft=async()=>{q(!1);try{U(!0),await A9e(l,i),u("SetMediaScreenImage",{mediaScreenId:i,imageUrl:de==="image"?null:(W==null?void 0:W.imageUrl)||null,videoUrl:de==="video"?null:(W==null?void 0:W.videoUrl)||null,mediaType:null,displayAsVideo:!1}),H.log(`Deleted ${de} for media screen ${i}`),o&&o({type:"delete",mediaScreenId:i}),f({title:`${de==="image"?"Image":"Video"} deleted`,description:`The ${de} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),ne(null),U(!1),Ie(""),we(!1),setTimeout(()=>{e()},500)}catch(at){H.error(`Error deleting ${de}:`,at),f({title:"Deletion failed",description:at.message||`An error occurred while deleting the ${de}`,status:"error",duration:5e3,isClosable:!0}),U(!1)}},lt=()=>{D||(R(null),L(""),Y(0),e())},gt=at=>{pe(at),he(at===0?"image":"video")};return S.jsxs(S.Fragment,{children:[S.jsxs(Is,{isOpen:n,onClose:lt,size:"lg",children:[S.jsx(Os,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(As,{bg:"#1a1a1a",color:"white",maxW:"650px",borderRadius:"xl",border:"1px solid #333",children:[S.jsx(Jo,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",children:"Media Screen"}),S.jsx($s,{isDisabled:D,color:"gray.400",_hover:{color:"white",bg:"rgba(255,255,255,0.1)"},borderRadius:"full",size:"sm",top:3,right:3}),S.jsxs($e,{px:4,pb:1,children:[S.jsxs(Mi,{justify:"space-between",align:"center",bg:"rgba(255,255,255,0.03)",p:2,borderRadius:"lg",mb:1,border:"1px solid rgba(255,255,255,0.08)",children:[S.jsxs(Cn,{spacing:2,children:[S.jsx(qe,{fontWeight:"500",fontSize:"xs",color:"gray.300",children:"Display:"}),S.jsxs(Cn,{spacing:2,children:[S.jsx(Zt,{as:Dy,color:Fe?"gray.500":"white",size:"sm"}),S.jsx(sd,{colorScheme:"gray",size:"sm",isChecked:Fe,onChange:nt}),S.jsx(Zt,{as:$C,color:Fe?"white":"gray.500",size:"sm"})]})]}),S.jsx(Dc,{bg:"rgba(255,255,255,0.1)",color:"gray.300",fontSize:"xs",px:2,py:1,borderRadius:"md",fontWeight:"500",children:Fe?"Video":"Image"})]}),S.jsxs(qe,{fontSize:"xs",color:"gray.500",children:["ID: ",i]})]}),S.jsx(Ps,{px:4,py:1,children:S.jsxs(Mi,{children:[S.jsx(xS,{orientation:"vertical",variant:"unstyled",index:ie,onChange:gt,h:"100%",minW:"75px",mr:3,children:S.jsxs(DS,{spacing:1,children:[S.jsxs(ga,{_selected:{color:"white",bg:"rgba(255,255,255,0.1)",borderRadius:"lg"},_hover:{bg:"rgba(255,255,255,0.05)"},mb:1,py:1.5,px:2.5,justifyContent:"flex-start",borderRadius:"lg",fontSize:"xs",fontWeight:"500",color:"gray.400",w:"full",children:[S.jsx(Zt,{as:Dy,mr:1.5,size:"sm"})," Image"]}),S.jsxs(ga,{_selected:{color:"white",bg:"rgba(255,255,255,0.1)",borderRadius:"lg"},_hover:{bg:"rgba(255,255,255,0.05)"},py:1.5,px:2.5,justifyContent:"flex-start",borderRadius:"lg",fontSize:"xs",fontWeight:"500",color:"gray.400",w:"full",children:[S.jsx(Zt,{as:$C,mr:1.5,size:"sm"})," Video"]})]})}),S.jsx($e,{flex:"1",children:le?S.jsx(Mi,{justify:"center",align:"center",h:"120px",children:S.jsx(_d,{size:"lg",color:"white"})}):S.jsxs(S.Fragment,{children:[S.jsx($e,{children:ie===0?S.jsxs(hr,{spacing:4,align:"stretch",children:[W&&W.imageUrl&&de==="image"&&S.jsxs($e,{children:[S.jsx(qe,{fontWeight:"semibold",mb:2,children:"Current Image:"}),S.jsxs(Mi,{children:[S.jsx($e,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:S.jsx(Cp,{src:W.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),S.jsxs(hr,{align:"flex-start",spacing:2,children:[S.jsxs(qe,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date(W.uploadedAt).toLocaleString()]}),S.jsxs(qe,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",W.displayAsVideo?"Video":"Image"]}),S.jsx($n,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:S.jsx(Zt,{as:Ly}),onClick:()=>q(!0),isDisabled:D,children:"Delete"})]})]}),S.jsx(sR,{my:4})]}),S.jsx(qe,{fontWeight:"semibold",mb:2,children:W&&W.imageUrl&&de==="image"?"Replace with new image:":"Upload new image:"}),S.jsxs($e,{ref:v,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:J?"rgba(255,255,255,0.3)":"rgba(255,255,255,0.15)",bg:J?"rgba(255,255,255,0.08)":"rgba(255,255,255,0.03)",p:4,textAlign:"center",transition:"all 0.2s ease",_hover:{borderColor:"rgba(255,255,255,0.3)",bg:"rgba(255,255,255,0.06)"},cursor:"pointer",onClick:()=>y.current.click(),children:[O?S.jsx($e,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:S.jsx(Cp,{src:O,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):S.jsxs(hr,{spacing:2,children:[S.jsx(Zt,{as:$O,boxSize:"20px",color:"gray.400"}),S.jsxs(hr,{spacing:0,children:[S.jsx(qe,{fontSize:"xs",fontWeight:"500",color:"white",children:"Drop image or click to browse"}),S.jsx(qe,{fontSize:"xs",color:"gray.500",children:"PNG, JPG, JPEG, GIF"})]})]}),S.jsx(Li,{type:"file",accept:"image/*",onChange:je,ref:y,display:"none"})]}),C&&S.jsxs(qe,{fontSize:"xs",color:"gray.400",bg:"rgba(255,255,255,0.05)",p:2,borderRadius:"md",border:"1px solid rgba(255,255,255,0.1)",children:[C.name," (",Math.round(C.size/1024)," KB)"]})]}):S.jsxs(hr,{spacing:4,align:"stretch",children:[W&&W.videoUrl&&de==="video"&&S.jsxs($e,{children:[S.jsx(qe,{fontWeight:"500",mb:1,fontSize:"xs",color:"gray.400",children:"Current Video URL:"}),S.jsxs(Mi,{children:[S.jsx($e,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:S.jsx(qe,{fontSize:"sm",wordBreak:"break-all",children:W.videoUrl})}),S.jsxs(hr,{align:"flex-start",spacing:2,children:[S.jsxs(qe,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date(W.uploadedAt).toLocaleString()]}),S.jsxs(qe,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",W.displayAsVideo?"Video":"Image"]}),S.jsx($n,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:S.jsx(Zt,{as:Ly}),onClick:()=>q(!0),isDisabled:D,children:"Delete"})]})]}),S.jsx(sR,{my:4})]}),S.jsxs(Br,{children:[S.jsx(os,{fontSize:"xs",fontWeight:"500",color:"white",mb:1.5,children:"Video URL"}),S.jsx(Li,{placeholder:"https://youtube.com/watch?v=...",value:Se,onChange:at=>Ie(at.target.value),bg:"rgba(255,255,255,0.05)",borderColor:"rgba(255,255,255,0.15)",_hover:{borderColor:"rgba(255,255,255,0.3)"},_focus:{borderColor:"rgba(255,255,255,0.5)",boxShadow:"0 0 0 1px rgba(255,255,255,0.3)"},size:"sm",borderRadius:"lg",color:"white",fontSize:"xs",_placeholder:{color:"gray.500",fontSize:"xs"}})]}),Se&&S.jsxs($e,{mt:2,p:2,bg:"rgba(255,255,255,0.05)",borderRadius:"lg",border:"1px solid rgba(255,255,255,0.1)",children:[S.jsxs(Cn,{mb:1,children:[S.jsx(Zt,{as:vWe,color:"gray.400",size:"sm"}),S.jsx(qe,{fontWeight:"500",fontSize:"xs",color:"white",children:"Preview"})]}),S.jsx(qe,{fontSize:"xs",wordBreak:"break-all",color:"gray.400",children:Se})]})]})}),D&&S.jsxs($e,{mt:3,children:[S.jsxs(qe,{mb:2,fontSize:"sm",fontWeight:"500",color:"white",children:["Uploading: ",B,"%"]}),S.jsx(Hy,{value:B,colorScheme:"gray",size:"sm",borderRadius:"full",bg:"rgba(255,255,255,0.1)"})]})]})})]})}),S.jsx(gh,{pt:2,pb:3,px:4,children:S.jsxs(Mi,{w:"full",gap:3,children:[S.jsx($n,{variant:"outline",flex:1,onClick:lt,isDisabled:D,color:"gray.400",borderColor:"rgba(255,255,255,0.2)",_hover:{bg:"rgba(255,255,255,0.05)",borderColor:"rgba(255,255,255,0.3)"},borderRadius:"lg",size:"sm",fontSize:"xs",fontWeight:"500",children:"Cancel"}),S.jsx($n,{bg:"#6b7280",color:"white",flex:2,onClick:dt,isLoading:D,loadingText:"Saving",isDisabled:de==="image"&&!C||de==="video"&&!Se||D||le,leftIcon:S.jsx(Zt,{as:de==="image"?Dy:$C,size:"sm"}),_hover:{bg:"#4b5563"},_active:{bg:"#374151"},_disabled:{bg:"#374151",opacity:.5},borderRadius:"lg",size:"sm",fontSize:"xs",fontWeight:"600",children:de==="image"?"Upload":"Save URL"})]})})]})]}),S.jsx(VMe,{isOpen:me,leastDestructiveRef:b,onClose:()=>q(!1),children:S.jsx(Os,{bg:"rgba(0, 0, 0, 0.8)",children:S.jsxs(jMe,{bg:"#1a1a1a",color:"white",borderRadius:"xl",border:"1px solid #333",maxW:"350px",children:[S.jsxs(Jo,{fontSize:"md",fontWeight:"600",pt:4,pb:2,color:"white",children:["Delete ",de==="video"?"Video":"Image"]}),S.jsx(Ps,{py:2,color:"gray.400",fontSize:"sm",children:"Are you sure? This will revert the media screen to its blank state."}),S.jsx(gh,{pt:3,pb:4,children:S.jsxs(Mi,{w:"full",gap:2,children:[S.jsx($n,{ref:b,onClick:()=>q(!1),variant:"outline",flex:1,color:"gray.400",borderColor:"rgba(255,255,255,0.2)",_hover:{bg:"rgba(255,255,255,0.05)"},borderRadius:"lg",size:"sm",fontSize:"sm",children:"Cancel"}),S.jsx($n,{bg:"#dc2626",color:"white",onClick:ft,flex:1,leftIcon:S.jsx(Zt,{as:Ly,size:"sm"}),_hover:{bg:"#b91c1c"},borderRadius:"lg",fontWeight:"600",size:"sm",fontSize:"sm",children:"Delete"})]})})]})})})]})},LWe=n=>{const[e,i]=k.useState(null),[o,l]=k.useState(""),[u,f]=k.useState(null),[y,v]=k.useState(!1),b=jc(),{spaceID:C}=xo(),R=k.useCallback(D=>{var U,B;try{if(!D)return null;if(D.includes("youtube.com")||D.includes("youtu.be")){let Y="";return D.includes("youtube.com/watch")?Y=new URLSearchParams(new URL(D).search).get("v"):D.includes("youtu.be/")&&(Y=D.split("youtu.be/")[1].split("?")[0]),Y?`https://www.youtube.com/embed/${Y}?autoplay=1`:D}if(D.includes("vimeo.com")){if(D.includes("player.vimeo.com/video"))return D;const Y=(B=(U=D.split("vimeo.com/")[1])==null?void 0:U.split("?")[0])==null?void 0:B.split("/")[0];return Y?`https://player.vimeo.com/video/${Y}?autoplay=1`:D}return D}catch(Y){return H.error("Error converting to embed URL:",Y),D}},[]),O=k.useCallback(()=>{setTimeout(()=>{v(!1),H.log("Video processing state reset")},100)},[]);k.useEffect(()=>{let D=!0,U=null;const Y=b("PlayMediaScreenVideo",async W=>{try{const{mediaScreenId:ne,videoUrl:le}=W||{};if(!ne){H.error("Media screen ID is missing in Unity event data."),O();return}if(n){H.log("Edit mode is active, setting media screen ID but not playing video"),f(ne);return}if(v(!0),U=setTimeout(()=>{D&&(H.warn("Video processing timeout reached, resetting state"),v(!1))},5e3),le){if(D)try{const re=R(le);i(re),l(`Media Screen ${ne}`),f(ne),H.log("Media screen video URL set directly from event:",re)}catch(re){H.error("Error setting video URL from direct URL:",re)}finally{O(),clearTimeout(U)}return}try{const re=await cE(C,ne);if(!re||!re.videoUrl){H.error("No video URL found for media screen:",ne),O(),clearTimeout(U);return}if(!re.displayAsVideo){H.log("Media screen is not set to display as video:",ne),O(),clearTimeout(U);return}if(D)try{const me=R(re.videoUrl),q=re.title||`Media Screen ${ne}`;i(me),l(q),f(ne),H.log("Media screen video URL set to:",me)}catch(me){H.error("Error setting video URL from Firestore:",me)}finally{O(),clearTimeout(U)}}catch(re){H.error(`Error fetching media screen data for ${ne}:`,re),O(),clearTimeout(U)}}catch(ne){H.error("Error handling media screen video play:",ne),console.error("Error handling media screen video play:",ne),O(),clearTimeout(U)}});return()=>{D=!1,U&&clearTimeout(U),Y()}},[b,C,n,R,O]);const L=k.useCallback(()=>{i(null),l(""),f(null),v(!1),H.log("Video player state reset")},[]);return[e,o,u,L,y]},MWe=()=>{const{spaceID:n}=xo(),e=za(),i=jc(),[o,l]=k.useState(!1);k.useEffect(()=>{if(window.isPlayerInstantiated){H.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const b=()=>{H.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",b),()=>{window.removeEventListener("PlayerInstantiated",b)}},[]);const u=k.useCallback(async b=>{try{return b.includes("vimeo.com")?await f(b):b.includes("youtube.com")||b.includes("youtu.be")?await y(b):"https://via.placeholder.com/640x360?text=Video"}catch(C){return H.error(`Error fetching thumbnail for ${b}:`,C),"https://via.placeholder.com/640x360?text=Error"}},[]),f=async b=>{try{const C=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(b)}`,R=await fetch(C);if(!R.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${R.statusText}`);const O=await R.json(),L=O.thumbnail_url.replace(/_\d+x\d+/,""),D=["640x360","295x166"];let U=null;for(let B of D){const Y=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${L}_${B}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(Y,{method:"HEAD"})).ok){U=Y;break}}catch(W){H.warn(`Failed to validate thumbnail URL: ${Y}`,W)}}return U||O.thumbnail_url}catch(C){return H.error(`Error fetching Vimeo thumbnail: ${C.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},y=async b=>{let C="";if(b.includes("youtube.com/watch")?C=new URLSearchParams(new URL(b).search).get("v"):b.includes("youtu.be/")&&(C=b.split("youtu.be/")[1].split("?")[0]),!C)throw new Error("Could not extract YouTube video ID");const R=`https://img.youtube.com/vi/${C}/maxresdefault.jpg`;try{if((await fetch(R,{method:"HEAD"})).ok)return R}catch(O){H.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${C}`,O)}return`https://img.youtube.com/vi/${C}/hqdefault.jpg`},v=k.useCallback(async b=>{try{if(!n||!b)return;H.log(`Refreshing thumbnail for media screen ${b}`);const C=await cE(n,b);if(!C){H.log(`No media screen found with ID ${b}`);return}if(H.log("Media screen data:",C),!C.displayAsVideo||!C.videoUrl){H.log(`Media screen ${b} is not set to display as video or has no video URL`);return}const R=await u(C.videoUrl);e("SetMediaScreenThumbnail",{mediaScreenId:b,thumbnailUrl:R}),H.log(`Sent refreshed thumbnail for media screen ${b}: ${R}`)}catch(C){H.error(`Error refreshing thumbnail for media screen ${b}:`,C)}},[n,u,e]);k.useEffect(()=>{if(!o){H.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}H.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const C=i("SetMediaScreenThumbnail",async R=>{try{const{mediaScreenId:O,thumbnailUrl:L}=R;L==="refresh"&&O&&await v(O)}catch(O){console.error("Error handling SetMediaScreenThumbnail event:",O)}});return()=>{C()}},[i,v,o]),k.useEffect(()=>{if(!o){H.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}H.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const b=async()=>{try{if(!n)throw new Error("spaceID is not defined.");H.log("Fetching media screens for thumbnails...");const R=await DF(n);H.log("All media screens:",R);const O=R.filter(U=>U.displayAsVideo&&U.videoUrl);if(H.log("Media screens set to display as videos:",O),O.length===0){H.log("No media screens set to display as videos found.");return}H.log(`Found ${O.length} media screens set to display as videos.`);const L=O.map(async U=>{try{const B=await u(U.videoUrl);return H.log(`Fetched thumbnail for ${U.id}: ${B}`),{mediaScreenId:U.id,thumbnailUrl:B}}catch(B){return H.error(`Error processing thumbnail for media screen ${U.id}:`,B),{mediaScreenId:U.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),D=await Promise.all(L);H.log("Fetched Media Screen Thumbnails",D),D.forEach(({mediaScreenId:U,thumbnailUrl:B})=>{e("SetMediaScreenThumbnail",{mediaScreenId:U,thumbnailUrl:B}),H.log(`Sent thumbnail to Unity for media screen ${U}: ${B}`)})}catch(R){H.error("Error fetching media screen thumbnails:",R)}};b();const C=setInterval(b,300*1e3);return()=>{clearInterval(C)}},[e,n,u,o])},fZ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},UWe=()=>S.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),VWe=({videoUrl:n,videoTitle:e,mediaScreenId:i,isOpen:o,onClose:l})=>{const{fullscreenRef:u}=vh();return YN(o,`video-modal-${i}`),k.useEffect(()=>{if(o){const f=b=>{b.target.classList&&b.target.classList.contains("chakra-modal__overlay")&&(b.stopPropagation(),b.preventDefault())};document.addEventListener("mousemove",f,!0),document.addEventListener("mousedown",f,!0),document.addEventListener("mouseup",f,!0),document.addEventListener("click",f,!0),document.addEventListener("wheel",f,!0);const y=document.getElementById("unity-canvas"),v=document.getElementById("unity-container");if(y&&(y.style.pointerEvents="none"),v&&(v.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(b){console.error("Error disabling Unity input:",b)}return()=>{if(document.removeEventListener("mousemove",f,!0),document.removeEventListener("mousedown",f,!0),document.removeEventListener("mouseup",f,!0),document.removeEventListener("click",f,!0),document.removeEventListener("wheel",f,!0),y&&(y.style.pointerEvents="auto"),v&&(v.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(b){console.error("Error re-enabling Unity input:",b)}}}},[o]),S.jsxs(S.Fragment,{children:[S.jsx(UWe,{}),S.jsxs(Is,{isOpen:o,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:u},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${i}`,children:[S.jsx(Os,{bg:"rgba(0, 0, 0, 0.8)",onClick:f=>{f.target===f.currentTarget&&(l(),f.stopPropagation(),f.preventDefault())},onMouseMove:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseDown:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseUp:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onWheel:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},style:{pointerEvents:"auto"}}),S.jsxs(As,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[S.jsx($s,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),S.jsx(Ps,{p:0,width:"100%",children:n?S.jsx($e,{className:"iframe-container",style:fZ.iframeContainer,children:S.jsx("iframe",{className:"video-iframe",src:n,style:fZ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:e||"Video Player"})}):S.jsxs(Mi,{direction:"column",align:"center",justify:"center",h:"400px",children:[S.jsx(_d,{size:"xl",mb:4}),S.jsx(qe,{children:"Unable to load video"}),S.jsx(qe,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},jWe=5e3,FWe=n=>{if(!(n!=null&&n.includes("firebasestorage.googleapis.com")))return n;try{const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),e.toString()}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},BWe=()=>{const{isOpen:n,onOpen:e,onClose:i}=pd(),[o,l]=k.useState(null),[u,f]=k.useState("image"),y=k.useRef(null);YN(n,"image-viewer-modal");const v=k.useCallback(R=>R.stopPropagation(),[]);return k.useEffect(()=>{if(!n||!y.current)return;const R=y.current,O=document.getElementById("unity-canvas"),L=["mousemove","mousedown","mouseup","wheel"];return L.forEach(D=>R.addEventListener(D,v)),O&&(O.style.pointerEvents="none"),()=>{L.forEach(D=>R.removeEventListener(D,v)),O&&(O.style.pointerEvents="auto")}},[n,v]),{isOpen:n,currentImageUrl:o,currentMediaType:u,openImageViewer:(R,O="image")=>{const L=typeof R=="string"&&(R.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||R.includes("firebasestorage")&&!R.includes("video"));l(R),f(L?"image":O),e()},closeImageViewer:()=>{i(),setTimeout(()=>{l(null),f("image")},300)},modalContentRef:y,preventPropagation:v}},zWe=()=>S.jsx("style",{dangerouslySetInnerHTML:{__html:`
      body.unity-input-disabled #unity-container,
      body.unity-input-disabled #unity-canvas { pointer-events: none !important; }
      .image-viewer-modal-content,
      .chakra-modal__overlay { pointer-events: auto !important; }
    `}}),WWe=()=>{const[n,e]=k.useState([]),[i,o]=k.useState(!1),[l,u]=k.useState(null),[f,y]=k.useState(!1),v=k.useCallback((C,R)=>{e(O=>Array.isArray(O)&&O.some(D=>D.mediaScreenId===C)?O.map(D=>D.mediaScreenId===C?{...D,...R,lastUpdated:new Date().toISOString()}:D):[...Array.isArray(O)?O:[],{mediaScreenId:C,...R,firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},[]),b=k.useCallback(C=>Array.isArray(n)?n.find(R=>R.mediaScreenId===C):null,[n]);return{mediaScreens:n,setMediaScreens:e,isEditMode:i,setIsEditMode:o,selectedScreen:l,setSelectedScreen:u,unityReady:f,setUnityReady:y,updateMediaScreen:v,getScreenData:b}},GWe=()=>{const{spaceID:n}=xo(),{isOpen:e,onOpen:i,onClose:o}=pd(),l=za(),{fullscreenRef:u}=vh(),f=jc(),{trackReactEvent:y}=_E(n),{setMediaScreens:v,isEditMode:b,setIsEditMode:C,selectedScreen:R,setSelectedScreen:O,unityReady:L,setUnityReady:D,updateMediaScreen:U,getScreenData:B}=WWe(),{isOpen:Y,currentImageUrl:W,currentMediaType:ne,openImageViewer:le,closeImageViewer:re,modalContentRef:me,preventPropagation:q}=BWe(),[J,Q,ie,pe]=LWe(b),{isOpen:de,onOpen:he,onClose:Se}=pd();MWe(),bae(),k.useEffect(()=>{if(window.isPlayerInstantiated){D(!0);return}const Te=()=>D(!0);return window.addEventListener("PlayerInstantiated",Te),()=>window.removeEventListener("PlayerInstantiated",Te)},[D]);const Ie=k.useCallback(async Te=>{const Ne=B(Te);if(Ne)return{screen:Ne,imageUrl:Ne.imageUrl,videoUrl:Ne.videoUrl,mediaType:Ne.mediaType||"image",displayAsVideo:Ne.displayAsVideo||!1};if(W)return{screen:{mediaScreenId:Te},imageUrl:W,videoUrl:null,mediaType:"image",displayAsVideo:!1};if(n&&Te)try{const be=await cE(n,Te);if(be)return U(Te,{...be,hasImage:!!be.imageUrl,source:"firestore-fetch"}),{screen:be,imageUrl:be.imageUrl,videoUrl:be.videoUrl,mediaType:be.mediaType||"image",displayAsVideo:be.displayAsVideo||!1}}catch(be){console.error(`Error fetching media screen data for ${Te}:`,be)}return null},[B,W,n,U]),Fe=k.useCallback(async Te=>{if(O(Te),b){i();return}if(de&&ie===Te)return;const Ne=await Ie(Te);if(Ne){if(Ne.displayAsVideo&&Ne.videoUrl)l("PlayMediaScreenVideo",{mediaScreenId:Te,videoUrl:Ne.videoUrl});else if(Ne.imageUrl){const be=FWe(Ne.imageUrl);le(be,Ne.mediaType||"image")}}},[b,i,de,ie,Ie,l,le]);k.useEffect(()=>{if(!L||!n)return;const Te=async()=>{try{const Ne=await DF(n),be={};Ne.forEach(xe=>{xe.id&&xe.imageUrl&&(be[xe.id]=xe.imageUrl)}),v(xe=>xe.map(je=>({...je,hasImage:!!be[je.mediaScreenId],imageUrl:be[je.mediaScreenId],mediaType:je.mediaType||"image"})))}catch(Ne){console.error("Error fetching media screen images:",Ne)}};if(Te(),b){const Ne=setInterval(Te,jWe);return()=>clearInterval(Ne)}},[n,b,L,v]);const we=k.useCallback(Te=>{const{mediaScreenId:Ne,type:be,imageUrl:xe,mediaType:je}=Te;be==="upload"?U(Ne,{hasImage:!0,imageUrl:xe,mediaType:je||"image"}):be==="delete"&&setTimeout(()=>{v(nt=>nt.filter(dt=>dt.mediaScreenId!==Ne))},100)},[U,v]);k.useEffect(()=>{const Te=Ne=>{const be=Ne.detail.enabled;C(be),l("SetMediaScreenEditMode",{enabled:be,showUploadIcon:be})};return window.addEventListener("editModeChanged",Te),()=>window.removeEventListener("editModeChanged",Te)},[l,C]),k.useEffect(()=>(window.JsSendMediaScreenClick=Te=>{try{const Ne=JSON.parse(Te);window.dispatchEvent(new CustomEvent("MediaScreenClick",{detail:JSON.stringify(Ne)}))}catch(Ne){console.error("Error processing MediaScreenClick data:",Ne)}},window.handleMediaScreenClick=Te=>{Fe(Te)},window.TestJavaScriptFromUnity=Te=>{},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[Fe]),k.useEffect(()=>{const Te=je=>{try{const nt=JSON.parse(je.detail);U(nt.mediaScreenId,{...nt,source:"event"}),b&&l("SetMediaScreenEditMode",{mediaScreenId:nt.mediaScreenId,enabled:!0,showUploadIcon:!0}),n&&nt.mediaScreenId&&cE(n,nt.mediaScreenId).then(dt=>{dt!=null&&dt.displayAsVideo&&(dt!=null&&dt.videoUrl)&&l("SetMediaScreenImage",{mediaScreenId:nt.mediaScreenId,imageUrl:null,displayAsVideo:!0})}).catch(dt=>console.error("Error fetching media screen data:",dt))}catch(nt){console.error("Error handling MediaScreen registration:",nt)}},Ne=je=>{try{let nt;typeof je=="string"?nt=je:nt=JSON.parse(je.detail).mediaScreenId,Fe(nt)}catch(nt){console.error("Error handling MediaScreen click:",nt)}},xe=[["RegisterMediaScreen",Te],["MediaScreenClick",Ne],["reactUnityEvent",je=>{const{eventName:nt,eventData:dt}=je.detail||{};switch(nt){case"RegisterMediaScreen":Te({detail:dt});break;case"MediaScreenClick":Ne({detail:dt});break;case"SetMediaScreenImage":try{const ft=JSON.parse(dt);ft.mediaScreenId&&U(ft.mediaScreenId,{imageUrl:ft.imageUrl,hasImage:!!ft.imageUrl,displayAsVideo:ft.displayAsVideo||!1,source:"set-media-screen-image"})}catch(ft){console.error("Error handling SetMediaScreenImage event:",ft)}break}}]];return xe.forEach(([je,nt])=>window.addEventListener(je,nt)),()=>{xe.forEach(([je,nt])=>window.removeEventListener(je,nt))}},[b,l,n,U,Fe]),k.useEffect(()=>{J&&(he(),y(ho.REACT.VIDEO_CLICK,{mediaScreenId:ie,videoUrl:J,videoTitle:Q,source:"media_screen_controller",trigger:"video_modal_open"}))},[J,he,y,ie,Q]);const Re=k.useCallback(()=>{pe(),Se()},[pe,Se]);return k.useEffect(()=>{const Ne=f("RegisterMediaScreen",xe=>{xe!=null&&xe.mediaScreenId&&(U(xe.mediaScreenId,{...xe,source:"direct-event"}),b&&l("SetMediaScreenEditMode",{mediaScreenId:xe.mediaScreenId,enabled:!0,showUploadIcon:!0}))}),be=f("MediaScreenClick",xe=>{xe!=null&&xe.mediaScreenId&&Fe(xe.mediaScreenId)});return()=>{Ne(),be()}},[f,b,l,U,Fe]),k.useEffect(()=>{b&&ie&&(O(ie),i(),pe())},[b,ie,i,pe,O]),S.jsxs(S.Fragment,{children:[S.jsx(DWe,{isOpen:e,onClose:o,mediaScreenId:R,onImageChange:we}),S.jsx(zWe,{}),S.jsx(Al,{containerRef:u,children:S.jsxs(Is,{isOpen:Y,onClose:re,size:"lg",isCentered:!0,portalProps:{containerRef:u},id:"image-viewer-modal",blockScrollOnMount:!0,children:[S.jsx(Os,{bg:"rgba(0, 0, 0, 0.8)",onClick:q,onMouseMove:q,onMouseDown:q,onMouseUp:q,onWheel:q}),S.jsxs(As,{ref:me,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:q,onMouseMove:q,onMouseDown:q,onMouseUp:q,onWheel:q,children:[S.jsx($s,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),S.jsx(Ps,{p:0,width:"100%",onClick:q,onMouseMove:q,onMouseDown:q,onMouseUp:q,onWheel:q,children:W?S.jsx($e,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:q,onMouseMove:q,onMouseDown:q,onMouseUp:q,onWheel:q,children:ne==="image"?S.jsx(Cp,{src:W,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onError:Te=>console.error("Error loading image:",Te,W),onClick:q}):S.jsxs($e,{width:"100%",textAlign:"center",onClick:q,onMouseMove:q,onMouseDown:q,onMouseUp:q,onWheel:q,children:[S.jsx(qe,{mb:4,fontSize:"lg",children:"Video URL:"}),S.jsx(qe,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:W}),S.jsx(qe,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):S.jsx(Mi,{direction:"column",align:"center",justify:"center",h:"400px",onClick:q,onMouseMove:q,onMouseDown:q,onMouseUp:q,onWheel:q,children:S.jsx(qe,{children:"No image available"})})})]})]})}),S.jsx(VWe,{videoUrl:J,videoTitle:Q,mediaScreenId:ie,isOpen:de,onClose:Re})]})},Mae=({backgroundUrl:n=null,videoBackgroundUrl:e=null,containerRef:i})=>{const[o,l]=k.useState(!1),[u,f]=k.useState(n),[y,v]=k.useState(e),b=k.useRef(null),C=k.useRef(null),R=k.useRef(null),O=k.useRef(!1),L=k.useRef(!1);k.useEffect(()=>{if(!(O.current||L.current)){if(L.current=!0,e){U(e),O.current=!0;return}if(n){B(n),O.current=!0;return}D()}},[n,e]),k.useEffect(()=>{const ne=le=>{const{videoBackgroundUrl:re}=le.detail;re&&!O.current&&(U(re),O.current=!0)};return window.addEventListener("SpaceVideoBackgroundUpdated",ne),()=>{window.removeEventListener("SpaceVideoBackgroundUpdated",ne)}},[]);const D=()=>{const le=window.location.pathname.match(/\/space\/([^\/]+)/);if(!le||!le[1])return;const re=le[1];mo(re).then(me=>{if(me&&me.videoBackgroundUrl)U(me.videoBackgroundUrl),O.current=!0;else if(me&&(me.backgroundUrl||me.backgroundGsUrl)){const q=me.backgroundUrl||me.backgroundGsUrl;B(q),O.current=!0}}).catch(me=>{H.error("PersistentBackground: Error fetching space data:",me)})},U=ne=>{if(!i||!i.current)return;W();const le=document.createElement("video");R.current=le,le.autoplay=!0,le.loop=!0,le.muted=!0,le.playsInline=!0,le.setAttribute("playsinline",""),le.setAttribute("webkit-playsinline",""),le.setAttribute("preload","auto"),le.src=ne,Object.assign(le.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",objectFit:"cover",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",opacity:"1"}),i.current.appendChild(le),Y(),le.load();try{le.play().catch(re=>{const me=()=>{le.play().catch(()=>{})};window.addEventListener("click",me,{once:!0}),window.addEventListener("touchstart",me,{once:!0}),setTimeout(()=>{le.play().catch(()=>{})},1e3)})}catch{}},B=ne=>{if(!i||!i.current||!ne)return;const le=document.createElement("div");b.current=le,Object.assign(le.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:`url('${ne}')`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"19",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",opacity:"1"}),i.current.appendChild(le),Y()},Y=()=>{if(!i||!i.current)return;const ne=document.createElement("div");C.current=ne,Object.assign(ne.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",WebkitBackdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(ne)},W=()=>{!i||!i.current||(b.current&&i.current.contains(b.current)&&(i.current.removeChild(b.current),b.current=null),R.current&&i.current.contains(R.current)&&(R.current.pause(),R.current.src="",R.current.load(),i.current.removeChild(R.current),R.current=null),C.current&&i.current.contains(C.current)&&(i.current.removeChild(C.current),C.current=null))};return k.useEffect(()=>{if(!i||!i.current)return;const ne=()=>{l(!0),b.current&&(b.current.style.opacity="0"),R.current&&(R.current.style.opacity="0"),C.current&&(C.current.style.opacity="0"),setTimeout(()=>{W()},1500)};if(window.isPlayerInstantiated){ne();return}mh.subscribe(fh.playerInstantiated,ne),window.addEventListener("PlayerInstantiated",ne);const le=setTimeout(()=>{ne()},3e4);return()=>{mh.unsubscribe(fh.playerInstantiated,ne),window.removeEventListener("PlayerInstantiated",ne),clearTimeout(le),W()}},[i]),null};Mae.propTypes={backgroundUrl:Nn.string,videoBackgroundUrl:Nn.string,containerRef:Nn.shape({current:Nn.instanceOf(Element)})};const mZ="https://www.spacesmetaverse.com/assets/images/SpacesLogo_Loader.png",Uae=({containerRef:n})=>{const{spaceID:e}=xo(),{isUserBannedFromSpace:i}=k.useContext(ls),[o,l]=k.useState(!1),[u,f]=k.useState(!1),[y,v]=k.useState(!1),[b,C]=k.useState(0),[R,O]=k.useState("Initialising World"),[L,D]=k.useState(null),U=k.useRef(null),B=k.useRef(null),Y=k.useRef(null),W=k.useRef(null),ne=k.useRef(null),le=k.useRef(null);k.useEffect(()=>()=>{},[]);const{error:re}=xo(),[me,q]=k.useState(!1);return k.useEffect(()=>{re&&(H.error("PersistentLoader: Unity error detected:",re),q(!0),setTimeout(()=>{if(U.current){const J=U.current.querySelector("div:first-child");J&&(J.textContent="Reconnecting...")}},3e3))},[re]),k.useEffect(()=>{(async()=>{if(e)try{const Q=await mo(e);Q&&Q.logoUrl&&D(Q.logoUrl)}catch(Q){H.error("PersistentLoader: Error fetching space logo:",Q)}})()},[e]),k.useEffect(()=>{const J=Q=>{const{logoUrl:ie}=Q.detail;D(ie),B.current&&(ie?(B.current.src=ie,Y.current.style.display="flex"):Y.current.style.display="none")};return window.addEventListener("SpaceLogoUpdated",J),()=>{window.removeEventListener("SpaceLogoUpdated",J)}},[]),k.useEffect(()=>{(async()=>{if(e&&i)try{await i(e)&&(H.warn(`PersistentLoader: user banned from space ${e}`),l(!0))}catch(Q){H.error("PersistentLoader: error checking ban status",Q)}})()},[e,i]),k.useEffect(()=>{if(!n||!n.current){H.error("PersistentLoader: Container ref missing");return}if(o){const Ne=document.createElement("div");return Object.assign(Ne.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"red",background:"rgba(0,0,0,0.7)",padding:"20px",borderRadius:"8px",zIndex:"100",fontSize:"18px",fontWeight:"bold",textAlign:"center"}),Ne.textContent="Access Denied: You have been banned from this space.",n.current.appendChild(Ne),()=>{n.current.removeChild(Ne)}}const J=document.createElement("div");if(U.current=J,Object.assign(J.style,{position:"absolute",top:"60%",left:"50%",transform:"translate(-50%, -50%)",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.3s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.4)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",borderRadius:"12px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.3), inset 0 0 1px rgba(255, 255, 255, 0.3)",border:"1px solid rgba(255, 255, 255, 0.1)",opacity:"1"}),L){const Ne=document.createElement("div");Y.current=Ne,Object.assign(Ne.style,{position:"absolute",top:"37.5%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.3s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px",opacity:"1"});const be=document.createElement("img");B.current=be,be.src=L,be.alt="Space Logo",be.style.maxHeight="100px",be.style.maxWidth="100%",be.style.objectFit="contain",be.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",Ne.appendChild(be),n.current.appendChild(Ne)}const Q=document.createElement("style");Q.textContent=`
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(Q);const ie=document.createElement("div");ie.style.fontSize="16px",ie.style.fontWeight="bold",ie.style.textAlign="center",ie.style.marginBottom="16px",ie.style.color="#ffffff",ie.textContent="Initialising World";const pe=document.createElement("div");pe.style.width="240px",pe.style.height="100px",pe.style.position="relative",pe.style.marginBottom="15px",pe.style.padding="0px",pe.style.overflow="hidden",pe.style.boxSizing="border-box",pe.style.transition="opacity 0.3s ease-in-out",pe.style.opacity="1";const de=document.createElement("div");de.style.width="100%",de.style.height="100%",de.style.position="absolute",de.style.top="0",de.style.left="0",de.style.maskImage=`url(${mZ})`,de.style.maskSize="contain",de.style.maskPosition="center",de.style.maskRepeat="no-repeat",de.style.webkitMaskImage=`url(${mZ})`,de.style.webkitMaskSize="contain",de.style.webkitMaskPosition="center",de.style.webkitMaskRepeat="no-repeat",de.style.background="linear-gradient(to right, #4facfe 0%, #00f2fe 15%, white 15%, white 100%)",de.style.backgroundSize="100% 100%",de.style.transition="background 0.5s ease-out",W.current=de,ne.current=null,pe.appendChild(de);const he=document.createElement("div");he.style.marginTop="8px",he.style.fontSize="14px",he.style.fontWeight="bold",he.style.color="#ffffff",he.textContent="0%",J.appendChild(ie),J.appendChild(pe),J.appendChild(he),n.current.appendChild(J);const Se=Ne=>{C(Ne);const be=Math.round(Ne*100),xe=`linear-gradient(to right, #4facfe 0%, #00f2fe ${be}%, white ${be}%, white 100%)`;de.style.background=xe,he.textContent=`${be}%`},Ie=Ne=>{O(Ne),ie.textContent=Ne},Fe=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];me&&(Fe[0].stage="Connecting to Space",Fe[1].stage="Reconnecting...",Fe[2].stage="Please Wait"),Ie(Fe[0].stage),Se(.25);const we=Ne=>{const be=Ne.detail.progress;Se(be),be<.33?Ie(Fe[0].stage):be<.66?Ie(Fe[1].stage):Ie(Fe[2].stage)},Re=()=>{f(!0),Ie(Fe[1].stage),Se(.66)},Te=()=>{le.current&&clearInterval(le.current),v(!0),Ie(Fe[2].stage),Se(1),!me&&(J.style.transition="all 0.5s ease-in-out",pe.style.transition="opacity 1.2s ease-in-out",ie.style.transition="opacity 0.4s ease-in-out",he.style.transition="opacity 0.4s ease-in-out",Y.current&&(Y.current.style.transition="opacity 0.5s ease-in-out"),J.style.backgroundColor="rgba(0, 0, 0, 0)",J.style.backdropFilter="blur(0px)",J.style.WebkitBackdropFilter="blur(0px)",J.style.boxShadow="0 0 0 rgba(0, 0, 0, 0)",J.style.border="1px solid rgba(255, 255, 255, 0)",ie.style.opacity="0",he.style.opacity="0",Y.current&&(Y.current.style.opacity="0"),setTimeout(()=>{pe.style.opacity="0",setTimeout(()=>{n.current&&n.current.contains(J)&&n.current.removeChild(J),Y.current&&n.current&&n.current.contains(Y.current)&&n.current.removeChild(Y.current)},1300)},400))};if(window.isPlayerInstantiated)Te();else{mh.subscribe(fh.playerInstantiated,Te);const Ne=()=>Te();window.addEventListener("PlayerInstantiated",Ne),mh.subscribe(fh.firstSceneLoaded,Re),window.addEventListener("UnityProgress",we),le.current=setInterval(()=>{y||C(xe=>{const je=Math.min(xe+.02,.95);return Se(je),je<.33&&R!==Fe[0].stage?Ie(Fe[0].stage):je>=.33&&je<.66&&R!==Fe[1].stage?Ie(Fe[1].stage):je>=.66&&R!==Fe[2].stage&&Ie(Fe[2].stage),je})},300);const be=setTimeout(()=>{Te()},6e4);return()=>{mh.unsubscribe(fh.playerInstantiated,Te),window.removeEventListener("PlayerInstantiated",Ne),mh.unsubscribe(fh.firstSceneLoaded,Re),window.removeEventListener("UnityProgress",we),clearInterval(le.current),clearTimeout(be),n.current&&n.current.contains(J)&&n.current.removeChild(J),Y.current&&n.current&&n.current.contains(Y.current)&&n.current.removeChild(Y.current)}}},[L,n]),null};Uae.propTypes={containerRef:Nn.shape({current:Nn.instanceOf(Element)})};const GS=()=>window.unityInstance||window.gameInstance||window.reactUnityInstance,LF=()=>{document.body.classList.add("unity-focused");const n=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","PageUp","PageDown","Home","End"],e=o=>{if(n.includes(o.key)){const l=o.target.tagName==="INPUT"||o.target.tagName==="TEXTAREA"||o.target.isContentEditable,u=document.querySelector("canvas")||document.getElementById("unity-canvas"),f=o.target.closest("canvas")||o.target.closest("#webgl-root"),y=document.activeElement===u;!l&&(f||y)&&o.preventDefault()}},i=o=>{document.querySelector("canvas")||document.getElementById("unity-canvas"),document.getElementById("unity-container")||document.getElementById("webgl-root"),o.target.closest("canvas")||o.target.closest("#webgl-root")?document.body.classList.add("unity-focused"):document.body.classList.remove("unity-focused")};return document.addEventListener("keydown",e),document.addEventListener("click",i),()=>{document.body.classList.remove("unity-focused"),document.removeEventListener("keydown",e),document.removeEventListener("click",i)}},Vae=()=>{document.body.classList.remove("unity-focused")};function jk(n){return n?(document.body.classList.add("unity-focused"),window.unityKeyboardEnabled=!0):(document.body.classList.remove("unity-focused"),window.unityKeyboardEnabled=!1),n?LF():Vae(),new Promise(e=>{try{const i=GS();if(i){try{n?i.SendMessage("WebGLInput","EnableKeyboardCapture"):i.SendMessage("WebGLInput","DisableKeyboardCapture"),e(!0);return}catch{}try{i.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),e(!0);return}catch{}if(i.Module){!n&&i.Module.WebGLInputHandler&&!window._originalWebGLInputHandler&&(window._originalWebGLInputHandler=i.Module.WebGLInputHandler),n&&window._originalWebGLInputHandler?(i.Module.WebGLInputHandler=window._originalWebGLInputHandler,window._originalWebGLInputHandler=null):n||(i.Module.WebGLInputHandler=null),e(!0);return}}else window.__pendingKeyboardCaptureState=n,document.getElementById("webgl-root")&&L5(n),e(!0)}catch(i){console.error("Error setting Unity keyboard capture:",i),e(!1)}})}function L5(n){window.__unityInstancePoller&&clearTimeout(window.__unityInstancePoller);const e=20;let i=0;const o=()=>{i++;const l=GS();if(l)try{n?l.SendMessage("WebGLInput","EnableKeyboardCapture"):l.SendMessage("WebGLInput","DisableKeyboardCapture"),window.__pendingKeyboardCaptureState=null}catch{try{l.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),window.__pendingKeyboardCaptureState=null}catch(f){console.error("Unity keyboard: Failed to apply keyboard state",f)}}else if(i<e){const u=Math.min(500*Math.pow(1.2,i),5e3);window.__unityInstancePoller=setTimeout(o,u)}else window.__pendingKeyboardCaptureState=null};window.__unityInstancePoller=setTimeout(o,500)}function HWe(){const n=GS();if(!n)return!1;const e=document.querySelector("canvas")||document.getElementById("unity-canvas");return!!(e&&document.activeElement===e||n.Module&&n.Module.WebGLInputHandler)}function Z0(n=!0){return n?LF():Vae(),new Promise(e=>{try{const i=document.querySelector("canvas")||document.getElementById("unity-canvas");if(i){try{i.focus({preventScroll:!0})}catch{i.focus()}if(i.style.pointerEvents="auto",n){jk(!0).then(e);return}e(!0)}else e(!1)}catch(i){console.error("Error focusing Unity canvas:",i),e(!1)}})}function My(n=!0){return LF(),new Promise(e=>{try{if(n)jk(!1).then(i=>{var u;const o=document.querySelector("canvas")||document.getElementById("unity-canvas");o&&(o.blur(),o.style.pointerEvents="none"),window.__keyEventHandler||(window.__keyEventHandler=f=>{window.__blockKeyboardInput&&!["INPUT","TEXTAREA","SELECT"].includes(f.target.tagName)&&f.stopPropagation()},document.addEventListener("keydown",window.__keyEventHandler,!0),document.addEventListener("keyup",window.__keyEventHandler,!0),document.addEventListener("keypress",window.__keyEventHandler,!0)),window.__blockKeyboardInput=!0;const l=GS();(u=l==null?void 0:l.Module)!=null&&u.WebGLInputHandler&&(window._savedWebGLInputHandler=l.Module.WebGLInputHandler,l.Module.WebGLInputHandler=null),e(!0)});else{window.__blockKeyboardInput=!1,window.__keyEventHandler&&(document.removeEventListener("keydown",window.__keyEventHandler,!0),document.removeEventListener("keyup",window.__keyEventHandler,!0),document.removeEventListener("keypress",window.__keyEventHandler,!0),window.__keyEventHandler=null);const i=GS();i!=null&&i.Module&&window._savedWebGLInputHandler&&(i.Module.WebGLInputHandler=window._savedWebGLInputHandler,window._savedWebGLInputHandler=null);const o=document.querySelector("canvas")||document.getElementById("unity-canvas");o&&(o.style.pointerEvents="auto"),jk(!0).then(()=>{e(!0)})}}catch(i){console.error("Error in blockUnityKeyboardInput:",i),e(!1)}})}function $We(n){if(n){if(window.unityInstance=n,typeof window.__pendingKeyboardCaptureState=="boolean")try{const e=window.__pendingKeyboardCaptureState;try{e?n.SendMessage("WebGLInput","EnableKeyboardCapture"):n.SendMessage("WebGLInput","DisableKeyboardCapture"),window.__pendingKeyboardCaptureState=null}catch{try{n.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",e),window.__pendingKeyboardCaptureState=null}catch(o){console.error("Unity keyboard: Failed to apply keyboard state",o)}}}catch(e){console.error("Unity keyboard: Error applying keyboard state:",e)}window.__unityInstancePoller&&(clearTimeout(window.__unityInstancePoller),window.__unityInstancePoller=null)}}function KWe(){if(window.setUnityKeyboardCapture=jk,window.focusUnity=Z0,window.blockUnityKeyboardInput=My,window.hasUnityKeyboardFocus=HWe,window.getUnityInstance=GS,window.registerUnityInstance=$We,document.getElementById("webgl-root")){const n=new MutationObserver(e=>{for(const i of e)if(i.addedNodes.length)for(let o=0;o<i.addedNodes.length;o++){const l=i.addedNodes[o];if(l.nodeName==="CANVAS"||l.querySelector&&l.querySelector("canvas")){L5(!0),n.disconnect();break}}});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("canvas")&&L5(!0)}if(typeof window<"u"&&typeof require=="function")try{const n=require("react");window.useUnityKeyboardFocus=function(){const[i,o]=n.useState(!1);return n.useEffect(()=>(i?(My(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(My(!1),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{i&&(My(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[i]),[i,o]}}catch{}}typeof window<"u"&&setTimeout(KWe,0);const qWe=({size:n="md",tooltipPlacement:e="top",className:i="livestream-button"})=>{const[o,l]=k.useState(!1),[u,f]=k.useState(!1),{savedStreamData:y,reloadStreamData:v}=Sae(),{spaceID:b}=xo(),{user:C}=k.useContext(ls),R=Ea(),[O,L]=k.useState(!1),D=iq((y==null?void 0:y.rtmpUrl)||""),U=iq((y==null?void 0:y.streamKey)||"");k.useEffect(()=>{if(b){H.log("LiveStreamButton: Forcing reload of stream data"),v();const W=()=>{H.log("LiveStreamButton: Stream settings changed, reloading data"),v()};return window.addEventListener("StreamSettingsChanged",W),()=>{window.removeEventListener("StreamSettingsChanged",W)}}},[b,v]),k.useEffect(()=>{(async()=>{if(!(C!=null&&C.uid)||!b){L(!1);return}try{const ne=await CBe(C.uid,"disruptiveAdmin"),le=await IBe(C,b);L(ne||le)}catch(ne){H.error("Error checking user permissions:",ne),L(!1)}})()},[C==null?void 0:C.uid,b]),k.useEffect(()=>{H.log("LiveStreamButton: Current streaming data:",{enabled:y==null?void 0:y.enabled,hasRtmpUrl:!!(y!=null&&y.rtmpUrl),hasStreamKey:!!(y!=null&&y.streamKey),hasPermission:O,isPlayerReady:u})},[y,O,u]),k.useEffect(()=>{const W=()=>{H.log("LiveStreamButton: Player instantiated, showing button"),f(!0)};return window.addEventListener("PlayerInstantiated",W),window.isPlayerInstantiated&&(H.log("LiveStreamButton: Player was already instantiated"),f(!0)),()=>{window.removeEventListener("PlayerInstantiated",W)}},[]);const B=()=>{window.dispatchEvent(new Event("modal-opened")),l(!0)},Y=()=>{window.dispatchEvent(new Event("modal-closed")),l(!1)};return!u||!O||(y==null?void 0:y.enabled)!==!0?(H.log("LiveStreamButton: Not rendering button because:",{playerNotReady:!u,noPermission:!O,streamingDisabled:(y==null?void 0:y.enabled)!==!0,enabledValue:y==null?void 0:y.enabled}),null):S.jsxs(S.Fragment,{children:[S.jsx(Ff,{label:"Live Stream Info",placement:e,hasArrow:!0,children:S.jsx(cd,{size:n,borderRadius:"full",bg:"black",icon:S.jsx(w9e,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:i,"data-testid":"livestream-button",cursor:"pointer",onClick:B})}),S.jsxs(Is,{isOpen:o,onClose:Y,isCentered:!0,size:"md",children:[S.jsx(Os,{backdropFilter:"blur(4px)"}),S.jsxs(As,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",children:[S.jsx(Jo,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Live Stream Info"}),S.jsx($s,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),S.jsx(Ps,{p:4,children:y!=null&&y.rtmpUrl&&(y!=null&&y.streamKey)?S.jsxs($e,{children:[S.jsx(qe,{fontSize:"sm",mb:4,color:"white",children:"Copy these details to your streaming software (OBS, Streamlabs, etc.)"}),S.jsxs($e,{mb:4,children:[S.jsx(qe,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"RTMP URL"}),S.jsx(Mi,{children:S.jsxs(Ag,{size:"sm",children:[S.jsx(Li,{value:y.rtmpUrl,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",color:"white"}),S.jsx(uR,{children:S.jsx(ya,{"aria-label":"Copy RTMP URL",icon:D.hasCopied?S.jsx(iZ,{}):S.jsx(sZ,{}),size:"xs",colorScheme:D.hasCopied?"green":"blue",onClick:()=>{D.onCopy(),R({title:"RTMP URL copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),S.jsxs($e,{mb:4,children:[S.jsx(qe,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"Stream Key"}),S.jsx(Mi,{children:S.jsxs(Ag,{size:"sm",children:[S.jsx(Li,{value:y.streamKey,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",type:"password",color:"white"}),S.jsx(uR,{children:S.jsx(ya,{"aria-label":"Copy Stream Key",icon:U.hasCopied?S.jsx(iZ,{}):S.jsx(sZ,{}),size:"xs",colorScheme:U.hasCopied?"green":"blue",onClick:()=>{U.onCopy(),R({title:"Stream Key copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),S.jsx(qe,{fontSize:"xs",color:"whiteAlpha.800",mt:4,children:"Stream to this RTMP server using the Stream Key above. View and manage stream settings in the Space Manager."})]}):S.jsxs($e,{textAlign:"center",p:4,children:[S.jsx(qe,{color:"white",children:"No stream configuration found for this space."}),S.jsx(qe,{fontSize:"xs",mt:2,color:"whiteAlpha.800",children:"Configure streaming in the Space Manager under Stream tab."})]})})]})]})]})},MF="spaces",UF="portals",YWe=async(n,e,i)=>{try{const o=_r(Xn,MF,n,UF,e),l={...i,sourceSpaceId:n,portalId:e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await Gg(o,l),H.log(`Saved portal ${e} to space ${n}`),!0}catch(o){return H.error("Error saving portal:",o),!1}},XWe=async(n,e)=>{try{const i=_r(Xn,MF,n,UF,e);return await BN(i),H.log(`Deleted portal ${e} from space ${n}`),!0}catch(i){return H.error("Error deleting portal:",i),!1}},JWe=async(n,e,i)=>{try{const o=_r(Xn,MF,n,UF,e),l={...i,updatedAt:new Date().toISOString()};return await ko(o,l),H.log(`Updated portal ${e} in space ${n}`),!0}catch(o){return H.error("Error updating portal:",o),!1}};function QWe(n,e,i){const o=k.useRef();k.useEffect(()=>(o.current&&clearTimeout(o.current),o.current=setTimeout(n,e),()=>clearTimeout(o.current)),i)}const ZWe=({isOpen:n,onClose:e,portal:i,spaceId:o,style:l})=>{if(!n||!i)return null;const[u,f]=k.useState({x:0,y:1.5,z:0}),[y,v]=k.useState({x:0,y:0,z:0}),[b,C]=k.useState({x:1,y:1,z:1}),R=za(),O=Ea();k.useEffect(()=>{i&&(f(i.position||{x:0,y:1.5,z:0}),v(i.rotation||{x:0,y:0,z:0}),C(i.scale||{x:1,y:1,z:1}))},[i]),k.useEffect(()=>{R("UpdatePortalTransform",{portalId:i.portalId,position:u,rotation:y,scale:b})},[u,y,b,i.portalId,R]),QWe(()=>{const D={...i,position:u,rotation:y,scale:b};JWe(o,i.portalId,D)},300,[u,y,b,o,i.portalId]);const L=async()=>{try{if(R("DeletePortal",{portalId:i.portalId}),await XWe(o,i.portalId))O({title:"Portal Deleted",description:"The portal has been removed.",status:"success",duration:3e3,isClosable:!0}),e();else throw new Error("Failed to delete portal from Firebase")}catch{O({title:"Delete Error",description:"Failed to delete portal. Please try again.",status:"error",duration:5e3,isClosable:!0})}};return S.jsxs($e,{position:"absolute",top:"72px",right:"24px",zIndex:2e3,minW:"340px",maxW:"360px",bg:"rgba(255,255,255,0.15)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.18)",borderRadius:"2xl",p:6,border:"1px solid rgba(255,255,255,0.2)",style:{backdropFilter:"blur(18px)",WebkitBackdropFilter:"blur(18px)",...l},color:"gray.900",children:[S.jsx($e,{fontWeight:"bold",fontSize:"lg",mb:2,children:"Edit Portal"}),S.jsxs(hr,{spacing:4,align:"stretch",children:[S.jsxs(Br,{children:[S.jsx(os,{children:"Position"}),S.jsxs(Cn,{children:[S.jsxs(Go,{value:u.x,onChange:(D,U)=>f(B=>({...B,x:U})),step:.1,precision:2,children:[S.jsx($o,{placeholder:"X"}),S.jsxs(Ho,{children:[S.jsx(qo,{}),S.jsx(Ko,{})]})]}),S.jsxs(Go,{value:u.y,onChange:(D,U)=>f(B=>({...B,y:U})),step:.1,precision:2,children:[S.jsx($o,{placeholder:"Y"}),S.jsxs(Ho,{children:[S.jsx(qo,{}),S.jsx(Ko,{})]})]}),S.jsxs(Go,{value:u.z,onChange:(D,U)=>f(B=>({...B,z:U})),step:.1,precision:2,children:[S.jsx($o,{placeholder:"Z"}),S.jsxs(Ho,{children:[S.jsx(qo,{}),S.jsx(Ko,{})]})]})]})]}),S.jsxs(Br,{children:[S.jsx(os,{children:"Rotation"}),S.jsxs(Cn,{children:[S.jsxs(Go,{value:y.x,onChange:(D,U)=>v(B=>({...B,x:U})),step:1,children:[S.jsx($o,{placeholder:"X"}),S.jsxs(Ho,{children:[S.jsx(qo,{}),S.jsx(Ko,{})]})]}),S.jsxs(Go,{value:y.y,onChange:(D,U)=>v(B=>({...B,y:U})),step:1,children:[S.jsx($o,{placeholder:"Y"}),S.jsxs(Ho,{children:[S.jsx(qo,{}),S.jsx(Ko,{})]})]}),S.jsxs(Go,{value:y.z,onChange:(D,U)=>v(B=>({...B,z:U})),step:1,children:[S.jsx($o,{placeholder:"Z"}),S.jsxs(Ho,{children:[S.jsx(qo,{}),S.jsx(Ko,{})]})]})]})]}),S.jsxs(Br,{children:[S.jsx(os,{children:"Scale"}),S.jsxs(Cn,{children:[S.jsxs(Go,{value:b.x,onChange:(D,U)=>C(B=>({...B,x:U})),step:.1,precision:2,min:.1,children:[S.jsx($o,{placeholder:"X"}),S.jsxs(Ho,{children:[S.jsx(qo,{}),S.jsx(Ko,{})]})]}),S.jsxs(Go,{value:b.y,onChange:(D,U)=>C(B=>({...B,y:U})),step:.1,precision:2,min:.1,children:[S.jsx($o,{placeholder:"Y"}),S.jsxs(Ho,{children:[S.jsx(qo,{}),S.jsx(Ko,{})]})]}),S.jsxs(Go,{value:b.z,onChange:(D,U)=>C(B=>({...B,z:U})),step:.1,precision:2,min:.1,children:[S.jsx($o,{placeholder:"Z"}),S.jsxs(Ho,{children:[S.jsx(qo,{}),S.jsx(Ko,{})]})]})]})]}),S.jsx(Cn,{spacing:4,width:"100%",justify:"flex-end",children:S.jsx($n,{colorScheme:"red",onClick:L,variant:"outline",children:"Delete Portal"})}),S.jsx($n,{mt:2,variant:"ghost",colorScheme:"whiteAlpha",onClick:e,children:"Close"})]})]})},eGe=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const e=new URL(n),i=e.searchParams.get("alt"),o=e.searchParams.get("token");return e.search="",i&&e.searchParams.set("alt",i),o&&e.searchParams.set("token",o),e.toString()}return n}catch(e){return console.error("Error cleaning Firebase URL:",e),n}},tGe=()=>{const{spaceID:n}=xo(),e=za(),[i,o]=k.useState(!1);k.useEffect(()=>{if(window.isPlayerInstantiated){H.log("useUnityPortalImages: Unity already ready (via window flag)"),o(!0);return}const l=()=>{H.log("useUnityPortalImages: Unity is now ready (PlayerInstantiated event)"),o(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),k.useEffect(()=>{if(!i){H.log("useUnityPortalImages: Waiting for Unity to be ready before loading portal images");return}H.log("useUnityPortalImages: Unity is ready, now loading portal images"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const u=Uc(Xn,"spaces",n,"portals"),f=await hd(u);if(f.empty){H.log("useUnityPortalImages: No portals found for space:",n);return}H.log(`useUnityPortalImages: Found ${f.size} portals for space ${n}`);for(const y of f.docs){const v=y.data(),b=v.portalId,C=v.targetSpaceId;if(!C){H.warn(`useUnityPortalImages: No target space ID found for portal: ${b}`);continue}const R=await mo(C);if(!R){H.warn(`useUnityPortalImages: No space data found for target space: ${C}`);continue}const O=R.backgroundUrl||R.backgroundGsUrl;if(!O){H.warn(`useUnityPortalImages: No background image URL found for target space: ${C}`);continue}const L=eGe(O);e("SetPortalImage",JSON.stringify({portalId:b,imageUrl:L})),H.log(`Sent portal image data to Unity for portal ${b}: ${L}`)}}catch(u){H.error("Error fetching portal images:",u)}})()},[e,n,i])},nGe=()=>(tGe(),null);function rGe(n,e,i){const o=k.useRef();k.useEffect(()=>(o.current&&clearTimeout(o.current),o.current=setTimeout(n,e),()=>clearTimeout(o.current)),i)}const iGe=({isOpen:n,onClose:e,item:i,spaceId:o,style:l})=>{if(!n||!i)return null;const[u,f]=k.useState({x:0,y:0,z:0}),[y,v]=k.useState({x:0,y:0,z:0}),[b,C]=k.useState({x:1,y:1,z:1}),R=za(),O=Ea();k.useEffect(()=>{i&&(f(i.position||{x:0,y:0,z:0}),v(i.rotation||{x:0,y:0,z:0}),C(i.scale||{x:1,y:1,z:1}))},[i]),k.useEffect(()=>{R("UpdateCatalogueItem",{hotspotId:i.hotspotId,position:u,rotation:y,scale:b})},[u,y,b,i.hotspotId,R]),rGe(()=>{const D=_r(Xn,"spaces",o,"catalogue",i.hotspotId);ko(D,{position:u,rotation:y,scale:b,updatedAt:Date.now()})},300,[u,y,b,o,i.hotspotId]);const L=async()=>{try{R("DeleteCatalogueItem",{hotspotId:i.hotspotId});const D=_r(Xn,"spaces",o,"catalogue",i.hotspotId);await BN(D),O({title:"Item Deleted",description:"The item has been removed.",status:"success",duration:3e3,isClosable:!0}),e()}catch{O({title:"Delete Error",description:"Failed to delete item. Please try again.",status:"error",duration:5e3,isClosable:!0})}};return S.jsxs($e,{position:"absolute",top:"72px",right:"24px",zIndex:2e3,minW:"340px",maxW:"360px",bg:"rgba(255,255,255,0.15)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.18)",borderRadius:"2xl",p:6,border:"1px solid rgba(255,255,255,0.2)",style:{backdropFilter:"blur(18px)",WebkitBackdropFilter:"blur(18px)",...l},color:"gray.900",children:[S.jsx($e,{fontWeight:"bold",fontSize:"lg",mb:2,children:"Edit Catalogue Item"}),S.jsxs(hr,{spacing:4,align:"stretch",children:[S.jsxs(Br,{children:[S.jsx(os,{children:"Position"}),S.jsxs(Cn,{children:[S.jsxs(Go,{value:u.x,onChange:(D,U)=>f(B=>({...B,x:U})),step:.1,precision:2,children:[S.jsx($o,{placeholder:"X"}),S.jsxs(Ho,{children:[S.jsx(qo,{}),S.jsx(Ko,{})]})]}),S.jsxs(Go,{value:u.y,onChange:(D,U)=>f(B=>({...B,y:U})),step:.1,precision:2,children:[S.jsx($o,{placeholder:"Y"}),S.jsxs(Ho,{children:[S.jsx(qo,{}),S.jsx(Ko,{})]})]}),S.jsxs(Go,{value:u.z,onChange:(D,U)=>f(B=>({...B,z:U})),step:.1,precision:2,children:[S.jsx($o,{placeholder:"Z"}),S.jsxs(Ho,{children:[S.jsx(qo,{}),S.jsx(Ko,{})]})]})]})]}),S.jsxs(Br,{children:[S.jsx(os,{children:"Rotation"}),S.jsxs(Cn,{children:[S.jsxs(Go,{value:y.x,onChange:(D,U)=>v(B=>({...B,x:U})),step:1,children:[S.jsx($o,{placeholder:"X"}),S.jsxs(Ho,{children:[S.jsx(qo,{}),S.jsx(Ko,{})]})]}),S.jsxs(Go,{value:y.y,onChange:(D,U)=>v(B=>({...B,y:U})),step:1,children:[S.jsx($o,{placeholder:"Y"}),S.jsxs(Ho,{children:[S.jsx(qo,{}),S.jsx(Ko,{})]})]}),S.jsxs(Go,{value:y.z,onChange:(D,U)=>v(B=>({...B,z:U})),step:1,children:[S.jsx($o,{placeholder:"Z"}),S.jsxs(Ho,{children:[S.jsx(qo,{}),S.jsx(Ko,{})]})]})]})]}),S.jsxs(Br,{children:[S.jsx(os,{children:"Scale"}),S.jsxs(Cn,{children:[S.jsxs(Go,{value:b.x,onChange:(D,U)=>C(B=>({...B,x:U})),step:.1,precision:2,min:.1,children:[S.jsx($o,{placeholder:"X"}),S.jsxs(Ho,{children:[S.jsx(qo,{}),S.jsx(Ko,{})]})]}),S.jsxs(Go,{value:b.y,onChange:(D,U)=>C(B=>({...B,y:U})),step:.1,precision:2,min:.1,children:[S.jsx($o,{placeholder:"Y"}),S.jsxs(Ho,{children:[S.jsx(qo,{}),S.jsx(Ko,{})]})]}),S.jsxs(Go,{value:b.z,onChange:(D,U)=>C(B=>({...B,z:U})),step:.1,precision:2,min:.1,children:[S.jsx($o,{placeholder:"Z"}),S.jsxs(Ho,{children:[S.jsx(qo,{}),S.jsx(Ko,{})]})]})]})]}),S.jsx(Cn,{spacing:4,width:"100%",justify:"flex-end",children:S.jsx($n,{colorScheme:"red",onClick:L,variant:"outline",children:"Delete Item"})}),S.jsx($n,{mt:2,variant:"ghost",colorScheme:"whiteAlpha",onClick:e,children:"Close"})]})]})};function sGe(){const{clickedItem:n,clearClickedItem:e}=Iae(),[i,o]=k.useState(!1);k.useEffect(()=>{const f=y=>{y!=null&&y.detail&&typeof y.detail.enabled=="boolean"&&(o(y.detail.enabled),y.detail.enabled||e())};return window.addEventListener("editModeChanged",f),()=>window.removeEventListener("editModeChanged",f)},[e]);const l=()=>{e()};let u="";if(n!=null&&n.hotspotId){const f=n.hotspotId.split("_");f.length>=3&&(u=f.slice(1,-1).join("_"))}return S.jsx(S.Fragment,{children:n&&i&&S.jsx(iGe,{isOpen:!!n&&i,onClose:l,item:n,spaceId:u})})}const oGe=(n,e={})=>{const{user:i}=k.useContext(ls),{trackUnityEvent:o,isReady:l}=_E(n,{enableDebugLogs:e.enableDebugLogs||!1}),u=jc();return k.useEffect(()=>{if(!l||!i)return;H.log(" Unity Analytics: Setting up event listeners");const f=u("PlayVideo",D=>{H.log(" Unity Analytics: Video play event detected",D),o(ho.UNITY.VIDEO_PLAY,{category:po.MEDIA_INTERACTION,videoId:D==null?void 0:D.gameObjectName,videoUrl:D==null?void 0:D.videoUrl,isEditMode:(D==null?void 0:D.isEditMode)||!1,timestamp:new Date().toISOString(),...D})}),y=u("PlayMediaScreenVideo",D=>{H.log(" Unity Analytics: Media screen click event detected",D),o(ho.UNITY.MEDIA_SCREEN_CLICK,{category:po.MEDIA_INTERACTION,mediaScreenId:D==null?void 0:D.mediaScreenId,videoUrl:D==null?void 0:D.videoUrl,isEditMode:(D==null?void 0:D.isEditMode)||!1,timestamp:new Date().toISOString(),...D})}),v=u("OpenNameplateModal",D=>{H.log(" Unity Analytics: Nameplate click event detected",D),o(ho.UNITY.NAMEPLATE_CLICK,{category:po.SOCIAL_INTERACTION,targetUserId:D==null?void 0:D.uid,targetPlayerName:D==null?void 0:D.playerName,targetPlayerId:D==null?void 0:D.playerId,isLocalPlayer:(D==null?void 0:D.isLocalPlayer)||!1,timestamp:new Date().toISOString(),...D})}),b=u("PlayerInstantiated",D=>{H.log(" Unity Analytics: Player spawn event detected",D),o(ho.UNITY.PLAYER_SPAWN,{category:po.SYSTEM_EVENT,timestamp:new Date().toISOString(),...D})}),C=u("FirstSceneLoaded",D=>{H.log(" Unity Analytics: First scene loaded event detected",D),o(ho.UNITY.SPACE_READY,{category:po.SYSTEM_EVENT,timestamp:new Date().toISOString(),...D})}),R=u("SeatingHotspotClicked",D=>{H.log(" Unity Analytics: Catalogue item click event detected",D),o(ho.UNITY.OBJECT_INTERACT,{category:po.CONTENT_INTERACTION,objectType:"catalogue_item",hotspotId:D==null?void 0:D.hotspotId,itemId:D==null?void 0:D.itemId,position:D==null?void 0:D.position,timestamp:new Date().toISOString(),...D})}),O=u("UpdatePlayerList",D=>{D!=null&&D.players&&Array.isArray(D.players)&&(H.log(" Unity Analytics: Player list update event detected",D),o(ho.UNITY.PLAYER_MOVE,{category:po.SOCIAL_INTERACTION,activePlayerCount:D.players.length,playerList:D.players.map(U=>({playerId:U.playerId,playerName:U.playerName,isLocalPlayer:U.isLocalPlayer})),timestamp:new Date().toISOString()}))}),L=u("RequestUserForUnity",D=>{H.log(" Unity Analytics: Unity user request event detected",D),o(ho.UNITY.SPACE_LOAD,{category:po.SYSTEM_EVENT,requestType:"user_data",timestamp:new Date().toISOString(),...D})});return()=>{H.log(" Unity Analytics: Cleaning up event listeners"),f(),y(),v(),b(),C(),R(),O(),L()}},[l,i,o,u]),{isReady:l,trackUnityEvent:o}},aGe=async(n,e)=>{try{const i=Uc(Xn,`spaces/${n}/chatMessages`);await Aoe(i,e),H.log("Message sent to space chat:",e)}catch(i){throw H.error("Error sending message to space chat:",i),i}},cGe=n=>{const{user:e}=k.useContext(ls),[i,o]=k.useState([]),[l,u]=k.useState(!1),[f,y]=k.useState(null),[v,b]=k.useState([]);k.useEffect(()=>{o([]),b([]),y(null)},[n]),k.useEffect(()=>{if(!n){H.warn("useWebGLChat: No spaceID provided");return}u(!0),y(null),H.log("useWebGLChat: Subscribing to chat messages for space:",n);const L=setTimeout(()=>{H.warn("useWebGLChat: Loading timeout reached, stopping loading state"),u(!1)},1e4);try{const D=Uc(Xn,`spaces/${n}/chatMessages`),U=Nk(D,q6e("timestamp","desc"),Coe(50)),B=Poe(U,Y=>{H.log("useWebGLChat: Firestore snapshot received, docs:",Y.docs.length);const W=[];Y.forEach(me=>{const q=me.data();W.push({id:me.id,...q})});const ne=W.sort((me,q)=>{var ie,pe;const J=(ie=me.timestamp)!=null&&ie.toDate?me.timestamp.toDate():new Date(me.timestamp),Q=(pe=q.timestamp)!=null&&pe.toDate?q.timestamp.toDate():new Date(q.timestamp);return J-Q}),le=new Date(Date.now()-1440*60*1e3),re=ne.filter(me=>{var J;return((J=me.timestamp)!=null&&J.toDate?me.timestamp.toDate():new Date(me.timestamp))>=le});H.log("useWebGLChat: Setting messages:",re.length,"of",ne.length,"total (filtered last 24h)"),o(re),u(!1),clearTimeout(L)},Y=>{H.error("useWebGLChat: Firestore subscription error:",Y),y("Failed to load chat messages"),u(!1)});return()=>{H.log("useWebGLChat: Unsubscribing from chat messages"),clearTimeout(L),B()}}catch(D){H.error("useWebGLChat: Error setting up subscription:",D),y("Failed to load chat messages"),u(!1),clearTimeout(L)}},[n]),k.useEffect(()=>{(async()=>{if(i.length===0){b([]);return}try{const D=await Promise.all(i.map(async U=>{if(U.rpmURL!==void 0||!U.uid)return U;try{const B=await Vc(U.uid);let Y=null;if(B.groups){const W=`space_${n}_owners`,ne=`space_${n}_hosts`;B.groups.includes(W)?Y="owner":B.groups.includes(ne)&&(Y="host")}return{...U,rpmURL:B.rpmURL,role:Y,firstName:B.firstName,lastName:B.lastName}}catch(B){return H.warn("useWebGLChat: Failed to enrich message with profile data:",B),U}}));b(D)}catch(D){H.error("useWebGLChat: Error enriching messages:",D),b(i)}})()},[i,n]);const C=k.useCallback(async L=>{var D;if(!n||!e)throw new Error("Cannot send message: missing spaceID or user");if(!((D=L.text)!=null&&D.trim()))throw new Error("Cannot send empty message");y(null);try{H.log("useWebGLChat: Sending message:",L);const U={text:L.text.trim(),uid:e.uid,user:L.user||e.Nickname||e.displayName||"Anonymous",timestamp:new Date,rpmURL:L.rpmURL||e.rpmURL,isGuest:L.isGuest||e.isGuest||!1};await aGe(n,U),H.log("useWebGLChat: Message sent successfully")}catch(U){throw H.error("useWebGLChat: Error sending message:",U),y("Failed to send message"),U}},[n,e]),R=v.length,O=k.useCallback(L=>{const D=new Date(L);return v.filter(U=>{var Y;return((Y=U.timestamp)!=null&&Y.toDate?U.timestamp.toDate():new Date(U.timestamp))>D})},[v]);return{messages:v,messageCount:R,sendMessage:C,isLoading:l,error:f,getRecentMessages:O}},lGe=n=>{k.useEffect(()=>(n?(H.log("useChatKeyboardFocus: Chat input focused, blocking Unity keyboard input"),My(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(H.log("useChatKeyboardFocus: Chat input blurred, restoring Unity keyboard input"),My(!1),window.dispatchEvent(new CustomEvent("modal-closed")),setTimeout(()=>{Z0(!0)},100)),()=>{n&&(H.log("useChatKeyboardFocus: Cleanup - restoring Unity keyboard input"),My(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[n]),k.useEffect(()=>{const e=i=>{if(i.key==="Escape"&&n){H.log("useChatKeyboardFocus: Escape key pressed, blurring chat input");const o=document.querySelector('input[placeholder*="chat"]');o&&o.blur()}};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[n])},uGe=({message:n,isCurrentUser:e,spaceID:i,onMessageDelete:o})=>{const{user:l}=k.useContext(ls),[u,f]=k.useState(!1),[y,v]=k.useState(!1),[b,C]=k.useState(!1),R=Ea();k.useEffect(()=>{(async()=>{if(l!=null&&l.uid)try{const Y=await GN(l.uid,"disruptiveAdmin");f(Y)}catch(Y){console.error("Error checking admin status:",Y),f(!1)}})()},[l==null?void 0:l.uid]);const O=async()=>{if(!(!i||!n.id)){C(!0);try{await BN(_r(Xn,`spaces/${i}/chatMessages`,n.id)),R({title:"Message Deleted",description:"The message has been removed from the chat.",status:"success",duration:2e3,isClosable:!0}),o&&o(n.id)}catch(B){console.error("Error deleting message:",B),R({title:"Delete Failed",description:"Failed to delete the message. Please try again.",status:"error",duration:3e3,isClosable:!0})}finally{C(!1)}}},L=B=>{if(!B)return"";const Y=B.toDate?B.toDate():new Date(B),ne=new Date-Y,le=Math.floor(ne/(1e3*60)),re=Math.floor(ne/(1e3*60*60));return le<1?"now":le<60?`${le}m`:re<24?`${re}h`:Y.toLocaleDateString()},D=B=>B?B.includes(".glb")?B.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):B:null,U=B=>{if(!B)return"?";if(B.startsWith("Visitor_")){const Y=B.split("_")[1];return`V${Y?Y.charAt(0):""}`}return B.charAt(0).toUpperCase()};return S.jsxs(Cn,{align:"flex-start",spacing:2,px:2,py:1,borderRadius:"md",_hover:{bg:"rgba(255, 255, 255, 0.05)"},width:"100%",maxWidth:"100%",position:"relative",onMouseEnter:()=>v(!0),onMouseLeave:()=>v(!1),role:"group",css:{boxSizing:"border-box"},children:[S.jsx(cd,{size:"xs",src:D(n.rpmURL),name:U(n.user),bg:"whiteAlpha.300",color:"white",borderWidth:"1px",borderColor:"whiteAlpha.300",flexShrink:0,mt:.5}),S.jsx($e,{flex:1,minW:0,children:S.jsxs(qe,{fontSize:"xs",color:"white",wordBreak:"break-word",whiteSpace:"pre-wrap",lineHeight:"1.3",display:"inline",userSelect:"text",_focus:{outline:"none",boxShadow:"none"},css:{"&::selection":{background:"rgba(66, 153, 225, 0.3)"}},children:[S.jsx(qe,{as:"span",fontWeight:"bold",color:e?"blue.300":"green.300",mr:1,textShadow:"0 1px 2px rgba(0,0,0,0.4)",children:n.user}),n.role&&S.jsx(qe,{as:"span",mr:1,children:n.role==="owner"?"":n.role==="host"?"":""}),n.isGuest&&S.jsx(qe,{as:"span",color:"gray.400",fontSize:"xs",mr:1,children:"(Guest)"}),S.jsx(qe,{as:"span",color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.4)",children:n.text}),S.jsx(qe,{as:"span",fontSize:"xs",color:"whiteAlpha.500",ml:2,fontWeight:"normal",children:L(n.timestamp)})]})}),u&&y&&S.jsx($e,{position:"absolute",top:"4px",right:"4px",zIndex:"1000",children:S.jsxs(XS,{children:[S.jsx(JS,{as:ya,icon:S.jsx(_ae,{}),size:"xs",variant:"ghost",color:"white",bg:"rgba(0, 0, 0, 0.6)",_hover:{bg:"rgba(0, 0, 0, 0.8)"},_active:{bg:"rgba(0, 0, 0, 0.8)"},borderRadius:"full",minW:"20px",h:"20px",isLoading:b}),S.jsx(QS,{bg:"rgba(0, 0, 0, 0.9)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:"9999",boxShadow:"lg",border:"1px solid rgba(255, 255, 255, 0.2)",children:S.jsx(NS,{icon:S.jsx(E9e,{}),onClick:O,bg:"transparent",color:"red.300",_hover:{bg:"red.900"},fontSize:"sm",isDisabled:b,children:"Delete Message"})})]})})]})},dGe=({messages:n=[],currentUserId:e,isLoading:i=!1,spaceID:o})=>{const l=k.useRef(null),u=k.useRef(null),f=b=>{};k.useEffect(()=>{l.current&&setTimeout(()=>{l.current.scrollIntoView({behavior:n.length<=1?"auto":"smooth",block:"end"})},100)},[n]),k.useEffect(()=>{n.length>0&&l.current&&l.current.scrollIntoView({behavior:"auto",block:"end"})},[]);const v=(b=>{const C=[];let R=null;return b.forEach(O=>{var U;const D=((U=O.timestamp)!=null&&U.toDate?O.timestamp.toDate():new Date(O.timestamp)).toDateString();(!R||R.date!==D)&&(R={date:D,messages:[]},C.push(R)),R.messages.push(O)}),C})(n);return i&&n.length===0?S.jsx($e,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",color:"whiteAlpha.600",children:S.jsxs(hr,{spacing:2,children:[S.jsx(_d,{size:"sm"}),S.jsx(qe,{fontSize:"sm",children:"Loading messages..."})]})}):n.length===0?S.jsx($e,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",color:"whiteAlpha.600",textAlign:"center",p:4,children:S.jsxs(hr,{spacing:2,children:[S.jsx(qe,{fontSize:"sm",children:"No messages yet"}),S.jsx(qe,{fontSize:"xs",children:"Be the first to start the conversation!"})]})}):S.jsx($e,{ref:u,width:"100%",maxWidth:"100%",height:"100%",css:{boxSizing:"border-box","& *:focus":{outline:"none !important",boxShadow:"none !important"},"& *::selection":{background:"transparent"}},children:S.jsxs(hr,{spacing:0,align:"stretch",width:"100%",children:[v.map((b,C)=>S.jsxs($e,{children:[C>0&&S.jsxs($e,{display:"flex",alignItems:"center",my:2,children:[S.jsx($e,{flex:1,height:"1px",bg:"whiteAlpha.200"}),S.jsx(qe,{fontSize:"xs",color:"whiteAlpha.600",px:2,bg:"rgba(0, 0, 0, 0.5)",borderRadius:"md",children:b.date===new Date().toDateString()?"Today":b.date}),S.jsx($e,{flex:1,height:"1px",bg:"whiteAlpha.200"})]}),b.messages.map(R=>S.jsx(uGe,{message:R,isCurrentUser:R.uid===e,spaceID:o,onMessageDelete:f},R.id))]},b.date)),S.jsx("div",{ref:l,style:{height:"1px",width:"100%"}})]})})};function hGe(n){return ir({attr:{fill:"currentColor",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"}},{tag:"path",attr:{d:"M4.285 9.567a.5.5 0 0 1 .683.183A3.498 3.498 0 0 0 8 11.5a3.498 3.498 0 0 0 3.032-1.75.5.5 0 1 1 .866.5A4.498 4.498 0 0 1 8 12.5a4.498 4.498 0 0 1-3.898-2.25.5.5 0 0 1 .183-.683zM7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5zm4 0c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5z"}}]})(n)}const pGe=({onSendMessage:n,onFocusChange:e,placeholder:i="Press Enter to chat...",disabled:o=!1,maxLength:l=500})=>{const[u,f]=k.useState(""),[y,v]=k.useState(!1),b=k.useRef(null),C=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],R=Y=>{Y.key==="Enter"&&!Y.shiftKey?(Y.preventDefault(),O()):Y.key==="Escape"&&(Y.preventDefault(),D())},O=()=>{u.trim()&&!o&&(n(u),f(""),setTimeout(()=>{b.current&&b.current.focus()},0))},L=()=>{v(!0),e==null||e(!0)},D=()=>{v(!1),e==null||e(!1),b.current&&b.current.blur()},U=Y=>{const W=Y.target.value;W.length<=l&&f(W)},B=Y=>{const W=u+Y;W.length<=l&&(f(W),setTimeout(()=>{b.current&&b.current.focus()},0))};return k.useEffect(()=>{const Y=W=>{W.key==="Enter"&&!y&&!o&&W.target.tagName!=="INPUT"&&W.target.tagName!=="TEXTAREA"&&!W.target.isContentEditable&&(W.preventDefault(),b.current&&b.current.focus())};return document.addEventListener("keydown",Y),()=>{document.removeEventListener("keydown",Y)}},[y,o]),S.jsxs(Ag,{size:"sm",children:[S.jsx(uS,{children:S.jsxs(XS,{children:[S.jsx(JS,{as:ya,icon:S.jsx(hGe,{}),size:"xs",variant:"ghost",color:"white",_hover:{bg:"whiteAlpha.200"},"aria-label":"Add emoji",disabled:o}),S.jsx(QS,{bg:"rgba(0, 0, 0, 0.9)",borderColor:"whiteAlpha.300",border:"1px solid rgba(255, 255, 255, 0.2)",maxW:"280px",zIndex:"9999",p:2,children:S.jsx(oj,{columns:8,spacing:1,children:C.map((Y,W)=>S.jsx($e,{as:"button",p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},onClick:()=>B(Y),fontSize:"lg",textAlign:"center",minH:"32px",display:"flex",alignItems:"center",justifyContent:"center",children:Y},W))})})]})}),S.jsx(Li,{ref:b,value:u,onChange:U,onKeyPress:R,onFocus:L,onBlur:D,placeholder:i,disabled:o,bg:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",color:"white",_placeholder:{color:"whiteAlpha.500"},_focus:{bg:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 0 0 1px rgba(66, 153, 225, 0.4)"},_hover:{border:"1px solid rgba(255, 255, 255, 0.2)"},borderRadius:"md",pl:"40px",pr:"40px"}),S.jsx(uR,{children:S.jsx(ya,{icon:S.jsx($ze,{}),size:"xs",variant:"ghost",color:"white",_hover:{bg:"whiteAlpha.200"},onClick:O,disabled:o||!u.trim(),"aria-label":"Send message"})})]})},fGe=({spaceID:n,isVisible:e=!0})=>{const{user:i}=k.useContext(ls),{isOpen:o,onToggle:l,onClose:u}=pd(),[f,y]=k.useState(!1),[v,b]=k.useState(0),[C,R]=k.useState(!1),[O,L]=k.useState(!1),D=k.useRef(null),{messages:U,sendMessage:B,isLoading:Y,error:W}=cGe(n);lGe(f),k.useEffect(()=>{const re=()=>{R(!0)};return window.addEventListener("PlayerInstantiated",re),()=>{window.removeEventListener("PlayerInstantiated",re)}},[]),k.useEffect(()=>{if(!o&&U.length>0){const re=U.filter(me=>me.timestamp>(localStorage.getItem(`lastReadChat_${n}`)||0));b(re.length)}else o&&(b(0),localStorage.setItem(`lastReadChat_${n}`,Date.now().toString()))},[o,U,n]);const ne=async re=>{if(!(!i||!re.trim()))try{await B({text:re.trim(),uid:i.uid,user:i.Nickname||i.displayName||i.username||"Anonymous",timestamp:new Date,rpmURL:i.rpmURL,isGuest:i.isGuest||!1})}catch(me){console.error("Failed to send message:",me)}},le=re=>{y(re)};return k.useEffect(()=>{o&&D.current&&setTimeout(()=>{const re=D.current;re.scrollTop=re.scrollHeight},150)},[o,U.length]),k.useEffect(()=>{(async()=>{if(n)try{const me=await mo(n);L((me==null?void 0:me.textChatDisabled)||!1)}catch(me){console.error("Error checking text chat setting:",me),L(!1)}})()},[n]),k.useEffect(()=>{const re=me=>{me.detail&&me.detail.spaceId===n&&(L(me.detail.textChatDisabled),me.detail.textChatDisabled&&o&&u())};return window.addEventListener("SpaceTextChatSettingChanged",re),()=>{window.removeEventListener("SpaceTextChatSettingChanged",re)}},[n,o,u]),!e||!i||!C||O?null:S.jsxs($e,{position:"absolute",bottom:"20px",left:"20px",zIndex:"1000",maxWidth:"350px",minWidth:"280px",children:[!o&&S.jsxs($e,{position:"relative",children:[S.jsx(ya,{icon:S.jsx(KQ,{}),"aria-label":"Open chat",size:"lg",colorScheme:"blue",bg:"rgba(0, 0, 0, 0.7)",color:"white",_hover:{bg:"rgba(0, 0, 0, 0.8)"},borderRadius:"full",onClick:l}),v>0&&S.jsx(Dc,{position:"absolute",top:"-5px",right:"-5px",colorScheme:"red",borderRadius:"full",minW:"20px",h:"20px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"xs",children:v>99?"99+":v})]}),S.jsx(Sne,{in:o,animateOpacity:!0,children:S.jsxs($e,{bg:"rgba(0, 0, 0, 0.3)",backdropFilter:"blur(8px)",borderRadius:"md",overflow:"visible",maxWidth:"350px",minWidth:"280px",children:[S.jsx($e,{height:"210px",overflowY:"scroll",overflowX:"hidden",p:2,width:"100%",maxWidth:"100%",css:{boxSizing:"border-box","&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"transparent"},"&::-webkit-scrollbar-thumb":{background:"rgba(255, 255, 255, 0.2)",borderRadius:"2px"},"&::-webkit-scrollbar:horizontal":{display:"none"}},ref:D,children:S.jsx(dGe,{messages:U,currentUserId:i==null?void 0:i.uid,isLoading:Y,spaceID:n})}),S.jsx($e,{p:2,children:S.jsxs(Cn,{spacing:2,align:"center",children:[S.jsx($e,{flex:1,children:S.jsx(pGe,{onSendMessage:ne,onFocusChange:le,placeholder:"Press Enter to chat...",disabled:Y})}),S.jsx(ya,{icon:S.jsx(KQ,{}),size:"sm",variant:"ghost",color:"white",_hover:{bg:"whiteAlpha.200"},onClick:u,"aria-label":"Minimize chat",h:"32px",w:"32px",flexShrink:0})]})}),W&&S.jsx($e,{p:2,bg:"red.500",color:"white",fontSize:"xs",textAlign:"center",children:W})]})})]})},mGe=({isOpen:n,onClose:e,currentSpaceId:i})=>{const[o,l]=k.useState([]),[u,f]=k.useState(!1),[y,v]=k.useState(null),[b,C]=k.useState(!1),R=Ea(),{placePortal:O,directPlacePortal:L}=Tae(),D=Rg("rgba(240, 240, 240, 0.95)","rgba(35, 35, 35, 0.95)"),U=Rg("gray.800","white"),B=Rg("gray.200","whiteAlpha.200"),Y=Rg("gray.200","whiteAlpha.300");k.useEffect(()=>{n&&(async()=>{f(!0),v(null),l([]);try{const re=Uc(Xn,"spaces"),q=(await hd(re)).docs.map(J=>({id:J.id,name:J.data().name||`Space ID: ${J.id}`}));l(q)}catch(re){H.error("PortalAdminModal: Error fetching spaces:",re),v("Failed to load spaces. Please check your connection and try again.")}f(!1)})()},[n]);const W=async(le,re)=>{if(!i){H.error("PortalAdminModal: currentSpaceId is not defined. Cannot save portal."),R({title:"Error",description:"Cannot place portal: Current space ID is missing.",status:"error",duration:5e3,isClosable:!0});return}C(!0),H.log(`PortalAdminModal: Attempting to place portal to ${re} (${le}) in space ${i}`);try{const me=await mo(le);if(!me)throw new Error(`Failed to fetch target space data for ${le}`);const q=me.backgroundUrl||me.backgroundGsUrl;q||H.warn(`PortalAdminModal: No background image URL found for target space: ${le}`);const J="PortalObjectPrefab",Q={x:0,y:1.5,z:0},ie={x:0,y:0,z:0},pe={x:1,y:1,z:1},de=`portal_${i}_${le}_${Date.now()}`;if(!await YWe(i,de,{type:"portal",targetSpaceId:le,targetSpaceName:re,portalId:de,position:Q,rotation:ie,scale:pe,prefabName:J,initialImageUrl:q})){H.error(`PortalAdminModal: Failed to save portal data to Firebase for space ${i}.`),R({title:"Save Error",description:"Failed to save portal data to database.",status:"error",duration:5e3,isClosable:!0}),C(!1);return}H.log(`PortalAdminModal: Portal data saved to Firebase for space ${i}.`);let Ie=!1;try{const Fe={portalId:de,prefabName:J,position:Q,rotation:ie,scale:pe,initialImageUrl:q};Ie=O(de,J,Q,ie,pe,q),Ie||(Ie=L(de,J,Q,ie,pe,q)),H.log("PortalAdminModal: Portal placement in Unity:",Ie)}catch(Fe){H.error("PortalAdminModal: Error placing portal in Unity:",Fe)}Ie?(R({title:"Portal Placed",description:`Portal to ${re} created successfully.`,status:"success",duration:3e3,isClosable:!0}),e()):(R({title:"Portal Saved",description:"Portal data saved. It will appear when Unity is ready.",status:"info",duration:5e3,isClosable:!0}),e())}catch(me){H.error("PortalAdminModal: Error creating portal:",me),R({title:"Error",description:"Failed to create portal. Please try again.",status:"error",duration:5e3,isClosable:!0})}finally{C(!1)}},ne=u||b;return S.jsxs(Is,{isOpen:n,onClose:e,size:"lg",isCentered:!0,scrollBehavior:"inside",children:[S.jsx(Os,{bg:"blackAlpha.700",backdropFilter:"blur(8px)"}),S.jsxs(As,{bg:D,backdropFilter:"blur(18px)",color:U,borderRadius:"lg",maxHeight:"80vh",boxShadow:"2xl",children:[S.jsx(Jo,{borderBottom:"1px solid",borderColor:Y,fontSize:"lg",fontWeight:"semibold",children:"Select a Space to Create Portal To"}),S.jsx($s,{}),S.jsxs(Ps,{p:6,children:[ne&&S.jsxs(hr,{justifyContent:"center",alignItems:"center",height:"200px",children:[S.jsx(_d,{size:"xl",thickness:"4px",speed:"0.65s",emptyColor:"gray.200",color:"blue.500"}),S.jsx(qe,{mt:3,children:"Loading Spaces..."})]}),y&&S.jsxs(Jy,{status:"error",borderRadius:"md",variant:"subtle",children:[S.jsx(Qy,{}),y]}),!u&&!y&&o.length===0&&S.jsx(qe,{textAlign:"center",py:10,children:"No spaces found or you may not have permission to view them."}),!u&&!y&&o.length>0&&S.jsx(iN,{spacing:3,children:o.map(le=>S.jsx(ure,{p:3,borderRadius:"md",_hover:{bg:B,cursor:ne?"not-allowed":"pointer",transform:ne?"none":"scale(1.02)"},transition:"background-color 0.2s ease-in-out, transform 0.2s ease-in-out",onClick:()=>!ne&&W(le.id,le.name),borderWidth:"1px",borderColor:"transparent",_focus:{boxShadow:"outline"},opacity:ne?.7:1,pointerEvents:ne?"none":"auto",children:le.name},le.id))})]})]})]})},gGe={Furniture:"chair",Objects:"misc"},_Ge=({isOpen:n,onClose:e,settings:i})=>{const[o,l]=k.useState(null),[u,f]=k.useState(""),[y,v]=k.useState(!1),[b,C]=k.useState(!1),[R,O]=k.useState([]),[L,D]=k.useState(!0),[U,B]=k.useState(null),{placeCatalogueItem:Y}=Cae();Rg("blue.500","blue.300"),Rg("gray.500","gray.400"),Rg("whiteAlpha.200","whiteAlpha.200"),k.useEffect(()=>{n&&(async()=>{D(!0),B(null),O([]);try{const ie=Uc(Xn,"catalogue"),pe=await hd(ie),de=[];pe.forEach(he=>{var Fe,we;const Se=he.data(),Ie=["chair","misc"];Se.glbUrl&&((Fe=Se.categories)!=null&&Fe.some(Re=>Ie.includes(Re)))&&de.push({id:he.id,name:Se.name||"Unnamed Item",thumbnail:((we=Se.thumbnail)==null?void 0:we.src)||"https://via.placeholder.com/150",glbUrl:Se.glbUrl,categories:Se.categories})}),O(de)}catch(ie){console.error("Error fetching catalogue items:",ie),B("Failed to load catalogue items. Please check your connection and try again.")}D(!1)})()},[n]);const W=Q=>{l(Q),f(""),v(Q==="Portals")},ne=()=>{l(null),v(!1),f("")},le=(Q,ie)=>{const pe=gGe[ie];let de=Q;return pe&&(de=de.filter(he=>{var Se;return(Se=he.categories)==null?void 0:Se.includes(pe)})),u&&(de=de.filter(he=>he.name.toLowerCase().includes(u.toLowerCase()))),de},re=["Furniture","Objects"].includes(o||"")?le(R,o):[],me=async Q=>{try{if(!Q.glbUrl){console.error("Item is missing GLB URL");return}const ie=`item_${i.spaceID}_${Date.now()}`,pe={x:0,y:0,z:0},de={x:0,y:0,z:0},he={x:1,y:1,z:1},Se={itemId:ie,name:Q.name||"Unnamed Item",glbUrl:Q.glbUrl,thumbnail:Q.thumbnail||"https://via.placeholder.com/150",position:pe,rotation:de,scale:he,createdAt:Date.now(),updatedAt:Date.now(),categories:Q.categories||[]};if(!Se.glbUrl)throw new Error("GLB URL is required");await Gg(_r(Xn,"spaces",i.spaceID,"catalogue",ie),Se),Y(ie,Se.glbUrl,pe,de,he)?e():console.error("Failed to place item in Unity")}catch(ie){console.error("Error placing item:",ie)}},q=()=>{C(!0)},J=()=>{C(!1)};return S.jsxs(Is,{isOpen:n,onClose:e,isCentered:!1,motionPreset:"slideInLeft",children:[S.jsx(Os,{bg:"transparent",backdropFilter:"none"}),S.jsxs(As,{bg:"#1a1a1a",color:"white",borderRadius:"2xl",border:"1px solid #333",position:"fixed",left:"20px",top:"20px",transform:"none",width:"360px",maxWidth:"360px",height:"80vh",maxHeight:"80vh",overflow:"hidden",boxShadow:"xl",children:[S.jsx(Jo,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",borderBottom:"1px solid",borderColor:"whiteAlpha.300",children:S.jsxs(Mi,{align:"center",gap:2,children:[o&&S.jsx(ya,{"aria-label":"Back",icon:S.jsx(a9e,{}),size:"sm",variant:"ghost",color:"whiteAlpha.800",onClick:ne}),S.jsx(qe,{children:o?y?"Create New Portal":o:"Content Catalogue"})]})}),S.jsx($s,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsxs(Ps,{p:0,display:"flex",flexDirection:"column",height:"calc(100% - 60px)",children:[!o&&S.jsx($e,{p:4,children:S.jsxs(ck,{templateColumns:"repeat(2, 1fr)",gap:3,children:[S.jsx($e,{onClick:()=>W("Recent"),cursor:"pointer",bg:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"xl",height:"120px",display:"flex",alignItems:"center",justifyContent:"center",_hover:{bg:"rgba(255,255,255,0.12)"},children:S.jsxs(hr,{spacing:2,children:[S.jsx(Zt,{as:l9e,boxSize:8,color:"white"}),S.jsx(qe,{fontSize:"sm",color:"white",children:"Recent"})]})}),S.jsx($e,{onClick:()=>W("Furniture"),cursor:"pointer",bg:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"xl",height:"120px",display:"flex",alignItems:"center",justifyContent:"center",_hover:{bg:"rgba(255,255,255,0.12)"},children:S.jsxs(hr,{spacing:2,children:[S.jsx(Zt,{as:u9e,boxSize:8,color:"white"}),S.jsx(qe,{fontSize:"sm",color:"white",children:"Furniture"})]})}),S.jsx($e,{onClick:()=>W("Objects"),cursor:"pointer",bg:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"xl",height:"120px",display:"flex",alignItems:"center",justifyContent:"center",_hover:{bg:"rgba(255,255,255,0.12)"},children:S.jsxs(hr,{spacing:2,children:[S.jsx(Zt,{as:d9e,boxSize:8,color:"white"}),S.jsx(qe,{fontSize:"sm",color:"white",children:"Objects"})]})}),S.jsx($e,{onClick:()=>W("Upload"),cursor:"pointer",bg:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"xl",height:"120px",display:"flex",alignItems:"center",justifyContent:"center",_hover:{bg:"rgba(255,255,255,0.12)"},children:S.jsxs(hr,{spacing:2,children:[S.jsx(Zt,{as:v9e,boxSize:8,color:"white"}),S.jsx(qe,{fontSize:"sm",color:"white",children:"Upload"})]})}),S.jsx($e,{onClick:()=>W("Portals"),cursor:"pointer",bg:"rgba(255,255,255,0.06)",border:"1px solid rgba(255,255,255,0.12)",borderRadius:"xl",height:"120px",display:"flex",alignItems:"center",justifyContent:"center",gridColumn:"1 / span 2",_hover:{bg:"rgba(255,255,255,0.12)"},children:S.jsxs(hr,{spacing:2,children:[S.jsx(Zt,{as:h9e,boxSize:8,color:"white"}),S.jsx(qe,{fontSize:"sm",color:"white",children:"Portals"})]})})]})}),o==="Portals"&&y?S.jsx($e,{p:4,flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",children:S.jsx($n,{size:"lg",colorScheme:"blue",onClick:q,children:"Browse"})}):o&&S.jsxs(S.Fragment,{children:[S.jsx($e,{p:4,children:S.jsx(Li,{placeholder:`Search in ${o}...`,value:u,onChange:Q=>f(Q.target.value),bg:"rgba(255, 255, 255, 0.05)",borderColor:"rgba(255, 255, 255, 0.2)",borderRadius:"md",size:"md",_placeholder:{color:"whiteAlpha.500"}})}),S.jsx($e,{p:4,pt:0,overflowY:"auto",flexGrow:1,children:S.jsx(ck,{templateColumns:"repeat(2, minmax(0, 1fr))",gap:3,children:L?S.jsx(qe,{color:"whiteAlpha.700",children:"Loading items..."}):re.length>0?re.map(Q=>S.jsxs($e,{p:2,bg:"whiteAlpha.100",borderRadius:"lg",textAlign:"center",cursor:"pointer",_hover:{bg:"whiteAlpha.300",transform:"scale(1.03)"},onClick:()=>me(Q),transition:"all 0.2s ease-in-out",display:"flex",flexDirection:"column",children:[S.jsx($e,{bgImage:`url(${Q.thumbnail})`,bgSize:"contain",bgRepeat:"no-repeat",bgPos:"center",borderRadius:"md",h:"84px",mb:2,flexShrink:0}),S.jsx(qe,{fontSize:"xs",noOfLines:2,flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",children:Q.name})]},Q.id)):S.jsxs(qe,{color:"whiteAlpha.700",children:[o==="Furniture"&&"No chairs found in the catalogue.",o==="Objects"&&"No miscellaneous objects found in the catalogue.",!["Furniture","Objects"].includes(o)&&`No items found in "${o}"${u&&` matching "${u}"`}.`]})})})]})]})]}),S.jsx(mGe,{isOpen:b,onClose:J,currentSpaceId:i==null?void 0:i.spaceID})]})},yGe="9442a472625f44e7b2c5065b9f9b3988",nV=()=>document.querySelector("canvas")||document.getElementById("unity-canvas"),VF=k.forwardRef(({settings:n},e)=>{const{unityProvider:i,isLoaded:o,error:l}=xo(),u=C9e();I9e();const f=za(),y=$9e(u),{user:v}=k.useContext(ls),[b,C]=k.useState(!1),[R,O]=k.useState(window.devicePixelRatio),[L,D]=R9e();wae().find(St=>St.isLocalPlayer);const[B,Y]=k.useState(!0),[W,ne]=k.useState(!0),[le,re]=k.useState(!1),me=Ea(),q=n.spaceID||"default";G9e(),z9e(q),oGe(q,{enableDebugLogs:!0});const{trackUnityEvent:J}=_E(q,{enableDebugLogs:!0}),[Q,ie]=k.useState(!1),[pe,de]=k.useState(!1),[he,Se]=k.useState(!1),[Ie,Fe]=k.useState(!1),we=k.useMemo(()=>new URLSearchParams(window.location.search).get("sessionId")||q,[q]),[Re,Te]=k.useState(null);k.useEffect(()=>{v!=null&&v.uid&&Vc(v.uid).then(St=>{Te(St)}).catch(St=>{console.error("Error fetching user profile:",St)})},[v==null?void 0:v.uid]),k.useEffect(()=>{(async()=>{if(v!=null&&v.uid&&q)try{const ve=await Vc(v.uid);let De=!1;if(ve.groups){const Ot=`space_${q}_owners`;De=ve.groups.includes(Ot)}const Ke=await GN(v.uid,"disruptiveAdmin");re(De||Ke)}catch(ve){console.error("Error checking edit permissions:",ve),re(!1)}else re(!1)})()},[v==null?void 0:v.uid,q]),k.useEffect(()=>{const St=async()=>{if(l){de(!0),Se(!0);return}if(v){de(!1);return}try{const De=await mo(q);De&&De.allowGuestUsers===!0?de(!1):(de(!0),Se(!0))}catch{de(!0),Se(!0)}},ve=setTimeout(()=>{St()},1e3);return()=>clearTimeout(ve)},[l,v,q]),k.useEffect(()=>{const St=()=>{ne(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&ne(!0),mh.subscribe(fh.playerInstantiated,St);const ve=setTimeout(()=>{W||(ne(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{mh.unsubscribe(fh.playerInstantiated,St),clearTimeout(ve)}},[W]),k.useEffect(()=>{const St=()=>{Se(!0)},ve=()=>{Se(!1)};return window.addEventListener("modal-opened",St),window.addEventListener("modal-closed",ve),()=>{window.removeEventListener("modal-opened",St),window.removeEventListener("modal-closed",ve)}},[]),k.useEffect(()=>{Se(L!==null)},[L]),k.useEffect(()=>{o||u?setTimeout(()=>{C(!0)},5e3):console.warn("WebGLRenderer: Unity is NOT ready yet.")},[o,u]),k.useEffect(()=>{o&&i&&setTimeout(()=>{if(window.unityInstance)try{window.unityInstance.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",!1)}catch(St){console.error("WebGLRenderer: Error disabling Unity keyboard capture:",St)}},1e3)},[o,i]),k.useEffect(()=>{const St=document.getElementById("webgl-root");return St?(St.style.display="block",St.getAttribute("data-space-id")!==q&&St.setAttribute("data-space-id",q)):console.error("WebGLRenderer: Could not find webgl-root element"),()=>{}},[q]),k.useEffect(()=>{const St=()=>{const Ke=nV();Ke?(Ke.tabIndex=1,Ke.style.outline="none",Ke.addEventListener("click",()=>{he||Z0(!0)})):console.warn("WebGLRenderer: Could not find Unity canvas to configure")};St();const ve=setTimeout(St,1e3),De=()=>{St()};return window.addEventListener("unityReady",De),()=>{clearTimeout(ve),window.removeEventListener("unityReady",De)}},[o,he]);const Ne=k.useCallback(()=>{he||Z0(!0)},[he]);k.useEffect(()=>{if(o&&i){const St=nV();if(St)return St.addEventListener("click",Ne),()=>{St.removeEventListener("click",Ne)}}},[o,i,Ne]),k.useEffect(()=>{if(o&&i){const St=ve=>{if(he||ve.target.tagName==="INPUT"||ve.target.tagName==="TEXTAREA"||ve.target.tagName==="SELECT"||ve.target.tagName==="BUTTON"||ve.target.closest(".chakra-modal__content")||ve.target.closest('[role="dialog"]')||ve.target.closest('[role="menu"]')||ve.target.closest(".chakra-popover__content")||ve.target.closest('[role="tooltip"]'))return;const De=nV();if(De&&(ve.target===De||De.contains(ve.target)))return;if(ve.target.closest(".webgl-overlay")||ve.target.closest(".game-ui")||ve.target.closest(".player-list")||ve.target.closest(".unity-ui-overlay")){setTimeout(()=>{he||Z0(!0)},50);return}setTimeout(()=>{De&&!he&&((De.tabIndex===void 0||De.tabIndex<0)&&(De.tabIndex=1),De.focus(),Z0(!0))},50)};return document.addEventListener("click",St,!0),()=>{document.removeEventListener("click",St,!0)}}},[o,i,he]),k.useEffect(()=>{const St=ve=>{f("FirebaseUserFromReact",ve)};return mh.subscribe(fh.sendUserToUnity,St),()=>mh.unsubscribe(fh.sendUserToUnity,St)},[f]);const{setFullscreenRef:be,fullscreenRef:xe}=vh();k.useEffect(()=>{be(e.current)},[e,be]);const je=()=>{if(!le){me({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}if(Ie){Fe(!1),Se(!1);return}if(Q){ie(!1);const St=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(St)}else{ie(!0),Fe(!0),Se(!0);const St=new CustomEvent("editModeChanged",{detail:{enabled:!0}});window.dispatchEvent(St)}},nt=()=>{Fe(!1),Se(!1)},dt=()=>{Y(!B)},ft=v&&n.enableVoiceChat;k.useEffect(()=>{const St=ve=>{ie(ve.detail.enabled)};return window.addEventListener("editModeChanged",St),()=>{window.removeEventListener("editModeChanged",St)}},[]),bae(),k9e();const lt=k.useRef(null),{clickedPortal:gt,clearClickedPortal:at}=W9e(),[Ct,En]=k.useState(!1),[Gt,Xt]=k.useState(!1),[st,hn]=k.useState(""),[an,jt]=k.useState("");k.useEffect(()=>{async function St(){if(hn(""),jt(""),gt&&!Q){let ve=gt.targetSpaceId;if(!ve&&gt.portalId)try{const De=_r(Xn,"spaces",q,"portals",gt.portalId),Ke=await Xo(De);Ke.exists()&&(ve=Ke.data().targetSpaceId)}catch{}if(ve)try{const De=await mo(ve);hn((De==null?void 0:De.name)||ve),jt((De==null?void 0:De.slug)||""),Xt(!0)}catch{hn(ve),jt(""),Xt(!0)}else hn(""),jt(""),Xt(!0)}}gt&&Q&&En(!0),gt&&!Q&&St()},[gt,Q,q]);const on=()=>{En(!1),at()};return H9e(q),Iae(),S.jsxs($e,{className:"webgl-renderer",children:[n.urlLoadingBackground&&S.jsx(Mae,{backgroundUrl:n.urlLoadingBackground,videoBackgroundUrl:n.videoBackgroundUrl,containerRef:lt}),!pe&&S.jsx(Uae,{containerRef:lt}),pe&&S.jsx($e,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:S.jsx(wR,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),S.jsx(sGe,{spaceId:q,isEditMode:Q}),S.jsx(_Ge,{isOpen:Ie,onClose:nt,settings:{spaceID:q}}),S.jsx(r3,{containerRef:xe.current?xe:document.body,children:S.jsxs("div",{ref:e,style:{width:"100%",height:"100%",aspectRatio:"auto",position:"absolute"},children:[S.jsxs($e,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[S.jsx(q9e,{}),v&&S.jsx(qWe,{size:"md"}),ft&&S.jsxs(xae,{appId:yGe,channel:we,uid:v==null?void 0:v.uid,enabled:!0,children:[S.jsx(uWe,{size:"md",defaultMuted:!0,joinOnClick:!0}),S.jsx(hWe,{userNickname:Re==null?void 0:Re.Nickname})]}),le&&S.jsx($e,{as:"button",onClick:je,"aria-label":"Edit Mode",display:"flex",alignItems:"center",justifyContent:"center",width:"48px",height:"48px",color:"white",bg:Q?"linear-gradient(135deg, rgba(0, 0, 0, 0.45), rgba(0, 150, 255, 0.2), rgba(0, 0, 0, 0.35))":"linear-gradient(135deg, rgba(0, 0, 0, 0.5), rgba(20, 20, 20, 0.4))",backdropFilter:"blur(30px) saturate(200%) brightness(1.1)",_hover:{bg:Q?"linear-gradient(135deg, rgba(0, 0, 0, 0.55), rgba(0, 150, 255, 0.3), rgba(0, 0, 0, 0.45))":"linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(20, 20, 20, 0.5))",transform:"scale(1.05)",backdropFilter:"blur(35px) saturate(220%) brightness(1.15)"},cursor:"pointer",boxShadow:Q?"0 0 20px 2px rgba(0, 150, 255, 0.8), 0 0 40px 4px rgba(0, 150, 255, 0.4), inset 0 1px 2px rgba(255, 255, 255, 0.4), inset 0 -1px 2px rgba(0, 0, 0, 0.3)":"0 4px 15px rgba(0, 0, 0, 0.3), inset 0 1px 2px rgba(255, 255, 255, 0.25), inset 0 -1px 2px rgba(0, 0, 0, 0.2)",transition:"all 0.3s ease",border:"1px solid",borderColor:Q?"rgba(0, 150, 255, 0.4)":"rgba(255, 255, 255, 0.2)",borderRadius:"full",position:"relative",_before:{content:'""',position:"absolute",top:0,left:0,right:0,bottom:0,borderRadius:"full",padding:"1px",background:Q?"linear-gradient(135deg, rgba(0, 150, 255, 0.5), rgba(0, 200, 255, 0.2))":"linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.1))",WebkitMask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",WebkitMaskComposite:"xor",maskComposite:"exclude",pointerEvents:"none"},children:S.jsx(T9e,{size:"20px"})}),S.jsx(J9e,{}),S.jsx($e,{position:"relative",zIndex:"9999",children:S.jsx(xWe,{onTogglePlayerList:dt,spaceID:q,containerRef:lt})})]}),S.jsxs($e,{ref:lt,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[S.jsx($e,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),S.jsx($e,{...y,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:i&&!pe?S.jsx(pae.Unity,{unityProvider:i,style:{width:"100%",height:"100%"},devicePixelRatio:R,tabIndex:1}):S.jsx($e,{width:"100%",height:"100%",backgroundColor:"#333",display:"flex",alignItems:"center",justifyContent:"center",children:pe&&S.jsx(qe,{color:"white",fontSize:"lg",children:"Authentication Required"})})}),S.jsx($e,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:S.jsx(K9e,{})})]}),S.jsx($e,{...y,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&S.jsx(Cp,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),S.jsxs($e,{...y,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&S.jsx(Y9e,{}),S.jsx(eWe,{})]}),S.jsx(tWe,{}),S.jsx(nWe,{isOpen:L!==null,onClose:()=>{D()},playerName:(L==null?void 0:L.playerName)||"Unknown Player",playerId:(L==null?void 0:L.playerId)||"Unknown ID",uid:L==null?void 0:L.uid}),S.jsx(rWe,{isVisible:B,onToggleVisibility:Y,spaceID:q}),S.jsx(GWe,{}),S.jsx($e,{position:"absolute",top:4,right:4,zIndex:1e3,children:Ct&&gt&&S.jsx(ZWe,{isOpen:Ct,onClose:on,portal:gt,spaceId:q})}),!Q&&Gt&&S.jsxs(Is,{isOpen:Gt,onClose:()=>{Xt(!1),at(),hn(""),jt("")},isCentered:!0,children:[S.jsx(Os,{bg:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)"}),S.jsxs(As,{bg:"#1a1a1a",borderRadius:"xl",border:"1px solid #333",maxW:"420px",p:0,children:[S.jsx(Jo,{fontSize:"md",fontWeight:"600",pb:1,pt:3,px:4,color:"white",textAlign:"center",children:st?`Visit ${st}?`:"Visit Space?"}),S.jsx($s,{color:"white",bg:"rgba(255,255,255,0.1)",_hover:{color:"gray.400",bg:"transparent"},borderRadius:"full",size:"sm",top:2,right:3}),S.jsx(Ps,{pb:8,pt:2,px:8,children:S.jsxs(Mi,{mt:4,gap:6,justify:"center",children:[S.jsx($n,{variant:"outline",borderColor:"whiteAlpha.400",color:"white",fontWeight:"bold",borderRadius:"2xl",px:10,py:6,fontSize:"lg",onClick:()=>{Xt(!1),at(),hn(""),jt("")},_hover:{bg:"whiteAlpha.100"},children:"Cancel"}),S.jsx($n,{colorScheme:"whiteAlpha",bg:"white",color:"#181818",fontWeight:"bold",borderRadius:"2xl",px:10,py:6,fontSize:"lg",onClick:async()=>{if(gt&&v){let St=null;if(gt.portalId){const ve=gt.portalId.split("_");ve.length>=3&&(St=ve[2])}await J(ho.UNITY.PORTAL_NAVIGATE,{category:po.NAVIGATION,portalId:gt.portalId,targetSpaceId:St,sourceSpaceId:q,targetSpaceName:st,targetSpaceSlug:an,isEditMode:!1,navigationType:"confirmed",timestamp:new Date().toISOString()})}an&&window.open(`https://www.spacesmetaverse.com/w/${an}`,"_blank","noopener"),Xt(!1),at(),hn(""),jt("")},_hover:{bg:"gray.100"},children:"Visit"})]})})]})]}),S.jsx(nGe,{}),S.jsx(fGe,{spaceID:q,isVisible:!pe&&v})]})})]})});VF.displayName="WebGLRenderer";VF.propTypes={settings:Nn.shape({urlLoadingBackground:Nn.string,videoBackgroundUrl:Nn.string,showAuthButton:Nn.bool,showDisruptiveLogo:Nn.bool,urlDisruptiveLogo:Nn.string,showHelpButton:Nn.bool,enableVoiceChat:Nn.bool,spaceID:Nn.string})};typeof window<"u"&&!window.MultipleView&&(window.MultipleView=class{constructor(){this.multiView={getPlayer:()=>({isPlaying:!1,play:()=>!0,pause:()=>!0,mute:e=>!0,isMuted:!1,seek:e=>!0,setVolume:e=>!0,getVolume:()=>1,getCurrentTime:()=>0,getDuration:()=>100}),initialize:()=>!0,setUnityContext:e=>(window.hisPlayerContextId=e,!0),release:()=>!0,setProperties:e=>!0,setMultiPaths:e=>(window._hisplayer_paths=e,!0)}}});if(typeof window<"u"&&!window._hisPlayerInitialized){if(H.log("WebGLLoader: Initializing HISPlayer functions"),window._hisPlayerInitialized=!0,window._hisplayer_event_queue=window._hisplayer_event_queue||[],window._hisplayer_error_queue=window._hisplayer_error_queue||[],!document.getElementById("hisplayer-error")){const n=document.createElement("div");n.id="hisplayer-error",n.style.position="absolute",n.style.top="10px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.color="red",n.style.zIndex="9999",document.body.appendChild(n),H.log("WebGLLoader: Created hisplayer-error div")}window.isErrorQueueEmpty=window.isErrorQueueEmpty||function(){return window._hisplayer_error_queue.length===0},window.getNextError=window.getNextError||function(){return window._hisplayer_error_queue.length>0?window._hisplayer_error_queue.shift():""},window.isEventQueueEmpty=window.isEventQueueEmpty||function(){return window._hisplayer_event_queue.length===0},window.getNextEvent=window.getNextEvent||function(){return window._hisplayer_event_queue.length>0?window._hisplayer_event_queue.shift():""},window.setUpContext=window.setUpContext||function(n){window.hisPlayerContextId=n;try{if(window.MultipleView){const e=new window.MultipleView;if(e&&e.multiView&&typeof e.multiView.setUnityContext=="function")return e.multiView.setUnityContext(n),window._hisplayer_instance=e,!0;console.error("HISPlayer: Player initialization failed - missing expected methods")}else{console.error("HISPlayer: MultipleView class not found"),window.MultipleView=class{constructor(){this.multiView={getPlayer:()=>({isPlaying:!1,play:()=>!0,pause:()=>!0,mute:()=>!0,isMuted:!1,seek:()=>!0,setVolume:()=>!0,getVolume:()=>1,getCurrentTime:()=>0,getDuration:()=>100}),initialize:()=>!0,setUnityContext:o=>(window.hisPlayerContextId=o,!0),release:()=>!0,setProperties:()=>!0,setMultiPaths:()=>!0}}};const e=new window.MultipleView;return e.multiView.setUnityContext(n),window._hisplayer_instance=e,!0}}catch(e){console.error("HISPlayer: Error in setUpContext:",e);const i=document.getElementById("hisplayer-error");i&&(i.textContent="Error: "+e.message)}return!1}}const jae=({spaceID:n,overrideSettings:e})=>{const i=k.useRef(null),[o,l]=k.useState(!0),{loading:u,isUserBannedFromSpace:f,user:y}=k.useContext(ls),[v,b]=k.useState(!1),[C,R]=k.useState(!1),[O,L]=k.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[D,U]=k.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",videoBackgroundUrl:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return k.useEffect(()=>{if(u)return;(async()=>{const Y=y?300:800;await new Promise(W=>setTimeout(W,Y));try{const W=await mo(n);if(W){if(!y&&(!W.allowGuestUsers||W.allowGuestUsers!==!0)){R(!0),l(!1);return}else(!y&&W.allowGuestUsers===!0||y)&&R(!1);L(me=>({...me,spaceID:n,loaderUrl:W.loaderUrl,dataUrl:W.dataUrl,frameworkUrl:W.frameworkUrl,codeUrl:W.codeUrl}));const ne=await GO(D.urlDisruptiveLogo);let le="";if(W.backgroundUrl)le=W.backgroundUrl;else if(W.backgroundGsUrl)try{le=await GO(W.backgroundGsUrl)}catch(me){H.warn("WebGLLoader: Error fetching background from GS URL:",me)}else if(W.gsUrlLoadingBackground)try{le=await GO(W.gsUrlLoadingBackground)}catch(me){H.warn("WebGLLoader: Error fetching background from legacy GS URL:",me)}let re="";W.videoBackgroundUrl&&(re=W.videoBackgroundUrl),U(me=>({...me,urlLoadingBackground:le,videoBackgroundUrl:re,showAuthButton:W.showAuthButton!==void 0?W.showAuthButton:!0,showDisruptiveLogo:W.showDisruptiveLogo!==void 0?W.showDisruptiveLogo:!0,showHelpButton:W.showHelpButton!==void 0?W.showHelpButton:!0,enableVoiceChat:W.enableVoiceChat!==void 0?W.enableVoiceChat:!0,urlDisruptiveLogo:ne,spaceID:n,...e||{}})),re&&window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:re}})),l(!1)}else H.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(W){H.error("WebGLLoader: Error fetching space data:",W)}finally{l(!1)}})()},[n,D.urlDisruptiveLogo,e,y,u]),k.useEffect(()=>{(async()=>{if(!u&&y&&f)try{const Y=await f(n);b(Y)}catch(Y){H.error("WebGLLoader: ban check error",Y)}})()},[u,y,n,f]),k.useEffect(()=>{o||(H.log("WebGLLoader: Unity config from Firebase",O),H.log("WebGLLoader: Space settings from Firebase",D))},[o]),u?S.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Loading user"}):v?S.jsx("div",{className:"flex justify-center items-center h-full mt-12 text-red-500",children:"Access Denied: You have been banned from this space."}):C?S.jsx($e,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0, 0, 0, 0.8)",zIndex:"1000",children:S.jsx(wR,{mode:"button",label:"Sign In Required",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}):n?S.jsx(S.Fragment,{children:o?S.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):S.jsx(i9e,{...O,children:S.jsx(VF,{ref:i,settings:D})})}):null};jae.propTypes={spaceID:Nn.string.isRequired,overrideSettings:Nn.object};function gZ(){const n=document.getElementById("webgl-root");if(n){const e=n.getAttribute("data-space-id"),i=n.getAttribute("data-theme")||"default",o=()=>{const[l,u]=k.useState(null);return k.useEffect(()=>{HUe(i).then(u)},[]),l?S.jsx(FNe,{theme:l,children:S.jsx(aze,{children:S.jsx(cze,{children:S.jsx(jae,{spaceID:e})})})}):S.jsx("div",{children:"Loading theme..."})};try{REe.createRoot(n).render(S.jsx(o,{}))}catch(l){console.warn("Error initializing WebGL:",l)}}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",gZ):gZ());export{BEe as a,pSe as b,Qi as c,uSe as d,vGe as e,EGe as f,nSe as g,ad as i,Tp as m,dIe as t};
