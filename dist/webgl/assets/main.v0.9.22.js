function Kge(r,t){for(var s=0;s<t.length;s++){const a=t[s];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in r)){const d=Object.getOwnPropertyDescriptor(a,l);d&&Object.defineProperty(r,l,d.get?d:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}var eE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function u0(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var lM={exports:{}},Wb={},uM={exports:{}},pr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q7;function qge(){if(Q7)return pr;Q7=1;var r=Symbol.for("react.element"),t=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),f=Symbol.for("react.context"),E=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),T=Symbol.for("react.memo"),R=Symbol.for("react.lazy"),I=Symbol.iterator;function N(Te){return Te===null||typeof Te!="object"?null:(Te=I&&Te[I]||Te["@@iterator"],typeof Te=="function"?Te:null)}var F={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},j=Object.assign,G={};function H(Te,Se,Ae){this.props=Te,this.context=Se,this.refs=G,this.updater=Ae||F}H.prototype.isReactComponent={},H.prototype.setState=function(Te,Se){if(typeof Te!="object"&&typeof Te!="function"&&Te!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Te,Se,"setState")},H.prototype.forceUpdate=function(Te){this.updater.enqueueForceUpdate(this,Te,"forceUpdate")};function te(){}te.prototype=H.prototype;function K(Te,Se,Ae){this.props=Te,this.context=Se,this.refs=G,this.updater=Ae||F}var ee=K.prototype=new te;ee.constructor=K,j(ee,H.prototype),ee.isPureReactComponent=!0;var de=Array.isArray,se=Object.prototype.hasOwnProperty,ge={current:null},Z={key:!0,ref:!0,__self:!0,__source:!0};function Q(Te,Se,Ae){var Ue,ze={},et=null,nt=null;if(Se!=null)for(Ue in Se.ref!==void 0&&(nt=Se.ref),Se.key!==void 0&&(et=""+Se.key),Se)se.call(Se,Ue)&&!Z.hasOwnProperty(Ue)&&(ze[Ue]=Se[Ue]);var dt=arguments.length-2;if(dt===1)ze.children=Ae;else if(1<dt){for(var Xe=Array(dt),Ct=0;Ct<dt;Ct++)Xe[Ct]=arguments[Ct+2];ze.children=Xe}if(Te&&Te.defaultProps)for(Ue in dt=Te.defaultProps,dt)ze[Ue]===void 0&&(ze[Ue]=dt[Ue]);return{$$typeof:r,type:Te,key:et,ref:nt,props:ze,_owner:ge.current}}function ne(Te,Se){return{$$typeof:r,type:Te.type,key:Se,ref:Te.ref,props:Te.props,_owner:Te._owner}}function oe(Te){return typeof Te=="object"&&Te!==null&&Te.$$typeof===r}function pe(Te){var Se={"=":"=0",":":"=2"};return"$"+Te.replace(/[=:]/g,function(Ae){return Se[Ae]})}var he=/\/+/g;function le(Te,Se){return typeof Te=="object"&&Te!==null&&Te.key!=null?pe(""+Te.key):Se.toString(36)}function Me(Te,Se,Ae,Ue,ze){var et=typeof Te;(et==="undefined"||et==="boolean")&&(Te=null);var nt=!1;if(Te===null)nt=!0;else switch(et){case"string":case"number":nt=!0;break;case"object":switch(Te.$$typeof){case r:case t:nt=!0}}if(nt)return nt=Te,ze=ze(nt),Te=Ue===""?"."+le(nt,0):Ue,de(ze)?(Ae="",Te!=null&&(Ae=Te.replace(he,"$&/")+"/"),Me(ze,Se,Ae,"",function(Ct){return Ct})):ze!=null&&(oe(ze)&&(ze=ne(ze,Ae+(!ze.key||nt&&nt.key===ze.key?"":(""+ze.key).replace(he,"$&/")+"/")+Te)),Se.push(ze)),1;if(nt=0,Ue=Ue===""?".":Ue+":",de(Te))for(var dt=0;dt<Te.length;dt++){et=Te[dt];var Xe=Ue+le(et,dt);nt+=Me(et,Se,Ae,Xe,ze)}else if(Xe=N(Te),typeof Xe=="function")for(Te=Xe.call(Te),dt=0;!(et=Te.next()).done;)et=et.value,Xe=Ue+le(et,dt++),nt+=Me(et,Se,Ae,Xe,ze);else if(et==="object")throw Se=String(Te),Error("Objects are not valid as a React child (found: "+(Se==="[object Object]"?"object with keys {"+Object.keys(Te).join(", ")+"}":Se)+"). If you meant to render a collection of children, use an array instead.");return nt}function He(Te,Se,Ae){if(Te==null)return Te;var Ue=[],ze=0;return Me(Te,Ue,"","",function(et){return Se.call(Ae,et,ze++)}),Ue}function rt(Te){if(Te._status===-1){var Se=Te._result;Se=Se(),Se.then(function(Ae){(Te._status===0||Te._status===-1)&&(Te._status=1,Te._result=Ae)},function(Ae){(Te._status===0||Te._status===-1)&&(Te._status=2,Te._result=Ae)}),Te._status===-1&&(Te._status=0,Te._result=Se)}if(Te._status===1)return Te._result.default;throw Te._result}var we={current:null},Ce={transition:null},ye={ReactCurrentDispatcher:we,ReactCurrentBatchConfig:Ce,ReactCurrentOwner:ge};function Ne(){throw Error("act(...) is not supported in production builds of React.")}return pr.Children={map:He,forEach:function(Te,Se,Ae){He(Te,function(){Se.apply(this,arguments)},Ae)},count:function(Te){var Se=0;return He(Te,function(){Se++}),Se},toArray:function(Te){return He(Te,function(Se){return Se})||[]},only:function(Te){if(!oe(Te))throw Error("React.Children.only expected to receive a single React element child.");return Te}},pr.Component=H,pr.Fragment=s,pr.Profiler=l,pr.PureComponent=K,pr.StrictMode=a,pr.Suspense=v,pr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ye,pr.act=Ne,pr.cloneElement=function(Te,Se,Ae){if(Te==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Te+".");var Ue=j({},Te.props),ze=Te.key,et=Te.ref,nt=Te._owner;if(Se!=null){if(Se.ref!==void 0&&(et=Se.ref,nt=ge.current),Se.key!==void 0&&(ze=""+Se.key),Te.type&&Te.type.defaultProps)var dt=Te.type.defaultProps;for(Xe in Se)se.call(Se,Xe)&&!Z.hasOwnProperty(Xe)&&(Ue[Xe]=Se[Xe]===void 0&&dt!==void 0?dt[Xe]:Se[Xe])}var Xe=arguments.length-2;if(Xe===1)Ue.children=Ae;else if(1<Xe){dt=Array(Xe);for(var Ct=0;Ct<Xe;Ct++)dt[Ct]=arguments[Ct+2];Ue.children=dt}return{$$typeof:r,type:Te.type,key:ze,ref:et,props:Ue,_owner:nt}},pr.createContext=function(Te){return Te={$$typeof:f,_currentValue:Te,_currentValue2:Te,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Te.Provider={$$typeof:d,_context:Te},Te.Consumer=Te},pr.createElement=Q,pr.createFactory=function(Te){var Se=Q.bind(null,Te);return Se.type=Te,Se},pr.createRef=function(){return{current:null}},pr.forwardRef=function(Te){return{$$typeof:E,render:Te}},pr.isValidElement=oe,pr.lazy=function(Te){return{$$typeof:R,_payload:{_status:-1,_result:Te},_init:rt}},pr.memo=function(Te,Se){return{$$typeof:T,type:Te,compare:Se===void 0?null:Se}},pr.startTransition=function(Te){var Se=Ce.transition;Ce.transition={};try{Te()}finally{Ce.transition=Se}},pr.unstable_act=Ne,pr.useCallback=function(Te,Se){return we.current.useCallback(Te,Se)},pr.useContext=function(Te){return we.current.useContext(Te)},pr.useDebugValue=function(){},pr.useDeferredValue=function(Te){return we.current.useDeferredValue(Te)},pr.useEffect=function(Te,Se){return we.current.useEffect(Te,Se)},pr.useId=function(){return we.current.useId()},pr.useImperativeHandle=function(Te,Se,Ae){return we.current.useImperativeHandle(Te,Se,Ae)},pr.useInsertionEffect=function(Te,Se){return we.current.useInsertionEffect(Te,Se)},pr.useLayoutEffect=function(Te,Se){return we.current.useLayoutEffect(Te,Se)},pr.useMemo=function(Te,Se){return we.current.useMemo(Te,Se)},pr.useReducer=function(Te,Se,Ae){return we.current.useReducer(Te,Se,Ae)},pr.useRef=function(Te){return we.current.useRef(Te)},pr.useState=function(Te){return we.current.useState(Te)},pr.useSyncExternalStore=function(Te,Se,Ae){return we.current.useSyncExternalStore(Te,Se,Ae)},pr.useTransition=function(){return we.current.useTransition()},pr.version="18.3.1",pr}var Z7;function bu(){return Z7||(Z7=1,uM.exports=qge()),uM.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var e$;function Yge(){if(e$)return Wb;e$=1;var r=bu(),t=Symbol.for("react.element"),s=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function f(E,v,T){var R,I={},N=null,F=null;T!==void 0&&(N=""+T),v.key!==void 0&&(N=""+v.key),v.ref!==void 0&&(F=v.ref);for(R in v)a.call(v,R)&&!d.hasOwnProperty(R)&&(I[R]=v[R]);if(E&&E.defaultProps)for(R in v=E.defaultProps,v)I[R]===void 0&&(I[R]=v[R]);return{$$typeof:t,type:E,key:N,ref:F,props:I,_owner:l.current}}return Wb.Fragment=s,Wb.jsx=f,Wb.jsxs=f,Wb}var t$;function Xge(){return t$||(t$=1,lM.exports=Yge()),lM.exports}var P=Xge(),L=bu();const ni=u0(L),n$=Kge({__proto__:null,default:ni},[L]);var VP={},dM={exports:{}},Vc={},hM={exports:{}},pM={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r$;function Jge(){return r$||(r$=1,function(r){function t(Ce,ye){var Ne=Ce.length;Ce.push(ye);e:for(;0<Ne;){var Te=Ne-1>>>1,Se=Ce[Te];if(0<l(Se,ye))Ce[Te]=ye,Ce[Ne]=Se,Ne=Te;else break e}}function s(Ce){return Ce.length===0?null:Ce[0]}function a(Ce){if(Ce.length===0)return null;var ye=Ce[0],Ne=Ce.pop();if(Ne!==ye){Ce[0]=Ne;e:for(var Te=0,Se=Ce.length,Ae=Se>>>1;Te<Ae;){var Ue=2*(Te+1)-1,ze=Ce[Ue],et=Ue+1,nt=Ce[et];if(0>l(ze,Ne))et<Se&&0>l(nt,ze)?(Ce[Te]=nt,Ce[et]=Ne,Te=et):(Ce[Te]=ze,Ce[Ue]=Ne,Te=Ue);else if(et<Se&&0>l(nt,Ne))Ce[Te]=nt,Ce[et]=Ne,Te=et;else break e}}return ye}function l(Ce,ye){var Ne=Ce.sortIndex-ye.sortIndex;return Ne!==0?Ne:Ce.id-ye.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;r.unstable_now=function(){return d.now()}}else{var f=Date,E=f.now();r.unstable_now=function(){return f.now()-E}}var v=[],T=[],R=1,I=null,N=3,F=!1,j=!1,G=!1,H=typeof setTimeout=="function"?setTimeout:null,te=typeof clearTimeout=="function"?clearTimeout:null,K=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ee(Ce){for(var ye=s(T);ye!==null;){if(ye.callback===null)a(T);else if(ye.startTime<=Ce)a(T),ye.sortIndex=ye.expirationTime,t(v,ye);else break;ye=s(T)}}function de(Ce){if(G=!1,ee(Ce),!j)if(s(v)!==null)j=!0,rt(se);else{var ye=s(T);ye!==null&&we(de,ye.startTime-Ce)}}function se(Ce,ye){j=!1,G&&(G=!1,te(Q),Q=-1),F=!0;var Ne=N;try{for(ee(ye),I=s(v);I!==null&&(!(I.expirationTime>ye)||Ce&&!pe());){var Te=I.callback;if(typeof Te=="function"){I.callback=null,N=I.priorityLevel;var Se=Te(I.expirationTime<=ye);ye=r.unstable_now(),typeof Se=="function"?I.callback=Se:I===s(v)&&a(v),ee(ye)}else a(v);I=s(v)}if(I!==null)var Ae=!0;else{var Ue=s(T);Ue!==null&&we(de,Ue.startTime-ye),Ae=!1}return Ae}finally{I=null,N=Ne,F=!1}}var ge=!1,Z=null,Q=-1,ne=5,oe=-1;function pe(){return!(r.unstable_now()-oe<ne)}function he(){if(Z!==null){var Ce=r.unstable_now();oe=Ce;var ye=!0;try{ye=Z(!0,Ce)}finally{ye?le():(ge=!1,Z=null)}}else ge=!1}var le;if(typeof K=="function")le=function(){K(he)};else if(typeof MessageChannel<"u"){var Me=new MessageChannel,He=Me.port2;Me.port1.onmessage=he,le=function(){He.postMessage(null)}}else le=function(){H(he,0)};function rt(Ce){Z=Ce,ge||(ge=!0,le())}function we(Ce,ye){Q=H(function(){Ce(r.unstable_now())},ye)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(Ce){Ce.callback=null},r.unstable_continueExecution=function(){j||F||(j=!0,rt(se))},r.unstable_forceFrameRate=function(Ce){0>Ce||125<Ce?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ne=0<Ce?Math.floor(1e3/Ce):5},r.unstable_getCurrentPriorityLevel=function(){return N},r.unstable_getFirstCallbackNode=function(){return s(v)},r.unstable_next=function(Ce){switch(N){case 1:case 2:case 3:var ye=3;break;default:ye=N}var Ne=N;N=ye;try{return Ce()}finally{N=Ne}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(Ce,ye){switch(Ce){case 1:case 2:case 3:case 4:case 5:break;default:Ce=3}var Ne=N;N=Ce;try{return ye()}finally{N=Ne}},r.unstable_scheduleCallback=function(Ce,ye,Ne){var Te=r.unstable_now();switch(typeof Ne=="object"&&Ne!==null?(Ne=Ne.delay,Ne=typeof Ne=="number"&&0<Ne?Te+Ne:Te):Ne=Te,Ce){case 1:var Se=-1;break;case 2:Se=250;break;case 5:Se=1073741823;break;case 4:Se=1e4;break;default:Se=5e3}return Se=Ne+Se,Ce={id:R++,callback:ye,priorityLevel:Ce,startTime:Ne,expirationTime:Se,sortIndex:-1},Ne>Te?(Ce.sortIndex=Ne,t(T,Ce),s(v)===null&&Ce===s(T)&&(G?(te(Q),Q=-1):G=!0,we(de,Ne-Te))):(Ce.sortIndex=Se,t(v,Ce),j||F||(j=!0,rt(se))),Ce},r.unstable_shouldYield=pe,r.unstable_wrapCallback=function(Ce){var ye=N;return function(){var Ne=N;N=ye;try{return Ce.apply(this,arguments)}finally{N=Ne}}}}(pM)),pM}var i$;function Qge(){return i$||(i$=1,hM.exports=Jge()),hM.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s$;function Zge(){if(s$)return Vc;s$=1;var r=bu(),t=Qge();function s(p){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+p,b=1;b<arguments.length;b++)g+="&args[]="+encodeURIComponent(arguments[b]);return"Minified React error #"+p+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function d(p,g){f(p,g),f(p+"Capture",g)}function f(p,g){for(l[p]=g,p=0;p<g.length;p++)a.add(g[p])}var E=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,T=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,R={},I={};function N(p){return v.call(I,p)?!0:v.call(R,p)?!1:T.test(p)?I[p]=!0:(R[p]=!0,!1)}function F(p,g,b,O){if(b!==null&&b.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return O?!1:b!==null?!b.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function j(p,g,b,O){if(g===null||typeof g>"u"||F(p,g,b,O))return!0;if(O)return!1;if(b!==null)switch(b.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function G(p,g,b,O,M,z,ae){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=O,this.attributeNamespace=M,this.mustUseProperty=b,this.propertyName=p,this.type=g,this.sanitizeURL=z,this.removeEmptyString=ae}var H={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){H[p]=new G(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var g=p[0];H[g]=new G(g,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){H[p]=new G(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){H[p]=new G(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){H[p]=new G(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){H[p]=new G(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){H[p]=new G(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){H[p]=new G(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){H[p]=new G(p,5,!1,p.toLowerCase(),null,!1,!1)});var te=/[\-:]([a-z])/g;function K(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var g=p.replace(te,K);H[g]=new G(g,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var g=p.replace(te,K);H[g]=new G(g,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var g=p.replace(te,K);H[g]=new G(g,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){H[p]=new G(p,1,!1,p.toLowerCase(),null,!1,!1)}),H.xlinkHref=new G("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){H[p]=new G(p,1,!1,p.toLowerCase(),null,!0,!0)});function ee(p,g,b,O){var M=H.hasOwnProperty(g)?H[g]:null;(M!==null?M.type!==0:O||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(j(g,b,M,O)&&(b=null),O||M===null?N(g)&&(b===null?p.removeAttribute(g):p.setAttribute(g,""+b)):M.mustUseProperty?p[M.propertyName]=b===null?M.type===3?!1:"":b:(g=M.attributeName,O=M.attributeNamespace,b===null?p.removeAttribute(g):(M=M.type,b=M===3||M===4&&b===!0?"":""+b,O?p.setAttributeNS(O,g,b):p.setAttribute(g,b))))}var de=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,se=Symbol.for("react.element"),ge=Symbol.for("react.portal"),Z=Symbol.for("react.fragment"),Q=Symbol.for("react.strict_mode"),ne=Symbol.for("react.profiler"),oe=Symbol.for("react.provider"),pe=Symbol.for("react.context"),he=Symbol.for("react.forward_ref"),le=Symbol.for("react.suspense"),Me=Symbol.for("react.suspense_list"),He=Symbol.for("react.memo"),rt=Symbol.for("react.lazy"),we=Symbol.for("react.offscreen"),Ce=Symbol.iterator;function ye(p){return p===null||typeof p!="object"?null:(p=Ce&&p[Ce]||p["@@iterator"],typeof p=="function"?p:null)}var Ne=Object.assign,Te;function Se(p){if(Te===void 0)try{throw Error()}catch(b){var g=b.stack.trim().match(/\n( *(at )?)/);Te=g&&g[1]||""}return`
`+Te+p}var Ae=!1;function Ue(p,g){if(!p||Ae)return"";Ae=!0;var b=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(it){var O=it}Reflect.construct(p,[],g)}else{try{g.call()}catch(it){O=it}p.call(g.prototype)}else{try{throw Error()}catch(it){O=it}p()}}catch(it){if(it&&O&&typeof it.stack=="string"){for(var M=it.stack.split(`
`),z=O.stack.split(`
`),ae=M.length-1,Ie=z.length-1;1<=ae&&0<=Ie&&M[ae]!==z[Ie];)Ie--;for(;1<=ae&&0<=Ie;ae--,Ie--)if(M[ae]!==z[Ie]){if(ae!==1||Ie!==1)do if(ae--,Ie--,0>Ie||M[ae]!==z[Ie]){var xe=`
`+M[ae].replace(" at new "," at ");return p.displayName&&xe.includes("<anonymous>")&&(xe=xe.replace("<anonymous>",p.displayName)),xe}while(1<=ae&&0<=Ie);break}}}finally{Ae=!1,Error.prepareStackTrace=b}return(p=p?p.displayName||p.name:"")?Se(p):""}function ze(p){switch(p.tag){case 5:return Se(p.type);case 16:return Se("Lazy");case 13:return Se("Suspense");case 19:return Se("SuspenseList");case 0:case 2:case 15:return p=Ue(p.type,!1),p;case 11:return p=Ue(p.type.render,!1),p;case 1:return p=Ue(p.type,!0),p;default:return""}}function et(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case Z:return"Fragment";case ge:return"Portal";case ne:return"Profiler";case Q:return"StrictMode";case le:return"Suspense";case Me:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case pe:return(p.displayName||"Context")+".Consumer";case oe:return(p._context.displayName||"Context")+".Provider";case he:var g=p.render;return p=p.displayName,p||(p=g.displayName||g.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case He:return g=p.displayName||null,g!==null?g:et(p.type)||"Memo";case rt:g=p._payload,p=p._init;try{return et(p(g))}catch{}}return null}function nt(p){var g=p.type;switch(p.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=g.render,p=p.displayName||p.name||"",g.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return et(g);case 8:return g===Q?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function dt(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function Xe(p){var g=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function Ct(p){var g=Xe(p)?"checked":"value",b=Object.getOwnPropertyDescriptor(p.constructor.prototype,g),O=""+p[g];if(!p.hasOwnProperty(g)&&typeof b<"u"&&typeof b.get=="function"&&typeof b.set=="function"){var M=b.get,z=b.set;return Object.defineProperty(p,g,{configurable:!0,get:function(){return M.call(this)},set:function(ae){O=""+ae,z.call(this,ae)}}),Object.defineProperty(p,g,{enumerable:b.enumerable}),{getValue:function(){return O},setValue:function(ae){O=""+ae},stopTracking:function(){p._valueTracker=null,delete p[g]}}}}function dn(p){p._valueTracker||(p._valueTracker=Ct(p))}function Ut(p){if(!p)return!1;var g=p._valueTracker;if(!g)return!0;var b=g.getValue(),O="";return p&&(O=Xe(p)?p.checked?"true":"false":p.value),p=O,p!==b?(g.setValue(p),!0):!1}function ln(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function Ln(p,g){var b=g.checked;return Ne({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:b??p._wrapperState.initialChecked})}function qt(p,g){var b=g.defaultValue==null?"":g.defaultValue,O=g.checked!=null?g.checked:g.defaultChecked;b=dt(g.value!=null?g.value:b),p._wrapperState={initialChecked:O,initialValue:b,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function Yn(p,g){g=g.checked,g!=null&&ee(p,"checked",g,!1)}function $t(p,g){Yn(p,g);var b=dt(g.value),O=g.type;if(b!=null)O==="number"?(b===0&&p.value===""||p.value!=b)&&(p.value=""+b):p.value!==""+b&&(p.value=""+b);else if(O==="submit"||O==="reset"){p.removeAttribute("value");return}g.hasOwnProperty("value")?Fe(p,g.type,b):g.hasOwnProperty("defaultValue")&&Fe(p,g.type,dt(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(p.defaultChecked=!!g.defaultChecked)}function Re(p,g,b){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var O=g.type;if(!(O!=="submit"&&O!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+p._wrapperState.initialValue,b||g===p.value||(p.value=g),p.defaultValue=g}b=p.name,b!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,b!==""&&(p.name=b)}function Fe(p,g,b){(g!=="number"||ln(p.ownerDocument)!==p)&&(b==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+b&&(p.defaultValue=""+b))}var Ke=Array.isArray;function _t(p,g,b,O){if(p=p.options,g){g={};for(var M=0;M<b.length;M++)g["$"+b[M]]=!0;for(b=0;b<p.length;b++)M=g.hasOwnProperty("$"+p[b].value),p[b].selected!==M&&(p[b].selected=M),M&&O&&(p[b].defaultSelected=!0)}else{for(b=""+dt(b),g=null,M=0;M<p.length;M++){if(p[M].value===b){p[M].selected=!0,O&&(p[M].defaultSelected=!0);return}g!==null||p[M].disabled||(g=p[M])}g!==null&&(g.selected=!0)}}function yt(p,g){if(g.dangerouslySetInnerHTML!=null)throw Error(s(91));return Ne({},g,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function Ge(p,g){var b=g.value;if(b==null){if(b=g.children,g=g.defaultValue,b!=null){if(g!=null)throw Error(s(92));if(Ke(b)){if(1<b.length)throw Error(s(93));b=b[0]}g=b}g==null&&(g=""),b=g}p._wrapperState={initialValue:dt(b)}}function Pt(p,g){var b=dt(g.value),O=dt(g.defaultValue);b!=null&&(b=""+b,b!==p.value&&(p.value=b),g.defaultValue==null&&p.defaultValue!==b&&(p.defaultValue=b)),O!=null&&(p.defaultValue=""+O)}function Yt(p){var g=p.textContent;g===p._wrapperState.initialValue&&g!==""&&g!==null&&(p.value=g)}function hn(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function an(p,g){return p==null||p==="http://www.w3.org/1999/xhtml"?hn(g):p==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var ir,na=function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,b,O,M){MSApp.execUnsafeLocalFunction(function(){return p(g,b,O,M)})}:p}(function(p,g){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=g;else{for(ir=ir||document.createElement("div"),ir.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=ir.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;g.firstChild;)p.appendChild(g.firstChild)}});function Vt(p,g){if(g){var b=p.firstChild;if(b&&b===p.lastChild&&b.nodeType===3){b.nodeValue=g;return}}p.textContent=g}var sn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},wi=["Webkit","ms","Moz","O"];Object.keys(sn).forEach(function(p){wi.forEach(function(g){g=g+p.charAt(0).toUpperCase()+p.substring(1),sn[g]=sn[p]})});function di(p,g,b){return g==null||typeof g=="boolean"||g===""?"":b||typeof g!="number"||g===0||sn.hasOwnProperty(p)&&sn[p]?(""+g).trim():g+"px"}function yi(p,g){p=p.style;for(var b in g)if(g.hasOwnProperty(b)){var O=b.indexOf("--")===0,M=di(b,g[b],O);b==="float"&&(b="cssFloat"),O?p.setProperty(b,M):p[b]=M}}var ur=Ne({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Da(p,g){if(g){if(ur[p]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(s(137,p));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(s(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(s(61))}if(g.style!=null&&typeof g.style!="object")throw Error(s(62))}}function Zc(p,g){if(p.indexOf("-")===-1)return typeof g.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var so=null;function oo(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var kl=null,xs=null,sc=null;function ra(p){if(p=Kf(p)){if(typeof kl!="function")throw Error(s(280));var g=p.stateNode;g&&(g=qf(g),kl(p.stateNode,p.type,g))}}function oc(p){xs?sc?sc.push(p):sc=[p]:xs=p}function el(){if(xs){var p=xs,g=sc;if(sc=xs=null,ra(p),g)for(p=0;p<g.length;p++)ra(g[p])}}function Ou(p,g){return p(g)}function ac(){}var tl=!1;function wo(p,g,b){if(tl)return p(g,b);tl=!0;try{return Ou(p,g,b)}finally{tl=!1,(xs!==null||sc!==null)&&(ac(),el())}}function Pi(p,g){var b=p.stateNode;if(b===null)return null;var O=qf(b);if(O===null)return null;b=O[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(O=!O.disabled)||(p=p.type,O=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!O;break e;default:p=!1}if(p)return null;if(b&&typeof b!="function")throw Error(s(231,g,typeof b));return b}var as=!1;if(E)try{var La={};Object.defineProperty(La,"passive",{get:function(){as=!0}}),window.addEventListener("test",La,La),window.removeEventListener("test",La,La)}catch{as=!1}function ku(p,g,b,O,M,z,ae,Ie,xe){var it=Array.prototype.slice.call(arguments,3);try{g.apply(b,it)}catch(It){this.onError(It)}}var cc=!1,ia=null,sa=!1,Od=null,Rg={onError:function(p){cc=!0,ia=p}};function Nu(p,g,b,O,M,z,ae,Ie,xe){cc=!1,ia=null,ku.apply(Rg,arguments)}function tp(p,g,b,O,M,z,ae,Ie,xe){if(Nu.apply(this,arguments),cc){if(cc){var it=ia;cc=!1,ia=null}else throw Error(s(198));sa||(sa=!0,Od=it)}}function Ms(p){var g=p,b=p;if(p.alternate)for(;g.return;)g=g.return;else{p=g;do g=p,(g.flags&4098)!==0&&(b=g.return),p=g.return;while(p)}return g.tag===3?b:null}function Du(p){if(p.tag===13){var g=p.memoizedState;if(g===null&&(p=p.alternate,p!==null&&(g=p.memoizedState)),g!==null)return g.dehydrated}return null}function oa(p){if(Ms(p)!==p)throw Error(s(188))}function kd(p){var g=p.alternate;if(!g){if(g=Ms(p),g===null)throw Error(s(188));return g!==p?null:p}for(var b=p,O=g;;){var M=b.return;if(M===null)break;var z=M.alternate;if(z===null){if(O=M.return,O!==null){b=O;continue}break}if(M.child===z.child){for(z=M.child;z;){if(z===b)return oa(M),p;if(z===O)return oa(M),g;z=z.sibling}throw Error(s(188))}if(b.return!==O.return)b=M,O=z;else{for(var ae=!1,Ie=M.child;Ie;){if(Ie===b){ae=!0,b=M,O=z;break}if(Ie===O){ae=!0,O=M,b=z;break}Ie=Ie.sibling}if(!ae){for(Ie=z.child;Ie;){if(Ie===b){ae=!0,b=z,O=M;break}if(Ie===O){ae=!0,O=z,b=M;break}Ie=Ie.sibling}if(!ae)throw Error(s(189))}}if(b.alternate!==O)throw Error(s(190))}if(b.tag!==3)throw Error(s(188));return b.stateNode.current===b?p:g}function Nd(p){return p=kd(p),p!==null?xa(p):null}function xa(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var g=xa(p);if(g!==null)return g;p=p.sibling}return null}var Dd=t.unstable_scheduleCallback,Lu=t.unstable_cancelCallback,Ro=t.unstable_shouldYield,Ld=t.unstable_requestPaint,Fr=t.unstable_now,hi=t.unstable_getCurrentPriorityLevel,lc=t.unstable_ImmediatePriority,nl=t.unstable_UserBlockingPriority,aa=t.unstable_NormalPriority,np=t.unstable_LowPriority,xd=t.unstable_IdlePriority,Nl=null,ao=null;function Nf(p){if(ao&&typeof ao.onCommitFiberRoot=="function")try{ao.onCommitFiberRoot(Nl,p,void 0,(p.current.flags&128)===128)}catch{}}var Hs=Math.clz32?Math.clz32:Md,rp=Math.log,rl=Math.LN2;function Md(p){return p>>>=0,p===0?32:31-(rp(p)/rl|0)|0}var Ud=64,dr=4194304;function Dl(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function Ll(p,g){var b=p.pendingLanes;if(b===0)return 0;var O=0,M=p.suspendedLanes,z=p.pingedLanes,ae=b&268435455;if(ae!==0){var Ie=ae&~M;Ie!==0?O=Dl(Ie):(z&=ae,z!==0&&(O=Dl(z)))}else ae=b&~M,ae!==0?O=Dl(ae):z!==0&&(O=Dl(z));if(O===0)return 0;if(g!==0&&g!==O&&(g&M)===0&&(M=O&-O,z=g&-g,M>=z||M===16&&(z&4194240)!==0))return g;if((O&4)!==0&&(O|=b&16),g=p.entangledLanes,g!==0)for(p=p.entanglements,g&=O;0<g;)b=31-Hs(g),M=1<<b,O|=p[b],g&=~M;return O}function xu(p,g){switch(p){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ma(p,g){for(var b=p.suspendedLanes,O=p.pingedLanes,M=p.expirationTimes,z=p.pendingLanes;0<z;){var ae=31-Hs(z),Ie=1<<ae,xe=M[ae];xe===-1?((Ie&b)===0||(Ie&O)!==0)&&(M[ae]=xu(Ie,g)):xe<=g&&(p.expiredLanes|=Ie),z&=~Ie}}function Co(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function Mu(){var p=Ud;return Ud<<=1,(Ud&4194240)===0&&(Ud=64),p}function il(p){for(var g=[],b=0;31>b;b++)g.push(p);return g}function xl(p,g,b){p.pendingLanes|=g,g!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,g=31-Hs(g),p[g]=b}function zr(p,g){var b=p.pendingLanes&~g;p.pendingLanes=g,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=g,p.mutableReadLanes&=g,p.entangledLanes&=g,g=p.entanglements;var O=p.eventTimes;for(p=p.expirationTimes;0<b;){var M=31-Hs(b),z=1<<M;g[M]=0,O[M]=-1,p[M]=-1,b&=~z}}function Ua(p,g){var b=p.entangledLanes|=g;for(p=p.entanglements;b;){var O=31-Hs(b),M=1<<O;M&g|p[O]&g&&(p[O]|=g),b&=~M}}var nr=0;function uc(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var Df,Ml,Vd,ip,Lf,sp=!1,Io=[],Qi=null,Ao=null,Po=null,Ul=new Map,Oo=new Map,ko=[],xf="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function dc(p,g){switch(p){case"focusin":case"focusout":Qi=null;break;case"dragenter":case"dragleave":Ao=null;break;case"mouseover":case"mouseout":Po=null;break;case"pointerover":case"pointerout":Ul.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":Oo.delete(g.pointerId)}}function cs(p,g,b,O,M,z){return p===null||p.nativeEvent!==z?(p={blockedOn:g,domEventName:b,eventSystemFlags:O,nativeEvent:z,targetContainers:[M]},g!==null&&(g=Kf(g),g!==null&&Ml(g)),p):(p.eventSystemFlags|=O,g=p.targetContainers,M!==null&&g.indexOf(M)===-1&&g.push(M),p)}function Uu(p,g,b,O,M){switch(g){case"focusin":return Qi=cs(Qi,p,g,b,O,M),!0;case"dragenter":return Ao=cs(Ao,p,g,b,O,M),!0;case"mouseover":return Po=cs(Po,p,g,b,O,M),!0;case"pointerover":var z=M.pointerId;return Ul.set(z,cs(Ul.get(z)||null,p,g,b,O,M)),!0;case"gotpointercapture":return z=M.pointerId,Oo.set(z,cs(Oo.get(z)||null,p,g,b,O,M)),!0}return!1}function op(p){var g=fp(p.target);if(g!==null){var b=Ms(g);if(b!==null){if(g=b.tag,g===13){if(g=Du(b),g!==null){p.blockedOn=g,Lf(p.priority,function(){Vd(b)});return}}else if(g===3&&b.stateNode.current.memoizedState.isDehydrated){p.blockedOn=b.tag===3?b.stateNode.containerInfo:null;return}}}p.blockedOn=null}function sl(p){if(p.blockedOn!==null)return!1;for(var g=p.targetContainers;0<g.length;){var b=gr(p.domEventName,p.eventSystemFlags,g[0],p.nativeEvent);if(b===null){b=p.nativeEvent;var O=new b.constructor(b.type,b);so=O,b.target.dispatchEvent(O),so=null}else return g=Kf(b),g!==null&&Ml(g),p.blockedOn=b,!1;g.shift()}return!0}function Vl(p,g,b){sl(p)&&b.delete(g)}function Mf(){sp=!1,Qi!==null&&sl(Qi)&&(Qi=null),Ao!==null&&sl(Ao)&&(Ao=null),Po!==null&&sl(Po)&&(Po=null),Ul.forEach(Vl),Oo.forEach(Vl)}function ca(p,g){p.blockedOn===g&&(p.blockedOn=null,sp||(sp=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Mf)))}function la(p){function g(M){return ca(M,p)}if(0<Io.length){ca(Io[0],p);for(var b=1;b<Io.length;b++){var O=Io[b];O.blockedOn===p&&(O.blockedOn=null)}}for(Qi!==null&&ca(Qi,p),Ao!==null&&ca(Ao,p),Po!==null&&ca(Po,p),Ul.forEach(g),Oo.forEach(g),b=0;b<ko.length;b++)O=ko[b],O.blockedOn===p&&(O.blockedOn=null);for(;0<ko.length&&(b=ko[0],b.blockedOn===null);)op(b),b.blockedOn===null&&ko.shift()}var ol=de.ReactCurrentBatchConfig,ve=!0;function De(p,g,b,O){var M=nr,z=ol.transition;ol.transition=null;try{nr=1,Ht(p,g,b,O)}finally{nr=M,ol.transition=z}}function tt(p,g,b,O){var M=nr,z=ol.transition;ol.transition=null;try{nr=4,Ht(p,g,b,O)}finally{nr=M,ol.transition=z}}function Ht(p,g,b,O){if(ve){var M=gr(p,g,b,O);if(M===null)zE(p,g,O,Hn,b),dc(p,O);else if(Uu(M,p,g,b,O))O.stopPropagation();else if(dc(p,O),g&4&&-1<xf.indexOf(p)){for(;M!==null;){var z=Kf(M);if(z!==null&&Df(z),z=gr(p,g,b,O),z===null&&zE(p,g,O,Hn,b),z===M)break;M=z}M!==null&&O.stopPropagation()}else zE(p,g,O,null,b)}}var Hn=null;function gr(p,g,b,O){if(Hn=null,p=oo(O),p=fp(p),p!==null)if(g=Ms(p),g===null)p=null;else if(b=g.tag,b===13){if(p=Du(g),p!==null)return p;p=null}else if(b===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;p=null}else g!==p&&(p=null);return Hn=p,null}function jr(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(hi()){case lc:return 1;case nl:return 4;case aa:case np:return 16;case xd:return 536870912;default:return 16}default:return 16}}var cn=null,kr=null,pi=null;function Rs(){if(pi)return pi;var p,g=kr,b=g.length,O,M="value"in cn?cn.value:cn.textContent,z=M.length;for(p=0;p<b&&g[p]===M[p];p++);var ae=b-p;for(O=1;O<=ae&&g[b-O]===M[z-O];O++);return pi=M.slice(p,1<O?1-O:void 0)}function No(p){var g=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&g===13&&(p=13)):p=g,p===10&&(p=13),32<=p||p===13?p:0}function Do(){return!0}function Vu(){return!1}function zi(p){function g(b,O,M,z,ae){this._reactName=b,this._targetInst=M,this.type=O,this.nativeEvent=z,this.target=ae,this.currentTarget=null;for(var Ie in p)p.hasOwnProperty(Ie)&&(b=p[Ie],this[Ie]=b?b(z):z[Ie]);return this.isDefaultPrevented=(z.defaultPrevented!=null?z.defaultPrevented:z.returnValue===!1)?Do:Vu,this.isPropagationStopped=Vu,this}return Ne(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var b=this.nativeEvent;b&&(b.preventDefault?b.preventDefault():typeof b.returnValue!="unknown"&&(b.returnValue=!1),this.isDefaultPrevented=Do)},stopPropagation:function(){var b=this.nativeEvent;b&&(b.stopPropagation?b.stopPropagation():typeof b.cancelBubble!="unknown"&&(b.cancelBubble=!0),this.isPropagationStopped=Do)},persist:function(){},isPersistent:Do}),g}var al={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Fd=zi(al),hc=Ne({},al,{view:0,detail:0}),Cg=zi(hc),Uf,Fu,Lo,Fl=Ne({},hc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pc,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==Lo&&(Lo&&p.type==="mousemove"?(Uf=p.screenX-Lo.screenX,Fu=p.screenY-Lo.screenY):Fu=Uf=0,Lo=p),Uf)},movementY:function(p){return"movementY"in p?p.movementY:Fu}}),Vf=zi(Fl),Ig=Ne({},Fl,{dataTransfer:0}),xE=zi(Ig),Ff=Ne({},hc,{relatedTarget:0}),jf=zi(Ff),ju=Ne({},al,{animationName:0,elapsedTime:0,pseudoElement:0}),Bu=zi(ju),Wu=Ne({},al,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),Ag=zi(Wu),ME=Ne({},al,{data:0}),xn=zi(ME),Bf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xo={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},UE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function VE(p){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(p):(p=UE[p])?!!g[p]:!1}function pc(){return VE}var C=Ne({},hc,{key:function(p){if(p.key){var g=Bf[p.key]||p.key;if(g!=="Unidentified")return g}return p.type==="keypress"?(p=No(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?xo[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pc,charCode:function(p){return p.type==="keypress"?No(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?No(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),B=zi(C),J=Ne({},Fl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),fe=zi(J),qe=Ne({},hc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pc}),at=zi(qe),Lt=Ne({},al,{propertyName:0,elapsedTime:0,pseudoElement:0}),Gr=zi(Lt),ii=Ne({},Fl,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),_r=zi(ii),Us=[9,13,27,32],ls=E&&"CompositionEvent"in window,Va=null;E&&"documentMode"in document&&(Va=document.documentMode);var Mo=E&&"TextEvent"in window&&!Va,ap=E&&(!ls||Va&&8<Va&&11>=Va),Wf=" ",Fa=!1;function ZR(p,g){switch(p){case"keyup":return Us.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function eC(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var zf=!1;function VN(p,g){switch(p){case"compositionend":return eC(g);case"keypress":return g.which!==32?null:(Fa=!0,Wf);case"textInput":return p=g.data,p===Wf&&Fa?null:p;default:return null}}function tC(p,g){if(zf)return p==="compositionend"||!ls&&ZR(p,g)?(p=Rs(),pi=kr=cn=null,zf=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return ap&&g.locale!=="ko"?null:g.data;default:return null}}var FN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function nC(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g==="input"?!!FN[p.type]:g==="textarea"}function C0(p,g,b,O){oc(O),g=GE(g,"onChange"),0<g.length&&(b=new Fd("onChange","change",null,b,O),p.push({event:b,listeners:g}))}var cp=null,Pg=null;function jN(p){D0(p,0)}function lp(p){var g=mp(p);if(Ut(g))return p}function BN(p,g){if(p==="change")return g}var rC=!1;if(E){var I0;if(E){var fc="oninput"in document;if(!fc){var iC=document.createElement("div");iC.setAttribute("oninput","return;"),fc=typeof iC.oninput=="function"}I0=fc}else I0=!1;rC=I0&&(!document.documentMode||9<document.documentMode)}function sC(){cp&&(cp.detachEvent("onpropertychange",ua),Pg=cp=null)}function ua(p){if(p.propertyName==="value"&&lp(Pg)){var g=[];C0(g,Pg,p,oo(p)),wo(jN,g)}}function WN(p,g,b){p==="focusin"?(sC(),cp=g,Pg=b,cp.attachEvent("onpropertychange",ua)):p==="focusout"&&sC()}function zN(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return lp(Pg)}function GN(p,g){if(p==="click")return lp(g)}function HN(p,g){if(p==="input"||p==="change")return lp(g)}function oC(p,g){return p===g&&(p!==0||1/p===1/g)||p!==p&&g!==g}var cl=typeof Object.is=="function"?Object.is:oC;function Og(p,g){if(cl(p,g))return!0;if(typeof p!="object"||p===null||typeof g!="object"||g===null)return!1;var b=Object.keys(p),O=Object.keys(g);if(b.length!==O.length)return!1;for(O=0;O<b.length;O++){var M=b[O];if(!v.call(g,M)||!cl(p[M],g[M]))return!1}return!0}function aC(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function A0(p,g){var b=aC(p);p=0;for(var O;b;){if(b.nodeType===3){if(O=p+b.textContent.length,p<=g&&O>=g)return{node:b,offset:g-p};p=O}e:{for(;b;){if(b.nextSibling){b=b.nextSibling;break e}b=b.parentNode}b=void 0}b=aC(b)}}function cC(p,g){return p&&g?p===g?!0:p&&p.nodeType===3?!1:g&&g.nodeType===3?cC(p,g.parentNode):"contains"in p?p.contains(g):p.compareDocumentPosition?!!(p.compareDocumentPosition(g)&16):!1:!1}function lC(){for(var p=window,g=ln();g instanceof p.HTMLIFrameElement;){try{var b=typeof g.contentWindow.location.href=="string"}catch{b=!1}if(b)p=g.contentWindow;else break;g=ln(p.document)}return g}function kg(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g&&(g==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||g==="textarea"||p.contentEditable==="true")}function P0(p){var g=lC(),b=p.focusedElem,O=p.selectionRange;if(g!==b&&b&&b.ownerDocument&&cC(b.ownerDocument.documentElement,b)){if(O!==null&&kg(b)){if(g=O.start,p=O.end,p===void 0&&(p=g),"selectionStart"in b)b.selectionStart=g,b.selectionEnd=Math.min(p,b.value.length);else if(p=(g=b.ownerDocument||document)&&g.defaultView||window,p.getSelection){p=p.getSelection();var M=b.textContent.length,z=Math.min(O.start,M);O=O.end===void 0?z:Math.min(O.end,M),!p.extend&&z>O&&(M=O,O=z,z=M),M=A0(b,z);var ae=A0(b,O);M&&ae&&(p.rangeCount!==1||p.anchorNode!==M.node||p.anchorOffset!==M.offset||p.focusNode!==ae.node||p.focusOffset!==ae.offset)&&(g=g.createRange(),g.setStart(M.node,M.offset),p.removeAllRanges(),z>O?(p.addRange(g),p.extend(ae.node,ae.offset)):(g.setEnd(ae.node,ae.offset),p.addRange(g)))}}for(g=[],p=b;p=p.parentNode;)p.nodeType===1&&g.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof b.focus=="function"&&b.focus(),b=0;b<g.length;b++)p=g[b],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var $N=E&&"documentMode"in document&&11>=document.documentMode,ot=null,O0=null,Ng=null,k0=!1;function uC(p,g,b){var O=b.window===b?b.document:b.nodeType===9?b:b.ownerDocument;k0||ot==null||ot!==ln(O)||(O=ot,"selectionStart"in O&&kg(O)?O={start:O.selectionStart,end:O.selectionEnd}:(O=(O.ownerDocument&&O.ownerDocument.defaultView||window).getSelection(),O={anchorNode:O.anchorNode,anchorOffset:O.anchorOffset,focusNode:O.focusNode,focusOffset:O.focusOffset}),Ng&&Og(Ng,O)||(Ng=O,O=GE(O0,"onSelect"),0<O.length&&(g=new Fd("onSelect","select",null,g,b),p.push({event:g,listeners:O}),g.target=ot)))}function FE(p,g){var b={};return b[p.toLowerCase()]=g.toLowerCase(),b["Webkit"+p]="webkit"+g,b["Moz"+p]="moz"+g,b}var Gf={animationend:FE("Animation","AnimationEnd"),animationiteration:FE("Animation","AnimationIteration"),animationstart:FE("Animation","AnimationStart"),transitionend:FE("Transition","TransitionEnd")},N0={},dC={};E&&(dC=document.createElement("div").style,"AnimationEvent"in window||(delete Gf.animationend.animation,delete Gf.animationiteration.animation,delete Gf.animationstart.animation),"TransitionEvent"in window||delete Gf.transitionend.transition);function up(p){if(N0[p])return N0[p];if(!Gf[p])return p;var g=Gf[p],b;for(b in g)if(g.hasOwnProperty(b)&&b in dC)return N0[p]=g[b];return p}var dp=up("animationend"),hC=up("animationiteration"),pC=up("animationstart"),fC=up("transitionend"),mC=new Map,jE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function jd(p,g){mC.set(p,g),d(g,[p])}for(var BE=0;BE<jE.length;BE++){var ja=jE[BE],KN=ja.toLowerCase(),Dg=ja[0].toUpperCase()+ja.slice(1);jd(KN,"on"+Dg)}jd(dp,"onAnimationEnd"),jd(hC,"onAnimationIteration"),jd(pC,"onAnimationStart"),jd("dblclick","onDoubleClick"),jd("focusin","onFocus"),jd("focusout","onBlur"),jd(fC,"onTransitionEnd"),f("onMouseEnter",["mouseout","mouseover"]),f("onMouseLeave",["mouseout","mouseover"]),f("onPointerEnter",["pointerout","pointerover"]),f("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),qN=new Set("cancel close invalid load scroll toggle".split(" ").concat(Lg));function gC(p,g,b){var O=p.type||"unknown-event";p.currentTarget=b,tp(O,g,void 0,p),p.currentTarget=null}function D0(p,g){g=(g&4)!==0;for(var b=0;b<p.length;b++){var O=p[b],M=O.event;O=O.listeners;e:{var z=void 0;if(g)for(var ae=O.length-1;0<=ae;ae--){var Ie=O[ae],xe=Ie.instance,it=Ie.currentTarget;if(Ie=Ie.listener,xe!==z&&M.isPropagationStopped())break e;gC(M,Ie,it),z=xe}else for(ae=0;ae<O.length;ae++){if(Ie=O[ae],xe=Ie.instance,it=Ie.currentTarget,Ie=Ie.listener,xe!==z&&M.isPropagationStopped())break e;gC(M,Ie,it),z=xe}}}if(sa)throw p=Od,sa=!1,Od=null,p}function vi(p,g){var b=g[Vg];b===void 0&&(b=g[Vg]=new Set);var O=p+"__bubble";b.has(O)||(_C(g,p,2,!1),b.add(O))}function L0(p,g,b){var O=0;g&&(O|=4),_C(b,p,O,g)}var WE="_reactListening"+Math.random().toString(36).slice(2);function hp(p){if(!p[WE]){p[WE]=!0,a.forEach(function(b){b!=="selectionchange"&&(qN.has(b)||L0(b,!1,p),L0(b,!0,p))});var g=p.nodeType===9?p:p.ownerDocument;g===null||g[WE]||(g[WE]=!0,L0("selectionchange",!1,g))}}function _C(p,g,b,O){switch(jr(g)){case 1:var M=De;break;case 4:M=tt;break;default:M=Ht}b=M.bind(null,g,b,p),M=void 0,!as||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(M=!0),O?M!==void 0?p.addEventListener(g,b,{capture:!0,passive:M}):p.addEventListener(g,b,!0):M!==void 0?p.addEventListener(g,b,{passive:M}):p.addEventListener(g,b,!1)}function zE(p,g,b,O,M){var z=O;if((g&1)===0&&(g&2)===0&&O!==null)e:for(;;){if(O===null)return;var ae=O.tag;if(ae===3||ae===4){var Ie=O.stateNode.containerInfo;if(Ie===M||Ie.nodeType===8&&Ie.parentNode===M)break;if(ae===4)for(ae=O.return;ae!==null;){var xe=ae.tag;if((xe===3||xe===4)&&(xe=ae.stateNode.containerInfo,xe===M||xe.nodeType===8&&xe.parentNode===M))return;ae=ae.return}for(;Ie!==null;){if(ae=fp(Ie),ae===null)return;if(xe=ae.tag,xe===5||xe===6){O=z=ae;continue e}Ie=Ie.parentNode}}O=O.return}wo(function(){var it=z,It=oo(b),At=[];e:{var Rt=mC.get(p);if(Rt!==void 0){var zt=Fd,Zt=p;switch(p){case"keypress":if(No(b)===0)break e;case"keydown":case"keyup":zt=B;break;case"focusin":Zt="focus",zt=jf;break;case"focusout":Zt="blur",zt=jf;break;case"beforeblur":case"afterblur":zt=jf;break;case"click":if(b.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":zt=Vf;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":zt=xE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":zt=at;break;case dp:case hC:case pC:zt=Bu;break;case fC:zt=Gr;break;case"scroll":zt=Cg;break;case"wheel":zt=_r;break;case"copy":case"cut":case"paste":zt=Ag;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":zt=fe}var en=(g&4)!==0,Hi=!en&&p==="scroll",Je=en?Rt!==null?Rt+"Capture":null:Rt;en=[];for(var Ve=it,Ze;Ve!==null;){Ze=Ve;var Nt=Ze.stateNode;if(Ze.tag===5&&Nt!==null&&(Ze=Nt,Je!==null&&(Nt=Pi(Ve,Je),Nt!=null&&en.push(Hf(Ve,Nt,Ze)))),Hi)break;Ve=Ve.return}0<en.length&&(Rt=new zt(Rt,Zt,null,b,It),At.push({event:Rt,listeners:en}))}}if((g&7)===0){e:{if(Rt=p==="mouseover"||p==="pointerover",zt=p==="mouseout"||p==="pointerout",Rt&&b!==so&&(Zt=b.relatedTarget||b.fromElement)&&(fp(Zt)||Zt[mc]))break e;if((zt||Rt)&&(Rt=It.window===It?It:(Rt=It.ownerDocument)?Rt.defaultView||Rt.parentWindow:window,zt?(Zt=b.relatedTarget||b.toElement,zt=it,Zt=Zt?fp(Zt):null,Zt!==null&&(Hi=Ms(Zt),Zt!==Hi||Zt.tag!==5&&Zt.tag!==6)&&(Zt=null)):(zt=null,Zt=it),zt!==Zt)){if(en=Vf,Nt="onMouseLeave",Je="onMouseEnter",Ve="mouse",(p==="pointerout"||p==="pointerover")&&(en=fe,Nt="onPointerLeave",Je="onPointerEnter",Ve="pointer"),Hi=zt==null?Rt:mp(zt),Ze=Zt==null?Rt:mp(Zt),Rt=new en(Nt,Ve+"leave",zt,b,It),Rt.target=Hi,Rt.relatedTarget=Ze,Nt=null,fp(It)===it&&(en=new en(Je,Ve+"enter",Zt,b,It),en.target=Ze,en.relatedTarget=Hi,Nt=en),Hi=Nt,zt&&Zt)t:{for(en=zt,Je=Zt,Ve=0,Ze=en;Ze;Ze=pp(Ze))Ve++;for(Ze=0,Nt=Je;Nt;Nt=pp(Nt))Ze++;for(;0<Ve-Ze;)en=pp(en),Ve--;for(;0<Ze-Ve;)Je=pp(Je),Ze--;for(;Ve--;){if(en===Je||Je!==null&&en===Je.alternate)break t;en=pp(en),Je=pp(Je)}en=null}else en=null;zt!==null&&xg(At,Rt,zt,en,!1),Zt!==null&&Hi!==null&&xg(At,Hi,Zt,en,!0)}}e:{if(Rt=it?mp(it):window,zt=Rt.nodeName&&Rt.nodeName.toLowerCase(),zt==="select"||zt==="input"&&Rt.type==="file")var tn=BN;else if(nC(Rt))if(rC)tn=HN;else{tn=zN;var pn=WN}else(zt=Rt.nodeName)&&zt.toLowerCase()==="input"&&(Rt.type==="checkbox"||Rt.type==="radio")&&(tn=GN);if(tn&&(tn=tn(p,it))){C0(At,tn,b,It);break e}pn&&pn(p,Rt,it),p==="focusout"&&(pn=Rt._wrapperState)&&pn.controlled&&Rt.type==="number"&&Fe(Rt,"number",Rt.value)}switch(pn=it?mp(it):window,p){case"focusin":(nC(pn)||pn.contentEditable==="true")&&(ot=pn,O0=it,Ng=null);break;case"focusout":Ng=O0=ot=null;break;case"mousedown":k0=!0;break;case"contextmenu":case"mouseup":case"dragend":k0=!1,uC(At,b,It);break;case"selectionchange":if($N)break;case"keydown":case"keyup":uC(At,b,It)}var En;if(ls)e:{switch(p){case"compositionstart":var On="onCompositionStart";break e;case"compositionend":On="onCompositionEnd";break e;case"compositionupdate":On="onCompositionUpdate";break e}On=void 0}else zf?ZR(p,b)&&(On="onCompositionEnd"):p==="keydown"&&b.keyCode===229&&(On="onCompositionStart");On&&(ap&&b.locale!=="ko"&&(zf||On!=="onCompositionStart"?On==="onCompositionEnd"&&zf&&(En=Rs()):(cn=It,kr="value"in cn?cn.value:cn.textContent,zf=!0)),pn=GE(it,On),0<pn.length&&(On=new xn(On,p,null,b,It),At.push({event:On,listeners:pn}),En?On.data=En:(En=eC(b),En!==null&&(On.data=En)))),(En=Mo?VN(p,b):tC(p,b))&&(it=GE(it,"onBeforeInput"),0<it.length&&(It=new xn("onBeforeInput","beforeinput",null,b,It),At.push({event:It,listeners:it}),It.data=En))}D0(At,g)})}function Hf(p,g,b){return{instance:p,listener:g,currentTarget:b}}function GE(p,g){for(var b=g+"Capture",O=[];p!==null;){var M=p,z=M.stateNode;M.tag===5&&z!==null&&(M=z,z=Pi(p,b),z!=null&&O.unshift(Hf(p,z,M)),z=Pi(p,g),z!=null&&O.push(Hf(p,z,M))),p=p.return}return O}function pp(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function xg(p,g,b,O,M){for(var z=g._reactName,ae=[];b!==null&&b!==O;){var Ie=b,xe=Ie.alternate,it=Ie.stateNode;if(xe!==null&&xe===O)break;Ie.tag===5&&it!==null&&(Ie=it,M?(xe=Pi(b,z),xe!=null&&ae.unshift(Hf(b,xe,Ie))):M||(xe=Pi(b,z),xe!=null&&ae.push(Hf(b,xe,Ie)))),b=b.return}ae.length!==0&&p.push({event:g,listeners:ae})}var YN=/\r\n?/g,XN=/\u0000|\uFFFD/g;function EC(p){return(typeof p=="string"?p:""+p).replace(YN,`
`).replace(XN,"")}function HE(p,g,b){if(g=EC(g),EC(p)!==g&&b)throw Error(s(425))}function $E(){}var KE=null,Mg=null;function x0(p,g){return p==="textarea"||p==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var Ug=typeof setTimeout=="function"?setTimeout:void 0,JN=typeof clearTimeout=="function"?clearTimeout:void 0,yC=typeof Promise=="function"?Promise:void 0,QN=typeof queueMicrotask=="function"?queueMicrotask:typeof yC<"u"?function(p){return yC.resolve(null).then(p).catch(ZN)}:Ug;function ZN(p){setTimeout(function(){throw p})}function M0(p,g){var b=g,O=0;do{var M=b.nextSibling;if(p.removeChild(b),M&&M.nodeType===8)if(b=M.data,b==="/$"){if(O===0){p.removeChild(M),la(g);return}O--}else b!=="$"&&b!=="$?"&&b!=="$!"||O++;b=M}while(b);la(g)}function Bd(p){for(;p!=null;p=p.nextSibling){var g=p.nodeType;if(g===1||g===3)break;if(g===8){if(g=p.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return p}function vC(p){p=p.previousSibling;for(var g=0;p;){if(p.nodeType===8){var b=p.data;if(b==="$"||b==="$!"||b==="$?"){if(g===0)return p;g--}else b==="/$"&&g++}p=p.previousSibling}return null}var $f=Math.random().toString(36).slice(2),jl="__reactFiber$"+$f,Wd="__reactProps$"+$f,mc="__reactContainer$"+$f,Vg="__reactEvents$"+$f,e1="__reactListeners$"+$f,t1="__reactHandles$"+$f;function fp(p){var g=p[jl];if(g)return g;for(var b=p.parentNode;b;){if(g=b[mc]||b[jl]){if(b=g.alternate,g.child!==null||b!==null&&b.child!==null)for(p=vC(p);p!==null;){if(b=p[jl])return b;p=vC(p)}return g}p=b,b=p.parentNode}return null}function Kf(p){return p=p[jl]||p[mc],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function mp(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(s(33))}function qf(p){return p[Wd]||null}var U0=[],Yf=-1;function gc(p){return{current:p}}function Si(p){0>Yf||(p.current=U0[Yf],U0[Yf]=null,Yf--)}function fi(p,g){Yf++,U0[Yf]=p.current,p.current=g}var zd={},co=gc(zd),da=gc(!1),gp=zd;function _p(p,g){var b=p.type.contextTypes;if(!b)return zd;var O=p.stateNode;if(O&&O.__reactInternalMemoizedUnmaskedChildContext===g)return O.__reactInternalMemoizedMaskedChildContext;var M={},z;for(z in b)M[z]=g[z];return O&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=g,p.__reactInternalMemoizedMaskedChildContext=M),M}function ha(p){return p=p.childContextTypes,p!=null}function qE(){Si(da),Si(co)}function SC(p,g,b){if(co.current!==zd)throw Error(s(168));fi(co,g),fi(da,b)}function YE(p,g,b){var O=p.stateNode;if(g=g.childContextTypes,typeof O.getChildContext!="function")return b;O=O.getChildContext();for(var M in O)if(!(M in g))throw Error(s(108,nt(p)||"Unknown",M));return Ne({},b,O)}function XE(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||zd,gp=co.current,fi(co,p),fi(da,da.current),!0}function TC(p,g,b){var O=p.stateNode;if(!O)throw Error(s(169));b?(p=YE(p,g,gp),O.__reactInternalMemoizedMergedChildContext=p,Si(da),Si(co),fi(co,p)):Si(da),fi(da,b)}var _c=null,JE=!1,V0=!1;function bC(p){_c===null?_c=[p]:_c.push(p)}function n1(p){JE=!0,bC(p)}function Gd(){if(!V0&&_c!==null){V0=!0;var p=0,g=nr;try{var b=_c;for(nr=1;p<b.length;p++){var O=b[p];do O=O(!0);while(O!==null)}_c=null,JE=!1}catch(M){throw _c!==null&&(_c=_c.slice(p+1)),Dd(lc,Gd),M}finally{nr=g,V0=!1}}return null}var Xf=[],zu=0,Fg=null,QE=0,Ec=[],Ba=0,Ep=null,Gu=1,Hu="";function $u(p,g){Xf[zu++]=QE,Xf[zu++]=Fg,Fg=p,QE=g}function ZE(p,g,b){Ec[Ba++]=Gu,Ec[Ba++]=Hu,Ec[Ba++]=Ep,Ep=p;var O=Gu;p=Hu;var M=32-Hs(O)-1;O&=~(1<<M),b+=1;var z=32-Hs(g)+M;if(30<z){var ae=M-M%5;z=(O&(1<<ae)-1).toString(32),O>>=ae,M-=ae,Gu=1<<32-Hs(g)+M|b<<M|O,Hu=z+p}else Gu=1<<z|b<<M|O,Hu=p}function ey(p){p.return!==null&&($u(p,1),ZE(p,1,0))}function jg(p){for(;p===Fg;)Fg=Xf[--zu],Xf[zu]=null,QE=Xf[--zu],Xf[zu]=null;for(;p===Ep;)Ep=Ec[--Ba],Ec[Ba]=null,Hu=Ec[--Ba],Ec[Ba]=null,Gu=Ec[--Ba],Ec[Ba]=null}var pa=null,fa=null,si=!1,Uo=null;function wC(p,g){var b=Ga(5,null,null,0);b.elementType="DELETED",b.stateNode=g,b.return=p,g=p.deletions,g===null?(p.deletions=[b],p.flags|=16):g.push(b)}function RC(p,g){switch(p.tag){case 5:var b=p.type;return g=g.nodeType!==1||b.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(p.stateNode=g,pa=p,fa=Bd(g.firstChild),!0):!1;case 6:return g=p.pendingProps===""||g.nodeType!==3?null:g,g!==null?(p.stateNode=g,pa=p,fa=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(b=Ep!==null?{id:Gu,overflow:Hu}:null,p.memoizedState={dehydrated:g,treeContext:b,retryLane:1073741824},b=Ga(18,null,null,0),b.stateNode=g,b.return=p,p.child=b,pa=p,fa=null,!0):!1;default:return!1}}function ty(p){return(p.mode&1)!==0&&(p.flags&128)===0}function F0(p){if(si){var g=fa;if(g){var b=g;if(!RC(p,g)){if(ty(p))throw Error(s(418));g=Bd(b.nextSibling);var O=pa;g&&RC(p,g)?wC(O,b):(p.flags=p.flags&-4097|2,si=!1,pa=p)}}else{if(ty(p))throw Error(s(418));p.flags=p.flags&-4097|2,si=!1,pa=p}}}function CC(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;pa=p}function Bg(p){if(p!==pa)return!1;if(!si)return CC(p),si=!0,!1;var g;if((g=p.tag!==3)&&!(g=p.tag!==5)&&(g=p.type,g=g!=="head"&&g!=="body"&&!x0(p.type,p.memoizedProps)),g&&(g=fa)){if(ty(p))throw IC(),Error(s(418));for(;g;)wC(p,g),g=Bd(g.nextSibling)}if(CC(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(s(317));e:{for(p=p.nextSibling,g=0;p;){if(p.nodeType===8){var b=p.data;if(b==="/$"){if(g===0){fa=Bd(p.nextSibling);break e}g--}else b!=="$"&&b!=="$!"&&b!=="$?"||g++}p=p.nextSibling}fa=null}}else fa=pa?Bd(p.stateNode.nextSibling):null;return!0}function IC(){for(var p=fa;p;)p=Bd(p.nextSibling)}function Jf(){fa=pa=null,si=!1}function j0(p){Uo===null?Uo=[p]:Uo.push(p)}var r1=de.ReactCurrentBatchConfig;function Wg(p,g,b){if(p=b.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(b._owner){if(b=b._owner,b){if(b.tag!==1)throw Error(s(309));var O=b.stateNode}if(!O)throw Error(s(147,p));var M=O,z=""+p;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===z?g.ref:(g=function(ae){var Ie=M.refs;ae===null?delete Ie[z]:Ie[z]=ae},g._stringRef=z,g)}if(typeof p!="string")throw Error(s(284));if(!b._owner)throw Error(s(290,p))}return p}function ny(p,g){throw p=Object.prototype.toString.call(g),Error(s(31,p==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":p))}function B0(p){var g=p._init;return g(p._payload)}function Hd(p){function g(Je,Ve){if(p){var Ze=Je.deletions;Ze===null?(Je.deletions=[Ve],Je.flags|=16):Ze.push(Ve)}}function b(Je,Ve){if(!p)return null;for(;Ve!==null;)g(Je,Ve),Ve=Ve.sibling;return null}function O(Je,Ve){for(Je=new Map;Ve!==null;)Ve.key!==null?Je.set(Ve.key,Ve):Je.set(Ve.index,Ve),Ve=Ve.sibling;return Je}function M(Je,Ve){return Je=ed(Je,Ve),Je.index=0,Je.sibling=null,Je}function z(Je,Ve,Ze){return Je.index=Ze,p?(Ze=Je.alternate,Ze!==null?(Ze=Ze.index,Ze<Ve?(Je.flags|=2,Ve):Ze):(Je.flags|=2,Ve)):(Je.flags|=1048576,Ve)}function ae(Je){return p&&Je.alternate===null&&(Je.flags|=2),Je}function Ie(Je,Ve,Ze,Nt){return Ve===null||Ve.tag!==6?(Ve=wT(Ze,Je.mode,Nt),Ve.return=Je,Ve):(Ve=M(Ve,Ze),Ve.return=Je,Ve)}function xe(Je,Ve,Ze,Nt){var tn=Ze.type;return tn===Z?It(Je,Ve,Ze.props.children,Nt,Ze.key):Ve!==null&&(Ve.elementType===tn||typeof tn=="object"&&tn!==null&&tn.$$typeof===rt&&B0(tn)===Ve.type)?(Nt=M(Ve,Ze.props),Nt.ref=Wg(Je,Ve,Ze),Nt.return=Je,Nt):(Nt=Wy(Ze.type,Ze.key,Ze.props,null,Je.mode,Nt),Nt.ref=Wg(Je,Ve,Ze),Nt.return=Je,Nt)}function it(Je,Ve,Ze,Nt){return Ve===null||Ve.tag!==4||Ve.stateNode.containerInfo!==Ze.containerInfo||Ve.stateNode.implementation!==Ze.implementation?(Ve=RT(Ze,Je.mode,Nt),Ve.return=Je,Ve):(Ve=M(Ve,Ze.children||[]),Ve.return=Je,Ve)}function It(Je,Ve,Ze,Nt,tn){return Ve===null||Ve.tag!==7?(Ve=Op(Ze,Je.mode,Nt,tn),Ve.return=Je,Ve):(Ve=M(Ve,Ze),Ve.return=Je,Ve)}function At(Je,Ve,Ze){if(typeof Ve=="string"&&Ve!==""||typeof Ve=="number")return Ve=wT(""+Ve,Je.mode,Ze),Ve.return=Je,Ve;if(typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case se:return Ze=Wy(Ve.type,Ve.key,Ve.props,null,Je.mode,Ze),Ze.ref=Wg(Je,null,Ve),Ze.return=Je,Ze;case ge:return Ve=RT(Ve,Je.mode,Ze),Ve.return=Je,Ve;case rt:var Nt=Ve._init;return At(Je,Nt(Ve._payload),Ze)}if(Ke(Ve)||ye(Ve))return Ve=Op(Ve,Je.mode,Ze,null),Ve.return=Je,Ve;ny(Je,Ve)}return null}function Rt(Je,Ve,Ze,Nt){var tn=Ve!==null?Ve.key:null;if(typeof Ze=="string"&&Ze!==""||typeof Ze=="number")return tn!==null?null:Ie(Je,Ve,""+Ze,Nt);if(typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case se:return Ze.key===tn?xe(Je,Ve,Ze,Nt):null;case ge:return Ze.key===tn?it(Je,Ve,Ze,Nt):null;case rt:return tn=Ze._init,Rt(Je,Ve,tn(Ze._payload),Nt)}if(Ke(Ze)||ye(Ze))return tn!==null?null:It(Je,Ve,Ze,Nt,null);ny(Je,Ze)}return null}function zt(Je,Ve,Ze,Nt,tn){if(typeof Nt=="string"&&Nt!==""||typeof Nt=="number")return Je=Je.get(Ze)||null,Ie(Ve,Je,""+Nt,tn);if(typeof Nt=="object"&&Nt!==null){switch(Nt.$$typeof){case se:return Je=Je.get(Nt.key===null?Ze:Nt.key)||null,xe(Ve,Je,Nt,tn);case ge:return Je=Je.get(Nt.key===null?Ze:Nt.key)||null,it(Ve,Je,Nt,tn);case rt:var pn=Nt._init;return zt(Je,Ve,Ze,pn(Nt._payload),tn)}if(Ke(Nt)||ye(Nt))return Je=Je.get(Ze)||null,It(Ve,Je,Nt,tn,null);ny(Ve,Nt)}return null}function Zt(Je,Ve,Ze,Nt){for(var tn=null,pn=null,En=Ve,On=Ve=0,fs=null;En!==null&&On<Ze.length;On++){En.index>On?(fs=En,En=null):fs=En.sibling;var Er=Rt(Je,En,Ze[On],Nt);if(Er===null){En===null&&(En=fs);break}p&&En&&Er.alternate===null&&g(Je,En),Ve=z(Er,Ve,On),pn===null?tn=Er:pn.sibling=Er,pn=Er,En=fs}if(On===Ze.length)return b(Je,En),si&&$u(Je,On),tn;if(En===null){for(;On<Ze.length;On++)En=At(Je,Ze[On],Nt),En!==null&&(Ve=z(En,Ve,On),pn===null?tn=En:pn.sibling=En,pn=En);return si&&$u(Je,On),tn}for(En=O(Je,En);On<Ze.length;On++)fs=zt(En,Je,On,Ze[On],Nt),fs!==null&&(p&&fs.alternate!==null&&En.delete(fs.key===null?On:fs.key),Ve=z(fs,Ve,On),pn===null?tn=fs:pn.sibling=fs,pn=fs);return p&&En.forEach(function(nh){return g(Je,nh)}),si&&$u(Je,On),tn}function en(Je,Ve,Ze,Nt){var tn=ye(Ze);if(typeof tn!="function")throw Error(s(150));if(Ze=tn.call(Ze),Ze==null)throw Error(s(151));for(var pn=tn=null,En=Ve,On=Ve=0,fs=null,Er=Ze.next();En!==null&&!Er.done;On++,Er=Ze.next()){En.index>On?(fs=En,En=null):fs=En.sibling;var nh=Rt(Je,En,Er.value,Nt);if(nh===null){En===null&&(En=fs);break}p&&En&&nh.alternate===null&&g(Je,En),Ve=z(nh,Ve,On),pn===null?tn=nh:pn.sibling=nh,pn=nh,En=fs}if(Er.done)return b(Je,En),si&&$u(Je,On),tn;if(En===null){for(;!Er.done;On++,Er=Ze.next())Er=At(Je,Er.value,Nt),Er!==null&&(Ve=z(Er,Ve,On),pn===null?tn=Er:pn.sibling=Er,pn=Er);return si&&$u(Je,On),tn}for(En=O(Je,En);!Er.done;On++,Er=Ze.next())Er=zt(En,Je,On,Er.value,Nt),Er!==null&&(p&&Er.alternate!==null&&En.delete(Er.key===null?On:Er.key),Ve=z(Er,Ve,On),pn===null?tn=Er:pn.sibling=Er,pn=Er);return p&&En.forEach(function(y1){return g(Je,y1)}),si&&$u(Je,On),tn}function Hi(Je,Ve,Ze,Nt){if(typeof Ze=="object"&&Ze!==null&&Ze.type===Z&&Ze.key===null&&(Ze=Ze.props.children),typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case se:e:{for(var tn=Ze.key,pn=Ve;pn!==null;){if(pn.key===tn){if(tn=Ze.type,tn===Z){if(pn.tag===7){b(Je,pn.sibling),Ve=M(pn,Ze.props.children),Ve.return=Je,Je=Ve;break e}}else if(pn.elementType===tn||typeof tn=="object"&&tn!==null&&tn.$$typeof===rt&&B0(tn)===pn.type){b(Je,pn.sibling),Ve=M(pn,Ze.props),Ve.ref=Wg(Je,pn,Ze),Ve.return=Je,Je=Ve;break e}b(Je,pn);break}else g(Je,pn);pn=pn.sibling}Ze.type===Z?(Ve=Op(Ze.props.children,Je.mode,Nt,Ze.key),Ve.return=Je,Je=Ve):(Nt=Wy(Ze.type,Ze.key,Ze.props,null,Je.mode,Nt),Nt.ref=Wg(Je,Ve,Ze),Nt.return=Je,Je=Nt)}return ae(Je);case ge:e:{for(pn=Ze.key;Ve!==null;){if(Ve.key===pn)if(Ve.tag===4&&Ve.stateNode.containerInfo===Ze.containerInfo&&Ve.stateNode.implementation===Ze.implementation){b(Je,Ve.sibling),Ve=M(Ve,Ze.children||[]),Ve.return=Je,Je=Ve;break e}else{b(Je,Ve);break}else g(Je,Ve);Ve=Ve.sibling}Ve=RT(Ze,Je.mode,Nt),Ve.return=Je,Je=Ve}return ae(Je);case rt:return pn=Ze._init,Hi(Je,Ve,pn(Ze._payload),Nt)}if(Ke(Ze))return Zt(Je,Ve,Ze,Nt);if(ye(Ze))return en(Je,Ve,Ze,Nt);ny(Je,Ze)}return typeof Ze=="string"&&Ze!==""||typeof Ze=="number"?(Ze=""+Ze,Ve!==null&&Ve.tag===6?(b(Je,Ve.sibling),Ve=M(Ve,Ze),Ve.return=Je,Je=Ve):(b(Je,Ve),Ve=wT(Ze,Je.mode,Nt),Ve.return=Je,Je=Ve),ae(Je)):b(Je,Ve)}return Hi}var Qf=Hd(!0),AC=Hd(!1),ry=gc(null),zg=null,Zf=null,iy=null;function W0(){iy=Zf=zg=null}function z0(p){var g=ry.current;Si(ry),p._currentValue=g}function G0(p,g,b){for(;p!==null;){var O=p.alternate;if((p.childLanes&g)!==g?(p.childLanes|=g,O!==null&&(O.childLanes|=g)):O!==null&&(O.childLanes&g)!==g&&(O.childLanes|=g),p===b)break;p=p.return}}function Ku(p,g){zg=p,iy=Zf=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&g)!==0&&(ga=!0),p.firstContext=null)}function yc(p){var g=p._currentValue;if(iy!==p)if(p={context:p,memoizedValue:g,next:null},Zf===null){if(zg===null)throw Error(s(308));Zf=p,zg.dependencies={lanes:0,firstContext:p}}else Zf=Zf.next=p;return g}var yp=null;function H0(p){yp===null?yp=[p]:yp.push(p)}function PC(p,g,b,O){var M=g.interleaved;return M===null?(b.next=b,H0(g)):(b.next=M.next,M.next=b),g.interleaved=b,qu(p,O)}function qu(p,g){p.lanes|=g;var b=p.alternate;for(b!==null&&(b.lanes|=g),b=p,p=p.return;p!==null;)p.childLanes|=g,b=p.alternate,b!==null&&(b.childLanes|=g),b=p,p=p.return;return b.tag===3?b.stateNode:null}var $d=!1;function Gg(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function OC(p,g){p=p.updateQueue,g.updateQueue===p&&(g.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function Bl(p,g){return{eventTime:p,lane:g,tag:0,payload:null,callback:null,next:null}}function Kd(p,g,b){var O=p.updateQueue;if(O===null)return null;if(O=O.shared,(Tr&2)!==0){var M=O.pending;return M===null?g.next=g:(g.next=M.next,M.next=g),O.pending=g,qu(p,b)}return M=O.interleaved,M===null?(g.next=g,H0(O)):(g.next=M.next,M.next=g),O.interleaved=g,qu(p,b)}function Hg(p,g,b){if(g=g.updateQueue,g!==null&&(g=g.shared,(b&4194240)!==0)){var O=g.lanes;O&=p.pendingLanes,b|=O,g.lanes=b,Ua(p,b)}}function kC(p,g){var b=p.updateQueue,O=p.alternate;if(O!==null&&(O=O.updateQueue,b===O)){var M=null,z=null;if(b=b.firstBaseUpdate,b!==null){do{var ae={eventTime:b.eventTime,lane:b.lane,tag:b.tag,payload:b.payload,callback:b.callback,next:null};z===null?M=z=ae:z=z.next=ae,b=b.next}while(b!==null);z===null?M=z=g:z=z.next=g}else M=z=g;b={baseState:O.baseState,firstBaseUpdate:M,lastBaseUpdate:z,shared:O.shared,effects:O.effects},p.updateQueue=b;return}p=b.lastBaseUpdate,p===null?b.firstBaseUpdate=g:p.next=g,b.lastBaseUpdate=g}function sy(p,g,b,O){var M=p.updateQueue;$d=!1;var z=M.firstBaseUpdate,ae=M.lastBaseUpdate,Ie=M.shared.pending;if(Ie!==null){M.shared.pending=null;var xe=Ie,it=xe.next;xe.next=null,ae===null?z=it:ae.next=it,ae=xe;var It=p.alternate;It!==null&&(It=It.updateQueue,Ie=It.lastBaseUpdate,Ie!==ae&&(Ie===null?It.firstBaseUpdate=it:Ie.next=it,It.lastBaseUpdate=xe))}if(z!==null){var At=M.baseState;ae=0,It=it=xe=null,Ie=z;do{var Rt=Ie.lane,zt=Ie.eventTime;if((O&Rt)===Rt){It!==null&&(It=It.next={eventTime:zt,lane:0,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null});e:{var Zt=p,en=Ie;switch(Rt=g,zt=b,en.tag){case 1:if(Zt=en.payload,typeof Zt=="function"){At=Zt.call(zt,At,Rt);break e}At=Zt;break e;case 3:Zt.flags=Zt.flags&-65537|128;case 0:if(Zt=en.payload,Rt=typeof Zt=="function"?Zt.call(zt,At,Rt):Zt,Rt==null)break e;At=Ne({},At,Rt);break e;case 2:$d=!0}}Ie.callback!==null&&Ie.lane!==0&&(p.flags|=64,Rt=M.effects,Rt===null?M.effects=[Ie]:Rt.push(Ie))}else zt={eventTime:zt,lane:Rt,tag:Ie.tag,payload:Ie.payload,callback:Ie.callback,next:null},It===null?(it=It=zt,xe=At):It=It.next=zt,ae|=Rt;if(Ie=Ie.next,Ie===null){if(Ie=M.shared.pending,Ie===null)break;Rt=Ie,Ie=Rt.next,Rt.next=null,M.lastBaseUpdate=Rt,M.shared.pending=null}}while(!0);if(It===null&&(xe=At),M.baseState=xe,M.firstBaseUpdate=it,M.lastBaseUpdate=It,g=M.shared.interleaved,g!==null){M=g;do ae|=M.lane,M=M.next;while(M!==g)}else z===null&&(M.shared.lanes=0);Rp|=ae,p.lanes=ae,p.memoizedState=At}}function NC(p,g,b){if(p=g.effects,g.effects=null,p!==null)for(g=0;g<p.length;g++){var O=p[g],M=O.callback;if(M!==null){if(O.callback=null,O=b,typeof M!="function")throw Error(s(191,M));M.call(O)}}}var $g={},Wl=gc($g),Kg=gc($g),em=gc($g);function vp(p){if(p===$g)throw Error(s(174));return p}function $0(p,g){switch(fi(em,g),fi(Kg,p),fi(Wl,$g),p=g.nodeType,p){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:an(null,"");break;default:p=p===8?g.parentNode:g,g=p.namespaceURI||null,p=p.tagName,g=an(g,p)}Si(Wl),fi(Wl,g)}function Sp(){Si(Wl),Si(Kg),Si(em)}function DC(p){vp(em.current);var g=vp(Wl.current),b=an(g,p.type);g!==b&&(fi(Kg,p),fi(Wl,b))}function tm(p){Kg.current===p&&(Si(Wl),Si(Kg))}var Ri=gc(0);function qd(p){for(var g=p;g!==null;){if(g.tag===13){var b=g.memoizedState;if(b!==null&&(b=b.dehydrated,b===null||b.data==="$?"||b.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var K0=[];function q0(){for(var p=0;p<K0.length;p++)K0[p]._workInProgressVersionPrimary=null;K0.length=0}var oy=de.ReactCurrentDispatcher,Y0=de.ReactCurrentBatchConfig,zl=0,Oi=null,us=null,ds=null,nm=!1,qg=!1,Yg=0,i1=0;function lo(){throw Error(s(321))}function X0(p,g){if(g===null)return!1;for(var b=0;b<g.length&&b<p.length;b++)if(!cl(p[b],g[b]))return!1;return!0}function rm(p,g,b,O,M,z){if(zl=z,Oi=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,oy.current=p===null||p.memoizedState===null?a1:GC,p=b(O,M),qg){z=0;do{if(qg=!1,Yg=0,25<=z)throw Error(s(301));z+=1,ds=us=null,g.updateQueue=null,oy.current=c1,p=b(O,M)}while(qg)}if(oy.current=uy,g=us!==null&&us.next!==null,zl=0,ds=us=Oi=null,nm=!1,g)throw Error(s(300));return p}function J0(){var p=Yg!==0;return Yg=0,p}function Vo(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ds===null?Oi.memoizedState=ds=p:ds=ds.next=p,ds}function ma(){if(us===null){var p=Oi.alternate;p=p!==null?p.memoizedState:null}else p=us.next;var g=ds===null?Oi.memoizedState:ds.next;if(g!==null)ds=g,us=p;else{if(p===null)throw Error(s(310));us=p,p={memoizedState:us.memoizedState,baseState:us.baseState,baseQueue:us.baseQueue,queue:us.queue,next:null},ds===null?Oi.memoizedState=ds=p:ds=ds.next=p}return ds}function Yd(p,g){return typeof g=="function"?g(p):g}function Tp(p){var g=ma(),b=g.queue;if(b===null)throw Error(s(311));b.lastRenderedReducer=p;var O=us,M=O.baseQueue,z=b.pending;if(z!==null){if(M!==null){var ae=M.next;M.next=z.next,z.next=ae}O.baseQueue=M=z,b.pending=null}if(M!==null){z=M.next,O=O.baseState;var Ie=ae=null,xe=null,it=z;do{var It=it.lane;if((zl&It)===It)xe!==null&&(xe=xe.next={lane:0,action:it.action,hasEagerState:it.hasEagerState,eagerState:it.eagerState,next:null}),O=it.hasEagerState?it.eagerState:p(O,it.action);else{var At={lane:It,action:it.action,hasEagerState:it.hasEagerState,eagerState:it.eagerState,next:null};xe===null?(Ie=xe=At,ae=O):xe=xe.next=At,Oi.lanes|=It,Rp|=It}it=it.next}while(it!==null&&it!==z);xe===null?ae=O:xe.next=Ie,cl(O,g.memoizedState)||(ga=!0),g.memoizedState=O,g.baseState=ae,g.baseQueue=xe,b.lastRenderedState=O}if(p=b.interleaved,p!==null){M=p;do z=M.lane,Oi.lanes|=z,Rp|=z,M=M.next;while(M!==p)}else M===null&&(b.lanes=0);return[g.memoizedState,b.dispatch]}function im(p){var g=ma(),b=g.queue;if(b===null)throw Error(s(311));b.lastRenderedReducer=p;var O=b.dispatch,M=b.pending,z=g.memoizedState;if(M!==null){b.pending=null;var ae=M=M.next;do z=p(z,ae.action),ae=ae.next;while(ae!==M);cl(z,g.memoizedState)||(ga=!0),g.memoizedState=z,g.baseQueue===null&&(g.baseState=z),b.lastRenderedState=z}return[z,O]}function LC(){}function Q0(p,g){var b=Oi,O=ma(),M=g(),z=!cl(O.memoizedState,M);if(z&&(O.memoizedState=M,ga=!0),O=O.queue,vc(MC.bind(null,b,O,p),[p]),O.getSnapshot!==g||z||ds!==null&&ds.memoizedState.tag&1){if(b.flags|=2048,Xg(9,Z0.bind(null,b,O,M,g),void 0,null),Vs===null)throw Error(s(349));(zl&30)!==0||xC(b,g,M)}return M}function xC(p,g,b){p.flags|=16384,p={getSnapshot:g,value:b},g=Oi.updateQueue,g===null?(g={lastEffect:null,stores:null},Oi.updateQueue=g,g.stores=[p]):(b=g.stores,b===null?g.stores=[p]:b.push(p))}function Z0(p,g,b,O){g.value=b,g.getSnapshot=O,UC(g)&&ay(p)}function MC(p,g,b){return b(function(){UC(g)&&ay(p)})}function UC(p){var g=p.getSnapshot;p=p.value;try{var b=g();return!cl(p,b)}catch{return!0}}function ay(p){var g=qu(p,1);g!==null&&wc(g,p,1,-1)}function cy(p){var g=Vo();return typeof p=="function"&&(p=p()),g.memoizedState=g.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Yd,lastRenderedState:p},g.queue=p,p=p.dispatch=o1.bind(null,Oi,p),[g.memoizedState,p]}function Xg(p,g,b,O){return p={tag:p,create:g,destroy:b,deps:O,next:null},g=Oi.updateQueue,g===null?(g={lastEffect:null,stores:null},Oi.updateQueue=g,g.lastEffect=p.next=p):(b=g.lastEffect,b===null?g.lastEffect=p.next=p:(O=b.next,b.next=p,p.next=O,g.lastEffect=p)),p}function VC(){return ma().memoizedState}function Jg(p,g,b,O){var M=Vo();Oi.flags|=p,M.memoizedState=Xg(1|g,b,void 0,O===void 0?null:O)}function sm(p,g,b,O){var M=ma();O=O===void 0?null:O;var z=void 0;if(us!==null){var ae=us.memoizedState;if(z=ae.destroy,O!==null&&X0(O,ae.deps)){M.memoizedState=Xg(g,b,z,O);return}}Oi.flags|=p,M.memoizedState=Xg(1|g,b,z,O)}function FC(p,g){return Jg(8390656,8,p,g)}function vc(p,g){return sm(2048,8,p,g)}function bp(p,g){return sm(4,2,p,g)}function Xd(p,g){return sm(4,4,p,g)}function eT(p,g){if(typeof g=="function")return p=p(),g(p),function(){g(null)};if(g!=null)return p=p(),g.current=p,function(){g.current=null}}function tT(p,g,b){return b=b!=null?b.concat([p]):null,sm(4,4,eT.bind(null,g,p),b)}function Yu(){}function ly(p,g){var b=ma();g=g===void 0?null:g;var O=b.memoizedState;return O!==null&&g!==null&&X0(g,O[1])?O[0]:(b.memoizedState=[p,g],p)}function jC(p,g){var b=ma();g=g===void 0?null:g;var O=b.memoizedState;return O!==null&&g!==null&&X0(g,O[1])?O[0]:(p=p(),b.memoizedState=[p,g],p)}function nT(p,g,b){return(zl&21)===0?(p.baseState&&(p.baseState=!1,ga=!0),p.memoizedState=b):(cl(b,g)||(b=Mu(),Oi.lanes|=b,Rp|=b,p.baseState=!0),g)}function s1(p,g){var b=nr;nr=b!==0&&4>b?b:4,p(!0);var O=Y0.transition;Y0.transition={};try{p(!1),g()}finally{nr=b,Y0.transition=O}}function rT(){return ma().memoizedState}function BC(p,g,b){var O=bc(p);if(b={lane:O,action:b,hasEagerState:!1,eagerState:null,next:null},Xu(p))WC(g,b);else if(b=PC(p,g,b,O),b!==null){var M=qs();wc(b,p,O,M),zC(b,g,O)}}function o1(p,g,b){var O=bc(p),M={lane:O,action:b,hasEagerState:!1,eagerState:null,next:null};if(Xu(p))WC(g,M);else{var z=p.alternate;if(p.lanes===0&&(z===null||z.lanes===0)&&(z=g.lastRenderedReducer,z!==null))try{var ae=g.lastRenderedState,Ie=z(ae,b);if(M.hasEagerState=!0,M.eagerState=Ie,cl(Ie,ae)){var xe=g.interleaved;xe===null?(M.next=M,H0(g)):(M.next=xe.next,xe.next=M),g.interleaved=M;return}}catch{}finally{}b=PC(p,g,M,O),b!==null&&(M=qs(),wc(b,p,O,M),zC(b,g,O))}}function Xu(p){var g=p.alternate;return p===Oi||g!==null&&g===Oi}function WC(p,g){qg=nm=!0;var b=p.pending;b===null?g.next=g:(g.next=b.next,b.next=g),p.pending=g}function zC(p,g,b){if((b&4194240)!==0){var O=g.lanes;O&=p.pendingLanes,b|=O,g.lanes=b,Ua(p,b)}}var uy={readContext:yc,useCallback:lo,useContext:lo,useEffect:lo,useImperativeHandle:lo,useInsertionEffect:lo,useLayoutEffect:lo,useMemo:lo,useReducer:lo,useRef:lo,useState:lo,useDebugValue:lo,useDeferredValue:lo,useTransition:lo,useMutableSource:lo,useSyncExternalStore:lo,useId:lo,unstable_isNewReconciler:!1},a1={readContext:yc,useCallback:function(p,g){return Vo().memoizedState=[p,g===void 0?null:g],p},useContext:yc,useEffect:FC,useImperativeHandle:function(p,g,b){return b=b!=null?b.concat([p]):null,Jg(4194308,4,eT.bind(null,g,p),b)},useLayoutEffect:function(p,g){return Jg(4194308,4,p,g)},useInsertionEffect:function(p,g){return Jg(4,2,p,g)},useMemo:function(p,g){var b=Vo();return g=g===void 0?null:g,p=p(),b.memoizedState=[p,g],p},useReducer:function(p,g,b){var O=Vo();return g=b!==void 0?b(g):g,O.memoizedState=O.baseState=g,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:g},O.queue=p,p=p.dispatch=BC.bind(null,Oi,p),[O.memoizedState,p]},useRef:function(p){var g=Vo();return p={current:p},g.memoizedState=p},useState:cy,useDebugValue:Yu,useDeferredValue:function(p){return Vo().memoizedState=p},useTransition:function(){var p=cy(!1),g=p[0];return p=s1.bind(null,p[1]),Vo().memoizedState=p,[g,p]},useMutableSource:function(){},useSyncExternalStore:function(p,g,b){var O=Oi,M=Vo();if(si){if(b===void 0)throw Error(s(407));b=b()}else{if(b=g(),Vs===null)throw Error(s(349));(zl&30)!==0||xC(O,g,b)}M.memoizedState=b;var z={value:b,getSnapshot:g};return M.queue=z,FC(MC.bind(null,O,z,p),[p]),O.flags|=2048,Xg(9,Z0.bind(null,O,z,b,g),void 0,null),b},useId:function(){var p=Vo(),g=Vs.identifierPrefix;if(si){var b=Hu,O=Gu;b=(O&~(1<<32-Hs(O)-1)).toString(32)+b,g=":"+g+"R"+b,b=Yg++,0<b&&(g+="H"+b.toString(32)),g+=":"}else b=i1++,g=":"+g+"r"+b.toString(32)+":";return p.memoizedState=g},unstable_isNewReconciler:!1},GC={readContext:yc,useCallback:ly,useContext:yc,useEffect:vc,useImperativeHandle:tT,useInsertionEffect:bp,useLayoutEffect:Xd,useMemo:jC,useReducer:Tp,useRef:VC,useState:function(){return Tp(Yd)},useDebugValue:Yu,useDeferredValue:function(p){var g=ma();return nT(g,us.memoizedState,p)},useTransition:function(){var p=Tp(Yd)[0],g=ma().memoizedState;return[p,g]},useMutableSource:LC,useSyncExternalStore:Q0,useId:rT,unstable_isNewReconciler:!1},c1={readContext:yc,useCallback:ly,useContext:yc,useEffect:vc,useImperativeHandle:tT,useInsertionEffect:bp,useLayoutEffect:Xd,useMemo:jC,useReducer:im,useRef:VC,useState:function(){return im(Yd)},useDebugValue:Yu,useDeferredValue:function(p){var g=ma();return us===null?g.memoizedState=p:nT(g,us.memoizedState,p)},useTransition:function(){var p=im(Yd)[0],g=ma().memoizedState;return[p,g]},useMutableSource:LC,useSyncExternalStore:Q0,useId:rT,unstable_isNewReconciler:!1};function Wa(p,g){if(p&&p.defaultProps){g=Ne({},g),p=p.defaultProps;for(var b in p)g[b]===void 0&&(g[b]=p[b]);return g}return g}function dy(p,g,b,O){g=p.memoizedState,b=b(O,g),b=b==null?g:Ne({},g,b),p.memoizedState=b,p.lanes===0&&(p.updateQueue.baseState=b)}var hy={isMounted:function(p){return(p=p._reactInternals)?Ms(p)===p:!1},enqueueSetState:function(p,g,b){p=p._reactInternals;var O=qs(),M=bc(p),z=Bl(O,M);z.payload=g,b!=null&&(z.callback=b),g=Kd(p,z,M),g!==null&&(wc(g,p,M,O),Hg(g,p,M))},enqueueReplaceState:function(p,g,b){p=p._reactInternals;var O=qs(),M=bc(p),z=Bl(O,M);z.tag=1,z.payload=g,b!=null&&(z.callback=b),g=Kd(p,z,M),g!==null&&(wc(g,p,M,O),Hg(g,p,M))},enqueueForceUpdate:function(p,g){p=p._reactInternals;var b=qs(),O=bc(p),M=Bl(b,O);M.tag=2,g!=null&&(M.callback=g),g=Kd(p,M,O),g!==null&&(wc(g,p,O,b),Hg(g,p,O))}};function iT(p,g,b,O,M,z,ae){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(O,z,ae):g.prototype&&g.prototype.isPureReactComponent?!Og(b,O)||!Og(M,z):!0}function HC(p,g,b){var O=!1,M=zd,z=g.contextType;return typeof z=="object"&&z!==null?z=yc(z):(M=ha(g)?gp:co.current,O=g.contextTypes,z=(O=O!=null)?_p(p,M):zd),g=new g(b,z),p.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=hy,p.stateNode=g,g._reactInternals=p,O&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=M,p.__reactInternalMemoizedMaskedChildContext=z),g}function $C(p,g,b,O){p=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(b,O),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(b,O),g.state!==p&&hy.enqueueReplaceState(g,g.state,null)}function sT(p,g,b,O){var M=p.stateNode;M.props=b,M.state=p.memoizedState,M.refs={},Gg(p);var z=g.contextType;typeof z=="object"&&z!==null?M.context=yc(z):(z=ha(g)?gp:co.current,M.context=_p(p,z)),M.state=p.memoizedState,z=g.getDerivedStateFromProps,typeof z=="function"&&(dy(p,g,z,b),M.state=p.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof M.getSnapshotBeforeUpdate=="function"||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(g=M.state,typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount(),g!==M.state&&hy.enqueueReplaceState(M,M.state,null),sy(p,b,M,O),M.state=p.memoizedState),typeof M.componentDidMount=="function"&&(p.flags|=4194308)}function om(p,g){try{var b="",O=g;do b+=ze(O),O=O.return;while(O);var M=b}catch(z){M=`
Error generating stack: `+z.message+`
`+z.stack}return{value:p,source:g,stack:M,digest:null}}function oT(p,g,b){return{value:p,source:null,stack:b??null,digest:g??null}}function aT(p,g){try{console.error(g.value)}catch(b){setTimeout(function(){throw b})}}var l1=typeof WeakMap=="function"?WeakMap:Map;function cT(p,g,b){b=Bl(-1,b),b.tag=3,b.payload={element:null};var O=g.value;return b.callback=function(){Oy||(Oy=!0,yT=O),aT(p,g)},b}function Ju(p,g,b){b=Bl(-1,b),b.tag=3;var O=p.type.getDerivedStateFromError;if(typeof O=="function"){var M=g.value;b.payload=function(){return O(M)},b.callback=function(){aT(p,g)}}var z=p.stateNode;return z!==null&&typeof z.componentDidCatch=="function"&&(b.callback=function(){aT(p,g),typeof O!="function"&&(Jd===null?Jd=new Set([this]):Jd.add(this));var ae=g.stack;this.componentDidCatch(g.value,{componentStack:ae!==null?ae:""})}),b}function KC(p,g,b){var O=p.pingCache;if(O===null){O=p.pingCache=new l1;var M=new Set;O.set(g,M)}else M=O.get(g),M===void 0&&(M=new Set,O.set(g,M));M.has(b)||(M.add(b),p=_I.bind(null,p,g,b),g.then(p,p))}function qC(p){do{var g;if((g=p.tag===13)&&(g=p.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return p;p=p.return}while(p!==null);return null}function YC(p,g,b,O,M){return(p.mode&1)===0?(p===g?p.flags|=65536:(p.flags|=128,b.flags|=131072,b.flags&=-52805,b.tag===1&&(b.alternate===null?b.tag=17:(g=Bl(-1,1),g.tag=2,Kd(b,g,1))),b.lanes|=1),p):(p.flags|=65536,p.lanes=M,p)}var u1=de.ReactCurrentOwner,ga=!1;function Fo(p,g,b,O){g.child=p===null?AC(g,null,b,O):Qf(g,p.child,b,O)}function py(p,g,b,O,M){b=b.render;var z=g.ref;return Ku(g,M),O=rm(p,g,b,O,z,M),b=J0(),p!==null&&!ga?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~M,Gl(p,g,M)):(si&&b&&ey(g),g.flags|=1,Fo(p,g,O,M),g.child)}function XC(p,g,b,O,M){if(p===null){var z=b.type;return typeof z=="function"&&!Zd(z)&&z.defaultProps===void 0&&b.compare===null&&b.defaultProps===void 0?(g.tag=15,g.type=z,JC(p,g,z,O,M)):(p=Wy(b.type,null,O,g,g.mode,M),p.ref=g.ref,p.return=g,g.child=p)}if(z=p.child,(p.lanes&M)===0){var ae=z.memoizedProps;if(b=b.compare,b=b!==null?b:Og,b(ae,O)&&p.ref===g.ref)return Gl(p,g,M)}return g.flags|=1,p=ed(z,O),p.ref=g.ref,p.return=g,g.child=p}function JC(p,g,b,O,M){if(p!==null){var z=p.memoizedProps;if(Og(z,O)&&p.ref===g.ref)if(ga=!1,g.pendingProps=O=z,(p.lanes&M)!==0)(p.flags&131072)!==0&&(ga=!0);else return g.lanes=p.lanes,Gl(p,g,M)}return lT(p,g,b,O,M)}function QC(p,g,b){var O=g.pendingProps,M=O.children,z=p!==null?p.memoizedState:null;if(O.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},fi(ll,za),za|=b;else{if((b&1073741824)===0)return p=z!==null?z.baseLanes|b:b,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:p,cachePool:null,transitions:null},g.updateQueue=null,fi(ll,za),za|=p,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},O=z!==null?z.baseLanes:b,fi(ll,za),za|=O}else z!==null?(O=z.baseLanes|b,g.memoizedState=null):O=b,fi(ll,za),za|=O;return Fo(p,g,M,b),g.child}function ZC(p,g){var b=g.ref;(p===null&&b!==null||p!==null&&p.ref!==b)&&(g.flags|=512,g.flags|=2097152)}function lT(p,g,b,O,M){var z=ha(b)?gp:co.current;return z=_p(g,z),Ku(g,M),b=rm(p,g,b,O,z,M),O=J0(),p!==null&&!ga?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~M,Gl(p,g,M)):(si&&O&&ey(g),g.flags|=1,Fo(p,g,b,M),g.child)}function eI(p,g,b,O,M){if(ha(b)){var z=!0;XE(g)}else z=!1;if(Ku(g,M),g.stateNode===null)yy(p,g),HC(g,b,O),sT(g,b,O,M),O=!0;else if(p===null){var ae=g.stateNode,Ie=g.memoizedProps;ae.props=Ie;var xe=ae.context,it=b.contextType;typeof it=="object"&&it!==null?it=yc(it):(it=ha(b)?gp:co.current,it=_p(g,it));var It=b.getDerivedStateFromProps,At=typeof It=="function"||typeof ae.getSnapshotBeforeUpdate=="function";At||typeof ae.UNSAFE_componentWillReceiveProps!="function"&&typeof ae.componentWillReceiveProps!="function"||(Ie!==O||xe!==it)&&$C(g,ae,O,it),$d=!1;var Rt=g.memoizedState;ae.state=Rt,sy(g,O,ae,M),xe=g.memoizedState,Ie!==O||Rt!==xe||da.current||$d?(typeof It=="function"&&(dy(g,b,It,O),xe=g.memoizedState),(Ie=$d||iT(g,b,Ie,O,Rt,xe,it))?(At||typeof ae.UNSAFE_componentWillMount!="function"&&typeof ae.componentWillMount!="function"||(typeof ae.componentWillMount=="function"&&ae.componentWillMount(),typeof ae.UNSAFE_componentWillMount=="function"&&ae.UNSAFE_componentWillMount()),typeof ae.componentDidMount=="function"&&(g.flags|=4194308)):(typeof ae.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=O,g.memoizedState=xe),ae.props=O,ae.state=xe,ae.context=it,O=Ie):(typeof ae.componentDidMount=="function"&&(g.flags|=4194308),O=!1)}else{ae=g.stateNode,OC(p,g),Ie=g.memoizedProps,it=g.type===g.elementType?Ie:Wa(g.type,Ie),ae.props=it,At=g.pendingProps,Rt=ae.context,xe=b.contextType,typeof xe=="object"&&xe!==null?xe=yc(xe):(xe=ha(b)?gp:co.current,xe=_p(g,xe));var zt=b.getDerivedStateFromProps;(It=typeof zt=="function"||typeof ae.getSnapshotBeforeUpdate=="function")||typeof ae.UNSAFE_componentWillReceiveProps!="function"&&typeof ae.componentWillReceiveProps!="function"||(Ie!==At||Rt!==xe)&&$C(g,ae,O,xe),$d=!1,Rt=g.memoizedState,ae.state=Rt,sy(g,O,ae,M);var Zt=g.memoizedState;Ie!==At||Rt!==Zt||da.current||$d?(typeof zt=="function"&&(dy(g,b,zt,O),Zt=g.memoizedState),(it=$d||iT(g,b,it,O,Rt,Zt,xe)||!1)?(It||typeof ae.UNSAFE_componentWillUpdate!="function"&&typeof ae.componentWillUpdate!="function"||(typeof ae.componentWillUpdate=="function"&&ae.componentWillUpdate(O,Zt,xe),typeof ae.UNSAFE_componentWillUpdate=="function"&&ae.UNSAFE_componentWillUpdate(O,Zt,xe)),typeof ae.componentDidUpdate=="function"&&(g.flags|=4),typeof ae.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof ae.componentDidUpdate!="function"||Ie===p.memoizedProps&&Rt===p.memoizedState||(g.flags|=4),typeof ae.getSnapshotBeforeUpdate!="function"||Ie===p.memoizedProps&&Rt===p.memoizedState||(g.flags|=1024),g.memoizedProps=O,g.memoizedState=Zt),ae.props=O,ae.state=Zt,ae.context=xe,O=it):(typeof ae.componentDidUpdate!="function"||Ie===p.memoizedProps&&Rt===p.memoizedState||(g.flags|=4),typeof ae.getSnapshotBeforeUpdate!="function"||Ie===p.memoizedProps&&Rt===p.memoizedState||(g.flags|=1024),O=!1)}return fy(p,g,b,O,z,M)}function fy(p,g,b,O,M,z){ZC(p,g);var ae=(g.flags&128)!==0;if(!O&&!ae)return M&&TC(g,b,!1),Gl(p,g,z);O=g.stateNode,u1.current=g;var Ie=ae&&typeof b.getDerivedStateFromError!="function"?null:O.render();return g.flags|=1,p!==null&&ae?(g.child=Qf(g,p.child,null,z),g.child=Qf(g,null,Ie,z)):Fo(p,g,Ie,z),g.memoizedState=O.state,M&&TC(g,b,!0),g.child}function uT(p){var g=p.stateNode;g.pendingContext?SC(p,g.pendingContext,g.pendingContext!==g.context):g.context&&SC(p,g.context,!1),$0(p,g.containerInfo)}function tI(p,g,b,O,M){return Jf(),j0(M),g.flags|=256,Fo(p,g,b,O),g.child}var dT={dehydrated:null,treeContext:null,retryLane:0};function am(p){return{baseLanes:p,cachePool:null,transitions:null}}function my(p,g,b){var O=g.pendingProps,M=Ri.current,z=!1,ae=(g.flags&128)!==0,Ie;if((Ie=ae)||(Ie=p!==null&&p.memoizedState===null?!1:(M&2)!==0),Ie?(z=!0,g.flags&=-129):(p===null||p.memoizedState!==null)&&(M|=1),fi(Ri,M&1),p===null)return F0(g),p=g.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((g.mode&1)===0?g.lanes=1:p.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(ae=O.children,p=O.fallback,z?(O=g.mode,z=g.child,ae={mode:"hidden",children:ae},(O&1)===0&&z!==null?(z.childLanes=0,z.pendingProps=ae):z=eh(ae,O,0,null),p=Op(p,O,b,null),z.return=g,p.return=g,z.sibling=p,g.child=z,g.child.memoizedState=am(b),g.memoizedState=dT,p):gy(g,ae));if(M=p.memoizedState,M!==null&&(Ie=M.dehydrated,Ie!==null))return nI(p,g,ae,O,Ie,M,b);if(z){z=O.fallback,ae=g.mode,M=p.child,Ie=M.sibling;var xe={mode:"hidden",children:O.children};return(ae&1)===0&&g.child!==M?(O=g.child,O.childLanes=0,O.pendingProps=xe,g.deletions=null):(O=ed(M,xe),O.subtreeFlags=M.subtreeFlags&14680064),Ie!==null?z=ed(Ie,z):(z=Op(z,ae,b,null),z.flags|=2),z.return=g,O.return=g,O.sibling=z,g.child=O,O=z,z=g.child,ae=p.child.memoizedState,ae=ae===null?am(b):{baseLanes:ae.baseLanes|b,cachePool:null,transitions:ae.transitions},z.memoizedState=ae,z.childLanes=p.childLanes&~b,g.memoizedState=dT,O}return z=p.child,p=z.sibling,O=ed(z,{mode:"visible",children:O.children}),(g.mode&1)===0&&(O.lanes=b),O.return=g,O.sibling=null,p!==null&&(b=g.deletions,b===null?(g.deletions=[p],g.flags|=16):b.push(p)),g.child=O,g.memoizedState=null,O}function gy(p,g){return g=eh({mode:"visible",children:g},p.mode,0,null),g.return=p,p.child=g}function wp(p,g,b,O){return O!==null&&j0(O),Qf(g,p.child,null,b),p=gy(g,g.pendingProps.children),p.flags|=2,g.memoizedState=null,p}function nI(p,g,b,O,M,z,ae){if(b)return g.flags&256?(g.flags&=-257,O=oT(Error(s(422))),wp(p,g,ae,O)):g.memoizedState!==null?(g.child=p.child,g.flags|=128,null):(z=O.fallback,M=g.mode,O=eh({mode:"visible",children:O.children},M,0,null),z=Op(z,M,ae,null),z.flags|=2,O.return=g,z.return=g,O.sibling=z,g.child=O,(g.mode&1)!==0&&Qf(g,p.child,null,ae),g.child.memoizedState=am(ae),g.memoizedState=dT,z);if((g.mode&1)===0)return wp(p,g,ae,null);if(M.data==="$!"){if(O=M.nextSibling&&M.nextSibling.dataset,O)var Ie=O.dgst;return O=Ie,z=Error(s(419)),O=oT(z,O,void 0),wp(p,g,ae,O)}if(Ie=(ae&p.childLanes)!==0,ga||Ie){if(O=Vs,O!==null){switch(ae&-ae){case 4:M=2;break;case 16:M=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:M=32;break;case 536870912:M=268435456;break;default:M=0}M=(M&(O.suspendedLanes|ae))!==0?0:M,M!==0&&M!==z.retryLane&&(z.retryLane=M,qu(p,M),wc(O,p,M,-1))}return TT(),O=oT(Error(s(421))),wp(p,g,ae,O)}return M.data==="$?"?(g.flags|=128,g.child=p.child,g=Fy.bind(null,p),M._reactRetry=g,null):(p=z.treeContext,fa=Bd(M.nextSibling),pa=g,si=!0,Uo=null,p!==null&&(Ec[Ba++]=Gu,Ec[Ba++]=Hu,Ec[Ba++]=Ep,Gu=p.id,Hu=p.overflow,Ep=g),g=gy(g,O.children),g.flags|=4096,g)}function rI(p,g,b){p.lanes|=g;var O=p.alternate;O!==null&&(O.lanes|=g),G0(p.return,g,b)}function _y(p,g,b,O,M){var z=p.memoizedState;z===null?p.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:O,tail:b,tailMode:M}:(z.isBackwards=g,z.rendering=null,z.renderingStartTime=0,z.last=O,z.tail=b,z.tailMode=M)}function Ey(p,g,b){var O=g.pendingProps,M=O.revealOrder,z=O.tail;if(Fo(p,g,O.children,b),O=Ri.current,(O&2)!==0)O=O&1|2,g.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=g.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&rI(p,b,g);else if(p.tag===19)rI(p,b,g);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===g)break e;for(;p.sibling===null;){if(p.return===null||p.return===g)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}O&=1}if(fi(Ri,O),(g.mode&1)===0)g.memoizedState=null;else switch(M){case"forwards":for(b=g.child,M=null;b!==null;)p=b.alternate,p!==null&&qd(p)===null&&(M=b),b=b.sibling;b=M,b===null?(M=g.child,g.child=null):(M=b.sibling,b.sibling=null),_y(g,!1,M,b,z);break;case"backwards":for(b=null,M=g.child,g.child=null;M!==null;){if(p=M.alternate,p!==null&&qd(p)===null){g.child=M;break}p=M.sibling,M.sibling=b,b=M,M=p}_y(g,!0,b,null,z);break;case"together":_y(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function yy(p,g){(g.mode&1)===0&&p!==null&&(p.alternate=null,g.alternate=null,g.flags|=2)}function Gl(p,g,b){if(p!==null&&(g.dependencies=p.dependencies),Rp|=g.lanes,(b&g.childLanes)===0)return null;if(p!==null&&g.child!==p.child)throw Error(s(153));if(g.child!==null){for(p=g.child,b=ed(p,p.pendingProps),g.child=b,b.return=g;p.sibling!==null;)p=p.sibling,b=b.sibling=ed(p,p.pendingProps),b.return=g;b.sibling=null}return g.child}function iI(p,g,b){switch(g.tag){case 3:uT(g),Jf();break;case 5:DC(g);break;case 1:ha(g.type)&&XE(g);break;case 4:$0(g,g.stateNode.containerInfo);break;case 10:var O=g.type._context,M=g.memoizedProps.value;fi(ry,O._currentValue),O._currentValue=M;break;case 13:if(O=g.memoizedState,O!==null)return O.dehydrated!==null?(fi(Ri,Ri.current&1),g.flags|=128,null):(b&g.child.childLanes)!==0?my(p,g,b):(fi(Ri,Ri.current&1),p=Gl(p,g,b),p!==null?p.sibling:null);fi(Ri,Ri.current&1);break;case 19:if(O=(b&g.childLanes)!==0,(p.flags&128)!==0){if(O)return Ey(p,g,b);g.flags|=128}if(M=g.memoizedState,M!==null&&(M.rendering=null,M.tail=null,M.lastEffect=null),fi(Ri,Ri.current),O)break;return null;case 22:case 23:return g.lanes=0,QC(p,g,b)}return Gl(p,g,b)}var sI,vy,hT,oI;sI=function(p,g){for(var b=g.child;b!==null;){if(b.tag===5||b.tag===6)p.appendChild(b.stateNode);else if(b.tag!==4&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===g)break;for(;b.sibling===null;){if(b.return===null||b.return===g)return;b=b.return}b.sibling.return=b.return,b=b.sibling}},vy=function(){},hT=function(p,g,b,O){var M=p.memoizedProps;if(M!==O){p=g.stateNode,vp(Wl.current);var z=null;switch(b){case"input":M=Ln(p,M),O=Ln(p,O),z=[];break;case"select":M=Ne({},M,{value:void 0}),O=Ne({},O,{value:void 0}),z=[];break;case"textarea":M=yt(p,M),O=yt(p,O),z=[];break;default:typeof M.onClick!="function"&&typeof O.onClick=="function"&&(p.onclick=$E)}Da(b,O);var ae;b=null;for(it in M)if(!O.hasOwnProperty(it)&&M.hasOwnProperty(it)&&M[it]!=null)if(it==="style"){var Ie=M[it];for(ae in Ie)Ie.hasOwnProperty(ae)&&(b||(b={}),b[ae]="")}else it!=="dangerouslySetInnerHTML"&&it!=="children"&&it!=="suppressContentEditableWarning"&&it!=="suppressHydrationWarning"&&it!=="autoFocus"&&(l.hasOwnProperty(it)?z||(z=[]):(z=z||[]).push(it,null));for(it in O){var xe=O[it];if(Ie=M!=null?M[it]:void 0,O.hasOwnProperty(it)&&xe!==Ie&&(xe!=null||Ie!=null))if(it==="style")if(Ie){for(ae in Ie)!Ie.hasOwnProperty(ae)||xe&&xe.hasOwnProperty(ae)||(b||(b={}),b[ae]="");for(ae in xe)xe.hasOwnProperty(ae)&&Ie[ae]!==xe[ae]&&(b||(b={}),b[ae]=xe[ae])}else b||(z||(z=[]),z.push(it,b)),b=xe;else it==="dangerouslySetInnerHTML"?(xe=xe?xe.__html:void 0,Ie=Ie?Ie.__html:void 0,xe!=null&&Ie!==xe&&(z=z||[]).push(it,xe)):it==="children"?typeof xe!="string"&&typeof xe!="number"||(z=z||[]).push(it,""+xe):it!=="suppressContentEditableWarning"&&it!=="suppressHydrationWarning"&&(l.hasOwnProperty(it)?(xe!=null&&it==="onScroll"&&vi("scroll",p),z||Ie===xe||(z=[])):(z=z||[]).push(it,xe))}b&&(z=z||[]).push("style",b);var it=z;(g.updateQueue=it)&&(g.flags|=4)}},oI=function(p,g,b,O){b!==O&&(g.flags|=4)};function Qg(p,g){if(!si)switch(p.tailMode){case"hidden":g=p.tail;for(var b=null;g!==null;)g.alternate!==null&&(b=g),g=g.sibling;b===null?p.tail=null:b.sibling=null;break;case"collapsed":b=p.tail;for(var O=null;b!==null;)b.alternate!==null&&(O=b),b=b.sibling;O===null?g||p.tail===null?p.tail=null:p.tail.sibling=null:O.sibling=null}}function uo(p){var g=p.alternate!==null&&p.alternate.child===p.child,b=0,O=0;if(g)for(var M=p.child;M!==null;)b|=M.lanes|M.childLanes,O|=M.subtreeFlags&14680064,O|=M.flags&14680064,M.return=p,M=M.sibling;else for(M=p.child;M!==null;)b|=M.lanes|M.childLanes,O|=M.subtreeFlags,O|=M.flags,M.return=p,M=M.sibling;return p.subtreeFlags|=O,p.childLanes=b,g}function Sy(p,g,b){var O=g.pendingProps;switch(jg(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return uo(g),null;case 1:return ha(g.type)&&qE(),uo(g),null;case 3:return O=g.stateNode,Sp(),Si(da),Si(co),q0(),O.pendingContext&&(O.context=O.pendingContext,O.pendingContext=null),(p===null||p.child===null)&&(Bg(g)?g.flags|=4:p===null||p.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,Uo!==null&&(xy(Uo),Uo=null))),vy(p,g),uo(g),null;case 5:tm(g);var M=vp(em.current);if(b=g.type,p!==null&&g.stateNode!=null)hT(p,g,b,O,M),p.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!O){if(g.stateNode===null)throw Error(s(166));return uo(g),null}if(p=vp(Wl.current),Bg(g)){O=g.stateNode,b=g.type;var z=g.memoizedProps;switch(O[jl]=g,O[Wd]=z,p=(g.mode&1)!==0,b){case"dialog":vi("cancel",O),vi("close",O);break;case"iframe":case"object":case"embed":vi("load",O);break;case"video":case"audio":for(M=0;M<Lg.length;M++)vi(Lg[M],O);break;case"source":vi("error",O);break;case"img":case"image":case"link":vi("error",O),vi("load",O);break;case"details":vi("toggle",O);break;case"input":qt(O,z),vi("invalid",O);break;case"select":O._wrapperState={wasMultiple:!!z.multiple},vi("invalid",O);break;case"textarea":Ge(O,z),vi("invalid",O)}Da(b,z),M=null;for(var ae in z)if(z.hasOwnProperty(ae)){var Ie=z[ae];ae==="children"?typeof Ie=="string"?O.textContent!==Ie&&(z.suppressHydrationWarning!==!0&&HE(O.textContent,Ie,p),M=["children",Ie]):typeof Ie=="number"&&O.textContent!==""+Ie&&(z.suppressHydrationWarning!==!0&&HE(O.textContent,Ie,p),M=["children",""+Ie]):l.hasOwnProperty(ae)&&Ie!=null&&ae==="onScroll"&&vi("scroll",O)}switch(b){case"input":dn(O),Re(O,z,!0);break;case"textarea":dn(O),Yt(O);break;case"select":case"option":break;default:typeof z.onClick=="function"&&(O.onclick=$E)}O=M,g.updateQueue=O,O!==null&&(g.flags|=4)}else{ae=M.nodeType===9?M:M.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=hn(b)),p==="http://www.w3.org/1999/xhtml"?b==="script"?(p=ae.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof O.is=="string"?p=ae.createElement(b,{is:O.is}):(p=ae.createElement(b),b==="select"&&(ae=p,O.multiple?ae.multiple=!0:O.size&&(ae.size=O.size))):p=ae.createElementNS(p,b),p[jl]=g,p[Wd]=O,sI(p,g,!1,!1),g.stateNode=p;e:{switch(ae=Zc(b,O),b){case"dialog":vi("cancel",p),vi("close",p),M=O;break;case"iframe":case"object":case"embed":vi("load",p),M=O;break;case"video":case"audio":for(M=0;M<Lg.length;M++)vi(Lg[M],p);M=O;break;case"source":vi("error",p),M=O;break;case"img":case"image":case"link":vi("error",p),vi("load",p),M=O;break;case"details":vi("toggle",p),M=O;break;case"input":qt(p,O),M=Ln(p,O),vi("invalid",p);break;case"option":M=O;break;case"select":p._wrapperState={wasMultiple:!!O.multiple},M=Ne({},O,{value:void 0}),vi("invalid",p);break;case"textarea":Ge(p,O),M=yt(p,O),vi("invalid",p);break;default:M=O}Da(b,M),Ie=M;for(z in Ie)if(Ie.hasOwnProperty(z)){var xe=Ie[z];z==="style"?yi(p,xe):z==="dangerouslySetInnerHTML"?(xe=xe?xe.__html:void 0,xe!=null&&na(p,xe)):z==="children"?typeof xe=="string"?(b!=="textarea"||xe!=="")&&Vt(p,xe):typeof xe=="number"&&Vt(p,""+xe):z!=="suppressContentEditableWarning"&&z!=="suppressHydrationWarning"&&z!=="autoFocus"&&(l.hasOwnProperty(z)?xe!=null&&z==="onScroll"&&vi("scroll",p):xe!=null&&ee(p,z,xe,ae))}switch(b){case"input":dn(p),Re(p,O,!1);break;case"textarea":dn(p),Yt(p);break;case"option":O.value!=null&&p.setAttribute("value",""+dt(O.value));break;case"select":p.multiple=!!O.multiple,z=O.value,z!=null?_t(p,!!O.multiple,z,!1):O.defaultValue!=null&&_t(p,!!O.multiple,O.defaultValue,!0);break;default:typeof M.onClick=="function"&&(p.onclick=$E)}switch(b){case"button":case"input":case"select":case"textarea":O=!!O.autoFocus;break e;case"img":O=!0;break e;default:O=!1}}O&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return uo(g),null;case 6:if(p&&g.stateNode!=null)oI(p,g,p.memoizedProps,O);else{if(typeof O!="string"&&g.stateNode===null)throw Error(s(166));if(b=vp(em.current),vp(Wl.current),Bg(g)){if(O=g.stateNode,b=g.memoizedProps,O[jl]=g,(z=O.nodeValue!==b)&&(p=pa,p!==null))switch(p.tag){case 3:HE(O.nodeValue,b,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&HE(O.nodeValue,b,(p.mode&1)!==0)}z&&(g.flags|=4)}else O=(b.nodeType===9?b:b.ownerDocument).createTextNode(O),O[jl]=g,g.stateNode=O}return uo(g),null;case 13:if(Si(Ri),O=g.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(si&&fa!==null&&(g.mode&1)!==0&&(g.flags&128)===0)IC(),Jf(),g.flags|=98560,z=!1;else if(z=Bg(g),O!==null&&O.dehydrated!==null){if(p===null){if(!z)throw Error(s(318));if(z=g.memoizedState,z=z!==null?z.dehydrated:null,!z)throw Error(s(317));z[jl]=g}else Jf(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;uo(g),z=!1}else Uo!==null&&(xy(Uo),Uo=null),z=!0;if(!z)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=b,g):(O=O!==null,O!==(p!==null&&p.memoizedState!==null)&&O&&(g.child.flags|=8192,(g.mode&1)!==0&&(p===null||(Ri.current&1)!==0?ps===0&&(ps=3):TT())),g.updateQueue!==null&&(g.flags|=4),uo(g),null);case 4:return Sp(),vy(p,g),p===null&&hp(g.stateNode.containerInfo),uo(g),null;case 10:return z0(g.type._context),uo(g),null;case 17:return ha(g.type)&&qE(),uo(g),null;case 19:if(Si(Ri),z=g.memoizedState,z===null)return uo(g),null;if(O=(g.flags&128)!==0,ae=z.rendering,ae===null)if(O)Qg(z,!1);else{if(ps!==0||p!==null&&(p.flags&128)!==0)for(p=g.child;p!==null;){if(ae=qd(p),ae!==null){for(g.flags|=128,Qg(z,!1),O=ae.updateQueue,O!==null&&(g.updateQueue=O,g.flags|=4),g.subtreeFlags=0,O=b,b=g.child;b!==null;)z=b,p=O,z.flags&=14680066,ae=z.alternate,ae===null?(z.childLanes=0,z.lanes=p,z.child=null,z.subtreeFlags=0,z.memoizedProps=null,z.memoizedState=null,z.updateQueue=null,z.dependencies=null,z.stateNode=null):(z.childLanes=ae.childLanes,z.lanes=ae.lanes,z.child=ae.child,z.subtreeFlags=0,z.deletions=null,z.memoizedProps=ae.memoizedProps,z.memoizedState=ae.memoizedState,z.updateQueue=ae.updateQueue,z.type=ae.type,p=ae.dependencies,z.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),b=b.sibling;return fi(Ri,Ri.current&1|2),g.child}p=p.sibling}z.tail!==null&&Fr()>um&&(g.flags|=128,O=!0,Qg(z,!1),g.lanes=4194304)}else{if(!O)if(p=qd(ae),p!==null){if(g.flags|=128,O=!0,b=p.updateQueue,b!==null&&(g.updateQueue=b,g.flags|=4),Qg(z,!0),z.tail===null&&z.tailMode==="hidden"&&!ae.alternate&&!si)return uo(g),null}else 2*Fr()-z.renderingStartTime>um&&b!==1073741824&&(g.flags|=128,O=!0,Qg(z,!1),g.lanes=4194304);z.isBackwards?(ae.sibling=g.child,g.child=ae):(b=z.last,b!==null?b.sibling=ae:g.child=ae,z.last=ae)}return z.tail!==null?(g=z.tail,z.rendering=g,z.tail=g.sibling,z.renderingStartTime=Fr(),g.sibling=null,b=Ri.current,fi(Ri,O?b&1|2:b&1),g):(uo(g),null);case 22:case 23:return o_(),O=g.memoizedState!==null,p!==null&&p.memoizedState!==null!==O&&(g.flags|=8192),O&&(g.mode&1)!==0?(za&1073741824)!==0&&(uo(g),g.subtreeFlags&6&&(g.flags|=8192)):uo(g),null;case 24:return null;case 25:return null}throw Error(s(156,g.tag))}function d1(p,g){switch(jg(g),g.tag){case 1:return ha(g.type)&&qE(),p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 3:return Sp(),Si(da),Si(co),q0(),p=g.flags,(p&65536)!==0&&(p&128)===0?(g.flags=p&-65537|128,g):null;case 5:return tm(g),null;case 13:if(Si(Ri),p=g.memoizedState,p!==null&&p.dehydrated!==null){if(g.alternate===null)throw Error(s(340));Jf()}return p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 19:return Si(Ri),null;case 4:return Sp(),null;case 10:return z0(g.type._context),null;case 22:case 23:return o_(),null;case 24:return null;default:return null}}var Ty=!1,ho=!1,aI=typeof WeakSet=="function"?WeakSet:Set,Xt=null;function cm(p,g){var b=p.ref;if(b!==null)if(typeof b=="function")try{b(null)}catch(O){ki(p,g,O)}else b.current=null}function Zg(p,g,b){try{b()}catch(O){ki(p,g,O)}}var cI=!1;function pT(p,g){if(KE=ve,p=lC(),kg(p)){if("selectionStart"in p)var b={start:p.selectionStart,end:p.selectionEnd};else e:{b=(b=p.ownerDocument)&&b.defaultView||window;var O=b.getSelection&&b.getSelection();if(O&&O.rangeCount!==0){b=O.anchorNode;var M=O.anchorOffset,z=O.focusNode;O=O.focusOffset;try{b.nodeType,z.nodeType}catch{b=null;break e}var ae=0,Ie=-1,xe=-1,it=0,It=0,At=p,Rt=null;t:for(;;){for(var zt;At!==b||M!==0&&At.nodeType!==3||(Ie=ae+M),At!==z||O!==0&&At.nodeType!==3||(xe=ae+O),At.nodeType===3&&(ae+=At.nodeValue.length),(zt=At.firstChild)!==null;)Rt=At,At=zt;for(;;){if(At===p)break t;if(Rt===b&&++it===M&&(Ie=ae),Rt===z&&++It===O&&(xe=ae),(zt=At.nextSibling)!==null)break;At=Rt,Rt=At.parentNode}At=zt}b=Ie===-1||xe===-1?null:{start:Ie,end:xe}}else b=null}b=b||{start:0,end:0}}else b=null;for(Mg={focusedElem:p,selectionRange:b},ve=!1,Xt=g;Xt!==null;)if(g=Xt,p=g.child,(g.subtreeFlags&1028)!==0&&p!==null)p.return=g,Xt=p;else for(;Xt!==null;){g=Xt;try{var Zt=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(Zt!==null){var en=Zt.memoizedProps,Hi=Zt.memoizedState,Je=g.stateNode,Ve=Je.getSnapshotBeforeUpdate(g.elementType===g.type?en:Wa(g.type,en),Hi);Je.__reactInternalSnapshotBeforeUpdate=Ve}break;case 3:var Ze=g.stateNode.containerInfo;Ze.nodeType===1?Ze.textContent="":Ze.nodeType===9&&Ze.documentElement&&Ze.removeChild(Ze.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(Nt){ki(g,g.return,Nt)}if(p=g.sibling,p!==null){p.return=g.return,Xt=p;break}Xt=g.return}return Zt=cI,cI=!1,Zt}function e_(p,g,b){var O=g.updateQueue;if(O=O!==null?O.lastEffect:null,O!==null){var M=O=O.next;do{if((M.tag&p)===p){var z=M.destroy;M.destroy=void 0,z!==void 0&&Zg(g,b,z)}M=M.next}while(M!==O)}}function t_(p,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var b=g=g.next;do{if((b.tag&p)===p){var O=b.create;b.destroy=O()}b=b.next}while(b!==g)}}function fT(p){var g=p.ref;if(g!==null){var b=p.stateNode;switch(p.tag){case 5:p=b;break;default:p=b}typeof g=="function"?g(p):g.current=p}}function lI(p){var g=p.alternate;g!==null&&(p.alternate=null,lI(g)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(g=p.stateNode,g!==null&&(delete g[jl],delete g[Wd],delete g[Vg],delete g[e1],delete g[t1])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function mT(p){return p.tag===5||p.tag===3||p.tag===4}function uI(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||mT(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function gT(p,g,b){var O=p.tag;if(O===5||O===6)p=p.stateNode,g?b.nodeType===8?b.parentNode.insertBefore(p,g):b.insertBefore(p,g):(b.nodeType===8?(g=b.parentNode,g.insertBefore(p,b)):(g=b,g.appendChild(p)),b=b._reactRootContainer,b!=null||g.onclick!==null||(g.onclick=$E));else if(O!==4&&(p=p.child,p!==null))for(gT(p,g,b),p=p.sibling;p!==null;)gT(p,g,b),p=p.sibling}function by(p,g,b){var O=p.tag;if(O===5||O===6)p=p.stateNode,g?b.insertBefore(p,g):b.appendChild(p);else if(O!==4&&(p=p.child,p!==null))for(by(p,g,b),p=p.sibling;p!==null;)by(p,g,b),p=p.sibling}var $s=null,Sc=!1;function Hl(p,g,b){for(b=b.child;b!==null;)dI(p,g,b),b=b.sibling}function dI(p,g,b){if(ao&&typeof ao.onCommitFiberUnmount=="function")try{ao.onCommitFiberUnmount(Nl,b)}catch{}switch(b.tag){case 5:ho||cm(b,g);case 6:var O=$s,M=Sc;$s=null,Hl(p,g,b),$s=O,Sc=M,$s!==null&&(Sc?(p=$s,b=b.stateNode,p.nodeType===8?p.parentNode.removeChild(b):p.removeChild(b)):$s.removeChild(b.stateNode));break;case 18:$s!==null&&(Sc?(p=$s,b=b.stateNode,p.nodeType===8?M0(p.parentNode,b):p.nodeType===1&&M0(p,b),la(p)):M0($s,b.stateNode));break;case 4:O=$s,M=Sc,$s=b.stateNode.containerInfo,Sc=!0,Hl(p,g,b),$s=O,Sc=M;break;case 0:case 11:case 14:case 15:if(!ho&&(O=b.updateQueue,O!==null&&(O=O.lastEffect,O!==null))){M=O=O.next;do{var z=M,ae=z.destroy;z=z.tag,ae!==void 0&&((z&2)!==0||(z&4)!==0)&&Zg(b,g,ae),M=M.next}while(M!==O)}Hl(p,g,b);break;case 1:if(!ho&&(cm(b,g),O=b.stateNode,typeof O.componentWillUnmount=="function"))try{O.props=b.memoizedProps,O.state=b.memoizedState,O.componentWillUnmount()}catch(Ie){ki(b,g,Ie)}Hl(p,g,b);break;case 21:Hl(p,g,b);break;case 22:b.mode&1?(ho=(O=ho)||b.memoizedState!==null,Hl(p,g,b),ho=O):Hl(p,g,b);break;default:Hl(p,g,b)}}function hI(p){var g=p.updateQueue;if(g!==null){p.updateQueue=null;var b=p.stateNode;b===null&&(b=p.stateNode=new aI),g.forEach(function(O){var M=EI.bind(null,p,O);b.has(O)||(b.add(O),O.then(M,M))})}}function jo(p,g){var b=g.deletions;if(b!==null)for(var O=0;O<b.length;O++){var M=b[O];try{var z=p,ae=g,Ie=ae;e:for(;Ie!==null;){switch(Ie.tag){case 5:$s=Ie.stateNode,Sc=!1;break e;case 3:$s=Ie.stateNode.containerInfo,Sc=!0;break e;case 4:$s=Ie.stateNode.containerInfo,Sc=!0;break e}Ie=Ie.return}if($s===null)throw Error(s(160));dI(z,ae,M),$s=null,Sc=!1;var xe=M.alternate;xe!==null&&(xe.return=null),M.return=null}catch(it){ki(M,g,it)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)_T(g,p),g=g.sibling}function _T(p,g){var b=p.alternate,O=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(jo(g,p),_a(p),O&4){try{e_(3,p,p.return),t_(3,p)}catch(en){ki(p,p.return,en)}try{e_(5,p,p.return)}catch(en){ki(p,p.return,en)}}break;case 1:jo(g,p),_a(p),O&512&&b!==null&&cm(b,b.return);break;case 5:if(jo(g,p),_a(p),O&512&&b!==null&&cm(b,b.return),p.flags&32){var M=p.stateNode;try{Vt(M,"")}catch(en){ki(p,p.return,en)}}if(O&4&&(M=p.stateNode,M!=null)){var z=p.memoizedProps,ae=b!==null?b.memoizedProps:z,Ie=p.type,xe=p.updateQueue;if(p.updateQueue=null,xe!==null)try{Ie==="input"&&z.type==="radio"&&z.name!=null&&Yn(M,z),Zc(Ie,ae);var it=Zc(Ie,z);for(ae=0;ae<xe.length;ae+=2){var It=xe[ae],At=xe[ae+1];It==="style"?yi(M,At):It==="dangerouslySetInnerHTML"?na(M,At):It==="children"?Vt(M,At):ee(M,It,At,it)}switch(Ie){case"input":$t(M,z);break;case"textarea":Pt(M,z);break;case"select":var Rt=M._wrapperState.wasMultiple;M._wrapperState.wasMultiple=!!z.multiple;var zt=z.value;zt!=null?_t(M,!!z.multiple,zt,!1):Rt!==!!z.multiple&&(z.defaultValue!=null?_t(M,!!z.multiple,z.defaultValue,!0):_t(M,!!z.multiple,z.multiple?[]:"",!1))}M[Wd]=z}catch(en){ki(p,p.return,en)}}break;case 6:if(jo(g,p),_a(p),O&4){if(p.stateNode===null)throw Error(s(162));M=p.stateNode,z=p.memoizedProps;try{M.nodeValue=z}catch(en){ki(p,p.return,en)}}break;case 3:if(jo(g,p),_a(p),O&4&&b!==null&&b.memoizedState.isDehydrated)try{la(g.containerInfo)}catch(en){ki(p,p.return,en)}break;case 4:jo(g,p),_a(p);break;case 13:jo(g,p),_a(p),M=p.child,M.flags&8192&&(z=M.memoizedState!==null,M.stateNode.isHidden=z,!z||M.alternate!==null&&M.alternate.memoizedState!==null||(Py=Fr())),O&4&&hI(p);break;case 22:if(It=b!==null&&b.memoizedState!==null,p.mode&1?(ho=(it=ho)||It,jo(g,p),ho=it):jo(g,p),_a(p),O&8192){if(it=p.memoizedState!==null,(p.stateNode.isHidden=it)&&!It&&(p.mode&1)!==0)for(Xt=p,It=p.child;It!==null;){for(At=Xt=It;Xt!==null;){switch(Rt=Xt,zt=Rt.child,Rt.tag){case 0:case 11:case 14:case 15:e_(4,Rt,Rt.return);break;case 1:cm(Rt,Rt.return);var Zt=Rt.stateNode;if(typeof Zt.componentWillUnmount=="function"){O=Rt,b=Rt.return;try{g=O,Zt.props=g.memoizedProps,Zt.state=g.memoizedState,Zt.componentWillUnmount()}catch(en){ki(O,b,en)}}break;case 5:cm(Rt,Rt.return);break;case 22:if(Rt.memoizedState!==null){n_(At);continue}}zt!==null?(zt.return=Rt,Xt=zt):n_(At)}It=It.sibling}e:for(It=null,At=p;;){if(At.tag===5){if(It===null){It=At;try{M=At.stateNode,it?(z=M.style,typeof z.setProperty=="function"?z.setProperty("display","none","important"):z.display="none"):(Ie=At.stateNode,xe=At.memoizedProps.style,ae=xe!=null&&xe.hasOwnProperty("display")?xe.display:null,Ie.style.display=di("display",ae))}catch(en){ki(p,p.return,en)}}}else if(At.tag===6){if(It===null)try{At.stateNode.nodeValue=it?"":At.memoizedProps}catch(en){ki(p,p.return,en)}}else if((At.tag!==22&&At.tag!==23||At.memoizedState===null||At===p)&&At.child!==null){At.child.return=At,At=At.child;continue}if(At===p)break e;for(;At.sibling===null;){if(At.return===null||At.return===p)break e;It===At&&(It=null),At=At.return}It===At&&(It=null),At.sibling.return=At.return,At=At.sibling}}break;case 19:jo(g,p),_a(p),O&4&&hI(p);break;case 21:break;default:jo(g,p),_a(p)}}function _a(p){var g=p.flags;if(g&2){try{e:{for(var b=p.return;b!==null;){if(mT(b)){var O=b;break e}b=b.return}throw Error(s(160))}switch(O.tag){case 5:var M=O.stateNode;O.flags&32&&(Vt(M,""),O.flags&=-33);var z=uI(p);by(p,z,M);break;case 3:case 4:var ae=O.stateNode.containerInfo,Ie=uI(p);gT(p,Ie,ae);break;default:throw Error(s(161))}}catch(xe){ki(p,p.return,xe)}p.flags&=-3}g&4096&&(p.flags&=-4097)}function lm(p,g,b){Xt=p,ET(p)}function ET(p,g,b){for(var O=(p.mode&1)!==0;Xt!==null;){var M=Xt,z=M.child;if(M.tag===22&&O){var ae=M.memoizedState!==null||Ty;if(!ae){var Ie=M.alternate,xe=Ie!==null&&Ie.memoizedState!==null||ho;Ie=Ty;var it=ho;if(Ty=ae,(ho=xe)&&!it)for(Xt=M;Xt!==null;)ae=Xt,xe=ae.child,ae.tag===22&&ae.memoizedState!==null?pI(M):xe!==null?(xe.return=ae,Xt=xe):pI(M);for(;z!==null;)Xt=z,ET(z),z=z.sibling;Xt=M,Ty=Ie,ho=it}wy(p)}else(M.subtreeFlags&8772)!==0&&z!==null?(z.return=M,Xt=z):wy(p)}}function wy(p){for(;Xt!==null;){var g=Xt;if((g.flags&8772)!==0){var b=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:ho||t_(5,g);break;case 1:var O=g.stateNode;if(g.flags&4&&!ho)if(b===null)O.componentDidMount();else{var M=g.elementType===g.type?b.memoizedProps:Wa(g.type,b.memoizedProps);O.componentDidUpdate(M,b.memoizedState,O.__reactInternalSnapshotBeforeUpdate)}var z=g.updateQueue;z!==null&&NC(g,z,O);break;case 3:var ae=g.updateQueue;if(ae!==null){if(b=null,g.child!==null)switch(g.child.tag){case 5:b=g.child.stateNode;break;case 1:b=g.child.stateNode}NC(g,ae,b)}break;case 5:var Ie=g.stateNode;if(b===null&&g.flags&4){b=Ie;var xe=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":xe.autoFocus&&b.focus();break;case"img":xe.src&&(b.src=xe.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var it=g.alternate;if(it!==null){var It=it.memoizedState;if(It!==null){var At=It.dehydrated;At!==null&&la(At)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(s(163))}ho||g.flags&512&&fT(g)}catch(Rt){ki(g,g.return,Rt)}}if(g===p){Xt=null;break}if(b=g.sibling,b!==null){b.return=g.return,Xt=b;break}Xt=g.return}}function n_(p){for(;Xt!==null;){var g=Xt;if(g===p){Xt=null;break}var b=g.sibling;if(b!==null){b.return=g.return,Xt=b;break}Xt=g.return}}function pI(p){for(;Xt!==null;){var g=Xt;try{switch(g.tag){case 0:case 11:case 15:var b=g.return;try{t_(4,g)}catch(xe){ki(g,b,xe)}break;case 1:var O=g.stateNode;if(typeof O.componentDidMount=="function"){var M=g.return;try{O.componentDidMount()}catch(xe){ki(g,M,xe)}}var z=g.return;try{fT(g)}catch(xe){ki(g,z,xe)}break;case 5:var ae=g.return;try{fT(g)}catch(xe){ki(g,ae,xe)}}}catch(xe){ki(g,g.return,xe)}if(g===p){Xt=null;break}var Ie=g.sibling;if(Ie!==null){Ie.return=g.return,Xt=Ie;break}Xt=g.return}}var h1=Math.ceil,Ry=de.ReactCurrentDispatcher,Cy=de.ReactCurrentOwner,Tc=de.ReactCurrentBatchConfig,Tr=0,Vs=null,Gi=null,hs=0,za=0,ll=gc(0),ps=0,Ks=null,Rp=0,Iy=0,Ay=0,r_=null,Bo=null,Py=0,um=1/0,$l=null,Oy=!1,yT=null,Jd=null,dm=!1,Kl=null,ky=0,Cp=0,vT=null,i_=-1,Ny=0;function qs(){return(Tr&6)!==0?Fr():i_!==-1?i_:i_=Fr()}function bc(p){return(p.mode&1)===0?1:(Tr&2)!==0&&hs!==0?hs&-hs:r1.transition!==null?(Ny===0&&(Ny=Mu()),Ny):(p=nr,p!==0||(p=window.event,p=p===void 0?16:jr(p.type)),p)}function wc(p,g,b,O){if(50<Cp)throw Cp=0,vT=null,Error(s(185));xl(p,b,O),((Tr&2)===0||p!==Vs)&&(p===Vs&&((Tr&2)===0&&(Iy|=b),ps===4&&Qu(p,hs)),po(p,O),b===1&&Tr===0&&(g.mode&1)===0&&(um=Fr()+500,JE&&Gd()))}function po(p,g){var b=p.callbackNode;Ma(p,g);var O=Ll(p,p===Vs?hs:0);if(O===0)b!==null&&Lu(b),p.callbackNode=null,p.callbackPriority=0;else if(g=O&-O,p.callbackPriority!==g){if(b!=null&&Lu(b),g===1)p.tag===0?n1(Ip.bind(null,p)):bC(Ip.bind(null,p)),QN(function(){(Tr&6)===0&&Gd()}),b=null;else{switch(uc(O)){case 1:b=lc;break;case 4:b=nl;break;case 16:b=aa;break;case 536870912:b=xd;break;default:b=aa}b=a_(b,Dy.bind(null,p))}p.callbackPriority=g,p.callbackNode=b}}function Dy(p,g){if(i_=-1,Ny=0,(Tr&6)!==0)throw Error(s(327));var b=p.callbackNode;if(hm()&&p.callbackNode!==b)return null;var O=Ll(p,p===Vs?hs:0);if(O===0)return null;if((O&30)!==0||(O&p.expiredLanes)!==0||g)g=ql(p,O);else{g=O;var M=Tr;Tr|=2;var z=fI();(Vs!==p||hs!==g)&&($l=null,um=Fr()+500,Qd(p,g));do try{p1();break}catch(Ie){ST(p,Ie)}while(!0);W0(),Ry.current=z,Tr=M,Gi!==null?g=0:(Vs=null,hs=0,g=ps)}if(g!==0){if(g===2&&(M=Co(p),M!==0&&(O=M,g=Ly(p,M))),g===1)throw b=Ks,Qd(p,0),Qu(p,O),po(p,Fr()),b;if(g===6)Qu(p,O);else{if(M=p.current.alternate,(O&30)===0&&!My(M)&&(g=ql(p,O),g===2&&(z=Co(p),z!==0&&(O=z,g=Ly(p,z))),g===1))throw b=Ks,Qd(p,0),Qu(p,O),po(p,Fr()),b;switch(p.finishedWork=M,p.finishedLanes=O,g){case 0:case 1:throw Error(s(345));case 2:Ap(p,Bo,$l);break;case 3:if(Qu(p,O),(O&130023424)===O&&(g=Py+500-Fr(),10<g)){if(Ll(p,0)!==0)break;if(M=p.suspendedLanes,(M&O)!==O){qs(),p.pingedLanes|=p.suspendedLanes&M;break}p.timeoutHandle=Ug(Ap.bind(null,p,Bo,$l),g);break}Ap(p,Bo,$l);break;case 4:if(Qu(p,O),(O&4194240)===O)break;for(g=p.eventTimes,M=-1;0<O;){var ae=31-Hs(O);z=1<<ae,ae=g[ae],ae>M&&(M=ae),O&=~z}if(O=M,O=Fr()-O,O=(120>O?120:480>O?480:1080>O?1080:1920>O?1920:3e3>O?3e3:4320>O?4320:1960*h1(O/1960))-O,10<O){p.timeoutHandle=Ug(Ap.bind(null,p,Bo,$l),O);break}Ap(p,Bo,$l);break;case 5:Ap(p,Bo,$l);break;default:throw Error(s(329))}}}return po(p,Fr()),p.callbackNode===b?Dy.bind(null,p):null}function Ly(p,g){var b=r_;return p.current.memoizedState.isDehydrated&&(Qd(p,g).flags|=256),p=ql(p,g),p!==2&&(g=Bo,Bo=b,g!==null&&xy(g)),p}function xy(p){Bo===null?Bo=p:Bo.push.apply(Bo,p)}function My(p){for(var g=p;;){if(g.flags&16384){var b=g.updateQueue;if(b!==null&&(b=b.stores,b!==null))for(var O=0;O<b.length;O++){var M=b[O],z=M.getSnapshot;M=M.value;try{if(!cl(z(),M))return!1}catch{return!1}}}if(b=g.child,g.subtreeFlags&16384&&b!==null)b.return=g,g=b;else{if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function Qu(p,g){for(g&=~Ay,g&=~Iy,p.suspendedLanes|=g,p.pingedLanes&=~g,p=p.expirationTimes;0<g;){var b=31-Hs(g),O=1<<b;p[b]=-1,g&=~O}}function Ip(p){if((Tr&6)!==0)throw Error(s(327));hm();var g=Ll(p,0);if((g&1)===0)return po(p,Fr()),null;var b=ql(p,g);if(p.tag!==0&&b===2){var O=Co(p);O!==0&&(g=O,b=Ly(p,O))}if(b===1)throw b=Ks,Qd(p,0),Qu(p,g),po(p,Fr()),b;if(b===6)throw Error(s(345));return p.finishedWork=p.current.alternate,p.finishedLanes=g,Ap(p,Bo,$l),po(p,Fr()),null}function s_(p,g){var b=Tr;Tr|=1;try{return p(g)}finally{Tr=b,Tr===0&&(um=Fr()+500,JE&&Gd())}}function Zu(p){Kl!==null&&Kl.tag===0&&(Tr&6)===0&&hm();var g=Tr;Tr|=1;var b=Tc.transition,O=nr;try{if(Tc.transition=null,nr=1,p)return p()}finally{nr=O,Tc.transition=b,Tr=g,(Tr&6)===0&&Gd()}}function o_(){za=ll.current,Si(ll)}function Qd(p,g){p.finishedWork=null,p.finishedLanes=0;var b=p.timeoutHandle;if(b!==-1&&(p.timeoutHandle=-1,JN(b)),Gi!==null)for(b=Gi.return;b!==null;){var O=b;switch(jg(O),O.tag){case 1:O=O.type.childContextTypes,O!=null&&qE();break;case 3:Sp(),Si(da),Si(co),q0();break;case 5:tm(O);break;case 4:Sp();break;case 13:Si(Ri);break;case 19:Si(Ri);break;case 10:z0(O.type._context);break;case 22:case 23:o_()}b=b.return}if(Vs=p,Gi=p=ed(p.current,null),hs=za=g,ps=0,Ks=null,Ay=Iy=Rp=0,Bo=r_=null,yp!==null){for(g=0;g<yp.length;g++)if(b=yp[g],O=b.interleaved,O!==null){b.interleaved=null;var M=O.next,z=b.pending;if(z!==null){var ae=z.next;z.next=M,O.next=ae}b.pending=O}yp=null}return p}function ST(p,g){do{var b=Gi;try{if(W0(),oy.current=uy,nm){for(var O=Oi.memoizedState;O!==null;){var M=O.queue;M!==null&&(M.pending=null),O=O.next}nm=!1}if(zl=0,ds=us=Oi=null,qg=!1,Yg=0,Cy.current=null,b===null||b.return===null){ps=1,Ks=g,Gi=null;break}e:{var z=p,ae=b.return,Ie=b,xe=g;if(g=hs,Ie.flags|=32768,xe!==null&&typeof xe=="object"&&typeof xe.then=="function"){var it=xe,It=Ie,At=It.tag;if((It.mode&1)===0&&(At===0||At===11||At===15)){var Rt=It.alternate;Rt?(It.updateQueue=Rt.updateQueue,It.memoizedState=Rt.memoizedState,It.lanes=Rt.lanes):(It.updateQueue=null,It.memoizedState=null)}var zt=qC(ae);if(zt!==null){zt.flags&=-257,YC(zt,ae,Ie,z,g),zt.mode&1&&KC(z,it,g),g=zt,xe=it;var Zt=g.updateQueue;if(Zt===null){var en=new Set;en.add(xe),g.updateQueue=en}else Zt.add(xe);break e}else{if((g&1)===0){KC(z,it,g),TT();break e}xe=Error(s(426))}}else if(si&&Ie.mode&1){var Hi=qC(ae);if(Hi!==null){(Hi.flags&65536)===0&&(Hi.flags|=256),YC(Hi,ae,Ie,z,g),j0(om(xe,Ie));break e}}z=xe=om(xe,Ie),ps!==4&&(ps=2),r_===null?r_=[z]:r_.push(z),z=ae;do{switch(z.tag){case 3:z.flags|=65536,g&=-g,z.lanes|=g;var Je=cT(z,xe,g);kC(z,Je);break e;case 1:Ie=xe;var Ve=z.type,Ze=z.stateNode;if((z.flags&128)===0&&(typeof Ve.getDerivedStateFromError=="function"||Ze!==null&&typeof Ze.componentDidCatch=="function"&&(Jd===null||!Jd.has(Ze)))){z.flags|=65536,g&=-g,z.lanes|=g;var Nt=Ju(z,Ie,g);kC(z,Nt);break e}}z=z.return}while(z!==null)}gI(b)}catch(tn){g=tn,Gi===b&&b!==null&&(Gi=b=b.return);continue}break}while(!0)}function fI(){var p=Ry.current;return Ry.current=uy,p===null?uy:p}function TT(){(ps===0||ps===3||ps===2)&&(ps=4),Vs===null||(Rp&268435455)===0&&(Iy&268435455)===0||Qu(Vs,hs)}function ql(p,g){var b=Tr;Tr|=2;var O=fI();(Vs!==p||hs!==g)&&($l=null,Qd(p,g));do try{mI();break}catch(M){ST(p,M)}while(!0);if(W0(),Tr=b,Ry.current=O,Gi!==null)throw Error(s(261));return Vs=null,hs=0,ps}function mI(){for(;Gi!==null;)Uy(Gi)}function p1(){for(;Gi!==null&&!Ro();)Uy(Gi)}function Uy(p){var g=jy(p.alternate,p,za);p.memoizedProps=p.pendingProps,g===null?gI(p):Gi=g,Cy.current=null}function gI(p){var g=p;do{var b=g.alternate;if(p=g.return,(g.flags&32768)===0){if(b=Sy(b,g,za),b!==null){Gi=b;return}}else{if(b=d1(b,g),b!==null){b.flags&=32767,Gi=b;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{ps=6,Gi=null;return}}if(g=g.sibling,g!==null){Gi=g;return}Gi=g=p}while(g!==null);ps===0&&(ps=5)}function Ap(p,g,b){var O=nr,M=Tc.transition;try{Tc.transition=null,nr=1,f1(p,g,b,O)}finally{Tc.transition=M,nr=O}return null}function f1(p,g,b,O){do hm();while(Kl!==null);if((Tr&6)!==0)throw Error(s(327));b=p.finishedWork;var M=p.finishedLanes;if(b===null)return null;if(p.finishedWork=null,p.finishedLanes=0,b===p.current)throw Error(s(177));p.callbackNode=null,p.callbackPriority=0;var z=b.lanes|b.childLanes;if(zr(p,z),p===Vs&&(Gi=Vs=null,hs=0),(b.subtreeFlags&2064)===0&&(b.flags&2064)===0||dm||(dm=!0,a_(aa,function(){return hm(),null})),z=(b.flags&15990)!==0,(b.subtreeFlags&15990)!==0||z){z=Tc.transition,Tc.transition=null;var ae=nr;nr=1;var Ie=Tr;Tr|=4,Cy.current=null,pT(p,b),_T(b,p),P0(Mg),ve=!!KE,Mg=KE=null,p.current=b,lm(b),Ld(),Tr=Ie,nr=ae,Tc.transition=z}else p.current=b;if(dm&&(dm=!1,Kl=p,ky=M),z=p.pendingLanes,z===0&&(Jd=null),Nf(b.stateNode),po(p,Fr()),g!==null)for(O=p.onRecoverableError,b=0;b<g.length;b++)M=g[b],O(M.value,{componentStack:M.stack,digest:M.digest});if(Oy)throw Oy=!1,p=yT,yT=null,p;return(ky&1)!==0&&p.tag!==0&&hm(),z=p.pendingLanes,(z&1)!==0?p===vT?Cp++:(Cp=0,vT=p):Cp=0,Gd(),null}function hm(){if(Kl!==null){var p=uc(ky),g=Tc.transition,b=nr;try{if(Tc.transition=null,nr=16>p?16:p,Kl===null)var O=!1;else{if(p=Kl,Kl=null,ky=0,(Tr&6)!==0)throw Error(s(331));var M=Tr;for(Tr|=4,Xt=p.current;Xt!==null;){var z=Xt,ae=z.child;if((Xt.flags&16)!==0){var Ie=z.deletions;if(Ie!==null){for(var xe=0;xe<Ie.length;xe++){var it=Ie[xe];for(Xt=it;Xt!==null;){var It=Xt;switch(It.tag){case 0:case 11:case 15:e_(8,It,z)}var At=It.child;if(At!==null)At.return=It,Xt=At;else for(;Xt!==null;){It=Xt;var Rt=It.sibling,zt=It.return;if(lI(It),It===it){Xt=null;break}if(Rt!==null){Rt.return=zt,Xt=Rt;break}Xt=zt}}}var Zt=z.alternate;if(Zt!==null){var en=Zt.child;if(en!==null){Zt.child=null;do{var Hi=en.sibling;en.sibling=null,en=Hi}while(en!==null)}}Xt=z}}if((z.subtreeFlags&2064)!==0&&ae!==null)ae.return=z,Xt=ae;else e:for(;Xt!==null;){if(z=Xt,(z.flags&2048)!==0)switch(z.tag){case 0:case 11:case 15:e_(9,z,z.return)}var Je=z.sibling;if(Je!==null){Je.return=z.return,Xt=Je;break e}Xt=z.return}}var Ve=p.current;for(Xt=Ve;Xt!==null;){ae=Xt;var Ze=ae.child;if((ae.subtreeFlags&2064)!==0&&Ze!==null)Ze.return=ae,Xt=Ze;else e:for(ae=Ve;Xt!==null;){if(Ie=Xt,(Ie.flags&2048)!==0)try{switch(Ie.tag){case 0:case 11:case 15:t_(9,Ie)}}catch(tn){ki(Ie,Ie.return,tn)}if(Ie===ae){Xt=null;break e}var Nt=Ie.sibling;if(Nt!==null){Nt.return=Ie.return,Xt=Nt;break e}Xt=Ie.return}}if(Tr=M,Gd(),ao&&typeof ao.onPostCommitFiberRoot=="function")try{ao.onPostCommitFiberRoot(Nl,p)}catch{}O=!0}return O}finally{nr=b,Tc.transition=g}}return!1}function Vy(p,g,b){g=om(b,g),g=cT(p,g,1),p=Kd(p,g,1),g=qs(),p!==null&&(xl(p,1,g),po(p,g))}function ki(p,g,b){if(p.tag===3)Vy(p,p,b);else for(;g!==null;){if(g.tag===3){Vy(g,p,b);break}else if(g.tag===1){var O=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof O.componentDidCatch=="function"&&(Jd===null||!Jd.has(O))){p=om(b,p),p=Ju(g,p,1),g=Kd(g,p,1),p=qs(),g!==null&&(xl(g,1,p),po(g,p));break}}g=g.return}}function _I(p,g,b){var O=p.pingCache;O!==null&&O.delete(g),g=qs(),p.pingedLanes|=p.suspendedLanes&b,Vs===p&&(hs&b)===b&&(ps===4||ps===3&&(hs&130023424)===hs&&500>Fr()-Py?Qd(p,0):Ay|=b),po(p,g)}function bT(p,g){g===0&&((p.mode&1)===0?g=1:(g=dr,dr<<=1,(dr&130023424)===0&&(dr=4194304)));var b=qs();p=qu(p,g),p!==null&&(xl(p,g,b),po(p,b))}function Fy(p){var g=p.memoizedState,b=0;g!==null&&(b=g.retryLane),bT(p,b)}function EI(p,g){var b=0;switch(p.tag){case 13:var O=p.stateNode,M=p.memoizedState;M!==null&&(b=M.retryLane);break;case 19:O=p.stateNode;break;default:throw Error(s(314))}O!==null&&O.delete(g),bT(p,b)}var jy;jy=function(p,g,b){if(p!==null)if(p.memoizedProps!==g.pendingProps||da.current)ga=!0;else{if((p.lanes&b)===0&&(g.flags&128)===0)return ga=!1,iI(p,g,b);ga=(p.flags&131072)!==0}else ga=!1,si&&(g.flags&1048576)!==0&&ZE(g,QE,g.index);switch(g.lanes=0,g.tag){case 2:var O=g.type;yy(p,g),p=g.pendingProps;var M=_p(g,co.current);Ku(g,b),M=rm(null,g,O,p,M,b);var z=J0();return g.flags|=1,typeof M=="object"&&M!==null&&typeof M.render=="function"&&M.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,ha(O)?(z=!0,XE(g)):z=!1,g.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,Gg(g),M.updater=hy,g.stateNode=M,M._reactInternals=g,sT(g,O,p,b),g=fy(null,g,O,!0,z,b)):(g.tag=0,si&&z&&ey(g),Fo(null,g,M,b),g=g.child),g;case 16:O=g.elementType;e:{switch(yy(p,g),p=g.pendingProps,M=O._init,O=M(O._payload),g.type=O,M=g.tag=Pp(O),p=Wa(O,p),M){case 0:g=lT(null,g,O,p,b);break e;case 1:g=eI(null,g,O,p,b);break e;case 11:g=py(null,g,O,p,b);break e;case 14:g=XC(null,g,O,Wa(O.type,p),b);break e}throw Error(s(306,O,""))}return g;case 0:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:Wa(O,M),lT(p,g,O,M,b);case 1:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:Wa(O,M),eI(p,g,O,M,b);case 3:e:{if(uT(g),p===null)throw Error(s(387));O=g.pendingProps,z=g.memoizedState,M=z.element,OC(p,g),sy(g,O,null,b);var ae=g.memoizedState;if(O=ae.element,z.isDehydrated)if(z={element:O,isDehydrated:!1,cache:ae.cache,pendingSuspenseBoundaries:ae.pendingSuspenseBoundaries,transitions:ae.transitions},g.updateQueue.baseState=z,g.memoizedState=z,g.flags&256){M=om(Error(s(423)),g),g=tI(p,g,O,b,M);break e}else if(O!==M){M=om(Error(s(424)),g),g=tI(p,g,O,b,M);break e}else for(fa=Bd(g.stateNode.containerInfo.firstChild),pa=g,si=!0,Uo=null,b=AC(g,null,O,b),g.child=b;b;)b.flags=b.flags&-3|4096,b=b.sibling;else{if(Jf(),O===M){g=Gl(p,g,b);break e}Fo(p,g,O,b)}g=g.child}return g;case 5:return DC(g),p===null&&F0(g),O=g.type,M=g.pendingProps,z=p!==null?p.memoizedProps:null,ae=M.children,x0(O,M)?ae=null:z!==null&&x0(O,z)&&(g.flags|=32),ZC(p,g),Fo(p,g,ae,b),g.child;case 6:return p===null&&F0(g),null;case 13:return my(p,g,b);case 4:return $0(g,g.stateNode.containerInfo),O=g.pendingProps,p===null?g.child=Qf(g,null,O,b):Fo(p,g,O,b),g.child;case 11:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:Wa(O,M),py(p,g,O,M,b);case 7:return Fo(p,g,g.pendingProps,b),g.child;case 8:return Fo(p,g,g.pendingProps.children,b),g.child;case 12:return Fo(p,g,g.pendingProps.children,b),g.child;case 10:e:{if(O=g.type._context,M=g.pendingProps,z=g.memoizedProps,ae=M.value,fi(ry,O._currentValue),O._currentValue=ae,z!==null)if(cl(z.value,ae)){if(z.children===M.children&&!da.current){g=Gl(p,g,b);break e}}else for(z=g.child,z!==null&&(z.return=g);z!==null;){var Ie=z.dependencies;if(Ie!==null){ae=z.child;for(var xe=Ie.firstContext;xe!==null;){if(xe.context===O){if(z.tag===1){xe=Bl(-1,b&-b),xe.tag=2;var it=z.updateQueue;if(it!==null){it=it.shared;var It=it.pending;It===null?xe.next=xe:(xe.next=It.next,It.next=xe),it.pending=xe}}z.lanes|=b,xe=z.alternate,xe!==null&&(xe.lanes|=b),G0(z.return,b,g),Ie.lanes|=b;break}xe=xe.next}}else if(z.tag===10)ae=z.type===g.type?null:z.child;else if(z.tag===18){if(ae=z.return,ae===null)throw Error(s(341));ae.lanes|=b,Ie=ae.alternate,Ie!==null&&(Ie.lanes|=b),G0(ae,b,g),ae=z.sibling}else ae=z.child;if(ae!==null)ae.return=z;else for(ae=z;ae!==null;){if(ae===g){ae=null;break}if(z=ae.sibling,z!==null){z.return=ae.return,ae=z;break}ae=ae.return}z=ae}Fo(p,g,M.children,b),g=g.child}return g;case 9:return M=g.type,O=g.pendingProps.children,Ku(g,b),M=yc(M),O=O(M),g.flags|=1,Fo(p,g,O,b),g.child;case 14:return O=g.type,M=Wa(O,g.pendingProps),M=Wa(O.type,M),XC(p,g,O,M,b);case 15:return JC(p,g,g.type,g.pendingProps,b);case 17:return O=g.type,M=g.pendingProps,M=g.elementType===O?M:Wa(O,M),yy(p,g),g.tag=1,ha(O)?(p=!0,XE(g)):p=!1,Ku(g,b),HC(g,O,M),sT(g,O,M,b),fy(null,g,O,!0,p,b);case 19:return Ey(p,g,b);case 22:return QC(p,g,b)}throw Error(s(156,g.tag))};function a_(p,g){return Dd(p,g)}function By(p,g,b,O){this.tag=p,this.key=b,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=O,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ga(p,g,b,O){return new By(p,g,b,O)}function Zd(p){return p=p.prototype,!(!p||!p.isReactComponent)}function Pp(p){if(typeof p=="function")return Zd(p)?1:0;if(p!=null){if(p=p.$$typeof,p===he)return 11;if(p===He)return 14}return 2}function ed(p,g){var b=p.alternate;return b===null?(b=Ga(p.tag,g,p.key,p.mode),b.elementType=p.elementType,b.type=p.type,b.stateNode=p.stateNode,b.alternate=p,p.alternate=b):(b.pendingProps=g,b.type=p.type,b.flags=0,b.subtreeFlags=0,b.deletions=null),b.flags=p.flags&14680064,b.childLanes=p.childLanes,b.lanes=p.lanes,b.child=p.child,b.memoizedProps=p.memoizedProps,b.memoizedState=p.memoizedState,b.updateQueue=p.updateQueue,g=p.dependencies,b.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},b.sibling=p.sibling,b.index=p.index,b.ref=p.ref,b}function Wy(p,g,b,O,M,z){var ae=2;if(O=p,typeof p=="function")Zd(p)&&(ae=1);else if(typeof p=="string")ae=5;else e:switch(p){case Z:return Op(b.children,M,z,g);case Q:ae=8,M|=8;break;case ne:return p=Ga(12,b,g,M|2),p.elementType=ne,p.lanes=z,p;case le:return p=Ga(13,b,g,M),p.elementType=le,p.lanes=z,p;case Me:return p=Ga(19,b,g,M),p.elementType=Me,p.lanes=z,p;case we:return eh(b,M,z,g);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case oe:ae=10;break e;case pe:ae=9;break e;case he:ae=11;break e;case He:ae=14;break e;case rt:ae=16,O=null;break e}throw Error(s(130,p==null?p:typeof p,""))}return g=Ga(ae,b,g,M),g.elementType=p,g.type=O,g.lanes=z,g}function Op(p,g,b,O){return p=Ga(7,p,O,g),p.lanes=b,p}function eh(p,g,b,O){return p=Ga(22,p,O,g),p.elementType=we,p.lanes=b,p.stateNode={isHidden:!1},p}function wT(p,g,b){return p=Ga(6,p,null,g),p.lanes=b,p}function RT(p,g,b){return g=Ga(4,p.children!==null?p.children:[],p.key,g),g.lanes=b,g.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},g}function m1(p,g,b,O,M){this.tag=g,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=il(0),this.expirationTimes=il(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=il(0),this.identifierPrefix=O,this.onRecoverableError=M,this.mutableSourceEagerHydrationData=null}function CT(p,g,b,O,M,z,ae,Ie,xe){return p=new m1(p,g,b,Ie,xe),g===1?(g=1,z===!0&&(g|=8)):g=0,z=Ga(3,null,null,g),p.current=z,z.stateNode=p,z.memoizedState={element:O,isDehydrated:b,cache:null,transitions:null,pendingSuspenseBoundaries:null},Gg(z),p}function g1(p,g,b){var O=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ge,key:O==null?null:""+O,children:p,containerInfo:g,implementation:b}}function yI(p){if(!p)return zd;p=p._reactInternals;e:{if(Ms(p)!==p||p.tag!==1)throw Error(s(170));var g=p;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(ha(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(s(171))}if(p.tag===1){var b=p.type;if(ha(b))return YE(p,b,g)}return g}function zy(p,g,b,O,M,z,ae,Ie,xe){return p=CT(b,O,!0,p,M,z,ae,Ie,xe),p.context=yI(null),b=p.current,O=qs(),M=bc(b),z=Bl(O,M),z.callback=g??null,Kd(b,z,M),p.current.lanes=M,xl(p,M,O),po(p,O),p}function c_(p,g,b,O){var M=g.current,z=qs(),ae=bc(M);return b=yI(b),g.context===null?g.context=b:g.pendingContext=b,g=Bl(z,ae),g.payload={element:p},O=O===void 0?null:O,O!==null&&(g.callback=O),p=Kd(M,g,ae),p!==null&&(wc(p,M,ae,z),Hg(p,M,ae)),ae}function Gy(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function IT(p,g){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var b=p.retryLane;p.retryLane=b!==0&&b<g?b:g}}function AT(p,g){IT(p,g),(p=p.alternate)&&IT(p,g)}function l_(){return null}var ul=typeof reportError=="function"?reportError:function(p){console.error(p)};function Hy(p){this._internalRoot=p}$y.prototype.render=Hy.prototype.render=function(p){var g=this._internalRoot;if(g===null)throw Error(s(409));c_(p,g,null,null)},$y.prototype.unmount=Hy.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var g=p.containerInfo;Zu(function(){c_(null,p,null,null)}),g[mc]=null}};function $y(p){this._internalRoot=p}$y.prototype.unstable_scheduleHydration=function(p){if(p){var g=ip();p={blockedOn:null,target:p,priority:g};for(var b=0;b<ko.length&&g!==0&&g<ko[b].priority;b++);ko.splice(b,0,p),b===0&&op(p)}};function PT(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function pm(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function OT(){}function _1(p,g,b,O,M){if(M){if(typeof O=="function"){var z=O;O=function(){var it=Gy(ae);z.call(it)}}var ae=zy(g,O,p,0,null,!1,!1,"",OT);return p._reactRootContainer=ae,p[mc]=ae.current,hp(p.nodeType===8?p.parentNode:p),Zu(),ae}for(;M=p.lastChild;)p.removeChild(M);if(typeof O=="function"){var Ie=O;O=function(){var it=Gy(xe);Ie.call(it)}}var xe=CT(p,0,!1,null,null,!1,!1,"",OT);return p._reactRootContainer=xe,p[mc]=xe.current,hp(p.nodeType===8?p.parentNode:p),Zu(function(){c_(g,xe,b,O)}),xe}function kp(p,g,b,O,M){var z=b._reactRootContainer;if(z){var ae=z;if(typeof M=="function"){var Ie=M;M=function(){var xe=Gy(ae);Ie.call(xe)}}c_(g,ae,p,M)}else ae=_1(b,g,p,M,O);return Gy(ae)}Df=function(p){switch(p.tag){case 3:var g=p.stateNode;if(g.current.memoizedState.isDehydrated){var b=Dl(g.pendingLanes);b!==0&&(Ua(g,b|1),po(g,Fr()),(Tr&6)===0&&(um=Fr()+500,Gd()))}break;case 13:Zu(function(){var O=qu(p,1);if(O!==null){var M=qs();wc(O,p,1,M)}}),AT(p,1)}},Ml=function(p){if(p.tag===13){var g=qu(p,134217728);if(g!==null){var b=qs();wc(g,p,134217728,b)}AT(p,134217728)}},Vd=function(p){if(p.tag===13){var g=bc(p),b=qu(p,g);if(b!==null){var O=qs();wc(b,p,g,O)}AT(p,g)}},ip=function(){return nr},Lf=function(p,g){var b=nr;try{return nr=p,g()}finally{nr=b}},kl=function(p,g,b){switch(g){case"input":if($t(p,b),g=b.name,b.type==="radio"&&g!=null){for(b=p;b.parentNode;)b=b.parentNode;for(b=b.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<b.length;g++){var O=b[g];if(O!==p&&O.form===p.form){var M=qf(O);if(!M)throw Error(s(90));Ut(O),$t(O,M)}}}break;case"textarea":Pt(p,b);break;case"select":g=b.value,g!=null&&_t(p,!!b.multiple,g,!1)}},Ou=s_,ac=Zu;var th={usingClientEntryPoint:!1,Events:[Kf,mp,qf,oc,el,s_]},td={findFiberByHostInstance:fp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},E1={bundleType:td.bundleType,version:td.version,rendererPackageName:td.rendererPackageName,rendererConfig:td.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:de.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=Nd(p),p===null?null:p.stateNode},findFiberByHostInstance:td.findFiberByHostInstance||l_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ky=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ky.isDisabled&&Ky.supportsFiber)try{Nl=Ky.inject(E1),ao=Ky}catch{}}return Vc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=th,Vc.createPortal=function(p,g){var b=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!PT(g))throw Error(s(200));return g1(p,g,null,b)},Vc.createRoot=function(p,g){if(!PT(p))throw Error(s(299));var b=!1,O="",M=ul;return g!=null&&(g.unstable_strictMode===!0&&(b=!0),g.identifierPrefix!==void 0&&(O=g.identifierPrefix),g.onRecoverableError!==void 0&&(M=g.onRecoverableError)),g=CT(p,1,!1,null,null,b,!1,O,M),p[mc]=g.current,hp(p.nodeType===8?p.parentNode:p),new Hy(g)},Vc.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var g=p._reactInternals;if(g===void 0)throw typeof p.render=="function"?Error(s(188)):(p=Object.keys(p).join(","),Error(s(268,p)));return p=Nd(g),p=p===null?null:p.stateNode,p},Vc.flushSync=function(p){return Zu(p)},Vc.hydrate=function(p,g,b){if(!pm(g))throw Error(s(200));return kp(null,p,g,!0,b)},Vc.hydrateRoot=function(p,g,b){if(!PT(p))throw Error(s(405));var O=b!=null&&b.hydratedSources||null,M=!1,z="",ae=ul;if(b!=null&&(b.unstable_strictMode===!0&&(M=!0),b.identifierPrefix!==void 0&&(z=b.identifierPrefix),b.onRecoverableError!==void 0&&(ae=b.onRecoverableError)),g=zy(g,null,p,1,b??null,M,!1,z,ae),p[mc]=g.current,hp(p),O)for(p=0;p<O.length;p++)b=O[p],M=b._getVersion,M=M(b._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[b,M]:g.mutableSourceEagerHydrationData.push(b,M);return new $y(g)},Vc.render=function(p,g,b){if(!pm(g))throw Error(s(200));return kp(null,p,g,!1,b)},Vc.unmountComponentAtNode=function(p){if(!pm(p))throw Error(s(40));return p._reactRootContainer?(Zu(function(){kp(null,null,p,!1,function(){p._reactRootContainer=null,p[mc]=null})}),!0):!1},Vc.unstable_batchedUpdates=s_,Vc.unstable_renderSubtreeIntoContainer=function(p,g,b,O){if(!pm(b))throw Error(s(200));if(p==null||p._reactInternals===void 0)throw Error(s(38));return kp(p,g,b,!1,O)},Vc.version="18.3.1-next-f1338f8080-20240426",Vc}var o$;function IJ(){if(o$)return dM.exports;o$=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),dM.exports=Zge(),dM.exports}var a$;function e_e(){if(a$)return VP;a$=1;var r=IJ();return VP.createRoot=r.createRoot,VP.hydrateRoot=r.hydrateRoot,VP}var t_e=e_e();const n_e=u0(t_e);function r_e(r,t,s,a){return r.addEventListener(t,s,a),()=>{r.removeEventListener(t,s,a)}}function Bk(r){return r!=null&&typeof r=="object"&&"nodeType"in r&&r.nodeType===Node.ELEMENT_NODE}function i_e(){return!!(globalThis!=null&&globalThis.document)}function AJ(r){return r.parentElement&&AJ(r.parentElement)?!0:r.hidden}function s_e(r){const t=r.getAttribute("contenteditable");return t!=="false"&&t!=null}function o_e(r){return!!r.getAttribute("disabled")||!!r.getAttribute("aria-disabled")}function a_e(r){var t;return((t=PJ(r))==null?void 0:t.defaultView)??window}function PJ(r){return Bk(r)?r.ownerDocument:document}function c_e(r){return r.view??window}function l_e(r){return PJ(r).activeElement}function u_e(r){const t=c_e(r);return typeof t.PointerEvent<"u"&&r instanceof t.PointerEvent?r.pointerType==="mouse":r instanceof t.MouseEvent}function OJ(r){return!!r.touches}function d_e(r){return OJ(r)&&r.touches.length>1}function h_e(r,t="page"){const s=r.touches[0]||r.changedTouches[0];return{x:s[`${t}X`],y:s[`${t}Y`]}}function p_e(r,t="page"){return{x:r[`${t}X`],y:r[`${t}Y`]}}function kJ(r,t="page"){return OJ(r)?h_e(r,t):p_e(r,t)}function f_e(r){return t=>{const s=u_e(t);(!s||s&&t.button===0)&&r(t)}}function m_e(r,t=!1){function s(l){r(l,{point:kJ(l)})}return t?f_e(s):s}function fO(r,t,s,a){return r_e(r,t,m_e(s,t==="pointerdown"),a)}function g_e(r,...t){if(r==null)throw new TypeError("Cannot convert undefined or null to object");const s={...r};for(const a of t)if(a!=null)for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&(l in s&&delete s[l],s[l]=a[l]);return s}const Kn=r=>r?"":void 0,wS=r=>r?!0:void 0;function __e(r){return Array.isArray(r)}function Su(r){const t=typeof r;return r!=null&&(t==="object"||t==="function")&&!__e(r)}function E_e(r){const t=r==null?0:r.length;return t?r[t-1]:void 0}function y_e(r){const t=parseFloat(r.toString()),s=r.toString().replace(String(t),"");return{unitless:!s,value:t,unit:s}}function L2(r){if(r==null)return r;const{unitless:t}=y_e(r);return t||typeof r=="number"?`${r}px`:r}const NJ=(r,t)=>parseInt(r[1],10)>parseInt(t[1],10)?1:-1,mV=r=>Object.fromEntries(Object.entries(r).sort(NJ));function c$(r){const t=mV(r);return Object.assign(Object.values(t),t)}function v_e(r){const t=Object.keys(mV(r));return new Set(t)}function l$(r){if(!r)return r;r=L2(r)??r;const t=-.02;return typeof r=="number"?`${r+t}`:r.replace(/(\d+\.?\d*)/u,s=>`${parseFloat(s)+t}`)}function cw(r,t){const s=["@media screen"];return r&&s.push("and",`(min-width: ${L2(r)})`),t&&s.push("and",`(max-width: ${L2(t)})`),s.join(" ")}function S_e(r){if(!r)return null;r.base=r.base??"0px";const t=c$(r),s=Object.entries(r).sort(NJ).map(([d,f],E,v)=>{let[,T]=v[E+1]??[];return T=parseFloat(T)>0?l$(T):void 0,{_minW:l$(f),breakpoint:d,minW:f,maxW:T,maxWQuery:cw(null,T),minWQuery:cw(f),minMaxQuery:cw(f,T)}}),a=v_e(r),l=Array.from(a.values());return{keys:a,normalized:t,isResponsive(d){const f=Object.keys(d);return f.length>0&&f.every(E=>a.has(E))},asObject:mV(r),asArray:c$(r),details:s,get(d){return s.find(f=>f.breakpoint===d)},media:[null,...t.map(d=>cw(d)).slice(1)],toArrayValue(d){if(!Su(d))throw new Error("toArrayValue: value must be an object");const f=l.map(E=>d[E]??null);for(;E_e(f)===null;)f.pop();return f},toObjectValue(d){if(!Array.isArray(d))throw new Error("toObjectValue: value must be an array");return d.reduce((f,E,v)=>{const T=l[v];return T!=null&&E!=null&&(f[T]=E),f},{})}}}function DJ(...r){return function(...s){r.forEach(a=>a==null?void 0:a(...s))}}function Qn(...r){return function(s){r.some(a=>(a==null||a(s),s==null?void 0:s.defaultPrevented))}}function gV(r){return L.Children.toArray(r).filter(t=>L.isValidElement(t))}function Wk(r){const t=Object.assign({},r);for(let s in t)t[s]===void 0&&delete t[s];return t}function T_e(r,t){return`${r} returned \`undefined\`. Seems you forgot to wrap component within ${t}`}function Wi(r={}){const{name:t,strict:s=!0,hookName:a="useContext",providerName:l="Provider",errorMessage:d,defaultValue:f}=r,E=L.createContext(f);E.displayName=t;function v(){var R;const T=L.useContext(E);if(!T&&s){const I=new Error(d??T_e(a,l));throw I.name="ContextError",(R=Error.captureStackTrace)==null||R.call(Error,I,v),I}return T}return[E.Provider,v,E]}const _n=(...r)=>r.filter(Boolean).join(" "),LJ=r=>r.hasAttribute("tabindex"),b_e=r=>LJ(r)&&r.tabIndex===-1;function JO(r){if(!Bk(r)||AJ(r)||o_e(r))return!1;const{localName:t}=r;if(["input","select","textarea","button"].indexOf(t)>=0)return!0;const a={a:()=>r.hasAttribute("href"),audio:()=>r.hasAttribute("controls"),video:()=>r.hasAttribute("controls")};return t in a?a[t]():s_e(r)?!0:LJ(r)}function w_e(r){return r?Bk(r)&&JO(r)&&!b_e(r):!1}const R_e=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],C_e=R_e.join(),I_e=r=>r.offsetWidth>0&&r.offsetHeight>0;function xJ(r){const t=Array.from(r.querySelectorAll(C_e));return t.unshift(r),t.filter(s=>JO(s)&&I_e(s))}function A_e(r,t,s,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&r;a+=1)r=r[l[a]];return r===void 0?s:r}const P_e=r=>{const t=new WeakMap;return(a,l,d,f)=>{if(typeof a>"u")return r(a,l,d);t.has(a)||t.set(a,new Map);const E=t.get(a);if(E.has(l))return E.get(l);const v=r(a,l,d,f);return E.set(l,v),v}},MJ=P_e(A_e),O_e=r=>r.default||r;function _V(r){const{wasSelected:t,enabled:s,isSelected:a,mode:l="unmount"}=r;return!!(!s||a||l==="keepMounted"&&t)}function k_e(r){const t=parseFloat(r);return typeof t!="number"||Number.isNaN(t)?0:t}function N_e(r,t){let s=k_e(r);const a=10**(t??10);return s=Math.round(s*a)/a,t?s.toFixed(t):s.toString()}function D_e(r){if(!Number.isFinite(r))return 0;let t=1,s=0;for(;Math.round(r*t)/t!==r;)t*=10,s+=1;return s}function u$(r,t,s){return(r-t)*100/(s-t)}function L_e(r,t,s){return(s-t)*r+t}function d$(r,t,s){const a=Math.round((r-t)/s)*s+t,l=D_e(s);return N_e(a,l)}function fM(r,t,s){return r==null?r:(s<t&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(r,t),s))}function d0(r,t=[]){const s=Object.assign({},r);for(const a of t)a in s&&delete s[a];return s}function UJ(r,t){const s={};for(const a of t)a in r&&(s[a]=r[a]);return s}function EV(r,t){return Array.isArray(r)?r.map(s=>s===null?null:t(s)):Su(r)?Object.keys(r).reduce((s,a)=>(s[a]=t(r[a]),s),{}):r!=null?t(r):null}const x_e=r=>typeof r=="function";function Hc(r,...t){return x_e(r)?r(...t):r}function M_e(r){const t=r.ownerDocument.defaultView||window,{overflow:s,overflowX:a,overflowY:l}=t.getComputedStyle(r);return/auto|scroll|overlay|hidden/.test(s+l+a)}function U_e(r){return r.localName==="html"?r:r.assignedSlot||r.parentElement||r.ownerDocument.documentElement}function VJ(r){return["html","body","#document"].includes(r.localName)?r.ownerDocument.body:Bk(r)&&M_e(r)?r:VJ(U_e(r))}function V_e(r,t){const s={},a={};for(const[l,d]of Object.entries(r))t.includes(l)?s[l]=d:a[l]=d;return[s,a]}function F_e(r,...t){const s=Object.getOwnPropertyDescriptors(r),a=Object.keys(s),l=f=>{const E={};for(let v=0;v<f.length;v++){const T=f[v];s[T]&&(Object.defineProperty(E,T,s[T]),delete s[T])}return E},d=f=>l(Array.isArray(f)?f:a.filter(f));return t.map(d).concat(l(a))}function h$(r,t,s={}){const{stop:a,getKey:l}=s;function d(f,E=[]){if(Su(f)||Array.isArray(f)){const v={};for(const[T,R]of Object.entries(f)){const I=(l==null?void 0:l(T))??T,N=[...E,I];if(a!=null&&a(f,N))return t(f,E);v[I]=d(R,N)}return v}return t(f,E)}return d(r)}var lw={exports:{}};lw.exports;var p$;function j_e(){return p$||(p$=1,function(r,t){var s=200,a="__lodash_hash_undefined__",l=800,d=16,f=9007199254740991,E="[object Arguments]",v="[object Array]",T="[object AsyncFunction]",R="[object Boolean]",I="[object Date]",N="[object Error]",F="[object Function]",j="[object GeneratorFunction]",G="[object Map]",H="[object Number]",te="[object Null]",K="[object Object]",ee="[object Proxy]",de="[object RegExp]",se="[object Set]",ge="[object String]",Z="[object Undefined]",Q="[object WeakMap]",ne="[object ArrayBuffer]",oe="[object DataView]",pe="[object Float32Array]",he="[object Float64Array]",le="[object Int8Array]",Me="[object Int16Array]",He="[object Int32Array]",rt="[object Uint8Array]",we="[object Uint8ClampedArray]",Ce="[object Uint16Array]",ye="[object Uint32Array]",Ne=/[\\^$.*+?()[\]{}|]/g,Te=/^\[object .+?Constructor\]$/,Se=/^(?:0|[1-9]\d*)$/,Ae={};Ae[pe]=Ae[he]=Ae[le]=Ae[Me]=Ae[He]=Ae[rt]=Ae[we]=Ae[Ce]=Ae[ye]=!0,Ae[E]=Ae[v]=Ae[ne]=Ae[R]=Ae[oe]=Ae[I]=Ae[N]=Ae[F]=Ae[G]=Ae[H]=Ae[K]=Ae[de]=Ae[se]=Ae[ge]=Ae[Q]=!1;var Ue=typeof eE=="object"&&eE&&eE.Object===Object&&eE,ze=typeof self=="object"&&self&&self.Object===Object&&self,et=Ue||ze||Function("return this")(),nt=t&&!t.nodeType&&t,dt=nt&&!0&&r&&!r.nodeType&&r,Xe=dt&&dt.exports===nt,Ct=Xe&&Ue.process,dn=function(){try{var ve=dt&&dt.require&&dt.require("util").types;return ve||Ct&&Ct.binding&&Ct.binding("util")}catch{}}(),Ut=dn&&dn.isTypedArray;function ln(ve,De,tt){switch(tt.length){case 0:return ve.call(De);case 1:return ve.call(De,tt[0]);case 2:return ve.call(De,tt[0],tt[1]);case 3:return ve.call(De,tt[0],tt[1],tt[2])}return ve.apply(De,tt)}function Ln(ve,De){for(var tt=-1,Ht=Array(ve);++tt<ve;)Ht[tt]=De(tt);return Ht}function qt(ve){return function(De){return ve(De)}}function Yn(ve,De){return ve==null?void 0:ve[De]}function $t(ve,De){return function(tt){return ve(De(tt))}}var Re=Array.prototype,Fe=Function.prototype,Ke=Object.prototype,_t=et["__core-js_shared__"],yt=Fe.toString,Ge=Ke.hasOwnProperty,Pt=function(){var ve=/[^.]+$/.exec(_t&&_t.keys&&_t.keys.IE_PROTO||"");return ve?"Symbol(src)_1."+ve:""}(),Yt=Ke.toString,hn=yt.call(Object),an=RegExp("^"+yt.call(Ge).replace(Ne,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ir=Xe?et.Buffer:void 0,na=et.Symbol,Vt=et.Uint8Array;ir&&ir.allocUnsafe;var sn=$t(Object.getPrototypeOf,Object),wi=Object.create,di=Ke.propertyIsEnumerable,yi=Re.splice,ur=na?na.toStringTag:void 0,Da=function(){try{var ve=Ma(Object,"defineProperty");return ve({},"",{}),ve}catch{}}(),Zc=ir?ir.isBuffer:void 0,so=Math.max,oo=Date.now,kl=Ma(et,"Map"),xs=Ma(Object,"create"),sc=function(){function ve(){}return function(De){if(!dc(De))return{};if(wi)return wi(De);ve.prototype=De;var tt=new ve;return ve.prototype=void 0,tt}}();function ra(ve){var De=-1,tt=ve==null?0:ve.length;for(this.clear();++De<tt;){var Ht=ve[De];this.set(Ht[0],Ht[1])}}function oc(){this.__data__=xs?xs(null):{},this.size=0}function el(ve){var De=this.has(ve)&&delete this.__data__[ve];return this.size-=De?1:0,De}function Ou(ve){var De=this.__data__;if(xs){var tt=De[ve];return tt===a?void 0:tt}return Ge.call(De,ve)?De[ve]:void 0}function ac(ve){var De=this.__data__;return xs?De[ve]!==void 0:Ge.call(De,ve)}function tl(ve,De){var tt=this.__data__;return this.size+=this.has(ve)?0:1,tt[ve]=xs&&De===void 0?a:De,this}ra.prototype.clear=oc,ra.prototype.delete=el,ra.prototype.get=Ou,ra.prototype.has=ac,ra.prototype.set=tl;function wo(ve){var De=-1,tt=ve==null?0:ve.length;for(this.clear();++De<tt;){var Ht=ve[De];this.set(Ht[0],Ht[1])}}function Pi(){this.__data__=[],this.size=0}function as(ve){var De=this.__data__,tt=Ld(De,ve);if(tt<0)return!1;var Ht=De.length-1;return tt==Ht?De.pop():yi.call(De,tt,1),--this.size,!0}function La(ve){var De=this.__data__,tt=Ld(De,ve);return tt<0?void 0:De[tt][1]}function ku(ve){return Ld(this.__data__,ve)>-1}function cc(ve,De){var tt=this.__data__,Ht=Ld(tt,ve);return Ht<0?(++this.size,tt.push([ve,De])):tt[Ht][1]=De,this}wo.prototype.clear=Pi,wo.prototype.delete=as,wo.prototype.get=La,wo.prototype.has=ku,wo.prototype.set=cc;function ia(ve){var De=-1,tt=ve==null?0:ve.length;for(this.clear();++De<tt;){var Ht=ve[De];this.set(Ht[0],Ht[1])}}function sa(){this.size=0,this.__data__={hash:new ra,map:new(kl||wo),string:new ra}}function Od(ve){var De=xu(this,ve).delete(ve);return this.size-=De?1:0,De}function Rg(ve){return xu(this,ve).get(ve)}function Nu(ve){return xu(this,ve).has(ve)}function tp(ve,De){var tt=xu(this,ve),Ht=tt.size;return tt.set(ve,De),this.size+=tt.size==Ht?0:1,this}ia.prototype.clear=sa,ia.prototype.delete=Od,ia.prototype.get=Rg,ia.prototype.has=Nu,ia.prototype.set=tp;function Ms(ve){var De=this.__data__=new wo(ve);this.size=De.size}function Du(){this.__data__=new wo,this.size=0}function oa(ve){var De=this.__data__,tt=De.delete(ve);return this.size=De.size,tt}function kd(ve){return this.__data__.get(ve)}function Nd(ve){return this.__data__.has(ve)}function xa(ve,De){var tt=this.__data__;if(tt instanceof wo){var Ht=tt.__data__;if(!kl||Ht.length<s-1)return Ht.push([ve,De]),this.size=++tt.size,this;tt=this.__data__=new ia(Ht)}return tt.set(ve,De),this.size=tt.size,this}Ms.prototype.clear=Du,Ms.prototype.delete=oa,Ms.prototype.get=kd,Ms.prototype.has=Nd,Ms.prototype.set=xa;function Dd(ve,De){var tt=Ao(ve),Ht=!tt&&Qi(ve),Hn=!tt&&!Ht&&Oo(ve),gr=!tt&&!Ht&&!Hn&&op(ve),jr=tt||Ht||Hn||gr,cn=jr?Ln(ve.length,String):[],kr=cn.length;for(var pi in ve)jr&&(pi=="length"||Hn&&(pi=="offset"||pi=="parent")||gr&&(pi=="buffer"||pi=="byteLength"||pi=="byteOffset")||il(pi,kr))||cn.push(pi);return cn}function Lu(ve,De,tt){(tt!==void 0&&!Io(ve[De],tt)||tt===void 0&&!(De in ve))&&Fr(ve,De,tt)}function Ro(ve,De,tt){var Ht=ve[De];(!(Ge.call(ve,De)&&Io(Ht,tt))||tt===void 0&&!(De in ve))&&Fr(ve,De,tt)}function Ld(ve,De){for(var tt=ve.length;tt--;)if(Io(ve[tt][0],De))return tt;return-1}function Fr(ve,De,tt){De=="__proto__"&&Da?Da(ve,De,{configurable:!0,enumerable:!0,value:tt,writable:!0}):ve[De]=tt}var hi=Ll();function lc(ve){return ve==null?ve===void 0?Z:te:ur&&ur in Object(ve)?Co(ve):Df(ve)}function nl(ve){return cs(ve)&&lc(ve)==E}function aa(ve){if(!dc(ve)||Ua(ve))return!1;var De=ko(ve)?an:Te;return De.test(sp(ve))}function np(ve){return cs(ve)&&xf(ve.length)&&!!Ae[lc(ve)]}function xd(ve){if(!dc(ve))return uc(ve);var De=nr(ve),tt=[];for(var Ht in ve)Ht=="constructor"&&(De||!Ge.call(ve,Ht))||tt.push(Ht);return tt}function Nl(ve,De,tt,Ht,Hn){ve!==De&&hi(De,function(gr,jr){if(Hn||(Hn=new Ms),dc(gr))ao(ve,De,jr,tt,Nl,Ht,Hn);else{var cn=Ht?Ht(Vd(ve,jr),gr,jr+"",ve,De,Hn):void 0;cn===void 0&&(cn=gr),Lu(ve,jr,cn)}},Vl)}function ao(ve,De,tt,Ht,Hn,gr,jr){var cn=Vd(ve,tt),kr=Vd(De,tt),pi=jr.get(kr);if(pi){Lu(ve,tt,pi);return}var Rs=gr?gr(cn,kr,tt+"",ve,De,jr):void 0,No=Rs===void 0;if(No){var Do=Ao(kr),Vu=!Do&&Oo(kr),zi=!Do&&!Vu&&op(kr);Rs=kr,Do||Vu||zi?Ao(cn)?Rs=cn:Ul(cn)?Rs=Ud(cn):Vu?(No=!1,Rs=rp(kr)):zi?(No=!1,Rs=Md(kr)):Rs=[]:Uu(kr)||Qi(kr)?(Rs=cn,Qi(cn)?Rs=sl(cn):(!dc(cn)||ko(cn))&&(Rs=Mu(kr))):No=!1}No&&(jr.set(kr,Rs),Hn(Rs,kr,Ht,gr,jr),jr.delete(kr)),Lu(ve,tt,Rs)}function Nf(ve,De){return ip(Ml(ve,De,la),ve+"")}var Hs=Da?function(ve,De){return Da(ve,"toString",{configurable:!0,enumerable:!1,value:ca(De),writable:!0})}:la;function rp(ve,De){return ve.slice()}function rl(ve){var De=new ve.constructor(ve.byteLength);return new Vt(De).set(new Vt(ve)),De}function Md(ve,De){var tt=rl(ve.buffer);return new ve.constructor(tt,ve.byteOffset,ve.length)}function Ud(ve,De){var tt=-1,Ht=ve.length;for(De||(De=Array(Ht));++tt<Ht;)De[tt]=ve[tt];return De}function dr(ve,De,tt,Ht){var Hn=!tt;tt||(tt={});for(var gr=-1,jr=De.length;++gr<jr;){var cn=De[gr],kr=void 0;kr===void 0&&(kr=ve[cn]),Hn?Fr(tt,cn,kr):Ro(tt,cn,kr)}return tt}function Dl(ve){return Nf(function(De,tt){var Ht=-1,Hn=tt.length,gr=Hn>1?tt[Hn-1]:void 0,jr=Hn>2?tt[2]:void 0;for(gr=ve.length>3&&typeof gr=="function"?(Hn--,gr):void 0,jr&&xl(tt[0],tt[1],jr)&&(gr=Hn<3?void 0:gr,Hn=1),De=Object(De);++Ht<Hn;){var cn=tt[Ht];cn&&ve(De,cn,Ht,gr)}return De})}function Ll(ve){return function(De,tt,Ht){for(var Hn=-1,gr=Object(De),jr=Ht(De),cn=jr.length;cn--;){var kr=jr[++Hn];if(tt(gr[kr],kr,gr)===!1)break}return De}}function xu(ve,De){var tt=ve.__data__;return zr(De)?tt[typeof De=="string"?"string":"hash"]:tt.map}function Ma(ve,De){var tt=Yn(ve,De);return aa(tt)?tt:void 0}function Co(ve){var De=Ge.call(ve,ur),tt=ve[ur];try{ve[ur]=void 0;var Ht=!0}catch{}var Hn=Yt.call(ve);return Ht&&(De?ve[ur]=tt:delete ve[ur]),Hn}function Mu(ve){return typeof ve.constructor=="function"&&!nr(ve)?sc(sn(ve)):{}}function il(ve,De){var tt=typeof ve;return De=De??f,!!De&&(tt=="number"||tt!="symbol"&&Se.test(ve))&&ve>-1&&ve%1==0&&ve<De}function xl(ve,De,tt){if(!dc(tt))return!1;var Ht=typeof De;return(Ht=="number"?Po(tt)&&il(De,tt.length):Ht=="string"&&De in tt)?Io(tt[De],ve):!1}function zr(ve){var De=typeof ve;return De=="string"||De=="number"||De=="symbol"||De=="boolean"?ve!=="__proto__":ve===null}function Ua(ve){return!!Pt&&Pt in ve}function nr(ve){var De=ve&&ve.constructor,tt=typeof De=="function"&&De.prototype||Ke;return ve===tt}function uc(ve){var De=[];if(ve!=null)for(var tt in Object(ve))De.push(tt);return De}function Df(ve){return Yt.call(ve)}function Ml(ve,De,tt){return De=so(De===void 0?ve.length-1:De,0),function(){for(var Ht=arguments,Hn=-1,gr=so(Ht.length-De,0),jr=Array(gr);++Hn<gr;)jr[Hn]=Ht[De+Hn];Hn=-1;for(var cn=Array(De+1);++Hn<De;)cn[Hn]=Ht[Hn];return cn[De]=tt(jr),ln(ve,this,cn)}}function Vd(ve,De){if(!(De==="constructor"&&typeof ve[De]=="function")&&De!="__proto__")return ve[De]}var ip=Lf(Hs);function Lf(ve){var De=0,tt=0;return function(){var Ht=oo(),Hn=d-(Ht-tt);if(tt=Ht,Hn>0){if(++De>=l)return arguments[0]}else De=0;return ve.apply(void 0,arguments)}}function sp(ve){if(ve!=null){try{return yt.call(ve)}catch{}try{return ve+""}catch{}}return""}function Io(ve,De){return ve===De||ve!==ve&&De!==De}var Qi=nl(function(){return arguments}())?nl:function(ve){return cs(ve)&&Ge.call(ve,"callee")&&!di.call(ve,"callee")},Ao=Array.isArray;function Po(ve){return ve!=null&&xf(ve.length)&&!ko(ve)}function Ul(ve){return cs(ve)&&Po(ve)}var Oo=Zc||ol;function ko(ve){if(!dc(ve))return!1;var De=lc(ve);return De==F||De==j||De==T||De==ee}function xf(ve){return typeof ve=="number"&&ve>-1&&ve%1==0&&ve<=f}function dc(ve){var De=typeof ve;return ve!=null&&(De=="object"||De=="function")}function cs(ve){return ve!=null&&typeof ve=="object"}function Uu(ve){if(!cs(ve)||lc(ve)!=K)return!1;var De=sn(ve);if(De===null)return!0;var tt=Ge.call(De,"constructor")&&De.constructor;return typeof tt=="function"&&tt instanceof tt&&yt.call(tt)==hn}var op=Ut?qt(Ut):np;function sl(ve){return dr(ve,Vl(ve))}function Vl(ve){return Po(ve)?Dd(ve):xd(ve)}var Mf=Dl(function(ve,De,tt,Ht){Nl(ve,De,tt,Ht)});function ca(ve){return function(){return ve}}function la(ve){return ve}function ol(){return!1}r.exports=Mf}(lw,lw.exports)),lw.exports}var B_e=j_e();const Lh=u0(B_e);function $c(r,t=[]){const s=L.useRef(r);return L.useEffect(()=>{s.current=r}),L.useCallback((...a)=>{var l;return(l=s.current)==null?void 0:l.call(s,...a)},t)}function RS(r,t,s,a){const l=$c(s);return L.useEffect(()=>{const d=typeof r=="function"?r():r??document;if(!(!s||!d))return d.addEventListener(t,l,a),()=>{d.removeEventListener(t,l,a)}},[t,r,a,l,s]),()=>{const d=typeof r=="function"?r():r??document;d==null||d.removeEventListener(t,l,a)}}function FJ(r){const{isOpen:t,ref:s}=r,[a,l]=L.useState(t),[d,f]=L.useState(!1);return L.useEffect(()=>{d||(l(t),f(!0))},[t,d,a]),RS(()=>s.current,"animationend",()=>{l(t)}),{present:!(t?!1:!a),onComplete(){var R;const v=a_e(s.current),T=new v.CustomEvent("animationend",{bubbles:!0});(R=s.current)==null||R.dispatchEvent(T)}}}function jJ(r){const{value:t,defaultValue:s,onChange:a,shouldUpdate:l=(N,F)=>N!==F}=r,d=$c(a),f=$c(l),[E,v]=L.useState(s),T=t!==void 0,R=T?t:E,I=$c(N=>{const j=typeof N=="function"?N(R):N;f(R,j)&&(T||v(j),d(j))},[T,d,R,f]);return[R,I]}function ag(r={}){const{onClose:t,onOpen:s,isOpen:a,id:l}=r,d=$c(s),f=$c(t),[E,v]=L.useState(r.defaultIsOpen||!1),T=a!==void 0?a:E,R=a!==void 0,I=L.useId(),N=l??`disclosure-${I}`,F=L.useCallback(()=>{R||v(!1),f==null||f()},[R,f]),j=L.useCallback(()=>{R||v(!0),d==null||d()},[R,d]),G=L.useCallback(()=>{T?F():j()},[T,j,F]);function H(K={}){return{...K,"aria-expanded":T,"aria-controls":N,onClick(ee){var de;(de=K.onClick)==null||de.call(K,ee),G()}}}function te(K={}){return{...K,hidden:!T,id:N}}return{isOpen:T,onOpen:j,onClose:F,onToggle:G,isControlled:R,getButtonProps:H,getDisclosureProps:te}}const hf=globalThis!=null&&globalThis.document?L.useLayoutEffect:L.useEffect,cg=(r,t)=>{const s=L.useRef(!1),a=L.useRef(!1);L.useEffect(()=>{if(s.current&&a.current)return r();a.current=!0},t),L.useEffect(()=>(s.current=!0,()=>{s.current=!1}),[])};function W_e(r){const t=r.current;if(!t)return!1;const s=l_e(t);return!s||t.contains(s)?!1:!!w_e(s)}function BJ(r,t){const{shouldFocus:s,visible:a,focusRef:l}=t,d=s&&!a;cg(()=>{if(!d||W_e(r))return;const f=(l==null?void 0:l.current)||r.current;let E;if(f)return E=requestAnimationFrame(()=>{f.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(E)}},[d,r,l])}const z_e={preventScroll:!0,shouldFocus:!1};function G_e(r,t=z_e){const{focusRef:s,preventScroll:a,shouldFocus:l,visible:d}=t,f=H_e(r)?r.current:r,E=l&&d,v=L.useRef(E),T=L.useRef(d);hf(()=>{!T.current&&d&&(v.current=E),T.current=d},[d,E]);const R=L.useCallback(()=>{if(!(!d||!f||!v.current)&&(v.current=!1,!f.contains(document.activeElement)))if(s!=null&&s.current)requestAnimationFrame(()=>{var I;(I=s.current)==null||I.focus({preventScroll:a})});else{const I=xJ(f);I.length>0&&requestAnimationFrame(()=>{I[0].focus({preventScroll:a})})}},[d,a,f,s]);cg(()=>{R()},[R]),RS(f,"transitionend",R)}function H_e(r){return"current"in r}function $_e(r){return"current"in r}const WJ=()=>typeof window<"u";function K_e(){const r=navigator.userAgentData;return(r==null?void 0:r.platform)??navigator.platform}const q_e=r=>WJ()&&r.test(navigator.vendor),Y_e=r=>WJ()&&r.test(K_e()),X_e=()=>Y_e(/mac|iphone|ipad|ipod/i),J_e=()=>X_e()&&q_e(/apple/i);function Q_e(r){const{ref:t,elements:s,enabled:a}=r,l=()=>{var d;return((d=t.current)==null?void 0:d.ownerDocument)??document};RS(l,"pointerdown",d=>{var T,R;if(!J_e()||!a)return;const f=((R=(T=d.composedPath)==null?void 0:T.call(d))==null?void 0:R[0])??d.target,v=(s??[t]).some(I=>{const N=$_e(I)?I.current:I;return(N==null?void 0:N.contains(f))||N===f});l().activeElement!==f&&v&&(d.preventDefault(),f.focus())})}function Z_e(r,t){const s=L.useId();return L.useMemo(()=>r||[t,s].filter(Boolean).join("-"),[r,t,s])}function eEe(r,...t){const s=Z_e(r);return L.useMemo(()=>t.map(a=>`${a}-${s}`),[s,t])}function zJ(r){const t=L.useRef(null);return t.current=r,t}function tEe(r,t){if(r!=null){if(typeof r=="function"){r(t);return}try{r.current=t}catch{throw new Error(`Cannot assign value '${t}' to ref '${r}'`)}}}function Yi(...r){return t=>{r.forEach(s=>{tEe(s,t)})}}function nEe(...r){return L.useMemo(()=>Yi(...r),r)}function GJ(r){const{ref:t,handler:s,enabled:a=!0}=r,l=$c(s),f=L.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;L.useEffect(()=>{if(!a)return;const E=I=>{mM(I,t)&&(f.isPointerDown=!0)},v=I=>{if(f.ignoreEmulatedMouseEvents){f.ignoreEmulatedMouseEvents=!1;return}f.isPointerDown&&s&&mM(I,t)&&(f.isPointerDown=!1,l(I))},T=I=>{f.ignoreEmulatedMouseEvents=!0,s&&f.isPointerDown&&mM(I,t)&&(f.isPointerDown=!1,l(I))},R=HJ(t.current);return R.addEventListener("mousedown",E,!0),R.addEventListener("mouseup",v,!0),R.addEventListener("touchstart",E,!0),R.addEventListener("touchend",T,!0),()=>{R.removeEventListener("mousedown",E,!0),R.removeEventListener("mouseup",v,!0),R.removeEventListener("touchstart",E,!0),R.removeEventListener("touchend",T,!0)}},[s,t,l,f,a])}function mM(r,t){var a,l;const s=((a=r.composedPath)==null?void 0:a.call(r)[0])??r.target;return s&&!HJ(s).contains(s)?!1:!((l=t.current)!=null&&l.contains(s))}function HJ(r){return(r==null?void 0:r.ownerDocument)??document}function rEe(r,t){const s=$c(r);L.useEffect(()=>{if(t==null)return;let a=null;return a=window.setTimeout(()=>{s()},t),()=>{a&&window.clearTimeout(a)}},[t,s])}const $J=1/60*1e3,iEe=typeof performance<"u"?()=>performance.now():()=>Date.now(),KJ=typeof window<"u"?r=>window.requestAnimationFrame(r):r=>setTimeout(()=>r(iEe()),$J);function sEe(r){let t=[],s=[],a=0,l=!1,d=!1;const f=new WeakSet,E={schedule:(v,T=!1,R=!1)=>{const I=R&&l,N=I?t:s;return T&&f.add(v),N.indexOf(v)===-1&&(N.push(v),I&&l&&(a=t.length)),v},cancel:v=>{const T=s.indexOf(v);T!==-1&&s.splice(T,1),f.delete(v)},process:v=>{if(l){d=!0;return}if(l=!0,[t,s]=[s,t],s.length=0,a=t.length,a)for(let T=0;T<a;T++){const R=t[T];R(v),f.has(R)&&(E.schedule(R),r())}l=!1,d&&(d=!1,E.process(v))}};return E}const oEe=40;let x2=!0,Kw=!1,M2=!1;const CS={delta:0,timestamp:0},TR=["read","update","preRender","render","postRender"],zk=TR.reduce((r,t)=>(r[t]=sEe(()=>Kw=!0),r),{}),aEe=TR.reduce((r,t)=>{const s=zk[t];return r[t]=(a,l=!1,d=!1)=>(Kw||uEe(),s.schedule(a,l,d)),r},{}),cEe=TR.reduce((r,t)=>(r[t]=zk[t].cancel,r),{});TR.reduce((r,t)=>(r[t]=()=>zk[t].process(CS),r),{});const lEe=r=>zk[r].process(CS),qJ=r=>{Kw=!1,CS.delta=x2?$J:Math.max(Math.min(r-CS.timestamp,oEe),1),CS.timestamp=r,M2=!0,TR.forEach(lEe),M2=!1,Kw&&(x2=!1,KJ(qJ))},uEe=()=>{Kw=!0,x2=!0,M2||KJ(qJ)},f$=()=>CS;var dEe=Object.defineProperty,hEe=(r,t,s)=>t in r?dEe(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Ed=(r,t,s)=>(hEe(r,typeof t!="symbol"?t+"":t,s),s);class pEe{constructor(t,s,a){if(Ed(this,"history",[]),Ed(this,"startEvent",null),Ed(this,"lastEvent",null),Ed(this,"lastEventInfo",null),Ed(this,"handlers",{}),Ed(this,"removeListeners",()=>{}),Ed(this,"threshold",3),Ed(this,"win"),Ed(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const E=gM(this.lastEventInfo,this.history),v=this.startEvent!==null,T=_Ee(E.offset,{x:0,y:0})>=this.threshold;if(!v&&!T)return;const{timestamp:R}=f$();this.history.push({...E.point,timestamp:R});const{onStart:I,onMove:N}=this.handlers;v||(I==null||I(this.lastEvent,E),this.startEvent=this.lastEvent),N==null||N(this.lastEvent,E)}),Ed(this,"onPointerMove",(E,v)=>{this.lastEvent=E,this.lastEventInfo=v,aEe.update(this.updatePoint,!0)}),Ed(this,"onPointerUp",(E,v)=>{const T=gM(v,this.history),{onEnd:R,onSessionEnd:I}=this.handlers;I==null||I(E,T),this.end(),!(!R||!this.startEvent)&&(R==null||R(E,T))}),this.win=t.view??window,d_e(t))return;this.handlers=s,a&&(this.threshold=a),t.stopPropagation(),t.preventDefault();const l={point:kJ(t)},{timestamp:d}=f$();this.history=[{...l.point,timestamp:d}];const{onSessionStart:f}=s;f==null||f(t,gM(l,this.history)),this.removeListeners=gEe(fO(this.win,"pointermove",this.onPointerMove),fO(this.win,"pointerup",this.onPointerUp),fO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(t){this.handlers=t}end(){var t;(t=this.removeListeners)==null||t.call(this),cEe.update(this.updatePoint)}}function m$(r,t){return{x:r.x-t.x,y:r.y-t.y}}function gM(r,t){return{point:r.point,delta:m$(r.point,t[t.length-1]),offset:m$(r.point,t[0]),velocity:mEe(t,.1)}}const fEe=r=>r*1e3;function mEe(r,t){if(r.length<2)return{x:0,y:0};let s=r.length-1,a=null;const l=r[r.length-1];for(;s>=0&&(a=r[s],!(l.timestamp-a.timestamp>fEe(t)));)s--;if(!a)return{x:0,y:0};const d=(l.timestamp-a.timestamp)/1e3;if(d===0)return{x:0,y:0};const f={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}function gEe(...r){return t=>r.reduce((s,a)=>a(s),t)}function _M(r,t){return Math.abs(r-t)}function g$(r){return"x"in r&&"y"in r}function _Ee(r,t){if(typeof r=="number"&&typeof t=="number")return _M(r,t);if(g$(r)&&g$(t)){const s=_M(r.x,t.x),a=_M(r.y,t.y);return Math.sqrt(s**2+a**2)}return 0}function EEe(r,t){const{onPan:s,onPanStart:a,onPanEnd:l,onPanSessionStart:d,onPanSessionEnd:f,threshold:E}=t,v=!!(s||a||l||d||f),T=L.useRef(null),R=zJ({onSessionStart:d,onSessionEnd:f,onStart:a,onMove:s,onEnd(I,N){T.current=null,l==null||l(I,N)}});L.useEffect(()=>{var I;(I=T.current)==null||I.updateHandlers(R.current)}),L.useEffect(()=>{const I=r.current;if(!I||!v)return;function N(F){T.current=new pEe(F,R.current,E)}return fO(I,"pointerdown",N)},[r,v,R,E]),L.useEffect(()=>()=>{var I;(I=T.current)==null||I.end(),T.current=null},[])}const eo={open:(r,t)=>`${r}[data-open], ${r}[open], ${r}[data-state=open] ${t}`,closed:(r,t)=>`${r}[data-closed], ${r}[data-state=closed] ${t}`,hover:(r,t)=>`${r}:hover ${t}, ${r}[data-hover] ${t}`,focus:(r,t)=>`${r}:focus ${t}, ${r}[data-focus] ${t}`,focusVisible:(r,t)=>`${r}:focus-visible ${t}`,focusWithin:(r,t)=>`${r}:focus-within ${t}`,active:(r,t)=>`${r}:active ${t}, ${r}[data-active] ${t}`,disabled:(r,t)=>`${r}:disabled ${t}, ${r}[data-disabled] ${t}`,invalid:(r,t)=>`${r}:invalid ${t}, ${r}[data-invalid] ${t}`,checked:(r,t)=>`${r}:checked ${t}, ${r}[data-checked] ${t}`,placeholderShown:(r,t)=>`${r}:placeholder-shown ${t}`},wh=r=>YJ(t=>r(t,"&"),"[role=group]","[data-group]",".group"),Jp=r=>YJ(t=>r(t,"~ &"),"[data-peer]",".peer"),YJ=(r,...t)=>t.map(r).join(", "),IS={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:wh(eo.open),_groupClosed:wh(eo.closed),_groupHover:wh(eo.hover),_peerHover:Jp(eo.hover),_groupFocus:wh(eo.focus),_peerFocus:Jp(eo.focus),_groupFocusVisible:wh(eo.focusVisible),_peerFocusVisible:Jp(eo.focusVisible),_groupActive:wh(eo.active),_peerActive:Jp(eo.active),_groupDisabled:wh(eo.disabled),_peerDisabled:Jp(eo.disabled),_groupInvalid:wh(eo.invalid),_peerInvalid:Jp(eo.invalid),_groupChecked:wh(eo.checked),_peerChecked:Jp(eo.checked),_groupFocusWithin:wh(eo.focusWithin),_peerFocusWithin:Jp(eo.focusWithin),_peerPlaceholderShown:Jp(eo.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},XJ=Object.keys(IS),yEe=r=>/!(important)?$/.test(r),_$=r=>typeof r=="string"?r.replace(/!(important)?$/,"").trim():r,vEe=(r,t)=>s=>{const a=String(t),l=yEe(a),d=_$(a),f=r?`${r}.${d}`:d;let E=Su(s.__cssMap)&&f in s.__cssMap?s.__cssMap[f].varRef:t;return E=_$(E),l?`${E} !important`:E};function yV(r){const{scale:t,transform:s,compose:a}=r;return(d,f)=>{const E=vEe(t,d)(f);let v=(s==null?void 0:s(E,f))??E;return a&&(v=a(v,f)),v}}const FP=(...r)=>t=>r.reduce((s,a)=>a(s),t);function pu(r,t){return s=>{const a={property:s,scale:r};return a.transform=yV({scale:r,transform:t}),a}}const SEe=({rtl:r,ltr:t})=>s=>s.direction==="rtl"?r:t;function TEe(r){const{property:t,scale:s,transform:a}=r;return{scale:s,property:SEe(t),transform:s?yV({scale:s,compose:a}):a}}const JJ=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function bEe(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...JJ].join(" ")}function wEe(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...JJ].join(" ")}const REe={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},CEe={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function IEe(r){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":r,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const AEe={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},U2={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},PEe=new Set(Object.values(U2)),V2=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),OEe=r=>r.trim();function kEe(r,t){if(r==null||V2.has(r))return r;if(!(F2(r)||V2.has(r)))return`url('${r}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(r),d=l==null?void 0:l[1],f=l==null?void 0:l[2];if(!d||!f)return r;const E=d.includes("-gradient")?d:`${d}-gradient`,[v,...T]=f.split(",").map(OEe).filter(Boolean);if((T==null?void 0:T.length)===0)return r;const R=v in U2?U2[v]:v;T.unshift(R);const I=T.map(N=>{if(PEe.has(N))return N;const F=N.indexOf(" "),[j,G]=F!==-1?[N.substr(0,F),N.substr(F+1)]:[N],H=F2(G)?G:G&&G.split(" "),te=`colors.${j}`,K=te in t.__cssMap?t.__cssMap[te].varRef:j;return H?[K,...Array.isArray(H)?H:[H]].join(" "):K});return`${E}(${I.join(", ")})`}const F2=r=>typeof r=="string"&&r.includes("(")&&r.includes(")"),NEe=(r,t)=>kEe(r,t??{});function DEe(r){return/^var\(--.+\)$/.test(r)}const LEe=r=>{const t=parseFloat(r.toString()),s=r.toString().replace(String(t),"");return{unitless:!s,value:t,unit:s}},Rh=r=>t=>`${r}(${t})`,Cr={filter(r){return r!=="auto"?r:REe},backdropFilter(r){return r!=="auto"?r:CEe},ring(r){return IEe(Cr.px(r))},bgClip(r){return r==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:r}},transform(r){return r==="auto"?bEe():r==="auto-gpu"?wEe():r},vh(r){return r==="$100vh"?"var(--chakra-vh)":r},px(r){if(r==null)return r;const{unitless:t}=LEe(r);return t||typeof r=="number"?`${r}px`:r},fraction(r){return typeof r!="number"||r>1?r:`${r*100}%`},float(r,t){const s={left:"right",right:"left"};return t.direction==="rtl"?s[r]:r},degree(r){if(DEe(r)||r==null)return r;const t=typeof r=="string"&&!r.endsWith("deg");return typeof r=="number"||t?`${r}deg`:r},gradient:NEe,blur:Rh("blur"),opacity:Rh("opacity"),brightness:Rh("brightness"),contrast:Rh("contrast"),dropShadow:Rh("drop-shadow"),grayscale:Rh("grayscale"),hueRotate:r=>Rh("hue-rotate")(Cr.degree(r)),invert:Rh("invert"),saturate:Rh("saturate"),sepia:Rh("sepia"),bgImage(r){return r==null||F2(r)||V2.has(r)?r:`url(${r})`},outline(r){const t=String(r)==="0"||String(r)==="none";return r!==null&&t?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:r}},flexDirection(r){const{space:t,divide:s}=AEe[r]??{},a={flexDirection:r};return t&&(a[t]=1),s&&(a[s]=1),a}},Be={borderWidths:pu("borderWidths"),borderStyles:pu("borderStyles"),colors:pu("colors"),borders:pu("borders"),gradients:pu("gradients",Cr.gradient),radii:pu("radii",Cr.px),space:pu("space",FP(Cr.vh,Cr.px)),spaceT:pu("space",FP(Cr.vh,Cr.px)),degreeT(r){return{property:r,transform:Cr.degree}},prop(r,t,s){return{property:r,scale:t,...t&&{transform:yV({scale:t,transform:s})}}},propT(r,t){return{property:r,transform:t}},sizes:pu("sizes",FP(Cr.vh,Cr.px)),sizesT:pu("sizes",FP(Cr.vh,Cr.fraction)),shadows:pu("shadows"),logical:TEe,blur:pu("blur",Cr.blur)},mO={background:Be.colors("background"),backgroundColor:Be.colors("backgroundColor"),backgroundImage:Be.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:Cr.bgClip},bgSize:Be.prop("backgroundSize"),bgPosition:Be.prop("backgroundPosition"),bg:Be.colors("background"),bgColor:Be.colors("backgroundColor"),bgPos:Be.prop("backgroundPosition"),bgRepeat:Be.prop("backgroundRepeat"),bgAttachment:Be.prop("backgroundAttachment"),bgGradient:Be.gradients("backgroundImage"),bgClip:{transform:Cr.bgClip}};Object.assign(mO,{bgImage:mO.backgroundImage,bgImg:mO.backgroundImage});const $r={border:Be.borders("border"),borderWidth:Be.borderWidths("borderWidth"),borderStyle:Be.borderStyles("borderStyle"),borderColor:Be.colors("borderColor"),borderRadius:Be.radii("borderRadius"),borderTop:Be.borders("borderTop"),borderBlockStart:Be.borders("borderBlockStart"),borderTopLeftRadius:Be.radii("borderTopLeftRadius"),borderStartStartRadius:Be.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Be.radii("borderTopRightRadius"),borderStartEndRadius:Be.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Be.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Be.borders("borderRight"),borderInlineEnd:Be.borders("borderInlineEnd"),borderBottom:Be.borders("borderBottom"),borderBlockEnd:Be.borders("borderBlockEnd"),borderBottomLeftRadius:Be.radii("borderBottomLeftRadius"),borderBottomRightRadius:Be.radii("borderBottomRightRadius"),borderLeft:Be.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Be.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Be.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Be.borders(["borderLeft","borderRight"]),borderInline:Be.borders("borderInline"),borderY:Be.borders(["borderTop","borderBottom"]),borderBlock:Be.borders("borderBlock"),borderTopWidth:Be.borderWidths("borderTopWidth"),borderBlockStartWidth:Be.borderWidths("borderBlockStartWidth"),borderTopColor:Be.colors("borderTopColor"),borderBlockStartColor:Be.colors("borderBlockStartColor"),borderTopStyle:Be.borderStyles("borderTopStyle"),borderBlockStartStyle:Be.borderStyles("borderBlockStartStyle"),borderBottomWidth:Be.borderWidths("borderBottomWidth"),borderBlockEndWidth:Be.borderWidths("borderBlockEndWidth"),borderBottomColor:Be.colors("borderBottomColor"),borderBlockEndColor:Be.colors("borderBlockEndColor"),borderBottomStyle:Be.borderStyles("borderBottomStyle"),borderBlockEndStyle:Be.borderStyles("borderBlockEndStyle"),borderLeftWidth:Be.borderWidths("borderLeftWidth"),borderInlineStartWidth:Be.borderWidths("borderInlineStartWidth"),borderLeftColor:Be.colors("borderLeftColor"),borderInlineStartColor:Be.colors("borderInlineStartColor"),borderLeftStyle:Be.borderStyles("borderLeftStyle"),borderInlineStartStyle:Be.borderStyles("borderInlineStartStyle"),borderRightWidth:Be.borderWidths("borderRightWidth"),borderInlineEndWidth:Be.borderWidths("borderInlineEndWidth"),borderRightColor:Be.colors("borderRightColor"),borderInlineEndColor:Be.colors("borderInlineEndColor"),borderRightStyle:Be.borderStyles("borderRightStyle"),borderInlineEndStyle:Be.borderStyles("borderInlineEndStyle"),borderTopRadius:Be.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Be.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Be.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Be.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign($r,{rounded:$r.borderRadius,roundedTop:$r.borderTopRadius,roundedTopLeft:$r.borderTopLeftRadius,roundedTopRight:$r.borderTopRightRadius,roundedTopStart:$r.borderStartStartRadius,roundedTopEnd:$r.borderStartEndRadius,roundedBottom:$r.borderBottomRadius,roundedBottomLeft:$r.borderBottomLeftRadius,roundedBottomRight:$r.borderBottomRightRadius,roundedBottomStart:$r.borderEndStartRadius,roundedBottomEnd:$r.borderEndEndRadius,roundedLeft:$r.borderLeftRadius,roundedRight:$r.borderRightRadius,roundedStart:$r.borderInlineStartRadius,roundedEnd:$r.borderInlineEndRadius,borderStart:$r.borderInlineStart,borderEnd:$r.borderInlineEnd,borderTopStartRadius:$r.borderStartStartRadius,borderTopEndRadius:$r.borderStartEndRadius,borderBottomStartRadius:$r.borderEndStartRadius,borderBottomEndRadius:$r.borderEndEndRadius,borderStartRadius:$r.borderInlineStartRadius,borderEndRadius:$r.borderInlineEndRadius,borderStartWidth:$r.borderInlineStartWidth,borderEndWidth:$r.borderInlineEndWidth,borderStartColor:$r.borderInlineStartColor,borderEndColor:$r.borderInlineEndColor,borderStartStyle:$r.borderInlineStartStyle,borderEndStyle:$r.borderInlineEndStyle});const xEe={color:Be.colors("color"),textColor:Be.colors("color"),fill:Be.colors("fill"),stroke:Be.colors("stroke"),accentColor:Be.colors("accentColor"),textFillColor:Be.colors("textFillColor")},QO={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:Cr.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Be.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Be.space("gap"),rowGap:Be.space("rowGap"),columnGap:Be.space("columnGap")};Object.assign(QO,{flexDir:QO.flexDirection});const gu={width:Be.sizesT("width"),inlineSize:Be.sizesT("inlineSize"),height:Be.sizes("height"),blockSize:Be.sizes("blockSize"),boxSize:Be.sizes(["width","height"]),minWidth:Be.sizes("minWidth"),minInlineSize:Be.sizes("minInlineSize"),minHeight:Be.sizes("minHeight"),minBlockSize:Be.sizes("minBlockSize"),maxWidth:Be.sizes("maxWidth"),maxInlineSize:Be.sizes("maxInlineSize"),maxHeight:Be.sizes("maxHeight"),maxBlockSize:Be.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(r,t)=>{var l,d;return{[`@media screen and (min-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(r))==null?void 0:d.minW)??r})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(r,t)=>{var l,d;return{[`@media screen and (max-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(r))==null?void 0:d._minW)??r})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Be.propT("float",Cr.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(gu,{w:gu.width,h:gu.height,minW:gu.minWidth,maxW:gu.maxWidth,minH:gu.minHeight,maxH:gu.maxHeight,overscroll:gu.overscrollBehavior,overscrollX:gu.overscrollBehaviorX,overscrollY:gu.overscrollBehaviorY});const MEe={filter:{transform:Cr.filter},blur:Be.blur("--chakra-blur"),brightness:Be.propT("--chakra-brightness",Cr.brightness),contrast:Be.propT("--chakra-contrast",Cr.contrast),hueRotate:Be.propT("--chakra-hue-rotate",Cr.hueRotate),invert:Be.propT("--chakra-invert",Cr.invert),saturate:Be.propT("--chakra-saturate",Cr.saturate),dropShadow:Be.propT("--chakra-drop-shadow",Cr.dropShadow),backdropFilter:{transform:Cr.backdropFilter},backdropBlur:Be.blur("--chakra-backdrop-blur"),backdropBrightness:Be.propT("--chakra-backdrop-brightness",Cr.brightness),backdropContrast:Be.propT("--chakra-backdrop-contrast",Cr.contrast),backdropHueRotate:Be.propT("--chakra-backdrop-hue-rotate",Cr.hueRotate),backdropInvert:Be.propT("--chakra-backdrop-invert",Cr.invert),backdropSaturate:Be.propT("--chakra-backdrop-saturate",Cr.saturate)},UEe={ring:{transform:Cr.ring},ringColor:Be.colors("--chakra-ring-color"),ringOffset:Be.prop("--chakra-ring-offset-width"),ringOffsetColor:Be.colors("--chakra-ring-offset-color"),ringInset:Be.prop("--chakra-ring-inset")},VEe={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:Cr.outline},outlineOffset:!0,outlineColor:Be.colors("outlineColor")},QJ={gridGap:Be.space("gridGap"),gridColumnGap:Be.space("gridColumnGap"),gridRowGap:Be.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function FEe(r,t,s,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&r;a+=1)r=r[l[a]];return r===void 0?s:r}const jEe=r=>{const t=new WeakMap;return(a,l,d,f)=>{if(typeof a>"u")return r(a,l,d);t.has(a)||t.set(a,new Map);const E=t.get(a);if(E.has(l))return E.get(l);const v=r(a,l,d,f);return E.set(l,v),v}},BEe=jEe(FEe),WEe={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},zEe={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},EM=(r,t,s)=>{const a={},l=BEe(r,t,{});for(const d in l)d in s&&s[d]!=null||(a[d]=l[d]);return a},GEe={srOnly:{transform(r){return r===!0?WEe:r==="focusable"?zEe:{}}},layerStyle:{processResult:!0,transform:(r,t,s)=>EM(t,`layerStyles.${r}`,s)},textStyle:{processResult:!0,transform:(r,t,s)=>EM(t,`textStyles.${r}`,s)},apply:{processResult:!0,transform:(r,t,s)=>EM(t,r,s)}},Cw={position:!0,pos:Be.prop("position"),zIndex:Be.prop("zIndex","zIndices"),inset:Be.spaceT("inset"),insetX:Be.spaceT(["left","right"]),insetInline:Be.spaceT("insetInline"),insetY:Be.spaceT(["top","bottom"]),insetBlock:Be.spaceT("insetBlock"),top:Be.spaceT("top"),insetBlockStart:Be.spaceT("insetBlockStart"),bottom:Be.spaceT("bottom"),insetBlockEnd:Be.spaceT("insetBlockEnd"),left:Be.spaceT("left"),insetInlineStart:Be.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Be.spaceT("right"),insetInlineEnd:Be.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(Cw,{insetStart:Cw.insetInlineStart,insetEnd:Cw.insetInlineEnd});const j2={boxShadow:Be.shadows("boxShadow"),mixBlendMode:!0,blendMode:Be.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Be.prop("backgroundBlendMode"),opacity:!0};Object.assign(j2,{shadow:j2.boxShadow});const Ui={margin:Be.spaceT("margin"),marginTop:Be.spaceT("marginTop"),marginBlockStart:Be.spaceT("marginBlockStart"),marginRight:Be.spaceT("marginRight"),marginInlineEnd:Be.spaceT("marginInlineEnd"),marginBottom:Be.spaceT("marginBottom"),marginBlockEnd:Be.spaceT("marginBlockEnd"),marginLeft:Be.spaceT("marginLeft"),marginInlineStart:Be.spaceT("marginInlineStart"),marginX:Be.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Be.spaceT("marginInline"),marginY:Be.spaceT(["marginTop","marginBottom"]),marginBlock:Be.spaceT("marginBlock"),padding:Be.space("padding"),paddingTop:Be.space("paddingTop"),paddingBlockStart:Be.space("paddingBlockStart"),paddingRight:Be.space("paddingRight"),paddingBottom:Be.space("paddingBottom"),paddingBlockEnd:Be.space("paddingBlockEnd"),paddingLeft:Be.space("paddingLeft"),paddingInlineStart:Be.space("paddingInlineStart"),paddingInlineEnd:Be.space("paddingInlineEnd"),paddingX:Be.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Be.space("paddingInline"),paddingY:Be.space(["paddingTop","paddingBottom"]),paddingBlock:Be.space("paddingBlock")};Object.assign(Ui,{m:Ui.margin,mt:Ui.marginTop,mr:Ui.marginRight,me:Ui.marginInlineEnd,marginEnd:Ui.marginInlineEnd,mb:Ui.marginBottom,ml:Ui.marginLeft,ms:Ui.marginInlineStart,marginStart:Ui.marginInlineStart,mx:Ui.marginX,my:Ui.marginY,p:Ui.padding,pt:Ui.paddingTop,py:Ui.paddingY,px:Ui.paddingX,pb:Ui.paddingBottom,pl:Ui.paddingLeft,ps:Ui.paddingInlineStart,paddingStart:Ui.paddingInlineStart,pr:Ui.paddingRight,pe:Ui.paddingInlineEnd,paddingEnd:Ui.paddingInlineEnd});const HEe={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Be.spaceT("scrollMargin"),scrollMarginTop:Be.spaceT("scrollMarginTop"),scrollMarginBottom:Be.spaceT("scrollMarginBottom"),scrollMarginLeft:Be.spaceT("scrollMarginLeft"),scrollMarginRight:Be.spaceT("scrollMarginRight"),scrollMarginX:Be.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Be.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Be.spaceT("scrollPadding"),scrollPaddingTop:Be.spaceT("scrollPaddingTop"),scrollPaddingBottom:Be.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Be.spaceT("scrollPaddingLeft"),scrollPaddingRight:Be.spaceT("scrollPaddingRight"),scrollPaddingX:Be.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Be.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},$Ee={fontFamily:Be.prop("fontFamily","fonts"),fontSize:Be.prop("fontSize","fontSizes",Cr.px),fontWeight:Be.prop("fontWeight","fontWeights"),lineHeight:Be.prop("lineHeight","lineHeights"),letterSpacing:Be.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(r){if(r===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},KEe={textDecorationColor:Be.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Be.shadows("textShadow")},qEe={clipPath:!0,transform:Be.propT("transform",Cr.transform),transformOrigin:!0,translateX:Be.spaceT("--chakra-translate-x"),translateY:Be.spaceT("--chakra-translate-y"),skewX:Be.degreeT("--chakra-skew-x"),skewY:Be.degreeT("--chakra-skew-y"),scaleX:Be.prop("--chakra-scale-x"),scaleY:Be.prop("--chakra-scale-y"),scale:Be.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Be.degreeT("--chakra-rotate")},YEe={listStyleType:!0,listStylePosition:!0,listStylePos:Be.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Be.prop("listStyleImage")},XEe={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Be.prop("transitionDuration","transition.duration"),transitionProperty:Be.prop("transitionProperty","transition.property"),transitionTimingFunction:Be.prop("transitionTimingFunction","transition.easing")},vV=Lh({},mO,$r,xEe,QO,gu,MEe,UEe,VEe,QJ,GEe,Cw,j2,Ui,HEe,$Ee,KEe,qEe,YEe,XEe),JEe=Object.assign({},Ui,gu,QO,QJ,Cw),QEe=Object.keys(JEe),ZEe=[...Object.keys(vV),...XJ],eye={...vV,...IS},tye=r=>r in eye,nye=r=>t=>{if(!t.__breakpoints)return r;const{isResponsive:s,toArrayValue:a,media:l}=t.__breakpoints,d={};for(const f in r){let E=Hc(r[f],t);if(E==null)continue;if(E=Su(E)&&s(E)?a(E):E,!Array.isArray(E)){d[f]=E;continue}const v=E.slice(0,l.length).length;for(let T=0;T<v;T+=1){const R=l==null?void 0:l[T];if(!R){d[f]=E[T];continue}d[R]=d[R]||{},E[T]!=null&&(d[R][f]=E[T])}}return d};function rye(r){const t=[];let s="",a=!1;for(let l=0;l<r.length;l++){const d=r[l];d==="("?(a=!0,s+=d):d===")"?(a=!1,s+=d):d===","&&!a?(t.push(s),s=""):s+=d}return s=s.trim(),s&&t.push(s),t}function iye(r){return/^var\(--.+\)$/.test(r)}const sye=(r,t)=>r.startsWith("--")&&typeof t=="string"&&!iye(t),oye=(r,t)=>{if(t==null)return t;const s=f=>{var E,v;return(v=(E=r.__cssMap)==null?void 0:E[f])==null?void 0:v.varRef},a=f=>s(f)??f,[l,d]=rye(t);return t=s(l)??a(d)??a(t),t};function aye(r){const{configs:t={},pseudos:s={},theme:a}=r,l=(d,f=!1)=>{var R;const E=Hc(d,a),v=nye(E)(a);let T={};for(let I in v){const N=v[I];let F=Hc(N,a);I in s&&(I=s[I]),sye(I,F)&&(F=oye(a,F));let j=t[I];if(j===!0&&(j={property:I}),Su(F)){T[I]=T[I]??{},T[I]=Lh({},T[I],l(F,!0));continue}let G=((R=j==null?void 0:j.transform)==null?void 0:R.call(j,F,a,E))??F;G=j!=null&&j.processResult?l(G,!0):G;const H=Hc(j==null?void 0:j.property,a);if(!f&&(j!=null&&j.static)){const te=Hc(j.static,a);T=Lh({},T,te)}if(H&&Array.isArray(H)){for(const te of H)T[te]=G;continue}if(H){H==="&"&&Su(G)?T=Lh({},T,G):T[H]=G;continue}if(Su(G)){T=Lh({},T,G);continue}T[I]=G}return T};return l}const ZJ=r=>t=>aye({theme:t,pseudos:IS,configs:vV})(r);function R6e(r){return r}function C6e(r){return r}function Ai(r){return{definePartsStyle(t){return t},defineMultiStyleConfig(t){return{parts:r,...t}}}}function cye(r,t,s){var a,l;return((l=(a=r.__cssMap)==null?void 0:a[`${t}.${s}`])==null?void 0:l.varRef)??s}function lye(r,t){if(Array.isArray(r))return r;if(Su(r))return t(r);if(r!=null)return[r]}function uye(r,t){for(let s=t+1;s<r.length;s++)if(r[s]!=null)return s;return-1}function dye(r){const t=r.__breakpoints;return function(a,l,d,f){var N,F;if(!t)return;const E={},v=lye(d,t.toArrayValue);if(!v)return E;const T=v.length,R=T===1,I=!!a.parts;for(let j=0;j<T;j++){const G=t.details[j],H=t.details[uye(v,j)],te=cw(G.minW,H==null?void 0:H._minW),K=Hc((N=a[l])==null?void 0:N[v[j]],f);if(K){if(I){(F=a.parts)==null||F.forEach(ee=>{Lh(E,{[ee]:R?K[ee]:{[te]:K[ee]}})});continue}if(!I){R?Lh(E,K):E[te]=K;continue}E[te]=K}}return E}}function hye(r){return t=>{const{variant:s,size:a,theme:l}=t,d=dye(l);return Lh({},Hc(r.baseStyle??{},t),d(r,"sizes",a,t),d(r,"variants",s,t))}}function Ji(r){return d0(r,["styleConfig","size","variant","colorScheme"])}function eQ(r){return Su(r)&&r.reference?r.reference:String(r)}const Gk=(r,...t)=>t.map(eQ).join(` ${r} `).replace(/calc/g,""),E$=(...r)=>`calc(${Gk("+",...r)})`,y$=(...r)=>`calc(${Gk("-",...r)})`,B2=(...r)=>`calc(${Gk("*",...r)})`,v$=(...r)=>`calc(${Gk("/",...r)})`,S$=r=>{const t=eQ(r);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:B2(t,-1)},nf=Object.assign(r=>({add:(...t)=>nf(E$(r,...t)),subtract:(...t)=>nf(y$(r,...t)),multiply:(...t)=>nf(B2(r,...t)),divide:(...t)=>nf(v$(r,...t)),negate:()=>nf(S$(r)),toString:()=>r.toString()}),{add:E$,subtract:y$,multiply:B2,divide:v$,negate:S$});function pye(r,t="-"){return r.replace(/\s+/g,t)}function fye(r){const t=pye(r.toString());return gye(mye(t))}function mye(r){return r.includes("\\.")?r:!Number.isInteger(parseFloat(r.toString()))?r.replace(".","\\."):r}function gye(r){return r.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function _ye(r,t=""){return[t,r].filter(Boolean).join("-")}function Eye(r,t){return`var(${r}${t?`, ${t}`:""})`}function yye(r,t=""){return fye(`--${_ye(r,t)}`)}function Pn(r,t,s){const a=yye(r,s);return{variable:a,reference:Eye(a,t)}}function vye(r,t){const s={};for(const a of t){if(Array.isArray(a)){const[l,d]=a;s[l]=Pn(`${r}-${l}`,d);continue}s[a]=Pn(`${r}-${a}`)}return s}const Sye=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function Tye(r){return UJ(r,Sye)}function bye(r){return r.semanticTokens}function wye(r){const{__cssMap:t,__cssVars:s,__breakpoints:a,...l}=r;return l}function Rye(r){const t=Tye(r),s=bye(r),a=d=>XJ.includes(d)||d==="default",l={};return h$(t,(d,f)=>{d!=null&&(l[f.join(".")]={isSemantic:!1,value:d})}),h$(s,(d,f)=>{d!=null&&(l[f.join(".")]={isSemantic:!0,value:d})},{stop:d=>Object.keys(d).every(a)}),l}function T$(r,t){return Pn(String(r).replace(/\./g,"-"),void 0,t)}function Cye(r){var f;const t=Rye(r),s=(f=r.config)==null?void 0:f.cssVarPrefix;let a={};const l={};function d(E,v){const R=[String(E).split(".")[0],v].join(".");if(!t[R])return v;const{reference:N}=T$(R,s);return N}for(const[E,v]of Object.entries(t)){const{isSemantic:T,value:R}=v,{variable:I,reference:N}=T$(E,s);if(!T){if(E.startsWith("space")){const j=E.split("."),[G,...H]=j,te=`${G}.-${H.join(".")}`,K=nf.negate(R),ee=nf.negate(N);l[te]={value:K,var:I,varRef:ee}}a[I]=R,l[E]={value:R,var:I,varRef:N};continue}const F=Su(R)?R:{default:R};a=Lh(a,Object.entries(F).reduce((j,[G,H])=>{if(!H)return j;const te=d(E,`${H}`);if(G==="default")return j[I]=te,j;const K=(IS==null?void 0:IS[G])??G;return j[K]={[I]:te},j},{})),l[E]={value:N,var:I,varRef:N}}return{cssVars:a,cssMap:l}}function Iye(r){const t=wye(r),{cssMap:s,cssVars:a}=Cye(t);return Object.assign(t,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...a},__cssMap:s,__breakpoints:S_e(t.breakpoints)}),t}function Xr(r,t={}){let s=!1;function a(){if(!s){s=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...R){a();for(const I of R)t[I]=v(I);return Xr(r,t)}function d(...R){for(const I of R)I in t||(t[I]=v(I));return Xr(r,t)}function f(){return Object.fromEntries(Object.entries(t).map(([I,N])=>[I,N.selector]))}function E(){return Object.fromEntries(Object.entries(t).map(([I,N])=>[I,N.className]))}function v(R){const F=`chakra-${(["container","root"].includes(R??"")?[r]:[r,R]).filter(Boolean).join("__")}`;return{className:F,selector:`.${F}`,toString:()=>R}}return{parts:l,toPart:v,extend:d,selectors:f,classnames:E,get keys(){return Object.keys(t)},__type:{}}}const Aye=Xr("accordion").parts("root","container","button","panel","icon"),Pye=Xr("alert").parts("title","description","container","icon","spinner"),Oye=Xr("avatar").parts("label","badge","container","excessLabel","group"),kye=Xr("breadcrumb").parts("link","item","container","separator");Xr("button").parts();const Nye=Xr("checkbox").parts("control","icon","container","label");Xr("progress").parts("track","filledTrack","label");const Dye=Xr("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),Lye=Xr("editable").parts("preview","input","textarea"),xye=Xr("form").parts("container","requiredIndicator","helperText"),Mye=Xr("formError").parts("text","icon"),Uye=Xr("input").parts("addon","field","element","group"),Vye=Xr("list").parts("container","item","icon"),Fye=Xr("menu").parts("button","list","item","groupTitle","icon","command","divider"),jye=Xr("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),Bye=Xr("numberinput").parts("root","field","stepperGroup","stepper");Xr("pininput").parts("field");const Wye=Xr("popover").parts("content","header","body","footer","popper","arrow","closeButton"),zye=Xr("progress").parts("label","filledTrack","track"),Gye=Xr("radio").parts("container","control","label"),Hye=Xr("select").parts("field","icon"),$ye=Xr("slider").parts("container","track","thumb","filledTrack","mark"),Kye=Xr("stat").parts("container","label","helpText","number","icon"),qye=Xr("switch").parts("container","track","thumb","label"),Yye=Xr("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),Xye=Xr("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),Jye=Xr("tag").parts("container","label","closeButton"),Qye=Xr("card").parts("container","header","body","footer");Xr("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:Zye,defineMultiStyleConfig:eve}=Ai(Aye.keys),tve={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},nve={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},rve={pt:"2",px:"4",pb:"5"},ive={fontSize:"1.25em"},sve=Zye({container:tve,button:nve,panel:rve,icon:ive}),ove=eve({baseStyle:sve});function tE(r,t,s){return Math.min(Math.max(r,s),t)}class ave extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}}var uw=ave;function SV(r){if(typeof r!="string")throw new uw(r);if(r.trim().toLowerCase()==="transparent")return[0,0,0,0];let t=r.trim();t=mve.test(r)?uve(r):r;const s=dve.exec(t);if(s){const f=Array.from(s).slice(1);return[...f.slice(0,3).map(E=>parseInt(qw(E,2),16)),parseInt(qw(f[3]||"f",2),16)/255]}const a=hve.exec(t);if(a){const f=Array.from(a).slice(1);return[...f.slice(0,3).map(E=>parseInt(E,16)),parseInt(f[3]||"ff",16)/255]}const l=pve.exec(t);if(l){const f=Array.from(l).slice(1);return[...f.slice(0,3).map(E=>parseInt(E,10)),parseFloat(f[3]||"1")]}const d=fve.exec(t);if(d){const[f,E,v,T]=Array.from(d).slice(1).map(parseFloat);if(tE(0,100,E)!==E)throw new uw(r);if(tE(0,100,v)!==v)throw new uw(r);return[...gve(f,E,v),Number.isNaN(T)?1:T]}throw new uw(r)}function cve(r){let t=5381,s=r.length;for(;s;)t=t*33^r.charCodeAt(--s);return(t>>>0)%2341}const b$=r=>parseInt(r.replace(/_/g,""),36),lve="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((r,t)=>{const s=b$(t.substring(0,3)),a=b$(t.substring(3)).toString(16);let l="";for(let d=0;d<6-a.length;d++)l+="0";return r[s]=`${l}${a}`,r},{});function uve(r){const t=r.toLowerCase().trim(),s=lve[cve(t)];if(!s)throw new uw(r);return`#${s}`}const qw=(r,t)=>Array.from(Array(t)).map(()=>r).join(""),dve=new RegExp(`^#${qw("([a-f0-9])",3)}([a-f0-9])?$`,"i"),hve=new RegExp(`^#${qw("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),pve=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${qw(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),fve=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,mve=/^[a-z]+$/i,w$=r=>Math.round(r*255),gve=(r,t,s)=>{let a=s/100;if(t===0)return[a,a,a].map(w$);const l=(r%360+360)%360/60,d=(1-Math.abs(2*a-1))*(t/100),f=d*(1-Math.abs(l%2-1));let E=0,v=0,T=0;l>=0&&l<1?(E=d,v=f):l>=1&&l<2?(E=f,v=d):l>=2&&l<3?(v=d,T=f):l>=3&&l<4?(v=f,T=d):l>=4&&l<5?(E=f,T=d):l>=5&&l<6&&(E=d,T=f);const R=a-d/2,I=E+R,N=v+R,F=T+R;return[I,N,F].map(w$)};function _ve(r,t,s,a){return`rgba(${tE(0,255,r).toFixed()}, ${tE(0,255,t).toFixed()}, ${tE(0,255,s).toFixed()}, ${parseFloat(tE(0,1,a).toFixed(3))})`}function Eve(r,t){const[s,a,l,d]=SV(r);return _ve(s,a,l,d-t)}function yve(r){const[t,s,a,l]=SV(r);let d=f=>{const E=tE(0,255,f).toString(16);return E.length===1?`0${E}`:E};return`#${d(t)}${d(s)}${d(a)}${l<1?d(Math.round(l*255)):""}`}const vve=r=>Object.keys(r).length===0;function Sve(r,t,s,a,l){for(t=t.split?t.split("."):t,a=0;a<t.length;a++)r=r?r[t[a]]:l;return r===l?s:r}const Qa=(r,t,s)=>{const a=Sve(r,`colors.${t}`,t);try{return yve(a),a}catch{return s??"#000000"}},Tve=r=>{const[t,s,a]=SV(r);return(t*299+s*587+a*114)/1e3},bve=r=>t=>{const s=Qa(t,r);return Tve(s)<128?"dark":"light"},wve=r=>t=>bve(r)(t)==="dark",BS=(r,t)=>s=>{const a=Qa(s,r);return Eve(a,1-t)};function R$(r="1rem",t="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${t} 25%,
    transparent 25%,
    transparent 50%,
    ${t} 50%,
    ${t} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${r} ${r}`}}const Rve=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function Cve(r){const t=Rve();return!r||vve(r)?t:r.string&&r.colors?Ave(r.string,r.colors):r.string&&!r.colors?Ive(r.string):r.colors&&!r.string?Pve(r.colors):t}function Ive(r){let t=0;if(r.length===0)return t.toString();for(let a=0;a<r.length;a+=1)t=r.charCodeAt(a)+((t<<5)-t),t=t&t;let s="#";for(let a=0;a<3;a+=1){const l=t>>a*8&255;s+=`00${l.toString(16)}`.substr(-2)}return s}function Ave(r,t){let s=0;if(r.length===0)return t[0];for(let a=0;a<r.length;a+=1)s=r.charCodeAt(a)+((s<<5)-s),s=s&s;return s=(s%t.length+t.length)%t.length,t[s]}function Pve(r){return r[Math.floor(Math.random()*r.length)]}function An(r,t){return s=>s.colorMode==="dark"?t:r}function TV(r){const{orientation:t,vertical:s,horizontal:a}=r;return t?t==="vertical"?s:a:{}}function tQ(r){return Su(r)&&r.reference?r.reference:String(r)}const Hk=(r,...t)=>t.map(tQ).join(` ${r} `).replace(/calc/g,""),C$=(...r)=>`calc(${Hk("+",...r)})`,I$=(...r)=>`calc(${Hk("-",...r)})`,W2=(...r)=>`calc(${Hk("*",...r)})`,A$=(...r)=>`calc(${Hk("/",...r)})`,P$=r=>{const t=tQ(r);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:W2(t,-1)},rf=Object.assign(r=>({add:(...t)=>rf(C$(r,...t)),subtract:(...t)=>rf(I$(r,...t)),multiply:(...t)=>rf(W2(r,...t)),divide:(...t)=>rf(A$(r,...t)),negate:()=>rf(P$(r)),toString:()=>r.toString()}),{add:C$,subtract:I$,multiply:W2,divide:A$,negate:P$});function Ove(r){return!Number.isInteger(parseFloat(r.toString()))}function kve(r,t="-"){return r.replace(/\s+/g,t)}function nQ(r){const t=kve(r.toString());return t.includes("\\.")?r:Ove(r)?t.replace(".","\\."):r}function Nve(r,t=""){return[t,nQ(r)].filter(Boolean).join("-")}function Dve(r,t){return`var(${nQ(r)}${t?`, ${t}`:""})`}function Lve(r,t=""){return`--${Nve(r,t)}`}function io(r,t){const s=Lve(r,t==null?void 0:t.prefix);return{variable:s,reference:Dve(s,xve(t==null?void 0:t.fallback))}}function xve(r){return r==null?void 0:r.reference}const{definePartsStyle:bR,defineMultiStyleConfig:Mve}=Ai(Pye.keys),Cl=Pn("alert-fg"),Ef=Pn("alert-bg"),Uve=bR({container:{bg:Ef.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:Cl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:Cl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function bV(r){const{theme:t,colorScheme:s}=r,a=BS(`${s}.200`,.16)(t);return{light:`colors.${s}.100`,dark:a}}const Vve=bR(r=>{const{colorScheme:t}=r,s=bV(r);return{container:{[Cl.variable]:`colors.${t}.600`,[Ef.variable]:s.light,_dark:{[Cl.variable]:`colors.${t}.200`,[Ef.variable]:s.dark}}}}),Fve=bR(r=>{const{colorScheme:t}=r,s=bV(r);return{container:{[Cl.variable]:`colors.${t}.600`,[Ef.variable]:s.light,_dark:{[Cl.variable]:`colors.${t}.200`,[Ef.variable]:s.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:Cl.reference}}}),jve=bR(r=>{const{colorScheme:t}=r,s=bV(r);return{container:{[Cl.variable]:`colors.${t}.600`,[Ef.variable]:s.light,_dark:{[Cl.variable]:`colors.${t}.200`,[Ef.variable]:s.dark},pt:"2",borderTopWidth:"4px",borderTopColor:Cl.reference}}}),Bve=bR(r=>{const{colorScheme:t}=r;return{container:{[Cl.variable]:"colors.white",[Ef.variable]:`colors.${t}.600`,_dark:{[Cl.variable]:"colors.gray.900",[Ef.variable]:`colors.${t}.200`},color:Cl.reference}}}),Wve={subtle:Vve,"left-accent":Fve,"top-accent":jve,solid:Bve},zve=Mve({baseStyle:Uve,variants:Wve,defaultProps:{variant:"subtle",colorScheme:"blue"}}),rQ={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},Gve={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},Hve={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},iQ={...rQ,...Gve,container:Hve},$ve=r=>typeof r=="function";function Za(r,...t){return $ve(r)?r(...t):r}const{definePartsStyle:sQ,defineMultiStyleConfig:Kve}=Ai(Oye.keys),AS=Pn("avatar-border-color"),Iw=Pn("avatar-bg"),Yw=Pn("avatar-font-size"),WS=Pn("avatar-size"),qve={borderRadius:"full",border:"0.2em solid",borderColor:AS.reference,[AS.variable]:"white",_dark:{[AS.variable]:"colors.gray.800"}},Yve={bg:Iw.reference,fontSize:Yw.reference,width:WS.reference,height:WS.reference,lineHeight:"1",[Iw.variable]:"colors.gray.200",_dark:{[Iw.variable]:"colors.whiteAlpha.400"}},Xve=r=>{const{name:t,theme:s}=r,a=t?Cve({string:t}):"colors.gray.400",l=wve(a)(s);let d="white";return l||(d="gray.800"),{bg:Iw.reference,fontSize:Yw.reference,color:d,borderColor:AS.reference,verticalAlign:"top",width:WS.reference,height:WS.reference,"&:not([data-loaded])":{[Iw.variable]:a},[AS.variable]:"colors.white",_dark:{[AS.variable]:"colors.gray.800"}}},Jve={fontSize:Yw.reference,lineHeight:"1"},Qve=sQ(r=>({badge:Za(qve,r),excessLabel:Za(Yve,r),container:Za(Xve,r),label:Jve}));function Fm(r){const t=r!=="100%"?iQ[r]:void 0;return sQ({container:{[WS.variable]:t??r,[Yw.variable]:`calc(${t??r} / 2.5)`},excessLabel:{[WS.variable]:t??r,[Yw.variable]:`calc(${t??r} / 2.5)`}})}const Zve={"2xs":Fm(4),xs:Fm(6),sm:Fm(8),md:Fm(12),lg:Fm(16),xl:Fm(24),"2xl":Fm(32),full:Fm("100%")},eSe=Kve({baseStyle:Qve,sizes:Zve,defaultProps:{size:"md"}}),Ds=vye("badge",["bg","color","shadow"]),tSe={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:Ds.bg.reference,color:Ds.color.reference,boxShadow:Ds.shadow.reference},nSe=r=>{const{colorScheme:t,theme:s}=r,a=BS(`${t}.500`,.6)(s);return{[Ds.bg.variable]:`colors.${t}.500`,[Ds.color.variable]:"colors.white",_dark:{[Ds.bg.variable]:a,[Ds.color.variable]:"colors.whiteAlpha.800"}}},rSe=r=>{const{colorScheme:t,theme:s}=r,a=BS(`${t}.200`,.16)(s);return{[Ds.bg.variable]:`colors.${t}.100`,[Ds.color.variable]:`colors.${t}.800`,_dark:{[Ds.bg.variable]:a,[Ds.color.variable]:`colors.${t}.200`}}},iSe=r=>{const{colorScheme:t,theme:s}=r,a=BS(`${t}.200`,.8)(s);return{[Ds.color.variable]:`colors.${t}.500`,_dark:{[Ds.color.variable]:a},[Ds.shadow.variable]:`inset 0 0 0px 1px ${Ds.color.reference}`}},sSe={solid:nSe,subtle:rSe,outline:iSe},Aw={baseStyle:tSe,variants:sSe,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:oSe,definePartsStyle:aSe}=Ai(kye.keys),yM=Pn("breadcrumb-link-decor"),cSe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:yM.reference,[yM.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[yM.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},lSe=aSe({link:cSe}),uSe=oSe({baseStyle:lSe}),dSe={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},oQ=r=>{const{colorScheme:t,theme:s}=r;if(t==="gray")return{color:An("gray.800","whiteAlpha.900")(r),_hover:{bg:An("gray.100","whiteAlpha.200")(r)},_active:{bg:An("gray.200","whiteAlpha.300")(r)}};const a=BS(`${t}.200`,.12)(s),l=BS(`${t}.200`,.24)(s);return{color:An(`${t}.600`,`${t}.200`)(r),bg:"transparent",_hover:{bg:An(`${t}.50`,a)(r)},_active:{bg:An(`${t}.100`,l)(r)}}},hSe=r=>{const{colorScheme:t}=r,s=An("gray.200","whiteAlpha.300")(r);return{border:"1px solid",borderColor:t==="gray"?s:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...Za(oQ,r)}},pSe={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},fSe=r=>{const{colorScheme:t}=r;if(t==="gray"){const E=An("gray.100","whiteAlpha.200")(r);return{bg:E,color:An("gray.800","whiteAlpha.900")(r),_hover:{bg:An("gray.200","whiteAlpha.300")(r),_disabled:{bg:E}},_active:{bg:An("gray.300","whiteAlpha.400")(r)}}}const{bg:s=`${t}.500`,color:a="white",hoverBg:l=`${t}.600`,activeBg:d=`${t}.700`}=pSe[t]??{},f=An(s,`${t}.200`)(r);return{bg:f,color:An(a,"gray.800")(r),_hover:{bg:An(l,`${t}.300`)(r),_disabled:{bg:f}},_active:{bg:An(d,`${t}.400`)(r)}}},mSe=r=>{const{colorScheme:t}=r;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:An(`${t}.500`,`${t}.200`)(r),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:An(`${t}.700`,`${t}.500`)(r)}}},gSe={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},_Se={ghost:oQ,outline:hSe,solid:fSe,link:mSe,unstyled:gSe},ESe={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},ySe={baseStyle:dSe,variants:_Se,sizes:ESe,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:sE,defineMultiStyleConfig:vSe}=Ai(Qye.keys),ZO=Pn("card-bg"),pf=Pn("card-padding"),aQ=Pn("card-shadow"),gO=Pn("card-radius"),cQ=Pn("card-border-width","0"),lQ=Pn("card-border-color"),SSe=sE({container:{[ZO.variable]:"colors.chakra-body-bg",backgroundColor:ZO.reference,boxShadow:aQ.reference,borderRadius:gO.reference,color:"chakra-body-text",borderWidth:cQ.reference,borderColor:lQ.reference},body:{padding:pf.reference,flex:"1 1 0%"},header:{padding:pf.reference},footer:{padding:pf.reference}}),TSe={sm:sE({container:{[gO.variable]:"radii.base",[pf.variable]:"space.3"}}),md:sE({container:{[gO.variable]:"radii.md",[pf.variable]:"space.5"}}),lg:sE({container:{[gO.variable]:"radii.xl",[pf.variable]:"space.7"}})},bSe={elevated:sE({container:{[aQ.variable]:"shadows.base",_dark:{[ZO.variable]:"colors.gray.700"}}}),outline:sE({container:{[cQ.variable]:"1px",[lQ.variable]:"colors.chakra-border-color"}}),filled:sE({container:{[ZO.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[pf.variable]:0},header:{[pf.variable]:0},footer:{[pf.variable]:0}}},wSe=vSe({baseStyle:SSe,variants:bSe,sizes:TSe,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:_O,defineMultiStyleConfig:RSe}=Ai(Nye.keys),Pw=Pn("checkbox-size"),CSe=r=>{const{colorScheme:t}=r;return{w:Pw.reference,h:Pw.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:An(`${t}.500`,`${t}.200`)(r),borderColor:An(`${t}.500`,`${t}.200`)(r),color:An("white","gray.900")(r),_hover:{bg:An(`${t}.600`,`${t}.300`)(r),borderColor:An(`${t}.600`,`${t}.300`)(r)},_disabled:{borderColor:An("gray.200","transparent")(r),bg:An("gray.200","whiteAlpha.300")(r),color:An("gray.500","whiteAlpha.500")(r)}},_indeterminate:{bg:An(`${t}.500`,`${t}.200`)(r),borderColor:An(`${t}.500`,`${t}.200`)(r),color:An("white","gray.900")(r)},_disabled:{bg:An("gray.100","whiteAlpha.100")(r),borderColor:An("gray.100","transparent")(r)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:An("red.500","red.300")(r)}}},ISe={_disabled:{cursor:"not-allowed"}},ASe={userSelect:"none",_disabled:{opacity:.4}},PSe={transitionProperty:"transform",transitionDuration:"normal"},OSe=_O(r=>({icon:PSe,container:ISe,control:Za(CSe,r),label:ASe})),kSe={sm:_O({control:{[Pw.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:_O({control:{[Pw.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:_O({control:{[Pw.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},Gm=RSe({baseStyle:OSe,sizes:kSe,defaultProps:{size:"md",colorScheme:"blue"}}),Ow=io("close-button-size"),zb=io("close-button-bg"),NSe={w:[Ow.reference],h:[Ow.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[zb.variable]:"colors.blackAlpha.100",_dark:{[zb.variable]:"colors.whiteAlpha.100"}},_active:{[zb.variable]:"colors.blackAlpha.200",_dark:{[zb.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:zb.reference},DSe={lg:{[Ow.variable]:"sizes.10",fontSize:"md"},md:{[Ow.variable]:"sizes.8",fontSize:"xs"},sm:{[Ow.variable]:"sizes.6",fontSize:"2xs"}},LSe={baseStyle:NSe,sizes:DSe,defaultProps:{size:"md"}},{variants:xSe,defaultProps:MSe}=Aw,USe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:Ds.bg.reference,color:Ds.color.reference,boxShadow:Ds.shadow.reference},VSe={baseStyle:USe,variants:xSe,defaultProps:MSe},FSe={w:"100%",mx:"auto",maxW:"prose",px:"4"},jSe={baseStyle:FSe},BSe={opacity:.6,borderColor:"inherit"},WSe={borderStyle:"solid"},zSe={borderStyle:"dashed"},GSe={solid:WSe,dashed:zSe},HSe={baseStyle:BSe,variants:GSe,defaultProps:{variant:"solid"}},{definePartsStyle:z2,defineMultiStyleConfig:$Se}=Ai(Dye.keys),vM=Pn("drawer-bg"),SM=Pn("drawer-box-shadow");function Jv(r){return z2(r==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:r}})}const KSe={bg:"blackAlpha.600",zIndex:"modal"},qSe={display:"flex",zIndex:"modal",justifyContent:"center"},YSe=r=>{const{isFullHeight:t}=r;return{...t&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[vM.variable]:"colors.white",[SM.variable]:"shadows.lg",_dark:{[vM.variable]:"colors.gray.700",[SM.variable]:"shadows.dark-lg"},bg:vM.reference,boxShadow:SM.reference}},XSe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},JSe={position:"absolute",top:"2",insetEnd:"3"},QSe={px:"6",py:"2",flex:"1",overflow:"auto"},ZSe={px:"6",py:"4"},e0e=z2(r=>({overlay:KSe,dialogContainer:qSe,dialog:Za(YSe,r),header:XSe,closeButton:JSe,body:QSe,footer:ZSe})),t0e={xs:Jv("xs"),sm:Jv("md"),md:Jv("lg"),lg:Jv("2xl"),xl:Jv("4xl"),full:Jv("full")},n0e=$Se({baseStyle:e0e,sizes:t0e,defaultProps:{size:"xs"}}),{definePartsStyle:r0e,defineMultiStyleConfig:i0e}=Ai(Lye.keys),s0e={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},o0e={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},a0e={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},c0e=r0e({preview:s0e,input:o0e,textarea:a0e}),l0e=i0e({baseStyle:c0e}),{definePartsStyle:u0e,defineMultiStyleConfig:d0e}=Ai(xye.keys),PS=Pn("form-control-color"),h0e={marginStart:"1",[PS.variable]:"colors.red.500",_dark:{[PS.variable]:"colors.red.300"},color:PS.reference},p0e={mt:"2",[PS.variable]:"colors.gray.600",_dark:{[PS.variable]:"colors.whiteAlpha.600"},color:PS.reference,lineHeight:"normal",fontSize:"sm"},f0e=u0e({container:{width:"100%",position:"relative"},requiredIndicator:h0e,helperText:p0e}),m0e=d0e({baseStyle:f0e}),{definePartsStyle:g0e,defineMultiStyleConfig:_0e}=Ai(Mye.keys),OS=Pn("form-error-color"),E0e={[OS.variable]:"colors.red.500",_dark:{[OS.variable]:"colors.red.300"},color:OS.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},y0e={marginEnd:"0.5em",[OS.variable]:"colors.red.500",_dark:{[OS.variable]:"colors.red.300"},color:OS.reference},v0e=g0e({text:E0e,icon:y0e}),S0e=_0e({baseStyle:v0e}),T0e={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},b0e={baseStyle:T0e},w0e={fontFamily:"heading",fontWeight:"bold"},R0e={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},C0e={baseStyle:w0e,sizes:R0e,defaultProps:{size:"xl"}},{definePartsStyle:of,defineMultiStyleConfig:I0e}=Ai(Uye.keys),dS=Pn("input-height"),hS=Pn("input-font-size"),pS=Pn("input-padding"),fS=Pn("input-border-radius"),A0e=of({addon:{height:dS.reference,fontSize:hS.reference,px:pS.reference,borderRadius:fS.reference},field:{width:"100%",height:dS.reference,fontSize:hS.reference,px:pS.reference,borderRadius:fS.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),jm={lg:{[hS.variable]:"fontSizes.lg",[pS.variable]:"space.4",[fS.variable]:"radii.md",[dS.variable]:"sizes.12"},md:{[hS.variable]:"fontSizes.md",[pS.variable]:"space.4",[fS.variable]:"radii.md",[dS.variable]:"sizes.10"},sm:{[hS.variable]:"fontSizes.sm",[pS.variable]:"space.3",[fS.variable]:"radii.sm",[dS.variable]:"sizes.8"},xs:{[hS.variable]:"fontSizes.xs",[pS.variable]:"space.2",[fS.variable]:"radii.sm",[dS.variable]:"sizes.6"}},P0e={lg:of({field:jm.lg,group:jm.lg}),md:of({field:jm.md,group:jm.md}),sm:of({field:jm.sm,group:jm.sm}),xs:of({field:jm.xs,group:jm.xs})};function wV(r){const{focusBorderColor:t,errorBorderColor:s}=r;return{focusBorderColor:t||An("blue.500","blue.300")(r),errorBorderColor:s||An("red.500","red.300")(r)}}const O0e=of(r=>{const{theme:t}=r,{focusBorderColor:s,errorBorderColor:a}=wV(r);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:An("gray.300","whiteAlpha.400")(r)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Qa(t,a),boxShadow:`0 0 0 1px ${Qa(t,a)}`},_focusVisible:{zIndex:1,borderColor:Qa(t,s),boxShadow:`0 0 0 1px ${Qa(t,s)}`}},addon:{border:"1px solid",borderColor:An("inherit","whiteAlpha.50")(r),bg:An("gray.100","whiteAlpha.300")(r)}}}),k0e=of(r=>{const{theme:t}=r,{focusBorderColor:s,errorBorderColor:a}=wV(r);return{field:{border:"2px solid",borderColor:"transparent",bg:An("gray.100","whiteAlpha.50")(r),_hover:{bg:An("gray.200","whiteAlpha.100")(r)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Qa(t,a)},_focusVisible:{bg:"transparent",borderColor:Qa(t,s)}},addon:{border:"2px solid",borderColor:"transparent",bg:An("gray.100","whiteAlpha.50")(r)}}}),N0e=of(r=>{const{theme:t}=r,{focusBorderColor:s,errorBorderColor:a}=wV(r);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Qa(t,a),boxShadow:`0px 1px 0px 0px ${Qa(t,a)}`},_focusVisible:{borderColor:Qa(t,s),boxShadow:`0px 1px 0px 0px ${Qa(t,s)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),D0e=of({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),L0e={outline:O0e,filled:k0e,flushed:N0e,unstyled:D0e},Yr=I0e({baseStyle:A0e,sizes:P0e,variants:L0e,defaultProps:{size:"md",variant:"outline"}}),TM=Pn("kbd-bg"),x0e={[TM.variable]:"colors.gray.100",_dark:{[TM.variable]:"colors.whiteAlpha.100"},bg:TM.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},M0e={baseStyle:x0e},U0e={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},V0e={baseStyle:U0e},{defineMultiStyleConfig:F0e,definePartsStyle:j0e}=Ai(Vye.keys),B0e={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},W0e=j0e({icon:B0e}),z0e=F0e({baseStyle:W0e}),{defineMultiStyleConfig:G0e,definePartsStyle:H0e}=Ai(Fye.keys),Ch=Pn("menu-bg"),bM=Pn("menu-shadow"),$0e={[Ch.variable]:"#fff",[bM.variable]:"shadows.sm",_dark:{[Ch.variable]:"colors.gray.700",[bM.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:Ch.reference,boxShadow:bM.reference},K0e={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[Ch.variable]:"colors.gray.100",_dark:{[Ch.variable]:"colors.whiteAlpha.100"}},_active:{[Ch.variable]:"colors.gray.200",_dark:{[Ch.variable]:"colors.whiteAlpha.200"}},_expanded:{[Ch.variable]:"colors.gray.100",_dark:{[Ch.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:Ch.reference},q0e={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},Y0e={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},X0e={opacity:.6},J0e={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},Q0e={transitionProperty:"common",transitionDuration:"normal"},Z0e=H0e({button:Q0e,list:$0e,item:K0e,groupTitle:q0e,icon:Y0e,command:X0e,divider:J0e}),eTe=G0e({baseStyle:Z0e}),{defineMultiStyleConfig:tTe,definePartsStyle:G2}=Ai(jye.keys),wM=Pn("modal-bg"),RM=Pn("modal-shadow"),nTe={bg:"blackAlpha.600",zIndex:"modal"},rTe=r=>{const{isCentered:t,scrollBehavior:s}=r;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:t?"center":"flex-start",overflow:s==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},iTe=r=>{const{isCentered:t,scrollBehavior:s}=r;return{borderRadius:"md",color:"inherit",my:t?"auto":"16",mx:t?"auto":void 0,zIndex:"modal",maxH:s==="inside"?"calc(100% - 7.5rem)":void 0,[wM.variable]:"colors.white",[RM.variable]:"shadows.lg",_dark:{[wM.variable]:"colors.gray.700",[RM.variable]:"shadows.dark-lg"},bg:wM.reference,boxShadow:RM.reference}},sTe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},oTe={position:"absolute",top:"2",insetEnd:"3"},aTe=r=>{const{scrollBehavior:t}=r;return{px:"6",py:"2",flex:"1",overflow:t==="inside"?"auto":void 0}},cTe={px:"6",py:"4"},lTe=G2(r=>({overlay:nTe,dialogContainer:Za(rTe,r),dialog:Za(iTe,r),header:sTe,closeButton:oTe,body:Za(aTe,r),footer:cTe}));function yd(r){return G2(r==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:r}})}const uTe={xs:yd("xs"),sm:yd("sm"),md:yd("md"),lg:yd("lg"),xl:yd("xl"),"2xl":yd("2xl"),"3xl":yd("3xl"),"4xl":yd("4xl"),"5xl":yd("5xl"),"6xl":yd("6xl"),full:yd("full")},dTe=tTe({baseStyle:lTe,sizes:uTe,defaultProps:{size:"md"}}),uQ={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:hTe,definePartsStyle:dQ}=Ai(Bye.keys),RV=io("number-input-stepper-width"),hQ=io("number-input-input-padding"),pTe=rf(RV).add("0.5rem").toString(),CM=io("number-input-bg"),IM=io("number-input-color"),AM=io("number-input-border-color"),fTe={[RV.variable]:"sizes.6",[hQ.variable]:pTe},mTe=r=>{var t;return((t=Za(Yr.baseStyle,r))==null?void 0:t.field)??{}},gTe={width:RV.reference},_Te={borderStart:"1px solid",borderStartColor:AM.reference,color:IM.reference,bg:CM.reference,[IM.variable]:"colors.chakra-body-text",[AM.variable]:"colors.chakra-border-color",_dark:{[IM.variable]:"colors.whiteAlpha.800",[AM.variable]:"colors.whiteAlpha.300"},_active:{[CM.variable]:"colors.gray.200",_dark:{[CM.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},ETe=dQ(r=>({root:fTe,field:Za(mTe,r)??{},stepperGroup:gTe,stepper:_Te}));function jP(r){var d,f;const t=(d=Yr.sizes)==null?void 0:d[r],s={lg:"md",md:"md",sm:"sm",xs:"sm"},a=((f=t.field)==null?void 0:f.fontSize)??"md",l=uQ.fontSizes[a];return dQ({field:{...t.field,paddingInlineEnd:hQ.reference,verticalAlign:"top"},stepper:{fontSize:rf(l).multiply(.75).toString(),_first:{borderTopEndRadius:s[r]},_last:{borderBottomEndRadius:s[r],mt:"-1px",borderTopWidth:1}}})}const yTe={xs:jP("xs"),sm:jP("sm"),md:jP("md"),lg:jP("lg")},vTe=hTe({baseStyle:ETe,sizes:yTe,variants:Yr.variants,defaultProps:Yr.defaultProps});var uJ;const STe={...(uJ=Yr.baseStyle)==null?void 0:uJ.field,textAlign:"center"},TTe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var dJ;const bTe={outline:r=>{var t,s;return((s=Za((t=Yr.variants)==null?void 0:t.outline,r))==null?void 0:s.field)??{}},flushed:r=>{var t,s;return((s=Za((t=Yr.variants)==null?void 0:t.flushed,r))==null?void 0:s.field)??{}},filled:r=>{var t,s;return((s=Za((t=Yr.variants)==null?void 0:t.filled,r))==null?void 0:s.field)??{}},unstyled:((dJ=Yr.variants)==null?void 0:dJ.unstyled.field)??{}},wTe={baseStyle:STe,sizes:TTe,variants:bTe,defaultProps:Yr.defaultProps},{defineMultiStyleConfig:RTe,definePartsStyle:CTe}=Ai(Wye.keys),BP=io("popper-bg"),ITe=io("popper-arrow-bg"),O$=io("popper-arrow-shadow-color"),ATe={zIndex:"popover"},PTe={[BP.variable]:"colors.white",bg:BP.reference,[ITe.variable]:BP.reference,[O$.variable]:"colors.gray.200",_dark:{[BP.variable]:"colors.gray.700",[O$.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},OTe={px:3,py:2,borderBottomWidth:"1px"},kTe={px:3,py:2},NTe={px:3,py:2,borderTopWidth:"1px"},DTe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},LTe=CTe({popper:ATe,content:PTe,header:OTe,body:kTe,footer:NTe,closeButton:DTe}),xTe=RTe({baseStyle:LTe}),{defineMultiStyleConfig:MTe,definePartsStyle:dw}=Ai(zye.keys),UTe=r=>{const{colorScheme:t,theme:s,isIndeterminate:a,hasStripe:l}=r,d=An(R$(),R$("1rem","rgba(0,0,0,0.1)"))(r),f=An(`${t}.500`,`${t}.200`)(r),E=`linear-gradient(
    to right,
    transparent 0%,
    ${Qa(s,f)} 50%,
    transparent 100%
  )`;return{...!a&&l&&d,...a?{bgImage:E}:{bgColor:f}}},VTe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},FTe=r=>({bg:An("gray.100","whiteAlpha.300")(r)}),jTe=r=>({transitionProperty:"common",transitionDuration:"slow",...UTe(r)}),BTe=dw(r=>({label:VTe,filledTrack:jTe(r),track:FTe(r)})),WTe={xs:dw({track:{h:"1"}}),sm:dw({track:{h:"2"}}),md:dw({track:{h:"3"}}),lg:dw({track:{h:"4"}})},zTe=MTe({sizes:WTe,baseStyle:BTe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:GTe,definePartsStyle:EO}=Ai(Gye.keys),HTe=r=>{var s;const t=(s=Za(Gm.baseStyle,r))==null?void 0:s.control;return{...t,borderRadius:"full",_checked:{...t==null?void 0:t._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},$Te=EO(r=>{var t,s;return{label:(t=Gm.baseStyle)==null?void 0:t.call(Gm,r).label,container:(s=Gm.baseStyle)==null?void 0:s.call(Gm,r).container,control:HTe(r)}}),KTe={md:EO({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:EO({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:EO({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},qTe=GTe({baseStyle:$Te,sizes:KTe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:YTe,definePartsStyle:XTe}=Ai(Hye.keys),WP=Pn("select-bg");var hJ;const JTe={...(hJ=Yr.baseStyle)==null?void 0:hJ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:WP.reference,[WP.variable]:"colors.white",_dark:{[WP.variable]:"colors.gray.700"},"> option, > optgroup":{bg:WP.reference}},QTe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},ZTe=XTe({field:JTe,icon:QTe}),zP={paddingInlineEnd:"8"};var pJ,fJ,mJ,gJ,_J,EJ,yJ,vJ;const ebe={lg:{...(pJ=Yr.sizes)==null?void 0:pJ.lg,field:{...(fJ=Yr.sizes)==null?void 0:fJ.lg.field,...zP}},md:{...(mJ=Yr.sizes)==null?void 0:mJ.md,field:{...(gJ=Yr.sizes)==null?void 0:gJ.md.field,...zP}},sm:{...(_J=Yr.sizes)==null?void 0:_J.sm,field:{...(EJ=Yr.sizes)==null?void 0:EJ.sm.field,...zP}},xs:{...(yJ=Yr.sizes)==null?void 0:yJ.xs,field:{...(vJ=Yr.sizes)==null?void 0:vJ.xs.field,...zP},icon:{insetEnd:"1"}}},tbe=YTe({baseStyle:ZTe,sizes:ebe,variants:Yr.variants,defaultProps:Yr.defaultProps}),PM=Pn("skeleton-start-color"),OM=Pn("skeleton-end-color"),nbe={[PM.variable]:"colors.gray.100",[OM.variable]:"colors.gray.400",_dark:{[PM.variable]:"colors.gray.800",[OM.variable]:"colors.gray.600"},background:PM.reference,borderColor:OM.reference,opacity:.7,borderRadius:"sm"},rbe={baseStyle:nbe},kM=Pn("skip-link-bg"),ibe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[kM.variable]:"colors.white",_dark:{[kM.variable]:"colors.gray.700"},bg:kM.reference}},sbe={baseStyle:ibe},{defineMultiStyleConfig:obe,definePartsStyle:$k}=Ai($ye.keys),mE=Pn("slider-thumb-size"),Xw=Pn("slider-track-size"),Hm=Pn("slider-bg"),abe=r=>{const{orientation:t}=r;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...TV({orientation:t,vertical:{h:"100%",px:nf(mE.reference).divide(2).toString()},horizontal:{w:"100%",py:nf(mE.reference).divide(2).toString()}})}},cbe=r=>({...TV({orientation:r.orientation,horizontal:{h:Xw.reference},vertical:{w:Xw.reference}}),overflow:"hidden",borderRadius:"sm",[Hm.variable]:"colors.gray.200",_dark:{[Hm.variable]:"colors.whiteAlpha.200"},_disabled:{[Hm.variable]:"colors.gray.300",_dark:{[Hm.variable]:"colors.whiteAlpha.300"}},bg:Hm.reference}),lbe=r=>{const{orientation:t}=r;return{...TV({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:mE.reference,h:mE.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},ube=r=>{const{colorScheme:t}=r;return{width:"inherit",height:"inherit",[Hm.variable]:`colors.${t}.500`,_dark:{[Hm.variable]:`colors.${t}.200`},bg:Hm.reference}},dbe=$k(r=>({container:abe(r),track:cbe(r),thumb:lbe(r),filledTrack:ube(r)})),hbe=$k({container:{[mE.variable]:"sizes.4",[Xw.variable]:"sizes.1"}}),pbe=$k({container:{[mE.variable]:"sizes.3.5",[Xw.variable]:"sizes.1"}}),fbe=$k({container:{[mE.variable]:"sizes.2.5",[Xw.variable]:"sizes.0.5"}}),mbe={lg:hbe,md:pbe,sm:fbe},gbe=obe({baseStyle:dbe,sizes:mbe,defaultProps:{size:"md",colorScheme:"blue"}}),Z_=io("spinner-size"),_be={width:[Z_.reference],height:[Z_.reference]},Ebe={xs:{[Z_.variable]:"sizes.3"},sm:{[Z_.variable]:"sizes.4"},md:{[Z_.variable]:"sizes.6"},lg:{[Z_.variable]:"sizes.8"},xl:{[Z_.variable]:"sizes.12"}},ybe={baseStyle:_be,sizes:Ebe,defaultProps:{size:"md"}},{defineMultiStyleConfig:vbe,definePartsStyle:pQ}=Ai(Kye.keys),Sbe={fontWeight:"medium"},Tbe={opacity:.8,marginBottom:"2"},bbe={verticalAlign:"baseline",fontWeight:"semibold"},wbe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},Rbe=pQ({container:{},label:Sbe,helpText:Tbe,number:bbe,icon:wbe}),Cbe={md:pQ({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},Ibe=vbe({baseStyle:Rbe,sizes:Cbe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:Abe,definePartsStyle:hw}=Ai(["stepper","step","title","description","indicator","separator","icon","number"]),sf=Pn("stepper-indicator-size"),mS=Pn("stepper-icon-size"),gS=Pn("stepper-title-font-size"),pw=Pn("stepper-description-font-size"),Gb=Pn("stepper-accent-color"),Pbe=hw(({colorScheme:r})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[Gb.variable]:`colors.${r}.500`,_dark:{[Gb.variable]:`colors.${r}.200`}},title:{fontSize:gS.reference,fontWeight:"medium"},description:{fontSize:pw.reference,color:"chakra-subtle-text"},number:{fontSize:gS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:mS.reference,height:mS.reference},indicator:{flexShrink:0,borderRadius:"full",width:sf.reference,height:sf.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:Gb.reference},"&[data-status=complete]":{bg:Gb.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:Gb.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${sf.reference} - 8px)`,top:`calc(${sf.reference} + 4px)`,insetStart:`calc(${sf.reference} / 2 - 1px)`}}})),Obe=Abe({baseStyle:Pbe,sizes:{xs:hw({stepper:{[sf.variable]:"sizes.4",[mS.variable]:"sizes.3",[gS.variable]:"fontSizes.xs",[pw.variable]:"fontSizes.xs"}}),sm:hw({stepper:{[sf.variable]:"sizes.6",[mS.variable]:"sizes.4",[gS.variable]:"fontSizes.sm",[pw.variable]:"fontSizes.xs"}}),md:hw({stepper:{[sf.variable]:"sizes.8",[mS.variable]:"sizes.5",[gS.variable]:"fontSizes.md",[pw.variable]:"fontSizes.sm"}}),lg:hw({stepper:{[sf.variable]:"sizes.10",[mS.variable]:"sizes.6",[gS.variable]:"fontSizes.lg",[pw.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:kbe,definePartsStyle:yO}=Ai(qye.keys),kw=io("switch-track-width"),oE=io("switch-track-height"),NM=io("switch-track-diff"),Nbe=rf.subtract(kw,oE),H2=io("switch-thumb-x"),Hb=io("switch-bg"),Dbe=r=>{const{colorScheme:t}=r;return{borderRadius:"full",p:"0.5",width:[kw.reference],height:[oE.reference],transitionProperty:"common",transitionDuration:"fast",[Hb.variable]:"colors.gray.300",_dark:{[Hb.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[Hb.variable]:`colors.${t}.500`,_dark:{[Hb.variable]:`colors.${t}.200`}},bg:Hb.reference}},Lbe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[oE.reference],height:[oE.reference],_checked:{transform:`translateX(${H2.reference})`}},xbe=yO(r=>({container:{[NM.variable]:Nbe,[H2.variable]:NM.reference,_rtl:{[H2.variable]:rf(NM).negate().toString()}},track:Dbe(r),thumb:Lbe})),Mbe={sm:yO({container:{[kw.variable]:"1.375rem",[oE.variable]:"sizes.3"}}),md:yO({container:{[kw.variable]:"1.875rem",[oE.variable]:"sizes.4"}}),lg:yO({container:{[kw.variable]:"2.875rem",[oE.variable]:"sizes.6"}})},Ube=kbe({baseStyle:xbe,sizes:Mbe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:Vbe,definePartsStyle:kS}=Ai(Yye.keys),Fbe=kS({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),ek={"&[data-is-numeric=true]":{textAlign:"end"}},jbe=kS(r=>{const{colorScheme:t}=r;return{th:{color:An("gray.600","gray.400")(r),borderBottom:"1px",borderColor:An(`${t}.100`,`${t}.700`)(r),...ek},td:{borderBottom:"1px",borderColor:An(`${t}.100`,`${t}.700`)(r),...ek},caption:{color:An("gray.600","gray.100")(r)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),Bbe=kS(r=>{const{colorScheme:t}=r;return{th:{color:An("gray.600","gray.400")(r),borderBottom:"1px",borderColor:An(`${t}.100`,`${t}.700`)(r),...ek},td:{borderBottom:"1px",borderColor:An(`${t}.100`,`${t}.700`)(r),...ek},caption:{color:An("gray.600","gray.100")(r)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:An(`${t}.100`,`${t}.700`)(r)},td:{background:An(`${t}.100`,`${t}.700`)(r)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),Wbe={simple:jbe,striped:Bbe,unstyled:{}},zbe={sm:kS({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:kS({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:kS({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},Gbe=Vbe({baseStyle:Fbe,variants:Wbe,sizes:zbe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),Wc=Pn("tabs-color"),Td=Pn("tabs-bg"),GP=Pn("tabs-border-color"),{defineMultiStyleConfig:Hbe,definePartsStyle:Vh}=Ai(Xye.keys),$be=r=>{const{orientation:t}=r;return{display:t==="vertical"?"flex":"block"}},Kbe=r=>{const{isFitted:t}=r;return{flex:t?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},qbe=r=>{const{align:t="start",orientation:s}=r;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[t],flexDirection:s==="vertical"?"column":"row"}},Ybe={p:4},Xbe=Vh(r=>({root:$be(r),tab:Kbe(r),tablist:qbe(r),tabpanel:Ybe})),Jbe={sm:Vh({tab:{py:1,px:4,fontSize:"sm"}}),md:Vh({tab:{fontSize:"md",py:2,px:4}}),lg:Vh({tab:{fontSize:"lg",py:3,px:4}})},Qbe=Vh(r=>{const{colorScheme:t,orientation:s}=r,a=s==="vertical",l=a?"borderStart":"borderBottom",d=a?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[d]:"-2px",_selected:{[Wc.variable]:`colors.${t}.600`,_dark:{[Wc.variable]:`colors.${t}.300`},borderColor:"currentColor"},_active:{[Td.variable]:"colors.gray.200",_dark:{[Td.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:Wc.reference,bg:Td.reference}}}),Zbe=Vh(r=>{const{colorScheme:t}=r;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[GP.variable]:"transparent",_selected:{[Wc.variable]:`colors.${t}.600`,[GP.variable]:"colors.white",_dark:{[Wc.variable]:`colors.${t}.300`,[GP.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:GP.reference},color:Wc.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),ewe=Vh(r=>{const{colorScheme:t}=r;return{tab:{border:"1px solid",borderColor:"inherit",[Td.variable]:"colors.gray.50",_dark:{[Td.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[Td.variable]:"colors.white",[Wc.variable]:`colors.${t}.600`,_dark:{[Td.variable]:"colors.gray.800",[Wc.variable]:`colors.${t}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:Wc.reference,bg:Td.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),twe=Vh(r=>{const{colorScheme:t,theme:s}=r;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:Qa(s,`${t}.700`),bg:Qa(s,`${t}.100`)}}}}),nwe=Vh(r=>{const{colorScheme:t}=r;return{tab:{borderRadius:"full",fontWeight:"semibold",[Wc.variable]:"colors.gray.600",_dark:{[Wc.variable]:"inherit"},_selected:{[Wc.variable]:"colors.white",[Td.variable]:`colors.${t}.600`,_dark:{[Wc.variable]:"colors.gray.800",[Td.variable]:`colors.${t}.300`}},color:Wc.reference,bg:Td.reference}}}),rwe=Vh({}),iwe={line:Qbe,enclosed:Zbe,"enclosed-colored":ewe,"soft-rounded":twe,"solid-rounded":nwe,unstyled:rwe},swe=Hbe({baseStyle:Xbe,sizes:Jbe,variants:iwe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:owe,definePartsStyle:aE}=Ai(Jye.keys),k$=Pn("tag-bg"),N$=Pn("tag-color"),DM=Pn("tag-shadow"),vO=Pn("tag-min-height"),SO=Pn("tag-min-width"),TO=Pn("tag-font-size"),bO=Pn("tag-padding-inline"),awe={fontWeight:"medium",lineHeight:1.2,outline:0,[N$.variable]:Ds.color.reference,[k$.variable]:Ds.bg.reference,[DM.variable]:Ds.shadow.reference,color:N$.reference,bg:k$.reference,boxShadow:DM.reference,borderRadius:"md",minH:vO.reference,minW:SO.reference,fontSize:TO.reference,px:bO.reference,_focusVisible:{[DM.variable]:"shadows.outline"}},cwe={lineHeight:1.2,overflow:"visible"},lwe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},uwe=aE({container:awe,label:cwe,closeButton:lwe}),dwe={sm:aE({container:{[vO.variable]:"sizes.5",[SO.variable]:"sizes.5",[TO.variable]:"fontSizes.xs",[bO.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:aE({container:{[vO.variable]:"sizes.6",[SO.variable]:"sizes.6",[TO.variable]:"fontSizes.sm",[bO.variable]:"space.2"}}),lg:aE({container:{[vO.variable]:"sizes.8",[SO.variable]:"sizes.8",[TO.variable]:"fontSizes.md",[bO.variable]:"space.3"}})},hwe={subtle:aE(r=>{var t;return{container:(t=Aw.variants)==null?void 0:t.subtle(r)}}),solid:aE(r=>{var t;return{container:(t=Aw.variants)==null?void 0:t.solid(r)}}),outline:aE(r=>{var t;return{container:(t=Aw.variants)==null?void 0:t.outline(r)}})},pwe=owe({variants:hwe,baseStyle:uwe,sizes:dwe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var SJ;const fwe={...(SJ=Yr.baseStyle)==null?void 0:SJ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var TJ;const mwe={outline:r=>{var t;return((t=Yr.variants)==null?void 0:t.outline(r).field)??{}},flushed:r=>{var t;return((t=Yr.variants)==null?void 0:t.flushed(r).field)??{}},filled:r=>{var t;return((t=Yr.variants)==null?void 0:t.filled(r).field)??{}},unstyled:((TJ=Yr.variants)==null?void 0:TJ.unstyled.field)??{}};var bJ,wJ,RJ,CJ;const gwe={xs:((bJ=Yr.sizes)==null?void 0:bJ.xs.field)??{},sm:((wJ=Yr.sizes)==null?void 0:wJ.sm.field)??{},md:((RJ=Yr.sizes)==null?void 0:RJ.md.field)??{},lg:((CJ=Yr.sizes)==null?void 0:CJ.lg.field)??{}},_we={baseStyle:fwe,sizes:gwe,variants:mwe,defaultProps:{size:"md",variant:"outline"}},HP=io("tooltip-bg"),LM=io("tooltip-fg"),Ewe=io("popper-arrow-bg"),ywe={bg:HP.reference,color:LM.reference,[HP.variable]:"colors.gray.700",[LM.variable]:"colors.whiteAlpha.900",_dark:{[HP.variable]:"colors.gray.300",[LM.variable]:"colors.gray.900"},[Ewe.variable]:HP.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},vwe={baseStyle:ywe},Swe={Accordion:ove,Alert:zve,Avatar:eSe,Badge:Aw,Breadcrumb:uSe,Button:ySe,Checkbox:Gm,CloseButton:LSe,Code:VSe,Container:jSe,Divider:HSe,Drawer:n0e,Editable:l0e,Form:m0e,FormError:S0e,FormLabel:b0e,Heading:C0e,Input:Yr,Kbd:M0e,Link:V0e,List:z0e,Menu:eTe,Modal:dTe,NumberInput:vTe,PinInput:wTe,Popover:xTe,Progress:zTe,Radio:qTe,Select:tbe,Skeleton:rbe,SkipLink:sbe,Slider:gbe,Spinner:ybe,Stat:Ibe,Switch:Ube,Table:Gbe,Tabs:swe,Tag:pwe,Textarea:_we,Tooltip:vwe,Card:wSe,Stepper:Obe},Twe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},bwe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},wwe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},Rwe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},Cwe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},Iwe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},Awe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},Pwe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},Owe={property:Iwe,easing:Awe,duration:Pwe},kwe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},Nwe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},Dwe={breakpoints:bwe,zIndices:kwe,radii:Rwe,blur:Nwe,colors:wwe,...uQ,sizes:iQ,shadows:Cwe,space:rQ,borders:Twe,transition:Owe},Lwe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},xwe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},Mwe="ltr",Uwe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},Vwe={semanticTokens:Lwe,direction:Mwe,...Dwe,components:Swe,styles:xwe,config:Uwe};function Fwe(r){if(r.sheet)return r.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===r)return document.styleSheets[t]}function jwe(r){var t=document.createElement("style");return t.setAttribute("data-emotion",r.key),r.nonce!==void 0&&t.setAttribute("nonce",r.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var Bwe=function(){function r(s){var a=this;this._insertTag=function(l){var d;a.tags.length===0?a.insertionPoint?d=a.insertionPoint.nextSibling:a.prepend?d=a.container.firstChild:d=a.before:d=a.tags[a.tags.length-1].nextSibling,a.container.insertBefore(l,d),a.tags.push(l)},this.isSpeedy=s.speedy===void 0?!0:s.speedy,this.tags=[],this.ctr=0,this.nonce=s.nonce,this.key=s.key,this.container=s.container,this.prepend=s.prepend,this.insertionPoint=s.insertionPoint,this.before=null}var t=r.prototype;return t.hydrate=function(a){a.forEach(this._insertTag)},t.insert=function(a){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(jwe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var d=Fwe(l);try{d.insertRule(a,d.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(a));this.ctr++},t.flush=function(){this.tags.forEach(function(a){var l;return(l=a.parentNode)==null?void 0:l.removeChild(a)}),this.tags=[],this.ctr=0},r}(),Ca="-ms-",tk="-moz-",Kr="-webkit-",fQ="comm",CV="rule",IV="decl",Wwe="@import",mQ="@keyframes",zwe="@layer",Gwe=Math.abs,Kk=String.fromCharCode,Hwe=Object.assign;function $we(r,t){return Jo(r,0)^45?(((t<<2^Jo(r,0))<<2^Jo(r,1))<<2^Jo(r,2))<<2^Jo(r,3):0}function gQ(r){return r.trim()}function Kwe(r,t){return(r=t.exec(r))?r[0]:r}function qr(r,t,s){return r.replace(t,s)}function $2(r,t){return r.indexOf(t)}function Jo(r,t){return r.charCodeAt(t)|0}function Jw(r,t,s){return r.slice(t,s)}function Ph(r){return r.length}function AV(r){return r.length}function $P(r,t){return t.push(r),r}function qwe(r,t){return r.map(t).join("")}var qk=1,zS=1,_Q=0,Yc=0,Ws=0,h0="";function Yk(r,t,s,a,l,d,f){return{value:r,root:t,parent:s,type:a,props:l,children:d,line:qk,column:zS,length:f,return:""}}function $b(r,t){return Hwe(Yk("",null,null,"",null,null,0),r,{length:-r.length},t)}function Ywe(){return Ws}function Xwe(){return Ws=Yc>0?Jo(h0,--Yc):0,zS--,Ws===10&&(zS=1,qk--),Ws}function Il(){return Ws=Yc<_Q?Jo(h0,Yc++):0,zS++,Ws===10&&(zS=1,qk++),Ws}function Fh(){return Jo(h0,Yc)}function wO(){return Yc}function wR(r,t){return Jw(h0,r,t)}function Qw(r){switch(r){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function EQ(r){return qk=zS=1,_Q=Ph(h0=r),Yc=0,[]}function yQ(r){return h0="",r}function RO(r){return gQ(wR(Yc-1,K2(r===91?r+2:r===40?r+1:r)))}function Jwe(r){for(;(Ws=Fh())&&Ws<33;)Il();return Qw(r)>2||Qw(Ws)>3?"":" "}function Qwe(r,t){for(;--t&&Il()&&!(Ws<48||Ws>102||Ws>57&&Ws<65||Ws>70&&Ws<97););return wR(r,wO()+(t<6&&Fh()==32&&Il()==32))}function K2(r){for(;Il();)switch(Ws){case r:return Yc;case 34:case 39:r!==34&&r!==39&&K2(Ws);break;case 40:r===41&&K2(r);break;case 92:Il();break}return Yc}function Zwe(r,t){for(;Il()&&r+Ws!==57;)if(r+Ws===84&&Fh()===47)break;return"/*"+wR(t,Yc-1)+"*"+Kk(r===47?r:Il())}function eRe(r){for(;!Qw(Fh());)Il();return wR(r,Yc)}function tRe(r){return yQ(CO("",null,null,null,[""],r=EQ(r),0,[0],r))}function CO(r,t,s,a,l,d,f,E,v){for(var T=0,R=0,I=f,N=0,F=0,j=0,G=1,H=1,te=1,K=0,ee="",de=l,se=d,ge=a,Z=ee;H;)switch(j=K,K=Il()){case 40:if(j!=108&&Jo(Z,I-1)==58){$2(Z+=qr(RO(K),"&","&\f"),"&\f")!=-1&&(te=-1);break}case 34:case 39:case 91:Z+=RO(K);break;case 9:case 10:case 13:case 32:Z+=Jwe(j);break;case 92:Z+=Qwe(wO()-1,7);continue;case 47:switch(Fh()){case 42:case 47:$P(nRe(Zwe(Il(),wO()),t,s),v);break;default:Z+="/"}break;case 123*G:E[T++]=Ph(Z)*te;case 125*G:case 59:case 0:switch(K){case 0:case 125:H=0;case 59+R:te==-1&&(Z=qr(Z,/\f/g,"")),F>0&&Ph(Z)-I&&$P(F>32?L$(Z+";",a,s,I-1):L$(qr(Z," ","")+";",a,s,I-2),v);break;case 59:Z+=";";default:if($P(ge=D$(Z,t,s,T,R,l,E,ee,de=[],se=[],I),d),K===123)if(R===0)CO(Z,t,ge,ge,de,d,I,E,se);else switch(N===99&&Jo(Z,3)===110?100:N){case 100:case 108:case 109:case 115:CO(r,ge,ge,a&&$P(D$(r,ge,ge,0,0,l,E,ee,l,de=[],I),se),l,se,I,E,a?de:se);break;default:CO(Z,ge,ge,ge,[""],se,0,E,se)}}T=R=F=0,G=te=1,ee=Z="",I=f;break;case 58:I=1+Ph(Z),F=j;default:if(G<1){if(K==123)--G;else if(K==125&&G++==0&&Xwe()==125)continue}switch(Z+=Kk(K),K*G){case 38:te=R>0?1:(Z+="\f",-1);break;case 44:E[T++]=(Ph(Z)-1)*te,te=1;break;case 64:Fh()===45&&(Z+=RO(Il())),N=Fh(),R=I=Ph(ee=Z+=eRe(wO())),K++;break;case 45:j===45&&Ph(Z)==2&&(G=0)}}return d}function D$(r,t,s,a,l,d,f,E,v,T,R){for(var I=l-1,N=l===0?d:[""],F=AV(N),j=0,G=0,H=0;j<a;++j)for(var te=0,K=Jw(r,I+1,I=Gwe(G=f[j])),ee=r;te<F;++te)(ee=gQ(G>0?N[te]+" "+K:qr(K,/&\f/g,N[te])))&&(v[H++]=ee);return Yk(r,t,s,l===0?CV:E,v,T,R)}function nRe(r,t,s){return Yk(r,t,s,fQ,Kk(Ywe()),Jw(r,2,-2),0)}function L$(r,t,s,a){return Yk(r,t,s,IV,Jw(r,0,a),Jw(r,a+1,-1),a)}function NS(r,t){for(var s="",a=AV(r),l=0;l<a;l++)s+=t(r[l],l,r,t)||"";return s}function rRe(r,t,s,a){switch(r.type){case zwe:if(r.children.length)break;case Wwe:case IV:return r.return=r.return||r.value;case fQ:return"";case mQ:return r.return=r.value+"{"+NS(r.children,a)+"}";case CV:r.value=r.props.join(",")}return Ph(s=NS(r.children,a))?r.return=r.value+"{"+s+"}":""}function iRe(r){var t=AV(r);return function(s,a,l,d){for(var f="",E=0;E<t;E++)f+=r[E](s,a,l,d)||"";return f}}function sRe(r){return function(t){t.root||(t=t.return)&&r(t)}}var x$=function(t){var s=new WeakMap;return function(a){if(s.has(a))return s.get(a);var l=t(a);return s.set(a,l),l}};function vQ(r){var t=Object.create(null);return function(s){return t[s]===void 0&&(t[s]=r(s)),t[s]}}var oRe=function(t,s,a){for(var l=0,d=0;l=d,d=Fh(),l===38&&d===12&&(s[a]=1),!Qw(d);)Il();return wR(t,Yc)},aRe=function(t,s){var a=-1,l=44;do switch(Qw(l)){case 0:l===38&&Fh()===12&&(s[a]=1),t[a]+=oRe(Yc-1,s,a);break;case 2:t[a]+=RO(l);break;case 4:if(l===44){t[++a]=Fh()===58?"&\f":"",s[a]=t[a].length;break}default:t[a]+=Kk(l)}while(l=Il());return t},cRe=function(t,s){return yQ(aRe(EQ(t),s))},M$=new WeakMap,lRe=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var s=t.value,a=t.parent,l=t.column===a.column&&t.line===a.line;a.type!=="rule";)if(a=a.parent,!a)return;if(!(t.props.length===1&&s.charCodeAt(0)!==58&&!M$.get(a))&&!l){M$.set(t,!0);for(var d=[],f=cRe(s,d),E=a.props,v=0,T=0;v<f.length;v++)for(var R=0;R<E.length;R++,T++)t.props[T]=d[v]?f[v].replace(/&\f/g,E[R]):E[R]+" "+f[v]}}},uRe=function(t){if(t.type==="decl"){var s=t.value;s.charCodeAt(0)===108&&s.charCodeAt(2)===98&&(t.return="",t.value="")}};function SQ(r,t){switch($we(r,t)){case 5103:return Kr+"print-"+r+r;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Kr+r+r;case 5349:case 4246:case 4810:case 6968:case 2756:return Kr+r+tk+r+Ca+r+r;case 6828:case 4268:return Kr+r+Ca+r+r;case 6165:return Kr+r+Ca+"flex-"+r+r;case 5187:return Kr+r+qr(r,/(\w+).+(:[^]+)/,Kr+"box-$1$2"+Ca+"flex-$1$2")+r;case 5443:return Kr+r+Ca+"flex-item-"+qr(r,/flex-|-self/,"")+r;case 4675:return Kr+r+Ca+"flex-line-pack"+qr(r,/align-content|flex-|-self/,"")+r;case 5548:return Kr+r+Ca+qr(r,"shrink","negative")+r;case 5292:return Kr+r+Ca+qr(r,"basis","preferred-size")+r;case 6060:return Kr+"box-"+qr(r,"-grow","")+Kr+r+Ca+qr(r,"grow","positive")+r;case 4554:return Kr+qr(r,/([^-])(transform)/g,"$1"+Kr+"$2")+r;case 6187:return qr(qr(qr(r,/(zoom-|grab)/,Kr+"$1"),/(image-set)/,Kr+"$1"),r,"")+r;case 5495:case 3959:return qr(r,/(image-set\([^]*)/,Kr+"$1$`$1");case 4968:return qr(qr(r,/(.+:)(flex-)?(.*)/,Kr+"box-pack:$3"+Ca+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Kr+r+r;case 4095:case 3583:case 4068:case 2532:return qr(r,/(.+)-inline(.+)/,Kr+"$1$2")+r;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Ph(r)-1-t>6)switch(Jo(r,t+1)){case 109:if(Jo(r,t+4)!==45)break;case 102:return qr(r,/(.+:)(.+)-([^]+)/,"$1"+Kr+"$2-$3$1"+tk+(Jo(r,t+3)==108?"$3":"$2-$3"))+r;case 115:return~$2(r,"stretch")?SQ(qr(r,"stretch","fill-available"),t)+r:r}break;case 4949:if(Jo(r,t+1)!==115)break;case 6444:switch(Jo(r,Ph(r)-3-(~$2(r,"!important")&&10))){case 107:return qr(r,":",":"+Kr)+r;case 101:return qr(r,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Kr+(Jo(r,14)===45?"inline-":"")+"box$3$1"+Kr+"$2$3$1"+Ca+"$2box$3")+r}break;case 5936:switch(Jo(r,t+11)){case 114:return Kr+r+Ca+qr(r,/[svh]\w+-[tblr]{2}/,"tb")+r;case 108:return Kr+r+Ca+qr(r,/[svh]\w+-[tblr]{2}/,"tb-rl")+r;case 45:return Kr+r+Ca+qr(r,/[svh]\w+-[tblr]{2}/,"lr")+r}return Kr+r+Ca+r+r}return r}var dRe=function(t,s,a,l){if(t.length>-1&&!t.return)switch(t.type){case IV:t.return=SQ(t.value,t.length);break;case mQ:return NS([$b(t,{value:qr(t.value,"@","@"+Kr)})],l);case CV:if(t.length)return qwe(t.props,function(d){switch(Kwe(d,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return NS([$b(t,{props:[qr(d,/:(read-\w+)/,":"+tk+"$1")]})],l);case"::placeholder":return NS([$b(t,{props:[qr(d,/:(plac\w+)/,":"+Kr+"input-$1")]}),$b(t,{props:[qr(d,/:(plac\w+)/,":"+tk+"$1")]}),$b(t,{props:[qr(d,/:(plac\w+)/,Ca+"input-$1")]})],l)}return""})}},hRe=[dRe],pRe=function(t){var s=t.key;if(s==="css"){var a=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(a,function(G){var H=G.getAttribute("data-emotion");H.indexOf(" ")!==-1&&(document.head.appendChild(G),G.setAttribute("data-s",""))})}var l=t.stylisPlugins||hRe,d={},f,E=[];f=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+s+' "]'),function(G){for(var H=G.getAttribute("data-emotion").split(" "),te=1;te<H.length;te++)d[H[te]]=!0;E.push(G)});var v,T=[lRe,uRe];{var R,I=[rRe,sRe(function(G){R.insert(G)})],N=iRe(T.concat(l,I)),F=function(H){return NS(tRe(H),N)};v=function(H,te,K,ee){R=K,F(H?H+"{"+te.styles+"}":te.styles),ee&&(j.inserted[te.name]=!0)}}var j={key:s,sheet:new Bwe({key:s,container:f,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:d,registered:{},insert:v};return j.sheet.hydrate(E),j};function gE(){return gE=Object.assign?Object.assign.bind():function(r){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)({}).hasOwnProperty.call(s,a)&&(r[a]=s[a])}return r},gE.apply(null,arguments)}var xM={exports:{}},ti={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var U$;function fRe(){if(U$)return ti;U$=1;var r=typeof Symbol=="function"&&Symbol.for,t=r?Symbol.for("react.element"):60103,s=r?Symbol.for("react.portal"):60106,a=r?Symbol.for("react.fragment"):60107,l=r?Symbol.for("react.strict_mode"):60108,d=r?Symbol.for("react.profiler"):60114,f=r?Symbol.for("react.provider"):60109,E=r?Symbol.for("react.context"):60110,v=r?Symbol.for("react.async_mode"):60111,T=r?Symbol.for("react.concurrent_mode"):60111,R=r?Symbol.for("react.forward_ref"):60112,I=r?Symbol.for("react.suspense"):60113,N=r?Symbol.for("react.suspense_list"):60120,F=r?Symbol.for("react.memo"):60115,j=r?Symbol.for("react.lazy"):60116,G=r?Symbol.for("react.block"):60121,H=r?Symbol.for("react.fundamental"):60117,te=r?Symbol.for("react.responder"):60118,K=r?Symbol.for("react.scope"):60119;function ee(se){if(typeof se=="object"&&se!==null){var ge=se.$$typeof;switch(ge){case t:switch(se=se.type,se){case v:case T:case a:case d:case l:case I:return se;default:switch(se=se&&se.$$typeof,se){case E:case R:case j:case F:case f:return se;default:return ge}}case s:return ge}}}function de(se){return ee(se)===T}return ti.AsyncMode=v,ti.ConcurrentMode=T,ti.ContextConsumer=E,ti.ContextProvider=f,ti.Element=t,ti.ForwardRef=R,ti.Fragment=a,ti.Lazy=j,ti.Memo=F,ti.Portal=s,ti.Profiler=d,ti.StrictMode=l,ti.Suspense=I,ti.isAsyncMode=function(se){return de(se)||ee(se)===v},ti.isConcurrentMode=de,ti.isContextConsumer=function(se){return ee(se)===E},ti.isContextProvider=function(se){return ee(se)===f},ti.isElement=function(se){return typeof se=="object"&&se!==null&&se.$$typeof===t},ti.isForwardRef=function(se){return ee(se)===R},ti.isFragment=function(se){return ee(se)===a},ti.isLazy=function(se){return ee(se)===j},ti.isMemo=function(se){return ee(se)===F},ti.isPortal=function(se){return ee(se)===s},ti.isProfiler=function(se){return ee(se)===d},ti.isStrictMode=function(se){return ee(se)===l},ti.isSuspense=function(se){return ee(se)===I},ti.isValidElementType=function(se){return typeof se=="string"||typeof se=="function"||se===a||se===T||se===d||se===l||se===I||se===N||typeof se=="object"&&se!==null&&(se.$$typeof===j||se.$$typeof===F||se.$$typeof===f||se.$$typeof===E||se.$$typeof===R||se.$$typeof===H||se.$$typeof===te||se.$$typeof===K||se.$$typeof===G)},ti.typeOf=ee,ti}var V$;function mRe(){return V$||(V$=1,xM.exports=fRe()),xM.exports}var MM,F$;function gRe(){if(F$)return MM;F$=1;var r=mRe(),t={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},s={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},d={};d[r.ForwardRef]=a,d[r.Memo]=l;function f(j){return r.isMemo(j)?l:d[j.$$typeof]||t}var E=Object.defineProperty,v=Object.getOwnPropertyNames,T=Object.getOwnPropertySymbols,R=Object.getOwnPropertyDescriptor,I=Object.getPrototypeOf,N=Object.prototype;function F(j,G,H){if(typeof G!="string"){if(N){var te=I(G);te&&te!==N&&F(j,te,H)}var K=v(G);T&&(K=K.concat(T(G)));for(var ee=f(j),de=f(G),se=0;se<K.length;++se){var ge=K[se];if(!s[ge]&&!(H&&H[ge])&&!(de&&de[ge])&&!(ee&&ee[ge])){var Z=R(G,ge);try{E(j,ge,Z)}catch{}}}}return j}return MM=F,MM}gRe();var _Re=!0;function TQ(r,t,s){var a="";return s.split(" ").forEach(function(l){r[l]!==void 0?t.push(r[l]+";"):l&&(a+=l+" ")}),a}var PV=function(t,s,a){var l=t.key+"-"+s.name;(a===!1||_Re===!1)&&t.registered[l]===void 0&&(t.registered[l]=s.styles)},OV=function(t,s,a){PV(t,s,a);var l=t.key+"-"+s.name;if(t.inserted[s.name]===void 0){var d=s;do t.insert(s===d?"."+l:"",d,t.sheet,!0),d=d.next;while(d!==void 0)}};function ERe(r){for(var t=0,s,a=0,l=r.length;l>=4;++a,l-=4)s=r.charCodeAt(a)&255|(r.charCodeAt(++a)&255)<<8|(r.charCodeAt(++a)&255)<<16|(r.charCodeAt(++a)&255)<<24,s=(s&65535)*1540483477+((s>>>16)*59797<<16),s^=s>>>24,t=(s&65535)*1540483477+((s>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(l){case 3:t^=(r.charCodeAt(a+2)&255)<<16;case 2:t^=(r.charCodeAt(a+1)&255)<<8;case 1:t^=r.charCodeAt(a)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var yRe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},vRe=/[A-Z]|^ms/g,SRe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,bQ=function(t){return t.charCodeAt(1)===45},j$=function(t){return t!=null&&typeof t!="boolean"},UM=vQ(function(r){return bQ(r)?r:r.replace(vRe,"-$&").toLowerCase()}),B$=function(t,s){switch(t){case"animation":case"animationName":if(typeof s=="string")return s.replace(SRe,function(a,l,d){return Oh={name:l,styles:d,next:Oh},l})}return yRe[t]!==1&&!bQ(t)&&typeof s=="number"&&s!==0?s+"px":s};function Zw(r,t,s){if(s==null)return"";var a=s;if(a.__emotion_styles!==void 0)return a;switch(typeof s){case"boolean":return"";case"object":{var l=s;if(l.anim===1)return Oh={name:l.name,styles:l.styles,next:Oh},l.name;var d=s;if(d.styles!==void 0){var f=d.next;if(f!==void 0)for(;f!==void 0;)Oh={name:f.name,styles:f.styles,next:Oh},f=f.next;var E=d.styles+";";return E}return TRe(r,t,s)}case"function":{if(r!==void 0){var v=Oh,T=s(r);return Oh=v,Zw(r,t,T)}break}}var R=s;if(t==null)return R;var I=t[R];return I!==void 0?I:R}function TRe(r,t,s){var a="";if(Array.isArray(s))for(var l=0;l<s.length;l++)a+=Zw(r,t,s[l])+";";else for(var d in s){var f=s[d];if(typeof f!="object"){var E=f;t!=null&&t[E]!==void 0?a+=d+"{"+t[E]+"}":j$(E)&&(a+=UM(d)+":"+B$(d,E)+";")}else if(Array.isArray(f)&&typeof f[0]=="string"&&(t==null||t[f[0]]===void 0))for(var v=0;v<f.length;v++)j$(f[v])&&(a+=UM(d)+":"+B$(d,f[v])+";");else{var T=Zw(r,t,f);switch(d){case"animation":case"animationName":{a+=UM(d)+":"+T+";";break}default:a+=d+"{"+T+"}"}}}return a}var W$=/label:\s*([^\s;{]+)\s*(;|$)/g,Oh;function Xk(r,t,s){if(r.length===1&&typeof r[0]=="object"&&r[0]!==null&&r[0].styles!==void 0)return r[0];var a=!0,l="";Oh=void 0;var d=r[0];if(d==null||d.raw===void 0)a=!1,l+=Zw(s,t,d);else{var f=d;l+=f[0]}for(var E=1;E<r.length;E++)if(l+=Zw(s,t,r[E]),a){var v=d;l+=v[E]}W$.lastIndex=0;for(var T="",R;(R=W$.exec(l))!==null;)T+="-"+R[1];var I=ERe(l)+T;return{name:I,styles:l,next:Oh}}var bRe=function(t){return t()},wQ=n$.useInsertionEffect?n$.useInsertionEffect:!1,RQ=wQ||bRe,z$=wQ||L.useLayoutEffect,kV=L.createContext(typeof HTMLElement<"u"?pRe({key:"css"}):null);kV.Provider;var wRe=function(){return L.useContext(kV)},NV=function(t){return L.forwardRef(function(s,a){var l=L.useContext(kV);return t(s,l,a)})},GS=L.createContext({}),RRe=function(t,s){if(typeof s=="function"){var a=s(t);return a}return gE({},t,s)},CRe=x$(function(r){return x$(function(t){return RRe(r,t)})}),IRe=function(t){var s=L.useContext(GS);return t.theme!==s&&(s=CRe(s)(t.theme)),L.createElement(GS.Provider,{value:s},t.children)},DV={}.hasOwnProperty,q2="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",ARe=function(t,s){var a={};for(var l in s)DV.call(s,l)&&(a[l]=s[l]);return a[q2]=t,a},PRe=function(t){var s=t.cache,a=t.serialized,l=t.isStringTag;return PV(s,a,l),RQ(function(){return OV(s,a,l)}),null},ORe=NV(function(r,t,s){var a=r.css;typeof a=="string"&&t.registered[a]!==void 0&&(a=t.registered[a]);var l=r[q2],d=[a],f="";typeof r.className=="string"?f=TQ(t.registered,d,r.className):r.className!=null&&(f=r.className+" ");var E=Xk(d,void 0,L.useContext(GS));f+=t.key+"-"+E.name;var v={};for(var T in r)DV.call(r,T)&&T!=="css"&&T!==q2&&(v[T]=r[T]);return v.className=f,s&&(v.ref=s),L.createElement(L.Fragment,null,L.createElement(PRe,{cache:t,serialized:E,isStringTag:typeof l=="string"}),L.createElement(l,v))}),kRe=ORe,G$=function(t,s){var a=arguments;if(s==null||!DV.call(s,"css"))return L.createElement.apply(void 0,a);var l=a.length,d=new Array(l);d[0]=kRe,d[1]=ARe(t,s);for(var f=2;f<l;f++)d[f]=a[f];return L.createElement.apply(null,d)};(function(r){var t;t||(t=r.JSX||(r.JSX={}))})(G$||(G$={}));var Jk=NV(function(r,t){var s=r.styles,a=Xk([s],void 0,L.useContext(GS)),l=L.useRef();return z$(function(){var d=t.key+"-global",f=new t.sheet.constructor({key:d,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),E=!1,v=document.querySelector('style[data-emotion="'+d+" "+a.name+'"]');return t.sheet.tags.length&&(f.before=t.sheet.tags[0]),v!==null&&(E=!0,v.setAttribute("data-emotion",d),f.hydrate([v])),l.current=[f,E],function(){f.flush()}},[t]),z$(function(){var d=l.current,f=d[0],E=d[1];if(E){d[1]=!1;return}if(a.next!==void 0&&OV(t,a.next,!0),f.tags.length){var v=f.tags[f.tags.length-1].nextElementSibling;f.before=v,f.flush()}t.insert("",a,f,!1)},[t,a.name]),null});function NRe(){for(var r=arguments.length,t=new Array(r),s=0;s<r;s++)t[s]=arguments[s];return Xk(t)}function RR(){var r=NRe.apply(void 0,arguments),t="animation-"+r.name;return{name:t,styles:"@keyframes "+t+"{"+r.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const LV=L.createContext({});LV.displayName="ColorModeContext";function Qk(){const r=L.useContext(LV);if(r===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return r}function DRe(r,t){const{colorMode:s}=Qk();return s==="dark"?t:r}const KP={light:"chakra-ui-light",dark:"chakra-ui-dark"};function LRe(r={}){const{preventTransition:t=!0,nonce:s}=r,a={setDataset:l=>{const d=t?a.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,d==null||d()},setClassName(l){document.body.classList.add(l?KP.dark:KP.light),document.body.classList.remove(l?KP.light:KP.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return a.query().matches??l==="dark"?"dark":"light"},addListener(l){const d=a.query(),f=E=>{l(E.matches?"dark":"light")};return typeof d.addListener=="function"?d.addListener(f):d.addEventListener("change",f),()=>{typeof d.removeListener=="function"?d.removeListener(f):d.removeEventListener("change",f)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),s!==void 0&&(l.nonce=s),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return a}const xRe="chakra-ui-color-mode";function MRe(r){return{ssr:!1,type:"localStorage",get(t){if(!(globalThis!=null&&globalThis.document))return t;let s;try{s=localStorage.getItem(r)||t}catch{}return s||t},set(t){try{localStorage.setItem(r,t)}catch{}}}}const URe=MRe(xRe),H$=()=>{},VRe=i_e()?L.useLayoutEffect:L.useEffect;function $$(r,t){return r.type==="cookie"&&r.ssr?r.get(t):t}const CQ=function(t){const{value:s,children:a,options:{useSystemColorMode:l,initialColorMode:d,disableTransitionOnChange:f}={},colorModeManager:E=URe}=t,v=wRe(),T=d==="dark"?"dark":"light",[R,I]=L.useState(()=>$$(E,T)),[N,F]=L.useState(()=>$$(E)),{getSystemTheme:j,setClassName:G,setDataset:H,addListener:te}=L.useMemo(()=>LRe({preventTransition:f,nonce:v==null?void 0:v.nonce}),[f,v==null?void 0:v.nonce]),K=d==="system"&&!R?N:R,ee=L.useCallback(ge=>{const Z=ge==="system"?j():ge;I(Z),G(Z==="dark"),H(Z),E.set(Z)},[E,j,G,H]);VRe(()=>{d==="system"&&F(j())},[]),L.useEffect(()=>{const ge=E.get();if(ge){ee(ge);return}if(d==="system"){ee("system");return}ee(T)},[E,T,d,ee]);const de=L.useCallback(()=>{ee(K==="dark"?"light":"dark")},[K,ee]);L.useEffect(()=>{if(l)return te(ee)},[l,te,ee]);const se=L.useMemo(()=>({colorMode:s??K,toggleColorMode:s?H$:de,setColorMode:s?H$:ee,forced:s!==void 0}),[K,de,ee,s]);return P.jsx(LV.Provider,{value:se,children:a})};CQ.displayName="ColorModeProvider";const IQ=String.raw,AQ=IQ`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,FRe=()=>P.jsx(Jk,{styles:AQ}),jRe=({scope:r=""})=>P.jsx(Jk,{styles:IQ`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${r} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${r} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${r} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${r} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${r} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${r} :where(b, strong) {
        font-weight: bold;
      }

      ${r} small {
        font-size: 80%;
      }

      ${r} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${r} sub {
        bottom: -0.25em;
      }

      ${r} sup {
        top: -0.5em;
      }

      ${r} img {
        border-style: none;
      }

      ${r} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${r} :where(button, input) {
        overflow: visible;
      }

      ${r} :where(button, select) {
        text-transform: none;
      }

      ${r} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${r} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${r} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${r} progress {
        vertical-align: baseline;
      }

      ${r} textarea {
        overflow: auto;
      }

      ${r} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${r} input[type="number"]::-webkit-inner-spin-button,
      ${r} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${r} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${r} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${r} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${r} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${r} details {
        display: block;
      }

      ${r} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${r} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${r} button {
        background: transparent;
        padding: 0;
      }

      ${r} fieldset {
        margin: 0;
        padding: 0;
      }

      ${r} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${r} textarea {
        resize: vertical;
      }

      ${r} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${r} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${r} table {
        border-collapse: collapse;
      }

      ${r} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${r} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${r} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${r} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${r} select::-ms-expand {
        display: none;
      }

      ${AQ}
    `});function BRe(r){const{cssVarsRoot:t,theme:s,children:a}=r,l=L.useMemo(()=>Iye(s),[s]);return P.jsxs(IRe,{theme:l,children:[P.jsx(WRe,{root:t}),a]})}function WRe({root:r=":host, :root"}){const t=[r,"[data-theme]"].join(",");return P.jsx(Jk,{styles:s=>({[t]:s.__cssVars})})}Wi({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function zRe(){const{colorMode:r}=Qk();return P.jsx(Jk,{styles:t=>{const s=MJ(t,"styles.global"),a=Hc(s,{theme:t,colorMode:r});return a?ZJ(a)(t):void 0}})}const[GRe,HRe]=Wi({strict:!1,name:"PortalManagerContext"});function xV(r){const{children:t,zIndex:s}=r;return P.jsx(GRe,{value:{zIndex:s},children:t})}xV.displayName="PortalManager";const MV=L.createContext({getDocument(){return document},getWindow(){return window}});MV.displayName="EnvironmentContext";function $Re({defer:r}={}){const[,t]=L.useReducer(s=>s+1,0);return hf(()=>{r&&t()},[r]),L.useContext(MV)}function PQ(r){const{children:t,environment:s,disabled:a}=r,l=L.useRef(null),d=L.useMemo(()=>s||{getDocument:()=>{var E;return((E=l.current)==null?void 0:E.ownerDocument)??document},getWindow:()=>{var E;return((E=l.current)==null?void 0:E.ownerDocument.defaultView)??window}},[s]),f=!a||!s;return P.jsxs(MV.Provider,{value:d,children:[t,f&&P.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}PQ.displayName="EnvironmentProvider";const KRe=r=>{const{children:t,colorModeManager:s,portalZIndex:a,resetScope:l,resetCSS:d=!0,theme:f={},environment:E,cssVarsRoot:v,disableEnvironment:T,disableGlobalStyle:R}=r,I=P.jsx(PQ,{environment:E,disabled:T,children:t});return P.jsx(BRe,{theme:f,cssVarsRoot:v,children:P.jsxs(CQ,{colorModeManager:s,options:f.config,children:[d?P.jsx(jRe,{scope:l}):P.jsx(FRe,{}),!R&&P.jsx(zRe,{}),a?P.jsx(xV,{zIndex:a,children:I}):I]})})},UV=L.createContext({});function VV(r){const t=L.useRef(null);return t.current===null&&(t.current=r()),t.current}const CR=L.createContext(null),FV=L.createContext({transformPagePoint:r=>r,isStatic:!1,reducedMotion:"never"});class qRe extends L.Component{getSnapshotBeforeUpdate(t){const s=this.props.childRef.current;if(s&&t.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=s.offsetHeight||0,a.width=s.offsetWidth||0,a.top=s.offsetTop,a.left=s.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function YRe({children:r,isPresent:t}){const s=L.useId(),a=L.useRef(null),l=L.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=L.useContext(FV);return L.useInsertionEffect(()=>{const{width:f,height:E,top:v,left:T}=l.current;if(t||!a.current||!f||!E)return;a.current.dataset.motionPopId=s;const R=document.createElement("style");return d&&(R.nonce=d),document.head.appendChild(R),R.sheet&&R.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${E}px !important;
            top: ${v}px !important;
            left: ${T}px !important;
          }
        `),()=>{document.head.removeChild(R)}},[t]),P.jsx(qRe,{isPresent:t,childRef:a,sizeRef:l,children:L.cloneElement(r,{ref:a})})}const XRe=({children:r,initial:t,isPresent:s,onExitComplete:a,custom:l,presenceAffectsLayout:d,mode:f})=>{const E=VV(JRe),v=L.useId(),T=L.useCallback(I=>{E.set(I,!0);for(const N of E.values())if(!N)return;a&&a()},[E,a]),R=L.useMemo(()=>({id:v,initial:t,isPresent:s,custom:l,onExitComplete:T,register:I=>(E.set(I,!1),()=>E.delete(I))}),d?[Math.random(),T]:[s,T]);return L.useMemo(()=>{E.forEach((I,N)=>E.set(N,!1))},[s]),L.useEffect(()=>{!s&&!E.size&&a&&a()},[s]),f==="popLayout"&&(r=P.jsx(YRe,{isPresent:s,children:r})),P.jsx(CR.Provider,{value:R,children:r})};function JRe(){return new Map}function jV(r=!0){const t=L.useContext(CR);if(t===null)return[!0,null];const{isPresent:s,onExitComplete:a,register:l}=t,d=L.useId();L.useEffect(()=>{r&&l(d)},[r]);const f=L.useCallback(()=>r&&a&&a(d),[d,a,r]);return!s&&a?[!1,f]:[!0]}function QRe(){return ZRe(L.useContext(CR))}function ZRe(r){return r===null?!0:r.isPresent}const qP=r=>r.key||"";function K$(r){const t=[];return L.Children.forEach(r,s=>{L.isValidElement(s)&&t.push(s)}),t}const BV=typeof window<"u",OQ=BV?L.useLayoutEffect:L.useEffect,p0=({children:r,custom:t,initial:s=!0,onExitComplete:a,presenceAffectsLayout:l=!0,mode:d="sync",propagate:f=!1})=>{const[E,v]=jV(f),T=L.useMemo(()=>K$(r),[r]),R=f&&!E?[]:T.map(qP),I=L.useRef(!0),N=L.useRef(T),F=VV(()=>new Map),[j,G]=L.useState(T),[H,te]=L.useState(T);OQ(()=>{I.current=!1,N.current=T;for(let de=0;de<H.length;de++){const se=qP(H[de]);R.includes(se)?F.delete(se):F.get(se)!==!0&&F.set(se,!1)}},[H,R.length,R.join("-")]);const K=[];if(T!==j){let de=[...T];for(let se=0;se<H.length;se++){const ge=H[se],Z=qP(ge);R.includes(Z)||(de.splice(se,0,ge),K.push(ge))}d==="wait"&&K.length&&(de=K),te(K$(de)),G(T);return}const{forceRender:ee}=L.useContext(UV);return P.jsx(P.Fragment,{children:H.map(de=>{const se=qP(de),ge=f&&!E?!1:T===H||R.includes(se),Z=()=>{if(F.has(se))F.set(se,!0);else return;let Q=!0;F.forEach(ne=>{ne||(Q=!1)}),Q&&(ee==null||ee(),te(N.current),f&&(v==null||v()),a&&a())};return P.jsx(XRe,{isPresent:ge,initial:!I.current||s?void 0:!1,custom:ge?void 0:t,presenceAffectsLayout:l,mode:d,onExitComplete:ge?void 0:Z,children:de},se)})})},Al=r=>r;let kQ=Al;function WV(r){let t;return()=>(t===void 0&&(t=r()),t)}const HS=(r,t,s)=>{const a=t-r;return a===0?1:(s-r)/a},ff=r=>r*1e3,mf=r=>r/1e3,eCe={useManualTiming:!1};function tCe(r){let t=new Set,s=new Set,a=!1,l=!1;const d=new WeakSet;let f={delta:0,timestamp:0,isProcessing:!1};function E(T){d.has(T)&&(v.schedule(T),r()),T(f)}const v={schedule:(T,R=!1,I=!1)=>{const F=I&&a?t:s;return R&&d.add(T),F.has(T)||F.add(T),T},cancel:T=>{s.delete(T),d.delete(T)},process:T=>{if(f=T,a){l=!0;return}a=!0,[t,s]=[s,t],t.forEach(E),t.clear(),a=!1,l&&(l=!1,v.process(T))}};return v}const YP=["read","resolveKeyframes","update","preRender","render","postRender"],nCe=40;function NQ(r,t){let s=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=()=>s=!0,f=YP.reduce((te,K)=>(te[K]=tCe(d),te),{}),{read:E,resolveKeyframes:v,update:T,preRender:R,render:I,postRender:N}=f,F=()=>{const te=performance.now();s=!1,l.delta=a?1e3/60:Math.max(Math.min(te-l.timestamp,nCe),1),l.timestamp=te,l.isProcessing=!0,E.process(l),v.process(l),T.process(l),R.process(l),I.process(l),N.process(l),l.isProcessing=!1,s&&t&&(a=!1,r(F))},j=()=>{s=!0,a=!0,l.isProcessing||r(F)};return{schedule:YP.reduce((te,K)=>{const ee=f[K];return te[K]=(de,se=!1,ge=!1)=>(s||j(),ee.schedule(de,se,ge)),te},{}),cancel:te=>{for(let K=0;K<YP.length;K++)f[YP[K]].cancel(te)},state:l,steps:f}}const{schedule:Bi,cancel:lg,state:Yo,steps:VM}=NQ(typeof requestAnimationFrame<"u"?requestAnimationFrame:Al,!0),DQ=L.createContext({strict:!1}),q$={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},$S={};for(const r in q$)$S[r]={isEnabled:t=>q$[r].some(s=>!!t[s])};function rCe(r){for(const t in r)$S[t]={...$S[t],...r[t]}}const iCe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function nk(r){return r.startsWith("while")||r.startsWith("drag")&&r!=="draggable"||r.startsWith("layout")||r.startsWith("onTap")||r.startsWith("onPan")||r.startsWith("onLayout")||iCe.has(r)}let LQ=r=>!nk(r);function sCe(r){r&&(LQ=t=>t.startsWith("on")?!nk(t):r(t))}try{sCe(require("@emotion/is-prop-valid").default)}catch{}function oCe(r,t,s){const a={};for(const l in r)l==="values"&&typeof r.values=="object"||(LQ(l)||s===!0&&nk(l)||!t&&!nk(l)||r.draggable&&l.startsWith("onDrag"))&&(a[l]=r[l]);return a}function aCe(r){if(typeof Proxy>"u")return r;const t=new Map,s=(...a)=>r(...a);return new Proxy(s,{get:(a,l)=>l==="create"?r:(t.has(l)||t.set(l,r(l)),t.get(l))})}const Zk=L.createContext({});function eR(r){return typeof r=="string"||Array.isArray(r)}function eN(r){return r!==null&&typeof r=="object"&&typeof r.start=="function"}const zV=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],GV=["initial",...zV];function tN(r){return eN(r.animate)||GV.some(t=>eR(r[t]))}function xQ(r){return!!(tN(r)||r.variants)}function cCe(r,t){if(tN(r)){const{initial:s,animate:a}=r;return{initial:s===!1||eR(s)?s:void 0,animate:eR(a)?a:void 0}}return r.inherit!==!1?t:{}}function lCe(r){const{initial:t,animate:s}=cCe(r,L.useContext(Zk));return L.useMemo(()=>({initial:t,animate:s}),[Y$(t),Y$(s)])}function Y$(r){return Array.isArray(r)?r.join(" "):r}const uCe=Symbol.for("motionComponentSymbol");function _S(r){return r&&typeof r=="object"&&Object.prototype.hasOwnProperty.call(r,"current")}function dCe(r,t,s){return L.useCallback(a=>{a&&r.onMount&&r.onMount(a),t&&(a?t.mount(a):t.unmount()),s&&(typeof s=="function"?s(a):_S(s)&&(s.current=a))},[t])}const HV=r=>r.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),hCe="framerAppearId",MQ="data-"+HV(hCe),{schedule:$V}=NQ(queueMicrotask,!1),UQ=L.createContext({});function pCe(r,t,s,a,l){var d,f;const{visualElement:E}=L.useContext(Zk),v=L.useContext(DQ),T=L.useContext(CR),R=L.useContext(FV).reducedMotion,I=L.useRef(null);a=a||v.renderer,!I.current&&a&&(I.current=a(r,{visualState:t,parent:E,props:s,presenceContext:T,blockInitialAnimation:T?T.initial===!1:!1,reducedMotionConfig:R}));const N=I.current,F=L.useContext(UQ);N&&!N.projection&&l&&(N.type==="html"||N.type==="svg")&&fCe(I.current,s,l,F);const j=L.useRef(!1);L.useInsertionEffect(()=>{N&&j.current&&N.update(s,T)});const G=s[MQ],H=L.useRef(!!G&&!(!((d=window.MotionHandoffIsComplete)===null||d===void 0)&&d.call(window,G))&&((f=window.MotionHasOptimisedAnimation)===null||f===void 0?void 0:f.call(window,G)));return OQ(()=>{N&&(j.current=!0,window.MotionIsMounted=!0,N.updateFeatures(),$V.render(N.render),H.current&&N.animationState&&N.animationState.animateChanges())}),L.useEffect(()=>{N&&(!H.current&&N.animationState&&N.animationState.animateChanges(),H.current&&(queueMicrotask(()=>{var te;(te=window.MotionHandoffMarkAsComplete)===null||te===void 0||te.call(window,G)}),H.current=!1))}),N}function fCe(r,t,s,a){const{layoutId:l,layout:d,drag:f,dragConstraints:E,layoutScroll:v,layoutRoot:T}=t;r.projection=new s(r.latestValues,t["data-framer-portal-id"]?void 0:VQ(r.parent)),r.projection.setOptions({layoutId:l,layout:d,alwaysMeasureLayout:!!f||E&&_S(E),visualElement:r,animationType:typeof d=="string"?d:"both",initialPromotionConfig:a,layoutScroll:v,layoutRoot:T})}function VQ(r){if(r)return r.options.allowProjection!==!1?r.projection:VQ(r.parent)}function mCe({preloadedFeatures:r,createVisualElement:t,useRender:s,useVisualState:a,Component:l}){var d,f;r&&rCe(r);function E(T,R){let I;const N={...L.useContext(FV),...T,layoutId:gCe(T)},{isStatic:F}=N,j=lCe(T),G=a(T,F);if(!F&&BV){_Ce();const H=ECe(N);I=H.MeasureLayout,j.visualElement=pCe(l,G,N,t,H.ProjectionNode)}return P.jsxs(Zk.Provider,{value:j,children:[I&&j.visualElement?P.jsx(I,{visualElement:j.visualElement,...N}):null,s(l,T,dCe(G,j.visualElement,R),G,F,j.visualElement)]})}E.displayName=`motion.${typeof l=="string"?l:`create(${(f=(d=l.displayName)!==null&&d!==void 0?d:l.name)!==null&&f!==void 0?f:""})`}`;const v=L.forwardRef(E);return v[uCe]=l,v}function gCe({layoutId:r}){const t=L.useContext(UV).id;return t&&r!==void 0?t+"-"+r:r}function _Ce(r,t){L.useContext(DQ).strict}function ECe(r){const{drag:t,layout:s}=$S;if(!t&&!s)return{};const a={...t,...s};return{MeasureLayout:t!=null&&t.isEnabled(r)||s!=null&&s.isEnabled(r)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}const yCe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function KV(r){return typeof r!="string"||r.includes("-")?!1:!!(yCe.indexOf(r)>-1||/[A-Z]/u.test(r))}function X$(r){const t=[{},{}];return r==null||r.values.forEach((s,a)=>{t[0][a]=s.get(),t[1][a]=s.getVelocity()}),t}function qV(r,t,s,a){if(typeof t=="function"){const[l,d]=X$(a);t=t(s!==void 0?s:r.custom,l,d)}if(typeof t=="string"&&(t=r.variants&&r.variants[t]),typeof t=="function"){const[l,d]=X$(a);t=t(s!==void 0?s:r.custom,l,d)}return t}const Y2=r=>Array.isArray(r),vCe=r=>!!(r&&typeof r=="object"&&r.mix&&r.toValue),SCe=r=>Y2(r)?r[r.length-1]||0:r,ka=r=>!!(r&&r.getVelocity);function IO(r){const t=ka(r)?r.get():r;return vCe(t)?t.toValue():t}function TCe({scrapeMotionValuesFromProps:r,createRenderState:t,onUpdate:s},a,l,d){const f={latestValues:bCe(a,l,d,r),renderState:t()};return s&&(f.onMount=E=>s({props:a,current:E,...f}),f.onUpdate=E=>s(E)),f}const FQ=r=>(t,s)=>{const a=L.useContext(Zk),l=L.useContext(CR),d=()=>TCe(r,t,a,l);return s?d():VV(d)};function bCe(r,t,s,a){const l={},d=a(r,{});for(const N in d)l[N]=IO(d[N]);let{initial:f,animate:E}=r;const v=tN(r),T=xQ(r);t&&T&&!v&&r.inherit!==!1&&(f===void 0&&(f=t.initial),E===void 0&&(E=t.animate));let R=s?s.initial===!1:!1;R=R||f===!1;const I=R?E:f;if(I&&typeof I!="boolean"&&!eN(I)){const N=Array.isArray(I)?I:[I];for(let F=0;F<N.length;F++){const j=qV(r,N[F]);if(j){const{transitionEnd:G,transition:H,...te}=j;for(const K in te){let ee=te[K];if(Array.isArray(ee)){const de=R?ee.length-1:0;ee=ee[de]}ee!==null&&(l[K]=ee)}for(const K in G)l[K]=G[K]}}}return l}const f0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],PE=new Set(f0),jQ=r=>t=>typeof t=="string"&&t.startsWith(r),BQ=jQ("--"),wCe=jQ("var(--"),YV=r=>wCe(r)?RCe.test(r.split("/*")[0].trim()):!1,RCe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,WQ=(r,t)=>t&&typeof r=="number"?t.transform(r):r,yf=(r,t,s)=>s>t?t:s<r?r:s,m0={test:r=>typeof r=="number",parse:parseFloat,transform:r=>r},tR={...m0,transform:r=>yf(0,1,r)},XP={...m0,default:1},IR=r=>({test:t=>typeof t=="string"&&t.endsWith(r)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${r}`}),Wm=IR("deg"),jh=IR("%"),Nn=IR("px"),CCe=IR("vh"),ICe=IR("vw"),J$={...jh,parse:r=>jh.parse(r)/100,transform:r=>jh.transform(r*100)},ACe={borderWidth:Nn,borderTopWidth:Nn,borderRightWidth:Nn,borderBottomWidth:Nn,borderLeftWidth:Nn,borderRadius:Nn,radius:Nn,borderTopLeftRadius:Nn,borderTopRightRadius:Nn,borderBottomRightRadius:Nn,borderBottomLeftRadius:Nn,width:Nn,maxWidth:Nn,height:Nn,maxHeight:Nn,top:Nn,right:Nn,bottom:Nn,left:Nn,padding:Nn,paddingTop:Nn,paddingRight:Nn,paddingBottom:Nn,paddingLeft:Nn,margin:Nn,marginTop:Nn,marginRight:Nn,marginBottom:Nn,marginLeft:Nn,backgroundPositionX:Nn,backgroundPositionY:Nn},PCe={rotate:Wm,rotateX:Wm,rotateY:Wm,rotateZ:Wm,scale:XP,scaleX:XP,scaleY:XP,scaleZ:XP,skew:Wm,skewX:Wm,skewY:Wm,distance:Nn,translateX:Nn,translateY:Nn,translateZ:Nn,x:Nn,y:Nn,z:Nn,perspective:Nn,transformPerspective:Nn,opacity:tR,originX:J$,originY:J$,originZ:Nn},Q$={...m0,transform:Math.round},XV={...ACe,...PCe,zIndex:Q$,size:Nn,fillOpacity:tR,strokeOpacity:tR,numOctaves:Q$},OCe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},kCe=f0.length;function NCe(r,t,s){let a="",l=!0;for(let d=0;d<kCe;d++){const f=f0[d],E=r[f];if(E===void 0)continue;let v=!0;if(typeof E=="number"?v=E===(f.startsWith("scale")?1:0):v=parseFloat(E)===0,!v||s){const T=WQ(E,XV[f]);if(!v){l=!1;const R=OCe[f]||f;a+=`${R}(${T}) `}s&&(t[f]=T)}}return a=a.trim(),s?a=s(t,l?"":a):l&&(a="none"),a}function JV(r,t,s){const{style:a,vars:l,transformOrigin:d}=r;let f=!1,E=!1;for(const v in t){const T=t[v];if(PE.has(v)){f=!0;continue}else if(BQ(v)){l[v]=T;continue}else{const R=WQ(T,XV[v]);v.startsWith("origin")?(E=!0,d[v]=R):a[v]=R}}if(t.transform||(f||s?a.transform=NCe(t,r.transform,s):a.transform&&(a.transform="none")),E){const{originX:v="50%",originY:T="50%",originZ:R=0}=d;a.transformOrigin=`${v} ${T} ${R}`}}const DCe={offset:"stroke-dashoffset",array:"stroke-dasharray"},LCe={offset:"strokeDashoffset",array:"strokeDasharray"};function xCe(r,t,s=1,a=0,l=!0){r.pathLength=1;const d=l?DCe:LCe;r[d.offset]=Nn.transform(-a);const f=Nn.transform(t),E=Nn.transform(s);r[d.array]=`${f} ${E}`}function Z$(r,t,s){return typeof r=="string"?r:Nn.transform(t+s*r)}function MCe(r,t,s){const a=Z$(t,r.x,r.width),l=Z$(s,r.y,r.height);return`${a} ${l}`}function QV(r,{attrX:t,attrY:s,attrScale:a,originX:l,originY:d,pathLength:f,pathSpacing:E=1,pathOffset:v=0,...T},R,I){if(JV(r,T,I),R){r.style.viewBox&&(r.attrs.viewBox=r.style.viewBox);return}r.attrs=r.style,r.style={};const{attrs:N,style:F,dimensions:j}=r;N.transform&&(j&&(F.transform=N.transform),delete N.transform),j&&(l!==void 0||d!==void 0||F.transform)&&(F.transformOrigin=MCe(j,l!==void 0?l:.5,d!==void 0?d:.5)),t!==void 0&&(N.x=t),s!==void 0&&(N.y=s),a!==void 0&&(N.scale=a),f!==void 0&&xCe(N,f,E,v,!1)}const ZV=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),zQ=()=>({...ZV(),attrs:{}}),eF=r=>typeof r=="string"&&r.toLowerCase()==="svg";function GQ(r,{style:t,vars:s},a,l){Object.assign(r.style,t,l&&l.getProjectionStyles(a));for(const d in s)r.style.setProperty(d,s[d])}const HQ=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function $Q(r,t,s,a){GQ(r,t,void 0,a);for(const l in t.attrs)r.setAttribute(HQ.has(l)?l:HV(l),t.attrs[l])}const rk={};function UCe(r){Object.assign(rk,r)}function KQ(r,{layout:t,layoutId:s}){return PE.has(r)||r.startsWith("origin")||(t||s!==void 0)&&(!!rk[r]||r==="opacity")}function tF(r,t,s){var a;const{style:l}=r,d={};for(const f in l)(ka(l[f])||t.style&&ka(t.style[f])||KQ(f,r)||((a=s==null?void 0:s.getValue(f))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(d[f]=l[f]);return d}function qQ(r,t,s){const a=tF(r,t,s);for(const l in r)if(ka(r[l])||ka(t[l])){const d=f0.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[d]=r[l]}return a}function VCe(r,t){try{t.dimensions=typeof r.getBBox=="function"?r.getBBox():r.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const eK=["x","y","width","height","cx","cy","r"],FCe={useVisualState:FQ({scrapeMotionValuesFromProps:qQ,createRenderState:zQ,onUpdate:({props:r,prevProps:t,current:s,renderState:a,latestValues:l})=>{if(!s)return;let d=!!r.drag;if(!d){for(const E in l)if(PE.has(E)){d=!0;break}}if(!d)return;let f=!t;if(t)for(let E=0;E<eK.length;E++){const v=eK[E];r[v]!==t[v]&&(f=!0)}f&&Bi.read(()=>{VCe(s,a),Bi.render(()=>{QV(a,l,eF(s.tagName),r.transformTemplate),$Q(s,a)})})}})},jCe={useVisualState:FQ({scrapeMotionValuesFromProps:tF,createRenderState:ZV})};function YQ(r,t,s){for(const a in t)!ka(t[a])&&!KQ(a,s)&&(r[a]=t[a])}function BCe({transformTemplate:r},t){return L.useMemo(()=>{const s=ZV();return JV(s,t,r),Object.assign({},s.vars,s.style)},[t])}function WCe(r,t){const s=r.style||{},a={};return YQ(a,s,r),Object.assign(a,BCe(r,t)),a}function zCe(r,t){const s={},a=WCe(r,t);return r.drag&&r.dragListener!==!1&&(s.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=r.drag===!0?"none":`pan-${r.drag==="x"?"y":"x"}`),r.tabIndex===void 0&&(r.onTap||r.onTapStart||r.whileTap)&&(s.tabIndex=0),s.style=a,s}function GCe(r,t,s,a){const l=L.useMemo(()=>{const d=zQ();return QV(d,t,eF(a),r.transformTemplate),{...d.attrs,style:{...d.style}}},[t]);if(r.style){const d={};YQ(d,r.style,r),l.style={...d,...l.style}}return l}function HCe(r=!1){return(s,a,l,{latestValues:d},f)=>{const v=(KV(s)?GCe:zCe)(a,d,f,s),T=oCe(a,typeof s=="string",r),R=s!==L.Fragment?{...T,...v,ref:l}:{},{children:I}=a,N=L.useMemo(()=>ka(I)?I.get():I,[I]);return L.createElement(s,{...R,children:N})}}function $Ce(r,t){return function(a,{forwardMotionProps:l}={forwardMotionProps:!1}){const f={...KV(a)?FCe:jCe,preloadedFeatures:r,useRender:HCe(l),createVisualElement:t,Component:a};return mCe(f)}}function XQ(r,t){if(!Array.isArray(t))return!1;const s=t.length;if(s!==r.length)return!1;for(let a=0;a<s;a++)if(t[a]!==r[a])return!1;return!0}function nN(r,t,s){const a=r.getProps();return qV(a,t,s!==void 0?s:a.custom,r)}const KCe=WV(()=>window.ScrollTimeline!==void 0);class qCe{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,s){for(let a=0;a<this.animations.length;a++)this.animations[a][t]=s}attachTimeline(t,s){const a=this.animations.map(l=>{if(KCe()&&l.attachTimeline)return l.attachTimeline(t);if(typeof s=="function")return s(l)});return()=>{a.forEach((l,d)=>{l&&l(),this.animations[d].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let s=0;s<this.animations.length;s++)t=Math.max(t,this.animations[s].duration);return t}runAll(t){this.animations.forEach(s=>s[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class YCe extends qCe{then(t,s){return Promise.all(this.animations).then(t).catch(s)}}function nF(r,t){return r?r[t]||r.default||r:void 0}const X2=2e4;function JQ(r){let t=0;const s=50;let a=r.next(t);for(;!a.done&&t<X2;)t+=s,a=r.next(t);return t>=X2?1/0:t}function rF(r){return typeof r=="function"}function tK(r,t){r.timeline=t,r.onfinish=null}const iF=r=>Array.isArray(r)&&typeof r[0]=="number",XCe={linearEasing:void 0};function JCe(r,t){const s=WV(r);return()=>{var a;return(a=XCe[t])!==null&&a!==void 0?a:s()}}const ik=JCe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),QQ=(r,t,s=10)=>{let a="";const l=Math.max(Math.round(t/s),2);for(let d=0;d<l;d++)a+=r(HS(0,l-1,d))+", ";return`linear(${a.substring(0,a.length-2)})`};function ZQ(r){return!!(typeof r=="function"&&ik()||!r||typeof r=="string"&&(r in J2||ik())||iF(r)||Array.isArray(r)&&r.every(ZQ))}const fw=([r,t,s,a])=>`cubic-bezier(${r}, ${t}, ${s}, ${a})`,J2={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:fw([0,.65,.55,1]),circOut:fw([.55,0,1,.45]),backIn:fw([.31,.01,.66,-.59]),backOut:fw([.33,1.53,.69,.99])};function eZ(r,t){if(r)return typeof r=="function"&&ik()?QQ(r,t):iF(r)?fw(r):Array.isArray(r)?r.map(s=>eZ(s,t)||J2.easeOut):J2[r]}const Sd={x:!1,y:!1};function tZ(){return Sd.x||Sd.y}function QCe(r,t,s){var a;if(r instanceof Element)return[r];if(typeof r=="string"){let l=document;const d=(a=void 0)!==null&&a!==void 0?a:l.querySelectorAll(r);return d?Array.from(d):[]}return Array.from(r)}function nZ(r,t){const s=QCe(r),a=new AbortController,l={passive:!0,...t,signal:a.signal};return[s,l,()=>a.abort()]}function nK(r){return t=>{t.pointerType==="touch"||tZ()||r(t)}}function ZCe(r,t,s={}){const[a,l,d]=nZ(r,s),f=nK(E=>{const{target:v}=E,T=t(E);if(typeof T!="function"||!v)return;const R=nK(I=>{T(I),v.removeEventListener("pointerleave",R)});v.addEventListener("pointerleave",R,l)});return a.forEach(E=>{E.addEventListener("pointerenter",f,l)}),d}const rZ=(r,t)=>t?r===t?!0:rZ(r,t.parentElement):!1,sF=r=>r.pointerType==="mouse"?typeof r.button!="number"||r.button<=0:r.isPrimary!==!1,eIe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function tIe(r){return eIe.has(r.tagName)||r.tabIndex!==-1}const mw=new WeakSet;function rK(r){return t=>{t.key==="Enter"&&r(t)}}function FM(r,t){r.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const nIe=(r,t)=>{const s=r.currentTarget;if(!s)return;const a=rK(()=>{if(mw.has(s))return;FM(s,"down");const l=rK(()=>{FM(s,"up")}),d=()=>FM(s,"cancel");s.addEventListener("keyup",l,t),s.addEventListener("blur",d,t)});s.addEventListener("keydown",a,t),s.addEventListener("blur",()=>s.removeEventListener("keydown",a),t)};function iK(r){return sF(r)&&!tZ()}function rIe(r,t,s={}){const[a,l,d]=nZ(r,s),f=E=>{const v=E.currentTarget;if(!iK(E)||mw.has(v))return;mw.add(v);const T=t(E),R=(F,j)=>{window.removeEventListener("pointerup",I),window.removeEventListener("pointercancel",N),!(!iK(F)||!mw.has(v))&&(mw.delete(v),typeof T=="function"&&T(F,{success:j}))},I=F=>{R(F,s.useGlobalTarget||rZ(v,F.target))},N=F=>{R(F,!1)};window.addEventListener("pointerup",I,l),window.addEventListener("pointercancel",N,l)};return a.forEach(E=>{!tIe(E)&&E.getAttribute("tabindex")===null&&(E.tabIndex=0),(s.useGlobalTarget?window:E).addEventListener("pointerdown",f,l),E.addEventListener("focus",T=>nIe(T,l),l)}),d}function iIe(r){return r==="x"||r==="y"?Sd[r]?null:(Sd[r]=!0,()=>{Sd[r]=!1}):Sd.x||Sd.y?null:(Sd.x=Sd.y=!0,()=>{Sd.x=Sd.y=!1})}const iZ=new Set(["width","height","top","left","right","bottom",...f0]);let AO;function sIe(){AO=void 0}const Bh={now:()=>(AO===void 0&&Bh.set(Yo.isProcessing||eCe.useManualTiming?Yo.timestamp:performance.now()),AO),set:r=>{AO=r,queueMicrotask(sIe)}};function oF(r,t){r.indexOf(t)===-1&&r.push(t)}function aF(r,t){const s=r.indexOf(t);s>-1&&r.splice(s,1)}class cF{constructor(){this.subscriptions=[]}add(t){return oF(this.subscriptions,t),()=>aF(this.subscriptions,t)}notify(t,s,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](t,s,a);else for(let d=0;d<l;d++){const f=this.subscriptions[d];f&&f(t,s,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function sZ(r,t){return t?r*(1e3/t):0}const sK=30,oIe=r=>!isNaN(parseFloat(r));class aIe{constructor(t,s={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,l=!0)=>{const d=Bh.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=s.owner}setCurrent(t){this.current=t,this.updatedAt=Bh.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=oIe(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,s){this.events[t]||(this.events[t]=new cF);const a=this.events[t].add(s);return t==="change"?()=>{a(),Bi.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,s){this.passiveEffect=t,this.stopPassiveEffect=s}set(t,s=!0){!s||!this.passiveEffect?this.updateAndNotify(t,s):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,s,a){this.set(s),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-a}jump(t,s=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,s&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Bh.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>sK)return 0;const s=Math.min(this.updatedAt-this.prevUpdatedAt,sK);return sZ(parseFloat(this.current)-parseFloat(this.prevFrameValue),s)}start(t){return this.stop(),new Promise(s=>{this.hasAnimated=!0,this.animation=t(s),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function nR(r,t){return new aIe(r,t)}function cIe(r,t,s){r.hasValue(t)?r.getValue(t).set(s):r.addValue(t,nR(s))}function lIe(r,t){const s=nN(r,t);let{transitionEnd:a={},transition:l={},...d}=s||{};d={...d,...a};for(const f in d){const E=SCe(d[f]);cIe(r,f,E)}}function uIe(r){return!!(ka(r)&&r.add)}function Q2(r,t){const s=r.getValue("willChange");if(uIe(s))return s.add(t)}function oZ(r){return r.props[MQ]}const aZ=(r,t,s)=>(((1-3*s+3*t)*r+(3*s-6*t))*r+3*t)*r,dIe=1e-7,hIe=12;function pIe(r,t,s,a,l){let d,f,E=0;do f=t+(s-t)/2,d=aZ(f,a,l)-r,d>0?s=f:t=f;while(Math.abs(d)>dIe&&++E<hIe);return f}function AR(r,t,s,a){if(r===t&&s===a)return Al;const l=d=>pIe(d,0,1,r,s);return d=>d===0||d===1?d:aZ(l(d),t,a)}const cZ=r=>t=>t<=.5?r(2*t)/2:(2-r(2*(1-t)))/2,lZ=r=>t=>1-r(1-t),uZ=AR(.33,1.53,.69,.99),lF=lZ(uZ),dZ=cZ(lF),hZ=r=>(r*=2)<1?.5*lF(r):.5*(2-Math.pow(2,-10*(r-1))),uF=r=>1-Math.sin(Math.acos(r)),pZ=lZ(uF),fZ=cZ(uF),mZ=r=>/^0[^.\s]+$/u.test(r);function fIe(r){return typeof r=="number"?r===0:r!==null?r==="none"||r==="0"||mZ(r):!0}const Nw=r=>Math.round(r*1e5)/1e5,dF=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function mIe(r){return r==null}const gIe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,hF=(r,t)=>s=>!!(typeof s=="string"&&gIe.test(s)&&s.startsWith(r)||t&&!mIe(s)&&Object.prototype.hasOwnProperty.call(s,t)),gZ=(r,t,s)=>a=>{if(typeof a!="string")return a;const[l,d,f,E]=a.match(dF);return{[r]:parseFloat(l),[t]:parseFloat(d),[s]:parseFloat(f),alpha:E!==void 0?parseFloat(E):1}},_Ie=r=>yf(0,255,r),jM={...m0,transform:r=>Math.round(_Ie(r))},nE={test:hF("rgb","red"),parse:gZ("red","green","blue"),transform:({red:r,green:t,blue:s,alpha:a=1})=>"rgba("+jM.transform(r)+", "+jM.transform(t)+", "+jM.transform(s)+", "+Nw(tR.transform(a))+")"};function EIe(r){let t="",s="",a="",l="";return r.length>5?(t=r.substring(1,3),s=r.substring(3,5),a=r.substring(5,7),l=r.substring(7,9)):(t=r.substring(1,2),s=r.substring(2,3),a=r.substring(3,4),l=r.substring(4,5),t+=t,s+=s,a+=a,l+=l),{red:parseInt(t,16),green:parseInt(s,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const Z2={test:hF("#"),parse:EIe,transform:nE.transform},ES={test:hF("hsl","hue"),parse:gZ("hue","saturation","lightness"),transform:({hue:r,saturation:t,lightness:s,alpha:a=1})=>"hsla("+Math.round(r)+", "+jh.transform(Nw(t))+", "+jh.transform(Nw(s))+", "+Nw(tR.transform(a))+")"},Ia={test:r=>nE.test(r)||Z2.test(r)||ES.test(r),parse:r=>nE.test(r)?nE.parse(r):ES.test(r)?ES.parse(r):Z2.parse(r),transform:r=>typeof r=="string"?r:r.hasOwnProperty("red")?nE.transform(r):ES.transform(r)},yIe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function vIe(r){var t,s;return isNaN(r)&&typeof r=="string"&&(((t=r.match(dF))===null||t===void 0?void 0:t.length)||0)+(((s=r.match(yIe))===null||s===void 0?void 0:s.length)||0)>0}const _Z="number",EZ="color",SIe="var",TIe="var(",oK="${}",bIe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function rR(r){const t=r.toString(),s=[],a={color:[],number:[],var:[]},l=[];let d=0;const E=t.replace(bIe,v=>(Ia.test(v)?(a.color.push(d),l.push(EZ),s.push(Ia.parse(v))):v.startsWith(TIe)?(a.var.push(d),l.push(SIe),s.push(v)):(a.number.push(d),l.push(_Z),s.push(parseFloat(v))),++d,oK)).split(oK);return{values:s,split:E,indexes:a,types:l}}function yZ(r){return rR(r).values}function vZ(r){const{split:t,types:s}=rR(r),a=t.length;return l=>{let d="";for(let f=0;f<a;f++)if(d+=t[f],l[f]!==void 0){const E=s[f];E===_Z?d+=Nw(l[f]):E===EZ?d+=Ia.transform(l[f]):d+=l[f]}return d}}const wIe=r=>typeof r=="number"?0:r;function RIe(r){const t=yZ(r);return vZ(r)(t.map(wIe))}const ug={test:vIe,parse:yZ,createTransformer:vZ,getAnimatableNone:RIe},CIe=new Set(["brightness","contrast","saturate","opacity"]);function IIe(r){const[t,s]=r.slice(0,-1).split("(");if(t==="drop-shadow")return r;const[a]=s.match(dF)||[];if(!a)return r;const l=s.replace(a,"");let d=CIe.has(t)?1:0;return a!==s&&(d*=100),t+"("+d+l+")"}const AIe=/\b([a-z-]*)\(.*?\)/gu,eU={...ug,getAnimatableNone:r=>{const t=r.match(AIe);return t?t.map(IIe).join(" "):r}},PIe={...XV,color:Ia,backgroundColor:Ia,outlineColor:Ia,fill:Ia,stroke:Ia,borderColor:Ia,borderTopColor:Ia,borderRightColor:Ia,borderBottomColor:Ia,borderLeftColor:Ia,filter:eU,WebkitFilter:eU},pF=r=>PIe[r];function SZ(r,t){let s=pF(r);return s!==eU&&(s=ug),s.getAnimatableNone?s.getAnimatableNone(t):void 0}const OIe=new Set(["auto","none","0"]);function kIe(r,t,s){let a=0,l;for(;a<r.length&&!l;){const d=r[a];typeof d=="string"&&!OIe.has(d)&&rR(d).values.length&&(l=r[a]),a++}if(l&&s)for(const d of t)r[d]=SZ(s,l)}const aK=r=>r===m0||r===Nn,cK=(r,t)=>parseFloat(r.split(", ")[t]),lK=(r,t)=>(s,{transform:a})=>{if(a==="none"||!a)return 0;const l=a.match(/^matrix3d\((.+)\)$/u);if(l)return cK(l[1],t);{const d=a.match(/^matrix\((.+)\)$/u);return d?cK(d[1],r):0}},NIe=new Set(["x","y","z"]),DIe=f0.filter(r=>!NIe.has(r));function LIe(r){const t=[];return DIe.forEach(s=>{const a=r.getValue(s);a!==void 0&&(t.push([s,a.get()]),a.set(s.startsWith("scale")?1:0))}),t}const KS={width:({x:r},{paddingLeft:t="0",paddingRight:s="0"})=>r.max-r.min-parseFloat(t)-parseFloat(s),height:({y:r},{paddingTop:t="0",paddingBottom:s="0"})=>r.max-r.min-parseFloat(t)-parseFloat(s),top:(r,{top:t})=>parseFloat(t),left:(r,{left:t})=>parseFloat(t),bottom:({y:r},{top:t})=>parseFloat(t)+(r.max-r.min),right:({x:r},{left:t})=>parseFloat(t)+(r.max-r.min),x:lK(4,13),y:lK(5,14)};KS.translateX=KS.x;KS.translateY=KS.y;const cE=new Set;let tU=!1,nU=!1;function TZ(){if(nU){const r=Array.from(cE).filter(a=>a.needsMeasurement),t=new Set(r.map(a=>a.element)),s=new Map;t.forEach(a=>{const l=LIe(a);l.length&&(s.set(a,l),a.render())}),r.forEach(a=>a.measureInitialState()),t.forEach(a=>{a.render();const l=s.get(a);l&&l.forEach(([d,f])=>{var E;(E=a.getValue(d))===null||E===void 0||E.set(f)})}),r.forEach(a=>a.measureEndState()),r.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}nU=!1,tU=!1,cE.forEach(r=>r.complete()),cE.clear()}function bZ(){cE.forEach(r=>{r.readKeyframes(),r.needsMeasurement&&(nU=!0)})}function xIe(){bZ(),TZ()}class fF{constructor(t,s,a,l,d,f=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=s,this.name=a,this.motionValue=l,this.element=d,this.isAsync=f}scheduleResolve(){this.isScheduled=!0,this.isAsync?(cE.add(this),tU||(tU=!0,Bi.read(bZ),Bi.resolveKeyframes(TZ))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:s,element:a,motionValue:l}=this;for(let d=0;d<t.length;d++)if(t[d]===null)if(d===0){const f=l==null?void 0:l.get(),E=t[t.length-1];if(f!==void 0)t[0]=f;else if(a&&s){const v=a.readValue(s,E);v!=null&&(t[0]=v)}t[0]===void 0&&(t[0]=E),l&&f===void 0&&l.set(t[0])}else t[d]=t[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),cE.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,cE.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const wZ=r=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(r),MIe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function UIe(r){const t=MIe.exec(r);if(!t)return[,];const[,s,a,l]=t;return[`--${s??a}`,l]}function RZ(r,t,s=1){const[a,l]=UIe(r);if(!a)return;const d=window.getComputedStyle(t).getPropertyValue(a);if(d){const f=d.trim();return wZ(f)?parseFloat(f):f}return YV(l)?RZ(l,t,s+1):l}const CZ=r=>t=>t.test(r),VIe={test:r=>r==="auto",parse:r=>r},IZ=[m0,Nn,jh,Wm,ICe,CCe,VIe],uK=r=>IZ.find(CZ(r));class AZ extends fF{constructor(t,s,a,l,d){super(t,s,a,l,d,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:s,name:a}=this;if(!s||!s.current)return;super.readKeyframes();for(let v=0;v<t.length;v++){let T=t[v];if(typeof T=="string"&&(T=T.trim(),YV(T))){const R=RZ(T,s.current);R!==void 0&&(t[v]=R),v===t.length-1&&(this.finalKeyframe=T)}}if(this.resolveNoneKeyframes(),!iZ.has(a)||t.length!==2)return;const[l,d]=t,f=uK(l),E=uK(d);if(f!==E)if(aK(f)&&aK(E))for(let v=0;v<t.length;v++){const T=t[v];typeof T=="string"&&(t[v]=parseFloat(T))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:s}=this,a=[];for(let l=0;l<t.length;l++)fIe(t[l])&&a.push(l);a.length&&kIe(t,a,s)}measureInitialState(){const{element:t,unresolvedKeyframes:s,name:a}=this;if(!t||!t.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=KS[a](t.measureViewportBox(),window.getComputedStyle(t.current)),s[0]=this.measuredOrigin;const l=s[s.length-1];l!==void 0&&t.getValue(a,l).jump(l,!1)}measureEndState(){var t;const{element:s,name:a,unresolvedKeyframes:l}=this;if(!s||!s.current)return;const d=s.getValue(a);d&&d.jump(this.measuredOrigin,!1);const f=l.length-1,E=l[f];l[f]=KS[a](s.measureViewportBox(),window.getComputedStyle(s.current)),E!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=E),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([v,T])=>{s.getValue(v).set(T)}),this.resolveNoneKeyframes()}}const dK=(r,t)=>t==="zIndex"?!1:!!(typeof r=="number"||Array.isArray(r)||typeof r=="string"&&(ug.test(r)||r==="0")&&!r.startsWith("url("));function FIe(r){const t=r[0];if(r.length===1)return!0;for(let s=0;s<r.length;s++)if(r[s]!==t)return!0}function jIe(r,t,s,a){const l=r[0];if(l===null)return!1;if(t==="display"||t==="visibility")return!0;const d=r[r.length-1],f=dK(l,t),E=dK(d,t);return!f||!E?!1:FIe(r)||(s==="spring"||rF(s))&&a}const BIe=r=>r!==null;function rN(r,{repeat:t,repeatType:s="loop"},a){const l=r.filter(BIe),d=t&&s!=="loop"&&t%2===1?0:l.length-1;return!d||a===void 0?l[d]:a}const WIe=40;class PZ{constructor({autoplay:t=!0,delay:s=0,type:a="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:f="loop",...E}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Bh.now(),this.options={autoplay:t,delay:s,type:a,repeat:l,repeatDelay:d,repeatType:f,...E},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>WIe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&xIe(),this._resolved}onKeyframesResolved(t,s){this.resolvedAt=Bh.now(),this.hasAttemptedResolve=!0;const{name:a,type:l,velocity:d,delay:f,onComplete:E,onUpdate:v,isGenerator:T}=this.options;if(!T&&!jIe(t,a,l,d))if(f)this.options.duration=0;else{v&&v(rN(t,this.options,s)),E&&E(),this.resolveFinishedPromise();return}const R=this.initPlayback(t,s);R!==!1&&(this._resolved={keyframes:t,finalKeyframe:s,...R},this.onPostResolved())}onPostResolved(){}then(t,s){return this.currentFinishedPromise.then(t,s)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const ss=(r,t,s)=>r+(t-r)*s;function BM(r,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?r+(t-r)*6*s:s<1/2?t:s<2/3?r+(t-r)*(2/3-s)*6:r}function zIe({hue:r,saturation:t,lightness:s,alpha:a}){r/=360,t/=100,s/=100;let l=0,d=0,f=0;if(!t)l=d=f=s;else{const E=s<.5?s*(1+t):s+t-s*t,v=2*s-E;l=BM(v,E,r+1/3),d=BM(v,E,r),f=BM(v,E,r-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(f*255),alpha:a}}function sk(r,t){return s=>s>0?t:r}const WM=(r,t,s)=>{const a=r*r,l=s*(t*t-a)+a;return l<0?0:Math.sqrt(l)},GIe=[Z2,nE,ES],HIe=r=>GIe.find(t=>t.test(r));function hK(r){const t=HIe(r);if(!t)return!1;let s=t.parse(r);return t===ES&&(s=zIe(s)),s}const pK=(r,t)=>{const s=hK(r),a=hK(t);if(!s||!a)return sk(r,t);const l={...s};return d=>(l.red=WM(s.red,a.red,d),l.green=WM(s.green,a.green,d),l.blue=WM(s.blue,a.blue,d),l.alpha=ss(s.alpha,a.alpha,d),nE.transform(l))},$Ie=(r,t)=>s=>t(r(s)),PR=(...r)=>r.reduce($Ie),rU=new Set(["none","hidden"]);function KIe(r,t){return rU.has(r)?s=>s<=0?r:t:s=>s>=1?t:r}function qIe(r,t){return s=>ss(r,t,s)}function mF(r){return typeof r=="number"?qIe:typeof r=="string"?YV(r)?sk:Ia.test(r)?pK:JIe:Array.isArray(r)?OZ:typeof r=="object"?Ia.test(r)?pK:YIe:sk}function OZ(r,t){const s=[...r],a=s.length,l=r.map((d,f)=>mF(d)(d,t[f]));return d=>{for(let f=0;f<a;f++)s[f]=l[f](d);return s}}function YIe(r,t){const s={...r,...t},a={};for(const l in s)r[l]!==void 0&&t[l]!==void 0&&(a[l]=mF(r[l])(r[l],t[l]));return l=>{for(const d in a)s[d]=a[d](l);return s}}function XIe(r,t){var s;const a=[],l={color:0,var:0,number:0};for(let d=0;d<t.values.length;d++){const f=t.types[d],E=r.indexes[f][l[f]],v=(s=r.values[E])!==null&&s!==void 0?s:0;a[d]=v,l[f]++}return a}const JIe=(r,t)=>{const s=ug.createTransformer(t),a=rR(r),l=rR(t);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?rU.has(r)&&!l.values.length||rU.has(t)&&!a.values.length?KIe(r,t):PR(OZ(XIe(a,l),l.values),s):sk(r,t)};function kZ(r,t,s){return typeof r=="number"&&typeof t=="number"&&typeof s=="number"?ss(r,t,s):mF(r)(r,t)}const QIe=5;function NZ(r,t,s){const a=Math.max(t-QIe,0);return sZ(s-r(a),t-a)}const Ts={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},fK=.001;function ZIe({duration:r=Ts.duration,bounce:t=Ts.bounce,velocity:s=Ts.velocity,mass:a=Ts.mass}){let l,d,f=1-t;f=yf(Ts.minDamping,Ts.maxDamping,f),r=yf(Ts.minDuration,Ts.maxDuration,mf(r)),f<1?(l=T=>{const R=T*f,I=R*r,N=R-s,F=iU(T,f),j=Math.exp(-I);return fK-N/F*j},d=T=>{const I=T*f*r,N=I*s+s,F=Math.pow(f,2)*Math.pow(T,2)*r,j=Math.exp(-I),G=iU(Math.pow(T,2),f);return(-l(T)+fK>0?-1:1)*((N-F)*j)/G}):(l=T=>{const R=Math.exp(-T*r),I=(T-s)*r+1;return-.001+R*I},d=T=>{const R=Math.exp(-T*r),I=(s-T)*(r*r);return R*I});const E=5/r,v=tAe(l,d,E);if(r=ff(r),isNaN(v))return{stiffness:Ts.stiffness,damping:Ts.damping,duration:r};{const T=Math.pow(v,2)*a;return{stiffness:T,damping:f*2*Math.sqrt(a*T),duration:r}}}const eAe=12;function tAe(r,t,s){let a=s;for(let l=1;l<eAe;l++)a=a-r(a)/t(a);return a}function iU(r,t){return r*Math.sqrt(1-t*t)}const nAe=["duration","bounce"],rAe=["stiffness","damping","mass"];function mK(r,t){return t.some(s=>r[s]!==void 0)}function iAe(r){let t={velocity:Ts.velocity,stiffness:Ts.stiffness,damping:Ts.damping,mass:Ts.mass,isResolvedFromDuration:!1,...r};if(!mK(r,rAe)&&mK(r,nAe))if(r.visualDuration){const s=r.visualDuration,a=2*Math.PI/(s*1.2),l=a*a,d=2*yf(.05,1,1-(r.bounce||0))*Math.sqrt(l);t={...t,mass:Ts.mass,stiffness:l,damping:d}}else{const s=ZIe(r);t={...t,...s,mass:Ts.mass},t.isResolvedFromDuration=!0}return t}function DZ(r=Ts.visualDuration,t=Ts.bounce){const s=typeof r!="object"?{visualDuration:r,keyframes:[0,1],bounce:t}:r;let{restSpeed:a,restDelta:l}=s;const d=s.keyframes[0],f=s.keyframes[s.keyframes.length-1],E={done:!1,value:d},{stiffness:v,damping:T,mass:R,duration:I,velocity:N,isResolvedFromDuration:F}=iAe({...s,velocity:-mf(s.velocity||0)}),j=N||0,G=T/(2*Math.sqrt(v*R)),H=f-d,te=mf(Math.sqrt(v/R)),K=Math.abs(H)<5;a||(a=K?Ts.restSpeed.granular:Ts.restSpeed.default),l||(l=K?Ts.restDelta.granular:Ts.restDelta.default);let ee;if(G<1){const se=iU(te,G);ee=ge=>{const Z=Math.exp(-G*te*ge);return f-Z*((j+G*te*H)/se*Math.sin(se*ge)+H*Math.cos(se*ge))}}else if(G===1)ee=se=>f-Math.exp(-te*se)*(H+(j+te*H)*se);else{const se=te*Math.sqrt(G*G-1);ee=ge=>{const Z=Math.exp(-G*te*ge),Q=Math.min(se*ge,300);return f-Z*((j+G*te*H)*Math.sinh(Q)+se*H*Math.cosh(Q))/se}}const de={calculatedDuration:F&&I||null,next:se=>{const ge=ee(se);if(F)E.done=se>=I;else{let Z=0;G<1&&(Z=se===0?ff(j):NZ(ee,se,ge));const Q=Math.abs(Z)<=a,ne=Math.abs(f-ge)<=l;E.done=Q&&ne}return E.value=E.done?f:ge,E},toString:()=>{const se=Math.min(JQ(de),X2),ge=QQ(Z=>de.next(se*Z).value,se,30);return se+"ms "+ge}};return de}function gK({keyframes:r,velocity:t=0,power:s=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:f,min:E,max:v,restDelta:T=.5,restSpeed:R}){const I=r[0],N={done:!1,value:I},F=Q=>E!==void 0&&Q<E||v!==void 0&&Q>v,j=Q=>E===void 0?v:v===void 0||Math.abs(E-Q)<Math.abs(v-Q)?E:v;let G=s*t;const H=I+G,te=f===void 0?H:f(H);te!==H&&(G=te-I);const K=Q=>-G*Math.exp(-Q/a),ee=Q=>te+K(Q),de=Q=>{const ne=K(Q),oe=ee(Q);N.done=Math.abs(ne)<=T,N.value=N.done?te:oe};let se,ge;const Z=Q=>{F(N.value)&&(se=Q,ge=DZ({keyframes:[N.value,j(N.value)],velocity:NZ(ee,Q,N.value),damping:l,stiffness:d,restDelta:T,restSpeed:R}))};return Z(0),{calculatedDuration:null,next:Q=>{let ne=!1;return!ge&&se===void 0&&(ne=!0,de(Q),Z(Q)),se!==void 0&&Q>=se?ge.next(Q-se):(!ne&&de(Q),N)}}}const sAe=AR(.42,0,1,1),oAe=AR(0,0,.58,1),LZ=AR(.42,0,.58,1),aAe=r=>Array.isArray(r)&&typeof r[0]!="number",cAe={linear:Al,easeIn:sAe,easeInOut:LZ,easeOut:oAe,circIn:uF,circInOut:fZ,circOut:pZ,backIn:lF,backInOut:dZ,backOut:uZ,anticipate:hZ},_K=r=>{if(iF(r)){kQ(r.length===4);const[t,s,a,l]=r;return AR(t,s,a,l)}else if(typeof r=="string")return cAe[r];return r};function lAe(r,t,s){const a=[],l=s||kZ,d=r.length-1;for(let f=0;f<d;f++){let E=l(r[f],r[f+1]);if(t){const v=Array.isArray(t)?t[f]||Al:t;E=PR(v,E)}a.push(E)}return a}function uAe(r,t,{clamp:s=!0,ease:a,mixer:l}={}){const d=r.length;if(kQ(d===t.length),d===1)return()=>t[0];if(d===2&&t[0]===t[1])return()=>t[1];const f=r[0]===r[1];r[0]>r[d-1]&&(r=[...r].reverse(),t=[...t].reverse());const E=lAe(t,a,l),v=E.length,T=R=>{if(f&&R<r[0])return t[0];let I=0;if(v>1)for(;I<r.length-2&&!(R<r[I+1]);I++);const N=HS(r[I],r[I+1],R);return E[I](N)};return s?R=>T(yf(r[0],r[d-1],R)):T}function dAe(r,t){const s=r[r.length-1];for(let a=1;a<=t;a++){const l=HS(0,t,a);r.push(ss(s,1,l))}}function hAe(r){const t=[0];return dAe(t,r.length-1),t}function pAe(r,t){return r.map(s=>s*t)}function fAe(r,t){return r.map(()=>t||LZ).splice(0,r.length-1)}function ok({duration:r=300,keyframes:t,times:s,ease:a="easeInOut"}){const l=aAe(a)?a.map(_K):_K(a),d={done:!1,value:t[0]},f=pAe(s&&s.length===t.length?s:hAe(t),r),E=uAe(f,t,{ease:Array.isArray(l)?l:fAe(t,l)});return{calculatedDuration:r,next:v=>(d.value=E(v),d.done=v>=r,d)}}const mAe=r=>{const t=({timestamp:s})=>r(s);return{start:()=>Bi.update(t,!0),stop:()=>lg(t),now:()=>Yo.isProcessing?Yo.timestamp:Bh.now()}},gAe={decay:gK,inertia:gK,tween:ok,keyframes:ok,spring:DZ},_Ae=r=>r/100;class gF extends PZ{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:v}=this.options;v&&v()};const{name:s,motionValue:a,element:l,keyframes:d}=this.options,f=(l==null?void 0:l.KeyframeResolver)||fF,E=(v,T)=>this.onKeyframesResolved(v,T);this.resolver=new f(d,E,s,a,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:s="keyframes",repeat:a=0,repeatDelay:l=0,repeatType:d,velocity:f=0}=this.options,E=rF(s)?s:gAe[s]||ok;let v,T;E!==ok&&typeof t[0]!="number"&&(v=PR(_Ae,kZ(t[0],t[1])),t=[0,100]);const R=E({...this.options,keyframes:t});d==="mirror"&&(T=E({...this.options,keyframes:[...t].reverse(),velocity:-f})),R.calculatedDuration===null&&(R.calculatedDuration=JQ(R));const{calculatedDuration:I}=R,N=I+l,F=N*(a+1)-l;return{generator:R,mirroredGenerator:T,mapPercentToKeyframes:v,calculatedDuration:I,resolvedDuration:N,totalDuration:F}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,s=!1){const{resolved:a}=this;if(!a){const{keyframes:Q}=this.options;return{done:!0,value:Q[Q.length-1]}}const{finalKeyframe:l,generator:d,mirroredGenerator:f,mapPercentToKeyframes:E,keyframes:v,calculatedDuration:T,totalDuration:R,resolvedDuration:I}=a;if(this.startTime===null)return d.next(0);const{delay:N,repeat:F,repeatType:j,repeatDelay:G,onUpdate:H}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-R/this.speed,this.startTime)),s?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const te=this.currentTime-N*(this.speed>=0?1:-1),K=this.speed>=0?te<0:te>R;this.currentTime=Math.max(te,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=R);let ee=this.currentTime,de=d;if(F){const Q=Math.min(this.currentTime,R)/I;let ne=Math.floor(Q),oe=Q%1;!oe&&Q>=1&&(oe=1),oe===1&&ne--,ne=Math.min(ne,F+1),!!(ne%2)&&(j==="reverse"?(oe=1-oe,G&&(oe-=G/I)):j==="mirror"&&(de=f)),ee=yf(0,1,oe)*I}const se=K?{done:!1,value:v[0]}:de.next(ee);E&&(se.value=E(se.value));let{done:ge}=se;!K&&T!==null&&(ge=this.speed>=0?this.currentTime>=R:this.currentTime<=0);const Z=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&ge);return Z&&l!==void 0&&(se.value=rN(v,this.options,l)),H&&H(se.value),Z&&this.finish(),se}get duration(){const{resolved:t}=this;return t?mf(t.calculatedDuration):0}get time(){return mf(this.currentTime)}set time(t){t=ff(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const s=this.playbackSpeed!==t;this.playbackSpeed=t,s&&(this.time=mf(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=mAe,onPlay:s,startTime:a}=this.options;this.driver||(this.driver=t(d=>this.tick(d))),s&&s();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=a??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const EAe=new Set(["opacity","clipPath","filter","transform"]);function yAe(r,t,s,{delay:a=0,duration:l=300,repeat:d=0,repeatType:f="loop",ease:E="easeInOut",times:v}={}){const T={[t]:s};v&&(T.offset=v);const R=eZ(E,l);return Array.isArray(R)&&(T.easing=R),r.animate(T,{delay:a,duration:l,easing:Array.isArray(R)?"linear":R,fill:"both",iterations:d+1,direction:f==="reverse"?"alternate":"normal"})}const vAe=WV(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),ak=10,SAe=2e4;function TAe(r){return rF(r.type)||r.type==="spring"||!ZQ(r.ease)}function bAe(r,t){const s=new gF({...t,keyframes:r,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:r[0]};const l=[];let d=0;for(;!a.done&&d<SAe;)a=s.sample(d),l.push(a.value),d+=ak;return{times:void 0,keyframes:l,duration:d-ak,ease:"linear"}}const xZ={anticipate:hZ,backInOut:dZ,circInOut:fZ};function wAe(r){return r in xZ}class EK extends PZ{constructor(t){super(t);const{name:s,motionValue:a,element:l,keyframes:d}=this.options;this.resolver=new AZ(d,(f,E)=>this.onKeyframesResolved(f,E),s,a,l),this.resolver.scheduleResolve()}initPlayback(t,s){let{duration:a=300,times:l,ease:d,type:f,motionValue:E,name:v,startTime:T}=this.options;if(!E.owner||!E.owner.current)return!1;if(typeof d=="string"&&ik()&&wAe(d)&&(d=xZ[d]),TAe(this.options)){const{onComplete:I,onUpdate:N,motionValue:F,element:j,...G}=this.options,H=bAe(t,G);t=H.keyframes,t.length===1&&(t[1]=t[0]),a=H.duration,l=H.times,d=H.ease,f="keyframes"}const R=yAe(E.owner.current,v,t,{...this.options,duration:a,times:l,ease:d});return R.startTime=T??this.calcStartTime(),this.pendingTimeline?(tK(R,this.pendingTimeline),this.pendingTimeline=void 0):R.onfinish=()=>{const{onComplete:I}=this.options;E.set(rN(t,this.options,s)),I&&I(),this.cancel(),this.resolveFinishedPromise()},{animation:R,duration:a,times:l,type:f,ease:d,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:s}=t;return mf(s)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:s}=t;return mf(s.currentTime||0)}set time(t){const{resolved:s}=this;if(!s)return;const{animation:a}=s;a.currentTime=ff(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:s}=t;return s.playbackRate}set speed(t){const{resolved:s}=this;if(!s)return;const{animation:a}=s;a.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:s}=t;return s.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:s}=t;return s.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:s}=this;if(!s)return Al;const{animation:a}=s;tK(a,t)}return Al}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.playState==="finished"&&this.updateFinishedPromise(),s.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:s}=t;s.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:s,keyframes:a,duration:l,type:d,ease:f,times:E}=t;if(s.playState==="idle"||s.playState==="finished")return;if(this.time){const{motionValue:T,onUpdate:R,onComplete:I,element:N,...F}=this.options,j=new gF({...F,keyframes:a,duration:l,type:d,ease:f,times:E,isGenerator:!0}),G=ff(this.time);T.setWithVelocity(j.sample(G-ak).value,j.sample(G).value,ak)}const{onStop:v}=this.options;v&&v(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:s,name:a,repeatDelay:l,repeatType:d,damping:f,type:E}=t;if(!s||!s.owner||!(s.owner.current instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:T}=s.owner.getProps();return vAe()&&a&&EAe.has(a)&&!v&&!T&&!l&&d!=="mirror"&&f!==0&&E!=="inertia"}}const RAe={type:"spring",stiffness:500,damping:25,restSpeed:10},CAe=r=>({type:"spring",stiffness:550,damping:r===0?2*Math.sqrt(550):30,restSpeed:10}),IAe={type:"keyframes",duration:.8},AAe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},PAe=(r,{keyframes:t})=>t.length>2?IAe:PE.has(r)?r.startsWith("scale")?CAe(t[1]):RAe:AAe;function OAe({when:r,delay:t,delayChildren:s,staggerChildren:a,staggerDirection:l,repeat:d,repeatType:f,repeatDelay:E,from:v,elapsed:T,...R}){return!!Object.keys(R).length}const _F=(r,t,s,a={},l,d)=>f=>{const E=nF(a,r)||{},v=E.delay||a.delay||0;let{elapsed:T=0}=a;T=T-ff(v);let R={keyframes:Array.isArray(s)?s:[null,s],ease:"easeOut",velocity:t.getVelocity(),...E,delay:-T,onUpdate:N=>{t.set(N),E.onUpdate&&E.onUpdate(N)},onComplete:()=>{f(),E.onComplete&&E.onComplete()},name:r,motionValue:t,element:d?void 0:l};OAe(E)||(R={...R,...PAe(r,R)}),R.duration&&(R.duration=ff(R.duration)),R.repeatDelay&&(R.repeatDelay=ff(R.repeatDelay)),R.from!==void 0&&(R.keyframes[0]=R.from);let I=!1;if((R.type===!1||R.duration===0&&!R.repeatDelay)&&(R.duration=0,R.delay===0&&(I=!0)),I&&!d&&t.get()!==void 0){const N=rN(R.keyframes,E);if(N!==void 0)return Bi.update(()=>{R.onUpdate(N),R.onComplete()}),new YCe([])}return!d&&EK.supports(R)?new EK(R):new gF(R)};function kAe({protectedKeys:r,needsAnimating:t},s){const a=r.hasOwnProperty(s)&&t[s]!==!0;return t[s]=!1,a}function MZ(r,t,{delay:s=0,transitionOverride:a,type:l}={}){var d;let{transition:f=r.getDefaultTransition(),transitionEnd:E,...v}=t;a&&(f=a);const T=[],R=l&&r.animationState&&r.animationState.getState()[l];for(const I in v){const N=r.getValue(I,(d=r.latestValues[I])!==null&&d!==void 0?d:null),F=v[I];if(F===void 0||R&&kAe(R,I))continue;const j={delay:s,...nF(f||{},I)};let G=!1;if(window.MotionHandoffAnimation){const te=oZ(r);if(te){const K=window.MotionHandoffAnimation(te,I,Bi);K!==null&&(j.startTime=K,G=!0)}}Q2(r,I),N.start(_F(I,N,F,r.shouldReduceMotion&&iZ.has(I)?{type:!1}:j,r,G));const H=N.animation;H&&T.push(H)}return E&&Promise.all(T).then(()=>{Bi.update(()=>{E&&lIe(r,E)})}),T}function sU(r,t,s={}){var a;const l=nN(r,t,s.type==="exit"?(a=r.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:d=r.getDefaultTransition()||{}}=l||{};s.transitionOverride&&(d=s.transitionOverride);const f=l?()=>Promise.all(MZ(r,l,s)):()=>Promise.resolve(),E=r.variantChildren&&r.variantChildren.size?(T=0)=>{const{delayChildren:R=0,staggerChildren:I,staggerDirection:N}=d;return NAe(r,t,R+T,I,N,s)}:()=>Promise.resolve(),{when:v}=d;if(v){const[T,R]=v==="beforeChildren"?[f,E]:[E,f];return T().then(()=>R())}else return Promise.all([f(),E(s.delay)])}function NAe(r,t,s=0,a=0,l=1,d){const f=[],E=(r.variantChildren.size-1)*a,v=l===1?(T=0)=>T*a:(T=0)=>E-T*a;return Array.from(r.variantChildren).sort(DAe).forEach((T,R)=>{T.notify("AnimationStart",t),f.push(sU(T,t,{...d,delay:s+v(R)}).then(()=>T.notify("AnimationComplete",t)))}),Promise.all(f)}function DAe(r,t){return r.sortNodePosition(t)}function LAe(r,t,s={}){r.notify("AnimationStart",t);let a;if(Array.isArray(t)){const l=t.map(d=>sU(r,d,s));a=Promise.all(l)}else if(typeof t=="string")a=sU(r,t,s);else{const l=typeof t=="function"?nN(r,t,s.custom):t;a=Promise.all(MZ(r,l,s))}return a.then(()=>{r.notify("AnimationComplete",t)})}const xAe=GV.length;function UZ(r){if(!r)return;if(!r.isControllingVariants){const s=r.parent?UZ(r.parent)||{}:{};return r.props.initial!==void 0&&(s.initial=r.props.initial),s}const t={};for(let s=0;s<xAe;s++){const a=GV[s],l=r.props[a];(eR(l)||l===!1)&&(t[a]=l)}return t}const MAe=[...zV].reverse(),UAe=zV.length;function VAe(r){return t=>Promise.all(t.map(({animation:s,options:a})=>LAe(r,s,a)))}function FAe(r){let t=VAe(r),s=yK(),a=!0;const l=v=>(T,R)=>{var I;const N=nN(r,R,v==="exit"?(I=r.presenceContext)===null||I===void 0?void 0:I.custom:void 0);if(N){const{transition:F,transitionEnd:j,...G}=N;T={...T,...G,...j}}return T};function d(v){t=v(r)}function f(v){const{props:T}=r,R=UZ(r.parent)||{},I=[],N=new Set;let F={},j=1/0;for(let H=0;H<UAe;H++){const te=MAe[H],K=s[te],ee=T[te]!==void 0?T[te]:R[te],de=eR(ee),se=te===v?K.isActive:null;se===!1&&(j=H);let ge=ee===R[te]&&ee!==T[te]&&de;if(ge&&a&&r.manuallyAnimateOnMount&&(ge=!1),K.protectedKeys={...F},!K.isActive&&se===null||!ee&&!K.prevProp||eN(ee)||typeof ee=="boolean")continue;const Z=jAe(K.prevProp,ee);let Q=Z||te===v&&K.isActive&&!ge&&de||H>j&&de,ne=!1;const oe=Array.isArray(ee)?ee:[ee];let pe=oe.reduce(l(te),{});se===!1&&(pe={});const{prevResolvedValues:he={}}=K,le={...he,...pe},Me=we=>{Q=!0,N.has(we)&&(ne=!0,N.delete(we)),K.needsAnimating[we]=!0;const Ce=r.getValue(we);Ce&&(Ce.liveStyle=!1)};for(const we in le){const Ce=pe[we],ye=he[we];if(F.hasOwnProperty(we))continue;let Ne=!1;Y2(Ce)&&Y2(ye)?Ne=!XQ(Ce,ye):Ne=Ce!==ye,Ne?Ce!=null?Me(we):N.add(we):Ce!==void 0&&N.has(we)?Me(we):K.protectedKeys[we]=!0}K.prevProp=ee,K.prevResolvedValues=pe,K.isActive&&(F={...F,...pe}),a&&r.blockInitialAnimation&&(Q=!1),Q&&(!(ge&&Z)||ne)&&I.push(...oe.map(we=>({animation:we,options:{type:te}})))}if(N.size){const H={};N.forEach(te=>{const K=r.getBaseTarget(te),ee=r.getValue(te);ee&&(ee.liveStyle=!0),H[te]=K??null}),I.push({animation:H})}let G=!!I.length;return a&&(T.initial===!1||T.initial===T.animate)&&!r.manuallyAnimateOnMount&&(G=!1),a=!1,G?t(I):Promise.resolve()}function E(v,T){var R;if(s[v].isActive===T)return Promise.resolve();(R=r.variantChildren)===null||R===void 0||R.forEach(N=>{var F;return(F=N.animationState)===null||F===void 0?void 0:F.setActive(v,T)}),s[v].isActive=T;const I=f(v);for(const N in s)s[N].protectedKeys={};return I}return{animateChanges:f,setActive:E,setAnimateFunction:d,getState:()=>s,reset:()=>{s=yK(),a=!0}}}function jAe(r,t){return typeof t=="string"?t!==r:Array.isArray(t)?!XQ(t,r):!1}function K_(r=!1){return{isActive:r,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function yK(){return{animate:K_(!0),whileInView:K_(),whileHover:K_(),whileTap:K_(),whileDrag:K_(),whileFocus:K_(),exit:K_()}}class yg{constructor(t){this.isMounted=!1,this.node=t}update(){}}class BAe extends yg{constructor(t){super(t),t.animationState||(t.animationState=FAe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();eN(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:s}=this.node.prevProps||{};t!==s&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let WAe=0;class zAe extends yg{constructor(){super(...arguments),this.id=WAe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:s}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===a)return;const l=this.node.animationState.setActive("exit",!t);s&&!t&&l.then(()=>s(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const GAe={animation:{Feature:BAe},exit:{Feature:zAe}};function iR(r,t,s,a={passive:!0}){return r.addEventListener(t,s,a),()=>r.removeEventListener(t,s)}function OR(r){return{point:{x:r.pageX,y:r.pageY}}}const HAe=r=>t=>sF(t)&&r(t,OR(t));function Dw(r,t,s,a){return iR(r,t,HAe(s),a)}const vK=(r,t)=>Math.abs(r-t);function $Ae(r,t){const s=vK(r.x,t.x),a=vK(r.y,t.y);return Math.sqrt(s**2+a**2)}class VZ{constructor(t,s,{transformPagePoint:a,contextWindow:l,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const I=GM(this.lastMoveEventInfo,this.history),N=this.startEvent!==null,F=$Ae(I.offset,{x:0,y:0})>=3;if(!N&&!F)return;const{point:j}=I,{timestamp:G}=Yo;this.history.push({...j,timestamp:G});const{onStart:H,onMove:te}=this.handlers;N||(H&&H(this.lastMoveEvent,I),this.startEvent=this.lastMoveEvent),te&&te(this.lastMoveEvent,I)},this.handlePointerMove=(I,N)=>{this.lastMoveEvent=I,this.lastMoveEventInfo=zM(N,this.transformPagePoint),Bi.update(this.updatePoint,!0)},this.handlePointerUp=(I,N)=>{this.end();const{onEnd:F,onSessionEnd:j,resumeAnimation:G}=this.handlers;if(this.dragSnapToOrigin&&G&&G(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const H=GM(I.type==="pointercancel"?this.lastMoveEventInfo:zM(N,this.transformPagePoint),this.history);this.startEvent&&F&&F(I,H),j&&j(I,H)},!sF(t))return;this.dragSnapToOrigin=d,this.handlers=s,this.transformPagePoint=a,this.contextWindow=l||window;const f=OR(t),E=zM(f,this.transformPagePoint),{point:v}=E,{timestamp:T}=Yo;this.history=[{...v,timestamp:T}];const{onSessionStart:R}=s;R&&R(t,GM(E,this.history)),this.removeListeners=PR(Dw(this.contextWindow,"pointermove",this.handlePointerMove),Dw(this.contextWindow,"pointerup",this.handlePointerUp),Dw(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),lg(this.updatePoint)}}function zM(r,t){return t?{point:t(r.point)}:r}function SK(r,t){return{x:r.x-t.x,y:r.y-t.y}}function GM({point:r},t){return{point:r,delta:SK(r,FZ(t)),offset:SK(r,KAe(t)),velocity:qAe(t,.1)}}function KAe(r){return r[0]}function FZ(r){return r[r.length-1]}function qAe(r,t){if(r.length<2)return{x:0,y:0};let s=r.length-1,a=null;const l=FZ(r);for(;s>=0&&(a=r[s],!(l.timestamp-a.timestamp>ff(t)));)s--;if(!a)return{x:0,y:0};const d=mf(l.timestamp-a.timestamp);if(d===0)return{x:0,y:0};const f={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}const jZ=1e-4,YAe=1-jZ,XAe=1+jZ,BZ=.01,JAe=0-BZ,QAe=0+BZ;function Pl(r){return r.max-r.min}function ZAe(r,t,s){return Math.abs(r-t)<=s}function TK(r,t,s,a=.5){r.origin=a,r.originPoint=ss(t.min,t.max,r.origin),r.scale=Pl(s)/Pl(t),r.translate=ss(s.min,s.max,r.origin)-r.originPoint,(r.scale>=YAe&&r.scale<=XAe||isNaN(r.scale))&&(r.scale=1),(r.translate>=JAe&&r.translate<=QAe||isNaN(r.translate))&&(r.translate=0)}function Lw(r,t,s,a){TK(r.x,t.x,s.x,a?a.originX:void 0),TK(r.y,t.y,s.y,a?a.originY:void 0)}function bK(r,t,s){r.min=s.min+t.min,r.max=r.min+Pl(t)}function ePe(r,t,s){bK(r.x,t.x,s.x),bK(r.y,t.y,s.y)}function wK(r,t,s){r.min=t.min-s.min,r.max=r.min+Pl(t)}function xw(r,t,s){wK(r.x,t.x,s.x),wK(r.y,t.y,s.y)}function tPe(r,{min:t,max:s},a){return t!==void 0&&r<t?r=a?ss(t,r,a.min):Math.max(r,t):s!==void 0&&r>s&&(r=a?ss(s,r,a.max):Math.min(r,s)),r}function RK(r,t,s){return{min:t!==void 0?r.min+t:void 0,max:s!==void 0?r.max+s-(r.max-r.min):void 0}}function nPe(r,{top:t,left:s,bottom:a,right:l}){return{x:RK(r.x,s,l),y:RK(r.y,t,a)}}function CK(r,t){let s=t.min-r.min,a=t.max-r.max;return t.max-t.min<r.max-r.min&&([s,a]=[a,s]),{min:s,max:a}}function rPe(r,t){return{x:CK(r.x,t.x),y:CK(r.y,t.y)}}function iPe(r,t){let s=.5;const a=Pl(r),l=Pl(t);return l>a?s=HS(t.min,t.max-a,r.min):a>l&&(s=HS(r.min,r.max-l,t.min)),yf(0,1,s)}function sPe(r,t){const s={};return t.min!==void 0&&(s.min=t.min-r.min),t.max!==void 0&&(s.max=t.max-r.min),s}const oU=.35;function oPe(r=oU){return r===!1?r=0:r===!0&&(r=oU),{x:IK(r,"left","right"),y:IK(r,"top","bottom")}}function IK(r,t,s){return{min:AK(r,t),max:AK(r,s)}}function AK(r,t){return typeof r=="number"?r:r[t]||0}const PK=()=>({translate:0,scale:1,origin:0,originPoint:0}),yS=()=>({x:PK(),y:PK()}),OK=()=>({min:0,max:0}),ks=()=>({x:OK(),y:OK()});function _u(r){return[r("x"),r("y")]}function WZ({top:r,left:t,right:s,bottom:a}){return{x:{min:t,max:s},y:{min:r,max:a}}}function aPe({x:r,y:t}){return{top:t.min,right:r.max,bottom:t.max,left:r.min}}function cPe(r,t){if(!t)return r;const s=t({x:r.left,y:r.top}),a=t({x:r.right,y:r.bottom});return{top:s.y,left:s.x,bottom:a.y,right:a.x}}function HM(r){return r===void 0||r===1}function aU({scale:r,scaleX:t,scaleY:s}){return!HM(r)||!HM(t)||!HM(s)}function Y_(r){return aU(r)||zZ(r)||r.z||r.rotate||r.rotateX||r.rotateY||r.skewX||r.skewY}function zZ(r){return kK(r.x)||kK(r.y)}function kK(r){return r&&r!=="0%"}function ck(r,t,s){const a=r-s,l=t*a;return s+l}function NK(r,t,s,a,l){return l!==void 0&&(r=ck(r,l,a)),ck(r,s,a)+t}function cU(r,t=0,s=1,a,l){r.min=NK(r.min,t,s,a,l),r.max=NK(r.max,t,s,a,l)}function GZ(r,{x:t,y:s}){cU(r.x,t.translate,t.scale,t.originPoint),cU(r.y,s.translate,s.scale,s.originPoint)}const DK=.999999999999,LK=1.0000000000001;function lPe(r,t,s,a=!1){const l=s.length;if(!l)return;t.x=t.y=1;let d,f;for(let E=0;E<l;E++){d=s[E],f=d.projectionDelta;const{visualElement:v}=d.options;v&&v.props.style&&v.props.style.display==="contents"||(a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&SS(r,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),f&&(t.x*=f.x.scale,t.y*=f.y.scale,GZ(r,f)),a&&Y_(d.latestValues)&&SS(r,d.latestValues))}t.x<LK&&t.x>DK&&(t.x=1),t.y<LK&&t.y>DK&&(t.y=1)}function vS(r,t){r.min=r.min+t,r.max=r.max+t}function xK(r,t,s,a,l=.5){const d=ss(r.min,r.max,l);cU(r,t,s,d,a)}function SS(r,t){xK(r.x,t.x,t.scaleX,t.scale,t.originX),xK(r.y,t.y,t.scaleY,t.scale,t.originY)}function HZ(r,t){return WZ(cPe(r.getBoundingClientRect(),t))}function uPe(r,t,s){const a=HZ(r,s),{scroll:l}=t;return l&&(vS(a.x,l.offset.x),vS(a.y,l.offset.y)),a}const $Z=({current:r})=>r?r.ownerDocument.defaultView:null,dPe=new WeakMap;class hPe{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ks(),this.visualElement=t}start(t,{snapToCursor:s=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const l=R=>{const{dragSnapToOrigin:I}=this.getProps();I?this.pauseAnimation():this.stopAnimation(),s&&this.snapToCursor(OR(R).point)},d=(R,I)=>{const{drag:N,dragPropagation:F,onDragStart:j}=this.getProps();if(N&&!F&&(this.openDragLock&&this.openDragLock(),this.openDragLock=iIe(N),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),_u(H=>{let te=this.getAxisMotionValue(H).get()||0;if(jh.test(te)){const{projection:K}=this.visualElement;if(K&&K.layout){const ee=K.layout.layoutBox[H];ee&&(te=Pl(ee)*(parseFloat(te)/100))}}this.originPoint[H]=te}),j&&Bi.postRender(()=>j(R,I)),Q2(this.visualElement,"transform");const{animationState:G}=this.visualElement;G&&G.setActive("whileDrag",!0)},f=(R,I)=>{const{dragPropagation:N,dragDirectionLock:F,onDirectionLock:j,onDrag:G}=this.getProps();if(!N&&!this.openDragLock)return;const{offset:H}=I;if(F&&this.currentDirection===null){this.currentDirection=pPe(H),this.currentDirection!==null&&j&&j(this.currentDirection);return}this.updateAxis("x",I.point,H),this.updateAxis("y",I.point,H),this.visualElement.render(),G&&G(R,I)},E=(R,I)=>this.stop(R,I),v=()=>_u(R=>{var I;return this.getAnimationState(R)==="paused"&&((I=this.getAxisMotionValue(R).animation)===null||I===void 0?void 0:I.play())}),{dragSnapToOrigin:T}=this.getProps();this.panSession=new VZ(t,{onSessionStart:l,onStart:d,onMove:f,onSessionEnd:E,resumeAnimation:v},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:T,contextWindow:$Z(this.visualElement)})}stop(t,s){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:l}=s;this.startAnimation(l);const{onDragEnd:d}=this.getProps();d&&Bi.postRender(()=>d(t,s))}cancel(){this.isDragging=!1;const{projection:t,animationState:s}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),s&&s.setActive("whileDrag",!1)}updateAxis(t,s,a){const{drag:l}=this.getProps();if(!a||!JP(t,l,this.currentDirection))return;const d=this.getAxisMotionValue(t);let f=this.originPoint[t]+a[t];this.constraints&&this.constraints[t]&&(f=tPe(f,this.constraints[t],this.elastic[t])),d.set(f)}resolveConstraints(){var t;const{dragConstraints:s,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,d=this.constraints;s&&_S(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&l?this.constraints=nPe(l.layoutBox,s):this.constraints=!1,this.elastic=oPe(a),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&_u(f=>{this.constraints!==!1&&this.getAxisMotionValue(f)&&(this.constraints[f]=sPe(l.layoutBox[f],this.constraints[f]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:s}=this.getProps();if(!t||!_S(t))return!1;const a=t.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=uPe(a,l.root,this.visualElement.getTransformPagePoint());let f=rPe(l.layout.layoutBox,d);if(s){const E=s(aPe(f));this.hasMutatedConstraints=!!E,E&&(f=WZ(E))}return f}startAnimation(t){const{drag:s,dragMomentum:a,dragElastic:l,dragTransition:d,dragSnapToOrigin:f,onDragTransitionEnd:E}=this.getProps(),v=this.constraints||{},T=_u(R=>{if(!JP(R,s,this.currentDirection))return;let I=v&&v[R]||{};f&&(I={min:0,max:0});const N=l?200:1e6,F=l?40:1e7,j={type:"inertia",velocity:a?t[R]:0,bounceStiffness:N,bounceDamping:F,timeConstant:750,restDelta:1,restSpeed:10,...d,...I};return this.startAxisValueAnimation(R,j)});return Promise.all(T).then(E)}startAxisValueAnimation(t,s){const a=this.getAxisMotionValue(t);return Q2(this.visualElement,t),a.start(_F(t,a,0,s,this.visualElement,!1))}stopAnimation(){_u(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){_u(t=>{var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.pause()})}getAnimationState(t){var s;return(s=this.getAxisMotionValue(t).animation)===null||s===void 0?void 0:s.state}getAxisMotionValue(t){const s=`_drag${t.toUpperCase()}`,a=this.visualElement.getProps(),l=a[s];return l||this.visualElement.getValue(t,(a.initial?a.initial[t]:void 0)||0)}snapToCursor(t){_u(s=>{const{drag:a}=this.getProps();if(!JP(s,a,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(s);if(l&&l.layout){const{min:f,max:E}=l.layout.layoutBox[s];d.set(t[s]-ss(f,E,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:s}=this.getProps(),{projection:a}=this.visualElement;if(!_S(s)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};_u(f=>{const E=this.getAxisMotionValue(f);if(E&&this.constraints!==!1){const v=E.get();l[f]=iPe({min:v,max:v},this.constraints[f])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),_u(f=>{if(!JP(f,t,null))return;const E=this.getAxisMotionValue(f),{min:v,max:T}=this.constraints[f];E.set(ss(v,T,l[f]))})}addListeners(){if(!this.visualElement.current)return;dPe.set(this.visualElement,this);const t=this.visualElement.current,s=Dw(t,"pointerdown",v=>{const{drag:T,dragListener:R=!0}=this.getProps();T&&R&&this.start(v)}),a=()=>{const{dragConstraints:v}=this.getProps();_S(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),Bi.read(a);const f=iR(window,"resize",()=>this.scalePositionWithinConstraints()),E=l.addEventListener("didUpdate",({delta:v,hasLayoutChanged:T})=>{this.isDragging&&T&&(_u(R=>{const I=this.getAxisMotionValue(R);I&&(this.originPoint[R]+=v[R].translate,I.set(I.get()+v[R].translate))}),this.visualElement.render())});return()=>{f(),s(),d(),E&&E()}}getProps(){const t=this.visualElement.getProps(),{drag:s=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:f=oU,dragMomentum:E=!0}=t;return{...t,drag:s,dragDirectionLock:a,dragPropagation:l,dragConstraints:d,dragElastic:f,dragMomentum:E}}}function JP(r,t,s){return(t===!0||t===r)&&(s===null||s===r)}function pPe(r,t=10){let s=null;return Math.abs(r.y)>t?s="y":Math.abs(r.x)>t&&(s="x"),s}class fPe extends yg{constructor(t){super(t),this.removeGroupControls=Al,this.removeListeners=Al,this.controls=new hPe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Al}unmount(){this.removeGroupControls(),this.removeListeners()}}const MK=r=>(t,s)=>{r&&Bi.postRender(()=>r(t,s))};class mPe extends yg{constructor(){super(...arguments),this.removePointerDownListener=Al}onPointerDown(t){this.session=new VZ(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:$Z(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:s,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:MK(t),onStart:MK(s),onMove:a,onEnd:(d,f)=>{delete this.session,l&&Bi.postRender(()=>l(d,f))}}}mount(){this.removePointerDownListener=Dw(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const PO={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function UK(r,t){return t.max===t.min?0:r/(t.max-t.min)*100}const Kb={correct:(r,t)=>{if(!t.target)return r;if(typeof r=="string")if(Nn.test(r))r=parseFloat(r);else return r;const s=UK(r,t.target.x),a=UK(r,t.target.y);return`${s}% ${a}%`}},gPe={correct:(r,{treeScale:t,projectionDelta:s})=>{const a=r,l=ug.parse(r);if(l.length>5)return a;const d=ug.createTransformer(r),f=typeof l[0]!="number"?1:0,E=s.x.scale*t.x,v=s.y.scale*t.y;l[0+f]/=E,l[1+f]/=v;const T=ss(E,v,.5);return typeof l[2+f]=="number"&&(l[2+f]/=T),typeof l[3+f]=="number"&&(l[3+f]/=T),d(l)}};class _Pe extends L.Component{componentDidMount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:a,layoutId:l}=this.props,{projection:d}=t;UCe(EPe),d&&(s.group&&s.group.add(d),a&&a.register&&l&&a.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),PO.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:s,visualElement:a,drag:l,isPresent:d}=this.props,f=a.projection;return f&&(f.isPresent=d,l||t.layoutDependency!==s||s===void 0?f.willUpdate():this.safeToRemove(),t.isPresent!==d&&(d?f.promote():f.relegate()||Bi.postRender(()=>{const E=f.getStack();(!E||!E.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),$V.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:s,switchLayoutGroup:a}=this.props,{projection:l}=t;l&&(l.scheduleCheckAfterUnmount(),s&&s.group&&s.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function KZ(r){const[t,s]=jV(),a=L.useContext(UV);return P.jsx(_Pe,{...r,layoutGroup:a,switchLayoutGroup:L.useContext(UQ),isPresent:t,safeToRemove:s})}const EPe={borderRadius:{...Kb,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Kb,borderTopRightRadius:Kb,borderBottomLeftRadius:Kb,borderBottomRightRadius:Kb,boxShadow:gPe};function yPe(r,t,s){const a=ka(r)?r:nR(r);return a.start(_F("",a,t,s)),a.animation}function vPe(r){return r instanceof SVGElement&&r.tagName!=="svg"}const SPe=(r,t)=>r.depth-t.depth;class TPe{constructor(){this.children=[],this.isDirty=!1}add(t){oF(this.children,t),this.isDirty=!0}remove(t){aF(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(SPe),this.isDirty=!1,this.children.forEach(t)}}function bPe(r,t){const s=Bh.now(),a=({timestamp:l})=>{const d=l-s;d>=t&&(lg(a),r(d-t))};return Bi.read(a,!0),()=>lg(a)}const qZ=["TopLeft","TopRight","BottomLeft","BottomRight"],wPe=qZ.length,VK=r=>typeof r=="string"?parseFloat(r):r,FK=r=>typeof r=="number"||Nn.test(r);function RPe(r,t,s,a,l,d){l?(r.opacity=ss(0,s.opacity!==void 0?s.opacity:1,CPe(a)),r.opacityExit=ss(t.opacity!==void 0?t.opacity:1,0,IPe(a))):d&&(r.opacity=ss(t.opacity!==void 0?t.opacity:1,s.opacity!==void 0?s.opacity:1,a));for(let f=0;f<wPe;f++){const E=`border${qZ[f]}Radius`;let v=jK(t,E),T=jK(s,E);if(v===void 0&&T===void 0)continue;v||(v=0),T||(T=0),v===0||T===0||FK(v)===FK(T)?(r[E]=Math.max(ss(VK(v),VK(T),a),0),(jh.test(T)||jh.test(v))&&(r[E]+="%")):r[E]=T}(t.rotate||s.rotate)&&(r.rotate=ss(t.rotate||0,s.rotate||0,a))}function jK(r,t){return r[t]!==void 0?r[t]:r.borderRadius}const CPe=YZ(0,.5,pZ),IPe=YZ(.5,.95,Al);function YZ(r,t,s){return a=>a<r?0:a>t?1:s(HS(r,t,a))}function BK(r,t){r.min=t.min,r.max=t.max}function fu(r,t){BK(r.x,t.x),BK(r.y,t.y)}function WK(r,t){r.translate=t.translate,r.scale=t.scale,r.originPoint=t.originPoint,r.origin=t.origin}function zK(r,t,s,a,l){return r-=t,r=ck(r,1/s,a),l!==void 0&&(r=ck(r,1/l,a)),r}function APe(r,t=0,s=1,a=.5,l,d=r,f=r){if(jh.test(t)&&(t=parseFloat(t),t=ss(f.min,f.max,t/100)-f.min),typeof t!="number")return;let E=ss(d.min,d.max,a);r===d&&(E-=t),r.min=zK(r.min,t,s,E,l),r.max=zK(r.max,t,s,E,l)}function GK(r,t,[s,a,l],d,f){APe(r,t[s],t[a],t[l],t.scale,d,f)}const PPe=["x","scaleX","originX"],OPe=["y","scaleY","originY"];function HK(r,t,s,a){GK(r.x,t,PPe,s?s.x:void 0,a?a.x:void 0),GK(r.y,t,OPe,s?s.y:void 0,a?a.y:void 0)}function $K(r){return r.translate===0&&r.scale===1}function XZ(r){return $K(r.x)&&$K(r.y)}function KK(r,t){return r.min===t.min&&r.max===t.max}function kPe(r,t){return KK(r.x,t.x)&&KK(r.y,t.y)}function qK(r,t){return Math.round(r.min)===Math.round(t.min)&&Math.round(r.max)===Math.round(t.max)}function JZ(r,t){return qK(r.x,t.x)&&qK(r.y,t.y)}function YK(r){return Pl(r.x)/Pl(r.y)}function XK(r,t){return r.translate===t.translate&&r.scale===t.scale&&r.originPoint===t.originPoint}class NPe{constructor(){this.members=[]}add(t){oF(this.members,t),t.scheduleRender()}remove(t){if(aF(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const s=this.members[this.members.length-1];s&&this.promote(s)}}relegate(t){const s=this.members.findIndex(l=>t===l);if(s===0)return!1;let a;for(let l=s;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){a=d;break}}return a?(this.promote(a),!0):!1}promote(t,s){const a=this.lead;if(t!==a&&(this.prevLead=a,this.lead=t,t.show(),a)){a.instance&&a.scheduleRender(),t.scheduleRender(),t.resumeFrom=a,s&&(t.resumeFrom.preserveOpacity=!0),a.snapshot&&(t.snapshot=a.snapshot,t.snapshot.latestValues=a.animationValues||a.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:l}=t.options;l===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:s,resumingFrom:a}=t;s.onExitComplete&&s.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function DPe(r,t,s){let a="";const l=r.x.translate/t.x,d=r.y.translate/t.y,f=(s==null?void 0:s.z)||0;if((l||d||f)&&(a=`translate3d(${l}px, ${d}px, ${f}px) `),(t.x!==1||t.y!==1)&&(a+=`scale(${1/t.x}, ${1/t.y}) `),s){const{transformPerspective:T,rotate:R,rotateX:I,rotateY:N,skewX:F,skewY:j}=s;T&&(a=`perspective(${T}px) ${a}`),R&&(a+=`rotate(${R}deg) `),I&&(a+=`rotateX(${I}deg) `),N&&(a+=`rotateY(${N}deg) `),F&&(a+=`skewX(${F}deg) `),j&&(a+=`skewY(${j}deg) `)}const E=r.x.scale*t.x,v=r.y.scale*t.y;return(E!==1||v!==1)&&(a+=`scale(${E}, ${v})`),a||"none"}const X_={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},gw=typeof window<"u"&&window.MotionDebug!==void 0,$M=["","X","Y","Z"],LPe={visibility:"hidden"},JK=1e3;let xPe=0;function KM(r,t,s,a){const{latestValues:l}=t;l[r]&&(s[r]=l[r],t.setStaticValue(r,0),a&&(a[r]=0))}function QZ(r){if(r.hasCheckedOptimisedAppear=!0,r.root===r)return;const{visualElement:t}=r.options;if(!t)return;const s=oZ(t);if(window.MotionHasOptimisedAnimation(s,"transform")){const{layout:l,layoutId:d}=r.options;window.MotionCancelOptimisedAnimation(s,"transform",Bi,!(l||d))}const{parent:a}=r;a&&!a.hasCheckedOptimisedAppear&&QZ(a)}function ZZ({attachResizeListener:r,defaultParent:t,measureScroll:s,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(f={},E=t==null?void 0:t()){this.id=xPe++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,gw&&(X_.totalNodes=X_.resolvedTargetDeltas=X_.recalculatedProjection=0),this.nodes.forEach(VPe),this.nodes.forEach(zPe),this.nodes.forEach(GPe),this.nodes.forEach(FPe),gw&&window.MotionDebug.record(X_)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=f,this.root=E?E.root||E:this,this.path=E?[...E.path,E]:[],this.parent=E,this.depth=E?E.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new TPe)}addEventListener(f,E){return this.eventHandlers.has(f)||this.eventHandlers.set(f,new cF),this.eventHandlers.get(f).add(E)}notifyListeners(f,...E){const v=this.eventHandlers.get(f);v&&v.notify(...E)}hasListeners(f){return this.eventHandlers.has(f)}mount(f,E=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=vPe(f),this.instance=f;const{layoutId:v,layout:T,visualElement:R}=this.options;if(R&&!R.current&&R.mount(f),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),E&&(T||v)&&(this.isLayoutDirty=!0),r){let I;const N=()=>this.root.updateBlockedByResize=!1;r(f,()=>{this.root.updateBlockedByResize=!0,I&&I(),I=bPe(N,250),PO.hasAnimatedSinceResize&&(PO.hasAnimatedSinceResize=!1,this.nodes.forEach(ZK))})}v&&this.root.registerSharedNode(v,this),this.options.animate!==!1&&R&&(v||T)&&this.addEventListener("didUpdate",({delta:I,hasLayoutChanged:N,hasRelativeTargetChanged:F,layout:j})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const G=this.options.transition||R.getDefaultTransition()||YPe,{onLayoutAnimationStart:H,onLayoutAnimationComplete:te}=R.getProps(),K=!this.targetLayout||!JZ(this.targetLayout,j)||F,ee=!N&&F;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||ee||N&&(K||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(I,ee);const de={...nF(G,"layout"),onPlay:H,onComplete:te};(R.shouldReduceMotion||this.options.layoutRoot)&&(de.delay=0,de.type=!1),this.startAnimation(de)}else N||ZK(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=j})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const f=this.getStack();f&&f.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,lg(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(HPe),this.animationId++)}getTransformTemplate(){const{visualElement:f}=this.options;return f&&f.getProps().transformTemplate}willUpdate(f=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&QZ(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let R=0;R<this.path.length;R++){const I=this.path[R];I.shouldResetTransform=!0,I.updateScroll("snapshot"),I.options.layoutRoot&&I.willUpdate(!1)}const{layoutId:E,layout:v}=this.options;if(E===void 0&&!v)return;const T=this.getTransformTemplate();this.prevTransformTemplateValue=T?T(this.latestValues,""):void 0,this.updateSnapshot(),f&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(QK);return}this.isUpdating||this.nodes.forEach(BPe),this.isUpdating=!1,this.nodes.forEach(WPe),this.nodes.forEach(MPe),this.nodes.forEach(UPe),this.clearAllSnapshots();const E=Bh.now();Yo.delta=yf(0,1e3/60,E-Yo.timestamp),Yo.timestamp=E,Yo.isProcessing=!0,VM.update.process(Yo),VM.preRender.process(Yo),VM.render.process(Yo),Yo.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,$V.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(jPe),this.sharedNodes.forEach($Pe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Bi.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Bi.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const f=this.layout;this.layout=this.measure(!1),this.layoutCorrected=ks(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:E}=this.options;E&&E.notify("LayoutMeasure",this.layout.layoutBox,f?f.layoutBox:void 0)}updateScroll(f="measure"){let E=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===f&&(E=!1),E){const v=a(this.instance);this.scroll={animationId:this.root.animationId,phase:f,isRoot:v,offset:s(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!l)return;const f=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,E=this.projectionDelta&&!XZ(this.projectionDelta),v=this.getTransformTemplate(),T=v?v(this.latestValues,""):void 0,R=T!==this.prevTransformTemplateValue;f&&(E||Y_(this.latestValues)||R)&&(l(this.instance,T),this.shouldResetTransform=!1,this.scheduleRender())}measure(f=!0){const E=this.measurePageBox();let v=this.removeElementScroll(E);return f&&(v=this.removeTransform(v)),XPe(v),{animationId:this.root.animationId,measuredBox:E,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){var f;const{visualElement:E}=this.options;if(!E)return ks();const v=E.measureViewportBox();if(!(((f=this.scroll)===null||f===void 0?void 0:f.wasRoot)||this.path.some(JPe))){const{scroll:R}=this.root;R&&(vS(v.x,R.offset.x),vS(v.y,R.offset.y))}return v}removeElementScroll(f){var E;const v=ks();if(fu(v,f),!((E=this.scroll)===null||E===void 0)&&E.wasRoot)return v;for(let T=0;T<this.path.length;T++){const R=this.path[T],{scroll:I,options:N}=R;R!==this.root&&I&&N.layoutScroll&&(I.wasRoot&&fu(v,f),vS(v.x,I.offset.x),vS(v.y,I.offset.y))}return v}applyTransform(f,E=!1){const v=ks();fu(v,f);for(let T=0;T<this.path.length;T++){const R=this.path[T];!E&&R.options.layoutScroll&&R.scroll&&R!==R.root&&SS(v,{x:-R.scroll.offset.x,y:-R.scroll.offset.y}),Y_(R.latestValues)&&SS(v,R.latestValues)}return Y_(this.latestValues)&&SS(v,this.latestValues),v}removeTransform(f){const E=ks();fu(E,f);for(let v=0;v<this.path.length;v++){const T=this.path[v];if(!T.instance||!Y_(T.latestValues))continue;aU(T.latestValues)&&T.updateSnapshot();const R=ks(),I=T.measurePageBox();fu(R,I),HK(E,T.latestValues,T.snapshot?T.snapshot.layoutBox:void 0,R)}return Y_(this.latestValues)&&HK(E,this.latestValues),E}setTargetDelta(f){this.targetDelta=f,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(f){this.options={...this.options,...f,crossfade:f.crossfade!==void 0?f.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Yo.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(f=!1){var E;const v=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=v.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=v.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=v.isSharedProjectionDirty);const T=!!this.resumingFrom||this!==v;if(!(f||T&&this.isSharedProjectionDirty||this.isProjectionDirty||!((E=this.parent)===null||E===void 0)&&E.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:I,layoutId:N}=this.options;if(!(!this.layout||!(I||N))){if(this.resolvedRelativeTargetAt=Yo.timestamp,!this.targetDelta&&!this.relativeTarget){const F=this.getClosestProjectingParent();F&&F.layout&&this.animationProgress!==1?(this.relativeParent=F,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ks(),this.relativeTargetOrigin=ks(),xw(this.relativeTargetOrigin,this.layout.layoutBox,F.layout.layoutBox),fu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=ks(),this.targetWithTransforms=ks()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),ePe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):fu(this.target,this.layout.layoutBox),GZ(this.target,this.targetDelta)):fu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const F=this.getClosestProjectingParent();F&&!!F.resumingFrom==!!this.resumingFrom&&!F.options.layoutScroll&&F.target&&this.animationProgress!==1?(this.relativeParent=F,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ks(),this.relativeTargetOrigin=ks(),xw(this.relativeTargetOrigin,this.target,F.target),fu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}gw&&X_.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||aU(this.parent.latestValues)||zZ(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var f;const E=this.getLead(),v=!!this.resumingFrom||this!==E;let T=!0;if((this.isProjectionDirty||!((f=this.parent)===null||f===void 0)&&f.isProjectionDirty)&&(T=!1),v&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(T=!1),this.resolvedRelativeTargetAt===Yo.timestamp&&(T=!1),T)return;const{layout:R,layoutId:I}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(R||I))return;fu(this.layoutCorrected,this.layout.layoutBox);const N=this.treeScale.x,F=this.treeScale.y;lPe(this.layoutCorrected,this.treeScale,this.path,v),E.layout&&!E.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(E.target=E.layout.layoutBox,E.targetWithTransforms=ks());const{target:j}=E;if(!j){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(WK(this.prevProjectionDelta.x,this.projectionDelta.x),WK(this.prevProjectionDelta.y,this.projectionDelta.y)),Lw(this.projectionDelta,this.layoutCorrected,j,this.latestValues),(this.treeScale.x!==N||this.treeScale.y!==F||!XK(this.projectionDelta.x,this.prevProjectionDelta.x)||!XK(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",j)),gw&&X_.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(f=!0){var E;if((E=this.options.visualElement)===null||E===void 0||E.scheduleRender(),f){const v=this.getStack();v&&v.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=yS(),this.projectionDelta=yS(),this.projectionDeltaWithTransform=yS()}setAnimationOrigin(f,E=!1){const v=this.snapshot,T=v?v.latestValues:{},R={...this.latestValues},I=yS();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!E;const N=ks(),F=v?v.source:void 0,j=this.layout?this.layout.source:void 0,G=F!==j,H=this.getStack(),te=!H||H.members.length<=1,K=!!(G&&!te&&this.options.crossfade===!0&&!this.path.some(qPe));this.animationProgress=0;let ee;this.mixTargetDelta=de=>{const se=de/1e3;eq(I.x,f.x,se),eq(I.y,f.y,se),this.setTargetDelta(I),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(xw(N,this.layout.layoutBox,this.relativeParent.layout.layoutBox),KPe(this.relativeTarget,this.relativeTargetOrigin,N,se),ee&&kPe(this.relativeTarget,ee)&&(this.isProjectionDirty=!1),ee||(ee=ks()),fu(ee,this.relativeTarget)),G&&(this.animationValues=R,RPe(R,T,this.latestValues,se,K,te)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=se},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(f){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(lg(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Bi.update(()=>{PO.hasAnimatedSinceResize=!0,this.currentAnimation=yPe(0,JK,{...f,onUpdate:E=>{this.mixTargetDelta(E),f.onUpdate&&f.onUpdate(E)},onComplete:()=>{f.onComplete&&f.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const f=this.getStack();f&&f.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(JK),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const f=this.getLead();let{targetWithTransforms:E,target:v,layout:T,latestValues:R}=f;if(!(!E||!v||!T)){if(this!==f&&this.layout&&T&&eee(this.options.animationType,this.layout.layoutBox,T.layoutBox)){v=this.target||ks();const I=Pl(this.layout.layoutBox.x);v.x.min=f.target.x.min,v.x.max=v.x.min+I;const N=Pl(this.layout.layoutBox.y);v.y.min=f.target.y.min,v.y.max=v.y.min+N}fu(E,v),SS(E,R),Lw(this.projectionDeltaWithTransform,this.layoutCorrected,E,R)}}registerSharedNode(f,E){this.sharedNodes.has(f)||this.sharedNodes.set(f,new NPe),this.sharedNodes.get(f).add(E);const T=E.options.initialPromotionConfig;E.promote({transition:T?T.transition:void 0,preserveFollowOpacity:T&&T.shouldPreserveFollowOpacity?T.shouldPreserveFollowOpacity(E):void 0})}isLead(){const f=this.getStack();return f?f.lead===this:!0}getLead(){var f;const{layoutId:E}=this.options;return E?((f=this.getStack())===null||f===void 0?void 0:f.lead)||this:this}getPrevLead(){var f;const{layoutId:E}=this.options;return E?(f=this.getStack())===null||f===void 0?void 0:f.prevLead:void 0}getStack(){const{layoutId:f}=this.options;if(f)return this.root.sharedNodes.get(f)}promote({needsReset:f,transition:E,preserveFollowOpacity:v}={}){const T=this.getStack();T&&T.promote(this,v),f&&(this.projectionDelta=void 0,this.needsReset=!0),E&&this.setOptions({transition:E})}relegate(){const f=this.getStack();return f?f.relegate(this):!1}resetSkewAndRotation(){const{visualElement:f}=this.options;if(!f)return;let E=!1;const{latestValues:v}=f;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(E=!0),!E)return;const T={};v.z&&KM("z",f,T,this.animationValues);for(let R=0;R<$M.length;R++)KM(`rotate${$M[R]}`,f,T,this.animationValues),KM(`skew${$M[R]}`,f,T,this.animationValues);f.render();for(const R in T)f.setStaticValue(R,T[R]),this.animationValues&&(this.animationValues[R]=T[R]);f.scheduleRender()}getProjectionStyles(f){var E,v;if(!this.instance||this.isSVG)return;if(!this.isVisible)return LPe;const T={visibility:""},R=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,T.opacity="",T.pointerEvents=IO(f==null?void 0:f.pointerEvents)||"",T.transform=R?R(this.latestValues,""):"none",T;const I=this.getLead();if(!this.projectionDelta||!this.layout||!I.target){const G={};return this.options.layoutId&&(G.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,G.pointerEvents=IO(f==null?void 0:f.pointerEvents)||""),this.hasProjected&&!Y_(this.latestValues)&&(G.transform=R?R({},""):"none",this.hasProjected=!1),G}const N=I.animationValues||I.latestValues;this.applyTransformsToTarget(),T.transform=DPe(this.projectionDeltaWithTransform,this.treeScale,N),R&&(T.transform=R(N,T.transform));const{x:F,y:j}=this.projectionDelta;T.transformOrigin=`${F.origin*100}% ${j.origin*100}% 0`,I.animationValues?T.opacity=I===this?(v=(E=N.opacity)!==null&&E!==void 0?E:this.latestValues.opacity)!==null&&v!==void 0?v:1:this.preserveOpacity?this.latestValues.opacity:N.opacityExit:T.opacity=I===this?N.opacity!==void 0?N.opacity:"":N.opacityExit!==void 0?N.opacityExit:0;for(const G in rk){if(N[G]===void 0)continue;const{correct:H,applyTo:te}=rk[G],K=T.transform==="none"?N[G]:H(N[G],I);if(te){const ee=te.length;for(let de=0;de<ee;de++)T[te[de]]=K}else T[G]=K}return this.options.layoutId&&(T.pointerEvents=I===this?IO(f==null?void 0:f.pointerEvents)||"":"none"),T}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(f=>{var E;return(E=f.currentAnimation)===null||E===void 0?void 0:E.stop()}),this.root.nodes.forEach(QK),this.root.sharedNodes.clear()}}}function MPe(r){r.updateLayout()}function UPe(r){var t;const s=((t=r.resumeFrom)===null||t===void 0?void 0:t.snapshot)||r.snapshot;if(r.isLead()&&r.layout&&s&&r.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:l}=r.layout,{animationType:d}=r.options,f=s.source!==r.layout.source;d==="size"?_u(I=>{const N=f?s.measuredBox[I]:s.layoutBox[I],F=Pl(N);N.min=a[I].min,N.max=N.min+F}):eee(d,s.layoutBox,a)&&_u(I=>{const N=f?s.measuredBox[I]:s.layoutBox[I],F=Pl(a[I]);N.max=N.min+F,r.relativeTarget&&!r.currentAnimation&&(r.isProjectionDirty=!0,r.relativeTarget[I].max=r.relativeTarget[I].min+F)});const E=yS();Lw(E,a,s.layoutBox);const v=yS();f?Lw(v,r.applyTransform(l,!0),s.measuredBox):Lw(v,a,s.layoutBox);const T=!XZ(E);let R=!1;if(!r.resumeFrom){const I=r.getClosestProjectingParent();if(I&&!I.resumeFrom){const{snapshot:N,layout:F}=I;if(N&&F){const j=ks();xw(j,s.layoutBox,N.layoutBox);const G=ks();xw(G,a,F.layoutBox),JZ(j,G)||(R=!0),I.options.layoutRoot&&(r.relativeTarget=G,r.relativeTargetOrigin=j,r.relativeParent=I)}}}r.notifyListeners("didUpdate",{layout:a,snapshot:s,delta:v,layoutDelta:E,hasLayoutChanged:T,hasRelativeTargetChanged:R})}else if(r.isLead()){const{onExitComplete:a}=r.options;a&&a()}r.options.transition=void 0}function VPe(r){gw&&X_.totalNodes++,r.parent&&(r.isProjecting()||(r.isProjectionDirty=r.parent.isProjectionDirty),r.isSharedProjectionDirty||(r.isSharedProjectionDirty=!!(r.isProjectionDirty||r.parent.isProjectionDirty||r.parent.isSharedProjectionDirty)),r.isTransformDirty||(r.isTransformDirty=r.parent.isTransformDirty))}function FPe(r){r.isProjectionDirty=r.isSharedProjectionDirty=r.isTransformDirty=!1}function jPe(r){r.clearSnapshot()}function QK(r){r.clearMeasurements()}function BPe(r){r.isLayoutDirty=!1}function WPe(r){const{visualElement:t}=r.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),r.resetTransform()}function ZK(r){r.finishAnimation(),r.targetDelta=r.relativeTarget=r.target=void 0,r.isProjectionDirty=!0}function zPe(r){r.resolveTargetDelta()}function GPe(r){r.calcProjection()}function HPe(r){r.resetSkewAndRotation()}function $Pe(r){r.removeLeadSnapshot()}function eq(r,t,s){r.translate=ss(t.translate,0,s),r.scale=ss(t.scale,1,s),r.origin=t.origin,r.originPoint=t.originPoint}function tq(r,t,s,a){r.min=ss(t.min,s.min,a),r.max=ss(t.max,s.max,a)}function KPe(r,t,s,a){tq(r.x,t.x,s.x,a),tq(r.y,t.y,s.y,a)}function qPe(r){return r.animationValues&&r.animationValues.opacityExit!==void 0}const YPe={duration:.45,ease:[.4,0,.1,1]},nq=r=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(r),rq=nq("applewebkit/")&&!nq("chrome/")?Math.round:Al;function iq(r){r.min=rq(r.min),r.max=rq(r.max)}function XPe(r){iq(r.x),iq(r.y)}function eee(r,t,s){return r==="position"||r==="preserve-aspect"&&!ZAe(YK(t),YK(s),.2)}function JPe(r){var t;return r!==r.root&&((t=r.scroll)===null||t===void 0?void 0:t.wasRoot)}const QPe=ZZ({attachResizeListener:(r,t)=>iR(r,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),qM={current:void 0},tee=ZZ({measureScroll:r=>({x:r.scrollLeft,y:r.scrollTop}),defaultParent:()=>{if(!qM.current){const r=new QPe({});r.mount(window),r.setOptions({layoutScroll:!0}),qM.current=r}return qM.current},resetTransform:(r,t)=>{r.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:r=>window.getComputedStyle(r).position==="fixed"}),ZPe={pan:{Feature:mPe},drag:{Feature:fPe,ProjectionNode:tee,MeasureLayout:KZ}};function sq(r,t,s){const{props:a}=r;r.animationState&&a.whileHover&&r.animationState.setActive("whileHover",s==="Start");const l="onHover"+s,d=a[l];d&&Bi.postRender(()=>d(t,OR(t)))}class eOe extends yg{mount(){const{current:t}=this.node;t&&(this.unmount=ZCe(t,s=>(sq(this.node,s,"Start"),a=>sq(this.node,a,"End"))))}unmount(){}}class tOe extends yg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=PR(iR(this.node.current,"focus",()=>this.onFocus()),iR(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function oq(r,t,s){const{props:a}=r;r.animationState&&a.whileTap&&r.animationState.setActive("whileTap",s==="Start");const l="onTap"+(s==="End"?"":s),d=a[l];d&&Bi.postRender(()=>d(t,OR(t)))}class nOe extends yg{mount(){const{current:t}=this.node;t&&(this.unmount=rIe(t,s=>(oq(this.node,s,"Start"),(a,{success:l})=>oq(this.node,a,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const lU=new WeakMap,YM=new WeakMap,rOe=r=>{const t=lU.get(r.target);t&&t(r)},iOe=r=>{r.forEach(rOe)};function sOe({root:r,...t}){const s=r||document;YM.has(s)||YM.set(s,{});const a=YM.get(s),l=JSON.stringify(t);return a[l]||(a[l]=new IntersectionObserver(iOe,{root:r,...t})),a[l]}function oOe(r,t,s){const a=sOe(t);return lU.set(r,s),a.observe(r),()=>{lU.delete(r),a.unobserve(r)}}const aOe={some:0,all:1};class cOe extends yg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:s,margin:a,amount:l="some",once:d}=t,f={root:s?s.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:aOe[l]},E=v=>{const{isIntersecting:T}=v;if(this.isInView===T||(this.isInView=T,d&&!T&&this.hasEnteredView))return;T&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",T);const{onViewportEnter:R,onViewportLeave:I}=this.node.getProps(),N=T?R:I;N&&N(v)};return oOe(this.node.current,f,E)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:s}=this.node;["amount","margin","root"].some(lOe(t,s))&&this.startObserver()}unmount(){}}function lOe({viewport:r={}},{viewport:t={}}={}){return s=>r[s]!==t[s]}const uOe={inView:{Feature:cOe},tap:{Feature:nOe},focus:{Feature:tOe},hover:{Feature:eOe}},dOe={layout:{ProjectionNode:tee,MeasureLayout:KZ}},uU={current:null},nee={current:!1};function hOe(){if(nee.current=!0,!!BV)if(window.matchMedia){const r=window.matchMedia("(prefers-reduced-motion)"),t=()=>uU.current=r.matches;r.addListener(t),t()}else uU.current=!1}const pOe=[...IZ,Ia,ug],fOe=r=>pOe.find(CZ(r)),aq=new WeakMap;function mOe(r,t,s){for(const a in t){const l=t[a],d=s[a];if(ka(l))r.addValue(a,l);else if(ka(d))r.addValue(a,nR(l,{owner:r}));else if(d!==l)if(r.hasValue(a)){const f=r.getValue(a);f.liveStyle===!0?f.jump(l):f.hasAnimated||f.set(l)}else{const f=r.getStaticValue(a);r.addValue(a,nR(f!==void 0?f:l,{owner:r}))}}for(const a in s)t[a]===void 0&&r.removeValue(a);return t}const cq=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class gOe{scrapeMotionValuesFromProps(t,s,a){return{}}constructor({parent:t,props:s,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:d,visualState:f},E={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=fF,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const F=Bh.now();this.renderScheduledAt<F&&(this.renderScheduledAt=F,Bi.render(this.render,!1,!0))};const{latestValues:v,renderState:T,onUpdate:R}=f;this.onUpdate=R,this.latestValues=v,this.baseTarget={...v},this.initialValues=s.initial?{...v}:{},this.renderState=T,this.parent=t,this.props=s,this.presenceContext=a,this.depth=t?t.depth+1:0,this.reducedMotionConfig=l,this.options=E,this.blockInitialAnimation=!!d,this.isControllingVariants=tN(s),this.isVariantNode=xQ(s),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:I,...N}=this.scrapeMotionValuesFromProps(s,{},this);for(const F in N){const j=N[F];v[F]!==void 0&&ka(j)&&j.set(v[F],!1)}}mount(t){this.current=t,aq.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((s,a)=>this.bindToMotionValue(a,s)),nee.current||hOe(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:uU.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){aq.delete(this.current),this.projection&&this.projection.unmount(),lg(this.notifyUpdate),lg(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const s=this.features[t];s&&(s.unmount(),s.isMounted=!1)}this.current=null}bindToMotionValue(t,s){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const a=PE.has(t),l=s.on("change",E=>{this.latestValues[t]=E,this.props.onUpdate&&Bi.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),d=s.on("renderRequest",this.scheduleRender);let f;window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,t,s)),this.valueSubscriptions.set(t,()=>{l(),d(),f&&f(),s.owner&&s.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in $S){const s=$S[t];if(!s)continue;const{isEnabled:a,Feature:l}=s;if(!this.features[t]&&l&&a(this.props)&&(this.features[t]=new l(this)),this.features[t]){const d=this.features[t];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ks()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,s){this.latestValues[t]=s}update(t,s){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=s;for(let a=0;a<cq.length;a++){const l=cq[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,f=t[d];f&&(this.propEventSubscriptions[l]=this.on(l,f))}this.prevMotionValues=mOe(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const s=this.getClosestVariantNode();if(s)return s.variantChildren&&s.variantChildren.add(t),()=>s.variantChildren.delete(t)}addValue(t,s){const a=this.values.get(t);s!==a&&(a&&this.removeValue(t),this.bindToMotionValue(t,s),this.values.set(t,s),this.latestValues[t]=s.get())}removeValue(t){this.values.delete(t);const s=this.valueSubscriptions.get(t);s&&(s(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,s){if(this.props.values&&this.props.values[t])return this.props.values[t];let a=this.values.get(t);return a===void 0&&s!==void 0&&(a=nR(s===null?void 0:s,{owner:this}),this.addValue(t,a)),a}readValue(t,s){var a;let l=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(a=this.getBaseTargetFromProps(this.props,t))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,t,this.options);return l!=null&&(typeof l=="string"&&(wZ(l)||mZ(l))?l=parseFloat(l):!fOe(l)&&ug.test(s)&&(l=SZ(t,s)),this.setBaseTarget(t,ka(l)?l.get():l)),ka(l)?l.get():l}setBaseTarget(t,s){this.baseTarget[t]=s}getBaseTarget(t){var s;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const f=qV(this.props,a,(s=this.presenceContext)===null||s===void 0?void 0:s.custom);f&&(l=f[t])}if(a&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,t);return d!==void 0&&!ka(d)?d:this.initialValues[t]!==void 0&&l===void 0?void 0:this.baseTarget[t]}on(t,s){return this.events[t]||(this.events[t]=new cF),this.events[t].add(s)}notify(t,...s){this.events[t]&&this.events[t].notify(...s)}}class ree extends gOe{constructor(){super(...arguments),this.KeyframeResolver=AZ}sortInstanceNodePosition(t,s){return t.compareDocumentPosition(s)&2?1:-1}getBaseTargetFromProps(t,s){return t.style?t.style[s]:void 0}removeValueFromRenderState(t,{vars:s,style:a}){delete s[t],delete a[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;ka(t)&&(this.childSubscription=t.on("change",s=>{this.current&&(this.current.textContent=`${s}`)}))}}function _Oe(r){return window.getComputedStyle(r)}class EOe extends ree{constructor(){super(...arguments),this.type="html",this.renderInstance=GQ}readValueFromInstance(t,s){if(PE.has(s)){const a=pF(s);return a&&a.default||0}else{const a=_Oe(t),l=(BQ(s)?a.getPropertyValue(s):a[s])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(t,{transformPagePoint:s}){return HZ(t,s)}build(t,s,a){JV(t,s,a.transformTemplate)}scrapeMotionValuesFromProps(t,s,a){return tF(t,s,a)}}class yOe extends ree{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ks}getBaseTargetFromProps(t,s){return t[s]}readValueFromInstance(t,s){if(PE.has(s)){const a=pF(s);return a&&a.default||0}return s=HQ.has(s)?s:HV(s),t.getAttribute(s)}scrapeMotionValuesFromProps(t,s,a){return qQ(t,s,a)}build(t,s,a){QV(t,s,this.isSVGTag,a.transformTemplate)}renderInstance(t,s,a,l){$Q(t,s,a,l)}mount(t){this.isSVGTag=eF(t.tagName),super.mount(t)}}const vOe=(r,t)=>KV(r)?new yOe(t):new EOe(t,{allowProjection:r!==L.Fragment}),SOe=$Ce({...GAe,...uOe,...ZPe,...dOe},vOe),If=aCe(SOe),TOe=(r,t)=>r.find(s=>s.id===t);function lq(r,t){const s=iee(r,t),a=s?r[s].findIndex(l=>l.id===t):-1;return{position:s,index:a}}function iee(r,t){for(const[s,a]of Object.entries(r))if(TOe(a,t))return s}function bOe(r){const t=r.includes("right"),s=r.includes("left");let a="center";return t&&(a="flex-end"),s&&(a="flex-start"),{display:"flex",flexDirection:"column",alignItems:a}}function wOe(r){const s=r==="top"||r==="bottom"?"0 auto":void 0,a=r.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=r.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,d=r.includes("left")?void 0:"env(safe-area-inset-right, 0px)",f=r.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:s,top:a,bottom:l,right:d,left:f}}var ROe=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,COe=vQ(function(r){return ROe.test(r)||r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&r.charCodeAt(2)<91}),IOe=COe,AOe=function(t){return t!=="theme"},uq=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?IOe:AOe},dq=function(t,s,a){var l;if(s){var d=s.shouldForwardProp;l=t.__emotion_forwardProp&&d?function(f){return t.__emotion_forwardProp(f)&&d(f)}:d}return typeof l!="function"&&a&&(l=t.__emotion_forwardProp),l},POe=function(t){var s=t.cache,a=t.serialized,l=t.isStringTag;return PV(s,a,l),RQ(function(){return OV(s,a,l)}),null},OOe=function r(t,s){var a=t.__emotion_real===t,l=a&&t.__emotion_base||t,d,f;s!==void 0&&(d=s.label,f=s.target);var E=dq(t,s,a),v=E||uq(l),T=!v("as");return function(){var R=arguments,I=a&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(d!==void 0&&I.push("label:"+d+";"),R[0]==null||R[0].raw===void 0)I.push.apply(I,R);else{var N=R[0];I.push(N[0]);for(var F=R.length,j=1;j<F;j++)I.push(R[j],N[j])}var G=NV(function(H,te,K){var ee=T&&H.as||l,de="",se=[],ge=H;if(H.theme==null){ge={};for(var Z in H)ge[Z]=H[Z];ge.theme=L.useContext(GS)}typeof H.className=="string"?de=TQ(te.registered,se,H.className):H.className!=null&&(de=H.className+" ");var Q=Xk(I.concat(se),te.registered,ge);de+=te.key+"-"+Q.name,f!==void 0&&(de+=" "+f);var ne=T&&E===void 0?uq(ee):v,oe={};for(var pe in H)T&&pe==="as"||ne(pe)&&(oe[pe]=H[pe]);return oe.className=de,K&&(oe.ref=K),L.createElement(L.Fragment,null,L.createElement(POe,{cache:te,serialized:Q,isStringTag:typeof ee=="string"}),L.createElement(ee,oe))});return G.displayName=d!==void 0?d:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",G.defaultProps=t.defaultProps,G.__emotion_real=G,G.__emotion_base=l,G.__emotion_styles=I,G.__emotion_forwardProp=E,Object.defineProperty(G,"toString",{value:function(){return"."+f}}),G.withComponent=function(H,te){var K=r(H,gE({},s,te,{shouldForwardProp:dq(G,te,!0)}));return K.apply(void 0,I)},G}},kOe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],dU=OOe.bind(null);kOe.forEach(function(r){dU[r]=dU(r)});const NOe=new Set([...ZEe,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),DOe=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function LOe(r){return(DOe.has(r)||!NOe.has(r))&&r[0]!=="_"}const xOe=O_e(dU),MOe=({baseStyle:r})=>t=>{const{theme:s,css:a,__css:l,sx:d,...f}=t,[E]=F_e(f,tye),v=Hc(r,t),T=g_e({},l,v,Wk(E),d),R=ZJ(T)(t.theme);return a?[R,a]:R};function XM(r,t){const{baseStyle:s,...a}=t??{};a.shouldForwardProp||(a.shouldForwardProp=LOe);const l=MOe({baseStyle:s}),d=xOe(r,a)(l);return L.forwardRef(function(v,T){const{children:R,...I}=v,{colorMode:N,forced:F}=Qk(),j=F?N:void 0;return L.createElement(d,{ref:T,"data-theme":j,...I},R)})}function UOe(){const r=new Map;return new Proxy(XM,{apply(t,s,a){return XM(...a)},get(t,s){return r.has(s)||r.set(s,XM(s)),r.get(s)}})}const Mt=UOe(),VOe={initial:r=>{const{position:t}=r,s=["top","bottom"].includes(t)?"y":"x";let a=["top-right","bottom-right"].includes(t)?1:-1;return t==="bottom"&&(a=1),{opacity:0,[s]:a*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},see=L.memo(r=>{const{id:t,message:s,onCloseComplete:a,onRequestRemove:l,requestClose:d=!1,position:f="bottom",duration:E=5e3,containerStyle:v,motionVariants:T=VOe,toastSpacing:R="0.5rem"}=r,[I,N]=L.useState(E),F=QRe();cg(()=>{F||a==null||a()},[F]),cg(()=>{N(E)},[E]);const j=()=>N(null),G=()=>N(E),H=()=>{F&&l()};L.useEffect(()=>{F&&d&&l()},[F,d,l]),rEe(H,I);const te=L.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:R,...v}),[v,R]),K=L.useMemo(()=>bOe(f),[f]);return P.jsx(If.div,{layout:!0,className:"chakra-toast",variants:T,initial:"initial",animate:"animate",exit:"exit",onHoverStart:j,onHoverEnd:G,custom:{position:f},style:K,children:P.jsx(Mt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:te,children:Hc(s,{id:t,onClose:H})})})});see.displayName="ToastComponent";function Qt(r){return L.forwardRef(r)}var JM,hq;function FOe(){if(hq)return JM;hq=1;var r=typeof Element<"u",t=typeof Map=="function",s=typeof Set=="function",a=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(d,f){if(d===f)return!0;if(d&&f&&typeof d=="object"&&typeof f=="object"){if(d.constructor!==f.constructor)return!1;var E,v,T;if(Array.isArray(d)){if(E=d.length,E!=f.length)return!1;for(v=E;v--!==0;)if(!l(d[v],f[v]))return!1;return!0}var R;if(t&&d instanceof Map&&f instanceof Map){if(d.size!==f.size)return!1;for(R=d.entries();!(v=R.next()).done;)if(!f.has(v.value[0]))return!1;for(R=d.entries();!(v=R.next()).done;)if(!l(v.value[1],f.get(v.value[0])))return!1;return!0}if(s&&d instanceof Set&&f instanceof Set){if(d.size!==f.size)return!1;for(R=d.entries();!(v=R.next()).done;)if(!f.has(v.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(d)&&ArrayBuffer.isView(f)){if(E=d.length,E!=f.length)return!1;for(v=E;v--!==0;)if(d[v]!==f[v])return!1;return!0}if(d.constructor===RegExp)return d.source===f.source&&d.flags===f.flags;if(d.valueOf!==Object.prototype.valueOf&&typeof d.valueOf=="function"&&typeof f.valueOf=="function")return d.valueOf()===f.valueOf();if(d.toString!==Object.prototype.toString&&typeof d.toString=="function"&&typeof f.toString=="function")return d.toString()===f.toString();if(T=Object.keys(d),E=T.length,E!==Object.keys(f).length)return!1;for(v=E;v--!==0;)if(!Object.prototype.hasOwnProperty.call(f,T[v]))return!1;if(r&&d instanceof Element)return!1;for(v=E;v--!==0;)if(!((T[v]==="_owner"||T[v]==="__v"||T[v]==="__o")&&d.$$typeof)&&!l(d[T[v]],f[T[v]]))return!1;return!0}return d!==d&&f!==f}return JM=function(f,E){try{return l(f,E)}catch(v){if((v.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw v}},JM}var jOe=FOe();const BOe=u0(jOe);function g0(){const r=L.useContext(GS);if(!r)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return r}function oee(){const r=Qk(),t=g0();return{...r,theme:t}}function WOe(r,t,s){if(t==null)return t;const a=l=>{var d,f;return(f=(d=r.__cssMap)==null?void 0:d[l])==null?void 0:f.value};return a(t)??a(s)??s}function zOe(r,t,s){const a=Array.isArray(t)?t:[t],l=Array.isArray(s)?s:[s];return d=>{const f=l.filter(Boolean),E=a.map((v,T)=>{const R=`${r}.${v}`;return WOe(d,R,f[T]??v)});return Array.isArray(t)?E:E[0]}}function aee(r,t={}){const{styleConfig:s,...a}=t,{theme:l,colorMode:d}=oee(),f=r?MJ(l,`components.${r}`):void 0,E=s||f,v=Lh({theme:l,colorMode:d},(E==null?void 0:E.defaultProps)??{},Wk(d0(a,["children"])),(R,I)=>R?void 0:I),T=L.useRef({});if(E){const I=hye(E)(v);BOe(T.current,I)||(T.current=I)}return T.current}function Iu(r,t={}){return aee(r,t)}function Qc(r,t={}){return aee(r,t)}const pq={path:P.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[P.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),P.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),P.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},Wn=Qt((r,t)=>{const{as:s,viewBox:a,color:l="currentColor",focusable:d=!1,children:f,className:E,__css:v,...T}=r,R=_n("chakra-icon",E),I=Iu("Icon",r),N={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...v,...I},F={ref:t,focusable:d,className:R,__css:N},j=a??pq.viewBox;if(s&&typeof s!="string")return P.jsx(Mt.svg,{as:s,...F,...T});const G=f??pq.path;return P.jsx(Mt.svg,{verticalAlign:"middle",viewBox:j,...F,...T,children:G})});Wn.displayName="Icon";function GOe(r){return P.jsx(Wn,{viewBox:"0 0 24 24",...r,children:P.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function HOe(r){return P.jsx(Wn,{viewBox:"0 0 24 24",...r,children:P.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function fq(r){return P.jsx(Wn,{viewBox:"0 0 24 24",...r,children:P.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const $Oe=RR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),Af=Qt((r,t)=>{const s=Iu("Spinner",r),{label:a="Loading...",thickness:l="2px",speed:d="0.45s",emptyColor:f="transparent",className:E,...v}=Ji(r),T=_n("chakra-spinner",E),R={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:f,borderLeftColor:f,animation:`${$Oe} ${d} linear infinite`,...s};return P.jsx(Mt.div,{ref:t,__css:R,className:T,...v,children:a&&P.jsx(Mt.span,{srOnly:!0,children:a})})});Af.displayName="Spinner";const[KOe,EF]=Wi({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[qOe,yF]=Wi({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),cee={info:{icon:HOe,colorScheme:"blue"},warning:{icon:fq,colorScheme:"orange"},success:{icon:GOe,colorScheme:"green"},error:{icon:fq,colorScheme:"red"},loading:{icon:Af,colorScheme:"blue"}};function YOe(r){return cee[r].colorScheme}function XOe(r){return cee[r].icon}const qS=Qt(function(t,s){const{status:a="info",addRole:l=!0,...d}=Ji(t),f=t.colorScheme??YOe(a),E=Qc("Alert",{...t,colorScheme:f}),v={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",...E.container};return P.jsx(KOe,{value:{status:a},children:P.jsx(qOe,{value:E,children:P.jsx(Mt.div,{"data-status":a,role:l?"alert":void 0,ref:s,...d,className:_n("chakra-alert",t.className),__css:v})})})});qS.displayName="Alert";function YS(r){const{status:t}=EF(),s=XOe(t),a=yF(),l=t==="loading"?a.spinner:a.icon;return P.jsx(Mt.span,{display:"inherit","data-status":t,...r,className:_n("chakra-alert__icon",r.className),__css:l,children:r.children||P.jsx(s,{h:"100%",w:"100%"})})}YS.displayName="AlertIcon";const lk=Qt(function(t,s){const a=yF(),{status:l}=EF();return P.jsx(Mt.div,{ref:s,"data-status":l,...t,className:_n("chakra-alert__title",t.className),__css:a.title})});lk.displayName="AlertTitle";const uk=Qt(function(t,s){const{status:a}=EF(),l=yF(),d={display:"inline",...l.description};return P.jsx(Mt.div,{ref:s,"data-status":a,...t,className:_n("chakra-alert__desc",t.className),__css:d})});uk.displayName="AlertDescription";function JOe(r){return P.jsx(Wn,{focusable:"false","aria-hidden":!0,...r,children:P.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const vF=Qt(function(t,s){const a=Iu("CloseButton",t),{children:l,isDisabled:d,__css:f,...E}=Ji(t),v={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return P.jsx(Mt.button,{type:"button","aria-label":"Close",ref:s,disabled:d,__css:{...v,...a,...f},...E,children:l||P.jsx(JOe,{width:"1em",height:"1em"})})});vF.displayName="CloseButton";const QOe=r=>{const{status:t,variant:s="solid",id:a,title:l,isClosable:d,onClose:f,description:E,colorScheme:v,icon:T}=r,R=a?{root:`toast-${a}`,title:`toast-${a}-title`,description:`toast-${a}-description`}:void 0;return P.jsxs(qS,{addRole:!1,status:t,variant:s,id:R==null?void 0:R.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:v,children:[P.jsx(YS,{children:T}),P.jsxs(Mt.div,{flex:"1",maxWidth:"100%",children:[l&&P.jsx(lk,{id:R==null?void 0:R.title,children:l}),E&&P.jsx(uk,{id:R==null?void 0:R.description,display:"block",children:E})]}),d&&P.jsx(vF,{size:"sm",onClick:f,position:"absolute",insetEnd:1,top:1})]})};function lee(r={}){const{render:t,toastComponent:s=QOe}=r;return l=>typeof t=="function"?t({...l,...r}):P.jsx(s,{...l,...r})}const ZOe={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},kh=eke(ZOe);function eke(r){let t=r;const s=new Set,a=l=>{t=l(t),s.forEach(d=>d())};return{getState:()=>t,subscribe:l=>(s.add(l),()=>{a(()=>r),s.delete(l)}),removeToast:(l,d)=>{a(f=>({...f,[d]:f[d].filter(E=>E.id!=l)}))},notify:(l,d)=>{const f=tke(l,d),{position:E,id:v}=f;return a(T=>{const I=E.includes("top")?[f,...T[E]??[]]:[...T[E]??[],f];return{...T,[E]:I}}),v},update:(l,d)=>{l&&a(f=>{const E={...f},{position:v,index:T}=lq(E,l);return v&&T!==-1&&(E[v][T]={...E[v][T],...d,message:lee(d)}),E})},closeAll:({positions:l}={})=>{a(d=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((v,T)=>(v[T]=d[T].map(R=>({...R,requestClose:!0})),v),{...d}))},close:l=>{a(d=>{const f=iee(d,l);return f?{...d,[f]:d[f].map(E=>E.id==l?{...E,requestClose:!0}:E)}:d})},isActive:l=>!!lq(kh.getState(),l).position}}let mq=0;function tke(r,t={}){mq+=1;const s=t.id??mq,a=t.position??"bottom";return{id:s,message:r,position:a,duration:t.duration,onCloseComplete:t.onCloseComplete,onRequestRemove:()=>kh.removeToast(String(s),a),status:t.status,requestClose:!1,containerStyle:t.containerStyle}}var uee=IJ();const[dee,nke]=Wi({strict:!1,name:"PortalContext"}),SF="chakra-portal",rke=".chakra-portal",ike=r=>P.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:r.zIndex,top:0,left:0,right:0},children:r.children}),ske=r=>{const{appendToParentPortal:t,children:s}=r,[a,l]=L.useState(null),d=L.useRef(null),[,f]=L.useState({});L.useEffect(()=>f({}),[]);const E=nke(),v=HRe();hf(()=>{if(!a)return;const R=a.ownerDocument,I=t?E??R.body:R.body;if(!I)return;d.current=R.createElement("div"),d.current.className=SF,I.appendChild(d.current),f({});const N=d.current;return()=>{I.contains(N)&&I.removeChild(N)}},[a]);const T=v!=null&&v.zIndex?P.jsx(ike,{zIndex:v==null?void 0:v.zIndex,children:s}):s;return d.current?uee.createPortal(P.jsx(dee,{value:d.current,children:T}),d.current):P.jsx("span",{ref:R=>{R&&l(R)}})},oke=r=>{const{children:t,containerRef:s,appendToParentPortal:a}=r,l=s.current,d=l??(typeof window<"u"?document.body:void 0),f=L.useMemo(()=>{const v=l==null?void 0:l.ownerDocument.createElement("div");return v&&(v.className=SF),v},[l]),[,E]=L.useState({});return hf(()=>E({}),[]),hf(()=>{if(!(!f||!d))return d.appendChild(f),()=>{d.removeChild(f)}},[f,d]),d&&f?uee.createPortal(P.jsx(dee,{value:a?f:null,children:t}),f):null};function Au(r){const t={appendToParentPortal:!0,...r},{containerRef:s,...a}=t;return s?P.jsx(oke,{containerRef:s,...a}):P.jsx(ske,{...a})}Au.className=SF;Au.selector=rke;Au.displayName="Portal";const[ake,cke]=Wi({name:"ToastOptionsContext",strict:!1}),lke=r=>{const t=L.useSyncExternalStore(kh.subscribe,kh.getState,kh.getState),{motionVariants:s,component:a=see,portalProps:l,animatePresenceProps:d}=r,E=Object.keys(t).map(v=>{const T=t[v];return P.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${v}`,id:`chakra-toast-manager-${v}`,style:wOe(v),children:P.jsx(p0,{...d,initial:!1,children:T.map(R=>P.jsx(a,{motionVariants:s,...R},R.id))})},v)});return P.jsx(Au,{...l,children:E})},uke=r=>function({children:s,theme:a=r,toastOptions:l,...d}){return P.jsxs(KRe,{theme:a,...d,children:[P.jsx(ake,{value:l==null?void 0:l.defaultOptions,children:s}),P.jsx(lke,{...l})]})},dke=uke(Vwe);function gq(r){return r.sort((t,s)=>{const a=t.compareDocumentPosition(s);if(a&Node.DOCUMENT_POSITION_FOLLOWING||a&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(a&Node.DOCUMENT_POSITION_PRECEDING||a&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(a&Node.DOCUMENT_POSITION_DISCONNECTED||a&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const hke=r=>typeof r=="object"&&"nodeType"in r&&r.nodeType===Node.ELEMENT_NODE;function _q(r,t,s){let a=r+1;return s&&a>=t&&(a=0),a}function Eq(r,t,s){let a=r-1;return s&&a<0&&(a=t),a}const QM=typeof window<"u"?L.useLayoutEffect:L.useEffect,yq=r=>r;var pke=Object.defineProperty,fke=(r,t,s)=>t in r?pke(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,Ss=(r,t,s)=>(fke(r,typeof t!="symbol"?t+"":t,s),s);class mke{constructor(){Ss(this,"descendants",new Map),Ss(this,"register",t=>{if(t!=null)return hke(t)?this.registerNode(t):s=>{this.registerNode(s,t)}}),Ss(this,"unregister",t=>{this.descendants.delete(t);const s=gq(Array.from(this.descendants.keys()));this.assignIndex(s)}),Ss(this,"destroy",()=>{this.descendants.clear()}),Ss(this,"assignIndex",t=>{this.descendants.forEach(s=>{const a=t.indexOf(s.node);s.index=a,s.node.dataset.index=s.index.toString()})}),Ss(this,"count",()=>this.descendants.size),Ss(this,"enabledCount",()=>this.enabledValues().length),Ss(this,"values",()=>Array.from(this.descendants.values()).sort((s,a)=>s.index-a.index)),Ss(this,"enabledValues",()=>this.values().filter(t=>!t.disabled)),Ss(this,"item",t=>{if(this.count()!==0)return this.values()[t]}),Ss(this,"enabledItem",t=>{if(this.enabledCount()!==0)return this.enabledValues()[t]}),Ss(this,"first",()=>this.item(0)),Ss(this,"firstEnabled",()=>this.enabledItem(0)),Ss(this,"last",()=>this.item(this.descendants.size-1)),Ss(this,"lastEnabled",()=>{const t=this.enabledValues().length-1;return this.enabledItem(t)}),Ss(this,"indexOf",t=>{var s;return t?((s=this.descendants.get(t))==null?void 0:s.index)??-1:-1}),Ss(this,"enabledIndexOf",t=>t==null?-1:this.enabledValues().findIndex(s=>s.node.isSameNode(t))),Ss(this,"next",(t,s=!0)=>{const a=_q(t,this.count(),s);return this.item(a)}),Ss(this,"nextEnabled",(t,s=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=_q(l,this.enabledCount(),s);return this.enabledItem(d)}),Ss(this,"prev",(t,s=!0)=>{const a=Eq(t,this.count()-1,s);return this.item(a)}),Ss(this,"prevEnabled",(t,s=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=Eq(l,this.enabledCount()-1,s);return this.enabledItem(d)}),Ss(this,"registerNode",(t,s)=>{if(!t||this.descendants.has(t))return;const a=Array.from(this.descendants.keys()).concat(t),l=gq(a);s!=null&&s.disabled&&(s.disabled=!!s.disabled);const d={node:t,index:-1,...s};this.descendants.set(t,d),this.assignIndex(l)})}}function hee(){const[r,t]=Wi({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[r,t,()=>{const l=L.useRef(new mke);return QM(()=>()=>l.current.destroy()),l.current},l=>{const d=t(),[f,E]=L.useState(-1),v=L.useRef(null);QM(()=>()=>{v.current&&d.unregister(v.current)},[]),QM(()=>{if(!v.current)return;const R=Number(v.current.dataset.index);f!=R&&!Number.isNaN(R)&&E(R)});const T=yq(l?d.register(l):d.register);return{descendants:d,index:f,enabledIndex:d.enabledIndexOf(v.current),register:Yi(T,v)}}]}const vq={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},lE={enter:{duration:.2,ease:vq.easeOut},exit:{duration:.1,ease:vq.easeIn}},uE={enter:(r,t)=>({...r,delay:typeof t=="number"?t:t==null?void 0:t.enter}),exit:(r,t)=>({...r,delay:typeof t=="number"?t:t==null?void 0:t.exit})},[gke,_ke]=Wi({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function Eke(r){const t=r.trim().split(" "),s=t[0]??"",a=t.length>1?t[t.length-1]:"";return s&&a?`${s.charAt(0)}${a.charAt(0)}`:s.charAt(0)}function pee(r){const{name:t,getInitials:s,...a}=r,l=_ke();return P.jsx(Mt.div,{role:"img","aria-label":t,...a,__css:l.label,children:t?s==null?void 0:s(t):null})}pee.displayName="AvatarName";const fee=r=>P.jsxs(Mt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...r,children:[P.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),P.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function mee(r){const{loading:t,src:s,srcSet:a,onLoad:l,onError:d,crossOrigin:f,sizes:E,ignoreFallback:v}=r,[T,R]=L.useState("pending");L.useEffect(()=>{R(s?"loading":"pending")},[s]);const I=L.useRef(null),N=L.useCallback(()=>{if(!s)return;F();const j=new Image;j.src=s,f&&(j.crossOrigin=f),a&&(j.srcset=a),E&&(j.sizes=E),t&&(j.loading=t),j.onload=G=>{F(),R("loaded"),l==null||l(G)},j.onerror=G=>{F(),R("failed"),d==null||d(G)},I.current=j},[s,f,a,E,l,d,t]),F=()=>{I.current&&(I.current.onload=null,I.current.onerror=null,I.current=null)};return hf(()=>{if(!v)return T==="loading"&&N(),()=>{F()}},[T,N,v]),v?"loaded":T}const yke=(r,t)=>r!=="loaded"&&t==="beforeLoadOrError"||r==="failed"&&t==="onError";function gee(r){const{src:t,srcSet:s,onError:a,onLoad:l,getInitials:d,name:f,borderRadius:E,loading:v,iconLabel:T,icon:R=P.jsx(fee,{}),ignoreFallback:I,referrerPolicy:N,crossOrigin:F}=r,G=mee({src:t,onError:a,crossOrigin:F,ignoreFallback:I})==="loaded";return!t||!G?f?P.jsx(pee,{className:"chakra-avatar__initials",getInitials:d,name:f}):L.cloneElement(R,{role:"img","aria-label":T}):P.jsx(Mt.img,{src:t,srcSet:s,alt:f??T,onLoad:l,referrerPolicy:N,crossOrigin:F??void 0,className:"chakra-avatar__img",loading:v,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:E}})}gee.displayName="AvatarImage";const vke={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},vf=Qt((r,t)=>{const s=Qc("Avatar",r),[a,l]=L.useState(!1),{src:d,srcSet:f,name:E,showBorder:v,borderRadius:T="full",onError:R,onLoad:I,getInitials:N=Eke,icon:F=P.jsx(fee,{}),iconLabel:j=" avatar",loading:G,children:H,borderColor:te,ignoreFallback:K,crossOrigin:ee,referrerPolicy:de,...se}=Ji(r),ge={borderRadius:T,borderWidth:v?"2px":void 0,...vke,...s.container};return te&&(ge.borderColor=te),P.jsx(Mt.span,{ref:t,...se,className:_n("chakra-avatar",r.className),"data-loaded":Kn(a),__css:ge,children:P.jsxs(gke,{value:s,children:[P.jsx(gee,{src:d,srcSet:f,loading:G,onLoad:Qn(I,()=>{l(!0)}),onError:R,getInitials:N,name:E,borderRadius:T,icon:F,iconLabel:j,ignoreFallback:K,crossOrigin:ee,referrerPolicy:de}),H]})})});vf.displayName="Avatar";const af=Qt(function(t,s){const a=Iu("Badge",t),{className:l,...d}=Ji(t);return P.jsx(Mt.span,{ref:s,className:_n("chakra-badge",t.className),...d,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});af.displayName="Badge";const kt=Mt("div");kt.displayName="Box";const[A6e,Ske]=Wi({strict:!1,name:"ButtonGroupContext"});function _w(r){const{children:t,className:s,...a}=r,l=L.isValidElement(t)?L.cloneElement(t,{"aria-hidden":!0,focusable:!1}):t,d=_n("chakra-button__icon",s);return P.jsx(Mt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...a,className:d,children:l})}_w.displayName="ButtonIcon";function hU(r){const{label:t,placement:s,spacing:a="0.5rem",children:l=P.jsx(Af,{color:"currentColor",width:"1em",height:"1em"}),className:d,__css:f,...E}=r,v=_n("chakra-button__spinner",d),T=s==="start"?"marginEnd":"marginStart",R=L.useMemo(()=>({display:"flex",alignItems:"center",position:t?"relative":"absolute",[T]:t?a:0,fontSize:"1em",lineHeight:"normal",...f}),[f,t,T,a]);return P.jsx(Mt.div,{className:v,...E,__css:R,children:l})}hU.displayName="ButtonSpinner";function Tke(r){const[t,s]=L.useState(!r);return{ref:L.useCallback(d=>{d&&s(d.tagName==="BUTTON")},[]),type:t?"button":void 0}}const is=Qt((r,t)=>{const s=Ske(),a=Iu("Button",{...s,...r}),{isDisabled:l=s==null?void 0:s.isDisabled,isLoading:d,isActive:f,children:E,leftIcon:v,rightIcon:T,loadingText:R,iconSpacing:I="0.5rem",type:N,spinner:F,spinnerPlacement:j="start",className:G,as:H,shouldWrapChildren:te,...K}=Ji(r),ee=L.useMemo(()=>{const Z={...a==null?void 0:a._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...a,...!!s&&{_focus:Z}}},[a,s]),{ref:de,type:se}=Tke(H),ge={rightIcon:T,leftIcon:v,iconSpacing:I,children:E,shouldWrapChildren:te};return P.jsxs(Mt.button,{disabled:l||d,ref:nEe(t,de),as:H,type:N??se,"data-active":Kn(f),"data-loading":Kn(d),__css:ee,className:_n("chakra-button",G),...K,children:[d&&j==="start"&&P.jsx(hU,{className:"chakra-button__spinner--start",label:R,placement:"start",spacing:I,children:F}),d?R||P.jsx(Mt.span,{opacity:0,children:P.jsx(Sq,{...ge})}):P.jsx(Sq,{...ge}),d&&j==="end"&&P.jsx(hU,{className:"chakra-button__spinner--end",label:R,placement:"end",spacing:I,children:F})]})});is.displayName="Button";function Sq(r){const{leftIcon:t,rightIcon:s,children:a,iconSpacing:l,shouldWrapChildren:d}=r;return d?P.jsxs("span",{style:{display:"contents"},children:[t&&P.jsx(_w,{marginEnd:l,children:t}),a,s&&P.jsx(_w,{marginStart:l,children:s})]}):P.jsxs(P.Fragment,{children:[t&&P.jsx(_w,{marginEnd:l,children:t}),a,s&&P.jsx(_w,{marginStart:l,children:s})]})}const Pa=Qt((r,t)=>{const{icon:s,children:a,isRound:l,"aria-label":d,...f}=r,E=s||a,v=L.isValidElement(E)?L.cloneElement(E,{"aria-hidden":!0,focusable:!1}):null;return P.jsx(is,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:t,"aria-label":d,...f,children:v})});Pa.displayName="IconButton";const _ee=Mt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});_ee.displayName="Center";const bke={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};Qt(function(t,s){const{axis:a="both",...l}=t;return P.jsx(Mt.div,{ref:s,__css:bke[a],...l,position:"absolute"})});var wke=()=>typeof document<"u",Tq=!1,kR=null,_E=!1,pU=!1,fU=new Set;function TF(r,t){fU.forEach(s=>s(r,t))}var Rke=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function Cke(r){return!(r.metaKey||!Rke&&r.altKey||r.ctrlKey||r.key==="Control"||r.key==="Shift"||r.key==="Meta")}function bq(r){_E=!0,Cke(r)&&(kR="keyboard",TF("keyboard",r))}function Qv(r){if(kR="pointer",r.type==="mousedown"||r.type==="pointerdown"){_E=!0;const t=r.composedPath?r.composedPath()[0]:r.target;let s=!1;try{s=t.matches(":focus-visible")}catch{}if(s)return;TF("pointer",r)}}function Ike(r){return r.mozInputSource===0&&r.isTrusted?!0:r.detail===0&&!r.pointerType}function Ake(r){Ike(r)&&(_E=!0,kR="virtual")}function Pke(r){r.target===window||r.target===document||r.target instanceof Element&&r.target.hasAttribute("tabindex")||(!_E&&!pU&&(kR="virtual",TF("virtual",r)),_E=!1,pU=!1)}function Oke(){_E=!1,pU=!0}function wq(){return kR!=="pointer"}function kke(){if(!wke()||Tq)return;const{focus:r}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...s){_E=!0,r.apply(this,s)},document.addEventListener("keydown",bq,!0),document.addEventListener("keyup",bq,!0),document.addEventListener("click",Ake,!0),window.addEventListener("focus",Pke,!0),window.addEventListener("blur",Oke,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",Qv,!0),document.addEventListener("pointermove",Qv,!0),document.addEventListener("pointerup",Qv,!0)):(document.addEventListener("mousedown",Qv,!0),document.addEventListener("mousemove",Qv,!0),document.addEventListener("mouseup",Qv,!0)),Tq=!0}function Nke(r){kke(),r(wq());const t=()=>r(wq());return fU.add(t),()=>{fU.delete(t)}}const[Dke,Eee]=Wi({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[Lke,_0]=Wi({strict:!1,name:"FormControlContext"});function xke(r){const{id:t,isRequired:s,isInvalid:a,isDisabled:l,isReadOnly:d,...f}=r,E=L.useId(),v=t||`field-${E}`,T=`${v}-label`,R=`${v}-feedback`,I=`${v}-helptext`,[N,F]=L.useState(!1),[j,G]=L.useState(!1),[H,te]=L.useState(!1),K=L.useCallback((Z={},Q=null)=>({id:I,...Z,ref:Yi(Q,ne=>{ne&&G(!0)})}),[I]),ee=L.useCallback((Z={},Q=null)=>({...Z,ref:Q,"data-focus":Kn(H),"data-disabled":Kn(l),"data-invalid":Kn(a),"data-readonly":Kn(d),id:Z.id!==void 0?Z.id:T,htmlFor:Z.htmlFor!==void 0?Z.htmlFor:v}),[v,l,H,a,d,T]),de=L.useCallback((Z={},Q=null)=>({id:R,...Z,ref:Yi(Q,ne=>{ne&&F(!0)}),"aria-live":"polite"}),[R]),se=L.useCallback((Z={},Q=null)=>({...Z,...f,ref:Q,role:"group","data-focus":Kn(H),"data-disabled":Kn(l),"data-invalid":Kn(a),"data-readonly":Kn(d)}),[f,l,H,a,d]),ge=L.useCallback((Z={},Q=null)=>({...Z,ref:Q,role:"presentation","aria-hidden":!0,children:Z.children||"*"}),[]);return{isRequired:!!s,isInvalid:!!a,isReadOnly:!!d,isDisabled:!!l,isFocused:!!H,onFocus:()=>te(!0),onBlur:()=>te(!1),hasFeedbackText:N,setHasFeedbackText:F,hasHelpText:j,setHasHelpText:G,id:v,labelId:T,feedbackId:R,helpTextId:I,htmlProps:f,getHelpTextProps:K,getErrorMessageProps:de,getRootProps:se,getLabelProps:ee,getRequiredIndicatorProps:ge}}const rs=Qt(function(t,s){const a=Qc("Form",t),l=Ji(t),{getRootProps:d,htmlProps:f,...E}=xke(l),v=_n("chakra-form-control",t.className);return P.jsx(Lke,{value:E,children:P.jsx(Dke,{value:a,children:P.jsx(Mt.div,{...d({},s),className:v,__css:a.container})})})});rs.displayName="FormControl";const OO=Qt(function(t,s){const a=_0(),l=Eee(),d=_n("chakra-form__helper-text",t.className);return P.jsx(Mt.div,{...a==null?void 0:a.getHelpTextProps(t,s),__css:l.helperText,className:d})});OO.displayName="FormHelperText";function bF(r){const{isDisabled:t,isInvalid:s,isReadOnly:a,isRequired:l,...d}=yee(r);return{...d,disabled:t,readOnly:a,required:l,"aria-invalid":wS(s),"aria-required":wS(l),"aria-readonly":wS(a)}}function yee(r){const t=_0(),{id:s,disabled:a,readOnly:l,required:d,isRequired:f,isInvalid:E,isReadOnly:v,isDisabled:T,onFocus:R,onBlur:I,...N}=r,F=r["aria-describedby"]?[r["aria-describedby"]]:[];return t!=null&&t.hasFeedbackText&&(t!=null&&t.isInvalid)&&F.push(t.feedbackId),t!=null&&t.hasHelpText&&F.push(t.helpTextId),{...N,"aria-describedby":F.join(" ")||void 0,id:s??(t==null?void 0:t.id),isDisabled:a??T??(t==null?void 0:t.isDisabled),isReadOnly:l??v??(t==null?void 0:t.isReadOnly),isRequired:d??f??(t==null?void 0:t.isRequired),isInvalid:E??(t==null?void 0:t.isInvalid),onFocus:Qn(t==null?void 0:t.onFocus,R),onBlur:Qn(t==null?void 0:t.onBlur,I)}}const Mke={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function Uke(r={}){const t=yee(r),{isDisabled:s,isReadOnly:a,isRequired:l,isInvalid:d,id:f,onBlur:E,onFocus:v,"aria-describedby":T}=t,{defaultChecked:R,isChecked:I,isFocusable:N,onChange:F,isIndeterminate:j,name:G,value:H,tabIndex:te=void 0,"aria-label":K,"aria-labelledby":ee,"aria-invalid":de,...se}=r,ge=d0(se,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),Z=$c(F),Q=$c(E),ne=$c(v),[oe,pe]=L.useState(!1),[he,le]=L.useState(!1),[Me,He]=L.useState(!1),[rt,we]=L.useState(!1);L.useEffect(()=>Nke(pe),[]);const Ce=L.useRef(null),[ye,Ne]=L.useState(!0),[Te,Se]=L.useState(!!R),Ae=I!==void 0,Ue=Ae?I:Te,ze=L.useCallback(qt=>{if(a||s){qt.preventDefault();return}Ae||Se(Ue?qt.currentTarget.checked:j?!0:qt.currentTarget.checked),Z==null||Z(qt)},[a,s,Ue,Ae,j,Z]);hf(()=>{Ce.current&&(Ce.current.indeterminate=!!j)},[j]),cg(()=>{s&&le(!1)},[s,le]),hf(()=>{const qt=Ce.current;if(!(qt!=null&&qt.form))return;const Yn=()=>{Se(!!R)};return qt.form.addEventListener("reset",Yn),()=>{var $t;return($t=qt.form)==null?void 0:$t.removeEventListener("reset",Yn)}},[]);const et=s&&!N,nt=L.useCallback(qt=>{qt.key===" "&&we(!0)},[we]),dt=L.useCallback(qt=>{qt.key===" "&&we(!1)},[we]);hf(()=>{if(!Ce.current)return;Ce.current.checked!==Ue&&Se(Ce.current.checked)},[Ce.current]);const Xe=L.useCallback((qt={},Yn=null)=>{const $t=Re=>{he&&Re.preventDefault(),we(!0)};return{...qt,ref:Yn,"data-active":Kn(rt),"data-hover":Kn(Me),"data-checked":Kn(Ue),"data-focus":Kn(he),"data-focus-visible":Kn(he&&oe),"data-indeterminate":Kn(j),"data-disabled":Kn(s),"data-invalid":Kn(d),"data-readonly":Kn(a),"aria-hidden":!0,onMouseDown:Qn(qt.onMouseDown,$t),onMouseUp:Qn(qt.onMouseUp,()=>we(!1)),onMouseEnter:Qn(qt.onMouseEnter,()=>He(!0)),onMouseLeave:Qn(qt.onMouseLeave,()=>He(!1))}},[rt,Ue,s,he,oe,Me,j,d,a]),Ct=L.useCallback((qt={},Yn=null)=>({...qt,ref:Yn,"data-active":Kn(rt),"data-hover":Kn(Me),"data-checked":Kn(Ue),"data-focus":Kn(he),"data-focus-visible":Kn(he&&oe),"data-indeterminate":Kn(j),"data-disabled":Kn(s),"data-invalid":Kn(d),"data-readonly":Kn(a)}),[rt,Ue,s,he,oe,Me,j,d,a]),dn=L.useCallback((qt={},Yn=null)=>({...ge,htmlFor:ye?f:void 0,...qt,ref:Yi(Yn,$t=>{$t&&Ne($t.tagName==="LABEL")}),onClick:Qn(qt.onClick,()=>{var $t;ye||(($t=Ce.current)==null||$t.click(),requestAnimationFrame(()=>{var Re;(Re=Ce.current)==null||Re.focus({preventScroll:!0})}))}),"data-disabled":Kn(s),"data-checked":Kn(Ue),"data-invalid":Kn(d)}),[ge,s,Ue,d,ye,f]),Ut=L.useCallback((qt={},Yn=null)=>({...qt,ref:Yi(Ce,Yn),type:"checkbox",name:G,value:H,id:f,tabIndex:te,onChange:Qn(qt.onChange,ze),onBlur:Qn(qt.onBlur,Q,()=>le(!1)),onFocus:Qn(qt.onFocus,ne,()=>le(!0)),onKeyDown:Qn(qt.onKeyDown,nt),onKeyUp:Qn(qt.onKeyUp,dt),required:l,checked:Ue,disabled:et,readOnly:a,"aria-label":K,"aria-labelledby":ee,"aria-invalid":de?!!de:d,"aria-describedby":T,"aria-disabled":s,"aria-checked":j?"mixed":Ue,style:Mke}),[G,H,f,te,ze,Q,ne,nt,dt,l,Ue,et,a,K,ee,de,d,T,s,j]),ln=L.useCallback((qt={},Yn=null)=>({...qt,ref:Yn,onMouseDown:Qn(qt.onMouseDown,Vke),"data-disabled":Kn(s),"data-checked":Kn(Ue),"data-invalid":Kn(d)}),[Ue,s,d]);return{state:{isInvalid:d,isFocused:he,isChecked:Ue,isActive:rt,isHovered:Me,isIndeterminate:j,isDisabled:s,isReadOnly:a,isRequired:l},getRootProps:dn,getCheckboxProps:Xe,getIndicatorProps:Ct,getInputProps:Ut,getLabelProps:ln,htmlProps:ge}}function Vke(r){r.preventDefault(),r.stopPropagation()}const dE=Qt(function(t,s){const{borderLeftWidth:a,borderBottomWidth:l,borderTopWidth:d,borderRightWidth:f,borderWidth:E,borderStyle:v,borderColor:T,...R}=Iu("Divider",t),{className:I,orientation:N="horizontal",__css:F,...j}=Ji(t),G={vertical:{borderLeftWidth:a||f||E||"1px",height:"100%"},horizontal:{borderBottomWidth:l||d||E||"1px",width:"100%"}};return P.jsx(Mt.hr,{ref:s,"aria-orientation":N,...j,__css:{...R,border:"0",borderColor:T,borderStyle:v,...G[N],...F},className:_n("chakra-divider",I)})});dE.displayName="Divider";const Qo=Qt(function(t,s){const{direction:a,align:l,justify:d,wrap:f,basis:E,grow:v,shrink:T,...R}=t,I={display:"flex",flexDirection:a,alignItems:l,justifyContent:d,flexWrap:f,flexBasis:E,flexGrow:v,flexShrink:T};return P.jsx(Mt.div,{ref:s,__css:I,...R})});Qo.displayName="Flex";function Fke(r,t){if(r==null)return{};var s={};for(var a in r)if({}.hasOwnProperty.call(r,a)){if(t.indexOf(a)!==-1)continue;s[a]=r[a]}return s}var ZM={exports:{}},e2,Rq;function jke(){if(Rq)return e2;Rq=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return e2=r,e2}var t2,Cq;function Bke(){if(Cq)return t2;Cq=1;var r=jke();function t(){}function s(){}return s.resetWarningCache=t,t2=function(){function a(f,E,v,T,R,I){if(I!==r){var N=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw N.name="Invariant Violation",N}}a.isRequired=a;function l(){return a}var d={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:s,resetWarningCache:t};return d.PropTypes=d,d},t2}var Iq;function Wke(){return Iq||(Iq=1,ZM.exports=Bke()()),ZM.exports}var zke=Wke();const Ur=u0(zke);var mU="data-focus-lock",vee="data-focus-lock-disabled",Gke="data-no-focus-lock",Hke="data-autofocus-inside",$ke="data-no-autofocus";function n2(r,t){return typeof r=="function"?r(t):r&&(r.current=t),r}function Kke(r,t){var s=L.useState(function(){return{value:r,callback:t,facade:{get current(){return s.value},set current(a){var l=s.value;l!==a&&(s.value=a,s.callback(a,l))}}}})[0];return s.callback=t,s.facade}var qke=typeof window<"u"?L.useLayoutEffect:L.useEffect,Aq=new WeakMap;function See(r,t){var s=Kke(null,function(a){return r.forEach(function(l){return n2(l,a)})});return qke(function(){var a=Aq.get(s);if(a){var l=new Set(a),d=new Set(r),f=s.current;l.forEach(function(E){d.has(E)||n2(E,null)}),d.forEach(function(E){l.has(E)||n2(E,f)})}Aq.set(s,r)},[r]),s}var r2={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},Nh=function(){return Nh=Object.assign||function(t){for(var s,a=1,l=arguments.length;a<l;a++){s=arguments[a];for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&(t[d]=s[d])}return t},Nh.apply(this,arguments)};function NR(r,t){var s={};for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&t.indexOf(a)<0&&(s[a]=r[a]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(r);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(r,a[l])&&(s[a[l]]=r[a[l]]);return s}function Yke(r,t,s){if(s||arguments.length===2)for(var a=0,l=t.length,d;a<l;a++)(d||!(a in t))&&(d||(d=Array.prototype.slice.call(t,0,a)),d[a]=t[a]);return r.concat(d||Array.prototype.slice.call(t))}function Tee(r){return r}function bee(r,t){t===void 0&&(t=Tee);var s=[],a=!1,l={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:r},useMedium:function(d){var f=t(d,a);return s.push(f),function(){s=s.filter(function(E){return E!==f})}},assignSyncMedium:function(d){for(a=!0;s.length;){var f=s;s=[],f.forEach(d)}s={push:function(E){return d(E)},filter:function(){return s}}},assignMedium:function(d){a=!0;var f=[];if(s.length){var E=s;s=[],E.forEach(d),f=s}var v=function(){var R=f;f=[],R.forEach(d)},T=function(){return Promise.resolve().then(v)};T(),s={push:function(R){f.push(R),T()},filter:function(R){return f=f.filter(R),s}}}};return l}function wF(r,t){return t===void 0&&(t=Tee),bee(r,t)}function wee(r){r===void 0&&(r={});var t=bee(null);return t.options=Nh({async:!0,ssr:!1},r),t}var Ree=function(r){var t=r.sideCar,s=NR(r,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=t.read();if(!a)throw new Error("Sidecar medium not found");return L.createElement(a,Nh({},s))};Ree.isSideCarExport=!0;function Xke(r,t){return r.useMedium(t),Ree}var Cee=wF({},function(r){var t=r.target,s=r.currentTarget;return{target:t,currentTarget:s}}),Iee=wF(),Jke=wF(),Qke=wee({async:!0,ssr:typeof document<"u"}),Zke=L.createContext(void 0),eNe=[],RF=L.forwardRef(function(t,s){var a,l=L.useState(),d=l[0],f=l[1],E=L.useRef(),v=L.useRef(!1),T=L.useRef(null),R=L.useState({}),I=R[1],N=t.children,F=t.disabled,j=F===void 0?!1:F,G=t.noFocusGuards,H=G===void 0?!1:G,te=t.persistentFocus,K=te===void 0?!1:te,ee=t.crossFrame,de=ee===void 0?!0:ee,se=t.autoFocus,ge=se===void 0?!0:se;t.allowTextSelection;var Z=t.group,Q=t.className,ne=t.whiteList,oe=t.hasPositiveIndices,pe=t.shards,he=pe===void 0?eNe:pe,le=t.as,Me=le===void 0?"div":le,He=t.lockProps,rt=He===void 0?{}:He,we=t.sideCar,Ce=t.returnFocus,ye=Ce===void 0?!1:Ce,Ne=t.focusOptions,Te=t.onActivation,Se=t.onDeactivation,Ae=L.useState({}),Ue=Ae[0],ze=L.useCallback(function(Yn){var $t=Yn.captureFocusRestore;if(!T.current){var Re,Fe=(Re=document)==null?void 0:Re.activeElement;T.current=Fe,Fe!==document.body&&(T.current=$t(Fe))}E.current&&Te&&Te(E.current),v.current=!0,I()},[Te]),et=L.useCallback(function(){v.current=!1,Se&&Se(E.current),I()},[Se]),nt=L.useCallback(function(Yn){var $t=T.current;if($t){var Re=(typeof $t=="function"?$t():$t)||document.body,Fe=typeof ye=="function"?ye(Re):ye;if(Fe){var Ke=typeof Fe=="object"?Fe:void 0;T.current=null,Yn?Promise.resolve().then(function(){return Re.focus(Ke)}):Re.focus(Ke)}}},[ye]),dt=L.useCallback(function(Yn){v.current&&Cee.useMedium(Yn)},[]),Xe=Iee.useMedium,Ct=L.useCallback(function(Yn){E.current!==Yn&&(E.current=Yn,f(Yn))},[]),dn=gE((a={},a[vee]=j&&"disabled",a[mU]=Z,a),rt),Ut=H!==!0,ln=Ut&&H!=="tail",Ln=See([s,Ct]),qt=L.useMemo(function(){return{observed:E,shards:he,enabled:!j,active:v.current}},[j,v.current,he,d]);return ni.createElement(L.Fragment,null,Ut&&[ni.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:j?-1:0,style:r2}),oe?ni.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:j?-1:1,style:r2}):null],!j&&ni.createElement(we,{id:Ue,sideCar:Qke,observed:d,disabled:j,persistentFocus:K,crossFrame:de,autoFocus:ge,whiteList:ne,shards:he,onActivation:ze,onDeactivation:et,returnFocus:nt,focusOptions:Ne,noFocusGuards:H}),ni.createElement(Me,gE({ref:Ln},dn,{className:Q,onBlur:Xe,onFocus:dt}),ni.createElement(Zke.Provider,{value:qt},N)),ln&&ni.createElement("div",{"data-focus-guard":!0,tabIndex:j?-1:0,style:r2}))});RF.propTypes={};function gU(r,t){return gU=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,a){return s.__proto__=a,s},gU(r,t)}function tNe(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r,gU(r,t)}function sR(r){"@babel/helpers - typeof";return sR=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sR(r)}function nNe(r,t){if(sR(r)!="object"||!r)return r;var s=r[Symbol.toPrimitive];if(s!==void 0){var a=s.call(r,t);if(sR(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(r)}function rNe(r){var t=nNe(r,"string");return sR(t)=="symbol"?t:t+""}function iNe(r,t,s){return(t=rNe(t))in r?Object.defineProperty(r,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[t]=s,r}function sNe(r,t){function s(a){return a.displayName||a.name||"Component"}return function(l){var d=[],f;function E(){f=r(d.map(function(T){return T.props})),t(f)}var v=function(T){tNe(R,T);function R(){return T.apply(this,arguments)||this}R.peek=function(){return f};var I=R.prototype;return I.componentDidMount=function(){d.push(this),E()},I.componentDidUpdate=function(){E()},I.componentWillUnmount=function(){var F=d.indexOf(this);d.splice(F,1),E()},I.render=function(){return ni.createElement(l,this.props)},R}(L.PureComponent);return iNe(v,"displayName","SideEffect("+s(l)+")"),v}}var Qh=function(r){for(var t=Array(r.length),s=0;s<r.length;++s)t[s]=r[s];return t},EE=function(r){return Array.isArray(r)?r:[r]},Aee=function(r){return Array.isArray(r)?r[0]:r},oNe=function(r){if(r.nodeType!==Node.ELEMENT_NODE)return!1;var t=window.getComputedStyle(r,null);return!t||!t.getPropertyValue?!1:t.getPropertyValue("display")==="none"||t.getPropertyValue("visibility")==="hidden"},Pee=function(r){return r.parentNode&&r.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?r.parentNode.host:r.parentNode},Oee=function(r){return r===document||r&&r.nodeType===Node.DOCUMENT_NODE},aNe=function(r){return r.hasAttribute("inert")},cNe=function(r,t){return!r||Oee(r)||!oNe(r)&&!aNe(r)&&t(Pee(r))},kee=function(r,t){var s=r.get(t);if(s!==void 0)return s;var a=cNe(t,kee.bind(void 0,r));return r.set(t,a),a},lNe=function(r,t){return r&&!Oee(r)?hNe(r)?t(Pee(r)):!1:!0},Nee=function(r,t){var s=r.get(t);if(s!==void 0)return s;var a=lNe(t,Nee.bind(void 0,r));return r.set(t,a),a},Dee=function(r){return r.dataset},uNe=function(r){return r.tagName==="BUTTON"},Lee=function(r){return r.tagName==="INPUT"},xee=function(r){return Lee(r)&&r.type==="radio"},dNe=function(r){return!((Lee(r)||uNe(r))&&(r.type==="hidden"||r.disabled))},hNe=function(r){var t=r.getAttribute($ke);return![!0,"true",""].includes(t)},CF=function(r){var t;return!!(r&&(!((t=Dee(r))===null||t===void 0)&&t.focusGuard))},_U=function(r){return!CF(r)},pNe=function(r){return!!r},fNe=function(r,t){var s=Math.max(0,r.tabIndex),a=Math.max(0,t.tabIndex),l=s-a,d=r.index-t.index;if(l){if(!s)return 1;if(!a)return-1}return l||d},mNe=function(r){return r.tabIndex<0&&!r.hasAttribute("tabindex")?0:r.tabIndex},IF=function(r,t,s){return Qh(r).map(function(a,l){var d=mNe(a);return{node:a,index:l,tabIndex:s&&d===-1?(a.dataset||{}).focusGuard?0:-1:d}}).filter(function(a){return!t||a.tabIndex>=0}).sort(fNe)},gNe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],AF=gNe.join(","),_Ne="".concat(AF,", [data-focus-guard]"),Mee=function(r,t){return Qh((r.shadowRoot||r).children).reduce(function(s,a){return s.concat(a.matches(t?_Ne:AF)?[a]:[],Mee(a))},[])},ENe=function(r,t){var s;return r instanceof HTMLIFrameElement&&(!((s=r.contentDocument)===null||s===void 0)&&s.body)?XS([r.contentDocument.body],t):[r]},XS=function(r,t){return r.reduce(function(s,a){var l,d=Mee(a,t),f=(l=[]).concat.apply(l,d.map(function(E){return ENe(E,t)}));return s.concat(f,a.parentNode?Qh(a.parentNode.querySelectorAll(AF)).filter(function(E){return E===a}):[])},[])},yNe=function(r){var t=r.querySelectorAll("[".concat(Hke,"]"));return Qh(t).map(function(s){return XS([s])}).reduce(function(s,a){return s.concat(a)},[])},PF=function(r,t){return Qh(r).filter(function(s){return kee(t,s)}).filter(function(s){return dNe(s)})},Pq=function(r,t){return t===void 0&&(t=new Map),Qh(r).filter(function(s){return Nee(t,s)})},OF=function(r,t,s){return IF(PF(XS(r,s),t),!0,s)},oR=function(r,t){return IF(PF(XS(r),t),!1)},vNe=function(r,t){return PF(yNe(r),t)},hE=function(r,t){return r.shadowRoot?hE(r.shadowRoot,t):Object.getPrototypeOf(r).contains!==void 0&&Object.getPrototypeOf(r).contains.call(r,t)?!0:Qh(r.children).some(function(s){var a;if(s instanceof HTMLIFrameElement){var l=(a=s.contentDocument)===null||a===void 0?void 0:a.body;return l?hE(l,t):!1}return hE(s,t)})},SNe=function(r){for(var t=new Set,s=r.length,a=0;a<s;a+=1)for(var l=a+1;l<s;l+=1){var d=r[a].compareDocumentPosition(r[l]);(d&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&t.add(l),(d&Node.DOCUMENT_POSITION_CONTAINS)>0&&t.add(a)}return r.filter(function(f,E){return!t.has(E)})},Uee=function(r){return r.parentNode?Uee(r.parentNode):r},kF=function(r){var t=EE(r);return t.filter(Boolean).reduce(function(s,a){var l=a.getAttribute(mU);return s.push.apply(s,l?SNe(Qh(Uee(a).querySelectorAll("[".concat(mU,'="').concat(l,'"]:not([').concat(vee,'="disabled"])')))):[a]),s},[])},TNe=function(r){try{return r()}catch{return}},aR=function(r){if(r===void 0&&(r=document),!(!r||!r.activeElement)){var t=r.activeElement;return t.shadowRoot?aR(t.shadowRoot):t instanceof HTMLIFrameElement&&TNe(function(){return t.contentWindow.document})?aR(t.contentWindow.document):t}},bNe=function(r,t){return r===t},wNe=function(r,t){return!!Qh(r.querySelectorAll("iframe")).some(function(s){return bNe(s,t)})},Vee=function(r,t){return t===void 0&&(t=aR(Aee(r).ownerDocument)),!t||t.dataset&&t.dataset.focusGuard?!1:kF(r).some(function(s){return hE(s,t)||wNe(s,t)})},RNe=function(r){r===void 0&&(r=document);var t=aR(r);return t?Qh(r.querySelectorAll("[".concat(Gke,"]"))).some(function(s){return hE(s,t)}):!1},CNe=function(r,t){return t.filter(xee).filter(function(s){return s.name===r.name}).filter(function(s){return s.checked})[0]||r},NF=function(r,t){return xee(r)&&r.name?CNe(r,t):r},INe=function(r){var t=new Set;return r.forEach(function(s){return t.add(NF(s,r))}),r.filter(function(s){return t.has(s)})},Oq=function(r){return r[0]&&r.length>1?NF(r[0],r):r[0]},kq=function(r,t){return r.indexOf(NF(t,r))},EU="NEW_FOCUS",ANe=function(r,t,s,a,l){var d=r.length,f=r[0],E=r[d-1],v=CF(a);if(!(a&&r.indexOf(a)>=0)){var T=a!==void 0?s.indexOf(a):-1,R=l?s.indexOf(l):T,I=l?r.indexOf(l):-1;if(T===-1)return I!==-1?I:EU;if(I===-1)return EU;var N=T-R,F=s.indexOf(f),j=s.indexOf(E),G=INe(s),H=a!==void 0?G.indexOf(a):-1,te=l?G.indexOf(l):H,K=G.filter(function(Q){return Q.tabIndex>=0}),ee=a!==void 0?K.indexOf(a):-1,de=l?K.indexOf(l):ee,se=ee>=0&&de>=0?de-ee:te-H;if(!N&&I>=0||t.length===0)return I;var ge=kq(r,t[0]),Z=kq(r,t[t.length-1]);if(T<=F&&v&&Math.abs(N)>1)return Z;if(T>=j&&v&&Math.abs(N)>1)return ge;if(N&&Math.abs(se)>1)return I;if(T<=F)return Z;if(T>j)return ge;if(N)return Math.abs(N)>1?I:(d+I+N)%d}},PNe=function(r){return function(t){var s,a=(s=Dee(t))===null||s===void 0?void 0:s.autofocus;return t.autofocus||a!==void 0&&a!=="false"||r.indexOf(t)>=0}},Nq=function(r,t,s){var a=r.map(function(d){var f=d.node;return f}),l=Pq(a.filter(PNe(s)));return l&&l.length?Oq(l):Oq(Pq(t))},yU=function(r,t){return t===void 0&&(t=[]),t.push(r),r.parentNode&&yU(r.parentNode.host||r.parentNode,t),t},i2=function(r,t){for(var s=yU(r),a=yU(t),l=0;l<s.length;l+=1){var d=s[l];if(a.indexOf(d)>=0)return d}return!1},Fee=function(r,t,s){var a=EE(r),l=EE(t),d=a[0],f=!1;return l.filter(Boolean).forEach(function(E){f=i2(f||E,E)||f,s.filter(Boolean).forEach(function(v){var T=i2(d,v);T&&(!f||hE(T,f)?f=T:f=i2(T,f))})}),f},Dq=function(r,t){return r.reduce(function(s,a){return s.concat(vNe(a,t))},[])},ONe=function(r,t){var s=new Map;return t.forEach(function(a){return s.set(a.node,a)}),r.map(function(a){return s.get(a)}).filter(pNe)},kNe=function(r,t){var s=aR(EE(r).length>0?document:Aee(r).ownerDocument),a=kF(r).filter(_U),l=Fee(s||r,r,a),d=new Map,f=oR(a,d),E=f.filter(function(j){var G=j.node;return _U(G)});if(E[0]){var v=oR([l],d).map(function(j){var G=j.node;return G}),T=ONe(v,E),R=T.map(function(j){var G=j.node;return G}),I=T.filter(function(j){var G=j.tabIndex;return G>=0}).map(function(j){var G=j.node;return G}),N=ANe(R,I,v,s,t);if(N===EU){var F=Nq(f,I,Dq(a,d))||Nq(f,R,Dq(a,d));if(F)return{node:F};console.warn("focus-lock: cannot find any node to move focus into");return}return N===void 0?N:T[N]}},NNe=function(r){var t=kF(r).filter(_U),s=Fee(r,r,t),a=IF(XS([s],!0),!0,!0),l=XS(t,!1);return a.map(function(d){var f=d.node,E=d.index;return{node:f,index:E,lockItem:l.indexOf(f)>=0,guard:CF(f)}})},DF=function(r,t){r&&("focus"in r&&r.focus(t),"contentWindow"in r&&r.contentWindow&&r.contentWindow.focus())},s2=0,o2=!1,jee=function(r,t,s){s===void 0&&(s={});var a=kNe(r,t);if(!o2&&a){if(s2>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),o2=!0,setTimeout(function(){o2=!1},1);return}s2++,DF(a.node,s.focusOptions),s2--}};function qb(r){if(!r)return null;if(typeof WeakRef>"u")return function(){return r||null};var t=r?new WeakRef(r):null;return function(){return(t==null?void 0:t.deref())||null}}var DNe=function(r){if(!r)return null;for(var t=[],s=r;s&&s!==document.body;)t.push({current:qb(s),parent:qb(s.parentElement),left:qb(s.previousElementSibling),right:qb(s.nextElementSibling)}),s=s.parentElement;return{element:qb(r),stack:t,ownerDocument:r.ownerDocument}},LNe=function(r){var t,s,a,l,d;if(r)for(var f=r.stack,E=r.ownerDocument,v=new Map,T=0,R=f;T<R.length;T++){var I=R[T],N=(t=I.parent)===null||t===void 0?void 0:t.call(I);if(N&&E.contains(N)){for(var F=(s=I.left)===null||s===void 0?void 0:s.call(I),j=I.current(),G=N.contains(j)?j:void 0,H=(a=I.right)===null||a===void 0?void 0:a.call(I),te=OF([N],v),K=(d=(l=G??(F==null?void 0:F.nextElementSibling))!==null&&l!==void 0?l:H)!==null&&d!==void 0?d:F;K;){for(var ee=0,de=te;ee<de.length;ee++){var se=de[ee];if(K!=null&&K.contains(se.node))return se.node}K=K.nextElementSibling}if(te.length)return te[0].node}}},Bee=function(r){var t=DNe(r);return function(){return LNe(t)}},xNe=function(r,t,s){if(!r||!t)return console.error("no element or scope given"),{};var a=EE(t);if(a.every(function(f){return!hE(f,r)}))return console.error("Active element is not contained in the scope"),{};var l=s?OF(a,new Map):oR(a,new Map),d=l.findIndex(function(f){var E=f.node;return E===r});if(d!==-1)return{prev:l[d-1],next:l[d+1],first:l[0],last:l[l.length-1]}},MNe=function(r,t){var s=t?OF(EE(r),new Map):oR(EE(r),new Map);return{first:s[0],last:s[s.length-1]}},UNe=function(r){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},r)},Wee=function(r,t,s){t===void 0&&(t={});var a=UNe(t),l=xNe(r,a.scope,a.onlyTabbable);if(l){var d=s(l,a.cycle);d&&DF(d.node,a.focusOptions)}},VNe=function(r,t){t===void 0&&(t={}),Wee(r,t,function(s,a){var l=s.next,d=s.first;return l||a&&d})},FNe=function(r,t){t===void 0&&(t={}),Wee(r,t,function(s,a){var l=s.prev,d=s.last;return l||a&&d})},zee=function(r,t,s){var a,l=MNe(r,(a=t.onlyTabbable)!==null&&a!==void 0?a:!0),d=l[s];d&&DF(d.node,t.focusOptions)},jNe=function(r,t){t===void 0&&(t={}),zee(r,t,"first")},BNe=function(r,t){t===void 0&&(t={}),zee(r,t,"last")};function LF(r){setTimeout(r,1)}var WNe=function(t){return t&&"current"in t?t.current:t},Gee=function(){return document&&document.activeElement===document.body},zNe=function(){return Gee()||RNe()},DS=null,Fc=null,Lq=function(){return null},LS=null,cR=!1,xF=!1,GNe=function(){return!0},HNe=function(t){return(DS.whiteList||GNe)(t)},$Ne=function(t,s){LS={observerNode:t,portaledElement:s}},KNe=function(t){return LS&&LS.portaledElement===t};function xq(r,t,s,a){var l=null,d=r;do{var f=a[d];if(f.guard)f.node.dataset.focusAutoGuard&&(l=f);else if(f.lockItem){if(d!==r)return;l=null}else break}while((d+=s)!==t);l&&(l.node.tabIndex=0)}var qNe=function(t){return t?!!cR:cR==="meanwhile"},YNe=function r(t,s,a){return s&&(s.host===t&&(!s.activeElement||a.contains(s.activeElement))||s.parentNode&&r(t,s.parentNode,a))},XNe=function(t,s){return s.some(function(a){return YNe(t,a,a)})},Hee=function(t){return oR(t,new Map)},JNe=function(t){return!Hee([t.parentNode]).some(function(s){return s.node===t})},dk=function(){var t=!1;if(DS){var s=DS,a=s.observed,l=s.persistentFocus,d=s.autoFocus,f=s.shards,E=s.crossFrame,v=s.focusOptions,T=s.noFocusGuards,R=a||LS&&LS.portaledElement;if(Gee()&&Fc&&Fc!==document.body&&(!document.body.contains(Fc)||JNe(Fc))){var I=Lq();I&&I.focus()}var N=document&&document.activeElement;if(R){var F=[R].concat(f.map(WNe).filter(Boolean)),j=function(){if(!qNe(E)||!T||!Fc||xF)return!1;var ee=Hee(F),de=ee.findIndex(function(se){var ge=se.node;return ge===Fc});return de===0||de===ee.length-1};if((!N||HNe(N))&&(l||j()||!zNe()||!Fc&&d)&&(R&&!(Vee(F)||N&&XNe(N,F)||KNe(N))&&(document&&!Fc&&N&&!d?(N.blur&&N.blur(),document.body.focus()):(t=jee(F,Fc,{focusOptions:v}),LS={})),Fc=document&&document.activeElement,Fc!==document.body&&(Lq=Bee(Fc)),cR=!1),document&&N!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var G=document&&document.activeElement,H=NNe(F),te=H.map(function(K){var ee=K.node;return ee}).indexOf(G);te>-1&&(H.filter(function(K){var ee=K.guard,de=K.node;return ee&&de.dataset.focusAutoGuard}).forEach(function(K){var ee=K.node;return ee.removeAttribute("tabIndex")}),xq(te,H.length,1,H),xq(te,-1,-1,H))}}}return t},$ee=function(t){dk()&&t&&(t.stopPropagation(),t.preventDefault())},MF=function(){return LF(dk)},QNe=function(t){var s=t.target,a=t.currentTarget;a.contains(s)||$Ne(a,s)},ZNe=function(){return null},Kee=function(){xF=!0},qee=function(){xF=!1,cR="just",LF(function(){cR="meanwhile"})},e1e=function(){document.addEventListener("focusin",$ee),document.addEventListener("focusout",MF),window.addEventListener("focus",Kee),window.addEventListener("blur",qee)},t1e=function(){document.removeEventListener("focusin",$ee),document.removeEventListener("focusout",MF),window.removeEventListener("focus",Kee),window.removeEventListener("blur",qee)};function n1e(r){return r.filter(function(t){var s=t.disabled;return!s})}var Yee={moveFocusInside:jee,focusInside:Vee,focusNextElement:VNe,focusPrevElement:FNe,focusFirstElement:jNe,focusLastElement:BNe,captureFocusRestore:Bee};function r1e(r){var t=r.slice(-1)[0];t&&!DS&&e1e();var s=DS,a=s&&t&&t.id===s.id;DS=t,s&&!a&&(s.onDeactivation(),r.filter(function(l){var d=l.id;return d===s.id}).length||s.returnFocus(!t)),t?(Fc=null,(!a||s.observed!==t.observed)&&t.onActivation(Yee),dk(),LF(dk)):(t1e(),Fc=null)}Cee.assignSyncMedium(QNe);Iee.assignMedium(MF);Jke.assignMedium(function(r){return r(Yee)});const i1e=sNe(n1e,r1e)(ZNe);var vU=L.forwardRef(function(t,s){return ni.createElement(RF,gE({sideCar:i1e,ref:s},t))}),Xee=RF.propTypes||{};Xee.sideCar;Fke(Xee,["sideCar"]);vU.propTypes={};const s1e=vU.default??vU,Jee=r=>{const{initialFocusRef:t,finalFocusRef:s,contentRef:a,restoreFocus:l,children:d,isDisabled:f,autoFocus:E,persistentFocus:v,lockFocusAcrossFrames:T}=r,R=L.useCallback(()=>{t!=null&&t.current?t.current.focus():a!=null&&a.current&&xJ(a.current).length===0&&requestAnimationFrame(()=>{var j;(j=a.current)==null||j.focus()})},[t,a]),I=L.useCallback(()=>{var F;(F=s==null?void 0:s.current)==null||F.focus()},[s]),N=l&&!s;return P.jsx(s1e,{crossFrame:T,persistentFocus:v,autoFocus:E,disabled:f,onActivation:R,onDeactivation:I,returnFocus:N,children:d})};Jee.displayName="FocusLock";const[o1e,a1e]=Wi({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),tf=Qt((r,t)=>{const s=Qc("FormError",r),a=Ji(r),l=_0();return l!=null&&l.isInvalid?P.jsx(o1e,{value:s,children:P.jsx(Mt.div,{...l==null?void 0:l.getErrorMessageProps(a,t),className:_n("chakra-form__error-message",r.className),__css:{display:"flex",alignItems:"center",...s.text}})}):null});tf.displayName="FormErrorMessage";const c1e=Qt((r,t)=>{const s=a1e(),a=_0();if(!(a!=null&&a.isInvalid))return null;const l=_n("chakra-form__error-icon",r.className);return P.jsx(Wn,{ref:t,"aria-hidden":!0,...r,__css:s.icon,className:l,children:P.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});c1e.displayName="FormErrorIcon";const Eu=Qt(function(t,s){const a=Iu("FormLabel",t),l=Ji(t),{className:d,children:f,requiredIndicator:E=P.jsx(Qee,{}),optionalIndicator:v=null,...T}=l,R=_0(),I=(R==null?void 0:R.getLabelProps(T,s))??{ref:s,...T};return P.jsxs(Mt.label,{...I,className:_n("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...a},children:[f,R!=null&&R.isRequired?E:v]})});Eu.displayName="FormLabel";const Qee=Qt(function(t,s){const a=_0(),l=Eee();if(!(a!=null&&a.isRequired))return null;const d=_n("chakra-form__required-indicator",t.className);return P.jsx(Mt.span,{...a==null?void 0:a.getRequiredIndicatorProps(t,s),__css:l.requiredIndicator,className:d})});Qee.displayName="RequiredIndicator";const Zee=Qt(function(t,s){const{templateAreas:a,gap:l,rowGap:d,columnGap:f,column:E,row:v,autoFlow:T,autoRows:R,templateRows:I,autoColumns:N,templateColumns:F,...j}=t,G={display:"grid",gridTemplateAreas:a,gridGap:l,gridRowGap:d,gridColumnGap:f,gridAutoColumns:N,gridColumn:E,gridRow:v,gridAutoFlow:T,gridAutoRows:R,gridTemplateRows:I,gridTemplateColumns:F};return P.jsx(Mt.div,{ref:s,__css:G,...j})});Zee.displayName="Grid";const ete=Qt(function(t,s){const{columns:a,spacingX:l,spacingY:d,spacing:f,minChildWidth:E,...v}=t,T=g0(),R=E?u1e(E,T):d1e(a);return P.jsx(Zee,{ref:s,gap:f,columnGap:l,rowGap:d,templateColumns:R,...v})});ete.displayName="SimpleGrid";function l1e(r){return typeof r=="number"?`${r}px`:r}function u1e(r,t){return EV(r,s=>{const a=zOe("sizes",s,l1e(s))(t);return s===null?null:`repeat(auto-fit, minmax(${a}, 1fr))`})}function d1e(r){return EV(r,t=>t===null?null:`repeat(${t}, minmax(0, 1fr))`)}function DR(r){const{viewBox:t="0 0 24 24",d:s,displayName:a,defaultProps:l={}}=r,d=L.Children.toArray(r.path),f=Qt((E,v)=>P.jsx(Wn,{ref:v,viewBox:t,...l,...E,children:d.length?d:P.jsx("path",{fill:"currentColor",d:s})}));return f.displayName=a,f}const SU=Qt(function(t,s){const{htmlWidth:a,htmlHeight:l,alt:d,...f}=t;return P.jsx("img",{width:a,height:l,ref:s,alt:d,...f})});SU.displayName="NativeImage";const xh=Qt(function(t,s){const{fallbackSrc:a,fallback:l,src:d,srcSet:f,align:E,fit:v,loading:T,ignoreFallback:R,crossOrigin:I,fallbackStrategy:N="beforeLoadOrError",referrerPolicy:F,...j}=t,G=a!==void 0||l!==void 0,H=T!=null||R||!G,te=mee({...t,crossOrigin:I,ignoreFallback:H}),K=yke(te,N),ee={ref:s,objectFit:v,objectPosition:E,...H?j:d0(j,["onError","onLoad"])};return K?l||P.jsx(Mt.img,{as:SU,className:"chakra-image__placeholder",src:a,...ee}):P.jsx(Mt.img,{as:SU,src:d,srcSet:f,crossOrigin:I,loading:T,referrerPolicy:F,className:"chakra-image",...ee})});xh.displayName="Image";const To=Qt(function(t,s){const{htmlSize:a,...l}=t,d=Qc("Input",l),f=Ji(l),E=bF(f),v=_n("chakra-input",t.className);return P.jsx(Mt.input,{size:a,...E,__css:d.field,ref:s,className:v})});To.displayName="Input";To.id="Input";const[h1e,p1e]=Wi({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),kO=Qt(function(t,s){const a=Qc("Input",t),{children:l,className:d,...f}=Ji(t),E=_n("chakra-input__group",d),v={},T=gV(l),R=a.field;T.forEach(N=>{a&&(R&&N.type.id==="InputLeftElement"&&(v.paddingStart=R.height??R.h),R&&N.type.id==="InputRightElement"&&(v.paddingEnd=R.height??R.h),N.type.id==="InputRightAddon"&&(v.borderEndRadius=0),N.type.id==="InputLeftAddon"&&(v.borderStartRadius=0))});const I=T.map(N=>{var j,G;const F=Wk({size:((j=N.props)==null?void 0:j.size)||t.size,variant:((G=N.props)==null?void 0:G.variant)||t.variant});return N.type.id!=="Input"?L.cloneElement(N,F):L.cloneElement(N,Object.assign(F,v,N.props))});return P.jsx(Mt.div,{className:E,ref:s,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...a.group},"data-group":!0,...f,children:P.jsx(h1e,{value:a,children:I})})});kO.displayName="InputGroup";const f1e=Mt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),iN=Qt(function(t,s){const{placement:a="left",...l}=t,d=p1e(),f=d.field,v={[a==="left"?"insetStart":"insetEnd"]:"0",width:(f==null?void 0:f.height)??(f==null?void 0:f.h),height:(f==null?void 0:f.height)??(f==null?void 0:f.h),fontSize:f==null?void 0:f.fontSize,...d.element};return P.jsx(f1e,{ref:s,__css:v,...l})});iN.id="InputElement";iN.displayName="InputElement";const Mw=Qt(function(t,s){const{className:a,...l}=t,d=_n("chakra-input__left-element",a);return P.jsx(iN,{ref:s,placement:"left",className:d,...l})});Mw.id="InputLeftElement";Mw.displayName="InputLeftElement";const tte=Qt(function(t,s){const{className:a,...l}=t,d=_n("chakra-input__right-element",a);return P.jsx(iN,{ref:s,placement:"right",className:d,...l})});tte.id="InputRightElement";tte.displayName="InputRightElement";const vu=Qt(function(t,s){const a=Iu("Link",t),{className:l,isExternal:d,...f}=Ji(t);return P.jsx(Mt.a,{target:d?"_blank":void 0,rel:d?"noopener":void 0,ref:s,className:_n("chakra-link",l),...f,__css:a})});vu.displayName="Link";function m1e(r,t={}){const{ssr:s=!0,fallback:a}=t,{getWindow:l}=$Re(),d=Array.isArray(r)?r:[r];let f=Array.isArray(a)?a:[a];f=f.filter(T=>T!=null);const[E,v]=L.useState(()=>d.map((T,R)=>({media:T,matches:s?!!f[R]:l().matchMedia(T).matches})));return L.useEffect(()=>{const T=l();v(d.map(N=>({media:N,matches:T.matchMedia(N).matches})));const R=d.map(N=>T.matchMedia(N)),I=N=>{v(F=>F.slice().map(j=>j.media===N.media?{...j,matches:N.matches}:j))};return R.forEach(N=>{typeof N.addListener=="function"?N.addListener(I):N.addEventListener("change",I)}),()=>{R.forEach(N=>{typeof N.removeListener=="function"?N.removeListener(I):N.removeEventListener("change",I)})}},[l]),E.map(T=>T.matches)}function g1e(r,t,s,a){if(t==null)return a;if(!a)return r.find(f=>s(f).toLowerCase().startsWith(t.toLowerCase()));const l=r.filter(d=>s(d).toLowerCase().startsWith(t.toLowerCase()));if(l.length>0){let d;return l.includes(a)?(d=l.indexOf(a)+1,d===l.length&&(d=0),l[d]):(d=r.indexOf(l[0]),r[d])}return a}function _1e(r){const{key:t}=r;return t.length===1||t.length>1&&/[^a-zA-Z0-9]/.test(t)}function E1e(r={}){const{timeout:t=300,preventDefault:s=()=>!0}=r,[a,l]=L.useState([]),d=L.useRef(void 0),f=()=>{d.current&&(clearTimeout(d.current),d.current=null)},E=()=>{f(),d.current=setTimeout(()=>{l([]),d.current=null},t)};L.useEffect(()=>f,[]);function v(T){return R=>{if(R.key==="Backspace"){const I=[...a];I.pop(),l(I);return}if(_1e(R)){const I=a.concat(R.key);s(R)&&(R.preventDefault(),R.stopPropagation()),l(I),T(I.join("")),E()}}}return v}var Kc="top",wu="bottom",Ru="right",qc="left",UF="auto",LR=[Kc,wu,Ru,qc],JS="start",lR="end",y1e="clippingParents",nte="viewport",Yb="popper",v1e="reference",Mq=LR.reduce(function(r,t){return r.concat([t+"-"+JS,t+"-"+lR])},[]),rte=[].concat(LR,[UF]).reduce(function(r,t){return r.concat([t,t+"-"+JS,t+"-"+lR])},[]),S1e="beforeRead",T1e="read",b1e="afterRead",w1e="beforeMain",R1e="main",C1e="afterMain",I1e="beforeWrite",A1e="write",P1e="afterWrite",O1e=[S1e,T1e,b1e,w1e,R1e,C1e,I1e,A1e,P1e];function Yh(r){return r?(r.nodeName||"").toLowerCase():null}function Ol(r){if(r==null)return window;if(r.toString()!=="[object Window]"){var t=r.ownerDocument;return t&&t.defaultView||window}return r}function yE(r){var t=Ol(r).Element;return r instanceof t||r instanceof Element}function Tu(r){var t=Ol(r).HTMLElement;return r instanceof t||r instanceof HTMLElement}function VF(r){if(typeof ShadowRoot>"u")return!1;var t=Ol(r).ShadowRoot;return r instanceof t||r instanceof ShadowRoot}function k1e(r){var t=r.state;Object.keys(t.elements).forEach(function(s){var a=t.styles[s]||{},l=t.attributes[s]||{},d=t.elements[s];!Tu(d)||!Yh(d)||(Object.assign(d.style,a),Object.keys(l).forEach(function(f){var E=l[f];E===!1?d.removeAttribute(f):d.setAttribute(f,E===!0?"":E)}))})}function N1e(r){var t=r.state,s={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,s.popper),t.styles=s,t.elements.arrow&&Object.assign(t.elements.arrow.style,s.arrow),function(){Object.keys(t.elements).forEach(function(a){var l=t.elements[a],d=t.attributes[a]||{},f=Object.keys(t.styles.hasOwnProperty(a)?t.styles[a]:s[a]),E=f.reduce(function(v,T){return v[T]="",v},{});!Tu(l)||!Yh(l)||(Object.assign(l.style,E),Object.keys(d).forEach(function(v){l.removeAttribute(v)}))})}}const D1e={name:"applyStyles",enabled:!0,phase:"write",fn:k1e,effect:N1e,requires:["computeStyles"]};function Wh(r){return r.split("-")[0]}var pE=Math.max,hk=Math.min,QS=Math.round;function TU(){var r=navigator.userAgentData;return r!=null&&r.brands&&Array.isArray(r.brands)?r.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function ite(){return!/^((?!chrome|android).)*safari/i.test(TU())}function ZS(r,t,s){t===void 0&&(t=!1),s===void 0&&(s=!1);var a=r.getBoundingClientRect(),l=1,d=1;t&&Tu(r)&&(l=r.offsetWidth>0&&QS(a.width)/r.offsetWidth||1,d=r.offsetHeight>0&&QS(a.height)/r.offsetHeight||1);var f=yE(r)?Ol(r):window,E=f.visualViewport,v=!ite()&&s,T=(a.left+(v&&E?E.offsetLeft:0))/l,R=(a.top+(v&&E?E.offsetTop:0))/d,I=a.width/l,N=a.height/d;return{width:I,height:N,top:R,right:T+I,bottom:R+N,left:T,x:T,y:R}}function FF(r){var t=ZS(r),s=r.offsetWidth,a=r.offsetHeight;return Math.abs(t.width-s)<=1&&(s=t.width),Math.abs(t.height-a)<=1&&(a=t.height),{x:r.offsetLeft,y:r.offsetTop,width:s,height:a}}function ste(r,t){var s=t.getRootNode&&t.getRootNode();if(r.contains(t))return!0;if(s&&VF(s)){var a=t;do{if(a&&r.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function Sf(r){return Ol(r).getComputedStyle(r)}function L1e(r){return["table","td","th"].indexOf(Yh(r))>=0}function vg(r){return((yE(r)?r.ownerDocument:r.document)||window.document).documentElement}function sN(r){return Yh(r)==="html"?r:r.assignedSlot||r.parentNode||(VF(r)?r.host:null)||vg(r)}function Uq(r){return!Tu(r)||Sf(r).position==="fixed"?null:r.offsetParent}function x1e(r){var t=/firefox/i.test(TU()),s=/Trident/i.test(TU());if(s&&Tu(r)){var a=Sf(r);if(a.position==="fixed")return null}var l=sN(r);for(VF(l)&&(l=l.host);Tu(l)&&["html","body"].indexOf(Yh(l))<0;){var d=Sf(l);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||t&&d.willChange==="filter"||t&&d.filter&&d.filter!=="none")return l;l=l.parentNode}return null}function xR(r){for(var t=Ol(r),s=Uq(r);s&&L1e(s)&&Sf(s).position==="static";)s=Uq(s);return s&&(Yh(s)==="html"||Yh(s)==="body"&&Sf(s).position==="static")?t:s||x1e(r)||t}function jF(r){return["top","bottom"].indexOf(r)>=0?"x":"y"}function Uw(r,t,s){return pE(r,hk(t,s))}function M1e(r,t,s){var a=Uw(r,t,s);return a>s?s:a}function ote(){return{top:0,right:0,bottom:0,left:0}}function ate(r){return Object.assign({},ote(),r)}function cte(r,t){return t.reduce(function(s,a){return s[a]=r,s},{})}var U1e=function(t,s){return t=typeof t=="function"?t(Object.assign({},s.rects,{placement:s.placement})):t,ate(typeof t!="number"?t:cte(t,LR))};function V1e(r){var t,s=r.state,a=r.name,l=r.options,d=s.elements.arrow,f=s.modifiersData.popperOffsets,E=Wh(s.placement),v=jF(E),T=[qc,Ru].indexOf(E)>=0,R=T?"height":"width";if(!(!d||!f)){var I=U1e(l.padding,s),N=FF(d),F=v==="y"?Kc:qc,j=v==="y"?wu:Ru,G=s.rects.reference[R]+s.rects.reference[v]-f[v]-s.rects.popper[R],H=f[v]-s.rects.reference[v],te=xR(d),K=te?v==="y"?te.clientHeight||0:te.clientWidth||0:0,ee=G/2-H/2,de=I[F],se=K-N[R]-I[j],ge=K/2-N[R]/2+ee,Z=Uw(de,ge,se),Q=v;s.modifiersData[a]=(t={},t[Q]=Z,t.centerOffset=Z-ge,t)}}function F1e(r){var t=r.state,s=r.options,a=s.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=t.elements.popper.querySelector(l),!l)||ste(t.elements.popper,l)&&(t.elements.arrow=l))}const j1e={name:"arrow",enabled:!0,phase:"main",fn:V1e,effect:F1e,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function e0(r){return r.split("-")[1]}var B1e={top:"auto",right:"auto",bottom:"auto",left:"auto"};function W1e(r,t){var s=r.x,a=r.y,l=t.devicePixelRatio||1;return{x:QS(s*l)/l||0,y:QS(a*l)/l||0}}function Vq(r){var t,s=r.popper,a=r.popperRect,l=r.placement,d=r.variation,f=r.offsets,E=r.position,v=r.gpuAcceleration,T=r.adaptive,R=r.roundOffsets,I=r.isFixed,N=f.x,F=N===void 0?0:N,j=f.y,G=j===void 0?0:j,H=typeof R=="function"?R({x:F,y:G}):{x:F,y:G};F=H.x,G=H.y;var te=f.hasOwnProperty("x"),K=f.hasOwnProperty("y"),ee=qc,de=Kc,se=window;if(T){var ge=xR(s),Z="clientHeight",Q="clientWidth";if(ge===Ol(s)&&(ge=vg(s),Sf(ge).position!=="static"&&E==="absolute"&&(Z="scrollHeight",Q="scrollWidth")),ge=ge,l===Kc||(l===qc||l===Ru)&&d===lR){de=wu;var ne=I&&ge===se&&se.visualViewport?se.visualViewport.height:ge[Z];G-=ne-a.height,G*=v?1:-1}if(l===qc||(l===Kc||l===wu)&&d===lR){ee=Ru;var oe=I&&ge===se&&se.visualViewport?se.visualViewport.width:ge[Q];F-=oe-a.width,F*=v?1:-1}}var pe=Object.assign({position:E},T&&B1e),he=R===!0?W1e({x:F,y:G},Ol(s)):{x:F,y:G};if(F=he.x,G=he.y,v){var le;return Object.assign({},pe,(le={},le[de]=K?"0":"",le[ee]=te?"0":"",le.transform=(se.devicePixelRatio||1)<=1?"translate("+F+"px, "+G+"px)":"translate3d("+F+"px, "+G+"px, 0)",le))}return Object.assign({},pe,(t={},t[de]=K?G+"px":"",t[ee]=te?F+"px":"",t.transform="",t))}function z1e(r){var t=r.state,s=r.options,a=s.gpuAcceleration,l=a===void 0?!0:a,d=s.adaptive,f=d===void 0?!0:d,E=s.roundOffsets,v=E===void 0?!0:E,T={placement:Wh(t.placement),variation:e0(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:l,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,Vq(Object.assign({},T,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:f,roundOffsets:v})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,Vq(Object.assign({},T,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:v})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const G1e={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:z1e,data:{}};var QP={passive:!0};function H1e(r){var t=r.state,s=r.instance,a=r.options,l=a.scroll,d=l===void 0?!0:l,f=a.resize,E=f===void 0?!0:f,v=Ol(t.elements.popper),T=[].concat(t.scrollParents.reference,t.scrollParents.popper);return d&&T.forEach(function(R){R.addEventListener("scroll",s.update,QP)}),E&&v.addEventListener("resize",s.update,QP),function(){d&&T.forEach(function(R){R.removeEventListener("scroll",s.update,QP)}),E&&v.removeEventListener("resize",s.update,QP)}}const $1e={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:H1e,data:{}};var K1e={left:"right",right:"left",bottom:"top",top:"bottom"};function NO(r){return r.replace(/left|right|bottom|top/g,function(t){return K1e[t]})}var q1e={start:"end",end:"start"};function Fq(r){return r.replace(/start|end/g,function(t){return q1e[t]})}function BF(r){var t=Ol(r),s=t.pageXOffset,a=t.pageYOffset;return{scrollLeft:s,scrollTop:a}}function WF(r){return ZS(vg(r)).left+BF(r).scrollLeft}function Y1e(r,t){var s=Ol(r),a=vg(r),l=s.visualViewport,d=a.clientWidth,f=a.clientHeight,E=0,v=0;if(l){d=l.width,f=l.height;var T=ite();(T||!T&&t==="fixed")&&(E=l.offsetLeft,v=l.offsetTop)}return{width:d,height:f,x:E+WF(r),y:v}}function X1e(r){var t,s=vg(r),a=BF(r),l=(t=r.ownerDocument)==null?void 0:t.body,d=pE(s.scrollWidth,s.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),f=pE(s.scrollHeight,s.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),E=-a.scrollLeft+WF(r),v=-a.scrollTop;return Sf(l||s).direction==="rtl"&&(E+=pE(s.clientWidth,l?l.clientWidth:0)-d),{width:d,height:f,x:E,y:v}}function zF(r){var t=Sf(r),s=t.overflow,a=t.overflowX,l=t.overflowY;return/auto|scroll|overlay|hidden/.test(s+l+a)}function lte(r){return["html","body","#document"].indexOf(Yh(r))>=0?r.ownerDocument.body:Tu(r)&&zF(r)?r:lte(sN(r))}function Vw(r,t){var s;t===void 0&&(t=[]);var a=lte(r),l=a===((s=r.ownerDocument)==null?void 0:s.body),d=Ol(a),f=l?[d].concat(d.visualViewport||[],zF(a)?a:[]):a,E=t.concat(f);return l?E:E.concat(Vw(sN(f)))}function bU(r){return Object.assign({},r,{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height})}function J1e(r,t){var s=ZS(r,!1,t==="fixed");return s.top=s.top+r.clientTop,s.left=s.left+r.clientLeft,s.bottom=s.top+r.clientHeight,s.right=s.left+r.clientWidth,s.width=r.clientWidth,s.height=r.clientHeight,s.x=s.left,s.y=s.top,s}function jq(r,t,s){return t===nte?bU(Y1e(r,s)):yE(t)?J1e(t,s):bU(X1e(vg(r)))}function Q1e(r){var t=Vw(sN(r)),s=["absolute","fixed"].indexOf(Sf(r).position)>=0,a=s&&Tu(r)?xR(r):r;return yE(a)?t.filter(function(l){return yE(l)&&ste(l,a)&&Yh(l)!=="body"}):[]}function Z1e(r,t,s,a){var l=t==="clippingParents"?Q1e(r):[].concat(t),d=[].concat(l,[s]),f=d[0],E=d.reduce(function(v,T){var R=jq(r,T,a);return v.top=pE(R.top,v.top),v.right=hk(R.right,v.right),v.bottom=hk(R.bottom,v.bottom),v.left=pE(R.left,v.left),v},jq(r,f,a));return E.width=E.right-E.left,E.height=E.bottom-E.top,E.x=E.left,E.y=E.top,E}function ute(r){var t=r.reference,s=r.element,a=r.placement,l=a?Wh(a):null,d=a?e0(a):null,f=t.x+t.width/2-s.width/2,E=t.y+t.height/2-s.height/2,v;switch(l){case Kc:v={x:f,y:t.y-s.height};break;case wu:v={x:f,y:t.y+t.height};break;case Ru:v={x:t.x+t.width,y:E};break;case qc:v={x:t.x-s.width,y:E};break;default:v={x:t.x,y:t.y}}var T=l?jF(l):null;if(T!=null){var R=T==="y"?"height":"width";switch(d){case JS:v[T]=v[T]-(t[R]/2-s[R]/2);break;case lR:v[T]=v[T]+(t[R]/2-s[R]/2);break}}return v}function uR(r,t){t===void 0&&(t={});var s=t,a=s.placement,l=a===void 0?r.placement:a,d=s.strategy,f=d===void 0?r.strategy:d,E=s.boundary,v=E===void 0?y1e:E,T=s.rootBoundary,R=T===void 0?nte:T,I=s.elementContext,N=I===void 0?Yb:I,F=s.altBoundary,j=F===void 0?!1:F,G=s.padding,H=G===void 0?0:G,te=ate(typeof H!="number"?H:cte(H,LR)),K=N===Yb?v1e:Yb,ee=r.rects.popper,de=r.elements[j?K:N],se=Z1e(yE(de)?de:de.contextElement||vg(r.elements.popper),v,R,f),ge=ZS(r.elements.reference),Z=ute({reference:ge,element:ee,placement:l}),Q=bU(Object.assign({},ee,Z)),ne=N===Yb?Q:ge,oe={top:se.top-ne.top+te.top,bottom:ne.bottom-se.bottom+te.bottom,left:se.left-ne.left+te.left,right:ne.right-se.right+te.right},pe=r.modifiersData.offset;if(N===Yb&&pe){var he=pe[l];Object.keys(oe).forEach(function(le){var Me=[Ru,wu].indexOf(le)>=0?1:-1,He=[Kc,wu].indexOf(le)>=0?"y":"x";oe[le]+=he[He]*Me})}return oe}function eDe(r,t){t===void 0&&(t={});var s=t,a=s.placement,l=s.boundary,d=s.rootBoundary,f=s.padding,E=s.flipVariations,v=s.allowedAutoPlacements,T=v===void 0?rte:v,R=e0(a),I=R?E?Mq:Mq.filter(function(j){return e0(j)===R}):LR,N=I.filter(function(j){return T.indexOf(j)>=0});N.length===0&&(N=I);var F=N.reduce(function(j,G){return j[G]=uR(r,{placement:G,boundary:l,rootBoundary:d,padding:f})[Wh(G)],j},{});return Object.keys(F).sort(function(j,G){return F[j]-F[G]})}function tDe(r){if(Wh(r)===UF)return[];var t=NO(r);return[Fq(r),t,Fq(t)]}function nDe(r){var t=r.state,s=r.options,a=r.name;if(!t.modifiersData[a]._skip){for(var l=s.mainAxis,d=l===void 0?!0:l,f=s.altAxis,E=f===void 0?!0:f,v=s.fallbackPlacements,T=s.padding,R=s.boundary,I=s.rootBoundary,N=s.altBoundary,F=s.flipVariations,j=F===void 0?!0:F,G=s.allowedAutoPlacements,H=t.options.placement,te=Wh(H),K=te===H,ee=v||(K||!j?[NO(H)]:tDe(H)),de=[H].concat(ee).reduce(function(Ue,ze){return Ue.concat(Wh(ze)===UF?eDe(t,{placement:ze,boundary:R,rootBoundary:I,padding:T,flipVariations:j,allowedAutoPlacements:G}):ze)},[]),se=t.rects.reference,ge=t.rects.popper,Z=new Map,Q=!0,ne=de[0],oe=0;oe<de.length;oe++){var pe=de[oe],he=Wh(pe),le=e0(pe)===JS,Me=[Kc,wu].indexOf(he)>=0,He=Me?"width":"height",rt=uR(t,{placement:pe,boundary:R,rootBoundary:I,altBoundary:N,padding:T}),we=Me?le?Ru:qc:le?wu:Kc;se[He]>ge[He]&&(we=NO(we));var Ce=NO(we),ye=[];if(d&&ye.push(rt[he]<=0),E&&ye.push(rt[we]<=0,rt[Ce]<=0),ye.every(function(Ue){return Ue})){ne=pe,Q=!1;break}Z.set(pe,ye)}if(Q)for(var Ne=j?3:1,Te=function(ze){var et=de.find(function(nt){var dt=Z.get(nt);if(dt)return dt.slice(0,ze).every(function(Xe){return Xe})});if(et)return ne=et,"break"},Se=Ne;Se>0;Se--){var Ae=Te(Se);if(Ae==="break")break}t.placement!==ne&&(t.modifiersData[a]._skip=!0,t.placement=ne,t.reset=!0)}}const rDe={name:"flip",enabled:!0,phase:"main",fn:nDe,requiresIfExists:["offset"],data:{_skip:!1}};function Bq(r,t,s){return s===void 0&&(s={x:0,y:0}),{top:r.top-t.height-s.y,right:r.right-t.width+s.x,bottom:r.bottom-t.height+s.y,left:r.left-t.width-s.x}}function Wq(r){return[Kc,Ru,wu,qc].some(function(t){return r[t]>=0})}function iDe(r){var t=r.state,s=r.name,a=t.rects.reference,l=t.rects.popper,d=t.modifiersData.preventOverflow,f=uR(t,{elementContext:"reference"}),E=uR(t,{altBoundary:!0}),v=Bq(f,a),T=Bq(E,l,d),R=Wq(v),I=Wq(T);t.modifiersData[s]={referenceClippingOffsets:v,popperEscapeOffsets:T,isReferenceHidden:R,hasPopperEscaped:I},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":R,"data-popper-escaped":I})}const sDe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:iDe};function oDe(r,t,s){var a=Wh(r),l=[qc,Kc].indexOf(a)>=0?-1:1,d=typeof s=="function"?s(Object.assign({},t,{placement:r})):s,f=d[0],E=d[1];return f=f||0,E=(E||0)*l,[qc,Ru].indexOf(a)>=0?{x:E,y:f}:{x:f,y:E}}function aDe(r){var t=r.state,s=r.options,a=r.name,l=s.offset,d=l===void 0?[0,0]:l,f=rte.reduce(function(R,I){return R[I]=oDe(I,t.rects,d),R},{}),E=f[t.placement],v=E.x,T=E.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=v,t.modifiersData.popperOffsets.y+=T),t.modifiersData[a]=f}const cDe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:aDe};function lDe(r){var t=r.state,s=r.name;t.modifiersData[s]=ute({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})}const uDe={name:"popperOffsets",enabled:!0,phase:"read",fn:lDe,data:{}};function dDe(r){return r==="x"?"y":"x"}function hDe(r){var t=r.state,s=r.options,a=r.name,l=s.mainAxis,d=l===void 0?!0:l,f=s.altAxis,E=f===void 0?!1:f,v=s.boundary,T=s.rootBoundary,R=s.altBoundary,I=s.padding,N=s.tether,F=N===void 0?!0:N,j=s.tetherOffset,G=j===void 0?0:j,H=uR(t,{boundary:v,rootBoundary:T,padding:I,altBoundary:R}),te=Wh(t.placement),K=e0(t.placement),ee=!K,de=jF(te),se=dDe(de),ge=t.modifiersData.popperOffsets,Z=t.rects.reference,Q=t.rects.popper,ne=typeof G=="function"?G(Object.assign({},t.rects,{placement:t.placement})):G,oe=typeof ne=="number"?{mainAxis:ne,altAxis:ne}:Object.assign({mainAxis:0,altAxis:0},ne),pe=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,he={x:0,y:0};if(ge){if(d){var le,Me=de==="y"?Kc:qc,He=de==="y"?wu:Ru,rt=de==="y"?"height":"width",we=ge[de],Ce=we+H[Me],ye=we-H[He],Ne=F?-Q[rt]/2:0,Te=K===JS?Z[rt]:Q[rt],Se=K===JS?-Q[rt]:-Z[rt],Ae=t.elements.arrow,Ue=F&&Ae?FF(Ae):{width:0,height:0},ze=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:ote(),et=ze[Me],nt=ze[He],dt=Uw(0,Z[rt],Ue[rt]),Xe=ee?Z[rt]/2-Ne-dt-et-oe.mainAxis:Te-dt-et-oe.mainAxis,Ct=ee?-Z[rt]/2+Ne+dt+nt+oe.mainAxis:Se+dt+nt+oe.mainAxis,dn=t.elements.arrow&&xR(t.elements.arrow),Ut=dn?de==="y"?dn.clientTop||0:dn.clientLeft||0:0,ln=(le=pe==null?void 0:pe[de])!=null?le:0,Ln=we+Xe-ln-Ut,qt=we+Ct-ln,Yn=Uw(F?hk(Ce,Ln):Ce,we,F?pE(ye,qt):ye);ge[de]=Yn,he[de]=Yn-we}if(E){var $t,Re=de==="x"?Kc:qc,Fe=de==="x"?wu:Ru,Ke=ge[se],_t=se==="y"?"height":"width",yt=Ke+H[Re],Ge=Ke-H[Fe],Pt=[Kc,qc].indexOf(te)!==-1,Yt=($t=pe==null?void 0:pe[se])!=null?$t:0,hn=Pt?yt:Ke-Z[_t]-Q[_t]-Yt+oe.altAxis,an=Pt?Ke+Z[_t]+Q[_t]-Yt-oe.altAxis:Ge,ir=F&&Pt?M1e(hn,Ke,an):Uw(F?hn:yt,Ke,F?an:Ge);ge[se]=ir,he[se]=ir-Ke}t.modifiersData[a]=he}}const pDe={name:"preventOverflow",enabled:!0,phase:"main",fn:hDe,requiresIfExists:["offset"]};function fDe(r){return{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}}function mDe(r){return r===Ol(r)||!Tu(r)?BF(r):fDe(r)}function gDe(r){var t=r.getBoundingClientRect(),s=QS(t.width)/r.offsetWidth||1,a=QS(t.height)/r.offsetHeight||1;return s!==1||a!==1}function _De(r,t,s){s===void 0&&(s=!1);var a=Tu(t),l=Tu(t)&&gDe(t),d=vg(t),f=ZS(r,l,s),E={scrollLeft:0,scrollTop:0},v={x:0,y:0};return(a||!a&&!s)&&((Yh(t)!=="body"||zF(d))&&(E=mDe(t)),Tu(t)?(v=ZS(t,!0),v.x+=t.clientLeft,v.y+=t.clientTop):d&&(v.x=WF(d))),{x:f.left+E.scrollLeft-v.x,y:f.top+E.scrollTop-v.y,width:f.width,height:f.height}}function EDe(r){var t=new Map,s=new Set,a=[];r.forEach(function(d){t.set(d.name,d)});function l(d){s.add(d.name);var f=[].concat(d.requires||[],d.requiresIfExists||[]);f.forEach(function(E){if(!s.has(E)){var v=t.get(E);v&&l(v)}}),a.push(d)}return r.forEach(function(d){s.has(d.name)||l(d)}),a}function yDe(r){var t=EDe(r);return O1e.reduce(function(s,a){return s.concat(t.filter(function(l){return l.phase===a}))},[])}function vDe(r){var t;return function(){return t||(t=new Promise(function(s){Promise.resolve().then(function(){t=void 0,s(r())})})),t}}function SDe(r){var t=r.reduce(function(s,a){var l=s[a.name];return s[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,s},{});return Object.keys(t).map(function(s){return t[s]})}var zq={placement:"bottom",modifiers:[],strategy:"absolute"};function Gq(){for(var r=arguments.length,t=new Array(r),s=0;s<r;s++)t[s]=arguments[s];return!t.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function TDe(r){r===void 0&&(r={});var t=r,s=t.defaultModifiers,a=s===void 0?[]:s,l=t.defaultOptions,d=l===void 0?zq:l;return function(E,v,T){T===void 0&&(T=d);var R={placement:"bottom",orderedModifiers:[],options:Object.assign({},zq,d),modifiersData:{},elements:{reference:E,popper:v},attributes:{},styles:{}},I=[],N=!1,F={state:R,setOptions:function(te){var K=typeof te=="function"?te(R.options):te;G(),R.options=Object.assign({},d,R.options,K),R.scrollParents={reference:yE(E)?Vw(E):E.contextElement?Vw(E.contextElement):[],popper:Vw(v)};var ee=yDe(SDe([].concat(a,R.options.modifiers)));return R.orderedModifiers=ee.filter(function(de){return de.enabled}),j(),F.update()},forceUpdate:function(){if(!N){var te=R.elements,K=te.reference,ee=te.popper;if(Gq(K,ee)){R.rects={reference:_De(K,xR(ee),R.options.strategy==="fixed"),popper:FF(ee)},R.reset=!1,R.placement=R.options.placement,R.orderedModifiers.forEach(function(oe){return R.modifiersData[oe.name]=Object.assign({},oe.data)});for(var de=0;de<R.orderedModifiers.length;de++){if(R.reset===!0){R.reset=!1,de=-1;continue}var se=R.orderedModifiers[de],ge=se.fn,Z=se.options,Q=Z===void 0?{}:Z,ne=se.name;typeof ge=="function"&&(R=ge({state:R,options:Q,name:ne,instance:F})||R)}}}},update:vDe(function(){return new Promise(function(H){F.forceUpdate(),H(R)})}),destroy:function(){G(),N=!0}};if(!Gq(E,v))return F;F.setOptions(T).then(function(H){!N&&T.onFirstUpdate&&T.onFirstUpdate(H)});function j(){R.orderedModifiers.forEach(function(H){var te=H.name,K=H.options,ee=K===void 0?{}:K,de=H.effect;if(typeof de=="function"){var se=de({state:R,name:te,instance:F,options:ee}),ge=function(){};I.push(se||ge)}})}function G(){I.forEach(function(H){return H()}),I=[]}return F}}var bDe=[$1e,uDe,G1e,D1e,cDe,rDe,pDe,j1e,sDe],wDe=TDe({defaultModifiers:bDe});const Zv=(r,t)=>({var:r,varRef:t?`var(${r}, ${t})`:`var(${r})`}),zs={arrowShadowColor:Zv("--popper-arrow-shadow-color"),arrowSize:Zv("--popper-arrow-size","8px"),arrowSizeHalf:Zv("--popper-arrow-size-half"),arrowBg:Zv("--popper-arrow-bg"),transformOrigin:Zv("--popper-transform-origin"),arrowOffset:Zv("--popper-arrow-offset")};function RDe(r){if(r.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(r.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(r.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(r.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const CDe={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},IDe=r=>CDe[r],Hq={scroll:!0,resize:!0};function ADe(r){let t;return typeof r=="object"?t={enabled:!0,options:{...Hq,...r}}:t={enabled:r,options:Hq},t}const PDe={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:r})=>{r.styles.popper.width=`${r.rects.reference.width}px`},effect:({state:r})=>()=>{const t=r.elements.reference;r.elements.popper.style.width=`${t.offsetWidth}px`}},ODe={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:r})=>{$q(r)},effect:({state:r})=>()=>{$q(r)}},$q=r=>{r.elements.popper.style.setProperty(zs.transformOrigin.var,IDe(r.placement))},kDe={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:r})=>{NDe(r)}},NDe=r=>{var s;if(!r.placement)return;const t=DDe(r.placement);if((s=r.elements)!=null&&s.arrow&&t){Object.assign(r.elements.arrow.style,{[t.property]:t.value,width:zs.arrowSize.varRef,height:zs.arrowSize.varRef,zIndex:-1});const a={[zs.arrowSizeHalf.var]:`calc(${zs.arrowSize.varRef} / 2 - 1px)`,[zs.arrowOffset.var]:`calc(${zs.arrowSizeHalf.varRef} * -1)`};for(const l in a)r.elements.arrow.style.setProperty(l,a[l])}},DDe=r=>{if(r.startsWith("top"))return{property:"bottom",value:zs.arrowOffset.varRef};if(r.startsWith("bottom"))return{property:"top",value:zs.arrowOffset.varRef};if(r.startsWith("left"))return{property:"right",value:zs.arrowOffset.varRef};if(r.startsWith("right"))return{property:"left",value:zs.arrowOffset.varRef}},LDe={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:r})=>{Kq(r)},effect:({state:r})=>()=>{Kq(r)}},Kq=r=>{if(!r.elements.arrow)return;const t=r.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!t)return;const s=RDe(r.placement);s&&t.style.setProperty("--popper-arrow-default-shadow",s),Object.assign(t.style,{transform:"rotate(45deg)",background:zs.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},xDe={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},MDe={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function UDe(r,t="ltr"){var a;const s=((a=xDe[r])==null?void 0:a[t])||r;return t==="ltr"?s:MDe[r]??s}function GF(r={}){const{enabled:t=!0,modifiers:s,placement:a="bottom",strategy:l="absolute",arrowPadding:d=8,eventListeners:f=!0,offset:E,gutter:v=8,flip:T=!0,boundary:R="clippingParents",preventOverflow:I=!0,matchWidth:N,direction:F="ltr"}=r,j=L.useRef(null),G=L.useRef(null),H=L.useRef(null),te=UDe(a,F),K=L.useRef(()=>{}),ee=L.useCallback(()=>{var oe;!t||!j.current||!G.current||((oe=K.current)==null||oe.call(K),H.current=wDe(j.current,G.current,{placement:te,modifiers:[LDe,kDe,ODe,{...PDe,enabled:!!N},{name:"eventListeners",...ADe(f)},{name:"arrow",options:{padding:d}},{name:"offset",options:{offset:E??[0,v]}},{name:"flip",enabled:!!T,options:{padding:8}},{name:"preventOverflow",enabled:!!I,options:{boundary:R}},...s??[]],strategy:l}),H.current.forceUpdate(),K.current=H.current.destroy)},[te,t,s,N,f,d,E,v,T,I,R,l]);L.useEffect(()=>()=>{var oe;!j.current&&!G.current&&((oe=H.current)==null||oe.destroy(),H.current=null)},[]);const de=L.useCallback(oe=>{j.current=oe,ee()},[ee]),se=L.useCallback((oe={},pe=null)=>({...oe,ref:Yi(de,pe)}),[de]),ge=L.useCallback(oe=>{G.current=oe,ee()},[ee]),Z=L.useCallback((oe={},pe=null)=>({...oe,ref:Yi(ge,pe),style:{...oe.style,position:l,minWidth:N?void 0:"max-content",inset:"0 auto auto 0"}}),[l,ge,N]),Q=L.useCallback((oe={},pe=null)=>{const{size:he,shadowColor:le,bg:Me,style:He,...rt}=oe;return{...rt,ref:pe,"data-popper-arrow":"",style:VDe(oe)}},[]),ne=L.useCallback((oe={},pe=null)=>({...oe,ref:pe,"data-popper-arrow-inner":""}),[]);return{update(){var oe;(oe=H.current)==null||oe.update()},forceUpdate(){var oe;(oe=H.current)==null||oe.forceUpdate()},transformOrigin:zs.transformOrigin.varRef,referenceRef:de,popperRef:ge,getPopperProps:Z,getArrowProps:Q,getArrowInnerProps:ne,getReferenceProps:se}}function VDe(r){const{size:t,shadowColor:s,bg:a,style:l}=r,d={...l,position:"absolute"};return t&&(d["--popper-arrow-size"]=t),s&&(d["--popper-arrow-shadow-color"]=s),a&&(d["--popper-arrow-bg"]=a),d}function FDe(){const r=L.useRef(new Map),t=r.current,s=L.useCallback((l,d,f,E)=>{r.current.set(f,{type:d,el:l,options:E}),l.addEventListener(d,f,E)},[]),a=L.useCallback((l,d,f,E)=>{l.removeEventListener(d,f,E),r.current.delete(f)},[]);return L.useEffect(()=>()=>{t.forEach((l,d)=>{a(l.el,l.type,d,l.options)})},[a,t]),{add:s,remove:a}}function a2(r){var l,d;const t=((d=(l=r.composedPath)==null?void 0:l.call(r))==null?void 0:d[0])??r.target,{tagName:s,isContentEditable:a}=t;return s!=="INPUT"&&s!=="TEXTAREA"&&a!==!0}function dte(r={}){const{ref:t,isDisabled:s,isFocusable:a,clickOnEnter:l=!0,clickOnSpace:d=!0,onMouseDown:f,onMouseUp:E,onClick:v,onKeyDown:T,onKeyUp:R,tabIndex:I,onMouseOver:N,onMouseLeave:F,...j}=r,[G,H]=L.useState(!0),[te,K]=L.useState(!1),ee=FDe(),de=we=>{we&&we.tagName!=="BUTTON"&&H(!1)},se=G?I:I||0,ge=s&&!a,Z=L.useCallback(we=>{if(s){we.stopPropagation(),we.preventDefault();return}we.currentTarget.focus(),v==null||v(we)},[s,v]),Q=L.useCallback(we=>{te&&a2(we)&&(we.preventDefault(),we.stopPropagation(),K(!1),ee.remove(document,"keyup",Q,!1))},[te,ee]),ne=L.useCallback(we=>{if(T==null||T(we),s||we.defaultPrevented||we.metaKey||!a2(we.nativeEvent)||G)return;const Ce=l&&we.key==="Enter";d&&we.key===" "&&(we.preventDefault(),K(!0)),Ce&&(we.preventDefault(),we.currentTarget.click()),ee.add(document,"keyup",Q,!1)},[s,G,T,l,d,ee,Q]),oe=L.useCallback(we=>{if(R==null||R(we),s||we.defaultPrevented||we.metaKey||!a2(we.nativeEvent)||G)return;d&&we.key===" "&&(we.preventDefault(),K(!1),we.currentTarget.click())},[d,G,s,R]),pe=L.useCallback(we=>{we.button===0&&(K(!1),ee.remove(document,"mouseup",pe,!1))},[ee]),he=L.useCallback(we=>{if(we.button!==0)return;if(s){we.stopPropagation(),we.preventDefault();return}G||K(!0),we.currentTarget.focus({preventScroll:!0}),ee.add(document,"mouseup",pe,!1),f==null||f(we)},[s,G,f,ee,pe]),le=L.useCallback(we=>{we.button===0&&(G||K(!1),E==null||E(we))},[E,G]),Me=L.useCallback(we=>{if(s){we.preventDefault();return}N==null||N(we)},[s,N]),He=L.useCallback(we=>{te&&(we.preventDefault(),K(!1)),F==null||F(we)},[te,F]),rt=Yi(t,de);return G?{...j,ref:rt,type:"button","aria-disabled":ge?void 0:s,disabled:ge,onClick:Z,onMouseDown:f,onMouseUp:E,onKeyUp:R,onKeyDown:T,onMouseOver:N,onMouseLeave:F}:{...j,ref:rt,role:"button","data-active":Kn(te),"aria-disabled":s?"true":void 0,tabIndex:ge?void 0:se,onClick:Z,onMouseDown:he,onMouseUp:le,onKeyUp:oe,onKeyDown:ne,onMouseOver:Me,onMouseLeave:He}}const[jDe,BDe,WDe,zDe]=hee(),[GDe,MR]=Wi({strict:!1,name:"MenuContext"});function hte(r){return(r==null?void 0:r.ownerDocument)??document}function HDe(r){return hte(r).activeElement===r}function $De(r={}){const{id:t,closeOnSelect:s=!0,closeOnBlur:a=!0,initialFocusRef:l,autoSelect:d=!0,isLazy:f,isOpen:E,defaultIsOpen:v,onClose:T,onOpen:R,placement:I="bottom-start",lazyBehavior:N="unmount",direction:F,computePositionOnMount:j=!1,...G}=r,H=L.useRef(null),te=L.useRef(null),K=L.useRef(!0),ee=WDe(),de=L.useCallback(()=>{requestAnimationFrame(()=>{var Ae;(Ae=H.current)==null||Ae.focus({preventScroll:!1})})},[]),se=L.useCallback(()=>{const Ae=setTimeout(()=>{var Ue,ze;if(l)(Ue=l.current)==null||Ue.focus();else if(!ee.count())(ze=H.current)==null||ze.focus({preventScroll:!1});else{const et=ee.firstEnabled();et&&Me(et.index)}});ye.current.add(Ae)},[ee,l]),ge=L.useCallback(()=>{const Ae=setTimeout(()=>{var Ue;if(!ee.count())(Ue=H.current)==null||Ue.focus({preventScroll:!1});else{const ze=ee.lastEnabled();ze&&Me(ze.index)}});ye.current.add(Ae)},[ee]),Z=L.useCallback(()=>{R==null||R(),d?se():de()},[d,se,de,R]),{isOpen:Q,onOpen:ne,onClose:oe,onToggle:pe}=ag({isOpen:E,defaultIsOpen:v,onClose:T,onOpen:Z});GJ({enabled:Q&&a,ref:H,handler:Ae=>{var ze,et,nt;const Ue=((et=(ze=Ae.composedPath)==null?void 0:ze.call(Ae))==null?void 0:et[0])??Ae.target;(nt=te.current)!=null&&nt.contains(Ue)||oe()}});const he=GF({...G,enabled:Q||j,placement:I,direction:F}),[le,Me]=L.useState(-1);BJ(H,{focusRef:te,visible:Q,shouldFocus:!0});const He=FJ({isOpen:Q,ref:H}),[rt,we]=eEe(t,"menu-button","menu-list"),Ce=L.useCallback(()=>{ne(),de()},[ne,de]),ye=L.useRef(new Set([]));L.useEffect(()=>{const Ae=ye.current;return()=>{Ae.forEach(Ue=>clearTimeout(Ue)),Ae.clear()}},[]),cg(()=>{var Ae;Q||(Me(-1),(Ae=H.current)==null||Ae.scrollTo(0,0))},[Q]),cg(()=>{Q&&le===-1&&de()},[le,Q]),L.useEffect(()=>{var Ue;if(!Q)return;const Ae=ee.item(le);(Ue=Ae==null?void 0:Ae.node)==null||Ue.focus({preventScroll:!K.current})},[ee,le,Q]);const Ne=L.useCallback(()=>{ne(),se()},[se,ne]),Te=L.useCallback(()=>{K.current=!0,ne(),ge()},[ne,ge]),Se=L.useCallback(()=>{var nt,dt;const Ae=hte(H.current),Ue=(nt=H.current)==null?void 0:nt.contains(Ae.activeElement);if(!(Q&&!Ue))return;const et=(dt=ee.item(le))==null?void 0:dt.node;et==null||et.focus({preventScroll:!K.current})},[Q,le,ee]);return{openAndFocusMenu:Ce,openAndFocusFirstItem:Ne,openAndFocusLastItem:Te,onTransitionEnd:Se,unstable__animationState:He,descendants:ee,popper:he,buttonId:rt,menuId:we,forceUpdate:he.forceUpdate,orientation:"vertical",isOpen:Q,onToggle:pe,onOpen:ne,onClose:oe,menuRef:H,buttonRef:te,focusedIndex:le,closeOnSelect:s,closeOnBlur:a,autoSelect:d,setFocusedIndex:Me,isLazy:f,lazyBehavior:N,initialFocusRef:l,scrollIntoViewRef:K}}function KDe(r={},t=null){const s=MR(),{onToggle:a,popper:l,openAndFocusFirstItem:d,openAndFocusLastItem:f,scrollIntoViewRef:E}=s,v=L.useCallback(T=>{const R=T.key,N={Enter:d,ArrowDown:d,ArrowUp:f}[R];N&&(E.current=!0,T.preventDefault(),T.stopPropagation(),N(T))},[d,f,E]);return{...r,ref:Yi(s.buttonRef,t,l.referenceRef),id:s.buttonId,"data-active":Kn(s.isOpen),"aria-expanded":s.isOpen,"aria-haspopup":"menu","aria-controls":s.menuId,onClick:Qn(r.onClick,a),onKeyDown:Qn(r.onKeyDown,v)}}function wU(r){var t;return JDe(r)&&!!((t=r==null?void 0:r.getAttribute("role"))!=null&&t.startsWith("menuitem"))}function qDe(r={},t=null){const s=MR();if(!s)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:a,setFocusedIndex:l,menuRef:d,isOpen:f,onClose:E,menuId:v,isLazy:T,lazyBehavior:R,scrollIntoViewRef:I,unstable__animationState:N}=s,F=BDe(),j=E1e({preventDefault:K=>K.key!==" "&&wU(K.target)}),G=L.useCallback(K=>{if(!K.currentTarget.contains(K.target))return;const ee=K.key,se={Tab:Z=>Z.preventDefault(),Escape:Z=>{Z.stopPropagation(),E()},ArrowDown:()=>{I.current=!0;const Z=F.nextEnabled(a)??F.firstEnabled();Z&&l(Z.index)},ArrowUp:()=>{I.current=!0;const Z=F.prevEnabled(a)??F.firstEnabled();Z&&l(Z.index)}}[ee];if(se){K.preventDefault(),se(K);return}const ge=j(Z=>{const Q=g1e(F.values(),Z,ne=>{var oe;return((oe=ne==null?void 0:ne.node)==null?void 0:oe.textContent)??""},F.item(a));if(Q){const ne=F.indexOf(Q.node);l(ne)}});wU(K.target)&&ge(K)},[F,a,j,E,l,I]),H=L.useRef(!1);f&&(H.current=!0);const te=_V({wasSelected:H.current,enabled:T,mode:R,isSelected:N.present});return{...r,ref:Yi(d,t),children:te?r.children:null,tabIndex:-1,role:"menu",id:v,style:{...r.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:Qn(r.onKeyDown,G)}}function YDe(r={}){const{popper:t,isOpen:s}=MR();return t.getPopperProps({...r,style:{visibility:s?"visible":"hidden",...r.style}})}function XDe(r={},t=null){const{onMouseEnter:s,onMouseMove:a,onMouseLeave:l,onClick:d,onFocus:f,isDisabled:E,isFocusable:v,closeOnSelect:T,type:R,...I}=r,N=MR(),{setFocusedIndex:F,focusedIndex:j,closeOnSelect:G,onClose:H,menuId:te,scrollIntoViewRef:K}=N,ee=L.useRef(null),de=`${te}-menuitem-${L.useId()}`,{index:se,register:ge}=zDe({disabled:E&&!v}),Z=L.useCallback(Me=>{s==null||s(Me),!E&&(K.current=!1,F(se))},[F,se,E,s,K]),Q=L.useCallback(Me=>{a==null||a(Me),ee.current&&!HDe(ee.current)&&Z(Me)},[Z,a]),ne=L.useCallback(Me=>{l==null||l(Me),!E&&F(-1)},[F,E,l]),oe=L.useCallback(Me=>{d==null||d(Me),wU(Me.currentTarget)&&(T??G)&&H()},[H,d,G,T]),pe=L.useCallback(Me=>{f==null||f(Me),F(se)},[F,f,se]),he=se===j,le=dte({onClick:oe,onFocus:pe,onMouseEnter:Z,onMouseMove:Q,onMouseLeave:ne,ref:Yi(ge,ee,t),isDisabled:E,isFocusable:v});return{...I,...le,type:R??le.type,id:de,role:"menuitem",tabIndex:he?0:-1}}function JDe(r){if(!QDe(r))return!1;const t=r.ownerDocument.defaultView??window;return r instanceof t.HTMLElement}function QDe(r){return r!=null&&typeof r=="object"&&"nodeType"in r&&r.nodeType===Node.ELEMENT_NODE}const[ZDe,E0]=Wi({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),HF=r=>{const{children:t}=r,s=Qc("Menu",r),a=Ji(r),{direction:l}=g0(),{descendants:d,...f}=$De({...a,direction:l}),E=L.useMemo(()=>f,[f]),{isOpen:v,onClose:T,forceUpdate:R}=E;return P.jsx(jDe,{value:d,children:P.jsx(GDe,{value:E,children:P.jsx(ZDe,{value:s,children:Hc(t,{isOpen:v,onClose:T,forceUpdate:R})})})})};HF.displayName="Menu";const eLe=Qt((r,t)=>{const s=E0();return P.jsx(Mt.button,{ref:t,...r,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...s.button}})}),$F=Qt((r,t)=>{const{children:s,as:a,...l}=r,d=KDe(l,t),f=a||eLe;return P.jsx(f,{...d,className:_n("chakra-menu__menu-button",r.className),children:P.jsx(Mt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:r.children})})});$F.displayName="MenuButton";const pte=Qt((r,t)=>{const s=E0();return P.jsx(Mt.span,{ref:t,...r,__css:s.command,className:"chakra-menu__command"})});pte.displayName="MenuCommand";const fte=r=>{const{className:t,...s}=r,a=E0();return P.jsx(Mt.hr,{"aria-orientation":"horizontal",className:_n("chakra-menu__divider",t),...s,__css:a.divider})};fte.displayName="MenuDivider";const mte=r=>{const{className:t,children:s,...a}=r,l=E0(),d=L.Children.only(s),f=L.isValidElement(d)?L.cloneElement(d,{focusable:"false","aria-hidden":!0,className:_n("chakra-menu__icon",d.props.className)}):null,E=_n("chakra-menu__icon-wrapper",t);return P.jsx(Mt.span,{className:E,...a,__css:l.icon,children:f})};mte.displayName="MenuIcon";const tLe=Qt((r,t)=>{const{type:s,...a}=r,l=E0(),d=a.as||s?s??void 0:"button",f=L.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return P.jsx(Mt.button,{ref:t,type:d,...a,__css:f})}),DO=Qt((r,t)=>{const{icon:s,iconSpacing:a="0.75rem",command:l,commandSpacing:d="0.75rem",children:f,...E}=r,v=XDe(E,t),R=s||l?P.jsx("span",{style:{pointerEvents:"none",flex:1},children:f}):f;return P.jsxs(tLe,{...v,className:_n("chakra-menu__menuitem",v.className),children:[s&&P.jsx(mte,{fontSize:"0.8em",marginEnd:a,children:s}),R,l&&P.jsx(pte,{marginStart:d,children:l})]})});DO.displayName="MenuItem";const nLe={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},rLe=Mt(If.div),KF=Qt(function(t,s){var N;const{rootProps:a,motionProps:l,...d}=t,{isOpen:f,onTransitionEnd:E,unstable__animationState:v}=MR(),T=qDe(d,s),R=YDe(a),I=E0();return P.jsx(Mt.div,{...R,__css:{zIndex:t.zIndex??((N=I.list)==null?void 0:N.zIndex)},children:P.jsx(rLe,{variants:nLe,initial:!1,animate:f?"enter":"exit",__css:{outline:0,...I.list},...l,...T,className:_n("chakra-menu__menu-list",T.className),onUpdate:E,onAnimationComplete:DJ(v.onComplete,T.onAnimationComplete)})})});KF.displayName="MenuList";var iLe=function(r){if(typeof document>"u")return null;var t=Array.isArray(r)?r[0]:r;return t.ownerDocument.body},eS=new WeakMap,ZP=new WeakMap,eO={},c2=0,gte=function(r){return r&&(r.host||gte(r.parentNode))},sLe=function(r,t){return t.map(function(s){if(r.contains(s))return s;var a=gte(s);return a&&r.contains(a)?a:(console.error("aria-hidden",s,"in not contained inside",r,". Doing nothing"),null)}).filter(function(s){return!!s})},oLe=function(r,t,s,a){var l=sLe(t,Array.isArray(r)?r:[r]);eO[s]||(eO[s]=new WeakMap);var d=eO[s],f=[],E=new Set,v=new Set(l),T=function(I){!I||E.has(I)||(E.add(I),T(I.parentNode))};l.forEach(T);var R=function(I){!I||v.has(I)||Array.prototype.forEach.call(I.children,function(N){if(E.has(N))R(N);else try{var F=N.getAttribute(a),j=F!==null&&F!=="false",G=(eS.get(N)||0)+1,H=(d.get(N)||0)+1;eS.set(N,G),d.set(N,H),f.push(N),G===1&&j&&ZP.set(N,!0),H===1&&N.setAttribute(s,"true"),j||N.setAttribute(a,"true")}catch(te){console.error("aria-hidden: cannot operate on ",N,te)}})};return R(t),E.clear(),c2++,function(){f.forEach(function(I){var N=eS.get(I)-1,F=d.get(I)-1;eS.set(I,N),d.set(I,F),N||(ZP.has(I)||I.removeAttribute(a),ZP.delete(I)),F||I.removeAttribute(s)}),c2--,c2||(eS=new WeakMap,eS=new WeakMap,ZP=new WeakMap,eO={})}},aLe=function(r,t,s){s===void 0&&(s="data-aria-hidden");var a=Array.from(Array.isArray(r)?r:[r]),l=iLe(r);return l?(a.push.apply(a,Array.from(l.querySelectorAll("[aria-live]"))),oLe(a,l,s,"aria-hidden")):function(){return null}},cLe=Object.defineProperty,lLe=(r,t,s)=>t in r?cLe(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s,uLe=(r,t,s)=>(lLe(r,t+"",s),s);class dLe{constructor(){uLe(this,"modals"),this.modals=new Set}add(t){return this.modals.add(t),this.modals.size}remove(t){this.modals.delete(t)}isTopModal(t){if(!t)return!1;const s=Array.from(this.modals)[this.modals.size-1];return t===s}}const RU=new dLe;function _te(r,t){const[s,a]=L.useState(0);return L.useEffect(()=>{const l=r.current;if(l){if(t){const d=RU.add(l);a(d)}return()=>{RU.remove(l),a(0)}}},[t,r]),s}function hLe(r){const{isOpen:t,onClose:s,id:a,closeOnOverlayClick:l=!0,closeOnEsc:d=!0,useInert:f=!0,onOverlayClick:E,onEsc:v}=r,T=L.useRef(null),R=L.useRef(null),[I,N,F]=fLe(a,"chakra-modal","chakra-modal--header","chakra-modal--body");pLe(T,t&&f);const j=_te(T,t),G=L.useRef(null),H=L.useCallback(ne=>{G.current=ne.target},[]),te=L.useCallback(ne=>{ne.key==="Escape"&&(ne.stopPropagation(),d&&(s==null||s()),v==null||v())},[d,s,v]),[K,ee]=L.useState(!1),[de,se]=L.useState(!1),ge=L.useCallback((ne={},oe=null)=>({role:"dialog",...ne,ref:Yi(oe,T),id:I,tabIndex:-1,"aria-modal":!0,"aria-labelledby":K?N:void 0,"aria-describedby":de?F:void 0,onClick:Qn(ne.onClick,pe=>pe.stopPropagation())}),[F,de,I,N,K]),Z=L.useCallback(ne=>{ne.stopPropagation(),G.current===ne.target&&RU.isTopModal(T.current)&&(l&&(s==null||s()),E==null||E())},[s,l,E]),Q=L.useCallback((ne={},oe=null)=>({...ne,ref:Yi(oe,R),onClick:Qn(ne.onClick,Z),onKeyDown:Qn(ne.onKeyDown,te),onMouseDown:Qn(ne.onMouseDown,H)}),[te,H,Z]);return{isOpen:t,onClose:s,headerId:N,bodyId:F,setBodyMounted:se,setHeaderMounted:ee,dialogRef:T,overlayRef:R,getDialogProps:ge,getDialogContainerProps:Q,index:j}}function pLe(r,t){const s=r.current;L.useEffect(()=>{if(!(!r.current||!t))return aLe(r.current)},[t,r,s])}function fLe(r,...t){const s=L.useId(),a=r||s;return L.useMemo(()=>t.map(l=>`${l}-${a}`),[a,t])}const[mLe,y0]=Wi({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[gLe,vE]=Wi({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),tc=r=>{const t={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...r,lockFocusAcrossFrames:r.lockFocusAcrossFrames||!0},{portalProps:s,children:a,autoFocus:l,trapFocus:d,initialFocusRef:f,finalFocusRef:E,returnFocusOnClose:v,blockScrollOnMount:T,allowPinchZoom:R,preserveScrollBarGap:I,motionPreset:N,lockFocusAcrossFrames:F,animatePresenceProps:j,onCloseComplete:G}=t,H=Qc("Modal",t),K={...hLe(t),autoFocus:l,trapFocus:d,initialFocusRef:f,finalFocusRef:E,returnFocusOnClose:v,blockScrollOnMount:T,allowPinchZoom:R,preserveScrollBarGap:I,motionPreset:N,lockFocusAcrossFrames:F};return P.jsx(gLe,{value:K,children:P.jsx(mLe,{value:H,children:P.jsx(p0,{...j,onExitComplete:G,children:K.isOpen&&P.jsx(Au,{...s,children:a})})})})};tc.displayName="Modal";var LO="right-scroll-bar-position",xO="width-before-scroll-bar",_Le="with-scroll-bars-hidden",ELe="--removed-body-scroll-bar-size",Ete=wee(),l2=function(){},oN=L.forwardRef(function(r,t){var s=L.useRef(null),a=L.useState({onScrollCapture:l2,onWheelCapture:l2,onTouchMoveCapture:l2}),l=a[0],d=a[1],f=r.forwardProps,E=r.children,v=r.className,T=r.removeScrollBar,R=r.enabled,I=r.shards,N=r.sideCar,F=r.noIsolation,j=r.inert,G=r.allowPinchZoom,H=r.as,te=H===void 0?"div":H,K=r.gapMode,ee=NR(r,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),de=N,se=See([s,t]),ge=Nh(Nh({},ee),l);return L.createElement(L.Fragment,null,R&&L.createElement(de,{sideCar:Ete,removeScrollBar:T,shards:I,noIsolation:F,inert:j,setCallbacks:d,allowPinchZoom:!!G,lockRef:s,gapMode:K}),f?L.cloneElement(L.Children.only(E),Nh(Nh({},ge),{ref:se})):L.createElement(te,Nh({},ge,{className:v,ref:se}),E))});oN.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};oN.classNames={fullWidth:xO,zeroRight:LO};var yLe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function vLe(){if(!document)return null;var r=document.createElement("style");r.type="text/css";var t=yLe();return t&&r.setAttribute("nonce",t),r}function SLe(r,t){r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}function TLe(r){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(r)}var bLe=function(){var r=0,t=null;return{add:function(s){r==0&&(t=vLe())&&(SLe(t,s),TLe(t)),r++},remove:function(){r--,!r&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},wLe=function(){var r=bLe();return function(t,s){L.useEffect(function(){return r.add(t),function(){r.remove()}},[t&&s])}},yte=function(){var r=wLe(),t=function(s){var a=s.styles,l=s.dynamic;return r(a,l),null};return t},RLe={left:0,top:0,right:0,gap:0},u2=function(r){return parseInt(r||"",10)||0},CLe=function(r){var t=window.getComputedStyle(document.body),s=t[r==="padding"?"paddingLeft":"marginLeft"],a=t[r==="padding"?"paddingTop":"marginTop"],l=t[r==="padding"?"paddingRight":"marginRight"];return[u2(s),u2(a),u2(l)]},ILe=function(r){if(r===void 0&&(r="margin"),typeof window>"u")return RLe;var t=CLe(r),s=document.documentElement.clientWidth,a=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,a-s+t[2]-t[0])}},ALe=yte(),xS="data-scroll-locked",PLe=function(r,t,s,a){var l=r.left,d=r.top,f=r.right,E=r.gap;return s===void 0&&(s="margin"),`
  .`.concat(_Le,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(E,"px ").concat(a,`;
  }
  body[`).concat(xS,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(a,";"),s==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(f,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(E,"px ").concat(a,`;
    `),s==="padding"&&"padding-right: ".concat(E,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(LO,` {
    right: `).concat(E,"px ").concat(a,`;
  }
  
  .`).concat(xO,` {
    margin-right: `).concat(E,"px ").concat(a,`;
  }
  
  .`).concat(LO," .").concat(LO,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(xO," .").concat(xO,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(xS,`] {
    `).concat(ELe,": ").concat(E,`px;
  }
`)},qq=function(){var r=parseInt(document.body.getAttribute(xS)||"0",10);return isFinite(r)?r:0},OLe=function(){L.useEffect(function(){return document.body.setAttribute(xS,(qq()+1).toString()),function(){var r=qq()-1;r<=0?document.body.removeAttribute(xS):document.body.setAttribute(xS,r.toString())}},[])},kLe=function(r){var t=r.noRelative,s=r.noImportant,a=r.gapMode,l=a===void 0?"margin":a;OLe();var d=L.useMemo(function(){return ILe(l)},[l]);return L.createElement(ALe,{styles:PLe(d,!t,l,s?"":"!important")})},CU=!1;if(typeof window<"u")try{var tO=Object.defineProperty({},"passive",{get:function(){return CU=!0,!0}});window.addEventListener("test",tO,tO),window.removeEventListener("test",tO,tO)}catch{CU=!1}var tS=CU?{passive:!1}:!1,NLe=function(r){return r.tagName==="TEXTAREA"},vte=function(r,t){if(!(r instanceof Element))return!1;var s=window.getComputedStyle(r);return s[t]!=="hidden"&&!(s.overflowY===s.overflowX&&!NLe(r)&&s[t]==="visible")},DLe=function(r){return vte(r,"overflowY")},LLe=function(r){return vte(r,"overflowX")},Yq=function(r,t){var s=t.ownerDocument,a=t;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var l=Ste(r,a);if(l){var d=Tte(r,a),f=d[1],E=d[2];if(f>E)return!0}a=a.parentNode}while(a&&a!==s.body);return!1},xLe=function(r){var t=r.scrollTop,s=r.scrollHeight,a=r.clientHeight;return[t,s,a]},MLe=function(r){var t=r.scrollLeft,s=r.scrollWidth,a=r.clientWidth;return[t,s,a]},Ste=function(r,t){return r==="v"?DLe(t):LLe(t)},Tte=function(r,t){return r==="v"?xLe(t):MLe(t)},ULe=function(r,t){return r==="h"&&t==="rtl"?-1:1},VLe=function(r,t,s,a,l){var d=ULe(r,window.getComputedStyle(t).direction),f=d*a,E=s.target,v=t.contains(E),T=!1,R=f>0,I=0,N=0;do{var F=Tte(r,E),j=F[0],G=F[1],H=F[2],te=G-H-d*j;(j||te)&&Ste(r,E)&&(I+=te,N+=j),E instanceof ShadowRoot?E=E.host:E=E.parentNode}while(!v&&E!==document.body||v&&(t.contains(E)||t===E));return(R&&Math.abs(I)<1||!R&&Math.abs(N)<1)&&(T=!0),T},nO=function(r){return"changedTouches"in r?[r.changedTouches[0].clientX,r.changedTouches[0].clientY]:[0,0]},Xq=function(r){return[r.deltaX,r.deltaY]},Jq=function(r){return r&&"current"in r?r.current:r},FLe=function(r,t){return r[0]===t[0]&&r[1]===t[1]},jLe=function(r){return`
  .block-interactivity-`.concat(r,` {pointer-events: none;}
  .allow-interactivity-`).concat(r,` {pointer-events: all;}
`)},BLe=0,nS=[];function WLe(r){var t=L.useRef([]),s=L.useRef([0,0]),a=L.useRef(),l=L.useState(BLe++)[0],d=L.useState(yte)[0],f=L.useRef(r);L.useEffect(function(){f.current=r},[r]),L.useEffect(function(){if(r.inert){document.body.classList.add("block-interactivity-".concat(l));var G=Yke([r.lockRef.current],(r.shards||[]).map(Jq),!0).filter(Boolean);return G.forEach(function(H){return H.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),G.forEach(function(H){return H.classList.remove("allow-interactivity-".concat(l))})}}},[r.inert,r.lockRef.current,r.shards]);var E=L.useCallback(function(G,H){if("touches"in G&&G.touches.length===2||G.type==="wheel"&&G.ctrlKey)return!f.current.allowPinchZoom;var te=nO(G),K=s.current,ee="deltaX"in G?G.deltaX:K[0]-te[0],de="deltaY"in G?G.deltaY:K[1]-te[1],se,ge=G.target,Z=Math.abs(ee)>Math.abs(de)?"h":"v";if("touches"in G&&Z==="h"&&ge.type==="range")return!1;var Q=Yq(Z,ge);if(!Q)return!0;if(Q?se=Z:(se=Z==="v"?"h":"v",Q=Yq(Z,ge)),!Q)return!1;if(!a.current&&"changedTouches"in G&&(ee||de)&&(a.current=se),!se)return!0;var ne=a.current||se;return VLe(ne,H,G,ne==="h"?ee:de)},[]),v=L.useCallback(function(G){var H=G;if(!(!nS.length||nS[nS.length-1]!==d)){var te="deltaY"in H?Xq(H):nO(H),K=t.current.filter(function(se){return se.name===H.type&&(se.target===H.target||H.target===se.shadowParent)&&FLe(se.delta,te)})[0];if(K&&K.should){H.cancelable&&H.preventDefault();return}if(!K){var ee=(f.current.shards||[]).map(Jq).filter(Boolean).filter(function(se){return se.contains(H.target)}),de=ee.length>0?E(H,ee[0]):!f.current.noIsolation;de&&H.cancelable&&H.preventDefault()}}},[]),T=L.useCallback(function(G,H,te,K){var ee={name:G,delta:H,target:te,should:K,shadowParent:zLe(te)};t.current.push(ee),setTimeout(function(){t.current=t.current.filter(function(de){return de!==ee})},1)},[]),R=L.useCallback(function(G){s.current=nO(G),a.current=void 0},[]),I=L.useCallback(function(G){T(G.type,Xq(G),G.target,E(G,r.lockRef.current))},[]),N=L.useCallback(function(G){T(G.type,nO(G),G.target,E(G,r.lockRef.current))},[]);L.useEffect(function(){return nS.push(d),r.setCallbacks({onScrollCapture:I,onWheelCapture:I,onTouchMoveCapture:N}),document.addEventListener("wheel",v,tS),document.addEventListener("touchmove",v,tS),document.addEventListener("touchstart",R,tS),function(){nS=nS.filter(function(G){return G!==d}),document.removeEventListener("wheel",v,tS),document.removeEventListener("touchmove",v,tS),document.removeEventListener("touchstart",R,tS)}},[]);var F=r.removeScrollBar,j=r.inert;return L.createElement(L.Fragment,null,j?L.createElement(d,{styles:jLe(l)}):null,F?L.createElement(kLe,{gapMode:r.gapMode}):null)}function zLe(r){for(var t=null;r!==null;)r instanceof ShadowRoot&&(t=r.host,r=r.host),r=r.parentNode;return t}const GLe=Xke(Ete,WLe);var bte=L.forwardRef(function(r,t){return L.createElement(oN,Nh({},r,{ref:t,sideCar:GLe}))});bte.classNames=oN.classNames;function HLe(r){const{autoFocus:t,trapFocus:s,dialogRef:a,initialFocusRef:l,blockScrollOnMount:d,allowPinchZoom:f,finalFocusRef:E,returnFocusOnClose:v,preserveScrollBarGap:T,lockFocusAcrossFrames:R,isOpen:I}=vE(),[N,F]=jV();L.useEffect(()=>{!N&&F&&setTimeout(F)},[N,F]);const j=_te(a,I);return P.jsx(Jee,{autoFocus:t,isDisabled:!s,initialFocusRef:l,finalFocusRef:E,restoreFocus:v,contentRef:a,lockFocusAcrossFrames:R,children:P.jsx(bte,{removeScrollBar:!T,allowPinchZoom:f,enabled:j===1&&d,forwardProps:!0,children:r.children})})}const $Le={initial:({offsetX:r,offsetY:t,transition:s,transitionEnd:a,delay:l})=>({opacity:0,x:r,y:t,transition:(s==null?void 0:s.exit)??uE.exit(lE.exit,l),transitionEnd:a==null?void 0:a.exit}),enter:({transition:r,transitionEnd:t,delay:s})=>({opacity:1,x:0,y:0,transition:(r==null?void 0:r.enter)??uE.enter(lE.enter,s),transitionEnd:t==null?void 0:t.enter}),exit:({offsetY:r,offsetX:t,transition:s,transitionEnd:a,reverse:l,delay:d})=>{const f={x:t,y:r};return{opacity:0,transition:(s==null?void 0:s.exit)??uE.exit(lE.exit,d),...l?{...f,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{...f,...a==null?void 0:a.exit}}}}},Ew={initial:"initial",animate:"enter",exit:"exit",variants:$Le},KLe=L.forwardRef(function(t,s){const{unmountOnExit:a,in:l,reverse:d=!0,className:f,offsetX:E=0,offsetY:v=8,transition:T,transitionEnd:R,delay:I,animatePresenceProps:N,...F}=t,j=a?l&&a:!0,G=l||a?"enter":"exit",H={offsetX:E,offsetY:v,reverse:d,transition:T,transitionEnd:R,delay:I};return P.jsx(p0,{...N,custom:H,children:j&&P.jsx(If.div,{ref:s,className:_n("chakra-offset-slide",f),custom:H,...Ew,animate:G,...F})})});KLe.displayName="SlideFade";const qLe={exit:({reverse:r,initialScale:t,transition:s,transitionEnd:a,delay:l})=>({opacity:0,...r?{scale:t,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{scale:t,...a==null?void 0:a.exit}},transition:(s==null?void 0:s.exit)??uE.exit(lE.exit,l)}),enter:({transitionEnd:r,transition:t,delay:s})=>({opacity:1,scale:1,transition:(t==null?void 0:t.enter)??uE.enter(lE.enter,s),transitionEnd:r==null?void 0:r.enter})},wte={initial:"exit",animate:"enter",exit:"exit",variants:qLe},YLe=L.forwardRef(function(t,s){const{unmountOnExit:a,in:l,reverse:d=!0,initialScale:f=.95,className:E,transition:v,transitionEnd:T,delay:R,animatePresenceProps:I,...N}=t,F=a?l&&a:!0,j=l||a?"enter":"exit",G={initialScale:f,reverse:d,transition:v,transitionEnd:T,delay:R};return P.jsx(p0,{...I,custom:G,children:F&&P.jsx(If.div,{ref:s,className:_n("chakra-offset-slide",E),...wte,animate:j,custom:G,...N})})});YLe.displayName="ScaleFade";const XLe={slideInBottom:{...Ew,custom:{offsetY:16,reverse:!0}},slideInRight:{...Ew,custom:{offsetX:16,reverse:!0}},slideInTop:{...Ew,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...Ew,custom:{offsetX:-16,reverse:!0}},scale:{...wte,custom:{initialScale:.95,reverse:!0}},none:{}},JLe=Mt(If.section),QLe=r=>XLe[r||"none"],Rte=L.forwardRef((r,t)=>{const{preset:s,motionProps:a=QLe(s),...l}=r;return P.jsx(JLe,{ref:t,...a,...l})});Rte.displayName="ModalTransition";const nc=Qt((r,t)=>{const{className:s,children:a,containerProps:l,motionProps:d,...f}=r,{getDialogProps:E,getDialogContainerProps:v}=vE(),T=E(f,t),R=v(l),I=_n("chakra-modal__content",s),N=y0(),F={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...N.dialog},j={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...N.dialogContainer},{motionPreset:G}=vE();return P.jsx(HLe,{children:P.jsx(Mt.div,{...R,className:"chakra-modal__content-container",tabIndex:-1,__css:j,children:P.jsx(Rte,{preset:G,motionProps:d,className:I,...T,__css:F,children:a})})})});nc.displayName="ModalContent";const rc=Qt((r,t)=>{const{className:s,...a}=r,{bodyId:l,setBodyMounted:d}=vE();L.useEffect(()=>(d(!0),()=>d(!1)),[d]);const f=_n("chakra-modal__body",s),E=y0();return P.jsx(Mt.div,{ref:t,className:f,id:l,...a,__css:E.body})});rc.displayName="ModalBody";const Xc=Qt((r,t)=>{const{onClick:s,className:a,...l}=r,{onClose:d}=vE(),f=_n("chakra-modal__close-btn",a),E=y0();return P.jsx(vF,{ref:t,__css:E.closeButton,className:f,onClick:Qn(s,v=>{v.stopPropagation(),d()}),...l})});Xc.displayName="ModalCloseButton";const SE=Qt((r,t)=>{const{className:s,...a}=r,l=_n("chakra-modal__footer",s),d=y0(),f={display:"flex",alignItems:"center",justifyContent:"flex-end",...d.footer};return P.jsx(Mt.footer,{ref:t,...a,__css:f,className:l})});SE.displayName="ModalFooter";const Cu=Qt((r,t)=>{const{className:s,...a}=r,{headerId:l,setHeaderMounted:d}=vE();L.useEffect(()=>(d(!0),()=>d(!1)),[d]);const f=_n("chakra-modal__header",s),E=y0(),v={flex:0,...E.header};return P.jsx(Mt.header,{ref:t,className:f,id:l,...a,__css:v})});Cu.displayName="ModalHeader";const ZLe={enter:({transition:r,transitionEnd:t,delay:s}={})=>({opacity:1,transition:(r==null?void 0:r.enter)??uE.enter(lE.enter,s),transitionEnd:t==null?void 0:t.enter}),exit:({transition:r,transitionEnd:t,delay:s}={})=>({opacity:0,transition:(r==null?void 0:r.exit)??uE.exit(lE.exit,s),transitionEnd:t==null?void 0:t.exit})},Cte={initial:"exit",animate:"enter",exit:"exit",variants:ZLe},exe=L.forwardRef(function(t,s){const{unmountOnExit:a,in:l,className:d,transition:f,transitionEnd:E,delay:v,animatePresenceProps:T,...R}=t,I=l||a?"enter":"exit",N=a?l&&a:!0,F={transition:f,transitionEnd:E,delay:v};return P.jsx(p0,{...T,custom:F,children:N&&P.jsx(If.div,{ref:s,className:_n("chakra-fade",d),custom:F,...Cte,animate:I,...R})})});exe.displayName="Fade";const txe=Mt(If.div),ic=Qt((r,t)=>{const{className:s,transition:a,motionProps:l,...d}=r,f=_n("chakra-modal__overlay",s),v={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...y0().overlay},{motionPreset:T}=vE(),I=l||(T==="none"?{}:Cte);return P.jsx(txe,{...I,__css:v,ref:t,className:f,...d})});ic.displayName="ModalOverlay";function nxe(r){const{leastDestructiveRef:t,...s}=r;return P.jsx(tc,{...s,initialFocusRef:t})}const rxe=Qt((r,t)=>P.jsx(nc,{ref:t,role:"alertdialog",...r})),[ixe,aN]=Wi({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[sxe,Ite]=Wi({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),rS={click:"click",hover:"hover"};function oxe(r={}){const{closeOnBlur:t=!0,closeOnEsc:s=!0,initialFocusRef:a,id:l,returnFocusOnClose:d=!0,autoFocus:f=!0,arrowSize:E,arrowShadowColor:v,trigger:T=rS.click,openDelay:R=200,closeDelay:I=200,isLazy:N,lazyBehavior:F="unmount",computePositionOnMount:j,...G}=r,{isOpen:H,onClose:te,onOpen:K,onToggle:ee}=ag(r),[de,se]=L.useState(d);L.useEffect(()=>se(d),[d]);const ge=L.useRef(null),Z=L.useRef(null),Q=L.useRef(null),ne=L.useRef(!1),oe=L.useRef(!1);H&&(oe.current=!0);const[pe,he]=L.useState(!1),[le,Me]=L.useState(!1),He=L.useId(),rt=l??He,[we,Ce,ye,Ne]=["popover-trigger","popover-content","popover-header","popover-body"].map($t=>`${$t}-${rt}`),{referenceRef:Te,getArrowProps:Se,getPopperProps:Ae,getArrowInnerProps:Ue,forceUpdate:ze}=GF({...G,enabled:H||!!j}),et=FJ({isOpen:H,ref:Q});Q_e({enabled:H,ref:Z}),BJ(Q,{focusRef:Z,visible:H,shouldFocus:de&&T===rS.click}),G_e(Q,{focusRef:a,visible:H,shouldFocus:f&&T===rS.click}),GJ({enabled:H&&t,ref:Q,handler($t){var Fe;const Re=((Fe=$t.composedPath)==null?void 0:Fe.call($t)[0])??[$t.target];rO(Z.current,Re)||(Re&&se(!JO(Re)),te())}});const nt=_V({wasSelected:oe.current,enabled:N,mode:F,isSelected:et.present}),dt=L.useCallback(($t={},Re=null)=>{const Fe={...$t,style:{...$t.style,transformOrigin:zs.transformOrigin.varRef,[zs.arrowSize.var]:E?`${E}px`:void 0,[zs.arrowShadowColor.var]:v},ref:Yi(Q,Re),children:nt?$t.children:null,id:Ce,tabIndex:-1,role:"dialog",onKeyDown:Qn($t.onKeyDown,Ke=>{Ke.nativeEvent.isComposing||s&&Ke.key==="Escape"&&(Ke.preventDefault(),Ke.stopPropagation(),te())}),onBlur:Qn($t.onBlur,Ke=>{const _t=Qq(Ke),yt=rO(Q.current,_t),Ge=rO(Z.current,_t),Pt=!yt&&!Ge;_t&&se(!JO(_t)),H&&t&&Pt&&te()}),"aria-labelledby":pe?ye:void 0,"aria-describedby":le?Ne:void 0};return T===rS.hover&&(Fe.role="tooltip",Fe.onMouseEnter=Qn($t.onMouseEnter,()=>{ne.current=!0}),Fe.onMouseLeave=Qn($t.onMouseLeave,Ke=>{Ke.nativeEvent.relatedTarget!==null&&(ne.current=!1,setTimeout(()=>te(),I))})),Fe},[nt,Ce,pe,ye,le,Ne,T,s,te,H,t,I,v,E]),Xe=L.useCallback(($t={},Re=null)=>Ae({...$t,style:{visibility:H?"visible":"hidden",...$t.style}},Re),[H,Ae]),Ct=L.useCallback(($t,Re=null)=>({...$t,ref:Yi(Re,ge,Te)}),[ge,Te]),dn=L.useRef(void 0),Ut=L.useRef(void 0),ln=L.useCallback($t=>{ge.current==null&&Te($t)},[Te]),Ln=L.useCallback(($t={},Re=null)=>{const Fe={...$t,ref:Yi(Z,Re,ln),id:we,"aria-haspopup":"dialog","aria-expanded":H,"aria-controls":Ce};return T===rS.click&&(Fe.onClick=Qn($t.onClick,ee)),T===rS.hover&&(Fe.onFocus=Qn($t.onFocus,()=>{dn.current===void 0&&K()}),Fe.onBlur=Qn($t.onBlur,Ke=>{const _t=Qq(Ke),yt=!rO(Q.current,_t);H&&t&&yt&&te()}),Fe.onKeyDown=Qn($t.onKeyDown,Ke=>{Ke.key==="Escape"&&te()}),Fe.onMouseEnter=Qn($t.onMouseEnter,()=>{ne.current=!0,dn.current=window.setTimeout(()=>K(),R)}),Fe.onMouseLeave=Qn($t.onMouseLeave,()=>{ne.current=!1,dn.current&&(clearTimeout(dn.current),dn.current=void 0),Ut.current=window.setTimeout(()=>{ne.current===!1&&te()},I)})),Fe},[we,H,Ce,T,ln,ee,K,t,te,R,I]);L.useEffect(()=>()=>{dn.current&&clearTimeout(dn.current),Ut.current&&clearTimeout(Ut.current)},[]);const qt=L.useCallback(($t={},Re=null)=>({...$t,id:ye,ref:Yi(Re,Fe=>{he(!!Fe)})}),[ye]),Yn=L.useCallback(($t={},Re=null)=>({...$t,id:Ne,ref:Yi(Re,Fe=>{Me(!!Fe)})}),[Ne]);return{forceUpdate:ze,isOpen:H,onAnimationComplete:et.onComplete,onClose:te,getAnchorProps:Ct,getArrowProps:Se,getArrowInnerProps:Ue,getPopoverPositionerProps:Xe,getPopoverProps:dt,getTriggerProps:Ln,getHeaderProps:qt,getBodyProps:Yn}}function rO(r,t){return r===t||(r==null?void 0:r.contains(t))}function Qq(r){const t=r.currentTarget.ownerDocument.activeElement;return r.relatedTarget??t}function Ate(r){const t=Qc("Popover",r),{children:s,...a}=Ji(r),l=g0(),d=oxe({...a,direction:l.direction});return P.jsx(ixe,{value:d,children:P.jsx(sxe,{value:t,children:Hc(s,{isOpen:d.isOpen,onClose:d.onClose,forceUpdate:d.forceUpdate})})})}Ate.displayName="Popover";function Pte(r){var s;const t=L.version;return typeof t!="string"||t.startsWith("18.")?r==null?void 0:r.ref:(s=r==null?void 0:r.props)==null?void 0:s.ref}const Ote=Qt(function(t,s){const{getBodyProps:a}=aN(),l=Ite();return P.jsx(Mt.div,{...a(t,s),className:_n("chakra-popover__body",t.className),__css:l.body})});Ote.displayName="PopoverBody";function axe(r){if(r)return{enter:{...r.enter,visibility:"visible"},exit:{...r.exit,transitionEnd:{visibility:"hidden"}}}}const cxe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},lxe=Mt(If.section),kte=Qt(function(t,s){const{variants:a=cxe,...l}=t,{isOpen:d}=aN();return P.jsx(lxe,{ref:s,variants:axe(a),initial:!1,animate:d?"enter":"exit",...l})});kte.displayName="PopoverTransition";const Nte=Qt(function(t,s){const{rootProps:a,motionProps:l,...d}=t,{getPopoverProps:f,getPopoverPositionerProps:E,onAnimationComplete:v}=aN(),T=Ite(),R={position:"relative",display:"flex",flexDirection:"column",...T.content};return P.jsx(Mt.div,{...E(a),__css:T.popper,className:"chakra-popover__popper",children:P.jsx(kte,{...l,...f(d,s),onAnimationComplete:DJ(v,d.onAnimationComplete),className:_n("chakra-popover__content",t.className),__css:R})})});Nte.displayName="PopoverContent";function Dte(r){const t=L.Children.only(r.children),{getTriggerProps:s}=aN();return P.jsx(P.Fragment,{children:L.cloneElement(t,s(t.props,Pte(t)))})}Dte.displayName="PopoverTrigger";function uxe(r,t,s){return(r-t)*100/(s-t)}RR({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});RR({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const dxe=RR({"0%":{left:"-40%"},"100%":{left:"100%"}}),hxe=RR({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function pxe(r){const{value:t=0,min:s,max:a,valueText:l,getValueText:d,isIndeterminate:f,role:E="progressbar"}=r,v=uxe(t,s,a);return{bind:{"data-indeterminate":f?"":void 0,"aria-valuemax":a,"aria-valuemin":s,"aria-valuenow":f?void 0:t,"aria-valuetext":(()=>{if(t!=null)return typeof d=="function"?d(t,v):l})(),role:E},percent:v,value:t}}const[fxe,mxe]=Wi({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),gxe=Qt((r,t)=>{const{min:s,max:a,value:l,isIndeterminate:d,role:f,...E}=r,v=pxe({value:l,min:s,max:a,isIndeterminate:d,role:f}),R={height:"100%",...mxe().filledTrack};return P.jsx(Mt.div,{ref:t,style:{width:`${v.percent}%`,...E.style},...v.bind,...E,__css:R})}),t0=Qt((r,t)=>{var Z;const{value:s,min:a=0,max:l=100,hasStripe:d,isAnimated:f,children:E,borderRadius:v,isIndeterminate:T,"aria-label":R,"aria-labelledby":I,"aria-valuetext":N,title:F,role:j,...G}=Ji(r),H=Qc("Progress",r),te=v??((Z=H.track)==null?void 0:Z.borderRadius),K={animation:`${hxe} 1s linear infinite`},se={...!T&&d&&f&&K,...T&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${dxe} 1s ease infinite normal none running`}},ge={overflow:"hidden",position:"relative",...H.track};return P.jsx(Mt.div,{ref:t,borderRadius:te,__css:ge,...G,children:P.jsxs(fxe,{value:H,children:[P.jsx(gxe,{"aria-label":R,"aria-labelledby":I,"aria-valuetext":N,min:a,max:l,value:s,isIndeterminate:T,css:se,borderRadius:te,title:F,role:j}),E]})})});t0.displayName="Progress";const Lte=Qt(function(t,s){const{children:a,placeholder:l,className:d,...f}=t;return P.jsxs(Mt.select,{...f,ref:s,className:_n("chakra-select",d),children:[l&&P.jsx("option",{value:"",children:l}),a]})});Lte.displayName="SelectField";const xte=Qt((r,t)=>{var ee;const s=Qc("Select",r),{rootProps:a,placeholder:l,icon:d,color:f,height:E,h:v,minH:T,minHeight:R,iconColor:I,iconSize:N,...F}=Ji(r),[j,G]=V_e(F,QEe),H=bF(G),te={width:"100%",height:"fit-content",position:"relative",color:f},K={paddingEnd:"2rem",...s.field,_focus:{zIndex:"unset",...(ee=s.field)==null?void 0:ee._focus}};return P.jsxs(Mt.div,{className:"chakra-select__wrapper",__css:te,...j,...a,children:[P.jsx(Lte,{ref:t,height:v??E,minH:T??R,placeholder:l,...H,__css:K,children:r.children}),P.jsx(Mte,{"data-disabled":Kn(H.disabled),...(I||f)&&{color:I||f},__css:s.icon,...N&&{fontSize:N},children:d})]})});xte.displayName="Select";const _xe=r=>P.jsx("svg",{viewBox:"0 0 24 24",...r,children:P.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),Exe=Mt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),Mte=r=>{const{children:t=P.jsx(_xe,{}),...s}=r,a=L.cloneElement(t,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return P.jsx(Exe,{...s,className:"chakra-select__icon-wrapper",children:L.isValidElement(t)?a:null})};Mte.displayName="SelectIcon";function d2(r){const{orientation:t,vertical:s,horizontal:a}=r;return t==="vertical"?s:a}function yxe(r){const{orientation:t,thumbPercents:s,isReversed:a}=r,l=F=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...d2({orientation:t,vertical:{bottom:`calc(${s[F]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${s[F]}% - var(--slider-thumb-size) / 2)`}})}),d={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},f={position:"absolute",...d2({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},E=s.length===1,v=[0,a?100-s[0]:s[0]],T=E?v:s;let R=T[0];!E&&a&&(R=100-R);const I=Math.abs(T[T.length-1]-T[0]),N={...f,...d2({orientation:t,vertical:a?{height:`${I}%`,top:`${R}%`}:{height:`${I}%`,bottom:`${R}%`},horizontal:a?{width:`${I}%`,right:`${R}%`}:{width:`${I}%`,left:`${R}%`}})};return{trackStyle:f,innerTrackStyle:N,rootStyle:d,getThumbStyle:l}}function vxe(r){const{isReversed:t,direction:s,orientation:a}=r;return s==="ltr"||a==="vertical"?t:!t}function Sxe(r){const{min:t=0,max:s=100,onChange:a,value:l,defaultValue:d,isReversed:f,direction:E="ltr",orientation:v="horizontal",id:T,isDisabled:R,isReadOnly:I,onChangeStart:N,onChangeEnd:F,step:j=1,getAriaValueText:G,"aria-valuetext":H,"aria-label":te,"aria-labelledby":K,name:ee,focusThumbOnChange:de=!0,...se}=r,ge=$c(N),Z=$c(F),Q=$c(G),ne=vxe({isReversed:f,direction:E,orientation:v}),[oe,pe]=jJ({value:l,defaultValue:d??bxe(t,s),onChange:a}),[he,le]=L.useState(!1),[Me,He]=L.useState(!1),rt=!(R||I),we=(s-t)/10,Ce=j||(s-t)/100,ye=fM(oe,t,s),Ne=s-ye+t,Se=u$(ne?Ne:ye,t,s),Ae=v==="vertical",Ue=zJ({min:t,max:s,step:j,isDisabled:R,value:ye,isInteractive:rt,isReversed:ne,isVertical:Ae,eventSource:null,focusThumbOnChange:de,orientation:v}),ze=L.useRef(null),et=L.useRef(null),nt=L.useRef(null),dt=L.useId(),Xe=T??dt,[Ct,dn]=[`slider-thumb-${Xe}`,`slider-track-${Xe}`],Ut=L.useCallback(Vt=>{var oo;if(!ze.current)return;const sn=Ue.current;sn.eventSource="pointer";const wi=ze.current.getBoundingClientRect(),{clientX:di,clientY:yi}=((oo=Vt.touches)==null?void 0:oo[0])??Vt,ur=Ae?wi.bottom-yi:di-wi.left,Da=Ae?wi.height:wi.width;let Zc=ur/Da;ne&&(Zc=1-Zc);let so=L_e(Zc,sn.min,sn.max);return sn.step&&(so=parseFloat(d$(so,sn.min,sn.step))),so=fM(so,sn.min,sn.max),so},[Ae,ne,Ue]),ln=L.useCallback(Vt=>{const sn=Ue.current;sn.isInteractive&&(Vt=parseFloat(d$(Vt,sn.min,Ce)),Vt=fM(Vt,sn.min,sn.max),pe(Vt))},[Ce,pe,Ue]),Ln=L.useMemo(()=>({stepUp(Vt=Ce){const sn=ne?ye-Vt:ye+Vt;ln(sn)},stepDown(Vt=Ce){const sn=ne?ye+Vt:ye-Vt;ln(sn)},reset(){ln(d||0)},stepTo(Vt){ln(Vt)}}),[ln,ne,ye,Ce,d]),qt=L.useCallback(Vt=>{const sn=Ue.current,di={ArrowRight:()=>Ln.stepUp(),ArrowUp:()=>Ln.stepUp(),ArrowLeft:()=>Ln.stepDown(),ArrowDown:()=>Ln.stepDown(),PageUp:()=>Ln.stepUp(we),PageDown:()=>Ln.stepDown(we),Home:()=>ln(sn.min),End:()=>ln(sn.max)}[Vt.key];di&&(Vt.preventDefault(),Vt.stopPropagation(),di(Vt),sn.eventSource="keyboard")},[Ln,ln,we,Ue]),Yn=(Q==null?void 0:Q(ye))??H,{getThumbStyle:$t,rootStyle:Re,trackStyle:Fe,innerTrackStyle:Ke}=L.useMemo(()=>{const Vt=Ue.current;return yxe({isReversed:ne,orientation:Vt.orientation,thumbPercents:[Se]})},[ne,Se,Ue]),_t=L.useCallback(()=>{Ue.current.focusThumbOnChange&&setTimeout(()=>{var sn;return(sn=et.current)==null?void 0:sn.focus()})},[Ue]);cg(()=>{const Vt=Ue.current;_t(),Vt.eventSource==="keyboard"&&(Z==null||Z(Vt.value))},[ye,Z]);function yt(Vt){const sn=Ut(Vt);sn!=null&&sn!==Ue.current.value&&pe(sn)}EEe(nt,{onPanSessionStart(Vt){const sn=Ue.current;sn.isInteractive&&(le(!0),_t(),yt(Vt),ge==null||ge(sn.value))},onPanSessionEnd(){const Vt=Ue.current;Vt.isInteractive&&(le(!1),Z==null||Z(Vt.value))},onPan(Vt){Ue.current.isInteractive&&yt(Vt)}});const Ge=L.useCallback((Vt={},sn=null)=>({...Vt,...se,ref:Yi(sn,nt),tabIndex:-1,"aria-disabled":wS(R),"data-focused":Kn(Me),style:{...Vt.style,...Re}}),[se,R,Me,Re]),Pt=L.useCallback((Vt={},sn=null)=>({...Vt,ref:Yi(sn,ze),id:dn,"data-disabled":Kn(R),style:{...Vt.style,...Fe}}),[R,dn,Fe]),Yt=L.useCallback((Vt={},sn=null)=>({...Vt,ref:sn,style:{...Vt.style,...Ke}}),[Ke]),hn=L.useCallback((Vt={},sn=null)=>({...Vt,ref:Yi(sn,et),role:"slider",tabIndex:rt?0:void 0,id:Ct,"data-active":Kn(he),"aria-valuetext":Yn,"aria-valuemin":t,"aria-valuemax":s,"aria-valuenow":ye,"aria-orientation":v,"aria-disabled":wS(R),"aria-readonly":wS(I),"aria-label":te,"aria-labelledby":te?void 0:K,style:{...Vt.style,...$t(0)},onKeyDown:Qn(Vt.onKeyDown,qt),onFocus:Qn(Vt.onFocus,()=>He(!0)),onBlur:Qn(Vt.onBlur,()=>He(!1))}),[rt,Ct,he,Yn,t,s,ye,v,R,I,te,K,$t,qt]),an=L.useCallback((Vt,sn=null)=>{const wi=!(Vt.value<t||Vt.value>s),di=ye>=Vt.value,yi=u$(Vt.value,t,s),ur={position:"absolute",pointerEvents:"none",...Txe({orientation:v,vertical:{bottom:ne?`${100-yi}%`:`${yi}%`},horizontal:{left:ne?`${100-yi}%`:`${yi}%`}})};return{...Vt,ref:sn,role:"presentation","aria-hidden":!0,"data-disabled":Kn(R),"data-invalid":Kn(!wi),"data-highlighted":Kn(di),style:{...Vt.style,...ur}}},[R,ne,s,t,v,ye]),ir=L.useCallback((Vt={},sn=null)=>({...Vt,ref:sn,type:"hidden",value:ye,name:ee}),[ee,ye]);return{state:{value:ye,isFocused:Me,isDragging:he},actions:Ln,getRootProps:Ge,getTrackProps:Pt,getInnerTrackProps:Yt,getThumbProps:hn,getMarkerProps:an,getInputProps:ir}}function Txe(r){const{orientation:t,vertical:s,horizontal:a}=r;return t==="vertical"?s:a}function bxe(r,t){return t<r?r:r+(t-r)/2}const[wxe,cN]=Wi({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[Rxe,lN]=Wi({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),IU=Qt((r,t)=>{const s={...r,orientation:(r==null?void 0:r.orientation)??"horizontal"},a=Qc("Slider",s),l=Ji(s),{direction:d}=g0();l.direction=d;const{getInputProps:f,getRootProps:E,...v}=Sxe(l),T=E(),R=f({},t);return P.jsx(wxe,{value:v,children:P.jsx(Rxe,{value:a,children:P.jsxs(Mt.div,{...T,className:_n("chakra-slider",s.className),__css:a.container,children:[s.children,P.jsx("input",{...R})]})})})});IU.displayName="Slider";const AU=Qt((r,t)=>{const{getThumbProps:s}=cN(),a=lN(),l=s(r,t);return P.jsx(Mt.div,{...l,className:_n("chakra-slider__thumb",r.className),__css:a.thumb})});AU.displayName="SliderThumb";const PU=Qt((r,t)=>{const{getTrackProps:s}=cN(),a=lN(),l=s(r,t);return P.jsx(Mt.div,{...l,className:_n("chakra-slider__track",r.className),__css:a.track})});PU.displayName="SliderTrack";const OU=Qt((r,t)=>{const{getInnerTrackProps:s}=cN(),a=lN(),l=s(r,t);return P.jsx(Mt.div,{...l,className:_n("chakra-slider__filled-track",r.className),__css:a.filledTrack})});OU.displayName="SliderFilledTrack";const Cxe=Qt((r,t)=>{const{getMarkerProps:s}=cN(),a=lN(),l=s(r,t);return P.jsx(Mt.div,{...l,className:_n("chakra-slider__marker",r.className),__css:a.mark})});Cxe.displayName="SliderMark";const pk=Mt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});pk.displayName="Spacer";const Ute=r=>P.jsx(Mt.div,{className:"chakra-stack__item",...r,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...r.__css}});Ute.displayName="StackItem";function Ixe(r){const{spacing:t,direction:s}=r,a={column:{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":EV(s,l=>a[l])}}const qF=Qt((r,t)=>{const{isInline:s,direction:a,align:l,justify:d,spacing:f="0.5rem",wrap:E,children:v,divider:T,className:R,shouldWrapChildren:I,...N}=r,F=s?"row":a??"column",j=L.useMemo(()=>Ixe({spacing:f,direction:F}),[f,F]),G=!!T,H=!I&&!G,te=L.useMemo(()=>{const ee=gV(v);return H?ee:ee.map((de,se)=>{const ge=typeof de.key<"u"?de.key:se,Z=se+1===ee.length,ne=I?P.jsx(Ute,{children:de},ge):de;if(!G)return ne;const oe=L.cloneElement(T,{__css:j}),pe=Z?null:oe;return P.jsxs(L.Fragment,{children:[ne,pe]},ge)})},[T,j,G,H,I,v]),K=_n("chakra-stack",R);return P.jsx(Mt.div,{ref:t,display:"flex",alignItems:l,justifyContent:d,flexDirection:F,flexWrap:E,gap:G?void 0:f,className:K,...N,children:te})});qF.displayName="Stack";const Ii=Qt((r,t)=>P.jsx(qF,{align:"center",...r,direction:"row",ref:t}));Ii.displayName="HStack";const ji=Qt((r,t)=>P.jsx(qF,{align:"center",...r,direction:"column",ref:t}));ji.displayName="VStack";const Zm=Qt(function(t,s){const a=Qc("Switch",t),{spacing:l="0.5rem",children:d,...f}=Ji(t),{getIndicatorProps:E,getInputProps:v,getCheckboxProps:T,getRootProps:R,getLabelProps:I}=Uke(f),N=L.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),F=L.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),j=L.useMemo(()=>({userSelect:"none",marginStart:l,...a.label}),[l,a.label]);return P.jsxs(Mt.label,{...R(),className:_n("chakra-switch",t.className),__css:N,children:[P.jsx("input",{className:"chakra-switch__input",...v({},s)}),P.jsx(Mt.span,{...T(),className:"chakra-switch__track",__css:F,children:P.jsx(Mt.span,{__css:a.thumb,className:"chakra-switch__thumb",...E()})}),d&&P.jsx(Mt.span,{className:"chakra-switch__label",...I(),__css:j,children:d})]})});Zm.displayName="Switch";const[Axe,Pxe,Oxe,kxe]=hee();function Nxe(r){const{defaultIndex:t,onChange:s,index:a,isManual:l,isLazy:d,lazyBehavior:f="unmount",orientation:E="horizontal",direction:v="ltr",...T}=r,[R,I]=L.useState(t??0),[N,F]=jJ({defaultValue:t??0,value:a,onChange:s});L.useEffect(()=>{a!=null&&I(a)},[a]);const j=Oxe(),G=L.useId();return{id:`tabs-${r.id??G}`,selectedIndex:N,focusedIndex:R,setSelectedIndex:F,setFocusedIndex:I,isManual:l,isLazy:d,lazyBehavior:f,orientation:E,descendants:j,direction:v,htmlProps:T}}const[Dxe,uN]=Wi({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function Lxe(r){const{focusedIndex:t,orientation:s,direction:a}=uN(),l=Pxe(),d=L.useCallback(f=>{const E=()=>{var ee;const K=l.nextEnabled(t);K&&((ee=K.node)==null||ee.focus())},v=()=>{var ee;const K=l.prevEnabled(t);K&&((ee=K.node)==null||ee.focus())},T=()=>{var ee;const K=l.firstEnabled();K&&((ee=K.node)==null||ee.focus())},R=()=>{var ee;const K=l.lastEnabled();K&&((ee=K.node)==null||ee.focus())},I=s==="horizontal",N=s==="vertical",F=f.key,j=a==="ltr"?"ArrowLeft":"ArrowRight",G=a==="ltr"?"ArrowRight":"ArrowLeft",te={[j]:()=>I&&v(),[G]:()=>I&&E(),ArrowDown:()=>N&&E(),ArrowUp:()=>N&&v(),Home:T,End:R}[F];te&&(f.preventDefault(),te(f))},[l,t,s,a]);return{...r,role:"tablist","aria-orientation":s,onKeyDown:Qn(r.onKeyDown,d)}}function xxe(r){const{isDisabled:t=!1,isFocusable:s=!1,...a}=r,{setSelectedIndex:l,isManual:d,id:f,setFocusedIndex:E,selectedIndex:v}=uN(),{index:T,register:R}=kxe({disabled:t&&!s}),I=T===v,N=()=>{l(T)},F=()=>{E(T),!d&&!(t&&s)&&l(T)};return{...dte({...a,ref:Yi(R,r.ref),isDisabled:t,isFocusable:s,onClick:Qn(r.onClick,N)}),id:Vte(f,T),role:"tab",tabIndex:I?0:-1,type:"button","aria-selected":I,"aria-controls":Fte(f,T),onFocus:t?void 0:Qn(r.onFocus,F)}}const[Mxe,Uxe]=Wi({});function Vxe(r){const t=uN(),{id:s,selectedIndex:a}=t,d=gV(r.children).map((f,E)=>L.createElement(Mxe,{key:f.key??E,value:{isSelected:E===a,id:Fte(s,E),tabId:Vte(s,E),selectedIndex:a}},f));return{...r,children:d}}function Fxe(r){const{children:t,...s}=r,{isLazy:a,lazyBehavior:l}=uN(),{isSelected:d,id:f,tabId:E}=Uxe(),v=L.useRef(!1);d&&(v.current=!0);const T=_V({wasSelected:v.current,isSelected:d,enabled:a,mode:l});return{tabIndex:0,...s,children:T?t:null,role:"tabpanel","aria-labelledby":E,hidden:!d,id:f}}function Vte(r,t){return`${r}--tab-${t}`}function Fte(r,t){return`${r}--tabpanel-${t}`}const[jxe,dN]=Wi({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),UR=Qt(function(t,s){const a=Qc("Tabs",t),{children:l,className:d,...f}=Ji(t),{htmlProps:E,descendants:v,...T}=Nxe(f),R=L.useMemo(()=>T,[T]),{isFitted:I,...N}=E,F={position:"relative",...a.root};return P.jsx(Axe,{value:v,children:P.jsx(Dxe,{value:R,children:P.jsx(jxe,{value:a,children:P.jsx(Mt.div,{className:_n("chakra-tabs",d),ref:s,...N,__css:F,children:l})})})})});UR.displayName="Tabs";const zc=Qt(function(t,s){const a=dN(),l=xxe({...t,ref:s}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...a.tab};return P.jsx(Mt.button,{...l,className:_n("chakra-tabs__tab",t.className),__css:d})});zc.displayName="Tab";const VR=Qt(function(t,s){const a=Lxe({...t,ref:s}),l=dN(),d={display:"flex",...l.tablist};return P.jsx(Mt.div,{...a,className:_n("chakra-tabs__tablist",t.className),__css:d})});VR.displayName="TabList";const yu=Qt(function(t,s){const a=Fxe({...t,ref:s}),l=dN();return P.jsx(Mt.div,{outline:"0",...a,className:_n("chakra-tabs__tab-panel",t.className),__css:l.tabpanel})});yu.displayName="TabPanel";const hN=Qt(function(t,s){const a=Vxe(t),l=dN();return P.jsx(Mt.div,{...a,width:"100%",ref:s,className:_n("chakra-tabs__tab-panels",t.className),__css:l.tabpanels})});hN.displayName="TabPanels";const Bxe=["h","minH","height","minHeight"],jte=Qt((r,t)=>{const s=Iu("Textarea",r),{className:a,rows:l,...d}=Ji(r),f=bF(d),E=l?d0(s,Bxe):s;return P.jsx(Mt.textarea,{ref:t,rows:l,...f,className:_n("chakra-textarea",a),__css:E})});jte.displayName="Textarea";function Wxe(r,t){const s=r??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[s];return(l==null?void 0:l[t])??s}function zxe(r,t){const s=l=>({...t,...l,position:Wxe((l==null?void 0:l.position)??(t==null?void 0:t.position),r)}),a=l=>{const d=s(l),f=lee(d);return kh.notify(f,d)};return a.update=(l,d)=>{kh.update(l,s(d))},a.promise=(l,d)=>{const f=a({...d.loading,status:"loading",duration:null});l.then(E=>a.update(f,{status:"success",duration:5e3,...Hc(d.success,E)})).catch(E=>a.update(f,{status:"error",duration:5e3,...Hc(d.error,E)}))},a.closeAll=kh.closeAll,a.close=kh.close,a.isActive=kh.isActive,a}function Zh(r){const{theme:t}=oee(),s=cke();return L.useMemo(()=>zxe(t.direction,{...s,...r}),[r,t.direction,s])}const Gxe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},kU=r=>{var t;return((t=r.current)==null?void 0:t.ownerDocument)||document},MO=r=>{var t,s;return((s=(t=r.current)==null?void 0:t.ownerDocument)==null?void 0:s.defaultView)||window};function Hxe(r={}){const{openDelay:t=0,closeDelay:s=0,closeOnClick:a=!0,closeOnMouseDown:l,closeOnScroll:d,closeOnPointerDown:f=l,closeOnEsc:E=!0,onOpen:v,onClose:T,placement:R,id:I,isOpen:N,defaultIsOpen:F,arrowSize:j=10,arrowShadowColor:G,arrowPadding:H,modifiers:te,isDisabled:K,gutter:ee,offset:de,direction:se,...ge}=r,{isOpen:Z,onOpen:Q,onClose:ne}=ag({isOpen:N,defaultIsOpen:F,onOpen:v,onClose:T}),{referenceRef:oe,getPopperProps:pe,getArrowInnerProps:he,getArrowProps:le}=GF({enabled:Z,placement:R,arrowPadding:H,modifiers:te,gutter:ee,offset:de,direction:se}),Me=L.useId(),rt=`tooltip-${I??Me}`,we=L.useRef(null),Ce=L.useRef(void 0),ye=L.useCallback(()=>{Ce.current&&(clearTimeout(Ce.current),Ce.current=void 0)},[]),Ne=L.useRef(void 0),Te=L.useCallback(()=>{Ne.current&&(clearTimeout(Ne.current),Ne.current=void 0)},[]),Se=L.useCallback(()=>{Te(),ne()},[ne,Te]),Ae=$xe(we,Se),Ue=L.useCallback(()=>{if(!K&&!Ce.current){Z&&Ae();const Ut=MO(we);Ce.current=Ut.setTimeout(Q,t)}},[Ae,K,Z,Q,t]),ze=L.useCallback(()=>{ye();const Ut=MO(we);Ne.current=Ut.setTimeout(Se,s)},[s,Se,ye]),et=L.useCallback(()=>{Z&&a&&ze()},[a,ze,Z]),nt=L.useCallback(()=>{Z&&f&&ze()},[f,ze,Z]),dt=L.useCallback(Ut=>{Z&&Ut.key==="Escape"&&ze()},[Z,ze]);RS(()=>kU(we),"keydown",E?dt:void 0),RS(()=>{if(!d)return null;const Ut=we.current;if(!Ut)return null;const ln=VJ(Ut);return ln.localName==="body"?MO(we):ln},"scroll",()=>{Z&&d&&Se()},{passive:!0,capture:!0}),L.useEffect(()=>{K&&(ye(),Z&&ne())},[K,Z,ne,ye]),L.useEffect(()=>()=>{ye(),Te()},[ye,Te]),RS(()=>we.current,"pointerleave",ze);const Xe=L.useCallback((Ut={},ln=null)=>({...Ut,ref:Yi(we,ln,oe),onPointerEnter:Qn(Ut.onPointerEnter,qt=>{qt.pointerType!=="touch"&&Ue()}),onClick:Qn(Ut.onClick,et),onPointerDown:Qn(Ut.onPointerDown,nt),onFocus:Qn(Ut.onFocus,Ue),onBlur:Qn(Ut.onBlur,ze),"aria-describedby":Z?rt:void 0}),[Ue,ze,nt,Z,rt,et,oe]),Ct=L.useCallback((Ut={},ln=null)=>pe({...Ut,style:{...Ut.style,[zs.arrowSize.var]:j?`${j}px`:void 0,[zs.arrowShadowColor.var]:G}},ln),[pe,j,G]),dn=L.useCallback((Ut={},ln=null)=>{const Ln={...Ut.style,position:"relative",transformOrigin:zs.transformOrigin.varRef};return{ref:ln,...ge,...Ut,id:rt,role:"tooltip",style:Ln}},[ge,rt]);return{isOpen:Z,show:Ue,hide:ze,getTriggerProps:Xe,getTooltipProps:dn,getTooltipPositionerProps:Ct,getArrowProps:le,getArrowInnerProps:he}}const h2="chakra-ui:close-tooltip";function $xe(r,t){return L.useEffect(()=>{const s=kU(r);return s.addEventListener(h2,t),()=>s.removeEventListener(h2,t)},[t,r]),()=>{const s=kU(r),a=MO(r);s.dispatchEvent(new a.CustomEvent(h2))}}const Kxe=Mt(If.div),eg=Qt((r,t)=>{const s=Iu("Tooltip",r),a=Ji(r),l=g0(),{children:d,label:f,shouldWrapChildren:E,"aria-label":v,hasArrow:T,bg:R,portalProps:I,background:N,backgroundColor:F,bgColor:j,motionProps:G,animatePresenceProps:H,...te}=a,K=N??F??R??j;if(K){s.bg=K;const oe=cye(l,"colors",K);s[zs.arrowBg.var]=oe}const ee=Hxe({...te,direction:l.direction}),de=!L.isValidElement(d)||E;let se;if(de)se=P.jsx(Mt.span,{display:"inline-block",tabIndex:0,...ee.getTriggerProps(),children:d});else{const oe=L.Children.only(d);se=L.cloneElement(oe,ee.getTriggerProps(oe.props,Pte(oe)))}const ge=!!v,Z=ee.getTooltipProps({},t),Q=ge?d0(Z,["role","id"]):Z,ne=UJ(Z,["role","id"]);return f?P.jsxs(P.Fragment,{children:[se,P.jsx(p0,{...H,children:ee.isOpen&&P.jsx(Au,{...I,children:P.jsx(Mt.div,{...ee.getTooltipPositionerProps(),__css:{zIndex:s.zIndex,pointerEvents:"none"},children:P.jsxs(Kxe,{variants:Gxe,initial:"exit",animate:"enter",exit:"exit",...G,...Q,__css:s,children:[f,ge&&P.jsx(Mt.span,{srOnly:!0,...ne,children:v}),T&&P.jsx(Mt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:P.jsx(Mt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:s.bg}})})]})})})})]}):P.jsx(P.Fragment,{children:d})});eg.displayName="Tooltip";const fk=Qt(function(t,s){const a=Iu("Heading",t),{className:l,...d}=Ji(t);return P.jsx(Mt.h2,{ref:s,className:_n("chakra-heading",t.className),...d,__css:a})});fk.displayName="Heading";const St=Qt(function(t,s){const a=Iu("Text",t),{className:l,align:d,decoration:f,casing:E,...v}=Ji(t),T=Wk({textAlign:t.align,textDecoration:t.decoration,textTransform:t.casing});return P.jsx(Mt.p,{ref:s,className:_n("chakra-text",t.className),...T,...v,__css:a})});St.displayName="Text";const qxe="modulepreload",Yxe=function(r,t){return new URL(r,t).href},Zq={},p2=function(t,s,a){let l=Promise.resolve();if(s&&s.length>0){const f=document.getElementsByTagName("link"),E=document.querySelector("meta[property=csp-nonce]"),v=(E==null?void 0:E.nonce)||(E==null?void 0:E.getAttribute("nonce"));l=Promise.allSettled(s.map(T=>{if(T=Yxe(T,a),T in Zq)return;Zq[T]=!0;const R=T.endsWith(".css"),I=R?'[rel="stylesheet"]':"";if(!!a)for(let j=f.length-1;j>=0;j--){const G=f[j];if(G.href===T&&(!R||G.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${T}"]${I}`))return;const F=document.createElement("link");if(F.rel=R?"stylesheet":qxe,R||(F.as="script"),F.crossOrigin="",F.href=T,v&&F.setAttribute("nonce",v),document.head.appendChild(F),R)return new Promise((j,G)=>{F.addEventListener("load",j),F.addEventListener("error",()=>G(new Error(`Unable to preload CSS for ${T}`)))})}))}function d(f){const E=new Event("vite:preloadError",{cancelable:!0});if(E.payload=f,window.dispatchEvent(E),!E.defaultPrevented)throw f}return l.then(f=>{for(const E of f||[])E.status==="rejected"&&d(E.reason);return t().catch(d)})},iO=()=>{const r=new Date,t=r.getHours().toString().padStart(2,"0"),s=r.getMinutes().toString().padStart(2,"0"),a=r.getSeconds().toString().padStart(2,"0"),l=r.getMilliseconds().toString().padStart(3,"0");return`${t}:${s}:${a}.${l}`},be={log:(...r)=>{{const t=r.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.log(`[LOG] [${iO()}] `,...t)}},error:(...r)=>{{const t=r.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.error(`[ERROR] [${iO()}] `,...t)}},warn:(...r)=>{{const t=r.map((s,a)=>a===0&&typeof s=="string"?`
${s}`:s);console.warn(`[WARN] [${iO()}]`,...t)}},trace:r=>{console.trace(`[TRACE] [${iO()}] ${r}`)}};async function Xxe(r){let t;try{switch(r){case"default":t=await p2(()=>import("./index.v0.9.22.js"),[],import.meta.url);break;default:t=await p2(()=>import("./index.v0.9.22.js"),[],import.meta.url)}return t.default}catch(s){return be.error("Failed to load theme:",s),t=await p2(()=>import("./index.v0.9.22.js"),[],import.meta.url),t.default}}const Jxe=()=>{};var eY={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bte=function(r){const t=[];let s=0;for(let a=0;a<r.length;a++){let l=r.charCodeAt(a);l<128?t[s++]=l:l<2048?(t[s++]=l>>6|192,t[s++]=l&63|128):(l&64512)===55296&&a+1<r.length&&(r.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(r.charCodeAt(++a)&1023),t[s++]=l>>18|240,t[s++]=l>>12&63|128,t[s++]=l>>6&63|128,t[s++]=l&63|128):(t[s++]=l>>12|224,t[s++]=l>>6&63|128,t[s++]=l&63|128)}return t},Qxe=function(r){const t=[];let s=0,a=0;for(;s<r.length;){const l=r[s++];if(l<128)t[a++]=String.fromCharCode(l);else if(l>191&&l<224){const d=r[s++];t[a++]=String.fromCharCode((l&31)<<6|d&63)}else if(l>239&&l<365){const d=r[s++],f=r[s++],E=r[s++],v=((l&7)<<18|(d&63)<<12|(f&63)<<6|E&63)-65536;t[a++]=String.fromCharCode(55296+(v>>10)),t[a++]=String.fromCharCode(56320+(v&1023))}else{const d=r[s++],f=r[s++];t[a++]=String.fromCharCode((l&15)<<12|(d&63)<<6|f&63)}}return t.join("")},Wte={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<r.length;l+=3){const d=r[l],f=l+1<r.length,E=f?r[l+1]:0,v=l+2<r.length,T=v?r[l+2]:0,R=d>>2,I=(d&3)<<4|E>>4;let N=(E&15)<<2|T>>6,F=T&63;v||(F=64,f||(N=64)),a.push(s[R],s[I],s[N],s[F])}return a.join("")},encodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(r):this.encodeByteArray(Bte(r),t)},decodeString(r,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(r):Qxe(this.decodeStringToByteArray(r,t))},decodeStringToByteArray(r,t){this.init_();const s=t?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<r.length;){const d=s[r.charAt(l++)],E=l<r.length?s[r.charAt(l)]:0;++l;const T=l<r.length?s[r.charAt(l)]:64;++l;const I=l<r.length?s[r.charAt(l)]:64;if(++l,d==null||E==null||T==null||I==null)throw new Zxe;const N=d<<2|E>>4;if(a.push(N),T!==64){const F=E<<4&240|T>>2;if(a.push(F),I!==64){const j=T<<6&192|I;a.push(j)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class Zxe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const eMe=function(r){const t=Bte(r);return Wte.encodeByteArray(t,!0)},mk=function(r){return eMe(r).replace(/\./g,"")},zte=function(r){try{return Wte.decodeString(r,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tMe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nMe=()=>tMe().__FIREBASE_DEFAULTS__,rMe=()=>{if(typeof process>"u"||typeof eY>"u")return;const r=eY.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},iMe=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=r&&zte(r[1]);return t&&JSON.parse(t)},pN=()=>{try{return Jxe()||nMe()||rMe()||iMe()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},Gte=r=>{var t,s;return(s=(t=pN())===null||t===void 0?void 0:t.emulatorHosts)===null||s===void 0?void 0:s[r]},Hte=r=>{const t=Gte(r);if(!t)return;const s=t.lastIndexOf(":");if(s<=0||s+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const a=parseInt(t.substring(s+1),10);return t[0]==="["?[t.substring(1,s-1),a]:[t.substring(0,s),a]},$te=()=>{var r;return(r=pN())===null||r===void 0?void 0:r.config},Kte=r=>{var t;return(t=pN())===null||t===void 0?void 0:t[`_${r}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sMe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}wrapCallback(t){return(s,a)=>{s?this.reject(s):this.resolve(a),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(s):t(s,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qte(r,t){if(r.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s={alg:"none",type:"JWT"},a=t||"demo-project",l=r.iat||0,d=r.sub||r.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const f=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},r);return[mk(JSON.stringify(s)),mk(JSON.stringify(f)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Na(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function oMe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Na())}function aMe(){var r;const t=(r=pN())===null||r===void 0?void 0:r.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function cMe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function lMe(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function uMe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function dMe(){const r=Na();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function hMe(){return!aMe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function pMe(){try{return typeof indexedDB=="object"}catch{return!1}}function fMe(){return new Promise((r,t)=>{try{let s=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),s||self.indexedDB.deleteDatabase(a),r(!0)},l.onupgradeneeded=()=>{s=!1},l.onerror=()=>{var d;t(((d=l.error)===null||d===void 0?void 0:d.message)||"")}}catch(s){t(s)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mMe="FirebaseError";class ep extends Error{constructor(t,s,a){super(s),this.code=t,this.customData=a,this.name=mMe,Object.setPrototypeOf(this,ep.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,FR.prototype.create)}}class FR{constructor(t,s,a){this.service=t,this.serviceName=s,this.errors=a}create(t,...s){const a=s[0]||{},l=`${this.service}/${t}`,d=this.errors[t],f=d?gMe(d,a):"Error",E=`${this.serviceName}: ${f} (${l}).`;return new ep(l,E,a)}}function gMe(r,t){return r.replace(_Me,(s,a)=>{const l=t[a];return l!=null?String(l):`<${a}?>`})}const _Me=/\{\$([^}]+)}/g;function EMe(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}function TE(r,t){if(r===t)return!0;const s=Object.keys(r),a=Object.keys(t);for(const l of s){if(!a.includes(l))return!1;const d=r[l],f=t[l];if(tY(d)&&tY(f)){if(!TE(d,f))return!1}else if(d!==f)return!1}for(const l of a)if(!s.includes(l))return!1;return!0}function tY(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jR(r){const t=[];for(const[s,a]of Object.entries(r))Array.isArray(a)?a.forEach(l=>{t.push(encodeURIComponent(s)+"="+encodeURIComponent(l))}):t.push(encodeURIComponent(s)+"="+encodeURIComponent(a));return t.length?"&"+t.join("&"):""}function yw(r){const t={};return r.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,d]=a.split("=");t[decodeURIComponent(l)]=decodeURIComponent(d)}}),t}function vw(r){const t=r.indexOf("?");if(!t)return"";const s=r.indexOf("#",t);return r.substring(t,s>0?s:void 0)}function yMe(r,t){const s=new vMe(r,t);return s.subscribe.bind(s)}class vMe{constructor(t,s){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=s,this.task.then(()=>{t(this)}).catch(a=>{this.error(a)})}next(t){this.forEachObserver(s=>{s.next(t)})}error(t){this.forEachObserver(s=>{s.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,s,a){let l;if(t===void 0&&s===void 0&&a===void 0)throw new Error("Missing Observer.");SMe(t,["next","error","complete"])?l=t:l={next:t,error:s,complete:a},l.next===void 0&&(l.next=f2),l.error===void 0&&(l.error=f2),l.complete===void 0&&(l.complete=f2);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),d}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let s=0;s<this.observers.length;s++)this.sendOne(s,t)}sendOne(t,s){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{s(this.observers[t])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function SMe(r,t){if(typeof r!="object"||r===null)return!1;for(const s of t)if(s in r&&typeof r[s]=="function")return!0;return!1}function f2(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xi(r){return r&&r._delegate?r._delegate:r}class dg{constructor(t,s,a){this.name=t,this.instanceFactory=s,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J_="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TMe{constructor(t,s){this.name=t,this.container=s,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const s=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(s)){const a=new sMe;if(this.instancesDeferred.set(s,a),this.isInitialized(s)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:s});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(s).promise}getImmediate(t){var s;const a=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),l=(s=t==null?void 0:t.optional)!==null&&s!==void 0?s:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(d){if(l)return null;throw d}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(wMe(t))try{this.getOrInitializeService({instanceIdentifier:J_})}catch{}for(const[s,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(s);try{const d=this.getOrInitializeService({instanceIdentifier:l});a.resolve(d)}catch{}}}}clearInstance(t=J_){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(s=>"INTERNAL"in s).map(s=>s.INTERNAL.delete()),...t.filter(s=>"_delete"in s).map(s=>s._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=J_){return this.instances.has(t)}getOptions(t=J_){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:s={}}=t,a=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:s});for(const[d,f]of this.instancesDeferred.entries()){const E=this.normalizeInstanceIdentifier(d);a===E&&f.resolve(l)}return l}onInit(t,s){var a;const l=this.normalizeInstanceIdentifier(s),d=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;d.add(t),this.onInitCallbacks.set(l,d);const f=this.instances.get(l);return f&&t(f,l),()=>{d.delete(t)}}invokeOnInitCallbacks(t,s){const a=this.onInitCallbacks.get(s);if(a)for(const l of a)try{l(t,s)}catch{}}getOrInitializeService({instanceIdentifier:t,options:s={}}){let a=this.instances.get(t);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:bMe(t),options:s}),this.instances.set(t,a),this.instancesOptions.set(t,s),this.invokeOnInitCallbacks(a,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,a)}catch{}return a||null}normalizeInstanceIdentifier(t=J_){return this.component?this.component.multipleInstances?t:J_:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function bMe(r){return r===J_?void 0:r}function wMe(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RMe{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const s=this.getProvider(t.name);if(s.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);s.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const s=new TMe(t,this);return this.providers.set(t,s),s}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var vr;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(vr||(vr={}));const CMe={debug:vr.DEBUG,verbose:vr.VERBOSE,info:vr.INFO,warn:vr.WARN,error:vr.ERROR,silent:vr.SILENT},IMe=vr.INFO,AMe={[vr.DEBUG]:"log",[vr.VERBOSE]:"log",[vr.INFO]:"info",[vr.WARN]:"warn",[vr.ERROR]:"error"},PMe=(r,t,...s)=>{if(t<r.logLevel)return;const a=new Date().toISOString(),l=AMe[t];if(l)console[l](`[${a}]  ${r.name}:`,...s);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class YF{constructor(t){this.name=t,this._logLevel=IMe,this._logHandler=PMe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in vr))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?CMe[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,vr.DEBUG,...t),this._logHandler(this,vr.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,vr.VERBOSE,...t),this._logHandler(this,vr.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,vr.INFO,...t),this._logHandler(this,vr.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,vr.WARN,...t),this._logHandler(this,vr.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,vr.ERROR,...t),this._logHandler(this,vr.ERROR,...t)}}const OMe=(r,t)=>t.some(s=>r instanceof s);let nY,rY;function kMe(){return nY||(nY=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function NMe(){return rY||(rY=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Yte=new WeakMap,NU=new WeakMap,Xte=new WeakMap,m2=new WeakMap,XF=new WeakMap;function DMe(r){const t=new Promise((s,a)=>{const l=()=>{r.removeEventListener("success",d),r.removeEventListener("error",f)},d=()=>{s(tg(r.result)),l()},f=()=>{a(r.error),l()};r.addEventListener("success",d),r.addEventListener("error",f)});return t.then(s=>{s instanceof IDBCursor&&Yte.set(s,r)}).catch(()=>{}),XF.set(t,r),t}function LMe(r){if(NU.has(r))return;const t=new Promise((s,a)=>{const l=()=>{r.removeEventListener("complete",d),r.removeEventListener("error",f),r.removeEventListener("abort",f)},d=()=>{s(),l()},f=()=>{a(r.error||new DOMException("AbortError","AbortError")),l()};r.addEventListener("complete",d),r.addEventListener("error",f),r.addEventListener("abort",f)});NU.set(r,t)}let DU={get(r,t,s){if(r instanceof IDBTransaction){if(t==="done")return NU.get(r);if(t==="objectStoreNames")return r.objectStoreNames||Xte.get(r);if(t==="store")return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return tg(r[t])},set(r,t,s){return r[t]=s,!0},has(r,t){return r instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in r}};function xMe(r){DU=r(DU)}function MMe(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...s){const a=r.call(g2(this),t,...s);return Xte.set(a,t.sort?t.sort():[t]),tg(a)}:NMe().includes(r)?function(...t){return r.apply(g2(this),t),tg(Yte.get(this))}:function(...t){return tg(r.apply(g2(this),t))}}function UMe(r){return typeof r=="function"?MMe(r):(r instanceof IDBTransaction&&LMe(r),OMe(r,kMe())?new Proxy(r,DU):r)}function tg(r){if(r instanceof IDBRequest)return DMe(r);if(m2.has(r))return m2.get(r);const t=UMe(r);return t!==r&&(m2.set(r,t),XF.set(t,r)),t}const g2=r=>XF.get(r);function VMe(r,t,{blocked:s,upgrade:a,blocking:l,terminated:d}={}){const f=indexedDB.open(r,t),E=tg(f);return a&&f.addEventListener("upgradeneeded",v=>{a(tg(f.result),v.oldVersion,v.newVersion,tg(f.transaction),v)}),s&&f.addEventListener("blocked",v=>s(v.oldVersion,v.newVersion,v)),E.then(v=>{d&&v.addEventListener("close",()=>d()),l&&v.addEventListener("versionchange",T=>l(T.oldVersion,T.newVersion,T))}).catch(()=>{}),E}const FMe=["get","getKey","getAll","getAllKeys","count"],jMe=["put","add","delete","clear"],_2=new Map;function iY(r,t){if(!(r instanceof IDBDatabase&&!(t in r)&&typeof t=="string"))return;if(_2.get(t))return _2.get(t);const s=t.replace(/FromIndex$/,""),a=t!==s,l=jMe.includes(s);if(!(s in(a?IDBIndex:IDBObjectStore).prototype)||!(l||FMe.includes(s)))return;const d=async function(f,...E){const v=this.transaction(f,l?"readwrite":"readonly");let T=v.store;return a&&(T=T.index(E.shift())),(await Promise.all([T[s](...E),l&&v.done]))[0]};return _2.set(t,d),d}xMe(r=>({...r,get:(t,s,a)=>iY(t,s)||r.get(t,s,a),has:(t,s)=>!!iY(t,s)||r.has(t,s)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BMe{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(s=>{if(WMe(s)){const a=s.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(s=>s).join(" ")}}function WMe(r){const t=r.getComponent();return(t==null?void 0:t.type)==="VERSION"}const LU="@firebase/app",sY="0.11.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tf=new YF("@firebase/app"),zMe="@firebase/app-compat",GMe="@firebase/analytics-compat",HMe="@firebase/analytics",$Me="@firebase/app-check-compat",KMe="@firebase/app-check",qMe="@firebase/auth",YMe="@firebase/auth-compat",XMe="@firebase/database",JMe="@firebase/data-connect",QMe="@firebase/database-compat",ZMe="@firebase/functions",e2e="@firebase/functions-compat",t2e="@firebase/installations",n2e="@firebase/installations-compat",r2e="@firebase/messaging",i2e="@firebase/messaging-compat",s2e="@firebase/performance",o2e="@firebase/performance-compat",a2e="@firebase/remote-config",c2e="@firebase/remote-config-compat",l2e="@firebase/storage",u2e="@firebase/storage-compat",d2e="@firebase/firestore",h2e="@firebase/vertexai",p2e="@firebase/firestore-compat",f2e="firebase",m2e="11.4.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xU="[DEFAULT]",g2e={[LU]:"fire-core",[zMe]:"fire-core-compat",[HMe]:"fire-analytics",[GMe]:"fire-analytics-compat",[KMe]:"fire-app-check",[$Me]:"fire-app-check-compat",[qMe]:"fire-auth",[YMe]:"fire-auth-compat",[XMe]:"fire-rtdb",[JMe]:"fire-data-connect",[QMe]:"fire-rtdb-compat",[ZMe]:"fire-fn",[e2e]:"fire-fn-compat",[t2e]:"fire-iid",[n2e]:"fire-iid-compat",[r2e]:"fire-fcm",[i2e]:"fire-fcm-compat",[s2e]:"fire-perf",[o2e]:"fire-perf-compat",[a2e]:"fire-rc",[c2e]:"fire-rc-compat",[l2e]:"fire-gcs",[u2e]:"fire-gcs-compat",[d2e]:"fire-fst",[p2e]:"fire-fst-compat",[h2e]:"fire-vertex","fire-js":"fire-js",[f2e]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gk=new Map,_2e=new Map,MU=new Map;function oY(r,t){try{r.container.addComponent(t)}catch(s){Tf.debug(`Component ${t.name} failed to register with FirebaseApp ${r.name}`,s)}}function bE(r){const t=r.name;if(MU.has(t))return Tf.debug(`There were multiple attempts to register component ${t}.`),!1;MU.set(t,r);for(const s of gk.values())oY(s,r);for(const s of _2e.values())oY(s,r);return!0}function fN(r,t){const s=r.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),r.container.getProvider(t)}function bl(r){return r==null?!1:r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E2e={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ng=new FR("app","Firebase",E2e);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y2e{constructor(t,s,a){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},s),this._name=s.name,this._automaticDataCollectionEnabled=s.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new dg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ng.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OE=m2e;function Jte(r,t={}){let s=r;typeof t!="object"&&(t={name:t});const a=Object.assign({name:xU,automaticDataCollectionEnabled:!1},t),l=a.name;if(typeof l!="string"||!l)throw ng.create("bad-app-name",{appName:String(l)});if(s||(s=$te()),!s)throw ng.create("no-options");const d=gk.get(l);if(d){if(TE(s,d.options)&&TE(a,d.config))return d;throw ng.create("duplicate-app",{appName:l})}const f=new RMe(l);for(const v of MU.values())f.addComponent(v);const E=new y2e(s,a,f);return gk.set(l,E),E}function JF(r=xU){const t=gk.get(r);if(!t&&r===xU&&$te())return Jte();if(!t)throw ng.create("no-app",{appName:r});return t}function zh(r,t,s){var a;let l=(a=g2e[r])!==null&&a!==void 0?a:r;s&&(l+=`-${s}`);const d=l.match(/\s|\//),f=t.match(/\s|\//);if(d||f){const E=[`Unable to register library "${l}" with version "${t}":`];d&&E.push(`library name "${l}" contains illegal characters (whitespace or "/")`),d&&f&&E.push("and"),f&&E.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Tf.warn(E.join(" "));return}bE(new dg(`${l}-version`,()=>({library:l,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v2e="firebase-heartbeat-database",S2e=1,dR="firebase-heartbeat-store";let E2=null;function Qte(){return E2||(E2=VMe(v2e,S2e,{upgrade:(r,t)=>{switch(t){case 0:try{r.createObjectStore(dR)}catch(s){console.warn(s)}}}}).catch(r=>{throw ng.create("idb-open",{originalErrorMessage:r.message})})),E2}async function T2e(r){try{const s=(await Qte()).transaction(dR),a=await s.objectStore(dR).get(Zte(r));return await s.done,a}catch(t){if(t instanceof ep)Tf.warn(t.message);else{const s=ng.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Tf.warn(s.message)}}}async function aY(r,t){try{const a=(await Qte()).transaction(dR,"readwrite");await a.objectStore(dR).put(t,Zte(r)),await a.done}catch(s){if(s instanceof ep)Tf.warn(s.message);else{const a=ng.create("idb-set",{originalErrorMessage:s==null?void 0:s.message});Tf.warn(a.message)}}}function Zte(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b2e=1024,w2e=30;class R2e{constructor(t){this.container=t,this._heartbeatsCache=null;const s=this.container.getProvider("app").getImmediate();this._storage=new I2e(s),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var t,s;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=cY();if(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((s=this._heartbeatsCache)===null||s===void 0?void 0:s.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(f=>f.date===d))return;if(this._heartbeatsCache.heartbeats.push({date:d,agent:l}),this._heartbeatsCache.heartbeats.length>w2e){const f=A2e(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(f,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){Tf.warn(a)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const s=cY(),{heartbeatsToSend:a,unsentEntries:l}=C2e(this._heartbeatsCache.heartbeats),d=mk(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=s,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(s){return Tf.warn(s),""}}}function cY(){return new Date().toISOString().substring(0,10)}function C2e(r,t=b2e){const s=[];let a=r.slice();for(const l of r){const d=s.find(f=>f.agent===l.agent);if(d){if(d.dates.push(l.date),lY(s)>t){d.dates.pop();break}}else if(s.push({agent:l.agent,dates:[l.date]}),lY(s)>t){s.pop();break}a=a.slice(1)}return{heartbeatsToSend:s,unsentEntries:a}}class I2e{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return pMe()?fMe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const s=await T2e(this.app);return s!=null&&s.heartbeats?s:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var s;if(await this._canUseIndexedDBPromise){const l=await this.read();return aY(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:l.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var s;if(await this._canUseIndexedDBPromise){const l=await this.read();return aY(this.app,{lastSentHeartbeatDate:(s=t.lastSentHeartbeatDate)!==null&&s!==void 0?s:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...t.heartbeats]})}else return}}function lY(r){return mk(JSON.stringify({version:2,heartbeats:r})).length}function A2e(r){if(r.length===0)return-1;let t=0,s=r[0].date;for(let a=1;a<r.length;a++)r[a].date<s&&(s=r[a].date,t=a);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P2e(r){bE(new dg("platform-logger",t=>new BMe(t),"PRIVATE")),bE(new dg("heartbeat",t=>new R2e(t),"PRIVATE")),zh(LU,sY,r),zh(LU,sY,"esm2017"),zh("fire-js","")}P2e("");function ene(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const O2e=ene,tne=new FR("auth","Firebase",ene());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _k=new YF("@firebase/auth");function k2e(r,...t){_k.logLevel<=vr.WARN&&_k.warn(`Auth (${OE}): ${r}`,...t)}function UO(r,...t){_k.logLevel<=vr.ERROR&&_k.error(`Auth (${OE}): ${r}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cd(r,...t){throw QF(r,...t)}function Gh(r,...t){return QF(r,...t)}function nne(r,t,s){const a=Object.assign(Object.assign({},O2e()),{[t]:s});return new FR("auth","Firebase",a).create(t,{appName:r.name})}function gf(r){return nne(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function QF(r,...t){if(typeof r!="string"){const s=t[0],a=[...t.slice(1)];return a[0]&&(a[0].appName=r.name),r._errorFactory.create(s,...a)}return tne.create(r,...t)}function Dn(r,t,...s){if(!r)throw QF(t,...s)}function cf(r){const t="INTERNAL ASSERTION FAILED: "+r;throw UO(t),new Error(t)}function bf(r,t){r||cf(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UU(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.href)||""}function N2e(){return uY()==="http:"||uY()==="https:"}function uY(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D2e(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(N2e()||lMe()||"connection"in navigator)?navigator.onLine:!0}function L2e(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BR{constructor(t,s){this.shortDelay=t,this.longDelay=s,bf(s>t,"Short delay should be less than long delay!"),this.isMobile=oMe()||uMe()}get(){return D2e()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZF(r,t){bf(r.emulator,"Emulator should always be set here");const{url:s}=r.emulator;return t?`${s}${t.startsWith("/")?t.slice(1):t}`:s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rne{static initialize(t,s,a){this.fetchImpl=t,s&&(this.headersImpl=s),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;cf("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;cf("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;cf("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x2e={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M2e=new BR(3e4,6e4);function Pf(r,t){return r.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:r.tenantId}):t}async function Of(r,t,s,a,l={}){return ine(r,l,async()=>{let d={},f={};a&&(t==="GET"?f=a:d={body:JSON.stringify(a)});const E=jR(Object.assign({key:r.config.apiKey},f)).slice(1),v=await r._getAdditionalHeaders();v["Content-Type"]="application/json",r.languageCode&&(v["X-Firebase-Locale"]=r.languageCode);const T=Object.assign({method:t,headers:v},d);return cMe()||(T.referrerPolicy="no-referrer"),rne.fetch()(sne(r,r.config.apiHost,s,E),T)})}async function ine(r,t,s){r._canInitEmulator=!1;const a=Object.assign(Object.assign({},x2e),t);try{const l=new V2e(r),d=await Promise.race([s(),l.promise]);l.clearNetworkTimeout();const f=await d.json();if("needConfirmation"in f)throw sO(r,"account-exists-with-different-credential",f);if(d.ok&&!("errorMessage"in f))return f;{const E=d.ok?f.errorMessage:f.error.message,[v,T]=E.split(" : ");if(v==="FEDERATED_USER_ID_ALREADY_LINKED")throw sO(r,"credential-already-in-use",f);if(v==="EMAIL_EXISTS")throw sO(r,"email-already-in-use",f);if(v==="USER_DISABLED")throw sO(r,"user-disabled",f);const R=a[v]||v.toLowerCase().replace(/[_\s]+/g,"-");if(T)throw nne(r,R,T);Cd(r,R)}}catch(l){if(l instanceof ep)throw l;Cd(r,"network-request-failed",{message:String(l)})}}async function WR(r,t,s,a,l={}){const d=await Of(r,t,s,a,l);return"mfaPendingCredential"in d&&Cd(r,"multi-factor-auth-required",{_serverResponse:d}),d}function sne(r,t,s,a){const l=`${t}${s}?${a}`;return r.config.emulator?ZF(r.config,l):`${r.config.apiScheme}://${l}`}function U2e(r){switch(r){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class V2e{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((s,a)=>{this.timer=setTimeout(()=>a(Gh(this.auth,"network-request-failed")),M2e.get())})}}function sO(r,t,s){const a={appName:r.name};s.email&&(a.email=s.email),s.phoneNumber&&(a.phoneNumber=s.phoneNumber);const l=Gh(r,t,a);return l.customData._tokenResponse=s,l}function dY(r){return r!==void 0&&r.enterprise!==void 0}class F2e{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const s of this.recaptchaEnforcementState)if(s.provider&&s.provider===t)return U2e(s.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function j2e(r,t){return Of(r,"GET","/v2/recaptchaConfig",Pf(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function B2e(r,t){return Of(r,"POST","/v1/accounts:delete",t)}async function one(r,t){return Of(r,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fw(r){if(r)try{const t=new Date(Number(r));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function W2e(r,t=!1){const s=Xi(r),a=await s.getIdToken(t),l=ej(a);Dn(l&&l.exp&&l.auth_time&&l.iat,s.auth,"internal-error");const d=typeof l.firebase=="object"?l.firebase:void 0,f=d==null?void 0:d.sign_in_provider;return{claims:l,token:a,authTime:Fw(y2(l.auth_time)),issuedAtTime:Fw(y2(l.iat)),expirationTime:Fw(y2(l.exp)),signInProvider:f||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function y2(r){return Number(r)*1e3}function ej(r){const[t,s,a]=r.split(".");if(t===void 0||s===void 0||a===void 0)return UO("JWT malformed, contained fewer than 3 sections"),null;try{const l=zte(s);return l?JSON.parse(l):(UO("Failed to decode base64 JWT payload"),null)}catch(l){return UO("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function hY(r){const t=ej(r);return Dn(t,"internal-error"),Dn(typeof t.exp<"u","internal-error"),Dn(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hR(r,t,s=!1){if(s)return t;try{return await t}catch(a){throw a instanceof ep&&z2e(a)&&r.auth.currentUser===r&&await r.auth.signOut(),a}}function z2e({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G2e{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var s;if(t){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const l=((s=this.user.stsTokenManager.expirationTime)!==null&&s!==void 0?s:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(t=!1){if(!this.isRunning)return;const s=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},s)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VU{constructor(t,s){this.createdAt=t,this.lastLoginAt=s,this._initializeTime()}_initializeTime(){this.lastSignInTime=Fw(this.lastLoginAt),this.creationTime=Fw(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ek(r){var t;const s=r.auth,a=await r.getIdToken(),l=await hR(r,one(s,{idToken:a}));Dn(l==null?void 0:l.users.length,s,"internal-error");const d=l.users[0];r._notifyReloadListener(d);const f=!((t=d.providerUserInfo)===null||t===void 0)&&t.length?ane(d.providerUserInfo):[],E=$2e(r.providerData,f),v=r.isAnonymous,T=!(r.email&&d.passwordHash)&&!(E!=null&&E.length),R=v?T:!1,I={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:E,metadata:new VU(d.createdAt,d.lastLoginAt),isAnonymous:R};Object.assign(r,I)}async function H2e(r){const t=Xi(r);await Ek(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function $2e(r,t){return[...r.filter(a=>!t.some(l=>l.providerId===a.providerId)),...t]}function ane(r){return r.map(t=>{var{providerId:s}=t,a=NR(t,["providerId"]);return{providerId:s,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function K2e(r,t){const s=await ine(r,{},async()=>{const a=jR({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:l,apiKey:d}=r.config,f=sne(r,l,"/v1/token",`key=${d}`),E=await r._getAdditionalHeaders();return E["Content-Type"]="application/x-www-form-urlencoded",rne.fetch()(f,{method:"POST",headers:E,body:a})});return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}}async function q2e(r,t){return Of(r,"POST","/v2/accounts:revokeToken",Pf(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MS{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Dn(t.idToken,"internal-error"),Dn(typeof t.idToken<"u","internal-error"),Dn(typeof t.refreshToken<"u","internal-error");const s="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):hY(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,s)}updateFromIdToken(t){Dn(t.length!==0,"internal-error");const s=hY(t);this.updateTokensAndExpiration(t,null,s)}async getToken(t,s=!1){return!s&&this.accessToken&&!this.isExpired?this.accessToken:(Dn(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,s){const{accessToken:a,refreshToken:l,expiresIn:d}=await K2e(t,s);this.updateTokensAndExpiration(a,l,Number(d))}updateTokensAndExpiration(t,s,a){this.refreshToken=s||null,this.accessToken=t||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(t,s){const{refreshToken:a,accessToken:l,expirationTime:d}=s,f=new MS;return a&&(Dn(typeof a=="string","internal-error",{appName:t}),f.refreshToken=a),l&&(Dn(typeof l=="string","internal-error",{appName:t}),f.accessToken=l),d&&(Dn(typeof d=="number","internal-error",{appName:t}),f.expirationTime=d),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new MS,this.toJSON())}_performRefresh(){return cf("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bm(r,t){Dn(typeof r=="string"||typeof r>"u","internal-error",{appName:t})}class lf{constructor(t){var{uid:s,auth:a,stsTokenManager:l}=t,d=NR(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new G2e(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=a,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new VU(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(t){const s=await hR(this,this.stsTokenManager.getToken(this.auth,t));return Dn(s,this.auth,"internal-error"),this.accessToken!==s&&(this.accessToken=s,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),s}getIdTokenResult(t){return W2e(this,t)}reload(){return H2e(this)}_assign(t){this!==t&&(Dn(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(s=>Object.assign({},s)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const s=new lf(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return s.metadata._copy(this.metadata),s}_onReload(t){Dn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,s=!1){let a=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),a=!0),s&&await Ek(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(bl(this.auth.app))return Promise.reject(gf(this.auth));const t=await this.getIdToken();return await hR(this,B2e(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,s){var a,l,d,f,E,v,T,R;const I=(a=s.displayName)!==null&&a!==void 0?a:void 0,N=(l=s.email)!==null&&l!==void 0?l:void 0,F=(d=s.phoneNumber)!==null&&d!==void 0?d:void 0,j=(f=s.photoURL)!==null&&f!==void 0?f:void 0,G=(E=s.tenantId)!==null&&E!==void 0?E:void 0,H=(v=s._redirectEventId)!==null&&v!==void 0?v:void 0,te=(T=s.createdAt)!==null&&T!==void 0?T:void 0,K=(R=s.lastLoginAt)!==null&&R!==void 0?R:void 0,{uid:ee,emailVerified:de,isAnonymous:se,providerData:ge,stsTokenManager:Z}=s;Dn(ee&&Z,t,"internal-error");const Q=MS.fromJSON(this.name,Z);Dn(typeof ee=="string",t,"internal-error"),Bm(I,t.name),Bm(N,t.name),Dn(typeof de=="boolean",t,"internal-error"),Dn(typeof se=="boolean",t,"internal-error"),Bm(F,t.name),Bm(j,t.name),Bm(G,t.name),Bm(H,t.name),Bm(te,t.name),Bm(K,t.name);const ne=new lf({uid:ee,auth:t,email:N,emailVerified:de,displayName:I,isAnonymous:se,photoURL:j,phoneNumber:F,tenantId:G,stsTokenManager:Q,createdAt:te,lastLoginAt:K});return ge&&Array.isArray(ge)&&(ne.providerData=ge.map(oe=>Object.assign({},oe))),H&&(ne._redirectEventId=H),ne}static async _fromIdTokenResponse(t,s,a=!1){const l=new MS;l.updateFromServerResponse(s);const d=new lf({uid:s.localId,auth:t,stsTokenManager:l,isAnonymous:a});return await Ek(d),d}static async _fromGetAccountInfoResponse(t,s,a){const l=s.users[0];Dn(l.localId!==void 0,"internal-error");const d=l.providerUserInfo!==void 0?ane(l.providerUserInfo):[],f=!(l.email&&l.passwordHash)&&!(d!=null&&d.length),E=new MS;E.updateFromIdToken(a);const v=new lf({uid:l.localId,auth:t,stsTokenManager:E,isAnonymous:f}),T={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:d,metadata:new VU(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(d!=null&&d.length)};return Object.assign(v,T),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pY=new Map;function uf(r){bf(r instanceof Function,"Expected a class definition");let t=pY.get(r);return t?(bf(t instanceof r,"Instance stored in cache mismatched with class"),t):(t=new r,pY.set(r,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cne{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,s){this.storage[t]=s}async _get(t){const s=this.storage[t];return s===void 0?null:s}async _remove(t){delete this.storage[t]}_addListener(t,s){}_removeListener(t,s){}}cne.type="NONE";const fY=cne;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VO(r,t,s){return`firebase:${r}:${t}:${s}`}class US{constructor(t,s,a){this.persistence=t,this.auth=s,this.userKey=a;const{config:l,name:d}=this.auth;this.fullUserKey=VO(this.userKey,l.apiKey,d),this.fullPersistenceKey=VO("persistence",l.apiKey,d),this.boundEventHandler=s._onStorageEvent.bind(s),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?lf._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const s=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,s)return this.setCurrentUser(s)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,s,a="authUser"){if(!s.length)return new US(uf(fY),t,a);const l=(await Promise.all(s.map(async T=>{if(await T._isAvailable())return T}))).filter(T=>T);let d=l[0]||uf(fY);const f=VO(a,t.config.apiKey,t.name);let E=null;for(const T of s)try{const R=await T._get(f);if(R){const I=lf._fromJSON(t,R);T!==d&&(E=I),d=T;break}}catch{}const v=l.filter(T=>T._shouldAllowMigration);return!d._shouldAllowMigration||!v.length?new US(d,t,a):(d=v[0],E&&await d._set(f,E.toJSON()),await Promise.all(s.map(async T=>{if(T!==d)try{await T._remove(f)}catch{}})),new US(d,t,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mY(r){const t=r.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(hne(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(lne(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(fne(t))return"Blackberry";if(mne(t))return"Webos";if(une(t))return"Safari";if((t.includes("chrome/")||dne(t))&&!t.includes("edge/"))return"Chrome";if(pne(t))return"Android";{const s=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=r.match(s);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function lne(r=Na()){return/firefox\//i.test(r)}function une(r=Na()){const t=r.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function dne(r=Na()){return/crios\//i.test(r)}function hne(r=Na()){return/iemobile/i.test(r)}function pne(r=Na()){return/android/i.test(r)}function fne(r=Na()){return/blackberry/i.test(r)}function mne(r=Na()){return/webos/i.test(r)}function tj(r=Na()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function Y2e(r=Na()){var t;return tj(r)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function X2e(){return dMe()&&document.documentMode===10}function gne(r=Na()){return tj(r)||pne(r)||mne(r)||fne(r)||/windows phone/i.test(r)||hne(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _ne(r,t=[]){let s;switch(r){case"Browser":s=mY(Na());break;case"Worker":s=`${mY(Na())}-${r}`;break;default:s=r}const a=t.length?t.join(","):"FirebaseCore-web";return`${s}/JsCore/${OE}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J2e{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,s){const a=d=>new Promise((f,E)=>{try{const v=t(d);f(v)}catch(v){E(v)}});a.onAbort=s,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const s=[];try{for(const a of this.queue)await a(t),a.onAbort&&s.push(a.onAbort)}catch(a){s.reverse();for(const l of s)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Q2e(r,t={}){return Of(r,"GET","/v2/passwordPolicy",Pf(r,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z2e=6;class eUe{constructor(t){var s,a,l,d;const f=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(s=f.minPasswordLength)!==null&&s!==void 0?s:Z2e,f.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=f.maxPasswordLength),f.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=f.containsLowercaseCharacter),f.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=f.containsUppercaseCharacter),f.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=f.containsNumericCharacter),f.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=f.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(a=t.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(d=t.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var s,a,l,d,f,E;const v={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,v),this.validatePasswordCharacterOptions(t,v),v.isValid&&(v.isValid=(s=v.meetsMinPasswordLength)!==null&&s!==void 0?s:!0),v.isValid&&(v.isValid=(a=v.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),v.isValid&&(v.isValid=(l=v.containsLowercaseLetter)!==null&&l!==void 0?l:!0),v.isValid&&(v.isValid=(d=v.containsUppercaseLetter)!==null&&d!==void 0?d:!0),v.isValid&&(v.isValid=(f=v.containsNumericCharacter)!==null&&f!==void 0?f:!0),v.isValid&&(v.isValid=(E=v.containsNonAlphanumericCharacter)!==null&&E!==void 0?E:!0),v}validatePasswordLengthOptions(t,s){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(s.meetsMinPasswordLength=t.length>=a),l&&(s.meetsMaxPasswordLength=t.length<=l)}validatePasswordCharacterOptions(t,s){this.updatePasswordCharacterOptionsStatuses(s,!1,!1,!1,!1);let a;for(let l=0;l<t.length;l++)a=t.charAt(l),this.updatePasswordCharacterOptionsStatuses(s,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(t,s,a,l,d){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=s)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tUe{constructor(t,s,a,l){this.app=t,this.heartbeatServiceProvider=s,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new gY(this),this.idTokenSubscription=new gY(this),this.beforeStateQueue=new J2e(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=tne,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(t,s){return s&&(this._popupRedirectResolver=uf(s)),this._initializationPromise=this.queue(async()=>{var a,l;if(!this._deleted&&(this.persistenceManager=await US.create(this,t),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(s),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const s=await one(this,{idToken:t}),a=await lf._fromGetAccountInfoResponse(this,s,t);await this.directlySetCurrentUser(a)}catch(s){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",s),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var s;if(bl(this.app)){const f=this.app.settings.authIdToken;return f?new Promise(E=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(f).then(E,E))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let l=a,d=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const f=(s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId,E=l==null?void 0:l._redirectEventId,v=await this.tryRedirectSignIn(t);(!f||f===E)&&(v!=null&&v.user)&&(l=v.user,d=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(l)}catch(f){l=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(f))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Dn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(t){let s=null;try{s=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return s}async reloadAndSetCurrentUserOrClear(t){try{await Ek(t)}catch(s){if((s==null?void 0:s.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=L2e()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(bl(this.app))return Promise.reject(gf(this));const s=t?Xi(t):null;return s&&Dn(s.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(s&&s._clone(this))}async _updateCurrentUser(t,s=!1){if(!this._deleted)return t&&Dn(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),s||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return bl(this.app)?Promise.reject(gf(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return bl(this.app)?Promise.reject(gf(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(uf(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const s=this._getPasswordPolicyInternal();return s.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):s.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await Q2e(this),s=new eUe(t);this.tenantId===null?this._projectPasswordPolicy=s:this._tenantPasswordPolicies[this.tenantId]=s}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new FR("auth","Firebase",t())}onAuthStateChanged(t,s,a){return this.registerStateListener(this.authStateSubscription,t,s,a)}beforeAuthStateChanged(t,s){return this.beforeStateQueue.pushCallback(t,s)}onIdTokenChanged(t,s,a){return this.registerStateListener(this.idTokenSubscription,t,s,a)}authStateReady(){return new Promise((t,s)=>{if(this.currentUser)t();else{const a=this.onAuthStateChanged(()=>{a(),t()},s)}})}async revokeAccessToken(t){if(this.currentUser){const s=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:s};this.tenantId!=null&&(a.tenantId=this.tenantId),await q2e(this,a)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,s){const a=await this.getOrInitRedirectPersistenceManager(s);return t===null?a.removeCurrentUser():a.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const s=t&&uf(t)||this._popupRedirectResolver;Dn(s,this,"argument-error"),this.redirectPersistenceManager=await US.create(this,[uf(s._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var s,a;return this._isInitialized&&await this.queue(async()=>{}),((s=this._currentUser)===null||s===void 0?void 0:s._redirectEventId)===t?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,s;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(s=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&s!==void 0?s:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,s,a,l){if(this._deleted)return()=>{};const d=typeof s=="function"?s:s.next.bind(s);let f=!1;const E=this._isInitialized?Promise.resolve():this._initializationPromise;if(Dn(E,this,"internal-error"),E.then(()=>{f||d(this.currentUser)}),typeof s=="function"){const v=t.addObserver(s,a,l);return()=>{f=!0,v()}}else{const v=t.addObserver(s);return()=>{f=!0,v()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Dn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=_ne(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const s={"X-Client-Version":this.clientVersion};this.app.options.appId&&(s["X-Firebase-gmpid"]=this.app.options.appId);const a=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());a&&(s["X-Firebase-Client"]=a);const l=await this._getAppCheckToken();return l&&(s["X-Firebase-AppCheck"]=l),s}async _getAppCheckToken(){var t;if(bl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const s=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return s!=null&&s.error&&k2e(`Error while retrieving App Check token: ${s.error}`),s==null?void 0:s.token}}function Sg(r){return Xi(r)}class gY{constructor(t){this.auth=t,this.observer=null,this.addObserver=yMe(s=>this.observer=s)}get next(){return Dn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mN={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function nUe(r){mN=r}function Ene(r){return mN.loadJS(r)}function rUe(){return mN.recaptchaEnterpriseScript}function iUe(){return mN.gapiScript}function sUe(r){return`__${r}${Math.floor(Math.random()*1e6)}`}class oUe{constructor(){this.enterprise=new aUe}ready(t){t()}execute(t,s){return Promise.resolve("token")}render(t,s){return""}}class aUe{ready(t){t()}execute(t,s){return Promise.resolve("token")}render(t,s){return""}}const cUe="recaptcha-enterprise",yne="NO_RECAPTCHA";class lUe{constructor(t){this.type=cUe,this.auth=Sg(t)}async verify(t="verify",s=!1){async function a(d){if(!s){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(f,E)=>{j2e(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(v=>{if(v.recaptchaKey===void 0)E(new Error("recaptcha Enterprise site key undefined"));else{const T=new F2e(v);return d.tenantId==null?d._agentRecaptchaConfig=T:d._tenantRecaptchaConfigs[d.tenantId]=T,f(T.siteKey)}}).catch(v=>{E(v)})})}function l(d,f,E){const v=window.grecaptcha;dY(v)?v.enterprise.ready(()=>{v.enterprise.execute(d,{action:t}).then(T=>{f(T)}).catch(()=>{f(yne)})}):E(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new oUe().execute("siteKey",{action:"verify"}):new Promise((d,f)=>{a(this.auth).then(E=>{if(!s&&dY(window.grecaptcha))l(E,d,f);else{if(typeof window>"u"){f(new Error("RecaptchaVerifier is only supported in browser"));return}let v=rUe();v.length!==0&&(v+=E),Ene(v).then(()=>{l(E,d,f)}).catch(T=>{f(T)})}}).catch(E=>{f(E)})})}}async function _Y(r,t,s,a=!1,l=!1){const d=new lUe(r);let f;if(l)f=yne;else try{f=await d.verify(s)}catch{f=await d.verify(s,!0)}const E=Object.assign({},t);if(s==="mfaSmsEnrollment"||s==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in E){const v=E.phoneEnrollmentInfo.phoneNumber,T=E.phoneEnrollmentInfo.recaptchaToken;Object.assign(E,{phoneEnrollmentInfo:{phoneNumber:v,recaptchaToken:T,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in E){const v=E.phoneSignInInfo.recaptchaToken;Object.assign(E,{phoneSignInInfo:{recaptchaToken:v,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return E}return a?Object.assign(E,{captchaResp:f}):Object.assign(E,{captchaResponse:f}),Object.assign(E,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(E,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),E}async function yk(r,t,s,a,l){var d;if(!((d=r._getRecaptchaConfig())===null||d===void 0)&&d.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const f=await _Y(r,t,s,s==="getOobCode");return a(r,f)}else return a(r,t).catch(async f=>{if(f.code==="auth/missing-recaptcha-token"){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const E=await _Y(r,t,s,s==="getOobCode");return a(r,E)}else return Promise.reject(f)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uUe(r,t){const s=fN(r,"auth");if(s.isInitialized()){const l=s.getImmediate(),d=s.getOptions();if(TE(d,t??{}))return l;Cd(l,"already-initialized")}return s.initialize({options:t})}function dUe(r,t){const s=(t==null?void 0:t.persistence)||[],a=(Array.isArray(s)?s:[s]).map(uf);t!=null&&t.errorMap&&r._updateErrorMap(t.errorMap),r._initializeWithPersistence(a,t==null?void 0:t.popupRedirectResolver)}function hUe(r,t,s){const a=Sg(r);Dn(/^https?:\/\//.test(t),a,"invalid-emulator-scheme");const l=!1,d=vne(t),{host:f,port:E}=pUe(t),v=E===null?"":`:${E}`,T={url:`${d}//${f}${v}/`},R=Object.freeze({host:f,port:E,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!a._canInitEmulator){Dn(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Dn(TE(T,a.config.emulator)&&TE(R,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=T,a.emulatorConfig=R,a.settings.appVerificationDisabledForTesting=!0,fUe()}function vne(r){const t=r.indexOf(":");return t<0?"":r.substr(0,t+1)}function pUe(r){const t=vne(r),s=/(\/\/)?([^?#/]+)/.exec(r.substr(t.length));if(!s)return{host:"",port:null};const a=s[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const d=l[1];return{host:d,port:EY(a.substr(d.length+1))}}else{const[d,f]=a.split(":");return{host:d,port:EY(f)}}}function EY(r){if(!r)return null;const t=Number(r);return isNaN(t)?null:t}function fUe(){function r(){const t=document.createElement("p"),s=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",s.position="fixed",s.width="100%",s.backgroundColor="#ffffff",s.border=".1em solid #000000",s.color="#b50000",s.bottom="0px",s.left="0px",s.margin="0px",s.zIndex="10000",s.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nj{constructor(t,s){this.providerId=t,this.signInMethod=s}toJSON(){return cf("not implemented")}_getIdTokenResponse(t){return cf("not implemented")}_linkToIdToken(t,s){return cf("not implemented")}_getReauthenticationResolver(t){return cf("not implemented")}}async function mUe(r,t){return Of(r,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gUe(r,t){return WR(r,"POST","/v1/accounts:signInWithPassword",Pf(r,t))}async function Sne(r,t){return Of(r,"POST","/v1/accounts:sendOobCode",Pf(r,t))}async function _Ue(r,t){return Sne(r,t)}async function EUe(r,t){return Sne(r,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yUe(r,t){return WR(r,"POST","/v1/accounts:signInWithEmailLink",Pf(r,t))}async function vUe(r,t){return WR(r,"POST","/v1/accounts:signInWithEmailLink",Pf(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pR extends nj{constructor(t,s,a,l=null){super("password",a),this._email=t,this._password=s,this._tenantId=l}static _fromEmailAndPassword(t,s){return new pR(t,s,"password")}static _fromEmailAndCode(t,s,a=null){return new pR(t,s,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t;if(s!=null&&s.email&&(s!=null&&s.password)){if(s.signInMethod==="password")return this._fromEmailAndPassword(s.email,s.password);if(s.signInMethod==="emailLink")return this._fromEmailAndCode(s.email,s.password,s.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const s={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return yk(t,s,"signInWithPassword",gUe);case"emailLink":return yUe(t,{email:this._email,oobCode:this._password});default:Cd(t,"internal-error")}}async _linkToIdToken(t,s){switch(this.signInMethod){case"password":const a={idToken:s,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return yk(t,a,"signUpPassword",mUe);case"emailLink":return vUe(t,{idToken:s,email:this._email,oobCode:this._password});default:Cd(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VS(r,t){return WR(r,"POST","/v1/accounts:signInWithIdp",Pf(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SUe="http://localhost";class wE extends nj{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const s=new wE(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(s.idToken=t.idToken),t.accessToken&&(s.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(s.nonce=t.nonce),t.pendingToken&&(s.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(s.accessToken=t.oauthToken,s.secret=t.oauthTokenSecret):Cd("argument-error"),s}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const s=typeof t=="string"?JSON.parse(t):t,{providerId:a,signInMethod:l}=s,d=NR(s,["providerId","signInMethod"]);if(!a||!l)return null;const f=new wE(a,l);return f.idToken=d.idToken||void 0,f.accessToken=d.accessToken||void 0,f.secret=d.secret,f.nonce=d.nonce,f.pendingToken=d.pendingToken||null,f}_getIdTokenResponse(t){const s=this.buildRequest();return VS(t,s)}_linkToIdToken(t,s){const a=this.buildRequest();return a.idToken=s,VS(t,a)}_getReauthenticationResolver(t){const s=this.buildRequest();return s.autoCreate=!1,VS(t,s)}buildRequest(){const t={requestUri:SUe,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const s={};this.idToken&&(s.id_token=this.idToken),this.accessToken&&(s.access_token=this.accessToken),this.secret&&(s.oauth_token_secret=this.secret),s.providerId=this.providerId,this.nonce&&!this.pendingToken&&(s.nonce=this.nonce),t.postBody=jR(s)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TUe(r){switch(r){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function bUe(r){const t=yw(vw(r)).link,s=t?yw(vw(t)).deep_link_id:null,a=yw(vw(r)).deep_link_id;return(a?yw(vw(a)).link:null)||a||s||t||r}class rj{constructor(t){var s,a,l,d,f,E;const v=yw(vw(t)),T=(s=v.apiKey)!==null&&s!==void 0?s:null,R=(a=v.oobCode)!==null&&a!==void 0?a:null,I=TUe((l=v.mode)!==null&&l!==void 0?l:null);Dn(T&&R&&I,"argument-error"),this.apiKey=T,this.operation=I,this.code=R,this.continueUrl=(d=v.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(f=v.languageCode)!==null&&f!==void 0?f:null,this.tenantId=(E=v.tenantId)!==null&&E!==void 0?E:null}static parseLink(t){const s=bUe(t);try{return new rj(s)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v0{constructor(){this.providerId=v0.PROVIDER_ID}static credential(t,s){return pR._fromEmailAndPassword(t,s)}static credentialWithLink(t,s){const a=rj.parseLink(s);return Dn(a,"argument-error"),pR._fromEmailAndCode(t,a.code,a.tenantId)}}v0.PROVIDER_ID="password";v0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";v0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tne{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zR extends Tne{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $m extends zR{constructor(){super("facebook.com")}static credential(t){return wE._fromParams({providerId:$m.PROVIDER_ID,signInMethod:$m.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return $m.credentialFromTaggedObject(t)}static credentialFromError(t){return $m.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return $m.credential(t.oauthAccessToken)}catch{return null}}}$m.FACEBOOK_SIGN_IN_METHOD="facebook.com";$m.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Km extends zR{constructor(){super("google.com"),this.addScope("profile")}static credential(t,s){return wE._fromParams({providerId:Km.PROVIDER_ID,signInMethod:Km.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:s})}static credentialFromResult(t){return Km.credentialFromTaggedObject(t)}static credentialFromError(t){return Km.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:s,oauthAccessToken:a}=t;if(!s&&!a)return null;try{return Km.credential(s,a)}catch{return null}}}Km.GOOGLE_SIGN_IN_METHOD="google.com";Km.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qm extends zR{constructor(){super("github.com")}static credential(t){return wE._fromParams({providerId:qm.PROVIDER_ID,signInMethod:qm.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return qm.credentialFromTaggedObject(t)}static credentialFromError(t){return qm.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return qm.credential(t.oauthAccessToken)}catch{return null}}}qm.GITHUB_SIGN_IN_METHOD="github.com";qm.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ym extends zR{constructor(){super("twitter.com")}static credential(t,s){return wE._fromParams({providerId:Ym.PROVIDER_ID,signInMethod:Ym.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:s})}static credentialFromResult(t){return Ym.credentialFromTaggedObject(t)}static credentialFromError(t){return Ym.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:s,oauthTokenSecret:a}=t;if(!s||!a)return null;try{return Ym.credential(s,a)}catch{return null}}}Ym.TWITTER_SIGN_IN_METHOD="twitter.com";Ym.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wUe(r,t){return WR(r,"POST","/v1/accounts:signUp",Pf(r,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RE{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,s,a,l=!1){const d=await lf._fromIdTokenResponse(t,a,l),f=yY(a);return new RE({user:d,providerId:f,_tokenResponse:a,operationType:s})}static async _forOperation(t,s,a){await t._updateTokensIfNecessary(a,!0);const l=yY(a);return new RE({user:t,providerId:l,_tokenResponse:a,operationType:s})}}function yY(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vk extends ep{constructor(t,s,a,l){var d;super(s.code,s.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,vk.prototype),this.customData={appName:t.name,tenantId:(d=t.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:s.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(t,s,a,l){return new vk(t,s,a,l)}}function bne(r,t,s,a){return(t==="reauthenticate"?s._getReauthenticationResolver(r):s._getIdTokenResponse(r)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?vk._fromErrorAndOperation(r,d,t,a):d})}async function RUe(r,t,s=!1){const a=await hR(r,t._linkToIdToken(r.auth,await r.getIdToken()),s);return RE._forOperation(r,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CUe(r,t,s=!1){const{auth:a}=r;if(bl(a.app))return Promise.reject(gf(a));const l="reauthenticate";try{const d=await hR(r,bne(a,l,t,r),s);Dn(d.idToken,a,"internal-error");const f=ej(d.idToken);Dn(f,a,"internal-error");const{sub:E}=f;return Dn(r.uid===E,a,"user-mismatch"),RE._forOperation(r,l,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&Cd(a,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wne(r,t,s=!1){if(bl(r.app))return Promise.reject(gf(r));const a="signIn",l=await bne(r,a,t),d=await RE._fromIdTokenResponse(r,a,l);return s||await r._updateCurrentUser(d.user),d}async function IUe(r,t){return wne(Sg(r),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rne(r){const t=Sg(r);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function AUe(r,t,s){const a=Sg(r);await yk(a,{requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"},"getOobCode",EUe)}async function PUe(r,t,s){if(bl(r.app))return Promise.reject(gf(r));const a=Sg(r),f=await yk(a,{returnSecureToken:!0,email:t,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",wUe).catch(v=>{throw v.code==="auth/password-does-not-meet-requirements"&&Rne(r),v}),E=await RE._fromIdTokenResponse(a,"signIn",f);return await a._updateCurrentUser(E.user),E}function OUe(r,t,s){return bl(r.app)?Promise.reject(gf(r)):IUe(Xi(r),v0.credential(t,s)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&Rne(r),a})}async function FU(r,t){const s=Xi(r),l={requestType:"VERIFY_EMAIL",idToken:await r.getIdToken()},{email:d}=await _Ue(s.auth,l);d!==r.email&&await r.reload()}function kUe(r,t,s,a){return Xi(r).onIdTokenChanged(t,s,a)}function NUe(r,t,s){return Xi(r).beforeAuthStateChanged(t,s)}function DUe(r,t,s,a){return Xi(r).onAuthStateChanged(t,s,a)}function LUe(r){return Xi(r).signOut()}const Sk="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cne{constructor(t,s){this.storageRetriever=t,this.type=s}_isAvailable(){try{return this.storage?(this.storage.setItem(Sk,"1"),this.storage.removeItem(Sk),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,s){return this.storage.setItem(t,JSON.stringify(s)),Promise.resolve()}_get(t){const s=this.storage.getItem(t);return Promise.resolve(s?JSON.parse(s):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xUe=1e3,MUe=10;class Ine extends Cne{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,s)=>this.onStorageEvent(t,s),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=gne(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const s of Object.keys(this.listeners)){const a=this.storage.getItem(s),l=this.localCache[s];a!==l&&t(s,l,a)}}onStorageEvent(t,s=!1){if(!t.key){this.forAllChangedKeys((f,E,v)=>{this.notifyListeners(f,v)});return}const a=t.key;s?this.detachListener():this.stopPolling();const l=()=>{const f=this.storage.getItem(a);!s&&this.localCache[a]===f||this.notifyListeners(a,f)},d=this.storage.getItem(a);X2e()&&d!==t.newValue&&t.newValue!==t.oldValue?setTimeout(l,MUe):l()}notifyListeners(t,s){this.localCache[t]=s;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(s&&JSON.parse(s))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,s,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:s,newValue:a}),!0)})},xUe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,s){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,s){await super._set(t,s),this.localCache[t]=JSON.stringify(s)}async _get(t){const s=await super._get(t);return this.localCache[t]=JSON.stringify(s),s}async _remove(t){await super._remove(t),delete this.localCache[t]}}Ine.type="LOCAL";const UUe=Ine;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ane extends Cne{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,s){}_removeListener(t,s){}}Ane.type="SESSION";const Pne=Ane;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VUe(r){return Promise.all(r.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(s){return{fulfilled:!1,reason:s}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gN{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const s=this.receivers.find(l=>l.isListeningto(t));if(s)return s;const a=new gN(t);return this.receivers.push(a),a}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const s=t,{eventId:a,eventType:l,data:d}=s.data,f=this.handlersMap[l];if(!(f!=null&&f.size))return;s.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const E=Array.from(f).map(async T=>T(s.origin,d)),v=await VUe(E);s.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:v})}_subscribe(t,s){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(s)}_unsubscribe(t,s){this.handlersMap[t]&&s&&this.handlersMap[t].delete(s),(!s||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}gN.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ij(r="",t=10){let s="";for(let a=0;a<t;a++)s+=Math.floor(Math.random()*10);return r+s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FUe{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,s,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let d,f;return new Promise((E,v)=>{const T=ij("",20);l.port1.start();const R=setTimeout(()=>{v(new Error("unsupported_event"))},a);f={messageChannel:l,onMessage(I){const N=I;if(N.data.eventId===T)switch(N.data.status){case"ack":clearTimeout(R),d=setTimeout(()=>{v(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),E(N.data.response);break;default:clearTimeout(R),clearTimeout(d),v(new Error("invalid_response"));break}}},this.handlers.add(f),l.port1.addEventListener("message",f.onMessage),this.target.postMessage({eventType:t,eventId:T,data:s},[l.port2])}).finally(()=>{f&&this.removeMessageHandler(f)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hh(){return window}function jUe(r){Hh().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function One(){return typeof Hh().WorkerGlobalScope<"u"&&typeof Hh().importScripts=="function"}async function BUe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function WUe(){var r;return((r=navigator==null?void 0:navigator.serviceWorker)===null||r===void 0?void 0:r.controller)||null}function zUe(){return One()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kne="firebaseLocalStorageDb",GUe=1,Tk="firebaseLocalStorage",Nne="fbase_key";class GR{constructor(t){this.request=t}toPromise(){return new Promise((t,s)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{s(this.request.error)})})}}function _N(r,t){return r.transaction([Tk],t?"readwrite":"readonly").objectStore(Tk)}function HUe(){const r=indexedDB.deleteDatabase(kne);return new GR(r).toPromise()}function jU(){const r=indexedDB.open(kne,GUe);return new Promise((t,s)=>{r.addEventListener("error",()=>{s(r.error)}),r.addEventListener("upgradeneeded",()=>{const a=r.result;try{a.createObjectStore(Tk,{keyPath:Nne})}catch(l){s(l)}}),r.addEventListener("success",async()=>{const a=r.result;a.objectStoreNames.contains(Tk)?t(a):(a.close(),await HUe(),t(await jU()))})})}async function vY(r,t,s){const a=_N(r,!0).put({[Nne]:t,value:s});return new GR(a).toPromise()}async function $Ue(r,t){const s=_N(r,!1).get(t),a=await new GR(s).toPromise();return a===void 0?null:a.value}function SY(r,t){const s=_N(r,!0).delete(t);return new GR(s).toPromise()}const KUe=800,qUe=3;class Dne{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await jU(),this.db)}async _withRetries(t){let s=0;for(;;)try{const a=await this._openDb();return await t(a)}catch(a){if(s++>qUe)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return One()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=gN._getInstance(zUe()),this.receiver._subscribe("keyChanged",async(t,s)=>({keyProcessed:(await this._poll()).includes(s.key)})),this.receiver._subscribe("ping",async(t,s)=>["keyChanged"])}async initializeSender(){var t,s;if(this.activeServiceWorker=await BUe(),!this.activeServiceWorker)return;this.sender=new FUe(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((t=a[0])===null||t===void 0)&&t.fulfilled&&!((s=a[0])===null||s===void 0)&&s.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||WUe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await jU();return await vY(t,Sk,"1"),await SY(t,Sk),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,s){return this._withPendingWrite(async()=>(await this._withRetries(a=>vY(a,t,s)),this.localCache[t]=s,this.notifyServiceWorker(t)))}async _get(t){const s=await this._withRetries(a=>$Ue(a,t));return this.localCache[t]=s,s}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(s=>SY(s,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(l=>{const d=_N(l,!1).getAll();return new GR(d).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const s=[],a=new Set;if(t.length!==0)for(const{fbase_key:l,value:d}of t)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(d)&&(this.notifyListeners(l,d),s.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),s.push(l));return s}notifyListeners(t,s){this.localCache[t]=s;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(s)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),KUe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,s){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(s)}_removeListener(t,s){this.listeners[t]&&(this.listeners[t].delete(s),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Dne.type="LOCAL";const YUe=Dne;new BR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XUe(r,t){return t?uf(t):(Dn(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sj extends nj{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return VS(t,this._buildIdpRequest())}_linkToIdToken(t,s){return VS(t,this._buildIdpRequest(s))}_getReauthenticationResolver(t){return VS(t,this._buildIdpRequest())}_buildIdpRequest(t){const s={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(s.idToken=t),s}}function JUe(r){return wne(r.auth,new sj(r),r.bypassAuthState)}function QUe(r){const{auth:t,user:s}=r;return Dn(s,t,"internal-error"),CUe(s,new sj(r),r.bypassAuthState)}async function ZUe(r){const{auth:t,user:s}=r;return Dn(s,t,"internal-error"),RUe(s,new sj(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lne{constructor(t,s,a,l,d=!1){this.auth=t,this.resolver=a,this.user=l,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(s)?s:[s]}execute(){return new Promise(async(t,s)=>{this.pendingPromise={resolve:t,reject:s};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(t){const{urlResponse:s,sessionId:a,postBody:l,tenantId:d,error:f,type:E}=t;if(f){this.reject(f);return}const v={auth:this.auth,requestUri:s,sessionId:a,tenantId:d||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(E)(v))}catch(T){this.reject(T)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return JUe;case"linkViaPopup":case"linkViaRedirect":return ZUe;case"reauthViaPopup":case"reauthViaRedirect":return QUe;default:Cd(this.auth,"internal-error")}}resolve(t){bf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){bf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eVe=new BR(2e3,1e4);class TS extends Lne{constructor(t,s,a,l,d){super(t,s,l,d),this.provider=a,this.authWindow=null,this.pollId=null,TS.currentPopupAction&&TS.currentPopupAction.cancel(),TS.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Dn(t,this.auth,"internal-error"),t}async onExecution(){bf(this.filter.length===1,"Popup operations only handle one event");const t=ij();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(s=>{this.reject(s)}),this.resolver._isIframeWebStorageSupported(this.auth,s=>{s||this.reject(Gh(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(Gh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,TS.currentPopupAction=null}pollUserCancellation(){const t=()=>{var s,a;if(!((a=(s=this.authWindow)===null||s===void 0?void 0:s.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Gh(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,eVe.get())};t()}}TS.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tVe="pendingRedirect",FO=new Map;class nVe extends Lne{constructor(t,s,a=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],s,void 0,a),this.eventId=null}async execute(){let t=FO.get(this.auth._key());if(!t){try{const a=await rVe(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(a)}catch(s){t=()=>Promise.reject(s)}FO.set(this.auth._key(),t)}return this.bypassAuthState||FO.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const s=await this.auth._redirectUserForId(t.eventId);if(s)return this.user=s,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function rVe(r,t){const s=oVe(t),a=sVe(r);if(!await a._isAvailable())return!1;const l=await a._get(s)==="true";return await a._remove(s),l}function iVe(r,t){FO.set(r._key(),t)}function sVe(r){return uf(r._redirectPersistence)}function oVe(r){return VO(tVe,r.config.apiKey,r.name)}async function aVe(r,t,s=!1){if(bl(r.app))return Promise.reject(gf(r));const a=Sg(r),l=XUe(a,t),f=await new nVe(a,l,s).execute();return f&&!s&&(delete f.user._redirectEventId,await a._persistUserIfCurrent(f.user),await a._setRedirectUser(null,t)),f}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cVe=10*60*1e3;class lVe{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let s=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(t,a)&&(s=!0,this.sendToConsumer(t,a),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!uVe(t)||(this.hasHandledPotentialRedirect=!0,s||(this.queuedRedirectEvent=t,s=!0)),s}sendToConsumer(t,s){var a;if(t.error&&!xne(t)){const l=((a=t.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";s.onError(Gh(this.auth,l))}else s.onAuthEvent(t)}isEventForConsumer(t,s){const a=s.eventId===null||!!t.eventId&&t.eventId===s.eventId;return s.filter.includes(t.type)&&a}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=cVe&&this.cachedEventUids.clear(),this.cachedEventUids.has(TY(t))}saveEventToCache(t){this.cachedEventUids.add(TY(t)),this.lastProcessedEventTime=Date.now()}}function TY(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(t=>t).join("-")}function xne({type:r,error:t}){return r==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function uVe(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return xne(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dVe(r,t={}){return Of(r,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hVe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,pVe=/^https?/;async function fVe(r){if(r.config.emulator)return;const{authorizedDomains:t}=await dVe(r);for(const s of t)try{if(mVe(s))return}catch{}Cd(r,"unauthorized-domain")}function mVe(r){const t=UU(),{protocol:s,hostname:a}=new URL(t);if(r.startsWith("chrome-extension://")){const f=new URL(r);return f.hostname===""&&a===""?s==="chrome-extension:"&&r.replace("chrome-extension://","")===t.replace("chrome-extension://",""):s==="chrome-extension:"&&f.hostname===a}if(!pVe.test(s))return!1;if(hVe.test(r))return a===r;const l=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gVe=new BR(3e4,6e4);function bY(){const r=Hh().___jsl;if(r!=null&&r.H){for(const t of Object.keys(r.H))if(r.H[t].r=r.H[t].r||[],r.H[t].L=r.H[t].L||[],r.H[t].r=[...r.H[t].L],r.CP)for(let s=0;s<r.CP.length;s++)r.CP[s]=null}}function _Ve(r){return new Promise((t,s)=>{var a,l,d;function f(){bY(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{bY(),s(Gh(r,"network-request-failed"))},timeout:gVe.get()})}if(!((l=(a=Hh().gapi)===null||a===void 0?void 0:a.iframes)===null||l===void 0)&&l.Iframe)t(gapi.iframes.getContext());else if(!((d=Hh().gapi)===null||d===void 0)&&d.load)f();else{const E=sUe("iframefcb");return Hh()[E]=()=>{gapi.load?f():s(Gh(r,"network-request-failed"))},Ene(`${iUe()}?onload=${E}`).catch(v=>s(v))}}).catch(t=>{throw jO=null,t})}let jO=null;function EVe(r){return jO=jO||_Ve(r),jO}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yVe=new BR(5e3,15e3),vVe="__/auth/iframe",SVe="emulator/auth/iframe",TVe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},bVe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function wVe(r){const t=r.config;Dn(t.authDomain,r,"auth-domain-config-required");const s=t.emulator?ZF(t,SVe):`https://${r.config.authDomain}/${vVe}`,a={apiKey:t.apiKey,appName:r.name,v:OE},l=bVe.get(r.config.apiHost);l&&(a.eid=l);const d=r._getFrameworks();return d.length&&(a.fw=d.join(",")),`${s}?${jR(a).slice(1)}`}async function RVe(r){const t=await EVe(r),s=Hh().gapi;return Dn(s,r,"internal-error"),t.open({where:document.body,url:wVe(r),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:TVe,dontclear:!0},a=>new Promise(async(l,d)=>{await a.restyle({setHideOnLeave:!1});const f=Gh(r,"network-request-failed"),E=Hh().setTimeout(()=>{d(f)},yVe.get());function v(){Hh().clearTimeout(E),l(a)}a.ping(v).then(v,()=>{d(f)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CVe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},IVe=500,AVe=600,PVe="_blank",OVe="http://localhost";class wY{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function kVe(r,t,s,a=IVe,l=AVe){const d=Math.max((window.screen.availHeight-l)/2,0).toString(),f=Math.max((window.screen.availWidth-a)/2,0).toString();let E="";const v=Object.assign(Object.assign({},CVe),{width:a.toString(),height:l.toString(),top:d,left:f}),T=Na().toLowerCase();s&&(E=dne(T)?PVe:s),lne(T)&&(t=t||OVe,v.scrollbars="yes");const R=Object.entries(v).reduce((N,[F,j])=>`${N}${F}=${j},`,"");if(Y2e(T)&&E!=="_self")return NVe(t||"",E),new wY(null);const I=window.open(t||"",E,R);Dn(I,r,"popup-blocked");try{I.focus()}catch{}return new wY(I)}function NVe(r,t){const s=document.createElement("a");s.href=r,s.target=t;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DVe="__/auth/handler",LVe="emulator/auth/handler",xVe=encodeURIComponent("fac");async function RY(r,t,s,a,l,d){Dn(r.config.authDomain,r,"auth-domain-config-required"),Dn(r.config.apiKey,r,"invalid-api-key");const f={apiKey:r.config.apiKey,appName:r.name,authType:s,redirectUrl:a,v:OE,eventId:l};if(t instanceof Tne){t.setDefaultLanguage(r.languageCode),f.providerId=t.providerId||"",EMe(t.getCustomParameters())||(f.customParameters=JSON.stringify(t.getCustomParameters()));for(const[R,I]of Object.entries({}))f[R]=I}if(t instanceof zR){const R=t.getScopes().filter(I=>I!=="");R.length>0&&(f.scopes=R.join(","))}r.tenantId&&(f.tid=r.tenantId);const E=f;for(const R of Object.keys(E))E[R]===void 0&&delete E[R];const v=await r._getAppCheckToken(),T=v?`#${xVe}=${encodeURIComponent(v)}`:"";return`${MVe(r)}?${jR(E).slice(1)}${T}`}function MVe({config:r}){return r.emulator?ZF(r,LVe):`https://${r.authDomain}/${DVe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v2="webStorageSupport";class UVe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Pne,this._completeRedirectFn=aVe,this._overrideRedirectResult=iVe}async _openPopup(t,s,a,l){var d;bf((d=this.eventManagers[t._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const f=await RY(t,s,a,UU(),l);return kVe(t,f,ij())}async _openRedirect(t,s,a,l){await this._originValidation(t);const d=await RY(t,s,a,UU(),l);return jUe(d),new Promise(()=>{})}_initialize(t){const s=t._key();if(this.eventManagers[s]){const{manager:l,promise:d}=this.eventManagers[s];return l?Promise.resolve(l):(bf(d,"If manager is not set, promise should be"),d)}const a=this.initAndGetManager(t);return this.eventManagers[s]={promise:a},a.catch(()=>{delete this.eventManagers[s]}),a}async initAndGetManager(t){const s=await RVe(t),a=new lVe(t);return s.register("authEvent",l=>(Dn(l==null?void 0:l.authEvent,t,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:a},this.iframes[t._key()]=s,a}_isIframeWebStorageSupported(t,s){this.iframes[t._key()].send(v2,{type:v2},l=>{var d;const f=(d=l==null?void 0:l[0])===null||d===void 0?void 0:d[v2];f!==void 0&&s(!!f),Cd(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const s=t._key();return this.originValidationPromises[s]||(this.originValidationPromises[s]=fVe(t)),this.originValidationPromises[s]}get _shouldInitProactively(){return gne()||une()||tj()}}const VVe=UVe;var CY="@firebase/auth",IY="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FVe{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const s=this.auth.onIdTokenChanged(a=>{t((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,s),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const s=this.internalListeners.get(t);s&&(this.internalListeners.delete(t),s(),this.updateProactiveRefresh())}assertAuthConfigured(){Dn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jVe(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function BVe(r){bE(new dg("auth",(t,{options:s})=>{const a=t.getProvider("app").getImmediate(),l=t.getProvider("heartbeat"),d=t.getProvider("app-check-internal"),{apiKey:f,authDomain:E}=a.options;Dn(f&&!f.includes(":"),"invalid-api-key",{appName:a.name});const v={apiKey:f,authDomain:E,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:_ne(r)},T=new tUe(a,l,d,v);return dUe(T,s),T},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,s,a)=>{t.getProvider("auth-internal").initialize()})),bE(new dg("auth-internal",t=>{const s=Sg(t.getProvider("auth").getImmediate());return(a=>new FVe(a))(s)},"PRIVATE").setInstantiationMode("EXPLICIT")),zh(CY,IY,jVe(r)),zh(CY,IY,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WVe=5*60,zVe=Kte("authIdTokenMaxAge")||WVe;let AY=null;const GVe=r=>async t=>{const s=t&&await t.getIdTokenResult(),a=s&&(new Date().getTime()-Date.parse(s.issuedAtTime))/1e3;if(a&&a>zVe)return;const l=s==null?void 0:s.token;AY!==l&&(AY=l,await fetch(r,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function Mne(r=JF()){const t=fN(r,"auth");if(t.isInitialized())return t.getImmediate();const s=uUe(r,{popupRedirectResolver:VVe,persistence:[YUe,UUe,Pne]}),a=Kte("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(a,location.origin);if(location.origin===d.origin){const f=GVe(d.toString());NUe(s,f,()=>f(s.currentUser)),kUe(s,E=>f(E))}}const l=Gte("auth");return l&&hUe(s,`http://${l}`),s}function HVe(){var r,t;return(t=(r=document.getElementsByTagName("head"))===null||r===void 0?void 0:r[0])!==null&&t!==void 0?t:document}nUe({loadJS(r){return new Promise((t,s)=>{const a=document.createElement("script");a.setAttribute("src",r),a.onload=t,a.onerror=l=>{const d=Gh("internal-error");d.customData=l,s(d)},a.type="text/javascript",a.charset="UTF-8",HVe().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});BVe("Browser");var PY=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var rg,Une;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(Z,Q){function ne(){}ne.prototype=Q.prototype,Z.D=Q.prototype,Z.prototype=new ne,Z.prototype.constructor=Z,Z.C=function(oe,pe,he){for(var le=Array(arguments.length-2),Me=2;Me<arguments.length;Me++)le[Me-2]=arguments[Me];return Q.prototype[pe].apply(oe,le)}}function s(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(a,s),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(Z,Q,ne){ne||(ne=0);var oe=Array(16);if(typeof Q=="string")for(var pe=0;16>pe;++pe)oe[pe]=Q.charCodeAt(ne++)|Q.charCodeAt(ne++)<<8|Q.charCodeAt(ne++)<<16|Q.charCodeAt(ne++)<<24;else for(pe=0;16>pe;++pe)oe[pe]=Q[ne++]|Q[ne++]<<8|Q[ne++]<<16|Q[ne++]<<24;Q=Z.g[0],ne=Z.g[1],pe=Z.g[2];var he=Z.g[3],le=Q+(he^ne&(pe^he))+oe[0]+3614090360&4294967295;Q=ne+(le<<7&4294967295|le>>>25),le=he+(pe^Q&(ne^pe))+oe[1]+3905402710&4294967295,he=Q+(le<<12&4294967295|le>>>20),le=pe+(ne^he&(Q^ne))+oe[2]+606105819&4294967295,pe=he+(le<<17&4294967295|le>>>15),le=ne+(Q^pe&(he^Q))+oe[3]+3250441966&4294967295,ne=pe+(le<<22&4294967295|le>>>10),le=Q+(he^ne&(pe^he))+oe[4]+4118548399&4294967295,Q=ne+(le<<7&4294967295|le>>>25),le=he+(pe^Q&(ne^pe))+oe[5]+1200080426&4294967295,he=Q+(le<<12&4294967295|le>>>20),le=pe+(ne^he&(Q^ne))+oe[6]+2821735955&4294967295,pe=he+(le<<17&4294967295|le>>>15),le=ne+(Q^pe&(he^Q))+oe[7]+4249261313&4294967295,ne=pe+(le<<22&4294967295|le>>>10),le=Q+(he^ne&(pe^he))+oe[8]+1770035416&4294967295,Q=ne+(le<<7&4294967295|le>>>25),le=he+(pe^Q&(ne^pe))+oe[9]+2336552879&4294967295,he=Q+(le<<12&4294967295|le>>>20),le=pe+(ne^he&(Q^ne))+oe[10]+4294925233&4294967295,pe=he+(le<<17&4294967295|le>>>15),le=ne+(Q^pe&(he^Q))+oe[11]+2304563134&4294967295,ne=pe+(le<<22&4294967295|le>>>10),le=Q+(he^ne&(pe^he))+oe[12]+1804603682&4294967295,Q=ne+(le<<7&4294967295|le>>>25),le=he+(pe^Q&(ne^pe))+oe[13]+4254626195&4294967295,he=Q+(le<<12&4294967295|le>>>20),le=pe+(ne^he&(Q^ne))+oe[14]+2792965006&4294967295,pe=he+(le<<17&4294967295|le>>>15),le=ne+(Q^pe&(he^Q))+oe[15]+1236535329&4294967295,ne=pe+(le<<22&4294967295|le>>>10),le=Q+(pe^he&(ne^pe))+oe[1]+4129170786&4294967295,Q=ne+(le<<5&4294967295|le>>>27),le=he+(ne^pe&(Q^ne))+oe[6]+3225465664&4294967295,he=Q+(le<<9&4294967295|le>>>23),le=pe+(Q^ne&(he^Q))+oe[11]+643717713&4294967295,pe=he+(le<<14&4294967295|le>>>18),le=ne+(he^Q&(pe^he))+oe[0]+3921069994&4294967295,ne=pe+(le<<20&4294967295|le>>>12),le=Q+(pe^he&(ne^pe))+oe[5]+3593408605&4294967295,Q=ne+(le<<5&4294967295|le>>>27),le=he+(ne^pe&(Q^ne))+oe[10]+38016083&4294967295,he=Q+(le<<9&4294967295|le>>>23),le=pe+(Q^ne&(he^Q))+oe[15]+3634488961&4294967295,pe=he+(le<<14&4294967295|le>>>18),le=ne+(he^Q&(pe^he))+oe[4]+3889429448&4294967295,ne=pe+(le<<20&4294967295|le>>>12),le=Q+(pe^he&(ne^pe))+oe[9]+568446438&4294967295,Q=ne+(le<<5&4294967295|le>>>27),le=he+(ne^pe&(Q^ne))+oe[14]+3275163606&4294967295,he=Q+(le<<9&4294967295|le>>>23),le=pe+(Q^ne&(he^Q))+oe[3]+4107603335&4294967295,pe=he+(le<<14&4294967295|le>>>18),le=ne+(he^Q&(pe^he))+oe[8]+1163531501&4294967295,ne=pe+(le<<20&4294967295|le>>>12),le=Q+(pe^he&(ne^pe))+oe[13]+2850285829&4294967295,Q=ne+(le<<5&4294967295|le>>>27),le=he+(ne^pe&(Q^ne))+oe[2]+4243563512&4294967295,he=Q+(le<<9&4294967295|le>>>23),le=pe+(Q^ne&(he^Q))+oe[7]+1735328473&4294967295,pe=he+(le<<14&4294967295|le>>>18),le=ne+(he^Q&(pe^he))+oe[12]+2368359562&4294967295,ne=pe+(le<<20&4294967295|le>>>12),le=Q+(ne^pe^he)+oe[5]+4294588738&4294967295,Q=ne+(le<<4&4294967295|le>>>28),le=he+(Q^ne^pe)+oe[8]+2272392833&4294967295,he=Q+(le<<11&4294967295|le>>>21),le=pe+(he^Q^ne)+oe[11]+1839030562&4294967295,pe=he+(le<<16&4294967295|le>>>16),le=ne+(pe^he^Q)+oe[14]+4259657740&4294967295,ne=pe+(le<<23&4294967295|le>>>9),le=Q+(ne^pe^he)+oe[1]+2763975236&4294967295,Q=ne+(le<<4&4294967295|le>>>28),le=he+(Q^ne^pe)+oe[4]+1272893353&4294967295,he=Q+(le<<11&4294967295|le>>>21),le=pe+(he^Q^ne)+oe[7]+4139469664&4294967295,pe=he+(le<<16&4294967295|le>>>16),le=ne+(pe^he^Q)+oe[10]+3200236656&4294967295,ne=pe+(le<<23&4294967295|le>>>9),le=Q+(ne^pe^he)+oe[13]+681279174&4294967295,Q=ne+(le<<4&4294967295|le>>>28),le=he+(Q^ne^pe)+oe[0]+3936430074&4294967295,he=Q+(le<<11&4294967295|le>>>21),le=pe+(he^Q^ne)+oe[3]+3572445317&4294967295,pe=he+(le<<16&4294967295|le>>>16),le=ne+(pe^he^Q)+oe[6]+76029189&4294967295,ne=pe+(le<<23&4294967295|le>>>9),le=Q+(ne^pe^he)+oe[9]+3654602809&4294967295,Q=ne+(le<<4&4294967295|le>>>28),le=he+(Q^ne^pe)+oe[12]+3873151461&4294967295,he=Q+(le<<11&4294967295|le>>>21),le=pe+(he^Q^ne)+oe[15]+530742520&4294967295,pe=he+(le<<16&4294967295|le>>>16),le=ne+(pe^he^Q)+oe[2]+3299628645&4294967295,ne=pe+(le<<23&4294967295|le>>>9),le=Q+(pe^(ne|~he))+oe[0]+4096336452&4294967295,Q=ne+(le<<6&4294967295|le>>>26),le=he+(ne^(Q|~pe))+oe[7]+1126891415&4294967295,he=Q+(le<<10&4294967295|le>>>22),le=pe+(Q^(he|~ne))+oe[14]+2878612391&4294967295,pe=he+(le<<15&4294967295|le>>>17),le=ne+(he^(pe|~Q))+oe[5]+4237533241&4294967295,ne=pe+(le<<21&4294967295|le>>>11),le=Q+(pe^(ne|~he))+oe[12]+1700485571&4294967295,Q=ne+(le<<6&4294967295|le>>>26),le=he+(ne^(Q|~pe))+oe[3]+2399980690&4294967295,he=Q+(le<<10&4294967295|le>>>22),le=pe+(Q^(he|~ne))+oe[10]+4293915773&4294967295,pe=he+(le<<15&4294967295|le>>>17),le=ne+(he^(pe|~Q))+oe[1]+2240044497&4294967295,ne=pe+(le<<21&4294967295|le>>>11),le=Q+(pe^(ne|~he))+oe[8]+1873313359&4294967295,Q=ne+(le<<6&4294967295|le>>>26),le=he+(ne^(Q|~pe))+oe[15]+4264355552&4294967295,he=Q+(le<<10&4294967295|le>>>22),le=pe+(Q^(he|~ne))+oe[6]+2734768916&4294967295,pe=he+(le<<15&4294967295|le>>>17),le=ne+(he^(pe|~Q))+oe[13]+1309151649&4294967295,ne=pe+(le<<21&4294967295|le>>>11),le=Q+(pe^(ne|~he))+oe[4]+4149444226&4294967295,Q=ne+(le<<6&4294967295|le>>>26),le=he+(ne^(Q|~pe))+oe[11]+3174756917&4294967295,he=Q+(le<<10&4294967295|le>>>22),le=pe+(Q^(he|~ne))+oe[2]+718787259&4294967295,pe=he+(le<<15&4294967295|le>>>17),le=ne+(he^(pe|~Q))+oe[9]+3951481745&4294967295,Z.g[0]=Z.g[0]+Q&4294967295,Z.g[1]=Z.g[1]+(pe+(le<<21&4294967295|le>>>11))&4294967295,Z.g[2]=Z.g[2]+pe&4294967295,Z.g[3]=Z.g[3]+he&4294967295}a.prototype.u=function(Z,Q){Q===void 0&&(Q=Z.length);for(var ne=Q-this.blockSize,oe=this.B,pe=this.h,he=0;he<Q;){if(pe==0)for(;he<=ne;)l(this,Z,he),he+=this.blockSize;if(typeof Z=="string"){for(;he<Q;)if(oe[pe++]=Z.charCodeAt(he++),pe==this.blockSize){l(this,oe),pe=0;break}}else for(;he<Q;)if(oe[pe++]=Z[he++],pe==this.blockSize){l(this,oe),pe=0;break}}this.h=pe,this.o+=Q},a.prototype.v=function(){var Z=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);Z[0]=128;for(var Q=1;Q<Z.length-8;++Q)Z[Q]=0;var ne=8*this.o;for(Q=Z.length-8;Q<Z.length;++Q)Z[Q]=ne&255,ne/=256;for(this.u(Z),Z=Array(16),Q=ne=0;4>Q;++Q)for(var oe=0;32>oe;oe+=8)Z[ne++]=this.g[Q]>>>oe&255;return Z};function d(Z,Q){var ne=E;return Object.prototype.hasOwnProperty.call(ne,Z)?ne[Z]:ne[Z]=Q(Z)}function f(Z,Q){this.h=Q;for(var ne=[],oe=!0,pe=Z.length-1;0<=pe;pe--){var he=Z[pe]|0;oe&&he==Q||(ne[pe]=he,oe=!1)}this.g=ne}var E={};function v(Z){return-128<=Z&&128>Z?d(Z,function(Q){return new f([Q|0],0>Q?-1:0)}):new f([Z|0],0>Z?-1:0)}function T(Z){if(isNaN(Z)||!isFinite(Z))return I;if(0>Z)return H(T(-Z));for(var Q=[],ne=1,oe=0;Z>=ne;oe++)Q[oe]=Z/ne|0,ne*=4294967296;return new f(Q,0)}function R(Z,Q){if(Z.length==0)throw Error("number format error: empty string");if(Q=Q||10,2>Q||36<Q)throw Error("radix out of range: "+Q);if(Z.charAt(0)=="-")return H(R(Z.substring(1),Q));if(0<=Z.indexOf("-"))throw Error('number format error: interior "-" character');for(var ne=T(Math.pow(Q,8)),oe=I,pe=0;pe<Z.length;pe+=8){var he=Math.min(8,Z.length-pe),le=parseInt(Z.substring(pe,pe+he),Q);8>he?(he=T(Math.pow(Q,he)),oe=oe.j(he).add(T(le))):(oe=oe.j(ne),oe=oe.add(T(le)))}return oe}var I=v(0),N=v(1),F=v(16777216);r=f.prototype,r.m=function(){if(G(this))return-H(this).m();for(var Z=0,Q=1,ne=0;ne<this.g.length;ne++){var oe=this.i(ne);Z+=(0<=oe?oe:4294967296+oe)*Q,Q*=4294967296}return Z},r.toString=function(Z){if(Z=Z||10,2>Z||36<Z)throw Error("radix out of range: "+Z);if(j(this))return"0";if(G(this))return"-"+H(this).toString(Z);for(var Q=T(Math.pow(Z,6)),ne=this,oe="";;){var pe=de(ne,Q).g;ne=te(ne,pe.j(Q));var he=((0<ne.g.length?ne.g[0]:ne.h)>>>0).toString(Z);if(ne=pe,j(ne))return he+oe;for(;6>he.length;)he="0"+he;oe=he+oe}},r.i=function(Z){return 0>Z?0:Z<this.g.length?this.g[Z]:this.h};function j(Z){if(Z.h!=0)return!1;for(var Q=0;Q<Z.g.length;Q++)if(Z.g[Q]!=0)return!1;return!0}function G(Z){return Z.h==-1}r.l=function(Z){return Z=te(this,Z),G(Z)?-1:j(Z)?0:1};function H(Z){for(var Q=Z.g.length,ne=[],oe=0;oe<Q;oe++)ne[oe]=~Z.g[oe];return new f(ne,~Z.h).add(N)}r.abs=function(){return G(this)?H(this):this},r.add=function(Z){for(var Q=Math.max(this.g.length,Z.g.length),ne=[],oe=0,pe=0;pe<=Q;pe++){var he=oe+(this.i(pe)&65535)+(Z.i(pe)&65535),le=(he>>>16)+(this.i(pe)>>>16)+(Z.i(pe)>>>16);oe=le>>>16,he&=65535,le&=65535,ne[pe]=le<<16|he}return new f(ne,ne[ne.length-1]&-2147483648?-1:0)};function te(Z,Q){return Z.add(H(Q))}r.j=function(Z){if(j(this)||j(Z))return I;if(G(this))return G(Z)?H(this).j(H(Z)):H(H(this).j(Z));if(G(Z))return H(this.j(H(Z)));if(0>this.l(F)&&0>Z.l(F))return T(this.m()*Z.m());for(var Q=this.g.length+Z.g.length,ne=[],oe=0;oe<2*Q;oe++)ne[oe]=0;for(oe=0;oe<this.g.length;oe++)for(var pe=0;pe<Z.g.length;pe++){var he=this.i(oe)>>>16,le=this.i(oe)&65535,Me=Z.i(pe)>>>16,He=Z.i(pe)&65535;ne[2*oe+2*pe]+=le*He,K(ne,2*oe+2*pe),ne[2*oe+2*pe+1]+=he*He,K(ne,2*oe+2*pe+1),ne[2*oe+2*pe+1]+=le*Me,K(ne,2*oe+2*pe+1),ne[2*oe+2*pe+2]+=he*Me,K(ne,2*oe+2*pe+2)}for(oe=0;oe<Q;oe++)ne[oe]=ne[2*oe+1]<<16|ne[2*oe];for(oe=Q;oe<2*Q;oe++)ne[oe]=0;return new f(ne,0)};function K(Z,Q){for(;(Z[Q]&65535)!=Z[Q];)Z[Q+1]+=Z[Q]>>>16,Z[Q]&=65535,Q++}function ee(Z,Q){this.g=Z,this.h=Q}function de(Z,Q){if(j(Q))throw Error("division by zero");if(j(Z))return new ee(I,I);if(G(Z))return Q=de(H(Z),Q),new ee(H(Q.g),H(Q.h));if(G(Q))return Q=de(Z,H(Q)),new ee(H(Q.g),Q.h);if(30<Z.g.length){if(G(Z)||G(Q))throw Error("slowDivide_ only works with positive integers.");for(var ne=N,oe=Q;0>=oe.l(Z);)ne=se(ne),oe=se(oe);var pe=ge(ne,1),he=ge(oe,1);for(oe=ge(oe,2),ne=ge(ne,2);!j(oe);){var le=he.add(oe);0>=le.l(Z)&&(pe=pe.add(ne),he=le),oe=ge(oe,1),ne=ge(ne,1)}return Q=te(Z,pe.j(Q)),new ee(pe,Q)}for(pe=I;0<=Z.l(Q);){for(ne=Math.max(1,Math.floor(Z.m()/Q.m())),oe=Math.ceil(Math.log(ne)/Math.LN2),oe=48>=oe?1:Math.pow(2,oe-48),he=T(ne),le=he.j(Q);G(le)||0<le.l(Z);)ne-=oe,he=T(ne),le=he.j(Q);j(he)&&(he=N),pe=pe.add(he),Z=te(Z,le)}return new ee(pe,Z)}r.A=function(Z){return de(this,Z).h},r.and=function(Z){for(var Q=Math.max(this.g.length,Z.g.length),ne=[],oe=0;oe<Q;oe++)ne[oe]=this.i(oe)&Z.i(oe);return new f(ne,this.h&Z.h)},r.or=function(Z){for(var Q=Math.max(this.g.length,Z.g.length),ne=[],oe=0;oe<Q;oe++)ne[oe]=this.i(oe)|Z.i(oe);return new f(ne,this.h|Z.h)},r.xor=function(Z){for(var Q=Math.max(this.g.length,Z.g.length),ne=[],oe=0;oe<Q;oe++)ne[oe]=this.i(oe)^Z.i(oe);return new f(ne,this.h^Z.h)};function se(Z){for(var Q=Z.g.length+1,ne=[],oe=0;oe<Q;oe++)ne[oe]=Z.i(oe)<<1|Z.i(oe-1)>>>31;return new f(ne,Z.h)}function ge(Z,Q){var ne=Q>>5;Q%=32;for(var oe=Z.g.length-ne,pe=[],he=0;he<oe;he++)pe[he]=0<Q?Z.i(he+ne)>>>Q|Z.i(he+ne+1)<<32-Q:Z.i(he+ne);return new f(pe,Z.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,Une=a,f.prototype.add=f.prototype.add,f.prototype.multiply=f.prototype.j,f.prototype.modulo=f.prototype.A,f.prototype.compare=f.prototype.l,f.prototype.toNumber=f.prototype.m,f.prototype.toString=f.prototype.toString,f.prototype.getBits=f.prototype.i,f.fromNumber=T,f.fromString=R,rg=f}).apply(typeof PY<"u"?PY:typeof self<"u"?self:typeof window<"u"?window:{});var oO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Vne,Sw,Fne,BO,BU,jne,Bne,Wne;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(C,B,J){return C==Array.prototype||C==Object.prototype||(C[B]=J.value),C};function s(C){C=[typeof globalThis=="object"&&globalThis,C,typeof window=="object"&&window,typeof self=="object"&&self,typeof oO=="object"&&oO];for(var B=0;B<C.length;++B){var J=C[B];if(J&&J.Math==Math)return J}throw Error("Cannot find global object")}var a=s(this);function l(C,B){if(B)e:{var J=a;C=C.split(".");for(var fe=0;fe<C.length-1;fe++){var qe=C[fe];if(!(qe in J))break e;J=J[qe]}C=C[C.length-1],fe=J[C],B=B(fe),B!=fe&&B!=null&&t(J,C,{configurable:!0,writable:!0,value:B})}}function d(C,B){C instanceof String&&(C+="");var J=0,fe=!1,qe={next:function(){if(!fe&&J<C.length){var at=J++;return{value:B(at,C[at]),done:!1}}return fe=!0,{done:!0,value:void 0}}};return qe[Symbol.iterator]=function(){return qe},qe}l("Array.prototype.values",function(C){return C||function(){return d(this,function(B,J){return J})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var f=f||{},E=this||self;function v(C){var B=typeof C;return B=B!="object"?B:C?Array.isArray(C)?"array":B:"null",B=="array"||B=="object"&&typeof C.length=="number"}function T(C){var B=typeof C;return B=="object"&&C!=null||B=="function"}function R(C,B,J){return C.call.apply(C.bind,arguments)}function I(C,B,J){if(!C)throw Error();if(2<arguments.length){var fe=Array.prototype.slice.call(arguments,2);return function(){var qe=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(qe,fe),C.apply(B,qe)}}return function(){return C.apply(B,arguments)}}function N(C,B,J){return N=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?R:I,N.apply(null,arguments)}function F(C,B){var J=Array.prototype.slice.call(arguments,1);return function(){var fe=J.slice();return fe.push.apply(fe,arguments),C.apply(this,fe)}}function j(C,B){function J(){}J.prototype=B.prototype,C.aa=B.prototype,C.prototype=new J,C.prototype.constructor=C,C.Qb=function(fe,qe,at){for(var Lt=Array(arguments.length-2),Gr=2;Gr<arguments.length;Gr++)Lt[Gr-2]=arguments[Gr];return B.prototype[qe].apply(fe,Lt)}}function G(C){const B=C.length;if(0<B){const J=Array(B);for(let fe=0;fe<B;fe++)J[fe]=C[fe];return J}return[]}function H(C,B){for(let J=1;J<arguments.length;J++){const fe=arguments[J];if(v(fe)){const qe=C.length||0,at=fe.length||0;C.length=qe+at;for(let Lt=0;Lt<at;Lt++)C[qe+Lt]=fe[Lt]}else C.push(fe)}}class te{constructor(B,J){this.i=B,this.j=J,this.h=0,this.g=null}get(){let B;return 0<this.h?(this.h--,B=this.g,this.g=B.next,B.next=null):B=this.i(),B}}function K(C){return/^[\s\xa0]*$/.test(C)}function ee(){var C=E.navigator;return C&&(C=C.userAgent)?C:""}function de(C){return de[" "](C),C}de[" "]=function(){};var se=ee().indexOf("Gecko")!=-1&&!(ee().toLowerCase().indexOf("webkit")!=-1&&ee().indexOf("Edge")==-1)&&!(ee().indexOf("Trident")!=-1||ee().indexOf("MSIE")!=-1)&&ee().indexOf("Edge")==-1;function ge(C,B,J){for(const fe in C)B.call(J,C[fe],fe,C)}function Z(C,B){for(const J in C)B.call(void 0,C[J],J,C)}function Q(C){const B={};for(const J in C)B[J]=C[J];return B}const ne="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function oe(C,B){let J,fe;for(let qe=1;qe<arguments.length;qe++){fe=arguments[qe];for(J in fe)C[J]=fe[J];for(let at=0;at<ne.length;at++)J=ne[at],Object.prototype.hasOwnProperty.call(fe,J)&&(C[J]=fe[J])}}function pe(C){var B=1;C=C.split(":");const J=[];for(;0<B&&C.length;)J.push(C.shift()),B--;return C.length&&J.push(C.join(":")),J}function he(C){E.setTimeout(()=>{throw C},0)}function le(){var C=ye;let B=null;return C.g&&(B=C.g,C.g=C.g.next,C.g||(C.h=null),B.next=null),B}class Me{constructor(){this.h=this.g=null}add(B,J){const fe=He.get();fe.set(B,J),this.h?this.h.next=fe:this.g=fe,this.h=fe}}var He=new te(()=>new rt,C=>C.reset());class rt{constructor(){this.next=this.g=this.h=null}set(B,J){this.h=B,this.g=J,this.next=null}reset(){this.next=this.g=this.h=null}}let we,Ce=!1,ye=new Me,Ne=()=>{const C=E.Promise.resolve(void 0);we=()=>{C.then(Te)}};var Te=()=>{for(var C;C=le();){try{C.h.call(C.g)}catch(J){he(J)}var B=He;B.j(C),100>B.h&&(B.h++,C.next=B.g,B.g=C)}Ce=!1};function Se(){this.s=this.s,this.C=this.C}Se.prototype.s=!1,Se.prototype.ma=function(){this.s||(this.s=!0,this.N())},Se.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ae(C,B){this.type=C,this.g=this.target=B,this.defaultPrevented=!1}Ae.prototype.h=function(){this.defaultPrevented=!0};var Ue=function(){if(!E.addEventListener||!Object.defineProperty)return!1;var C=!1,B=Object.defineProperty({},"passive",{get:function(){C=!0}});try{const J=()=>{};E.addEventListener("test",J,B),E.removeEventListener("test",J,B)}catch{}return C}();function ze(C,B){if(Ae.call(this,C?C.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,C){var J=this.type=C.type,fe=C.changedTouches&&C.changedTouches.length?C.changedTouches[0]:null;if(this.target=C.target||C.srcElement,this.g=B,B=C.relatedTarget){if(se){e:{try{de(B.nodeName);var qe=!0;break e}catch{}qe=!1}qe||(B=null)}}else J=="mouseover"?B=C.fromElement:J=="mouseout"&&(B=C.toElement);this.relatedTarget=B,fe?(this.clientX=fe.clientX!==void 0?fe.clientX:fe.pageX,this.clientY=fe.clientY!==void 0?fe.clientY:fe.pageY,this.screenX=fe.screenX||0,this.screenY=fe.screenY||0):(this.clientX=C.clientX!==void 0?C.clientX:C.pageX,this.clientY=C.clientY!==void 0?C.clientY:C.pageY,this.screenX=C.screenX||0,this.screenY=C.screenY||0),this.button=C.button,this.key=C.key||"",this.ctrlKey=C.ctrlKey,this.altKey=C.altKey,this.shiftKey=C.shiftKey,this.metaKey=C.metaKey,this.pointerId=C.pointerId||0,this.pointerType=typeof C.pointerType=="string"?C.pointerType:et[C.pointerType]||"",this.state=C.state,this.i=C,C.defaultPrevented&&ze.aa.h.call(this)}}j(ze,Ae);var et={2:"touch",3:"pen",4:"mouse"};ze.prototype.h=function(){ze.aa.h.call(this);var C=this.i;C.preventDefault?C.preventDefault():C.returnValue=!1};var nt="closure_listenable_"+(1e6*Math.random()|0),dt=0;function Xe(C,B,J,fe,qe){this.listener=C,this.proxy=null,this.src=B,this.type=J,this.capture=!!fe,this.ha=qe,this.key=++dt,this.da=this.fa=!1}function Ct(C){C.da=!0,C.listener=null,C.proxy=null,C.src=null,C.ha=null}function dn(C){this.src=C,this.g={},this.h=0}dn.prototype.add=function(C,B,J,fe,qe){var at=C.toString();C=this.g[at],C||(C=this.g[at]=[],this.h++);var Lt=ln(C,B,fe,qe);return-1<Lt?(B=C[Lt],J||(B.fa=!1)):(B=new Xe(B,this.src,at,!!fe,qe),B.fa=J,C.push(B)),B};function Ut(C,B){var J=B.type;if(J in C.g){var fe=C.g[J],qe=Array.prototype.indexOf.call(fe,B,void 0),at;(at=0<=qe)&&Array.prototype.splice.call(fe,qe,1),at&&(Ct(B),C.g[J].length==0&&(delete C.g[J],C.h--))}}function ln(C,B,J,fe){for(var qe=0;qe<C.length;++qe){var at=C[qe];if(!at.da&&at.listener==B&&at.capture==!!J&&at.ha==fe)return qe}return-1}var Ln="closure_lm_"+(1e6*Math.random()|0),qt={};function Yn(C,B,J,fe,qe){if(Array.isArray(B)){for(var at=0;at<B.length;at++)Yn(C,B[at],J,fe,qe);return null}return J=Yt(J),C&&C[nt]?C.K(B,J,T(fe)?!!fe.capture:!1,qe):$t(C,B,J,!1,fe,qe)}function $t(C,B,J,fe,qe,at){if(!B)throw Error("Invalid event type");var Lt=T(qe)?!!qe.capture:!!qe,Gr=Ge(C);if(Gr||(C[Ln]=Gr=new dn(C)),J=Gr.add(B,J,fe,Lt,at),J.proxy)return J;if(fe=Re(),J.proxy=fe,fe.src=C,fe.listener=J,C.addEventListener)Ue||(qe=Lt),qe===void 0&&(qe=!1),C.addEventListener(B.toString(),fe,qe);else if(C.attachEvent)C.attachEvent(_t(B.toString()),fe);else if(C.addListener&&C.removeListener)C.addListener(fe);else throw Error("addEventListener and attachEvent are unavailable.");return J}function Re(){function C(J){return B.call(C.src,C.listener,J)}const B=yt;return C}function Fe(C,B,J,fe,qe){if(Array.isArray(B))for(var at=0;at<B.length;at++)Fe(C,B[at],J,fe,qe);else fe=T(fe)?!!fe.capture:!!fe,J=Yt(J),C&&C[nt]?(C=C.i,B=String(B).toString(),B in C.g&&(at=C.g[B],J=ln(at,J,fe,qe),-1<J&&(Ct(at[J]),Array.prototype.splice.call(at,J,1),at.length==0&&(delete C.g[B],C.h--)))):C&&(C=Ge(C))&&(B=C.g[B.toString()],C=-1,B&&(C=ln(B,J,fe,qe)),(J=-1<C?B[C]:null)&&Ke(J))}function Ke(C){if(typeof C!="number"&&C&&!C.da){var B=C.src;if(B&&B[nt])Ut(B.i,C);else{var J=C.type,fe=C.proxy;B.removeEventListener?B.removeEventListener(J,fe,C.capture):B.detachEvent?B.detachEvent(_t(J),fe):B.addListener&&B.removeListener&&B.removeListener(fe),(J=Ge(B))?(Ut(J,C),J.h==0&&(J.src=null,B[Ln]=null)):Ct(C)}}}function _t(C){return C in qt?qt[C]:qt[C]="on"+C}function yt(C,B){if(C.da)C=!0;else{B=new ze(B,this);var J=C.listener,fe=C.ha||C.src;C.fa&&Ke(C),C=J.call(fe,B)}return C}function Ge(C){return C=C[Ln],C instanceof dn?C:null}var Pt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Yt(C){return typeof C=="function"?C:(C[Pt]||(C[Pt]=function(B){return C.handleEvent(B)}),C[Pt])}function hn(){Se.call(this),this.i=new dn(this),this.M=this,this.F=null}j(hn,Se),hn.prototype[nt]=!0,hn.prototype.removeEventListener=function(C,B,J,fe){Fe(this,C,B,J,fe)};function an(C,B){var J,fe=C.F;if(fe)for(J=[];fe;fe=fe.F)J.push(fe);if(C=C.M,fe=B.type||B,typeof B=="string")B=new Ae(B,C);else if(B instanceof Ae)B.target=B.target||C;else{var qe=B;B=new Ae(fe,C),oe(B,qe)}if(qe=!0,J)for(var at=J.length-1;0<=at;at--){var Lt=B.g=J[at];qe=ir(Lt,fe,!0,B)&&qe}if(Lt=B.g=C,qe=ir(Lt,fe,!0,B)&&qe,qe=ir(Lt,fe,!1,B)&&qe,J)for(at=0;at<J.length;at++)Lt=B.g=J[at],qe=ir(Lt,fe,!1,B)&&qe}hn.prototype.N=function(){if(hn.aa.N.call(this),this.i){var C=this.i,B;for(B in C.g){for(var J=C.g[B],fe=0;fe<J.length;fe++)Ct(J[fe]);delete C.g[B],C.h--}}this.F=null},hn.prototype.K=function(C,B,J,fe){return this.i.add(String(C),B,!1,J,fe)},hn.prototype.L=function(C,B,J,fe){return this.i.add(String(C),B,!0,J,fe)};function ir(C,B,J,fe){if(B=C.i.g[String(B)],!B)return!0;B=B.concat();for(var qe=!0,at=0;at<B.length;++at){var Lt=B[at];if(Lt&&!Lt.da&&Lt.capture==J){var Gr=Lt.listener,ii=Lt.ha||Lt.src;Lt.fa&&Ut(C.i,Lt),qe=Gr.call(ii,fe)!==!1&&qe}}return qe&&!fe.defaultPrevented}function na(C,B,J){if(typeof C=="function")J&&(C=N(C,J));else if(C&&typeof C.handleEvent=="function")C=N(C.handleEvent,C);else throw Error("Invalid listener argument");return 2147483647<Number(B)?-1:E.setTimeout(C,B||0)}function Vt(C){C.g=na(()=>{C.g=null,C.i&&(C.i=!1,Vt(C))},C.l);const B=C.h;C.h=null,C.m.apply(null,B)}class sn extends Se{constructor(B,J){super(),this.m=B,this.l=J,this.h=null,this.i=!1,this.g=null}j(B){this.h=arguments,this.g?this.i=!0:Vt(this)}N(){super.N(),this.g&&(E.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function wi(C){Se.call(this),this.h=C,this.g={}}j(wi,Se);var di=[];function yi(C){ge(C.g,function(B,J){this.g.hasOwnProperty(J)&&Ke(B)},C),C.g={}}wi.prototype.N=function(){wi.aa.N.call(this),yi(this)},wi.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ur=E.JSON.stringify,Da=E.JSON.parse,Zc=class{stringify(C){return E.JSON.stringify(C,void 0)}parse(C){return E.JSON.parse(C,void 0)}};function so(){}so.prototype.h=null;function oo(C){return C.h||(C.h=C.i())}function kl(){}var xs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function sc(){Ae.call(this,"d")}j(sc,Ae);function ra(){Ae.call(this,"c")}j(ra,Ae);var oc={},el=null;function Ou(){return el=el||new hn}oc.La="serverreachability";function ac(C){Ae.call(this,oc.La,C)}j(ac,Ae);function tl(C){const B=Ou();an(B,new ac(B))}oc.STAT_EVENT="statevent";function wo(C,B){Ae.call(this,oc.STAT_EVENT,C),this.stat=B}j(wo,Ae);function Pi(C){const B=Ou();an(B,new wo(B,C))}oc.Ma="timingevent";function as(C,B){Ae.call(this,oc.Ma,C),this.size=B}j(as,Ae);function La(C,B){if(typeof C!="function")throw Error("Fn must not be null and must be a function");return E.setTimeout(function(){C()},B)}function ku(){this.g=!0}ku.prototype.xa=function(){this.g=!1};function cc(C,B,J,fe,qe,at){C.info(function(){if(C.g)if(at)for(var Lt="",Gr=at.split("&"),ii=0;ii<Gr.length;ii++){var _r=Gr[ii].split("=");if(1<_r.length){var Us=_r[0];_r=_r[1];var ls=Us.split("_");Lt=2<=ls.length&&ls[1]=="type"?Lt+(Us+"="+_r+"&"):Lt+(Us+"=redacted&")}}else Lt=null;else Lt=at;return"XMLHTTP REQ ("+fe+") [attempt "+qe+"]: "+B+`
`+J+`
`+Lt})}function ia(C,B,J,fe,qe,at,Lt){C.info(function(){return"XMLHTTP RESP ("+fe+") [ attempt "+qe+"]: "+B+`
`+J+`
`+at+" "+Lt})}function sa(C,B,J,fe){C.info(function(){return"XMLHTTP TEXT ("+B+"): "+Rg(C,J)+(fe?" "+fe:"")})}function Od(C,B){C.info(function(){return"TIMEOUT: "+B})}ku.prototype.info=function(){};function Rg(C,B){if(!C.g)return B;if(!B)return null;try{var J=JSON.parse(B);if(J){for(C=0;C<J.length;C++)if(Array.isArray(J[C])){var fe=J[C];if(!(2>fe.length)){var qe=fe[1];if(Array.isArray(qe)&&!(1>qe.length)){var at=qe[0];if(at!="noop"&&at!="stop"&&at!="close")for(var Lt=1;Lt<qe.length;Lt++)qe[Lt]=""}}}}return ur(J)}catch{return B}}var Nu={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},tp={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ms;function Du(){}j(Du,so),Du.prototype.g=function(){return new XMLHttpRequest},Du.prototype.i=function(){return{}},Ms=new Du;function oa(C,B,J,fe){this.j=C,this.i=B,this.l=J,this.R=fe||1,this.U=new wi(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new kd}function kd(){this.i=null,this.g="",this.h=!1}var Nd={},xa={};function Dd(C,B,J){C.L=1,C.v=Ua(Co(B)),C.m=J,C.P=!0,Lu(C,null)}function Lu(C,B){C.F=Date.now(),Fr(C),C.A=Co(C.v);var J=C.A,fe=C.R;Array.isArray(fe)||(fe=[String(fe)]),Ul(J.i,"t",fe),C.C=0,J=C.j.J,C.h=new kd,C.g=ME(C.j,J?B:null,!C.m),0<C.O&&(C.M=new sn(N(C.Y,C,C.g),C.O)),B=C.U,J=C.g,fe=C.ca;var qe="readystatechange";Array.isArray(qe)||(qe&&(di[0]=qe.toString()),qe=di);for(var at=0;at<qe.length;at++){var Lt=Yn(J,qe[at],fe||B.handleEvent,!1,B.h||B);if(!Lt)break;B.g[Lt.key]=Lt}B=C.H?Q(C.H):{},C.m?(C.u||(C.u="POST"),B["Content-Type"]="application/x-www-form-urlencoded",C.g.ea(C.A,C.u,C.m,B)):(C.u="GET",C.g.ea(C.A,C.u,null,B)),tl(),cc(C.i,C.u,C.A,C.l,C.R,C.m)}oa.prototype.ca=function(C){C=C.target;const B=this.M;B&&pi(C)==3?B.j():this.Y(C)},oa.prototype.Y=function(C){try{if(C==this.g)e:{const ls=pi(this.g);var B=this.g.Ba();const Va=this.g.Z();if(!(3>ls)&&(ls!=3||this.g&&(this.h.h||this.g.oa()||Rs(this.g)))){this.J||ls!=4||B==7||(B==8||0>=Va?tl(3):tl(2)),lc(this);var J=this.g.Z();this.X=J;t:if(Ro(this)){var fe=Rs(this.g);C="";var qe=fe.length,at=pi(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){aa(this),nl(this);var Lt="";break t}this.h.i=new E.TextDecoder}for(B=0;B<qe;B++)this.h.h=!0,C+=this.h.i.decode(fe[B],{stream:!(at&&B==qe-1)});fe.length=0,this.h.g+=C,this.C=0,Lt=this.h.g}else Lt=this.g.oa();if(this.o=J==200,ia(this.i,this.u,this.A,this.l,this.R,ls,J),this.o){if(this.T&&!this.K){t:{if(this.g){var Gr,ii=this.g;if((Gr=ii.g?ii.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(Gr)){var _r=Gr;break t}}_r=null}if(J=_r)sa(this.i,this.l,J,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,np(this,J);else{this.o=!1,this.s=3,Pi(12),aa(this),nl(this);break e}}if(this.P){J=!0;let Mo;for(;!this.J&&this.C<Lt.length;)if(Mo=Ld(this,Lt),Mo==xa){ls==4&&(this.s=4,Pi(14),J=!1),sa(this.i,this.l,null,"[Incomplete Response]");break}else if(Mo==Nd){this.s=4,Pi(15),sa(this.i,this.l,Lt,"[Invalid Chunk]"),J=!1;break}else sa(this.i,this.l,Mo,null),np(this,Mo);if(Ro(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),ls!=4||Lt.length!=0||this.h.h||(this.s=1,Pi(16),J=!1),this.o=this.o&&J,!J)sa(this.i,this.l,Lt,"[Invalid Chunked Response]"),aa(this),nl(this);else if(0<Lt.length&&!this.W){this.W=!0;var Us=this.j;Us.g==this&&Us.ba&&!Us.M&&(Us.j.info("Great, no buffering proxy detected. Bytes received: "+Lt.length),Ig(Us),Us.M=!0,Pi(11))}}else sa(this.i,this.l,Lt,null),np(this,Lt);ls==4&&aa(this),this.o&&!this.J&&(ls==4?jf(this.j,this):(this.o=!1,Fr(this)))}else No(this.g),J==400&&0<Lt.indexOf("Unknown SID")?(this.s=3,Pi(12)):(this.s=0,Pi(13)),aa(this),nl(this)}}}catch{}finally{}};function Ro(C){return C.g?C.u=="GET"&&C.L!=2&&C.j.Ca:!1}function Ld(C,B){var J=C.C,fe=B.indexOf(`
`,J);return fe==-1?xa:(J=Number(B.substring(J,fe)),isNaN(J)?Nd:(fe+=1,fe+J>B.length?xa:(B=B.slice(fe,fe+J),C.C=fe+J,B)))}oa.prototype.cancel=function(){this.J=!0,aa(this)};function Fr(C){C.S=Date.now()+C.I,hi(C,C.I)}function hi(C,B){if(C.B!=null)throw Error("WatchDog timer not null");C.B=La(N(C.ba,C),B)}function lc(C){C.B&&(E.clearTimeout(C.B),C.B=null)}oa.prototype.ba=function(){this.B=null;const C=Date.now();0<=C-this.S?(Od(this.i,this.A),this.L!=2&&(tl(),Pi(17)),aa(this),this.s=2,nl(this)):hi(this,this.S-C)};function nl(C){C.j.G==0||C.J||jf(C.j,C)}function aa(C){lc(C);var B=C.M;B&&typeof B.ma=="function"&&B.ma(),C.M=null,yi(C.U),C.g&&(B=C.g,C.g=null,B.abort(),B.ma())}function np(C,B){try{var J=C.j;if(J.G!=0&&(J.g==C||Hs(J.h,C))){if(!C.K&&Hs(J.h,C)&&J.G==3){try{var fe=J.Da.g.parse(B)}catch{fe=null}if(Array.isArray(fe)&&fe.length==3){var qe=fe;if(qe[0]==0){e:if(!J.u){if(J.g)if(J.g.F+3e3<C.F)Ff(J),al(J);else break e;Vf(J),Pi(18)}}else J.za=qe[1],0<J.za-J.T&&37500>qe[2]&&J.F&&J.v==0&&!J.C&&(J.C=La(N(J.Za,J),6e3));if(1>=Nf(J.h)&&J.ca){try{J.ca()}catch{}J.ca=void 0}}else Bu(J,11)}else if((C.K||J.g==C)&&Ff(J),!K(B))for(qe=J.Da.g.parse(B),B=0;B<qe.length;B++){let _r=qe[B];if(J.T=_r[0],_r=_r[1],J.G==2)if(_r[0]=="c"){J.K=_r[1],J.ia=_r[2];const Us=_r[3];Us!=null&&(J.la=Us,J.j.info("VER="+J.la));const ls=_r[4];ls!=null&&(J.Aa=ls,J.j.info("SVER="+J.Aa));const Va=_r[5];Va!=null&&typeof Va=="number"&&0<Va&&(fe=1.5*Va,J.L=fe,J.j.info("backChannelRequestTimeoutMs_="+fe)),fe=J;const Mo=C.g;if(Mo){const ap=Mo.g?Mo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ap){var at=fe.h;at.g||ap.indexOf("spdy")==-1&&ap.indexOf("quic")==-1&&ap.indexOf("h2")==-1||(at.j=at.l,at.g=new Set,at.h&&(rp(at,at.h),at.h=null))}if(fe.D){const Wf=Mo.g?Mo.g.getResponseHeader("X-HTTP-Session-Id"):null;Wf&&(fe.ya=Wf,zr(fe.I,fe.D,Wf))}}J.G=3,J.l&&J.l.ua(),J.ba&&(J.R=Date.now()-C.F,J.j.info("Handshake RTT: "+J.R+"ms")),fe=J;var Lt=C;if(fe.qa=Ag(fe,fe.J?fe.ia:null,fe.W),Lt.K){rl(fe.h,Lt);var Gr=Lt,ii=fe.L;ii&&(Gr.I=ii),Gr.B&&(lc(Gr),Fr(Gr)),fe.g=Lt}else Fl(fe);0<J.i.length&&hc(J)}else _r[0]!="stop"&&_r[0]!="close"||Bu(J,7);else J.G==3&&(_r[0]=="stop"||_r[0]=="close"?_r[0]=="stop"?Bu(J,7):zi(J):_r[0]!="noop"&&J.l&&J.l.ta(_r),J.v=0)}}tl(4)}catch{}}var xd=class{constructor(C,B){this.g=C,this.map=B}};function Nl(C){this.l=C||10,E.PerformanceNavigationTiming?(C=E.performance.getEntriesByType("navigation"),C=0<C.length&&(C[0].nextHopProtocol=="hq"||C[0].nextHopProtocol=="h2")):C=!!(E.chrome&&E.chrome.loadTimes&&E.chrome.loadTimes()&&E.chrome.loadTimes().wasFetchedViaSpdy),this.j=C?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ao(C){return C.h?!0:C.g?C.g.size>=C.j:!1}function Nf(C){return C.h?1:C.g?C.g.size:0}function Hs(C,B){return C.h?C.h==B:C.g?C.g.has(B):!1}function rp(C,B){C.g?C.g.add(B):C.h=B}function rl(C,B){C.h&&C.h==B?C.h=null:C.g&&C.g.has(B)&&C.g.delete(B)}Nl.prototype.cancel=function(){if(this.i=Md(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const C of this.g.values())C.cancel();this.g.clear()}};function Md(C){if(C.h!=null)return C.i.concat(C.h.D);if(C.g!=null&&C.g.size!==0){let B=C.i;for(const J of C.g.values())B=B.concat(J.D);return B}return G(C.i)}function Ud(C){if(C.V&&typeof C.V=="function")return C.V();if(typeof Map<"u"&&C instanceof Map||typeof Set<"u"&&C instanceof Set)return Array.from(C.values());if(typeof C=="string")return C.split("");if(v(C)){for(var B=[],J=C.length,fe=0;fe<J;fe++)B.push(C[fe]);return B}B=[],J=0;for(fe in C)B[J++]=C[fe];return B}function dr(C){if(C.na&&typeof C.na=="function")return C.na();if(!C.V||typeof C.V!="function"){if(typeof Map<"u"&&C instanceof Map)return Array.from(C.keys());if(!(typeof Set<"u"&&C instanceof Set)){if(v(C)||typeof C=="string"){var B=[];C=C.length;for(var J=0;J<C;J++)B.push(J);return B}B=[],J=0;for(const fe in C)B[J++]=fe;return B}}}function Dl(C,B){if(C.forEach&&typeof C.forEach=="function")C.forEach(B,void 0);else if(v(C)||typeof C=="string")Array.prototype.forEach.call(C,B,void 0);else for(var J=dr(C),fe=Ud(C),qe=fe.length,at=0;at<qe;at++)B.call(void 0,fe[at],J&&J[at],C)}var Ll=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function xu(C,B){if(C){C=C.split("&");for(var J=0;J<C.length;J++){var fe=C[J].indexOf("="),qe=null;if(0<=fe){var at=C[J].substring(0,fe);qe=C[J].substring(fe+1)}else at=C[J];B(at,qe?decodeURIComponent(qe.replace(/\+/g," ")):"")}}}function Ma(C){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,C instanceof Ma){this.h=C.h,Mu(this,C.j),this.o=C.o,this.g=C.g,il(this,C.s),this.l=C.l;var B=C.i,J=new Io;J.i=B.i,B.g&&(J.g=new Map(B.g),J.h=B.h),xl(this,J),this.m=C.m}else C&&(B=String(C).match(Ll))?(this.h=!1,Mu(this,B[1]||"",!0),this.o=nr(B[2]||""),this.g=nr(B[3]||"",!0),il(this,B[4]),this.l=nr(B[5]||"",!0),xl(this,B[6]||"",!0),this.m=nr(B[7]||"")):(this.h=!1,this.i=new Io(null,this.h))}Ma.prototype.toString=function(){var C=[],B=this.j;B&&C.push(uc(B,Ml,!0),":");var J=this.g;return(J||B=="file")&&(C.push("//"),(B=this.o)&&C.push(uc(B,Ml,!0),"@"),C.push(encodeURIComponent(String(J)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),J=this.s,J!=null&&C.push(":",String(J))),(J=this.l)&&(this.g&&J.charAt(0)!="/"&&C.push("/"),C.push(uc(J,J.charAt(0)=="/"?ip:Vd,!0))),(J=this.i.toString())&&C.push("?",J),(J=this.m)&&C.push("#",uc(J,sp)),C.join("")};function Co(C){return new Ma(C)}function Mu(C,B,J){C.j=J?nr(B,!0):B,C.j&&(C.j=C.j.replace(/:$/,""))}function il(C,B){if(B){if(B=Number(B),isNaN(B)||0>B)throw Error("Bad port number "+B);C.s=B}else C.s=null}function xl(C,B,J){B instanceof Io?(C.i=B,ko(C.i,C.h)):(J||(B=uc(B,Lf)),C.i=new Io(B,C.h))}function zr(C,B,J){C.i.set(B,J)}function Ua(C){return zr(C,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),C}function nr(C,B){return C?B?decodeURI(C.replace(/%25/g,"%2525")):decodeURIComponent(C):""}function uc(C,B,J){return typeof C=="string"?(C=encodeURI(C).replace(B,Df),J&&(C=C.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),C):null}function Df(C){return C=C.charCodeAt(0),"%"+(C>>4&15).toString(16)+(C&15).toString(16)}var Ml=/[#\/\?@]/g,Vd=/[#\?:]/g,ip=/[#\?]/g,Lf=/[#\?@]/g,sp=/#/g;function Io(C,B){this.h=this.g=null,this.i=C||null,this.j=!!B}function Qi(C){C.g||(C.g=new Map,C.h=0,C.i&&xu(C.i,function(B,J){C.add(decodeURIComponent(B.replace(/\+/g," ")),J)}))}r=Io.prototype,r.add=function(C,B){Qi(this),this.i=null,C=Oo(this,C);var J=this.g.get(C);return J||this.g.set(C,J=[]),J.push(B),this.h+=1,this};function Ao(C,B){Qi(C),B=Oo(C,B),C.g.has(B)&&(C.i=null,C.h-=C.g.get(B).length,C.g.delete(B))}function Po(C,B){return Qi(C),B=Oo(C,B),C.g.has(B)}r.forEach=function(C,B){Qi(this),this.g.forEach(function(J,fe){J.forEach(function(qe){C.call(B,qe,fe,this)},this)},this)},r.na=function(){Qi(this);const C=Array.from(this.g.values()),B=Array.from(this.g.keys()),J=[];for(let fe=0;fe<B.length;fe++){const qe=C[fe];for(let at=0;at<qe.length;at++)J.push(B[fe])}return J},r.V=function(C){Qi(this);let B=[];if(typeof C=="string")Po(this,C)&&(B=B.concat(this.g.get(Oo(this,C))));else{C=Array.from(this.g.values());for(let J=0;J<C.length;J++)B=B.concat(C[J])}return B},r.set=function(C,B){return Qi(this),this.i=null,C=Oo(this,C),Po(this,C)&&(this.h-=this.g.get(C).length),this.g.set(C,[B]),this.h+=1,this},r.get=function(C,B){return C?(C=this.V(C),0<C.length?String(C[0]):B):B};function Ul(C,B,J){Ao(C,B),0<J.length&&(C.i=null,C.g.set(Oo(C,B),G(J)),C.h+=J.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const C=[],B=Array.from(this.g.keys());for(var J=0;J<B.length;J++){var fe=B[J];const at=encodeURIComponent(String(fe)),Lt=this.V(fe);for(fe=0;fe<Lt.length;fe++){var qe=at;Lt[fe]!==""&&(qe+="="+encodeURIComponent(String(Lt[fe]))),C.push(qe)}}return this.i=C.join("&")};function Oo(C,B){return B=String(B),C.j&&(B=B.toLowerCase()),B}function ko(C,B){B&&!C.j&&(Qi(C),C.i=null,C.g.forEach(function(J,fe){var qe=fe.toLowerCase();fe!=qe&&(Ao(this,fe),Ul(this,qe,J))},C)),C.j=B}function xf(C,B){const J=new ku;if(E.Image){const fe=new Image;fe.onload=F(cs,J,"TestLoadImage: loaded",!0,B,fe),fe.onerror=F(cs,J,"TestLoadImage: error",!1,B,fe),fe.onabort=F(cs,J,"TestLoadImage: abort",!1,B,fe),fe.ontimeout=F(cs,J,"TestLoadImage: timeout",!1,B,fe),E.setTimeout(function(){fe.ontimeout&&fe.ontimeout()},1e4),fe.src=C}else B(!1)}function dc(C,B){const J=new ku,fe=new AbortController,qe=setTimeout(()=>{fe.abort(),cs(J,"TestPingServer: timeout",!1,B)},1e4);fetch(C,{signal:fe.signal}).then(at=>{clearTimeout(qe),at.ok?cs(J,"TestPingServer: ok",!0,B):cs(J,"TestPingServer: server error",!1,B)}).catch(()=>{clearTimeout(qe),cs(J,"TestPingServer: error",!1,B)})}function cs(C,B,J,fe,qe){try{qe&&(qe.onload=null,qe.onerror=null,qe.onabort=null,qe.ontimeout=null),fe(J)}catch{}}function Uu(){this.g=new Zc}function op(C,B,J){const fe=J||"";try{Dl(C,function(qe,at){let Lt=qe;T(qe)&&(Lt=ur(qe)),B.push(fe+at+"="+encodeURIComponent(Lt))})}catch(qe){throw B.push(fe+"type="+encodeURIComponent("_badmap")),qe}}function sl(C){this.l=C.Ub||null,this.j=C.eb||!1}j(sl,so),sl.prototype.g=function(){return new Vl(this.l,this.j)},sl.prototype.i=function(C){return function(){return C}}({});function Vl(C,B){hn.call(this),this.D=C,this.o=B,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}j(Vl,hn),r=Vl.prototype,r.open=function(C,B){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=C,this.A=B,this.readyState=1,la(this)},r.send=function(C){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const B={headers:this.u,method:this.B,credentials:this.m,cache:void 0};C&&(B.body=C),(this.D||E).fetch(new Request(this.A,B)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ca(this)),this.readyState=0},r.Sa=function(C){if(this.g&&(this.l=C,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=C.headers,this.readyState=2,la(this)),this.g&&(this.readyState=3,la(this),this.g)))if(this.responseType==="arraybuffer")C.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof E.ReadableStream<"u"&&"body"in C){if(this.j=C.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Mf(this)}else C.text().then(this.Ra.bind(this),this.ga.bind(this))};function Mf(C){C.j.read().then(C.Pa.bind(C)).catch(C.ga.bind(C))}r.Pa=function(C){if(this.g){if(this.o&&C.value)this.response.push(C.value);else if(!this.o){var B=C.value?C.value:new Uint8Array(0);(B=this.v.decode(B,{stream:!C.done}))&&(this.response=this.responseText+=B)}C.done?ca(this):la(this),this.readyState==3&&Mf(this)}},r.Ra=function(C){this.g&&(this.response=this.responseText=C,ca(this))},r.Qa=function(C){this.g&&(this.response=C,ca(this))},r.ga=function(){this.g&&ca(this)};function ca(C){C.readyState=4,C.l=null,C.j=null,C.v=null,la(C)}r.setRequestHeader=function(C,B){this.u.append(C,B)},r.getResponseHeader=function(C){return this.h&&this.h.get(C.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const C=[],B=this.h.entries();for(var J=B.next();!J.done;)J=J.value,C.push(J[0]+": "+J[1]),J=B.next();return C.join(`\r
`)};function la(C){C.onreadystatechange&&C.onreadystatechange.call(C)}Object.defineProperty(Vl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(C){this.m=C?"include":"same-origin"}});function ol(C){let B="";return ge(C,function(J,fe){B+=fe,B+=":",B+=J,B+=`\r
`}),B}function ve(C,B,J){e:{for(fe in J){var fe=!1;break e}fe=!0}fe||(J=ol(J),typeof C=="string"?J!=null&&encodeURIComponent(String(J)):zr(C,B,J))}function De(C){hn.call(this),this.headers=new Map,this.o=C||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}j(De,hn);var tt=/^https?$/i,Ht=["POST","PUT"];r=De.prototype,r.Ha=function(C){this.J=C},r.ea=function(C,B,J,fe){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+C);B=B?B.toUpperCase():"GET",this.D=C,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ms.g(),this.v=this.o?oo(this.o):oo(Ms),this.g.onreadystatechange=N(this.Ea,this);try{this.B=!0,this.g.open(B,String(C),!0),this.B=!1}catch(at){Hn(this,at);return}if(C=J||"",J=new Map(this.headers),fe)if(Object.getPrototypeOf(fe)===Object.prototype)for(var qe in fe)J.set(qe,fe[qe]);else if(typeof fe.keys=="function"&&typeof fe.get=="function")for(const at of fe.keys())J.set(at,fe.get(at));else throw Error("Unknown input type for opt_headers: "+String(fe));fe=Array.from(J.keys()).find(at=>at.toLowerCase()=="content-type"),qe=E.FormData&&C instanceof E.FormData,!(0<=Array.prototype.indexOf.call(Ht,B,void 0))||fe||qe||J.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[at,Lt]of J)this.g.setRequestHeader(at,Lt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{kr(this),this.u=!0,this.g.send(C),this.u=!1}catch(at){Hn(this,at)}};function Hn(C,B){C.h=!1,C.g&&(C.j=!0,C.g.abort(),C.j=!1),C.l=B,C.m=5,gr(C),cn(C)}function gr(C){C.A||(C.A=!0,an(C,"complete"),an(C,"error"))}r.abort=function(C){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=C||7,an(this,"complete"),an(this,"abort"),cn(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),cn(this,!0)),De.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?jr(this):this.bb())},r.bb=function(){jr(this)};function jr(C){if(C.h&&typeof f<"u"&&(!C.v[1]||pi(C)!=4||C.Z()!=2)){if(C.u&&pi(C)==4)na(C.Ea,0,C);else if(an(C,"readystatechange"),pi(C)==4){C.h=!1;try{const Lt=C.Z();e:switch(Lt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var B=!0;break e;default:B=!1}var J;if(!(J=B)){var fe;if(fe=Lt===0){var qe=String(C.D).match(Ll)[1]||null;!qe&&E.self&&E.self.location&&(qe=E.self.location.protocol.slice(0,-1)),fe=!tt.test(qe?qe.toLowerCase():"")}J=fe}if(J)an(C,"complete"),an(C,"success");else{C.m=6;try{var at=2<pi(C)?C.g.statusText:""}catch{at=""}C.l=at+" ["+C.Z()+"]",gr(C)}}finally{cn(C)}}}}function cn(C,B){if(C.g){kr(C);const J=C.g,fe=C.v[0]?()=>{}:null;C.g=null,C.v=null,B||an(C,"ready");try{J.onreadystatechange=fe}catch{}}}function kr(C){C.I&&(E.clearTimeout(C.I),C.I=null)}r.isActive=function(){return!!this.g};function pi(C){return C.g?C.g.readyState:0}r.Z=function(){try{return 2<pi(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(C){if(this.g){var B=this.g.responseText;return C&&B.indexOf(C)==0&&(B=B.substring(C.length)),Da(B)}};function Rs(C){try{if(!C.g)return null;if("response"in C.g)return C.g.response;switch(C.H){case"":case"text":return C.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in C.g)return C.g.mozResponseArrayBuffer}return null}catch{return null}}function No(C){const B={};C=(C.g&&2<=pi(C)&&C.g.getAllResponseHeaders()||"").split(`\r
`);for(let fe=0;fe<C.length;fe++){if(K(C[fe]))continue;var J=pe(C[fe]);const qe=J[0];if(J=J[1],typeof J!="string")continue;J=J.trim();const at=B[qe]||[];B[qe]=at,at.push(J)}Z(B,function(fe){return fe.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Do(C,B,J){return J&&J.internalChannelParams&&J.internalChannelParams[C]||B}function Vu(C){this.Aa=0,this.i=[],this.j=new ku,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Do("failFast",!1,C),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Do("baseRetryDelayMs",5e3,C),this.cb=Do("retryDelaySeedMs",1e4,C),this.Wa=Do("forwardChannelMaxRetries",2,C),this.wa=Do("forwardChannelRequestTimeoutMs",2e4,C),this.pa=C&&C.xmlHttpFactory||void 0,this.Xa=C&&C.Tb||void 0,this.Ca=C&&C.useFetchStreams||!1,this.L=void 0,this.J=C&&C.supportsCrossDomainXhr||!1,this.K="",this.h=new Nl(C&&C.concurrentRequestLimit),this.Da=new Uu,this.P=C&&C.fastHandshake||!1,this.O=C&&C.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=C&&C.Rb||!1,C&&C.xa&&this.j.xa(),C&&C.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&C&&C.detectBufferingProxy||!1,this.ja=void 0,C&&C.longPollingTimeout&&0<C.longPollingTimeout&&(this.ja=C.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Vu.prototype,r.la=8,r.G=1,r.connect=function(C,B,J,fe){Pi(0),this.W=C,this.H=B||{},J&&fe!==void 0&&(this.H.OSID=J,this.H.OAID=fe),this.F=this.X,this.I=Ag(this,null,this.W),hc(this)};function zi(C){if(Fd(C),C.G==3){var B=C.U++,J=Co(C.I);if(zr(J,"SID",C.K),zr(J,"RID",B),zr(J,"TYPE","terminate"),Fu(C,J),B=new oa(C,C.j,B),B.L=2,B.v=Ua(Co(J)),J=!1,E.navigator&&E.navigator.sendBeacon)try{J=E.navigator.sendBeacon(B.v.toString(),"")}catch{}!J&&E.Image&&(new Image().src=B.v,J=!0),J||(B.g=ME(B.j,null),B.g.ea(B.v)),B.F=Date.now(),Fr(B)}Wu(C)}function al(C){C.g&&(Ig(C),C.g.cancel(),C.g=null)}function Fd(C){al(C),C.u&&(E.clearTimeout(C.u),C.u=null),Ff(C),C.h.cancel(),C.s&&(typeof C.s=="number"&&E.clearTimeout(C.s),C.s=null)}function hc(C){if(!ao(C.h)&&!C.s){C.s=!0;var B=C.Ga;we||Ne(),Ce||(we(),Ce=!0),ye.add(B,C),C.B=0}}function Cg(C,B){return Nf(C.h)>=C.h.j-(C.s?1:0)?!1:C.s?(C.i=B.D.concat(C.i),!0):C.G==1||C.G==2||C.B>=(C.Va?0:C.Wa)?!1:(C.s=La(N(C.Ga,C,B),ju(C,C.B)),C.B++,!0)}r.Ga=function(C){if(this.s)if(this.s=null,this.G==1){if(!C){this.U=Math.floor(1e5*Math.random()),C=this.U++;const qe=new oa(this,this.j,C);let at=this.o;if(this.S&&(at?(at=Q(at),oe(at,this.S)):at=this.S),this.m!==null||this.O||(qe.H=at,at=null),this.P)e:{for(var B=0,J=0;J<this.i.length;J++){t:{var fe=this.i[J];if("__data__"in fe.map&&(fe=fe.map.__data__,typeof fe=="string")){fe=fe.length;break t}fe=void 0}if(fe===void 0)break;if(B+=fe,4096<B){B=J;break e}if(B===4096||J===this.i.length-1){B=J+1;break e}}B=1e3}else B=1e3;B=Lo(this,qe,B),J=Co(this.I),zr(J,"RID",C),zr(J,"CVER",22),this.D&&zr(J,"X-HTTP-Session-Id",this.D),Fu(this,J),at&&(this.O?B="headers="+encodeURIComponent(String(ol(at)))+"&"+B:this.m&&ve(J,this.m,at)),rp(this.h,qe),this.Ua&&zr(J,"TYPE","init"),this.P?(zr(J,"$req",B),zr(J,"SID","null"),qe.T=!0,Dd(qe,J,null)):Dd(qe,J,B),this.G=2}}else this.G==3&&(C?Uf(this,C):this.i.length==0||ao(this.h)||Uf(this))};function Uf(C,B){var J;B?J=B.l:J=C.U++;const fe=Co(C.I);zr(fe,"SID",C.K),zr(fe,"RID",J),zr(fe,"AID",C.T),Fu(C,fe),C.m&&C.o&&ve(fe,C.m,C.o),J=new oa(C,C.j,J,C.B+1),C.m===null&&(J.H=C.o),B&&(C.i=B.D.concat(C.i)),B=Lo(C,J,1e3),J.I=Math.round(.5*C.wa)+Math.round(.5*C.wa*Math.random()),rp(C.h,J),Dd(J,fe,B)}function Fu(C,B){C.H&&ge(C.H,function(J,fe){zr(B,fe,J)}),C.l&&Dl({},function(J,fe){zr(B,fe,J)})}function Lo(C,B,J){J=Math.min(C.i.length,J);var fe=C.l?N(C.l.Na,C.l,C):null;e:{var qe=C.i;let at=-1;for(;;){const Lt=["count="+J];at==-1?0<J?(at=qe[0].g,Lt.push("ofs="+at)):at=0:Lt.push("ofs="+at);let Gr=!0;for(let ii=0;ii<J;ii++){let _r=qe[ii].g;const Us=qe[ii].map;if(_r-=at,0>_r)at=Math.max(0,qe[ii].g-100),Gr=!1;else try{op(Us,Lt,"req"+_r+"_")}catch{fe&&fe(Us)}}if(Gr){fe=Lt.join("&");break e}}}return C=C.i.splice(0,J),B.D=C,fe}function Fl(C){if(!C.g&&!C.u){C.Y=1;var B=C.Fa;we||Ne(),Ce||(we(),Ce=!0),ye.add(B,C),C.v=0}}function Vf(C){return C.g||C.u||3<=C.v?!1:(C.Y++,C.u=La(N(C.Fa,C),ju(C,C.v)),C.v++,!0)}r.Fa=function(){if(this.u=null,xE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var C=2*this.R;this.j.info("BP detection timer enabled: "+C),this.A=La(N(this.ab,this),C)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Pi(10),al(this),xE(this))};function Ig(C){C.A!=null&&(E.clearTimeout(C.A),C.A=null)}function xE(C){C.g=new oa(C,C.j,"rpc",C.Y),C.m===null&&(C.g.H=C.o),C.g.O=0;var B=Co(C.qa);zr(B,"RID","rpc"),zr(B,"SID",C.K),zr(B,"AID",C.T),zr(B,"CI",C.F?"0":"1"),!C.F&&C.ja&&zr(B,"TO",C.ja),zr(B,"TYPE","xmlhttp"),Fu(C,B),C.m&&C.o&&ve(B,C.m,C.o),C.L&&(C.g.I=C.L);var J=C.g;C=C.ia,J.L=1,J.v=Ua(Co(B)),J.m=null,J.P=!0,Lu(J,C)}r.Za=function(){this.C!=null&&(this.C=null,al(this),Vf(this),Pi(19))};function Ff(C){C.C!=null&&(E.clearTimeout(C.C),C.C=null)}function jf(C,B){var J=null;if(C.g==B){Ff(C),Ig(C),C.g=null;var fe=2}else if(Hs(C.h,B))J=B.D,rl(C.h,B),fe=1;else return;if(C.G!=0){if(B.o)if(fe==1){J=B.m?B.m.length:0,B=Date.now()-B.F;var qe=C.B;fe=Ou(),an(fe,new as(fe,J)),hc(C)}else Fl(C);else if(qe=B.s,qe==3||qe==0&&0<B.X||!(fe==1&&Cg(C,B)||fe==2&&Vf(C)))switch(J&&0<J.length&&(B=C.h,B.i=B.i.concat(J)),qe){case 1:Bu(C,5);break;case 4:Bu(C,10);break;case 3:Bu(C,6);break;default:Bu(C,2)}}}function ju(C,B){let J=C.Ta+Math.floor(Math.random()*C.cb);return C.isActive()||(J*=2),J*B}function Bu(C,B){if(C.j.info("Error code "+B),B==2){var J=N(C.fb,C),fe=C.Xa;const qe=!fe;fe=new Ma(fe||"//www.google.com/images/cleardot.gif"),E.location&&E.location.protocol=="http"||Mu(fe,"https"),Ua(fe),qe?xf(fe.toString(),J):dc(fe.toString(),J)}else Pi(2);C.G=0,C.l&&C.l.sa(B),Wu(C),Fd(C)}r.fb=function(C){C?(this.j.info("Successfully pinged google.com"),Pi(2)):(this.j.info("Failed to ping google.com"),Pi(1))};function Wu(C){if(C.G=0,C.ka=[],C.l){const B=Md(C.h);(B.length!=0||C.i.length!=0)&&(H(C.ka,B),H(C.ka,C.i),C.h.i.length=0,G(C.i),C.i.length=0),C.l.ra()}}function Ag(C,B,J){var fe=J instanceof Ma?Co(J):new Ma(J);if(fe.g!="")B&&(fe.g=B+"."+fe.g),il(fe,fe.s);else{var qe=E.location;fe=qe.protocol,B=B?B+"."+qe.hostname:qe.hostname,qe=+qe.port;var at=new Ma(null);fe&&Mu(at,fe),B&&(at.g=B),qe&&il(at,qe),J&&(at.l=J),fe=at}return J=C.D,B=C.ya,J&&B&&zr(fe,J,B),zr(fe,"VER",C.la),Fu(C,fe),fe}function ME(C,B,J){if(B&&!C.J)throw Error("Can't create secondary domain capable XhrIo object.");return B=C.Ca&&!C.pa?new De(new sl({eb:J})):new De(C.pa),B.Ha(C.J),B}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function xn(){}r=xn.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function Bf(){}Bf.prototype.g=function(C,B){return new xo(C,B)};function xo(C,B){hn.call(this),this.g=new Vu(B),this.l=C,this.h=B&&B.messageUrlParams||null,C=B&&B.messageHeaders||null,B&&B.clientProtocolHeaderRequired&&(C?C["X-Client-Protocol"]="webchannel":C={"X-Client-Protocol":"webchannel"}),this.g.o=C,C=B&&B.initMessageHeaders||null,B&&B.messageContentType&&(C?C["X-WebChannel-Content-Type"]=B.messageContentType:C={"X-WebChannel-Content-Type":B.messageContentType}),B&&B.va&&(C?C["X-WebChannel-Client-Profile"]=B.va:C={"X-WebChannel-Client-Profile":B.va}),this.g.S=C,(C=B&&B.Sb)&&!K(C)&&(this.g.m=C),this.v=B&&B.supportsCrossDomainXhr||!1,this.u=B&&B.sendRawJson||!1,(B=B&&B.httpSessionIdParam)&&!K(B)&&(this.g.D=B,C=this.h,C!==null&&B in C&&(C=this.h,B in C&&delete C[B])),this.j=new pc(this)}j(xo,hn),xo.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},xo.prototype.close=function(){zi(this.g)},xo.prototype.o=function(C){var B=this.g;if(typeof C=="string"){var J={};J.__data__=C,C=J}else this.u&&(J={},J.__data__=ur(C),C=J);B.i.push(new xd(B.Ya++,C)),B.G==3&&hc(B)},xo.prototype.N=function(){this.g.l=null,delete this.j,zi(this.g),delete this.g,xo.aa.N.call(this)};function UE(C){sc.call(this),C.__headers__&&(this.headers=C.__headers__,this.statusCode=C.__status__,delete C.__headers__,delete C.__status__);var B=C.__sm__;if(B){e:{for(const J in B){C=J;break e}C=void 0}(this.i=C)&&(C=this.i,B=B!==null&&C in B?B[C]:void 0),this.data=B}else this.data=C}j(UE,sc);function VE(){ra.call(this),this.status=1}j(VE,ra);function pc(C){this.g=C}j(pc,xn),pc.prototype.ua=function(){an(this.g,"a")},pc.prototype.ta=function(C){an(this.g,new UE(C))},pc.prototype.sa=function(C){an(this.g,new VE)},pc.prototype.ra=function(){an(this.g,"b")},Bf.prototype.createWebChannel=Bf.prototype.g,xo.prototype.send=xo.prototype.o,xo.prototype.open=xo.prototype.m,xo.prototype.close=xo.prototype.close,Wne=function(){return new Bf},Bne=function(){return Ou()},jne=oc,BU={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Nu.NO_ERROR=0,Nu.TIMEOUT=8,Nu.HTTP_ERROR=6,BO=Nu,tp.COMPLETE="complete",Fne=tp,kl.EventType=xs,xs.OPEN="a",xs.CLOSE="b",xs.ERROR="c",xs.MESSAGE="d",hn.prototype.listen=hn.prototype.K,Sw=kl,De.prototype.listenOnce=De.prototype.L,De.prototype.getLastError=De.prototype.Ka,De.prototype.getLastErrorCode=De.prototype.Ba,De.prototype.getStatus=De.prototype.Z,De.prototype.getResponseJson=De.prototype.Oa,De.prototype.getResponseText=De.prototype.oa,De.prototype.send=De.prototype.ea,De.prototype.setWithCredentials=De.prototype.Ha,Vne=De}).apply(typeof oO<"u"?oO:typeof self<"u"?self:typeof window<"u"?window:{});const OY="@firebase/firestore",kY="4.7.9";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Aa{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Aa.UNAUTHENTICATED=new Aa(null),Aa.GOOGLE_CREDENTIALS=new Aa("google-credentials-uid"),Aa.FIRST_PARTY=new Aa("first-party-uid"),Aa.MOCK_USER=new Aa("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let S0="11.4.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CE=new YF("@firebase/firestore");function sS(){return CE.logLevel}function Jt(r,...t){if(CE.logLevel<=vr.DEBUG){const s=t.map(oj);CE.debug(`Firestore (${S0}): ${r}`,...s)}}function wf(r,...t){if(CE.logLevel<=vr.ERROR){const s=t.map(oj);CE.error(`Firestore (${S0}): ${r}`,...s)}}function n0(r,...t){if(CE.logLevel<=vr.WARN){const s=t.map(oj);CE.warn(`Firestore (${S0}): ${r}`,...s)}}function oj(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(s){return JSON.stringify(s)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fn(r="Unexpected state"){const t=`FIRESTORE (${S0}) INTERNAL ASSERTION FAILED: `+r;throw wf(t),new Error(t)}function ri(r,t){r||Fn()}function qn(r,t){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class rn extends ep{constructor(t,s){super(t,s),this.code=t,this.message=s,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _f{constructor(){this.promise=new Promise((t,s)=>{this.resolve=t,this.reject=s})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zne{constructor(t,s){this.user=s,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class $Ve{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,s){t.enqueueRetryable(()=>s(Aa.UNAUTHENTICATED))}shutdown(){}}class KVe{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,s){this.changeListener=s,t.enqueueRetryable(()=>s(this.token.user))}shutdown(){this.changeListener=null}}class qVe{constructor(t){this.t=t,this.currentUser=Aa.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,s){ri(this.o===void 0);let a=this.i;const l=v=>this.i!==a?(a=this.i,s(v)):Promise.resolve();let d=new _f;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new _f,t.enqueueRetryable(()=>l(this.currentUser))};const f=()=>{const v=d;t.enqueueRetryable(async()=>{await v.promise,await l(this.currentUser)})},E=v=>{Jt("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=v,this.o&&(this.auth.addAuthTokenListener(this.o),f())};this.t.onInit(v=>E(v)),setTimeout(()=>{if(!this.auth){const v=this.t.getImmediate({optional:!0});v?E(v):(Jt("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new _f)}},0),f()}getToken(){const t=this.i,s=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(s).then(a=>this.i!==t?(Jt("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(ri(typeof a.accessToken=="string"),new zne(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return ri(t===null||typeof t=="string"),new Aa(t)}}class YVe{constructor(t,s,a){this.l=t,this.h=s,this.P=a,this.type="FirstParty",this.user=Aa.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class XVe{constructor(t,s,a){this.l=t,this.h=s,this.P=a}getToken(){return Promise.resolve(new YVe(this.l,this.h,this.P))}start(t,s){t.enqueueRetryable(()=>s(Aa.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class NY{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class JVe{constructor(t,s){this.A=s,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,bl(t)&&t.settings.appCheckToken&&(this.V=t.settings.appCheckToken)}start(t,s){ri(this.o===void 0);const a=d=>{d.error!=null&&Jt("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const f=d.token!==this.R;return this.R=d.token,Jt("FirebaseAppCheckTokenProvider",`Received ${f?"new":"existing"} token.`),f?s(d.token):Promise.resolve()};this.o=d=>{t.enqueueRetryable(()=>a(d))};const l=d=>{Jt("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>l(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?l(d):Jt("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new NY(this.V));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(s=>s?(ri(typeof s.token=="string"),this.R=s.token,new NY(s.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QVe(r){const t=typeof self<"u"&&(self.crypto||self.msCrypto),s=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(s);else for(let a=0;a<r;a++)s[a]=Math.floor(256*Math.random());return s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gne{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const l=QVe(40);for(let d=0;d<l.length;++d)a.length<20&&l[d]<s&&(a+=t.charAt(l[d]%62))}return a}}function Ir(r,t){return r<t?-1:r>t?1:0}function r0(r,t,s){return r.length===t.length&&r.every((a,l)=>s(a,t[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DY=-62135596800,LY=1e6;class no{static now(){return no.fromMillis(Date.now())}static fromDate(t){return no.fromMillis(t.getTime())}static fromMillis(t){const s=Math.floor(t/1e3),a=Math.floor((t-1e3*s)*LY);return new no(s,a)}constructor(t,s){if(this.seconds=t,this.nanoseconds=s,s<0)throw new rn(bt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(s>=1e9)throw new rn(bt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+s);if(t<DY)throw new rn(bt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new rn(bt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/LY}_compareTo(t){return this.seconds===t.seconds?Ir(this.nanoseconds,t.nanoseconds):Ir(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds-DY;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gn{static fromTimestamp(t){return new Gn(t)}static min(){return new Gn(new no(0,0))}static max(){return new Gn(new no(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xY="__name__";class Ih{constructor(t,s,a){s===void 0?s=0:s>t.length&&Fn(),a===void 0?a=t.length-s:a>t.length-s&&Fn(),this.segments=t,this.offset=s,this.len=a}get length(){return this.len}isEqual(t){return Ih.comparator(this,t)===0}child(t){const s=this.segments.slice(this.offset,this.limit());return t instanceof Ih?t.forEach(a=>{s.push(a)}):s.push(t),this.construct(s)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==t.get(s))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let s=0;s<this.length;s++)if(this.get(s)!==t.get(s))return!1;return!0}forEach(t){for(let s=this.offset,a=this.limit();s<a;s++)t(this.segments[s])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,s){const a=Math.min(t.length,s.length);for(let l=0;l<a;l++){const d=Ih.compareSegments(t.get(l),s.get(l));if(d!==0)return d}return Math.sign(t.length-s.length)}static compareSegments(t,s){const a=Ih.isNumericId(t),l=Ih.isNumericId(s);return a&&!l?-1:!a&&l?1:a&&l?Ih.extractNumericId(t).compare(Ih.extractNumericId(s)):t<s?-1:t>s?1:0}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return rg.fromString(t.substring(4,t.length-2))}}class Fi extends Ih{construct(t,s,a){return new Fi(t,s,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const s=[];for(const a of t){if(a.indexOf("//")>=0)throw new rn(bt.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);s.push(...a.split("/").filter(l=>l.length>0))}return new Fi(s)}static emptyPath(){return new Fi([])}}const ZVe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Zo extends Ih{construct(t,s,a){return new Zo(t,s,a)}static isValidIdentifier(t){return ZVe.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Zo.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===xY}static keyField(){return new Zo([xY])}static fromServerFormat(t){const s=[];let a="",l=0;const d=()=>{if(a.length===0)throw new rn(bt.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);s.push(a),a=""};let f=!1;for(;l<t.length;){const E=t[l];if(E==="\\"){if(l+1===t.length)throw new rn(bt.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const v=t[l+1];if(v!=="\\"&&v!=="."&&v!=="`")throw new rn(bt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);a+=v,l+=2}else E==="`"?(f=!f,l++):E!=="."||f?(a+=E,l++):(d(),l++)}if(d(),f)throw new rn(bt.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Zo(s)}static emptyPath(){return new Zo([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sn{constructor(t){this.path=t}static fromPath(t){return new Sn(Fi.fromString(t))}static fromName(t){return new Sn(Fi.fromString(t).popFirst(5))}static empty(){return new Sn(Fi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Fi.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,s){return Fi.comparator(t.path,s.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Sn(new Fi(t.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fR=-1;function eFe(r,t){const s=r.toTimestamp().seconds,a=r.toTimestamp().nanoseconds+1,l=Gn.fromTimestamp(a===1e9?new no(s+1,0):new no(s,a));return new hg(l,Sn.empty(),t)}function tFe(r){return new hg(r.readTime,r.key,fR)}class hg{constructor(t,s,a){this.readTime=t,this.documentKey=s,this.largestBatchId=a}static min(){return new hg(Gn.min(),Sn.empty(),fR)}static max(){return new hg(Gn.max(),Sn.empty(),fR)}}function nFe(r,t){let s=r.readTime.compareTo(t.readTime);return s!==0?s:(s=Sn.comparator(r.documentKey,t.documentKey),s!==0?s:Ir(r.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rFe="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class iFe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function T0(r){if(r.code!==bt.FAILED_PRECONDITION||r.message!==rFe)throw r;Jt("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(s=>{this.isDone=!0,this.result=s,this.nextCallback&&this.nextCallback(s)},s=>{this.isDone=!0,this.error=s,this.catchCallback&&this.catchCallback(s)})}catch(t){return this.next(void 0,t)}next(t,s){return this.callbackAttached&&Fn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(t,this.result):new Tt((a,l)=>{this.nextCallback=d=>{this.wrapSuccess(t,d).next(a,l)},this.catchCallback=d=>{this.wrapFailure(s,d).next(a,l)}})}toPromise(){return new Promise((t,s)=>{this.next(t,s)})}wrapUserFunction(t){try{const s=t();return s instanceof Tt?s:Tt.resolve(s)}catch(s){return Tt.reject(s)}}wrapSuccess(t,s){return t?this.wrapUserFunction(()=>t(s)):Tt.resolve(s)}wrapFailure(t,s){return t?this.wrapUserFunction(()=>t(s)):Tt.reject(s)}static resolve(t){return new Tt((s,a)=>{s(t)})}static reject(t){return new Tt((s,a)=>{a(t)})}static waitFor(t){return new Tt((s,a)=>{let l=0,d=0,f=!1;t.forEach(E=>{++l,E.next(()=>{++d,f&&d===l&&s()},v=>a(v))}),f=!0,d===l&&s()})}static or(t){let s=Tt.resolve(!1);for(const a of t)s=s.next(l=>l?Tt.resolve(l):a());return s}static forEach(t,s){const a=[];return t.forEach((l,d)=>{a.push(s.call(this,l,d))}),this.waitFor(a)}static mapArray(t,s){return new Tt((a,l)=>{const d=t.length,f=new Array(d);let E=0;for(let v=0;v<d;v++){const T=v;s(t[T]).next(R=>{f[T]=R,++E,E===d&&a(f)},R=>l(R))}})}static doWhile(t,s){return new Tt((a,l)=>{const d=()=>{t()===!0?s().next(()=>{d()},l):a()};d()})}}function sFe(r){const t=r.match(/Android ([\d.]+)/i),s=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(s)}function b0(r){return r.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EN{constructor(t,s){this.previousValue=t,s&&(s.sequenceNumberHandler=a=>this.oe(a),this._e=a=>s.writeSequenceNumber(a))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}EN.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aj=-1;function yN(r){return r==null}function bk(r){return r===0&&1/r==-1/0}function oFe(r){return typeof r=="number"&&Number.isInteger(r)&&!bk(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hne="";function aFe(r){let t="";for(let s=0;s<r.length;s++)t.length>0&&(t=MY(t)),t=cFe(r.get(s),t);return MY(t)}function cFe(r,t){let s=t;const a=r.length;for(let l=0;l<a;l++){const d=r.charAt(l);switch(d){case"\0":s+="";break;case Hne:s+="";break;default:s+=d}}return s}function MY(r){return r+Hne+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UY(r){let t=0;for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&t++;return t}function Tg(r,t){for(const s in r)Object.prototype.hasOwnProperty.call(r,s)&&t(s,r[s])}function $ne(r){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class os{constructor(t,s){this.comparator=t,this.root=s||Xo.EMPTY}insert(t,s){return new os(this.comparator,this.root.insert(t,s,this.comparator).copy(null,null,Xo.BLACK,null,null))}remove(t){return new os(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Xo.BLACK,null,null))}get(t){let s=this.root;for(;!s.isEmpty();){const a=this.comparator(t,s.key);if(a===0)return s.value;a<0?s=s.left:a>0&&(s=s.right)}return null}indexOf(t){let s=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(t,a.key);if(l===0)return s+a.left.size;l<0?a=a.left:(s+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((s,a)=>(t(s,a),!1))}toString(){const t=[];return this.inorderTraversal((s,a)=>(t.push(`${s}:${a}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new aO(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new aO(this.root,t,this.comparator,!1)}getReverseIterator(){return new aO(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new aO(this.root,t,this.comparator,!0)}}class aO{constructor(t,s,a,l){this.isReverse=l,this.nodeStack=[];let d=1;for(;!t.isEmpty();)if(d=s?a(t.key,s):1,s&&l&&(d*=-1),d<0)t=this.isReverse?t.left:t.right;else{if(d===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const s={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return s}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Xo{constructor(t,s,a,l,d){this.key=t,this.value=s,this.color=a??Xo.RED,this.left=l??Xo.EMPTY,this.right=d??Xo.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,s,a,l,d){return new Xo(t??this.key,s??this.value,a??this.color,l??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,s,a){let l=this;const d=a(t,l.key);return l=d<0?l.copy(null,null,null,l.left.insert(t,s,a),null):d===0?l.copy(null,s,null,null,null):l.copy(null,null,null,null,l.right.insert(t,s,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return Xo.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,s){let a,l=this;if(s(t,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(t,s),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),s(t,l.key)===0){if(l.right.isEmpty())return Xo.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(t,s))}return l.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Xo.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Xo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),s=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,s)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Fn();const t=this.left.check();if(t!==this.right.check())throw Fn();return t+(this.isRed()?0:1)}}Xo.EMPTY=null,Xo.RED=!0,Xo.BLACK=!1;Xo.EMPTY=new class{constructor(){this.size=0}get key(){throw Fn()}get value(){throw Fn()}get color(){throw Fn()}get left(){throw Fn()}get right(){throw Fn()}copy(t,s,a,l,d){return this}insert(t,s,a){return new Xo(t,s)}remove(t,s){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ro{constructor(t){this.comparator=t,this.data=new os(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((s,a)=>(t(s),!1))}forEachInRange(t,s){const a=this.data.getIteratorFrom(t[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,t[1])>=0)return;s(l.key)}}forEachWhile(t,s){let a;for(a=s!==void 0?this.data.getIteratorFrom(s):this.data.getIterator();a.hasNext();)if(!t(a.getNext().key))return}firstAfterOrEqual(t){const s=this.data.getIteratorFrom(t);return s.hasNext()?s.getNext().key:null}getIterator(){return new VY(this.data.getIterator())}getIteratorFrom(t){return new VY(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let s=this;return s.size<t.size&&(s=t,t=this),t.forEach(a=>{s=s.add(a)}),s}isEqual(t){if(!(t instanceof ro)||this.size!==t.size)return!1;const s=this.data.getIterator(),a=t.data.getIterator();for(;s.hasNext();){const l=s.getNext().key,d=a.getNext().key;if(this.comparator(l,d)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(s=>{t.push(s)}),t}toString(){const t=[];return this.forEach(s=>t.push(s)),"SortedSet("+t.toString()+")"}copy(t){const s=new ro(this.comparator);return s.data=t,s}}class VY{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wl{constructor(t){this.fields=t,t.sort(Zo.comparator)}static empty(){return new wl([])}unionWith(t){let s=new ro(Zo.comparator);for(const a of this.fields)s=s.add(a);for(const a of t)s=s.add(a);return new wl(s.toArray())}covers(t){for(const s of this.fields)if(s.isPrefixOf(t))return!0;return!1}isEqual(t){return r0(this.fields,t.fields,(s,a)=>s.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kne extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ea{constructor(t){this.binaryString=t}static fromBase64String(t){const s=function(l){try{return atob(l)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new Kne("Invalid base64 string: "+d):d}}(t);return new ea(s)}static fromUint8Array(t){const s=function(l){let d="";for(let f=0;f<l.length;++f)d+=String.fromCharCode(l[f]);return d}(t);return new ea(s)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(s){return btoa(s)}(this.binaryString)}toUint8Array(){return function(s){const a=new Uint8Array(s.length);for(let l=0;l<s.length;l++)a[l]=s.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Ir(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ea.EMPTY_BYTE_STRING=new ea("");const lFe=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function pg(r){if(ri(!!r),typeof r=="string"){let t=0;const s=lFe.exec(r);if(ri(!!s),s[1]){let l=s[1];l=(l+"000000000").substr(0,9),t=Number(l)}const a=new Date(r);return{seconds:Math.floor(a.getTime()/1e3),nanos:t}}return{seconds:Ns(r.seconds),nanos:Ns(r.nanos)}}function Ns(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function fg(r){return typeof r=="string"?ea.fromBase64String(r):ea.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qne="server_timestamp",Yne="__type__",Xne="__previous_value__",Jne="__local_write_time__";function cj(r){var t,s;return((s=(((t=r==null?void 0:r.mapValue)===null||t===void 0?void 0:t.fields)||{})[Yne])===null||s===void 0?void 0:s.stringValue)===qne}function vN(r){const t=r.mapValue.fields[Xne];return cj(t)?vN(t):t}function mR(r){const t=pg(r.mapValue.fields[Jne].timestampValue);return new no(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uFe{constructor(t,s,a,l,d,f,E,v,T){this.databaseId=t,this.appId=s,this.persistenceKey=a,this.host=l,this.ssl=d,this.forceLongPolling=f,this.autoDetectLongPolling=E,this.longPollingOptions=v,this.useFetchStreams=T}}const wk="(default)";class gR{constructor(t,s){this.projectId=t,this.database=s||wk}static empty(){return new gR("","")}get isDefaultDatabase(){return this.database===wk}isEqual(t){return t instanceof gR&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qne="__type__",dFe="__max__",cO={mapValue:{}},Zne="__vector__",Rk="value";function mg(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?cj(r)?4:pFe(r)?9007199254740991:hFe(r)?10:11:Fn()}function Xh(r,t){if(r===t)return!0;const s=mg(r);if(s!==mg(t))return!1;switch(s){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return mR(r).isEqual(mR(t));case 3:return function(l,d){if(typeof l.timestampValue=="string"&&typeof d.timestampValue=="string"&&l.timestampValue.length===d.timestampValue.length)return l.timestampValue===d.timestampValue;const f=pg(l.timestampValue),E=pg(d.timestampValue);return f.seconds===E.seconds&&f.nanos===E.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(l,d){return fg(l.bytesValue).isEqual(fg(d.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(l,d){return Ns(l.geoPointValue.latitude)===Ns(d.geoPointValue.latitude)&&Ns(l.geoPointValue.longitude)===Ns(d.geoPointValue.longitude)}(r,t);case 2:return function(l,d){if("integerValue"in l&&"integerValue"in d)return Ns(l.integerValue)===Ns(d.integerValue);if("doubleValue"in l&&"doubleValue"in d){const f=Ns(l.doubleValue),E=Ns(d.doubleValue);return f===E?bk(f)===bk(E):isNaN(f)&&isNaN(E)}return!1}(r,t);case 9:return r0(r.arrayValue.values||[],t.arrayValue.values||[],Xh);case 10:case 11:return function(l,d){const f=l.mapValue.fields||{},E=d.mapValue.fields||{};if(UY(f)!==UY(E))return!1;for(const v in f)if(f.hasOwnProperty(v)&&(E[v]===void 0||!Xh(f[v],E[v])))return!1;return!0}(r,t);default:return Fn()}}function _R(r,t){return(r.values||[]).find(s=>Xh(s,t))!==void 0}function i0(r,t){if(r===t)return 0;const s=mg(r),a=mg(t);if(s!==a)return Ir(s,a);switch(s){case 0:case 9007199254740991:return 0;case 1:return Ir(r.booleanValue,t.booleanValue);case 2:return function(d,f){const E=Ns(d.integerValue||d.doubleValue),v=Ns(f.integerValue||f.doubleValue);return E<v?-1:E>v?1:E===v?0:isNaN(E)?isNaN(v)?0:-1:1}(r,t);case 3:return FY(r.timestampValue,t.timestampValue);case 4:return FY(mR(r),mR(t));case 5:return Ir(r.stringValue,t.stringValue);case 6:return function(d,f){const E=fg(d),v=fg(f);return E.compareTo(v)}(r.bytesValue,t.bytesValue);case 7:return function(d,f){const E=d.split("/"),v=f.split("/");for(let T=0;T<E.length&&T<v.length;T++){const R=Ir(E[T],v[T]);if(R!==0)return R}return Ir(E.length,v.length)}(r.referenceValue,t.referenceValue);case 8:return function(d,f){const E=Ir(Ns(d.latitude),Ns(f.latitude));return E!==0?E:Ir(Ns(d.longitude),Ns(f.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return jY(r.arrayValue,t.arrayValue);case 10:return function(d,f){var E,v,T,R;const I=d.fields||{},N=f.fields||{},F=(E=I[Rk])===null||E===void 0?void 0:E.arrayValue,j=(v=N[Rk])===null||v===void 0?void 0:v.arrayValue,G=Ir(((T=F==null?void 0:F.values)===null||T===void 0?void 0:T.length)||0,((R=j==null?void 0:j.values)===null||R===void 0?void 0:R.length)||0);return G!==0?G:jY(F,j)}(r.mapValue,t.mapValue);case 11:return function(d,f){if(d===cO.mapValue&&f===cO.mapValue)return 0;if(d===cO.mapValue)return 1;if(f===cO.mapValue)return-1;const E=d.fields||{},v=Object.keys(E),T=f.fields||{},R=Object.keys(T);v.sort(),R.sort();for(let I=0;I<v.length&&I<R.length;++I){const N=Ir(v[I],R[I]);if(N!==0)return N;const F=i0(E[v[I]],T[R[I]]);if(F!==0)return F}return Ir(v.length,R.length)}(r.mapValue,t.mapValue);default:throw Fn()}}function FY(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return Ir(r,t);const s=pg(r),a=pg(t),l=Ir(s.seconds,a.seconds);return l!==0?l:Ir(s.nanos,a.nanos)}function jY(r,t){const s=r.values||[],a=t.values||[];for(let l=0;l<s.length&&l<a.length;++l){const d=i0(s[l],a[l]);if(d)return d}return Ir(s.length,a.length)}function s0(r){return WU(r)}function WU(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(s){const a=pg(s);return`time(${a.seconds},${a.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(s){return fg(s).toBase64()}(r.bytesValue):"referenceValue"in r?function(s){return Sn.fromName(s).toString()}(r.referenceValue):"geoPointValue"in r?function(s){return`geo(${s.latitude},${s.longitude})`}(r.geoPointValue):"arrayValue"in r?function(s){let a="[",l=!0;for(const d of s.values||[])l?l=!1:a+=",",a+=WU(d);return a+"]"}(r.arrayValue):"mapValue"in r?function(s){const a=Object.keys(s.fields||{}).sort();let l="{",d=!0;for(const f of a)d?d=!1:l+=",",l+=`${f}:${WU(s.fields[f])}`;return l+"}"}(r.mapValue):Fn()}function WO(r){switch(mg(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=vN(r);return t?16+WO(t):16;case 5:return 2*r.stringValue.length;case 6:return fg(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(a){return(a.values||[]).reduce((l,d)=>l+WO(d),0)}(r.arrayValue);case 10:case 11:return function(a){let l=0;return Tg(a.fields,(d,f)=>{l+=d.length+WO(f)}),l}(r.mapValue);default:throw Fn()}}function BY(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function zU(r){return!!r&&"integerValue"in r}function lj(r){return!!r&&"arrayValue"in r}function WY(r){return!!r&&"nullValue"in r}function zY(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function zO(r){return!!r&&"mapValue"in r}function hFe(r){var t,s;return((s=(((t=r==null?void 0:r.mapValue)===null||t===void 0?void 0:t.fields)||{})[Qne])===null||s===void 0?void 0:s.stringValue)===Zne}function jw(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const t={mapValue:{fields:{}}};return Tg(r.mapValue.fields,(s,a)=>t.mapValue.fields[s]=jw(a)),t}if(r.arrayValue){const t={arrayValue:{values:[]}};for(let s=0;s<(r.arrayValue.values||[]).length;++s)t.arrayValue.values[s]=jw(r.arrayValue.values[s]);return t}return Object.assign({},r)}function pFe(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===dFe}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gc{constructor(t){this.value=t}static empty(){return new Gc({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let s=this.value;for(let a=0;a<t.length-1;++a)if(s=(s.mapValue.fields||{})[t.get(a)],!zO(s))return null;return s=(s.mapValue.fields||{})[t.lastSegment()],s||null}}set(t,s){this.getFieldsMap(t.popLast())[t.lastSegment()]=jw(s)}setAll(t){let s=Zo.emptyPath(),a={},l=[];t.forEach((f,E)=>{if(!s.isImmediateParentOf(E)){const v=this.getFieldsMap(s);this.applyChanges(v,a,l),a={},l=[],s=E.popLast()}f?a[E.lastSegment()]=jw(f):l.push(E.lastSegment())});const d=this.getFieldsMap(s);this.applyChanges(d,a,l)}delete(t){const s=this.field(t.popLast());zO(s)&&s.mapValue.fields&&delete s.mapValue.fields[t.lastSegment()]}isEqual(t){return Xh(this.value,t.value)}getFieldsMap(t){let s=this.value;s.mapValue.fields||(s.mapValue={fields:{}});for(let a=0;a<t.length;++a){let l=s.mapValue.fields[t.get(a)];zO(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},s.mapValue.fields[t.get(a)]=l),s=l}return s.mapValue.fields}applyChanges(t,s,a){Tg(s,(l,d)=>t[l]=d);for(const l of a)delete t[l]}clone(){return new Gc(jw(this.value))}}function ere(r){const t=[];return Tg(r.fields,(s,a)=>{const l=new Zo([s]);if(zO(a)){const d=ere(a.mapValue).fields;if(d.length===0)t.push(l);else for(const f of d)t.push(l.child(f))}else t.push(l)}),new wl(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oa{constructor(t,s,a,l,d,f,E){this.key=t,this.documentType=s,this.version=a,this.readTime=l,this.createTime=d,this.data=f,this.documentState=E}static newInvalidDocument(t){return new Oa(t,0,Gn.min(),Gn.min(),Gn.min(),Gc.empty(),0)}static newFoundDocument(t,s,a,l){return new Oa(t,1,s,Gn.min(),a,l,0)}static newNoDocument(t,s){return new Oa(t,2,s,Gn.min(),Gn.min(),Gc.empty(),0)}static newUnknownDocument(t,s){return new Oa(t,3,s,Gn.min(),Gn.min(),Gc.empty(),2)}convertToFoundDocument(t,s){return!this.createTime.isEqual(Gn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=s,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Gc.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Gc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Gn.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Oa&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Oa(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ck{constructor(t,s){this.position=t,this.inclusive=s}}function GY(r,t,s){let a=0;for(let l=0;l<r.position.length;l++){const d=t[l],f=r.position[l];if(d.field.isKeyField()?a=Sn.comparator(Sn.fromName(f.referenceValue),s.key):a=i0(f,s.data.field(d.field)),d.dir==="desc"&&(a*=-1),a!==0)break}return a}function HY(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let s=0;s<r.position.length;s++)if(!Xh(r.position[s],t.position[s]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ik{constructor(t,s="asc"){this.field=t,this.dir=s}}function fFe(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tre{}class Gs extends tre{constructor(t,s,a){super(),this.field=t,this.op=s,this.value=a}static create(t,s,a){return t.isKeyField()?s==="in"||s==="not-in"?this.createKeyFieldInFilter(t,s,a):new gFe(t,s,a):s==="array-contains"?new yFe(t,a):s==="in"?new vFe(t,a):s==="not-in"?new SFe(t,a):s==="array-contains-any"?new TFe(t,a):new Gs(t,s,a)}static createKeyFieldInFilter(t,s,a){return s==="in"?new _Fe(t,a):new EFe(t,a)}matches(t){const s=t.data.field(this.field);return this.op==="!="?s!==null&&this.matchesComparison(i0(s,this.value)):s!==null&&mg(this.value)===mg(s)&&this.matchesComparison(i0(s,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return Fn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Id extends tre{constructor(t,s){super(),this.filters=t,this.op=s,this.ce=null}static create(t,s){return new Id(t,s)}matches(t){return nre(this)?this.filters.find(s=>!s.matches(t))===void 0:this.filters.find(s=>s.matches(t))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((t,s)=>t.concat(s.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function nre(r){return r.op==="and"}function rre(r){return mFe(r)&&nre(r)}function mFe(r){for(const t of r.filters)if(t instanceof Id)return!1;return!0}function GU(r){if(r instanceof Gs)return r.field.canonicalString()+r.op.toString()+s0(r.value);if(rre(r))return r.filters.map(t=>GU(t)).join(",");{const t=r.filters.map(s=>GU(s)).join(",");return`${r.op}(${t})`}}function ire(r,t){return r instanceof Gs?function(a,l){return l instanceof Gs&&a.op===l.op&&a.field.isEqual(l.field)&&Xh(a.value,l.value)}(r,t):r instanceof Id?function(a,l){return l instanceof Id&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((d,f,E)=>d&&ire(f,l.filters[E]),!0):!1}(r,t):void Fn()}function sre(r){return r instanceof Gs?function(s){return`${s.field.canonicalString()} ${s.op} ${s0(s.value)}`}(r):r instanceof Id?function(s){return s.op.toString()+" {"+s.getFilters().map(sre).join(" ,")+"}"}(r):"Filter"}class gFe extends Gs{constructor(t,s,a){super(t,s,a),this.key=Sn.fromName(a.referenceValue)}matches(t){const s=Sn.comparator(t.key,this.key);return this.matchesComparison(s)}}class _Fe extends Gs{constructor(t,s){super(t,"in",s),this.keys=ore("in",s)}matches(t){return this.keys.some(s=>s.isEqual(t.key))}}class EFe extends Gs{constructor(t,s){super(t,"not-in",s),this.keys=ore("not-in",s)}matches(t){return!this.keys.some(s=>s.isEqual(t.key))}}function ore(r,t){var s;return(((s=t.arrayValue)===null||s===void 0?void 0:s.values)||[]).map(a=>Sn.fromName(a.referenceValue))}class yFe extends Gs{constructor(t,s){super(t,"array-contains",s)}matches(t){const s=t.data.field(this.field);return lj(s)&&_R(s.arrayValue,this.value)}}class vFe extends Gs{constructor(t,s){super(t,"in",s)}matches(t){const s=t.data.field(this.field);return s!==null&&_R(this.value.arrayValue,s)}}class SFe extends Gs{constructor(t,s){super(t,"not-in",s)}matches(t){if(_R(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const s=t.data.field(this.field);return s!==null&&!_R(this.value.arrayValue,s)}}class TFe extends Gs{constructor(t,s){super(t,"array-contains-any",s)}matches(t){const s=t.data.field(this.field);return!(!lj(s)||!s.arrayValue.values)&&s.arrayValue.values.some(a=>_R(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bFe{constructor(t,s=null,a=[],l=[],d=null,f=null,E=null){this.path=t,this.collectionGroup=s,this.orderBy=a,this.filters=l,this.limit=d,this.startAt=f,this.endAt=E,this.le=null}}function $Y(r,t=null,s=[],a=[],l=null,d=null,f=null){return new bFe(r,t,s,a,l,d,f)}function uj(r){const t=qn(r);if(t.le===null){let s=t.path.canonicalString();t.collectionGroup!==null&&(s+="|cg:"+t.collectionGroup),s+="|f:",s+=t.filters.map(a=>GU(a)).join(","),s+="|ob:",s+=t.orderBy.map(a=>function(d){return d.field.canonicalString()+d.dir}(a)).join(","),yN(t.limit)||(s+="|l:",s+=t.limit),t.startAt&&(s+="|lb:",s+=t.startAt.inclusive?"b:":"a:",s+=t.startAt.position.map(a=>s0(a)).join(",")),t.endAt&&(s+="|ub:",s+=t.endAt.inclusive?"a:":"b:",s+=t.endAt.position.map(a=>s0(a)).join(",")),t.le=s}return t.le}function dj(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let s=0;s<r.orderBy.length;s++)if(!fFe(r.orderBy[s],t.orderBy[s]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let s=0;s<r.filters.length;s++)if(!ire(r.filters[s],t.filters[s]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!HY(r.startAt,t.startAt)&&HY(r.endAt,t.endAt)}function HU(r){return Sn.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HR{constructor(t,s=null,a=[],l=[],d=null,f="F",E=null,v=null){this.path=t,this.collectionGroup=s,this.explicitOrderBy=a,this.filters=l,this.limit=d,this.limitType=f,this.startAt=E,this.endAt=v,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function wFe(r,t,s,a,l,d,f,E){return new HR(r,t,s,a,l,d,f,E)}function hj(r){return new HR(r)}function KY(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function are(r){return r.collectionGroup!==null}function Bw(r){const t=qn(r);if(t.he===null){t.he=[];const s=new Set;for(const d of t.explicitOrderBy)t.he.push(d),s.add(d.field.canonicalString());const a=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(f){let E=new ro(Zo.comparator);return f.filters.forEach(v=>{v.getFlattenedFilters().forEach(T=>{T.isInequality()&&(E=E.add(T.field))})}),E})(t).forEach(d=>{s.has(d.canonicalString())||d.isKeyField()||t.he.push(new Ik(d,a))}),s.has(Zo.keyField().canonicalString())||t.he.push(new Ik(Zo.keyField(),a))}return t.he}function $h(r){const t=qn(r);return t.Pe||(t.Pe=RFe(t,Bw(r))),t.Pe}function RFe(r,t){if(r.limitType==="F")return $Y(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(l=>{const d=l.dir==="desc"?"asc":"desc";return new Ik(l.field,d)});const s=r.endAt?new Ck(r.endAt.position,r.endAt.inclusive):null,a=r.startAt?new Ck(r.startAt.position,r.startAt.inclusive):null;return $Y(r.path,r.collectionGroup,t,r.filters,r.limit,s,a)}}function $U(r,t){const s=r.filters.concat([t]);return new HR(r.path,r.collectionGroup,r.explicitOrderBy.slice(),s,r.limit,r.limitType,r.startAt,r.endAt)}function KU(r,t,s){return new HR(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,s,r.startAt,r.endAt)}function SN(r,t){return dj($h(r),$h(t))&&r.limitType===t.limitType}function cre(r){return`${uj($h(r))}|lt:${r.limitType}`}function oS(r){return`Query(target=${function(s){let a=s.path.canonicalString();return s.collectionGroup!==null&&(a+=" collectionGroup="+s.collectionGroup),s.filters.length>0&&(a+=`, filters: [${s.filters.map(l=>sre(l)).join(", ")}]`),yN(s.limit)||(a+=", limit: "+s.limit),s.orderBy.length>0&&(a+=`, orderBy: [${s.orderBy.map(l=>function(f){return`${f.field.canonicalString()} (${f.dir})`}(l)).join(", ")}]`),s.startAt&&(a+=", startAt: ",a+=s.startAt.inclusive?"b:":"a:",a+=s.startAt.position.map(l=>s0(l)).join(",")),s.endAt&&(a+=", endAt: ",a+=s.endAt.inclusive?"a:":"b:",a+=s.endAt.position.map(l=>s0(l)).join(",")),`Target(${a})`}($h(r))}; limitType=${r.limitType})`}function TN(r,t){return t.isFoundDocument()&&function(a,l){const d=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(d):Sn.isDocumentKey(a.path)?a.path.isEqual(d):a.path.isImmediateParentOf(d)}(r,t)&&function(a,l){for(const d of Bw(a))if(!d.field.isKeyField()&&l.data.field(d.field)===null)return!1;return!0}(r,t)&&function(a,l){for(const d of a.filters)if(!d.matches(l))return!1;return!0}(r,t)&&function(a,l){return!(a.startAt&&!function(f,E,v){const T=GY(f,E,v);return f.inclusive?T<=0:T<0}(a.startAt,Bw(a),l)||a.endAt&&!function(f,E,v){const T=GY(f,E,v);return f.inclusive?T>=0:T>0}(a.endAt,Bw(a),l))}(r,t)}function CFe(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function lre(r){return(t,s)=>{let a=!1;for(const l of Bw(r)){const d=IFe(l,t,s);if(d!==0)return d;a=a||l.field.isKeyField()}return 0}}function IFe(r,t,s){const a=r.field.isKeyField()?Sn.comparator(t.key,s.key):function(d,f,E){const v=f.data.field(d),T=E.data.field(d);return v!==null&&T!==null?i0(v,T):Fn()}(r.field,t,s);switch(r.dir){case"asc":return a;case"desc":return-1*a;default:return Fn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kE{constructor(t,s){this.mapKeyFn=t,this.equalsFn=s,this.inner={},this.innerSize=0}get(t){const s=this.mapKeyFn(t),a=this.inner[s];if(a!==void 0){for(const[l,d]of a)if(this.equalsFn(l,t))return d}}has(t){return this.get(t)!==void 0}set(t,s){const a=this.mapKeyFn(t),l=this.inner[a];if(l===void 0)return this.inner[a]=[[t,s]],void this.innerSize++;for(let d=0;d<l.length;d++)if(this.equalsFn(l[d][0],t))return void(l[d]=[t,s]);l.push([t,s]),this.innerSize++}delete(t){const s=this.mapKeyFn(t),a=this.inner[s];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],t))return a.length===1?delete this.inner[s]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(t){Tg(this.inner,(s,a)=>{for(const[l,d]of a)t(l,d)})}isEmpty(){return $ne(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AFe=new os(Sn.comparator);function Rf(){return AFe}const ure=new os(Sn.comparator);function Tw(...r){let t=ure;for(const s of r)t=t.insert(s.key,s);return t}function dre(r){let t=ure;return r.forEach((s,a)=>t=t.insert(s,a.overlayedDocument)),t}function rE(){return Ww()}function hre(){return Ww()}function Ww(){return new kE(r=>r.toString(),(r,t)=>r.isEqual(t))}const PFe=new os(Sn.comparator),OFe=new ro(Sn.comparator);function Sr(...r){let t=OFe;for(const s of r)t=t.add(s);return t}const kFe=new ro(Ir);function NFe(){return kFe}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pj(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:bk(t)?"-0":t}}function pre(r){return{integerValue:""+r}}function DFe(r,t){return oFe(t)?pre(t):pj(r,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bN{constructor(){this._=void 0}}function LFe(r,t,s){return r instanceof Ak?function(l,d){const f={fields:{[Yne]:{stringValue:qne},[Jne]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return d&&cj(d)&&(d=vN(d)),d&&(f.fields[Xne]=d),{mapValue:f}}(s,t):r instanceof ER?mre(r,t):r instanceof yR?gre(r,t):function(l,d){const f=fre(l,d),E=qY(f)+qY(l.Ie);return zU(f)&&zU(l.Ie)?pre(E):pj(l.serializer,E)}(r,t)}function xFe(r,t,s){return r instanceof ER?mre(r,t):r instanceof yR?gre(r,t):s}function fre(r,t){return r instanceof Pk?function(a){return zU(a)||function(d){return!!d&&"doubleValue"in d}(a)}(t)?t:{integerValue:0}:null}class Ak extends bN{}class ER extends bN{constructor(t){super(),this.elements=t}}function mre(r,t){const s=_re(t);for(const a of r.elements)s.some(l=>Xh(l,a))||s.push(a);return{arrayValue:{values:s}}}class yR extends bN{constructor(t){super(),this.elements=t}}function gre(r,t){let s=_re(t);for(const a of r.elements)s=s.filter(l=>!Xh(l,a));return{arrayValue:{values:s}}}class Pk extends bN{constructor(t,s){super(),this.serializer=t,this.Ie=s}}function qY(r){return Ns(r.integerValue||r.doubleValue)}function _re(r){return lj(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}function MFe(r,t){return r.field.isEqual(t.field)&&function(a,l){return a instanceof ER&&l instanceof ER||a instanceof yR&&l instanceof yR?r0(a.elements,l.elements,Xh):a instanceof Pk&&l instanceof Pk?Xh(a.Ie,l.Ie):a instanceof Ak&&l instanceof Ak}(r.transform,t.transform)}class UFe{constructor(t,s){this.version=t,this.transformResults=s}}class Kh{constructor(t,s){this.updateTime=t,this.exists=s}static none(){return new Kh}static exists(t){return new Kh(void 0,t)}static updateTime(t){return new Kh(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function GO(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}class wN{}function Ere(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new vre(r.key,Kh.none()):new $R(r.key,r.data,Kh.none());{const s=r.data,a=Gc.empty();let l=new ro(Zo.comparator);for(let d of t.fields)if(!l.has(d)){let f=s.field(d);f===null&&d.length>1&&(d=d.popLast(),f=s.field(d)),f===null?a.delete(d):a.set(d,f),l=l.add(d)}return new bg(r.key,a,new wl(l.toArray()),Kh.none())}}function VFe(r,t,s){r instanceof $R?function(l,d,f){const E=l.value.clone(),v=XY(l.fieldTransforms,d,f.transformResults);E.setAll(v),d.convertToFoundDocument(f.version,E).setHasCommittedMutations()}(r,t,s):r instanceof bg?function(l,d,f){if(!GO(l.precondition,d))return void d.convertToUnknownDocument(f.version);const E=XY(l.fieldTransforms,d,f.transformResults),v=d.data;v.setAll(yre(l)),v.setAll(E),d.convertToFoundDocument(f.version,v).setHasCommittedMutations()}(r,t,s):function(l,d,f){d.convertToNoDocument(f.version).setHasCommittedMutations()}(0,t,s)}function zw(r,t,s,a){return r instanceof $R?function(d,f,E,v){if(!GO(d.precondition,f))return E;const T=d.value.clone(),R=JY(d.fieldTransforms,v,f);return T.setAll(R),f.convertToFoundDocument(f.version,T).setHasLocalMutations(),null}(r,t,s,a):r instanceof bg?function(d,f,E,v){if(!GO(d.precondition,f))return E;const T=JY(d.fieldTransforms,v,f),R=f.data;return R.setAll(yre(d)),R.setAll(T),f.convertToFoundDocument(f.version,R).setHasLocalMutations(),E===null?null:E.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(I=>I.field))}(r,t,s,a):function(d,f,E){return GO(d.precondition,f)?(f.convertToNoDocument(f.version).setHasLocalMutations(),null):E}(r,t,s)}function FFe(r,t){let s=null;for(const a of r.fieldTransforms){const l=t.data.field(a.field),d=fre(a.transform,l||null);d!=null&&(s===null&&(s=Gc.empty()),s.set(a.field,d))}return s||null}function YY(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&r0(a,l,(d,f)=>MFe(d,f))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}class $R extends wN{constructor(t,s,a,l=[]){super(),this.key=t,this.value=s,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class bg extends wN{constructor(t,s,a,l,d=[]){super(),this.key=t,this.data=s,this.fieldMask=a,this.precondition=l,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function yre(r){const t=new Map;return r.fieldMask.fields.forEach(s=>{if(!s.isEmpty()){const a=r.data.field(s);t.set(s,a)}}),t}function XY(r,t,s){const a=new Map;ri(r.length===s.length);for(let l=0;l<s.length;l++){const d=r[l],f=d.transform,E=t.data.field(d.field);a.set(d.field,xFe(f,E,s[l]))}return a}function JY(r,t,s){const a=new Map;for(const l of r){const d=l.transform,f=s.data.field(l.field);a.set(l.field,LFe(d,f,t))}return a}class vre extends wN{constructor(t,s){super(),this.key=t,this.precondition=s,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class jFe extends wN{constructor(t,s){super(),this.key=t,this.precondition=s,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BFe{constructor(t,s,a,l){this.batchId=t,this.localWriteTime=s,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(t,s){const a=s.mutationResults;for(let l=0;l<this.mutations.length;l++){const d=this.mutations[l];d.key.isEqual(t.key)&&VFe(d,t,a[l])}}applyToLocalView(t,s){for(const a of this.baseMutations)a.key.isEqual(t.key)&&(s=zw(a,t,s,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(t.key)&&(s=zw(a,t,s,this.localWriteTime));return s}applyToLocalDocumentSet(t,s){const a=hre();return this.mutations.forEach(l=>{const d=t.get(l.key),f=d.overlayedDocument;let E=this.applyToLocalView(f,d.mutatedFields);E=s.has(l.key)?null:E;const v=Ere(f,E);v!==null&&a.set(l.key,v),f.isValidDocument()||f.convertToNoDocument(Gn.min())}),a}keys(){return this.mutations.reduce((t,s)=>t.add(s.key),Sr())}isEqual(t){return this.batchId===t.batchId&&r0(this.mutations,t.mutations,(s,a)=>YY(s,a))&&r0(this.baseMutations,t.baseMutations,(s,a)=>YY(s,a))}}class fj{constructor(t,s,a,l){this.batch=t,this.commitVersion=s,this.mutationResults=a,this.docVersions=l}static from(t,s,a){ri(t.mutations.length===a.length);let l=function(){return PFe}();const d=t.mutations;for(let f=0;f<d.length;f++)l=l.insert(d[f].key,a[f].version);return new fj(t,s,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WFe{constructor(t,s){this.largestBatchId=t,this.mutation=s}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zFe{constructor(t,s){this.count=t,this.unchangedNames=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var js,Or;function GFe(r){switch(r){case bt.OK:return Fn();case bt.CANCELLED:case bt.UNKNOWN:case bt.DEADLINE_EXCEEDED:case bt.RESOURCE_EXHAUSTED:case bt.INTERNAL:case bt.UNAVAILABLE:case bt.UNAUTHENTICATED:return!1;case bt.INVALID_ARGUMENT:case bt.NOT_FOUND:case bt.ALREADY_EXISTS:case bt.PERMISSION_DENIED:case bt.FAILED_PRECONDITION:case bt.ABORTED:case bt.OUT_OF_RANGE:case bt.UNIMPLEMENTED:case bt.DATA_LOSS:return!0;default:return Fn()}}function Sre(r){if(r===void 0)return wf("GRPC error has no .code"),bt.UNKNOWN;switch(r){case js.OK:return bt.OK;case js.CANCELLED:return bt.CANCELLED;case js.UNKNOWN:return bt.UNKNOWN;case js.DEADLINE_EXCEEDED:return bt.DEADLINE_EXCEEDED;case js.RESOURCE_EXHAUSTED:return bt.RESOURCE_EXHAUSTED;case js.INTERNAL:return bt.INTERNAL;case js.UNAVAILABLE:return bt.UNAVAILABLE;case js.UNAUTHENTICATED:return bt.UNAUTHENTICATED;case js.INVALID_ARGUMENT:return bt.INVALID_ARGUMENT;case js.NOT_FOUND:return bt.NOT_FOUND;case js.ALREADY_EXISTS:return bt.ALREADY_EXISTS;case js.PERMISSION_DENIED:return bt.PERMISSION_DENIED;case js.FAILED_PRECONDITION:return bt.FAILED_PRECONDITION;case js.ABORTED:return bt.ABORTED;case js.OUT_OF_RANGE:return bt.OUT_OF_RANGE;case js.UNIMPLEMENTED:return bt.UNIMPLEMENTED;case js.DATA_LOSS:return bt.DATA_LOSS;default:return Fn()}}(Or=js||(js={}))[Or.OK=0]="OK",Or[Or.CANCELLED=1]="CANCELLED",Or[Or.UNKNOWN=2]="UNKNOWN",Or[Or.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Or[Or.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Or[Or.NOT_FOUND=5]="NOT_FOUND",Or[Or.ALREADY_EXISTS=6]="ALREADY_EXISTS",Or[Or.PERMISSION_DENIED=7]="PERMISSION_DENIED",Or[Or.UNAUTHENTICATED=16]="UNAUTHENTICATED",Or[Or.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Or[Or.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Or[Or.ABORTED=10]="ABORTED",Or[Or.OUT_OF_RANGE=11]="OUT_OF_RANGE",Or[Or.UNIMPLEMENTED=12]="UNIMPLEMENTED",Or[Or.INTERNAL=13]="INTERNAL",Or[Or.UNAVAILABLE=14]="UNAVAILABLE",Or[Or.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HFe(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $Fe=new rg([4294967295,4294967295],0);function QY(r){const t=HFe().encode(r),s=new Une;return s.update(t),new Uint8Array(s.digest())}function ZY(r){const t=new DataView(r.buffer),s=t.getUint32(0,!0),a=t.getUint32(4,!0),l=t.getUint32(8,!0),d=t.getUint32(12,!0);return[new rg([s,a],0),new rg([l,d],0)]}class mj{constructor(t,s,a){if(this.bitmap=t,this.padding=s,this.hashCount=a,s<0||s>=8)throw new bw(`Invalid padding: ${s}`);if(a<0)throw new bw(`Invalid hash count: ${a}`);if(t.length>0&&this.hashCount===0)throw new bw(`Invalid hash count: ${a}`);if(t.length===0&&s!==0)throw new bw(`Invalid padding when bitmap length is 0: ${s}`);this.Ee=8*t.length-s,this.de=rg.fromNumber(this.Ee)}Ae(t,s,a){let l=t.add(s.multiply(rg.fromNumber(a)));return l.compare($Fe)===1&&(l=new rg([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.Ee===0)return!1;const s=QY(t),[a,l]=ZY(s);for(let d=0;d<this.hashCount;d++){const f=this.Ae(a,l,d);if(!this.Re(f))return!1}return!0}static create(t,s,a){const l=t%8==0?0:8-t%8,d=new Uint8Array(Math.ceil(t/8)),f=new mj(d,l,s);return a.forEach(E=>f.insert(E)),f}insert(t){if(this.Ee===0)return;const s=QY(t),[a,l]=ZY(s);for(let d=0;d<this.hashCount;d++){const f=this.Ae(a,l,d);this.Ve(f)}}Ve(t){const s=Math.floor(t/8),a=t%8;this.bitmap[s]|=1<<a}}class bw extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RN{constructor(t,s,a,l,d){this.snapshotVersion=t,this.targetChanges=s,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(t,s,a){const l=new Map;return l.set(t,KR.createSynthesizedTargetChangeForCurrentChange(t,s,a)),new RN(Gn.min(),l,new os(Ir),Rf(),Sr())}}class KR{constructor(t,s,a,l,d){this.resumeToken=t,this.current=s,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(t,s,a){return new KR(a,s,Sr(),Sr(),Sr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HO{constructor(t,s,a,l){this.me=t,this.removedTargetIds=s,this.key=a,this.fe=l}}class Tre{constructor(t,s){this.targetId=t,this.ge=s}}class bre{constructor(t,s,a=ea.EMPTY_BYTE_STRING,l=null){this.state=t,this.targetIds=s,this.resumeToken=a,this.cause=l}}class eX{constructor(){this.pe=0,this.ye=tX(),this.we=ea.EMPTY_BYTE_STRING,this.be=!1,this.Se=!0}get current(){return this.be}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.we=t)}Fe(){let t=Sr(),s=Sr(),a=Sr();return this.ye.forEach((l,d)=>{switch(d){case 0:t=t.add(l);break;case 2:s=s.add(l);break;case 1:a=a.add(l);break;default:Fn()}}),new KR(this.we,this.be,t,s,a)}Me(){this.Se=!1,this.ye=tX()}xe(t,s){this.Se=!0,this.ye=this.ye.insert(t,s)}Oe(t){this.Se=!0,this.ye=this.ye.remove(t)}Ne(){this.pe+=1}Be(){this.pe-=1,ri(this.pe>=0)}Le(){this.Se=!0,this.be=!0}}class KFe{constructor(t){this.ke=t,this.qe=new Map,this.Qe=Rf(),this.$e=lO(),this.Ke=lO(),this.Ue=new os(Ir)}We(t){for(const s of t.me)t.fe&&t.fe.isFoundDocument()?this.Ge(s,t.fe):this.ze(s,t.key,t.fe);for(const s of t.removedTargetIds)this.ze(s,t.key,t.fe)}je(t){this.forEachTarget(t,s=>{const a=this.He(s);switch(t.state){case 0:this.Je(s)&&a.Ce(t.resumeToken);break;case 1:a.Be(),a.De||a.Me(),a.Ce(t.resumeToken);break;case 2:a.Be(),a.De||this.removeTarget(s);break;case 3:this.Je(s)&&(a.Le(),a.Ce(t.resumeToken));break;case 4:this.Je(s)&&(this.Ye(s),a.Ce(t.resumeToken));break;default:Fn()}})}forEachTarget(t,s){t.targetIds.length>0?t.targetIds.forEach(s):this.qe.forEach((a,l)=>{this.Je(l)&&s(l)})}Ze(t){const s=t.targetId,a=t.ge.count,l=this.Xe(s);if(l){const d=l.target;if(HU(d))if(a===0){const f=new Sn(d.path);this.ze(s,f,Oa.newNoDocument(f,Gn.min()))}else ri(a===1);else{const f=this.et(s);if(f!==a){const E=this.tt(t),v=E?this.nt(E,t,f):1;if(v!==0){this.Ye(s);const T=v===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(s,T)}}}}}tt(t){const s=t.ge.unchangedNames;if(!s||!s.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:d=0}=s;let f,E;try{f=fg(a).toUint8Array()}catch(v){if(v instanceof Kne)return n0("Decoding the base64 bloom filter in existence filter failed ("+v.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw v}try{E=new mj(f,l,d)}catch(v){return n0(v instanceof bw?"BloomFilter error: ":"Applying bloom filter failed: ",v),null}return E.Ee===0?null:E}nt(t,s,a){return s.ge.count===a-this.st(t,s.targetId)?0:2}st(t,s){const a=this.ke.getRemoteKeysForTarget(s);let l=0;return a.forEach(d=>{const f=this.ke.it(),E=`projects/${f.projectId}/databases/${f.database}/documents/${d.path.canonicalString()}`;t.mightContain(E)||(this.ze(s,d,null),l++)}),l}ot(t){const s=new Map;this.qe.forEach((d,f)=>{const E=this.Xe(f);if(E){if(d.current&&HU(E.target)){const v=new Sn(E.target.path);this._t(v).has(f)||this.ut(f,v)||this.ze(f,v,Oa.newNoDocument(v,t))}d.ve&&(s.set(f,d.Fe()),d.Me())}});let a=Sr();this.Ke.forEach((d,f)=>{let E=!0;f.forEachWhile(v=>{const T=this.Xe(v);return!T||T.purpose==="TargetPurposeLimboResolution"||(E=!1,!1)}),E&&(a=a.add(d))}),this.Qe.forEach((d,f)=>f.setReadTime(t));const l=new RN(t,s,this.Ue,this.Qe,a);return this.Qe=Rf(),this.$e=lO(),this.Ke=lO(),this.Ue=new os(Ir),l}Ge(t,s){if(!this.Je(t))return;const a=this.ut(t,s.key)?2:0;this.He(t).xe(s.key,a),this.Qe=this.Qe.insert(s.key,s),this.$e=this.$e.insert(s.key,this._t(s.key).add(t)),this.Ke=this.Ke.insert(s.key,this.ct(s.key).add(t))}ze(t,s,a){if(!this.Je(t))return;const l=this.He(t);this.ut(t,s)?l.xe(s,1):l.Oe(s),this.Ke=this.Ke.insert(s,this.ct(s).delete(t)),this.Ke=this.Ke.insert(s,this.ct(s).add(t)),a&&(this.Qe=this.Qe.insert(s,a))}removeTarget(t){this.qe.delete(t)}et(t){const s=this.He(t).Fe();return this.ke.getRemoteKeysForTarget(t).size+s.addedDocuments.size-s.removedDocuments.size}Ne(t){this.He(t).Ne()}He(t){let s=this.qe.get(t);return s||(s=new eX,this.qe.set(t,s)),s}ct(t){let s=this.Ke.get(t);return s||(s=new ro(Ir),this.Ke=this.Ke.insert(t,s)),s}_t(t){let s=this.$e.get(t);return s||(s=new ro(Ir),this.$e=this.$e.insert(t,s)),s}Je(t){const s=this.Xe(t)!==null;return s||Jt("WatchChangeAggregator","Detected inactive target",t),s}Xe(t){const s=this.qe.get(t);return s&&s.De?null:this.ke.lt(t)}Ye(t){this.qe.set(t,new eX),this.ke.getRemoteKeysForTarget(t).forEach(s=>{this.ze(t,s,null)})}ut(t,s){return this.ke.getRemoteKeysForTarget(t).has(s)}}function lO(){return new os(Sn.comparator)}function tX(){return new os(Sn.comparator)}const qFe={asc:"ASCENDING",desc:"DESCENDING"},YFe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},XFe={and:"AND",or:"OR"};class JFe{constructor(t,s){this.databaseId=t,this.useProto3Json=s}}function qU(r,t){return r.useProto3Json||yN(t)?t:{value:t}}function Ok(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function wre(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function QFe(r,t){return Ok(r,t.toTimestamp())}function qh(r){return ri(!!r),Gn.fromTimestamp(function(s){const a=pg(s);return new no(a.seconds,a.nanos)}(r))}function gj(r,t){return YU(r,t).canonicalString()}function YU(r,t){const s=function(l){return new Fi(["projects",l.projectId,"databases",l.database])}(r).child("documents");return t===void 0?s:s.child(t)}function Rre(r){const t=Fi.fromString(r);return ri(Ore(t)),t}function XU(r,t){return gj(r.databaseId,t.path)}function S2(r,t){const s=Rre(t);if(s.get(1)!==r.databaseId.projectId)throw new rn(bt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+s.get(1)+" vs "+r.databaseId.projectId);if(s.get(3)!==r.databaseId.database)throw new rn(bt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+s.get(3)+" vs "+r.databaseId.database);return new Sn(Ire(s))}function Cre(r,t){return gj(r.databaseId,t)}function ZFe(r){const t=Rre(r);return t.length===4?Fi.emptyPath():Ire(t)}function JU(r){return new Fi(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function Ire(r){return ri(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function nX(r,t,s){return{name:XU(r,t),fields:s.value.mapValue.fields}}function eje(r,t){let s;if("targetChange"in t){t.targetChange;const a=function(T){return T==="NO_CHANGE"?0:T==="ADD"?1:T==="REMOVE"?2:T==="CURRENT"?3:T==="RESET"?4:Fn()}(t.targetChange.targetChangeType||"NO_CHANGE"),l=t.targetChange.targetIds||[],d=function(T,R){return T.useProto3Json?(ri(R===void 0||typeof R=="string"),ea.fromBase64String(R||"")):(ri(R===void 0||R instanceof Buffer||R instanceof Uint8Array),ea.fromUint8Array(R||new Uint8Array))}(r,t.targetChange.resumeToken),f=t.targetChange.cause,E=f&&function(T){const R=T.code===void 0?bt.UNKNOWN:Sre(T.code);return new rn(R,T.message||"")}(f);s=new bre(a,l,d,E||null)}else if("documentChange"in t){t.documentChange;const a=t.documentChange;a.document,a.document.name,a.document.updateTime;const l=S2(r,a.document.name),d=qh(a.document.updateTime),f=a.document.createTime?qh(a.document.createTime):Gn.min(),E=new Gc({mapValue:{fields:a.document.fields}}),v=Oa.newFoundDocument(l,d,f,E),T=a.targetIds||[],R=a.removedTargetIds||[];s=new HO(T,R,v.key,v)}else if("documentDelete"in t){t.documentDelete;const a=t.documentDelete;a.document;const l=S2(r,a.document),d=a.readTime?qh(a.readTime):Gn.min(),f=Oa.newNoDocument(l,d),E=a.removedTargetIds||[];s=new HO([],E,f.key,f)}else if("documentRemove"in t){t.documentRemove;const a=t.documentRemove;a.document;const l=S2(r,a.document),d=a.removedTargetIds||[];s=new HO([],d,l,null)}else{if(!("filter"in t))return Fn();{t.filter;const a=t.filter;a.targetId;const{count:l=0,unchangedNames:d}=a,f=new zFe(l,d),E=a.targetId;s=new Tre(E,f)}}return s}function tje(r,t){let s;if(t instanceof $R)s={update:nX(r,t.key,t.value)};else if(t instanceof vre)s={delete:XU(r,t.key)};else if(t instanceof bg)s={update:nX(r,t.key,t.data),updateMask:uje(t.fieldMask)};else{if(!(t instanceof jFe))return Fn();s={verify:XU(r,t.key)}}return t.fieldTransforms.length>0&&(s.updateTransforms=t.fieldTransforms.map(a=>function(d,f){const E=f.transform;if(E instanceof Ak)return{fieldPath:f.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(E instanceof ER)return{fieldPath:f.field.canonicalString(),appendMissingElements:{values:E.elements}};if(E instanceof yR)return{fieldPath:f.field.canonicalString(),removeAllFromArray:{values:E.elements}};if(E instanceof Pk)return{fieldPath:f.field.canonicalString(),increment:E.Ie};throw Fn()}(0,a))),t.precondition.isNone||(s.currentDocument=function(l,d){return d.updateTime!==void 0?{updateTime:QFe(l,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:Fn()}(r,t.precondition)),s}function nje(r,t){return r&&r.length>0?(ri(t!==void 0),r.map(s=>function(l,d){let f=l.updateTime?qh(l.updateTime):qh(d);return f.isEqual(Gn.min())&&(f=qh(d)),new UFe(f,l.transformResults||[])}(s,t))):[]}function rje(r,t){return{documents:[Cre(r,t.path)]}}function ije(r,t){const s={structuredQuery:{}},a=t.path;let l;t.collectionGroup!==null?(l=a,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(l=a.popLast(),s.structuredQuery.from=[{collectionId:a.lastSegment()}]),s.parent=Cre(r,l);const d=function(T){if(T.length!==0)return Pre(Id.create(T,"and"))}(t.filters);d&&(s.structuredQuery.where=d);const f=function(T){if(T.length!==0)return T.map(R=>function(N){return{field:aS(N.field),direction:aje(N.dir)}}(R))}(t.orderBy);f&&(s.structuredQuery.orderBy=f);const E=qU(r,t.limit);return E!==null&&(s.structuredQuery.limit=E),t.startAt&&(s.structuredQuery.startAt=function(T){return{before:T.inclusive,values:T.position}}(t.startAt)),t.endAt&&(s.structuredQuery.endAt=function(T){return{before:!T.inclusive,values:T.position}}(t.endAt)),{ht:s,parent:l}}function sje(r){let t=ZFe(r.parent);const s=r.structuredQuery,a=s.from?s.from.length:0;let l=null;if(a>0){ri(a===1);const R=s.from[0];R.allDescendants?l=R.collectionId:t=t.child(R.collectionId)}let d=[];s.where&&(d=function(I){const N=Are(I);return N instanceof Id&&rre(N)?N.getFilters():[N]}(s.where));let f=[];s.orderBy&&(f=function(I){return I.map(N=>function(j){return new Ik(cS(j.field),function(H){switch(H){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(j.direction))}(N))}(s.orderBy));let E=null;s.limit&&(E=function(I){let N;return N=typeof I=="object"?I.value:I,yN(N)?null:N}(s.limit));let v=null;s.startAt&&(v=function(I){const N=!!I.before,F=I.values||[];return new Ck(F,N)}(s.startAt));let T=null;return s.endAt&&(T=function(I){const N=!I.before,F=I.values||[];return new Ck(F,N)}(s.endAt)),wFe(t,l,f,d,E,"F",v,T)}function oje(r,t){const s=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Fn()}}(t.purpose);return s==null?null:{"goog-listen-tags":s}}function Are(r){return r.unaryFilter!==void 0?function(s){switch(s.unaryFilter.op){case"IS_NAN":const a=cS(s.unaryFilter.field);return Gs.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=cS(s.unaryFilter.field);return Gs.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=cS(s.unaryFilter.field);return Gs.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const f=cS(s.unaryFilter.field);return Gs.create(f,"!=",{nullValue:"NULL_VALUE"});default:return Fn()}}(r):r.fieldFilter!==void 0?function(s){return Gs.create(cS(s.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Fn()}}(s.fieldFilter.op),s.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(s){return Id.create(s.compositeFilter.filters.map(a=>Are(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return Fn()}}(s.compositeFilter.op))}(r):Fn()}function aje(r){return qFe[r]}function cje(r){return YFe[r]}function lje(r){return XFe[r]}function aS(r){return{fieldPath:r.canonicalString()}}function cS(r){return Zo.fromServerFormat(r.fieldPath)}function Pre(r){return r instanceof Gs?function(s){if(s.op==="=="){if(zY(s.value))return{unaryFilter:{field:aS(s.field),op:"IS_NAN"}};if(WY(s.value))return{unaryFilter:{field:aS(s.field),op:"IS_NULL"}}}else if(s.op==="!="){if(zY(s.value))return{unaryFilter:{field:aS(s.field),op:"IS_NOT_NAN"}};if(WY(s.value))return{unaryFilter:{field:aS(s.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:aS(s.field),op:cje(s.op),value:s.value}}}(r):r instanceof Id?function(s){const a=s.getFilters().map(l=>Pre(l));return a.length===1?a[0]:{compositeFilter:{op:lje(s.op),filters:a}}}(r):Fn()}function uje(r){const t=[];return r.fields.forEach(s=>t.push(s.canonicalString())),{fieldPaths:t}}function Ore(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm{constructor(t,s,a,l,d=Gn.min(),f=Gn.min(),E=ea.EMPTY_BYTE_STRING,v=null){this.target=t,this.targetId=s,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=E,this.expectedCount=v}withSequenceNumber(t){return new Qm(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,s){return new Qm(this.target,this.targetId,this.purpose,this.sequenceNumber,s,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Qm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Qm(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dje{constructor(t){this.Tt=t}}function hje(r){const t=sje({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?KU(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pje{constructor(){this.Tn=new fje}addToCollectionParentIndex(t,s){return this.Tn.add(s),Tt.resolve()}getCollectionParents(t,s){return Tt.resolve(this.Tn.getEntries(s))}addFieldIndex(t,s){return Tt.resolve()}deleteFieldIndex(t,s){return Tt.resolve()}deleteAllFieldIndexes(t){return Tt.resolve()}createTargetIndexes(t,s){return Tt.resolve()}getDocumentsMatchingTarget(t,s){return Tt.resolve(null)}getIndexType(t,s){return Tt.resolve(0)}getFieldIndexes(t,s){return Tt.resolve([])}getNextCollectionGroupToUpdate(t){return Tt.resolve(null)}getMinOffset(t,s){return Tt.resolve(hg.min())}getMinOffsetFromCollectionGroup(t,s){return Tt.resolve(hg.min())}updateCollectionGroup(t,s,a){return Tt.resolve()}updateIndexEntries(t,s){return Tt.resolve()}}class fje{constructor(){this.index={}}add(t){const s=t.lastSegment(),a=t.popLast(),l=this.index[s]||new ro(Fi.comparator),d=!l.has(a);return this.index[s]=l.add(a),d}has(t){const s=t.lastSegment(),a=t.popLast(),l=this.index[s];return l&&l.has(a)}getEntries(t){return(this.index[t]||new ro(Fi.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rX={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},kre=41943040;class Bc{static withCacheSize(t){return new Bc(t,Bc.DEFAULT_COLLECTION_PERCENTILE,Bc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,s,a){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=s,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Bc.DEFAULT_COLLECTION_PERCENTILE=10,Bc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Bc.DEFAULT=new Bc(kre,Bc.DEFAULT_COLLECTION_PERCENTILE,Bc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Bc.DISABLED=new Bc(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0{constructor(t){this.$n=t}next(){return this.$n+=2,this.$n}static Kn(){return new o0(0)}static Un(){return new o0(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iX="LruGarbageCollector",mje=1048576;function sX([r,t],[s,a]){const l=Ir(r,s);return l===0?Ir(t,a):l}class gje{constructor(t){this.Hn=t,this.buffer=new ro(sX),this.Jn=0}Yn(){return++this.Jn}Zn(t){const s=[t,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(s);else{const a=this.buffer.last();sX(s,a)<0&&(this.buffer=this.buffer.delete(a).add(s))}}get maxValue(){return this.buffer.last()[0]}}class _je{constructor(t,s,a){this.garbageCollector=t,this.asyncQueue=s,this.localStore=a,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(t){Jt(iX,`Garbage collection scheduled in ${t}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(s){b0(s)?Jt(iX,"Ignoring IndexedDB error during garbage collection: ",s):await T0(s)}await this.er(3e5)})}}class Eje{constructor(t,s){this.tr=t,this.params=s}calculateTargetCount(t,s){return this.tr.nr(t).next(a=>Math.floor(s/100*a))}nthSequenceNumber(t,s){if(s===0)return Tt.resolve(EN.ae);const a=new gje(s);return this.tr.forEachTarget(t,l=>a.Zn(l.sequenceNumber)).next(()=>this.tr.rr(t,l=>a.Zn(l))).next(()=>a.maxValue)}removeTargets(t,s,a){return this.tr.removeTargets(t,s,a)}removeOrphanedDocuments(t,s){return this.tr.removeOrphanedDocuments(t,s)}collect(t,s){return this.params.cacheSizeCollectionThreshold===-1?(Jt("LruGarbageCollector","Garbage collection skipped; disabled"),Tt.resolve(rX)):this.getCacheSize(t).next(a=>a<this.params.cacheSizeCollectionThreshold?(Jt("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),rX):this.ir(t,s))}getCacheSize(t){return this.tr.getCacheSize(t)}ir(t,s){let a,l,d,f,E,v,T;const R=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(I=>(I>this.params.maximumSequenceNumbersToCollect?(Jt("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${I}`),l=this.params.maximumSequenceNumbersToCollect):l=I,f=Date.now(),this.nthSequenceNumber(t,l))).next(I=>(a=I,E=Date.now(),this.removeTargets(t,a,s))).next(I=>(d=I,v=Date.now(),this.removeOrphanedDocuments(t,a))).next(I=>(T=Date.now(),sS()<=vr.DEBUG&&Jt("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-R}ms
	Determined least recently used ${l} in `+(E-f)+`ms
	Removed ${d} targets in `+(v-E)+`ms
	Removed ${I} documents in `+(T-v)+`ms
Total Duration: ${T-R}ms`),Tt.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:d,documentsRemoved:I})))}}function yje(r,t){return new Eje(r,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vje{constructor(){this.changes=new kE(t=>t.toString(),(t,s)=>t.isEqual(s)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,s){this.assertNotApplied(),this.changes.set(t,Oa.newInvalidDocument(t).setReadTime(s))}getEntry(t,s){this.assertNotApplied();const a=this.changes.get(s);return a!==void 0?Tt.resolve(a):this.getFromCache(t,s)}getEntries(t,s){return this.getAllFromCache(t,s)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sje{constructor(t,s){this.overlayedDocument=t,this.mutatedFields=s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tje{constructor(t,s,a,l){this.remoteDocumentCache=t,this.mutationQueue=s,this.documentOverlayCache=a,this.indexManager=l}getDocument(t,s){let a=null;return this.documentOverlayCache.getOverlay(t,s).next(l=>(a=l,this.remoteDocumentCache.getEntry(t,s))).next(l=>(a!==null&&zw(a.mutation,l,wl.empty(),no.now()),l))}getDocuments(t,s){return this.remoteDocumentCache.getEntries(t,s).next(a=>this.getLocalViewOfDocuments(t,a,Sr()).next(()=>a))}getLocalViewOfDocuments(t,s,a=Sr()){const l=rE();return this.populateOverlays(t,l,s).next(()=>this.computeViews(t,s,l,a).next(d=>{let f=Tw();return d.forEach((E,v)=>{f=f.insert(E,v.overlayedDocument)}),f}))}getOverlayedDocuments(t,s){const a=rE();return this.populateOverlays(t,a,s).next(()=>this.computeViews(t,s,a,Sr()))}populateOverlays(t,s,a){const l=[];return a.forEach(d=>{s.has(d)||l.push(d)}),this.documentOverlayCache.getOverlays(t,l).next(d=>{d.forEach((f,E)=>{s.set(f,E)})})}computeViews(t,s,a,l){let d=Rf();const f=Ww(),E=function(){return Ww()}();return s.forEach((v,T)=>{const R=a.get(T.key);l.has(T.key)&&(R===void 0||R.mutation instanceof bg)?d=d.insert(T.key,T):R!==void 0?(f.set(T.key,R.mutation.getFieldMask()),zw(R.mutation,T,R.mutation.getFieldMask(),no.now())):f.set(T.key,wl.empty())}),this.recalculateAndSaveOverlays(t,d).next(v=>(v.forEach((T,R)=>f.set(T,R)),s.forEach((T,R)=>{var I;return E.set(T,new Sje(R,(I=f.get(T))!==null&&I!==void 0?I:null))}),E))}recalculateAndSaveOverlays(t,s){const a=Ww();let l=new os((f,E)=>f-E),d=Sr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,s).next(f=>{for(const E of f)E.keys().forEach(v=>{const T=s.get(v);if(T===null)return;let R=a.get(v)||wl.empty();R=E.applyToLocalView(T,R),a.set(v,R);const I=(l.get(E.batchId)||Sr()).add(v);l=l.insert(E.batchId,I)})}).next(()=>{const f=[],E=l.getReverseIterator();for(;E.hasNext();){const v=E.getNext(),T=v.key,R=v.value,I=hre();R.forEach(N=>{if(!d.has(N)){const F=Ere(s.get(N),a.get(N));F!==null&&I.set(N,F),d=d.add(N)}}),f.push(this.documentOverlayCache.saveOverlays(t,T,I))}return Tt.waitFor(f)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(t,s){return this.remoteDocumentCache.getEntries(t,s).next(a=>this.recalculateAndSaveOverlays(t,a))}getDocumentsMatchingQuery(t,s,a,l){return function(f){return Sn.isDocumentKey(f.path)&&f.collectionGroup===null&&f.filters.length===0}(s)?this.getDocumentsMatchingDocumentQuery(t,s.path):are(s)?this.getDocumentsMatchingCollectionGroupQuery(t,s,a,l):this.getDocumentsMatchingCollectionQuery(t,s,a,l)}getNextDocuments(t,s,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(t,s,a,l).next(d=>{const f=l-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,s,a.largestBatchId,l-d.size):Tt.resolve(rE());let E=fR,v=d;return f.next(T=>Tt.forEach(T,(R,I)=>(E<I.largestBatchId&&(E=I.largestBatchId),d.get(R)?Tt.resolve():this.remoteDocumentCache.getEntry(t,R).next(N=>{v=v.insert(R,N)}))).next(()=>this.populateOverlays(t,T,d)).next(()=>this.computeViews(t,v,T,Sr())).next(R=>({batchId:E,changes:dre(R)})))})}getDocumentsMatchingDocumentQuery(t,s){return this.getDocument(t,new Sn(s)).next(a=>{let l=Tw();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(t,s,a,l){const d=s.collectionGroup;let f=Tw();return this.indexManager.getCollectionParents(t,d).next(E=>Tt.forEach(E,v=>{const T=function(I,N){return new HR(N,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)}(s,v.child(d));return this.getDocumentsMatchingCollectionQuery(t,T,a,l).next(R=>{R.forEach((I,N)=>{f=f.insert(I,N)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(t,s,a,l){let d;return this.documentOverlayCache.getOverlaysForCollection(t,s.path,a.largestBatchId).next(f=>(d=f,this.remoteDocumentCache.getDocumentsMatchingQuery(t,s,a,d,l))).next(f=>{d.forEach((v,T)=>{const R=T.getKey();f.get(R)===null&&(f=f.insert(R,Oa.newInvalidDocument(R)))});let E=Tw();return f.forEach((v,T)=>{const R=d.get(v);R!==void 0&&zw(R.mutation,T,wl.empty(),no.now()),TN(s,T)&&(E=E.insert(v,T))}),E})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bje{constructor(t){this.serializer=t,this.dr=new Map,this.Ar=new Map}getBundleMetadata(t,s){return Tt.resolve(this.dr.get(s))}saveBundleMetadata(t,s){return this.dr.set(s.id,function(l){return{id:l.id,version:l.version,createTime:qh(l.createTime)}}(s)),Tt.resolve()}getNamedQuery(t,s){return Tt.resolve(this.Ar.get(s))}saveNamedQuery(t,s){return this.Ar.set(s.name,function(l){return{name:l.name,query:hje(l.bundledQuery),readTime:qh(l.readTime)}}(s)),Tt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wje{constructor(){this.overlays=new os(Sn.comparator),this.Rr=new Map}getOverlay(t,s){return Tt.resolve(this.overlays.get(s))}getOverlays(t,s){const a=rE();return Tt.forEach(s,l=>this.getOverlay(t,l).next(d=>{d!==null&&a.set(l,d)})).next(()=>a)}saveOverlays(t,s,a){return a.forEach((l,d)=>{this.Et(t,s,d)}),Tt.resolve()}removeOverlaysForBatchId(t,s,a){const l=this.Rr.get(a);return l!==void 0&&(l.forEach(d=>this.overlays=this.overlays.remove(d)),this.Rr.delete(a)),Tt.resolve()}getOverlaysForCollection(t,s,a){const l=rE(),d=s.length+1,f=new Sn(s.child("")),E=this.overlays.getIteratorFrom(f);for(;E.hasNext();){const v=E.getNext().value,T=v.getKey();if(!s.isPrefixOf(T.path))break;T.path.length===d&&v.largestBatchId>a&&l.set(v.getKey(),v)}return Tt.resolve(l)}getOverlaysForCollectionGroup(t,s,a,l){let d=new os((T,R)=>T-R);const f=this.overlays.getIterator();for(;f.hasNext();){const T=f.getNext().value;if(T.getKey().getCollectionGroup()===s&&T.largestBatchId>a){let R=d.get(T.largestBatchId);R===null&&(R=rE(),d=d.insert(T.largestBatchId,R)),R.set(T.getKey(),T)}}const E=rE(),v=d.getIterator();for(;v.hasNext()&&(v.getNext().value.forEach((T,R)=>E.set(T,R)),!(E.size()>=l)););return Tt.resolve(E)}Et(t,s,a){const l=this.overlays.get(a.key);if(l!==null){const f=this.Rr.get(l.largestBatchId).delete(a.key);this.Rr.set(l.largestBatchId,f)}this.overlays=this.overlays.insert(a.key,new WFe(s,a));let d=this.Rr.get(s);d===void 0&&(d=Sr(),this.Rr.set(s,d)),this.Rr.set(s,d.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rje{constructor(){this.sessionToken=ea.EMPTY_BYTE_STRING}getSessionToken(t){return Tt.resolve(this.sessionToken)}setSessionToken(t,s){return this.sessionToken=s,Tt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _j{constructor(){this.Vr=new ro(So.mr),this.gr=new ro(So.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(t,s){const a=new So(t,s);this.Vr=this.Vr.add(a),this.gr=this.gr.add(a)}yr(t,s){t.forEach(a=>this.addReference(a,s))}removeReference(t,s){this.wr(new So(t,s))}br(t,s){t.forEach(a=>this.removeReference(a,s))}Sr(t){const s=new Sn(new Fi([])),a=new So(s,t),l=new So(s,t+1),d=[];return this.gr.forEachInRange([a,l],f=>{this.wr(f),d.push(f.key)}),d}Dr(){this.Vr.forEach(t=>this.wr(t))}wr(t){this.Vr=this.Vr.delete(t),this.gr=this.gr.delete(t)}vr(t){const s=new Sn(new Fi([])),a=new So(s,t),l=new So(s,t+1);let d=Sr();return this.gr.forEachInRange([a,l],f=>{d=d.add(f.key)}),d}containsKey(t){const s=new So(t,0),a=this.Vr.firstAfterOrEqual(s);return a!==null&&t.isEqual(a.key)}}class So{constructor(t,s){this.key=t,this.Cr=s}static mr(t,s){return Sn.comparator(t.key,s.key)||Ir(t.Cr,s.Cr)}static pr(t,s){return Ir(t.Cr,s.Cr)||Sn.comparator(t.key,s.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cje{constructor(t,s){this.indexManager=t,this.referenceDelegate=s,this.mutationQueue=[],this.Fr=1,this.Mr=new ro(So.mr)}checkEmpty(t){return Tt.resolve(this.mutationQueue.length===0)}addMutationBatch(t,s,a,l){const d=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const f=new BFe(d,s,a,l);this.mutationQueue.push(f);for(const E of l)this.Mr=this.Mr.add(new So(E.key,d)),this.indexManager.addToCollectionParentIndex(t,E.key.path.popLast());return Tt.resolve(f)}lookupMutationBatch(t,s){return Tt.resolve(this.Or(s))}getNextMutationBatchAfterBatchId(t,s){const a=s+1,l=this.Nr(a),d=l<0?0:l;return Tt.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return Tt.resolve(this.mutationQueue.length===0?aj:this.Fr-1)}getAllMutationBatches(t){return Tt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,s){const a=new So(s,0),l=new So(s,Number.POSITIVE_INFINITY),d=[];return this.Mr.forEachInRange([a,l],f=>{const E=this.Or(f.Cr);d.push(E)}),Tt.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(t,s){let a=new ro(Ir);return s.forEach(l=>{const d=new So(l,0),f=new So(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([d,f],E=>{a=a.add(E.Cr)})}),Tt.resolve(this.Br(a))}getAllMutationBatchesAffectingQuery(t,s){const a=s.path,l=a.length+1;let d=a;Sn.isDocumentKey(d)||(d=d.child(""));const f=new So(new Sn(d),0);let E=new ro(Ir);return this.Mr.forEachWhile(v=>{const T=v.key.path;return!!a.isPrefixOf(T)&&(T.length===l&&(E=E.add(v.Cr)),!0)},f),Tt.resolve(this.Br(E))}Br(t){const s=[];return t.forEach(a=>{const l=this.Or(a);l!==null&&s.push(l)}),s}removeMutationBatch(t,s){ri(this.Lr(s.batchId,"removed")===0),this.mutationQueue.shift();let a=this.Mr;return Tt.forEach(s.mutations,l=>{const d=new So(l.key,s.batchId);return a=a.delete(d),this.referenceDelegate.markPotentiallyOrphaned(t,l.key)}).next(()=>{this.Mr=a})}qn(t){}containsKey(t,s){const a=new So(s,0),l=this.Mr.firstAfterOrEqual(a);return Tt.resolve(s.isEqual(l&&l.key))}performConsistencyCheck(t){return this.mutationQueue.length,Tt.resolve()}Lr(t,s){return this.Nr(t)}Nr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Or(t){const s=this.Nr(t);return s<0||s>=this.mutationQueue.length?null:this.mutationQueue[s]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ije{constructor(t){this.kr=t,this.docs=function(){return new os(Sn.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,s){const a=s.key,l=this.docs.get(a),d=l?l.size:0,f=this.kr(s);return this.docs=this.docs.insert(a,{document:s.mutableCopy(),size:f}),this.size+=f-d,this.indexManager.addToCollectionParentIndex(t,a.path.popLast())}removeEntry(t){const s=this.docs.get(t);s&&(this.docs=this.docs.remove(t),this.size-=s.size)}getEntry(t,s){const a=this.docs.get(s);return Tt.resolve(a?a.document.mutableCopy():Oa.newInvalidDocument(s))}getEntries(t,s){let a=Rf();return s.forEach(l=>{const d=this.docs.get(l);a=a.insert(l,d?d.document.mutableCopy():Oa.newInvalidDocument(l))}),Tt.resolve(a)}getDocumentsMatchingQuery(t,s,a,l){let d=Rf();const f=s.path,E=new Sn(f.child("__id-9223372036854775808__")),v=this.docs.getIteratorFrom(E);for(;v.hasNext();){const{key:T,value:{document:R}}=v.getNext();if(!f.isPrefixOf(T.path))break;T.path.length>f.length+1||nFe(tFe(R),a)<=0||(l.has(R.key)||TN(s,R))&&(d=d.insert(R.key,R.mutableCopy()))}return Tt.resolve(d)}getAllFromCollectionGroup(t,s,a,l){Fn()}qr(t,s){return Tt.forEach(this.docs,a=>s(a))}newChangeBuffer(t){return new Aje(this)}getSize(t){return Tt.resolve(this.size)}}class Aje extends vje{constructor(t){super(),this.Ir=t}applyChanges(t){const s=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?s.push(this.Ir.addEntry(t,l)):this.Ir.removeEntry(a)}),Tt.waitFor(s)}getFromCache(t,s){return this.Ir.getEntry(t,s)}getAllFromCache(t,s){return this.Ir.getEntries(t,s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pje{constructor(t){this.persistence=t,this.Qr=new kE(s=>uj(s),dj),this.lastRemoteSnapshotVersion=Gn.min(),this.highestTargetId=0,this.$r=0,this.Kr=new _j,this.targetCount=0,this.Ur=o0.Kn()}forEachTarget(t,s){return this.Qr.forEach((a,l)=>s(l)),Tt.resolve()}getLastRemoteSnapshotVersion(t){return Tt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Tt.resolve(this.$r)}allocateTargetId(t){return this.highestTargetId=this.Ur.next(),Tt.resolve(this.highestTargetId)}setTargetsMetadata(t,s,a){return a&&(this.lastRemoteSnapshotVersion=a),s>this.$r&&(this.$r=s),Tt.resolve()}zn(t){this.Qr.set(t.target,t);const s=t.targetId;s>this.highestTargetId&&(this.Ur=new o0(s),this.highestTargetId=s),t.sequenceNumber>this.$r&&(this.$r=t.sequenceNumber)}addTargetData(t,s){return this.zn(s),this.targetCount+=1,Tt.resolve()}updateTargetData(t,s){return this.zn(s),Tt.resolve()}removeTargetData(t,s){return this.Qr.delete(s.target),this.Kr.Sr(s.targetId),this.targetCount-=1,Tt.resolve()}removeTargets(t,s,a){let l=0;const d=[];return this.Qr.forEach((f,E)=>{E.sequenceNumber<=s&&a.get(E.targetId)===null&&(this.Qr.delete(f),d.push(this.removeMatchingKeysForTargetId(t,E.targetId)),l++)}),Tt.waitFor(d).next(()=>l)}getTargetCount(t){return Tt.resolve(this.targetCount)}getTargetData(t,s){const a=this.Qr.get(s)||null;return Tt.resolve(a)}addMatchingKeys(t,s,a){return this.Kr.yr(s,a),Tt.resolve()}removeMatchingKeys(t,s,a){this.Kr.br(s,a);const l=this.persistence.referenceDelegate,d=[];return l&&s.forEach(f=>{d.push(l.markPotentiallyOrphaned(t,f))}),Tt.waitFor(d)}removeMatchingKeysForTargetId(t,s){return this.Kr.Sr(s),Tt.resolve()}getMatchingKeysForTargetId(t,s){const a=this.Kr.vr(s);return Tt.resolve(a)}containsKey(t,s){return Tt.resolve(this.Kr.containsKey(s))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nre{constructor(t,s){this.Wr={},this.overlays={},this.Gr=new EN(0),this.zr=!1,this.zr=!0,this.jr=new Rje,this.referenceDelegate=t(this),this.Hr=new Pje(this),this.indexManager=new pje,this.remoteDocumentCache=function(l){return new Ije(l)}(a=>this.referenceDelegate.Jr(a)),this.serializer=new dje(s),this.Yr=new bje(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let s=this.overlays[t.toKey()];return s||(s=new wje,this.overlays[t.toKey()]=s),s}getMutationQueue(t,s){let a=this.Wr[t.toKey()];return a||(a=new Cje(s,this.referenceDelegate),this.Wr[t.toKey()]=a),a}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(t,s,a){Jt("MemoryPersistence","Starting transaction:",t);const l=new Oje(this.Gr.next());return this.referenceDelegate.Zr(),a(l).next(d=>this.referenceDelegate.Xr(l).next(()=>d)).toPromise().then(d=>(l.raiseOnCommittedEvent(),d))}ei(t,s){return Tt.or(Object.values(this.Wr).map(a=>()=>a.containsKey(t,s)))}}class Oje extends iFe{constructor(t){super(),this.currentSequenceNumber=t}}class Ej{constructor(t){this.persistence=t,this.ti=new _j,this.ni=null}static ri(t){return new Ej(t)}get ii(){if(this.ni)return this.ni;throw Fn()}addReference(t,s,a){return this.ti.addReference(a,s),this.ii.delete(a.toString()),Tt.resolve()}removeReference(t,s,a){return this.ti.removeReference(a,s),this.ii.add(a.toString()),Tt.resolve()}markPotentiallyOrphaned(t,s){return this.ii.add(s.toString()),Tt.resolve()}removeTarget(t,s){this.ti.Sr(s.targetId).forEach(l=>this.ii.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(t,s.targetId).next(l=>{l.forEach(d=>this.ii.add(d.toString()))}).next(()=>a.removeTargetData(t,s))}Zr(){this.ni=new Set}Xr(t){const s=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Tt.forEach(this.ii,a=>{const l=Sn.fromPath(a);return this.si(t,l).next(d=>{d||s.removeEntry(l,Gn.min())})}).next(()=>(this.ni=null,s.apply(t)))}updateLimboDocument(t,s){return this.si(t,s).next(a=>{a?this.ii.delete(s.toString()):this.ii.add(s.toString())})}Jr(t){return 0}si(t,s){return Tt.or([()=>Tt.resolve(this.ti.containsKey(s)),()=>this.persistence.getTargetCache().containsKey(t,s),()=>this.persistence.ei(t,s)])}}class kk{constructor(t,s){this.persistence=t,this.oi=new kE(a=>aFe(a.path),(a,l)=>a.isEqual(l)),this.garbageCollector=yje(this,s)}static ri(t,s){return new kk(t,s)}Zr(){}Xr(t){return Tt.resolve()}forEachTarget(t,s){return this.persistence.getTargetCache().forEachTarget(t,s)}nr(t){const s=this.sr(t);return this.persistence.getTargetCache().getTargetCount(t).next(a=>s.next(l=>a+l))}sr(t){let s=0;return this.rr(t,a=>{s++}).next(()=>s)}rr(t,s){return Tt.forEach(this.oi,(a,l)=>this.ar(t,a,l).next(d=>d?Tt.resolve():s(l)))}removeTargets(t,s,a){return this.persistence.getTargetCache().removeTargets(t,s,a)}removeOrphanedDocuments(t,s){let a=0;const l=this.persistence.getRemoteDocumentCache(),d=l.newChangeBuffer();return l.qr(t,f=>this.ar(t,f,s).next(E=>{E||(a++,d.removeEntry(f,Gn.min()))})).next(()=>d.apply(t)).next(()=>a)}markPotentiallyOrphaned(t,s){return this.oi.set(s,t.currentSequenceNumber),Tt.resolve()}removeTarget(t,s){const a=s.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,a)}addReference(t,s,a){return this.oi.set(a,t.currentSequenceNumber),Tt.resolve()}removeReference(t,s,a){return this.oi.set(a,t.currentSequenceNumber),Tt.resolve()}updateLimboDocument(t,s){return this.oi.set(s,t.currentSequenceNumber),Tt.resolve()}Jr(t){let s=t.key.toString().length;return t.isFoundDocument()&&(s+=WO(t.data.value)),s}ar(t,s,a){return Tt.or([()=>this.persistence.ei(t,s),()=>this.persistence.getTargetCache().containsKey(t,s),()=>{const l=this.oi.get(s);return Tt.resolve(l!==void 0&&l>a)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yj{constructor(t,s,a,l){this.targetId=t,this.fromCache=s,this.Hi=a,this.Ji=l}static Yi(t,s){let a=Sr(),l=Sr();for(const d of s.docChanges)switch(d.type){case 0:a=a.add(d.doc.key);break;case 1:l=l.add(d.doc.key)}return new yj(t,s.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kje{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nje{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return hMe()?8:sFe(Na())>0?6:4}()}initialize(t,s){this.ns=t,this.indexManager=s,this.Zi=!0}getDocumentsMatchingQuery(t,s,a,l){const d={result:null};return this.rs(t,s).next(f=>{d.result=f}).next(()=>{if(!d.result)return this.ss(t,s,l,a).next(f=>{d.result=f})}).next(()=>{if(d.result)return;const f=new kje;return this._s(t,s,f).next(E=>{if(d.result=E,this.Xi)return this.us(t,s,f,E.size)})}).next(()=>d.result)}us(t,s,a,l){return a.documentReadCount<this.es?(sS()<=vr.DEBUG&&Jt("QueryEngine","SDK will not create cache indexes for query:",oS(s),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),Tt.resolve()):(sS()<=vr.DEBUG&&Jt("QueryEngine","Query:",oS(s),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.ts*l?(sS()<=vr.DEBUG&&Jt("QueryEngine","The SDK decides to create cache indexes for query:",oS(s),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,$h(s))):Tt.resolve())}rs(t,s){if(KY(s))return Tt.resolve(null);let a=$h(s);return this.indexManager.getIndexType(t,a).next(l=>l===0?null:(s.limit!==null&&l===1&&(s=KU(s,null,"F"),a=$h(s)),this.indexManager.getDocumentsMatchingTarget(t,a).next(d=>{const f=Sr(...d);return this.ns.getDocuments(t,f).next(E=>this.indexManager.getMinOffset(t,a).next(v=>{const T=this.cs(s,E);return this.ls(s,T,f,v.readTime)?this.rs(t,KU(s,null,"F")):this.hs(t,T,s,v)}))})))}ss(t,s,a,l){return KY(s)||l.isEqual(Gn.min())?Tt.resolve(null):this.ns.getDocuments(t,a).next(d=>{const f=this.cs(s,d);return this.ls(s,f,a,l)?Tt.resolve(null):(sS()<=vr.DEBUG&&Jt("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),oS(s)),this.hs(t,f,s,eFe(l,fR)).next(E=>E))})}cs(t,s){let a=new ro(lre(t));return s.forEach((l,d)=>{TN(t,d)&&(a=a.add(d))}),a}ls(t,s,a,l){if(t.limit===null)return!1;if(a.size!==s.size)return!0;const d=t.limitType==="F"?s.last():s.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(l)>0)}_s(t,s,a){return sS()<=vr.DEBUG&&Jt("QueryEngine","Using full collection scan to execute query:",oS(s)),this.ns.getDocumentsMatchingQuery(t,s,hg.min(),a)}hs(t,s,a,l){return this.ns.getDocumentsMatchingQuery(t,a,l).next(d=>(s.forEach(f=>{d=d.insert(f.key,f)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vj="LocalStore",Dje=3e8;class Lje{constructor(t,s,a,l){this.persistence=t,this.Ps=s,this.serializer=l,this.Ts=new os(Ir),this.Is=new kE(d=>uj(d),dj),this.Es=new Map,this.ds=t.getRemoteDocumentCache(),this.Hr=t.getTargetCache(),this.Yr=t.getBundleCache(),this.As(a)}As(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Tje(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",s=>t.collect(s,this.Ts))}}function xje(r,t,s,a){return new Lje(r,t,s,a)}async function Dre(r,t){const s=qn(r);return await s.persistence.runTransaction("Handle user change","readonly",a=>{let l;return s.mutationQueue.getAllMutationBatches(a).next(d=>(l=d,s.As(t),s.mutationQueue.getAllMutationBatches(a))).next(d=>{const f=[],E=[];let v=Sr();for(const T of l){f.push(T.batchId);for(const R of T.mutations)v=v.add(R.key)}for(const T of d){E.push(T.batchId);for(const R of T.mutations)v=v.add(R.key)}return s.localDocuments.getDocuments(a,v).next(T=>({Rs:T,removedBatchIds:f,addedBatchIds:E}))})})}function Mje(r,t){const s=qn(r);return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=t.batch.keys(),d=s.ds.newChangeBuffer({trackRemovals:!0});return function(E,v,T,R){const I=T.batch,N=I.keys();let F=Tt.resolve();return N.forEach(j=>{F=F.next(()=>R.getEntry(v,j)).next(G=>{const H=T.docVersions.get(j);ri(H!==null),G.version.compareTo(H)<0&&(I.applyToRemoteDocument(G,T),G.isValidDocument()&&(G.setReadTime(T.commitVersion),R.addEntry(G)))})}),F.next(()=>E.mutationQueue.removeMutationBatch(v,I))}(s,a,t,d).next(()=>d.apply(a)).next(()=>s.mutationQueue.performConsistencyCheck(a)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(a,l,t.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(E){let v=Sr();for(let T=0;T<E.mutationResults.length;++T)E.mutationResults[T].transformResults.length>0&&(v=v.add(E.batch.mutations[T].key));return v}(t))).next(()=>s.localDocuments.getDocuments(a,l))})}function Lre(r){const t=qn(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",s=>t.Hr.getLastRemoteSnapshotVersion(s))}function Uje(r,t){const s=qn(r),a=t.snapshotVersion;let l=s.Ts;return s.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const f=s.ds.newChangeBuffer({trackRemovals:!0});l=s.Ts;const E=[];t.targetChanges.forEach((R,I)=>{const N=l.get(I);if(!N)return;E.push(s.Hr.removeMatchingKeys(d,R.removedDocuments,I).next(()=>s.Hr.addMatchingKeys(d,R.addedDocuments,I)));let F=N.withSequenceNumber(d.currentSequenceNumber);t.targetMismatches.get(I)!==null?F=F.withResumeToken(ea.EMPTY_BYTE_STRING,Gn.min()).withLastLimboFreeSnapshotVersion(Gn.min()):R.resumeToken.approximateByteSize()>0&&(F=F.withResumeToken(R.resumeToken,a)),l=l.insert(I,F),function(G,H,te){return G.resumeToken.approximateByteSize()===0||H.snapshotVersion.toMicroseconds()-G.snapshotVersion.toMicroseconds()>=Dje?!0:te.addedDocuments.size+te.modifiedDocuments.size+te.removedDocuments.size>0}(N,F,R)&&E.push(s.Hr.updateTargetData(d,F))});let v=Rf(),T=Sr();if(t.documentUpdates.forEach(R=>{t.resolvedLimboDocuments.has(R)&&E.push(s.persistence.referenceDelegate.updateLimboDocument(d,R))}),E.push(Vje(d,f,t.documentUpdates).next(R=>{v=R.Vs,T=R.fs})),!a.isEqual(Gn.min())){const R=s.Hr.getLastRemoteSnapshotVersion(d).next(I=>s.Hr.setTargetsMetadata(d,d.currentSequenceNumber,a));E.push(R)}return Tt.waitFor(E).next(()=>f.apply(d)).next(()=>s.localDocuments.getLocalViewOfDocuments(d,v,T)).next(()=>v)}).then(d=>(s.Ts=l,d))}function Vje(r,t,s){let a=Sr(),l=Sr();return s.forEach(d=>a=a.add(d)),t.getEntries(r,a).next(d=>{let f=Rf();return s.forEach((E,v)=>{const T=d.get(E);v.isFoundDocument()!==T.isFoundDocument()&&(l=l.add(E)),v.isNoDocument()&&v.version.isEqual(Gn.min())?(t.removeEntry(E,v.readTime),f=f.insert(E,v)):!T.isValidDocument()||v.version.compareTo(T.version)>0||v.version.compareTo(T.version)===0&&T.hasPendingWrites?(t.addEntry(v),f=f.insert(E,v)):Jt(vj,"Ignoring outdated watch update for ",E,". Current version:",T.version," Watch version:",v.version)}),{Vs:f,fs:l}})}function Fje(r,t){const s=qn(r);return s.persistence.runTransaction("Get next mutation batch","readonly",a=>(t===void 0&&(t=aj),s.mutationQueue.getNextMutationBatchAfterBatchId(a,t)))}function jje(r,t){const s=qn(r);return s.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return s.Hr.getTargetData(a,t).next(d=>d?(l=d,Tt.resolve(l)):s.Hr.allocateTargetId(a).next(f=>(l=new Qm(t,f,"TargetPurposeListen",a.currentSequenceNumber),s.Hr.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=s.Ts.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(s.Ts=s.Ts.insert(a.targetId,a),s.Is.set(t,a.targetId)),a})}async function QU(r,t,s){const a=qn(r),l=a.Ts.get(t),d=s?"readwrite":"readwrite-primary";try{s||await a.persistence.runTransaction("Release target",d,f=>a.persistence.referenceDelegate.removeTarget(f,l))}catch(f){if(!b0(f))throw f;Jt(vj,`Failed to update sequence numbers for target ${t}: ${f}`)}a.Ts=a.Ts.remove(t),a.Is.delete(l.target)}function oX(r,t,s){const a=qn(r);let l=Gn.min(),d=Sr();return a.persistence.runTransaction("Execute query","readwrite",f=>function(v,T,R){const I=qn(v),N=I.Is.get(R);return N!==void 0?Tt.resolve(I.Ts.get(N)):I.Hr.getTargetData(T,R)}(a,f,$h(t)).next(E=>{if(E)return l=E.lastLimboFreeSnapshotVersion,a.Hr.getMatchingKeysForTargetId(f,E.targetId).next(v=>{d=v})}).next(()=>a.Ps.getDocumentsMatchingQuery(f,t,s?l:Gn.min(),s?d:Sr())).next(E=>(Bje(a,CFe(t),E),{documents:E,gs:d})))}function Bje(r,t,s){let a=r.Es.get(t)||Gn.min();s.forEach((l,d)=>{d.readTime.compareTo(a)>0&&(a=d.readTime)}),r.Es.set(t,a)}class aX{constructor(){this.activeTargetIds=NFe()}Ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}vs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ss(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Wje{constructor(){this.ho=new aX,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,s,a){}addLocalQueryTarget(t,s=!0){return s&&this.ho.Ds(t),this.Po[t]||"not-current"}updateQueryState(t,s,a){this.Po[t]=s}removeLocalQueryTarget(t){this.ho.vs(t)}isLocalQueryTarget(t){return this.ho.activeTargetIds.has(t)}clearQueryState(t){delete this.Po[t]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(t){return this.ho.activeTargetIds.has(t)}start(){return this.ho=new aX,Promise.resolve()}handleUserChange(t,s,a){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zje{To(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cX="ConnectivityMonitor";class lX{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(t){this.Vo.push(t)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){Jt(cX,"Network connectivity changed: AVAILABLE");for(const t of this.Vo)t(0)}Ro(){Jt(cX,"Network connectivity changed: UNAVAILABLE");for(const t of this.Vo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uO=null;function ZU(){return uO===null?uO=function(){return 268435456+Math.round(2147483648*Math.random())}():uO++,"0x"+uO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T2="RestConnection",Gje={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Hje{get fo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const s=t.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=s+"://"+t.host,this.yo=`projects/${a}/databases/${l}`,this.wo=this.databaseId.database===wk?`project_id=${a}`:`project_id=${a}&database_id=${l}`}bo(t,s,a,l,d){const f=ZU(),E=this.So(t,s.toUriEncodedString());Jt(T2,`Sending RPC '${t}' ${f}:`,E,a);const v={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(v,l,d),this.vo(t,E,v,a).then(T=>(Jt(T2,`Received RPC '${t}' ${f}: `,T),T),T=>{throw n0(T2,`RPC '${t}' ${f} failed with error: `,T,"url: ",E,"request:",a),T})}Co(t,s,a,l,d,f){return this.bo(t,s,a,l,d)}Do(t,s,a){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+S0}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),s&&s.headers.forEach((l,d)=>t[d]=l),a&&a.headers.forEach((l,d)=>t[d]=l)}So(t,s){const a=Gje[t];return`${this.po}/v1/${s}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $je{constructor(t){this.Fo=t.Fo,this.Mo=t.Mo}xo(t){this.Oo=t}No(t){this.Bo=t}Lo(t){this.ko=t}onMessage(t){this.qo=t}close(){this.Mo()}send(t){this.Fo(t)}Qo(){this.Oo()}$o(){this.Bo()}Ko(t){this.ko(t)}Uo(t){this.qo(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ra="WebChannelConnection";class Kje extends Hje{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}vo(t,s,a,l){const d=ZU();return new Promise((f,E)=>{const v=new Vne;v.setWithCredentials(!0),v.listenOnce(Fne.COMPLETE,()=>{try{switch(v.getLastErrorCode()){case BO.NO_ERROR:const R=v.getResponseJson();Jt(Ra,`XHR for RPC '${t}' ${d} received:`,JSON.stringify(R)),f(R);break;case BO.TIMEOUT:Jt(Ra,`RPC '${t}' ${d} timed out`),E(new rn(bt.DEADLINE_EXCEEDED,"Request time out"));break;case BO.HTTP_ERROR:const I=v.getStatus();if(Jt(Ra,`RPC '${t}' ${d} failed with status:`,I,"response text:",v.getResponseText()),I>0){let N=v.getResponseJson();Array.isArray(N)&&(N=N[0]);const F=N==null?void 0:N.error;if(F&&F.status&&F.message){const j=function(H){const te=H.toLowerCase().replace(/_/g,"-");return Object.values(bt).indexOf(te)>=0?te:bt.UNKNOWN}(F.status);E(new rn(j,F.message))}else E(new rn(bt.UNKNOWN,"Server responded with status "+v.getStatus()))}else E(new rn(bt.UNAVAILABLE,"Connection failed."));break;default:Fn()}}finally{Jt(Ra,`RPC '${t}' ${d} completed.`)}});const T=JSON.stringify(l);Jt(Ra,`RPC '${t}' ${d} sending request:`,l),v.send(s,"POST",T,a,15)})}Wo(t,s,a){const l=ZU(),d=[this.po,"/","google.firestore.v1.Firestore","/",t,"/channel"],f=Wne(),E=Bne(),v={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},T=this.longPollingOptions.timeoutSeconds;T!==void 0&&(v.longPollingTimeout=Math.round(1e3*T)),this.useFetchStreams&&(v.useFetchStreams=!0),this.Do(v.initMessageHeaders,s,a),v.encodeInitMessageHeaders=!0;const R=d.join("");Jt(Ra,`Creating RPC '${t}' stream ${l}: ${R}`,v);const I=f.createWebChannel(R,v);let N=!1,F=!1;const j=new $je({Fo:H=>{F?Jt(Ra,`Not sending because RPC '${t}' stream ${l} is closed:`,H):(N||(Jt(Ra,`Opening RPC '${t}' stream ${l} transport.`),I.open(),N=!0),Jt(Ra,`RPC '${t}' stream ${l} sending:`,H),I.send(H))},Mo:()=>I.close()}),G=(H,te,K)=>{H.listen(te,ee=>{try{K(ee)}catch(de){setTimeout(()=>{throw de},0)}})};return G(I,Sw.EventType.OPEN,()=>{F||(Jt(Ra,`RPC '${t}' stream ${l} transport opened.`),j.Qo())}),G(I,Sw.EventType.CLOSE,()=>{F||(F=!0,Jt(Ra,`RPC '${t}' stream ${l} transport closed`),j.Ko())}),G(I,Sw.EventType.ERROR,H=>{F||(F=!0,n0(Ra,`RPC '${t}' stream ${l} transport errored:`,H),j.Ko(new rn(bt.UNAVAILABLE,"The operation could not be completed")))}),G(I,Sw.EventType.MESSAGE,H=>{var te;if(!F){const K=H.data[0];ri(!!K);const ee=K,de=(ee==null?void 0:ee.error)||((te=ee[0])===null||te===void 0?void 0:te.error);if(de){Jt(Ra,`RPC '${t}' stream ${l} received error:`,de);const se=de.status;let ge=function(ne){const oe=js[ne];if(oe!==void 0)return Sre(oe)}(se),Z=de.message;ge===void 0&&(ge=bt.INTERNAL,Z="Unknown error status: "+se+" with message "+de.message),F=!0,j.Ko(new rn(ge,Z)),I.close()}else Jt(Ra,`RPC '${t}' stream ${l} received:`,K),j.Uo(K)}}),G(E,jne.STAT_EVENT,H=>{H.stat===BU.PROXY?Jt(Ra,`RPC '${t}' stream ${l} detected buffering proxy`):H.stat===BU.NOPROXY&&Jt(Ra,`RPC '${t}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{j.$o()},0),j}}function b2(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CN(r){return new JFe(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xre{constructor(t,s,a=1e3,l=1.5,d=6e4){this.Ti=t,this.timerId=s,this.Go=a,this.zo=l,this.jo=d,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(t){this.cancel();const s=Math.floor(this.Ho+this.e_()),a=Math.max(0,Date.now()-this.Yo),l=Math.max(0,s-a);l>0&&Jt("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${s} ms, last attempt: ${a} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),t())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uX="PersistentStream";class Mre{constructor(t,s,a,l,d,f,E,v){this.Ti=t,this.n_=a,this.r_=l,this.connection=d,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=E,this.listener=v,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new xre(t,s)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(t){this.E_(),this.stream.send(t)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(t,s){this.E_(),this.d_(),this.a_.cancel(),this.i_++,t!==4?this.a_.reset():s&&s.code===bt.RESOURCE_EXHAUSTED?(wf(s.toString()),wf("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):s&&s.code===bt.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Lo(s)}A_(){}auth(){this.state=1;const t=this.R_(this.i_),s=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.i_===s&&this.V_(a,l)},a=>{t(()=>{const l=new rn(bt.UNKNOWN,"Fetching auth token failed: "+a.message);return this.m_(l)})})}V_(t,s){const a=this.R_(this.i_);this.stream=this.f_(t,s),this.stream.xo(()=>{a(()=>this.listener.xo())}),this.stream.No(()=>{a(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{a(()=>this.m_(l))}),this.stream.onMessage(l=>{a(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(t){return Jt(uX,`close with error: ${t}`),this.stream=null,this.close(4,t)}R_(t){return s=>{this.Ti.enqueueAndForget(()=>this.i_===t?s():(Jt(uX,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class qje extends Mre{constructor(t,s,a,l,d,f){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",s,a,l,f),this.serializer=d}f_(t,s){return this.connection.Wo("Listen",t,s)}g_(t){return this.onNext(t)}onNext(t){this.a_.reset();const s=eje(this.serializer,t),a=function(d){if(!("targetChange"in d))return Gn.min();const f=d.targetChange;return f.targetIds&&f.targetIds.length?Gn.min():f.readTime?qh(f.readTime):Gn.min()}(t);return this.listener.p_(s,a)}y_(t){const s={};s.database=JU(this.serializer),s.addTarget=function(d,f){let E;const v=f.target;if(E=HU(v)?{documents:rje(d,v)}:{query:ije(d,v).ht},E.targetId=f.targetId,f.resumeToken.approximateByteSize()>0){E.resumeToken=wre(d,f.resumeToken);const T=qU(d,f.expectedCount);T!==null&&(E.expectedCount=T)}else if(f.snapshotVersion.compareTo(Gn.min())>0){E.readTime=Ok(d,f.snapshotVersion.toTimestamp());const T=qU(d,f.expectedCount);T!==null&&(E.expectedCount=T)}return E}(this.serializer,t);const a=oje(this.serializer,t);a&&(s.labels=a),this.I_(s)}w_(t){const s={};s.database=JU(this.serializer),s.removeTarget=t,this.I_(s)}}class Yje extends Mre{constructor(t,s,a,l,d,f){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",s,a,l,f),this.serializer=d}get b_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.b_&&this.S_([])}f_(t,s){return this.connection.Wo("Write",t,s)}g_(t){return ri(!!t.streamToken),this.lastStreamToken=t.streamToken,ri(!t.writeResults||t.writeResults.length===0),this.listener.D_()}onNext(t){ri(!!t.streamToken),this.lastStreamToken=t.streamToken,this.a_.reset();const s=nje(t.writeResults,t.commitTime),a=qh(t.commitTime);return this.listener.v_(a,s)}C_(){const t={};t.database=JU(this.serializer),this.I_(t)}S_(t){const s={streamToken:this.lastStreamToken,writes:t.map(a=>tje(this.serializer,a))};this.I_(s)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xje{}class Jje extends Xje{constructor(t,s,a,l){super(),this.authCredentials=t,this.appCheckCredentials=s,this.connection=a,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new rn(bt.FAILED_PRECONDITION,"The client has already been terminated.")}bo(t,s,a,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,f])=>this.connection.bo(t,YU(s,a),l,d,f)).catch(d=>{throw d.name==="FirebaseError"?(d.code===bt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new rn(bt.UNKNOWN,d.toString())})}Co(t,s,a,l,d){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,E])=>this.connection.Co(t,YU(s,a),l,f,E,d)).catch(f=>{throw f.name==="FirebaseError"?(f.code===bt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new rn(bt.UNKNOWN,f.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class Qje{constructor(t,s){this.asyncQueue=t,this.onlineStateHandler=s,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(t){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.L_("Offline")))}set(t){this.Q_(),this.x_=0,t==="Online"&&(this.N_=!1),this.L_(t)}L_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}k_(t){const s=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(wf(s),this.N_=!1):Jt("OnlineStateTracker",s)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IE="RemoteStore";class Zje{constructor(t,s,a,l,d){this.localStore=t,this.datastore=s,this.asyncQueue=a,this.remoteSyncer={},this.K_=[],this.U_=new Map,this.W_=new Set,this.G_=[],this.z_=d,this.z_.To(f=>{a.enqueueAndForget(async()=>{NE(this)&&(Jt(IE,"Restarting streams for network reachability change."),await async function(v){const T=qn(v);T.W_.add(4),await qR(T),T.j_.set("Unknown"),T.W_.delete(4),await IN(T)}(this))})}),this.j_=new Qje(a,l)}}async function IN(r){if(NE(r))for(const t of r.G_)await t(!0)}async function qR(r){for(const t of r.G_)await t(!1)}function Ure(r,t){const s=qn(r);s.U_.has(t.targetId)||(s.U_.set(t.targetId,t),wj(s)?bj(s):w0(s).c_()&&Tj(s,t))}function Sj(r,t){const s=qn(r),a=w0(s);s.U_.delete(t),a.c_()&&Vre(s,t),s.U_.size===0&&(a.c_()?a.P_():NE(s)&&s.j_.set("Unknown"))}function Tj(r,t){if(r.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Gn.min())>0){const s=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(s)}w0(r).y_(t)}function Vre(r,t){r.H_.Ne(t),w0(r).w_(t)}function bj(r){r.H_=new KFe({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>r.U_.get(t)||null,it:()=>r.datastore.serializer.databaseId}),w0(r).start(),r.j_.B_()}function wj(r){return NE(r)&&!w0(r).u_()&&r.U_.size>0}function NE(r){return qn(r).W_.size===0}function Fre(r){r.H_=void 0}async function e4e(r){r.j_.set("Online")}async function t4e(r){r.U_.forEach((t,s)=>{Tj(r,t)})}async function n4e(r,t){Fre(r),wj(r)?(r.j_.q_(t),bj(r)):r.j_.set("Unknown")}async function r4e(r,t,s){if(r.j_.set("Online"),t instanceof bre&&t.state===2&&t.cause)try{await async function(l,d){const f=d.cause;for(const E of d.targetIds)l.U_.has(E)&&(await l.remoteSyncer.rejectListen(E,f),l.U_.delete(E),l.H_.removeTarget(E))}(r,t)}catch(a){Jt(IE,"Failed to remove targets %s: %s ",t.targetIds.join(","),a),await Nk(r,a)}else if(t instanceof HO?r.H_.We(t):t instanceof Tre?r.H_.Ze(t):r.H_.je(t),!s.isEqual(Gn.min()))try{const a=await Lre(r.localStore);s.compareTo(a)>=0&&await function(d,f){const E=d.H_.ot(f);return E.targetChanges.forEach((v,T)=>{if(v.resumeToken.approximateByteSize()>0){const R=d.U_.get(T);R&&d.U_.set(T,R.withResumeToken(v.resumeToken,f))}}),E.targetMismatches.forEach((v,T)=>{const R=d.U_.get(v);if(!R)return;d.U_.set(v,R.withResumeToken(ea.EMPTY_BYTE_STRING,R.snapshotVersion)),Vre(d,v);const I=new Qm(R.target,v,T,R.sequenceNumber);Tj(d,I)}),d.remoteSyncer.applyRemoteEvent(E)}(r,s)}catch(a){Jt(IE,"Failed to raise snapshot:",a),await Nk(r,a)}}async function Nk(r,t,s){if(!b0(t))throw t;r.W_.add(1),await qR(r),r.j_.set("Offline"),s||(s=()=>Lre(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{Jt(IE,"Retrying IndexedDB access"),await s(),r.W_.delete(1),await IN(r)})}function jre(r,t){return t().catch(s=>Nk(r,s,t))}async function AN(r){const t=qn(r),s=gg(t);let a=t.K_.length>0?t.K_[t.K_.length-1].batchId:aj;for(;i4e(t);)try{const l=await Fje(t.localStore,a);if(l===null){t.K_.length===0&&s.P_();break}a=l.batchId,s4e(t,l)}catch(l){await Nk(t,l)}Bre(t)&&Wre(t)}function i4e(r){return NE(r)&&r.K_.length<10}function s4e(r,t){r.K_.push(t);const s=gg(r);s.c_()&&s.b_&&s.S_(t.mutations)}function Bre(r){return NE(r)&&!gg(r).u_()&&r.K_.length>0}function Wre(r){gg(r).start()}async function o4e(r){gg(r).C_()}async function a4e(r){const t=gg(r);for(const s of r.K_)t.S_(s.mutations)}async function c4e(r,t,s){const a=r.K_.shift(),l=fj.from(a,t,s);await jre(r,()=>r.remoteSyncer.applySuccessfulWrite(l)),await AN(r)}async function l4e(r,t){t&&gg(r).b_&&await async function(a,l){if(function(f){return GFe(f)&&f!==bt.ABORTED}(l.code)){const d=a.K_.shift();gg(a).h_(),await jre(a,()=>a.remoteSyncer.rejectFailedWrite(d.batchId,l)),await AN(a)}}(r,t),Bre(r)&&Wre(r)}async function dX(r,t){const s=qn(r);s.asyncQueue.verifyOperationInProgress(),Jt(IE,"RemoteStore received new credentials");const a=NE(s);s.W_.add(3),await qR(s),a&&s.j_.set("Unknown"),await s.remoteSyncer.handleCredentialChange(t),s.W_.delete(3),await IN(s)}async function u4e(r,t){const s=qn(r);t?(s.W_.delete(2),await IN(s)):t||(s.W_.add(2),await qR(s),s.j_.set("Unknown"))}function w0(r){return r.J_||(r.J_=function(s,a,l){const d=qn(s);return d.M_(),new qje(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(r.datastore,r.asyncQueue,{xo:e4e.bind(null,r),No:t4e.bind(null,r),Lo:n4e.bind(null,r),p_:r4e.bind(null,r)}),r.G_.push(async t=>{t?(r.J_.h_(),wj(r)?bj(r):r.j_.set("Unknown")):(await r.J_.stop(),Fre(r))})),r.J_}function gg(r){return r.Y_||(r.Y_=function(s,a,l){const d=qn(s);return d.M_(),new Yje(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(r.datastore,r.asyncQueue,{xo:()=>Promise.resolve(),No:o4e.bind(null,r),Lo:l4e.bind(null,r),D_:a4e.bind(null,r),v_:c4e.bind(null,r)}),r.G_.push(async t=>{t?(r.Y_.h_(),await AN(r)):(await r.Y_.stop(),r.K_.length>0&&(Jt(IE,`Stopping write stream with ${r.K_.length} pending writes`),r.K_=[]))})),r.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rj{constructor(t,s,a,l,d){this.asyncQueue=t,this.timerId=s,this.targetTimeMs=a,this.op=l,this.removalCallback=d,this.deferred=new _f,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(f=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,s,a,l,d){const f=Date.now()+a,E=new Rj(t,s,f,l,d);return E.start(a),E}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new rn(bt.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Cj(r,t){if(wf("AsyncQueue",`${t}: ${r}`),b0(r))return new rn(bt.UNAVAILABLE,`${t}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FS{static emptySet(t){return new FS(t.comparator)}constructor(t){this.comparator=t?(s,a)=>t(s,a)||Sn.comparator(s.key,a.key):(s,a)=>Sn.comparator(s.key,a.key),this.keyedMap=Tw(),this.sortedSet=new os(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const s=this.keyedMap.get(t);return s?this.sortedSet.indexOf(s):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((s,a)=>(t(s),!1))}add(t){const s=this.delete(t.key);return s.copy(s.keyedMap.insert(t.key,t),s.sortedSet.insert(t,null))}delete(t){const s=this.get(t);return s?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(s)):this}isEqual(t){if(!(t instanceof FS)||this.size!==t.size)return!1;const s=this.sortedSet.getIterator(),a=t.sortedSet.getIterator();for(;s.hasNext();){const l=s.getNext().key,d=a.getNext().key;if(!l.isEqual(d))return!1}return!0}toString(){const t=[];return this.forEach(s=>{t.push(s.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,s){const a=new FS;return a.comparator=this.comparator,a.keyedMap=t,a.sortedSet=s,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hX{constructor(){this.Z_=new os(Sn.comparator)}track(t){const s=t.doc.key,a=this.Z_.get(s);a?t.type!==0&&a.type===3?this.Z_=this.Z_.insert(s,t):t.type===3&&a.type!==1?this.Z_=this.Z_.insert(s,{type:a.type,doc:t.doc}):t.type===2&&a.type===2?this.Z_=this.Z_.insert(s,{type:2,doc:t.doc}):t.type===2&&a.type===0?this.Z_=this.Z_.insert(s,{type:0,doc:t.doc}):t.type===1&&a.type===0?this.Z_=this.Z_.remove(s):t.type===1&&a.type===2?this.Z_=this.Z_.insert(s,{type:1,doc:a.doc}):t.type===0&&a.type===1?this.Z_=this.Z_.insert(s,{type:2,doc:t.doc}):Fn():this.Z_=this.Z_.insert(s,t)}X_(){const t=[];return this.Z_.inorderTraversal((s,a)=>{t.push(a)}),t}}class a0{constructor(t,s,a,l,d,f,E,v,T){this.query=t,this.docs=s,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=d,this.fromCache=f,this.syncStateChanged=E,this.excludesMetadataChanges=v,this.hasCachedResults=T}static fromInitialDocuments(t,s,a,l,d){const f=[];return s.forEach(E=>{f.push({type:0,doc:E})}),new a0(t,s,FS.emptySet(s),f,a,l,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&SN(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const s=this.docChanges,a=t.docChanges;if(s.length!==a.length)return!1;for(let l=0;l<s.length;l++)if(s[l].type!==a[l].type||!s[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d4e{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(t=>t.ra())}}class h4e{constructor(){this.queries=pX(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(s,a){const l=qn(s),d=l.queries;l.queries=pX(),d.forEach((f,E)=>{for(const v of E.ta)v.onError(a)})})(this,new rn(bt.ABORTED,"Firestore shutting down"))}}function pX(){return new kE(r=>cre(r),SN)}async function zre(r,t){const s=qn(r);let a=3;const l=t.query;let d=s.queries.get(l);d?!d.na()&&t.ra()&&(a=2):(d=new d4e,a=t.ra()?0:1);try{switch(a){case 0:d.ea=await s.onListen(l,!0);break;case 1:d.ea=await s.onListen(l,!1);break;case 2:await s.onFirstRemoteStoreListen(l)}}catch(f){const E=Cj(f,`Initialization of query '${oS(t.query)}' failed`);return void t.onError(E)}s.queries.set(l,d),d.ta.push(t),t.sa(s.onlineState),d.ea&&t.oa(d.ea)&&Ij(s)}async function Gre(r,t){const s=qn(r),a=t.query;let l=3;const d=s.queries.get(a);if(d){const f=d.ta.indexOf(t);f>=0&&(d.ta.splice(f,1),d.ta.length===0?l=t.ra()?0:1:!d.na()&&t.ra()&&(l=2))}switch(l){case 0:return s.queries.delete(a),s.onUnlisten(a,!0);case 1:return s.queries.delete(a),s.onUnlisten(a,!1);case 2:return s.onLastRemoteStoreUnlisten(a);default:return}}function p4e(r,t){const s=qn(r);let a=!1;for(const l of t){const d=l.query,f=s.queries.get(d);if(f){for(const E of f.ta)E.oa(l)&&(a=!0);f.ea=l}}a&&Ij(s)}function f4e(r,t,s){const a=qn(r),l=a.queries.get(t);if(l)for(const d of l.ta)d.onError(s);a.queries.delete(t)}function Ij(r){r.ia.forEach(t=>{t.next()})}var eV,fX;(fX=eV||(eV={}))._a="default",fX.Cache="cache";class Hre{constructor(t,s,a){this.query=t,this.aa=s,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=a||{}}oa(t){if(!this.options.includeMetadataChanges){const a=[];for(const l of t.docChanges)l.type!==3&&a.push(l);t=new a0(t.query,t.docs,t.oldDocs,a,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let s=!1;return this.ua?this.la(t)&&(this.aa.next(t),s=!0):this.ha(t,this.onlineState)&&(this.Pa(t),s=!0),this.ca=t,s}onError(t){this.aa.error(t)}sa(t){this.onlineState=t;let s=!1;return this.ca&&!this.ua&&this.ha(this.ca,t)&&(this.Pa(this.ca),s=!0),s}ha(t,s){if(!t.fromCache||!this.ra())return!0;const a=s!=="Offline";return(!this.options.Ta||!a)&&(!t.docs.isEmpty()||t.hasCachedResults||s==="Offline")}la(t){if(t.docChanges.length>0)return!0;const s=this.ca&&this.ca.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!s)&&this.options.includeMetadataChanges===!0}Pa(t){t=a0.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ua=!0,this.aa.next(t)}ra(){return this.options.source!==eV.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $re{constructor(t){this.key=t}}class Kre{constructor(t){this.key=t}}class m4e{constructor(t,s){this.query=t,this.fa=s,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Sr(),this.mutatedKeys=Sr(),this.ya=lre(t),this.wa=new FS(this.ya)}get ba(){return this.fa}Sa(t,s){const a=s?s.Da:new hX,l=s?s.wa:this.wa;let d=s?s.mutatedKeys:this.mutatedKeys,f=l,E=!1;const v=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,T=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(t.inorderTraversal((R,I)=>{const N=l.get(R),F=TN(this.query,I)?I:null,j=!!N&&this.mutatedKeys.has(N.key),G=!!F&&(F.hasLocalMutations||this.mutatedKeys.has(F.key)&&F.hasCommittedMutations);let H=!1;N&&F?N.data.isEqual(F.data)?j!==G&&(a.track({type:3,doc:F}),H=!0):this.va(N,F)||(a.track({type:2,doc:F}),H=!0,(v&&this.ya(F,v)>0||T&&this.ya(F,T)<0)&&(E=!0)):!N&&F?(a.track({type:0,doc:F}),H=!0):N&&!F&&(a.track({type:1,doc:N}),H=!0,(v||T)&&(E=!0)),H&&(F?(f=f.add(F),d=G?d.add(R):d.delete(R)):(f=f.delete(R),d=d.delete(R)))}),this.query.limit!==null)for(;f.size>this.query.limit;){const R=this.query.limitType==="F"?f.last():f.first();f=f.delete(R.key),d=d.delete(R.key),a.track({type:1,doc:R})}return{wa:f,Da:a,ls:E,mutatedKeys:d}}va(t,s){return t.hasLocalMutations&&s.hasCommittedMutations&&!s.hasLocalMutations}applyChanges(t,s,a,l){const d=this.wa;this.wa=t.wa,this.mutatedKeys=t.mutatedKeys;const f=t.Da.X_();f.sort((R,I)=>function(F,j){const G=H=>{switch(H){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Fn()}};return G(F)-G(j)}(R.type,I.type)||this.ya(R.doc,I.doc)),this.Ca(a),l=l!=null&&l;const E=s&&!l?this.Fa():[],v=this.pa.size===0&&this.current&&!l?1:0,T=v!==this.ga;return this.ga=v,f.length!==0||T?{snapshot:new a0(this.query,t.wa,d,f,t.mutatedKeys,v===0,T,!1,!!a&&a.resumeToken.approximateByteSize()>0),Ma:E}:{Ma:E}}sa(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new hX,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(t){return!this.fa.has(t)&&!!this.wa.has(t)&&!this.wa.get(t).hasLocalMutations}Ca(t){t&&(t.addedDocuments.forEach(s=>this.fa=this.fa.add(s)),t.modifiedDocuments.forEach(s=>{}),t.removedDocuments.forEach(s=>this.fa=this.fa.delete(s)),this.current=t.current)}Fa(){if(!this.current)return[];const t=this.pa;this.pa=Sr(),this.wa.forEach(a=>{this.xa(a.key)&&(this.pa=this.pa.add(a.key))});const s=[];return t.forEach(a=>{this.pa.has(a)||s.push(new Kre(a))}),this.pa.forEach(a=>{t.has(a)||s.push(new $re(a))}),s}Oa(t){this.fa=t.gs,this.pa=Sr();const s=this.Sa(t.documents);return this.applyChanges(s,!0)}Na(){return a0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const Aj="SyncEngine";class g4e{constructor(t,s,a){this.query=t,this.targetId=s,this.view=a}}class _4e{constructor(t){this.key=t,this.Ba=!1}}class E4e{constructor(t,s,a,l,d,f){this.localStore=t,this.remoteStore=s,this.eventManager=a,this.sharedClientState=l,this.currentUser=d,this.maxConcurrentLimboResolutions=f,this.La={},this.ka=new kE(E=>cre(E),SN),this.qa=new Map,this.Qa=new Set,this.$a=new os(Sn.comparator),this.Ka=new Map,this.Ua=new _j,this.Wa={},this.Ga=new Map,this.za=o0.Un(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function y4e(r,t,s=!0){const a=Zre(r);let l;const d=a.ka.get(t);return d?(a.sharedClientState.addLocalQueryTarget(d.targetId),l=d.view.Na()):l=await qre(a,t,s,!0),l}async function v4e(r,t){const s=Zre(r);await qre(s,t,!0,!1)}async function qre(r,t,s,a){const l=await jje(r.localStore,$h(t)),d=l.targetId,f=r.sharedClientState.addLocalQueryTarget(d,s);let E;return a&&(E=await S4e(r,t,d,f==="current",l.resumeToken)),r.isPrimaryClient&&s&&Ure(r.remoteStore,l),E}async function S4e(r,t,s,a,l){r.Ha=(I,N,F)=>async function(G,H,te,K){let ee=H.view.Sa(te);ee.ls&&(ee=await oX(G.localStore,H.query,!1).then(({documents:Z})=>H.view.Sa(Z,ee)));const de=K&&K.targetChanges.get(H.targetId),se=K&&K.targetMismatches.get(H.targetId)!=null,ge=H.view.applyChanges(ee,G.isPrimaryClient,de,se);return gX(G,H.targetId,ge.Ma),ge.snapshot}(r,I,N,F);const d=await oX(r.localStore,t,!0),f=new m4e(t,d.gs),E=f.Sa(d.documents),v=KR.createSynthesizedTargetChangeForCurrentChange(s,a&&r.onlineState!=="Offline",l),T=f.applyChanges(E,r.isPrimaryClient,v);gX(r,s,T.Ma);const R=new g4e(t,s,f);return r.ka.set(t,R),r.qa.has(s)?r.qa.get(s).push(t):r.qa.set(s,[t]),T.snapshot}async function T4e(r,t,s){const a=qn(r),l=a.ka.get(t),d=a.qa.get(l.targetId);if(d.length>1)return a.qa.set(l.targetId,d.filter(f=>!SN(f,t))),void a.ka.delete(t);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await QU(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),s&&Sj(a.remoteStore,l.targetId),tV(a,l.targetId)}).catch(T0)):(tV(a,l.targetId),await QU(a.localStore,l.targetId,!0))}async function b4e(r,t){const s=qn(r),a=s.ka.get(t),l=s.qa.get(a.targetId);s.isPrimaryClient&&l.length===1&&(s.sharedClientState.removeLocalQueryTarget(a.targetId),Sj(s.remoteStore,a.targetId))}async function w4e(r,t,s){const a=k4e(r);try{const l=await function(f,E){const v=qn(f),T=no.now(),R=E.reduce((F,j)=>F.add(j.key),Sr());let I,N;return v.persistence.runTransaction("Locally write mutations","readwrite",F=>{let j=Rf(),G=Sr();return v.ds.getEntries(F,R).next(H=>{j=H,j.forEach((te,K)=>{K.isValidDocument()||(G=G.add(te))})}).next(()=>v.localDocuments.getOverlayedDocuments(F,j)).next(H=>{I=H;const te=[];for(const K of E){const ee=FFe(K,I.get(K.key).overlayedDocument);ee!=null&&te.push(new bg(K.key,ee,ere(ee.value.mapValue),Kh.exists(!0)))}return v.mutationQueue.addMutationBatch(F,T,te,E)}).next(H=>{N=H;const te=H.applyToLocalDocumentSet(I,G);return v.documentOverlayCache.saveOverlays(F,H.batchId,te)})}).then(()=>({batchId:N.batchId,changes:dre(I)}))}(a.localStore,t);a.sharedClientState.addPendingMutation(l.batchId),function(f,E,v){let T=f.Wa[f.currentUser.toKey()];T||(T=new os(Ir)),T=T.insert(E,v),f.Wa[f.currentUser.toKey()]=T}(a,l.batchId,s),await YR(a,l.changes),await AN(a.remoteStore)}catch(l){const d=Cj(l,"Failed to persist write");s.reject(d)}}async function Yre(r,t){const s=qn(r);try{const a=await Uje(s.localStore,t);t.targetChanges.forEach((l,d)=>{const f=s.Ka.get(d);f&&(ri(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?f.Ba=!0:l.modifiedDocuments.size>0?ri(f.Ba):l.removedDocuments.size>0&&(ri(f.Ba),f.Ba=!1))}),await YR(s,a,t)}catch(a){await T0(a)}}function mX(r,t,s){const a=qn(r);if(a.isPrimaryClient&&s===0||!a.isPrimaryClient&&s===1){const l=[];a.ka.forEach((d,f)=>{const E=f.view.sa(t);E.snapshot&&l.push(E.snapshot)}),function(f,E){const v=qn(f);v.onlineState=E;let T=!1;v.queries.forEach((R,I)=>{for(const N of I.ta)N.sa(E)&&(T=!0)}),T&&Ij(v)}(a.eventManager,t),l.length&&a.La.p_(l),a.onlineState=t,a.isPrimaryClient&&a.sharedClientState.setOnlineState(t)}}async function R4e(r,t,s){const a=qn(r);a.sharedClientState.updateQueryState(t,"rejected",s);const l=a.Ka.get(t),d=l&&l.key;if(d){let f=new os(Sn.comparator);f=f.insert(d,Oa.newNoDocument(d,Gn.min()));const E=Sr().add(d),v=new RN(Gn.min(),new Map,new os(Ir),f,E);await Yre(a,v),a.$a=a.$a.remove(d),a.Ka.delete(t),Pj(a)}else await QU(a.localStore,t,!1).then(()=>tV(a,t,s)).catch(T0)}async function C4e(r,t){const s=qn(r),a=t.batch.batchId;try{const l=await Mje(s.localStore,t);Jre(s,a,null),Xre(s,a),s.sharedClientState.updateMutationState(a,"acknowledged"),await YR(s,l)}catch(l){await T0(l)}}async function I4e(r,t,s){const a=qn(r);try{const l=await function(f,E){const v=qn(f);return v.persistence.runTransaction("Reject batch","readwrite-primary",T=>{let R;return v.mutationQueue.lookupMutationBatch(T,E).next(I=>(ri(I!==null),R=I.keys(),v.mutationQueue.removeMutationBatch(T,I))).next(()=>v.mutationQueue.performConsistencyCheck(T)).next(()=>v.documentOverlayCache.removeOverlaysForBatchId(T,R,E)).next(()=>v.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(T,R)).next(()=>v.localDocuments.getDocuments(T,R))})}(a.localStore,t);Jre(a,t,s),Xre(a,t),a.sharedClientState.updateMutationState(t,"rejected",s),await YR(a,l)}catch(l){await T0(l)}}function Xre(r,t){(r.Ga.get(t)||[]).forEach(s=>{s.resolve()}),r.Ga.delete(t)}function Jre(r,t,s){const a=qn(r);let l=a.Wa[a.currentUser.toKey()];if(l){const d=l.get(t);d&&(s?d.reject(s):d.resolve(),l=l.remove(t)),a.Wa[a.currentUser.toKey()]=l}}function tV(r,t,s=null){r.sharedClientState.removeLocalQueryTarget(t);for(const a of r.qa.get(t))r.ka.delete(a),s&&r.La.Ja(a,s);r.qa.delete(t),r.isPrimaryClient&&r.Ua.Sr(t).forEach(a=>{r.Ua.containsKey(a)||Qre(r,a)})}function Qre(r,t){r.Qa.delete(t.path.canonicalString());const s=r.$a.get(t);s!==null&&(Sj(r.remoteStore,s),r.$a=r.$a.remove(t),r.Ka.delete(s),Pj(r))}function gX(r,t,s){for(const a of s)a instanceof $re?(r.Ua.addReference(a.key,t),A4e(r,a)):a instanceof Kre?(Jt(Aj,"Document no longer in limbo: "+a.key),r.Ua.removeReference(a.key,t),r.Ua.containsKey(a.key)||Qre(r,a.key)):Fn()}function A4e(r,t){const s=t.key,a=s.path.canonicalString();r.$a.get(s)||r.Qa.has(a)||(Jt(Aj,"New document in limbo: "+s),r.Qa.add(a),Pj(r))}function Pj(r){for(;r.Qa.size>0&&r.$a.size<r.maxConcurrentLimboResolutions;){const t=r.Qa.values().next().value;r.Qa.delete(t);const s=new Sn(Fi.fromString(t)),a=r.za.next();r.Ka.set(a,new _4e(s)),r.$a=r.$a.insert(s,a),Ure(r.remoteStore,new Qm($h(hj(s.path)),a,"TargetPurposeLimboResolution",EN.ae))}}async function YR(r,t,s){const a=qn(r),l=[],d=[],f=[];a.ka.isEmpty()||(a.ka.forEach((E,v)=>{f.push(a.Ha(v,t,s).then(T=>{var R;if((T||s)&&a.isPrimaryClient){const I=T?!T.fromCache:(R=s==null?void 0:s.targetChanges.get(v.targetId))===null||R===void 0?void 0:R.current;a.sharedClientState.updateQueryState(v.targetId,I?"current":"not-current")}if(T){l.push(T);const I=yj.Yi(v.targetId,T);d.push(I)}}))}),await Promise.all(f),a.La.p_(l),await async function(v,T){const R=qn(v);try{await R.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>Tt.forEach(T,N=>Tt.forEach(N.Hi,F=>R.persistence.referenceDelegate.addReference(I,N.targetId,F)).next(()=>Tt.forEach(N.Ji,F=>R.persistence.referenceDelegate.removeReference(I,N.targetId,F)))))}catch(I){if(!b0(I))throw I;Jt(vj,"Failed to update sequence numbers: "+I)}for(const I of T){const N=I.targetId;if(!I.fromCache){const F=R.Ts.get(N),j=F.snapshotVersion,G=F.withLastLimboFreeSnapshotVersion(j);R.Ts=R.Ts.insert(N,G)}}}(a.localStore,d))}async function P4e(r,t){const s=qn(r);if(!s.currentUser.isEqual(t)){Jt(Aj,"User change. New user:",t.toKey());const a=await Dre(s.localStore,t);s.currentUser=t,function(d,f){d.Ga.forEach(E=>{E.forEach(v=>{v.reject(new rn(bt.CANCELLED,f))})}),d.Ga.clear()}(s,"'waitForPendingWrites' promise is rejected due to a user change."),s.sharedClientState.handleUserChange(t,a.removedBatchIds,a.addedBatchIds),await YR(s,a.Rs)}}function O4e(r,t){const s=qn(r),a=s.Ka.get(t);if(a&&a.Ba)return Sr().add(a.key);{let l=Sr();const d=s.qa.get(t);if(!d)return l;for(const f of d){const E=s.ka.get(f);l=l.unionWith(E.view.ba)}return l}}function Zre(r){const t=qn(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=Yre.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=O4e.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=R4e.bind(null,t),t.La.p_=p4e.bind(null,t.eventManager),t.La.Ja=f4e.bind(null,t.eventManager),t}function k4e(r){const t=qn(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=C4e.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=I4e.bind(null,t),t}class Dk{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=CN(t.databaseInfo.databaseId),this.sharedClientState=this.Za(t),this.persistence=this.Xa(t),await this.persistence.start(),this.localStore=this.eu(t),this.gcScheduler=this.tu(t,this.localStore),this.indexBackfillerScheduler=this.nu(t,this.localStore)}tu(t,s){return null}nu(t,s){return null}eu(t){return xje(this.persistence,new Nje,t.initialUser,this.serializer)}Xa(t){return new Nre(Ej.ri,this.serializer)}Za(t){return new Wje}async terminate(){var t,s;(t=this.gcScheduler)===null||t===void 0||t.stop(),(s=this.indexBackfillerScheduler)===null||s===void 0||s.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Dk.provider={build:()=>new Dk};class N4e extends Dk{constructor(t){super(),this.cacheSizeBytes=t}tu(t,s){ri(this.persistence.referenceDelegate instanceof kk);const a=this.persistence.referenceDelegate.garbageCollector;return new _je(a,t.asyncQueue,s)}Xa(t){const s=this.cacheSizeBytes!==void 0?Bc.withCacheSize(this.cacheSizeBytes):Bc.DEFAULT;return new Nre(a=>kk.ri(a,s),this.serializer)}}class nV{async initialize(t,s){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(s),this.remoteStore=this.createRemoteStore(s),this.eventManager=this.createEventManager(s),this.syncEngine=this.createSyncEngine(s,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>mX(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=P4e.bind(null,this.syncEngine),await u4e(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new h4e}()}createDatastore(t){const s=CN(t.databaseInfo.databaseId),a=function(d){return new Kje(d)}(t.databaseInfo);return function(d,f,E,v){return new Jje(d,f,E,v)}(t.authCredentials,t.appCheckCredentials,a,s)}createRemoteStore(t){return function(a,l,d,f,E){return new Zje(a,l,d,f,E)}(this.localStore,this.datastore,t.asyncQueue,s=>mX(this.syncEngine,s,0),function(){return lX.D()?new lX:new zje}())}createSyncEngine(t,s){return function(l,d,f,E,v,T,R){const I=new E4e(l,d,f,E,v,T);return R&&(I.ja=!0),I}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,s)}async terminate(){var t,s;await async function(l){const d=qn(l);Jt(IE,"RemoteStore shutting down."),d.W_.add(5),await qR(d),d.z_.shutdown(),d.j_.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(s=this.eventManager)===null||s===void 0||s.terminate()}}nV.provider={build:()=>new nV};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eie{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.iu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.iu(this.observer.error,t):wf("Uncaught Error in snapshot listener:",t.toString()))}su(){this.muted=!0}iu(t,s){setTimeout(()=>{this.muted||t(s)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _g="FirestoreClient";class D4e{constructor(t,s,a,l,d){this.authCredentials=t,this.appCheckCredentials=s,this.asyncQueue=a,this.databaseInfo=l,this.user=Aa.UNAUTHENTICATED,this.clientId=Gne.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=d,this.authCredentials.start(a,async f=>{Jt(_g,"Received user=",f.uid),await this.authCredentialListener(f),this.user=f}),this.appCheckCredentials.start(a,f=>(Jt(_g,"Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new _f;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(s){const a=Cj(s,"Failed to shutdown persistence");t.reject(a)}}),t.promise}}async function w2(r,t){r.asyncQueue.verifyOperationInProgress(),Jt(_g,"Initializing OfflineComponentProvider");const s=r.configuration;await t.initialize(s);let a=s.initialUser;r.setCredentialChangeListener(async l=>{a.isEqual(l)||(await Dre(t.localStore,l),a=l)}),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t}async function _X(r,t){r.asyncQueue.verifyOperationInProgress();const s=await L4e(r);Jt(_g,"Initializing OnlineComponentProvider"),await t.initialize(s,r.configuration),r.setCredentialChangeListener(a=>dX(t.remoteStore,a)),r.setAppCheckTokenChangeListener((a,l)=>dX(t.remoteStore,l)),r._onlineComponents=t}async function L4e(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){Jt(_g,"Using user provided OfflineComponentProvider");try{await w2(r,r._uninitializedComponentsProvider._offline)}catch(t){const s=t;if(!function(l){return l.name==="FirebaseError"?l.code===bt.FAILED_PRECONDITION||l.code===bt.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(s))throw s;n0("Error using user provided cache. Falling back to memory cache: "+s),await w2(r,new Dk)}}else Jt(_g,"Using default OfflineComponentProvider"),await w2(r,new N4e(void 0));return r._offlineComponents}async function tie(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(Jt(_g,"Using user provided OnlineComponentProvider"),await _X(r,r._uninitializedComponentsProvider._online)):(Jt(_g,"Using default OnlineComponentProvider"),await _X(r,new nV))),r._onlineComponents}function x4e(r){return tie(r).then(t=>t.syncEngine)}async function nie(r){const t=await tie(r),s=t.eventManager;return s.onListen=y4e.bind(null,t.syncEngine),s.onUnlisten=T4e.bind(null,t.syncEngine),s.onFirstRemoteStoreListen=v4e.bind(null,t.syncEngine),s.onLastRemoteStoreUnlisten=b4e.bind(null,t.syncEngine),s}function M4e(r,t,s={}){const a=new _f;return r.asyncQueue.enqueueAndForget(async()=>function(d,f,E,v,T){const R=new eie({next:N=>{R.su(),f.enqueueAndForget(()=>Gre(d,I));const F=N.docs.has(E);!F&&N.fromCache?T.reject(new rn(bt.UNAVAILABLE,"Failed to get document because the client is offline.")):F&&N.fromCache&&v&&v.source==="server"?T.reject(new rn(bt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):T.resolve(N)},error:N=>T.reject(N)}),I=new Hre(hj(E.path),R,{includeMetadataChanges:!0,Ta:!0});return zre(d,I)}(await nie(r),r.asyncQueue,t,s,a)),a.promise}function U4e(r,t,s={}){const a=new _f;return r.asyncQueue.enqueueAndForget(async()=>function(d,f,E,v,T){const R=new eie({next:N=>{R.su(),f.enqueueAndForget(()=>Gre(d,I)),N.fromCache&&v.source==="server"?T.reject(new rn(bt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):T.resolve(N)},error:N=>T.reject(N)}),I=new Hre(E,R,{includeMetadataChanges:!0,Ta:!0});return zre(d,I)}(await nie(r),r.asyncQueue,t,s,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rie(r){const t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EX=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iie(r,t,s){if(!s)throw new rn(bt.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function V4e(r,t,s,a){if(t===!0&&a===!0)throw new rn(bt.INVALID_ARGUMENT,`${r} and ${s} cannot be used together.`)}function yX(r){if(!Sn.isDocumentKey(r))throw new rn(bt.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function vX(r){if(Sn.isDocumentKey(r))throw new rn(bt.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function PN(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const t=function(a){return a.constructor?a.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":Fn()}function Cf(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new rn(bt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const s=PN(r);throw new rn(bt.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${s}`)}}return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sie="firestore.googleapis.com",SX=!0;class TX{constructor(t){var s,a;if(t.host===void 0){if(t.ssl!==void 0)throw new rn(bt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=sie,this.ssl=SX}else this.host=t.host,this.ssl=(s=t.ssl)!==null&&s!==void 0?s:SX;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=kre;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<mje)throw new rn(bt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}V4e("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=rie((a=t.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new rn(bt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new rn(bt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new rn(bt.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class ON{constructor(t,s,a,l){this._authCredentials=t,this._appCheckCredentials=s,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new TX({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new rn(bt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new rn(bt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new TX(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new $Ve;switch(a.type){case"firstParty":return new XVe(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new rn(bt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(s){const a=EX.get(s);a&&(Jt("ComponentProvider","Removing Datastore"),EX.delete(s),a.terminate())}(this),Promise.resolve()}}function F4e(r,t,s,a={}){var l;const d=(r=Cf(r,ON))._getSettings(),f=Object.assign(Object.assign({},d),{emulatorOptions:r._getEmulatorOptions()}),E=`${t}:${s}`;d.host!==sie&&d.host!==E&&n0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const v=Object.assign(Object.assign({},d),{host:E,ssl:!1,emulatorOptions:a});if(!TE(v,f)&&(r._setSettings(v),a.mockUserToken)){let T,R;if(typeof a.mockUserToken=="string")T=a.mockUserToken,R=Aa.MOCK_USER;else{T=qte(a.mockUserToken,(l=r._app)===null||l===void 0?void 0:l.options.projectId);const I=a.mockUserToken.sub||a.mockUserToken.user_id;if(!I)throw new rn(bt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");R=new Aa(I)}r._authCredentials=new KVe(new zne(T,R))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R0{constructor(t,s,a){this.converter=s,this._query=a,this.type="query",this.firestore=t}withConverter(t){return new R0(this.firestore,t,this._query)}}class ec{constructor(t,s,a){this.converter=s,this._key=a,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ig(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new ec(this.firestore,t,this._key)}}class ig extends R0{constructor(t,s,a){super(t,s,hj(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new ec(this.firestore,null,new Sn(t))}withConverter(t){return new ig(this.firestore,t,this._path)}}function Lk(r,t,...s){if(r=Xi(r),iie("collection","path",t),r instanceof ON){const a=Fi.fromString(t,...s);return vX(a),new ig(r,null,a)}{if(!(r instanceof ec||r instanceof ig))throw new rn(bt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=r._path.child(Fi.fromString(t,...s));return vX(a),new ig(r.firestore,null,a)}}function ta(r,t,...s){if(r=Xi(r),arguments.length===1&&(t=Gne.newId()),iie("doc","path",t),r instanceof ON){const a=Fi.fromString(t,...s);return yX(a),new ec(r,null,new Sn(a))}{if(!(r instanceof ec||r instanceof ig))throw new rn(bt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=r._path.child(Fi.fromString(t,...s));return yX(a),new ec(r.firestore,r instanceof ig?r.converter:null,new Sn(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bX="AsyncQueue";class wX{constructor(t=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new xre(this,"async_queue_retry"),this.bu=()=>{const a=b2();a&&Jt(bX,"Visibility state changed to "+a.visibilityState),this.a_.t_()},this.Su=t;const s=b2();s&&typeof s.addEventListener=="function"&&s.addEventListener("visibilitychange",this.bu)}get isShuttingDown(){return this.mu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Du(),this.vu(t)}enterRestrictedMode(t){if(!this.mu){this.mu=!0,this.yu=t||!1;const s=b2();s&&typeof s.removeEventListener=="function"&&s.removeEventListener("visibilitychange",this.bu)}}enqueue(t){if(this.Du(),this.mu)return new Promise(()=>{});const s=new _f;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(t().then(s.resolve,s.reject),s.promise)).then(()=>s.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Vu.push(t),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(t){if(!b0(t))throw t;Jt(bX,"Operation failed with retryable error: "+t)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(t){const s=this.Su.then(()=>(this.pu=!0,t().catch(a=>{this.gu=a,this.pu=!1;const l=function(f){let E=f.message||"";return f.stack&&(E=f.stack.includes(f.message)?f.stack:f.message+`
`+f.stack),E}(a);throw wf("INTERNAL UNHANDLED ERROR: ",l),a}).then(a=>(this.pu=!1,a))));return this.Su=s,s}enqueueAfterDelay(t,s,a){this.Du(),this.wu.indexOf(t)>-1&&(s=0);const l=Rj.createAndSchedule(this,t,s,a,d=>this.Fu(d));return this.fu.push(l),l}Du(){this.gu&&Fn()}verifyOperationInProgress(){}async Mu(){let t;do t=this.Su,await t;while(t!==this.Su)}xu(t){for(const s of this.fu)if(s.timerId===t)return!0;return!1}Ou(t){return this.Mu().then(()=>{this.fu.sort((s,a)=>s.targetTimeMs-a.targetTimeMs);for(const s of this.fu)if(s.skipDelay(),t!=="all"&&s.timerId===t)break;return this.Mu()})}Nu(t){this.wu.push(t)}Fu(t){const s=this.fu.indexOf(t);this.fu.splice(s,1)}}class XR extends ON{constructor(t,s,a,l){super(t,s,a,l),this.type="firestore",this._queue=new wX,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new wX(t),this._firestoreClient=void 0,await t}}}function rV(r,t){const s=typeof r=="object"?r:JF(),a=typeof r=="string"?r:wk,l=fN(s,"firestore").getImmediate({identifier:a});if(!l._initialized){const d=Hte("firestore");d&&F4e(l,...d)}return l}function Oj(r){if(r._terminated)throw new rn(bt.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||j4e(r),r._firestoreClient}function j4e(r){var t,s,a;const l=r._freezeSettings(),d=function(E,v,T,R){return new uFe(E,v,T,R.host,R.ssl,R.experimentalForceLongPolling,R.experimentalAutoDetectLongPolling,rie(R.experimentalLongPollingOptions),R.useFetchStreams)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,l);r._componentsProvider||!((s=l.localCache)===null||s===void 0)&&s._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(r._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),r._firestoreClient=new D4e(r._authCredentials,r._appCheckCredentials,r._queue,d,r._componentsProvider&&function(E){const v=E==null?void 0:E._online.build();return{_offline:E==null?void 0:E._offline.build(v),_online:v}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c0{constructor(t){this._byteString=t}static fromBase64String(t){try{return new c0(ea.fromBase64String(t))}catch(s){throw new rn(bt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+s)}}static fromUint8Array(t){return new c0(ea.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kN{constructor(...t){for(let s=0;s<t.length;++s)if(t[s].length===0)throw new rn(bt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Zo(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kj{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nj{constructor(t,s){if(!isFinite(t)||t<-90||t>90)throw new rn(bt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(s)||s<-180||s>180)throw new rn(bt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+s);this._lat=t,this._long=s}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Ir(this._lat,t._lat)||Ir(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dj{constructor(t){this._values=(t||[]).map(s=>s)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(a,l){if(a.length!==l.length)return!1;for(let d=0;d<a.length;++d)if(a[d]!==l[d])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B4e=/^__.*__$/;class W4e{constructor(t,s,a){this.data=t,this.fieldMask=s,this.fieldTransforms=a}toMutation(t,s){return this.fieldMask!==null?new bg(t,this.data,this.fieldMask,s,this.fieldTransforms):new $R(t,this.data,s,this.fieldTransforms)}}class oie{constructor(t,s,a){this.data=t,this.fieldMask=s,this.fieldTransforms=a}toMutation(t,s){return new bg(t,this.data,this.fieldMask,s,this.fieldTransforms)}}function aie(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Fn()}}class Lj{constructor(t,s,a,l,d,f){this.settings=t,this.databaseId=s,this.serializer=a,this.ignoreUndefinedProperties=l,d===void 0&&this.Bu(),this.fieldTransforms=d||[],this.fieldMask=f||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(t){return new Lj(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(t){var s;const a=(s=this.path)===null||s===void 0?void 0:s.child(t),l=this.ku({path:a,Qu:!1});return l.$u(t),l}Ku(t){var s;const a=(s=this.path)===null||s===void 0?void 0:s.child(t),l=this.ku({path:a,Qu:!1});return l.Bu(),l}Uu(t){return this.ku({path:void 0,Qu:!0})}Wu(t){return xk(t,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(t){return this.fieldMask.find(s=>t.isPrefixOf(s))!==void 0||this.fieldTransforms.find(s=>t.isPrefixOf(s.field))!==void 0}Bu(){if(this.path)for(let t=0;t<this.path.length;t++)this.$u(this.path.get(t))}$u(t){if(t.length===0)throw this.Wu("Document fields must not be empty");if(aie(this.Lu)&&B4e.test(t))throw this.Wu('Document fields cannot begin and end with "__"')}}class z4e{constructor(t,s,a){this.databaseId=t,this.ignoreUndefinedProperties=s,this.serializer=a||CN(t)}ju(t,s,a,l=!1){return new Lj({Lu:t,methodName:s,zu:a,path:Zo.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function xj(r){const t=r._freezeSettings(),s=CN(r._databaseId);return new z4e(r._databaseId,!!t.ignoreUndefinedProperties,s)}function G4e(r,t,s,a,l,d={}){const f=r.ju(d.merge||d.mergeFields?2:0,t,s,l);Mj("Data must be an object, but it was:",f,a);const E=cie(a,f);let v,T;if(d.merge)v=new wl(f.fieldMask),T=f.fieldTransforms;else if(d.mergeFields){const R=[];for(const I of d.mergeFields){const N=iV(t,I,s);if(!f.contains(N))throw new rn(bt.INVALID_ARGUMENT,`Field '${N}' is specified in your field mask but missing from your input data.`);uie(R,N)||R.push(N)}v=new wl(R),T=f.fieldTransforms.filter(I=>v.covers(I.field))}else v=null,T=f.fieldTransforms;return new W4e(new Gc(E),v,T)}class NN extends kj{_toFieldTransform(t){if(t.Lu!==2)throw t.Lu===1?t.Wu(`${this._methodName}() can only appear at the top level of your update data`):t.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof NN}}function H4e(r,t,s,a){const l=r.ju(1,t,s);Mj("Data must be an object, but it was:",l,a);const d=[],f=Gc.empty();Tg(a,(v,T)=>{const R=Uj(t,v,s);T=Xi(T);const I=l.Ku(R);if(T instanceof NN)d.push(R);else{const N=JR(T,I);N!=null&&(d.push(R),f.set(R,N))}});const E=new wl(d);return new oie(f,E,l.fieldTransforms)}function $4e(r,t,s,a,l,d){const f=r.ju(1,t,s),E=[iV(t,a,s)],v=[l];if(d.length%2!=0)throw new rn(bt.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let N=0;N<d.length;N+=2)E.push(iV(t,d[N])),v.push(d[N+1]);const T=[],R=Gc.empty();for(let N=E.length-1;N>=0;--N)if(!uie(T,E[N])){const F=E[N];let j=v[N];j=Xi(j);const G=f.Ku(F);if(j instanceof NN)T.push(F);else{const H=JR(j,G);H!=null&&(T.push(F),R.set(F,H))}}const I=new wl(T);return new oie(R,I,f.fieldTransforms)}function K4e(r,t,s,a=!1){return JR(s,r.ju(a?4:3,t))}function JR(r,t){if(lie(r=Xi(r)))return Mj("Unsupported field value:",t,r),cie(r,t);if(r instanceof kj)return function(a,l){if(!aie(l.Lu))throw l.Wu(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${a._methodName}() is not currently supported inside arrays`);const d=a._toFieldTransform(l);d&&l.fieldTransforms.push(d)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.Qu&&t.Lu!==4)throw t.Wu("Nested arrays are not supported");return function(a,l){const d=[];let f=0;for(const E of a){let v=JR(E,l.Uu(f));v==null&&(v={nullValue:"NULL_VALUE"}),d.push(v),f++}return{arrayValue:{values:d}}}(r,t)}return function(a,l){if((a=Xi(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return DFe(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const d=no.fromDate(a);return{timestampValue:Ok(l.serializer,d)}}if(a instanceof no){const d=new no(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:Ok(l.serializer,d)}}if(a instanceof Nj)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof c0)return{bytesValue:wre(l.serializer,a._byteString)};if(a instanceof ec){const d=l.databaseId,f=a.firestore._databaseId;if(!f.isEqual(d))throw l.Wu(`Document reference is for database ${f.projectId}/${f.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:gj(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof Dj)return function(f,E){return{mapValue:{fields:{[Qne]:{stringValue:Zne},[Rk]:{arrayValue:{values:f.toArray().map(T=>{if(typeof T!="number")throw E.Wu("VectorValues must only contain numeric values.");return pj(E.serializer,T)})}}}}}}(a,l);throw l.Wu(`Unsupported field value: ${PN(a)}`)}(r,t)}function cie(r,t){const s={};return $ne(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Tg(r,(a,l)=>{const d=JR(l,t.qu(a));d!=null&&(s[a]=d)}),{mapValue:{fields:s}}}function lie(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof no||r instanceof Nj||r instanceof c0||r instanceof ec||r instanceof kj||r instanceof Dj)}function Mj(r,t,s){if(!lie(s)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(s)){const a=PN(s);throw a==="an object"?t.Wu(r+" a custom object"):t.Wu(r+" "+a)}}function iV(r,t,s){if((t=Xi(t))instanceof kN)return t._internalPath;if(typeof t=="string")return Uj(r,t);throw xk("Field path arguments must be of type string or ",r,!1,void 0,s)}const q4e=new RegExp("[~\\*/\\[\\]]");function Uj(r,t,s){if(t.search(q4e)>=0)throw xk(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,s);try{return new kN(...t.split("."))._internalPath}catch{throw xk(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,s)}}function xk(r,t,s,a,l){const d=a&&!a.isEmpty(),f=l!==void 0;let E=`Function ${t}() called with invalid data`;s&&(E+=" (via `toFirestore()`)"),E+=". ";let v="";return(d||f)&&(v+=" (found",d&&(v+=` in field ${a}`),f&&(v+=` in document ${l}`),v+=")"),new rn(bt.INVALID_ARGUMENT,E+r+v)}function uie(r,t){return r.some(s=>s.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class die{constructor(t,s,a,l,d){this._firestore=t,this._userDataWriter=s,this._key=a,this._document=l,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new ec(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new Y4e(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const s=this._document.data.field(Vj("DocumentSnapshot.get",t));if(s!==null)return this._userDataWriter.convertValue(s)}}}class Y4e extends die{data(){return super.data()}}function Vj(r,t){return typeof t=="string"?Uj(r,t):t instanceof kN?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function X4e(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new rn(bt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Fj{}class J4e extends Fj{}function RX(r,t,...s){let a=[];t instanceof Fj&&a.push(t),a=a.concat(s),function(d){const f=d.filter(v=>v instanceof jj).length,E=d.filter(v=>v instanceof DN).length;if(f>1||f>0&&E>0)throw new rn(bt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const l of a)r=l._apply(r);return r}class DN extends J4e{constructor(t,s,a){super(),this._field=t,this._op=s,this._value=a,this.type="where"}static _create(t,s,a){return new DN(t,s,a)}_apply(t){const s=this._parse(t);return hie(t._query,s),new R0(t.firestore,t.converter,$U(t._query,s))}_parse(t){const s=xj(t.firestore);return function(d,f,E,v,T,R,I){let N;if(T.isKeyField()){if(R==="array-contains"||R==="array-contains-any")throw new rn(bt.INVALID_ARGUMENT,`Invalid Query. You can't perform '${R}' queries on documentId().`);if(R==="in"||R==="not-in"){AX(I,R);const j=[];for(const G of I)j.push(IX(v,d,G));N={arrayValue:{values:j}}}else N=IX(v,d,I)}else R!=="in"&&R!=="not-in"&&R!=="array-contains-any"||AX(I,R),N=K4e(E,f,I,R==="in"||R==="not-in");return Gs.create(T,R,N)}(t._query,"where",s,t.firestore._databaseId,this._field,this._op,this._value)}}function CX(r,t,s){const a=t,l=Vj("where",r);return DN._create(l,a,s)}class jj extends Fj{constructor(t,s){super(),this.type=t,this._queryConstraints=s}static _create(t,s){return new jj(t,s)}_parse(t){const s=this._queryConstraints.map(a=>a._parse(t)).filter(a=>a.getFilters().length>0);return s.length===1?s[0]:Id.create(s,this._getOperator())}_apply(t){const s=this._parse(t);return s.getFilters().length===0?t:(function(l,d){let f=l;const E=d.getFlattenedFilters();for(const v of E)hie(f,v),f=$U(f,v)}(t._query,s),new R0(t.firestore,t.converter,$U(t._query,s)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function IX(r,t,s){if(typeof(s=Xi(s))=="string"){if(s==="")throw new rn(bt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!are(t)&&s.indexOf("/")!==-1)throw new rn(bt.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${s}' contains a '/' character.`);const a=t.path.child(Fi.fromString(s));if(!Sn.isDocumentKey(a))throw new rn(bt.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return BY(r,new Sn(a))}if(s instanceof ec)return BY(r,s._key);throw new rn(bt.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${PN(s)}.`)}function AX(r,t){if(!Array.isArray(r)||r.length===0)throw new rn(bt.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function hie(r,t){const s=function(l,d){for(const f of l)for(const E of f.getFlattenedFilters())if(d.indexOf(E.op)>=0)return E.op;return null}(r.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(s!==null)throw s===t.op?new rn(bt.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new rn(bt.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${s.toString()}' filters.`)}class Q4e{convertValue(t,s="none"){switch(mg(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Ns(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,s);case 5:return t.stringValue;case 6:return this.convertBytes(fg(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,s);case 11:return this.convertObject(t.mapValue,s);case 10:return this.convertVectorValue(t.mapValue);default:throw Fn()}}convertObject(t,s){return this.convertObjectMap(t.fields,s)}convertObjectMap(t,s="none"){const a={};return Tg(t,(l,d)=>{a[l]=this.convertValue(d,s)}),a}convertVectorValue(t){var s,a,l;const d=(l=(a=(s=t.fields)===null||s===void 0?void 0:s[Rk].arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(f=>Ns(f.doubleValue));return new Dj(d)}convertGeoPoint(t){return new Nj(Ns(t.latitude),Ns(t.longitude))}convertArray(t,s){return(t.values||[]).map(a=>this.convertValue(a,s))}convertServerTimestamp(t,s){switch(s){case"previous":const a=vN(t);return a==null?null:this.convertValue(a,s);case"estimate":return this.convertTimestamp(mR(t));default:return null}}convertTimestamp(t){const s=pg(t);return new no(s.seconds,s.nanos)}convertDocumentKey(t,s){const a=Fi.fromString(t);ri(Ore(a));const l=new gR(a.get(1),a.get(3)),d=new Sn(a.popFirst(5));return l.isEqual(s)||wf(`Document ${d} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${s.projectId}/${s.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z4e(r,t,s){let a;return a=r?s&&(s.merge||s.mergeFields)?r.toFirestore(t,s):r.toFirestore(t):t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ww{constructor(t,s){this.hasPendingWrites=t,this.fromCache=s}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class pie extends die{constructor(t,s,a,l,d,f){super(t,s,a,l,f),this._firestore=t,this._firestoreImpl=t,this.metadata=d}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const s=new $O(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(s,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,s={}){if(this._document){const a=this._document.data.field(Vj("DocumentSnapshot.get",t));if(a!==null)return this._userDataWriter.convertValue(a,s.serverTimestamps)}}}class $O extends pie{data(t={}){return super.data(t)}}class e3e{constructor(t,s,a,l){this._firestore=t,this._userDataWriter=s,this._snapshot=l,this.metadata=new ww(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const t=[];return this.forEach(s=>t.push(s)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,s){this._snapshot.docs.forEach(a=>{t.call(s,new $O(this._firestore,this._userDataWriter,a.key,a,new ww(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const s=!!t.includeMetadataChanges;if(s&&this._snapshot.excludesMetadataChanges)throw new rn(bt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===s||(this._cachedChanges=function(l,d){if(l._snapshot.oldDocs.isEmpty()){let f=0;return l._snapshot.docChanges.map(E=>{const v=new $O(l._firestore,l._userDataWriter,E.doc.key,E.doc,new ww(l._snapshot.mutatedKeys.has(E.doc.key),l._snapshot.fromCache),l.query.converter);return E.doc,{type:"added",doc:v,oldIndex:-1,newIndex:f++}})}{let f=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(E=>d||E.type!==3).map(E=>{const v=new $O(l._firestore,l._userDataWriter,E.doc.key,E.doc,new ww(l._snapshot.mutatedKeys.has(E.doc.key),l._snapshot.fromCache),l.query.converter);let T=-1,R=-1;return E.type!==0&&(T=f.indexOf(E.doc.key),f=f.delete(E.doc.key)),E.type!==1&&(f=f.add(E.doc),R=f.indexOf(E.doc.key)),{type:t3e(E.type),doc:v,oldIndex:T,newIndex:R}})}}(this,s),this._cachedChangesIncludeMetadataChanges=s),this._cachedChanges}}function t3e(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Fn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eg(r){r=Cf(r,ec);const t=Cf(r.firestore,XR);return M4e(Oj(t),r._key).then(s=>n3e(t,r,s))}class fie extends Q4e{constructor(t){super(),this.firestore=t}convertBytes(t){return new c0(t)}convertReference(t){const s=this.convertDocumentKey(t,this.firestore._databaseId);return new ec(this.firestore,null,s)}}function Mk(r){r=Cf(r,R0);const t=Cf(r.firestore,XR),s=Oj(t),a=new fie(t);return X4e(r._query),U4e(s,r._query).then(l=>new e3e(t,a,r,l))}function sV(r,t,s){r=Cf(r,ec);const a=Cf(r.firestore,XR),l=Z4e(r.converter,t,s);return mie(a,[G4e(xj(a),"setDoc",r._key,l,r.converter!==null,s).toMutation(r._key,Kh.none())])}function Ad(r,t,s,...a){r=Cf(r,ec);const l=Cf(r.firestore,XR),d=xj(l);let f;return f=typeof(t=Xi(t))=="string"||t instanceof kN?$4e(d,"updateDoc",r._key,t,s,a):H4e(d,"updateDoc",r._key,t),mie(l,[f.toMutation(r._key,Kh.exists(!0))])}function mie(r,t){return function(a,l){const d=new _f;return a.asyncQueue.enqueueAndForget(async()=>w4e(await x4e(a),l,d)),d.promise}(Oj(r),t)}function n3e(r,t,s){const a=s.docs.get(t._key),l=new fie(r);return new pie(r,l,t._key,a,new ww(s.hasPendingWrites,s.fromCache),t.converter)}(function(t,s=!0){(function(l){S0=l})(OE),bE(new dg("firestore",(a,{instanceIdentifier:l,options:d})=>{const f=a.getProvider("app").getImmediate(),E=new XR(new qVe(a.getProvider("auth-internal")),new JVe(f,a.getProvider("app-check-internal")),function(T,R){if(!Object.prototype.hasOwnProperty.apply(T.options,["projectId"]))throw new rn(bt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new gR(T.options.projectId,R)}(f,l),f);return d=Object.assign({useFetchStreams:s},d),E._setSettings(d),E},"PUBLIC").setMultipleInstances(!0)),zh(OY,kY,t),zh(OY,kY,"esm2017")})();var r3e="firebase",i3e="11.4.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */zh(r3e,i3e,"app");const s3e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"9442a472625f44e7b2c5065b9f9b3988",VITE_FIREBASE_API_KEY:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",VITE_FIREBASE_APP_ID:"1:294433070603:web:136cddd196eea9614fb10e",VITE_FIREBASE_AUTH_DOMAIN:"disruptive-metaverse.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"294433070603",VITE_FIREBASE_PROJECT_ID:"disruptive-metaverse",VITE_FIREBASE_STORAGE_BUCKET:"disruptive-metaverse.appspot.com"};console.log("Environment variables check:");console.log("VITE_FIREBASE_API_KEY exists:",!0);console.log("import.meta.env:",s3e);const zm={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"};console.log("Firebase config being used:",{apiKey:zm.apiKey?`${zm.apiKey.substring(0,5)}...`:"missing",authDomain:zm.authDomain,projectId:zm.projectId,storageBucket:zm.storageBucket,messagingSenderId:zm.messagingSenderId?"present":"missing",appId:zm.appId?"present":"missing"});const gie=Jte(zm),_ie=Mne(gie),bo=rV(gie),Jh=async r=>{try{be.log("userFirestore: Get user Profile data for user ID: "+r);const t=ta(bo,"users",r),s=await Eg(t);return s.exists()?(be.log("userFirestore: Found Profile for : "+s.data().Nickname),s.data()):(be.error("userFirestore: user profile document not found"),null)}catch(t){throw be.error("userFirestore: Error fetching user profile data:",t),t}},o3e=async(r,t,s)=>{try{be.log("userFirestore: Registering new user with email:",r);const l=(await PUe(_ie,r,t)).user;await FU(l),be.log("userFirestore: Verification email sent to:",r);const d={email:l.email,createdAt:new Date,groups:["users"],emailVerified:!1,...s};be.log("userFirestore: Creating user document with data:",d);const f=ta(bo,"users",l.uid);return await sV(f,d),be.log("userFirestore: User created successfully with groups:",d.groups),{...l,...d}}catch(a){throw be.error("userFirestore: Error creating user:",a),a}},Eie=async(r,t)=>{try{be.log(`userFirestore: Updating rpmURL for user ID: ${r}`);const s=ta(bo,"users",r);await Ad(s,{rpmURL:t,lastUpdated:new Date().toISOString()}),be.log("userFirestore: rpmURL updated successfully.")}catch(s){throw be.error("userFirestore: Error updating rpmURL:",s),s}},a3e=(r,t)=>{if(t==="users")return console.log(`OVERRIDE: userBelongsToGroup check for user ${r} and group ${t} - Returning true`),!0;if(t==="disruptiveAdmin"){const a=["lppDQiMb3hhloApQ7llOtk5tckY2","XutdlDmDSncMBUw6vwlQGdkpjNr2","aMhQYu0ArucoNCc6pJJtyfRbn8k2","fJVBogzjtTQqUHnYCYLhTt6jBW13","9NrbbBoc2rOYQC3xAkRBDkig8eg1"].includes(r);return console.log(`OVERRIDE: userBelongsToGroup check for user ${r} and admin group ${t} - Returning ${a}`),a}return console.log(`OVERRIDE: userBelongsToGroup check for user ${r} and group ${t} - Returning false`),!1},yie=async(r,t)=>a3e(r,t),c3e=["email","name","rpmURL","Nickname","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups"],wd={sendUserToUnity:"sendUserToUnity"};class l3e{constructor(){this.events={}}subscribe(t,s){this.events[t]||(this.events[t]=[]),this.events[t].push(s)}publish(t,s){const a=this.events[t];a?(a.forEach(l=>{l(s)}),be.log(`EventBus: Published event '${t}'`)):be.log(`EventBus: No subscribers for event '${t}'`)}unsubscribe(t,s){var l;const a=(l=this.events[t])==null?void 0:l.indexOf(s);a>-1&&this.events[t].splice(a,1)}}const Rd=new l3e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vie="firebasestorage.googleapis.com",Sie="storageBucket",u3e=2*60*1e3,d3e=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ws extends ep{constructor(t,s,a=0){super(R2(t),`Firebase Storage: ${s} (${R2(t)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,ws.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return R2(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var bs;(function(r){r.UNKNOWN="unknown",r.OBJECT_NOT_FOUND="object-not-found",r.BUCKET_NOT_FOUND="bucket-not-found",r.PROJECT_NOT_FOUND="project-not-found",r.QUOTA_EXCEEDED="quota-exceeded",r.UNAUTHENTICATED="unauthenticated",r.UNAUTHORIZED="unauthorized",r.UNAUTHORIZED_APP="unauthorized-app",r.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",r.INVALID_CHECKSUM="invalid-checksum",r.CANCELED="canceled",r.INVALID_EVENT_NAME="invalid-event-name",r.INVALID_URL="invalid-url",r.INVALID_DEFAULT_BUCKET="invalid-default-bucket",r.NO_DEFAULT_BUCKET="no-default-bucket",r.CANNOT_SLICE_BLOB="cannot-slice-blob",r.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",r.NO_DOWNLOAD_URL="no-download-url",r.INVALID_ARGUMENT="invalid-argument",r.INVALID_ARGUMENT_COUNT="invalid-argument-count",r.APP_DELETED="app-deleted",r.INVALID_ROOT_OPERATION="invalid-root-operation",r.INVALID_FORMAT="invalid-format",r.INTERNAL_ERROR="internal-error",r.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(bs||(bs={}));function R2(r){return"storage/"+r}function Bj(){const r="An unknown error occurred, please check the error payload for server response.";return new ws(bs.UNKNOWN,r)}function h3e(r){return new ws(bs.OBJECT_NOT_FOUND,"Object '"+r+"' does not exist.")}function p3e(r){return new ws(bs.QUOTA_EXCEEDED,"Quota for bucket '"+r+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function f3e(){const r="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new ws(bs.UNAUTHENTICATED,r)}function m3e(){return new ws(bs.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function g3e(r){return new ws(bs.UNAUTHORIZED,"User does not have permission to access '"+r+"'.")}function _3e(){return new ws(bs.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function E3e(){return new ws(bs.CANCELED,"User canceled the upload/download.")}function y3e(r){return new ws(bs.INVALID_URL,"Invalid URL '"+r+"'.")}function v3e(r){return new ws(bs.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.")}function S3e(){return new ws(bs.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Sie+"' property when initializing the app?")}function T3e(){return new ws(bs.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function b3e(){return new ws(bs.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function w3e(r){return new ws(bs.UNSUPPORTED_ENVIRONMENT,`${r} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function oV(r){return new ws(bs.INVALID_ARGUMENT,r)}function Tie(){return new ws(bs.APP_DELETED,"The Firebase app was deleted.")}function R3e(r){return new ws(bs.INVALID_ROOT_OPERATION,"The operation '"+r+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Gw(r,t){return new ws(bs.INVALID_FORMAT,"String does not match format '"+r+"': "+t)}function Xb(r){throw new ws(bs.INTERNAL_ERROR,"Internal error: "+r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rl{constructor(t,s){this.bucket=t,this.path_=s}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,s){let a;try{a=Rl.makeFromUrl(t,s)}catch{return new Rl(t,"")}if(a.path==="")return a;throw v3e(t)}static makeFromUrl(t,s){let a=null;const l="([A-Za-z0-9.\\-_]+)";function d(de){de.path.charAt(de.path.length-1)==="/"&&(de.path_=de.path_.slice(0,-1))}const f="(/(.*))?$",E=new RegExp("^gs://"+l+f,"i"),v={bucket:1,path:3};function T(de){de.path_=decodeURIComponent(de.path)}const R="v[A-Za-z0-9_]+",I=s.replace(/[.]/g,"\\."),N="(/([^?#]*).*)?$",F=new RegExp(`^https?://${I}/${R}/b/${l}/o${N}`,"i"),j={bucket:1,path:3},G=s===vie?"(?:storage.googleapis.com|storage.cloud.google.com)":s,H="([^?#]*)",te=new RegExp(`^https?://${G}/${l}/${H}`,"i"),ee=[{regex:E,indices:v,postModify:d},{regex:F,indices:j,postModify:T},{regex:te,indices:{bucket:1,path:2},postModify:T}];for(let de=0;de<ee.length;de++){const se=ee[de],ge=se.regex.exec(t);if(ge){const Z=ge[se.indices.bucket];let Q=ge[se.indices.path];Q||(Q=""),a=new Rl(Z,Q),se.postModify(a);break}}if(a==null)throw y3e(t);return a}}class C3e{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I3e(r,t,s){let a=1,l=null,d=null,f=!1,E=0;function v(){return E===2}let T=!1;function R(...H){T||(T=!0,t.apply(null,H))}function I(H){l=setTimeout(()=>{l=null,r(F,v())},H)}function N(){d&&clearTimeout(d)}function F(H,...te){if(T){N();return}if(H){N(),R.call(null,H,...te);return}if(v()||f){N(),R.call(null,H,...te);return}a<64&&(a*=2);let ee;E===1?(E=2,ee=0):ee=(a+Math.random())*1e3,I(ee)}let j=!1;function G(H){j||(j=!0,N(),!T&&(l!==null?(H||(E=2),clearTimeout(l),I(0)):H||(E=1)))}return I(0),d=setTimeout(()=>{f=!0,G(!0)},s),G}function A3e(r){r(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P3e(r){return r!==void 0}function O3e(r){return typeof r=="object"&&!Array.isArray(r)}function Wj(r){return typeof r=="string"||r instanceof String}function PX(r){return zj()&&r instanceof Blob}function zj(){return typeof Blob<"u"}function OX(r,t,s,a){if(a<t)throw oV(`Invalid value for '${r}'. Expected ${t} or greater.`);if(a>s)throw oV(`Invalid value for '${r}'. Expected ${s} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LN(r,t,s){let a=t;return s==null&&(a=`https://${t}`),`${s}://${a}/v0${r}`}function bie(r){const t=encodeURIComponent;let s="?";for(const a in r)if(r.hasOwnProperty(a)){const l=t(a)+"="+t(r[a]);s=s+l+"&"}return s=s.slice(0,-1),s}var fE;(function(r){r[r.NO_ERROR=0]="NO_ERROR",r[r.NETWORK_ERROR=1]="NETWORK_ERROR",r[r.ABORT=2]="ABORT"})(fE||(fE={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k3e(r,t){const s=r>=500&&r<600,l=[408,429].indexOf(r)!==-1,d=t.indexOf(r)!==-1;return s||l||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N3e{constructor(t,s,a,l,d,f,E,v,T,R,I,N=!0){this.url_=t,this.method_=s,this.headers_=a,this.body_=l,this.successCodes_=d,this.additionalRetryCodes_=f,this.callback_=E,this.errorCallback_=v,this.timeout_=T,this.progressCallback_=R,this.connectionFactory_=I,this.retry=N,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((F,j)=>{this.resolve_=F,this.reject_=j,this.start_()})}start_(){const t=(a,l)=>{if(l){a(!1,new dO(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const f=E=>{const v=E.loaded,T=E.lengthComputable?E.total:-1;this.progressCallback_!==null&&this.progressCallback_(v,T)};this.progressCallback_!==null&&d.addUploadProgressListener(f),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(f),this.pendingConnection_=null;const E=d.getErrorCode()===fE.NO_ERROR,v=d.getStatus();if(!E||k3e(v,this.additionalRetryCodes_)&&this.retry){const R=d.getErrorCode()===fE.ABORT;a(!1,new dO(!1,null,R));return}const T=this.successCodes_.indexOf(v)!==-1;a(!0,new dO(T,d))})},s=(a,l)=>{const d=this.resolve_,f=this.reject_,E=l.connection;if(l.wasSuccessCode)try{const v=this.callback_(E,E.getResponse());P3e(v)?d(v):d()}catch(v){f(v)}else if(E!==null){const v=Bj();v.serverResponse=E.getErrorText(),this.errorCallback_?f(this.errorCallback_(E,v)):f(v)}else if(l.canceled){const v=this.appDelete_?Tie():E3e();f(v)}else{const v=_3e();f(v)}};this.canceled_?s(!1,new dO(!1,null,!0)):this.backoffId_=I3e(t,s,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&A3e(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class dO{constructor(t,s,a){this.wasSuccessCode=t,this.connection=s,this.canceled=!!a}}function D3e(r,t){t!==null&&t.length>0&&(r.Authorization="Firebase "+t)}function L3e(r,t){r["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function x3e(r,t){t&&(r["X-Firebase-GMPID"]=t)}function M3e(r,t){t!==null&&(r["X-Firebase-AppCheck"]=t)}function U3e(r,t,s,a,l,d,f=!0){const E=bie(r.urlParams),v=r.url+E,T=Object.assign({},r.headers);return x3e(T,t),D3e(T,s),L3e(T,d),M3e(T,a),new N3e(v,r.method,T,r.body,r.successCodes,r.additionalRetryCodes,r.handler,r.errorHandler,r.timeout,r.progressCallback,l,f)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V3e(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function F3e(...r){const t=V3e();if(t!==void 0){const s=new t;for(let a=0;a<r.length;a++)s.append(r[a]);return s.getBlob()}else{if(zj())return new Blob(r);throw new ws(bs.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function j3e(r,t,s){return r.webkitSlice?r.webkitSlice(t,s):r.mozSlice?r.mozSlice(t,s):r.slice?r.slice(t,s):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B3e(r){if(typeof atob>"u")throw w3e("base-64");return atob(r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mh={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class C2{constructor(t,s){this.data=t,this.contentType=s||null}}function W3e(r,t){switch(r){case Mh.RAW:return new C2(wie(t));case Mh.BASE64:case Mh.BASE64URL:return new C2(Rie(r,t));case Mh.DATA_URL:return new C2(G3e(t),H3e(t))}throw Bj()}function wie(r){const t=[];for(let s=0;s<r.length;s++){let a=r.charCodeAt(s);if(a<=127)t.push(a);else if(a<=2047)t.push(192|a>>6,128|a&63);else if((a&64512)===55296)if(!(s<r.length-1&&(r.charCodeAt(s+1)&64512)===56320))t.push(239,191,189);else{const d=a,f=r.charCodeAt(++s);a=65536|(d&1023)<<10|f&1023,t.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|a&63)}else(a&64512)===56320?t.push(239,191,189):t.push(224|a>>12,128|a>>6&63,128|a&63)}return new Uint8Array(t)}function z3e(r){let t;try{t=decodeURIComponent(r)}catch{throw Gw(Mh.DATA_URL,"Malformed data URL.")}return wie(t)}function Rie(r,t){switch(r){case Mh.BASE64:{const l=t.indexOf("-")!==-1,d=t.indexOf("_")!==-1;if(l||d)throw Gw(r,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case Mh.BASE64URL:{const l=t.indexOf("+")!==-1,d=t.indexOf("/")!==-1;if(l||d)throw Gw(r,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let s;try{s=B3e(t)}catch(l){throw l.message.includes("polyfill")?l:Gw(r,"Invalid character found")}const a=new Uint8Array(s.length);for(let l=0;l<s.length;l++)a[l]=s.charCodeAt(l);return a}class Cie{constructor(t){this.base64=!1,this.contentType=null;const s=t.match(/^data:([^,]+)?,/);if(s===null)throw Gw(Mh.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const a=s[1]||null;a!=null&&(this.base64=$3e(a,";base64"),this.contentType=this.base64?a.substring(0,a.length-7):a),this.rest=t.substring(t.indexOf(",")+1)}}function G3e(r){const t=new Cie(r);return t.base64?Rie(Mh.BASE64,t.rest):z3e(t.rest)}function H3e(r){return new Cie(r).contentType}function $3e(r,t){return r.length>=t.length?r.substring(r.length-t.length)===t:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xm{constructor(t,s){let a=0,l="";PX(t)?(this.data_=t,a=t.size,l=t.type):t instanceof ArrayBuffer?(s?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),a=this.data_.length):t instanceof Uint8Array&&(s?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),a=t.length),this.size_=a,this.type_=l}size(){return this.size_}type(){return this.type_}slice(t,s){if(PX(this.data_)){const a=this.data_,l=j3e(a,t,s);return l===null?null:new Xm(l)}else{const a=new Uint8Array(this.data_.buffer,t,s-t);return new Xm(a,!0)}}static getBlob(...t){if(zj()){const s=t.map(a=>a instanceof Xm?a.data_:a);return new Xm(F3e.apply(null,s))}else{const s=t.map(f=>Wj(f)?W3e(Mh.RAW,f).data:f.data_);let a=0;s.forEach(f=>{a+=f.byteLength});const l=new Uint8Array(a);let d=0;return s.forEach(f=>{for(let E=0;E<f.length;E++)l[d++]=f[E]}),new Xm(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iie(r){let t;try{t=JSON.parse(r)}catch{return null}return O3e(t)?t:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K3e(r){if(r.length===0)return null;const t=r.lastIndexOf("/");return t===-1?"":r.slice(0,t)}function q3e(r,t){const s=t.split("/").filter(a=>a.length>0).join("/");return r.length===0?s:r+"/"+s}function Aie(r){const t=r.lastIndexOf("/",r.length-2);return t===-1?r:r.slice(t+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y3e(r,t){return t}class Xa{constructor(t,s,a,l){this.server=t,this.local=s||t,this.writable=!!a,this.xform=l||Y3e}}let hO=null;function X3e(r){return!Wj(r)||r.length<2?r:Aie(r)}function Pie(){if(hO)return hO;const r=[];r.push(new Xa("bucket")),r.push(new Xa("generation")),r.push(new Xa("metageneration")),r.push(new Xa("name","fullPath",!0));function t(d,f){return X3e(f)}const s=new Xa("name");s.xform=t,r.push(s);function a(d,f){return f!==void 0?Number(f):f}const l=new Xa("size");return l.xform=a,r.push(l),r.push(new Xa("timeCreated")),r.push(new Xa("updated")),r.push(new Xa("md5Hash",null,!0)),r.push(new Xa("cacheControl",null,!0)),r.push(new Xa("contentDisposition",null,!0)),r.push(new Xa("contentEncoding",null,!0)),r.push(new Xa("contentLanguage",null,!0)),r.push(new Xa("contentType",null,!0)),r.push(new Xa("metadata","customMetadata",!0)),hO=r,hO}function J3e(r,t){function s(){const a=r.bucket,l=r.fullPath,d=new Rl(a,l);return t._makeStorageReference(d)}Object.defineProperty(r,"ref",{get:s})}function Q3e(r,t,s){const a={};a.type="file";const l=s.length;for(let d=0;d<l;d++){const f=s[d];a[f.local]=f.xform(a,t[f.server])}return J3e(a,r),a}function Oie(r,t,s){const a=Iie(t);return a===null?null:Q3e(r,a,s)}function Z3e(r,t,s,a){const l=Iie(t);if(l===null||!Wj(l.downloadTokens))return null;const d=l.downloadTokens;if(d.length===0)return null;const f=encodeURIComponent;return d.split(",").map(T=>{const R=r.bucket,I=r.fullPath,N="/b/"+f(R)+"/o/"+f(I),F=LN(N,s,a),j=bie({alt:"media",token:T});return F+j})[0]}function eBe(r,t){const s={},a=t.length;for(let l=0;l<a;l++){const d=t[l];d.writable&&(s[d.server]=r[d.local])}return JSON.stringify(s)}class Gj{constructor(t,s,a,l){this.url=t,this.method=s,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kie(r){if(!r)throw Bj()}function tBe(r,t){function s(a,l){const d=Oie(r,l,t);return kie(d!==null),d}return s}function nBe(r,t){function s(a,l){const d=Oie(r,l,t);return kie(d!==null),Z3e(d,l,r.host,r._protocol)}return s}function Nie(r){function t(s,a){let l;return s.getStatus()===401?s.getErrorText().includes("Firebase App Check token is invalid")?l=m3e():l=f3e():s.getStatus()===402?l=p3e(r.bucket):s.getStatus()===403?l=g3e(r.path):l=a,l.status=s.getStatus(),l.serverResponse=a.serverResponse,l}return t}function Die(r){const t=Nie(r);function s(a,l){let d=t(a,l);return a.getStatus()===404&&(d=h3e(r.path)),d.serverResponse=l.serverResponse,d}return s}function rBe(r,t,s){const a=t.fullServerUrl(),l=LN(a,r.host,r._protocol),d="GET",f=r.maxOperationRetryTime,E=new Gj(l,d,nBe(r,s),f);return E.errorHandler=Die(t),E}function iBe(r,t){const s=t.fullServerUrl(),a=LN(s,r.host,r._protocol),l="DELETE",d=r.maxOperationRetryTime;function f(v,T){}const E=new Gj(a,l,f,d);return E.successCodes=[200,204],E.errorHandler=Die(t),E}function sBe(r,t){return r&&r.contentType||t&&t.type()||"application/octet-stream"}function oBe(r,t,s){const a=Object.assign({},s);return a.fullPath=r.path,a.size=t.size(),a.contentType||(a.contentType=sBe(null,t)),a}function aBe(r,t,s,a,l){const d=t.bucketOnlyServerUrl(),f={"X-Goog-Upload-Protocol":"multipart"};function E(){let ee="";for(let de=0;de<2;de++)ee=ee+Math.random().toString().slice(2);return ee}const v=E();f["Content-Type"]="multipart/related; boundary="+v;const T=oBe(t,a,l),R=eBe(T,s),I="--"+v+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+R+`\r
--`+v+`\r
Content-Type: `+T.contentType+`\r
\r
`,N=`\r
--`+v+"--",F=Xm.getBlob(I,a,N);if(F===null)throw T3e();const j={name:T.fullPath},G=LN(d,r.host,r._protocol),H="POST",te=r.maxUploadRetryTime,K=new Gj(G,H,tBe(r,s),te);return K.urlParams=j,K.headers=f,K.body=F.uploadData(),K.errorHandler=Nie(t),K}class cBe{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=fE.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=fE.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=fE.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,s,a,l){if(this.sent_)throw Xb("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(s,t,!0),l!==void 0)for(const d in l)l.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,l[d].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Xb("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Xb("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Xb("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Xb("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}}class lBe extends cBe{initXhr(){this.xhr_.responseType="text"}}function Hj(){return new lBe}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AE{constructor(t,s){this._service=t,s instanceof Rl?this._location=s:this._location=Rl.makeFromUrl(s,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,s){return new AE(t,s)}get root(){const t=new Rl(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Aie(this._location.path)}get storage(){return this._service}get parent(){const t=K3e(this._location.path);if(t===null)return null;const s=new Rl(this._location.bucket,t);return new AE(this._service,s)}_throwIfRoot(t){if(this._location.path==="")throw R3e(t)}}function uBe(r,t,s){r._throwIfRoot("uploadBytes");const a=aBe(r.storage,r._location,Pie(),new Xm(t,!0),s);return r.storage.makeRequestWithTokens(a,Hj).then(l=>({metadata:l,ref:r}))}function dBe(r){r._throwIfRoot("getDownloadURL");const t=rBe(r.storage,r._location,Pie());return r.storage.makeRequestWithTokens(t,Hj).then(s=>{if(s===null)throw b3e();return s})}function hBe(r){r._throwIfRoot("deleteObject");const t=iBe(r.storage,r._location);return r.storage.makeRequestWithTokens(t,Hj)}function pBe(r,t){const s=q3e(r._location.path,t),a=new Rl(r._location.bucket,s);return new AE(r.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fBe(r){return/^[A-Za-z]+:\/\//.test(r)}function mBe(r,t){return new AE(r,t)}function Lie(r,t){if(r instanceof $j){const s=r;if(s._bucket==null)throw S3e();const a=new AE(s,s._bucket);return t!=null?Lie(a,t):a}else return t!==void 0?pBe(r,t):r}function gBe(r,t){if(t&&fBe(t)){if(r instanceof $j)return mBe(r,t);throw oV("To use ref(service, url), the first argument must be a Storage instance.")}else return Lie(r,t)}function kX(r,t){const s=t==null?void 0:t[Sie];return s==null?null:Rl.makeFromBucketSpec(s,r)}function _Be(r,t,s,a={}){r.host=`${t}:${s}`,r._protocol="http";const{mockUserToken:l}=a;l&&(r._overrideAuthToken=typeof l=="string"?l:qte(l,r.app.options.projectId))}class $j{constructor(t,s,a,l,d){this.app=t,this._authProvider=s,this._appCheckProvider=a,this._url=l,this._firebaseVersion=d,this._bucket=null,this._host=vie,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=u3e,this._maxUploadRetryTime=d3e,this._requests=new Set,l!=null?this._bucket=Rl.makeFromBucketSpec(l,this._host):this._bucket=kX(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=Rl.makeFromBucketSpec(this._url,t):this._bucket=kX(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){OX("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){OX("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const s=await t.getToken();if(s!==null)return s.accessToken}return null}async _getAppCheckToken(){if(bl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new AE(this,t)}_makeRequest(t,s,a,l,d=!0){if(this._deleted)return new C3e(Tie());{const f=U3e(t,this._appId,a,l,s,this._firebaseVersion,d);return this._requests.add(f),f.getPromise().then(()=>this._requests.delete(f),()=>this._requests.delete(f)),f}}async makeRequestWithTokens(t,s){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,s,a,l).getPromise()}}const NX="@firebase/storage",DX="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xie="storage";function Kj(r,t,s){return r=Xi(r),uBe(r,t,s)}function xN(r){return r=Xi(r),dBe(r)}function qj(r){return r=Xi(r),hBe(r)}function DE(r,t){return r=Xi(r),gBe(r,t)}function LE(r=JF(),t){r=Xi(r);const a=fN(r,xie).getImmediate({identifier:t}),l=Hte("storage");return l&&EBe(a,...l),a}function EBe(r,t,s,a={}){_Be(r,t,s,a)}function yBe(r,{instanceIdentifier:t}){const s=r.getProvider("app").getImmediate(),a=r.getProvider("auth-internal"),l=r.getProvider("app-check-internal");return new $j(s,a,l,t,OE)}function vBe(){bE(new dg(xie,yBe,"PUBLIC").setMultipleInstances(!0)),zh(NX,DX,""),zh(NX,DX,"esm2017")}vBe();const KO=async r=>{const t=LE(),s=DE(t,r);try{return await xN(s)}catch(a){throw be.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",a),a}};let vR={};const sg=async r=>{try{const t=ta(bo,"spaces",r),s=await Eg(t);if(s.exists()){let a=s.data();const l=a.name,d=a.description;if(a.webglBuildId){const f=ta(bo,"webglBuilds",a.webglBuildId),E=await Eg(f);if(E.exists()){const v=E.data();a={...a,...v,name:l||v.name,description:d||v.description}}else be.warn(`spacesFirestore: No document found for webglBuildId: ${a.webglBuildId}`)}return a=await SBe(a),a=TBe(a),console.log("Space data:",a),be.log(`spacesFirestore: Caching space data for: ${r}`),vR[r]=a,a}else return be.warn(`spacesFirestore: No document found for item ID: ${r}`),null}catch(t){throw be.error("spacesFirestore: Error fetching item data:",t),t}},SBe=async r=>{const s=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async a=>{const l=r[a];l&&l.startsWith("gs://")&&(r[a]=await KO(l))});return await Promise.all(s),r},TBe=r=>{const{gsUrlCode:t,gsUrlData:s,gsUrlFramework:a,gsUrlLoader:l,...d}=r;return{...d,codeUrl:t,dataUrl:s,frameworkUrl:a,loaderUrl:l}};let I2={};const Mie=async r=>{be.log("spacesFirestore: Get Videos from Firestore for space: ",r);try{if(I2[r])return be.log("spacesFirestore: Returning cached videos for space:",r),I2[r];const t=Lk(bo,`spaces/${r}/videos`),s=await Mk(t),a=[];return s.forEach(l=>{a.push({id:l.id,...l.data()})}),I2[r]=a,a}catch(t){throw be.error("spacesFirestore: Error fetching Space videos from Firestore:",t),t}},bBe=async(r,t)=>{try{if(!r||!t)throw new Error("Missing required parameters: spaceId and logoFile");if(!t.type.startsWith("image/"))throw new Error("File must be an image");const s=LE(),a=Date.now(),l=t.name.split(".").pop(),d=`logo_${a}.${l}`,f=DE(s,`spaces/${r}/logo/${d}`);be.log(`Uploading logo for space ${r}`);const E=await Kj(f,t),v=await xN(E.ref),T=ta(bo,"spaces",r);return await Ad(T,{logoUrl:v,logoGsUrl:`gs://${E.ref.bucket}/${E.ref.fullPath}`,logoFileName:d,updatedAt:new Date().toISOString()}),be.log(`Successfully uploaded logo for space ${r}`),v}catch(s){throw be.error("Error uploading space logo:",s),s}},wBe=async r=>{try{const t=ta(bo,"spaces",r),s=await Eg(t);if(!s.exists())return be.warn(`No space found with ID: ${r}`),!1;const a=s.data();if(a.logoGsUrl){const l=LE(),d=DE(l,a.logoGsUrl);try{await qj(d),be.log(`Deleted logo file from storage: ${a.logoGsUrl}`)}catch(f){be.warn(`Could not delete logo file from storage: ${f.message}`)}}return await Ad(t,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),be.log(`Successfully removed logo for space ${r}`),!0}catch(t){throw be.error("Error deleting space logo:",t),t}},RBe=async(r,t)=>{try{if(!r||!t)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!t.type.startsWith("image/"))throw new Error("File must be an image");const s=LE(),a=Date.now(),l=t.name.split(".").pop(),d=`background_${a}.${l}`,f=DE(s,`spaces/${r}/background/${d}`);be.log(`Uploading background for space ${r}`);const E=await Kj(f,t),v=await xN(E.ref),T=ta(bo,"spaces",r);return await Ad(T,{backgroundUrl:v,backgroundGsUrl:`gs://${E.ref.bucket}/${E.ref.fullPath}`,backgroundFileName:d,gsUrlLoadingBackground:`gs://${E.ref.bucket}/${E.ref.fullPath}`,updatedAt:new Date().toISOString()}),be.log(`Successfully uploaded background for space ${r}`),v}catch(s){throw be.error("Error uploading space background:",s),s}},CBe=async r=>{try{const t=ta(bo,"spaces",r),s=await Eg(t);if(!s.exists())return be.warn(`No space found with ID: ${r}`),!1;const a=s.data();if(a.backgroundGsUrl){const l=LE(),d=DE(l,a.backgroundGsUrl);try{await qj(d),be.log(`Deleted background file from storage: ${a.backgroundGsUrl}`)}catch(f){be.warn(`Could not delete background file from storage: ${f.message}`)}}return await Ad(t,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),be.log(`Successfully removed background references for space ${r}`),!0}catch(t){throw be.error("Error deleting space background:",t),t}},IBe=async(r,t)=>{try{be.log(`spacesFirestore: Updating settings for space: ${r}`,t);const s=ta(bo,"spaces",r),a=await Eg(s);if(!a.exists())throw new Error(`Space with ID ${r} not found`);const l=a.data(),d={...t,accessibleToAllUsers:t.accessibleToAllUsers!==void 0?t.accessibleToAllUsers:l.accessibleToAllUsers!==void 0?l.accessibleToAllUsers:!0,updatedAt:new Date().toISOString()};await Ad(s,d),vR[r]&&delete vR[r],be.log(`spacesFirestore: Successfully updated settings for space: ${r}`)}catch(s){throw be.error(`spacesFirestore: Error updating settings for space: ${r}`,s),s}},ABe=async(r,t)=>{try{be.log(`spacesFirestore: Setting accessibleToAllUsers=${t} for space: ${r}`);const s=ta(bo,"spaces",r);if(!(await Eg(s)).exists())throw new Error(`Space with ID ${r} not found`);await Ad(s,{accessibleToAllUsers:t,updatedAt:new Date().toISOString()}),vR[r]&&delete vR[r],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceAccessibilityChanged",{detail:{spaceId:r,accessibleToAllUsers:t}})),be.log(`spacesFirestore: Successfully updated accessibleToAllUsers for space: ${r}`)}catch(s){throw be.error(`spacesFirestore: Error updating accessibleToAllUsers for space: ${r}`,s),s}},Pu=L.createContext(null),PBe=({children:r})=>{const[t,s]=L.useState(null),a=L.useRef(null),[l,d]=L.useState(!0),f=Mne(),E=K=>K?K.Nickname?K.Nickname:`${K.firstName} ${K.lastName}`:"Anon";L.useEffect(()=>{const K=DUe(f,async ee=>{if(be.log("UserProvider: Firebase onAuthStateChanged() fired"),ee)try{const de=await Jh(ee.uid),se=E(de),ge={uid:ee.uid,email:ee.email,emailVerified:ee.emailVerified,...de,displayName:se};console.log(ge),s(ge),a.current=ge,I(ge)}catch(de){be.error("UserProvider: Error fetching user profile data:",de)}else s(null),a.current=null;d(!1)});return()=>{K&&K()}},[]);const v=async(K,ee,de)=>{try{const{firstName:se,lastName:ge}=de,Z=`${se}${ge.charAt(0).toUpperCase()}`,Q={...de,Nickname:Z,rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",groups:["users"]},ne=await o3e(K,ee,Q),oe=E(Q),pe={uid:ne.uid,email:ne.email,...Q,displayName:oe};return s(pe),a.current=pe,be.log("UserProvider: User registered successfully with groups:",Q.groups),pe}catch(se){throw be.error("UserProvider: Error creating user:",se),se}},T=async(K,ee)=>{try{const de=await OUe(f,K,ee);if(!de.user.emailVerified)throw await FU(de.user),be.log("UserProvider: Verification email sent again to:",K),new Error("Please verify your email before signing in. A new verification email has been sent.");const se=await Jh(de.user.uid),ge=E(se),Z={uid:de.user.uid,email:de.user.email,emailVerified:de.user.emailVerified,...se,displayName:ge};s(Z),I(Z)}catch(de){throw be.error("UserProvider: Error signing in:",de),de}},R=async()=>{try{await LUe(f),s(null),be.log("UserProvider: User signed out.")}catch(K){throw be.error("UserProvider: Error signing out:",K),K}},I=()=>{const K=a.current;if(K){const ee=N(K);be.log("UserProvider: sendUserToUnity() using the eventBus",ee),Rd.publish(wd.sendUserToUnity,ee)}else be.log("UserProvider: No current user to send to Unity.")},N=K=>{const ee={};return[...c3e,"uid"].forEach(se=>{K.hasOwnProperty(se)&&(ee[se]=K[se])}),ee},F=async K=>!t||!t.uid?!1:await yie(t.uid,K),j=async K=>{if(!t||!t.uid)return!1;try{const ee=await sg(K);if(ee.usersAllowed.includes(t.uid)||ee.userAdmin.includes(t.uid)||ee.usersModerators.includes(t.uid))return!0;if(t.groups&&Array.isArray(t.groups)){const se=`space_${K}_owners`,ge=`space_${K}_hosts`;if(t.groups.includes(se)||t.groups.includes(ge))return be.log(`UserProvider: User ${t.uid} has access to space ${K} as owner/host`),!0}return ee.accessibleToAllUsers===!0&&t.groups?t.groups.includes("users"):!1}catch(ee){return be.error("UserProvider: Error verifying user access to space:",ee),!1}},G=async K=>{if(!t||!t.uid)return!1;try{return(await sg(K)).userAdmin.includes(t.uid)}catch(ee){return be.error("UserProvider: Error verifying user admin status for space:",ee),!1}},H=async K=>{if(!t||!t.uid)return!1;try{return(await sg(K)).usersModerators.includes(t.uid)}catch(ee){return be.error("UserProvider: Error verifying user moderator status for space:",ee),!1}},te=async()=>{try{const K=f.currentUser;return K&&!K.emailVerified?(await FU(K),be.log("UserProvider: Verification email resent to:",K.email),!0):!1}catch(K){throw be.error("UserProvider: Error resending verification email:",K),K}};return P.jsx(Pu.Provider,{value:{user:t,loading:l,register:v,signIn:T,signOut:R,sendUserToUnity:I,isUserInGroup:F,userHasAccessToSpace:j,userIsAdminOfSpace:G,userIsModeratorOfSpace:H,resendVerificationEmail:te},children:r})},Uie=L.createContext(),Pd=()=>L.useContext(Uie),OBe=({children:r})=>{const[t,s]=L.useState(!1),a=L.useRef(null),[l,d]=L.useState(!1);L.useEffect(()=>{const v=()=>{const T=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);d(T)};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const f=L.useCallback(v=>{a.current=v},[]),E=L.useCallback(()=>{const v=a.current;if(!v)return;const T=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const R=v.querySelector("video")||v;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(R.webkitEnterFullscreen)try{R.webkitEnterFullscreen(),s(!0);return}catch(I){console.error("iOS fullscreen error:",I)}try{if(R.webkitRequestFullscreen){R.webkitRequestFullscreen(),s(!0);return}}catch(I){console.error("iOS fallback fullscreen error:",I)}}if(/Android/i.test(navigator.userAgent))try{T?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),s(!1)):(v.requestFullscreen?v.requestFullscreen():v.webkitRequestFullscreen?v.webkitRequestFullscreen():v.mozRequestFullScreen?v.mozRequestFullScreen():v.msRequestFullscreen&&v.msRequestFullscreen(),s(!0));return}catch(I){console.error("Android fullscreen error:",I)}}try{T?document.exitFullscreen?document.exitFullscreen().then(()=>{s(!1)}).catch(R=>console.error("Error exiting fullscreen:",R)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),s(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),s(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),s(!1)):v.requestFullscreen?v.requestFullscreen().then(()=>{s(!0)}).catch(R=>console.error("Error entering fullscreen:",R)):v.webkitRequestFullscreen?(v.webkitRequestFullscreen(),s(!0)):v.mozRequestFullScreen?(v.mozRequestFullScreen(),s(!0)):v.msRequestFullscreen&&(v.msRequestFullscreen(),s(!0))}catch(R){console.error("Fullscreen error:",R)}},[l]);return L.useEffect(()=>{const v=()=>{const T=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;s(!!T)};return document.addEventListener("fullscreenchange",v),document.addEventListener("webkitfullscreenchange",v),document.addEventListener("mozfullscreenchange",v),document.addEventListener("MSFullscreenChange",v),()=>{document.removeEventListener("fullscreenchange",v),document.removeEventListener("webkitfullscreenchange",v),document.removeEventListener("mozfullscreenchange",v),document.removeEventListener("MSFullscreenChange",v)}},[]),P.jsx(Uie.Provider,{value:{isFullscreen:t,toggleFullscreen:E,fullscreenRef:a,setFullscreenRef:f,isMobile:l},children:P.jsx("div",{ref:f,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:r})})};var A2={},Jb={},Qb={},LX;function kBe(){if(LX)return Qb;LX=1,Object.defineProperty(Qb,"__esModule",{value:!0}),Qb.useUnityCanvasId=void 0;var r=bu(),t=0,s="react-unity-webgl-canvas",a=function(l){if(l.id!==void 0)return l.id;var d=(0,r.useMemo)(function(){return[s,++t].join("-")},[]);return d};return Qb.useUnityCanvasId=a,Qb}var Qp={},Zb={},xX;function Vie(){if(xX)return Zb;xX=1,Object.defineProperty(Zb,"__esModule",{value:!0}),Zb.UnityLoaderStatus=void 0;var r;return function(t){t.Idle="Idle",t.Loading="Loading",t.Loaded="Loaded",t.Error="Error"}(r||(Zb.UnityLoaderStatus=r={})),Zb}var ew={},MX;function Yj(){return MX||(MX=1,Object.defineProperty(ew,"__esModule",{value:!0}),ew.isBrowserEnvironment=void 0,ew.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),ew}var UX;function NBe(){if(UX)return Qp;UX=1;var r=Qp&&Qp.__awaiter||function(f,E,v,T){function R(I){return I instanceof v?I:new v(function(N){N(I)})}return new(v||(v=Promise))(function(I,N){function F(H){try{G(T.next(H))}catch(te){N(te)}}function j(H){try{G(T.throw(H))}catch(te){N(te)}}function G(H){H.done?I(H.value):R(H.value).then(F,j)}G((T=T.apply(f,E||[])).next())})},t=Qp&&Qp.__generator||function(f,E){var v={label:0,sent:function(){if(I[0]&1)throw I[1];return I[1]},trys:[],ops:[]},T,R,I,N=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return N.next=F(0),N.throw=F(1),N.return=F(2),typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function F(G){return function(H){return j([G,H])}}function j(G){if(T)throw new TypeError("Generator is already executing.");for(;N&&(N=0,G[0]&&(v=0)),v;)try{if(T=1,R&&(I=G[0]&2?R.return:G[0]?R.throw||((I=R.return)&&I.call(R),0):R.next)&&!(I=I.call(R,G[1])).done)return I;switch(R=0,I&&(G=[G[0]&2,I.value]),G[0]){case 0:case 1:I=G;break;case 4:return v.label++,{value:G[1],done:!1};case 5:v.label++,R=G[1],G=[0];continue;case 7:G=v.ops.pop(),v.trys.pop();continue;default:if(I=v.trys,!(I=I.length>0&&I[I.length-1])&&(G[0]===6||G[0]===2)){v=0;continue}if(G[0]===3&&(!I||G[1]>I[0]&&G[1]<I[3])){v.label=G[1];break}if(G[0]===6&&v.label<I[1]){v.label=I[1],I=G;break}if(I&&v.label<I[2]){v.label=I[2],v.ops.push(G);break}I[2]&&v.ops.pop(),v.trys.pop();continue}G=E.call(f,v)}catch(H){G=[6,H],R=0}finally{T=I=0}if(G[0]&5)throw G[1];return{value:G[0]?G[1]:void 0,done:!0}}};Object.defineProperty(Qp,"__esModule",{value:!0}),Qp.useUnityInstance=void 0;var s=bu(),a=Vie(),l=Yj(),d=function(f,E,v,T){(0,s.useEffect)(function(){(function(){return r(void 0,void 0,void 0,function(){var R,I;return t(this,function(N){switch(N.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(f!==a.UnityLoaderStatus.Loaded||E===null)return T.setUnityInstance(null),T.setInitialisationError(null),[2];N.label=1;case 1:return N.trys.push([1,3,,4]),[4,window.createUnityInstance(E,v,T.setLoadingProgression)];case 2:return R=N.sent(),T.setUnityInstance(R),T.setInitialisationError(null),[3,4];case 3:return I=N.sent(),T.setUnityInstance(null),T.setInitialisationError(I),[3,4];case 4:return[2]}})})})()},[f,E,v,T])};return Qp.useUnityInstance=d,Qp}var tw={},VX;function DBe(){if(VX)return tw;VX=1,Object.defineProperty(tw,"__esModule",{value:!0}),tw.useUnityArguments=void 0;var r=bu(),t=function(s){return(0,r.useMemo)(function(){return{dataUrl:s.unityProvider.unityConfig.dataUrl,frameworkUrl:s.unityProvider.unityConfig.frameworkUrl,codeUrl:s.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:s.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:s.unityProvider.unityConfig.memoryUrl,symbolsUrl:s.unityProvider.unityConfig.symbolsUrl,workerUrl:s.unityProvider.unityConfig.workerUrl,companyName:s.unityProvider.unityConfig.companyName,productName:s.unityProvider.unityConfig.productName,productVersion:s.unityProvider.unityConfig.productVersion,webglContextAttributes:s.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:s.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:s.devicePixelRatio||1,autoSyncPersistentDataPath:s.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof s.matchWebGLToCanvasSize=="boolean"?s.matchWebGLToCanvasSize:!0,disabledCanvasEvents:s.disabledCanvasEvents||["contextmenu","dragstart"],print:function(a){},printErr:function(a){}}},[])};return tw.useUnityArguments=t,tw}var nw={},FX;function LBe(){if(FX)return nw;FX=1,Object.defineProperty(nw,"__esModule",{value:!0}),nw.useUnityLoader=void 0;var r=bu(),t=Yj(),s=Vie(),a=function(l){var d=(0,r.useState)(s.UnityLoaderStatus.Loading),f=d[0],E=d[1];return(0,r.useEffect)(function(){if(t.isBrowserEnvironment!==!1){if(l.loaderUrl===null){E(s.UnityLoaderStatus.Idle);return}var v=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));v===null?(v=window.document.createElement("script"),v.type="text/javascript",v.src=l.loaderUrl,v.async=!0,v.setAttribute("data-status","loading"),window.document.body.appendChild(v),v.addEventListener("load",function(){return v==null?void 0:v.setAttribute("data-status","loaded")}),v.addEventListener("error",function(){return v==null?void 0:v.setAttribute("data-status","error")})):E(v.getAttribute("data-status")==="loaded"?s.UnityLoaderStatus.Loaded:s.UnityLoaderStatus.Error);var T=function(R){return E(R.type==="load"?s.UnityLoaderStatus.Loaded:s.UnityLoaderStatus.Error)};return v.addEventListener("load",T),v.addEventListener("error",T),function(){v!==null&&(v.removeEventListener("load",T),v.removeEventListener("error",T),window.document.body.removeChild(v))}}},[l.loaderUrl]),f};return nw.useUnityLoader=a,nw}var jX;function xBe(){if(jX)return Jb;jX=1,Object.defineProperty(Jb,"__esModule",{value:!0}),Jb.Unity=void 0;var r=bu(),t=bu(),s=kBe(),a=NBe(),l=DBe(),d=LBe(),f=(0,t.forwardRef)(function(E,v){var T=(0,t.useRef)(null),R=(0,s.useUnityCanvasId)(E),I=(0,l.useUnityArguments)(E),N=(0,d.useUnityLoader)(E.unityProvider.unityConfig);return(0,a.useUnityInstance)(N,T.current,I,E.unityProvider),(0,r.useImperativeHandle)(v,function(){return T.current}),(0,r.createElement)("canvas",{ref:T,id:R,style:E.style,className:E.className,tabIndex:E.tabIndex})});return Jb.Unity=f,Jb}var Zp={},rw={},BX;function Fie(){if(BX)return rw;BX=1,Object.defineProperty(rw,"__esModule",{value:!0}),rw.errorMessages=void 0;var r={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return rw.errorMessages=r,rw}var q_={},WX;function MBe(){if(WX)return q_;WX=1;var r=q_&&q_.__spreadArray||function(E,v,T){if(T||arguments.length===2)for(var R=0,I=v.length,N;R<I;R++)(N||!(R in v))&&(N||(N=Array.prototype.slice.call(v,0,R)),N[R]=v[R]);return E.concat(N||Array.prototype.slice.call(v))};Object.defineProperty(q_,"__esModule",{value:!0}),q_.useEventSystem=void 0;var t=bu(),s=Fie(),a=Yj(),l=[],d=function(E){for(var v=[],T=1;T<arguments.length;T++)v[T-1]=arguments[T];var R=void 0;return l.forEach(function(I){R=I.apply(void 0,r([E],v,!1))}),R};a.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=d);var f=function(){var E=(0,t.useRef)([]),v=(0,t.useCallback)(function(I,N){E.current=r(r([],E.current,!0),[{eventName:I,callback:N}],!1)},[E]),T=(0,t.useCallback)(function(I,N){E.current=E.current.filter(function(F){return F.eventName!==I&&F.callback!==N})},[E]),R=(0,t.useCallback)(function(I){for(var N=[],F=1;F<arguments.length;F++)N[F-1]=arguments[F];var j=E.current.find(function(G){return G.eventName===I});if(typeof j>"u"){console.warn(s.errorMessages.noEventListener,{eventName:I});return}return j.callback.apply(j,N)},[E]);return(0,t.useEffect)(function(){return l.push(R),function(){l.splice(l.indexOf(R),1)}},[R]),{addEventListener:v,removeEventListener:T}};return q_.useEventSystem=f,q_}var iw={},zX;function UBe(){if(zX)return iw;zX=1,Object.defineProperty(iw,"__esModule",{value:!0}),iw.useNullableState=void 0;var r=bu(),t=function(s){return(0,r.useState)(s||null)};return iw.useNullableState=t,iw}var GX;function VBe(){if(GX)return Zp;GX=1;var r=Zp&&Zp.__awaiter||function(E,v,T,R){function I(N){return N instanceof T?N:new T(function(F){F(N)})}return new(T||(T=Promise))(function(N,F){function j(te){try{H(R.next(te))}catch(K){F(K)}}function G(te){try{H(R.throw(te))}catch(K){F(K)}}function H(te){te.done?N(te.value):I(te.value).then(j,G)}H((R=R.apply(E,v||[])).next())})},t=Zp&&Zp.__generator||function(E,v){var T={label:0,sent:function(){if(N[0]&1)throw N[1];return N[1]},trys:[],ops:[]},R,I,N,F=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return F.next=j(0),F.throw=j(1),F.return=j(2),typeof Symbol=="function"&&(F[Symbol.iterator]=function(){return this}),F;function j(H){return function(te){return G([H,te])}}function G(H){if(R)throw new TypeError("Generator is already executing.");for(;F&&(F=0,H[0]&&(T=0)),T;)try{if(R=1,I&&(N=H[0]&2?I.return:H[0]?I.throw||((N=I.return)&&N.call(I),0):I.next)&&!(N=N.call(I,H[1])).done)return N;switch(I=0,N&&(H=[H[0]&2,N.value]),H[0]){case 0:case 1:N=H;break;case 4:return T.label++,{value:H[1],done:!1};case 5:T.label++,I=H[1],H=[0];continue;case 7:H=T.ops.pop(),T.trys.pop();continue;default:if(N=T.trys,!(N=N.length>0&&N[N.length-1])&&(H[0]===6||H[0]===2)){T=0;continue}if(H[0]===3&&(!N||H[1]>N[0]&&H[1]<N[3])){T.label=H[1];break}if(H[0]===6&&T.label<N[1]){T.label=N[1],N=H;break}if(N&&T.label<N[2]){T.label=N[2],T.ops.push(H);break}N[2]&&T.ops.pop(),T.trys.pop();continue}H=v.call(E,T)}catch(te){H=[6,te],I=0}finally{R=N=0}if(H[0]&5)throw H[1];return{value:H[0]?H[1]:void 0,done:!0}}};Object.defineProperty(Zp,"__esModule",{value:!0}),Zp.useUnityContext=void 0;var s=bu(),a=Fie(),l=MBe(),d=UBe(),f=function(E){var v=(0,d.useNullableState)(),T=v[0],R=v[1],I=(0,s.useState)(0),N=I[0],F=I[1],j=(0,s.useState)(!1),G=j[0],H=j[1],te=(0,d.useNullableState)(),K=te[0],ee=te[1],de=(0,l.useEventSystem)(),se=(0,s.useRef)({setLoadingProgression:F,setInitialisationError:ee,setUnityInstance:R,setIsLoaded:H,unityConfig:E}),ge=(0,s.useCallback)(function(he){if(T===null){console.warn(a.errorMessages.requestFullscreenNoUnityInstance);return}T.SetFullscreen(he===!0?1:0)},[T]),Z=(0,s.useCallback)(function(){if(T===null||typeof T.Module.canvas>"u"){console.warn(a.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return T.Module.canvas.requestPointerLock()},[T]),Q=(0,s.useCallback)(function(he,le,Me){if(T===null){console.warn(a.errorMessages.sendMessageNoUnityInstance);return}T.SendMessage(he,le,Me)},[T]),ne=(0,s.useCallback)(function(he,le){if(T===null||typeof T.Module.canvas>"u"){console.warn(a.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return T.Module.canvas.toDataURL(he,le)},[T]),oe=(0,s.useCallback)(function(){return T===null?(console.warn(a.errorMessages.quitNoUnityInstance),Promise.reject()):T.Quit()},[T]),pe=(0,s.useCallback)(function(){return r(void 0,void 0,void 0,function(){var he;return t(this,function(le){switch(le.label){case 0:return T===null||typeof T.Module.canvas>"u"?(console.warn(a.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(he=T.Module.canvas,document.body.appendChild(he),he.style.display="none",[4,oe()]);case 1:return le.sent(),he.remove(),[2]}})})},[T]);return(0,s.useEffect)(function(){H(N===1)},[N]),{unityProvider:se.current,loadingProgression:N,initialisationError:K,isLoaded:G,UNSAFE__unityInstance:T,requestFullscreen:ge,requestPointerLock:Z,sendMessage:Q,takeScreenshot:ne,unload:oe,UNSAFE__detachAndUnloadImmediate:pe,addEventListener:de.addEventListener,removeEventListener:de.removeEventListener}};return Zp.useUnityContext=f,Zp}var HX;function FBe(){return HX||(HX=1,function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.useUnityContext=r.Unity=void 0;var t=xBe();Object.defineProperty(r,"Unity",{enumerable:!0,get:function(){return t.Unity}});var s=VBe();Object.defineProperty(r,"useUnityContext",{enumerable:!0,get:function(){return s.useUnityContext}})}(A2)),A2}var jie=FBe();const vd="[UnityProvider]",aV=L.createContext(),jBe=({spaceID:r,children:t,loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d,loadingBackground:f,showLoginButton:E,showDisruptiveLogo:v})=>{be.log(`${vd} Initializing with spaceID:`,r),be.log(`${vd} Unity URLs:`,{loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d});const{unityProvider:T,loadingProgression:R,isLoaded:I,sendMessage:N,addEventListener:F,removeEventListener:j,error:G}=jie.useUnityContext({loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d}),H={unityProvider:T,loadingProgression:R,isLoaded:I,sendMessage:N,addEventListener:F,removeEventListener:j,error:G,spaceID:r},te=L.useRef(null),K=L.useRef(Date.now());L.useEffect(()=>{const ge=()=>{document.hidden?(be.log(`${vd} Page hidden, starting keep-alive`),ee()):(be.log(`${vd} Page visible, stopping keep-alive`),de())};return document.addEventListener("visibilitychange",ge),()=>{document.removeEventListener("visibilitychange",ge),de()}},[]),L.useEffect(()=>{const ge=()=>{K.current=Date.now(),document.hidden&&N("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",ge),window.addEventListener("keydown",ge),window.addEventListener("touchstart",ge),()=>{window.removeEventListener("mousemove",ge),window.removeEventListener("keydown",ge),window.removeEventListener("touchstart",ge)}},[N]);const ee=()=>{te.current||(te.current=setInterval(()=>{I&&document.hidden&&(N("WebGLInputManager","KeepAlive"),be.debug(`${vd} Sent keep-alive message`))},1e4))},de=()=>{te.current&&(clearInterval(te.current),te.current=null)};L.useEffect(()=>(be.log(`${vd} Component mounted`),()=>{be.log(`${vd} Component unmounting`),de()}),[]),L.useEffect(()=>{be.log(`${vd} Loading progress:`,R)},[R]),L.useEffect(()=>{I&&(be.log(`${vd} Unity instance loaded for:`,r),document.hidden&&ee())},[I,r]),L.useEffect(()=>{G&&be.error(`${vd} Unity error:`,G)},[G]),be.log(`${vd} Rendering provider with instance:`,H),L.useEffect(()=>{be.log("UnityProvider: Unity build URLs:",{loaderUrl:s,dataUrl:a,frameworkUrl:l,codeUrl:d})},[s,a,l,d]);const se=[];if(s||se.push("loaderUrl"),a||se.push("dataUrl"),l||se.push("frameworkUrl"),d||se.push("codeUrl"),se.length>0)return be.error(`UnityProvider: Missing required Unity build URLs: ${se.join(", ")}`),P.jsx(aV.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${se.join(", ")}`),spaceID:r},children:t});try{return L.useEffect(()=>{be.log("UnityProvider: Unity context created:",T),T?be.log("UnityProvider: Unity provider is available"):be.error("UnityProvider: Unity provider is not available"),I?be.log("UnityProvider: Unity is loaded"):be.log("UnityProvider: Unity is not loaded yet")},[T,I]),P.jsx(aV.Provider,{value:H,children:t})}catch(ge){return be.error("UnityProvider: Error creating Unity context:",ge),P.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[P.jsx("h3",{children:"Unity Error"}),P.jsxs("p",{children:["Error creating Unity context: ",ge.message]}),P.jsx("p",{children:"Please check the console for more details."})]})}},Jc=()=>L.useContext(aV),wg=()=>{const{sendMessage:r,isLoaded:t}=Jc(),s=L.useRef([]),a=L.useCallback(()=>{if(t)for(;s.current.length>0;){const{eventName:d,data:f}=s.current.shift();be.log("useSendUnityEvent: Processing queued event to Unity:",d,f);try{r("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:d,data:JSON.stringify(f)}))}catch(E){be.error("useSendUnityEvent: Error sending event to Unity:",E),s.current.unshift({eventName:d,data:f});break}}},[r,t]);return L.useEffect(()=>{const d=setInterval(()=>{a()},1e3);return()=>clearInterval(d)},[a]),L.useCallback((d,f)=>{be.log("useSendUnityEvent: Queuing event for Unity:",d),s.current.push({eventName:d,data:f}),a()},[a])},kf=()=>{const{addEventListener:r,removeEventListener:t}=Jc();return L.useCallback((s,a)=>{const l=d=>{be.log(s+" unity message received.");let f=null;if(d)try{f=JSON.parse(d)}catch(E){be.warn("Failed to parse JSON data from Unity message:",E)}a(f)};return r(s,l),()=>{t(s,l)}},[r,t])},BBe=()=>{const[r,t]=L.useState(!1),s=kf();return L.useEffect(()=>{const l=s("FirstSceneLoaded",()=>{be.log("FirstSceneLoaded unity message received."),t(!0)});return()=>{l()}},[s]),r},WBe=r=>{const[t,s]=L.useState(null),a=kf(),{spaceID:l}=Jc();return L.useEffect(()=>{let f=!0;const v=a("PlayVideo",async T=>{try{const{gameObjectName:R}=T;if(!R){be.error("Game object name is missing in Unity event data.");return}const I=await Mie(l);be.log("SPACES VIDEOS",I);const N=I.find(F=>F.id===R);N&&f?(s(N.url),be.log("Video URL set to:",N.url)):console.error("Video not found for game object:",R)}catch(R){console.error("Error fetching space videos:",R)}});return()=>{f=!1,v()}},[a,l,r]),[t,()=>{s(null)}]},zBe=()=>{const r=kf(),{sendUserToUnity:t}=L.useContext(Pu);return L.useEffect(()=>{const a=r("RequestUserForUnity",()=>{be.log("React: Request from Unity to send user data"),t()});return()=>{a()}},[r,t]),!0},GBe=()=>{const{spaceID:r}=Jc(),t=wg(),[s,a]=L.useState(!1);L.useEffect(()=>{if(window.isPlayerInstantiated){be.log("useUnityThumbnails: Unity already ready (via window flag)"),a(!0);return}const l=()=>{be.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),L.useEffect(()=>{if(!s){be.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}be.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!r)throw new Error("spaceID is not defined.");const d=await Mie(r),f=async T=>{const R=`https://vimeo.com/api/oembed.json?url=${T}`,I=await fetch(R);if(!I.ok)throw new Error(`Failed to fetch thumbnail: ${I.statusText}`);const N=await I.json(),F=N.thumbnail_url.replace(/_\d+x\d+/,""),j=["640x360","295x166"];let G=null;for(let H of j){const te=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${F}_${H}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(te,{method:"HEAD"})).ok){G=te;break}}catch(K){console.warn(`Failed to validate thumbnail URL: ${te}`,K)}}return G||N.thumbnail_url},E=d.map(async T=>{const R=await f(T.url);return{gameObjectName:T.id,thumbnailUrl:R}}),v=await Promise.all(E);be.log("Fetched Thumbnails",v),v.forEach(({gameObjectName:T,thumbnailUrl:R})=>{t("SetThumbnail",{gameObjectName:T,thumbnailUrl:R})})}catch(d){be.error("Error fetching thumbnails:",d)}})()},[t,r,s])},HBe=()=>{const[r,t]=L.useState(null),s=kf();return console.log(" Nameplate click hook initialized"),L.useEffect(()=>{console.log(" Setting up nameplate click listener...");const d=s("OpenNameplateModal",f=>{if(console.log(" Nameplate click detected!",f),!f){console.warn(" Received empty data in nameplate click handler");return}try{const E=typeof f=="string"?JSON.parse(f):f;t({playerName:E.playerName,playerId:E.playerId,uid:E.uid,isLocalPlayer:E.isLocalPlayer}),console.log(" Processed nameplate data:",E)}catch(E){console.error(" Error processing nameplate data:",E)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof d=="function"&&d()}},[s]),[r,()=>{console.log(" Resetting nameplate data"),t(null)}]},Bie=()=>{const[r,t]=L.useState([]),s=kf();return L.useEffect(()=>{let a=!0,l=null;const d=()=>{window.unityInstance&&(be.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},f=F=>{if(a){be.log("UpdatePlayerList unity message received.");try{let j=[];if(typeof F=="object"&&F!==null?j=F.players||[]:j=JSON.parse(F).players||[],Array.isArray(j)){const G=Array.from(new Map(j.map(H=>[H.playerId,H])).values());t(G),l&&(clearTimeout(l),l=null)}}catch(j){be.error("Error handling player list data:",j),l||(l=setTimeout(d,1e3))}}},E=()=>{be.log("Player disconnected, requesting fresh player list"),d()},v=()=>{be.log("Player left, requesting fresh player list"),d()};d();const T=s("UpdatePlayerList",f),R=s("PlayerDisconnected",E),I=s("PlayerLeft",v),N=setInterval(d,5e3);return()=>{a=!1,l&&clearTimeout(l),typeof T=="function"&&T(),typeof R=="function"&&R(),typeof I=="function"&&I(),clearInterval(N)}},[s]),r},$X=async(r,t,s,a={})=>{try{const{mediaType:l="image",displayAsVideo:d=!1,directUrl:f=null}=a;if(!r||!t)throw new Error("Missing required parameters: spaceId and mediaScreenId");let E=null;if(s){if(!s.type.startsWith("image/"))throw new Error("File must be an image");const v=LE(),T=Date.now(),R=s.name.split(".").pop(),I=`${t}_${T}.${R}`,N=DE(v,`spaces/${r}/mediaScreens/${I}`);be.log(`Uploading image for media screen ${t} in space ${r}`);const F=await Kj(N,s);E=await xN(F.ref);const j=ta(bo,`spaces/${r}/mediaScreens`,t);await sV(j,{imageUrl:E,gsUrl:`gs://${F.ref.bucket}/${F.ref.fullPath}`,fileName:I,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(f){E=f;const v=ta(bo,`spaces/${r}/mediaScreens`,t);await sV(v,{videoUrl:f,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return be.log(`Successfully uploaded ${l} for media screen ${t} (display as video: ${d})`),E}catch(l){throw be.error(`Error uploading media screen ${(a==null?void 0:a.mediaType)||"image"}:`,l),l}},Xj=async r=>{be.log(`Getting media screen images for space: ${r}`);try{const t=Lk(bo,`spaces/${r}/mediaScreens`),s=await Mk(t),a=[];return s.forEach(l=>{a.push({id:l.id,...l.data()})}),a}catch(t){throw be.error("Error fetching media screen images from Firestore:",t),t}},df=async(r,t)=>{try{const s=ta(bo,`spaces/${r}/mediaScreens`,t),a=await Eg(s);return a.exists()?{id:a.id,...a.data()}:(be.warn(`No media screen found with ID: ${t}`),null)}catch(s){throw be.error("Error fetching media screen image:",s),s}},$Be=async(r,t)=>{try{const s=await df(r,t);if(!s)return be.warn(`No media screen found with ID: ${t} to delete`),!1;if(s.gsUrl){const l=LE(),d=DE(l,s.gsUrl);try{await qj(d),be.log(`Deleted file from storage: ${s.gsUrl}`)}catch(f){be.warn(`Could not delete file from storage: ${f.message}`)}}const a=ta(bo,`spaces/${r}/mediaScreens`,t);return s.mediaType==="video"?(await Ad(a,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),be.log(`Successfully removed video for media screen ${t}`)):(await Ad(a,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),be.log(`Successfully removed image for media screen ${t}`)),!0}catch(s){throw be.error("Error deleting media screen image:",s),s}},KBe=async(r,t,s)=>{try{if(!r||!t||typeof s!="boolean")throw new Error("Missing or invalid required parameters");const a=await df(r,t);if(!a||!a.imageUrl&&!a.videoUrl)return be.warn(`No media screen content found with ID: ${t} to update`),!1;const l=ta(bo,`spaces/${r}/mediaScreens`,t);return await Ad(l,{displayAsVideo:s,updatedAt:new Date().toISOString()}),be.log(`Successfully updated display mode for media screen ${t} to ${s?"video":"image"}`),!0}catch(a){throw be.error("Error updating media screen display mode:",a),a}},qBe=r=>{if(!r)return null;try{if(r.includes("firebasestorage.googleapis.com")){const t=new URL(r),s=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",s&&t.searchParams.set("alt",s),a&&t.searchParams.set("token",a),console.log(`Cleaned Firebase URL from ${r} to ${t.toString()}`),t.toString()}return r}catch(t){return console.error("Error cleaning Firebase URL:",t),r}},Wie=()=>{const{spaceID:r}=Jc(),t=wg(),[s,a]=L.useState(!1);L.useEffect(()=>{if(window.isPlayerInstantiated){be.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),a(!0);return}const l=()=>{be.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),L.useEffect(()=>{if(!s){be.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}be.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!r)throw new Error("spaceID is not defined.");const d=await Xj(r);be.log("Fetched Media Screen Images",d),d.forEach(f=>{const{id:E,imageUrl:v,displayAsVideo:T,videoUrl:R}=f;let I=null;(!T||!R)&&(I=v?qBe(v):null),t("SetMediaScreenImage",{mediaScreenId:E,imageUrl:I,videoUrl:R||null,displayAsVideo:T||!1,timestamp:Date.now()}),be.log(`Sent media screen data for ${E} to Unity (displayAsVideo: ${T})`),T&&R&&(t("SetMediaScreenDisplayMode",{mediaScreenId:E,displayAsVideo:!0,videoUrl:R,timestamp:Date.now()}),be.log(`Set display mode to video for screen ${E}`))})}catch(d){be.error("Error fetching media screen images:",d)}})()},[t,r,s])},YBe=r=>({opacity:1});var QR=r=>r.type==="checkbox",iE=r=>r instanceof Date,Ja=r=>r==null;const zie=r=>typeof r=="object";var Ls=r=>!Ja(r)&&!Array.isArray(r)&&zie(r)&&!iE(r),XBe=r=>Ls(r)&&r.target?QR(r.target)?r.target.checked:r.target.value:r,JBe=r=>r.substring(0,r.search(/\.\d+(\.|$)/))||r,QBe=(r,t)=>r.has(JBe(t)),ZBe=r=>{const t=r.constructor&&r.constructor.prototype;return Ls(t)&&t.hasOwnProperty("isPrototypeOf")},Jj=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function mu(r){let t;const s=Array.isArray(r),a=typeof FileList<"u"?r instanceof FileList:!1;if(r instanceof Date)t=new Date(r);else if(r instanceof Set)t=new Set(r);else if(!(Jj&&(r instanceof Blob||a))&&(s||Ls(r)))if(t=s?[]:{},!s&&!ZBe(r))t=r;else for(const l in r)r.hasOwnProperty(l)&&(t[l]=mu(r[l]));else return r;return t}var MN=r=>Array.isArray(r)?r.filter(Boolean):[],Bs=r=>r===void 0,on=(r,t,s)=>{if(!t||!Ls(r))return s;const a=MN(t.split(/[,[\].]+?/)).reduce((l,d)=>Ja(l)?l:l[d],r);return Bs(a)||a===r?Bs(r[t])?s:r[t]:a},Ah=r=>typeof r=="boolean",Qj=r=>/^\w*$/.test(r),Gie=r=>MN(r.replace(/["|']|\]/g,"").split(/\.|\[/)),Vi=(r,t,s)=>{let a=-1;const l=Qj(t)?[t]:Gie(t),d=l.length,f=d-1;for(;++a<d;){const E=l[a];let v=s;if(a!==f){const T=r[E];v=Ls(T)||Array.isArray(T)?T:isNaN(+l[a+1])?{}:[]}if(E==="__proto__"||E==="constructor"||E==="prototype")return;r[E]=v,r=r[E]}return r};const KX={BLUR:"blur",FOCUS_OUT:"focusout"},bd={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},ef={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};ni.createContext(null);var e5e=(r,t,s,a=!0)=>{const l={defaultValues:t._defaultValues};for(const d in r)Object.defineProperty(l,d,{get:()=>{const f=d;return t._proxyFormState[f]!==bd.all&&(t._proxyFormState[f]=!a||bd.all),r[f]}});return l},jc=r=>Ls(r)&&!Object.keys(r).length,t5e=(r,t,s,a)=>{s(r);const{name:l,...d}=r;return jc(d)||Object.keys(d).length>=Object.keys(t).length||Object.keys(d).find(f=>t[f]===bd.all)},qO=r=>Array.isArray(r)?r:[r];function n5e(r){const t=ni.useRef(r);t.current=r,ni.useEffect(()=>{const s=!r.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{s&&s.unsubscribe()}},[r.disabled])}var Uh=r=>typeof r=="string",r5e=(r,t,s,a,l)=>Uh(r)?(a&&t.watch.add(r),on(s,r,l)):Array.isArray(r)?r.map(d=>(a&&t.watch.add(d),on(s,d))):(a&&(t.watchAll=!0),s),i5e=(r,t,s,a,l)=>t?{...s[r],types:{...s[r]&&s[r].types?s[r].types:{},[a]:l||!0}}:{},qX=r=>({isOnSubmit:!r||r===bd.onSubmit,isOnBlur:r===bd.onBlur,isOnChange:r===bd.onChange,isOnAll:r===bd.all,isOnTouch:r===bd.onTouched}),YX=(r,t,s)=>!s&&(t.watchAll||t.watch.has(r)||[...t.watch].some(a=>r.startsWith(a)&&/^\.\w+/.test(r.slice(a.length))));const Hw=(r,t,s,a)=>{for(const l of s||Object.keys(r)){const d=on(r,l);if(d){const{_f:f,...E}=d;if(f){if(f.refs&&f.refs[0]&&t(f.refs[0],l)&&!a)return!0;if(f.ref&&t(f.ref,f.name)&&!a)return!0;if(Hw(E,t))break}else if(Ls(E)&&Hw(E,t))break}}};var s5e=(r,t,s)=>{const a=qO(on(r,s));return Vi(a,"root",t[s]),Vi(r,s,a),r},Zj=r=>r.type==="file",Dh=r=>typeof r=="function",Uk=r=>{if(!Jj)return!1;const t=r?r.ownerDocument:0;return r instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},YO=r=>Uh(r),e4=r=>r.type==="radio",Vk=r=>r instanceof RegExp;const XX={value:!1,isValid:!1},JX={value:!0,isValid:!0};var Hie=r=>{if(Array.isArray(r)){if(r.length>1){const t=r.filter(s=>s&&s.checked&&!s.disabled).map(s=>s.value);return{value:t,isValid:!!t.length}}return r[0].checked&&!r[0].disabled?r[0].attributes&&!Bs(r[0].attributes.value)?Bs(r[0].value)||r[0].value===""?JX:{value:r[0].value,isValid:!0}:JX:XX}return XX};const QX={isValid:!1,value:null};var $ie=r=>Array.isArray(r)?r.reduce((t,s)=>s&&s.checked&&!s.disabled?{isValid:!0,value:s.value}:t,QX):QX;function ZX(r,t,s="validate"){if(YO(r)||Array.isArray(r)&&r.every(YO)||Ah(r)&&!r)return{type:s,message:YO(r)?r:"",ref:t}}var iS=r=>Ls(r)&&!Vk(r)?r:{value:r,message:""},eJ=async(r,t,s,a,l,d)=>{const{ref:f,refs:E,required:v,maxLength:T,minLength:R,min:I,max:N,pattern:F,validate:j,name:G,valueAsNumber:H,mount:te}=r._f,K=on(s,G);if(!te||t.has(G))return{};const ee=E?E[0]:f,de=he=>{l&&ee.reportValidity&&(ee.setCustomValidity(Ah(he)?"":he||""),ee.reportValidity())},se={},ge=e4(f),Z=QR(f),Q=ge||Z,ne=(H||Zj(f))&&Bs(f.value)&&Bs(K)||Uk(f)&&f.value===""||K===""||Array.isArray(K)&&!K.length,oe=i5e.bind(null,G,a,se),pe=(he,le,Me,He=ef.maxLength,rt=ef.minLength)=>{const we=he?le:Me;se[G]={type:he?He:rt,message:we,ref:f,...oe(he?He:rt,we)}};if(d?!Array.isArray(K)||!K.length:v&&(!Q&&(ne||Ja(K))||Ah(K)&&!K||Z&&!Hie(E).isValid||ge&&!$ie(E).isValid)){const{value:he,message:le}=YO(v)?{value:!!v,message:v}:iS(v);if(he&&(se[G]={type:ef.required,message:le,ref:ee,...oe(ef.required,le)},!a))return de(le),se}if(!ne&&(!Ja(I)||!Ja(N))){let he,le;const Me=iS(N),He=iS(I);if(!Ja(K)&&!isNaN(K)){const rt=f.valueAsNumber||K&&+K;Ja(Me.value)||(he=rt>Me.value),Ja(He.value)||(le=rt<He.value)}else{const rt=f.valueAsDate||new Date(K),we=Ne=>new Date(new Date().toDateString()+" "+Ne),Ce=f.type=="time",ye=f.type=="week";Uh(Me.value)&&K&&(he=Ce?we(K)>we(Me.value):ye?K>Me.value:rt>new Date(Me.value)),Uh(He.value)&&K&&(le=Ce?we(K)<we(He.value):ye?K<He.value:rt<new Date(He.value))}if((he||le)&&(pe(!!he,Me.message,He.message,ef.max,ef.min),!a))return de(se[G].message),se}if((T||R)&&!ne&&(Uh(K)||d&&Array.isArray(K))){const he=iS(T),le=iS(R),Me=!Ja(he.value)&&K.length>+he.value,He=!Ja(le.value)&&K.length<+le.value;if((Me||He)&&(pe(Me,he.message,le.message),!a))return de(se[G].message),se}if(F&&!ne&&Uh(K)){const{value:he,message:le}=iS(F);if(Vk(he)&&!K.match(he)&&(se[G]={type:ef.pattern,message:le,ref:f,...oe(ef.pattern,le)},!a))return de(le),se}if(j){if(Dh(j)){const he=await j(K,s),le=ZX(he,ee);if(le&&(se[G]={...le,...oe(ef.validate,le.message)},!a))return de(le.message),se}else if(Ls(j)){let he={};for(const le in j){if(!jc(he)&&!a)break;const Me=ZX(await j[le](K,s),ee,le);Me&&(he={...Me,...oe(le,Me.message)},de(Me.message),a&&(se[G]=he))}if(!jc(he)&&(se[G]={ref:ee,...he},!a))return se}}return de(!0),se};function o5e(r,t){const s=t.slice(0,-1).length;let a=0;for(;a<s;)r=Bs(r)?a++:r[t[a++]];return r}function a5e(r){for(const t in r)if(r.hasOwnProperty(t)&&!Bs(r[t]))return!1;return!0}function to(r,t){const s=Array.isArray(t)?t:Qj(t)?[t]:Gie(t),a=s.length===1?r:o5e(r,s),l=s.length-1,d=s[l];return a&&delete a[d],l!==0&&(Ls(a)&&jc(a)||Array.isArray(a)&&a5e(a))&&to(r,s.slice(0,-1)),r}var P2=()=>{let r=[];return{get observers(){return r},next:l=>{for(const d of r)d.next&&d.next(l)},subscribe:l=>(r.push(l),{unsubscribe:()=>{r=r.filter(d=>d!==l)}}),unsubscribe:()=>{r=[]}}},cV=r=>Ja(r)||!zie(r);function Jm(r,t){if(cV(r)||cV(t))return r===t;if(iE(r)&&iE(t))return r.getTime()===t.getTime();const s=Object.keys(r),a=Object.keys(t);if(s.length!==a.length)return!1;for(const l of s){const d=r[l];if(!a.includes(l))return!1;if(l!=="ref"){const f=t[l];if(iE(d)&&iE(f)||Ls(d)&&Ls(f)||Array.isArray(d)&&Array.isArray(f)?!Jm(d,f):d!==f)return!1}}return!0}var Kie=r=>r.type==="select-multiple",c5e=r=>e4(r)||QR(r),O2=r=>Uk(r)&&r.isConnected,qie=r=>{for(const t in r)if(Dh(r[t]))return!0;return!1};function Fk(r,t={}){const s=Array.isArray(r);if(Ls(r)||s)for(const a in r)Array.isArray(r[a])||Ls(r[a])&&!qie(r[a])?(t[a]=Array.isArray(r[a])?[]:{},Fk(r[a],t[a])):Ja(r[a])||(t[a]=!0);return t}function Yie(r,t,s){const a=Array.isArray(r);if(Ls(r)||a)for(const l in r)Array.isArray(r[l])||Ls(r[l])&&!qie(r[l])?Bs(t)||cV(s[l])?s[l]=Array.isArray(r[l])?Fk(r[l],[]):{...Fk(r[l])}:Yie(r[l],Ja(t)?{}:t[l],s[l]):s[l]=!Jm(r[l],t[l]);return s}var sw=(r,t)=>Yie(r,t,Fk(t)),Xie=(r,{valueAsNumber:t,valueAsDate:s,setValueAs:a})=>Bs(r)?r:t?r===""?NaN:r&&+r:s&&Uh(r)?new Date(r):a?a(r):r;function k2(r){const t=r.ref;return Zj(t)?t.files:e4(t)?$ie(r.refs).value:Kie(t)?[...t.selectedOptions].map(({value:s})=>s):QR(t)?Hie(r.refs).value:Xie(Bs(t.value)?r.ref.value:t.value,r)}var l5e=(r,t,s,a)=>{const l={};for(const d of r){const f=on(t,d);f&&Vi(l,d,f._f)}return{criteriaMode:s,names:[...r],fields:l,shouldUseNativeValidation:a}},ow=r=>Bs(r)?r:Vk(r)?r.source:Ls(r)?Vk(r.value)?r.value.source:r.value:r;const tJ="AsyncFunction";var u5e=r=>!!r&&!!r.validate&&!!(Dh(r.validate)&&r.validate.constructor.name===tJ||Ls(r.validate)&&Object.values(r.validate).find(t=>t.constructor.name===tJ)),d5e=r=>r.mount&&(r.required||r.min||r.max||r.maxLength||r.minLength||r.pattern||r.validate);function nJ(r,t,s){const a=on(r,s);if(a||Qj(s))return{error:a,name:s};const l=s.split(".");for(;l.length;){const d=l.join("."),f=on(t,d),E=on(r,d);if(f&&!Array.isArray(f)&&s!==d)return{name:s};if(E&&E.type)return{name:d,error:E};l.pop()}return{name:s}}var h5e=(r,t,s,a,l)=>l.isOnAll?!1:!s&&l.isOnTouch?!(t||r):(s?a.isOnBlur:l.isOnBlur)?!r:(s?a.isOnChange:l.isOnChange)?r:!0,p5e=(r,t)=>!MN(on(r,t)).length&&to(r,t);const f5e={mode:bd.onSubmit,reValidateMode:bd.onChange,shouldFocusError:!0};function m5e(r={}){let t={...f5e,...r},s={submitCount:0,isDirty:!1,isLoading:Dh(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},a={},l=Ls(t.defaultValues)||Ls(t.values)?mu(t.defaultValues||t.values)||{}:{},d=t.shouldUnregister?{}:mu(l),f={action:!1,mount:!1,watch:!1},E={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},v,T=0;const R={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},I={values:P2(),array:P2(),state:P2()},N=qX(t.mode),F=qX(t.reValidateMode),j=t.criteriaMode===bd.all,G=Re=>Fe=>{clearTimeout(T),T=setTimeout(Re,Fe)},H=async Re=>{if(!t.disabled&&(R.isValid||Re)){const Fe=t.resolver?jc((await Q()).errors):await oe(a,!0);Fe!==s.isValid&&I.state.next({isValid:Fe})}},te=(Re,Fe)=>{!t.disabled&&(R.isValidating||R.validatingFields)&&((Re||Array.from(E.mount)).forEach(Ke=>{Ke&&(Fe?Vi(s.validatingFields,Ke,Fe):to(s.validatingFields,Ke))}),I.state.next({validatingFields:s.validatingFields,isValidating:!jc(s.validatingFields)}))},K=(Re,Fe=[],Ke,_t,yt=!0,Ge=!0)=>{if(_t&&Ke&&!t.disabled){if(f.action=!0,Ge&&Array.isArray(on(a,Re))){const Pt=Ke(on(a,Re),_t.argA,_t.argB);yt&&Vi(a,Re,Pt)}if(Ge&&Array.isArray(on(s.errors,Re))){const Pt=Ke(on(s.errors,Re),_t.argA,_t.argB);yt&&Vi(s.errors,Re,Pt),p5e(s.errors,Re)}if(R.touchedFields&&Ge&&Array.isArray(on(s.touchedFields,Re))){const Pt=Ke(on(s.touchedFields,Re),_t.argA,_t.argB);yt&&Vi(s.touchedFields,Re,Pt)}R.dirtyFields&&(s.dirtyFields=sw(l,d)),I.state.next({name:Re,isDirty:he(Re,Fe),dirtyFields:s.dirtyFields,errors:s.errors,isValid:s.isValid})}else Vi(d,Re,Fe)},ee=(Re,Fe)=>{Vi(s.errors,Re,Fe),I.state.next({errors:s.errors})},de=Re=>{s.errors=Re,I.state.next({errors:s.errors,isValid:!1})},se=(Re,Fe,Ke,_t)=>{const yt=on(a,Re);if(yt){const Ge=on(d,Re,Bs(Ke)?on(l,Re):Ke);Bs(Ge)||_t&&_t.defaultChecked||Fe?Vi(d,Re,Fe?Ge:k2(yt._f)):He(Re,Ge),f.mount&&H()}},ge=(Re,Fe,Ke,_t,yt)=>{let Ge=!1,Pt=!1;const Yt={name:Re};if(!t.disabled){const hn=!!(on(a,Re)&&on(a,Re)._f&&on(a,Re)._f.disabled);if(!Ke||_t){R.isDirty&&(Pt=s.isDirty,s.isDirty=Yt.isDirty=he(),Ge=Pt!==Yt.isDirty);const an=hn||Jm(on(l,Re),Fe);Pt=!!(!hn&&on(s.dirtyFields,Re)),an||hn?to(s.dirtyFields,Re):Vi(s.dirtyFields,Re,!0),Yt.dirtyFields=s.dirtyFields,Ge=Ge||R.dirtyFields&&Pt!==!an}if(Ke){const an=on(s.touchedFields,Re);an||(Vi(s.touchedFields,Re,Ke),Yt.touchedFields=s.touchedFields,Ge=Ge||R.touchedFields&&an!==Ke)}Ge&&yt&&I.state.next(Yt)}return Ge?Yt:{}},Z=(Re,Fe,Ke,_t)=>{const yt=on(s.errors,Re),Ge=R.isValid&&Ah(Fe)&&s.isValid!==Fe;if(t.delayError&&Ke?(v=G(()=>ee(Re,Ke)),v(t.delayError)):(clearTimeout(T),v=null,Ke?Vi(s.errors,Re,Ke):to(s.errors,Re)),(Ke?!Jm(yt,Ke):yt)||!jc(_t)||Ge){const Pt={..._t,...Ge&&Ah(Fe)?{isValid:Fe}:{},errors:s.errors,name:Re};s={...s,...Pt},I.state.next(Pt)}},Q=async Re=>{te(Re,!0);const Fe=await t.resolver(d,t.context,l5e(Re||E.mount,a,t.criteriaMode,t.shouldUseNativeValidation));return te(Re),Fe},ne=async Re=>{const{errors:Fe}=await Q(Re);if(Re)for(const Ke of Re){const _t=on(Fe,Ke);_t?Vi(s.errors,Ke,_t):to(s.errors,Ke)}else s.errors=Fe;return Fe},oe=async(Re,Fe,Ke={valid:!0})=>{for(const _t in Re){const yt=Re[_t];if(yt){const{_f:Ge,...Pt}=yt;if(Ge){const Yt=E.array.has(Ge.name),hn=yt._f&&u5e(yt._f);hn&&R.validatingFields&&te([_t],!0);const an=await eJ(yt,E.disabled,d,j,t.shouldUseNativeValidation&&!Fe,Yt);if(hn&&R.validatingFields&&te([_t]),an[Ge.name]&&(Ke.valid=!1,Fe))break;!Fe&&(on(an,Ge.name)?Yt?s5e(s.errors,an,Ge.name):Vi(s.errors,Ge.name,an[Ge.name]):to(s.errors,Ge.name))}!jc(Pt)&&await oe(Pt,Fe,Ke)}}return Ke.valid},pe=()=>{for(const Re of E.unMount){const Fe=on(a,Re);Fe&&(Fe._f.refs?Fe._f.refs.every(Ke=>!O2(Ke)):!O2(Fe._f.ref))&&et(Re)}E.unMount=new Set},he=(Re,Fe)=>!t.disabled&&(Re&&Fe&&Vi(d,Re,Fe),!Jm(Te(),l)),le=(Re,Fe,Ke)=>r5e(Re,E,{...f.mount?d:Bs(Fe)?l:Uh(Re)?{[Re]:Fe}:Fe},Ke,Fe),Me=Re=>MN(on(f.mount?d:l,Re,t.shouldUnregister?on(l,Re,[]):[])),He=(Re,Fe,Ke={})=>{const _t=on(a,Re);let yt=Fe;if(_t){const Ge=_t._f;Ge&&(!Ge.disabled&&Vi(d,Re,Xie(Fe,Ge)),yt=Uk(Ge.ref)&&Ja(Fe)?"":Fe,Kie(Ge.ref)?[...Ge.ref.options].forEach(Pt=>Pt.selected=yt.includes(Pt.value)):Ge.refs?QR(Ge.ref)?Ge.refs.length>1?Ge.refs.forEach(Pt=>(!Pt.defaultChecked||!Pt.disabled)&&(Pt.checked=Array.isArray(yt)?!!yt.find(Yt=>Yt===Pt.value):yt===Pt.value)):Ge.refs[0]&&(Ge.refs[0].checked=!!yt):Ge.refs.forEach(Pt=>Pt.checked=Pt.value===yt):Zj(Ge.ref)?Ge.ref.value="":(Ge.ref.value=yt,Ge.ref.type||I.values.next({name:Re,values:{...d}})))}(Ke.shouldDirty||Ke.shouldTouch)&&ge(Re,yt,Ke.shouldTouch,Ke.shouldDirty,!0),Ke.shouldValidate&&Ne(Re)},rt=(Re,Fe,Ke)=>{for(const _t in Fe){const yt=Fe[_t],Ge=`${Re}.${_t}`,Pt=on(a,Ge);(E.array.has(Re)||Ls(yt)||Pt&&!Pt._f)&&!iE(yt)?rt(Ge,yt,Ke):He(Ge,yt,Ke)}},we=(Re,Fe,Ke={})=>{const _t=on(a,Re),yt=E.array.has(Re),Ge=mu(Fe);Vi(d,Re,Ge),yt?(I.array.next({name:Re,values:{...d}}),(R.isDirty||R.dirtyFields)&&Ke.shouldDirty&&I.state.next({name:Re,dirtyFields:sw(l,d),isDirty:he(Re,Ge)})):_t&&!_t._f&&!Ja(Ge)?rt(Re,Ge,Ke):He(Re,Ge,Ke),YX(Re,E)&&I.state.next({...s}),I.values.next({name:f.mount?Re:void 0,values:{...d}})},Ce=async Re=>{f.mount=!0;const Fe=Re.target;let Ke=Fe.name,_t=!0;const yt=on(a,Ke),Ge=()=>Fe.type?k2(yt._f):XBe(Re),Pt=Yt=>{_t=Number.isNaN(Yt)||iE(Yt)&&isNaN(Yt.getTime())||Jm(Yt,on(d,Ke,Yt))};if(yt){let Yt,hn;const an=Ge(),ir=Re.type===KX.BLUR||Re.type===KX.FOCUS_OUT,na=!d5e(yt._f)&&!t.resolver&&!on(s.errors,Ke)&&!yt._f.deps||h5e(ir,on(s.touchedFields,Ke),s.isSubmitted,F,N),Vt=YX(Ke,E,ir);Vi(d,Ke,an),ir?(yt._f.onBlur&&yt._f.onBlur(Re),v&&v(0)):yt._f.onChange&&yt._f.onChange(Re);const sn=ge(Ke,an,ir,!1),wi=!jc(sn)||Vt;if(!ir&&I.values.next({name:Ke,type:Re.type,values:{...d}}),na)return R.isValid&&(t.mode==="onBlur"&&ir?H():ir||H()),wi&&I.state.next({name:Ke,...Vt?{}:sn});if(!ir&&Vt&&I.state.next({...s}),t.resolver){const{errors:di}=await Q([Ke]);if(Pt(an),_t){const yi=nJ(s.errors,a,Ke),ur=nJ(di,a,yi.name||Ke);Yt=ur.error,Ke=ur.name,hn=jc(di)}}else te([Ke],!0),Yt=(await eJ(yt,E.disabled,d,j,t.shouldUseNativeValidation))[Ke],te([Ke]),Pt(an),_t&&(Yt?hn=!1:R.isValid&&(hn=await oe(a,!0)));_t&&(yt._f.deps&&Ne(yt._f.deps),Z(Ke,hn,Yt,sn))}},ye=(Re,Fe)=>{if(on(s.errors,Fe)&&Re.focus)return Re.focus(),1},Ne=async(Re,Fe={})=>{let Ke,_t;const yt=qO(Re);if(t.resolver){const Ge=await ne(Bs(Re)?Re:yt);Ke=jc(Ge),_t=Re?!yt.some(Pt=>on(Ge,Pt)):Ke}else Re?(_t=(await Promise.all(yt.map(async Ge=>{const Pt=on(a,Ge);return await oe(Pt&&Pt._f?{[Ge]:Pt}:Pt)}))).every(Boolean),!(!_t&&!s.isValid)&&H()):_t=Ke=await oe(a);return I.state.next({...!Uh(Re)||R.isValid&&Ke!==s.isValid?{}:{name:Re},...t.resolver||!Re?{isValid:Ke}:{},errors:s.errors}),Fe.shouldFocus&&!_t&&Hw(a,ye,Re?yt:E.mount),_t},Te=Re=>{const Fe={...f.mount?d:l};return Bs(Re)?Fe:Uh(Re)?on(Fe,Re):Re.map(Ke=>on(Fe,Ke))},Se=(Re,Fe)=>({invalid:!!on((Fe||s).errors,Re),isDirty:!!on((Fe||s).dirtyFields,Re),error:on((Fe||s).errors,Re),isValidating:!!on(s.validatingFields,Re),isTouched:!!on((Fe||s).touchedFields,Re)}),Ae=Re=>{Re&&qO(Re).forEach(Fe=>to(s.errors,Fe)),I.state.next({errors:Re?s.errors:{}})},Ue=(Re,Fe,Ke)=>{const _t=(on(a,Re,{_f:{}})._f||{}).ref,yt=on(s.errors,Re)||{},{ref:Ge,message:Pt,type:Yt,...hn}=yt;Vi(s.errors,Re,{...hn,...Fe,ref:_t}),I.state.next({name:Re,errors:s.errors,isValid:!1}),Ke&&Ke.shouldFocus&&_t&&_t.focus&&_t.focus()},ze=(Re,Fe)=>Dh(Re)?I.values.subscribe({next:Ke=>Re(le(void 0,Fe),Ke)}):le(Re,Fe,!0),et=(Re,Fe={})=>{for(const Ke of Re?qO(Re):E.mount)E.mount.delete(Ke),E.array.delete(Ke),Fe.keepValue||(to(a,Ke),to(d,Ke)),!Fe.keepError&&to(s.errors,Ke),!Fe.keepDirty&&to(s.dirtyFields,Ke),!Fe.keepTouched&&to(s.touchedFields,Ke),!Fe.keepIsValidating&&to(s.validatingFields,Ke),!t.shouldUnregister&&!Fe.keepDefaultValue&&to(l,Ke);I.values.next({values:{...d}}),I.state.next({...s,...Fe.keepDirty?{isDirty:he()}:{}}),!Fe.keepIsValid&&H()},nt=({disabled:Re,name:Fe,field:Ke,fields:_t})=>{(Ah(Re)&&f.mount||Re||E.disabled.has(Fe))&&(Re?E.disabled.add(Fe):E.disabled.delete(Fe),ge(Fe,k2(Ke?Ke._f:on(_t,Fe)._f),!1,!1,!0))},dt=(Re,Fe={})=>{let Ke=on(a,Re);const _t=Ah(Fe.disabled)||Ah(t.disabled);return Vi(a,Re,{...Ke||{},_f:{...Ke&&Ke._f?Ke._f:{ref:{name:Re}},name:Re,mount:!0,...Fe}}),E.mount.add(Re),Ke?nt({field:Ke,disabled:Ah(Fe.disabled)?Fe.disabled:t.disabled,name:Re}):se(Re,!0,Fe.value),{..._t?{disabled:Fe.disabled||t.disabled}:{},...t.progressive?{required:!!Fe.required,min:ow(Fe.min),max:ow(Fe.max),minLength:ow(Fe.minLength),maxLength:ow(Fe.maxLength),pattern:ow(Fe.pattern)}:{},name:Re,onChange:Ce,onBlur:Ce,ref:yt=>{if(yt){dt(Re,Fe),Ke=on(a,Re);const Ge=Bs(yt.value)&&yt.querySelectorAll&&yt.querySelectorAll("input,select,textarea")[0]||yt,Pt=c5e(Ge),Yt=Ke._f.refs||[];if(Pt?Yt.find(hn=>hn===Ge):Ge===Ke._f.ref)return;Vi(a,Re,{_f:{...Ke._f,...Pt?{refs:[...Yt.filter(O2),Ge,...Array.isArray(on(l,Re))?[{}]:[]],ref:{type:Ge.type,name:Re}}:{ref:Ge}}}),se(Re,!1,void 0,Ge)}else Ke=on(a,Re,{}),Ke._f&&(Ke._f.mount=!1),(t.shouldUnregister||Fe.shouldUnregister)&&!(QBe(E.array,Re)&&f.action)&&E.unMount.add(Re)}}},Xe=()=>t.shouldFocusError&&Hw(a,ye,E.mount),Ct=Re=>{Ah(Re)&&(I.state.next({disabled:Re}),Hw(a,(Fe,Ke)=>{const _t=on(a,Ke);_t&&(Fe.disabled=_t._f.disabled||Re,Array.isArray(_t._f.refs)&&_t._f.refs.forEach(yt=>{yt.disabled=_t._f.disabled||Re}))},0,!1))},dn=(Re,Fe)=>async Ke=>{let _t;Ke&&(Ke.preventDefault&&Ke.preventDefault(),Ke.persist&&Ke.persist());let yt=mu(d);if(E.disabled.size)for(const Ge of E.disabled)Vi(yt,Ge,void 0);if(I.state.next({isSubmitting:!0}),t.resolver){const{errors:Ge,values:Pt}=await Q();s.errors=Ge,yt=Pt}else await oe(a);if(to(s.errors,"root"),jc(s.errors)){I.state.next({errors:{}});try{await Re(yt,Ke)}catch(Ge){_t=Ge}}else Fe&&await Fe({...s.errors},Ke),Xe(),setTimeout(Xe);if(I.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:jc(s.errors)&&!_t,submitCount:s.submitCount+1,errors:s.errors}),_t)throw _t},Ut=(Re,Fe={})=>{on(a,Re)&&(Bs(Fe.defaultValue)?we(Re,mu(on(l,Re))):(we(Re,Fe.defaultValue),Vi(l,Re,mu(Fe.defaultValue))),Fe.keepTouched||to(s.touchedFields,Re),Fe.keepDirty||(to(s.dirtyFields,Re),s.isDirty=Fe.defaultValue?he(Re,mu(on(l,Re))):he()),Fe.keepError||(to(s.errors,Re),R.isValid&&H()),I.state.next({...s}))},ln=(Re,Fe={})=>{const Ke=Re?mu(Re):l,_t=mu(Ke),yt=jc(Re),Ge=yt?l:_t;if(Fe.keepDefaultValues||(l=Ke),!Fe.keepValues){if(Fe.keepDirtyValues){const Pt=new Set([...E.mount,...Object.keys(sw(l,d))]);for(const Yt of Array.from(Pt))on(s.dirtyFields,Yt)?Vi(Ge,Yt,on(d,Yt)):we(Yt,on(Ge,Yt))}else{if(Jj&&Bs(Re))for(const Pt of E.mount){const Yt=on(a,Pt);if(Yt&&Yt._f){const hn=Array.isArray(Yt._f.refs)?Yt._f.refs[0]:Yt._f.ref;if(Uk(hn)){const an=hn.closest("form");if(an){an.reset();break}}}}a={}}d=t.shouldUnregister?Fe.keepDefaultValues?mu(l):{}:mu(Ge),I.array.next({values:{...Ge}}),I.values.next({values:{...Ge}})}E={mount:Fe.keepDirtyValues?E.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},f.mount=!R.isValid||!!Fe.keepIsValid||!!Fe.keepDirtyValues,f.watch=!!t.shouldUnregister,I.state.next({submitCount:Fe.keepSubmitCount?s.submitCount:0,isDirty:yt?!1:Fe.keepDirty?s.isDirty:!!(Fe.keepDefaultValues&&!Jm(Re,l)),isSubmitted:Fe.keepIsSubmitted?s.isSubmitted:!1,dirtyFields:yt?{}:Fe.keepDirtyValues?Fe.keepDefaultValues&&d?sw(l,d):s.dirtyFields:Fe.keepDefaultValues&&Re?sw(l,Re):Fe.keepDirty?s.dirtyFields:{},touchedFields:Fe.keepTouched?s.touchedFields:{},errors:Fe.keepErrors?s.errors:{},isSubmitSuccessful:Fe.keepIsSubmitSuccessful?s.isSubmitSuccessful:!1,isSubmitting:!1})},Ln=(Re,Fe)=>ln(Dh(Re)?Re(d):Re,Fe);return{control:{register:dt,unregister:et,getFieldState:Se,handleSubmit:dn,setError:Ue,_executeSchema:Q,_getWatch:le,_getDirty:he,_updateValid:H,_removeUnmounted:pe,_updateFieldArray:K,_updateDisabledField:nt,_getFieldArray:Me,_reset:ln,_resetDefaultValues:()=>Dh(t.defaultValues)&&t.defaultValues().then(Re=>{Ln(Re,t.resetOptions),I.state.next({isLoading:!1})}),_updateFormState:Re=>{s={...s,...Re}},_disableForm:Ct,_subjects:I,_proxyFormState:R,_setErrors:de,get _fields(){return a},get _formValues(){return d},get _state(){return f},set _state(Re){f=Re},get _defaultValues(){return l},get _names(){return E},set _names(Re){E=Re},get _formState(){return s},set _formState(Re){s=Re},get _options(){return t},set _options(Re){t={...t,...Re}}},trigger:Ne,register:dt,handleSubmit:dn,watch:ze,setValue:we,getValues:Te,reset:Ln,resetField:Ut,clearErrors:Ae,unregister:et,setError:Ue,setFocus:(Re,Fe={})=>{const Ke=on(a,Re),_t=Ke&&Ke._f;if(_t){const yt=_t.refs?_t.refs[0]:_t.ref;yt.focus&&(yt.focus(),Fe.shouldSelect&&Dh(yt.select)&&yt.select())}},getFieldState:Se}}function Jie(r={}){const t=ni.useRef(void 0),s=ni.useRef(void 0),[a,l]=ni.useState({isDirty:!1,isValidating:!1,isLoading:Dh(r.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:r.errors||{},disabled:r.disabled||!1,defaultValues:Dh(r.defaultValues)?void 0:r.defaultValues});t.current||(t.current={...m5e(r),formState:a});const d=t.current.control;return d._options=r,n5e({subject:d._subjects.state,next:f=>{t5e(f,d._proxyFormState,d._updateFormState)&&l({...d._formState})}}),ni.useEffect(()=>d._disableForm(r.disabled),[d,r.disabled]),ni.useEffect(()=>{if(d._proxyFormState.isDirty){const f=d._getDirty();f!==a.isDirty&&d._subjects.state.next({isDirty:f})}},[d,a.isDirty]),ni.useEffect(()=>{r.values&&!Jm(r.values,s.current)?(d._reset(r.values,d._options.resetOptions),s.current=r.values,l(f=>({...f}))):d._resetDefaultValues()},[r.values,d]),ni.useEffect(()=>{r.errors&&d._setErrors(r.errors)},[r.errors,d]),ni.useEffect(()=>{d._state.mount||(d._updateValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),ni.useEffect(()=>{r.shouldUnregister&&d._subjects.values.next({values:d._getWatch()})},[r.shouldUnregister,d]),t.current.formState=e5e(a,d),t.current}const UN=(r,t="generic-modal")=>{L.useEffect(()=>{if(!window.unityInstance)return;const s=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),be.log(`Unity input disabled for ${t}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=t}catch(l){be.error(`Failed to disable Unity input for ${t}:`,l)}},a=()=>{try{window.unityInputDisabledBy===t?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),be.log(`Unity input re-enabled (was disabled by ${t})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):be.log(`Not re-enabling Unity input for ${t} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){be.error(`Failed to enable Unity input for ${t}:`,l)}};return r?s():a(),()=>{r&&a()}},[r,t])};function t4({mode:r,label:t,buttonProps:s={},isOpen:a,onClose:l}){const{register:d,handleSubmit:f,formState:{errors:E}}=Jie(),{register:v}=L.useContext(Pu),T=Zh(),{fullscreenRef:R}=Pd(),[I,N]=L.useState(!1),[F,j]=L.useState(!1),G=a!==void 0?a:I,H=l||(()=>N(!1));UN(G);const te=async de=>{const{email:se,password:ge,confirmPassword:Z,...Q}=de;if(ge!==Z){T({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}j(!0);try{const ne=await v(se,ge,Q);be.log("User: Registration process complete."),H(),T({title:"Registration Successful",description:"Your account has been created. Please check your email to verify your account before signing in.",status:"success",duration:7e3,isClosable:!0,position:"top"})}catch(ne){be.error("User: Registration Error:",ne),T({title:"Error",description:"An error occurred during registration. Please try again.",status:"error",duration:3e3,isClosable:!0,position:"top"})}finally{j(!1)}},K=()=>{l?l():N(!I)},ee=r==="link"?P.jsx(vu,{variant:"header",onClick:K,children:t}):P.jsx(is,{onClick:K,...s,children:t});return P.jsxs(P.Fragment,{children:[!a&&ee,P.jsxs(tc,{isOpen:G,onClose:H,size:"md",portalProps:{containerRef:R},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[P.jsx(ic,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),P.jsxs(nc,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:de=>{de.stopPropagation()},children:[P.jsxs(Cu,{p:8,textAlign:"center",children:[P.jsx(fk,{size:"lg",mb:2,children:"Create Account"}),P.jsx(St,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),P.jsx(Xc,{color:"gray.400"}),P.jsx(rc,{px:8,children:P.jsx("form",{onSubmit:f(te),children:P.jsxs(ji,{spacing:4,children:[P.jsxs(rs,{isInvalid:E.companyName,isRequired:!0,children:[P.jsx(To,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("companyName",{required:"Company name is required"})}),P.jsx(tf,{children:E.companyName&&E.companyName.message})]}),P.jsxs(Qo,{gap:4,w:"100%",children:[P.jsxs(rs,{isInvalid:E.firstName,isRequired:!0,children:[P.jsx(To,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("firstName",{required:"First name is required"})}),P.jsx(tf,{children:E.firstName&&E.firstName.message})]}),P.jsxs(rs,{isInvalid:E.lastName,isRequired:!0,children:[P.jsx(To,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("lastName",{required:"Last name is required"})}),P.jsx(tf,{children:E.lastName&&E.lastName.message})]})]}),P.jsxs(rs,{isInvalid:E.email,isRequired:!0,children:[P.jsx(To,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),P.jsx(tf,{children:E.email&&E.email.message})]}),P.jsxs(Qo,{gap:4,w:"100%",children:[P.jsxs(rs,{isInvalid:E.password,isRequired:!0,children:[P.jsx(To,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),P.jsx(tf,{children:E.password&&E.password.message})]}),P.jsxs(rs,{isInvalid:E.confirmPassword,isRequired:!0,children:[P.jsx(To,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("confirmPassword",{required:"Confirm password is required"})}),P.jsx(tf,{children:E.confirmPassword&&E.confirmPassword.message})]})]}),P.jsx(rs,{children:P.jsx(To,{placeholder:"Access Code",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("accessCode")})}),P.jsx(rs,{children:P.jsx(To,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("linkedInProfile")})})]})})}),P.jsxs(SE,{px:8,pb:8,flexDirection:"column",gap:4,children:[P.jsx(is,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:f(te),isLoading:F,loadingText:"Creating Account",children:"Create Account"}),P.jsxs(St,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",P.jsx(vu,{color:"blue.400",onClick:()=>{H(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]})]})}t4.propTypes={mode:Ur.oneOf(["button","link"]),label:Ur.string,buttonProps:Ur.object,isOpen:Ur.bool,onClose:Ur.func};const g5e=DR({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),rJ=DR({displayName:"EmailIcon",path:P.jsxs("g",{fill:"currentColor",children:[P.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),P.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),_5e=DR({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),E5e=DR({displayName:"QuestionOutlineIcon",path:P.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[P.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),P.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),P.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),y5e=DR({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"});function n4({mode:r="button",label:t="Sign In",buttonProps:s={},initialIsOpen:a=!1}){const{signIn:l}=L.useContext(Pu),{fullscreenRef:d}=Pd(),f=Zh(),{register:E,handleSubmit:v,formState:{errors:T,isSubmitting:R}}=Jie({defaultValues:{email:"neil@pursey.net",password:"123456"}}),[I,N]=L.useState(a),[F,j]=L.useState(!1),[G,H]=L.useState(!1),[te,K]=L.useState(""),[ee,de]=L.useState(!1);UN(I||G),L.useEffect(()=>{const pe=()=>{N(!0)};return window.addEventListener("openSignInModal",pe),()=>{window.removeEventListener("openSignInModal",pe)}},[]);const se=async pe=>{try{await l(pe.email,pe.password),be.log("User: Sign-in process complete."),N(!1),window.location.reload()}catch(he){be.error("User: SignIn Error:",he);const le=he.message||"An error occurred while logging in. Please check your credentials.",Me=le.includes("verify your email");f({title:Me?"Email Verification Required":"Error",description:le,status:Me?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:d.current})}},ge=async()=>{if(!te){f({title:"Email Required",description:"Please enter your email address to reset your password.",status:"warning",duration:3e3,isClosable:!0,position:"top",container:d.current});return}try{de(!0),await AUe(_ie,te),f({title:"Password Reset Email Sent",description:"Check your email for instructions to reset your password.",status:"success",duration:5e3,isClosable:!0,position:"top",container:d.current}),H(!1)}catch(pe){be.error("User: Reset Password Error:",pe),f({title:"Error",description:pe.message||"Failed to send password reset email. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:d.current})}finally{de(!1)}},Z=()=>N(pe=>!pe),Q=()=>{N(!1),j(!0)},ne=()=>{H(!0)},oe=r==="link"?P.jsx(vu,{variant:"header",onClick:Z,children:t}):P.jsx(is,{onClick:Z,...s,children:t});return P.jsxs(P.Fragment,{children:[oe,P.jsxs(tc,{isOpen:I,onClose:Z,size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[P.jsx(ic,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),P.jsx("form",{onSubmit:v(se),children:P.jsxs(nc,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:pe=>{pe.stopPropagation()},children:[P.jsxs(Cu,{p:8,textAlign:"center",children:[P.jsx(fk,{size:"lg",mb:2,children:"Welcome Back"}),P.jsx(St,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),P.jsx(Xc,{color:"gray.400"}),P.jsx(rc,{px:8,pb:8,children:P.jsxs(ji,{spacing:4,children:[P.jsxs(rs,{isInvalid:T.email,children:[P.jsxs(kO,{children:[P.jsx(Mw,{pointerEvents:"none",children:P.jsx(rJ,{color:"gray.500"})}),P.jsx(To,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...E("email",{required:"Email is required."})})]}),P.jsx(tf,{children:T.email&&T.email.message})]}),P.jsxs(rs,{isInvalid:T.password,children:[P.jsxs(kO,{children:[P.jsx(Mw,{pointerEvents:"none",children:P.jsx(g5e,{color:"gray.500"})}),P.jsx(To,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...E("password",{required:"Password is required."})})]}),P.jsx(tf,{children:T.password&&T.password.message})]}),P.jsx(kt,{alignSelf:"flex-end",children:P.jsx(vu,{color:"blue.400",fontSize:"sm",onClick:ne,children:"Forgot Password?"})})]})}),P.jsxs(SE,{px:8,pb:8,flexDirection:"column",gap:4,children:[P.jsx(is,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:R,loadingText:"Signing In",children:"Sign In"}),P.jsxs(St,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",P.jsx(vu,{color:"blue.400",onClick:Q,children:"Sign Up"})]})]})]})})]}),P.jsxs(tc,{isOpen:G,onClose:()=>H(!1),size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[P.jsx(ic,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),P.jsxs(nc,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:pe=>{pe.stopPropagation()},children:[P.jsxs(Cu,{p:8,textAlign:"center",children:[P.jsx(fk,{size:"lg",mb:2,children:"Reset Password"}),P.jsx(St,{fontSize:"sm",color:"gray.400",children:"Enter your email to receive password reset instructions"})]}),P.jsx(Xc,{color:"gray.400"}),P.jsx(rc,{px:8,pb:4,children:P.jsx(rs,{children:P.jsxs(kO,{children:[P.jsx(Mw,{pointerEvents:"none",children:P.jsx(rJ,{color:"gray.500"})}),P.jsx(To,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},value:te,onChange:pe=>K(pe.target.value)})]})})}),P.jsxs(SE,{px:8,pb:8,flexDirection:"column",gap:4,children:[P.jsx(is,{colorScheme:"blue",size:"lg",width:"100%",onClick:ge,isLoading:ee,loadingText:"Sending",children:"Send Reset Link"}),P.jsxs(St,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Remember your password?"," ",P.jsx(vu,{color:"blue.400",onClick:()=>H(!1),children:"Back to Sign In"})]})]})]})]}),P.jsx(t4,{mode:"link",isOpen:F,onClose:()=>j(!1)})]})}n4.propTypes={mode:Ur.oneOf(["button","link"]),label:Ur.string,buttonProps:Ur.object,initialIsOpen:Ur.bool};function v5e(){const{loadingProgression:r,isLoaded:t,error:s}=Jc(),{user:a}=L.useContext(Pu),[l,d]=L.useState(!1),[f,E]=L.useState(!1),[v,T]=L.useState(!1),[R,I]=L.useState(!1),N=L.useRef(!1),F=L.useRef(!1),j=L.useRef(null),G=L.useRef(null),H=L.useRef(null),te=kf(),K=L.useRef(null),ee=L.useRef(null),de=L.useRef(null),se=L.useRef(null);L.useEffect(()=>{d(!a&&r===0)},[a,r]),L.useEffect(()=>{const Q=document.createElement("style");return Q.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(Q),K.current=Q,()=>{K.current&&document.head.removeChild(K.current)}},[]),L.useEffect(()=>{const Q=()=>{const ne=document.getElementById("unity-canvas"),oe=document.getElementById("unity-container");ne&&(j.current=ne,console.log("LoaderProgress: Found Unity canvas"),ne.style.zIndex="1"),oe&&(G.current=oe,console.log("LoaderProgress: Found Unity container"),oe.style.zIndex="1"),ne&&oe&&de.current&&(clearInterval(de.current),de.current=null)};return Q(),de.current=setInterval(Q,100),()=>{de.current&&(clearInterval(de.current),de.current=null)}},[]),L.useEffect(()=>{console.log("LoaderProgress: Setting up FirstSceneLoaded listener"),window.isFirstSceneLoaded&&(console.log("LoaderProgress: FirstSceneLoaded already set via window flag"),F.current=!0,I(!0));const ne=te("FirstSceneLoaded",()=>{console.log("LoaderProgress: FirstSceneLoaded event received"),F.current=!0,I(!0),window.isFirstSceneLoaded=!0}),oe=setTimeout(()=>{F.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded after timeout"),F.current=!0,I(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{ne(),clearTimeout(oe)}},[te]),L.useEffect(()=>{console.log("LoaderProgress: Setting up PlayerInstantiated listener"),window.isPlayerInstantiated&&(console.log("LoaderProgress: Player already instantiated via window flag"),N.current=!0,T(!0),F.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because player is already instantiated"),F.current=!0,I(!0),window.isFirstSceneLoaded=!0));const Q=()=>{console.log("LoaderProgress: PlayerInstantiated event received"),N.current=!0,T(!0),F.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because player is instantiated"),F.current=!0,I(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",Q);const ne=te("PlayerInstantiated",Q),oe=setTimeout(()=>{N.current||(console.log("LoaderProgress: Forcing player instantiation after timeout"),N.current=!0,T(!0),F.current||(console.log("LoaderProgress: Forcing FirstSceneLoaded because of timeout"),F.current=!0,I(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",Q),ne(),clearTimeout(oe)}},[te]),L.useEffect(()=>(console.log("LoaderProgress: Handling visibility changes",{isFirstSceneLoaded:R,isPlayerInstantiated:v}),R&&v&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),ee.current&&clearTimeout(ee.current),ee.current=setTimeout(()=>{console.log("LoaderProgress: Showing Unity canvas now"),j.current&&(j.current.style.opacity="1",j.current.style.removeProperty("opacity")),G.current&&(G.current.style.opacity="1",G.current.style.removeProperty("opacity")),H.current&&(H.current.style.opacity="0",H.current.style.pointerEvents="none",setTimeout(()=>{H.current&&(H.current.style.display="none")},1500))},2e3)),()=>{ee.current&&clearTimeout(ee.current)}),[R,v]),L.useEffect(()=>(se.current=setInterval(()=>{var Q,ne;console.log("LoaderProgress: Debug interval",{isLoaded:t,isFirstSceneLoaded:F.current,isPlayerInstantiated:N.current,windowFirstSceneLoaded:window.isFirstSceneLoaded,windowPlayerInstantiated:window.isPlayerInstantiated,unityCanvasZIndex:(Q=j.current)==null?void 0:Q.style.zIndex,loaderZIndex:(ne=H.current)==null?void 0:ne.style.zIndex})},5e3),()=>{se.current&&clearInterval(se.current)}),[t]),L.useEffect(()=>{console.log("LoaderProgress: State updated",{isLoaded:t,isFirstSceneLoaded:R,isPlayerInstantiated:v,loadingProgression:r})},[t,R,v,r]);const ge=()=>t?t&&!R&&!v?"Scene initializing":R&&!v?"Player initializing":"Ready":"World loading",Z=()=>t?t&&!R&&!v?85:R&&!v?95:100:r*80;return P.jsx(P.Fragment,{children:l?P.jsx(kt,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:P.jsxs(ji,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[P.jsx(St,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),P.jsx(St,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),P.jsx(is,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>E(!0),children:"Sign In"})]})}):P.jsx(kt,{ref:H,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:P.jsxs(Qo,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[P.jsx(St,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),P.jsx(St,{fontSize:"sm",children:ge()}),P.jsx(t0,{value:Z(),size:"lg",width:"100%",marginY:2})]})})})}function Qie({mode:r="button",label:t="Sign Out"}){const s=Zh(),{signOut:a}=L.useContext(Pu),{fullscreenRef:l}=Pd(),d=async()=>{try{await a(),s({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(E){console.error("SignOut Error:",E),s({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},f=r==="link"?P.jsx(vu,{variant:"header",onClick:d,style:{cursor:"pointer"},children:t}):null;return P.jsx(P.Fragment,{children:f})}Qie.propTypes={mode:Ur.oneOf(["button","link"]),label:Ur.string};function S5e(){const{user:r}=L.useContext(Pu);return P.jsx("div",{children:r!==null?P.jsx("div",{children:P.jsx(Qie,{})}):P.jsxs("div",{children:[P.jsx(t4,{}),P.jsx(n4,{})]})})}function T5e(){const{fullscreenRef:r}=Pd(),[t,s]=L.useState(!1),a=()=>{s(!t)};return P.jsxs(P.Fragment,{children:[P.jsx(eg,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:r},children:P.jsx(Pa,{"aria-label":"Controller Help",icon:P.jsx(E5e,{}),onClick:a,variant:"iconButton"})}),P.jsxs(tc,{isOpen:t,onClose:a,size:"md",portalProps:{containerRef:r},children:[P.jsx(ic,{}),P.jsxs(nc,{children:[P.jsx(Cu,{children:"Notes"}),P.jsx(Xc,{}),P.jsx(rc,{children:P.jsx(St,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),P.jsx(SE,{children:P.jsx(is,{variant:"primary",onClick:a,children:"Close"})})]})]})]})}var Zie={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},iJ=ni.createContext&&ni.createContext(Zie),og=function(){return og=Object.assign||function(r){for(var t,s=1,a=arguments.length;s<a;s++){t=arguments[s];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(r[l]=t[l])}return r},og.apply(this,arguments)},b5e=function(r,t){var s={};for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&t.indexOf(a)<0&&(s[a]=r[a]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(r);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(r,a[l])&&(s[a[l]]=r[a[l]]);return s};function ese(r){return r&&r.map(function(t,s){return ni.createElement(t.tag,og({key:s},t.attr),ese(t.child))})}function Vr(r){return function(t){return ni.createElement(w5e,og({attr:og({},r.attr)},t),ese(r.child))}}function w5e(r){var t=function(s){var a=r.attr,l=r.size,d=r.title,f=b5e(r,["attr","size","title"]),E=l||s.size||"1em",v;return s.className&&(v=s.className),r.className&&(v=(v?v+" ":"")+r.className),ni.createElement("svg",og({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},s.attr,a,f,{className:v,style:og(og({color:r.color||s.color},s.style),r.style),height:E,width:E,xmlns:"http://www.w3.org/2000/svg"}),d&&ni.createElement("title",null,d),r.children)};return iJ!==void 0?ni.createElement(iJ.Consumer,null,function(s){return t(s)}):t(Zie)}function tse(r){return Vr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(r)}function R5e(r){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.034 8 8 119.033 8 256s111.034 248 248 248 248-111.034 248-248S392.967 8 256 8zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676zM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676z"}}]})(r)}function lV(r){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(r)}function C5e(r){return Vr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(r)}function I5e(r){return Vr({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(r)}function A5e(r){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(r)}function nse(r){return Vr({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(r)}function P5e(r){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(r)}function O5e(r){return Vr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(r)}function uV(r){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(r)}function dV(r){return Vr({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(r)}function k5e(r){return Vr({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(r)}function N5e(r){return Vr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(r)}function D5e(r){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(r)}function hV(r){return Vr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(r)}function L5e(r){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(r)}function x5e(r){return Vr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(r)}function M5e(r){return Vr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zM461.64 256l45.64-45.64c6.3-6.3 6.3-16.52 0-22.82l-22.82-22.82c-6.3-6.3-16.52-6.3-22.82 0L416 210.36l-45.64-45.64c-6.3-6.3-16.52-6.3-22.82 0l-22.82 22.82c-6.3 6.3-6.3 16.52 0 22.82L370.36 256l-45.63 45.63c-6.3 6.3-6.3 16.52 0 22.82l22.82 22.82c6.3 6.3 16.52 6.3 22.82 0L416 301.64l45.64 45.64c6.3 6.3 16.52 6.3 22.82 0l22.82-22.82c6.3-6.3 6.3-16.52 0-22.82L461.64 256z"}}]})(r)}function U5e(r){return Vr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zm233.32-51.08c-11.17-7.33-26.18-4.24-33.51 6.95-7.34 11.17-4.22 26.18 6.95 33.51 66.27 43.49 105.82 116.6 105.82 195.58 0 78.98-39.55 152.09-105.82 195.58-11.17 7.32-14.29 22.34-6.95 33.5 7.04 10.71 21.93 14.56 33.51 6.95C528.27 439.58 576 351.33 576 256S528.27 72.43 448.35 19.97zM480 256c0-63.53-32.06-121.94-85.77-156.24-11.19-7.14-26.03-3.82-33.12 7.46s-3.78 26.21 7.41 33.36C408.27 165.97 432 209.11 432 256s-23.73 90.03-63.48 115.42c-11.19 7.14-14.5 22.07-7.41 33.36 6.51 10.36 21.12 15.14 33.12 7.46C447.94 377.94 480 319.54 480 256zm-141.77-76.87c-11.58-6.33-26.19-2.16-32.61 9.45-6.39 11.61-2.16 26.2 9.45 32.61C327.98 228.28 336 241.63 336 256c0 14.38-8.02 27.72-20.92 34.81-11.61 6.41-15.84 21-9.45 32.61 6.43 11.66 21.05 15.8 32.61 9.45 28.23-15.55 45.77-45 45.77-76.88s-17.54-61.32-45.78-76.86z"}}]})(r)}function rse({open:r,onClose:t}){const s=L.useRef(null),a=wg(),{user:l}=L.useContext(Pu),d=v=>{s.current&&!s.current.contains(v.target)&&t()},f=async v=>{const T=E(v);if((T==null?void 0:T.source)==="readyplayerme"&&(T.eventName==="v1.frame.ready"&&s.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),T.eventName==="v1.avatar.exported")){const R=T.data.url;if(console.log(`Avatar URL: ${R}`),a("AvatarUrlFromReact",{url:R}),l&&l.uid)try{await Eie(l.uid,R),t()}catch(I){console.error("Error updating RPM URL:",I)}else console.error("No authenticated user found to update rpmURL.")}},E=v=>{try{return JSON.parse(v.data)}catch{return null}};return L.useEffect(()=>(r&&(document.addEventListener("mousedown",d),window.addEventListener("message",f)),()=>{document.removeEventListener("mousedown",d),window.removeEventListener("message",f)}),[r]),r&&P.jsx(Au,{children:P.jsx(kt,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:v=>v.stopPropagation(),children:P.jsx(kt,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:P.jsx("iframe",{ref:s,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function V5e({isOpen:r,onClose:t}){const[s,a]=L.useState(!1),[l,d]=L.useState(null),{user:f}=L.useContext(Pu),E=wg(),v=j=>{j.stopPropagation(),a(!0)},T=()=>{a(!1),t()},R=async j=>{if(d(j),f&&f.uid)try{await Eie(f.uid,j.url),E("AvatarUrlFromReact",{url:j.url}),t()}catch(G){console.error("Error updating RPM URL:",G)}else console.error("No authenticated user found to update rpmURL.")},I=DRe("gray.200","whiteAlpha.300"),N="rgba(0, 0, 0, 0.3)",F=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return P.jsxs(P.Fragment,{children:[P.jsx(Au,{children:P.jsxs(tc,{isOpen:r,onClose:t,isCentered:!0,size:"xl",zIndex:9999,children:[P.jsx(ic,{bg:"rgba(0, 0, 0, 0.7)"}),P.jsxs(nc,{bg:"gray.800",color:"white",maxW:"900px",children:[P.jsx(Cu,{fontSize:"lg",children:"Customise Your Avatar"}),P.jsx(Xc,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),P.jsx(rc,{pb:4,children:P.jsxs(ji,{spacing:4,align:"stretch",children:[P.jsx(St,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),P.jsxs(ete,{columns:5,spacing:2,children:[P.jsx(kt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:I,borderRadius:"lg",overflow:"hidden",onClick:v,_hover:{bg:N},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:P.jsxs(ji,{spacing:1,children:[P.jsx(Wn,{as:N5e,boxSize:4}),P.jsx(St,{fontSize:"xs",children:"Create Custom Avatar"})]})}),F.map(j=>P.jsxs(kt,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===j.id?"blue.400":I,borderRadius:"lg",overflow:"hidden",onClick:()=>R(j),_hover:{bg:N},transition:"all 0.2s",aspectRatio:"1",children:[P.jsx(xh,{src:j.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:j.name,width:"100%",height:"100%",objectFit:"cover"}),P.jsx(kt,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:P.jsx(St,{fontSize:"xs",children:j.name})})]},j.id))]})]})})]})]})}),s&&P.jsx(rse,{open:s,onClose:T})]})}function F5e(){const{fullscreenRef:r}=Pd(),[t,s]=L.useState(!1),[a,l]=L.useState(!1),[d,f]=L.useState(!1),[E,v]=L.useState(!1),{user:T}=L.useContext(Pu),[R,I]=L.useState(null),[N,F]=L.useState(!0),j=(K,ee)=>!K||!ee?"?":`${K.charAt(0)}${ee.charAt(0)}`.toUpperCase(),G=async()=>{if(T!=null&&T.uid){F(!0);try{const K=await Jh(T.uid);I({rpmURL:K.rpmURL?K.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:K.firstName,lastName:K.lastName})}catch(K){console.error("Error fetching profile data:",K)}finally{F(!1)}}};L.useEffect(()=>{G()},[T==null?void 0:T.uid]),L.useEffect(()=>{const K=()=>{s(!0)};return window.addEventListener("PlayerInstantiated",K),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]);const H=()=>l(!a),te=()=>{l(!1),G()};return t?P.jsxs(P.Fragment,{children:[P.jsx(eg,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:E,portalProps:{containerRef:r},children:P.jsxs(kt,{position:"relative",onMouseEnter:()=>{f(!0),v(!0)},onMouseLeave:()=>{f(!1),v(!1)},cursor:"pointer",onClick:H,children:[P.jsx(vf,{src:N||R==null?void 0:R.rpmURL,size:"md",borderRadius:"full",bg:"white",name:N?j(R==null?void 0:R.firstName,R==null?void 0:R.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),d&&P.jsx(kt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:P.jsx(St,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),P.jsx(V5e,{isOpen:a,onClose:te})]}):null}function j5e(r){return Vr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(r)}function B5e(r){return Vr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(r)}function W5e(){const{isFullscreen:r,toggleFullscreen:t,fullscreenRef:s,isMobile:a}=Pd(),l=Zh();L.useEffect(()=>{const f=E=>{console.error("Fullscreen error:",E),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",f),document.addEventListener("webkitfullscreenerror",f),document.addEventListener("mozfullscreenerror",f),document.addEventListener("MSFullscreenError",f),()=>{document.removeEventListener("fullscreenerror",f),document.removeEventListener("webkitfullscreenerror",f),document.removeEventListener("mozfullscreenerror",f),document.removeEventListener("MSFullscreenError",f)}},[l]);const d=()=>{s.current?(a&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!r&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),t()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return P.jsx(eg,{label:r?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:s},children:P.jsx(Pa,{"aria-label":r?"Exit Fullscreen":"Enter Fullscreen",icon:r?P.jsx(j5e,{}):P.jsx(B5e,{}),onClick:d,variant:"iconButton",size:a?"lg":"md"})})}const sJ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function z5e(){const{isOpen:r,onOpen:t,onClose:s}=ag(),{fullscreenRef:a}=Pd(),[l,d]=WBe(!1);L.useEffect(()=>{be.log("VideoPlayer: Current video URL:",l),l&&(be.log("VideoPlayer: Opening modal for video URL:",l),t())},[l,t]);const f=()=>{be.log("VideoPlayer: Closing modal"),d(),s()};return P.jsx(Au,{containerRef:a,children:P.jsxs(tc,{isOpen:r,onClose:f,size:"lg",isCentered:!0,portalProps:{containerRef:a},children:[P.jsx(ic,{bg:"rgba(0, 0, 0, 0.8)"}),P.jsxs(nc,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[P.jsx(Xc,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),P.jsx(rc,{p:0,width:"100%",children:l&&P.jsx(kt,{style:sJ.iframeContainer,children:P.jsx("iframe",{src:l,style:sJ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function G5e({isOpen:r,onClose:t,playerName:s,playerId:a,uid:l}){const[d,f]=L.useState(null),[E,v]=L.useState(!0),[T,R]=L.useState(null);return L.useEffect(()=>{r&&(async()=>{if(v(!0),R(null),!l){be.warn("NameplateModal: No UID provided for player:",s),R("No user ID available for this player"),v(!1);return}try{be.log("NameplateModal: Fetching profile for UID:",l);const N=await Jh(l);N?f({firstName:N.firstName,lastName:N.lastName,linkedinUrl:N.linkedinUrl,websiteUrl:N.websiteUrl,rpmURL:N.rpmURL?N.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):R("Could not find profile data for this player")}catch(N){be.error("Error fetching profile data:",N),R("Error loading profile data")}finally{v(!1)}})()},[l,r,s]),P.jsxs(tc,{isOpen:r,onClose:t,isCentered:!0,size:"md",children:[P.jsx(ic,{backdropFilter:"blur(10px)"}),P.jsxs(nc,{bg:"gray.900",color:"white",borderRadius:"xl",children:[P.jsx(Cu,{children:"Player Info"}),P.jsx(Xc,{}),P.jsx(rc,{pb:6,children:E?P.jsx(_ee,{py:8,children:P.jsx(Af,{size:"xl",color:"blue.400"})}):T?P.jsxs(qS,{status:"warning",variant:"solid",borderRadius:"md",children:[P.jsx(YS,{}),T]}):P.jsxs(ji,{spacing:4,align:"center",children:[P.jsx(vf,{size:"2xl",src:d==null?void 0:d.rpmURL,bg:"whiteAlpha.300",name:s,borderWidth:"2px",borderColor:"whiteAlpha.300"}),P.jsxs(ji,{spacing:1,children:[P.jsx(St,{fontSize:"2xl",fontWeight:"bold",children:s}),(d==null?void 0:d.firstName)&&P.jsxs(St,{fontSize:"md",color:"gray.400",children:[d.firstName," ",d.lastName]}),P.jsxs(St,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",a]})]}),((d==null?void 0:d.linkedinUrl)||(d==null?void 0:d.websiteUrl))&&P.jsxs(P.Fragment,{children:[P.jsx(dE,{borderColor:"whiteAlpha.300"}),P.jsxs(Ii,{spacing:4,pt:2,children:[(d==null?void 0:d.linkedinUrl)&&P.jsx(vu,{href:d.linkedinUrl,isExternal:!0,children:P.jsx(Pa,{icon:P.jsx(tse,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(d==null?void 0:d.websiteUrl)&&P.jsx(vu,{href:d.websiteUrl,isExternal:!0,children:P.jsx(Pa,{icon:P.jsx(nse,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const H5e=({isVisible:r,onToggleVisibility:t,spaceID:s})=>{const[a]=m1e("(max-width: 768px)"),[l,d]=L.useState(!1);L.useEffect(()=>{(()=>{const Ce=navigator.userAgent||navigator.vendor||window.opera,Ne=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(Ce);d(Ne),Ne&&be.log("UnityPlayerList: Mobile browser detected, component will not render")})()},[]);const f=a||l,E=Bie(),[v,T]=L.useState(!1),[R,I]=L.useState([]),[N,F]=L.useState(!1),[j,G]=L.useState({}),[H,te]=L.useState({}),[K,ee]=L.useState(null),[de,se]=L.useState(!1),ge=Zh(),Z=window.currentUser||{},ne=(()=>{if(s)return s;if(window.spaceID)return window.spaceID;const Ce=(window.location.pathname||"").split("/"),ye=Ce[Ce.length-1];if(ye&&ye.length>5)return ye;const Ne=document.body.getAttribute("data-space-id");if(Ne)return Ne;const Te=localStorage.getItem("currentSpaceId");return Te||"fallback-space-id"})();L.useEffect(()=>{(async()=>{try{const ye=await sg(ne);ye&&ye.voiceDisabled?(console.log("UnityPlayerList: Voice is disabled for this space"),se(!0)):se(!1)}catch(ye){console.error("UnityPlayerList: Error checking if voice is disabled:",ye)}})();const Ce=ye=>{ye.detail&&typeof ye.detail.voiceDisabled=="boolean"&&(console.log("UnityPlayerList: Voice setting changed:",ye.detail.voiceDisabled),se(ye.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Ce),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Ce)}},[ne]),L.useEffect(()=>{const we={};E.forEach(Ce=>{if(Ce.uid){if(Ce.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)we[Ce.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const ye=window.agoraClient.client.remoteUsers,Ne=ye.find(Te=>String(Te.uid)===String(Ce.uid));if(Ne)we[Ce.uid]=Ne.uid;else{const Te=ye.find(Se=>typeof Se.uid=="string"&&Se.uid.includes(Ce.uid));if(Te)we[Ce.uid]=Te.uid;else{const Se=ye.find(Ae=>typeof Ce.uid=="string"&&Ce.uid.includes(String(Ae.uid)));if(Se)we[Ce.uid]=Se.uid;else{const Ae=ye.filter(Ue=>!(typeof Ue.uid=="string"&&Ue.uid.startsWith("screen-")));Ae.length===1&&!Ce.isLocalPlayer&&(we[Ce.uid]=Ae[0].uid)}}}}}}),te(we)},[E]);const oe=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const we=window.agoraClient.isVoiceEnabled;we!==N&&F(we)}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const we=window.agoraClient.client.remoteUsers,Ce={};we.forEach(ye=>{typeof ye.uid=="string"&&ye.uid.startsWith("screen-")||(Ce[ye.uid]=!!ye.audioTrack&&!ye.audioTrack.muted)}),JSON.stringify(Ce)!==JSON.stringify(j)&&G(Ce)}};L.useEffect(()=>{const we=setInterval(oe,500),Ce=ye=>{ye.detail&&typeof ye.detail.enabled=="boolean"&&F(ye.detail.enabled)};return window.addEventListener("VoiceToggled",Ce),oe(),()=>{clearInterval(we),window.removeEventListener("VoiceToggled",Ce)}},[]),L.useEffect(()=>{const we=()=>{be.log("UnityPlayerList: Player instantiated, showing list"),T(!0)};return window.addEventListener("PlayerInstantiated",we),window.isPlayerInstantiated&&(be.log("UnityPlayerList: Player was already instantiated"),T(!0)),()=>{window.removeEventListener("PlayerInstantiated",we)}},[]),L.useEffect(()=>{(async()=>{const Ce=await Promise.all(E.map(async ye=>{if(ye.uid)try{const Ne=await Jh(ye.uid);let Te=null;if(Ne.groups){const Se=`space_${ne}_owners`,Ae=`space_${ne}_hosts`;Ne.groups.includes(Se)?Te="owner":Ne.groups.includes(Ae)&&(Te="host")}return le({uid:ye.uid})&&ee(Te),{...ye,firstName:Ne.firstName,lastName:Ne.lastName,linkedInProfile:Ne.linkedInProfile,websiteUrl:Ne.websiteUrl,rpmURL:Ne.rpmURL?Ne.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,role:Te}}catch(Ne){return be.error(`Error fetching data for player ${ye.playerName}:`,Ne),ye}return ye}));I(Ce)})()},[E,ne]);const pe=[...R].sort((we,Ce)=>we.isLocalPlayer?-1:Ce.isLocalPlayer?1:0),he=()=>{be.log("UnityPlayerList: Toggling visibility"),t&&t()},le=we=>!!(we.isLocalPlayer||Z&&Z.uid&&we.uid===Z.uid),Me=we=>{try{if(le(we))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:N;if(we.uid){if(j[we.uid])return!0;const Ce=H[we.uid];if(Ce&&j[Ce])return!0;const ye=parseInt(we.uid);if(!isNaN(ye)&&j[ye])return!0}return!1}catch(Ce){return console.error("Error in hasActiveMic:",Ce),!1}},He=({player:we})=>{const Ce=we.role;return Ce==="owner"?P.jsxs(Ii,{spacing:1,bg:"green.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(72, 187, 120, 0.5)",border:"1px solid",borderColor:"green.400",children:[P.jsx(Wn,{as:lV,color:"green.400",boxSize:5}),P.jsx(af,{colorScheme:"green",variant:"solid",fontSize:"md",px:2,children:"Owner"})]}):Ce==="host"?P.jsxs(Ii,{spacing:1,bg:"purple.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(159, 122, 234, 0.5)",border:"1px solid",borderColor:"purple.400",children:[P.jsx(Wn,{as:hV,color:"purple.400",boxSize:5}),P.jsx(af,{colorScheme:"purple",variant:"solid",fontSize:"md",px:2,children:"Host"})]}):null},rt=(we,Ce)=>{switch(console.log(`Action "${we}" performed on player: ${Ce.playerName}`),we){case"mute":ge({title:"Player Muted",description:`${Ce.playerName} has been muted.`,status:"info",duration:3e3,isClosable:!0});break;case"kick":ge({title:"Player Kicked",description:`${Ce.playerName} has been kicked from the space.`,status:"warning",duration:3e3,isClosable:!0});break;case"promote":ge({title:"Player Promoted",description:`${Ce.playerName} has been promoted to host.`,status:"success",duration:3e3,isClosable:!0});break}};return P.jsxs(kt,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:v&&r&&!f?"visible":"hidden",role:"group",children:[P.jsx(kt,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:P.jsx(Pa,{icon:P.jsx(_5e,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:he,_hover:{opacity:.8}})}),P.jsxs(St,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",E.length]}),P.jsx(kt,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:P.jsx(ji,{align:"stretch",spacing:1,width:"100%",children:pe.map((we,Ce)=>{const ye=le(we),Ne=!de&&Me(we);return P.jsx(kt,{children:P.jsxs(Ate,{placement:"left",trigger:"hover",children:[P.jsx(Dte,{children:P.jsxs(Ii,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[P.jsx(vf,{size:"xs",src:we.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),P.jsx(St,{fontSize:"xs",children:we.playerName}),we.role==="owner"&&P.jsx(Wn,{as:lV,color:"green.400",boxSize:2.5}),we.role==="host"&&P.jsx(Wn,{as:hV,color:"purple.400",boxSize:2.5}),P.jsx(pk,{}),K==="owner"&&P.jsxs(HF,{closeOnSelect:!0,placement:"bottom-end",children:[P.jsx($F,{as:Pa,"aria-label":"Options",icon:P.jsx(I5e,{}),variant:"ghost",size:"xs",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.300"},onClick:Te=>Te.stopPropagation()}),P.jsxs(KF,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:[P.jsx(DO,{icon:P.jsx(U5e,{}),onClick:()=>rt("mute",we),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",isDisabled:de,children:"Mute Player"}),P.jsx(DO,{icon:P.jsx(L5e,{}),onClick:()=>rt("promote",we),_hover:{bg:"whiteAlpha.200"},fontSize:"sm",children:"Promote to Host"}),P.jsx(fte,{borderColor:"whiteAlpha.300"}),P.jsx(DO,{icon:P.jsx(R5e,{}),onClick:()=>rt("kick",we),_hover:{bg:"red.800"},color:"red.300",fontSize:"sm",children:"Kick from Space"})]})]}),!de&&(Ne?P.jsx(kt,{color:"green.400",children:P.jsx(dV,{})}):P.jsx(kt,{color:"red.400",children:P.jsx(uV,{})})),ye&&P.jsx(St,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"})]})}),P.jsx(Nte,{bg:"rgba(0,0,0,0.8)",border:"none",boxShadow:"dark-lg",color:"white",p:4,width:"auto",minWidth:"250px",ml:"-20px",position:"absolute",left:"-250px",top:"-100px",transform:"none !important",zIndex:1e4,children:P.jsx(Ote,{children:P.jsxs(ji,{align:"center",spacing:3,children:[P.jsx(vf,{size:"xl",src:we.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),P.jsx(St,{fontSize:"xl",fontWeight:"bold",children:we.playerName}),P.jsx(He,{player:we}),we.firstName&&P.jsxs(St,{fontSize:"sm",color:"gray.300",children:[we.firstName," ",we.lastName]}),P.jsxs(Ii,{spacing:4,pt:2,children:[we.linkedInProfile&&P.jsx(vu,{href:we.linkedInProfile,isExternal:!0,children:P.jsx(Pa,{icon:P.jsx(tse,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),we.websiteUrl&&P.jsx(vu,{href:we.websiteUrl,isExternal:!0,children:P.jsx(Pa,{icon:P.jsx(nse,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),!de&&P.jsx(Pa,{icon:Ne?P.jsx(dV,{}):P.jsx(uV,{}),variant:"ghost",colorScheme:Ne?"green":"red",size:"md","aria-label":"Microphone status",isDisabled:!0}),de&&P.jsx(Pa,{icon:P.jsx(M5e,{}),variant:"ghost",colorScheme:"red",size:"md","aria-label":"Voice chat disabled",isDisabled:!0,title:"Voice chat is disabled for this space"})]})]})})})]})},Ce)})})})]})};var XO={exports:{}},$5e=XO.exports,oJ;function K5e(){return oJ||(oJ=1,function(r,t){(function(s,a){r.exports=a()})($5e,function(){function s(e,n){return n.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(o){if(o!=="default"&&!(o in e)){var c=Object.getOwnPropertyDescriptor(i,o);Object.defineProperty(e,o,c.get?c:{enumerable:!0,get:function(){return i[o]}})}})}),Object.freeze(e)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof eE<"u"?eE:typeof self<"u"?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d=function(e){try{return!!e()}catch{return!0}},f=!d(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),E=f,v=Function.prototype,T=v.call,R=E&&v.bind.bind(T,T),I=E?R:function(e){return function(){return T.apply(e,arguments)}},N=I({}.isPrototypeOf),F=function(e){return e&&e.Math==Math&&e},j=F(typeof globalThis=="object"&&globalThis)||F(typeof window=="object"&&window)||F(typeof self=="object"&&self)||F(typeof a=="object"&&a)||function(){return this}()||a||Function("return this")(),G=f,H=Function.prototype,te=H.apply,K=H.call,ee=typeof Reflect=="object"&&Reflect.apply||(G?K.bind(te):function(){return K.apply(te,arguments)}),de=I,se=de({}.toString),ge=de("".slice),Z=function(e){return ge(se(e),8,-1)},Q=Z,ne=I,oe=function(e){if(Q(e)==="Function")return ne(e)},pe=typeof document=="object"&&document.all,he={all:pe,IS_HTMLDDA:pe===void 0&&pe!==void 0},le=he.all,Me=he.IS_HTMLDDA?function(e){return typeof e=="function"||e===le}:function(e){return typeof e=="function"},He={},rt=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),we=f,Ce=Function.prototype.call,ye=we?Ce.bind(Ce):function(){return Ce.apply(Ce,arguments)},Ne={},Te={}.propertyIsEnumerable,Se=Object.getOwnPropertyDescriptor,Ae=Se&&!Te.call({1:2},1);Ne.f=Ae?function(e){var n=Se(this,e);return!!n&&n.enumerable}:Te;var Ue,ze,et=function(e,n){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:n}},nt=d,dt=Z,Xe=Object,Ct=I("".split),dn=nt(function(){return!Xe("z").propertyIsEnumerable(0)})?function(e){return dt(e)=="String"?Ct(e,""):Xe(e)}:Xe,Ut=function(e){return e==null},ln=Ut,Ln=TypeError,qt=function(e){if(ln(e))throw Ln("Can't call method on "+e);return e},Yn=dn,$t=qt,Re=function(e){return Yn($t(e))},Fe=Me,Ke=he.all,_t=he.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:Fe(e)||e===Ke}:function(e){return typeof e=="object"?e!==null:Fe(e)},yt={},Ge=yt,Pt=j,Yt=Me,hn=function(e){return Yt(e)?e:void 0},an=function(e,n){return arguments.length<2?hn(Ge[e])||hn(Pt[e]):Ge[e]&&Ge[e][n]||Pt[e]&&Pt[e][n]},ir=typeof navigator<"u"&&String(navigator.userAgent)||"",na=j,Vt=ir,sn=na.process,wi=na.Deno,di=sn&&sn.versions||wi&&wi.version,yi=di&&di.v8;yi&&(ze=(Ue=yi.split("."))[0]>0&&Ue[0]<4?1:+(Ue[0]+Ue[1])),!ze&&Vt&&(!(Ue=Vt.match(/Edge\/(\d+)/))||Ue[1]>=74)&&(Ue=Vt.match(/Chrome\/(\d+)/))&&(ze=+Ue[1]);var ur=ze,Da=ur,Zc=d,so=j.String,oo=!!Object.getOwnPropertySymbols&&!Zc(function(){var e=Symbol();return!so(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Da&&Da<41}),kl=oo&&!Symbol.sham&&typeof Symbol.iterator=="symbol",xs=an,sc=Me,ra=N,oc=Object,el=kl?function(e){return typeof e=="symbol"}:function(e){var n=xs("Symbol");return sc(n)&&ra(n.prototype,oc(e))},Ou=String,ac=function(e){try{return Ou(e)}catch{return"Object"}},tl=Me,wo=ac,Pi=TypeError,as=function(e){if(tl(e))return e;throw Pi(wo(e)+" is not a function")},La=as,ku=Ut,cc=function(e,n){var i=e[n];return ku(i)?void 0:La(i)},ia=ye,sa=Me,Od=_t,Rg=TypeError,Nu={exports:{}},tp=j,Ms=Object.defineProperty,Du=function(e,n){try{Ms(tp,e,{value:n,configurable:!0,writable:!0})}catch{tp[e]=n}return n},oa="__core-js_shared__",kd=j[oa]||Du(oa,{}),Nd=kd;(Nu.exports=function(e,n){return Nd[e]||(Nd[e]=n!==void 0?n:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var xa=Nu.exports,Dd=qt,Lu=Object,Ro=function(e){return Lu(Dd(e))},Ld=Ro,Fr=I({}.hasOwnProperty),hi=Object.hasOwn||function(e,n){return Fr(Ld(e),n)},lc=I,nl=0,aa=Math.random(),np=lc(1 .toString),xd=function(e){return"Symbol("+(e===void 0?"":e)+")_"+np(++nl+aa,36)},Nl=xa,ao=hi,Nf=xd,Hs=oo,rp=kl,rl=j.Symbol,Md=Nl("wks"),Ud=rp?rl.for||rl:rl&&rl.withoutSetter||Nf,dr=function(e){return ao(Md,e)||(Md[e]=Hs&&ao(rl,e)?rl[e]:Ud("Symbol."+e)),Md[e]},Dl=ye,Ll=_t,xu=el,Ma=cc,Co=function(e,n){var i,o;if(sa(i=e.toString)&&!Od(o=ia(i,e))||sa(i=e.valueOf)&&!Od(o=ia(i,e)))return o;throw Rg("Can't convert object to primitive value")},Mu=TypeError,il=dr("toPrimitive"),xl=function(e,n){if(!Ll(e)||xu(e))return e;var i,o=Ma(e,il);if(o){if(i=Dl(o,e,n),!Ll(i)||xu(i))return i;throw Mu("Can't convert object to primitive value")}return Co(e)},zr=el,Ua=function(e){var n=xl(e,"string");return zr(n)?n:n+""},nr=_t,uc=j.document,Df=nr(uc)&&nr(uc.createElement),Ml=function(e){return Df?uc.createElement(e):{}},Vd=Ml,ip=!rt&&!d(function(){return Object.defineProperty(Vd("div"),"a",{get:function(){return 7}}).a!=7}),Lf=rt,sp=ye,Io=Ne,Qi=et,Ao=Re,Po=Ua,Ul=hi,Oo=ip,ko=Object.getOwnPropertyDescriptor;He.f=Lf?ko:function(e,n){if(e=Ao(e),n=Po(n),Oo)try{return ko(e,n)}catch{}if(Ul(e,n))return Qi(!sp(Io.f,e,n),e[n])};var xf=d,dc=Me,cs=/#|\.prototype\./,Uu=function(e,n){var i=sl[op(e)];return i==Mf||i!=Vl&&(dc(n)?xf(n):!!n)},op=Uu.normalize=function(e){return String(e).replace(cs,".").toLowerCase()},sl=Uu.data={},Vl=Uu.NATIVE="N",Mf=Uu.POLYFILL="P",ca=Uu,la=as,ol=f,ve=oe(oe.bind),De=function(e,n){return la(e),n===void 0?e:ol?ve(e,n):function(){return e.apply(n,arguments)}},tt={},Ht=rt&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Hn=_t,gr=String,jr=TypeError,cn=function(e){if(Hn(e))return e;throw jr(gr(e)+" is not an object")},kr=rt,pi=ip,Rs=Ht,No=cn,Do=Ua,Vu=TypeError,zi=Object.defineProperty,al=Object.getOwnPropertyDescriptor,Fd="enumerable",hc="configurable",Cg="writable";tt.f=kr?Rs?function(e,n,i){if(No(e),n=Do(n),No(i),typeof e=="function"&&n==="prototype"&&"value"in i&&Cg in i&&!i[Cg]){var o=al(e,n);o&&o[Cg]&&(e[n]=i.value,i={configurable:hc in i?i[hc]:o[hc],enumerable:Fd in i?i[Fd]:o[Fd],writable:!1})}return zi(e,n,i)}:zi:function(e,n,i){if(No(e),n=Do(n),No(i),pi)try{return zi(e,n,i)}catch{}if("get"in i||"set"in i)throw Vu("Accessors not supported");return"value"in i&&(e[n]=i.value),e};var Uf=tt,Fu=et,Lo=rt?function(e,n,i){return Uf.f(e,n,Fu(1,i))}:function(e,n,i){return e[n]=i,e},Fl=j,Vf=ee,Ig=oe,xE=Me,Ff=He.f,jf=ca,ju=yt,Bu=De,Wu=Lo,Ag=hi,ME=function(e){var n=function(i,o,c){if(this instanceof n){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,o)}return new e(i,o,c)}return Vf(e,this,arguments)};return n.prototype=e.prototype,n},xn=function(e,n){var i,o,c,u,h,m,_,y,S,w=e.target,A=e.global,k=e.stat,W=e.proto,U=A?Fl:k?Fl[w]:(Fl[w]||{}).prototype,V=A?ju:ju[w]||Wu(ju,w,{})[w],q=V.prototype;for(u in n)o=!(i=jf(A?u:w+(k?".":"#")+u,e.forced))&&U&&Ag(U,u),m=V[u],o&&(_=e.dontCallGetSet?(S=Ff(U,u))&&S.value:U[u]),h=o&&_?_:n[u],o&&typeof m==typeof h||(y=e.bind&&o?Bu(h,Fl):e.wrap&&o?ME(h):W&&xE(h)?Ig(h):h,(e.sham||h&&h.sham||m&&m.sham)&&Wu(y,"sham",!0),Wu(V,u,y),W&&(Ag(ju,c=w+"Prototype")||Wu(ju,c,{}),Wu(ju[c],u,h),e.real&&q&&(i||!q[u])&&Wu(q,u,h)))},Bf=Math.ceil,xo=Math.floor,UE=Math.trunc||function(e){var n=+e;return(n>0?xo:Bf)(n)},VE=UE,pc=function(e){var n=+e;return n!=n||n===0?0:VE(n)},C=pc,B=Math.max,J=Math.min,fe=function(e,n){var i=C(e);return i<0?B(i+n,0):J(i,n)},qe=pc,at=Math.min,Lt=function(e){return e>0?at(qe(e),9007199254740991):0},Gr=Lt,ii=function(e){return Gr(e.length)},_r=Re,Us=fe,ls=ii,Va=function(e){return function(n,i,o){var c,u=_r(n),h=ls(u),m=Us(o,h);if(e&&i!=i){for(;h>m;)if((c=u[m++])!=c)return!0}else for(;h>m;m++)if((e||m in u)&&u[m]===i)return e||m||0;return!e&&-1}},Mo={includes:Va(!0),indexOf:Va(!1)},ap=Mo.includes;xn({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(e){return ap(this,e,arguments.length>1?arguments[1]:void 0)}});var Wf=yt,Fa=function(e){return Wf[e+"Prototype"]},ZR=Fa("Array").includes,eC=_t,zf=Z,VN=dr("match"),tC=function(e){var n;return eC(e)&&((n=e[VN])!==void 0?!!n:zf(e)=="RegExp")},FN=tC,nC=TypeError,C0={};C0[dr("toStringTag")]="z";var cp=String(C0)==="[object z]",Pg=cp,jN=Me,lp=Z,BN=dr("toStringTag"),rC=Object,I0=lp(function(){return arguments}())=="Arguments",fc=Pg?lp:function(e){var n,i,o;return e===void 0?"Undefined":e===null?"Null":typeof(i=function(c,u){try{return c[u]}catch{}}(n=rC(e),BN))=="string"?i:I0?lp(n):(o=lp(n))=="Object"&&jN(n.callee)?"Arguments":o},iC=fc,sC=String,ua=function(e){if(iC(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return sC(e)},WN=dr("match"),zN=xn,GN=function(e){if(FN(e))throw nC("The method doesn't accept regular expressions");return e},HN=qt,oC=ua,cl=function(e){var n=/./;try{"/./"[e](n)}catch{try{return n[WN]=!1,"/./"[e](n)}catch{}}return!1},Og=I("".indexOf);zN({target:"String",proto:!0,forced:!cl("includes")},{includes:function(e){return!!~Og(oC(HN(this)),oC(GN(e)),arguments.length>1?arguments[1]:void 0)}});var aC=Fa("String").includes,A0=N,cC=ZR,lC=aC,kg=Array.prototype,P0=String.prototype,$N=function(e){var n=e.includes;return e===kg||A0(kg,e)&&n===kg.includes?cC:typeof e=="string"||e===P0||A0(P0,e)&&n===P0.includes?lC:n},ot=l($N),O0=as,Ng=Ro,k0=dn,uC=ii,FE=TypeError,Gf=function(e){return function(n,i,o,c){O0(i);var u=Ng(n),h=k0(u),m=uC(u),_=e?m-1:0,y=e?-1:1;if(o<2)for(;;){if(_ in h){c=h[_],_+=y;break}if(_+=y,e?_<0:m<=_)throw FE("Reduce of empty array with no initial value")}for(;e?_>=0:m>_;_+=y)_ in h&&(c=i(c,h[_],_,u));return c}},N0={left:Gf(!1)},dC=d,up=function(e,n){var i=[][e];return!!i&&dC(function(){i.call(null,n||function(){return 1},1)})},dp=typeof process<"u"&&Z(process)=="process",hC=N0.left;xn({target:"Array",proto:!0,forced:!dp&&ur>79&&ur<83||!up("reduce")},{reduce:function(e){var n=arguments.length;return hC(this,e,n,n>1?arguments[1]:void 0)}});var pC=Fa("Array").reduce,fC=N,mC=pC,jE=Array.prototype,jd=function(e){var n=e.reduce;return e===jE||fC(jE,e)&&n===jE.reduce?mC:n},BE=jd,ja=l(BE),KN=Z,Dg=Array.isArray||function(e){return KN(e)=="Array"},Lg=xn,qN=Dg,gC=I([].reverse),D0=[1,2];Lg({target:"Array",proto:!0,forced:String(D0)===String(D0.reverse())},{reverse:function(){return qN(this)&&(this.length=this.length),gC(this)}});var vi=Fa("Array").reverse,L0=N,WE=vi,hp=Array.prototype,_C=function(e){var n=e.reverse;return e===hp||L0(hp,e)&&n===hp.reverse?WE:n},zE=_C,Hf=l(zE),GE=xd,pp=xa("keys"),xg=function(e){return pp[e]||(pp[e]=GE(e))},YN=!d(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),XN=hi,EC=Me,HE=Ro,$E=YN,KE=xg("IE_PROTO"),Mg=Object,x0=Mg.prototype,Ug=$E?Mg.getPrototypeOf:function(e){var n=HE(e);if(XN(n,KE))return n[KE];var i=n.constructor;return EC(i)&&n instanceof i?i.prototype:n instanceof Mg?x0:null},JN=I,yC=as,QN=Me,ZN=String,M0=TypeError,Bd=function(e,n,i){try{return JN(yC(Object.getOwnPropertyDescriptor(e,n)[i]))}catch{}},vC=cn,$f=function(e){if(typeof e=="object"||QN(e))return e;throw M0("Can't set "+ZN(e)+" as a prototype")},jl=Object.setPrototypeOf||("__proto__"in{}?function(){var e,n=!1,i={};try{(e=Bd(Object.prototype,"__proto__","set"))(i,[]),n=i instanceof Array}catch{}return function(o,c){return vC(o),$f(c),n?e(o,c):o.__proto__=c,o}}():void 0),Wd={},mc={},Vg=hi,e1=Re,t1=Mo.indexOf,fp=mc,Kf=I([].push),mp=function(e,n){var i,o=e1(e),c=0,u=[];for(i in o)!Vg(fp,i)&&Vg(o,i)&&Kf(u,i);for(;n.length>c;)Vg(o,i=n[c++])&&(~t1(u,i)||Kf(u,i));return u},qf=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],U0=mp,Yf=qf.concat("length","prototype");Wd.f=Object.getOwnPropertyNames||function(e){return U0(e,Yf)};var gc={};gc.f=Object.getOwnPropertySymbols;var Si=an,fi=Wd,zd=gc,co=cn,da=I([].concat),gp=Si("Reflect","ownKeys")||function(e){var n=fi.f(co(e)),i=zd.f;return i?da(n,i(e)):n},_p=hi,ha=gp,qE=He,SC=tt,YE={},XE=mp,TC=qf,_c=Object.keys||function(e){return XE(e,TC)},JE=rt,V0=Ht,bC=tt,n1=cn,Gd=Re,Xf=_c;YE.f=JE&&!V0?Object.defineProperties:function(e,n){n1(e);for(var i,o=Gd(n),c=Xf(n),u=c.length,h=0;u>h;)bC.f(e,i=c[h++],o[i]);return e};var zu,Fg=an("document","documentElement"),QE=cn,Ec=YE,Ba=qf,Ep=mc,Gu=Fg,Hu=Ml,$u="prototype",ZE="script",ey=xg("IE_PROTO"),jg=function(){},pa=function(e){return"<"+ZE+">"+e+"</"+ZE+">"},fa=function(e){e.write(pa("")),e.close();var n=e.parentWindow.Object;return e=null,n},si=function(){try{zu=new ActiveXObject("htmlfile")}catch{}var e,n,i;si=typeof document<"u"?document.domain&&zu?fa(zu):(n=Hu("iframe"),i="java"+ZE+":",n.style.display="none",Gu.appendChild(n),n.src=String(i),(e=n.contentWindow.document).open(),e.write(pa("document.F=Object")),e.close(),e.F):fa(zu);for(var o=Ba.length;o--;)delete si[$u][Ba[o]];return si()};Ep[ey]=!0;var Uo=Object.create||function(e,n){var i;return e!==null?(jg[$u]=QE(e),i=new jg,jg[$u]=null,i[ey]=e):i=si(),n===void 0?i:Ec.f(i,n)},wC=_t,RC=Lo,ty=Error,F0=I("".replace),CC=String(ty("zxcasd").stack),Bg=/\n\s*at [^:]*:[^\n]*/,IC=Bg.test(CC),Jf=et,j0=!d(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Jf(1,7)),e.stack!==7)}),r1=Lo,Wg=function(e,n){if(IC&&typeof e=="string"&&!ty.prepareStackTrace)for(;n--;)e=F0(e,Bg,"");return e},ny=j0,B0=Error.captureStackTrace,Hd={},Qf=Hd,AC=dr("iterator"),ry=Array.prototype,zg=function(e){return e!==void 0&&(Qf.Array===e||ry[AC]===e)},Zf=fc,iy=cc,W0=Ut,z0=Hd,G0=dr("iterator"),Ku=function(e){if(!W0(e))return iy(e,G0)||iy(e,"@@iterator")||z0[Zf(e)]},yc=ye,yp=as,H0=cn,PC=ac,qu=Ku,$d=TypeError,Gg=function(e,n){var i=arguments.length<2?qu(e):n;if(yp(i))return H0(yc(i,e));throw $d(PC(e)+" is not iterable")},OC=ye,Bl=cn,Kd=cc,Hg=function(e,n,i){var o,c;Bl(e);try{if(!(o=Kd(e,"return"))){if(n==="throw")throw i;return i}o=OC(o,e)}catch(u){c=!0,o=u}if(n==="throw")throw i;if(c)throw o;return Bl(o),i},kC=De,sy=ye,NC=cn,$g=ac,Wl=zg,Kg=ii,em=N,vp=Gg,$0=Ku,Sp=Hg,DC=TypeError,tm=function(e,n){this.stopped=e,this.result=n},Ri=tm.prototype,qd=function(e,n,i){var o,c,u,h,m,_,y,S=i&&i.that,w=!(!i||!i.AS_ENTRIES),A=!(!i||!i.IS_RECORD),k=!(!i||!i.IS_ITERATOR),W=!(!i||!i.INTERRUPTED),U=kC(n,S),V=function(Y){return o&&Sp(o,"normal",Y),new tm(!0,Y)},q=function(Y){return w?(NC(Y),W?U(Y[0],Y[1],V):U(Y[0],Y[1])):W?U(Y,V):U(Y)};if(A)o=e.iterator;else if(k)o=e;else{if(!(c=$0(e)))throw DC($g(e)+" is not iterable");if(Wl(c)){for(u=0,h=Kg(e);h>u;u++)if((m=q(e[u]))&&em(Ri,m))return m;return new tm(!1)}o=vp(e,c)}for(_=A?e.next:o.next;!(y=sy(_,o)).done;){try{m=q(y.value)}catch(Y){Sp(o,"throw",Y)}if(typeof m=="object"&&m&&em(Ri,m))return m}return new tm(!1)},K0=ua,q0=xn,oy=N,Y0=Ug,zl=jl,Oi=function(e,n,i){for(var o=ha(n),c=SC.f,u=qE.f,h=0;h<o.length;h++){var m=o[h];_p(e,m)||i&&_p(i,m)||c(e,m,u(n,m))}},us=Uo,ds=Lo,nm=et,qg=function(e,n){wC(n)&&"cause"in n&&RC(e,"cause",n.cause)},Yg=function(e,n,i,o){ny&&(B0?B0(e,n):r1(e,"stack",Wg(i,o)))},i1=qd,lo=function(e,n){return e===void 0?arguments.length<2?"":n:K0(e)},X0=dr("toStringTag"),rm=Error,J0=[].push,Vo=function(e,n){var i,o=oy(ma,this);zl?i=zl(rm(),o?Y0(this):ma):(i=o?this:us(ma),ds(i,X0,"Error")),n!==void 0&&ds(i,"message",lo(n)),Yg(i,Vo,i.stack,1),arguments.length>2&&qg(i,arguments[2]);var c=[];return i1(e,J0,{that:c}),ds(i,"errors",c),i};zl?zl(Vo,rm):Oi(Vo,rm,{name:!0});var ma=Vo.prototype=us(rm.prototype,{constructor:nm(1,Vo),message:nm(1,""),name:nm(1,"AggregateError")});q0({global:!0},{AggregateError:Vo});var Yd,Tp,im,LC=Me,Q0=j.WeakMap,xC=LC(Q0)&&/native code/.test(String(Q0)),Z0=j,MC=_t,UC=Lo,ay=hi,cy=kd,Xg=xg,VC=mc,Jg="Object already initialized",sm=Z0.TypeError,FC=Z0.WeakMap;if(xC||cy.state){var vc=cy.state||(cy.state=new FC);vc.get=vc.get,vc.has=vc.has,vc.set=vc.set,Yd=function(e,n){if(vc.has(e))throw sm(Jg);return n.facade=e,vc.set(e,n),n},Tp=function(e){return vc.get(e)||{}},im=function(e){return vc.has(e)}}else{var bp=Xg("state");VC[bp]=!0,Yd=function(e,n){if(ay(e,bp))throw sm(Jg);return n.facade=e,UC(e,bp,n),n},Tp=function(e){return ay(e,bp)?e[bp]:{}},im=function(e){return ay(e,bp)}}var Xd,eT,tT,Yu={set:Yd,get:Tp,has:im,enforce:function(e){return im(e)?Tp(e):Yd(e,{})},getterFor:function(e){return function(n){var i;if(!MC(n)||(i=Tp(n)).type!==e)throw sm("Incompatible receiver, "+e+" required");return i}}},ly=rt,jC=hi,nT=Function.prototype,s1=ly&&Object.getOwnPropertyDescriptor,rT=jC(nT,"name"),BC={PROPER:rT&&(function(){}).name==="something",CONFIGURABLE:rT&&(!ly||ly&&s1(nT,"name").configurable)},o1=Lo,Xu=function(e,n,i,o){return o&&o.enumerable?e[n]=i:o1(e,n,i),e},WC=d,zC=Me,uy=_t,a1=Uo,GC=Ug,c1=Xu,Wa=dr("iterator"),dy=!1;[].keys&&("next"in(tT=[].keys())?(eT=GC(GC(tT)))!==Object.prototype&&(Xd=eT):dy=!0);var hy=!uy(Xd)||WC(function(){var e={};return Xd[Wa].call(e)!==e});zC((Xd=hy?{}:a1(Xd))[Wa])||c1(Xd,Wa,function(){return this});var iT={IteratorPrototype:Xd,BUGGY_SAFARI_ITERATORS:dy},HC=fc,$C=cp?{}.toString:function(){return"[object "+HC(this)+"]"},sT=cp,om=tt.f,oT=Lo,aT=hi,l1=$C,cT=dr("toStringTag"),Ju=function(e,n,i,o){if(e){var c=i?e:e.prototype;aT(c,cT)||om(c,cT,{configurable:!0,value:n}),o&&!sT&&oT(c,"toString",l1)}},KC=iT.IteratorPrototype,qC=Uo,YC=et,u1=Ju,ga=Hd,Fo=function(){return this},py=function(e,n,i,o){var c=n+" Iterator";return e.prototype=qC(KC,{next:YC(+!o,i)}),u1(e,c,!1,!0),ga[c]=Fo,e},XC=xn,JC=ye,QC=BC,ZC=py,lT=Ug,eI=Ju,fy=Xu,uT=Hd,tI=iT,dT=QC.PROPER,am=tI.BUGGY_SAFARI_ITERATORS,my=dr("iterator"),gy="keys",wp="values",nI="entries",rI=function(){return this},_y=function(e,n,i,o,c,u,h){ZC(i,n,o);var m,_,y,S=function(q){if(q===c&&U)return U;if(!am&&q in k)return k[q];switch(q){case gy:case wp:case nI:return function(){return new i(this,q)}}return function(){return new i(this)}},w=n+" Iterator",A=!1,k=e.prototype,W=k[my]||k["@@iterator"]||c&&k[c],U=!am&&W||S(c),V=n=="Array"&&k.entries||W;if(V&&(m=lT(V.call(new e)))!==Object.prototype&&m.next&&(eI(m,w,!0,!0),uT[w]=rI),dT&&c==wp&&W&&W.name!==wp&&(A=!0,U=function(){return JC(W,this)}),c)if(_={values:S(wp),keys:u?U:S(gy),entries:S(nI)},h)for(y in _)(am||A||!(y in k))&&fy(k,y,_[y]);else XC({target:n,proto:!0,forced:am||A},_);return h&&k[my]!==U&&fy(k,my,U,{}),uT[n]=U,_},Ey=function(e,n){return{value:e,done:n}},yy=Re,Gl=Hd,iI=Yu;tt.f;var sI=_y,vy=Ey,hT="Array Iterator",oI=iI.set,Qg=iI.getterFor(hT);sI(Array,"Array",function(e,n){oI(this,{type:hT,target:yy(e),index:0,kind:n})},function(){var e=Qg(this),n=e.target,i=e.kind,o=e.index++;return!n||o>=n.length?(e.target=void 0,vy(void 0,!0)):vy(i=="keys"?o:i=="values"?n[o]:[o,n[o]],!1)},"values"),Gl.Arguments=Gl.Array;var uo=tt,Sy=function(e,n,i){return uo.f(e,n,i)},d1=an,Ty=Sy,ho=rt,aI=dr("species"),Xt=N,cm=TypeError,Zg=function(e,n){if(Xt(n,e))return e;throw cm("Incorrect invocation")},cI=Me,pT=kd,e_=I(Function.toString);cI(pT.inspectSource)||(pT.inspectSource=function(e){return e_(e)});var t_=pT.inspectSource,fT=I,lI=d,mT=Me,uI=fc,gT=t_,by=function(){},$s=[],Sc=an("Reflect","construct"),Hl=/^\s*(?:class|function)\b/,dI=fT(Hl.exec),hI=!Hl.exec(by),jo=function(e){if(!mT(e))return!1;try{return Sc(by,$s,e),!0}catch{return!1}},_T=function(e){if(!mT(e))return!1;switch(uI(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return hI||!!dI(Hl,gT(e))}catch{return!0}};_T.sham=!0;var _a,lm,ET,wy,n_=!Sc||lI(function(){var e;return jo(jo.call)||!jo(Object)||!jo(function(){e=!0})||e})?_T:jo,pI=n_,h1=ac,Ry=TypeError,Cy=cn,Tc=function(e){if(pI(e))return e;throw Ry(h1(e)+" is not a constructor")},Tr=Ut,Vs=dr("species"),Gi=function(e,n){var i,o=Cy(e).constructor;return o===void 0||Tr(i=Cy(o)[Vs])?n:Tc(i)},hs=I([].slice),za=TypeError,ll=function(e,n){if(e<n)throw za("Not enough arguments");return e},ps=/(?:ipad|iphone|ipod).*applewebkit/i.test(ir),Ks=j,Rp=ee,Iy=De,Ay=Me,r_=hi,Bo=d,Py=Fg,um=hs,$l=Ml,Oy=ll,yT=ps,Jd=dp,dm=Ks.setImmediate,Kl=Ks.clearImmediate,ky=Ks.process,Cp=Ks.Dispatch,vT=Ks.Function,i_=Ks.MessageChannel,Ny=Ks.String,qs=0,bc={},wc="onreadystatechange";Bo(function(){_a=Ks.location});var po=function(e){if(r_(bc,e)){var n=bc[e];delete bc[e],n()}},Dy=function(e){return function(){po(e)}},Ly=function(e){po(e.data)},xy=function(e){Ks.postMessage(Ny(e),_a.protocol+"//"+_a.host)};dm&&Kl||(dm=function(e){Oy(arguments.length,1);var n=Ay(e)?e:vT(e),i=um(arguments,1);return bc[++qs]=function(){Rp(n,void 0,i)},lm(qs),qs},Kl=function(e){delete bc[e]},Jd?lm=function(e){ky.nextTick(Dy(e))}:Cp&&Cp.now?lm=function(e){Cp.now(Dy(e))}:i_&&!yT?(wy=(ET=new i_).port2,ET.port1.onmessage=Ly,lm=Iy(wy.postMessage,wy)):Ks.addEventListener&&Ay(Ks.postMessage)&&!Ks.importScripts&&_a&&_a.protocol!=="file:"&&!Bo(xy)?(lm=xy,Ks.addEventListener("message",Ly,!1)):lm=wc in $l("script")?function(e){Py.appendChild($l("script"))[wc]=function(){Py.removeChild(this),po(e)}}:function(e){setTimeout(Dy(e),0)});var My={set:dm,clear:Kl},Qu=function(){this.head=null,this.tail=null};Qu.prototype={add:function(e){var n={item:e,next:null},i=this.tail;i?i.next=n:this.head=n,this.tail=n},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Ip,s_,Zu,o_,Qd,ST=Qu,fI=/ipad|iphone|ipod/i.test(ir)&&typeof Pebble<"u",TT=/web0s(?!.*chrome)/i.test(ir),ql=j,mI=De,p1=He.f,Uy=My.set,gI=ST,Ap=ps,f1=fI,hm=TT,Vy=dp,ki=ql.MutationObserver||ql.WebKitMutationObserver,_I=ql.document,bT=ql.process,Fy=ql.Promise,EI=p1(ql,"queueMicrotask"),jy=EI&&EI.value;if(!jy){var a_=new gI,By=function(){var e,n;for(Vy&&(e=bT.domain)&&e.exit();n=a_.get();)try{n()}catch(i){throw a_.head&&Ip(),i}e&&e.enter()};Ap||Vy||hm||!ki||!_I?!f1&&Fy&&Fy.resolve?((o_=Fy.resolve(void 0)).constructor=Fy,Qd=mI(o_.then,o_),Ip=function(){Qd(By)}):Vy?Ip=function(){bT.nextTick(By)}:(Uy=mI(Uy,ql),Ip=function(){Uy(By)}):(s_=!0,Zu=_I.createTextNode(""),new ki(By).observe(Zu,{characterData:!0}),Ip=function(){Zu.data=s_=!s_}),jy=function(e){a_.head||Ip(),a_.add(e)}}var Ga=jy,Zd=function(e){try{return{error:!1,value:e()}}catch(n){return{error:!0,value:n}}},Pp=j.Promise,ed=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Wy=!ed&&!dp&&typeof window=="object"&&typeof document=="object",Op=j,eh=Pp,wT=Me,RT=ca,m1=t_,CT=dr,g1=Wy,yI=ed,zy=ur,c_=eh&&eh.prototype,Gy=CT("species"),IT=wT(Op.PromiseRejectionEvent),AT=RT("Promise",function(){var e=m1(eh),n=e!==String(eh);if(!n&&zy===66||!c_.catch||!c_.finally)return!0;if(!zy||zy<51||!/native code/.test(e)){var i=new eh(function(c){c(1)}),o=function(c){c(function(){},function(){})};if((i.constructor={})[Gy]=o,!(i.then(function(){})instanceof o))return!0}return!n&&(g1||yI)&&!IT}),l_={CONSTRUCTOR:AT,REJECTION_EVENT:IT},ul={},Hy=as,$y=TypeError,PT=function(e){var n,i;this.promise=new e(function(o,c){if(n!==void 0||i!==void 0)throw $y("Bad Promise constructor");n=o,i=c}),this.resolve=Hy(n),this.reject=Hy(i)};ul.f=function(e){return new PT(e)};var pm,OT,_1=xn,kp=dp,th=j,td=ye,E1=Xu,Ky=Ju,p=function(e){var n=d1(e);ho&&n&&!n[aI]&&Ty(n,aI,{configurable:!0,get:function(){return this}})},g=as,b=Me,O=_t,M=Zg,z=Gi,ae=My.set,Ie=Ga,xe=function(e,n){try{arguments.length==1?console.error(e):console.error(e,n)}catch{}},it=Zd,It=ST,At=Yu,Rt=Pp,zt=l_,Zt=ul,en="Promise",Hi=zt.CONSTRUCTOR,Je=zt.REJECTION_EVENT,Ve=At.getterFor(en),Ze=At.set,Nt=Rt&&Rt.prototype,tn=Rt,pn=Nt,En=th.TypeError,On=th.document,fs=th.process,Er=Zt.f,nh=Er,y1=!!(On&&On.createEvent&&th.dispatchEvent),s4="unhandledrejection",o4=function(e){var n;return!(!O(e)||!b(n=e.then))&&n},a4=function(e,n){var i,o,c,u=n.value,h=n.state==1,m=h?e.ok:e.fail,_=e.resolve,y=e.reject,S=e.domain;try{m?(h||(n.rejection===2&&gse(n),n.rejection=1),m===!0?i=u:(S&&S.enter(),i=m(u),S&&(S.exit(),c=!0)),i===e.promise?y(En("Promise-chain cycle")):(o=o4(i))?td(o,i,_,y):_(i)):y(u)}catch(w){S&&!c&&S.exit(),y(w)}},c4=function(e,n){e.notified||(e.notified=!0,Ie(function(){for(var i,o=e.reactions;i=o.get();)a4(i,e);e.notified=!1,n&&!e.rejection&&mse(e)}))},l4=function(e,n,i){var o,c;y1?((o=On.createEvent("Event")).promise=n,o.reason=i,o.initEvent(e,!1,!0),th.dispatchEvent(o)):o={promise:n,reason:i},!Je&&(c=th["on"+e])?c(o):e===s4&&xe("Unhandled promise rejection",i)},mse=function(e){td(ae,th,function(){var n,i=e.facade,o=e.value;if(u4(e)&&(n=it(function(){kp?fs.emit("unhandledRejection",o,i):l4(s4,i,o)}),e.rejection=kp||u4(e)?2:1,n.error))throw n.value})},u4=function(e){return e.rejection!==1&&!e.parent},gse=function(e){td(ae,th,function(){var n=e.facade;kp?fs.emit("rejectionHandled",n):l4("rejectionhandled",n,e.value)})},qy=function(e,n,i){return function(o){e(n,o,i)}},Yy=function(e,n,i){e.done||(e.done=!0,i&&(e=i),e.value=n,e.state=2,c4(e,!0))},v1=function(e,n,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===n)throw En("Promise can't be resolved itself");var o=o4(n);o?Ie(function(){var c={done:!1};try{td(o,n,qy(v1,c,e),qy(Yy,c,e))}catch(u){Yy(c,u,e)}}):(e.value=n,e.state=1,c4(e,!1))}catch(c){Yy({done:!1},c,e)}}};Hi&&(pn=(tn=function(e){M(this,pn),g(e),td(pm,this);var n=Ve(this);try{e(qy(v1,n),qy(Yy,n))}catch(i){Yy(n,i)}}).prototype,(pm=function(e){Ze(this,{type:en,done:!1,notified:!1,parent:!1,reactions:new It,rejection:!1,state:0,value:void 0})}).prototype=E1(pn,"then",function(e,n){var i=Ve(this),o=Er(z(this,tn));return i.parent=!0,o.ok=!b(e)||e,o.fail=b(n)&&n,o.domain=kp?fs.domain:void 0,i.state==0?i.reactions.add(o):Ie(function(){a4(o,i)}),o.promise}),OT=function(){var e=new pm,n=Ve(e);this.promise=e,this.resolve=qy(v1,n),this.reject=qy(Yy,n)},Zt.f=Er=function(e){return e===tn||e===void 0?new OT(e):nh(e)}),_1({global:!0,wrap:!0,forced:Hi},{Promise:tn}),Ky(tn,en,!1,!0),p(en);var d4=dr("iterator"),h4=!1;try{var _se=0,p4={next:function(){return{done:!!_se++}},return:function(){h4=!0}};p4[d4]=function(){return this},Array.from(p4,function(){throw 2})}catch{}var Ese=Pp,yse=function(e,n){if(!h4)return!1;var i=!1;try{var o={};o[d4]=function(){return{next:function(){return{done:i=!0}}}},e(o)}catch{}return i},vI=l_.CONSTRUCTOR||!yse(function(e){Ese.all(e).then(void 0,function(){})}),vse=ye,Sse=as,Tse=ul,bse=Zd,wse=qd;xn({target:"Promise",stat:!0,forced:vI},{all:function(e){var n=this,i=Tse.f(n),o=i.resolve,c=i.reject,u=bse(function(){var h=Sse(n.resolve),m=[],_=0,y=1;wse(e,function(S){var w=_++,A=!1;y++,vse(h,n,S).then(function(k){A||(A=!0,m[w]=k,--y||o(m))},c)}),--y||o(m)});return u.error&&c(u.value),i.promise}});var Rse=xn,Cse=l_.CONSTRUCTOR;Pp&&Pp.prototype,Rse({target:"Promise",proto:!0,forced:Cse,real:!0},{catch:function(e){return this.then(void 0,e)}});var Ise=ye,Ase=as,Pse=ul,Ose=Zd,kse=qd;xn({target:"Promise",stat:!0,forced:vI},{race:function(e){var n=this,i=Pse.f(n),o=i.reject,c=Ose(function(){var u=Ase(n.resolve);kse(e,function(h){Ise(u,n,h).then(i.resolve,o)})});return c.error&&o(c.value),i.promise}});var Nse=ye,Dse=ul;xn({target:"Promise",stat:!0,forced:l_.CONSTRUCTOR},{reject:function(e){var n=Dse.f(this);return Nse(n.reject,void 0,e),n.promise}});var Lse=cn,xse=_t,Mse=ul,f4=function(e,n){if(Lse(e),xse(n)&&n.constructor===e)return n;var i=Mse.f(e);return(0,i.resolve)(n),i.promise},Use=xn,Vse=Pp,Fse=l_.CONSTRUCTOR,jse=f4,Bse=an("Promise"),Wse=!Fse;Use({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return jse(Wse&&this===Bse?Vse:this,e)}});var zse=ye,Gse=as,Hse=ul,$se=Zd,Kse=qd;xn({target:"Promise",stat:!0,forced:vI},{allSettled:function(e){var n=this,i=Hse.f(n),o=i.resolve,c=i.reject,u=$se(function(){var h=Gse(n.resolve),m=[],_=0,y=1;Kse(e,function(S){var w=_++,A=!1;y++,zse(h,n,S).then(function(k){A||(A=!0,m[w]={status:"fulfilled",value:k},--y||o(m))},function(k){A||(A=!0,m[w]={status:"rejected",reason:k},--y||o(m))})}),--y||o(m)});return u.error&&c(u.value),i.promise}});var qse=ye,Yse=as,Xse=an,Jse=ul,Qse=Zd,Zse=qd,m4="No one promise resolved";xn({target:"Promise",stat:!0,forced:vI},{any:function(e){var n=this,i=Xse("AggregateError"),o=Jse.f(n),c=o.resolve,u=o.reject,h=Qse(function(){var m=Yse(n.resolve),_=[],y=0,S=1,w=!1;Zse(e,function(A){var k=y++,W=!1;S++,qse(m,n,A).then(function(U){W||w||(w=!0,c(U))},function(U){W||w||(W=!0,_[k]=U,--S||u(new i(_,m4)))})}),--S||u(new i(_,m4))});return h.error&&u(h.value),o.promise}});var eoe=xn,S1=Pp,toe=d,noe=an,roe=Me,ioe=Gi,g4=f4,soe=S1&&S1.prototype;eoe({target:"Promise",proto:!0,real:!0,forced:!!S1&&toe(function(){soe.finally.call({then:function(){}},function(){})})},{finally:function(e){var n=ioe(this,noe("Promise")),i=roe(e);return this.then(i?function(o){return g4(n,e()).then(function(){return o})}:e,i?function(o){return g4(n,e()).then(function(){throw o})}:e)}});var T1=I,ooe=pc,aoe=ua,coe=qt,loe=T1("".charAt),_4=T1("".charCodeAt),uoe=T1("".slice),E4=function(e){return function(n,i){var o,c,u=aoe(coe(n)),h=ooe(i),m=u.length;return h<0||h>=m?e?"":void 0:(o=_4(u,h))<55296||o>56319||h+1===m||(c=_4(u,h+1))<56320||c>57343?e?loe(u,h):o:e?uoe(u,h,h+2):c-56320+(o-55296<<10)+65536}},b1={codeAt:E4(!1),charAt:E4(!0)},doe=b1.charAt,hoe=ua,y4=Yu,poe=_y,v4=Ey,S4="String Iterator",foe=y4.set,moe=y4.getterFor(S4);poe(String,"String",function(e){foe(this,{type:S4,string:hoe(e),index:0})},function(){var e,n=moe(this),i=n.string,o=n.index;return o>=i.length?v4(void 0,!0):(e=doe(i,o),n.index+=e.length,v4(e,!1))});var goe=yt.Promise,_oe={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Eoe=j,yoe=fc,voe=Lo,T4=Hd,b4=dr("toStringTag");for(var w1 in _oe){var w4=Eoe[w1],R1=w4&&w4.prototype;R1&&yoe(R1)!==b4&&voe(R1,b4,w1),T4[w1]=T4.Array}var R4=goe,lt=l(R4),Soe=Fa("Array").values,Toe=fc,boe=hi,woe=N,Roe=Soe,C1=Array.prototype,Coe={DOMTokenList:!0,NodeList:!0},Ioe=function(e){var n=e.values;return e===C1||woe(C1,e)&&n===C1.values||boe(Coe,Toe(e))?Roe:n},Rc=l(Ioe),Aoe=d,Poe=dr("iterator"),I1=!Aoe(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),n=e.searchParams,i=new URLSearchParams("a=1&a=2"),o="";return e.pathname="c%20d",n.forEach(function(c,u){n.delete("b"),o+=u+c}),i.delete("a",2),!e.toJSON||!i.has("a",1)||i.has("a",2)||!n.size&&!0||!n.sort||e.href!=="http://a/c%20d?a=1&c=3"||n.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!n[Poe]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),Ooe=Xu,koe=Ua,Noe=tt,Doe=et,SI=function(e,n,i){var o=koe(n);o in e?Noe.f(e,o,Doe(0,i)):e[o]=i},C4=fe,Loe=ii,xoe=SI,Moe=Array,Uoe=Math.max,A1=function(e,n,i){for(var o=Loe(e),c=C4(n,o),u=C4(i===void 0?o:i,o),h=Moe(Uoe(u-c,0)),m=0;c<u;c++,m++)xoe(h,m,e[c]);return h.length=m,h},I4=A1,Voe=Math.floor,P1=function(e,n){var i=e.length,o=Voe(i/2);return i<8?Foe(e,n):joe(e,P1(I4(e,0,o),n),P1(I4(e,o),n),n)},Foe=function(e,n){for(var i,o,c=e.length,u=1;u<c;){for(o=u,i=e[u];o&&n(e[o-1],i)>0;)e[o]=e[--o];o!==u++&&(e[o]=i)}return e},joe=function(e,n,i,o){for(var c=n.length,u=i.length,h=0,m=0;h<c||m<u;)e[h+m]=h<c&&m<u?o(n[h],i[m])<=0?n[h++]:i[m++]:h<c?n[h++]:i[m++];return e},A4=P1,O1=xn,Xy=j,TI=ye,rh=I,Jy=rt,P4=I1,O4=Xu,Boe=Sy,Woe=function(e,n,i){for(var o in n)i&&i.unsafe&&e[o]?e[o]=n[o]:Ooe(e,o,n[o],i);return e},zoe=Ju,Goe=py,k1=Yu,k4=Zg,N1=Me,Hoe=hi,$oe=De,Koe=fc,qoe=cn,N4=_t,Ha=ua,Yoe=Uo,D4=et,D1=Gg,Xoe=Ku,Qy=ll,Joe=A4,Qoe=dr("iterator"),kT="URLSearchParams",L4=kT+"Iterator",x4=k1.set,Yl=k1.getterFor(kT),Zoe=k1.getterFor(L4),eae=Object.getOwnPropertyDescriptor,L1=function(e){if(!Jy)return Xy[e];var n=eae(Xy,e);return n&&n.value},M4=L1("fetch"),bI=L1("Request"),NT=L1("Headers"),x1=bI&&bI.prototype,U4=NT&&NT.prototype,tae=Xy.RegExp,nae=Xy.TypeError,V4=Xy.decodeURIComponent,rae=Xy.encodeURIComponent,iae=rh("".charAt),F4=rh([].join),u_=rh([].push),M1=rh("".replace),sae=rh([].shift),j4=rh([].splice),B4=rh("".split),oae=rh("".slice),aae=/\+/g,W4=Array(4),cae=function(e){return W4[e-1]||(W4[e-1]=tae("((?:%[\\da-f]{2}){"+e+"})","gi"))},lae=function(e){try{return V4(e)}catch{return e}},z4=function(e){var n=M1(e,aae," "),i=4;try{return V4(n)}catch{for(;i;)n=M1(n,cae(i--),lae);return n}},uae=/[!'()~]|%20/g,dae={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},hae=function(e){return dae[e]},G4=function(e){return M1(rae(e),uae,hae)},U1=Goe(function(e,n){x4(this,{type:L4,iterator:D1(Yl(e).entries),kind:n})},"Iterator",function(){var e=Zoe(this),n=e.kind,i=e.iterator.next(),o=i.value;return i.done||(i.value=n==="keys"?o.key:n==="values"?o.value:[o.key,o.value]),i},!0),H4=function(e){this.entries=[],this.url=null,e!==void 0&&(N4(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?iae(e,0)==="?"?oae(e,1):e:Ha(e)))};H4.prototype={type:kT,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var n,i,o,c,u,h,m,_=Xoe(e);if(_)for(i=(n=D1(e,_)).next;!(o=TI(i,n)).done;){if(u=(c=D1(qoe(o.value))).next,(h=TI(u,c)).done||(m=TI(u,c)).done||!TI(u,c).done)throw nae("Expected sequence with length 2");u_(this.entries,{key:Ha(h.value),value:Ha(m.value)})}else for(var y in e)Hoe(e,y)&&u_(this.entries,{key:y,value:Ha(e[y])})},parseQuery:function(e){if(e)for(var n,i,o=B4(e,"&"),c=0;c<o.length;)(n=o[c++]).length&&(i=B4(n,"="),u_(this.entries,{key:z4(sae(i)),value:z4(F4(i,"="))}))},serialize:function(){for(var e,n=this.entries,i=[],o=0;o<n.length;)e=n[o++],u_(i,G4(e.key)+"="+G4(e.value));return F4(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var wI=function(){k4(this,Zy);var e=x4(this,new H4(arguments.length>0?arguments[0]:void 0));Jy||(this.size=e.entries.length)},Zy=wI.prototype;if(Woe(Zy,{append:function(e,n){var i=Yl(this);Qy(arguments.length,2),u_(i.entries,{key:Ha(e),value:Ha(n)}),Jy||this.length++,i.updateURL()},delete:function(e){for(var n=Yl(this),i=Qy(arguments.length,1),o=n.entries,c=Ha(e),u=i<2?void 0:arguments[1],h=u===void 0?u:Ha(u),m=0;m<o.length;){var _=o[m];if(_.key!==c||h!==void 0&&_.value!==h)m++;else if(j4(o,m,1),h!==void 0)break}Jy||(this.size=o.length),n.updateURL()},get:function(e){var n=Yl(this).entries;Qy(arguments.length,1);for(var i=Ha(e),o=0;o<n.length;o++)if(n[o].key===i)return n[o].value;return null},getAll:function(e){var n=Yl(this).entries;Qy(arguments.length,1);for(var i=Ha(e),o=[],c=0;c<n.length;c++)n[c].key===i&&u_(o,n[c].value);return o},has:function(e){for(var n=Yl(this).entries,i=Qy(arguments.length,1),o=Ha(e),c=i<2?void 0:arguments[1],u=c===void 0?c:Ha(c),h=0;h<n.length;){var m=n[h++];if(m.key===o&&(u===void 0||m.value===u))return!0}return!1},set:function(e,n){var i=Yl(this);Qy(arguments.length,1);for(var o,c=i.entries,u=!1,h=Ha(e),m=Ha(n),_=0;_<c.length;_++)(o=c[_]).key===h&&(u?j4(c,_--,1):(u=!0,o.value=m));u||u_(c,{key:h,value:m}),Jy||(this.size=c.length),i.updateURL()},sort:function(){var e=Yl(this);Joe(e.entries,function(n,i){return n.key>i.key?1:-1}),e.updateURL()},forEach:function(e){for(var n,i=Yl(this).entries,o=$oe(e,arguments.length>1?arguments[1]:void 0),c=0;c<i.length;)o((n=i[c++]).value,n.key,this)},keys:function(){return new U1(this,"keys")},values:function(){return new U1(this,"values")},entries:function(){return new U1(this,"entries")}},{enumerable:!0}),O4(Zy,Qoe,Zy.entries,{}),O4(Zy,"toString",function(){return Yl(this).serialize()},{enumerable:!0}),Jy&&Boe(Zy,"size",{get:function(){return Yl(this).entries.length},configurable:!0,enumerable:!0}),zoe(wI,kT),O1({global:!0,forced:!P4},{URLSearchParams:wI}),!P4&&N1(NT)){var pae=rh(U4.has),fae=rh(U4.set),$4=function(e){if(N4(e)){var n,i=e.body;if(Koe(i)===kT)return n=e.headers?new NT(e.headers):new NT,pae(n,"content-type")||fae(n,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Yoe(e,{body:D4(0,Ha(i)),headers:D4(0,n)})}return e};if(N1(M4)&&O1({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return M4(e,arguments.length>1?$4(arguments[1]):{})}}),N1(bI)){var V1=function(e){return k4(this,x1),new bI(e,arguments.length>1?$4(arguments[1]):{})};x1.constructor=V1,V1.prototype=x1,O1({global:!0,dontCallGetSet:!0,forced:!0},{Request:V1})}}var Xl,mae={URLSearchParams:wI,getState:Yl},gae=yt.URLSearchParams,K4=rt,_ae=I,Eae=ye,yae=d,F1=_c,vae=gc,Sae=Ne,Tae=Ro,bae=dn,ev=Object.assign,q4=Object.defineProperty,wae=_ae([].concat),Rae=!ev||yae(function(){if(K4&&ev({b:1},ev(q4({},"a",{enumerable:!0,get:function(){q4(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},n={},i=Symbol(),o="abcdefghijklmnopqrst";return e[i]=7,o.split("").forEach(function(c){n[c]=c}),ev({},e)[i]!=7||F1(ev({},n)).join("")!=o})?function(e,n){for(var i=Tae(e),o=arguments.length,c=1,u=vae.f,h=Sae.f;o>c;)for(var m,_=bae(arguments[c++]),y=u?wae(F1(_),u(_)):F1(_),S=y.length,w=0;S>w;)m=y[w++],K4&&!Eae(h,_,m)||(i[m]=_[m]);return i}:ev,Cae=cn,Iae=Hg,Aae=De,Pae=ye,Oae=Ro,kae=function(e,n,i,o){try{return o?n(Cae(i)[0],i[1]):n(i)}catch(c){Iae(e,"throw",c)}},Nae=zg,Dae=n_,Lae=ii,Y4=SI,xae=Gg,Mae=Ku,X4=Array,d_=I,j1=2147483647,Uae=/[^\0-\u007E]/,J4=/[.\u3002\uFF0E\uFF61]/g,Q4="Overflow: input needs wider integers to process",Z4=RangeError,Vae=d_(J4.exec),tv=Math.floor,B1=String.fromCharCode,e3=d_("".charCodeAt),t3=d_([].join),fm=d_([].push),Fae=d_("".replace),jae=d_("".split),Bae=d_("".toLowerCase),n3=function(e){return e+22+75*(e<26)},Wae=function(e,n,i){var o=0;for(e=i?tv(e/700):e>>1,e+=tv(e/n);e>455;)e=tv(e/35),o+=36;return tv(o+36*e/(e+38))},zae=function(e){var n=[];e=function(q){for(var Y=[],ce=0,_e=q.length;ce<_e;){var Ee=e3(q,ce++);if(Ee>=55296&&Ee<=56319&&ce<_e){var me=e3(q,ce++);(64512&me)==56320?fm(Y,((1023&Ee)<<10)+(1023&me)+65536):(fm(Y,Ee),ce--)}else fm(Y,Ee)}return Y}(e);var i,o,c=e.length,u=128,h=0,m=72;for(i=0;i<e.length;i++)(o=e[i])<128&&fm(n,B1(o));var _=n.length,y=_;for(_&&fm(n,"-");y<c;){var S=j1;for(i=0;i<e.length;i++)(o=e[i])>=u&&o<S&&(S=o);var w=y+1;if(S-u>tv((j1-h)/w))throw Z4(Q4);for(h+=(S-u)*w,u=S,i=0;i<e.length;i++){if((o=e[i])<u&&++h>j1)throw Z4(Q4);if(o==u){for(var A=h,k=36;;){var W=k<=m?1:k>=m+26?26:k-m;if(A<W)break;var U=A-W,V=36-W;fm(n,B1(n3(W+U%V))),A=tv(U/V),k+=36}fm(n,B1(n3(A))),m=Wae(h,w,y==_),h=0,y++}}h++,u++}return t3(n,"")},Gae=xn,W1=rt,Hae=I1,z1=j,r3=De,Jl=I,RI=Xu,Ql=Sy,$ae=Zg,G1=hi,H1=Rae,nv=function(e){var n=Oae(e),i=Dae(this),o=arguments.length,c=o>1?arguments[1]:void 0,u=c!==void 0;u&&(c=Aae(c,o>2?arguments[2]:void 0));var h,m,_,y,S,w,A=Mae(n),k=0;if(!A||this===X4&&Nae(A))for(h=Lae(n),m=i?new this(h):X4(h);h>k;k++)w=u?c(n[k],k):n[k],Y4(m,k,w);else for(S=(y=xae(n,A)).next,m=i?new this:[];!(_=Pae(S,y)).done;k++)w=u?kae(y,c,[_.value,k],!0):_.value,Y4(m,k,w);return m.length=k,m},nd=A1,Kae=b1.codeAt,qae=function(e){var n,i,o=[],c=jae(Fae(Bae(e),J4,"."),".");for(n=0;n<c.length;n++)i=c[n],fm(o,Vae(Uae,i)?"xn--"+zae(i):i);return t3(o,".")},Np=ua,Yae=Ju,Xae=ll,i3=mae,s3=Yu,Jae=s3.set,CI=s3.getterFor("URL"),Qae=i3.URLSearchParams,Zae=i3.getState,DT=z1.URL,$1=z1.TypeError,II=z1.parseInt,ece=Math.floor,o3=Math.pow,Zl=Jl("".charAt),rd=Jl(/./.exec),LT=Jl([].join),tce=Jl(1 .toString),nce=Jl([].pop),rv=Jl([].push),K1=Jl("".replace),rce=Jl([].shift),ice=Jl("".split),xT=Jl("".slice),AI=Jl("".toLowerCase),sce=Jl([].unshift),q1="Invalid scheme",h_="Invalid host",a3="Invalid port",c3=/[a-z]/i,oce=/[\d+-.a-z]/i,Y1=/\d/,ace=/^0x/i,cce=/^[0-7]+$/,lce=/^\d+$/,l3=/^[\da-f]+$/i,uce=/[\0\t\n\r #%/:<>?@[\\\]^|]/,dce=/[\0\t\n\r #/:<>?@[\\\]^|]/,hce=/^[\u0000-\u0020]+/,pce=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,fce=/[\t\n\r]/g,MT=function(e){var n,i,o,c;if(typeof e=="number"){for(n=[],i=0;i<4;i++)sce(n,e%256),e=ece(e/256);return LT(n,".")}if(typeof e=="object"){for(n="",o=function(u){for(var h=null,m=1,_=null,y=0,S=0;S<8;S++)u[S]!==0?(y>m&&(h=_,m=y),_=null,y=0):(_===null&&(_=S),++y);return y>m&&(h=_,m=y),h}(e),i=0;i<8;i++)c&&e[i]===0||(c&&(c=!1),o===i?(n+=i?":":"::",c=!0):(n+=tce(e[i],16),i<7&&(n+=":")));return"["+n+"]"}return e},PI={},u3=H1({},PI,{" ":1,'"':1,"<":1,">":1,"`":1}),d3=H1({},u3,{"#":1,"?":1,"{":1,"}":1}),X1=H1({},d3,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),mm=function(e,n){var i=Kae(e,0);return i>32&&i<127&&!G1(n,e)?e:encodeURIComponent(e)},OI={ftp:21,file:null,http:80,https:443,ws:80,wss:443},UT=function(e,n){var i;return e.length==2&&rd(c3,Zl(e,0))&&((i=Zl(e,1))==":"||!n&&i=="|")},h3=function(e){var n;return e.length>1&&UT(xT(e,0,2))&&(e.length==2||(n=Zl(e,2))==="/"||n==="\\"||n==="?"||n==="#")},mce=function(e){return e==="."||AI(e)==="%2e"},J1={},p3={},Q1={},f3={},m3={},Z1={},g3={},_3={},kI={},NI={},eD={},tD={},nD={},rD={},E3={},iD={},iv={},ih={},y3={},p_={},Dp={},sD=function(e,n,i){var o,c,u,h=Np(e);if(n){if(c=this.parse(h))throw $1(c);this.searchParams=null}else{if(i!==void 0&&(o=new sD(i,!0)),c=this.parse(h,null,o))throw $1(c);(u=Zae(new Qae)).bindURL(this),this.searchParams=u}};sD.prototype={type:"URL",parse:function(e,n,i){var o,c,u,h,m,_=this,y=n||J1,S=0,w="",A=!1,k=!1,W=!1;for(e=Np(e),n||(_.scheme="",_.username="",_.password="",_.host=null,_.port=null,_.path=[],_.query=null,_.fragment=null,_.cannotBeABaseURL=!1,e=K1(e,hce,""),e=K1(e,pce,"$1")),e=K1(e,fce,""),o=nv(e);S<=o.length;){switch(c=o[S],y){case J1:if(!c||!rd(c3,c)){if(n)return q1;y=Q1;continue}w+=AI(c),y=p3;break;case p3:if(c&&(rd(oce,c)||c=="+"||c=="-"||c=="."))w+=AI(c);else{if(c!=":"){if(n)return q1;w="",y=Q1,S=0;continue}if(n&&(_.isSpecial()!=G1(OI,w)||w=="file"&&(_.includesCredentials()||_.port!==null)||_.scheme=="file"&&!_.host))return;if(_.scheme=w,n)return void(_.isSpecial()&&OI[_.scheme]==_.port&&(_.port=null));w="",_.scheme=="file"?y=rD:_.isSpecial()&&i&&i.scheme==_.scheme?y=f3:_.isSpecial()?y=_3:o[S+1]=="/"?(y=m3,S++):(_.cannotBeABaseURL=!0,rv(_.path,""),y=y3)}break;case Q1:if(!i||i.cannotBeABaseURL&&c!="#")return q1;if(i.cannotBeABaseURL&&c=="#"){_.scheme=i.scheme,_.path=nd(i.path),_.query=i.query,_.fragment="",_.cannotBeABaseURL=!0,y=Dp;break}y=i.scheme=="file"?rD:Z1;continue;case f3:if(c!="/"||o[S+1]!="/"){y=Z1;continue}y=kI,S++;break;case m3:if(c=="/"){y=NI;break}y=ih;continue;case Z1:if(_.scheme=i.scheme,c==Xl)_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=nd(i.path),_.query=i.query;else if(c=="/"||c=="\\"&&_.isSpecial())y=g3;else if(c=="?")_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=nd(i.path),_.query="",y=p_;else{if(c!="#"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=nd(i.path),_.path.length--,y=ih;continue}_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,_.path=nd(i.path),_.query=i.query,_.fragment="",y=Dp}break;case g3:if(!_.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){_.username=i.username,_.password=i.password,_.host=i.host,_.port=i.port,y=ih;continue}y=NI}else y=kI;break;case _3:if(y=kI,c!="/"||Zl(w,S+1)!="/")continue;S++;break;case kI:if(c!="/"&&c!="\\"){y=NI;continue}break;case NI:if(c=="@"){A&&(w="%40"+w),A=!0,u=nv(w);for(var U=0;U<u.length;U++){var V=u[U];if(V!=":"||W){var q=mm(V,X1);W?_.password+=q:_.username+=q}else W=!0}w=""}else if(c==Xl||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(A&&w=="")return"Invalid authority";S-=nv(w).length+1,w="",y=eD}else w+=c;break;case eD:case tD:if(n&&_.scheme=="file"){y=iD;continue}if(c!=":"||k){if(c==Xl||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()){if(_.isSpecial()&&w=="")return h_;if(n&&w==""&&(_.includesCredentials()||_.port!==null))return;if(h=_.parseHost(w))return h;if(w="",y=iv,n)return;continue}c=="["?k=!0:c=="]"&&(k=!1),w+=c}else{if(w=="")return h_;if(h=_.parseHost(w))return h;if(w="",y=nD,n==tD)return}break;case nD:if(!rd(Y1,c)){if(c==Xl||c=="/"||c=="?"||c=="#"||c=="\\"&&_.isSpecial()||n){if(w!=""){var Y=II(w,10);if(Y>65535)return a3;_.port=_.isSpecial()&&Y===OI[_.scheme]?null:Y,w=""}if(n)return;y=iv;continue}return a3}w+=c;break;case rD:if(_.scheme="file",c=="/"||c=="\\")y=E3;else{if(!i||i.scheme!="file"){y=ih;continue}if(c==Xl)_.host=i.host,_.path=nd(i.path),_.query=i.query;else if(c=="?")_.host=i.host,_.path=nd(i.path),_.query="",y=p_;else{if(c!="#"){h3(LT(nd(o,S),""))||(_.host=i.host,_.path=nd(i.path),_.shortenPath()),y=ih;continue}_.host=i.host,_.path=nd(i.path),_.query=i.query,_.fragment="",y=Dp}}break;case E3:if(c=="/"||c=="\\"){y=iD;break}i&&i.scheme=="file"&&!h3(LT(nd(o,S),""))&&(UT(i.path[0],!0)?rv(_.path,i.path[0]):_.host=i.host),y=ih;continue;case iD:if(c==Xl||c=="/"||c=="\\"||c=="?"||c=="#"){if(!n&&UT(w))y=ih;else if(w==""){if(_.host="",n)return;y=iv}else{if(h=_.parseHost(w))return h;if(_.host=="localhost"&&(_.host=""),n)return;w="",y=iv}continue}w+=c;break;case iv:if(_.isSpecial()){if(y=ih,c!="/"&&c!="\\")continue}else if(n||c!="?")if(n||c!="#"){if(c!=Xl&&(y=ih,c!="/"))continue}else _.fragment="",y=Dp;else _.query="",y=p_;break;case ih:if(c==Xl||c=="/"||c=="\\"&&_.isSpecial()||!n&&(c=="?"||c=="#")){if((m=AI(m=w))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(_.shortenPath(),c=="/"||c=="\\"&&_.isSpecial()||rv(_.path,"")):mce(w)?c=="/"||c=="\\"&&_.isSpecial()||rv(_.path,""):(_.scheme=="file"&&!_.path.length&&UT(w)&&(_.host&&(_.host=""),w=Zl(w,0)+":"),rv(_.path,w)),w="",_.scheme=="file"&&(c==Xl||c=="?"||c=="#"))for(;_.path.length>1&&_.path[0]==="";)rce(_.path);c=="?"?(_.query="",y=p_):c=="#"&&(_.fragment="",y=Dp)}else w+=mm(c,d3);break;case y3:c=="?"?(_.query="",y=p_):c=="#"?(_.fragment="",y=Dp):c!=Xl&&(_.path[0]+=mm(c,PI));break;case p_:n||c!="#"?c!=Xl&&(c=="'"&&_.isSpecial()?_.query+="%27":_.query+=c=="#"?"%23":mm(c,PI)):(_.fragment="",y=Dp);break;case Dp:c!=Xl&&(_.fragment+=mm(c,u3))}S++}},parseHost:function(e){var n,i,o;if(Zl(e,0)=="["){if(Zl(e,e.length-1)!="]"||(n=function(c){var u,h,m,_,y,S,w,A=[0,0,0,0,0,0,0,0],k=0,W=null,U=0,V=function(){return Zl(c,U)};if(V()==":"){if(Zl(c,1)!=":")return;U+=2,W=++k}for(;V();){if(k==8)return;if(V()!=":"){for(u=h=0;h<4&&rd(l3,V());)u=16*u+II(V(),16),U++,h++;if(V()=="."){if(h==0||(U-=h,k>6))return;for(m=0;V();){if(_=null,m>0){if(!(V()=="."&&m<4))return;U++}if(!rd(Y1,V()))return;for(;rd(Y1,V());){if(y=II(V(),10),_===null)_=y;else{if(_==0)return;_=10*_+y}if(_>255)return;U++}A[k]=256*A[k]+_,++m!=2&&m!=4||k++}if(m!=4)return;break}if(V()==":"){if(U++,!V())return}else if(V())return;A[k++]=u}else{if(W!==null)return;U++,W=++k}}if(W!==null)for(S=k-W,k=7;k!=0&&S>0;)w=A[k],A[k--]=A[W+S-1],A[W+--S]=w;else if(k!=8)return;return A}(xT(e,1,-1)),!n))return h_;this.host=n}else if(this.isSpecial()){if(e=qae(e),rd(uce,e)||(n=function(c){var u,h,m,_,y,S,w,A=ice(c,".");if(A.length&&A[A.length-1]==""&&A.length--,(u=A.length)>4)return c;for(h=[],m=0;m<u;m++){if((_=A[m])=="")return c;if(y=10,_.length>1&&Zl(_,0)=="0"&&(y=rd(ace,_)?16:8,_=xT(_,y==8?1:2)),_==="")S=0;else{if(!rd(y==10?lce:y==8?cce:l3,_))return c;S=II(_,y)}rv(h,S)}for(m=0;m<u;m++)if(S=h[m],m==u-1){if(S>=o3(256,5-u))return null}else if(S>255)return null;for(w=nce(h),m=0;m<h.length;m++)w+=h[m]*o3(256,3-m);return w}(e),n===null))return h_;this.host=n}else{if(rd(dce,e))return h_;for(n="",i=nv(e),o=0;o<i.length;o++)n+=mm(i[o],PI);this.host=n}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return G1(OI,this.scheme)},shortenPath:function(){var e=this.path,n=e.length;!n||this.scheme=="file"&&n==1&&UT(e[0],!0)||e.length--},serialize:function(){var e=this,n=e.scheme,i=e.username,o=e.password,c=e.host,u=e.port,h=e.path,m=e.query,_=e.fragment,y=n+":";return c!==null?(y+="//",e.includesCredentials()&&(y+=i+(o?":"+o:"")+"@"),y+=MT(c),u!==null&&(y+=":"+u)):n=="file"&&(y+="//"),y+=e.cannotBeABaseURL?h[0]:h.length?"/"+LT(h,"/"):"",m!==null&&(y+="?"+m),_!==null&&(y+="#"+_),y},setHref:function(e){var n=this.parse(e);if(n)throw $1(n);this.searchParams.update()},getOrigin:function(){var e=this.scheme,n=this.port;if(e=="blob")try{return new sv(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+MT(this.host)+(n!==null?":"+n:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Np(e)+":",J1)},getUsername:function(){return this.username},setUsername:function(e){var n=nv(Np(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<n.length;i++)this.username+=mm(n[i],X1)}},getPassword:function(){return this.password},setPassword:function(e){var n=nv(Np(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<n.length;i++)this.password+=mm(n[i],X1)}},getHost:function(){var e=this.host,n=this.port;return e===null?"":n===null?MT(e):MT(e)+":"+n},setHost:function(e){this.cannotBeABaseURL||this.parse(e,eD)},getHostname:function(){var e=this.host;return e===null?"":MT(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,tD)},getPort:function(){var e=this.port;return e===null?"":Np(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Np(e))==""?this.port=null:this.parse(e,nD))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+LT(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,iv))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Np(e))==""?this.query=null:(Zl(e,0)=="?"&&(e=xT(e,1)),this.query="",this.parse(e,p_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Np(e))!=""?(Zl(e,0)=="#"&&(e=xT(e,1)),this.fragment="",this.parse(e,Dp)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var sv=function(e){var n=$ae(this,$a),i=Xae(arguments.length,1)>1?arguments[1]:void 0,o=Jae(n,new sD(e,!1,i));W1||(n.href=o.serialize(),n.origin=o.getOrigin(),n.protocol=o.getProtocol(),n.username=o.getUsername(),n.password=o.getPassword(),n.host=o.getHost(),n.hostname=o.getHostname(),n.port=o.getPort(),n.pathname=o.getPathname(),n.search=o.getSearch(),n.searchParams=o.getSearchParams(),n.hash=o.getHash())},$a=sv.prototype,eu=function(e,n){return{get:function(){return CI(this)[e]()},set:n&&function(i){return CI(this)[n](i)},configurable:!0,enumerable:!0}};if(W1&&(Ql($a,"href",eu("serialize","setHref")),Ql($a,"origin",eu("getOrigin")),Ql($a,"protocol",eu("getProtocol","setProtocol")),Ql($a,"username",eu("getUsername","setUsername")),Ql($a,"password",eu("getPassword","setPassword")),Ql($a,"host",eu("getHost","setHost")),Ql($a,"hostname",eu("getHostname","setHostname")),Ql($a,"port",eu("getPort","setPort")),Ql($a,"pathname",eu("getPathname","setPathname")),Ql($a,"search",eu("getSearch","setSearch")),Ql($a,"searchParams",eu("getSearchParams")),Ql($a,"hash",eu("getHash","setHash"))),RI($a,"toJSON",function(){return CI(this).serialize()},{enumerable:!0}),RI($a,"toString",function(){return CI(this).serialize()},{enumerable:!0}),DT){var v3=DT.createObjectURL,S3=DT.revokeObjectURL;v3&&RI(sv,"createObjectURL",r3(v3,DT)),S3&&RI(sv,"revokeObjectURL",r3(S3,DT))}Yae(sv,"URL"),Gae({global:!0,forced:!Hae,sham:!W1},{URL:sv});var gce=xn,_ce=d,Ece=ll,T3=ua,yce=I1,b3=an("URL");gce({target:"URL",stat:!0,forced:!(yce&&_ce(function(){b3.canParse()}))},{canParse:function(e){var n=Ece(arguments.length,1),i=T3(e),o=n<2||arguments[1]===void 0?void 0:T3(arguments[1]);try{return!!new b3(i,o)}catch{return!1}}});var DI=l(yt.URL);let w3=!0,R3=!0;function LI(e,n,i){const o=e.match(n);return o&&o.length>=i&&parseInt(o[i],10)}function f_(e,n,i){if(!e.RTCPeerConnection)return;const o=e.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(h,m){if(h!==n)return c.apply(this,arguments);const _=y=>{const S=i(y);S&&(m.handleEvent?m.handleEvent(S):m(S))};return this._eventMap=this._eventMap||{},this._eventMap[n]||(this._eventMap[n]=new Map),this._eventMap[n].set(m,_),c.apply(this,[h,_])};const u=o.removeEventListener;o.removeEventListener=function(h,m){if(h!==n||!this._eventMap||!this._eventMap[n])return u.apply(this,arguments);if(!this._eventMap[n].has(m))return u.apply(this,arguments);const _=this._eventMap[n].get(m);return this._eventMap[n].delete(m),this._eventMap[n].size===0&&delete this._eventMap[n],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,_])},Object.defineProperty(o,"on"+n,{get(){return this["_on"+n]},set(h){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),h&&this.addEventListener(n,this["_on"+n]=h)},enumerable:!0,configurable:!0})}function vce(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(w3=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Sce(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(R3=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function C3(){if(typeof window=="object"){if(w3)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function oD(e,n){R3&&console.warn(e+" is deprecated, please use "+n+" instead.")}function I3(e){return Object.prototype.toString.call(e)==="[object Object]"}function A3(e){var n;return I3(e)?ja(n=Object.keys(e)).call(n,function(i,o){const c=I3(e[o]),u=c?A3(e[o]):e[o],h=c&&!Object.keys(u).length;return u===void 0||h?i:Object.assign(i,{[o]:u})},{}):e}function aD(e,n,i){n&&!i.has(n.id)&&(i.set(n.id,n),Object.keys(n).forEach(o=>{o.endsWith("Id")?aD(e,e.get(n[o]),i):o.endsWith("Ids")&&n[o].forEach(c=>{aD(e,e.get(c),i)})}))}function P3(e,n,i){const o=i?"outbound-rtp":"inbound-rtp",c=new Map;if(n===null)return c;const u=[];return e.forEach(h=>{h.type==="track"&&h.trackIdentifier===n.id&&u.push(h)}),u.forEach(h=>{e.forEach(m=>{m.type===o&&m.trackId===h.id&&aD(e,m,c)})}),c}const O3=C3;function k3(e,n){const i=e&&e.navigator;if(!i.mediaDevices)return;const o=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(_=>{if(_==="require"||_==="advanced"||_==="mediaSource")return;const y=typeof h[_]=="object"?h[_]:{ideal:h[_]};y.exact!==void 0&&typeof y.exact=="number"&&(y.min=y.max=y.exact);const S=function(w,A){return w?w+A.charAt(0).toUpperCase()+A.slice(1):A==="deviceId"?"sourceId":A};if(y.ideal!==void 0){m.optional=m.optional||[];let w={};typeof y.ideal=="number"?(w[S("min",_)]=y.ideal,m.optional.push(w),w={},w[S("max",_)]=y.ideal,m.optional.push(w)):(w[S("",_)]=y.ideal,m.optional.push(w))}y.exact!==void 0&&typeof y.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[S("",_)]=y.exact):["min","max"].forEach(w=>{y[w]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[S(w,_)]=y[w])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(n.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const _=function(y,S,w){S in y&&!(w in y)&&(y[w]=y[S],delete y[S])};_((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),_(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=o(h.audio)}if(h&&typeof h.video=="object"){let _=h.video.facingMode;_=_&&(typeof _=="object"?_:{ideal:_});const y=n.version<66;if(_&&(_.exact==="user"||_.exact==="environment"||_.ideal==="user"||_.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||y)){let S;if(delete h.video.facingMode,_.exact==="environment"||_.ideal==="environment"?S=["back","rear"]:_.exact!=="user"&&_.ideal!=="user"||(S=["front"]),S)return i.mediaDevices.enumerateDevices().then(w=>{let A=(w=w.filter(k=>k.kind==="videoinput")).find(k=>S.some(W=>{var U;return ot(U=k.label.toLowerCase()).call(U,W)}));return!A&&w.length&&ot(S).call(S,"back")&&(A=w[w.length-1]),A&&(h.video.deviceId=_.exact?{exact:A.deviceId}:{ideal:A.deviceId}),h.video=o(h.video),O3("chrome: "+JSON.stringify(h)),m(h)})}h.video=o(h.video)}return O3("chrome: "+JSON.stringify(h)),m(h)},u=function(h){return n.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(h,m,_){c(h,y=>{i.webkitGetUserMedia(y,m,S=>{_&&_(u(S))})})}).bind(i),i.mediaDevices.getUserMedia){const h=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(m){return c(m,_=>h(_).then(y=>{if(_.audio&&!y.getAudioTracks().length||_.video&&!y.getVideoTracks().length)throw y.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return y},y=>lt.reject(u(y))))}}}function N3(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function D3(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.track.id):{track:o.track};const u=new Event("track");u.track=o.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)}),i.stream.getTracks().forEach(o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.id):{track:o};const u=new Event("track");u.track=o,u.receiver=c,u.transceiver={receiver:c},u.streams=[i.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),n.apply(this,arguments)}}else f_(e,"track",n=>(n.transceiver||Object.defineProperty(n,"transceiver",{value:{receiver:n.receiver}}),n))}function L3(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const n=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,m){let _=c.apply(this,arguments);return _||(_=n(this,h),this._senders.push(_)),_};const u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],i.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(n(this,u))})};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(m=>m.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function x3(e){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,o,c]=arguments;if(arguments.length>0&&typeof i=="function")return n.apply(this,arguments);if(n.length===0&&(arguments.length===0||typeof i!="function"))return n.apply(this,[]);const u=function(m){const _={};return m.result().forEach(y=>{const S={id:y.id,timestamp:y.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[y.type]||y.type};y.names().forEach(w=>{S[w]=y.stat(w)}),_[S.id]=S}),_},h=function(m){return new Map(Object.keys(m).map(_=>[_,m[_]]))};if(arguments.length>=2){const m=function(_){o(h(u(_)))};return n.apply(this,[m,i])}return new lt((m,_)=>{n.apply(this,[function(y){m(h(u(y)))},_])}).then(o,c)}}function M3(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){const c=i.apply(this,[]);return c.forEach(u=>u._pc=this),c});const o=e.RTCPeerConnection.prototype.addTrack;o&&(e.RTCPeerConnection.prototype.addTrack=function(){const c=o.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>P3(u,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){const o=i.apply(this,[]);return o.forEach(c=>c._pc=this),o}),f_(e,"track",o=>(o.receiver._pc=o.srcElement,o)),e.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>P3(c,o.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const i=arguments[0];let o,c,u;return this.getSenders().forEach(h=>{h.track===i&&(o?u=!0:o=h)}),this.getReceivers().forEach(h=>(h.track===i&&(c?u=!0:c=h),h.track===i)),u||o&&c?lt.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():lt.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return n.apply(this,arguments)}}function U3(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=n.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(_=>{if(this.getSenders().find(S=>S.track===_))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();i.apply(this,arguments);const m=this.getSenders().filter(_=>h.indexOf(_)===-1);this._shimmedLocalStreams[u.id]=[u].concat(m)};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],o.apply(this,arguments)};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(u);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function V3(e,n){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&n.version>=65)return U3(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const _=i.apply(this);return this._reverseStreams=this._reverseStreams||{},_.map(y=>this._reverseStreams[y.id])};const o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(_){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_.getTracks().forEach(y=>{if(this.getSenders().find(w=>w.track===y))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[_.id]){const y=new e.MediaStream(_.getTracks());this._streams[_.id]=y,this._reverseStreams[y.id]=_,_=y}o.apply(this,[_])};const c=e.RTCPeerConnection.prototype.removeStream;function u(_,y){let S=y.sdp;return Object.keys(_._reverseStreams||[]).forEach(w=>{const A=_._reverseStreams[w],k=_._streams[A.id];S=S.replace(new RegExp(k.id,"g"),A.id)}),new RTCSessionDescription({type:y.type,sdp:S})}e.RTCPeerConnection.prototype.removeStream=function(_){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[_.id]||_]),delete this._reverseStreams[this._streams[_.id]?this._streams[_.id].id:_.id],delete this._streams[_.id]},e.RTCPeerConnection.prototype.addTrack=function(_,y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(k=>k===_))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(k=>k.track===_))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const A=this._streams[y.id];if(A)A.addTrack(_),lt.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const k=new e.MediaStream([_]);this._streams[y.id]=k,this._reverseStreams[k.id]=y,this.addStream(k)}return this.getSenders().find(k=>k.track===_)},["createOffer","createAnswer"].forEach(function(_){const y=e.RTCPeerConnection.prototype[_],S={[_](){const w=arguments;return arguments.length&&typeof arguments[0]=="function"?y.apply(this,[A=>{const k=u(this,A);w[0].apply(null,[k])},A=>{w[1]&&w[1].apply(null,A)},arguments[2]]):y.apply(this,arguments).then(A=>u(this,A))}};e.RTCPeerConnection.prototype[_]=S[_]});const h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(_,y){let S=y.sdp;return Object.keys(_._reverseStreams||[]).forEach(w=>{const A=_._reverseStreams[w],k=_._streams[A.id];S=S.replace(new RegExp(A.id,"g"),k.id)}),new RTCSessionDescription({type:y.type,sdp:S})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const _=m.get.apply(this);return _.type===""?_:u(this,_)}}),e.RTCPeerConnection.prototype.removeTrack=function(_){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!_._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(_._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let y;this._streams=this._streams||{},Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(w=>_.track===w)&&(y=this._streams[S])}),y&&(y.getTracks().length===1?this.removeStream(this._reverseStreams[y.id]):y.removeTrack(_.track),this.dispatchEvent(new Event("negotiationneeded")))}}function cD(e,n){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const o=e.RTCPeerConnection.prototype[i],c={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=c[i]})}function F3(e,n){f_(e,"negotiationneeded",i=>{const o=i.target;if(!(n.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return i})}var j3=Object.freeze({__proto__:null,fixNegotiationNeeded:F3,shimAddTrackRemoveTrack:V3,shimAddTrackRemoveTrackWithNative:U3,shimGetDisplayMedia:function(e,n){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof n=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return n(i).then(o=>{const c=i.video&&i.video.width,u=i.video&&i.video.height,h=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:h||3}},c&&(i.video.mandatory.maxWidth=c),u&&(i.video.mandatory.maxHeight=u),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:L3,shimGetStats:x3,shimGetUserMedia:k3,shimMediaStream:N3,shimOnTrack:D3,shimPeerConnection:cD,shimSenderReceiverGetStats:M3});function B3(e,n){const i=e&&e.navigator,o=e&&e.MediaStreamTrack;if(i.getUserMedia=function(c,u,h){oD("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(c).then(u,h)},!(n.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const c=function(h,m,_){m in h&&!(_ in h)&&(h[_]=h[m],delete h[m])},u=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},o&&o.prototype.getSettings){const h=o.prototype.getSettings;o.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(o&&o.prototype.applyConstraints){const h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function W3(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function lD(e,n){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),n.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=e.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=h[c]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return o.apply(this,[c||null]).then(m=>{if(n.version<53&&!u)try{m.forEach(_=>{_.type=i[_.type]||_.type})}catch(_){if(_.name!=="TypeError")throw _;m.forEach((y,S)=>{m.set(S,Object.assign({},y,{type:i[y.type]||y.type}))})}return m}).then(u,h)}}function z3(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(c=>c._pc=this),o});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=i.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):lt.resolve(new Map)}}function G3(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i}),f_(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function H3(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(n){oD("removeStream","removeTrack"),this.getSenders().forEach(i=>{var o;i.track&&ot(o=n.getTracks()).call(o,i.track)&&this.removeTrack(i)})})}function $3(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function K3(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.addTransceiver;n&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const o=i.length>0;o&&i.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=n.apply(this,arguments);if(o){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=i,u.sendEncodings=i,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function q3(e){if(typeof e!="object"||!e.RTCRtpSender)return;const n=e.RTCRtpSender.prototype.getParameters;n&&(e.RTCRtpSender.prototype.getParameters=function(){const i=n.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function Y3(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?lt.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}function X3(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?lt.all(this.setParametersPromises).then(()=>n.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):n.apply(this,arguments)}}var J3=Object.freeze({__proto__:null,shimAddTransceiver:K3,shimCreateAnswer:X3,shimCreateOffer:Y3,shimGetDisplayMedia:function(e,n){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,lt.reject(o)}return i.video===!0?i.video={mediaSource:n}:i.video.mediaSource=n,e.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:q3,shimGetUserMedia:B3,shimOnTrack:W3,shimPeerConnection:lD,shimRTCDataChannel:$3,shimReceiverGetStats:G3,shimRemoveStream:H3,shimSenderGetStats:z3});function Q3(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){var o;this._localStreams||(this._localStreams=[]),ot(o=this._localStreams).call(o,i)||this._localStreams.push(i),i.getAudioTracks().forEach(c=>n.call(this,c,i)),i.getVideoTracks().forEach(c=>n.call(this,c,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var m;this._localStreams?ot(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),n.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(n){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(n);if(i===-1)return;this._localStreams.splice(i,1);const o=n.getTracks();this.getSenders().forEach(c=>{ot(o).call(o,c.track)&&this.removeTrack(c)})})}}function Z3(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),ot(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(c)>=0)return;i._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,i.dispatchEvent(u)})}),n.apply(i,arguments)}}}function eB(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,i=n.createOffer,o=n.createAnswer,c=n.setLocalDescription,u=n.setRemoteDescription,h=n.addIceCandidate;n.createOffer=function(_,y){const S=arguments.length>=2?arguments[2]:arguments[0],w=i.apply(this,[S]);return y?(w.then(_,y),lt.resolve()):w},n.createAnswer=function(_,y){const S=arguments.length>=2?arguments[2]:arguments[0],w=o.apply(this,[S]);return y?(w.then(_,y),lt.resolve()):w};let m=function(_,y,S){const w=c.apply(this,[_]);return S?(w.then(y,S),lt.resolve()):w};n.setLocalDescription=m,m=function(_,y,S){const w=u.apply(this,[_]);return S?(w.then(y,S),lt.resolve()):w},n.setRemoteDescription=m,m=function(_,y,S){const w=h.apply(this,[_]);return S?(w.then(y,S),lt.resolve()):w},n.addIceCandidate=m}function tB(e){const n=e&&e.navigator;if(n.mediaDevices&&n.mediaDevices.getUserMedia){const i=n.mediaDevices,o=i.getUserMedia.bind(i);n.mediaDevices.getUserMedia=c=>o(nB(c))}!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=(function(i,o,c){n.mediaDevices.getUserMedia(i).then(o,c)}).bind(n))}function nB(e){return e&&e.video!==void 0?Object.assign({},e,{video:A3(e.video)}):e}function rB(e){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection;e.RTCPeerConnection=function(i,o){if(i&&i.iceServers){const c=[];for(let u=0;u<i.iceServers.length;u++){let h=i.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(oD("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(i.iceServers[u])}i.iceServers=c}return new n(i,o)},e.RTCPeerConnection.prototype=n.prototype,"generateCertificate"in n&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>n.generateCertificate})}function iB(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function sB(e){const n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):i.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):i.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return n.apply(this,arguments)}}function oB(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var aB=Object.freeze({__proto__:null,shimAudioContext:oB,shimCallbacksAPI:eB,shimConstraints:nB,shimCreateOfferLegacy:sB,shimGetUserMedia:tB,shimLocalStreamsAPI:Q3,shimRTCIceServerUrls:rB,shimRemoteStreamsAPI:Z3,shimTrackEventTransceiver:iB}),cB=`	
\v\f\r \u2028\u2029\uFEFF`,Tce=qt,bce=ua,uD=cB,lB=I("".replace),wce=RegExp("^["+uD+"]+"),Rce=RegExp("(^|[^"+uD+"])["+uD+"]+$"),Cce=function(e){return function(n){var i=bce(Tce(n));return 1&e&&(i=lB(i,wce,"")),2&e&&(i=lB(i,Rce,"$1")),i}},Ice={trim:Cce(3)},Ace=BC.PROPER,Pce=d,uB=cB,Oce=Ice.trim;xn({target:"String",proto:!0,forced:function(e){return Pce(function(){return!!uB[e]()||""[e]()!==""||Ace&&uB[e].name!==e})}("trim")},{trim:function(){return Oce(this)}});var kce=Fa("String").trim,Nce=N,Dce=kce,dD=String.prototype,Lce=function(e){var n=e.trim;return typeof e=="string"||e===dD||Nce(dD,e)&&n===dD.trim?Dce:n},Ys=l(Lce),dB={exports:{}};(function(e){const n={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};n.localCName=n.generateIdentifier(),n.splitLines=function(i){return i.trim().split(`
`).map(o=>o.trim())},n.splitSections=function(i){return i.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},n.getDescription=function(i){const o=n.splitSections(i);return o&&o[0]},n.getMediaSections=function(i){const o=n.splitSections(i);return o.shift(),o},n.matchPrefix=function(i,o){return n.splitLines(i).filter(c=>c.indexOf(o)===0)},n.parseCandidate=function(i){let o;o=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");const c={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let u=8;u<o.length;u+=2)switch(o[u]){case"raddr":c.relatedAddress=o[u+1];break;case"rport":c.relatedPort=parseInt(o[u+1],10);break;case"tcptype":c.tcpType=o[u+1];break;case"ufrag":c.ufrag=o[u+1],c.usernameFragment=o[u+1];break;default:c[o[u]]===void 0&&(c[o[u]]=o[u+1])}return c},n.writeCandidate=function(i){const o=[];o.push(i.foundation);const c=i.component;c==="rtp"?o.push(1):c==="rtcp"?o.push(2):o.push(c),o.push(i.protocol.toUpperCase()),o.push(i.priority),o.push(i.address||i.ip),o.push(i.port);const u=i.type;return o.push("typ"),o.push(u),u!=="host"&&i.relatedAddress&&i.relatedPort&&(o.push("raddr"),o.push(i.relatedAddress),o.push("rport"),o.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(o.push("ufrag"),o.push(i.usernameFragment||i.ufrag)),"candidate:"+o.join(" ")},n.parseIceOptions=function(i){return i.substring(14).split(" ")},n.parseRtpMap=function(i){let o=i.substring(9).split(" ");const c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},n.writeRtpMap=function(i){let o=i.payloadType;i.preferredPayloadType!==void 0&&(o=i.preferredPayloadType);const c=i.channels||i.numChannels||1;return"a=rtpmap:"+o+" "+i.name+"/"+i.clockRate+(c!==1?"/"+c:"")+`\r
`},n.parseExtmap=function(i){const o=i.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},n.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},n.parseFmtp=function(i){const o={};let c;const u=i.substring(i.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),o[c[0].trim()]=c[1];return o},n.writeFmtp=function(i){let o="",c=i.payloadType;if(i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const u=[];Object.keys(i.parameters).forEach(h=>{i.parameters[h]!==void 0?u.push(h+"="+i.parameters[h]):u.push(h)}),o+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return o},n.parseRtcpFb=function(i){const o=i.substring(i.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},n.writeRtcpFb=function(i){let o="",c=i.payloadType;return i.preferredPayloadType!==void 0&&(c=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(u=>{o+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),o},n.parseSsrcMedia=function(i){const o=i.indexOf(" "),c={ssrc:parseInt(i.substring(7,o),10)},u=i.indexOf(":",o);return u>-1?(c.attribute=i.substring(o+1,u),c.value=i.substring(u+1)):c.attribute=i.substring(o+1),c},n.parseSsrcGroup=function(i){const o=i.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(c=>parseInt(c,10))}},n.getMid=function(i){const o=n.matchPrefix(i,"a=mid:")[0];if(o)return o.substring(6)},n.parseFingerprint=function(i){const o=i.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},n.getDtlsParameters=function(i,o){return{role:"auto",fingerprints:n.matchPrefix(i+o,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(i,o){let c="a=setup:"+o+`\r
`;return i.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},n.parseCryptoLine=function(i){const o=i.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},n.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?n.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},n.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const o=i.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},n.getCryptoParameters=function(i,o){return n.matchPrefix(i+o,"a=crypto:").map(n.parseCryptoLine)},n.getIceParameters=function(i,o){const c=n.matchPrefix(i+o,"a=ice-ufrag:")[0],u=n.matchPrefix(i+o,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},n.writeIceParameters=function(i){let o="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(o+=`a=ice-lite\r
`),o},n.parseRtpParameters=function(i){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=n.splitLines(i)[0].split(" ");o.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],_=n.matchPrefix(i,"a=rtpmap:"+m+" ")[0];if(_){const y=n.parseRtpMap(_),S=n.matchPrefix(i,"a=fmtp:"+m+" ");switch(y.parameters=S.length?n.parseFmtp(S[0]):{},y.rtcpFeedback=n.matchPrefix(i,"a=rtcp-fb:"+m+" ").map(n.parseRtcpFb),o.codecs.push(y),y.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(y.name.toUpperCase())}}}n.matchPrefix(i,"a=extmap:").forEach(h=>{o.headerExtensions.push(n.parseExtmap(h))});const u=n.matchPrefix(i,"a=rtcp-fb:* ").map(n.parseRtcpFb);return o.codecs.forEach(h=>{u.forEach(m=>{h.rtcpFeedback.find(_=>_.type===m.type&&_.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),o},n.writeRtpDescription=function(i,o){let c="";c+="m="+i+" ",c+=o.codecs.length>0?"9":"0",c+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=o.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(h=>{c+=n.writeRtpMap(h),c+=n.writeFmtp(h),c+=n.writeRtcpFb(h)});let u=0;return o.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(h=>{c+=n.writeExtmap(h)}),c},n.parseRtpEncodingParameters=function(i){const o=[],c=n.parseRtpParameters(i),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=n.matchPrefix(i,"a=ssrc:").map(A=>n.parseSsrcMedia(A)).filter(A=>A.attribute==="cname"),_=m.length>0&&m[0].ssrc;let y;const S=n.matchPrefix(i,"a=ssrc-group:FID").map(A=>A.substring(17).split(" ").map(k=>parseInt(k,10)));S.length>0&&S[0].length>1&&S[0][0]===_&&(y=S[0][1]),c.codecs.forEach(A=>{if(A.name.toUpperCase()==="RTX"&&A.parameters.apt){let k={ssrc:_,codecPayloadType:parseInt(A.parameters.apt,10)};_&&y&&(k.rtx={ssrc:y}),o.push(k),u&&(k=JSON.parse(JSON.stringify(k)),k.fec={ssrc:_,mechanism:h?"red+ulpfec":"red"},o.push(k))}}),o.length===0&&_&&o.push({ssrc:_});let w=n.matchPrefix(i,"b=");return w.length&&(w=w[0].indexOf("b=TIAS:")===0?parseInt(w[0].substring(7),10):w[0].indexOf("b=AS:")===0?1e3*parseInt(w[0].substring(5),10)*.95-16e3:void 0,o.forEach(A=>{A.maxBitrate=w})),o},n.parseRtcpParameters=function(i){const o={},c=n.matchPrefix(i,"a=ssrc:").map(m=>n.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);const u=n.matchPrefix(i,"a=rtcp-rsize");o.reducedSize=u.length>0,o.compound=u.length===0;const h=n.matchPrefix(i,"a=rtcp-mux");return o.mux=h.length>0,o},n.writeRtcpParameters=function(i){let o="";return i.reducedSize&&(o+=`a=rtcp-rsize\r
`),i.mux&&(o+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(o+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),o},n.parseMsid=function(i){let o;const c=n.matchPrefix(i,"a=msid:");if(c.length===1)return o=c[0].substring(7).split(" "),{stream:o[0],track:o[1]};const u=n.matchPrefix(i,"a=ssrc:").map(h=>n.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(o=u[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},n.parseSctpDescription=function(i){const o=n.parseMLine(i),c=n.matchPrefix(i,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=n.matchPrefix(i,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:o.fmt,maxMessageSize:u};const m=n.matchPrefix(i,"a=sctpmap:");if(m.length>0){const _=m[0].substring(10).split(" ");return{port:parseInt(_[0],10),protocol:_[1],maxMessageSize:u}}},n.writeSctpDescription=function(i,o){let c=[];return c=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,22)},n.writeSessionBoilerplate=function(i,o,c){let u;const h=o!==void 0?o:2;return u=i||n.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},n.getDirection=function(i,o){const c=n.splitLines(i);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return o?n.getDirection(o):"sendrecv"},n.getKind=function(i){return n.splitLines(i)[0].split(" ")[0].substring(2)},n.isRejected=function(i){return i.split(" ",2)[1]==="0"},n.parseMLine=function(i){const o=n.splitLines(i)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},n.parseOLine=function(i){const o=n.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},n.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const o=n.splitLines(i);for(let c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},e.exports=n})(dB);var hB=dB.exports,ov=l(hB),xce=s({__proto__:null,default:ov},[hB]);function xI(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const n=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const o=new n(i),c=ov.parseCandidate(i.candidate),u=Object.assign(o,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new n(i)},e.RTCIceCandidate.prototype=n.prototype,f_(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function hD(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||f_(e,"icecandidate",n=>{if(n.candidate){const i=ov.parseCandidate(n.candidate.candidate);i.type==="relay"&&(n.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return n})}function MI(e,n){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const i=function(m){if(!m||!m.sdp)return!1;const _=ov.splitSections(m.sdp);return _.shift(),_.some(y=>{const S=ov.parseMLine(y);return S&&S.kind==="application"&&S.protocol.indexOf("SCTP")!==-1})},o=function(m){const _=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(_===null||_.length<2)return-1;const y=parseInt(_[1],10);return y!=y?-1:y},c=function(m){let _=65536;return n.browser==="firefox"&&(_=n.version<57?m===-1?16384:2147483637:n.version<60?n.version===57?65535:65536:2147483637),_},u=function(m,_){let y=65536;n.browser==="firefox"&&n.version===57&&(y=65535);const S=ov.matchPrefix(m.sdp,"a=max-message-size:");return S.length>0?y=parseInt(S[0].substr(19),10):n.browser==="firefox"&&_!==-1&&(y=2147483637),y},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,n.browser==="chrome"&&n.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const m=o(arguments[0]),_=c(m),y=u(arguments[0],m);let S;S=_===0&&y===0?Number.POSITIVE_INFINITY:_===0||y===0?Math.max(_,y):Math.min(_,y);const w={};Object.defineProperty(w,"maxMessageSize",{get:()=>S}),this._sctp=w}return h.apply(this,arguments)}}function UI(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function n(o,c){const u=o.send;o.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(o.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(o,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const o=i.apply(this,arguments);return n(o,this),o},f_(e,"datachannel",o=>(n(o.channel,o.target),o))}function pD(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype;Object.defineProperty(n,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(n,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const o=n[i];n[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function fD(e,n){if(!e.RTCPeerConnection||n.browser==="chrome"&&n.version>=71||n.browser==="safari"&&n.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=o.sdp.split(`
`).filter(u=>Ys(u).call(u)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&o instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return i.apply(this,arguments)}}function VI(e,n){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(n.browser==="chrome"&&n.version<78||n.browser==="firefox"&&n.version<68||n.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?lt.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),lt.resolve())})}function FI(e,n){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return i.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?i.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>i.apply(this,[c]))})}var Mce=Object.freeze({__proto__:null,removeExtmapAllowMixed:fD,shimAddIceCandidateNullOrEmpty:VI,shimConnectionState:pD,shimMaxMessageSize:MI,shimParameterlessSetLocalDescription:FI,shimRTCIceCandidate:xI,shimRTCIceCandidateRelayProtocol:hD,shimSendThrowTypeError:UI});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=C3,o=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:m}=u;if(m.mozGetUserMedia)h.browser="firefox",h.version=LI(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=LI(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=LI(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(e),c={browserDetails:o,commonShim:Mce,extractVersion:LI,disableLog:vce,disableWarnings:Sce,sdp:xce};switch(o.browser){case"chrome":if(!j3||!cD||!n.shimChrome)return i("Chrome shim is not included in this adapter release."),c;if(o.version===null)return i("Chrome shim can not determine version, not shimming."),c;i("adapter.js shimming chrome."),c.browserShim=j3,VI(e,o),FI(e),k3(e,o),N3(e),cD(e,o),D3(e),V3(e,o),L3(e),x3(e),M3(e),F3(e,o),xI(e),hD(e),pD(e),MI(e,o),UI(e),fD(e,o);break;case"firefox":if(!J3||!lD||!n.shimFirefox)return i("Firefox shim is not included in this adapter release."),c;i("adapter.js shimming firefox."),c.browserShim=J3,VI(e,o),FI(e),B3(e,o),lD(e,o),W3(e),H3(e),z3(e),G3(e),$3(e),K3(e),q3(e),Y3(e),X3(e),xI(e),pD(e),MI(e,o),UI(e);break;case"safari":if(!aB||!n.shimSafari)return i("Safari shim is not included in this adapter release."),c;i("adapter.js shimming safari."),c.browserShim=aB,VI(e,o),FI(e),rB(e),sB(e),eB(e),Q3(e),Z3(e),iB(e),tB(e),oB(e),xI(e),hD(e),MI(e,o),UI(e),fD(e,o);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var pB=ac,Uce=TypeError,fB=ir.match(/firefox\/(\d+)/i),Vce=!!fB&&+fB[1],Fce=/MSIE|Trident/.test(ir),mB=ir.match(/AppleWebKit\/(\d+)\./),jce=!!mB&&+mB[1],Bce=xn,gB=I,Wce=as,zce=Ro,_B=ii,Gce=function(e,n){if(!delete e[n])throw Uce("Cannot delete property "+pB(n)+" of "+pB(e))},EB=ua,mD=d,Hce=A4,$ce=up,yB=Vce,Kce=Fce,vB=ur,SB=jce,gm=[],TB=gB(gm.sort),qce=gB(gm.push),Yce=mD(function(){gm.sort(void 0)}),Xce=mD(function(){gm.sort(null)}),Jce=$ce("sort"),bB=!mD(function(){if(vB)return vB<70;if(!(yB&&yB>3)){if(Kce)return!0;if(SB)return SB<603;var e,n,i,o,c="";for(e=65;e<76;e++){switch(n=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(o=0;o<47;o++)gm.push({k:n+o,v:i})}for(gm.sort(function(u,h){return h.v-u.v}),o=0;o<gm.length;o++)n=gm[o].k.charAt(0),c.charAt(c.length-1)!==n&&(c+=n);return c!=="DGBEFHACIJK"}});Bce({target:"Array",proto:!0,forced:Yce||!Xce||!Jce||!bB},{sort:function(e){e!==void 0&&Wce(e);var n=zce(this);if(bB)return e===void 0?TB(n):TB(n,e);var i,o,c=[],u=_B(n);for(o=0;o<u;o++)o in n&&qce(c,n[o]);for(Hce(c,function(h){return function(m,_){return _===void 0?-1:m===void 0?1:h!==void 0?+h(m,_)||0:EB(m)>EB(_)?1:-1}}(e)),i=_B(c),o=0;o<i;)n[o]=c[o++];for(;o<u;)Gce(n,o++);return n}});var Qce=Fa("Array").sort,Zce=N,ele=Qce,gD=Array.prototype,tle=function(e){var n=e.sort;return e===gD||Zce(gD,e)&&n===gD.sort?ele:n},VT=l(tle),_D=j;xn({global:!0,forced:_D.globalThis!==_D},{globalThis:_D});var wB=l(j),ED={exports:{}};(function(e,n){(function(i,o){var c="function",u="undefined",h="object",m="string",_="major",y="model",S="name",w="type",A="vendor",k="version",W="architecture",U="console",V="mobile",q="tablet",Y="smarttv",ce="wearable",_e="embedded",Ee="Amazon",me="Apple",ke="ASUS",Ye="BlackBerry",ut="Browser",pt="Chrome",yn="Firefox",vn="Google",cr="Huawei",Zr="LG",Wr="Microsoft",qo="Motorola",je="Opera",st="Samsung",vt="Sharp",We="Sony",x="Xiaomi",ie="Zebra",ue="Facebook",Qe="Chromium OS",Gt="Mac OS",tr=function(Ei){for(var Mi={},yr=0;yr<Ei.length;yr++)Mi[Ei[yr].toUpperCase()]=Ei[yr];return Mi},xi=function(Ei,Mi){return typeof Ei===m&&ba(Mi).indexOf(ba(Ei))!==-1},ba=function(Ei){return Ei.toLowerCase()},Xp=function(Ei,Mi){if(typeof Ei===m)return Ei=Ei.replace(/^\s\s*/,""),typeof Mi===u?Ei:Ei.substring(0,350)},H_=function(Ei,Mi){for(var yr,Ya,bh,ei,Vn,wa,Vm=0;Vm<Mi.length&&!Vn;){var _d=Mi[Vm],J7=Mi[Vm+1];for(yr=Ya=0;yr<_d.length&&!Vn&&_d[yr];)if(Vn=_d[yr++].exec(Ei))for(bh=0;bh<J7.length;bh++)wa=Vn[++Ya],typeof(ei=J7[bh])===h&&ei.length>0?ei.length===2?typeof ei[1]==c?this[ei[0]]=ei[1].call(this,wa):this[ei[0]]=ei[1]:ei.length===3?typeof ei[1]!==c||ei[1].exec&&ei[1].test?this[ei[0]]=wa?wa.replace(ei[1],ei[2]):o:this[ei[0]]=wa?ei[1].call(this,wa,ei[2]):o:ei.length===4&&(this[ei[0]]=wa?ei[3].call(this,wa.replace(ei[1],ei[2])):o):this[ei]=wa||o;Vm+=2}},Bb=function(Ei,Mi){for(var yr in Mi)if(typeof Mi[yr]===h&&Mi[yr].length>0){for(var Ya=0;Ya<Mi[yr].length;Ya++)if(xi(Mi[yr][Ya],Ei))return yr==="?"?o:yr}else if(xi(Mi[yr],Ei))return yr==="?"?o:yr;return Ei},MP={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},UP={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[k,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[k,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,k],[/opios[\/ ]+([\w\.]+)/i],[k,[S,je+" Mini"]],[/\bopr\/([\w\.]+)/i],[k,[S,je]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[S,k],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[k,[S,"UC"+ut]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[k,[S,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[k,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[k,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[k,[S,"IE"]],[/yabrowser\/([\w\.]+)/i],[k,[S,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+ut],k],[/\bfocus\/([\w\.]+)/i],[k,[S,yn+" Focus"]],[/\bopt\/([\w\.]+)/i],[k,[S,je+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[k,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[k,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[k,[S,je+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[k,[S,"MIUI "+ut]],[/fxios\/([-\w\.]+)/i],[k,[S,yn]],[/\bqihu|(qi?ho?o?|360)browser/i],[[S,"360 "+ut]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1 "+ut],k],[/(comodo_dragon)\/([\w\.]+)/i],[[S,/_/g," "],k],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[S,k],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,ue],k],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[S,k],[/\bgsa\/([\w\.]+) .*safari\//i],[k,[S,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[k,[S,pt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,pt+" WebView"],k],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[k,[S,"Android "+ut]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,k],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[k,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[k,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[k,Bb,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[S,k],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],k],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[k,[S,yn+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[S,k],[/(cobalt)\/([\w\.]+)/i],[S,[k,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[W,"amd64"]],[/(ia32(?=;))/i],[[W,ba]],[/((?:i[346]|x)86)[;\)]/i],[[W,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[W,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[W,"armhf"]],[/windows (ce|mobile); ppc;/i],[[W,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[W,/ower/,"",ba]],[/(sun4\w)[;\)]/i],[[W,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[W,ba]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[y,[A,st],[w,q]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[y,[A,st],[w,V]],[/\((ip(?:hone|od)[\w ]*);/i],[y,[A,me],[w,V]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[y,[A,me],[w,q]],[/(macintosh);/i],[y,[A,me]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[y,[A,vt],[w,V]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[y,[A,cr],[w,q]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[y,[A,cr],[w,V]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[y,/_/g," "],[A,x],[w,V]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[y,/_/g," "],[A,x],[w,q]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[y,[A,"OPPO"],[w,V]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[y,[A,"Vivo"],[w,V]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[y,[A,"Realme"],[w,V]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[y,[A,qo],[w,V]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[y,[A,qo],[w,q]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[y,[A,Zr],[w,q]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[y,[A,Zr],[w,V]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[y,[A,"Lenovo"],[w,q]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[y,/_/g," "],[A,"Nokia"],[w,V]],[/(pixel c)\b/i],[y,[A,vn],[w,q]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[y,[A,vn],[w,V]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[y,[A,We],[w,V]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[y,"Xperia Tablet"],[A,We],[w,q]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[y,[A,"OnePlus"],[w,V]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[y,[A,Ee],[w,q]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[y,/(.+)/g,"Fire Phone $1"],[A,Ee],[w,V]],[/(playbook);[-\w\),; ]+(rim)/i],[y,A,[w,q]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[y,[A,Ye],[w,V]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[y,[A,ke],[w,q]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[y,[A,ke],[w,V]],[/(nexus 9)/i],[y,[A,"HTC"],[w,q]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[A,[y,/_/g," "],[w,V]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[y,[A,"Acer"],[w,q]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[y,[A,"Meizu"],[w,V]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[A,y,[w,V]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[A,y,[w,q]],[/(surface duo)/i],[y,[A,Wr],[w,q]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[y,[A,"Fairphone"],[w,V]],[/(u304aa)/i],[y,[A,"AT&T"],[w,V]],[/\bsie-(\w*)/i],[y,[A,"Siemens"],[w,V]],[/\b(rct\w+) b/i],[y,[A,"RCA"],[w,q]],[/\b(venue[\d ]{2,7}) b/i],[y,[A,"Dell"],[w,q]],[/\b(q(?:mv|ta)\w+) b/i],[y,[A,"Verizon"],[w,q]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[y,[A,"Barnes & Noble"],[w,q]],[/\b(tm\d{3}\w+) b/i],[y,[A,"NuVision"],[w,q]],[/\b(k88) b/i],[y,[A,"ZTE"],[w,q]],[/\b(nx\d{3}j) b/i],[y,[A,"ZTE"],[w,V]],[/\b(gen\d{3}) b.+49h/i],[y,[A,"Swiss"],[w,V]],[/\b(zur\d{3}) b/i],[y,[A,"Swiss"],[w,q]],[/\b((zeki)?tb.*\b) b/i],[y,[A,"Zeki"],[w,q]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[A,"Dragon Touch"],y,[w,q]],[/\b(ns-?\w{0,9}) b/i],[y,[A,"Insignia"],[w,q]],[/\b((nxa|next)-?\w{0,9}) b/i],[y,[A,"NextBook"],[w,q]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[A,"Voice"],y,[w,V]],[/\b(lvtel\-)?(v1[12]) b/i],[[A,"LvTel"],y,[w,V]],[/\b(ph-1) /i],[y,[A,"Essential"],[w,V]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[y,[A,"Envizen"],[w,q]],[/\b(trio[-\w\. ]+) b/i],[y,[A,"MachSpeed"],[w,q]],[/\btu_(1491) b/i],[y,[A,"Rotor"],[w,q]],[/(shield[\w ]+) b/i],[y,[A,"Nvidia"],[w,q]],[/(sprint) (\w+)/i],[A,y,[w,V]],[/(kin\.[onetw]{3})/i],[[y,/\./g," "],[A,Wr],[w,V]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[y,[A,ie],[w,q]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[y,[A,ie],[w,V]],[/smart-tv.+(samsung)/i],[A,[w,Y]],[/hbbtv.+maple;(\d+)/i],[[y,/^/,"SmartTV"],[A,st],[w,Y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[A,Zr],[w,Y]],[/(apple) ?tv/i],[A,[y,me+" TV"],[w,Y]],[/crkey/i],[[y,pt+"cast"],[A,vn],[w,Y]],[/droid.+aft(\w)( bui|\))/i],[y,[A,Ee],[w,Y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[y,[A,vt],[w,Y]],[/(bravia[\w ]+)( bui|\))/i],[y,[A,We],[w,Y]],[/(mitv-\w{5}) bui/i],[y,[A,x],[w,Y]],[/Hbbtv.*(technisat) (.*);/i],[A,y,[w,Y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[A,Xp],[y,Xp],[w,Y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[w,Y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[A,y,[w,U]],[/droid.+; (shield) bui/i],[y,[A,"Nvidia"],[w,U]],[/(playstation [345portablevi]+)/i],[y,[A,We],[w,U]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[y,[A,Wr],[w,U]],[/((pebble))app/i],[A,y,[w,ce]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[y,[A,me],[w,ce]],[/droid.+; (glass) \d/i],[y,[A,vn],[w,ce]],[/droid.+; (wt63?0{2,3})\)/i],[y,[A,ie],[w,ce]],[/(quest( 2| pro)?)/i],[y,[A,ue],[w,ce]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[A,[w,_e]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[y,[w,V]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[y,[w,q]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[w,q]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[w,V]],[/(android[-\w\. ]{0,9});.+buil/i],[y,[A,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[k,[S,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[k,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[S,k],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[k,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,k],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[S,[k,Bb,MP]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,"Windows"],[k,Bb,MP]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[k,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,Gt],[k,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[k,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,k],[/\(bb(10);/i],[k,[S,Ye]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[k,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[k,[S,yn+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[k,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[k,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[k,[S,pt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,Qe],k],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,k],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],k],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[S,k]]},Sl=function(Ei,Mi){if(typeof Ei===h&&(Mi=Ei,Ei=o),!(this instanceof Sl))return new Sl(Ei,Mi).getResult();var yr=typeof i!==u&&i.navigator?i.navigator:o,Ya=Ei||(yr&&yr.userAgent?yr.userAgent:""),bh=yr&&yr.userAgentData?yr.userAgentData:o,ei=Mi?function(Vn,wa){var Vm={};for(var _d in Vn)wa[_d]&&wa[_d].length%2==0?Vm[_d]=wa[_d].concat(Vn[_d]):Vm[_d]=Vn[_d];return Vm}(UP,Mi):UP;return this.getBrowser=function(){var Vn={};return Vn[S]=o,Vn[k]=o,H_.call(Vn,Ya,ei.browser),Vn[_]=function(wa){return typeof wa===m?wa.replace(/[^\d\.]/g,"").split(".")[0]:o}(Vn[k]),yr&&yr.brave&&typeof yr.brave.isBrave==c&&(Vn[S]="Brave"),Vn},this.getCPU=function(){var Vn={};return Vn[W]=o,H_.call(Vn,Ya,ei.cpu),Vn},this.getDevice=function(){var Vn={};return Vn[A]=o,Vn[y]=o,Vn[w]=o,H_.call(Vn,Ya,ei.device),!Vn[w]&&bh&&bh.mobile&&(Vn[w]=V),Vn[y]=="Macintosh"&&yr&&typeof yr.standalone!==u&&yr.maxTouchPoints&&yr.maxTouchPoints>2&&(Vn[y]="iPad",Vn[w]=q),Vn},this.getEngine=function(){var Vn={};return Vn[S]=o,Vn[k]=o,H_.call(Vn,Ya,ei.engine),Vn},this.getOS=function(){var Vn={};return Vn[S]=o,Vn[k]=o,H_.call(Vn,Ya,ei.os),!Vn[S]&&bh&&bh.platform!="Unknown"&&(Vn[S]=bh.platform.replace(/chrome os/i,Qe).replace(/macos/i,Gt)),Vn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Ya},this.setUA=function(Vn){return Ya=typeof Vn===m&&Vn.length>350?Xp(Vn,350):Vn,this},this.setUA(Ya),this};Sl.VERSION="0.7.34",Sl.BROWSER=tr([S,k,_]),Sl.CPU=tr([W]),Sl.DEVICE=tr([y,A,w,U,V,Y,q,ce,_e]),Sl.ENGINE=Sl.OS=tr([S,k]),e.exports&&(n=e.exports=Sl),n.UAParser=Sl;var Um=typeof i!==u&&(i.jQuery||i.Zepto);if(Um&&!Um.ua){var $_=new Sl;Um.ua=$_.getResult(),Um.ua.get=function(){return $_.getUA()},Um.ua.set=function(Ei){$_.setUA(Ei);var Mi=$_.getResult();for(var yr in Mi)Um.ua[yr]=Mi[yr]}}})(typeof window=="object"?window:a)})(ED,ED.exports);var nle=l(ED.exports),rle=fc,ile=hi,sle=Ut,ole=Hd,ale=dr("iterator"),cle=Object,lle=function(e){if(sle(e))return!1;var n=cle(e);return n[ale]!==void 0||"@@iterator"in n||ile(ole,rle(n))},ule=l(lle),RB=My.clear;xn({global:!0,bind:!0,forced:j.clearImmediate!==RB},{clearImmediate:RB});var dle=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",CB=j,hle=ee,ple=Me,fle=dle,mle=ir,gle=hs,_le=ll,Ele=CB.Function,yle=/MSIE .\./.test(mle)||fle&&function(){var e=CB.Bun.version.split(".");return e.length<3||e[0]==0&&(e[1]<3||e[1]==3&&e[2]==0)}(),vle=xn,IB=j,AB=My.set,Sle=function(e,n){var i=1;return yle?function(o,c){var u=_le(arguments.length,1)>i,h=ple(o)?o:Ele(o),m=u?gle(arguments,i):[],_=u?function(){hle(h,this,m)}:h;return e(_)}:e},PB=IB.setImmediate?Sle(AB):AB;vle({global:!0,bind:!0,forced:IB.setImmediate!==PB},{setImmediate:PB});var OB=l(yt.setImmediate),Tle=xn,ble=Ga,wle=as,Rle=ll,Cle=dp,Ile=j.process;Tle({global:!0,dontCallGetSet:!0},{queueMicrotask:function(e){Rle(arguments.length,1),wle(e);var n=Cle&&Ile.domain;ble(n?n.bind(e):e)}});var kB=l(yt.queueMicrotask);function NB(e,n){return function(){return e.apply(n,arguments)}}const{toString:Ale}=Object.prototype,{getPrototypeOf:yD}=Object,jI=(vD=Object.create(null),e=>{const n=Ale.call(e);return vD[n]||(vD[n]=n.slice(8,-1).toLowerCase())});var vD;const id=e=>(e=e.toLowerCase(),n=>jI(n)===e),BI=e=>n=>typeof n===e,{isArray:av}=Array,FT=BI("undefined"),DB=id("ArrayBuffer"),Ple=BI("string"),dl=BI("function"),LB=BI("number"),WI=e=>e!==null&&typeof e=="object",zI=e=>{if(jI(e)!=="object")return!1;const n=yD(e);return!(n!==null&&n!==Object.prototype&&Object.getPrototypeOf(n)!==null||Symbol.toStringTag in e||ule(e))},Ole=id("Date"),kle=id("File"),Nle=id("Blob"),Dle=id("FileList"),Lle=id("URLSearchParams"),[xle,Mle,Ule,Vle]=["ReadableStream","Request","Response","Headers"].map(id);function jT(e,n){let i,o,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),av(e))for(i=0,o=e.length;i<o;i++)n.call(null,e[i],i,e);else{const u=c?Object.getOwnPropertyNames(e):Object.keys(e),h=u.length;let m;for(i=0;i<h;i++)m=u[i],n.call(null,e[m],m,e)}}function xB(e,n){n=n.toLowerCase();const i=Object.keys(e);let o,c=i.length;for(;c-- >0;)if(o=i[c],n===o.toLowerCase())return o;return null}const m_=wB!==void 0?wB:typeof self<"u"?self:typeof window<"u"?window:eE,MB=e=>!FT(e)&&e!==m_,Fle=(SD=typeof Uint8Array<"u"&&yD(Uint8Array),e=>SD&&e instanceof SD);var SD;const jle=id("HTMLFormElement"),UB=(e=>{let{hasOwnProperty:n}=e;return(i,o)=>n.call(i,o)})(Object.prototype),Ble=id("RegExp"),VB=(e,n)=>{const i=Object.getOwnPropertyDescriptors(e),o={};jT(i,(c,u)=>{let h;(h=n(c,u,e))!==!1&&(o[u]=h||c)}),Object.defineProperties(e,o)},TD="abcdefghijklmnopqrstuvwxyz",FB="0123456789",jB={DIGIT:FB,ALPHA:TD,ALPHA_DIGIT:TD+TD.toUpperCase()+FB},Wle=id("AsyncFunction"),BB=(WB=typeof OB=="function",zB=dl(m_.postMessage),WB?OB:zB?(bD="axios@".concat(Math.random()),GI=[],m_.addEventListener("message",e=>{let{source:n,data:i}=e;n===m_&&i===bD&&GI.length&&GI.shift()()},!1),e=>{GI.push(e),m_.postMessage(bD,"*")}):e=>setTimeout(e));var WB,zB,bD,GI;const zle=kB!==void 0?kB.bind(m_):typeof process<"u"&&process.nextTick||BB;var ct={isArray:av,isArrayBuffer:DB,isBuffer:function(e){return e!==null&&!FT(e)&&e.constructor!==null&&!FT(e.constructor)&&dl(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let n;return e&&(typeof FormData=="function"&&e instanceof FormData||dl(e.append)&&((n=jI(e))==="formdata"||n==="object"&&dl(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let n;return n=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&DB(e.buffer),n},isString:Ple,isNumber:LB,isBoolean:e=>e===!0||e===!1,isObject:WI,isPlainObject:zI,isReadableStream:xle,isRequest:Mle,isResponse:Ule,isHeaders:Vle,isUndefined:FT,isDate:Ole,isFile:kle,isBlob:Nle,isRegExp:Ble,isFunction:dl,isStream:e=>WI(e)&&dl(e.pipe),isURLSearchParams:Lle,isTypedArray:Fle,isFileList:Dle,forEach:jT,merge:function e(){const{caseless:n}=MB(this)&&this||{},i={},o=(c,u)=>{const h=n&&xB(i,u)||u;zI(i[h])&&zI(c)?i[h]=e(i[h],c):zI(c)?i[h]=e({},c):av(c)?i[h]=c.slice():i[h]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&jT(arguments[c],o);return i},extend:function(e,n,i){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return jT(n,(c,u)=>{i&&dl(c)?e[u]=NB(c,i):e[u]=c},{allOwnKeys:o}),e},trim:e=>Ys(e)?Ys(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,n,i,o)=>{e.prototype=Object.create(n.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:n.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,n,i,o)=>{let c,u,h;const m={};if(n=n||{},e==null)return n;do{for(c=Object.getOwnPropertyNames(e),u=c.length;u-- >0;)h=c[u],o&&!o(h,e,n)||m[h]||(n[h]=e[h],m[h]=!0);e=i!==!1&&yD(e)}while(e&&(!i||i(e,n))&&e!==Object.prototype);return n},kindOf:jI,kindOfTest:id,endsWith:(e,n,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=n.length;const o=e.indexOf(n,i);return o!==-1&&o===i},toArray:e=>{if(!e)return null;if(av(e))return e;let n=e.length;if(!LB(n))return null;const i=new Array(n);for(;n-- >0;)i[n]=e[n];return i},forEachEntry:(e,n)=>{const i=(e&&e[Symbol.iterator]).call(e);let o;for(;(o=i.next())&&!o.done;){const c=o.value;n.call(e,c[0],c[1])}},matchAll:(e,n)=>{let i;const o=[];for(;(i=e.exec(n))!==null;)o.push(i);return o},isHTMLForm:jle,hasOwnProperty:UB,hasOwnProp:UB,reduceDescriptors:VB,freezeMethods:e=>{VB(e,(n,i)=>{if(dl(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const o=e[i];dl(o)&&(n.enumerable=!1,"writable"in n?n.writable=!1:n.set||(n.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(e,n)=>{const i={},o=c=>{c.forEach(u=>{i[u]=!0})};return av(e)?o(e):o(String(e).split(n)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,i,o){return i.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(e,n)=>e!=null&&Number.isFinite(e=+e)?e:n,findKey:xB,global:m_,isContextDefined:MB,ALPHABET:jB,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:jB.ALPHA_DIGIT,i="";const{length:o}=n;for(;e--;)i+=n[Math.random()*o|0];return i},isSpecCompliantForm:function(e){return!!(e&&dl(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{const n=new Array(10),i=(o,c)=>{if(WI(o)){if(n.indexOf(o)>=0)return;if(!("toJSON"in o)){n[c]=o;const u=av(o)?[]:{};return jT(o,(h,m)=>{const _=i(h,c+1);!FT(_)&&(u[m]=_)}),n[c]=void 0,u}}return o};return i(e,0)},isAsyncFn:Wle,isThenable:e=>e&&(WI(e)||dl(e))&&dl(e.then)&&dl(e.catch),setImmediate:BB,asap:zle};function Zn(e,n,i,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",n&&(this.code=n),i&&(this.config=i),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}ct.inherits(Zn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ct.toJSONObject(this.config),code:this.code,status:this.status}}});const GB=Zn.prototype,HB={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{HB[e]={value:e}}),Object.defineProperties(Zn,HB),Object.defineProperty(GB,"isAxiosError",{value:!0}),Zn.from=(e,n,i,o,c,u)=>{const h=Object.create(GB);return ct.toFlatObject(e,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),Zn.call(h,e.message,n,i,o,c),h.cause=e,h.name=e.name,u&&Object.assign(h,u),h};function wD(e){return ct.isPlainObject(e)||ct.isArray(e)}function $B(e){return ct.endsWith(e,"[]")?e.slice(0,-2):e}function KB(e,n,i){return e?e.concat(n).map(function(o,c){return o=$B(o),!i&&c?"["+o+"]":o}).join(i?".":""):n}const Gle=ct.toFlatObject(ct,{},null,function(e){return/^is[A-Z]/.test(e)});function HI(e,n,i){if(!ct.isObject(e))throw new TypeError("target must be an object");n=n||new FormData;const o=(i=ct.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(A,k){return!ct.isUndefined(k[A])})).metaTokens,c=i.visitor||y,u=i.dots,h=i.indexes,m=(i.Blob||typeof Blob<"u"&&Blob)&&ct.isSpecCompliantForm(n);if(!ct.isFunction(c))throw new TypeError("visitor must be a function");function _(A){if(A===null)return"";if(ct.isDate(A))return A.toISOString();if(!m&&ct.isBlob(A))throw new Zn("Blob is not supported. Use a Buffer instead.");return ct.isArrayBuffer(A)||ct.isTypedArray(A)?m&&typeof Blob=="function"?new Blob([A]):Buffer.from(A):A}function y(A,k,W){let U=A;if(A&&!W&&typeof A=="object"){if(ct.endsWith(k,"{}"))k=o?k:k.slice(0,-2),A=JSON.stringify(A);else if(ct.isArray(A)&&function(V){return ct.isArray(V)&&!V.some(wD)}(A)||(ct.isFileList(A)||ct.endsWith(k,"[]"))&&(U=ct.toArray(A)))return k=$B(k),U.forEach(function(V,q){!ct.isUndefined(V)&&V!==null&&n.append(h===!0?KB([k],q,u):h===null?k:k+"[]",_(V))}),!1}return!!wD(A)||(n.append(KB(W,k,u),_(A)),!1)}const S=[],w=Object.assign(Gle,{defaultVisitor:y,convertValue:_,isVisitable:wD});if(!ct.isObject(e))throw new TypeError("data must be an object");return function A(k,W){if(!ct.isUndefined(k)){if(S.indexOf(k)!==-1)throw Error("Circular reference detected in "+W.join("."));S.push(k),ct.forEach(k,function(U,V){(!(ct.isUndefined(U)||U===null)&&c.call(n,U,ct.isString(V)?Ys(V).call(V):V,W,w))===!0&&A(U,W?W.concat(V):[V])}),S.pop()}}(e),n}function qB(e){const n={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(i){return n[i]})}function RD(e,n){this._pairs=[],e&&HI(e,this,n)}const YB=RD.prototype;function Hle(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function XB(e,n,i){if(!n)return e;const o=i&&i.encode||Hle;ct.isFunction(i)&&(i={serialize:i});const c=i&&i.serialize;let u;if(u=c?c(n,i):ct.isURLSearchParams(n)?n.toString():new RD(n,i).toString(o),u){const h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}YB.append=function(e,n){this._pairs.push([e,n])},YB.toString=function(e){const n=e?function(i){return e.call(this,i,qB)}:qB;return this._pairs.map(function(i){return n(i[0])+"="+n(i[1])},"").join("&")};var JB=class{constructor(){this.handlers=[]}use(e,n,i){return this.handlers.push({fulfilled:e,rejected:n,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ct.forEach(this.handlers,function(n){n!==null&&e(n)})}},QB={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ZB={exports:{}},$le=xn,Kle=rt,e5=tt.f;$le({target:"Object",stat:!0,forced:Object.defineProperty!==e5,sham:!Kle},{defineProperty:e5});var t5=yt.Object,qle=ZB.exports=function(e,n,i){return t5.defineProperty(e,n,i)};t5.defineProperty.sham&&(qle.sham=!0);var n5=l(ZB.exports),Yle=TypeError,r5=Dg,Xle=n_,Jle=_t,Qle=dr("species"),i5=Array,Zle=function(e){var n;return r5(e)&&(n=e.constructor,(Xle(n)&&(n===i5||r5(n.prototype))||Jle(n)&&(n=n[Qle])===null)&&(n=void 0)),n===void 0?i5:n},s5=function(e,n){return new(Zle(e))(n===0?0:n)},eue=d,tue=ur,nue=dr("species"),o5=function(e){return tue>=51||!eue(function(){var n=[];return(n.constructor={})[nue]=function(){return{foo:1}},n[e](Boolean).foo!==1})},rue=xn,iue=d,sue=Dg,oue=_t,aue=Ro,cue=ii,a5=function(e){if(e>9007199254740991)throw Yle("Maximum allowed index exceeded");return e},c5=SI,lue=s5,uue=o5,due=ur,l5=dr("isConcatSpreadable"),hue=due>=51||!iue(function(){var e=[];return e[l5]=!1,e.concat()[0]!==e}),pue=function(e){if(!oue(e))return!1;var n=e[l5];return n!==void 0?!!n:sue(e)};rue({target:"Array",proto:!0,forced:!hue||!uue("concat")},{concat:function(e){var n,i,o,c,u,h=aue(this),m=lue(h,0),_=0;for(n=-1,o=arguments.length;n<o;n++)if(pue(u=n===-1?h:arguments[n]))for(c=cue(u),a5(_+c),i=0;i<c;i++,_++)i in u&&c5(m,_,u[i]);else a5(_+1),c5(m,_++,u);return m.length=_,m}});var u5={},fue=Z,mue=Re,d5=Wd.f,gue=A1,h5=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];u5.f=function(e){return h5&&fue(e)=="Window"?function(n){try{return d5(n)}catch{return gue(h5)}}(e):d5(mue(e))};var cv={},_ue=dr;cv.f=_ue;var p5=yt,Eue=hi,yue=cv,vue=tt.f,ms=function(e){var n=p5.Symbol||(p5.Symbol={});Eue(n,e)||vue(n,e,{value:yue.f(e)})},Sue=ye,Tue=an,bue=dr,wue=Xu,f5=function(){var e=Tue("Symbol"),n=e&&e.prototype,i=n&&n.valueOf,o=bue("toPrimitive");n&&!n[o]&&wue(n,o,function(c){return Sue(i,this)},{})},Rue=De,Cue=dn,Iue=Ro,Aue=ii,Pue=s5,m5=I([].push),Oue=function(e){var n=e==1,i=e==2,o=e==3,c=e==4,u=e==6,h=e==7,m=e==5||u;return function(_,y,S,w){for(var A,k,W=Iue(_),U=Cue(W),V=Rue(y,S),q=Aue(U),Y=0,ce=w||Pue,_e=n?ce(_,q):i||h?ce(_,0):void 0;q>Y;Y++)if((m||Y in U)&&(k=V(A=U[Y],Y,W),e))if(n)_e[Y]=k;else if(k)switch(e){case 3:return!0;case 5:return A;case 6:return Y;case 2:m5(_e,A)}else switch(e){case 4:return!1;case 7:m5(_e,A)}return u?-1:o||c?c:_e}},g5={forEach:Oue(0)},$I=xn,CD=j,ID=ye,kue=I,lv=rt,uv=oo,Nue=d,fo=hi,Due=N,AD=cn,KI=Re,PD=Ua,Lue=ua,OD=et,BT=Uo,_5=_c,xue=Wd,E5=u5,Mue=gc,y5=He,v5=tt,Uue=YE,S5=Ne,T5=Xu,Vue=Sy,kD=xa,b5=mc,w5=xd,Fue=dr,jue=cv,Bue=ms,Wue=f5,zue=Ju,R5=Yu,qI=g5.forEach,Cc=xg("hidden"),YI="Symbol",WT="prototype",Gue=R5.set,C5=R5.getterFor(YI),sd=Object[WT],g_=CD.Symbol,XI=g_&&g_[WT],Hue=CD.TypeError,ND=CD.QObject,I5=y5.f,__=v5.f,A5=E5.f,$ue=S5.f,P5=kue([].push),Lp=kD("symbols"),zT=kD("op-symbols"),Kue=kD("wks"),DD=!ND||!ND[WT]||!ND[WT].findChild,LD=lv&&Nue(function(){return BT(__({},"a",{get:function(){return __(this,"a",{value:7}).a}})).a!=7})?function(e,n,i){var o=I5(sd,n);o&&delete sd[n],__(e,n,i),o&&e!==sd&&__(sd,n,o)}:__,xD=function(e,n){var i=Lp[e]=BT(XI);return Gue(i,{type:YI,tag:e,description:n}),lv||(i.description=n),i},JI=function(e,n,i){e===sd&&JI(zT,n,i),AD(e);var o=PD(n);return AD(i),fo(Lp,o)?(i.enumerable?(fo(e,Cc)&&e[Cc][o]&&(e[Cc][o]=!1),i=BT(i,{enumerable:OD(0,!1)})):(fo(e,Cc)||__(e,Cc,OD(1,{})),e[Cc][o]=!0),LD(e,o,i)):__(e,o,i)},MD=function(e,n){AD(e);var i=KI(n),o=_5(i).concat(D5(i));return qI(o,function(c){lv&&!ID(O5,i,c)||JI(e,c,i[c])}),e},O5=function(e){var n=PD(e),i=ID($ue,this,n);return!(this===sd&&fo(Lp,n)&&!fo(zT,n))&&(!(i||!fo(this,n)||!fo(Lp,n)||fo(this,Cc)&&this[Cc][n])||i)},k5=function(e,n){var i=KI(e),o=PD(n);if(i!==sd||!fo(Lp,o)||fo(zT,o)){var c=I5(i,o);return!c||!fo(Lp,o)||fo(i,Cc)&&i[Cc][o]||(c.enumerable=!0),c}},N5=function(e){var n=A5(KI(e)),i=[];return qI(n,function(o){fo(Lp,o)||fo(b5,o)||P5(i,o)}),i},D5=function(e){var n=e===sd,i=A5(n?zT:KI(e)),o=[];return qI(i,function(c){!fo(Lp,c)||n&&!fo(sd,c)||P5(o,Lp[c])}),o};uv||(g_=function(){if(Due(XI,this))throw Hue("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?Lue(arguments[0]):void 0,n=w5(e),i=function(o){this===sd&&ID(i,zT,o),fo(this,Cc)&&fo(this[Cc],n)&&(this[Cc][n]=!1),LD(this,n,OD(1,o))};return lv&&DD&&LD(sd,n,{configurable:!0,set:i}),xD(n,e)},T5(XI=g_[WT],"toString",function(){return C5(this).tag}),T5(g_,"withoutSetter",function(e){return xD(w5(e),e)}),S5.f=O5,v5.f=JI,Uue.f=MD,y5.f=k5,xue.f=E5.f=N5,Mue.f=D5,jue.f=function(e){return xD(Fue(e),e)},lv&&Vue(XI,"description",{configurable:!0,get:function(){return C5(this).description}})),$I({global:!0,wrap:!0,forced:!uv,sham:!uv},{Symbol:g_}),qI(_5(Kue),function(e){Bue(e)}),$I({target:YI,stat:!0,forced:!uv},{useSetter:function(){DD=!0},useSimple:function(){DD=!1}}),$I({target:"Object",stat:!0,forced:!uv,sham:!lv},{create:function(e,n){return n===void 0?BT(e):MD(BT(e),n)},defineProperty:JI,defineProperties:MD,getOwnPropertyDescriptor:k5}),$I({target:"Object",stat:!0,forced:!uv},{getOwnPropertyNames:N5}),Wue(),zue(g_,YI),b5[Cc]=!0;var L5=oo&&!!Symbol.for&&!!Symbol.keyFor,que=xn,Yue=an,Xue=hi,Jue=ua,x5=xa,Que=L5,UD=x5("string-to-symbol-registry"),Zue=x5("symbol-to-string-registry");que({target:"Symbol",stat:!0,forced:!Que},{for:function(e){var n=Jue(e);if(Xue(UD,n))return UD[n];var i=Yue("Symbol")(n);return UD[n]=i,Zue[i]=n,i}});var ede=xn,tde=hi,nde=el,rde=ac,ide=L5,M5=xa("symbol-to-string-registry");ede({target:"Symbol",stat:!0,forced:!ide},{keyFor:function(e){if(!nde(e))throw TypeError(rde(e)+" is not a symbol");if(tde(M5,e))return M5[e]}});var U5=Dg,sde=Me,V5=Z,ode=ua,F5=I([].push),ade=xn,j5=an,B5=ee,cde=ye,GT=I,W5=d,z5=Me,G5=el,H5=hs,lde=function(e){if(sde(e))return e;if(U5(e)){for(var n=e.length,i=[],o=0;o<n;o++){var c=e[o];typeof c=="string"?F5(i,c):typeof c!="number"&&V5(c)!="Number"&&V5(c)!="String"||F5(i,ode(c))}var u=i.length,h=!0;return function(m,_){if(h)return h=!1,_;if(U5(this))return _;for(var y=0;y<u;y++)if(i[y]===m)return _}}},ude=oo,dde=String,_m=j5("JSON","stringify"),QI=GT(/./.exec),$5=GT("".charAt),hde=GT("".charCodeAt),pde=GT("".replace),fde=GT(1 .toString),mde=/[\uD800-\uDFFF]/g,K5=/^[\uD800-\uDBFF]$/,q5=/^[\uDC00-\uDFFF]$/,Y5=!ude||W5(function(){var e=j5("Symbol")();return _m([e])!="[null]"||_m({a:e})!="{}"||_m(Object(e))!="{}"}),X5=W5(function(){return _m("\uDF06\uD834")!=='"\\udf06\\ud834"'||_m("\uDEAD")!=='"\\udead"'}),gde=function(e,n){var i=H5(arguments),o=lde(n);if(z5(o)||e!==void 0&&!G5(e))return i[1]=function(c,u){if(z5(o)&&(u=cde(o,this,dde(c),u)),!G5(u))return u},B5(_m,null,i)},_de=function(e,n,i){var o=$5(i,n-1),c=$5(i,n+1);return QI(K5,e)&&!QI(q5,c)||QI(q5,e)&&!QI(K5,o)?"\\u"+fde(hde(e,0),16):e};_m&&ade({target:"JSON",stat:!0,forced:Y5||X5},{stringify:function(e,n,i){var o=H5(arguments),c=B5(Y5?gde:_m,null,o);return X5&&typeof c=="string"?pde(c,mde,_de):c}});var J5=gc,Ede=Ro;xn({target:"Object",stat:!0,forced:!oo||d(function(){J5.f(1)})},{getOwnPropertySymbols:function(e){var n=J5.f;return n?n(Ede(e)):[]}}),ms("asyncIterator"),ms("hasInstance"),ms("isConcatSpreadable"),ms("iterator"),ms("match"),ms("matchAll"),ms("replace"),ms("search"),ms("species"),ms("split");var yde=f5;ms("toPrimitive"),yde();var vde=an,Sde=Ju;ms("toStringTag"),Sde(vde("Symbol"),"Symbol"),ms("unscopables"),Ju(j.JSON,"JSON",!0);var Tde=yt.Symbol,bde=dr,wde=tt.f,Q5=bde("metadata"),Z5=Function.prototype;Z5[Q5]===void 0&&wde(Z5,Q5,{value:null}),ms("dispose"),ms("metadata");var Rde=Tde;ms("asyncDispose");var Cde=I,VD=an("Symbol"),Ide=VD.keyFor,Ade=Cde(VD.prototype.valueOf),e6=VD.isRegisteredSymbol||function(e){try{return Ide(Ade(e))!==void 0}catch{return!1}};xn({target:"Symbol",stat:!0},{isRegisteredSymbol:e6});for(var Pde=xa,t6=an,Ode=I,kde=el,Nde=dr,ZI=t6("Symbol"),n6=ZI.isWellKnownSymbol,r6=t6("Object","getOwnPropertyNames"),Dde=Ode(ZI.prototype.valueOf),i6=Pde("wks"),FD=0,s6=r6(ZI),Lde=s6.length;FD<Lde;FD++)try{var o6=s6[FD];kde(ZI[o6])&&Nde(o6)}catch{}var a6=function(e){if(n6&&n6(e))return!0;try{for(var n=Dde(e),i=0,o=r6(i6),c=o.length;i<c;i++)if(i6[o[i]]==n)return!0}catch{}return!1};xn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:a6}),ms("matcher"),ms("observable"),xn({target:"Symbol",stat:!0},{isRegistered:e6}),xn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:a6}),ms("metadataKey"),ms("patternMatch"),ms("replaceAll");var dv=l(Rde),c6=l(cv.f("iterator"));function HT(e){return HT=typeof dv=="function"&&typeof c6=="symbol"?function(n){return typeof n}:function(n){return n&&typeof dv=="function"&&n.constructor===dv&&n!==dv.prototype?"symbol":typeof n},HT(e)}var xde=l(cv.f("toPrimitive"));function Mde(e){var n=function(i,o){if(HT(i)!=="object"||i===null)return i;var c=i[xde];if(c!==void 0){var u=c.call(i,o);if(HT(u)!=="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(i)}(e,"string");return HT(n)==="symbol"?n:String(n)}function $(e,n,i){return(n=Mde(n))in e?n5(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}var l6=l(gae),Ude={isBrowser:!0,classes:{URLSearchParams:l6!==void 0?l6:RD,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const jD=typeof window<"u"&&typeof document<"u",BD=typeof navigator=="object"&&navigator||void 0,Vde=jD&&(!BD||["ReactNative","NativeScript","NS"].indexOf(BD.product)<0),Fde=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",jde=jD&&window.location.href||"http://localhost";function u6(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function d6(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?u6(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):u6(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Ea=d6(d6({},Object.freeze({__proto__:null,hasBrowserEnv:jD,hasStandardBrowserEnv:Vde,hasStandardBrowserWebWorkerEnv:Fde,navigator:BD,origin:jde})),Ude),Bde=cn,Wde=ye,zde=hi,Gde=N,Hde=function(){var e=Bde(this),n="";return e.hasIndices&&(n+="d"),e.global&&(n+="g"),e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),e.dotAll&&(n+="s"),e.unicode&&(n+="u"),e.unicodeSets&&(n+="v"),e.sticky&&(n+="y"),n},h6=RegExp.prototype,p6=function(e){var n=e.flags;return n!==void 0||"flags"in h6||zde(e,"flags")||!Gde(h6,e)?n:Wde(Hde,e)},$de=b1.charAt,f6=ye,Kde=cn,qde=Me,Yde=Z,Xde=/./.exec,Jde=TypeError,Qde=xn,m6=ye,g6=oe,Zde=py,eA=Ey,_6=qt,E6=Lt,$T=ua,ehe=cn,the=Ut,nhe=Z,rhe=tC,y6=p6,ihe=cc,she=d,ohe=Gi,ahe=function(e,n,i){return n+(i?$de(e,n).length:1)},che=function(e,n){var i=e.exec;if(qde(i)){var o=f6(i,e,n);return o!==null&&Kde(o),o}if(Yde(e)==="RegExp")return f6(Xde,e,n);throw Jde("RegExp#exec called on incompatible receiver")},v6=Yu,lhe=dr("matchAll"),S6="RegExp String",T6=S6+" Iterator",uhe=v6.set,dhe=v6.getterFor(T6),hhe=TypeError,WD=g6("".indexOf),tA=g6("".matchAll),zD=!!tA&&!she(function(){tA("a",/./)}),phe=Zde(function(e,n,i,o){uhe(this,{type:T6,regexp:e,string:n,global:i,unicode:o,done:!1})},S6,function(){var e=dhe(this);if(e.done)return eA(void 0,!0);var n=e.regexp,i=e.string,o=che(n,i);return o===null?(e.done=!0,eA(void 0,!0)):e.global?($T(o[0])===""&&(n.lastIndex=ahe(i,E6(n.lastIndex),e.unicode)),eA(o,!1)):(e.done=!0,eA(o,!1))}),b6=function(e){var n,i,o,c=ehe(this),u=$T(e),h=ohe(c,RegExp),m=$T(y6(c));return n=new h(h===RegExp?c.source:c,m),i=!!~WD(m,"g"),o=!!~WD(m,"u"),n.lastIndex=E6(c.lastIndex),new phe(n,u,i,o)};Qde({target:"String",proto:!0,forced:zD},{matchAll:function(e){var n,i,o,c,u=_6(this);if(the(e)){if(zD)return tA(u,e)}else{if(rhe(e)&&(n=$T(_6(y6(e))),!~WD(n,"g")))throw hhe("`.matchAll` does not allow non-global regexes");if(zD)return tA(u,e);if((o=ihe(e,lhe))===void 0&&nhe(e)=="RegExp"&&(o=b6),o)return m6(o,e,u)}return i=$T(u),c=new RegExp(e,"g"),m6(b6,c,i)}});var fhe=Fa("String").matchAll,mhe=N,ghe=fhe,GD=String.prototype,_he=function(e){var n=e.matchAll;return typeof e=="string"||e===GD||mhe(GD,e)&&n===GD.matchAll?ghe:n},Ehe=l(_he);function w6(e){function n(i,o,c,u){let h=i[u++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),_=u>=i.length;return h=!h&&ct.isArray(c)?c.length:h,_?(ct.hasOwnProp(c,h)?c[h]=[c[h],o]:c[h]=o,!m):(c[h]&&ct.isObject(c[h])||(c[h]=[]),n(i,o,c[h],u)&&ct.isArray(c[h])&&(c[h]=function(y){const S={},w=Object.keys(y);let A;const k=w.length;let W;for(A=0;A<k;A++)W=w[A],S[W]=y[W];return S}(c[h])),!m)}if(ct.isFormData(e)&&ct.isFunction(e.entries)){const i={};return ct.forEachEntry(e,(o,c)=>{n(function(u){return Ehe(ct).call(ct,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(o),c,i,0)}),i}return null}const HD={transitional:QB,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const i=n.getContentType()||"",o=i.indexOf("application/json")>-1,c=ct.isObject(e);if(c&&ct.isHTMLForm(e)&&(e=new FormData(e)),ct.isFormData(e))return o?JSON.stringify(w6(e)):e;if(ct.isArrayBuffer(e)||ct.isBuffer(e)||ct.isStream(e)||ct.isFile(e)||ct.isBlob(e)||ct.isReadableStream(e))return e;if(ct.isArrayBufferView(e))return e.buffer;if(ct.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(c){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return HI(h,new Ea.classes.URLSearchParams,Object.assign({visitor:function(_,y,S,w){return Ea.isNode&&ct.isBuffer(_)?(this.append(y,_.toString("base64")),!1):w.defaultVisitor.apply(this,arguments)}},m))}(e,this.formSerializer).toString();if((u=ct.isFileList(e))||i.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return HI(u?{"files[]":e}:e,h&&new h,this.formSerializer)}}return c||o?(n.setContentType("application/json",!1),function(h,m,_){if(ct.isString(h))try{return(m||JSON.parse)(h),Ys(ct).call(ct,h)}catch(y){if(y.name!=="SyntaxError")throw y}return(_||JSON.stringify)(h)}(e)):e}],transformResponse:[function(e){const n=this.transitional||HD.transitional,i=n&&n.forcedJSONParsing,o=this.responseType==="json";if(ct.isResponse(e)||ct.isReadableStream(e))return e;if(e&&ct.isString(e)&&(i&&!this.responseType||o)){const c=!(n&&n.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(u){if(c)throw u.name==="SyntaxError"?Zn.from(u,Zn.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ea.classes.FormData,Blob:Ea.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ct.forEach(["delete","get","head","post","put","patch"],e=>{HD.headers[e]={}});var $D=HD;const yhe=ct.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),R6=Symbol("internals");function KT(e){var n;return e&&Ys(n=String(e)).call(n).toLowerCase()}function nA(e){return e===!1||e==null?e:ct.isArray(e)?e.map(nA):String(e)}function KD(e,n,i,o,c){return ct.isFunction(o)?o.call(this,n,i):(c&&(n=i),ct.isString(n)?ct.isString(o)?n.indexOf(o)!==-1:ct.isRegExp(o)?o.test(n):void 0:void 0)}class rA{constructor(n){n&&this.set(n)}set(n,i,o){const c=this;function u(_,y,S){const w=KT(y);if(!w)throw new Error("header name must be a non-empty string");const A=ct.findKey(c,w);(!A||c[A]===void 0||S===!0||S===void 0&&c[A]!==!1)&&(c[A||y]=nA(_))}const h=(_,y)=>ct.forEach(_,(S,w)=>u(S,w,y));if(ct.isPlainObject(n)||n instanceof this.constructor)h(n,i);else if(ct.isString(n)&&(n=Ys(n).call(n))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Ys(m=n).call(m)))h((_=>{const y={};let S,w,A;return _&&_.split(`
`).forEach(function(k){var W,U;A=k.indexOf(":"),S=Ys(W=k.substring(0,A)).call(W).toLowerCase(),w=Ys(U=k.substring(A+1)).call(U),!S||y[S]&&yhe[S]||(S==="set-cookie"?y[S]?y[S].push(w):y[S]=[w]:y[S]=y[S]?y[S]+", "+w:w)}),y})(n),i);else if(ct.isHeaders(n))for(const[_,y]of n.entries())u(y,_,o);else n!=null&&u(i,n,o);var m;return this}get(n,i){if(n=KT(n)){const o=ct.findKey(this,n);if(o){const c=this[o];if(!i)return c;if(i===!0)return function(u){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=m.exec(u);)h[_[1]]=_[2];return h}(c);if(ct.isFunction(i))return i.call(this,c,o);if(ct.isRegExp(i))return i.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(n,i){if(n=KT(n)){const o=ct.findKey(this,n);return!(!o||this[o]===void 0||i&&!KD(0,this[o],o,i))}return!1}delete(n,i){const o=this;let c=!1;function u(h){if(h=KT(h)){const m=ct.findKey(o,h);!m||i&&!KD(0,o[m],m,i)||(delete o[m],c=!0)}}return ct.isArray(n)?n.forEach(u):u(n),c}clear(n){const i=Object.keys(this);let o=i.length,c=!1;for(;o--;){const u=i[o];n&&!KD(0,this[u],u,n,!0)||(delete this[u],c=!0)}return c}normalize(n){const i=this,o={};return ct.forEach(this,(c,u)=>{var h;const m=ct.findKey(o,u);if(m)return i[m]=nA(c),void delete i[u];const _=n?function(y){return Ys(y).call(y).toLowerCase().replace(/([a-z\d])(\w*)/g,(S,w,A)=>w.toUpperCase()+A)}(u):Ys(h=String(u)).call(h);_!==u&&delete i[u],i[_]=nA(c),o[_]=!0}),this}concat(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return this.constructor.concat(this,...i)}toJSON(n){const i=Object.create(null);return ct.forEach(this,(o,c)=>{o!=null&&o!==!1&&(i[c]=n&&ct.isArray(o)?o.join(", "):o)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(n=>{let[i,o]=n;return i+": "+o}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(n){return n instanceof this?n:new this(n)}static concat(n){const i=new this(n);for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c.forEach(h=>i.set(h)),i}static accessor(n){const i=(this[R6]=this[R6]={accessors:{}}).accessors,o=this.prototype;function c(u){const h=KT(u);i[h]||(function(m,_){const y=ct.toCamelCase(" "+_);["get","set","has"].forEach(S=>{Object.defineProperty(m,S+y,{value:function(w,A,k){return this[S].call(this,_,w,A,k)},configurable:!0})})}(o,u),i[h]=!0)}return ct.isArray(n)?n.forEach(c):c(n),this}}rA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ct.reduceDescriptors(rA.prototype,(e,n)=>{let{value:i}=e,o=n[0].toUpperCase()+n.slice(1);return{get:()=>i,set(c){this[o]=c}}}),ct.freezeMethods(rA);var od=rA;function qD(e,n){const i=this||$D,o=n||i,c=od.from(o.headers);let u=o.data;return ct.forEach(e,function(h){u=h.call(i,u,c.normalize(),n?n.status:void 0)}),c.normalize(),u}function C6(e){return!(!e||!e.__CANCEL__)}function hv(e,n,i){Zn.call(this,e??"canceled",Zn.ERR_CANCELED,n,i),this.name="CanceledError"}function I6(e,n,i){const o=i.config.validateStatus;i.status&&o&&!o(i.status)?n(new Zn("Request failed with status code "+i.status,[Zn.ERR_BAD_REQUEST,Zn.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}ct.inherits(hv,Zn,{__CANCEL__:!0});const iA=function(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const c=function(u,h){u=u||10;const m=new Array(u),_=new Array(u);let y,S=0,w=0;return h=h!==void 0?h:1e3,function(A){const k=Date.now(),W=_[w];y||(y=k),m[S]=A,_[S]=k;let U=w,V=0;for(;U!==S;)V+=m[U++],U%=u;if(S=(S+1)%u,S===w&&(w=(w+1)%u),k-y<h)return;const q=W&&k-W;return q?Math.round(1e3*V/q):void 0}}(50,250);return function(u,h){let m,_,y=0,S=1e3/h;const w=function(A){y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,_&&(clearTimeout(_),_=null),u.apply(null,A)};return[function(){const A=Date.now(),k=A-y;for(var W=arguments.length,U=new Array(W),V=0;V<W;V++)U[V]=arguments[V];k>=S?w(U,A):(m=U,_||(_=setTimeout(()=>{_=null,w(m)},S-k)))},()=>m&&w(m)]}(u=>{const h=u.loaded,m=u.lengthComputable?u.total:void 0,_=h-o,y=c(_);o=h,e({loaded:h,total:m,progress:m?h/m:void 0,bytes:_,rate:y||void 0,estimated:y&&m&&h<=m?(m-h)/y:void 0,event:u,lengthComputable:m!=null,[n?"download":"upload"]:!0})},i)},A6=(e,n)=>{const i=e!=null;return[o=>n[0]({lengthComputable:i,total:e,loaded:o}),n[1]]},P6=e=>function(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return ct.asap(()=>e(...i))};var vhe=Ea.hasStandardBrowserEnv?((e,n)=>i=>(i=new DI(i,Ea.origin),e.protocol===i.protocol&&e.host===i.host&&(n||e.port===i.port)))(new DI(Ea.origin),Ea.navigator&&/(msie|trident)/i.test(Ea.navigator.userAgent)):()=>!0,She=Ea.hasStandardBrowserEnv?{write(e,n,i,o,c,u){const h=[e+"="+encodeURIComponent(n)];ct.isNumber(i)&&h.push("expires="+new Date(i).toGMTString()),ct.isString(o)&&h.push("path="+o),ct.isString(c)&&h.push("domain="+c),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read(e){const n=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function O6(e,n){return e&&!function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}(n)?function(i,o){return o?i.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):i}(e,n):n}function k6(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}const N6=e=>e instanceof od?function(n){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?k6(Object(o),!0).forEach(function(c){$(n,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):k6(Object(o)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(o,c))})}return n}({},e):e;function E_(e,n){n=n||{};const i={};function o(y,S,w,A){return ct.isPlainObject(y)&&ct.isPlainObject(S)?ct.merge.call({caseless:A},y,S):ct.isPlainObject(S)?ct.merge({},S):ct.isArray(S)?S.slice():S}function c(y,S,w,A){return ct.isUndefined(S)?ct.isUndefined(y)?void 0:o(void 0,y,0,A):o(y,S,0,A)}function u(y,S){if(!ct.isUndefined(S))return o(void 0,S)}function h(y,S){return ct.isUndefined(S)?ct.isUndefined(y)?void 0:o(void 0,y):o(void 0,S)}function m(y,S,w){return w in n?o(y,S):w in e?o(void 0,y):void 0}const _={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(y,S,w)=>c(N6(y),N6(S),0,!0)};return ct.forEach(Object.keys(Object.assign({},e,n)),function(y){const S=_[y]||c,w=S(e[y],n[y],y);ct.isUndefined(w)&&S!==m||(i[y]=w)}),i}var D6=e=>{const n=E_({},e);let i,{data:o,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:h,headers:m,auth:_}=n;if(n.headers=m=od.from(m),n.url=XB(O6(n.baseURL,n.url),e.params,e.paramsSerializer),_&&m.set("Authorization","Basic "+btoa((_.username||"")+":"+(_.password?unescape(encodeURIComponent(_.password)):""))),ct.isFormData(o)){if(Ea.hasStandardBrowserEnv||Ea.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((i=m.getContentType())!==!1){const[y,...S]=i?i.split(";").map(w=>Ys(w).call(w)).filter(Boolean):[];m.setContentType([y||"multipart/form-data",...S].join("; "))}}if(Ea.hasStandardBrowserEnv&&(c&&ct.isFunction(c)&&(c=c(n)),c||c!==!1&&vhe(n.url))){const y=u&&h&&She.read(h);y&&m.set(u,y)}return n},The=typeof XMLHttpRequest<"u"&&function(e){return new lt(function(n,i){const o=D6(e);let c=o.data;const u=od.from(o.headers).normalize();let h,m,_,y,S,{responseType:w,onUploadProgress:A,onDownloadProgress:k}=o;function W(){y&&y(),S&&S(),o.cancelToken&&o.cancelToken.unsubscribe(h),o.signal&&o.signal.removeEventListener("abort",h)}let U=new XMLHttpRequest;function V(){if(!U)return;const Y=od.from("getAllResponseHeaders"in U&&U.getAllResponseHeaders());I6(function(ce){n(ce),W()},function(ce){i(ce),W()},{data:w&&w!=="text"&&w!=="json"?U.response:U.responseText,status:U.status,statusText:U.statusText,headers:Y,config:e,request:U}),U=null}U.open(o.method.toUpperCase(),o.url,!0),U.timeout=o.timeout,"onloadend"in U?U.onloadend=V:U.onreadystatechange=function(){U&&U.readyState===4&&(U.status!==0||U.responseURL&&U.responseURL.indexOf("file:")===0)&&setTimeout(V)},U.onabort=function(){U&&(i(new Zn("Request aborted",Zn.ECONNABORTED,e,U)),U=null)},U.onerror=function(){i(new Zn("Network Error",Zn.ERR_NETWORK,e,U)),U=null},U.ontimeout=function(){let Y=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const ce=o.transitional||QB;o.timeoutErrorMessage&&(Y=o.timeoutErrorMessage),i(new Zn(Y,ce.clarifyTimeoutError?Zn.ETIMEDOUT:Zn.ECONNABORTED,e,U)),U=null},c===void 0&&u.setContentType(null),"setRequestHeader"in U&&ct.forEach(u.toJSON(),function(Y,ce){U.setRequestHeader(ce,Y)}),ct.isUndefined(o.withCredentials)||(U.withCredentials=!!o.withCredentials),w&&w!=="json"&&(U.responseType=o.responseType),k&&([_,S]=iA(k,!0),U.addEventListener("progress",_)),A&&U.upload&&([m,y]=iA(A),U.upload.addEventListener("progress",m),U.upload.addEventListener("loadend",y)),(o.cancelToken||o.signal)&&(h=Y=>{U&&(i(!Y||Y.type?new hv(null,e,U):Y),U.abort(),U=null)},o.cancelToken&&o.cancelToken.subscribe(h),o.signal&&(o.signal.aborted?h():o.signal.addEventListener("abort",h)));const q=function(Y){const ce=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Y);return ce&&ce[1]||""}(o.url);q&&Ea.protocols.indexOf(q)===-1?i(new Zn("Unsupported protocol "+q+":",Zn.ERR_BAD_REQUEST,e)):U.send(c||null)})},bhe=(e,n)=>{const{length:i}=e=e?e.filter(Boolean):[];if(n||i){let o,c=new AbortController;const u=function(y){if(!o){o=!0,m();const S=y instanceof Error?y:this.reason;c.abort(S instanceof Zn?S:new hv(S instanceof Error?S.message:S))}};let h=n&&setTimeout(()=>{h=null,u(new Zn("timeout ".concat(n," of ms exceeded"),Zn.ETIMEDOUT))},n);const m=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach(y=>{y.unsubscribe?y.unsubscribe(u):y.removeEventListener("abort",u)}),e=null)};e.forEach(y=>y.addEventListener("abort",u));const{signal:_}=c;return _.unsubscribe=()=>ct.asap(m),_}},whe=R4,Rhe=ul;xn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=Rhe.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var Che=ul,Ihe=Zd;xn({target:"Promise",stat:!0,forced:!0},{try:function(e){var n=Che.f(this),i=Ihe(e);return(i.error?n.reject:n.resolve)(i.value),n.promise}});var YD=l(whe),L6=cv.f("asyncIterator"),Ahe=l(L6);function XD(e,n){this.v=e,this.k=n}function qT(e){var n,i;function o(u,h){try{var m=e[u](h),_=m.value,y=_ instanceof XD;YD.resolve(y?_.v:_).then(function(S){if(y){var w=u==="return"?"return":"next";if(!_.k||S.done)return o(w,S);S=e[w](S).value}c(m.done?"return":"normal",S)},function(S){o("throw",S)})}catch(S){c("throw",S)}}function c(u,h){switch(u){case"return":n.resolve({value:h,done:!0});break;case"throw":n.reject(h);break;default:n.resolve({value:h,done:!1})}(n=n.next)?o(n.key,n.arg):i=null}this._invoke=function(u,h){return new YD(function(m,_){var y={key:u,arg:h,resolve:m,reject:_,next:null};i?i=i.next=y:(n=i=y,o(u,h))})},typeof e.return!="function"&&(this.return=void 0)}function hl(e){return function(){return new qT(e.apply(this,arguments))}}function wn(e){return new XD(e,0)}function sA(e){var n={},i=!1;function o(c,u){return i=!0,{done:!1,value:new XD(u=new YD(function(h){h(e[c](u))}),1)}}return n[dv!==void 0&&c6||"@@iterator"]=function(){return this},n.next=function(c){return i?(i=!1,c):o("next",c)},typeof e.throw=="function"&&(n.throw=function(c){if(i)throw i=!1,c;return o("throw",c)}),typeof e.return=="function"&&(n.return=function(c){return i?(i=!1,c):o("return",c)}),n}qT.prototype[typeof dv=="function"&&Ahe||"@@asyncIterator"]=function(){return this},qT.prototype.next=function(e){return this._invoke("next",e)},qT.prototype.throw=function(e){return this._invoke("throw",e)},qT.prototype.return=function(e){return this._invoke("return",e)};var JD=l(L6);function QD(e){var n,i,o,c=2;for(typeof Symbol<"u"&&(i=JD,o=Symbol.iterator);c--;){if(i&&(n=e[i])!=null)return n.call(e);if(o&&(n=e[o])!=null)return new oA(n.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function oA(e){function n(i){if(Object(i)!==i)return lt.reject(new TypeError(i+" is not an object."));var o=i.done;return lt.resolve(i.value).then(function(c){return{value:c,done:o}})}return oA=function(i){this.s=i,this.n=i.next},oA.prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?lt.resolve({value:i,done:!0}):n(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?lt.reject(i):n(o.apply(this.s,arguments))}},new oA(e)}const Phe=function*(e,n){let i=e.byteLength;if(!n||i<n)return void(yield e);let o,c=0;for(;c<i;)o=c+n,yield e.slice(c,o),c=o},Ohe=function(){var e=hl(function*(n,i){var o,c=!1,u=!1;try{for(var h,m=QD(khe(n));c=!(h=yield wn(m.next())).done;c=!1){const _=h.value;yield*sA(QD(Phe(_,i)))}}catch(_){u=!0,o=_}finally{try{c&&m.return!=null&&(yield wn(m.return()))}finally{if(u)throw o}}});return function(n,i){return e.apply(this,arguments)}}(),khe=function(){var e=hl(function*(n){if(n[JD])return void(yield*sA(QD(n)));const i=n.getReader();try{for(;;){const{done:o,value:c}=yield wn(i.read());if(o)break;yield c}}finally{yield wn(i.cancel())}});return function(n){return e.apply(this,arguments)}}(),x6=(e,n,i,o)=>{const c=Ohe(e,n);let u,h=0,m=_=>{u||(u=!0,o&&o(_))};return new ReadableStream({async pull(_){try{const{done:y,value:S}=await c.next();if(y)return m(),void _.close();let w=S.byteLength;if(i){let A=h+=w;i(A)}_.enqueue(new Uint8Array(S))}catch(y){throw m(y),y}},cancel:_=>(m(_),c.return())},{highWaterMark:2})};function M6(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function U6(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?M6(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):M6(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const aA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",V6=aA&&typeof ReadableStream=="function",Nhe=aA&&(typeof TextEncoder=="function"?(F6=new TextEncoder,e=>F6.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var F6;const j6=function(e){try{for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return!!e(...i)}catch{return!1}},Dhe=V6&&j6(()=>{let e=!1;const n=new Request(Ea.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!n}),ZD=V6&&j6(()=>ct.isReadableStream(new Response("").body)),cA={stream:ZD&&(e=>e.body)};var B6;aA&&(B6=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!cA[e]&&(cA[e]=ct.isFunction(B6[e])?n=>n[e]():(n,i)=>{throw new Zn("Response type '".concat(e,"' is not supported"),Zn.ERR_NOT_SUPPORT,i)})}));const Lhe=async(e,n)=>{const i=ct.toFiniteNumber(e.getContentLength());return i??(async o=>o==null?0:ct.isBlob(o)?o.size:ct.isSpecCompliantForm(o)?(await new Request(Ea.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:ct.isArrayBufferView(o)||ct.isArrayBuffer(o)?o.byteLength:(ct.isURLSearchParams(o)&&(o+=""),ct.isString(o)?(await Nhe(o)).byteLength:void 0))(n)};var xhe=aA&&(async e=>{let{url:n,method:i,data:o,signal:c,cancelToken:u,timeout:h,onDownloadProgress:m,onUploadProgress:_,responseType:y,headers:S,withCredentials:w="same-origin",fetchOptions:A}=D6(e);y=y?(y+"").toLowerCase():"text";let k,W=bhe([c,u&&u.toAbortSignal()],h);const U=W&&W.unsubscribe&&(()=>{W.unsubscribe()});let V;try{if(_&&Dhe&&i!=="get"&&i!=="head"&&(V=await Lhe(S,o))!==0){let Ee,me=new Request(n,{method:"POST",body:o,duplex:"half"});if(ct.isFormData(o)&&(Ee=me.headers.get("content-type"))&&S.setContentType(Ee),me.body){const[ke,Ye]=A6(V,iA(P6(_)));o=x6(me.body,65536,ke,Ye)}}ct.isString(w)||(w=w?"include":"omit");const q="credentials"in Request.prototype;k=new Request(n,U6(U6({},A),{},{signal:W,method:i.toUpperCase(),headers:S.normalize().toJSON(),body:o,duplex:"half",credentials:q?w:void 0}));let Y=await fetch(k);const ce=ZD&&(y==="stream"||y==="response");if(ZD&&(m||ce&&U)){const Ee={};["status","statusText","headers"].forEach(ut=>{Ee[ut]=Y[ut]});const me=ct.toFiniteNumber(Y.headers.get("content-length")),[ke,Ye]=m&&A6(me,iA(P6(m),!0))||[];Y=new Response(x6(Y.body,65536,ke,()=>{Ye&&Ye(),U&&U()}),Ee)}y=y||"text";let _e=await cA[ct.findKey(cA,y)||"text"](Y,e);return!ce&&U&&U(),await new lt((Ee,me)=>{I6(Ee,me,{data:_e,headers:od.from(Y.headers),status:Y.status,statusText:Y.statusText,config:e,request:k})})}catch(q){throw U&&U(),q&&q.name==="TypeError"&&/fetch/i.test(q.message)?Object.assign(new Zn("Network Error",Zn.ERR_NETWORK,e,k),{cause:q.cause||q}):Zn.from(q,q&&q.code,e,k)}});const eL={http:null,xhr:The,fetch:xhe};ct.forEach(eL,(e,n)=>{if(e){try{Object.defineProperty(e,"name",{value:n})}catch{}Object.defineProperty(e,"adapterName",{value:n})}});const W6=e=>"- ".concat(e),Mhe=e=>ct.isFunction(e)||e===null||e===!1;var z6={getAdapter:e=>{e=ct.isArray(e)?e:[e];const{length:n}=e;let i,o;const c={};for(let u=0;u<n;u++){let h;if(i=e[u],o=i,!Mhe(i)&&(o=eL[(h=String(i)).toLowerCase()],o===void 0))throw new Zn("Unknown adapter '".concat(h,"'"));if(o)break;c[h||"#"+u]=o}if(!o){const u=Object.entries(c).map(h=>{let[m,_]=h;return"adapter ".concat(m," ")+(_===!1?"is not supported by the environment":"is not available in the build")});throw new Zn("There is no suitable adapter to dispatch the request "+(n?u.length>1?`since :
`+u.map(W6).join(`
`):" "+W6(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:eL};function tL(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new hv(null,e)}function G6(e){return tL(e),e.headers=od.from(e.headers),e.data=qD.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),z6.getAdapter(e.adapter||$D.adapter)(e).then(function(n){return tL(e),n.data=qD.call(e,e.transformResponse,n),n.headers=od.from(n.headers),n},function(n){return C6(n)||(tL(e),n&&n.response&&(n.response.data=qD.call(e,e.transformResponse,n.response),n.response.headers=od.from(n.response.headers))),lt.reject(n)})}const H6="1.7.9",lA={};["object","boolean","number","function","string","symbol"].forEach((e,n)=>{lA[e]=function(i){return typeof i===e||"a"+(n<1?"n ":" ")+e}});const $6={};lA.transitional=function(e,n,i){function o(c,u){return"[Axios v"+H6+"] Transitional option '"+c+"'"+u+(i?". "+i:"")}return(c,u,h)=>{if(e===!1)throw new Zn(o(u," has been removed"+(n?" in "+n:"")),Zn.ERR_DEPRECATED);return n&&!$6[u]&&($6[u]=!0,console.warn(o(u," has been deprecated since v"+n+" and will be removed in the near future"))),!e||e(c,u,h)}},lA.spelling=function(e){return(n,i)=>(console.warn("".concat(i," is likely a misspelling of ").concat(e)),!0)};var uA={assertOptions:function(e,n,i){if(typeof e!="object")throw new Zn("options must be an object",Zn.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let c=o.length;for(;c-- >0;){const u=o[c],h=n[u];if(h){const m=e[u],_=m===void 0||h(m,u,e);if(_!==!0)throw new Zn("option "+u+" must be "+_,Zn.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new Zn("Unknown option "+u,Zn.ERR_BAD_OPTION)}},validators:lA};const sh=uA.validators;let dA=class{constructor(e){this.defaults=e,this.interceptors={request:new JB,response:new JB}}async request(e,n){try{return await this._request(e,n)}catch(i){if(i instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const c=o.stack?o.stack.replace(/^.+\n/,""):"";try{i.stack?c&&!String(i.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+c):i.stack=c}catch{}}throw i}}_request(e,n){typeof e=="string"?(n=n||{}).url=e:n=e||{},n=E_(this.defaults,n);const{transitional:i,paramsSerializer:o,headers:c}=n;i!==void 0&&uA.assertOptions(i,{silentJSONParsing:sh.transitional(sh.boolean),forcedJSONParsing:sh.transitional(sh.boolean),clarifyTimeoutError:sh.transitional(sh.boolean)},!1),o!=null&&(ct.isFunction(o)?n.paramsSerializer={serialize:o}:uA.assertOptions(o,{encode:sh.function,serialize:sh.function},!0)),uA.assertOptions(n,{baseUrl:sh.spelling("baseURL"),withXsrfToken:sh.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let u=c&&ct.merge(c.common,c[n.method]);c&&ct.forEach(["delete","get","head","post","put","patch","common"],k=>{delete c[k]}),n.headers=od.concat(u,c);const h=[];let m=!0;this.interceptors.request.forEach(function(k){typeof k.runWhen=="function"&&k.runWhen(n)===!1||(m=m&&k.synchronous,h.unshift(k.fulfilled,k.rejected))});const _=[];let y;this.interceptors.response.forEach(function(k){_.push(k.fulfilled,k.rejected)});let S,w=0;if(!m){const k=[G6.bind(this),void 0];for(k.unshift.apply(k,h),k.push.apply(k,_),S=k.length,y=lt.resolve(n);w<S;)y=y.then(k[w++],k[w++]);return y}S=h.length;let A=n;for(w=0;w<S;){const k=h[w++],W=h[w++];try{A=k(A)}catch(U){W.call(this,U);break}}try{y=G6.call(this,A)}catch(k){return lt.reject(k)}for(w=0,S=_.length;w<S;)y=y.then(_[w++],_[w++]);return y}getUri(e){return XB(O6((e=E_(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};ct.forEach(["delete","get","head","options"],function(e){dA.prototype[e]=function(n,i){return this.request(E_(i||{},{method:e,url:n,data:(i||{}).data}))}}),ct.forEach(["post","put","patch"],function(e){function n(i){return function(o,c,u){return this.request(E_(u||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}dA.prototype[e]=n(),dA.prototype[e+"Form"]=n(!0)});var hA=dA;class nL{constructor(n){if(typeof n!="function")throw new TypeError("executor must be a function.");let i;this.promise=new lt(function(c){i=c});const o=this;this.promise.then(c=>{if(!o._listeners)return;let u=o._listeners.length;for(;u-- >0;)o._listeners[u](c);o._listeners=null}),this.promise.then=c=>{let u;const h=new lt(m=>{o.subscribe(m),u=m}).then(c);return h.cancel=function(){o.unsubscribe(u)},h},n(function(c,u,h){o.reason||(o.reason=new hv(c,u,h),i(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(n){this.reason?n(this.reason):this._listeners?this._listeners.push(n):this._listeners=[n]}unsubscribe(n){if(!this._listeners)return;const i=this._listeners.indexOf(n);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const n=new AbortController,i=o=>{n.abort(o)};return this.subscribe(i),n.signal.unsubscribe=()=>this.unsubscribe(i),n.signal}static source(){let n;return{token:new nL(function(o){n=o}),cancel:n}}}var Uhe=nL;const rL={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(rL).forEach(e=>{let[n,i]=e;rL[i]=n});var Vhe=rL;const Fs=function e(n){const i=new hA(n),o=NB(hA.prototype.request,i);return ct.extend(o,hA.prototype,i,{allOwnKeys:!0}),ct.extend(o,i,null,{allOwnKeys:!0}),o.create=function(c){return e(E_(n,c))},o}($D);Fs.Axios=hA,Fs.CanceledError=hv,Fs.CancelToken=Uhe,Fs.isCancel=C6,Fs.VERSION=H6,Fs.toFormData=HI,Fs.AxiosError=Zn,Fs.Cancel=Fs.CanceledError,Fs.all=function(e){return lt.all(e)},Fs.spread=function(e){return function(n){return e.apply(null,n)}},Fs.isAxiosError=function(e){return ct.isObject(e)&&e.isAxiosError===!0},Fs.mergeConfig=E_,Fs.AxiosHeaders=od,Fs.formToJSON=e=>w6(ct.isHTMLForm(e)?new FormData(e):e),Fs.getAdapter=z6.getAdapter,Fs.HttpStatusCode=Vhe,Fs.default=Fs;var Wo=Fs;const Fhe=()=>{};function YT(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Fhe};return e.promise=new lt((n,i)=>{e.resolve=o=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,n(o),e.value=o)},e.reject=o=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,i(o))}}),e}const pA=new Map,fA=new Map,oh=new Map;let Ni=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Mn=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const K6=new nle;let ad=K6.getResult(),iL=null;function Rn(e){if(!iL){ad=K6.getResult();const n=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Mn.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Mn.CHROME;case"Safari":case"Mobile Safari":return Mn.SAFARI;case"Edge":return Mn.EDGE;case"Firefox":return Mn.FIREFOX;case"QQ":case"QQBrowser":return Mn.QQ;case"Opera":return Mn.OPERA;case"WeChat":return Mn.WECHAT;default:return m.browser.name||""}}(ad),i=q6(ad),o=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(ad),c=ad.os.version,u=q6(ad,!1),h=ad.device.type;if(!(n&&i&&o&&c))return{name:n,version:i,os:o,osVersion:c,browserVersion:u,deviceType:h};iL={name:n,version:i,os:o,osVersion:c,browserVersion:u,deviceType:h}}return iL}function q6(e){let n,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return n=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",i?n.split(".")[0]:n}function mA(){return Rn().os}function Y6(){const e=Rn();return"".concat(e.os," ").concat(e.osVersion)}function gA(){const e=Rn();return!!(ad.engine.name==="WebKit"&&e.os===Ni.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Mn.SAFARI||mo()&&e.name!==Mn.SAFARI)}function xp(){return Rn().name===Mn.CHROME}function gs(){return Rn().name===Mn.SAFARI}function X6(){return Rn().name===Mn.EDGE}function Nr(){return Rn().name===Mn.FIREFOX}function mo(){return Rn().os===Ni.IOS}function XT(e){const n=Rn();return!(n.name!==Mn.CHROME||!n.osVersion)&&Number(n.version)>=e}function J6(e){const n=Rn();return!(n.name!==Mn.CHROME||!n.osVersion)&&Number(n.version)<e}function sL(e,n,i){const o=Rn();return!(o.name!==e||!o.osVersion)&&(i?Number(o.version)>=n&&Number(o.version)<=i:Number(o.version)===n)}function oL(e){const n=Rn();return!(n.name!==Mn.EDGE||!n.osVersion)&&Number(n.version)>=e}function Q6(e){const n=Rn();return!(n.name!==Mn.SAFARI||!n.osVersion)&&Number(n.version)>=e}function Z6(e,n,i){const o=Rn();if(o.os!==Ni.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return n&&Number(c[0])===e&&Number(c[1])<n||Number(c[0])<e}function eW(e,n,i){const o=Rn();if(o.name!==Mn.SAFARI||!o.osVersion||!o.browserVersion)return!1;const c=o.browserVersion.split(".");return i?n&&Number(c[0])===e&&Number(c[1])<n||Number(c[0])<e:n?Number(c[0])===e&&Number(c[1])<=n||Number(c[0])<e:Number(c[0])<=e}function aL(e){const n=Rn();return!(n.name!==Mn.OPERA||!n.osVersion)&&Number(n.version)>=e}function tW(){const e=Rn();if(e.os!==Ni.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])<14||Number(n[0])===14&&Number(n[1])<=6}function pv(){const e=Rn();if(e.os!==Ni.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])===15}function cL(){const e=Rn();if(e.os!==Ni.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])===16}function nW(){const e=Rn();if(e.os!==Ni.IOS||!e.osVersion)return!1;const n=e.osVersion.split(".");return Number(n[0])===15&&Number(n[1])>=1}function tu(){return gs()&&navigator.maxTouchPoints>0}function rW(){return Rn().name===Mn.WECHAT}function iW(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function lL(){const e=mA();return function(){const{deviceType:n}=Rn();return n==="mobile"||n==="tablet"}()||e===Ni.ANDROID||e===Ni.IOS||e===Ni.HARMONY_OS}function Mp(){const e=Rn();return e.name!==Mn.EDGE&&e.name!==Mn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function _A(){return mA()===Ni.ANDROID}function JT(){const e=Rn();return _A()&&(e.name===Mn.CHROME||e.name===Mn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function sW(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function ft(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?sW(Object(i),!0).forEach(function(o){Wt(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):sW(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Wt(e,n,i){return(n=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(n))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}let X=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Le=class extends Error{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(n),Wt(this,"code",void 0),Wt(this,"message",void 0),Wt(this,"data",void 0),Wt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",n=arguments.length>1?arguments[1]:void 0;return e==="error"&&(n||console).error(this.toString()),e==="warning"&&(n||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Up(e,n){if(typeof e!="boolean")throw new Le(X.INVALID_PARAMS,"Invalid ".concat(n,": The value is of the boolean type."))}function Ci(e,n,i){if(!ot(i).call(i,e))throw new Le(X.INVALID_PARAMS,"".concat(n," can only be set as ").concat(JSON.stringify(i)))}function er(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<i||e>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new Le(X.INVALID_PARAMS,"invalid ".concat(n,": the value range is [").concat(i,", ").concat(o,"]. integer only"))}function uL(e,n){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Le(X.INVALID_PARAMS,"".concat(n," is not a valid ConstrainLong"));e.min!==void 0&&er(e.min,"".concat(n,".min"),0,1/0),e.max!==void 0&&er(e.max,"".concat(n,".max"),1,1/0),e.exact!==void 0&&er(e.exact,"".concat(n,".exact"),1,1/0),e.ideal!==void 0&&er(e.ideal,"".concat(n,".ideal"),1,1/0)}else er(e,n,1,1/0)}function Zi(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Le(X.INVALID_PARAMS,"".concat(n||"param"," cannot be empty"));if(!oW(e,i,o,c))throw new Le(X.INVALID_PARAMS,"Invalid ".concat(n||"string param",": Length of the string: [").concat(i,",").concat(o,"].").concat(c?" ASCII characters only.":""))}function Vp(e,n){if(!Array.isArray(e))throw new Le(X.INVALID_PARAMS,"".concat(n," should be an array"))}function Dr(e){return e==null}function oW(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=i&&e.length>=n&&(!o||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(e))}var QT=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(QT||{}),dL=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(dL||{});const aW=new class{constructor(){Wt(this,"_clientSize",null),Wt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Wt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Wt(this,"getStyle",e=>window.getComputedStyle(e,null)),Wt(this,"checkCssVisibleProperty",e=>{var n;let i=!0;const o=this.getStyle(e),{display:c,visibility:u,opacity:h,filter:m}=o;return(c==="none"||ot(n=["hidden","collapse"]).call(n,u)||Number(h)<.1)&&(i=!1),!!i&&(m&&m.split(" ").filter(_=>{var y;const S=_.split("(")[0];return ot(y=["brightness","blur","opacity"]).call(y,S)}).map(_=>{const[y,S]=_.split(/\(|\)/);return[y,Number(S.match(/^[0-9\.]+/))]}).forEach(_=>{const[y,S]=_;switch(y){case"brightness":(S<.1||S>3)&&(i=!1);break;case"blur":S>3&&(i=!1);break;case"opacity":S<.1&&(i=!1)}}),i)}),Wt(this,"checkPropertyUpToAllParentNodes",(e,n)=>{let i=!0,o=!0;const c=h=>n(h);let u=e;for(;u&&o;)c(u)||(i=!1,o=!1),u=u.parentElement,u||(o=!1);return i}),Wt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Wt(this,"getSizeAboutClient",e=>{const{width:n,height:i,left:o,right:c,top:u,bottom:h}=e.getBoundingClientRect(),m=this.getClientWidth(),_=this.getClientHeight();return{width:n,height:i,left:o,right:c,top:u,bottom:h,clientWidth:m,clientHeight:_,clientMin:Math.min(m,_)}}),Wt(this,"checkActualSize",()=>{const{width:e,height:n,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(e,n,i)}),Wt(this,"elementFromPoint",(e,n)=>document.elementFromPoint?document.elementFromPoint(e,n):null),Wt(this,"checkCoverForAPoint",(e,n,i)=>{const o=this.elementFromPoint(e,n);return o!==null&&o!==i}),Wt(this,"getPointPositionList",()=>{const{width:e,height:n,left:i,top:o}=this._clientSize,c=e/6,u=n/6,h=[],m=10**6;for(let _=0;_<5;_++)for(let y=0;y<5;y++){const S=(i*m+(_===0?.1:_===4?(c*_*m-1e5)/m:c*_)*m)/m,w=(o*m+(y===0?.1:y===4?(u*y*m-1e5)/m:u*y)*m)/m;h.push({x:S,y:w})}return[...h]}),Wt(this,"checkElementCover",e=>this.getPointPositionList().map(n=>this.checkCoverForAPoint(n.x,n.y,e)).filter(n=>!!n).length>6),Wt(this,"checkSizeIsVisible",(e,n,i)=>(e>50||i/e<=10)&&(n>50||i/n<=10)),Wt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:n,top:i,bottom:o,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let m,_,y,S;if(e<0)m=0;else{if(!(e<u))return!1;m=e}if(n<0)return!1;if(_=n<u?n:u,i<0)y=0;else{if(!(i<c))return!1;y=i}if(o<0)return!1;S=o<c?o:c;const w=_-m,A=S-y;return this.checkSizeIsVisible(w,A,h)}),Wt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Wt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(QT.COVERED);{const n=this.checkActualSize(),i=this.checkSizeOfPartInClient();return n&&!i?this.returnHiddenResult(QT.POSITION):n?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(QT.SIZE)}}return this.returnHiddenResult(QT.STYLE)}return this.returnHiddenResult(dL.UNMOUNTED)}return this.returnHiddenResult(dL.INVALID_HTML_ELEMENT)}),Wt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,n=>n.nodeName.toUpperCase()!=="HTML"?n.parentElement!==null:!!document.documentElement))}};function hL(e){return new TextEncoder().encode(e)}const cW=function(e,n){const i=new Uint8Array(e.byteLength+n.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(n),e.byteLength),i},pL=async e=>function(n,i){let o="";return new Uint8Array(n).forEach(c=>{o+=c.toString(i).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",hL(e)),16);let Ar=class{constructor(){Wt(this,"_events",{}),Wt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(n=>n.listener):[]}on(e,n){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!1})}once(e,n){this._events[e]||(this._events[e]=[]);const i=this._events[e];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!0})}off(e,n){if(!this._events[e])return;const i=this._events[e],o=this._indexOfListener(i,n);o!==-1&&i.splice(o,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const n=this._events[e].map(u=>u);for(var i=arguments.length,o=new Array(i>1?i-1:0),c=1;c<i;c++)o[c-1]=arguments[c];for(let u=0;u<n.length;u+=1){const h=n[u];h.once&&this.off(e,h.listener),h.listener.apply(this,o||[])}}safeEmit(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];[...this._events[e]||[]].forEach(c=>{c.once&&this.off(e,c.listener);try{c.listener.apply(this,i)}catch(u){console.error("safeEmit event:".concat(e," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(e,n){let i=e.length;for(;i--;)if(e[i].listener===n)return i;return-1}},ZT=null;function lW(){if(ZT)return ZT;if(window.electron)return ZT=window.electron;if(!window.require)return null;try{return ZT=window.require("electron"),ZT}catch{return null}}let mi=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),Lr=function(e){return e.TRACER="tracer",e}({});function uW(e){return er(e.timeout,"config.timeout",0,1e5),er(e.timeoutFactor,"config.timeoutFactor",0,100,!1),er(e.maxRetryCount,"config.maxRetryConfig",0,1/0),er(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let jhe=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),jn=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function eb(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(n=>{if(!n.urls)throw Error()})}catch{return!1}return!0}function dW(e){return Zi(e.turnServerURL,"turnServerURL"),Zi(e.username,"username"),Zi(e.password,"password"),e.udpport&&er(e.udpport,"udpport",1,99999,!0),e.forceturn&&Up(e.forceturn,"forceturn"),e.security&&Up(e.security,"security"),e.tcpport&&er(e.tcpport,"tcpport",1,99999,!0),!0}function fL(e){return e.level!==void 0&&Ci(e.level,"level",[1,2,3]),e.delay!==void 0&&er(e.delay,"delay",0,3e3,!0),!0}let fn=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),_s=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),Ka=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),fv=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Es(e,n){for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return e.getListeners(n).length===0?lt.reject(new Le(X.UNEXPECTED_ERROR,"can not emit promise")):new lt((u,h)=>{e.emit(n,...o,u,h)})}function sr(e,n){if(e.getListeners(n).length===0)return lt.resolve();for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return Es(e,n,...o)}function Ic(e,n){if(e.getListeners(n).length===0)return null;for(var i=arguments.length,o=new Array(i>2?i-2:0),c=2;c<i;c++)o[c-2]=arguments[c];return tb(e,n,...o)}function tb(e,n){let i=null,o=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(e.emit(n,...u,m=>{i=m},m=>{o=m}),o!==null)throw o;if(i===null)throw new Le(X.UNEXPECTED_ERROR,"handler is not sync");return i}const oi=new class extends Ar{set networkState(e){this.emit(fv.NETWORK_STATE_CHANGE,e,this._networkState),e===Ka.ONLINE?this.emit(fv.ONLINE):e===Ka.OFFLINE&&(this.onlineWaiter=new lt(n=>{this.once(fv.ONLINE,()=>{this.onlineWaiter=void 0,n(Ka.ONLINE)})}),this.emit(fv.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Ka.ONLINE}constructor(){super(),Wt(this,"_moduleName","network-indicator"),Wt(this,"_networkState",Ka.ONLINE),Wt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Ka.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Ka.OFFLINE})}};function EA(e,n){const i=e.indexOf(n);i!==-1&&e.splice(i,1)}function mv(e){const n=[];return e.forEach(i=>{n.indexOf(i)===-1&&n.push(i)}),n}function yA(e){lt!==void 0?lt.resolve().then(e):setTimeout(e,0)}function xr(e){return JSON.parse(JSON.stringify(e))}function y_(e){try{return xr(e)}catch{return e}}const hW={};function Em(e,n){hW[n]||(hW[n]=!0,e())}function v_(e){const n=window.atob(e),i=new Uint8Array(new ArrayBuffer(n.length));for(let o=0;o<n.length;o+=1)i[o]=n.charCodeAt(o);return i}function ym(e){let n="";for(let i=0;i<e.length;i+=1)n+=String.fromCharCode(e[i]);return window.btoa(n)}function pW(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(e);if(i.length>n)i=i.slice(0,n);else if(i.length<n){const o=new Uint8Array(n);o.set(i),i=o}return i}function fW(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=ja(n).call(n,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(o));let u=0;return n.forEach(h=>{c.set(h,u),u+=h.length}),c}function ah(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function mW(e){let n=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(i=>{n+=typeof i=="string"?ah(i):i.size}),n+138}function Bhe(e){const n=new Le(X.TIMEOUT,"timeout");return new lt((i,o)=>{window.setTimeout(()=>o(n),e)})}function es(e){return new lt(n=>{window.setTimeout(n,e)})}function or(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,n=arguments.length>1?arguments[1]:void 0;const i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?"".concat(n).concat(i):"".concat(n).concat(i)+or(e-i.length,"")}function S_(){return or(32,"").toUpperCase()}const vA=()=>{},gW=new class{constructor(){Wt(this,"fnMap",new Map)}throttleByKey(e,n,i,o){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(n)){const m=this.fnMap.get(n);if(m.threshold!==i){m.fn(...m.args),clearTimeout(m.timer);const _=window.setTimeout(()=>{const y=this.fnMap.get(n);y&&y.fn(...y.args),this.fnMap.delete(n)},i);this.fnMap.set(n,{fn:e,threshold:i,timer:_,args:u,skipFn:o})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(n,ft(ft({},m),{},{fn:e,args:u,skipFn:o}))}else{const m=window.setTimeout(()=>{const _=this.fnMap.get(n);_&&_.fn(..._.args),this.fnMap.delete(n)},i);this.fnMap.set(n,{fn:e,threshold:i,timer:m,args:u,skipFn:o})}}},_W=gW.throttleByKey.bind(gW);function EW(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function mL(e,n){if(!EW(e)||!EW(n)||Array.isArray(e)&&!Array.isArray(n)||!Array.isArray(e)&&Array.isArray(n))return n;if(Array.isArray(n)&&Array.isArray(e)){const i=[...e];for(let o=0;o<n.length;o++)i[o]=mL(e[o],n[o]);return i}{const i=ft({},e);for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&(Object.prototype.hasOwnProperty.call(e,o)?i[o]=mL(e[o],n[o]):i[o]=n[o]);return i}}function yW(e,n){let i=[0];if(i=new Array(n).fill(0),e===0)return i;let o=0;for(;e>0&&(i[o]=255&e,e>>=8,o++,o!==n););return i}function gL(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function vW(e){const n="0123456789abcdef";function i(ce){let _e,Ee="";for(_e=0;_e<=3;_e++)Ee+=n.charAt(ce>>8*_e+4&15)+n.charAt(ce>>8*_e&15);return Ee}function o(ce,_e){const Ee=(65535&ce)+(65535&_e);return(ce>>16)+(_e>>16)+(Ee>>16)<<16|65535&Ee}function c(ce,_e,Ee,me,ke,Ye){return o(function(ut,pt){return ut<<pt|ut>>>32-pt}(o(o(_e,ce),o(me,Ye)),ke),Ee)}function u(ce,_e,Ee,me,ke,Ye,ut){return c(_e&Ee|~_e&me,ce,_e,ke,Ye,ut)}function h(ce,_e,Ee,me,ke,Ye,ut){return c(_e&me|Ee&~me,ce,_e,ke,Ye,ut)}function m(ce,_e,Ee,me,ke,Ye,ut){return c(_e^Ee^me,ce,_e,ke,Ye,ut)}function _(ce,_e,Ee,me,ke,Ye,ut){return c(Ee^(_e|~me),ce,_e,ke,Ye,ut)}const y=function(ce){let _e;const Ee=1+(ce.length+8>>6),me=new Array(16*Ee);for(_e=0;_e<16*Ee;_e++)me[_e]=0;for(_e=0;_e<ce.length;_e++)me[_e>>2]|=ce.charCodeAt(_e)<<_e%4*8;return me[_e>>2]|=128<<_e%4*8,me[16*Ee-2]=8*ce.length,me}(e);let S,w,A,k,W,U=1732584193,V=-271733879,q=-1732584194,Y=271733878;for(S=0;S<y.length;S+=16)w=U,A=V,k=q,W=Y,U=u(U,V,q,Y,y[S+0],7,-680876936),Y=u(Y,U,V,q,y[S+1],12,-389564586),q=u(q,Y,U,V,y[S+2],17,606105819),V=u(V,q,Y,U,y[S+3],22,-1044525330),U=u(U,V,q,Y,y[S+4],7,-176418897),Y=u(Y,U,V,q,y[S+5],12,1200080426),q=u(q,Y,U,V,y[S+6],17,-1473231341),V=u(V,q,Y,U,y[S+7],22,-45705983),U=u(U,V,q,Y,y[S+8],7,1770035416),Y=u(Y,U,V,q,y[S+9],12,-1958414417),q=u(q,Y,U,V,y[S+10],17,-42063),V=u(V,q,Y,U,y[S+11],22,-1990404162),U=u(U,V,q,Y,y[S+12],7,1804603682),Y=u(Y,U,V,q,y[S+13],12,-40341101),q=u(q,Y,U,V,y[S+14],17,-1502002290),V=u(V,q,Y,U,y[S+15],22,1236535329),U=h(U,V,q,Y,y[S+1],5,-165796510),Y=h(Y,U,V,q,y[S+6],9,-1069501632),q=h(q,Y,U,V,y[S+11],14,643717713),V=h(V,q,Y,U,y[S+0],20,-373897302),U=h(U,V,q,Y,y[S+5],5,-701558691),Y=h(Y,U,V,q,y[S+10],9,38016083),q=h(q,Y,U,V,y[S+15],14,-660478335),V=h(V,q,Y,U,y[S+4],20,-405537848),U=h(U,V,q,Y,y[S+9],5,568446438),Y=h(Y,U,V,q,y[S+14],9,-1019803690),q=h(q,Y,U,V,y[S+3],14,-187363961),V=h(V,q,Y,U,y[S+8],20,1163531501),U=h(U,V,q,Y,y[S+13],5,-1444681467),Y=h(Y,U,V,q,y[S+2],9,-51403784),q=h(q,Y,U,V,y[S+7],14,1735328473),V=h(V,q,Y,U,y[S+12],20,-1926607734),U=m(U,V,q,Y,y[S+5],4,-378558),Y=m(Y,U,V,q,y[S+8],11,-2022574463),q=m(q,Y,U,V,y[S+11],16,1839030562),V=m(V,q,Y,U,y[S+14],23,-35309556),U=m(U,V,q,Y,y[S+1],4,-1530992060),Y=m(Y,U,V,q,y[S+4],11,1272893353),q=m(q,Y,U,V,y[S+7],16,-155497632),V=m(V,q,Y,U,y[S+10],23,-1094730640),U=m(U,V,q,Y,y[S+13],4,681279174),Y=m(Y,U,V,q,y[S+0],11,-358537222),q=m(q,Y,U,V,y[S+3],16,-722521979),V=m(V,q,Y,U,y[S+6],23,76029189),U=m(U,V,q,Y,y[S+9],4,-640364487),Y=m(Y,U,V,q,y[S+12],11,-421815835),q=m(q,Y,U,V,y[S+15],16,530742520),V=m(V,q,Y,U,y[S+2],23,-995338651),U=_(U,V,q,Y,y[S+0],6,-198630844),Y=_(Y,U,V,q,y[S+7],10,1126891415),q=_(q,Y,U,V,y[S+14],15,-1416354905),V=_(V,q,Y,U,y[S+5],21,-57434055),U=_(U,V,q,Y,y[S+12],6,1700485571),Y=_(Y,U,V,q,y[S+3],10,-1894986606),q=_(q,Y,U,V,y[S+10],15,-1051523),V=_(V,q,Y,U,y[S+1],21,-2054922799),U=_(U,V,q,Y,y[S+8],6,1873313359),Y=_(Y,U,V,q,y[S+15],10,-30611744),q=_(q,Y,U,V,y[S+6],15,-1560198380),V=_(V,q,Y,U,y[S+13],21,1309151649),U=_(U,V,q,Y,y[S+4],6,-145523070),Y=_(Y,U,V,q,y[S+11],10,-1120210379),q=_(q,Y,U,V,y[S+2],15,718787259),V=_(V,q,Y,U,y[S+9],21,-343485551),U=o(U,w),V=o(V,A),q=o(q,k),Y=o(Y,W);return i(U)+i(V)+i(q)+i(Y)}let Whe=1,SW=console,Cs=class{static setLogger(e){SW=e}constructor(e,n){Wt(this,"id",void 0),Wt(this,"lockingPromise",lt.resolve()),Wt(this,"locks",0),Wt(this,"name",""),Wt(this,"lockId",void 0),this.lockId=Whe++,e&&(this.name=e),n&&(this.id=n),this.logger("created")}logger(e,n){const i=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(n??"");SW.debug("".concat(i," ").concat(o))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let n;this.locks+=1,this.logger("locked",e);const i=new lt(c=>{n=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),o=this.lockingPromise.then(()=>n);return this.lockingPromise=this.lockingPromise.then(()=>i),o}};function gv(e,n){return function(i,o,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[n];if(!h)throw new Error("mutex property key ".concat(n," doesn't exist on ").concat(e));const m=await h.lock("From ".concat(e,".").concat(o));try{for(var _=arguments.length,y=new Array(_),S=0;S<_;S++)y[S]=arguments[S];return await u.apply(this,y)}finally{m()}},c}}const gi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function _L(e,n){const i=Math.floor(n.timeout*Math.pow(n.timeoutFactor,e));return Math.min(n.maxRetryTimeout,i)}function cd(e,n,i,o){const c=Object.assign({},gi,o);let u=c.timeout;const h=async()=>{await function(y){return new lt(S=>{window.setTimeout(S,y)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let m=!1;const _=new lt(async(y,S)=>{n=n||(()=>!1),i=i||(()=>!0);for(let w=0;w<c.maxRetryCount;w+=1){if(m)return S(new Le(X.OPERATION_ABORTED));try{const A=await e();if(!n(A,w)||w+1===c.maxRetryCount)return y(A);await h()}catch(A){if(!i(A,w)||w+1===c.maxRetryCount)return S(A);await h()}}});return _.cancel=()=>m=!0,_}let SA,TW=class{constructor(e){Wt(this,"input",[]),Wt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:ja(e=this.input).call(e,(n,i)=>n+i)/this.input.length}},TA=0,EL=0;function yL(e,n,i,o){return new lt((c,u)=>{n.responseType=n.responseType||"json",n.data&&!i?(n.data=JSON.stringify(n.data),TA+=ah(n.data)):i&&(n.data.size?TA+=n.data.size:n.data instanceof FormData?TA+=mW(n.data):TA+=ah(JSON.stringify(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=e,Wo.request(n).then(h=>{typeof h.data=="string"?EL+=ah(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?EL+=h.data.byteLength:EL+=ah(JSON.stringify(h.data)),c(h.data)}).catch(h=>{Wo.isCancel(h)?u(new Le(X.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Le(X.NETWORK_TIMEOUT,h.message)):h.response?u(new Le(X.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Le(X.NETWORK_ERROR,h.message))})})}async function zhe(e,n){const i=new Blob([n.data],{type:"buffer"});return await yL(e,ft(ft({},n),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}const bW=()=>window.isSecureContext!==void 0;function nu(e){if(Array.isArray(e))return e.map(i=>i);if(!wW(e))return e;const n={};for(const i in e){const o=e[i];wW(o)||Array.isArray(o)?n[i]=nu(o):n[i]=o}return n}function wW(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let vL=class{constructor(e){Wt(this,"input",[]),Wt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const ch={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},nb={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:ch,remoteCandidate:ch},updateInterval:0},RW={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},CW={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},IW={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},AW={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let SL=class{constructor(e,n){Wt(this,"onFirstVideoReceived",void 0),Wt(this,"onFirstVideoDecoded",void 0),Wt(this,"onFirstAudioReceived",void 0),Wt(this,"onFirstVideoDecodedTimeout",void 0),Wt(this,"onFirstAudioDecoded",void 0),Wt(this,"onSelectedLocalCandidateChanged",void 0),Wt(this,"onSelectedRemoteCandidateChanged",void 0),Wt(this,"videoIsReady",!1),Wt(this,"videoIsReady2",{}),Wt(this,"pc",void 0),Wt(this,"options",void 0),Wt(this,"intervalTimer",void 0),Wt(this,"stats",nu(nb)),Wt(this,"isFirstVideoReceived",{}),Wt(this,"isFirstVideoDecoded",{}),Wt(this,"isFirstAudioReceived",{}),Wt(this,"isFirstAudioDecoded",{}),Wt(this,"isFirstVideoDecodedTimeout",{}),Wt(this,"lossRateWindowStats",[]),this.pc=e,this.options=n,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new lt(e=>{e({local:ft({},ch),remote:ft({},ch)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,n){this.videoIsReady2[e]=n}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const n=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,c=0,u=0,h=0;for(const m of i)e[m].forEach((_,y)=>{if(!this.lossRateWindowStats[n-1][m][y]||!this.lossRateWindowStats[0][m][y])return;const S=this.lossRateWindowStats[n-1][m][y].packets-this.lossRateWindowStats[0][m][y].packets,w=this.lossRateWindowStats[n-1][m][y].packetsLost-this.lossRateWindowStats[0][m][y].packetsLost;m==="videoSend"||m==="audioSend"?(o+=S,u+=w):(c+=S,h+=w),Number.isNaN(S)||Number.isNaN(S)?_.packetLostRate=0:_.packetLostRate=S<=0||w<=0?0:w/(S+w)});e.sendPacketLossRate=o<=0||u<=0?0:u/(o+u),e.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},Ghe=class extends SL{constructor(){super(...arguments),Wt(this,"_stats",nb),Wt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),n=this.statsResponsesToObjects(e);this._stats=nu(nb);const i=n.filter(c=>c.type==="ssrc");this.processSSRCStats(i);const o=n.find(c=>c.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(n=>{var i;const o=ot(i=n.id).call(i,"send");switch("".concat(n.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const c=nu(CW);c.codec=n.googCodecName,c.adaptionChangeReason="none",n.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),n.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(n.googAvgEncodeMs),c.inputFrame={width:Number(n.googFrameWidthInput)||Number(n.googFrameWidthSent),height:Number(n.googFrameHeightInput)||Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},c.sentFrame={width:Number(n.googFrameWidthSent),height:Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},c.firsCount=Number(n.googFirReceived),c.nacksCount=Number(n.googNacksReceived),c.plisCount=Number(n.googPlisReceived),c.frameCount=Number(n.framesEncoded),c.bytes=Number(n.bytesSent),c.packets=Number(n.packetsSent),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.rttMs=Number(n.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=nu(RW),u=this.lastDecodeVideoReceiverStats.get(Number(n.ssrc));if(c.codec=n.googCodecName,c.targetDelayMs=Number(n.googTargetDelayMs),c.renderDelayMs=Number(n.googRenderDelayMs),c.currentDelayMs=Number(n.googCurrentDelayMs),c.minPlayoutDelayMs=Number(n.googMinPlayoutDelayMs),c.decodeMs=Number(n.googDecodeMs),c.maxDecodeMs=Number(n.googMaxDecodeMs),c.receivedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateReceived)},c.decodedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateDecoded)},c.decodeFrameRate=Number(n.googFrameRateDecoded),c.outputFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateOutput)},c.jitterBufferMs=Number(n.googJitterBufferMs),c.firsCount=Number(n.googFirsSent),c.nacksCount=Number(n.googNacksSent),c.plisCount=Number(n.googPlisSent),c.framesDecodeCount=Number(n.framesDecoded),c.bytes=Number(n.bytesReceived),c.packets=Number(n.packetsReceived),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,m=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:ft({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=nu(AW);c.codec=n.googCodecName,c.outputLevel=Math.abs(Number(n.audioOutputLevel))/32767,c.decodingCNG=Number(n.googDecodingCNG),c.decodingCTN=Number(n.googDecodingCTN),c.decodingCTSG=Number(n.googDecodingCTSG),c.decodingNormal=Number(n.googDecodingNormal),c.decodingPLC=Number(n.googDecodingPLC),c.decodingPLCCNG=Number(n.googDecodingPLCCNG),c.expandRate=Number(n.googExpandRate),c.accelerateRate=Number(n.googAccelerateRate),c.preemptiveExpandRate=Number(n.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(n.googSecondaryDecodedRate),c.speechExpandRate=Number(n.googSpeechExpandRate),c.preferredJitterBufferMs=Number(n.googPreferredJitterBufferMs),c.jitterBufferMs=Number(n.googJitterBufferMs),c.jitterMs=Number(n.googJitterReceived),c.bytes=Number(n.bytesReceived),c.packets=Number(n.packetsReceived),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.receivedFrames=Number(n.googDecodingCTN)||Number(n.packetsReceived),c.droppedFrames=Number(n.googDecodingPLC)+Number(n.googDecodingPLCCNG)||Number(n.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=nu(IW);c.codec=n.googCodecName,c.inputLevel=Math.abs(Number(n.audioInputLevel))/32767,c.aecReturnLoss=Number(n.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(n.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(n.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(n.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(n.bytesSent),c.packets=Number(n.packetsSent),c.packetsLost=Number(n.packetsLost),c.ssrc=Number(n.ssrc),c.rttMs=Number(n.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new lt((e,n)=>{this.pc.getStats(e,n)})}statsResponsesToObjects(e){const n=[];return e.result().forEach(i=>{const o={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(c=>{o[c]=i.stat(c)}),n.push(o)}),n}},rb=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),bA=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),TL=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Ac=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var _v=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(_v||{});function ib(e,n,i,o){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:_v.kNone;if(!n)return;const u=Number(n[i]);if(typeof u!="number")return;const h=Number(n[o]);if(typeof h!="number")return;if(!e)return h?u/h*c:void 0;const m=Number(e[i]);if(typeof m!="number")return;const _=Number(e[o]);if(typeof _!="number")return;const y=h-_;return y?(u-m)/y*c:void 0}let PW=class extends SL{constructor(){super(...arguments),Wt(this,"_stats",nb),Wt(this,"report",void 0),Wt(this,"lastDecodeVideoReceiverStats",new Map),Wt(this,"lastVideoFramesRecv",new Map),Wt(this,"lastVideoFramesSent",new Map),Wt(this,"lastVideoFramesDecode",new Map),Wt(this,"lastVideoFramesOutput",new Map),Wt(this,"lastVideoJBDelay",new Map),Wt(this,"lastAudioJBDelay",new Map),Wt(this,"mediaBytesSent",new Map),Wt(this,"mediaBytesRetransmit",new Map),Wt(this,"mediaBytesTargetEncode",new Map),Wt(this,"lastDecodeAudioReceiverStats",new Map),Wt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=nu(nb),this.report.forEach(e=>{switch(e.type){case Ac.OUTBOUND:case Ac.INBOUND:{const n=e.mediaType||e.kind,i=!n&&"frameWidth"in e,o=!n&&!("frameWidth"in e);e.type===Ac.OUTBOUND?n==="audio"||o?this.processAudioOutboundStats(e):(n==="video"||i)&&this.processVideoOutboundStats(e):e.type===Ac.INBOUND&&(n==="audio"||o?this.processAudioInboundStats(e):(n==="video"||i)&&this.processVideoInboundStats(e));break}case Ac.TRANSPORT:{const n=this.report.get(e.selectedCandidatePairId);n&&this.processCandidatePairStats(n);break}case Ac.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),n={local:ft({},ch),remote:ft({},ch)};return e.forEach(i=>{let o;if(i.type===Ac.TRANSPORT&&(o=e.get(i.selectedCandidatePairId)),i.type===Ac.CANDIDATE_PAIR&&i.selected&&(o=i),o){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(o.localCandidateId){const u=e.get(o.localCandidateId);u&&c(n.local,u)}if(o.remoteCandidateId){const u=e.get(o.remoteCandidateId);u&&c(n.remote,u)}}}),n}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(n=>{e.currentRoundTripTime&&(n.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(n=>{e.currentRoundTripTime&&(n.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const n=this.report.get(e.localCandidateId);n&&this.processCandidateStats(n)}if(e.remoteCandidateId){const n=this.report.get(e.remoteCandidateId);n&&this.processCandidateStats(n)}}processCandidateStats(e){let n;e.type===Ac.LOCAL_CANDIDATE&&(n=this._stats.selectedCandidatePair.localCandidate),e.type===Ac.REMOTE_CANDIDATE&&(n=this._stats.selectedCandidatePair.remoteCandidate),n&&(n.type=e.type,n.id=e.id,e.address&&(n.address=e.address),e.candidateType&&(n.candidateType=e.candidateType),e.port&&(n.port=e.port),e.priority&&(n.priority=e.priority),e.protocol&&(n.protocol=e.protocol),e.relayProtocol&&(n.relayProtocol=e.relayProtocol),e.type===Ac.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==n.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(ft({},n),ft({},this.stats.selectedCandidatePair.localCandidate)),e.type===Ac.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==n.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(ft({},n),ft({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let n=this._stats.audioRecv.find(o=>o.ssrc===e.ssrc);n||(n=nu(AW),this._stats.audioRecv.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsReceived,n.packetsLost=e.packetsLost,n.packetsDiscarded=e.packetsDiscarded,n.bytes=e.bytesReceived,n.jitterMs=1e3*e.jitter,n.retransmittedBytesReceived=e.retransmittedBytesReceived,n.retransmittedPacketsReceived=e.retransmittedPacketsReceived,n.totalProcessingDelay=e.totalProcessingDelay,n.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const i=this.lastDecodeAudioReceiverStats.get(n.ssrc);n.avgProcessingDelayMs=ib(i,n,"totalProcessingDelay","jitterBufferEmittedCount",_v.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),n.receivedFrames||(n.receivedFrames=e.packetsReceived),n.droppedFrames||(n.droppedFrames=e.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.outputLevel&&n.outputLevel>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),typeof e.concealedSamples=="number"&&(n.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(n.ssrc,ft({},n))}processVideoInboundStats(e){let n=this._stats.videoRecv.find(h=>h.ssrc===e.ssrc);n||(n=nu(RW),this._stats.videoRecv.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsReceived,n.packetsLost=e.packetsLost,n.bytes=e.bytesReceived,n.firsCount=e.firCount,n.nacksCount=e.nackCount,n.plisCount=e.pliCount,n.framesDecodeCount=e.framesDecoded,n.framesDroppedCount=e.framesDropped,n.totalInterFrameDelay=e.totalInterFrameDelay,n.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,n.totalFreezesDuration=e.totalFreezesDuration,n.totalProcessingDelay=e.totalProcessingDelay,n.packetsDiscarded=e.packetsDiscarded,n.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,n.totalAssemblyTime=e.totalAssemblyTime,n.keyFramesDecoded=e.keyFramesDecoded,n.retransmittedBytesReceived=e.retransmittedBytesReceived,n.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const i=this.lastDecodeVideoReceiverStats.get(n.ssrc),o=this.lastVideoFramesDecode.get(n.ssrc),c=this.lastVideoFramesOutput.get(n.ssrc),u=Date.now();if(n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]){const h=n.decodedFrame?n.decodedFrame.width:0,m=n.decodedFrame?n.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,h,m),this.isFirstVideoDecoded[n.ssrc]=!0}if(i){const h=i.stats,m=u-i.lts;n.framesDecodeFreezeTime=h.framesDecodeFreezeTime,n.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[n.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[n.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(n.ssrc),this.isFirstVideoDecodedTimeout[n.ssrc]=!0),n.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(i.lts=Date.now(),n.framesDecodeInterval=m,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):n.framesDecodeCount<h.framesDecodeCount&&(n.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(i.stats.framesDecodeCount>e.framesDecoded?n.qpSumPerFrame=e.qpSum/e.framesDecoded:n.qpSumPerFrame=(e.qpSum-i.qpSum)/(e.framesDecoded-i.stats.framesDecodeCount))}e.totalDecodeTime&&(n.decodeMs=1e3*e.totalDecodeTime,n.avgDecodeMs=ib(i==null?void 0:i.stats,n,"decodeMs","framesDecodeCount")),n.avgProcessingDelayMs=ib(i==null?void 0:i.stats,n,"totalProcessingDelay","framesDecodeCount",_v.kMillisecondsFromSeconds),n.avgFramesAssembledFromMultiplePacketsMs=ib(i==null?void 0:i.stats,n,"totalAssemblyTime","framesAssembledFromMultiplePackets",_v.kMillisecondsFromSeconds),n.avgInterFrameDelayMs=ib(i==null?void 0:i.stats,n,"totalInterFrameDelay","framesDecodeCount",_v.kMillisecondsFromSeconds),o&&u-o.lts>=800?(n.decodeFrameRate=Math.round((n.framesDecodeCount-o.count)/((u-o.lts)/1e3)),this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:u,rate:n.decodeFrameRate})):o?n.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:u,rate:0}),n.framesDroppedCount&&e.framesReceived&&(c&&u-c.lts>=800?(n.outputFrameRate=Math.round((e.framesReceived-n.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(n.ssrc,{count:e.framesReceived-n.framesDroppedCount,lts:u,rate:Math.max(n.outputFrameRate,0)})):c?n.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(n.ssrc,{count:e.framesReceived-n.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(n.framesRateFirefox=e.framerateMean),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:ft({},n),lts:i?i.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let n=this._stats.videoSend.find(o=>o.ssrc===e.ssrc);n||(n=nu(CW),this._stats.videoSend.push(n));const i=this.mediaBytesSent.get(e.ssrc);if(i)i.add(e.bytesSent);else{const o=new vL(10);o.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,o)}if(e.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(e.ssrc);if(o)o.add(e.retransmittedBytesSent);else{const c=new vL(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(e.ssrc);if(o)o.add(e.totalEncodedBytesTarget);else{const c=new vL(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(n.ssrc=e.ssrc,n.bytes=e.bytesSent,n.packets=e.packetsSent,n.firsCount=e.firCount,n.nacksCount=e.nackCount,n.plisCount=e.pliCount,n.frameCount=e.framesEncoded,n.adaptionChangeReason=e.qualityLimitationReason,n.scalabilityMode=e.scalabilityMode,n.retransmittedBytesSent=e.retransmittedBytesSent,n.retransmittedPacketsSent=e.retransmittedPacketsSent,n.hugeFramesSent=e.hugeFramesSent,n.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){const o=this.lastEncoderMs.get(e.ssrc);if(!o||o.lastFrameCount>e.framesEncoded)n.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const c=e.framesEncoded-o.lastFrameCount,u=e.totalEncodeTime-o.lastEncoderTime;n.avgEncodeMs=1e3*u/c}}if(e.framesEncoded&&e.qpSum){const o=this.lastEncoderMs.get(e.ssrc);!o||o.lastFrameCount>e.framesEncoded?n.qpSumPerFrame=e.qpSum/e.framesEncoded:n.qpSumPerFrame=(e.qpSum-o.lastQpSum)/(e.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,n),this.processVideoTrackSenderStats(e,e.trackId,n),e.remoteId)this.processRemoteInboundStats(e.remoteId,n);else{const o=this.findRemoteStatsId(e.ssrc,Ac.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,n)}}processAudioOutboundStats(e){let n=this._stats.audioSend.find(i=>i.ssrc===e.ssrc);if(n||(n=nu(IW),this._stats.audioSend.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsSent,n.bytes=e.bytesSent,n.retransmittedBytesSent=e.retransmittedBytesSent,n.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,n),e.remoteId)this.processRemoteInboundStats(e.remoteId,n);else{const i=this.findRemoteStatsId(e.ssrc,Ac.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,n)}}findRemoteStatsId(e,n){var i;const o=Array.from(Rc(i=this.report).call(i)).find(c=>c.type===n&&c.ssrc===e);return o?o.id:null}processVideoMediaSource(e,n){const i=this.report.get(e);i&&i.width&&i.height&&i.framesPerSecond&&(n.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(e,n){const i=this.report.get(e);i&&(n.inputLevel=i.audioLevel)}processVideoTrackSenderStats(e,n,i){var o,c,u,h;const m=n?this.report.get(n):void 0,_=(o=m==null?void 0:m.framesSent)!==null&&o!==void 0?o:e.framesSent;if(typeof _!="number")return;let y=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:e.frameWidth,S=(u=m==null?void 0:m.frameHeight)!==null&&u!==void 0?u:e.frameHeight,w=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof y=="number"&&typeof S=="number"||(y=0,S=0),w==null){const A=Date.now(),k=this.lastVideoFramesSent.get(i.ssrc);k&&A-k.lts>=800?(w=Math.round((_-k.count)/((A-k.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:A,rate:w})):k?w=k.rate:this.lastVideoFramesSent.set(i.ssrc,{count:_,lts:A,rate:0})}i.sentFrame={width:y,height:S,frameRate:Math.max(0,w)}}processVideoTrackReceiverStats(e,n,i){var o,c,u,h,m;const _=n?this.report.get(n):void 0,y=(o=_==null?void 0:_.framesReceived)!==null&&o!==void 0?o:e.framesReceived,S=(c=_==null?void 0:_.frameWidth)!==null&&c!==void 0?c:e.frameWidth,w=(u=_==null?void 0:_.frameHeight)!==null&&u!==void 0?u:e.frameHeight,A=(h=_==null?void 0:_.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,k=(m=_==null?void 0:_.jitterBufferEmittedCount)!==null&&m!==void 0?m:e.jitterBufferEmittedCount;if(typeof y=="number"){const W=this.lastVideoFramesRecv.get(i.ssrc),U=Date.now();i.framesReceivedCount=y;let V=0;W&&U-W.lts>=800?(V=Math.round((y-W.count)/((U-W.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:y,lts:U,rate:V})):W?V=W.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:y,lts:U,rate:0}),i.receivedFrame={width:S||0,height:w||0,frameRate:V||0},i.decodedFrame={width:S||0,height:w||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:S||0,height:w||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if(A&&k){const W=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let U=W.jitterBufferMs;const V=k-W.jitterBufferEmittedCount;V>0&&(U=1e3*(A-W.jitterBufferDelay)/V),i.jitterBufferMs=U,i.currentDelayMs=Math.round(U),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:A,jitterBufferEmittedCount:k,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(e,n,i){var o,c,u,h;const m=n?this.report.get(n):void 0,_=(o=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&o!==void 0?o:0,y=(u=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;i.aecReturnLoss=_,i.aecReturnLossEnhancement=y}processAudioTrackReceiverStats(e,n,i){var o,c,u,h,m,_,y;const S=n?this.report.get(n):void 0,w=(o=S==null?void 0:S.removedSamplesForAcceleration)!==null&&o!==void 0?o:e.removedSamplesForAcceleration,A=(c=S==null?void 0:S.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,k=(u=S==null?void 0:S.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,W=(h=S==null?void 0:S.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,U=(m=S==null?void 0:S.audioLevel)!==null&&m!==void 0?m:e==null?void 0:e.audioLevel,V=(_=S==null?void 0:S.totalSamplesDuration)!==null&&_!==void 0?_:e==null?void 0:e.totalSamplesDuration,q=(y=S==null?void 0:S.concealedSamples)!==null&&y!==void 0?y:e.concealedSamples;if(typeof A=="number"&&(i.totalSamplesReceived=A),w&&A&&(i.accelerateRate=w/A),k&&W){const ce=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let _e=ce.jitterBufferMs;const Ee=W-ce.jitterBufferEmittedCount;Ee>0&&(_e=1e3*(k-ce.jitterBufferDelay)/Ee),i.jitterBufferMs=Math.round(_e),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:k,jitterBufferEmittedCount:W,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=U;let Y=1920;V&&A&&(Y=A/V/50,i.receivedFrames=Math.round(A/Y)),q&&(i.droppedFrames=Math.round(q/Y))}processRemoteInboundStats(e,n){const i=this.report.get(e);i&&(n.packetsLost=i.packetsLost,i.roundTripTime&&(n.rttMs=1e3*i.roundTripTime),i.jitter&&(n.jitterMs=1e3*i.jitter),i.timestamp&&(n.timestamp=i.timestamp))}getCodecFromCodecStats(e){const n=this.report.get(e);if(!n)return"";const i=n.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let e=0,n=null,i=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{n=n===null?c.diffMean():n+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{i=i===null?c.diffMean():i+c.diffMean()});const o=n!==null?e-n:e;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},n!==null&&(this._stats.bitrate.retransmit=8*n/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},Hhe=class extends SL{updateStats(){return lt.resolve()}};function bL(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new Ghe(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new PW(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof lt||function(_){return!!_&&(typeof _=="object"||typeof _=="function")&&typeof _.then=="function"}(m))}(e)?new PW(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new Hhe(e,{updateInterval:n,lossRateInterval:i,freezeRateLimit:o,firstVideoDecodedTimeout:c})}const OW="websdk_ng_install_id";function wL(){try{if(re("INSTALL_ID"))return re("INSTALL_ID");let e=window.localStorage.getItem(OW);return e||(e=S_(),window.localStorage.setItem(OW,e)),Xn("INSTALL_ID",e),e}catch{return}}const pl=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const n=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(n&&n[1]&&n[2]){const i=n[1],o=n[2];return"".concat(i,".").concat(o)}return"4.0.0.999"}("4.23.2"),RL=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let T_=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const ys=function(){const e="us".concat("erna","me"),n="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");const o=i.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const u=c.join(""),h={};return h[e]=o,h[n]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=ys;const wA={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},CL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},IL="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",AL={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},fr=ft(ft(ft({},AL),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:CL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},wA),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function Xn(e,n,i){var o,c,u;ot(o=Object.keys(fr)).call(o,e)&&(!i&&ot(c=Object.keys(ld)).call(c,e)||(fr[e]=n,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||n!==!0||(fr.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(fr.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&n&&(u=!!n,fr.USE_NEW_NETWORK_CONFIG=u,u&&(fr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],fr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],fr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],fr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],fr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",fr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",fr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&n&&(fr.ENABLE_INSTANT_VIDEO=!0,fr.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&n&&(fr.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&n&&(fr.NEW_TURN_MODE||(fr.NEW_TURN_MODE=4))))}function re(e){return fr[e]}RL||(fr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],fr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],fr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],fr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],fr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],fr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],fr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",fr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",fr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",fr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",fr.AREAS=["NORTH_AMERICA","OVERSEA"]);let kW=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const ld={};var mn=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(mn||{});let RA=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const NW=128,$he=96,DW=1e3,Ev=10;let Khe=0;var LW=(()=>{var e={8:(o,c,u)=>{u.r(c),u.d(c,{Parser:()=>ut,Printer:()=>Zr,parse:()=>st,print:()=>vt});const h=`
`,m="".concat("\r").concat(h),_=" ";let y;function S(We){return We>="0"&&We<="9"}function w(We){return We>="!"&&We<="~"}function A(We){return w(We)||We>=""&&We<=""}function k(We){return We==="!"||We>="#"&&We<="'"||We>="*"&&We<="+"||We>="-"&&We<="."||We>="0"&&We<="9"||We>="A"&&We<="Z"||We>="^"&&We<="~"}function W(We){return We>="1"&&We<="9"}function U(We){return We>="A"&&We<="Z"||We>="a"&&We<="z"}function V(We){return We==="d"||We==="h"||We==="m"||We==="s"}function q(We){return We>""&&We<"	"||We>"\v"&&We<"\f"||We>""&&We<""}function Y(We){return U(We)||S(We)||We==="+"||We==="/"}function ce(We){return S(We)||U(We)||We==="+"||We==="/"||We==="-"||We==="_"}function _e(We){return U(We)||S(We)||We==="+"||We==="/"}function Ee(We,x){var ie=Object.keys(We);if(Object.getOwnPropertySymbols){var ue=Object.getOwnPropertySymbols(We);x&&(ue=ue.filter(function(Qe){return Object.getOwnPropertyDescriptor(We,Qe).enumerable})),ie.push.apply(ie,ue)}return ie}function me(We){for(var x=1;x<arguments.length;x++){var ie=arguments[x]!=null?arguments[x]:{};x%2?Ee(Object(ie),!0).forEach(function(ue){ke(We,ue,ie[ue])}):Object.getOwnPropertyDescriptors?Object.defineProperties(We,Object.getOwnPropertyDescriptors(ie)):Ee(Object(ie)).forEach(function(ue){Object.defineProperty(We,ue,Object.getOwnPropertyDescriptor(ie,ue))})}return We}function ke(We,x,ie){return x in We?Object.defineProperty(We,x,{value:ie,enumerable:!0,configurable:!0,writable:!0}):We[x]=ie,We}(function(We){We.VERSION="v",We.ORIGIN="o",We.SESSION_NAME="s",We.INFORMATION="i",We.URI="u",We.EMAIL="e",We.PHONE="p",We.CONNECTION="c",We.BANDWIDTH="b",We.TIME="t",We.REPEAT="r",We.ZONE_ADJUSTMENTS="z",We.KEY="k",We.ATTRIBUTE="a",We.MEDIA="m"})(y||(y={}));class Ye{consumeText(x,ie){let ue=ie;for(;ue<x.length;){const Qe=x[ue];if(Qe==="\0"||Qe==="\r"||Qe===h)break;ue+=1}if(ue-ie==0)throw new Error("Invalid text, at ".concat(x));return ue}consumeUnicastAddress(x,ie,ue){return this.consumeTill(x,ie,_)}consumeOneOrMore(x,ie,ue){let Qe=ie;for(;ue(x[Qe]);)Qe++;if(Qe-ie==0)throw new Error("Invalid rule at ".concat(ie,"."));return Qe}consumeSpace(x,ie){if(x[ie]===_)return ie+1;throw new Error("Invalid space at ".concat(ie,"."))}consumeIP4Address(x,ie){let ue=ie;for(let Qe=0;Qe<4;Qe++)if(ue=this.consumeDecimalUChar(x,ue),Qe!==3){if(x[ue]!==".")throw new Error("Invalid IP4 address.");ue++}return ue}consumeDecimalUChar(x,ie){let ue=ie;for(let Gt=0;Gt<3&&S(x[ue]);Gt++,ue++);if(ue-ie==0)throw new Error("Invalid decimal uchar.");const Qe=parseInt(x.slice(ie,ue));if(Qe>=0&&Qe<=255)return ue;throw new Error("Invalid decimal uchar")}consumeIP6Address(x,ie){let ue=this.consumeHexpart(x,ie);return x[ue]===":"&&(ue+=1,ue=this.consumeIP4Address(x,ue)),ue}consumeHexpart(x,ie){let ue=ie;if(x[ue]===":"&&x[ue+1]===":"){ue+=2;try{ue=this.consumeHexseq(x,ue)}catch{}return ue}if(ue=this.consumeHexseq(x,ue),x[ue]===":"&&x[ue+1]===":"){ue+=2;try{ue=this.consumeHexseq(x,ue)}catch{}return ue}return ue}consumeHexseq(x,ie){let ue=ie;for(;ue=this.consumeHex4(x,ue),x[ue]===":"&&x[ue+1]!==":";)ue+=1;return ue}consumeHex4(x,ie){let ue=0;for(;ue<4;ue++)if(!((Qe=x[ie+ue])>="0"&&Qe<="9"||Qe>="a"&&Qe<="f"||Qe>="A"&&Qe<="F")){if(ue===0)throw new Error("Invalid hex 4");break}var Qe;return ie+ue}consumeFQDN(x,ie){let ue=ie;for(;S(x[ue])||U(x[ue])||x[ue]==="-"||x[ue]===".";)ue+=1;if(ue-ie<4)throw new Error("Invalid FQDN");return ue}consumeExtnAddr(x,ie){return this.consumeOneOrMore(x,ie,A)}consumeMulticastAddress(x,ie,ue){switch(ue){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(x,ie);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(x,ie);default:try{return this.consumeFQDN(x,ie)}catch{return this.consumeExtnAddr(x,ie)}}}consumeIP6MulticastAddress(x,ie){const ue=this.consumeHexpart(x,ie);return x[ue]==="/"?this.consumeInteger(x,ue+1):ue}consumeIP4MulticastAddress(x,ie){let ue=ie+3;const Qe=x.slice(ie,ue),Gt=parseInt(Qe);if(Gt<224||Gt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let tr=0;tr<3;tr++){if(x[ue]!==".")throw new Error("Invalid IP4 multicast address.");ue+=1,ue=this.consumeDecimalUChar(x,ue)}return x[ue]==="/"&&(ue+=1),ue=this.consumeTTL(x,ue),x[ue]==="/"&&(ue=this.consumeInteger(x,ue)),ue}consumeInteger(x,ie){if(!W(x[ie]))throw new Error("Invalid integer.");for(ie+=1;S(x[ie]);)ie+=1;return ie}consumeTTL(x,ie){if(x[ie]==="0")return ie+1;if(!W(x[ie]))throw new Error("Invalid TTL.");ie+=1;for(let ue=0;ue<2&&S(x[ie]);ue++)ie+=1;return ie}consumeToken(x,ie){return this.consumeOneOrMore(x,ie,k)}consumeTime(x,ie){let ue=ie;if(x[ue]==="0")return ue+1;for(W(x[ue])&&(ue+=1);S(x[ue]);)ue++;if(ue-ie<10)throw new Error("Invalid time");return ue}consumeAddress(x,ie){return this.consumeTill(x,ie,_)}consumeTypedTime(x,ie){let ue=ie;return ue=this.consumeOneOrMore(x,ue,S),V(x[ue])?ue+1:ue}consumeRepeatInterval(x,ie){if(!W(x[ie]))throw new Error("Invalid repeat interval");for(ie+=1;S(x[ie]);)ie+=1;return V(x[ie])&&(ie+=1),ie}consumePort(x,ie){return this.consumeOneOrMore(x,ie,S)}consume(x,ie,ue){for(let Qe=0;Qe<ue.length;Qe++){if(ie+Qe>=x.length)throw new Error("consume exceeding value length");if(x[ie+Qe]!==ue[Qe])throw new Error("consume ".concat(ue," failed at ").concat(Qe))}return ie+ue.length}consumeTill(x,ie,ue){let Qe=ie;for(;Qe<x.length&&(typeof ue!="string"||x[Qe]!==ue)&&(typeof ue!="function"||!ue(x[Qe]));)Qe++;return Qe}}class ut extends Ye{constructor(){super(),ke(this,"records",[]),ke(this,"currentLine",0)}parse(x){const ie=this.probeEOL(x);this.records=x.split(ie).filter($_=>!!Ys($_).call($_)).map(this.parseLine),this.currentLine=0;const ue=this.parseVersion(),Qe=this.parseOrigin(),Gt=this.parseSessionName(),tr=this.parseInformation(),xi=this.parseUri(),ba=this.parseEmail(),Xp=this.parsePhone(),H_=this.parseConnection(),Bb=this.parseBandWidth(),MP=this.parseTimeFields(),UP=this.parseKey(),Sl=this.parseSessionAttribute(),Um=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ue,origin:Qe,sessionName:Gt,information:tr,uri:xi,emails:ba,phones:Xp,connection:H_,bandwidths:Bb,timeFields:MP,key:UP,attributes:Sl,mediaDescriptions:Um}}getCurrentRecord(){const x=this.records[this.currentLine];if(!x)throw new Error("Record doesn't exit.");return x}probeEOL(x){for(let ie=0;ie<x.length;ie++)if(x[ie]===h)return x[ie-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(x,ie){if(x.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const ue=x[0];if(x[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ue,value:x.slice(2),line:ie,cur:0}}parseSessionAttribute(){const x=new yn;for(;this.currentLine<this.records.length;){const ie=this.getCurrentRecord();if(ie.type!==y.ATTRIBUTE)break;const ue={attField:this.extractOneOrMore(ie,Qe=>k(Qe)&&Qe!==":"),_cur:0};ie.value[ie.cur]===":"&&(ie.cur+=1,ue.attValue=this.extractOneOrMore(ie,q)),x.parse(ue),this.currentLine++}return x.digest()}parseMediaAttributes(x){const ie=new vn(x);for(;this.currentLine<this.records.length;){const ue=this.getCurrentRecord();if(ue.type!==y.ATTRIBUTE)break;const Qe={attField:this.extractOneOrMore(ue,Gt=>k(Gt)&&Gt!==":"),_cur:0};ue.value[ue.cur]===":"&&(ue.cur+=1,Qe.attValue=this.extractOneOrMore(ue,q)),ie.parse(Qe),this.currentLine++}return ie.digest()}parseKey(){const x=this.getCurrentRecord();if(x.type===y.KEY){if(x.value==="prompt"||x.value==="clear:"||x.value==="base64:"||x.value==="uri:")return x.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const x=this.getCurrentRecord();if(x.type===y.ZONE_ADJUSTMENTS){const ie=[];for(;;)try{const ue=this.extract(x,this.consumeTime);this.consumeSpaceForRecord(x);let Qe=!1;x.value[x.cur]==="-"&&(Qe=!0,x.cur+=1);const Gt=this.extract(x,this.consumeTypedTime);ie.push({time:ue,typedTime:Gt,back:Qe})}catch{break}if(ie.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ie}return[]}parseRepeat(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==y.REPEAT)break;{const ue=this.extract(ie,this.consumeRepeatInterval),Qe=this.parseTypedTime(ie);x.push({repeatInterval:ue,typedTimes:Qe}),this.currentLine++}}return x}parseTypedTime(x){const ie=[];for(;;)try{this.consumeSpaceForRecord(x),ie.push(this.extract(x,this.consumeTypedTime))}catch{break}if(ie.length===0)throw new Error("Invalid typed time.");return ie}parseTime(){const x=this.getCurrentRecord(),ie=this.extract(x,this.consumeTime);this.consumeSpaceForRecord(x);const ue=this.extract(x,this.consumeTime);return this.currentLine++,{startTime:ie,stopTime:ue}}parseBandWidth(){const x=[];for(;this.currentLine<this.records.length;){const ie=this.getCurrentRecord();if(ie.type!==y.BANDWIDTH)break;{const ue=this.extractOneOrMore(ie,k);if(ie.value[ie.cur]!==":")throw new Error("Invalid bandwidth field.");ie.cur++;const Qe=this.extractOneOrMore(ie,S);x.push({bwtype:ue,bandwidth:Qe}),this.currentLine++}}return x}parseVersion(){const x=this.getCurrentRecord();if(x.type!==y.VERSION)throw new Error("first sdp record must be version");const ie=x.value.slice(0,this.consumeOneOrMore(x.value,0,S));if(ie.length!==x.value.length)throw new Error('invalid proto version, "v='.concat(x.value,'"'));return this.currentLine++,ie}parseOrigin(){const x=this.getCurrentRecord();if(x.type!==y.ORIGIN)throw new Error("second line of sdp must be origin");const ie=this.extractOneOrMore(x,A);this.consumeSpaceForRecord(x);const ue=this.extractOneOrMore(x,S);this.consumeSpaceForRecord(x);const Qe=this.extractOneOrMore(x,S);this.consumeSpaceForRecord(x);const Gt=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const tr=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const xi=this.extract(x,this.consumeUnicastAddress);return this.currentLine++,{username:ie,sessId:ue,sessVersion:Qe,nettype:Gt,addrtype:tr,unicastAddress:xi}}parseSessionName(){const x=this.getCurrentRecord();if(x.type===y.SESSION_NAME){const ie=this.extract(x,this.consumeText);return this.currentLine++,ie}}parseInformation(){const x=this.getCurrentRecord();if(x.type!==y.INFORMATION)return;const ie=this.extract(x,this.consumeText);return this.currentLine++,ie}parseUri(){const x=this.getCurrentRecord();if(x.type===y.URI)return this.currentLine++,x.value}parseEmail(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==y.EMAIL)break;x.push(ie.value),this.currentLine++}return x}parsePhone(){const x=[];for(;;){const ie=this.getCurrentRecord();if(ie.type!==y.PHONE)break;x.push(ie.value),this.currentLine++}return x}parseConnection(){const x=this.getCurrentRecord();if(x.type===y.CONNECTION){const ie=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const ue=this.extractOneOrMore(x,k);this.consumeSpaceForRecord(x);const Qe=this.extract(x,this.consumeAddress);return this.currentLine++,{nettype:ie,addrtype:ue,address:Qe}}}parseMedia(){const x=this.getCurrentRecord(),ie=this.extract(x,this.consumeToken);this.consumeSpaceForRecord(x);let ue=this.extract(x,this.consumePort);x.value[x.cur]==="/"&&(x.cur+=1,ue+=this.extract(x,this.consumeInteger)),this.consumeSpaceForRecord(x);const Qe=[];for(Qe.push(this.extract(x,this.consumeToken));x.value[x.cur]==="/";)x.cur+=1,Qe.push(this.extract(x,this.consumeToken));if(Qe.length===0)throw new Error("Invalid proto");const Gt=this.parseFmt(x);return this.currentLine++,{mediaType:ie,port:ue,protos:Qe,fmts:Gt}}parseTimeFields(){const x=[];for(;this.getCurrentRecord().type===y.TIME;){const ie=this.parseTime(),ue=this.parseRepeat(),Qe=this.parseZone();x.push({time:ie,repeats:ue,zones:Qe})}return x}parseMediaDescription(){const x=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.MEDIA;){const ie=this.parseMedia(),ue=this.parseInformation(),Qe=this.parseConnections(),Gt=this.parseBandWidth(),tr=this.parseKey(),xi=this.parseMediaAttributes(ie);x.push({media:ie,information:ue,connections:Qe,bandwidths:Gt,key:tr,attributes:xi})}return x}parseConnections(){const x=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===y.CONNECTION;)x.push(this.parseConnection());return x}parseFmt(x){const ie=[];for(;;)try{this.consumeSpaceForRecord(x),ie.push(this.extract(x,this.consumeToken))}catch{break}if(ie.length===0)throw new Error("Invalid fmts");return ie}extract(x,ie){for(var ue=arguments.length,Qe=new Array(ue>2?ue-2:0),Gt=2;Gt<ue;Gt++)Qe[Gt-2]=arguments[Gt];const tr=ie.call(this,x.value,x.cur,...Qe),xi=x.value.slice(x.cur,tr);return x.cur=tr,xi}extractOneOrMore(x,ie){const ue=this.consumeOneOrMore(x.value,x.cur,ie),Qe=x.value.slice(x.cur,ue);return x.cur=ue,Qe}consumeSpaceForRecord(x){if(x.value[x.cur]!==_)throw new Error("Invalid space at ".concat(x.cur,"."));x.cur+=1}}class pt extends Ye{constructor(){super(...arguments),ke(this,"attributes",void 0),ke(this,"digested",!1)}extractOneOrMore(x,ie,ue){const Qe=this.consumeOneOrMore(x.attValue,x._cur,ie),Gt=x.attValue.slice(x._cur,Qe),[tr,xi]=ue||[];if(typeof tr=="number"&&Gt.length<tr)throw new Error("error in length, should be more or equal than ".concat(tr," characters."));if(typeof xi=="number"&&Gt.length>xi)throw new Error("error in length, should be less or equal than ".concat(xi," characters."));return x._cur=Qe,Gt}consumeAttributeSpace(x){if(x.attValue[x._cur]!==_)throw new Error("Invalid space at ".concat(x._cur,"."));x._cur+=1}extract(x,ie){if(!x.attValue)throw new Error("Nothing to extract from attValue.");for(var ue=arguments.length,Qe=new Array(ue>2?ue-2:0),Gt=2;Gt<ue;Gt++)Qe[Gt-2]=arguments[Gt];const tr=ie.call(this,x.attValue,x._cur,...Qe),xi=x.attValue.slice(x._cur,tr);return x._cur=tr,xi}atEnd(x){if(!x.attValue)throw new Error;return x._cur>=x.attValue.length}peekChar(x){if(!x.attValue)throw new Error;return x.attValue[x._cur]}peek(x,ie){if(!x.attValue)throw new Error;for(let ue=0;ue<ie.length;ue++)if(ie[ue]!==x.attValue[x._cur+ue])return!1;return!0}parseIceUfrag(x){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(x,Y,[4,256])}parseIcePwd(x){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(x,Y,[22,256])}parseIceOptions(x){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ie=[];for(;!this.atEnd(x);){ie.push(this.extractOneOrMore(x,Y));try{this.consumeAttributeSpace(x)}catch(ue){if(this.atEnd(x))break;throw ue}}this.attributes.iceOptions=ie}parseFingerprint(x){const ie=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const ue=this.extract(x,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ie,fingerprint:ue})}parseExtmap(x){const ie=this.extractOneOrMore(x,S);let ue;this.peekChar(x)==="/"&&(this.extract(x,this.consume,"/"),ue=this.extract(x,this.consumeToken)),this.consumeAttributeSpace(x);const Qe=this.extract(x,this.consumeTill,_),Gt=me(me({entry:parseInt(ie,10)},ue&&{direction:ue}),{},{extensionName:Qe});this.peekChar(x)===_&&(this.consumeAttributeSpace(x),Gt.extensionAttributes=this.extract(x,this.consumeTill)),this.attributes.extmaps.push(Gt)}parseSetup(x){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ie=this.extract(x,this.consumeTill);if(ie!=="active"&&ie!=="passive"&&ie!=="actpass"&&ie!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ie}}class yn extends pt{constructor(){super(...arguments),ke(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(x){if(this.digested)throw new Error("already digested");try{switch(x.attField){case"group":this.parseGroup(x);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(x);break;case"ice-pwd":this.parseIcePwd(x);break;case"ice-options":this.parseIceOptions(x);break;case"fingerprint":this.parseFingerprint(x);break;case"setup":this.parseSetup(x);break;case"tls-id":this.parseTlsId(x);break;case"identity":this.parseIdentity(x);break;case"extmap":this.parseExtmap(x);break;case"msid-semantic":this.parseMsidSemantic(x);break;default:x.ignored=!0,this.attributes.unrecognized.push(x)}}catch(ie){throw console.error("parsing session attribute ".concat(x.attField,' error, "a=').concat(x.attField,":").concat(x.attValue,'"')),ie}if(!x.ignored&&x.attValue&&!this.atEnd(x))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(x){const ie=this.extract(x,this.consumeToken),ue=[];for(;!this.atEnd(x)&&this.peekChar(x)===_;)this.consumeAttributeSpace(x),ue.push(this.extract(x,this.consumeToken));this.attributes.groups.push({semantic:ie,identificationTag:ue})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(x){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(x,ce)}parseIdentity(x){const ie=this.extractOneOrMore(x,_e),ue=[];for(;!this.atEnd(x)&&this.peekChar(x)===_;){this.consumeAttributeSpace(x);const Qe=this.extract(x,this.consumeToken);this.extract(x,this.consume,"=");const Gt=this.extractOneOrMore(x,tr=>tr!==_&&q(tr));ue.push({name:Qe,value:Gt})}this.attributes.identities.push({assertionValue:ie,extensions:ue})}parseMsidSemantic(x){this.peekChar(x)===_&&this.consumeAttributeSpace(x);const ie={semantic:this.extract(x,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(x)}catch{break}if(this.peekChar(x)==="*"){this.extract(x,this.consume,"*"),ie.applyForAll=!0;break}{const ue=this.extract(x,this.consumeTill,_);ie.identifierList.push(ue)}}this.attributes.msidSemantic=ie}}class vn extends pt{constructor(x){super(),ke(this,"attributes",void 0),x.protos.indexOf("RTP")!==-1||x.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(x){if(this.digested)throw new Error("already digested");try{switch(x.attField){case"extmap":this.parseExtmap(x);break;case"setup":this.parseSetup(x);break;case"ice-ufrag":this.parseIceUfrag(x);break;case"ice-pwd":this.parseIcePwd(x);break;case"ice-options":this.parseIceOptions(x);break;case"candidate":this.parseCandidate(x);break;case"remote-candidate":this.parseRemoteCandidate(x);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(x);break;case"rtpmap":this.parseRtpmap(x);break;case"ptime":this.parsePtime(x);break;case"maxptime":this.parseMaxPtime(x);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(x);break;case"ssrc":this.parseSSRC(x);break;case"fmtp":this.parseFmtp(x);break;case"rtcp-fb":this.parseRtcpFb(x);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(x);break;case"mid":this.parseMid(x);break;case"msid":this.parseMsid(x);break;case"imageattr":this.parseImageAttr(x);break;case"rid":this.parseRid(x);break;case"simulcast":this.parseSimulcast(x);break;case"sctp-port":this.parseSctpPort(x);break;case"max-message-size":this.parseMaxMessageSize(x);break;case"ssrc-group":this.parseSSRCGroup(x);break;default:x.ignored=!0,this.attributes.unrecognized.push(x)}}catch(ie){throw console.error("parsing media attribute ".concat(x.attField,' error, "a=').concat(x.attField,":").concat(x.attValue,'"')),ie}if(!x.ignored&&x.attValue&&!this.atEnd(x))throw new Error("attribute parsing error")}parseCandidate(x){const ie=this.extractOneOrMore(x,Y,[1,32]);this.consumeAttributeSpace(x);const ue=this.extractOneOrMore(x,S,[1,5]);this.consumeAttributeSpace(x);const Qe=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const Gt=this.extractOneOrMore(x,S,[1,10]);this.consumeAttributeSpace(x);const tr=this.extract(x,this.consumeAddress);this.consumeAttributeSpace(x);const xi=this.extract(x,this.consumePort);this.consumeAttributeSpace(x),this.extract(x,this.consume,"typ"),this.consumeAttributeSpace(x);const ba={foundation:ie,componentId:ue,transport:Qe,priority:Gt,connectionAddress:tr,port:xi,type:this.extract(x,this.consumeToken),extension:{}};for(this.peek(x," raddr")&&(this.extract(x,this.consume," raddr"),this.consumeAttributeSpace(x),ba.relAddr=this.extract(x,this.consumeAddress)),this.peek(x," rport")&&(this.extract(x,this.consume," rport"),this.consumeAttributeSpace(x),ba.relPort=this.extract(x,this.consumePort));this.peekChar(x)===_;){this.consumeAttributeSpace(x);const Xp=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x),ba.extension[Xp]=this.extractOneOrMore(x,w)}this.attributes.candidates.push(ba)}parseRemoteCandidate(x){const ie=[];for(;;){const ue=this.extractOneOrMore(x,S,[1,5]);this.consumeAttributeSpace(x);const Qe=this.extract(x,this.consumeAddress);this.consumeAttributeSpace(x);const Gt=this.extract(x,this.consumePort);ie.push({componentId:ue,connectionAddress:Qe,port:Gt});try{this.consumeAttributeSpace(x)}catch{break}}this.attributes.remoteCandidatesList.push(ie)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(x){const ie=this.extract(x,this.consumeToken);this.consumeAttributeSpace(x);const ue=this.extract(x,this.consumeTill,"/");this.extract(x,this.consume,"/");const Qe={encodingName:ue,clockRate:this.extractOneOrMore(x,S)};this.atEnd(x)||this.peekChar(x)!=="/"||(this.extract(x,this.consume,"/"),Qe.encodingParameters=parseInt(this.extract(x,this.consumeTill),10));const Gt=this.attributes.payloads.find(tr=>tr.payloadType===parseInt(ie,10));Gt?Gt.rtpMap=Qe:this.attributes.payloads.push({payloadType:parseInt(ie,10),rtpMap:Qe,rtcpFeedbacks:[]})}parsePtime(x){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(x,this.consumeTill)}parseMaxPtime(x){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(x,this.consumeTill)}parseDirection(x){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=x.attField}parseSSRC(x){const ie=this.extractOneOrMore(x,S);this.consumeAttributeSpace(x);const ue=this.extract(x,this.consumeTill,":");let Qe;this.peekChar(x)===":"&&(this.extract(x,this.consume,":"),Qe=this.extract(x,this.consumeTill));const Gt=this.attributes.ssrcs.find(tr=>tr.ssrcId===parseInt(ie,10));Gt?Gt.attributes[ue]=Qe:this.attributes.ssrcs.push({ssrcId:parseInt(ie,10),attributes:{[ue]:Qe}})}parseFmtp(x){const ie=this.extract(x,this.consumeTill,_);this.consumeAttributeSpace(x);const ue=this.extract(x,this.consumeTill),Qe={};ue.split(";").forEach(tr=>{let[xi,ba]=tr.split("=");xi=Ys(xi).call(xi);const Xp=typeof ba=="string"?Ys(ba).call(ba):null;typeof xi=="string"&&xi.length>0&&(Qe[xi]=Xp)});const Gt=this.attributes.payloads.find(tr=>tr.payloadType===parseInt(ie,10));Gt?Gt.fmtp={parameters:Qe}:this.attributes.payloads.push({payloadType:parseInt(ie,10),rtcpFeedbacks:[],fmtp:{parameters:Qe}})}parseFmtParameters(x){const ie={},ue=this.extract(x,this.consumeTill,"=");x._cur++;const Qe=this.extract(x,this.consumeTill,";");for(ie[ue]=Qe;x.attValue[x._cur]===";";){const Gt=this.extract(x,this.consumeTill,"=");x._cur++;const tr=this.extract(x,this.consumeTill,";");ie[Gt]=tr}return ie}parseRtcpFb(x){let ie="";ie=this.peekChar(x)==="*"?this.extract(x,this.consume,"*"):this.extract(x,this.consumeTill,_),this.consumeAttributeSpace(x);const ue=this.extract(x,this.consumeTill,_);let Qe;if(ue==="trr-int")Qe={type:ue,interval:this.extract(x,this.consumeTill)};else{const Gt={type:ue};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),Gt.parameter=this.extract(x,this.consumeToken),this.peekChar(x)===_&&(Gt.additional=this.extract(x,this.consumeTill))),Qe=Gt}if(ie==="*")this.attributes.rtcpFeedbackWildcards.push(Qe);else{const Gt=this.attributes.payloads.find(tr=>tr.payloadType===parseInt(ie,10));Gt?Gt.rtcpFeedbacks.push(Qe):this.attributes.payloads.push({payloadType:parseInt(ie,10),rtcpFeedbacks:[Qe]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(x){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ie={port:this.extract(x,this.consumePort)};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),ie.netType=this.extractOneOrMore(x,k),this.consumeAttributeSpace(x),ie.addressType=this.extractOneOrMore(x,k),this.consumeAttributeSpace(x),ie.address=this.extract(x,this.consumeAddress)),this.attributes.rtcp=ie}parseMsid(x){const ie={id:this.extractOneOrMore(x,k,[1,64])};this.peekChar(x)===_&&(this.consumeAttributeSpace(x),ie.appdata=this.extractOneOrMore(x,k,[1,64])),this.attributes.msids.push(ie)}parseImageAttr(x){this.attributes.imageattr.push(x.attValue)}parseRid(x){const ie=this.extractOneOrMore(x,Qe=>U(Qe)||S(Qe)||Qe==="_"||Qe==="-");this.consumeAttributeSpace(x);const ue={id:ie,direction:this.extract(x,this.consumeToken),params:[]};if(this.peekChar(x)===_){if(this.consumeAttributeSpace(x),this.peek(x,"pt=")){this.extract(x,this.consume,"pt=");const Qe=[];for(;;){const Gt=this.extract(x,this.consumeToken);Qe.push(Gt);try{this.extract(x,this.consume,",")}catch{break}}ue.payloads=Qe,this.peekChar(x)===_&&this.extract(x,this.consume,_)}for(;;){const Qe=this.extract(x,this.consumeToken);switch(Qe){case"depend":{const Gt={type:Qe,rids:this.extract(x,this.consume,"=").split(",")};ue.params.push(Gt);break}default:{const Gt={type:Qe};this.peekChar(x)==="="&&(this.extract(x,this.consume,"="),Gt.val=this.extract(x,this.consumeTill,";")),ue.params.push(Gt)}}try{this.extract(x,this.consume,";")}catch{break}}}this.attributes.rids.push(ue)}parseSimulcast(x){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=x.attValue,this.extract(x,this.consumeTill)}parseSctpPort(x){this.attributes.sctpPort=this.extractOneOrMore(x,S,[1,5])}parseMaxMessageSize(x){this.attributes.maxMessageSize=this.extractOneOrMore(x,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(x){this.attributes.mid=this.extract(x,this.consumeToken)}parseSSRCGroup(x){const ie=this.extract(x,this.consumeToken),ue=[];for(;;)try{this.consumeAttributeSpace(x);const Qe=this.extract(x,this.consumeInteger);ue.push(parseInt(Qe,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ie,ssrcIds:ue})}}function cr(We,x,ie){return x in We?Object.defineProperty(We,x,{value:ie,enumerable:!0,configurable:!0,writable:!0}):We[x]=ie,We}class Zr{constructor(){cr(this,"eol",m)}print(x,ie){let ue="";return ie&&(this.eol=ie),ue+=this.printVersion(x.version),ue+=this.printOrigin(x.origin),ue+=this.printSessionName(x.sessionName),ue+=this.printInformation(x.information),ue+=this.printUri(x.uri),ue+=this.printEmail(x.emails),ue+=this.printPhone(x.phones),ue+=this.printConnection(x.connection),ue+=this.printBandwidth(x.bandwidths),ue+=this.printTimeFields(x.timeFields),ue+=this.printKey(x.key),ue+=this.printSessionAttributes(x.attributes),ue+=this.printMediaDescription(x.mediaDescriptions),ue}printVersion(x){return"v=".concat(x).concat(this.eol)}printOrigin(x){return"o=".concat(x.username," ").concat(x.sessId," ").concat(x.sessVersion," ").concat(x.nettype," ").concat(x.addrtype," ").concat(x.unicastAddress).concat(this.eol)}printSessionName(x){return x?"s=".concat(x).concat(this.eol):""}printInformation(x){return x?"i=".concat(x).concat(this.eol):""}printUri(x){return x?"u=".concat(x).concat(this.eol):""}printEmail(x){let ie="";for(const ue of x)ie+="e=".concat(ue).concat(this.eol);return ie}printPhone(x){let ie="";for(const ue of x)ie+="e=".concat(ue).concat(this.eol);return ie}printConnection(x){return x?"c=".concat(x.nettype," ").concat(x.addrtype," ").concat(x.address).concat(this.eol):""}printBandwidth(x){let ie="";for(const ue of x)ie+="b=".concat(ue.bwtype,":").concat(ue.bandwidth).concat(this.eol);return ie}printTimeFields(x){let ie="";for(const ue of x){ie+="t=".concat(ue.time.startTime," ").concat(ue.time.startTime).concat(this.eol);for(const Qe of ue.repeats)ie+="r=".concat(Qe.repeatInterval," ").concat(Qe.typedTimes.join(" ")).concat(this.eol);ue.zoneAdjustments&&(ie+="z=",ie+="z=".concat(ue.zoneAdjustments.map(Qe=>"".concat(Qe.time," ").concat(Qe.back?"-":""," ").concat(Qe.typedTime)).join(" ")).concat(this.eol),ie+=this.eol)}return ie}printKey(x){return x?"k=".concat(x).concat(this.eol):""}printAttributes(x){let ie="";for(const ue of x)ie+="a=".concat(ue.attField).concat(ue.attValue?":".concat(ue.attValue):"").concat(this.eol);return ie}printMediaDescription(x){let ie="";for(const ue of x)ie+=this.printMedia(ue.media),ie+=this.printInformation(ue.information),ie+=this.printConnections(ue.connections),ie+=this.printBandwidth(ue.bandwidths),ie+=this.printKey(ue.key),ie+=this.printMediaAttributes(ue);return ie}printConnections(x){let ie="";for(const ue of x)ie+=this.printConnection(ue);return ie}printMedia(x){return"m=".concat(x.mediaType," ").concat(x.port," ").concat(x.protos.join("/")," ").concat(x.fmts.join(" ")).concat(this.eol)}printSessionAttributes(x){return new qo(this.eol).print(x)}printMediaAttributes(x){return new je(this.eol).print(x)}}class Wr{constructor(x){cr(this,"eol",void 0),this.eol=x}printIceUfrag(x){return x===void 0?"":"a=ice-ufrag:".concat(x).concat(this.eol)}printIcePwd(x){return x===void 0?"":"a=ice-pwd:".concat(x).concat(this.eol)}printIceOptions(x){return x===void 0?"":"a=ice-options:".concat(x.join(_)).concat(this.eol)}printFingerprints(x){return x.length>0?x.map(ie=>"a=fingerprint:".concat(ie.hashFunction).concat(_).concat(ie.fingerprint)).join(this.eol)+this.eol:""}printExtmap(x){return x.map(ie=>"a=extmap:".concat(ie.entry).concat(ie.direction?"/".concat(ie.direction):"").concat(_).concat(ie.extensionName).concat(ie.extensionAttributes?"".concat(_).concat(ie.extensionAttributes):"").concat(this.eol)).join("")}printSetup(x){return x===void 0?"":"a=setup:".concat(x).concat(this.eol)}printUnrecognized(x){return x.map(ie=>"a=".concat(ie.attField).concat(ie.attValue?":".concat(ie.attValue):"").concat(this.eol)).join("")}}class qo extends Wr{print(x){let ie="";return ie+=this.printGroups(x.groups),ie+=this.printMsidSemantic(x.msidSemantic),ie+=this.printIceLite(x.iceLite),ie+=this.printIceUfrag(x.iceUfrag),ie+=this.printIcePwd(x.icePwd),ie+=this.printIceOptions(x.iceOptions),ie+=this.printFingerprints(x.fingerprints),ie+=this.printSetup(x.setup),ie+=this.printTlsId(x.tlsId),ie+=this.printIdentity(x.identities),ie+=this.printExtmap(x.extmaps),ie+=this.printUnrecognized(x.unrecognized),ie}printGroups(x){let ie="";return x.length>0&&(ie+=x.map(ue=>"a=group:".concat(ue.semantic).concat(ue.identificationTag.map(Qe=>"".concat(_).concat(Qe)).join("")).concat(this.eol)).join("")),ie}printIceLite(x){return x===void 0?"":"a=ice-lite"+this.eol}printTlsId(x){return x?"a=tls-id:".concat(x).concat(this.eol):""}printIdentity(x){return x.length===0?"":x.map(ie=>"a=identity:".concat(ie.assertionValue).concat(ie.extensions.map(ue=>"".concat(_).concat(ue.name).concat(ue.value?"=".concat(ue.value):"")))).join(this.eol)+this.eol}printMsidSemantic(x){if(!x)return"";let ie="a=msid-semantic:".concat(x.semantic);return x.applyForAll?ie+="".concat(_,"*"):x.identifierList.length>0&&(ie+=x.identifierList.map(ue=>"".concat(_).concat(ue))),ie+this.eol}}class je extends Wr{print(x){const ie=x.attributes;let ue="";return ue+=this.printRTCP(ie.rtcp),ue+=this.printIceUfrag(ie.iceUfrag),ue+=this.printIcePwd(ie.icePwd),ue+=this.printIceOptions(ie.iceOptions),ue+=this.printCandidates(ie.candidates),ue+=this.printRemoteCandidatesList(ie.remoteCandidatesList),ue+=this.printEndOfCandidates(ie.endOfCandidates),ue+=this.printFingerprints(ie.fingerprints),ue+=this.printSetup(ie.setup),ue+=this.printMid(ie.mid),ue+=this.printExtmap(ie.extmaps),ue+=this.printRTPRelated(ie),ue+=this.printPtime(ie.ptime),ue+=this.printMaxPtime(ie.maxPtime),ue+=this.printDirection(ie.direction),ue+=this.printSSRCGroups(ie.ssrcGroups),ue+=this.printSSRC(ie.ssrcs),ue+=this.printRTCPMux(ie.rtcpMux),ue+=this.printRTCPMuxOnly(ie.rtcpMuxOnly),ue+=this.printRTCPRsize(ie.rtcpRsize),ue+=this.printMSId(ie.msids),ue+=this.printImageattr(ie.imageattr),ue+=this.printRid(ie.rids),ue+=this.printSimulcast(ie.simulcast),ue+=this.printSCTPPort(ie.sctpPort),ue+=this.printMaxMessageSize(ie.maxMessageSize),ue+=this.printUnrecognized(ie.unrecognized),ue}printCandidates(x){return x.map(ie=>"a=candidate:".concat(ie.foundation).concat(_).concat(ie.componentId).concat(_).concat(ie.transport).concat(_).concat(ie.priority).concat(_).concat(ie.connectionAddress).concat(_).concat(ie.port).concat(_,"typ").concat(_).concat(ie.type).concat(ie.relAddr?"".concat(_,"raddr").concat(_).concat(ie.relAddr):"").concat(ie.relPort?"".concat(_,"rport").concat(_).concat(ie.relPort):"").concat(Object.keys(ie.extension).map(ue=>"".concat(_).concat(ue).concat(_).concat(ie.extension[ue])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(x){return x.map(ie=>"a=remote-candidates:".concat(ie.join(_)).concat(this.eol)).join("")}printEndOfCandidates(x){return x===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(x){if(!x.payloads)return"";const ie=x.payloads;let ue="";ue+=x.rtcpFeedbackWildcards.map(Qe=>this.printRTCPFeedback("*",Qe)).join("");for(const Qe of ie)ue+=this.printRtpMap(Qe.payloadType,Qe.rtpMap),ue+=this.printFmtp(Qe.payloadType,Qe.fmtp),ue+=Qe.rtcpFeedbacks.map(Gt=>this.printRTCPFeedback(Qe.payloadType,Gt)).join("");return ue}printFmtp(x,ie){if(!ie)return"";const ue=Object.keys(ie.parameters);return ue.length===1&&ie.parameters[ue[0]]===null?"a=fmtp:".concat(x).concat(_).concat(ue[0]).concat(this.eol):"a=fmtp:".concat(x).concat(_).concat(Object.keys(ie.parameters).map(Qe=>"".concat(Qe,"=").concat(ie.parameters[Qe])).join(";")).concat(this.eol)}printRtpMap(x,ie){return ie?"a=rtpmap:".concat(x).concat(_).concat(ie.encodingName,"/").concat(ie.clockRate).concat(ie.encodingParameters?"/".concat(ie.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(x,ie){let ue="a=rtcp-fb:".concat(x).concat(_),Qe=ie;return Qe.type==="trr-int"?ue+="ttr-int".concat(_).concat(Qe.interval):(ue+="".concat(Qe.type),Qe.parameter&&(ue+="".concat(_).concat(Qe.parameter),Qe.additional&&(ue+="".concat(_).concat(Qe.additional)))),ue+this.eol}printPtime(x){return x===void 0?"":"a=ptime:".concat(x).concat(this.eol)}printMaxPtime(x){return x===void 0?"":"a=maxptime:".concat(x).concat(this.eol)}printDirection(x){return x===void 0?"":"a=".concat(x).concat(this.eol)}printSSRC(x){return x.map(ie=>Object.keys(ie.attributes).map(ue=>"a=ssrc:".concat(ie.ssrcId.toString(10)).concat(_).concat(ue).concat(ie.attributes[ue]?":".concat(ie.attributes[ue]):"").concat(this.eol)).join("")).join("")}printRTCPMux(x){return x===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(x){return x===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(x){return x===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(x){if(x===void 0)return"";let ie="a=rtcp:".concat(x.port);return x.netType&&(ie+="".concat(_).concat(x.netType)),x.addressType&&(ie+="".concat(_).concat(x.addressType)),x.address&&(ie+="".concat(_).concat(x.address)),ie+this.eol}printMSId(x){return x.map(ie=>"a=msid:".concat(ie.id).concat(ie.appdata?"".concat(_).concat(ie.appdata):"").concat(this.eol)).join("")}printImageattr(x){return x.map(ie=>"a=imageattr:".concat(ie).concat(this.eol)).join("")}printRid(x){return x.map(ie=>{let ue="a=rid:".concat(ie.id).concat(_).concat(ie.direction);return ie.payloads&&(ue+="".concat(_,"pt=").concat(ie.payloads.join(","))),ie.params.length>0&&(ue+="".concat(_).concat(ie.params.map(Qe=>Qe.type==="depend"?"depend=".concat(Qe.rids.join(",")):"".concat(Qe.type,"=").concat(Qe.val)).join(";"))),ue+this.eol}).join("")}printSimulcast(x){return x===void 0?"":"a=simulcast:".concat(x).concat(this.eol)}printSCTPPort(x){return x===void 0?"":"a=sctp-port:".concat(x).concat(this.eol)}printMaxMessageSize(x){return x===void 0?"":"a=max-message-size:".concat(x).concat(this.eol)}printMid(x){return x===void 0?"":"a=mid:".concat(x).concat(this.eol)}printSSRCGroups(x){return x.map(ie=>"a=ssrc-group:".concat(ie.semantic).concat(ie.ssrcIds.map(ue=>"".concat(_).concat(ue.toString(10))).join("")).concat(this.eol)).join("")}}function st(We){return new ut().parse(We)}function vt(We,x){return new Zr().print(We,x)}}},n={};function i(o){if(n[o])return n[o].exports;var c=n[o]={exports:{}};return e[o](c,c.exports,i),c.exports}return i.d=(o,c)=>{for(var u in c)i.o(c,u)&&!i.o(o,u)&&Object.defineProperty(o,u,{enumerable:!0,get:c[u]})},i.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),i.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},i(8)})();function ya(e){return LW.parse(e)}function vm(e,n){return LW.print(e,n)}var qhe=Fa("Array").keys,Yhe=fc,Xhe=hi,Jhe=N,Qhe=qhe,PL=Array.prototype,Zhe={DOMTokenList:!0,NodeList:!0},epe=function(e){var n=e.keys;return e===PL||Jhe(PL,e)&&n===PL.keys||Xhe(Zhe,Yhe(e))?Qhe:n},Pc=l(epe);function xW(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function nn(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?xW(Object(i),!0).forEach(function(o){Mr(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):xW(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Mr(e,n,i){return(n=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(n))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}const MW=new class extends Ar{constructor(){super(...arguments),Mr(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:n}=e;n[n.length-1]&&n[n.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=n[n.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class tpe{constructor(n){Mr(this,"logger",void 0),Mr(this,"prefixLists",[]),this.logger=n}debug(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];this.logger.debug(...this.prefixLists,...i)}info(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];this.logger.info(...this.prefixLists,...i)}warning(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];this.logger.warning(...this.prefixLists,...i)}error(){for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];this.logger.error(...this.prefixLists,...i)}prefix(n){return this.prefixLists.push(n),this}popPrefix(){return this.prefixLists.pop(),this}}function OL(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function UW(){const e=new Date,n=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return n?(n==null?void 0:n[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const fl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},CA=Date.now(),sb=e=>{for(const n in fl)if(Object.prototype.hasOwnProperty.call(fl,n)&&fl[n]===e)return n;return"DEFAULT"},D=new class{constructor(){Mr(this,"proxyServerURL",void 0),Mr(this,"logLevel",fl.DEBUG),Mr(this,"uploadState","collecting"),Mr(this,"uploadLogWaitingList",[]),Mr(this,"uploadLogUploadingList",[]),Mr(this,"uploadErrorCount",0),Mr(this,"currentLogID",0),Mr(this,"url",void 0),Mr(this,"extLog",(e,n)=>{this.appendLogToWaitingList(e,...n)})}debug(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[fl.DEBUG].concat(n);this.log.apply(this,o)}info(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[fl.INFO].concat(n);this.log.apply(this,o)}warning(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[fl.WARNING].concat(n);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[fl.ERROR].concat(n);this.log.apply(this,o)}upload(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=[fl.DEBUG].concat(n);this.uploadLog.apply(this,o)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){Xn("UPLOAD_LOG",!0)}disableLogUpload(){Xn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new tpe(this).prefix(e)}log(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];if(Date.now()-CA<100)return void setTimeout(()=>{this.log(...n)},Date.now()-CA);const o=Math.max(0,Math.min(4,n[0]));if(n[0]=OL()+" Agora-SDK [".concat(sb(o),"]:"),this.appendLogToWaitingList(o,...n),o<this.logLevel)return;const c=OL()+" %cAgora-SDK [".concat(sb(o),"]:");let u=[];if(!re("USE_NEW_LOG"))switch(o){case fl.DEBUG:u=[c,"color: #64B5F6;"].concat(n.slice(1)),console.log.apply(console,u);break;case fl.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(n.slice(1)),console.log.apply(console,u);break;case fl.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(n.slice(1)),console.warn.apply(console,u);break;case fl.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(n.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];if(Date.now()-CA<100)return void setTimeout(()=>{this.uploadLog(...n)},Date.now()-CA);const o=Math.max(0,Math.min(4,n[0]));n[0]=OL()+" Agora-SDK [".concat(sb(o),"]:"),this.appendLogToWaitingList(o,...n)}appendLogToWaitingList(e){if(!re("UPLOAD_LOG"))return;for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];Array.isArray(i[0])?i[0][0]=UW()+" Agora-SDK [".concat(sb(e),"]:"):i[0]=UW()+" Agora-SDK [".concat(sb(e),"]:");let c="";i.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,n={sdk_version:pl,process_id:re("PROCESS_ID"),payload:JSON.stringify(e)};return cd(async()=>{const i=await Wo.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(re("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(re("LOG_UPLOAD_SERVER"),"/upload/v1")),n,{responseType:"text"});if(i.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=i,o}},()=>(this.uploadLogUploadingList=[],!1),i=>{const o={status:-1,message:i.message,errorRange:e.map(c=>c.log_item_id)};return i.response?(o.status=i.response.status,o.data=i.response.data,o.headers=i.response.headers):i.request&&(o.status=i.request.status),MW.reportLogUploadError(o),!0},{timeout:re("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:re("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,re("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),re("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var VW;function npe(e){return Zi(e.reportId,"params.reportId",0,100,!1),Zi(e.category,"params.category",0,100,!1),Zi(e.event,"params.event",0,100,!1),Zi(e.label,"params.label",0,100,!1),er(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(VW={}).FREE="free",VW.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const rpe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Di=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),br=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let ipe=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function xt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(n,i,o){const c=o.value;if(typeof c=="function"){const u=e.className||n.__className__||(n.constructor.name==="AgoraRTCClient"?"Client":n.constructor.name);o.value=function(){for(var h,m=arguments.length,_=new Array(m),y=0;y<m;y++)_[y]=arguments[y];let S=_;if(e.argsMap)try{S=e.argsMap(this,..._)}catch(A){D.warning(A),S=[]}try{JSON.stringify(S)}catch{D.warning("arguments for method ".concat(u,".").concat(String(i)," not serializable for apiInvoke.")),S=[]}const w=(e.report||wt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(i)),options:S,tag:Lr.TRACER,reportResult:e.reportResult},e.throttleTime);try{const A=c.apply(this,_);return A instanceof lt?A.then(k=>(w.onSuccess(e.reportResult&&k),k)).catch(k=>{throw w.onError(k),k}):(w.onSuccess(e.reportResult&&A),A)}catch(A){throw w.onError(A),A}}}return o}}const wt=new class{constructor(){Mr(this,"baseInfoMap",new Map),Mr(this,"proxyServer",void 0),Mr(this,"eventUploadTimer",void 0),Mr(this,"setSessionIdTimer",void 0),Mr(this,"url",void 0),Mr(this,"sids",new Set),Mr(this,"backupUrl",void 0),Mr(this,"_appId",void 0),Mr(this,"_aid",0),Mr(this,"keyEventUploadPendingItems",[]),Mr(this,"normalEventUploadPendingItems",[]),Mr(this,"apiInvokeUploadPendingItems",[]),Mr(this,"apiInvokeCount",0),Mr(this,"apiInvokeLoggedCount",0),Mr(this,"ltsList",[]),Mr(this,"lastSendNormalEventTime",Date.now()),Mr(this,"customReportCounterTimer",void 0),Mr(this,"customReportCount",0),Mr(this,"extApiInvoke",async e=>{for(const n of e){const i=nn(nn({},n),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Lr.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),re("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),re("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,n=>{let[i,o]=n;return i+o}),16)||0}reportApiInvoke(e,n,i){n.timeout=n.timeout||6e4,n.reportResult=n.reportResult===void 0||n.reportResult;const o=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!re("SHOW_REPORT_INVOKER_LOG"),h=!!re("SHOW_REPORT_USER_INVOKER_LOG"),m=u||h&&n.id;m&&(this.apiInvokeLoggedCount+=1);const _=this.apiInvokeLoggedCount;function y(k,W){if(m){let U="[apiInvoke-".concat(_,"]");n.id&&(U+="[".concat(n.id,"]")),n.name&&(U+="[".concat(n.name,"]")),D.info("".concat(U," ").concat(k),k==="start"?n.options:W||"")}}const S=()=>({tag:n.tag,invokeId:c,sid:e,name:n.name,apiInvokeTime:o,options:n.options,states:n.states||null});y("start");let w=!1;es(n.timeout).then(()=>{w||(this.sendApiInvoke(nn(nn({},S()),{},{error:X.API_INVOKE_TIMEOUT,success:!1})),y("timeout"))});const A=new Le(X.UNEXPECTED_ERROR,"".concat(n.name,": this api invoke is end"));return{onSuccess:k=>{const W=()=>{if(w)throw A;return w=!0,this.sendApiInvoke(nn(nn({},S()),{},{success:!0},n.reportResult&&{result:k})),y("onSuccess"),k};return i?_W(W,n.name+"Success",i,()=>w=!0):W()},onError:k=>{const W=()=>{if(w)throw k;w=!0,this.sendApiInvoke(nn(nn({},S()),{},{success:!1,error:k})),y("onFailure",k.toString())};return i?_W(W,n.name+"Error",i,()=>w=!0):W()}}}sessionInit(e,n){if(this.baseInfoMap.has(e))return;const i=Date.now(),o=this.createBaseInfo(e,i);o.cname=n.cname;const c=Object.assign({},{willUploadConsoleLog:re("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:RL?"global":"oversea",areas:re("AREAS")&&re("AREAS").join(",")},n.extend),{stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:y,clientRole:S}=n,w=Date.now(),A=nn(nn({},o),{},{eventType:Di.SESSION_INIT,appid:n.appid,browser:navigator.userAgent,buildFormat:n.buildFormat,build:IL,lts:w,elapse:w-i,extend:JSON.stringify(c),mode:n.mode,process:re("PROCESS_ID"),appType:re("APP_TYPE"),success:!0,version:pl,stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:_,lsid:y,clientType:ot(k=window.navigator.userAgent).call(k,"AgoraWebView")?42:20,clientRole:S,serviceId:re("PROCESS_ID"),extensionID:re("PLUGIN_INFO").join(",")||""});var k;this.send({type:br.SESSION,data:A},!0)}joinChooseServer(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn({},o),{},{role:n.role,eventType:Di.JOIN_CHOOSE_SERVER,lts:c,eventElapse:n.elapse||c-n.lts,chooseServerAddr:n.csAddr,errorCode:n.ec,elapse:c-i.startTime,success:n.succ,chooseServerAddrList:JSON.stringify(n.serverList),uid:n.uid?parseInt(n.uid):null,cid:n.cid?parseInt(n.cid):null,chooseServerIp:n.csIp||"",opid:n.opid,unilbsServerIds:n.unilbsServerIds,extend:n.extend||void 0,isHttp3:n.isHttp3,corssRegionTagReq:n.corssRegionTagReq||void 0,corssRegionTagRes:n.corssRegionTagRes||void 0});this.send({type:br.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn({},o),{},{eventType:Di.REQ_USER_ACCOUNT,lts:c,success:n.success,serverAddress:n.serverAddr,stringUid:n.stringUid,uid:n.uid,errorCode:n.errorCode,elapse:n.elapse||c-i.startTime,eventElapse:c-n.lts,extend:JSON.stringify(n.extend)});this.send({type:br.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info;n.vid&&(o.vid=n.vid),o.uid=n.uid,o.cid=n.cid;const c=Date.now(),{firstSuccess:u,avoidJoinStartTime:h,addr:m,isProxy:_}=n,y=c-(u&&h?h:i.startTime),S=nn(nn({},o),{},{eventType:Di.JOIN_GATEWAY,lts:c,gatewayAddr:n.addr,success:n.succ,errorCode:n.ec,errorMsg:n.errorMsg||"",elapse:y,eventElapse:c-n.lts,firstSuccess:u,signalChannel:n.signalChannel,preload:n.preload?1:0,installId:wL(),isABTestSuccess:n.isABTestSuccess?1:0}),w=S.success?1:0;if(n.succ&&(i.lastJoinSuccessTime=c),u)this.send({type:br.JOIN_GATEWAY,data:S},!0);else{let A;if(m)if(_){const W=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),U=m.match(/p=[0-9]{1,6}/g);A={isSuccess:w,gatewayIp:W&&W.length?W[0].split("=")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split("=")[1]:"",isProxy:_?1:0}}else{const W=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),U=m.match(/(:|p=)[0-9]{1,6}/g);A={isSuccess:w,gatewayIp:W&&W.length?W[0].split("//")[1].replace(/-/g,"."):"",port:U&&U.length?U[0].split(/:|p=/g)[1]:"",isProxy:_?1:0}}else A={isSuccess:w,gatewayIp:"",port:"",isProxy:_?1:0};delete S.success,delete S.eventType,delete S.firstSuccess,S.vid=Number(S.vid);const k=Object.assign({},S,A,{eventType:Di.REJOIN_GATEWAY});this.send({type:br.RE_JOIN_GATEWAY,data:k},!0)}}joinChannelTimeout(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=Date.now(),c=nn(nn({},i.info),{},{lts:o,timeout:n,elapse:o-i.startTime});this.send({type:br.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn({},o),{},{eventType:Di.PUBLISH,lts:c,eventElapse:n.eventElapse,elapse:c-i.startTime,success:n.succ,errorCode:n.ec,videoName:n.videoName,audioName:n.audioName,screenName:n.screenName,screenshare:n.screenshare,audio:n.audio,video:n.video,p2pid:n.p2pid,publishRequestid:n.publishRequestid});this.send({type:br.PUBLISH,data:u},!0)}subscribe(e,n,i){const o=this.baseInfoMap.get(e);if(!o)return;const c=o.info,u=Date.now(),h=nn(nn({},c),{},{eventType:Di.SUBSCRIBE,lts:u,eventElapse:n.eventElapse,elapse:u-o.startTime,success:n.succ,errorCode:n.ec,video:n.video,audio:n.audio,subscribeRequestid:n.subscribeRequestid,p2pid:n.p2pid,preSsrc:n.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof n.peerid=="string"?h.peerSuid=n.peerid:h.peer=n.peerid,this.send({type:br.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var n;const i=[...Pc(n=this.baseInfoMap).call(n)],o=i.length?i[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;const u=c.info,h=Date.now(),m=nn(nn({},u),{},{eventType:Di.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-c.startTime,status:e.status?1:2});this.send({type:br.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(e,n,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=nn(nn(nn({},u),o),{},{elapse:h-c.startTime,eventType:n,lts:h,firstDecodeFrame:Math.max((o.firstFrame||h)-c.startTime,0),apEnd:Math.max(o.apEnd-c.startTime,0),apStart:Math.max(o.apStart-c.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-c.startTime,0),joinGwStart:Math.max(o.joinGwStart-c.startTime,0),pcEnd:Math.max(o.pcEnd-c.startTime,0),pcStart:Math.max(o.pcStart-c.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-c.startTime,0),subscriberStart:Math.max(o.subscriberStart-c.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-c.startTime,0)});this.send({type:i,data:m},!0)}firstRemoteFrame(e,n,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=nn(nn(nn({},u),o),{},{elapse:h-c.startTime,eventType:n,lts:h});this.send({type:i,data:m},!0)}abTest(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn(nn({},o),n),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-i.startTime,eventType:Di.AB_TEST,lts:c});this.send({type:br.AB_TEST,data:u},!0)}pcStats(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn(nn({},o),n),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-i.startTime,eventType:Di.PC_STATS,lts:c,preallocation:n.preallocation?1:0});this.send({type:br.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(e,n){if(e){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn(nn({},o),n),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:Di.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:br.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(e,n,i,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=nn(nn(nn({},u),o),{},{eventType:n,lts:h});this.send({type:i,data:m},!0)}streamSwitch(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn({},o),{},{eventType:Di.STREAM_SWITCH,lts:c,isDual:n.isdual,elapse:c-i.startTime,success:n.succ});this.send({type:br.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn({},o),{},{eventType:Di.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-n.lts,elapse:c-i.startTime,APAddr:n.APAddr,workerManagerList:n.workerManagerList,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:br.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn({},o),{},{eventType:Di.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-n.lts,elapse:c-i.startTime,workerManagerAddr:n.workerManagerAddr,response:n.response,errorCode:n.ec,success:n.succ});this.send({type:br.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(e){this.proxyServer=e,e?D.debug("reportProxyServerurl: ".concat(e)):D.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn({},o),{},{subscribeElapse:n.subscribeElapse,peer:n.peer,peerPublishDuration:Math.max(n.audioPublishDuration,n.videoPublishDuration),audiotag:n.audioPublishDuration>0?1:-1,videotag:n.videoPublishDuration>0?1:-1,lts:c,elapse:c-i.startTime,joinChannelSuccessElapse:c-(i.lastJoinSuccessTime||c),peerPublishDurationVideo:n.videoPublishDuration,peerPublishDurationAudio:n.audioPublishDuration});this.send({type:br.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now();(function(u,h,m){const _=u[h];if(!_||typeof _!="string")return[u];u[h]="";const y=ah(JSON.stringify(u));let S=0;const w=[];let A=0;for(let k=0;k<_.length;k++)A+=_.charCodeAt(k)<=127?1:3,A<=m-y||(w[w.length]=ft(ft({},u),{},{[h]:_.substring(S,k)}),S=k,A=_.charCodeAt(k)<=127?1:3);return S!==_.length-1&&(w[w.length]=ft(ft({},u),{},{[h]:_.substring(S)})),w})(nn(nn(nn({},o),n),{},{elapse:c-i.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:br.WORKER_EVENT,data:u},!0))}apworkerEvent(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn(nn({},o),n),{},{elapse:c-i.startTime,lts:c});this.send({type:br.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn(nn({},o),n),{},{elapse:c-i.startTime,lts:c,extend:n.extend||void 0});this.send({type:br.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(e,n){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,c=Date.now(),u=nn(nn(nn({},o),n),{},{elapse:c-i.startTime,lts:c});this.send({type:br.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(e,n){if(this.customReportCount+=n.length,this.customReportCount>re("CUSTOM_REPORT_LIMIT"))throw new Le(X.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),o=n.map(c=>({type:br.USER_ANALYTICS,data:nn(nn({sid:e},c),{},{lts:i})}));try{re("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(c){throw D.error("send custom report message failed",c.toString()),new Le(X.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){const n=re("NOT_REPORT_EVENT");if(e.tag&&ot(n)&&ot(n).call(n,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const i=this.baseInfoMap.get(e.sid);if(!i)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:o,uid:c,cid:u}=i.info;let h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Le){const{code:_,message:y}=e.error;h=_||y||e.error.toString()}else h=e.error.toString();const m={invokeId:e.invokeId,sid:e.sid,cname:o,cid:u,uid:c,lts:e.lts,success:e.success,elapse:e.lts-i.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:br.API_INVOKE,data:m},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const n=Array.from(this.sids).find(i=>i!==null);n&&e.forEach(i=>{i&&(i.sid=n,this.sendApiInvoke(Object.assign({},i)))}),e.length=0}send(e,n){if(n)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>re("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,n){const i=[],o=[];for(;e.length;){const u=e.shift();i.length<20?i.push(u):o.push(u)}e.push(...o);for(const u of[...i]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),VT(c=this.ltsList).call(c,(h,m)=>h-m))}return n||(this.lastSendNormalEventTime=Date.now()),re("ENABLE_EVENT_REPORT")&&i.length&&(re("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((u=>h=>{re("EVENT_REPORT_RETRY")&&(n?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>re("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-re("NORMAL_EVENT_QUEUE_CAPACITY")),D.warning("report: drop normal events"))))})(i)),e}async postDataToStatsCollector2(e){oi.networkState===Ka.OFFLINE&&await lt.race([oi.onlineWaiter,es(2*gi.maxRetryTimeout)]);const n=c=>{let u=new Uint8Array;return c.forEach(h=>{const m=hL(JSON.stringify(h.data)),_=new ArrayBuffer(5),y=(w=>{let A=0;return Object.entries(br).forEach(k=>{let[W,U]=k;U===w.type&&(A=ipe[W])}),A})(h),S=new DataView(_);S.setUint16(0,m.byteLength,!0),S.setUint8(2,255&y),S.setUint8(3,y>>>8&255),S.setUint8(4,y>>>16&255),u=cW(u,new Uint8Array(_)),u=cW(u,m)}),u},i="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(re("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let c=0;c<2;c+=1){c===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(re("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await yL(o,{timeout:1e4,data:n(e),headers:nn(nn({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=(m=>{const _=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return _&&_.info.vid&&+_.info.vid||0})(e[0]),o=i?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(m=>JSON.stringify(m)),vid:i,aid:o};oi.networkState===Ka.OFFLINE&&await lt.race([oi.onlineWaiter,es(2*gi.maxRetryTimeout)]);const u=n?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("EVENT_REPORT_DOMAIN"),"&p=").concat(re("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(re("EVENT_REPORT_DOMAIN"),":").concat(re("STATS_COLLECTOR_PORT")).concat(u));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(re("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(re("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(re("STATS_COLLECTOR_PORT")).concat(u)));try{n?await zhe(h,{timeout:1e4,data:c}):await yL(h,{timeout:1e4,data:c})}catch(_){if(m===1)throw _;continue}return}}createBaseInfo(e,n){const i=Object.assign({},rpe);return i.sid=e,this.baseInfoMap.set(e,{info:i,startTime:n}),i}reportResourceTiming(e,n){const i=performance.getEntriesByName(e),o=i[i.length-1];o&&this.reportApiInvoke(n,{name:"Client.resourceTiming",options:o,tag:Lr.TRACER}).onSuccess()}};MW.on("REPORT_LOG_UPLOAD",e=>{e.networkState=oi.networkState,wt.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Lr.TRACER}).onSuccess("logUploadError")});class Oe extends Le{constructor(n){super(n,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Mr(this,"name","AgoraRTCException")}print(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(n,D)}throw(){super.throw(D)}}const ts={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function kn(){return ts}function FW(){return"setSinkId"in HTMLAudioElement.prototype&&(!re("RESTRICTION_SET_PLAYBACK_DEVICE")||(xp()||X6())&&!lL())}function jW(){return!ts.supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Mp()}let ns=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function yv(e,n,i){return{sampleRate:e,stereo:n,bitrate:i}}function Cn(e,n,i,o,c){return{width:e,height:n,frameRate:i,bitrateMin:o,bitrateMax:c}}function ru(e,n,i,o,c){return{width:{max:e},height:{max:n},frameRate:i,bitrateMin:o,bitrateMax:c}}function kL(e,n){return{numSpatialLayers:e,numTemporalLayers:n}}const spe={"90p":Cn(160,90),"90p_1":Cn(160,90),"120p":Cn(160,120,15,30,65),"120p_1":Cn(160,120,15,30,65),"120p_3":Cn(120,120,15,30,50),"120p_4":Cn(212,120),"180p":Cn(320,180,15,30,140),"180p_1":Cn(320,180,15,30,140),"180p_3":Cn(180,180,15,30,100),"180p_4":Cn(240,180,15,30,120),"240p":Cn(320,240,15,40,200),"240p_1":Cn(320,240,15,40,200),"240p_3":Cn(240,240,15,40,140),"240p_4":Cn(424,240,15,40,220),"360p":Cn(640,360,15,80,400),"360p_1":Cn(640,360,15,80,400),"360p_3":Cn(360,360,15,80,260),"360p_4":Cn(640,360,30,80,600),"360p_6":Cn(360,360,30,80,400),"360p_7":Cn(480,360,15,80,320),"360p_8":Cn(480,360,30,80,490),"360p_9":Cn(640,360,15,80,800),"360p_10":Cn(640,360,24,80,800),"360p_11":Cn(640,360,24,80,1e3),"480p":Cn(640,480,15,100,500),"480p_1":Cn(640,480,15,100,500),"480p_2":Cn(640,480,30,100,1e3),"480p_3":Cn(480,480,15,100,400),"480p_4":Cn(640,480,30,100,750),"480p_6":Cn(480,480,30,100,600),"480p_8":Cn(848,480,15,100,610),"480p_9":Cn(848,480,30,100,930),"480p_10":Cn(640,480,10,100,400),"720p":Cn(1280,720,15,120,1130),"720p_auto":Cn(1280,720,30,900,3e3),"720p_1":Cn(1280,720,15,120,1130),"720p_2":Cn(1280,720,30,120,2e3),"720p_3":Cn(1280,720,30,120,1710),"720p_5":Cn(960,720,15,120,910),"720p_6":Cn(960,720,30,120,1380),"1080p":Cn(1920,1080,15,120,2080),"1080p_1":Cn(1920,1080,15,120,2080),"1080p_2":Cn(1920,1080,30,120,3e3),"1080p_3":Cn(1920,1080,30,120,3150),"1080p_5":Cn(1920,1080,60,120,4780),"1440p":Cn(2560,1440,30,120,4850),"1440p_1":Cn(2560,1440,30,120,4850),"1440p_2":Cn(2560,1440,60,120,7350),"4k":Cn(3840,2160,30,120,8910),"4k_1":Cn(3840,2160,30,120,8910),"4k_3":Cn(3840,2160,60,120,13500)},ope={"480p":ru(640,480,5),"480p_1":ru(640,480,5),"480p_2":ru(640,480,30),"480p_3":ru(640,480,15),"720p":ru(1280,720,5),"720p_auto":Cn(1280,720,30,900,3e3),"720p_1":ru(1280,720,5),"720p_2":ru(1280,720,30),"720p_3":ru(1280,720,15),"1080p":ru(1920,1080,5),"1080p_1":ru(1920,1080,5),"1080p_2":ru(1920,1080,30),"1080p_3":ru(1920,1080,15)},ape={"1SL1TL":kL(1,1),"3SL3TL":kL(3,3),"2SL3TL":kL(2,3)};function lh(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},spe[e]):e}function NL(e){return typeof e=="string"?Object.assign({},ope[e]):e}function IA(e){return typeof e=="string"?Object.assign({},ape[e]):e}const cpe={speech_low_quality:yv(16e3,!1),speech_standard:yv(32e3,!1,18),music_standard:yv(48e3,!1),standard_stereo:yv(48e3,!0,56),high_quality:yv(48e3,!1,128),high_quality_stereo:yv(48e3,!0,192)};function AA(e){return typeof e=="string"?Object.assign({},cpe[e]):e}const vv=[];function BW(e){return Ci(e,"mediaSource",["screen","window","application"]),!0}let gt=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),ar=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Sv=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),lpe=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),upe=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),b_=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),Tv=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),bv=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),wv=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Oc=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const DL={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},LL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},WW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},dpe={uplinkNetworkQuality:0,downlinkNetworkQuality:0},zW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let go=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),kc=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),ob=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),w_=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Xs=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),uh=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const xL={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let PA=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function GW(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function wr(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?GW(Object(i),!0).forEach(function(o){Pe(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):GW(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Pe(e,n,i){return(n=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var _=m.call(u,"string");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(n))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}function In(e,n,i,o,c){var u,h,m={};return Object.keys(o).forEach(function(_){m[_]=o[_]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=ja(u=Hf(h=i.slice()).call(h)).call(u,function(_,y){return y(e,n,_)||_},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(e,n,m),m=null),m}class HW extends Ar{set _mediaStreamTrack(n){n!==this.mediaStreamTrack&&(this.safeEmit(b_.TRACK_UPDATED,n),this.mediaStreamTrack=n)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(n,i){super(),Pe(this,"trackMediaType",void 0),Pe(this,"_ID",void 0),Pe(this,"_rtpTransceiver",void 0),Pe(this,"_lowRtpTransceiver",void 0),Pe(this,"_hints",[]),Pe(this,"_isClosed",!1),Pe(this,"_originMediaStreamTrack",void 0),Pe(this,"mediaStreamTrack",void 0),Pe(this,"_external",{}),this._ID=i||or(8,"track-"),this._originMediaStreamTrack=n,this.mediaStreamTrack=n,function(o){ot(vv).call(vv,o)||vv.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(n){return n||Em(()=>{var i;wt.reportApiInvoke(null,{name:mi.GET_MEDIA_STREAM_TRACK,options:[],tag:Lr.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(n){return n===Sv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(n){const i=vv.indexOf(n);i!==-1&&vv.splice(i,1)}(this),this.emit(Tv.CLOSED),this.removeAllListeners(b_.SEI_RECEIVED)}_updateRtpTransceiver(n,i){if(i===Sv.LOW_STREAM){if(this._lowRtpTransceiver===n)return;this._lowRtpTransceiver=n}else{if(this._rtpTransceiver===n)return;this._rtpTransceiver=n}this.emit(b_.TRANSCEIVER_UPDATED,n,i)}}class Rv extends HW{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(n,i){super(n,i),Pe(this,"_enabled",!0),Pe(this,"_muted",!1),Pe(this,"_isExternalTrack",!1),Pe(this,"_isClosed",!1),Pe(this,"_enabledMutex",void 0),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Cs("".concat(this.getTrackId())),n.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var n,i;return(n=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&n!==void 0?n:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,D.debug("[".concat(this.getTrackId(),"] close")),this.emit(gt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(n,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,n!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),n.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=n,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sr(this,gt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){D.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Tv.TRACK_ENDED)}stateCheck(n,i){if(D.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(n,": ").concat(i,"]")),Up(i,n),this._enabled&&this._muted&&n==="enabled"&&i===!1)throw new Le(X.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",D);if(!this._enabled&&!this._muted&&n==="muted"&&i===!0)throw new Le(X.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",D)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():lt.resolve([])}}const $W=window.AudioContext||window.webkitAudioContext;let Nc=null;const Jn=new class extends Ar{constructor(){super(...arguments),Pe(this,"prevState",void 0),Pe(this,"curState",void 0),Pe(this,"currentTime",void 0),Pe(this,"currentTimeStuckAt",void 0),Pe(this,"interruptDetectorTrack",void 0),Pe(this,"onLocalAudioTrackMute",()=>{D.info("ios15-interruption-start"),this.emit(ns.IOS_15_16_INTERRUPTION_START)}),Pe(this,"onLocalAudioTrackUnmute",async()=>{D.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?D.info("ios15-interruption-end-canceled"):(Nc&&await Nc.suspend(),this.emit(ns.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){D.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){D.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Cv(){if(!Nc){if(function(){if(!$W)return void D.error("your browser is not support web audio");D.info("create audio context");const e=wr({},re("WEBAUDIO_INIT_OPTIONS"));D.debug("audio context init option:",JSON.stringify(e)),Nc=new $W(e),Jn.curState=Nc.state,Nc.onstatechange=()=>{Jn.prevState=Jn.curState,Jn.curState=Nc?Nc.state:void 0;const{prevState:n,curState:i}=Jn,o=i==="running",c=i==="interrupted",u=n==="running",h=n==="suspended",m=n==="interrupted",_=Rn().osVersion;(mo()||tu())&&u&&c&&(D.info("ios".concat(_,"-interruption-start")),Jn.emit(ns.IOS_INTERRUPTION_START)),(mo()||tu())&&(h||m)&&o&&(D.info("ios".concat(_,"-interruption-end")),Jn.emit(ns.IOS_INTERRUPTION_END)),n!==i&&Jn.emit(ns.STATE_CHANGE,i,n)},setInterval(()=>{var n;const i=(n=Nc)===null||n===void 0?void 0:n.currentTime;Jn.currentTime!==i?(Jn.currentTimeStuckAt&&(D.debug("AudioContext current time resume at ".concat(i)),Jn.currentTimeStuckAt=void 0),Jn.currentTime=i):(i!==Jn.currentTimeStuckAt&&(wt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:Lr.TRACER}).onSuccess(),D.warning("AudioContext current time stuck at ".concat(i))),Jn.currentTimeStuckAt=i)},5e3),async function(n){const i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,c=!1,u=!1,h=!1;function m(U){n.state==="running"?_(!1):mo()||tu()?n.state==="suspended"&&(_(!0),U&&n.resume().then(y,y)):n.state!=="closed"&&(_(!0),U&&n.resume().then(y,y))}function _(U){if(c!==U){c=U;for(let V=0,q=i;V<q.length;V+=1){const Y=q[V];U?window.addEventListener(Y,S,{capture:!0,passive:!0}):window.removeEventListener(Y,S,{capture:!0,passive:!0})}}}function y(){m(!1)}function S(){m(!0)}function w(U){if(!h)if(o.paused)if(U){let V;A(!1),h=!0;try{V=o.play(),V?V.then(k,k):(o.addEventListener("playing",k),o.addEventListener("abort",k),o.addEventListener("error",k))}catch{k()}}else A(!0);else A(!1)}function A(U){if(u!==U){u=U;for(let V=0,q=i;V<q.length;V++){const Y=q[V];U?window.addEventListener(Y,W,{capture:!0,passive:!0}):window.removeEventListener(Y,W,{capture:!0,passive:!0})}}}function k(){o.removeEventListener("playing",k),o.removeEventListener("abort",k),o.removeEventListener("error",k),h=!1,w(!1)}function W(){w(!0)}if(mo()){const U=n.createMediaStreamDestination(),V=document.createElement("div");V.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=V.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=U.stream,w(!0)}Jn.on(ns.STATE_CHANGE,function(){m(!0)}),m(!1)}(Nc)}(),!Nc)throw new Le(X.NOT_SUPPORTED,"can not create audio context");return Nc}return Nc}function R_(e){if(function(){if(ML!==null)return ML;const o=Cv(),c=o.createBufferSource(),u=o.createGain(),h=o.createGain();c.connect(u),c.connect(h),c.disconnect(u);let m=!1;try{c.disconnect(u)}catch{m=!0}return c.disconnect(),ML=m,m}())return;const n=e.connect,i=e.disconnect;e.connect=(o,c,u)=>{var h;return e._inputNodes||(e._inputNodes=[]),ot(h=e._inputNodes).call(h,o)||(o instanceof AudioNode?(e._inputNodes.push(o),n.call(e,o,c,u)):n.call(e,o,c)),e},e.disconnect=(o,c,u)=>{i.call(e),o?EA(e._inputNodes,o):e._inputNodes=[];for(const h of e._inputNodes)n.call(e,h)}}let ML=null;function UL(e,n){let i=!1;const o=1/n;if(re("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{i?window.clearInterval(c):e(performance.now()/1e3)},1e3*o)}else{const c=Cv();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(i)return void(u=null);const m=c.createOscillator();m.onended=h,m.connect(u),m.start(0),m.stop(c.currentTime+o),e(c.currentTime)};h()}return()=>{i=!0}}class KW{constructor(){Pe(this,"context",void 0),Pe(this,"analyserNode",void 0),Pe(this,"sourceNode",void 0),this.context=Cv(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(n){if(n!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=n,n==null||n.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||mo()||tu()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const n=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(n);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let c=0;c<n.length;++c)n[c]=o[c]/128-1}const i=ja(n).call(n,(o,c)=>o+c*c,0)/n.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var n,i;(n=this.sourceNode)===null||n===void 0||n.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{D.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class qW extends Ar{get processSourceNode(){return this.sourceNode}set processedNode(n){var i;if(!this.isDestroyed&&this._processedNode!==n){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=n,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Pe(this,"outputNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"isPlayed",!1),Pe(this,"sourceNode",void 0),Pe(this,"context",void 0),Pe(this,"audioBufferNode",void 0),Pe(this,"destNode",void 0),Pe(this,"audioOutputLevel",0),Pe(this,"volumeLevelAnalyser",void 0),Pe(this,"_processedNode",void 0),Pe(this,"playNode",void 0),Pe(this,"isDestroyed",!1),Pe(this,"onNoAudioInput",void 0),Pe(this,"isNoAudioInput",!1),Pe(this,"_noAudioInputCount",0),this.context=Cv(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),R_(this.outputNode),this.volumeLevelAnalyser=new KW}startGetAudioBuffer(n){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(n),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(Oc.ON_AUDIO_BUFFER,function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){const u=o.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return o.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!kn().webAudioMediaStreamDest)throw new Le(X.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(n){this.context.state!=="running"&&yA(()=>{Jn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=n||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(n>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;mo()||tu()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const i=this.volumeLevelAnalyser.getAnalyserNode();let o;i.getFloatTimeDomainData?(o=new Float32Array(i.fftSize),i.getFloatTimeDomainData(o)):(o=new Uint8Array(i.fftSize),i.getByteTimeDomainData(o));let c=!1;for(let u=0;u<o.length;u++)o[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await es(200),await this.checkHasAudioInput(n?n+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(n){this.outputNode.gain.setValueAtTime(n,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var n,i;(n=this.processedNode)===null||n===void 0||n.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var n;this.processedNode?(n=this.processedNode)===null||n===void 0||n.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class YW extends qW{get isFreeze(){return!1}constructor(n,i,o){var c;if(super(),Pe(this,"sourceNode",void 0),Pe(this,"track",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"audioElement",void 0),Pe(this,"isCurrentTrackCloned",!1),Pe(this,"isRemoteTrack",!1),Pe(this,"originVolumeLevelAnalyser",void 0),Pe(this,"rebuildWebAudio",async()=>{if(D.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void D.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>D.info("resume success")),D.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const _=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(_),R_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const y=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(y,this.context.currentTime),R_(this.outputNode),this.emit(Oc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=_,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),n.kind!=="audio")throw new Le(X.UNEXPECTED_ERROR);this.track=n;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(u),R_(this.sourceNode),o){const m=o.clone();m.enabled=!0,this.clonedTrack=m,D.debug("create an unmuted track ".concat(m.id," from the original track ").concat(o.id," to get the volume"));const _=this.context.createMediaStreamSource(new MediaStream([m]));R_(_),this.originVolumeLevelAnalyser=new KW,this.originVolumeLevelAnalyser.updateSource(_)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=Rn();i&&h.os===Ni.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(Jn.on(ns.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(n){this.sourceNode.disconnect(),this.track=n,this.isCurrentTrackCloned=!1;const i=new MediaStream([n]);this.sourceNode=this.context.createMediaStreamSource(i),R_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Oc.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var n;this.audioElement.srcObject=null,this.audioElement.remove(),Jn.off("state-change",this.rebuildWebAudio),(n=this.originVolumeLevelAnalyser)===null||n===void 0||n.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(n){return this.context.createMediaStreamSource(new MediaStream([n]))}updateOriginTrack(n){const i=n.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),D.debug("create an unmuted track ".concat(i.id," from the original track ").concat(n.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([i]));R_(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function XW(e,n,i){const o=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:o(n.height,1080),maxWidth:o(n.width,1920)}}};return n.frameRate&&typeof n.frameRate!="number"?(c.video.mandatory.maxFrameRate=n.frameRate.max,c.video.mandatory.minFrameRate=n.frameRate.min):typeof n.frameRate=="number"&&(c.video.mandatory.maxFrameRate=n.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function hpe(e,n){const i=await JW(e.mediaSource),{sourceId:o,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new lt((m,_)=>{const y=document.createElement("div");y.innerText="share screen",y.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const w=document.createElement("div");w.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",w.setAttribute("style","height: 12%;");const A=document.createElement("div");A.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const k=document.createElement("div");k.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const W=document.createElement("button");W.innerHTML="cancel",W.setAttribute("style","width: 85px;"),W.onclick=()=>{document.body.removeChild(q);const Y=new Error("NotAllowedError");Y.name="NotAllowedError",_(Y)};let U=h;const V=document.createElement("div");if(h){const Y=document.createElement("input");Y.setAttribute("type","checkbox");const ce=document.createElement("span");Y.setAttribute("style","margin-right: 6px;"),ce.innerText="Share audio",Y.checked=U,Y.onchange=()=>{U=Y.checked},V.appendChild(Y),V.appendChild(ce)}k.appendChild(V),k.appendChild(W),S.appendChild(w),S.appendChild(A),S.appendChild(k);const q=document.createElement("div");q.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),q.appendChild(y),q.appendChild(S),document.body.appendChild(q),u.map(Y=>{if(Y.id){const ce=document.createElement("div");ce.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let _e=Y.thumbnail;try{const{width:Ee}=_e.getSize();Ee>1920&&(_e=_e.resize({width:1920}))}catch(Ee){throw Ee&&Ee.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Ee}ce.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+_e.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Y.name.replace(/[\u00A0-\u9999<>\&]/g,function(Ee){return"&#"+Ee.charCodeAt(0)+";"})+"</span>",ce.onclick=()=>{document.body.removeChild(q),m({sourceId:Y.id,audio:U})},A.appendChild(ce)}})})}(i,n);return await XW(o,e,c)}async function JW(e){let n=["window","screen"];e!=="application"&&e!=="window"||(n=["window"]),e==="screen"&&(n=["screen"]);const i=lW();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new Le(X.ELECTRON_IS_NULL);let o=null;try{var c;o=((c=i.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:n}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:n})}catch{o=null}o&&o.then||(o=new lt((u,h)=>{i.desktopCapturer.getSources({types:n},(m,_)=>{m?h(m):u(_)})}));try{return await o}catch(u){throw new Le(X.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const VL=new Cs("safari");let QW=!1,ZW=!1;async function Dc(e,n){let i=0,o=null;for(;i<2;)try{o=await ppe(e,n,i>0);break}catch(c){if(c instanceof Le)throw D.error("[".concat(n,"] ").concat(c.toString())),c;const u=OA(c.name||c.code||c,c.message);if(u.code===X.MEDIA_OPTION_INVALID){D.debug("[".concat(n,"] detect media option invalid, retry")),i+=1,await es(500);continue}throw D.error("[".concat(n,"] ").concat(u.toString())),u}if(!o)throw new Le(X.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function ppe(e,n,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Le(X.NOT_SUPPORTED,"can not find getUserMedia");i&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const o=kn(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return D.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(lW())e.screen.sourceId?Iv(c,await XW(e.screen.sourceId,e.screen,!!e.screenAudio)):Iv(c,await hpe(e.screen,!!e.screenAudio));else if(xp()&&e.screen.extensionId&&e.screen.mandatory){if(!o.getStreamFromExtension)throw new Le(X.NOT_SUPPORTED,"This browser does not support screen sharing");D.debug("[".concat(n,'] Screen access on chrome stable, looking for extension"'));const A=await(h=e.screen.extensionId,m=n,new lt((k,W)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},U=>{if(!U||!U.streamId)return D.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),U),void W(new Le(X.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));k(U.streamId)})}catch(U){D.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),U.toString()),W(new Le(X.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=A,Iv(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(o.getDisplayMedia){var u;e.screen.mediaSource&&BW(e.screen.mediaSource);const A={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(u=e.screen.displaySurface)!==null&&u!==void 0?u:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:k,surfaceSwitching:W,systemAudio:U,preferCurrentTab:V}=e.screen,q={selfBrowserSurface:k,surfaceSwitching:W,systemAudio:U,preferCurrentTab:V};!k&&delete q.selfBrowserSurface,!W&&delete q.surfaceSwitching,!U&&delete q.systemAudio,!V&&delete q.preferCurrentTab,D.debug("[".concat(n,"] getDisplayMedia:"),JSON.stringify({video:A,audio:e.screenAudio,controls:q})),Iv(c,await navigator.mediaDevices.getDisplayMedia(wr({video:A,audio:e.screenAudio},q)))}else{if(!Nr())throw D.error("[".concat(n,"] This browser does not support screenSharing")),new Le(X.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&BW(e.screen.mediaSource);const A={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};D.debug("[".concat(n,"] getUserMedia: ").concat(JSON.stringify(A))),Iv(c,await navigator.mediaDevices.getUserMedia(A))}}var h,m;if(!e.video&&!e.audio)return c;let _={video:e.video,audio:e.audio},y=re("MEDIA_DEVICE_CONSTRAINTS");if(y)try{typeof y=="string"&&(y=JSON.parse(y)),_=mL(_,y)}catch{}D.debug("[".concat(n,"] GetUserMedia"),JSON.stringify(_)),Rn();let S,w=null;(gs()||mo()||gA())&&(w=await VL.lock());try{S=await navigator.mediaDevices.getUserMedia(_)}catch(A){throw w&&w(),A}return _.audio&&(QW=!0),_.video&&(ZW=!0),Iv(c,S),w&&w(),c}function OA(e,n){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Le(X.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(n));case"NotFoundError":case"DevicesNotFoundError":return new Le(X.DEVICE_NOT_FOUND,"".concat(e,": ").concat(n));case"NotSupportedError":return new Le(X.NOT_SUPPORTED,"".concat(e,": ").concat(n));case"NotReadableError":return new Le(X.NOT_READABLE,"".concat(e,": ").concat(n));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Le(X.PERMISSION_DENIED,"".concat(e,": ").concat(n));case"ConstraintNotSatisfiedError":return new Le(X.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(n));default:return D.error("getUserMedia unexpected error",e),new Le(X.UNEXPECTED_ERROR,"".concat(e,": ").concat(n))}}function Iv(e,n){const i=e.getVideoTracks()[0],o=e.getAudioTracks()[0],c=n.getVideoTracks()[0],u=n.getAudioTracks()[0];u&&(o&&e.removeTrack(o),e.addTrack(u)),c&&(i&&e.removeTrack(i),e.addTrack(c))}const Lc=new class extends Ar{get state(){return this._state}set state(e){e!==this._state&&(this.emit(w_.STATE_CHANGE,e),this._state=e)}constructor(){super(),Pe(this,"_state",ob.IDLE),Pe(this,"isAccessMicrophonePermission",!1),Pe(this,"isAccessCameraPermission",!1),Pe(this,"lastAccessMicrophonePermission",!1),Pe(this,"lastAccessCameraPermission",!1),Pe(this,"checkdeviceMatched",!1),Pe(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(re("ENUMERATE_DEVICES_INTERVAL")||(_A()||mA()===Ni.HARMONY_OS)&&Mp())&&this.updateDevicesInfo()},re("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>D.error(e.toString()))}async enumerateDevices(e,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Le(X.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o);let u=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&n;c.audio&&(u=!1),c.video&&(h=!1);let m=null,_=null,y=null;if(!i&&(u||h)){if(VL.isLocked&&(D.debug("[device manager] wait GUM lock"),(await VL.lock())(),D.debug("[device manager] GUM unlock")),QW&&(u=!1,this.isAccessMicrophonePermission=!0),ZW&&(h=!1,this.isAccessCameraPermission=!0),D.debug("[device manager] check media device permissions",e,n,u,h),u&&h){try{y=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const w=OA(S.name||S.code||S,S.message);if(w.code===X.PERMISSION_DENIED)throw w;D.warning("getUserMedia failed in getDevices",w)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({audio:e})}catch(S){const w=OA(S.name||S.code||S,S.message);if(w.code===X.PERMISSION_DENIED)throw w;D.warning("getUserMedia failed in getDevices",w)}this.isAccessMicrophonePermission=!0}else if(h){try{_=await navigator.mediaDevices.getUserMedia({video:n})}catch(S){const w=OA(S.name||S.code||S,S.message);if(w.code===X.PERMISSION_DENIED)throw w;D.warning("getUserMedia failed in getDevices",w)}this.isAccessCameraPermission=!0}D.debug("[device manager] mic permission",e,"cam permission",n)}try{const S=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(w=>w.stop()),_&&_.getTracks().forEach(w=>w.stop()),y&&y.getTracks().forEach(w=>w.stop()),m=null,_=null,y=null,S}catch(S){return m&&m.getTracks().forEach(w=>w.stop()),_&&_.getTracks().forEach(w=>w.stop()),y&&y.getTracks().forEach(w=>w.stop()),m=null,_=null,y=null,new Le(X.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(n=>n.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(n=>n.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(n=>n.kind==="audiooutput")}searchDeviceIdByName(e){let n=null;return this.deviceInfoMap.forEach(i=>{i.device.label===e&&(n=i.device.deviceId)}),n}async getDeviceById(e){const n=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===e);if(!n)throw new Le(X.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return n}async init(){this.state=ob.INITING;try{await this.updateDevicesInfo(),this.state=ob.INITEND}catch(e){throw D.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=ob.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Le(X.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),n=Date.now(),i=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=e.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=e.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?D.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):D.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):D.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:n,updateAt:n,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),i.push(h)}u&&(u.updateAt=n)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==n&&(c.state="INACTIVE",i.push(c))}),this.state!==ob.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(w_.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(w_.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(w_.PLAYOUT_DEVICE_CHANGED,c)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const n=e.filter(c=>c.kind==="audioinput"),i=e.filter(c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(const c of n)if(c.label&&c.deviceId){o.audio=!0;break}for(const c of i)if(c.label&&c.deviceId){o.video=!0;break}return o}};let FL=!1;const xc=new class extends Ar{constructor(){super(...arguments),Pe(this,"onAutoplayFailed",void 0),Pe(this,"onAudioAutoplayFailed",void 0)}};function e8(){if(Rn(),!FL){const e=n=>{n.preventDefault(),FL=!1,JT()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};FL=!0,JT()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),D.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),xc.onAutoplayFailed?xc.onAutoplayFailed():xc.onAudioAutoplayFailed?D.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):D.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),xc.emit("autoplay-failed")}}function t8(e,n,i,o){if(!e)return;const c=wt.getBaseInfoBySessionId(e);if(!c)return;const u=c.info,h=Date.now(),m=wr(wr({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:xc.onAutoplayFailed||xc.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:n,trackId:o,extend:void 0});wt.send({type:br.AUTOPLAY_FAILED,data:m},!0)}const fpe=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],zo=new class{constructor(){Pe(this,"onAutoplayFailed",void 0),Pe(this,"elementMap",new Map),Pe(this,"elementStateMap",new Map),Pe(this,"elementsNeedToResume",[]),Pe(this,"sinkIdMap",new Map),Pe(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(n=>{let[i,o]=n;const c=this.elementStateMap.get(i),u=o.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(D.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return o.pause(),void o.play();if(Jn.curState==="running")return pv()?(o.pause(),void o.play()):void(c&&c==="paused"&&o.play())}})}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,i]=e;const o=i.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(D.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),Jn.on(ns.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Jn.on(ns.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Jn.on(ns.STATE_CHANGE,()=>{mo()&&Jn.prevState==="suspended"&&Jn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,n){const i=this.elementMap.get(e);if(this.sinkIdMap.set(e,n),i)try{await i.setSinkId(n)}catch(o){throw new Le(X.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(e,n,i,o){if(this.elementMap.has(n))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(n,c),this.elementMap.set(n,c),this.elementStateMap.set(n,Xs.INIT),this.setVolume(n,i);const u=this.sinkIdMap.get(n);if(u)try{c.setSinkId(u).catch(m=>{D.warning("[".concat(n,"] set sink id failed"),m.toString())})}catch(m){D.warning("[".concat(n,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{o&&t8(o,"audio",m.message,n),D.warning("audio element play warning",m.toString()),this.elementMap.has(n)&&m.name==="NotAllowedError"&&(D.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),yA(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),e8()}))})}updateTrack(e,n){const i=this.elementMap.get(e);i&&(i.srcObject=new MediaStream([n]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,n){const i=this.elementMap.get(e);i&&(n=Math.max(0,Math.min(100,n)),i.volume=n/100)}stop(e){const n=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!n)return;const i=this.elementsNeedToResume.indexOf(n);this.elementsNeedToResume.splice(i,1),n.srcObject=null,n.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,n){fpe.forEach(i=>{n.addEventListener(i,o=>{const c=this.elementStateMap.get(e),u=o.type==="pause"?"paused":o.type;if(D.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(u)),o.type==="error"){const h=n==null?void 0:n.error;h&&D.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,u)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(n=>{n.play().then(i=>{D.debug("Auto resume audio element success")}).catch(i=>{D.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new lt(n=>{document.body?n():window.addEventListener("load",()=>n())}).then(()=>{JT()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function Jr(){return function(e,n,i){const o=i.value;return typeof o=="function"&&(i.value=function(){this._isClosed&&new Le(X.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",D);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const m=o.apply(this,u);return m instanceof lt?new lt((_,y)=>{m.then(_).catch(y)}):m}),i}}class n8 extends Ar{constructor(n){super(),Pe(this,"name","VideoProcessorDestination"),Pe(this,"ID","0"),Pe(this,"_source",void 0),Pe(this,"videoContext",void 0),Pe(this,"inputTrack",void 0),this.videoContext=n}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Le(X.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Le(X.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(n){if(n.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);n.track&&n.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=n.track,this.emit(go.ON_TRACK,n.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(go.ON_TRACK,void 0)}}class r8 extends Ar{set chained(n){this._chained=n}get chained(){return this._chained}constructor(n,i){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"usageRegistry",[]),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"_chained",!1),this.trackId=n,this.direction=i}async getConstraints(){return await Es(this,kc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(n,i){var o;return D.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),n&&this.constraintsMap.set(i,n),sr(this,kc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Rc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(n){var i;if(this.constraintsMap.has(n))return D.info("processor ".concat(n.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(n),sr(this,kc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Rc(i=this.constraintsMap).call(i)))}registerStats(n,i,o){this.statsRegistry.find(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i)||this.statsRegistry.push({processorName:n.name,processorID:n.ID,type:i,cb:o})}unregisterStats(n,i){const o=this.statsRegistry.findIndex(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const n=[];for(const{processorID:i,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();n.push({processorID:i,processorName:o,type:c,stats:h})}catch(h){D.error(new Le(X.UNEXPECTED_ERROR,h.message))}return n}registerUsage(n,i){this.usageRegistry.find(o=>o.processorID===n.ID&&o.processorName===n.name)||this.usageRegistry.push({processorID:n.ID,processorName:n.name,cb:i})}unregisterUsage(n){const i=this.usageRegistry.findIndex(o=>o.processorID===n.ID&&o.processorName===n.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const n=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let o=i();o instanceof lt&&(o=await o),n.push(wr(wr({},o),{},{direction:this.direction}))}catch(o){D.error("gather extension usage error",o)}return n}getDirection(){return this.direction}}class i8 extends Ar{constructor(n){super(),Pe(this,"name","AudioProcessorDestination"),Pe(this,"ID","0"),Pe(this,"inputTrack",void 0),Pe(this,"inputNode",void 0),Pe(this,"audioProcessorContext",void 0),Pe(this,"_source",void 0),this.audioProcessorContext=n}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Le(X.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Le(X.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(go.ON_TRACK,void 0),this.emit(go.ON_NODE,void 0)}updateInput(n){if(n.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);n.track&&this.inputTrack!==n.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=n.track,this.emit(go.ON_TRACK,this.inputTrack)),n.node&&this.inputNode!==n.node&&(this.audioProcessorContext.chained=!0,this.inputNode=n.node,this.emit(go.ON_NODE,this.inputNode))}}class s8 extends Ar{set chained(n){this._chained=n}get chained(){return this._chained}constructor(n,i,o){super(),Pe(this,"constraintsMap",new Map),Pe(this,"statsRegistry",[]),Pe(this,"audioContext",void 0),Pe(this,"trackId",void 0),Pe(this,"direction",void 0),Pe(this,"usageRegistry",[]),Pe(this,"_chained",!1),this.audioContext=n,this.trackId=i,this.direction=o}async getConstraints(){return Es(this,kc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(n,i){var o;return D.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),n&&this.constraintsMap.set(i,n),sr(this,kc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Rc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(n){var i;if(this.constraintsMap.has(n))return this.constraintsMap.delete(n),sr(this,kc.REQUEST_UPDATE_CONSTRAINTS,Array.from(Rc(i=this.constraintsMap).call(i)))}registerStats(n,i,o){this.statsRegistry.find(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i)||this.statsRegistry.push({processorName:n.name,processorID:n.ID,type:i,cb:o})}unregisterStats(n,i){const o=this.statsRegistry.findIndex(c=>c.processorID===n.ID&&c.processorName===n.name&&c.type===i);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const n=[];for(const{processorID:i,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();n.push({processorID:i,processorName:o,type:c,stats:h})}catch(h){D.error(new Le(X.UNEXPECTED_ERROR,h.message))}return n}registerUsage(n,i){this.usageRegistry.find(o=>o.processorID===n.ID&&o.processorName===n.name)||this.usageRegistry.push({processorID:n.ID,processorName:n.name,cb:i})}unregisterUsage(n){const i=this.usageRegistry.findIndex(o=>o.processorID===n.ID&&o.processorName===n.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const n=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let o=i();o instanceof lt&&(o=await o),n.push(wr(wr({},o),{},{direction:this.direction}))}catch(o){D.error("gather extension usage error",o)}return n}getDirection(){return this.direction}}class jL extends Ar{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Pe(this,"context",void 0),Pe(this,"processSourceNode",void 0),Pe(this,"outputTrack",void 0),Pe(this,"processedNode",void 0),Pe(this,"clonedTrack",void 0),Pe(this,"outputNode",void 0),this.outputNode=new mpe}setVolume(){}createOutputTrack(){throw new Le(X.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class mpe{disconnect(){}connect(){}}function o8(e){return new lt((n,i)=>{let o=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=mo()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&Nr()||(o=!0,c.srcObject=null,c.remove(),n([h,m]))}),c.srcObject=new MediaStream([e]),c.play().catch(vA),setTimeout(()=>{o||(c.srcObject=null,c.remove(),n([c.videoWidth,c.videoHeight]))},4e3)})}function kA(e){const n={};e.facingMode&&(n.facingMode=e.facingMode),e.cameraId&&(n.deviceId={exact:e.cameraId});const i=lh(e.encoderConfig);return i.width!=null&&(n.width=i.width),i.height!=null&&(n.height=i.height),!iW()&&i.frameRate&&(n.frameRate=i.frameRate),X6()&&typeof n.frameRate=="object"&&(n.frameRate.max=60),Nr()&&(n.frameRate={ideal:30,max:30}),n}function a8(e){const n={};return iW()||(e.AGC!==void 0&&(n.autoGainControl=e.AGC),e.AEC!==void 0&&(n.echoCancellation=e.AEC),e.ANS!==void 0&&(n.noiseSuppression=e.ANS,xp()&&e.ANS&&(n.googHighpassFilter=e.ANS))),n}function c8(e){const n=a8(e);if(e.encoderConfig){const i=AA(e.encoderConfig);n.channelCount=i.stereo?2:1,n.sampleRate=i.sampleRate,n.sampleSize=i.sampleSize}return e.microphoneId&&(n.deviceId={exact:e.microphoneId}),_A()&&(n.sampleRate=void 0),n}const gpe=e=>{const n=e._encoderConfig;if(!n)return;const{frameRate:i,width:o,height:c}=e.getMediaStreamTrackSettings();let{frameRate:u=i,width:h=o,height:m=c}=n;if(!u||!h||!m)return;h=gL(h),m=gL(m),u=gL(u);const{max:_,min:y}=function(k,W,U){const V=200*Math.pow(U/15,.6)*Math.pow(k*W/640/360,.75);return{min:Math.floor(V),max:Math.floor(4*V)}}(h,m,u),{bitrateMax:S,bitrateMin:w}=n||{};S||D.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(u,"] => [brMax: ").concat(S,", brMin: ").concat(w,"]"));const{maxFramerate:A}=re("ENCODER_CONFIG_LIMIT");return A&&typeof A=="number"&&(u=Math.min(u,A)),{frameRate:u,bitrateMax:S||_,bitrateMin:w||y,scaleResolutionDownBy:1,scale:0}},l8=async(e,n,i)=>await(async(o,c,u)=>{const h=function(y){const S=[];for(let w=0;w<y.length;w+=2)S.push(parseInt(y.slice(w,w+2),16));return Uint8Array.from(S)}(vW(""+c+u)).slice(0,16),m=h.slice(0,12),_=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},_,o))})(e.buffer,n,i),BL=e=>{const n=document.createElement("canvas");return n.width=2,n.height=2,new lt((i,o)=>{n.toBlob(async c=>{if(n.remove(),c){const u=await u8(c);i({buffer:u,width:n.width,height:n.height})}else o(new Le(X.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},u8=async e=>{const n=await e.arrayBuffer();return new Uint8Array(n)};var d8,h8,p8,f8,m8,g8,_8,E8,y8,v8,S8,T8,b8,w8,R8,C8,I8,A8,Pr,P8,O8,k8,N8,D8,L8,dh,x8,M8,U8,V8,F8,j8,B8,W8,z8,G8,H8,$8,K8,vs;let Br=(d8=xt({argsMap:(e,n)=>[e.getTrackId(),n],throttleTime:300}),h8=xt({argsMap:(e,n)=>[e.getTrackId(),n]}),p8=Jr(),f8=gv("LocalAudioTrack","_enabledMutex"),m8=xt({argsMap:(e,n)=>[e.getTrackId(),n]}),g8=Jr(),_8=gv("LocalAudioTrack","_enabledMutex"),E8=xt({argsMap:(e,n)=>[e.getTrackId(),n]}),y8=Jr(),v8=Jr(),S8=Jr(),T8=xt({argsMap:e=>[e.getTrackId()]}),b8=Jr(),w8=xt({argsMap:e=>[e.getTrackId()]}),R8=Jr(),C8=xt({argsMap:e=>[e.getTrackId()]}),I8=xt({argsMap:(e,n)=>[e.getTrackId(),n.name]}),A8=xt({argsMap:e=>[e.getTrackId()]}),In((Pr=class extends Rv{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?zo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,n,i,o){super(e,i),Pe(this,"trackMediaType",wv.AUDIO),Pe(this,"_encoderConfig",void 0),Pe(this,"_trackSource",void 0),Pe(this,"metadata",[]),Pe(this,"_enabled",!0),Pe(this,"_volume",100),Pe(this,"_useAudioElement",!0),Pe(this,"_bypassWebAudio",!1),Pe(this,"processor",void 0),Pe(this,"_processorContext",void 0),Pe(this,"_processorDestination",void 0),Pe(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=n,this._getOriginVolumeLevel=!!o,this._trackSource=new jL,re("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),re("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),gs()&&!Nc?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){er(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&zo.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void D.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const n=this._source.createOutputTrack();this._mediaStreamTrack!==n&&(this._mediaStreamTrack=n,sr(this,gt.NEED_REPLACE_TRACK,this).then(()=>{D.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{D.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!FW())throw new Le(X.NOT_SUPPORTED,"your browser does not support setting the audio output device");await zo.setSinkID(this.getTrackId(),e)}async setEnabled(e,n,i){return this._setEnabled(e,n,i)}async _setEnabled(e,n,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await sr(this,gt.NEED_ENABLE_TRACK,this),D.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(o){throw i||(this._enabled=!1),D.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await sr(this,gt.NEED_DISABLE_TRACK,this)}catch(o){throw i||(this._enabled=!0),D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,D.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await sr(this,gt.NEED_MUTE_TRACK,this):await sr(this,gt.NEED_UNMUTE_TRACK,this))}getStats(){return Em(()=>{D.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Ic(this,gt.GET_STATS)||wr({},DL)}setAudioFrameCallback(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Oc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(n),this._source.removeAllListeners(Oc.ON_AUDIO_BUFFER),this._source.on(Oc.ON_AUDIO_BUFFER,i=>e(i))}play(){D.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(D.debug("[".concat(this.getTrackId(),"] start audio playback in element")),zo.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){D.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?zo.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];D.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&zo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,n){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sr(this,gt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return lt.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Le(X.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Le(X.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const n=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,n.reset()}bindProcessorDestinationEvents(e){e.on(go.ON_TRACK,async n=>{n?n!==this._mediaStreamTrack&&(this._mediaStreamTrack=n,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(n),await sr(this,gt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sr(this,gt.NEED_REPLACE_TRACK,this))}),e.on(go.ON_NODE,n=>{this._source.processedNode=n})}unbindProcessorDestinationEvents(e){e.removeAllListeners(go.ON_TRACK),e.removeAllListeners(go.ON_NODE)}bindProcessorContextEvents(e){e.on(kc.REQUEST_CONSTRAINTS,async n=>{n(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(kc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof jL&&(this._trackSource=new YW(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new s8(this._source.context,this.getTrackId(),"local"),n=new i8(e);return this._processorContext=e,this._processorDestination=n,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(n),this._source.on(Oc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(zo.stop(this.getTrackId()),this._source.play()),sr(this,gt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{D.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{D.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:n}}}).prototype,"setVolume",[d8],Object.getOwnPropertyDescriptor(Pr.prototype,"setVolume"),Pr.prototype),In(Pr.prototype,"setPlaybackDevice",[h8,p8],Object.getOwnPropertyDescriptor(Pr.prototype,"setPlaybackDevice"),Pr.prototype),In(Pr.prototype,"setEnabled",[f8,m8,g8],Object.getOwnPropertyDescriptor(Pr.prototype,"setEnabled"),Pr.prototype),In(Pr.prototype,"setMuted",[_8,E8,y8],Object.getOwnPropertyDescriptor(Pr.prototype,"setMuted"),Pr.prototype),In(Pr.prototype,"getStats",[v8],Object.getOwnPropertyDescriptor(Pr.prototype,"getStats"),Pr.prototype),In(Pr.prototype,"setAudioFrameCallback",[S8],Object.getOwnPropertyDescriptor(Pr.prototype,"setAudioFrameCallback"),Pr.prototype),In(Pr.prototype,"play",[T8,b8],Object.getOwnPropertyDescriptor(Pr.prototype,"play"),Pr.prototype),In(Pr.prototype,"stop",[w8,R8],Object.getOwnPropertyDescriptor(Pr.prototype,"stop"),Pr.prototype),In(Pr.prototype,"close",[C8],Object.getOwnPropertyDescriptor(Pr.prototype,"close"),Pr.prototype),In(Pr.prototype,"pipe",[I8],Object.getOwnPropertyDescriptor(Pr.prototype,"pipe"),Pr.prototype),In(Pr.prototype,"unpipe",[A8],Object.getOwnPropertyDescriptor(Pr.prototype,"unpipe"),Pr.prototype),Pr),NA=(P8=xt({argsMap:(e,n)=>[e.getTrackId(),n]}),O8=Jr(),k8=gv("MicrophoneAudioTrack","_enabledMutex"),N8=xt({argsMap:(e,n,i)=>[e.getTrackId(),n,i]}),D8=Jr(),L8=xt({argsMap:e=>[e.getTrackId()]}),In((dh=class extends Br{get __className__(){return"MicrophoneAudioTrack"}constructor(e,n,i,o){super(e,n.encoderConfig?AA(n.encoderConfig):{},o,re("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Pe(this,"_config",void 0),Pe(this,"_deviceName","default"),Pe(this,"_constraints",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_enabled",!0),this._config=n,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof n.bypassWebAudio=="boolean"&&(this._bypassWebAudio=n.bypassWebAudio),(pv()||cL())&&Jn.bindInterruptDetectorTrack(this)}async setDevice(e){if(D.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const n=await Lc.getDeviceById(e),i={};i.audio=wr({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let o=null;try{o=await Dc(i,this.getTrackId())}catch(c){throw D.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await Dc({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=n.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(n){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await Lc.getDeviceById(e);this._deviceName=n.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(n){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}D.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,n,i){if(n)return D.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),e),re("AUTO_RESET_AUDIO_ROUTE")&&(mo()||tu())){const h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),i||(this._enabled=!1);try{await sr(this,gt.NEED_DISABLE_TRACK,this)}catch(h){throw D.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=wr({},this._constraints),u=Lc.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{i||(this._enabled=!0);const h=await Dc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await sr(this,gt.NEED_ENABLE_TRACK,this)}catch(h){throw i||(this._enabled=!1),D.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}D.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(pv()||cL())&&Jn.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((mo()||tu())&&this._enabled&&!this._isClosed&&Jn.duringInterruption){const e=async()=>{Jn.off(ns.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Jn.on(ns.IOS_INTERRUPTION_END,e)}else D.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Tv.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,i=Lc.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId=i),this._constraints=n,this._enabled){this._originMediaStreamTrack.stop();const o=await Dc({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(kc.REQUEST_UPDATE_CONSTRAINTS,async(n,i,o)=>{try{const c=Object.assign({},this._originalConstraints,...n);await this.renewMediaStreamTrack(c),i()}catch(c){o(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(kc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[P8,O8],Object.getOwnPropertyDescriptor(dh.prototype,"setDevice"),dh.prototype),In(dh.prototype,"setEnabled",[k8,N8,D8],Object.getOwnPropertyDescriptor(dh.prototype,"setEnabled"),dh.prototype),In(dh.prototype,"close",[L8],Object.getOwnPropertyDescriptor(dh.prototype,"close"),dh.prototype),dh),_pe=(x8=xt({argsMap:(e,n)=>[e.getTrackId(),n,e.duration]}),M8=Jr(),U8=xt({argsMap:e=>[e.getTrackId()]}),V8=Jr(),F8=xt({argsMap:e=>[e.getTrackId()]}),j8=Jr(),B8=xt({argsMap:e=>[e.getTrackId()]}),W8=Jr(),z8=xt({argsMap:e=>[e.getTrackId()]}),G8=Jr(),H8=xt({argsMap:e=>[e.getTrackId()]}),$8=xt({argsMap:e=>[e.getTrackId()]}),K8=Jr(),In((vs=class extends Br{get __className__(){return"BufferSourceAudioTrack"}constructor(e,n,i,o){super(n.createOutputTrack(),i,o),Pe(this,"source",void 0),Pe(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=n,this._bufferSource.on(Oc.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit(Tv.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){er(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[x8,M8],Object.getOwnPropertyDescriptor(vs.prototype,"startProcessAudioBuffer"),vs.prototype),In(vs.prototype,"pauseProcessAudioBuffer",[U8,V8],Object.getOwnPropertyDescriptor(vs.prototype,"pauseProcessAudioBuffer"),vs.prototype),In(vs.prototype,"seekAudioBuffer",[F8,j8],Object.getOwnPropertyDescriptor(vs.prototype,"seekAudioBuffer"),vs.prototype),In(vs.prototype,"resumeProcessAudioBuffer",[B8,W8],Object.getOwnPropertyDescriptor(vs.prototype,"resumeProcessAudioBuffer"),vs.prototype),In(vs.prototype,"stopProcessAudioBuffer",[z8,G8],Object.getOwnPropertyDescriptor(vs.prototype,"stopProcessAudioBuffer"),vs.prototype),In(vs.prototype,"close",[H8],Object.getOwnPropertyDescriptor(vs.prototype,"close"),vs.prototype),In(vs.prototype,"setAudioBufferPlaybackSpeed",[$8,K8],Object.getOwnPropertyDescriptor(vs.prototype,"setAudioBufferPlaybackSpeed"),vs.prototype),vs);class Ti extends Br{get __className__(){return"MixingAudioTrack"}get isActive(){for(const n of this.trackList)if(n._enabled&&!n._isClosed&&!n.muted)return!0;return!1}constructor(){const n=Cv().createMediaStreamDestination();super(n.stream.getAudioTracks()[0],void 0,or(8,"track-mix-")),Pe(this,"trackList",void 0),Pe(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=n,this.trackList=[]}hasAudioTrack(n){return this.trackList.indexOf(n)!==-1}addAudioTrack(n){this.trackList.indexOf(n)===-1?(D.debug("add ".concat(n.getTrackId()," to mixing track")),n._source.outputNode.connect(this.destNode),this.trackList.push(n),this.updateEncoderConfig()):D.debug("track ".concat(n.getTrackId()," is already added"))}removeAudioTrack(n){if(this.trackList.indexOf(n)!==-1){D.debug("remove ".concat(n.getTrackId()," from mixing track"));try{n._source.outputNode.disconnect(this.destNode)}catch{}EA(this.trackList,n),this.updateEncoderConfig()}}updateEncoderConfig(){const n={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(n.bitrate||0)&&(n.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(n.sampleRate||0)&&(n.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(n.sampleSize||0)&&(n.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(n.stereo=!0))}),this._encoderConfig=n}_updateRtpTransceiver(n){this._rtpTransceiver!==n&&(this._rtpTransceiver=n,this.trackList.forEach(i=>{i instanceof Ti?i.emit(b_.TRANSCEIVER_UPDATED,n):i._updateRtpTransceiver(n)}))}}class Epe extends qW{set currentState(n){n!==this._currentState&&(this._currentState=n,this.safeEmit(Oc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Pe(this,"audioBuffer",void 0),Pe(this,"sourceNode",void 0),Pe(this,"startPlayTime",0),Pe(this,"startPlayOffset",0),Pe(this,"pausePlayTime",0),Pe(this,"options",void 0),Pe(this,"currentLoopCount",0),Pe(this,"currentPlaybackSpeed",100),Pe(this,"_currentState","stopped"),this.audioBuffer=n,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(n){this.currentState==="stopped"?(this.options=n,this.startPlayOffset=this.options.startPlayTime||0):D.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(n){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=n,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=n))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(n){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=n/100),this.currentPlaybackSpeed=n}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const n=this.context.createBufferSource();return n.buffer=this.audioBuffer,n.loop=!!this.options.loop,n.connect(this.outputNode),n.playbackRate.value=this.currentPlaybackSpeed/100,n}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const q8=new Map;class WL{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const n=this.renderStats.curTs-this.renderStats.lastTs,i=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/n;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,i}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(n){n!==this._videoElementStatus&&(D.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(n)),this._videoElementStatus=n)}get videoState(){return this._videoState}set videoState(n){var i;n!==this._videoState&&(this._videoState=n,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(n){Pe(this,"trackId",void 0),Pe(this,"config",void 0),Pe(this,"onFirstVideoFrameDecoded",void 0),Pe(this,"onVideoStateChanged",void 0),Pe(this,"freezeTimeCounterList",[]),Pe(this,"renderFreezeAccTime",0),Pe(this,"isKeepLastFrame",!1),Pe(this,"timeUpdatedCount",0),Pe(this,"freezeTime",0),Pe(this,"playbackTime",0),Pe(this,"lastTimeUpdatedTime",0),Pe(this,"autoplayFailed",!1),Pe(this,"videoTrack",void 0),Pe(this,"videoElement",void 0),Pe(this,"cacheVideoElement",void 0),Pe(this,"renderStats",void 0),Pe(this,"_videoState",uh.VideoStateStopped),Pe(this,"videoElementCheckInterval",void 0),Pe(this,"videoElementFreezeTimeout",void 0),Pe(this,"_videoElementStatus",Xs.NONE),Pe(this,"isGettingVideoDimensions",!1),Pe(this,"startGetVideoDimensions",()=>{const i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return D.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),Pe(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Jn.curState==="running"&&(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Y6())),nW()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Pe(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Xs.PLAYING;break;case"loadeddata":if(this.videoState=uh.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Xs.CANPLAY;break;case"stalled":this.videoElementStatus=Xs.STALLED;break;case"suspend":this.videoElementStatus=Xs.SUSPEND;break;case"pause":this.videoElementStatus=Xs.PAUSED,mo()||tu()||gs()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Xs.WAITING;break;case"abort":this.videoElementStatus=Xs.ABORT;break;case"ended":this.videoElementStatus=Xs.ENDED;break;case"emptied":this.videoElementStatus=Xs.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=Xs.ERROR,D.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const c=o-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,Fp.lastVisibleTime<Fp.lastHiddenTime||u<Fp.lastHiddenTime||u<Fp.lastVisibleTime)return;for(c>re("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Pe(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(D.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Y6())),nW()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=n.trackId,this.config=n,n.element instanceof HTMLVideoElement?this.videoElement=n.element:this.videoElement=document.createElement("video"),Jn.on(ns.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Jn.on(ns.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var n;return(n=this.videoElement.parentElement)!==null&&n!==void 0?n:void 0}updateConfig(n){this.config=n,this.trackId=n.trackId,n.element!==this.videoElement&&(this.destroy(),this.videoElement=n.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.initVideoElement())}play(n){const i=this.videoElement.play();i&&i.catch&&i.catch(c=>{n&&t8(n,"video",c.message,this.trackId),c.name==="NotAllowedError"?(D.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):D.warning("[".concat(this.trackId,"] play warning: "),c)});const o=Rn();if((o.name==="Safari"&&Number(o.version)===15||pv())&&i&&i.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(c).catch(c)}}getCurrentFrame(){const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const i=n.getContext("2d");if(!i)return D.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,n.width,n.height);const o=i.getImageData(0,0,n.width,n.height);return n.remove(),o}async getCurrentFrameToUint8Array(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new lt((u,h)=>{o.toBlob(async m=>{if(o.remove(),m){const _=await u8(m);u({buffer:_,width:o.width,height:o.height})}else h(new Le(X.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},n,i<0?.1:i>1?1:i)})):await BL(n)}destroy(){this.renderStats=void 0,Jn.off(ns.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Jn.off(ns.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=uh.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Xs.INIT,!this.videoElementCheckInterval&&(Y8.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=Xs.DESTROYED)},1e3),re("ENABLE_VIDEO_FRAME_CALLBACK"))){var n,i;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,re("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===uh.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=uh.VideoStateFrozen:document.addEventListener("visibilitychange",h))},_=(y,S)=>{if(this.videoElementStatus===Xs.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=S.mediaTime):this.renderStats={lastTs:S.mediaTime,curTs:S.mediaTime,lastRenderNum:0,renderNum:0},u){const k=S.presentationTime-u.presentationTime;this.videoState===uh.VideoStateStarting&&(this.videoState=uh.VideoStateDecoding),this.videoState===uh.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,re("VIDEO_FREEZE_DURATION"))),k<re("VIDEO_FREEZE_DURATION")&&this.videoState===uh.VideoStateFrozen&&(this.videoState=uh.VideoStateDecoding),k>re("VIDEO_FREEZE_DURATION")&&Fp.lastVisibleTime>=Fp.lastHiddenTime&&u.timestamp>Fp.lastVisibleTime&&u.timestamp>Fp.lastHiddenTime&&(this.renderFreezeAccTime+=k)}u=wr(wr({},S),{},{timestamp:y})}var w,A;re("ENABLE_VIDEO_FRAME_CALLBACK")&&((w=(A=this.videoElement).requestVideoFrameCallback)===null||w===void 0||w.call(A,_))};(n=(i=this.videoElement).requestVideoFrameCallback)===null||n===void 0||n.call(i,_)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),_A()&&!re("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=Rn();o.name==="Safari"&&Number(o.version)===15||pv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Nr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Nr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{D.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){Y8.forEach(n=>{this.videoElement&&this.videoElement.removeEventListener(n,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Xs.NONE}handleAutoPlayFailed(){const n=i=>{i.preventDefault(),this.videoElement.play().then(()=>{D.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{D.error(o)}),this.autoplayFailed=!1,JT()?document.body.removeEventListener("click",n,!0):(document.body.removeEventListener("touchstart",n,!0),document.body.removeEventListener("mousedown",n,!0))};JT()?document.body.addEventListener("click",n,!0):(document.body.addEventListener("touchstart",n,!0),document.body.addEventListener("mousedown",n,!0)),e8()}}const Y8=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class X8 extends WL{constructor(n){super(n),Pe(this,"container",void 0),Pe(this,"slot",void 0),this.slot=n.element,this.updateConfig(n)}updateConfig(n){this.config=n,this.trackId=n.trackId;const i=n.element;i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()}updateVideoTrack(n){this.videoTrack!==n&&(this.videoTrack=n,this.createElements())}play(n){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(n)}getCurrentFrame(){var n;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(n){var i;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(n,o):await BL(n)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",re("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var n;!this.container||(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var n;if((n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var J8,Q8,Z8,ez,tz,nz,rz,iz,sz,oz,az,cz,lz,uz,dz,hz,pz,fz,mz,gz,_z,Ez,yz,vz,Tn,Sz,Tz,bz,wz,Rz,Cz,Iz,Az,Mc;let mr=(J8=xt({argsMap:(e,n,i)=>[e.getTrackId(),typeof n=="string"?n:n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),Q8=Jr(),Z8=xt({argsMap:e=>[e.getTrackId()]}),ez=gv("LocalVideoTrack","_enabledMutex"),tz=xt({argsMap:(e,n)=>[e.getTrackId(),n]}),nz=Jr(),rz=gv("LocalVideoTrack","_enabledMutex"),iz=xt({argsMap:(e,n)=>[e.getTrackId(),n]}),sz=Jr(),oz=xt({argsMap:(e,n)=>[e.getTrackId(),n]}),az=Jr(),cz=Jr(),lz=xt({argsMap:(e,n,i)=>[e.getTrackId(),n,i]}),uz=Jr(),dz=Jr(),hz=Jr(),pz=Jr(),fz=Jr(),mz=Jr(),gz=Jr(),_z=xt({argsMap:(e,n)=>[e.getTrackId(),n.name]}),Ez=xt({argsMap:e=>[e.getTrackId()]}),yz=xt({argsMap:e=>[e.getTrackId()]}),vz=xt({argsMap:(e,n,i)=>[e.getTrackId(),n.label,i]}),Tn=class ise extends Rv{get videoHeight(){if(gs()){const{height:n}=this._mediaStreamTrack.getSettings();return this._videoHeight=n,this._videoHeight}return this._videoHeight}get videoWidth(){if(gs()){const{width:n}=this._mediaStreamTrack.getSettings();return this._videoWidth=n,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Xs.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(n){this._processorContext=n}get __className__(){return"LocalVideoTrack"}constructor(n,i,o,c,u,h){if(super(n,u),Pe(this,"trackMediaType",wv.VIDEO),Pe(this,"_player",void 0),Pe(this,"isUseScaleResolutionDownBy",!1),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"_encoderConfig",void 0),Pe(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Pe(this,"_optimizationMode",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_videoWidth",void 0),Pe(this,"_forceBitrateLimit",void 0),Pe(this,"_enabled",!0),Pe(this,"_processorDestination",void 0),Pe(this,"_processorContext",void 0),gs()){const{width:m,height:_}=n.getSettings();this._videoWidth=m,this._videoHeight=_}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=i,this._scalabilityMode=o,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(ar.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(sL(Mn.CHROME,115)&&mA().indexOf("Windows")!==-1){const m=function(_,y){if("VideoFrame"in window&&"TransformStream"in window&&kn().supportWebRTCInsertableStream){const S=new MediaStreamTrackProcessor(_),w=new MediaStreamTrackGenerator({kind:"video"});let A,k,W=Date.now();const U=()=>{V&&(clearInterval(V),V=void 0),A&&(A.close(),A=void 0),_.stop(),k=void 0,w.removeEventListener("ended",U)};let V=window.setInterval(()=>{if(k&&A&&Date.now()-W>1e3)try{w.readyState==="live"?k.enqueue(A.clone()):U()}catch{U()}},1e3);const q=new TransformStream({transform:(Y,ce)=>{w.readyState==="live"?(k=ce,W=Date.now(),A===void 0?(A=Y,ce.enqueue(Y.clone())):(ce.enqueue(A),A=Y)):Y.close()}});return w.addEventListener("ended",U),S.readable.pipeThrough(q).pipeTo(w.writable),w}}(n);m&&(D.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}i&&this._hints.indexOf(ar.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new r8(this.getTrackId(),"local"),this._processorDestination=new n8(this.processorContext),this.bindProcessorDestinationEvents()}play(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof n=="string"){const c=document.getElementById(n);c?n=c:(D.warning("[".concat(this.getTrackId(),'] can not find "#').concat(n,'" element, use document.body')),n=document.body)}D.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const o=wr(wr(wr({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:n});this._player?this._player.updateConfig(o):(n instanceof HTMLVideoElement?this._player=new WL(o):this._player=new X8(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit(Tv.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},re("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,D.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(n,i){if(!i){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),n),!n){this._originMediaStreamTrack.enabled=!1;try{await sr(this,gt.NEED_DISABLE_TRACK,this)}catch(o){throw D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return i||(this._enabled=!1),void D.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await sr(this,gt.NEED_ENABLE_TRACK,this)}catch(o){throw D.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}D.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(n){n!==this._muted&&(this.stateCheck("muted",n),this._muted=n,this._originMediaStreamTrack.enabled=!n,D.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(n)),n?await sr(this,gt.NEED_MUTE_TRACK,this):await sr(this,gt.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(n,i){if(!this._enabled)throw new Le(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(n=lh(n),this._forceBitrateLimit&&(n.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:n.bitrateMin),n.width||n.height||n.frameRate){const o=kA({encoderConfig:n});(gs()||mo()||tu())&&(o.deviceId=void 0),D.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(n),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const u=new Le(X.UNEXPECTED_ERROR,c.toString());throw D.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=n,this._hints.indexOf(ar.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sr(this,gt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(D)}}getStats(){return Em(()=>{D.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Ic(this,gt.GET_STATS)||wr({},LL)}async setBeautyEffect(n){D.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(n,i):await BL(n)}async setBitrateLimit(n){D.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(n))),n&&(this._forceBitrateLimit=n,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<n.max_bitrate?this._encoderConfig.bitrateMax:n.max_bitrate:this._encoderConfig.bitrateMax=n.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=n.min_bitrate))}async setOptimizationMode(n){if(n!=="motion"&&n!=="detail"&&n!=="balanced")return void D.error(X.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const i=this._optimizationMode;try{this._optimizationMode=n,await sr(this,gt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=i,D.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}D.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(n,")"))}setScalabiltyMode(n){if(n.numSpatialLayers===1&&n.numTemporalLayers!==1)return D.error(X.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=n,D.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(n,")"))}updateMediaStreamTrackResolution(){o8(this._originMediaStreamTrack).then(n=>{let[i,o]=n;this._videoHeight=o,this._videoWidth=i}).catch(vA)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(n){if(!this._enabled)throw new Le(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");D.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(n)),n=lh(n),this._forceBitrateLimit&&(n.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:n.bitrateMax,n.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:n.bitrateMin),this._encoderConfig=n,this._hints.indexOf(ar.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sr(this,gt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(D)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:n,height:i,frameRate:o}=this.getMediaStreamTrackSettings();if(!n||!i||!o)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:m}=function(_,y,S,w,A){const k=re("BITRATE_ADAPTER_TYPE");if(k==="DEFAULT_BITRATE")return{min:w,max:A};if(A===void 0){var W;const V=Math.floor(200*Math.pow(S/15,.6)*Math.pow(_*y/640/360,.75));A=k==="STANDARD_BITRATE"?4*V:2*V,w=(W=w)!==null&&W!==void 0?W:V}else{var U;w=(U=w)!==null&&U!==void 0?U:Math.floor(A/10)}return{min:w,max:A}}(n,i,o,u,c);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,D.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(n,", h: ").concat(i,", fps: ").concat(o,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var n,i;const o=this==null||(n=this._player)===null||n===void 0?void 0:n.getContainerElement(),c={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=aW.checkOneElementVisible(u),_=Object.assign({},m);if(_.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=_.visible;const y=wt.reportApiInvoke(null,{tag:Lr.TRACER,name:mi.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});_.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(_.reason))}return _}return}catch(o){throw new Le(X.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(n){}pipe(n){if(this.processor===n)return n;if(n._source)throw new Le(X.INVALID_OPERATION,"Processor ".concat(n.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=n,this.processor._source=this,n.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),n}unpipe(){if(!this.processor)return;const n=this.processor;this.processor._source=void 0,this.processor=void 0,n.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(n){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;n&&(o=wr(wr({},o),lh(n))),o=y_(o);const c=or(8,"track-video-cloned-"),u=new ise(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,y_(this._scalabilityMode),this._optimizationMode,c,y_(this._hints));return n&&o&&u.setEncoderConfiguration(o),D.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}async replaceTrack(n,i){if(!(n instanceof MediaStreamTrack))throw new Le(X.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(n.kind!=="video")throw new Le(X.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(n,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(n){if(Em(()=>{wt.reportApiInvoke(null,{name:mi.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Lr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!re("ENABLE_VIDEO_SEI")||!re("ENABLE_ENCODED_TRANSFORM"))return void D.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(n instanceof Uint8Array==0)return new Le(X.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const i=this.getRTCRtpTransceiver();if(!i)return void D.warning("Video track is not published, SEI can not be send");const o=i.sender.getParameters();if(o.codecs.length===0)return;const c=o.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",n):D.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on(go.ON_TRACK,async n=>{n?n!==this._mediaStreamTrack&&(this._mediaStreamTrack=n,this._updatePlayerSource(),await sr(this,gt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await sr(this,gt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(go.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(kc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(kc.REQUEST_CONSTRAINTS)}},In(Tn.prototype,"play",[J8,Q8],Object.getOwnPropertyDescriptor(Tn.prototype,"play"),Tn.prototype),In(Tn.prototype,"stop",[Z8],Object.getOwnPropertyDescriptor(Tn.prototype,"stop"),Tn.prototype),In(Tn.prototype,"setEnabled",[ez,tz,nz],Object.getOwnPropertyDescriptor(Tn.prototype,"setEnabled"),Tn.prototype),In(Tn.prototype,"setMuted",[rz,iz,sz],Object.getOwnPropertyDescriptor(Tn.prototype,"setMuted"),Tn.prototype),In(Tn.prototype,"setEncoderConfiguration",[oz,az],Object.getOwnPropertyDescriptor(Tn.prototype,"setEncoderConfiguration"),Tn.prototype),In(Tn.prototype,"getStats",[cz],Object.getOwnPropertyDescriptor(Tn.prototype,"getStats"),Tn.prototype),In(Tn.prototype,"setBeautyEffect",[lz,uz],Object.getOwnPropertyDescriptor(Tn.prototype,"setBeautyEffect"),Tn.prototype),In(Tn.prototype,"getCurrentFrameData",[dz],Object.getOwnPropertyDescriptor(Tn.prototype,"getCurrentFrameData"),Tn.prototype),In(Tn.prototype,"getCurrentFrameImage",[hz],Object.getOwnPropertyDescriptor(Tn.prototype,"getCurrentFrameImage"),Tn.prototype),In(Tn.prototype,"setBitrateLimit",[pz],Object.getOwnPropertyDescriptor(Tn.prototype,"setBitrateLimit"),Tn.prototype),In(Tn.prototype,"setOptimizationMode",[fz],Object.getOwnPropertyDescriptor(Tn.prototype,"setOptimizationMode"),Tn.prototype),In(Tn.prototype,"setScalabiltyMode",[mz],Object.getOwnPropertyDescriptor(Tn.prototype,"setScalabiltyMode"),Tn.prototype),In(Tn.prototype,"updateMediaStreamTrackResolution",[gz],Object.getOwnPropertyDescriptor(Tn.prototype,"updateMediaStreamTrackResolution"),Tn.prototype),In(Tn.prototype,"pipe",[_z],Object.getOwnPropertyDescriptor(Tn.prototype,"pipe"),Tn.prototype),In(Tn.prototype,"unpipe",[Ez],Object.getOwnPropertyDescriptor(Tn.prototype,"unpipe"),Tn.prototype),In(Tn.prototype,"close",[yz],Object.getOwnPropertyDescriptor(Tn.prototype,"close"),Tn.prototype),In(Tn.prototype,"replaceTrack",[vz],Object.getOwnPropertyDescriptor(Tn.prototype,"replaceTrack"),Tn.prototype),Tn),zL=(Sz=xt({argsMap:(e,n)=>[e.getTrackId(),n]}),Tz=Jr(),bz=gv("CameraVideoTrack","_enabledMutex"),wz=xt({argsMap:(e,n)=>[e.getTrackId(),n]}),Rz=Jr(),Cz=xt({argsMap:(e,n)=>[e.getTrackId(),n]}),Iz=Jr(),Az=xt({argsMap:e=>[e.getTrackId()]}),Mc=class sse extends mr{get __className__(){return"CameraVideoTrack"}constructor(n,i,o,c,u,h){super(n,lh(i.encoderConfig),c,u,h),Pe(this,"_config",void 0),Pe(this,"_originalConstraints",void 0),Pe(this,"_constraints",void 0),Pe(this,"_enabled",!0),Pe(this,"_deviceName","default"),Pe(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(pv()||cL())&&!function(){const m=Rn();if(m.os!==Ni.IOS||!m.osVersion)return!1;const _=m.osVersion.split(".");return Number(_[0])===15&&Number(_[1])>=2}()&&rW()&&this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=o,this._constraints=o,this._deviceName=n.label,this._encoderConfig=lh(this._config.encoderConfig),Jn.on(ns.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Jn.on(ns.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(n){return typeof n=="string"?this._setDeviceById(n):n.deviceId?this._setDeviceById(n.deviceId):n.facingMode?this._setDeviceByFacingModel(n.facingMode):void 0}async _setDeviceById(n){if(D.info("[".concat(this.getTrackId(),"] set device to ").concat(n)),this._enabled)try{const i=await Lc.getDeviceById(n),o={};o.video=wr({},this._constraints),o.video.deviceId={exact:n},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await Dc(o,this.getTrackId())}catch(u){throw D.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await Dc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=n,this._constraints.deviceId={exact:n}}catch(i){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await Lc.getDeviceById(n);this._deviceName=i.label,this._config.cameraId=n,this._constraints.deviceId={exact:n}}catch(i){throw D.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}D.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(n){D.info("[".concat(this.getTrackId(),"] set facingMode ").concat(n));const i={video:wr(wr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:n}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await Dc(i,this.getTrackId())}catch(c){throw D.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),o=await Dc({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=n,this._config.cameraId=void 0,this._constraints=wr({},i.video),D.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(n,i){if(!i){if(n===this._enabled)return;this.stateCheck("enabled",n)}if(D.info("[".concat(this.getTrackId(),"] start setEnabled"),n),n){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await Dc({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await sr(this,gt.NEED_ENABLE_TRACK,this)}catch(o){throw D.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),D.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await sr(this,gt.NEED_DISABLE_TRACK,this)}catch(o){throw D.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}D.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(n,i){if(!this._enabled)throw new Le(X.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");n=lh(n),this._forceBitrateLimit&&(n.bitrateMax=this._forceBitrateLimit.max_bitrate||n.bitrateMax,n.bitrateMin=this._forceBitrateLimit.min_bitrate||n.bitrateMin);const o=xr(this._config);o.encoderConfig=n;const c=kA(o);(gs()||mo()||tu())&&(c.deviceId=void 0),D.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(n),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new Le(X.UNEXPECTED_ERROR,u.toString());throw D.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=o,this._constraints=c,this._originalConstraints=c,this._encoderConfig=n,this._hints.indexOf(ar.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await sr(this,gt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(D)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((mo()||tu())&&this._enabled&&!this._isClosed&&Jn.duringInterruption){const n=async()=>{Jn.off(ns.IOS_INTERRUPTION_END,n),this._enabled&&!this._isClosed&&(D.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Jn.on(ns.IOS_INTERRUPTION_END,n)}else D.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Tv.TRACK_ENDED)}async renewMediaStreamTrack(n){const i=n||this._constraints,o=Lc.searchDeviceIdByName(this._deviceName);if(o&&!i.deviceId&&(i.deviceId={exact:o}),this._enabled){const c=await Dc({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Jn.off(ns.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Jn.off(ns.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(n){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;n&&(o=wr(wr({},o),lh(n))),o=y_(o);const c=or(8,"track-cam-cloned-"),u=new sse(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,y_(wr(wr({},this._config),{},{encoderConfig:o})),y_(this._constraints),y_(this._scalabilityMode),this._optimizationMode,c);return n&&o&&u.setEncoderConfiguration(o),D.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(i)),u}bindProcessorContextEvents(){this.processorContext.on(kc.REQUEST_UPDATE_CONSTRAINTS,async(n,i,o)=>{try{const c=Object.assign({},this._originalConstraints,...n);await this.renewMediaStreamTrack(c),i()}catch(c){o(c)}}),this.processorContext.on(kc.REQUEST_CONSTRAINTS,async n=>{n(this._originMediaStreamTrack.getSettings())})}},In(Mc.prototype,"setDevice",[Sz,Tz],Object.getOwnPropertyDescriptor(Mc.prototype,"setDevice"),Mc.prototype),In(Mc.prototype,"setEnabled",[bz,wz,Rz],Object.getOwnPropertyDescriptor(Mc.prototype,"setEnabled"),Mc.prototype),In(Mc.prototype,"setEncoderConfiguration",[Cz,Iz],Object.getOwnPropertyDescriptor(Mc.prototype,"setEncoderConfiguration"),Mc.prototype),In(Mc.prototype,"close",[Az],Object.getOwnPropertyDescriptor(Mc.prototype,"close"),Mc.prototype),Mc);function GL(e,n,i,o){i.optimizationMode&&(o&&o.width&&o.height?(i.encoderConfig=wr(wr({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(n.contentHint=i.optimizationMode,n.contentHint===i.optimizationMode?D.debug("[".concat(e,"] set content hint to"),i.optimizationMode):D.debug("[".concat(e,"] set content hint failed")))):D.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var Pz,Oz,kz,Nz,ml,Dz,Lz,xz,Mz,Uz,Vz,Js;class Fz extends HW{getUserId(){return this._userId}constructor(n,i,o,c){super(n,"track-".concat(n.kind,"-").concat(i,"-").concat(c.clientId,"_").concat(or(5,""))),Pe(this,"_userId",void 0),Pe(this,"_uintId",void 0),Pe(this,"_isDestroyed",!1),Pe(this,"store",void 0),Pe(this,"processor",void 0),Pe(this,"processorContext",void 0),this._userId=i,this._uintId=o,this.store=c}_updateOriginMediaStreamTrack(n){this._originMediaStreamTrack=n,this._mediaStreamTrack=n,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,D.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Av=(Pz=xt({argsMap:(e,n,i)=>[e.getTrackId(),typeof n=="string"?n:n instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),Oz=xt({argsMap:e=>[e.getTrackId()]}),kz=xt({argsMap:(e,n)=>[e.getTrackId(),n.name]}),Nz=xt({argsMap:e=>[e.getTrackId()]}),In((ml=class extends Fz{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Xs.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,n,i,o){super(e,n,i,o),Pe(this,"_videoVisibleTimer",null),Pe(this,"_previousVideoVisibleStatus",void 0),Pe(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Pe(this,"trackMediaType",wv.VIDEO),Pe(this,"_videoWidth",void 0),Pe(this,"_videoHeight",void 0),Pe(this,"_player",void 0),Pe(this,"processorDestination",void 0),Pe(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new r8(this.getTrackId(),"remote"),this.processorDestination=new n8(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Em(()=>{D.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Ic(this,gt.GET_STATS)||wr({},zW)}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const o=document.getElementById(e);o?e=o:(D.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}D.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=wr(wr({fit:"cover"},n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(i):(e instanceof HTMLVideoElement?this._player=new WL(i):this._player=new X8(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(bv.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(bv.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(bv.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},re("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,D.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){o8(this._originMediaStreamTrack).then(e=>{let[n,i]=e;this._videoHeight=i,this._videoWidth=n}).catch(vA)}_updatePlayerSource(){D.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,n;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:c,slot:u}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=aW.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const _=wt.reportApiInvoke(null,{tag:Lr.TRACER,name:mi.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?_.onSuccess("Video is visible"):_.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(i){throw new Le(X.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Le(X.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(go.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(go.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(b_.SEI_RECEIVED,e)}}).prototype,"play",[Pz],Object.getOwnPropertyDescriptor(ml.prototype,"play"),ml.prototype),In(ml.prototype,"stop",[Oz],Object.getOwnPropertyDescriptor(ml.prototype,"stop"),ml.prototype),In(ml.prototype,"pipe",[kz],Object.getOwnPropertyDescriptor(ml.prototype,"pipe"),ml.prototype),In(ml.prototype,"unpipe",[Nz],Object.getOwnPropertyDescriptor(ml.prototype,"unpipe"),ml.prototype),ml),Pv=(Dz=xt({argsMap:(e,n)=>[e.getTrackId(),n],throttleTime:300}),Lz=xt({argsMap:(e,n)=>[e.getTrackId(),n]}),xz=xt({argsMap:e=>[e.getTrackId()]}),Mz=xt({argsMap:e=>[e.getTrackId()]}),Uz=xt({argsMap:(e,n)=>[e.getTrackId(),n.name]}),Vz=xt({argsMap:e=>[e.getTrackId()]}),In((Js=class extends Fz{get isPlaying(){return this._useAudioElement?zo.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,n,i,o){super(e,n,i,o),Pe(this,"trackMediaType",wv.AUDIO),Pe(this,"_source",void 0),Pe(this,"_useAudioElement",!0),Pe(this,"_volume",100),Pe(this,"processorContext",void 0),Pe(this,"processorDestination",void 0),Pe(this,"_played",!1),Pe(this,"_bypassWebAudio",!1),re("DISABLE_WEBAUDIO")?(this._source=new jL,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new YW(e,!0),re("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Oc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(bv.FIRST_FRAME_DECODED)}),this.processorContext=new s8(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new i8(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Oc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Oc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(n),this._source.removeAllListeners(Oc.ON_AUDIO_BUFFER),this._source.on(Oc.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?zo.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!FW())throw new Le(X.NOT_SUPPORTED,"your browser does not support setting the audio output device");await zo.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Em(()=>{D.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Ic(this,gt.GET_STATS)||wr({},WW)}play(){D.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(D.debug("[".concat(this.getTrackId(),"] use audio element to play")),zo.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){D.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?zo.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];D.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&zo.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Le(X.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Le(X.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Le(X.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const n=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,n.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(go.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(go.ON_NODE,e=>{this._source.processedNode=e;const n=!e;this._useAudioElement!==n&&(this._played?(this.stop(),this._useAudioElement=n,this.play()):this._useAudioElement=n)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(go.ON_TRACK),this.processorDestination.removeAllListeners(go.ON_NODE)}}).prototype,"setVolume",[Dz],Object.getOwnPropertyDescriptor(Js.prototype,"setVolume"),Js.prototype),In(Js.prototype,"setPlaybackDevice",[Lz],Object.getOwnPropertyDescriptor(Js.prototype,"setPlaybackDevice"),Js.prototype),In(Js.prototype,"play",[xz],Object.getOwnPropertyDescriptor(Js.prototype,"play"),Js.prototype),In(Js.prototype,"stop",[Mz],Object.getOwnPropertyDescriptor(Js.prototype,"stop"),Js.prototype),In(Js.prototype,"pipe",[Uz],Object.getOwnPropertyDescriptor(Js.prototype,"pipe"),Js.prototype),In(Js.prototype,"unpipe",[Vz],Object.getOwnPropertyDescriptor(Js.prototype,"unpipe"),Js.prototype),Js);const Fp=new class extends Ar{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Pe(this,"_lastHiddenTime",0),Pe(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),D.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class jz extends Ar{constructor(n,i){super(),Pe(this,"trackMediaType",wv.DATA),Pe(this,"_version",1),Pe(this,"_type",3),Pe(this,"_config",void 0),Pe(this,"_originDataChannel",void 0),Pe(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Pe(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),Pe(this,"_datachannelEventMap",new Map),this._config=n,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader()}useDataStream(n){this._dataStreamPacketHandler=n}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return re("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var n,i;return(n=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&n!==void 0?n:"connecting"}get _originDataChannelId(){var n,i;return(n=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&n!==void 0?n:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new lt((n,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&n();const o=setTimeout(()=>{var c;i(new Le(X.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),n()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new Le(X.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new Le(X.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(n){this._originDataChannel=n,this._bandDataChannelEvents(n)}_initPacketHeader(){const n=new DataView(this._dataStreamPacketHeader);n.setUint16(0,this._version),n.setUint8(2,this._type),n.setUint8(3,this._config.id)}_bandDataChannelEvents(n){this._unbindDataChannelEvents(n),[PA.OPEN,PA.CLOSE,PA.ERROR].forEach(i=>{const o=()=>{this.emit(i)};this._datachannelEventMap.set(i,o),n.addEventListener(i,o)})}_unbindDataChannelEvents(n){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[o,c]=i;n.removeEventListener(o,c)}),this._datachannelEventMap.clear()}}class ype extends jz{constructor(n){super(n),Pe(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=i.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(o).getUint8(3);if(c!==this.id)return void(re("SHOW_DATASTREAM2_LOG")&&D.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=i.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(PA.MESSAGE,u)}}_updateOriginDataChannel(n){super._updateOriginDataChannel(n),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class vpe extends jz{send(n){if(this._originDataChannel){let i=n;i=this._dataStreamPacketHandler.serialize(n);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function DA(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>DI.revokeObjectURL(e),0),new Worker(DI.createObjectURL(e))}const Bz=71,HL=1,$L=2,KL=1,Wz=2;var jp=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(jp||{});function zz(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=e.getUint8(0);if(i!==Bz)return;const o=e.getUint16(1),c=HL+$L+o,u=new Uint8Array(e.byteLength-c);u.set(new Uint8Array(e.buffer,c,e.byteLength-c));const h={m:i,tlvLen:o,tlv:[],frame:u};let m=HL+$L;for(;m<c;){const _=e.getUint8(m),y=e.getUint16(m+KL),S=KL+Wz;if(_===jp.AUDIO_LEVEL){let w=e.getUint8(m+S);for(let A=1;A<y;A++)w=w<<8|e.getUint8(m+S+A);h.tlv.push({tag:_,length:y,value:n?127^w>>1:127&w})}else if(_===jp.METADATA||_===jp.AUDIO_64_BIT_PTS){const w=new Uint8Array(y);for(let A=0;A<y;A++)w[A]=e.getUint8(m+S+A);h.tlv.push({tag:_,length:y,value:w})}m+=S+y}return h}const LA=new Map,xA=127,C_=1e-10,qL=139/13,MA=new Map;function YL(e,n,i){const o="".concat(e,"-").concat(n,"-").concat(i);let c=0;return MA.has(o)?c=MA.get(o):(c=Math.log(function(h,m){const _=h-m;m<_&&(m=_);let y=1;for(let S=h,w=1;S>m;S--,w++)y=y*S/w;return y}(n,e))+e*Math.log(.5)+(n-e)*Math.log(1-.5)-Math.log(i)+i*e,MA.set(o,c)),c<C_&&(c=C_),c}function Gz(e,n,i){const o=n.length,c=e.length/o;let u=!1;for(let h=0,m=0;h<o;h++){let _=0;for(let y=m+c;m<y;m++)e[m]>i&&_++;n[h]!==_&&(n[h]=_,u=!0)}return u}window.cache=MA;let Spe=0;class Hz{constructor(n){Pe(this,"id",void 0),Pe(this,"immediates",[]),Pe(this,"lastNonSilence",-1),Pe(this,"immediateSpeechActivityScore",C_),Pe(this,"lastLevelChangedTime",Date.now()),Pe(this,"levels",[]),Pe(this,"longs",[]),Pe(this,"longSpeechActivityScore",C_),Pe(this,"mediums",[]),Pe(this,"mediumSpeechActivityScore",C_),Pe(this,"minLevel",0),Pe(this,"nextMinLevel",0),Pe(this,"nextMinLevelWindowLength",0),Pe(this,"energyScore",0),this.id=n||"".concat(Spe++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const n=this.immediates,i=this.levels,o=this.minLevel+qL;let c=!1;for(let u=0;u<n.length;++u){let h=i[u];h<o&&(h=0);const m=Math.floor(h/qL);n[u]!==m&&(n[u]=m,c=!0)}return c}computeLongs(){return Gz(this.mediums,this.longs,4)}computeMediums(){return Gz(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=YL(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(n){this.longSpeechActivityScore=YL(this.longs[0],10,47),this.longSpeechActivityScore>C_&&(this.lastNonSilence=n)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=YL(this.mediums[0],5,24)}evaluateSpeechActivityScores(n){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(n)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var n;return"[".concat(Hf(n=[...this.levels]).call(n).join(),"]")}getSpeechActivityScore(n){switch(n){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+n)}}levelChanged(n,i){if(this.lastLevelChangedTime<=i){this.lastLevelChangedTime=i;let o=n;return n<0&&(o=0),n>xA&&(o=xA),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+qL?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(n){if(n!==0){if(this.minLevel===0||this.minLevel>n)return this.minLevel=n,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=n,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>n&&(this.nextMinLevel=n),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let i=Math.sqrt(this.minLevel*this.nextMinLevel);i<0?i=0:i>xA&&(i=xA),this.minLevel=i,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Tpe{constructor(n){Pe(this,"algorithm",void 0),this.algorithm=n}execute(){let n=!this.algorithm;if(!n)try{const i=this.algorithm.runInDecisionMaker(this);i<=0?n=!0:setTimeout(this.execute.bind(this),i)}catch{n=!0}n&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class XL{constructor(n,i,o){Pe(this,"isDominant",void 0),Pe(this,"energyRanking",void 0),Pe(this,"energyScore",void 0),this.isDominant=n,this.energyRanking=i,this.energyScore=o}}class bpe extends Ar{constructor(n){super(),Pe(this,"dominantId",null),Pe(this,"lastDecisionTime",0),Pe(this,"lastLevelChangedTime",0),Pe(this,"lastLevelIdleTime",0),Pe(this,"relativeSpeechActivities",[]),Pe(this,"speakers",new Map),Pe(this,"enableSilence",!1),Pe(this,"timeoutToSilenceInterval",0),Pe(this,"decisionMaker",null),Pe(this,"loudest",[]),Pe(this,"numLoudestToTrack",3),Pe(this,"energyExpireTimeMs",250),Pe(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=n,this.enableSilence=n>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,i=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=n,i!=null&&(this.energyExpireTimeMs=i),o!=null&&(this.energyAlphaPct=o),this.loudest.length>n&&this.loudest.splice(n)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(n){return this.loudest.some(i=>i.id===n)}levelChanged(n,i){const o=Date.now(),c=this.getOrCreateSpeaker(n);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const u=c.levelChanged(i,o);return this.updateLoudestList(c,u,o)}runInDecisionMaker(n){return this.decisionMaker!==n||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(n){this.decisionMaker===n&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(n){n.forEach(i=>{this.speakers.has(i.id)||this.speakers.set(i.id,i)})}removeSpeakers(n){n.forEach(i=>{this.speakers.delete(i.id)})}getOrCreateSpeaker(n){let i=this.speakers.get(n);return i||(i=new Hz(n),this.speakers.set(n,i),this.maybeStartDecisionMaker()),i}updateLoudestList(n,i,o){const c=n.id===this.dominantId;if(i<0){let _=0;for(;_<this.loudest.length&&this.loudest[_]!==n;)++_;return new XL(c,_,n.energyScore)}if(n.energyScore=Math.floor((this.energyAlphaPct*i+(100-this.energyAlphaPct)*n.energyScore+50)/100),this.numLoudestToTrack===0)return new XL(c,0,n.energyScore);const u=o-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const _=this.loudest[h];if(_.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(_.id!==n.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<n.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,n),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new XL(c,m,n.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Tpe(this),this.decisionMaker.execute())}makeDecision(n){let i=null,o=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const m=Rc(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(u=m.id,m.evaluateSpeechActivityScores(n),n-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const S=this.speakers.entries().next();S.value&&(u=S.value[0],m=S.value[1])}else u=m.id;m!=null&&m.evaluateSpeechActivityScores(n);const _=this.relativeSpeechActivities;let y=2;for(const S of this.speakers.entries()){const[w,A]=S;if(A===m)continue;A.evaluateSpeechActivityScores(n);for(let V=0;V<_.length;++V){const q=m==null?C_:m.getSpeechActivityScore(V);_[V]=Math.log(A.getSpeechActivityScore(V)/q)}const k=_[0],W=_[1],U=_[2];k>3&&W>2&&U>0&&W>y&&(y=W,u=w)}this.enableSilence&&m!=null&&u===m.id&&n-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(i=this.dominantId,this.dominantId=u,o=this.dominantId),o==null&&!this.enableSilence||o===i||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const n=Date.now(),i=300-(n-this.lastLevelIdleTime);let o=0;i<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(n),this.lastLevelIdleTime=n):o=i;let c=300-(n-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=n,this.makeDecision(n),c=300-(Date.now()-n)),c>0&&o>c&&(o=c),o}timeoutIdleLevels(n){const i=[];for(const c of Rc(o=this.speakers).call(o)){var o;const u=n-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?i.push(c.id):300<u&&c.levelTimedOut()}i.forEach(c=>this.speakers.delete(c))}}const Ov=new Map;let ud=null,UA=null;const $z=3;let I_=[];const dd=new Map,VA=new Map;class wpe{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(n,i){Pe(this,"id",void 0),Pe(this,"track",void 0),Pe(this,"score",0),Pe(this,"active",!0),Pe(this,"muted",!1),Pe(this,"timer",0),Pe(this,"actives",0),Pe(this,"inactives",0),this.id=n,this.track=i,this.setActive(dd.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const n=this.active;this.active=this.activeRate>=.8;const{actives:i,inactives:o}=function(){const c=[],u=[];return Array.from(Rc(dd).call(dd)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(i.length>3){let c;i.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(i.length<3&&o.length>0){let c;o.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&n&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(n){this.active=n,this.resetTimer(),this.setMuted(!n)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const n=function(i){let o;return Array.from(Rc(dd).call(dd)).forEach(c=>{!c.active||c.id===i||c.samples<40||(!o||c.score<o.score)&&(o=c)}),o}(this.id);n&&this.activeRate-n.activeRate>.4&&(n.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const n=function(i){let o;return Array.from(Rc(dd).call(dd)).forEach(c=>{c.active||c.id===i||c.samples<40||(!o||c.score>o.score)&&(o=c)}),o}(this.id);n&&n.activeRate-this.activeRate>.4&&(n.setActive(!0),this.setActive(!1))}addSample(n){n?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(n){this.track&&(this.track.enabled=!n,this.muted=n)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let FA;function Kz(e){const n=dd.get(e);n&&(dd.delete(e),n.clearTimer())}const jA=new Map,Rpe=new Map;function Cpe(e,n,i){let o=new Uint8Array(e,n,i),c=[],u=0;for(;c.length<i;)u+3<i&&o[u]===0&&o[u+1]===0&&o[u+2]===3&&(o[u+3]===0||o[u+3]===1||o[u+3]===2||o[u+3]===3)?(c.push(o[u],o[u+1],o[u+3]),u+=4):(c.push(o[u]),u++);return new Uint8Array(c)}const BA=new Map,ab=new Map;(function(){const e=Rn();ts.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),ts.getStreamFromExtension=e.name===Mn.CHROME&&Number(e.version)>34,ts.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const n=new RTCPeerConnection;let i=!1;try{n.addTransceiver("audio"),i=!0}catch{}return n.close(),i}(),ts.supportMinBitrate=e.name===Mn.CHROME||e.name===Mn.EDGE,ts.supportSetRtpSenderParameters=function(){const n=Rn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Mp()||!(!gs()&&!gA())||n.name===Mn.FIREFOX&&Number(n.version)>=64)}(),e.name===Mn.SAFARI&&(Number(e.version)>=14?ts.supportDualStream=!0:ts.supportDualStream=!1),ts.webAudioMediaStreamDest=function(){const n=Rn();return!(n.name===Mn.SAFARI&&Number(n.version)<12)}(),ts.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",ts.supportWebGL=typeof WebGLRenderingContext<"u",ts.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Mp()||(ts.webAudioWithAEC=!0),ts.supportShareAudio=function(){const n=Rn();return(n.os===Ni.WIN_10||n.os===Ni.WIN_81||n.os===Ni.WIN_7||n.os===Ni.LINUX||n.os===Ni.MAC_OS||n.os===Ni.CHROMIUM_OS)&&n.name===Mn.CHROME&&Number(n.version)>=74}(),ts.supportDataChannel=!!(XT(76)||function(n){const i=Rn();return!(i.name!==Mn.FIREFOX||!i.osVersion)&&Number(i.version)>=n}(68)||Q6(14)),ts.supportPCSetConfiguration=function(){const n=window.RTCPeerConnection;return!Nr()&&!!n&&n.prototype.setConfiguration instanceof Function}(),ts.supportWebRTCEncodedTransform=function(){const n=Rn();return n.name==="Chrome"&&Number(n.version)>=87||n.name==="Safari"&&Number(n.version)>=15}(),ts.supportWebRTCInsertableStream=function(){const n=Rn();return(n.name===Mn.CHROME||n.name===Mn.EDGE)&&Number(n.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),ts.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,ts.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,yA(()=>{ts.supportDualStreamEncoding=function(){const n=Rn();return!!re("DISABLE_WEBAUDIO")||n.name==="Safari"&&Number(n.version)>=14||!!(n.name==="Chrome"&&/Windows/i.test(n.os||"")&&Number(n.version)>=100&&re("CHROME_DUAL_STREAM_USE_ENCODING"))}(),D.debug("browser ua: ",navigator.userAgent),D.info("browser info: ",e),D.info("browser compatibility: ",ts)})})();const Ipe=["CHINA","GLOBAL"],qz=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],A_=[],kv=[];function P_(e,n){return!!n&&A_.some(i=>i.uid===e&&i.channelName===n)}function JL(){return kv.length>0}var Ape=g5.forEach,Yz=up("forEach")?[].forEach:function(e){return Ape(this,e,arguments.length>1?arguments[1]:void 0)};xn({target:"Array",proto:!0,forced:[].forEach!=Yz},{forEach:Yz});var Ppe=Fa("Array").forEach,Ope=fc,kpe=hi,Npe=N,Dpe=Ppe,QL=Array.prototype,Lpe={DOMTokenList:!0,NodeList:!0},xpe=function(e){var n=e.forEach;return e===QL||Npe(QL,e)&&n===QL.forEach||kpe(Lpe,Ope(e))?Dpe:n},Mpe=l(xpe),Upe=Ro,Xz=_c;xn({target:"Object",stat:!0,forced:d(function(){Xz(1)})},{keys:function(e){return Xz(Upe(e))}});var Jz=l(yt.Object.keys),Vpe=l(BE),Fpe=l(zE),jpe=xn,Qz=Dg,Bpe=n_,Wpe=_t,Zz=fe,zpe=ii,Gpe=Re,Hpe=SI,$pe=dr,Kpe=hs,qpe=o5("slice"),Ype=$pe("species"),ZL=Array,Xpe=Math.max;jpe({target:"Array",proto:!0,forced:!qpe},{slice:function(e,n){var i,o,c,u=Gpe(this),h=zpe(u),m=Zz(e,h),_=Zz(n===void 0?h:n,h);if(Qz(u)&&(i=u.constructor,(Bpe(i)&&(i===ZL||Qz(i.prototype))||Wpe(i)&&(i=i[Ype])===null)&&(i=void 0),i===ZL||i===void 0))return Kpe(u,m,_);for(o=new(i===void 0?ZL:i)(Xpe(_-m,0)),c=0;m<_;m++,c++)m in u&&Hpe(o,c,u[m]);return o.length=c,o}});var Jpe=Fa("Array").slice,Qpe=N,Zpe=Jpe,ex=Array.prototype,efe=function(e){var n=e.slice;return e===ex||Qpe(ex,e)&&n===ex.slice?Zpe:n},tfe=l(efe);function Et(e,n,i,o,c){var u,h,m,_={};return Mpe(u=Jz(o)).call(u,function(y){_[y]=o[y]}),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=Vpe(h=Fpe(m=tfe(i).call(i)).call(m)).call(h,function(y,S){return S(e,n,y)||y},_),c&&_.initializer!==void 0&&(_.value=_.initializer?_.initializer.call(c):void 0,_.initializer=void 0),_.initializer===void 0&&(n5(e,n,_),_=null),_}let WA=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),tx=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),iu=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),_o=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Dt=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),lr=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Bt=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),jt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),cb=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),gn=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Eo=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Kt=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function zA(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw D.error("Invalid Channel Name ".concat(e)),new Oe(X.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function GA(e){if(n=e,!(typeof n=="number"&&Math.floor(n)===n&&0<=n&&n<=4294967295||oW(e,1,255)))throw new Oe(X.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var n;typeof e=="string"&&D.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Bp=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const nfe={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},nx={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function rx(e,n){Zi(e.url,"".concat(n,".url"),1,1e3,!1),Dr(e.x)||er(e.x,"".concat(n,".x"),0,1e4),Dr(e.y)||er(e.y,"".concat(n,".y"),0,1e4),Dr(e.width)||er(e.width,"".concat(n,".width"),0,1e4),Dr(e.height)||er(e.height,"".concat(n,".height"),0,1e4),Dr(e.zOrder)||er(e.zOrder,"".concat(n,".zOrder"),0,255),Dr(e.alpha)||er(e.alpha,"".concat(n,".alpha"),0,1,!1)}const rfe={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Sm=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),ix=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),bi=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function eG(e){if(!e.channelName)throw new Oe(X.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new Oe(X.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Zi(e.token,"info.token",1,2047),GA(e.uid),zA(e.channelName),!0}let yo=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Wp=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),va=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),Nv=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),zn=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),$i=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),HA=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Li=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),Un=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const tG=[Un.AFRICA,Un.ASIA,Un.CHINA,Un.EUROPE,Un.GLOBAL,Un.INDIA,Un.JAPAN,Un.NORTH_AMERICA,Un.OCEANIA,Un.OVERSEA,Un.SOUTH_AMERICA];let Is=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const $A={CHINA:{},ASIA:{CODE:Is.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Is.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Is.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Is.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Is.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Is.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Is.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Is.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Is.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Is.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Is.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Is.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Is.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};RL&&($A.CHINA={CODE:Is.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let lb=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function nG(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class rG extends Ar{constructor(n,i){super(),$(this,"onICEConnectionStateChange",void 0),$(this,"onConnectionStateChange",void 0),$(this,"onDTLSTransportStateChange",void 0),$(this,"onDTLSTransportError",void 0),$(this,"onICETransportStateChange",void 0),$(this,"onFirstAudioReceived",void 0),$(this,"onFirstVideoReceived",void 0),$(this,"onFirstAudioDecoded",void 0),$(this,"onFirstVideoDecoded",void 0),$(this,"onFirstVideoDecodedTimeout",void 0),$(this,"onSelectedLocalCandidateChanged",void 0),$(this,"onSelectedRemoteCandidateChanged",void 0),$(this,"onICECandidateError",void 0),$(this,"getLocalVideoStats",void 0)}}class iG extends rG{constructor(n,i){super(n,i),$(this,"establishPromise",void 0)}}let mt=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),As=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),zp=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const sG=["disconnected","failed"];let $e=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Bn=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Ot=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),su=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),ou=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Ki=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),oG=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),hh=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),gl=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),hd=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),Dv=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Qr=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),Lv=function(e){return e.ABORT="abort",e}({}),Tm=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),ife=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const sfe={[WA.ACCESS_POINT]:{[_o.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[_o.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[_o.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[_o.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[_o.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[_o.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[_o.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[WA.UNILBS]:{[iu.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[iu.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[iu.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[iu.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[iu.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[iu.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[iu.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[iu.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[iu.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[iu.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[iu.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[iu.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[WA.STRING_UID_ALLOCATOR]:{[tx.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[tx.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[tx.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function xv(e){const n=sfe[Math.floor(e/1e4)];if(!n)return{desc:"unknown error",retry:!1};const i=n[e%1e4];if(!i){if(Math.floor(e/1e4)===WA.ACCESS_POINT){const o=e%1e4;if(o.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}const ofe={[Dt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Dt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Dt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Dt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Dt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Dt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Dt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Dt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Dt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Dt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Dt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Dt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Dt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Dt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Dt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Dt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Dt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Dt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Dt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Dt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Dt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Dt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Dt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Dt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Dt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Dt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Dt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Dt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Dt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Dt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Dt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Dt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Dt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Dt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Dt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Dt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Dt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Dt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Dt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Dt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Dt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Dt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Dt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Dt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Dt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Dt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Dt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Dt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Dt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Dt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Dt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Dt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Dt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Dt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Dt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Dt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Dt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Dt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Dt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Dt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Dt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Dt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Dt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Dt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function ub(e){return ofe[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function aG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function sx(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?aG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):aG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function cG(e,n){if(typeof e=="string")return e;const{proxy:i,host:o,port:c}=e;if(n){const u=re("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(o,"/ws/?p=").concat(Number(c)+150):"wss://".concat(o,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(o,"&p=").concat(c):"wss://".concat(o,":").concat(c)}const afe=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,cfe=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,lfe=/wss:\/\/(.+):([0-9]+)\/?/,ufe=/wss:\/\/(.[^\/]+)\/?/;let dfe=0;class hfe{constructor(n,i){$(this,"id",0),$(this,"store",void 0),$(this,"recordIndex",void 0),$(this,"websockets",[]),$(this,"try443PortDuration",2e3),$(this,"forceCloseWSDuration",5e3),$(this,"try443PortTimeout",null),$(this,"forceCloseTimeout",null),$(this,"isTry443PortFailed",!1),$(this,"isNormalPortFailed",!1),$(this,"useDoubleDomain",!1),$(this,"useProxy",!1),$(this,"startTime",Date.now()),this.id=++dfe,this.try443PortDuration=re("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=n||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(n=>{n.onopen=null,n.onclose=null,n.onmessage=null,n.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var n;const i=Date.now()-this.startTime;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];D.debug("[choose-best-ws ".concat((n=this.store)===null||n===void 0?void 0:n.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...c)}createWebSocket(n,i,o){this.logger("createWebSocket:",n,{isTry443Port:i,hasTimeoutDetection:o});const c=re("GATEWAY_DOMAINS"),u=Date.now(),h=[],m=c.find(A=>{var k;return ot(k=n.host).call(k,A)});m||(this.useDoubleDomain=!1);const _=[];if(this.useDoubleDomain)c.forEach(A=>{_.push(cG(sx(sx({},n),{},{host:n.host.replace(m,A)}),i))});else{const A=sx({},n);if(i&&m){const k=c.find(W=>W!==m);k&&(A.host=A.host.replace(m,k))}_.push(cG(A,i))}try{_.forEach(A=>{const k=new WebSocket(A);k.binaryType="arraybuffer",h.push(k),this.logger("ws is connecting:",k.url)})}catch(A){if(this.logger("ws create failed"),h.forEach(k=>k.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(n,i,o);if(!i&&Number(n.port)!==443)return this.createWebSocket(n,!0,o);throw new Oe(X.WS_ERR,"init websocket failed! Error: ".concat(A.toString()))}const y=YT();this.store&&this.store.recordJoinChannelService({urls:h.map(A=>A.url),service:"gateway"},this.recordIndex),h.forEach(A=>{A.onopen=()=>{this.logger("onopen: ws ".concat(A.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(k=>{k!==A&&(k.onopen=null,k.onclose=null,k.onmessage=null,k.close(),this.logger("close backup websocket: ".concat(k.url)))}),this.websockets.length=0,y.resolve(A)},A.onclose=k=>{this.logger("onclose: ws ".concat(A.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(A.readyState));const W=h.every(U=>U.readyState===WebSocket.CLOSED||U.readyState===WebSocket.CLOSING);this.logger("".concat(i?"443":"47xx"," websocket closed, all failed: ").concat(W)),W&&(i||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(k.reason)),y.reject({code:k.code,reason:HA.A_ROUND_WS_FAILED})):!i&&W&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),w()),i?this.isTry443PortFailed=W:this.isNormalPortFailed=W},A.onmessage=k=>this.logger("".concat(A.url," onmessage: ").concat(k.data))}),this.websockets.push(...h);const S=()=>{this.websockets.forEach(A=>A.readyState!==WebSocket.OPEN&&A.close())},w=()=>{if(y.isResolved)return S();Rn().os===Ni.MAC_OS&&Nr()&&S(),this.createWebSocket(n,!0,!0).then(A=>{y.resolve(A)}).catch(A=>{this.isNormalPortFailed&&y.reject(A),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",y.isResolved),this.forceCloseTimeout=null,S()},this.forceCloseWSDuration)};return o||(()=>{if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,S()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",y.isResolved),this.try443PortTimeout=null,w()},this.try443PortDuration)})(),y.promise}chooseBestWebsocket(n,i,o,c){return this.useDoubleDomain=!!i,typeof n=="string"&&(n=function(u){let h,m,_;return[,h,m,_]=u.match(afe)||[],h||([,m,_]=u.match(cfe)||[]),m&&_||([,m,_]=u.match(lfe)||[]),m&&_||([,m]=u.match(ufe)||[]),m||D.warning("un-destructible url: ",u),{proxy:h,host:m,port:_||"443"}}(n)),this.recordIndex=c,this.useProxy=!!n.proxy,o&&this.useProxy&&(D.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(n,!!o,!1).finally(()=>this.clearTimeout())}}function lG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}class uG extends Ar{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(n){var i;ot(i=["tryNext","recover"]).call(i,n)&&this.resetReconnectCount(n),this._reconnectMode=n}get state(){return this._state}set state(n){n!==this._state&&(this._state=n,this._state==="reconnecting"?this.emit(Kt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Kt.CONNECTED):this._state==="closed"?this.emit(Kt.CLOSED):this._state==="failed"&&this.emit(Kt.FAILED))}resetReconnectCount(n){D.debug("websocket reset reconnect count, reason: "+n),this.reconnectCount=0}constructor(n,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),$(this,"connectionID",0),$(this,"currentURLIndex",0),$(this,"urls",[]),$(this,"_reconnectMode","tryNext"),$(this,"reconnectReason",void 0),$(this,"_initMutex",void 0),$(this,"name",void 0),$(this,"_state","closed"),$(this,"reconnectInterrupter",void 0),$(this,"websocket",void 0),$(this,"retryConfig",void 0),$(this,"reconnectCount",0),$(this,"forceCloseTimeout",5e3),$(this,"onlineReconnectListener",void 0),$(this,"useCompress",void 0),$(this,"tryDoubleDomain",!1),$(this,"use443PortOnly",!1),$(this,"wsInflateLength",0),$(this,"wsDeflateLength",0),$(this,"closeEstablishingWs",()=>{}),$(this,"store",void 0),$(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=n,this.retryConfig=function(w){for(var A=1;A<arguments.length;A++){var k=arguments[A]!=null?arguments[A]:{};A%2?lG(Object(k),!0).forEach(function(W){$(w,W,k[W])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(k)):lG(Object(k)).forEach(function(W){Object.defineProperty(w,W,Object.getOwnPropertyDescriptor(k,W))})}return w}({},i),this.useCompress=o,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new Cs("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:_}=i,y=Math.max(300,Math.floor(3*m/5)),S=Math.max(1.2,Math.floor(8*_)/10);Ka.ONLINE&&(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=S),oi.on(fv.NETWORK_STATE_CHANGE,(w,A)=>{w!==A&&(this.resetReconnectCount("network state change: ".concat(A," -> ").concat(w)),w===Ka.ONLINE?(this.retryConfig.timeout=y,this.retryConfig.timeoutFactor=S):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=_))})}getConnection(){return this.websocket||void 0}async init(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=i,this.urls=n,this.state="connecting";try{const c=YT(),u=this.urls[this.currentURLIndex];re("ENABLE_PREALLOC_PC")&&this.emit(oG.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(c.resolve).catch(c.reject),this.once(Kt.CLOSED,()=>{c.reject(new Le(X.WS_DISCONNECT))}),this.once(Kt.CONNECTED,c.resolve),await c.promise}catch{}finally{o()}}close(n,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;i?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0}this.state=n?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(n,i){if(!this.websocket)return void D.warning("[".concat(this.name,"] can not reconnect, no websocket"));n!==void 0&&(this.reconnectMode=n),D.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:i})}sendMessage(n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Le(X.WS_ABORT,"websocket is not ready");try{i||(n=JSON.stringify(n)),this.websocket.send(n)}catch(o){throw new Le(X.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(n){this.wsDeflateLength=this.wsDeflateLength+n.originLength,this.wsInflateLength=this.wsInflateLength+n.compressedLength}getWsInflateData(){const n=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:n,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(n){var i;const o=YT();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=S=>{var w;(w=this.store)===null||w===void 0||w.signalChannelOpen(),D.debug("[".concat(this.name,"] websocket opened:"),S),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},u=async S=>{var w;if(D.debug("[".concat(this.name,"] websocket close ").concat((w=this.websocket)===null||w===void 0?void 0:w.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new Le(X.WS_DISCONNECT,"websocket close: ".concat(S.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=S.reason,this.state="reconnecting");const A=Ic(this,Kt.WILL_RECONNECT,this.reconnectMode,S.reason)||this.reconnectMode,k=await this.reconnectWithAction(A);if(this.state==="closed")return void D.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!k)return o.reject(new Le(X.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),this.close(!0);o.resolve()}},h=S=>{this.emit(Kt.ON_MESSAGE,S)},m=S=>{D.warn("[".concat(this.connectionID,"] ws open error ").concat(S))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),re("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(n=re("GATEWAY_WSS_ADDRESS")),D.debug("[".concat(this.name,"] start connect, url:"),n);const _=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var y;const S=await this.chooseBestWebsocketConnection(n);this.websocket=S,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=m,(y=this.store)===null||y===void 0||y.recordJoinChannelService({endTs:Date.now(),status:"success"},_),this.joinGatewayRecordIndex=_}catch(S){const w=this.state==="closed",A=S instanceof Le,k=A&&S.code===X.WS_ABORT,W=A&&S.code===X.WS_ERR,U=A?S.message:S&&(S.reason||S.toString());D.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(U)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:k?"aborted":"error",errors:[S]},_),w||W?(o.reject(w?new Le(X.WS_DISCONNECT,"websocket is closed: ".concat(U)):new Le(X.WS_ERR,"init websocket failed: ".concat(U))),W&&D.error("[".concat(this.name,"] init websocket failed: ").concat(U))):u&&u(S)}return o.promise}async reconnectWithAction(n){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;D.warning("[choose-best-ws] action: =>",n),this.onlineReconnectListener||oi.isOnline||!oi.onlineWaiter||(this.onlineReconnectListener=oi.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,i){const h=_L(this.reconnectCount,this.retryConfig);D.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(n)),await lt.race([es(h),this.onlineReconnectListener||new lt(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(Kt.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(n==="retry")await c(this.urls[this.currentURLIndex],n);else if(n==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);D.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],n)}else n==="recover"&&(D.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Es(this,Kt.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],n))}catch(h){var u;D.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;return Array.isArray(m)&&ot(m).call(m,"dynamic key expired")?(this.emit(Kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(n,i)}return!0}}class ox extends uG{constructor(n,i){super(n,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(n,i){const o=YT(),c=function(h,m){return new hfe(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{D.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),o.reject(new Le(X.WS_ABORT,"choose best websocket aborted"))};const u=re("GATEWAY_DOMAINS");return D.debug("[choose-best-ws] currentDomain: ",n,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(n,this.tryDoubleDomain,this.use443PortOnly,i).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class db extends uG{constructor(n,i){super(n,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(n,i){return new lt((o,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{D.debug("[choose-best-ws] close establishing websockets"),h.forEach(W=>{W.onclose=null,W.onopen=null,W.onmessage=null,W.close()}),c(new Le(X.WS_ABORT,"choose best websocket aborted"))};const m=re("GATEWAY_DOMAINS");let _;const y=n.indexOf("?h="),S=m.find(W=>y!==-1?ot(n).call(n,W,y):ot(n).call(n,W));D.debug("[choose-best-ws] currentDomain: ",S,", domains: ",m);let w=!this.tryDoubleDomain||!S;if(!w&&S){var A;const W=Date.now();try{m.forEach(U=>{const V=y===-1?n.replace(S,U):n.substr(0,y)+n.substr(y).replace(S,U),q=new WebSocket(V);q.binaryType="arraybuffer",h.push(q),D.debug("[choose-best-ws] ws is connecting:",q.url)})}catch{for(D.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(V=>V.close());h.length;)h.pop();w=!0}(A=this.store)===null||A===void 0||A.recordJoinChannelService({urls:h.map(U=>U.url),service:"gateway"},i),h.forEach(U=>{U.onopen=()=>{if(u)return;const V=Date.now()-W;D.debug("[choose-best-ws] ws open cost ".concat(V,"ms")),h.filter(q=>q!==U).forEach(q=>{D.debug("[choose-best-ws]close backup websocket: ".concat(q.url)),q.close()}),u=!0,o(U)},U.onclose=V=>{_=V,!u&&(h.find(q=>!(q.readyState===WebSocket.CLOSED||q.readyState===WebSocket.CLOSING))||(D.debug("[choose-best-ws] all websocket is closed"),u=!0,c(_)))},U.onmessage=V=>{D.debug("[choose-best-ws]".concat(U.url," onmessage: ").concat(V.data))}}),es(this.forceCloseTimeout).then(()=>{h.forEach(U=>{U.readyState!==WebSocket.OPEN&&U.close()})})}if(w){var k;let W;D.debug("[choose-best-ws] use single url: ",n),(k=this.store)===null||k===void 0||k.recordJoinChannelService({urls:[n],service:"gateway"},i);try{W=new WebSocket(n),h.push(W),W.binaryType="arraybuffer"}catch(U){const V=new Le(X.WS_ERR,"init websocket failed! Error: ".concat(U.toString()));return D.error("[".concat(this.name,"]").concat(V)),void c(V)}W.onopen=()=>{o(W)},W.onclose=U=>{c(U)},W.onmessage=U=>{D.debug("[choose-best-ws]".concat(W.url," onmessage: ").concat(U.data))},es(this.forceCloseTimeout).then(()=>{W&&W.readyState!==WebSocket.OPEN&&W.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class pfe extends Ar{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===lr.CONNECTED?this.emit(Bt.WS_CONNECTED):n===lr.RECONNECTING?this.emit(Bt.WS_RECONNECTING,this._websocketReconnectReason):n===lr.CLOSED&&this.emit(Bt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(n,i){super(),$(this,"_disconnectedReason",void 0),$(this,"_websocketReconnectReason",void 0),$(this,"_connectionState",lr.CLOSED),$(this,"reconnectToken",void 0),$(this,"websocket",void 0),$(this,"openConnectionTime",void 0),$(this,"clientId",void 0),$(this,"lastMsgTime",Date.now()),$(this,"uploadCache",[]),$(this,"uploadCacheInterval",void 0),$(this,"rttRolling",new TW(5)),$(this,"pingpongTimer",void 0),$(this,"wsInflateDataTimer",void 0),$(this,"pingpongTimeoutCount",0),$(this,"joinResponse",void 0),$(this,"multiIpOption",void 0),$(this,"initError",void 0),$(this,"spec",void 0),$(this,"store",void 0),$(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Bt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===gn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===gn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(jn.UID_BANNED);break;case 15:this.close(jn.IP_BANNED);break;case 16:this.close(jn.CHANNEL_BANNED)}if(c._type===gn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Dt.ERR_LICENSE_MISSING:this.close(jn.LICENSE_MISSING);break;case Dt.ERR_LICENSE_EXPIRED:this.close(jn.LICENSE_EXPIRED);break;case Dt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(jn.LICENSE_MINUTES_EXCEEDED);break;case Dt.ERR_LICENSE_PERIOD_INVALID:this.close(jn.LICENSE_PERIOD_INVALID);break;case Dt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(jn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Dt.ERR_LICENSE_ILLEGAL:this.close(jn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=n.clientId,this.spec=n,this.store=i,this.websocket=new ox("gateway-".concat(this.clientId),this.spec.retryConfig,!0,re("JOIN_GATEWAY_USE_DUAL_DOMAIN"),re("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===lr.CONNECTED&&this.reconnect("retry",_s.OFFLINE)})}async request(n,i,o,c){const u=or(6,""),h={_id:u,_type:n,_message:i},m=this.websocket.connectionID,_=()=>new lt((W,U)=>{if(this.connectionState===lr.CONNECTED)return W();const V=()=>{this.off(Bt.WS_CLOSED,q),W()},q=()=>{this.off(Bt.WS_CONNECTED,V),U(new Oe(X.WS_ABORT))};this.once(Bt.WS_CONNECTED,V),this.once(Bt.WS_CLOSED,q),n!==jt.PUBLISH&&n!==jt.PUBLISH_DATASTREAM&&n!==jt.SUBSCRIBE&&n!==jt.SUBSCRIBE_DATASTREAM&&n!==jt.UNSUBSCRIBE&&n!==jt.UNSUBSCRIBE_DATASTREAM&&n!==jt.UNPUBLISH&&n!==jt.UNPUBLISH_DATASTREAM&&n!==jt.CONTROL&&n!==jt.RESTART_ICE||this.once(Bt.DISCONNECT_P2P,()=>{U(new Oe(X.DISCONNECT_P2P))}),n!==jt.PUBLISH&&n!==jt.RESTART_ICE||this.once(Bt.ABORT_P2P_EXECUTION,()=>{U(new Oe(X.DISCONNECT_P2P))})});if(this.connectionState!==lr.CONNECTING&&this.connectionState!==lr.RECONNECTING||n===jt.JOIN||n===jt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const y=new lt((W,U)=>{let V=!1;const q=(ce,_e)=>{V=!0,W({isSuccess:ce==="success",message:_e||{}}),this.off(Bt.WS_CLOSED,Y),this.off(Bt.WS_RECONNECTING,Y),this.emit(Bt.REQUEST_SUCCESS,n,i)};this.once("res-@".concat(u),q);const Y=()=>{U(new Oe(X.WS_ABORT,"type: ".concat(n))),this.off(Bt.WS_CLOSED,Y),this.off(Bt.WS_RECONNECTING,Y),this.off("res-@".concat(u),q)};this.once(Bt.WS_CLOSED,Y),this.once(Bt.WS_RECONNECTING,Y),es(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||V||(D.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(n)),this.emit(Bt.REQUEST_TIMEOUT,n,i))})});let S=null;try{S=await y}catch(W){if(this.connectionState===lr.CLOSED||n===jt.LEAVE)throw new Oe(X.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?W.throw():n===jt.JOIN||n===jt.REJOIN?null:(await _(),await this.request(n,i))}if(S.isSuccess)return S.message;const w=Number(S.message.error_code||S.message.code),A=ub(w),k=new Oe(X.UNEXPECTED_RESPONSE,"".concat(A.desc,": ").concat(S.message.error_str),{code:w,data:S.message,desc:A.desc});return A.action==="success"?S.message:(D.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(w,", message: ").concat(A.desc,", action: ").concat(A.action)),w===Dt.ERR_TOO_MANY_BROADCASTERS?((n===jt.JOIN||n===jt.REJOIN)&&(this.initError=k,this.close()),k.throw()):A.action==="failed"?k.throw():A.action==="quit"?(this.initError=k,this.close(),k.throw()):(w===Dt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,D.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",_s.MULTI_IP)):this.reconnect(A.action,_s.SERVER_ERROR),n===jt.JOIN||n===jt.REJOIN?null:await this.request(n,i)))}waitMessage(n,i){return new lt(o=>{const c=u=>{(!i||i(u))&&(this.off(n,c),o(u))};this.on(n,c)})}uploadWRTCStats(n){if(!this.store.sessionId)return void D.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:n};this.upload(cb.WRTC_STATS,i)}upload(n,i){const o={_type:n,_message:i};try{this.websocket.sendMessage(o)}catch{const u=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==lr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},re("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,i){const o={_type:n,_message:i};this.websocket.sendMessage(o)}init(n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new lt((i,o)=>{this.once(Bt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Bt.WS_CLOSED,c=>o(this.initError||new Oe(X.WS_ABORT,c))),this.connectionState=lr.CONNECTING,this.websocket.init(n).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=n||jn.LEAVE,this.connectionState=lr.CLOSED,D.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Bt.ABORT_P2P_EXECUTION);const n=await Es(this,Bt.REQUEST_JOIN_INFO),i=await this.request(jt.JOIN,n);if(!i)return this.emit(Bt.REPORT_JOIN_GATEWAY,HA.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Bt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=lr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Oe(X.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const n=tb(this,Bt.REQUEST_REJOIN_INFO);n.token=this.reconnectToken;const i=await this.request(jt.REJOIN,n);return!!i&&(this.connectionState=lr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(o=>{this.emit(gn.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(gn.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(gn.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(gn.MUTE_AUDIO,{uid:o.uid}):this.emit(gn.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(gn.MUTE_VIDEO,{uid:o.uid}):this.emit(gn.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(gn.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(gn.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(gn.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(gn.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(gn.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(n,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,i)}handleNotification(n){D.debug("[".concat(this.clientId,"] receive notification: "),n);const i=ub(n.code);if(n.code===28&&"detail"in n&&(D.info("[".concat(this.clientId,"] receive recover notification: "),n.detail),this.emit(Bt.RECOVER_NOTIFICATION,n.detail)),i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(jn.UID_BANNED),void this.close()):void this.reconnect(i.action,_s.SERVER_ERROR);D.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=re("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=n&&(D.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",_s.TIMEOUT):this.request(jt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-i;this.rttRolling.add(o),re("REPORT_STATS")&&this.send(jt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:n,wsDeflateLength:i}=this.websocket.getWsInflateData();n!==0&&i!==0&&this.upload(cb.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:n})}handleWebsocketEvents(){this.websocket.on(Kt.RECONNECT_CREATE_CONNECTION,n=>{this.emit(Bt.WS_RECONNECT_CREATE_CONNECTION,n)}),this.websocket.on(Kt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Kt.CLOSED,()=>{this.connectionState=lr.CLOSED}),this.websocket.on(Kt.FAILED,()=>{this._disconnectedReason=jn.NETWORK_ERROR,this.connectionState=lr.CLOSED}),this.websocket.on(Kt.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState===lr.CONNECTED?this.connectionState=lr.RECONNECTING:this.connectionState=lr.CONNECTING}),this.websocket.on(Kt.WILL_RECONNECT,(n,i,o)=>{const c=tb(this,Bt.IS_P2P_DISCONNECTED),u=c||n!=="retry";c&&n==="retry"&&(D.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),n="tryNext",i=HA.P2P_DISCONNECTED),u&&(D.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(n)),this.emit(Bt.REPORT_JOIN_GATEWAY,i||HA.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Bt.DISCONNECT_P2P)),o(n)}),this.websocket.on(Kt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(n=>{D.warning("[".concat(this.clientId,"] rejoin failed ").concat(n)),this.reconnect("tryNext",_s.SERVER_ERROR)}):this.join().catch(n=>{if(this.emit(Bt.REPORT_JOIN_GATEWAY,n,this.url||""),n instanceof Oe){if(n.code===X.UNEXPECTED_RESPONSE&&n.data.code===Dt.ERR_NO_AUTHORIZED)return this.initError=new Oe(X.TOKEN_EXPIRE,"dynamic key expired"),void this.close(jn.TOKEN_EXPIRE);D.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",_s.SERVER_ERROR):(this.initError=n,this.close())}})}),this.websocket.on(Kt.REQUEST_NEW_URLS,(n,i)=>{Es(this,Bt.REQUEST_RECOVER,this.multiIpOption).then(n).catch(i)}),this.websocket.on(Kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(gn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(oG.PRE_CONNECT_PC,()=>{this.emit(Bt.PRE_CONNECT_PC)})}}let ffe=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),ai=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function dG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function KA(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?dG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):dG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function bm(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(re("TURN_DOMAIN")):(D.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function ax(e,n){e.addresses||(e.addresses=[]);const i=function(m,_){if(re("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(w=>{let{ip:A,port:k}=w;return{address:"".concat(A,":").concat(k)}});const y=re("GATEWAY_DOMAINS");let S=y[1]&&ot(_).call(_,y[1])?1:0;return m.map(w=>{let{domain_prefix:A,port:k,ip:W}=w;if(A)return{address:"".concat(A,".").concat(y[S++%y.length],":").concat(k)};const U=/^[\.\:\d]+$/.test(W),V=U?"".concat(W.replace(/[^\d]/g,"-"),".").concat(y[S++%y.length],":").concat(k):"".concat(W,":").concat(k);return U||D.debug("Cannot recognized as ip address: ".concat(W,", use as host")),{ip:W,port:k,address:V}})}(e.addresses,n),o=Array.isArray(e.detail)&&e.detail[18];if(o&&typeof o=="string"){const m=o.split(";");for(let _=0;_<m.length;_++){var c;const y=Ys(c=m[_]).call(c);i[_]&&y&&(i[_].ip6=y)}}const u=e.detail&&e.detail.candidate;let h;if(u){const[m,_]=u.split(":");m&&_&&(h={port:Number(_),ip:m,address:"".concat(m,":").concat(_)})}return{gatewayAddrs:i,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function qa(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function hG(e){const n=e._encoderConfig;if(!n)return{};const i={resolution:n.width&&n.height?"".concat(qa(n.width),"x").concat(qa(n.height)):void 0,maxVideoBW:n.bitrateMax,minVideoBW:n.bitrateMin};return typeof n.frameRate=="number"?(i.maxFrameRate=n.frameRate,i.minFrameRate=n.frameRate):n.frameRate&&(i.maxFrameRate=n.frameRate.max||n.frameRate.ideal||n.frameRate.exact||n.frameRate.min,i.minFrameRate=n.frameRate.min||n.frameRate.ideal||n.frameRate.exact||n.frameRate.max),i}function pG(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function hb(e,n){let i,o,c;switch(n){case ai.CHOOSE_SERVER:o=4096,c="choose server";break;case ai.CLOUD_PROXY:o=1048576,c="proxy";break;case ai.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case ai.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new Oe(X.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(u=>{u.buffer&&u.buffer.flag===o&&(i={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>KA(KA({},h),{},{ticket:u.buffer.cert})),server_ts:e.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:KA(KA({},u.buffer.detail),e.detail),flag:u.buffer.flag,opid:e.opid,cert:u.buffer.cert})}),!i)throw new Oe(X.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function fG(e,n){return await lt.all(e.addresses.map(async i=>({address:re("USE_TURN_IP")?i.ip:bm(i.ip),tcpport:i.port,udpport:i.port,username:n&&re("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?n.toString():ys.username,password:n&&re("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await pL(n.toString()):ys.password})))}function cx(e,n){const i=n.getMediaStreamTrack(!0).getSettings(),o=n.videoHeight||i.height,c=n.videoWidth||i.width;return o&&c?Math.max(Math.min(o,c)/Math.min(qa(e.height),qa(e.width)),1):(D.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function wm(e){let{candidateType:n,relayProtocol:i,type:o,address:c,port:u,protocol:h}=e;const m={candidateType:n,relayProtocol:i,protocol:h};if(o!=="local-candidate"){const _=c.split(".");_.length>=4&&(_[1]="*",_[2]="*"),m.address=_.join("."),m.port=u}return m}function qA(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:re("SVC_MODE");if(re("ENABLE_SVC"))return function(n){return n in bA}(e)?e:bA.L1T3}const mG={[mt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[mt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function YA(e,n,i){n.forEach(o=>{var c;const u=mG[e].find(m=>{var _;let{key:y}=m;return ot(_=o.extensionName).call(_,y)});if(!u)return;const h=i.find(m=>{let{extensionName:_}=m;return ot(_).call(_,u.key)});h&&ot(c=h.extensionName).call(c,"gdpr_forbidden")&&(o.extensionName=h.extensionName)})}function Mv(e,n){n.forEach(i=>{var o;const c=mG[e].find(u=>{var h;let{key:m}=u;return ot(h=i.extensionName).call(h,m)});ot(o=i.extensionName).call(o,"gdpr_forbidden")&&c&&(i.extensionName=c.extensionName)})}function gG(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||ot(e).call(e,"abs-send-time")}function XA(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||ot(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function _G(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function EG(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?_G(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_G(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function pb(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:_}=n,{useXR:y}=i;let S=[],w=[],A=[],k=[],W=!1,U=!1;if(ya(e).mediaDescriptions.forEach(q=>{o&&o!==q.attributes.direction||(q.media.mediaType!=="video"||W||(w=q.attributes.payloads,k=q.attributes.extmaps,W=!0),q.media.mediaType!=="audio"||U||(S=q.attributes.payloads,A=q.attributes.extmaps,U=!0))}),!k||w.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!A||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(w.forEach(q=>{var Y;(Y=q.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),y&&q.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(q=>{var Y;(Y=q.rtpMap)!==null&&Y!==void 0&&Y.clockRate&&(q.rtpMap.clockRate=parseInt(q.rtpMap.clockRate)),y&&q.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter(q=>{var Y;return((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"}),w=w.filter(q=>{var Y;return((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())!=="rtx"})),u&&(w=w.filter(q=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),h&&(S=S.filter(q=>{var Y;return!/(red)|(ulpfec)|(flexfec)/i.test(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(S=S.filter(q=>{var Y;return ot(m).call(m,((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLowerCase())||"")})),_&&(_==null?void 0:_.length)>0){const q=w.filter(Y=>{var ce;return ot(_).call(_,((ce=Y.rtpMap)===null||ce===void 0?void 0:ce.encodingName.toLowerCase())||"")});w=q.concat(c?[]:dx(q,w))}const V=re("UNSUPPORTED_VIDEO_CODEC");return V&&V.length>0&&(w=w.filter(q=>!(q.rtpMap&&ot(V).call(V,q.rtpMap.encodingName.toLowerCase())))),{audioCodecs:S,videoCodecs:w,audioExtensions:A,videoExtensions:k}}function Rm(e){const n=ya(e);let i,o;for(const c of n.mediaDescriptions){if(!i){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:u,icePwd:h}}if(!o){const u=c.attributes.fingerprints;u.length>0&&(o={fingerprints:u})}}if(!o&&n.attributes.fingerprints.length>0&&(o={fingerprints:n.attributes.fingerprints}),!o||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:o}}function yG(e,n){const i=[],o=e.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=e.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const _=(m=o.find(y=>y.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];i.push({ssrcId:h,rtx:n?_:void 0})});else if(o.length>0){const h=o[0].ssrcIds[0],m=o[0].ssrcIds[1];i.push({ssrcId:h,rtx:n?m:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:u[0].ssrcId})}return i}function vG(e,n,i){const{cname:o}=e;let c=[];n&&(c=SG(n)),c.length===0&&(c=e.iceParameters.candidates.map(S=>({foundation:S.foundation,componentId:"1",transport:S.protocol,priority:S.priority.toString(),connectionAddress:S.ip,port:S.port.toString(),type:S.type,extension:{}})),D.debug("Using candidates from gateway."));const u={fingerprints:e.dtlsParameters.fingerprints.map(S=>({hashFunction:S.algorithm,fingerprint:S.fingerprint}))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let m;switch(e.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const _=QA(e.rtpCapabilities),y=[];return Array.isArray(i)&&i.length>0&&i.forEach(S=>{y.push({kind:mt.VIDEO,ssrcId:S.v,rtx:S.v_rtx,mslabel:"".concat(S.v,"_").concat(S.a)},{kind:mt.AUDIO,ssrcId:S.a,mslabel:"".concat(S.v,"_").concat(S.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:_,setup:m,cname:o,preSSRCs:y}}function SG(e){let n=[];return e.ip&&typeof e.port=="number"&&(n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],D.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(n.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),D.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),n}function O_(e,n,i){const o=[],c=[];return e.forEach(u=>{let{ssrcId:h,rtx:m}=u;const _=or(8,"track-"),y={ssrcId:h,attributes:EG({label:_,mslabel:i=i||or(10,""),msid:"".concat(i," ").concat(_)},n&&{cname:n})};if(o.push(y),m!==void 0){const S={ssrcId:m,attributes:EG({label:_,mslabel:i,msid:"".concat(i," ").concat(_)},n&&{cname:n})};o.push(S),c.push({semantic:"FID",ssrcIds:[h,m]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:o,ssrcGroups:c}}function Uv(e,n){n instanceof Br&&e.attributes.payloads.forEach(i=>{var o;const c=(o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const u=n._encoderConfig;u&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!Nr()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"))})}function lx(e){const n=e.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");n!==-1&&e.attributes.unrecognized.splice(n,1)}function ux(e,n){var i;if(!(n instanceof mr&&n._encoderConfig&&n._hints.indexOf(ar.SCREEN_TRACK)===-1))return;const o=n._encoderConfig;kn().supportMinBitrate&&o.bitrateMin&&e.attributes.payloads.forEach(c=>{var u,h;ot(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),kn().supportMinBitrate&&!ot(i=n._hints).call(i,ar.LOW_STREAM)&&o.bitrateMax&&e.attributes.payloads.forEach(c=>{var u,h;ot(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(re("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function TG(e){if(e.media.mediaType!=="video")return;const n=Rn();if(n.name!==Mn.SAFARI&&n.os!==Ni.IOS)return;const i=e.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));i!==-1&&e.attributes.extmaps.splice(i,1)}function JA(e,n,i){if(!n)return;let o,c;if(e.media.mediaType==="video"?(o=i.videoExtensions,c=i.videoCodecs):(o=i.audioExtensions,c=i.audioCodecs),n.twcc===!0){const u=o.find(h=>XA(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>XA(_.extensionName))||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,y){return y.filter(S=>!!_.find(w=>w.payloadType===S.payloadType&&!!w.rtcpFeedbacks.find(A=>A.type==="transport-cc")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(y=>y.type==="transport-cc")||_.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(n.twcc===!1){const u=e.attributes.extmaps.findIndex(h=>XA(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(n.remb===!0){const u=o.find(h=>gG(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(_=>_.extensionName===h)||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(_,y){return y.filter(S=>!!_.find(w=>w.payloadType===S.payloadType&&!!w.rtcpFeedbacks.find(A=>A.type==="goog-remb")))}(c,e.attributes.payloads).forEach(_=>{_.rtcpFeedbacks.find(y=>y.type==="goog-remb")||_.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(n.remb===!1){const u=e.attributes.extmaps.findIndex(h=>gG(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(_=>_.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function bG(e,n,i){if(Nr()||e.media.mediaType!=="video"||!(n instanceof mr)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!re("SIMULCAST")||i==="vp9"&&re("ENABLE_SVC")||n._scalabilityMode===void 0||n._scalabilityMode.numSpatialLayers<=1)return;const o=i==="vp8"?2:n._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],u=e.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<o;m++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:xr(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),u&&(e.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+m,attributes:xr(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,u.ssrcIds[1]+m]}));e.attributes.ssrcGroups.unshift(h)}async function wG(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const o=(await i.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=arguments.length>2?arguments[2]:void 0;const S=pb(y,m,_,"sendonly"),w=pb(y,m,_,"recvonly"),A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},W={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(au(S,w,"videoExtensions",A,k,W),au(S,w,"videoCodecs",A,k,W),au(S,w,"audioExtensions",A,k,W),au(S,w,"audioCodecs",A,k,W),re("RAISE_H264_BASELINE_PRIORITY")){const U=[],V=[];W.videoCodecs.forEach((q,Y)=>{var ce;if(((ce=q.rtpMap)===null||ce===void 0?void 0:ce.encodingName.toLocaleLowerCase())==="h264"){var _e,Ee;const me=W.videoCodecs[Y+1],ke=me&&PG(q,me),Ye=(_e=q.fmtp)===null||_e===void 0?void 0:_e.parameters["profile-level-id"],ut=(Ee=q.fmtp)===null||Ee===void 0?void 0:Ee.parameters["packetization-mode"];!Ye||Ye!==re("FIRST_H264_PROFILE_LEVEL_ID")||re("FIRST_PACKETIZATION_MODE")&&ut!==re("FIRST_PACKETIZATION_MODE")?ke?V.push([q,me]):V.push([q]):ke?U.push([q,me]):U.push([q])}}),U.length>0&&V.length>0&&(D.debug("raising H264 baseline profile priority"),W.videoCodecs.forEach((q,Y)=>{var ce;if(((ce=q.rtpMap)===null||ce===void 0?void 0:ce.encodingName.toLocaleLowerCase())==="h264"){const _e=PG(q,W.videoCodecs[Y+1]),Ee=U.shift()||V.shift()||[];Ee.length>0&&(_e?W.videoCodecs.splice(Y,2,...Ee):W.videoCodecs.splice(Y,1,...Ee))}}),k.videoCodecs=k.videoCodecs.filter(q=>{var Y,ce;return!(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((ce=q.fmtp)===null||ce===void 0?void 0:ce.parameters["profile-level-id"])!==re("FIRST_H264_PROFILE_LEVEL_ID"))}),re("FILTER_SEND_H264_BASELINE")&&(A.videoCodecs=A.videoCodecs.filter(q=>{var Y,ce;return!(((Y=q.rtpMap)===null||Y===void 0?void 0:Y.encodingName.toLocaleLowerCase())==="h264"&&((ce=q.fmtp)===null||ce===void 0?void 0:ce.parameters["profile-level-id"])!==re("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:A,recv:k,sendrecv:W}}(e,n,o);try{i.close()}catch{}return{send:c,recv:u,sendrecv:h}}function RG(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},n=pb(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(au(e,n,"videoExtensions",i,o,c),au(e,n,"videoCodecs",i,o,c),au(e,n,"audioExtensions",i,o,c),au(e,n,"audioCodecs",i,o,c),re("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){D.debug("raising H264 baseline profile priority");const m=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(o.videoCodecs=o.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:o,sendrecv:c}}function au(e,n,i,o,c,u){if(i==="videoExtensions"||i==="audioExtensions"){const h=[];return e[i].forEach(m=>{n[i].some((_,y)=>{if(m.entry===_.entry&&m.extensionName===_.extensionName)return h.push(y),!0})?u[i].push(m):o[i].push(m)}),void n[i].forEach((m,_)=>{h.indexOf(_)===-1&&c[i].push(m)})}if(i==="videoCodecs"||i==="audioCodecs"){const h=[];return e[i].forEach(m=>{n[i].some((_,y)=>{if(m.payloadType===_.payloadType&&JSON.stringify(m)===JSON.stringify(_))return h.push(y),!0})?u[i].push(m):o[i].push(m)}),void n[i].forEach((m,_)=>{h.indexOf(_)===-1&&c[i].push(m)})}}function QA(e){const{send:n,recv:i,sendrecv:o}=e;if(!o){if(!n||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:n,recv:i}}let c,u;return n?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...n.audioCodecs,...o.audioCodecs],c.videoCodecs=[...n.videoCodecs,...o.videoCodecs],c.audioExtensions=[...n.audioExtensions,...o.audioExtensions],c.videoExtensions=[...n.videoExtensions,...o.videoExtensions]):c=o,i?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...i.audioCodecs,...o.audioCodecs],u.videoCodecs=[...i.videoCodecs,...o.videoCodecs],u.audioExtensions=[...i.audioExtensions,...o.audioExtensions],u.videoExtensions=[...i.videoExtensions,...o.videoExtensions]):u=o,{send:c,recv:u}}function Vv(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(n=>{var i;return((i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(n=>{n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"})}function fb(e,n,i,o){let c=[];if(e===mt.VIDEO){if(re("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(c=n.videoCodecs.filter(u=>{var h;return ot(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===re("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],m=[],_=[];if(i.videoCodecs.forEach(y=>{const S=y.rtpMap&&y.rtpMap.encodingName.toLowerCase()||"";ot(S).call(S,o)?u.push(y):ot(S).call(S,"vp9")?h.push(y):ot(S).call(S,"vp8")?m.push(y):ot(S).call(S,"h264")&&_.push(y)}),u.length===0){let y="";h.length!==0?(u=h,y="vp9"):m.length!==0?(u=m,y="vp8"):_.length!==0&&(u=_,y="h264"),D.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(y))}u.length!==0&&(c=n.videoCodecs.filter(y=>u.some(S=>S.payloadType===y.payloadType)))}if(c.length===0&&(D.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(n.videoCodecs[0].rtpMap&&n.videoCodecs[0].rtpMap.encodingName)),c=n.videoCodecs),re("USE_PUB_RTX")||re("USE_SUB_RTX")){const u=dx(c,n.videoCodecs);c=[...c,...u]}}else c=n.audioCodecs.filter(u=>{var h;return ot(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)}),c.length===0&&(D.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),c=n.audioCodecs.filter(u=>{var h;return ot(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function dx(e,n){const i=e.map(o=>o.payloadType.toString());return n.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&ot(i).call(i,o.fmtp&&o.fmtp.parameters.apt))}async function mb(e,n,i){const o=n.toString(),c=IG(o,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:o});const u=await e.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=CG(h,i||{}),c==null||c(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function CG(e,n,i){const o=ya(e),{useXR:c}=n;return o.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(i)&&!ot(i).call(i,u.attributes.mid)||(u.media.mediaType==="audio"&&Vv(u),c&&ot(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(_=>_.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),vm(o)}function IG(e,n,i,o){if(re("SDP_LOGGING"))return D.upload("exchanging ".concat(i," ").concat(n," SDP during P2PConnection.").concat(o,`
`),e),n==="offer"?c=>{IG(c,"answer",i==="local"?"remote":"local",o)}:void 0}function AG(e){const n=re("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(n)&&n.length>0)&&n.some(i=>ot(e).call(e,i))}function PG(e,n){try{var i;return((i=e.fmtp)===null||i===void 0?void 0:i.parameters.apt)===n.payloadType.toString()}catch{return!1}}function OG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function _l(e,n){return typeof re(e)===n?re(e):void 0}function mfe(){try{const e=re("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(n){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?OG(Object(o),!0).forEach(function(c){$(n,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):OG(Object(o)).forEach(function(c){Object.defineProperty(n,c,Object.getOwnPropertyDescriptor(o,c))})}return n}({},e)}catch(e){return D.debug("handle gateway attributes failed: ",e),{}}}const kG={};function Cm(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&D.debug("install service ".concat(e.name)),kG[e.name]=e}function Gp(e){const n=kG[e];if(!n)throw new Le(X.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return n}function NG(e,n){return Gp("DataStream").create(e,n)}function ZA(){return Gp("InterceptFrame").create()}function DG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Hp(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?DG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):DG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const hx=new Map;class gfe extends Ar{get state(){return this._state}set state(n){if(n===this._state)return;const i=this._state;this._state=n,n==="DISCONNECTED"&&this._disconnectedReason?this.emit($i.CONNECTION_STATE_CHANGE,n,i,this._disconnectedReason):this.emit($i.CONNECTION_STATE_CHANGE,n,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(n){D.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(n)),this._joinGatewayStartTime=n}constructor(n,i){var o,c,u;super(),$(this,"store",void 0),$(this,"joinInfo",void 0),$(this,"key",void 0),$(this,"ntpOffset",0),$(this,"signal",void 0),$(this,"role",void 0),$(this,"inChannelInfo",{joinAt:null,duration:0}),$(this,"spec",void 0),$(this,"_state","DISCONNECTED"),$(this,"_statsCollector",void 0),$(this,"_disconnectedReason",void 0),$(this,"isSignalRecover",!1),$(this,"hasChangeBGPAddress",!1),$(this,"trafficStatsInterval",void 0),$(this,"networkQualityInterval",void 0),$(this,"_joinGatewayStartTime",0),$(this,"_signalTimeout",!1),$(this,"_clientRoleOptions",void 0),$(this,"_isProactiveJoin",!1),this.store=n,this.spec=i,this.signal=this.store.useP2P?(o={spec:Hp(Hp({},i),{},{retryConfig:i.websocketRetryConfig}),store:n},(c=(u=Gp("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,o)):new pfe(Hp(Hp({},i),{},{retryConfig:i.websocketRetryConfig}),n),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}async join(n,i,o){this.store.joinGatewayStart(),n.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=hx.get(n.cname);if(u||(u=new Map,hx.set(n.cname,u)),this._isProactiveJoin=!0,u.has(n.uid)){const y=new Oe(X.UID_CONFLICT);throw wt.joinGateway(n.sid,{lts:c,succ:!1,ec:y.code,addr:null,uid:n.uid,cid:n.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!n.proxyServer,signalChannel:"0",preload:n.preload}),y}u.set(n.uid,!0),this.joinInfo=n,this.key=i;let h=0;this.joinGatewayStartTime=c;const m=n.proxyServer;try{D.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const y=n.gatewayAddrs.map(S=>{let{address:w}=S;const[A,k]=w.split(":"),W={host:A,port:k};return n.proxyServer&&(W.proxy=n.proxyServer),W});h=(await this.signal.init(y)).uid,D.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(y){var _;throw D.error("[".concat(this.store.clientId,"] User join failed"),y.toString()),wt.joinGateway(n.sid,{lts:c,succ:!1,ec:((_=y.data)===null||_===void 0?void 0:_.desc)||y.code,errorMsg:y.message,addr:this.signal.url,uid:n.uid,cid:n.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:n.preload}),u.delete(n.uid),this.signal.close(),y}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),D.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(y=>{D.warning("[".concat(this.store.clientId,"] get traffic stats error"),y.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit($i.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit($i.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit($i.NETWORK_QUALITY,{uplinkNetworkQuality:pG(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:pG(this._statsCollector.trafficStats.B_dnq)}):this.emit($i.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let n=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==jn.FALLBACK&&(this.state="DISCONNECTING");try{n||this.signal.connectionState!==lr.CONNECTED||await function(o,c){return c===1/0?o:lt.race([o,Bhe(c)])}(this.signal.request(jt.LEAVE,void 0,!0),3e3)}catch(o){D.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(i),i!==jn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(n,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:re("PUB_EXTEND"),twcc:!!re("PUBLISH_TWCC"),rtx:!!re("USE_PUB_RTX")};try{return(await this.signal.request(jt.PUBLISH,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Dt.ERR_PUBLISH_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(n,i),this.publish(n,i,!1);throw u}}async publishDataChannel(n,i,o){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(c=i.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(jt.PUBLISH_DATASTREAM,u,!0)}catch(h){if(o&&h.data&&h.data.code===Dt.ERR_PUBLISH_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(n,i),this.publishDataChannel(n,i,!1);throw h}}async unpublish(n,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(jt.UNPUBLISH,{stream_id:i,ortc:n},!0)}catch(o){D.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await lt.all(n.map(i=>this.signal.request(jt.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){D.warning("unpublish datachannels warning: ",i)}}async presubscribe(n,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:n,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!re("SUBSCRIBE_TWCC"),rtx:!!re("USE_SUB_RTX")||void 0,extend:re("SUB_EXTEND"),svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return await this.signal.request(jt.PRE_SUBSCRIBE,c,!0)}catch(u){if(o&&u.data&&u.data.code===Dt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(n,i,!1);throw u}}async subscribe(n,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:n,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!re("SUBSCRIBE_TWCC"),rtx:!!re("USE_SUB_RTX"),extend:re("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return(await this.signal.request(jt.SUBSCRIBE,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Dt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(n,i),await this.subscribe(n,i,!1);throw u}}async subscribeDataChannel(n,i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:n,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(jt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(o&&u.data&&u.data.code===Dt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(n,i),await this.subscribeDataChannel(n,i,!1);throw u}}async subscribeAll(n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:n,dtx:!1,rtx:!!re("USE_SUB_RTX"),twcc:!!re("SUBSCRIBE_TWCC"),svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return await this.signal.request(jt.SUBSCRIBE_STREAMS,o,!0)}catch(c){if(i&&c.data&&c.data.code===Dt.ERR_SUBSCRIBE_REQUEST_INVALID)return D.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(n),await this.subscribeAll(n,!1);throw c}}async setVideoProfile(n){const i=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let c=o.frameRate,u=o.width,h=o.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(n);if(i)return this.signal.request(jt.SET_VIDEO_PROFILE,i);D.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(n,i){try{await this.signal.request(jt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:n,stream_id:i},!0)}catch(o){D.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(n,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await lt.all(n.map(o=>this.signal.request(jt.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:i},!0)))}catch(o){D.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(n){try{await this.signal.request(jt.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){D.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(n){const{iceParameters:i,dtlsParameters:o,rtpCapabilities:c}=n;return{gatewayEstablishParams:await this.signal.request(jt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:o,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(jt.GATEWAY_INFO)}async renewToken(n){await this.signal.request(jt.RENEW_TOKEN,n),this.key=n.token}updateClientRole(n,i){i&&(this._clientRoleOptions=Object.assign({},i)),re("CLIENT_ROLE_OPTIONS")&&(D.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(re("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},re("CLIENT_ROLE_OPTIONS"))),this.role=n}async setClientRole(n,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),re("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},re("CLIENT_ROLE_OPTIONS")),D.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(re("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=n);let o,c=0;n==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(jt.SET_CLIENT_ROLE,{role:n,level:c,delay:o,client_ts:Date.now()}),this.role=n}async setRemoteVideoStreamType(n,i){await this.signal.request(jt.SWITCH_VIDEO_STREAM,{stream_id:n,stream_type:i})}async setDefaultRemoteVideoStreamType(n){await this.signal.request(jt.DEFAULT_VIDEO_STREAM,{stream_type:n})}async setStreamFallbackOption(n,i){await this.signal.request(jt.SET_FALLBACK_OPTION,{stream_id:n,fallback_type:i})}async pickSVCLayer(n,i){await this.signal.request(jt.PICK_SVC_LAYER,{stream_id:n,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(n){await this.signal.request(jt.SET_RTM2_FLAG,{rtm2_flag:n})}async sendExtensionMessage(n,i,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(n,i,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Hp({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(jt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const n=hx.get(this.joinInfo.cname);n&&n.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const n=function(i){let o;return o=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:ys.username,password:ys.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],n&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Hp(Hp({},ys),{},{turnServerURL:n.turnServerURL,tcpport:n.tcpport,udpport:n.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const n=await this.signal.request(jt.TRAFFIC_STATS,void 0,!0);n.timestamp=Date.now(),n.ntp_offset!=null&&(this.ntpOffset=n.ntp_offset),n.peer_delay.forEach(i=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===i.peer_uid);o&&o.B_st!==i.B_st&&yA(()=>{this.emit($i.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(n)}getJoinMessage(n){if(!this.joinInfo||!this.key)throw new Oe(X.UNEXPECTED_ERROR,"can not generate join message, no join info");const i=Object.assign({},this.joinInfo.apResponse);let o=re("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}var c;o&&o.length>128&&(o=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit($i.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,ot(kv).call(kv,c)||kv.push(c);const u=!(Nr()||J6(87)||jW())&&typeof re("ENABLE_PRE_SUB")=="boolean"&&re("ENABLE_PRE_SUB"),h=!jW()&&_l("ENABLE_PREALLOC_PC","boolean"),m=mfe(),_=XT(87)||function(){const S=Rn();if(S.name!==Mn.SAFARI||!S.browserVersion)return!1;const w=S.browserVersion.split(".");return Number(w[0])>15||Number(w[0])===15&&Number(w[1])>=4}(),y=Hp({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:pl,browser:navigator.userAgent,process_id:re("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:re("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:Hp({enableEncodedTransform:!!re("ENABLE_AUDIO_METADATA")&&_||!!re("ENABLE_AUDIO_TOPN")&&sL(Mn.CHROME,87,116)||void 0,enableAudioMetadata:!!re("ENABLE_AUDIO_METADATA")&&_,enableAudioPts:!!re("ENABLE_AUDIO_PTS_METADATA")&&_,topnSmoothLevel:re("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:re("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:re("TOPN_SWITCH_HOLD_MS"),topnAudioGain:re("TOPN_AUDIO_GAIN"),enablePublishedUserList:re("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:re("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:_l("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:_l("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:_l("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:re("USE_PUB_RTX")===!0||re("USE_SUB_RTX")===!0||void 0,disableFEC:re("DISABLE_FEC"),enableNTPReport:!!re("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!re("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!re("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:_l("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!re("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!re("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:_l("USE_XR","boolean"),enableLossbasedBwe:_l("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!re("ENABLE_AUT_CC")||void 0,enableCCFallback:_l("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:u?_l("PRE_SUB_NUM","number"):void 0,enablePubTWCC:_l("PUBLISH_TWCC","boolean"),enableSubTWCC:_l("SUBSCRIBE_TWCC","boolean"),enablePubRTX:_l("USE_PUB_RTX","boolean"),enableSubRTX:_l("USE_SUB_RTX","boolean"),enableSubSVC:re("ENABLE_SVC")?re("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0,enableSvcExtended:re("ENABLE_SVC")&&Array.isArray(re("SVC_EXTENDED"))&&re("SVC_EXTENDED").length!==0?re("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},n);return this.joinInfo.stringUid&&(y.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(y.aes_mode=this.joinInfo.aesmode,re("ENCRYPT_AES")?(y.aes_secret=this.joinInfo.aespassword,y.aes_encrypt=!0):y.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(y.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(y.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(y.default_video_stream=this.joinInfo.defaultVideoStream),y}getRejoinMessage(){if(!this.joinInfo)throw new Oe(X.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Bt.WS_RECONNECT_CREATE_CONNECTION,n=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Bt.WS_RECONNECTING,n=>{this.joinInfo&&wt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n||_s.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",wt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Bt.WS_CLOSED,n=>{let i;switch(n){case jn.LEAVE:i=_s.LEAVE;break;case jn.UID_BANNED:case jn.IP_BANNED:case jn.CHANNEL_BANNED:case jn.SERVER_ERROR:i=_s.SERVER_ERROR;break;case jn.FALLBACK:i=_s.FALLBACK;break;case jn.LICENSE_MISSING:case jn.LICENSE_EXPIRED:case jn.LICENSE_MINUTES_EXCEEDED:case jn.LICENSE_PERIOD_INVALID:case jn.LICENSE_MULTIPLE_SDK_SERVICE:case jn.LICENSE_ILLEGAL:case jn.TOKEN_EXPIRE:i=n;break;default:i=_s.NETWORK_ERROR}D.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+_s.NETWORK_ERROR)),this.joinInfo&&wt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:n===jn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=n,n!==jn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Bt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const n=re("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;n&&(n.level||n.delay)&&(D.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(n.level,", delay: ").concat(n.delay)),this.setClientRole(this.role,n))}if(wt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const n=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!n)return void D.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(n));Xn("EVENT_REPORT_DOMAIN",n[1]),Xn("EVENT_REPORT_BACKUP_DOMAIN",n[1]),Xn("LOG_UPLOAD_SERVER","".concat(n[1],":6444"))}}}),this.signal.on(gn.ON_UPLINK_STATS,n=>{this._statsCollector.updateUplinkStats(n)}),this.signal.on(Bt.REQUEST_RECOVER,(n,i,o)=>{if(!this.joinInfo)return o(new Oe(X.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));n&&(this.joinInfo.multiIP=n,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Es(this,$i.REQUEST_NEW_GATEWAY_LIST).then(i).catch(o)}),this.signal.on(Bt.REQUEST_JOIN_INFO,async(n,i,o)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void n(this.getJoinMessage({ortc:{}}));const u=xr((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(re("NEW_TURN_MODE")&&u){let y=u.servers,S=u.serversFromGateway;const w=this.signal.currentURLIndex;y.length>0&&(y=[y[w%y.length]],u.servers=y),Array.isArray(S)&&S.length>0&&(S=[S[0]],u.serversFromGateway=S),D.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(w))}const{iceParameters:h,dtlsParameters:m,rtpCapabilities:_}=await Es(this,$i.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u});try{n(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:m,rtpCapabilities:_,version:"2"}}))}catch(y){i(y)}}),this.signal.on(Bt.REQUEST_REJOIN_INFO,n=>{n(this.getRejoinMessage())}),this.signal.on(Bt.REPORT_JOIN_GATEWAY,(n,i)=>{if(!this.joinInfo)return;let o,c="";var u;n instanceof Oe?(o=((u=n.data)===null||u===void 0?void 0:u.desc)||n.code,c=n.message):o=n,wt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:c,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Bt.IS_P2P_DISCONNECTED,n=>{n(tb(this,$i.IS_P2P_DISCONNECTED))}),this.signal.on(Bt.DISCONNECT_P2P,()=>{this.emit($i.DISCONNECT_P2P)}),this.signal.on(Bt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Bt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Bt.JOIN_RESPONSE,n=>{const i=this.getCurrentGatewayAddress();this.emit($i.JOIN_RESPONSE,n,i)}),this.signal.on(Bt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const n=this.getCurrentGatewayAddress(),i=re("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(n&&i){const o=SG(n);this.emit($i.PRE_CONNECT_PC,{candidates:o,fingerprint:i})}}}),this.signal.on(Bt.RECOVER_NOTIFICATION,n=>{this.joinInfo&&typeof re("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(re("AP_REQUEST_DETAIL"),";").concat(n))})}async tryUnsubBeforeResub(n,i){try{await this.signal.request(jt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:n,ortc:[i]},!0)}catch(o){throw D.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(n,i){try{await this.signal.request(jt.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(o){throw D.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(n,i){try{await this.signal.request(jt.UNPUBLISH,{stream_id:n,ortc:i},!0)}catch(o){throw D.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(n,i){try{await this.signal.request(jt.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(o){throw D.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(n){const i={users:n.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(jt.UNSUBSCRIBE_STREAMS,i,!0)}catch(o){throw D.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(n,i){const o={action:n.find(c=>c.stream_type===zn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:n,stream_id:i};try{await this.signal.request(jt.CONTROL,o,!0,!0)}catch(c){throw D.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(n,i){const o={action:n.find(c=>c.stream_type===zn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:n,stream_id:i};try{await this.signal.request(jt.CONTROL,o,!0,!0)}catch(c){throw D.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(n,i){const o={action:n===mt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(jt.CONTROL,o,!0,!0)}catch(c){throw D.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(n,i){const o={action:n===mt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(jt.CONTROL,o,!0,!0)}catch(c){throw D.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(n){this.signal.uploadWRTCStats(n)}upload(n,i){this.signal.upload(n,i)}getSignalRTT(){return this.signal.rtt}async restartICE(n){const i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:n};try{return await this.signal.request(jt.RESTART_ICE,i,!0)}catch(o){throw D.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(n,i){this.state==="CONNECTED"&&this.signal.reconnect(n||void 0,i||_s.P2P_FAILED)}getCurrentGatewayAddress(){var n,i;if(!re("GATEWAY_WSS_ADDRESS"))return re("USE_CANDIDATE_FROM_AP_DETAIL")&&(n=this.joinInfo)!==null&&n!==void 0&&n.apGatewayAddress?(D.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(n){await this.signal.request(jt.SET_PARAMETER,{enablePublishAudioFilter:n})}}let eP=0,px=0;function pd(e,n,i,o){return new lt((c,u)=>{n.timeout=n.timeout||re("HTTP_CONNECT_TIMEOUT"),n.responseType=n.responseType||"json",n.data&&!i?(n.data=JSON.stringify(n.data),eP+=ah(n.data)):i&&(n.data.size?eP+=n.data.size:n.data instanceof FormData?eP+=mW(n.data):eP+=ah(JSON.stringify(n.data))),n.headers=n.headers||{},n.headers["Content-Type"]=n.headers["Content-Type"]||"application/json",n.method="POST",n.url=e,Wo.request(n).then(h=>{typeof h.data=="string"?px+=ah(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?px+=h.data.byteLength:px+=ah(JSON.stringify(h.data)),o&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{Wo.isCancel(h)?u(new Oe(X.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Oe(X.NETWORK_TIMEOUT,h.message)):h.response?u(new Oe(X.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Oe(X.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function n(je){var st=0;return function(){return st<je.length?{done:!1,value:je[st++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(je,st,vt){return je==Array.prototype||je==Object.prototype||(je[st]=vt.value),je},o,c=function(je){je=[typeof globalThis=="object"&&globalThis,je,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var st=0;st<je.length;++st){var vt=je[st];if(vt&&vt.Math==Math)return vt}throw Error("Cannot find global object")}(this);function u(je,st){if(st)e:{var vt=c;je=je.split(".");for(var We=0;We<je.length-1;We++){var x=je[We];if(!(x in vt))break e;vt=vt[x]}(st=st(We=vt[je=je[je.length-1]]))!=We&&st!=null&&i(vt,je,{configurable:!0,writable:!0,value:st})}}function h(je){return(je={next:je})[Symbol.iterator]=function(){return this},je}function m(je){var st=typeof Symbol<"u"&&Symbol.iterator&&je[Symbol.iterator];return st?st.call(je):{next:n(je)}}if(u("Symbol",function(je){function st(x,ie){this.A=x,i(this,"description",{configurable:!0,writable:!0,value:ie})}if(je)return je;st.prototype.toString=function(){return this.A};var vt="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",We=0;return function x(ie){if(this instanceof x)throw new TypeError("Symbol is not a constructor");return new st(vt+(ie||"")+"_"+We++,ie)}}),u("Symbol.iterator",function(je){if(je)return je;je=Symbol("Symbol.iterator");for(var st="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),vt=0;vt<st.length;vt++){var We=c[st[vt]];typeof We=="function"&&typeof We.prototype[je]!="function"&&i(We.prototype,je,{configurable:!0,writable:!0,value:function(){return h(n(this))}})}return je}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var _;e:{var y={};try{y.__proto__={a:!0},_=y.a;break e}catch{}_=!1}o=_?function(je,st){if(je.__proto__=st,je.__proto__!==st)throw new TypeError(je+" is not extensible");return je}:null}var S=o;function w(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function A(je){if(je.m)throw new TypeError("Generator is already running");je.m=!0}function k(je,st){return je.h=3,{value:st}}function W(je){this.g=new w,this.G=je}function U(je,st,vt,We){try{var x=st.call(je.g.j,vt);if(!(x instanceof Object))throw new TypeError("Iterator result "+x+" is not an object");if(!x.done)return je.g.m=!1,x;var ie=x.value}catch(ue){return je.g.j=null,je.g.s(ue),V(je)}return je.g.j=null,We.call(je.g,ie),V(je)}function V(je){for(;je.g.h;)try{var st=je.G(je.g);if(st)return je.g.m=!1,{value:st.value,done:!1}}catch(vt){je.g.v=void 0,je.g.s(vt)}if(je.g.m=!1,je.g.l){if(st=je.g.l,je.g.l=null,st.F)throw st.D;return{value:st.return,done:!0}}return{value:void 0,done:!0}}function q(je){this.next=function(st){return je.o(st)},this.throw=function(st){return je.s(st)},this.return=function(st){return function(vt,We){A(vt.g);var x=vt.g.j;return x?U(vt,"return"in x?x.return:function(ie){return{value:ie,done:!0}},We,vt.g.return):(vt.g.return(We),V(vt))}(je,st)},this[Symbol.iterator]=function(){return this}}function Y(je,st){return st=new q(new W(st)),S&&je.prototype&&S(st,je.prototype),st}if(w.prototype.o=function(je){this.v=je},w.prototype.s=function(je){this.l={D:je,F:!0},this.h=this.C||this.u},w.prototype.return=function(je){this.l={return:je},this.h=this.u},W.prototype.o=function(je){return A(this.g),this.g.j?U(this,this.g.j.next,je,this.g.o):(this.g.o(je),V(this))},W.prototype.s=function(je){return A(this.g),this.g.j?U(this,this.g.j.throw,je,this.g.o):(this.g.s(je),V(this))},u("Array.prototype.entries",function(je){return je||function(){return function(st,vt){st instanceof String&&(st+="");var We=0,x=!1,ie={next:function(){if(!x&&We<st.length){var ue=We++;return{value:vt(ue,st[ue]),done:!1}}return x=!0,{done:!0,value:void 0}}};return ie[Symbol.iterator]=function(){return ie},ie}(this,function(st,vt){return[st,vt]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var ce=function(je,st){for(var vt=0;vt<je.length;vt++)st(je[vt])},_e=function(je){return je.replace(/\r?\n|\r/g,`\r
`)},Ee=function(je,st,vt){return st instanceof Blob?(vt=vt!==void 0?vt+"":typeof st.name=="string"?st.name:"blob",st.name===vt&&Object.prototype.toString.call(st)!=="[object Blob]"||(st=new File([st],vt)),[String(je),st]):[String(je),String(st)]},me=function(je,st){if(je.length<st)throw new TypeError(st+" argument required, but only "+je.length+" present.")},ke=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ye=ke.FormData,ut=ke.XMLHttpRequest&&ke.XMLHttpRequest.prototype.send,pt=ke.Request&&ke.fetch,yn=ke.navigator&&ke.navigator.sendBeacon,vn=ke.Element&&ke.Element.prototype,cr=ke.Symbol&&Symbol.toStringTag;cr&&(Blob.prototype[cr]||(Blob.prototype[cr]="Blob"),"File"in ke&&!File.prototype[cr]&&(File.prototype[cr]="File"));try{new File([],"")}catch{ke.File=function(st,vt,We){return st=new Blob(st,We||{}),Object.defineProperties(st,{name:{value:vt},lastModified:{value:+(We&&We.lastModified!==void 0?new Date(We.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),cr&&Object.defineProperty(st,cr,{value:"File"}),st}}var Zr=function(je){return je.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Wr=function(je){this.i=[];var st=this;je&&ce(je.elements,function(vt){if(vt.name&&!vt.disabled&&vt.type!=="submit"&&vt.type!=="button"&&!vt.matches("form fieldset[disabled] *"))if(vt.type==="file"){var We=vt.files&&vt.files.length?vt.files:[new File([],"",{type:"application/octet-stream"})];ce(We,function(x){st.append(vt.name,x)})}else vt.type==="select-multiple"||vt.type==="select-one"?ce(vt.options,function(x){!x.disabled&&x.selected&&st.append(vt.name,x.value)}):vt.type==="checkbox"||vt.type==="radio"?vt.checked&&st.append(vt.name,vt.value):(We=vt.type==="textarea"?_e(vt.value):vt.value,st.append(vt.name,We))})};if((e=Wr.prototype).append=function(je,st,vt){me(arguments,2),this.i.push(Ee(je,st,vt))},e.delete=function(je){me(arguments,1);var st=[];je=String(je),ce(this.i,function(vt){vt[0]!==je&&st.push(vt)}),this.i=st},e.entries=function je(){var st,vt=this;return Y(je,function(We){if(We.h==1&&(st=0),We.h!=3)return st<vt.i.length?We=k(We,vt.i[st]):(We.h=0,We=void 0),We;st++,We.h=2})},e.forEach=function(je,st){me(arguments,1);for(var vt=m(this),We=vt.next();!We.done;We=vt.next()){var x=m(We.value);We=x.next().value,x=x.next().value,je.call(st,x,We,this)}},e.get=function(je){me(arguments,1);var st=this.i;je=String(je);for(var vt=0;vt<st.length;vt++)if(st[vt][0]===je)return st[vt][1];return null},e.getAll=function(je){me(arguments,1);var st=[];return je=String(je),ce(this.i,function(vt){vt[0]===je&&st.push(vt[1])}),st},e.has=function(je){me(arguments,1),je=String(je);for(var st=0;st<this.i.length;st++)if(this.i[st][0]===je)return!0;return!1},e.keys=function je(){var st,vt,We,x,ie=this;return Y(je,function(ue){if(ue.h==1&&(st=m(ie),vt=st.next()),ue.h!=3)return vt.done?void(ue.h=0):(We=vt.value,x=m(We),k(ue,x.next().value));vt=st.next(),ue.h=2})},e.set=function(je,st,vt){me(arguments,2),je=String(je);var We=[],x=Ee(je,st,vt),ie=!0;ce(this.i,function(ue){ue[0]===je?ie&&(ie=!We.push(x)):We.push(ue)}),ie&&We.push(x),this.i=We},e.values=function je(){var st,vt,We,x,ie=this;return Y(je,function(ue){if(ue.h==1&&(st=m(ie),vt=st.next()),ue.h!=3)return vt.done?void(ue.h=0):(We=vt.value,(x=m(We)).next(),k(ue,x.next().value));vt=st.next(),ue.h=2})},Wr.prototype._asNative=function(){for(var je=new Ye,st=m(this),vt=st.next();!vt.done;vt=st.next()){var We=m(vt.value);vt=We.next().value,We=We.next().value,je.append(vt,We)}return je},Wr.prototype._blob=function(){var je="----formdata-polyfill-"+Math.random(),st=[],vt="--"+je+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(We,x){return typeof We=="string"?st.push(vt+Zr(_e(x))+`"\r
\r
`+_e(We)+`\r
`):st.push(vt+Zr(_e(x))+'"; filename="'+Zr(We.name)+`"\r
Content-Type: `+(We.type||"application/octet-stream")+`\r
\r
`,We,`\r
`)}),st.push("--"+je+"--"),new Blob(st,{type:"multipart/form-data; boundary="+je})},Wr.prototype[Symbol.iterator]=function(){return this.entries()},Wr.prototype.toString=function(){return"[object FormData]"},vn&&!vn.matches&&(vn.matches=vn.matchesSelector||vn.mozMatchesSelector||vn.msMatchesSelector||vn.oMatchesSelector||vn.webkitMatchesSelector||function(je){for(var st=(je=(this.document||this.ownerDocument).querySelectorAll(je)).length;0<=--st&&je.item(st)!==this;);return-1<st}),cr&&(Wr.prototype[cr]="FormData"),ut){var qo=ke.XMLHttpRequest.prototype.setRequestHeader;ke.XMLHttpRequest.prototype.setRequestHeader=function(je,st){qo.call(this,je,st),je.toLowerCase()==="content-type"&&(this.B=!0)},ke.XMLHttpRequest.prototype.send=function(je){je instanceof Wr?(je=je._blob(),this.B||this.setRequestHeader("Content-Type",je.type),ut.call(this,je)):ut.call(this,je)}}pt&&(ke.fetch=function(je,st){return st&&st.body&&st.body instanceof Wr&&(st.body=st.body._blob()),pt.call(this,je,st)}),yn&&(ke.navigator.sendBeacon=function(je,st){return st instanceof Wr&&(st=st._asNative()),yn.call(this,je,st)}),ke.FormData=Wr}})();const gb=()=>{const e=re("AREAS");return e.length===0&&e.push(Un.GLOBAL),ja(e).call(e,(n,i,o)=>{const c=LG(i);return c?o===0?c:"".concat(n,",").concat(c):n},"")},LG=e=>e===Un.OVERSEA?"".concat(Is.ASIA,",").concat(Is.EUROPE,",").concat(Is.AFRICA,",").concat(Is.NORTH_AMERICA,",").concat(Is.SOUTH_AMERICA,",").concat(Is.OCEANIA):Is[e],_fe=e=>{const n={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(i=>{const o=$A[i],c=Object.keys(o);c&&c.map(u=>{u!=="CODE"&&(n[u]=n[u].concat(o[u]))})}),n},tP={GLOBAL:{ASIA:[Un.CHINA,Un.JAPAN,Un.INDIA,Un.KOREA,Un.HKMC],EUROPE:[],NORTH_AMERICA:[Un.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},nP=Object.keys(tP[Un.GLOBAL]),fx=[Un.CHINA,Un.NORTH_AMERICA,Un.EUROPE,Un.ASIA,Un.JAPAN,Un.INDIA,Un.OCEANIA,Un.SOUTH_AMERICA,Un.AFRICA,Un.KOREA,Un.HKMC,Un.US],Efe=function(e,n){let i=[];if(ot(e).call(e,Un.GLOBAL)){const u=[Un.GLOBAL,Un.OVERSEA],h=Object.keys($A);if(n===Un.GLOBAL)throw new Oe(X.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(n===Un.CHINA)i=[Un.OVERSEA];else if(c=n,ot(nP).call(nP,c)){const m=(o=n,tP[Un.GLOBAL][o]||[]),_=[...u,n,...m];i=h.filter(y=>!ot(_).call(_,y))}else if(function(m){let _=!1;return nP.forEach(y=>{var S;ot(S=tP[Un.GLOBAL][y]).call(S,m)&&(_=!0)}),_}(n)){const m=function(y){let S;return nP.forEach(w=>{var A;ot(A=tP[Un.GLOBAL][w]).call(A,y)&&(S=w)}),S}(n),_=[...u,m,n];i=h.filter(y=>!ot(_).call(_,y))}else i=e;i=function(m){const _=[];return fx.forEach(y=>{ot(m).call(m,y)&&_.push(y)}),_.concat(m.filter(y=>!ot(fx).call(fx,y)))}(i)}else i=e;var o,c;return i};function xG(e){var n,i;if(!e&&ot(n=re("AREAS")).call(n,Un.EXTENSIONS))return D.debug("update area from ap : reset"),void mx(Ipe,!0);if(!ot(i=re("AREAS")).call(i,Un.GLOBAL)||!e)return;let o=$A.EXTENSIONS;o&&(o={CODE:LG(Un.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},D.debug("update area from ap success: ".concat(e,",config is "),o),Xn("AREAS",[Un.EXTENSIONS],!0),Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?Xn(c,o[c][0]):Xn(c,o[c])}))}function mx(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=wt.reportApiInvoke(null,{name:mi.SET_AREA,options:e,tag:Lr.TRACER});try{let o=[];if(typeof e=="string"&&(o=[e]),Array.isArray(e)&&(e.forEach(u=>{if(!ot(tG).call(tG,u))throw new Oe(X.INVALID_PARAMS,"invalid area code")}),o=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:u,excludedArea:h}=e;if(!u)throw new Oe(X.INVALID_PARAMS,"area code is needed");let m=u;typeof u=="string"&&(m=[u]),o=h?Efe(m,h):m}if(!n){if(ld.AREAS){const u=new Oe(X.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(u),void D.warning("setArea is prohibited because of config-distribute")}if(ot(o).call(o,Un.GLOBAL)&&re("AREAS")===Un.EXTENSIONS){const u=new Oe(X.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(u),void D.warning("setArea is prohibited because of ap extensions")}}Xn("AREAS",o,n);const c=_fe(o);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?Xn(u,c[u][0]):Xn(u,c[u])}),D.debug("set area success:",o.join(","))}catch(o){throw i.onError(o),o}i.onSuccess()}function MG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function ph(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?MG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):MG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let gx=1;function yfe(e,n,i,o,c){gx+=1;const u={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:gx,requestId:gx,version:pl,cname:i.cname},h={service_name:n,json_body:JSON.stringify(u)};let m,_,y=e[0];return cd(async()=>{m=Date.now();const S=await pd(y,{data:h,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(_=Date.now()-m,S.code!==0){const k=new Oe(X.UNEXPECTED_RESPONSE,"live streaming ap error, code"+S.code,{retry:!0,responseTime:_});throw D.error(k.toString()),k}const w=JSON.parse(S.json_body);if(w.code!==200){const k=new Oe(X.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(w.code,", reason: ").concat(w.reason),{code:w.code,responseTime:_});throw D.error(k.toString()),k}if(!w.servers||w.servers.length===0){const k=new Oe(X.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:w.code,responseTime:_});throw D.error(k.toString()),k}const A=function(k,W){return{addressList:k.servers.map(U=>"wss://".concat(U.address.replace(/\./g,"-"),".").concat(re("WORKER_DOMAIN"),":").concat(U.wss,"?serviceName=").concat(encodeURIComponent(W))),workerToken:k.workerToken,vid:k.vid}}(w,n);return re("LIVE_STREAMING_ADDRESS")&&(A.addressList=re("LIVE_STREAMING_ADDRESS")instanceof Array?re("LIVE_STREAMING_ADDRESS"):[re("LIVE_STREAMING_ADDRESS")]),ph(ph({},A),{},{responseTime:_})},(S,w)=>(wt.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:n,responseDetail:JSON.stringify(S.addressList),firstSuccess:w===0,responseTime:_,serverIp:e[w%e.length]}),!1),(S,w)=>(wt.apworkerEvent(i.sid,{success:!1,sc:S.data&&S.data.code||200,serviceName:n,responseTime:_,serverIp:e[w%e.length]}),!!(S.code!==X.OPERATION_ABORTED&&S.code!==X.UNEXPECTED_RESPONSE||S.data&&S.data.retry)&&(y=e[(w+1)%e.length],!0)),c)}let _x=1;function UG(e,n,i,o){let{url:c,areaCode:u}=e;const{clientId:h,sid:m}=n,_=Date.now();let y;const S=n.role,[w,A]=yx(n,u,[ai.CHOOSE_SERVER]);let k=oi.networkState;return cd(async()=>{k&&oi.networkState===Ka.OFFLINE&&oi.onlineWaiter&&await lt.race([oi.onlineWaiter,es(o&&o.maxRetryTimeout||gi.maxRetryTimeout)]),k=oi.networkState;const{data:W,headers:U}=await pd(c,{data:w,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=U.http3==="1"?1:-1,wt.reportResourceTiming(c,m),FG(W,c,n,_,[ai.CHOOSE_SERVER],y);const V=hb(W,ai.CHOOSE_SERVER);return Ex(V),ax(V,c)},W=>(W&&wt.joinChooseServer(m,{role:S,lts:_,succ:!0,csAddr:c,opid:A,serverList:W.gatewayAddrs.map(U=>U.address),ec:null,cid:W.cid.toString(),uid:W.uid.toString(),csIp:W.csIp,unilbsServerIds:[ai.CHOOSE_SERVER].toString(),isHttp3:y,corssRegionTagReq:n.apRequestDetail,corssRegionTagRes:W.res.detail&&W.res.detail[38]}),!1),W=>W.code!==X.OPERATION_ABORTED&&(W.code===X.CAN_NOT_GET_GATEWAY_SERVER?W.data.retry:(wt.joinChooseServer(m,{role:S,lts:_,succ:!1,csAddr:c,serverList:null,opid:A,ec:W.code,csIp:W.data&&W.data.csIp,unilbsServerIds:[ai.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:k}),isHttp3:y,corssRegionTagReq:n.apRequestDetail}),D.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),W),!0)),o)}function VG(e,n,i,o){let c,{url:u,areaCode:h,serviceIds:m}=e;const _=Date.now(),y=n.role,[S,w]=yx(n,h,m);let A;return cd(async()=>{A&&oi.networkState===Ka.OFFLINE&&oi.onlineWaiter&&await lt.race([oi.onlineWaiter,es(o&&o.maxRetryTimeout||gi.maxRetryTimeout)]),A=oi.networkState;const{data:k,headers:W}=await pd(u,{data:S,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=W.http3==="1"?1:-1,wt.reportResourceTiming(u,n.sid),FG(k,u,n,_,m,c);const U=hb(k,ai.CHOOSE_SERVER),V=hb(k,n.cloudProxyServer==="proxy5"?ai.CLOUD_PROXY_5:n.cloudProxyServer==="proxy3"||n.cloudProxyServer==="proxy4"?ai.CLOUD_PROXY:ai.CLOUD_PROXY_FALLBACK);return Ex(U),{gatewayInfo:ax(U,u),proxyInfo:V,url:u}},k=>(k.gatewayInfo&&wt.joinChooseServer(n.sid,{role:y,lts:_,succ:!0,csAddr:u,serverList:k.gatewayInfo.gatewayAddrs.map(W=>W.address),ec:null,opid:w,cid:k.gatewayInfo.cid.toString(),uid:k.gatewayInfo.uid.toString(),csIp:k.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:n.apRequestDetail,corssRegionTagRes:k.gatewayInfo.res.detail&&k.gatewayInfo.res.detail[38]}),k.proxyInfo&&wt.joinWebProxyAP(n.sid,{lts:_,sucess:1,apServerAddr:u,turnServerAddrList:k.proxyInfo.addresses.map(W=>W.ip).join(","),errorCode:null,eventType:n.cloudProxyServer,unilbsServerIds:m.toString()}),!1),k=>k.code!==X.OPERATION_ABORTED&&(k.code===X.CAN_NOT_GET_GATEWAY_SERVER?k.data.retry:(wt.joinWebProxyAP(n.sid,{lts:_,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:k.code,eventType:n.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:A})}),D.warning("[".concat(n.clientId,"] multi unilbs network error, retry"),k),!0)),o)}const FG=(e,n,i,o,c,u)=>{const{sid:h,clientId:m,cloudProxyServer:_}=i,y=[],S=w=>{w.flag===4096?wt.joinChooseServer(h,{role:i.role,lts:o,succ:!1,csAddr:n,opid:e.opid,serverList:null,ec:w.error.message,csIp:w.error.data&&w.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:i.apRequestDetail}):w.flag!==1048576&&w.flag!==4194304&&w.flag!==4194310||wt.joinWebProxyAP(h,{lts:o,sucess:0,apServerAddr:n,turnServerAddrList:null,errorCode:w.error.code,eventType:_,unilbsServerIds:c.toString()})};if(e.response_body.forEach(w=>{const A=w.buffer.code;if(w.uri===23&&A===0&&!w.buffer.edges_services)if(w.buffer.flag===4194310)D.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),w.buffer.edges_services=[];else{const k={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:w.buffer.flag};y.push(k),S(k)}if(A!==0){const k=xv(A),W={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,k.desc,{desc:k.desc,retry:k.retry,csIp:e.detail[502]}),flag:w.buffer.flag};w.buffer.flag===4194310?D.warning(W.error.toString()):y.push(W),S(W)}}),y.length)throw D.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(n," failed, ").concat(y.map(w=>"flag: ".concat(w.flag,", message: ").concat(w.error.message,", retry: ").concat(w.error.data.retry)).join(" | "))),new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,y.map(w=>"flag: ".concat(w.flag,", message: ").concat(w.error.message)).join(" | "),{retry:!!y.find(w=>w.error.data.retry),csIp:e.detail[502],desc:[...new Set(y.map(w=>{var A;return w==null||(A=w.error)===null||A===void 0||(A=A.data)===null||A===void 0?void 0:A.desc}).filter(w=>!!w))]})},Ex=e=>{var n,i,o,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(re("AP_AREA")&&((o=e.detail)!==null&&o!==void 0&&o[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?xG(e.detail[23].toLowerCase()):xG()),(n=e.detail)!==null&&n!==void 0&&n[19]&&typeof((i=e.detail)===null||i===void 0?void 0:i[19])=="string"){const h=e.detail[19],m=h==null?void 0:h.split(";");for(let _=0;_<m.length;_++){var u;const y=Ys(u=m[_]).call(u);e.addresses[_]&&m&&(e.addresses[_].fingerprint=y)}}if(re("GATEWAY_ADDRESS")&&re("GATEWAY_ADDRESS").length>0){D.debug("assign gateway address to",re("GATEWAY_ADDRESS"));const h=re("GATEWAY_ADDRESS").map(m=>{var _,y;const S=(_=(y=e.addresses.find(w=>w.ip===m.ip&&w.port===m.port))===null||y===void 0?void 0:y.fingerprint)!==null&&_!==void 0?_:"";return{ip:m.ip,port:m.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:S}});e.addresses=h}},vfe=(e,n)=>{if(e.response_body&&e.response_body.length){const i=e.response_body[0];if(i.buffer.code!==0){const o=xv(i.buffer.code);throw new Oe(X.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return i.buffer.ticket}throw D.debug("update ticket request received ap response without response body:",n),new Oe(X.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},yx=(e,n,i)=>{const o=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,u={appid:e.appId,client_ts:Date.now(),opid:o,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:ph(ph(ph({6:e.stringUid,11:n,12:re("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:n},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:i,uid:e.uid||0}}]};u.request_bodies.forEach(m=>{e.multiIP&&e.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,o]},Sfe=(e,n)=>{const i=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:n,uid:e.uid||0,edges_services:e.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(o)),[c,i]};let Fv=0;function jv(e){return lt.all(e.map(n=>n.then(i=>{throw i},i=>i))).then(n=>{throw n},n=>n)}const _b=async e=>{let{fragementLength:n,referenceList:i,asyncMapHandler:o,allFailedhandler:c,promisesCollector:u}=e,h=0;const m=n;let _,y=0;const S=async()=>{const w=(()=>{const A=h*m,k=A+m;return i.slice(A,k).map(o)})();u&&u.push(...w);try{_=await jv(w)}catch(A){if(y+=m,h++,!(y>=i.length))return void await S();c(A)}w.forEach(A=>A.cancel())};return await S(),_},jG=async e=>{let{referenceList:n,asyncMapHandler:i,closeFn:o}=e;const c=n.length;let u=0;const h=async()=>{const m=i(n.shift());try{return await m}catch(_){if(u++,u>=c||o!=null&&o(_))throw _;return h()}};return h()};async function vx(e,n,i,o){return{gatewayInfo:await async function(u,h,m,_){let y=null;const S=[],w=async()=>{const k=re("WEBCS_DOMAIN").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(V=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:gb()})),W=_.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(V=>V.url)}),U=await _b({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:V=>(D.debug("[".concat(u.clientId,"] Connect to choose_server:"),V.url),UG(V,u,h,m)),allFailedhandler:V=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},W),V[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},W),U},A=async()=>{if(await es(1e3),y!==null)return y;const k=re("WEBCS_DOMAIN_BACKUP_LIST").map(V=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:gb()})),W=_.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(V=>V.url)}),U=await _b({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:V=>(D.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),V.url),UG(V,u,h,m)),allFailedhandler:V=>{throw _.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},W),V[0]},promisesCollector:S});return _.recordJoinChannelService({endTs:Date.now(),status:"success"},W),U};try{return y=await jv([w(),A()]),S.length&&S.forEach(k=>k.cancel&&typeof k.cancel=="function"&&k.cancel()),y}catch(k){throw k[0]}}(e,n,i,o)}}async function BG(e,n,i,o,c){const u=e.cloudProxyServer;if(u==="disabled"){if(e.useLocalAccessPoint)return await vx(e,n,i,c);if(re("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:A,proxyInfo:k}=await GG(e,n,i,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:A};const W=k.map(U=>({turnServerURL:U.address,tcpport:U.tcpport||ys.tcpport,udpport:U.udpport||ys.udpport,username:U.username||ys.username,password:U.password||ys.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const U=(h=e.uid)!==null&&h!==void 0?h:A.uid,V="glb:".concat(U.toString()),q=await pL(V),Y=k.map(ce=>({turnServerURL:ce.address,tcpport:ce.tcpport||ys.tcpport,udpport:ce.udpport||ys.udpport,username:V,password:q,forceturn:!1,security:!0}));W.push(...Y)}return e.turnServer={mode:"manual",servers:W},{gatewayInfo:A}}return await vx(e,n,i,c)}const{proxyInfo:m,gatewayInfo:_}=await GG(e,n,i,c),y={gatewayInfo:_},S=m.map(A=>({turnServerURL:A.address,tcpport:u==="proxy3"?void 0:A.tcpport?A.tcpport:ys.tcpport,udpport:u==="proxy4"?void 0:A.udpport?A.udpport:ys.udpport,username:A.username||ys.username,password:A.password||ys.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var w;const A=(w=e.uid)!==null&&w!==void 0?w:_.uid,k="glb:".concat(A.toString()),W=await pL(k),U=m.map(V=>({turnServerURL:V.address,tcpport:u==="proxy3"?void 0:V.tcpport||ys.tcpport,udpport:u==="proxy4"?void 0:V.udpport||ys.udpport,username:k,password:W,forceturn:u!=="proxy4",security:u==="proxy5"}));S.push(...U)}return e.turnServer={mode:"manual",servers:S},D.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(u)),y}async function WG(e,n,i,o,c){const u=re("ACCOUNT_REGISTER").slice(0,re("AJAX_REQUEST_CONCURRENT"));let h=[];h=n.proxyServer?u.map(_=>"https://".concat(n.proxyServer,"/ap/?url=").concat(_+"/api/v1")):u.map(_=>"https://".concat(_,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const _=await async function(y,S,w,A,k){const W=Date.now(),U={sid:w.sid,opid:10,appid:w.appId,string_uid:S};let V=y[0];const q=await cd(()=>pd(V+"".concat(V.indexOf("?")===-1?"?":"&","action=stringuid"),{data:U,cancelToken:A,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(Y,ce)=>{if(Y.code===0){if(Y.uid<=0||Y.uid>=Math.pow(2,32))throw D.error("Invalid Uint Uid ".concat(S," => ").concat(Y.uid),Y),wt.reqUserAccount(U.sid,{lts:W,success:!1,serverAddr:V,stringUid:U.string_uid,uid:Y.uid,errorCode:X.INVALID_UINT_UID_FROM_STRING_UID,extend:U}),new Oe(X.INVALID_UINT_UID_FROM_STRING_UID);return wt.reqUserAccount(U.sid,{lts:W,success:!0,serverAddr:V,stringUid:U.string_uid,uid:Y.uid,errorCode:null,extend:U}),!1}const _e=xv(Y.code);return _e.retry&&(V=y[(ce+1)%y.length]),wt.reqUserAccount(U.sid,{lts:W,success:!1,serverAddr:V,stringUid:U.string_uid,uid:Y.uid,errorCode:_e.desc,extend:U}),_e.retry},(Y,ce)=>Y.code!==X.OPERATION_ABORTED&&(wt.reqUserAccount(U.sid,{lts:W,success:!1,serverAddr:V,stringUid:U.string_uid,uid:null,errorCode:Y.code,extend:U}),V=y[(ce+1)%y.length],!0),k);if(q.code!==0){const Y=xv(q.code);throw new Oe(X.UNEXPECTED_RESPONSE,Y.desc)}return q}(h,e,n,i,o);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),_.uid}catch(_){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[_]},m),_}}async function Tfe(e,n,i){const o=re("ACCOUNT_REGISTER");let c=[];c=n.proxyServer?o.map(u=>"https://".concat(n.proxyServer,"/ap/?url=").concat(u+"/api/v1")):o.map(u=>"https://".concat(u,"/api/v1"));try{return await jG({referenceList:c,asyncMapHandler:h=>async function(m,_,y,S){const w=Date.now(),A={sid:y.sid,opid:10,appid:y.appId,string_uid:_};try{const k=await pd(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:A,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(k.code!==0){const W=xv(k.code);throw new Oe(X.UNEXPECTED_RESPONSE,"preload sua error:".concat(W.desc),W)}if(k.uid<=0||k.uid>=Math.pow(2,32))throw new Oe(X.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:w,url:m,req:A,uid:k.uid,elapse:Date.now()-w}}catch(k){throw k}}(h,e,n,i),closeFn:h=>h.code===X.OPERATION_ABORTED||h.code===X.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function bfe(e,n,i){const o=re("CDS_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v1"):"https://".concat(_,"/api/v1?action=config")),c=o.map(_=>function(y,S,w,A){const k=Rn(),W={flag:64,cipher_method:0,features:ph(ph(ph(ph(ph({install_id:wL(),device:k.name,system:k.os,system_general:navigator.userAgent,vendor:S.appId,version:pl,cname:S.cname,session_id:S.sid,proxyServer:S.proxyServer,sdk_type:ffe.WEB_RTC,browser_name:k.name,browser_version:k.version,user_agent:navigator.userAgent,channel_name:S.cname},S.stringUid&&{string_uid:S.stringUid}),S.uid&&{uid:S.uid+""}),k.os&&{os_name:k.os}),k.osVersion&&{os_version:k.osVersion}),{},{detail:""})};return cd(()=>pd(y,{data:W,timeout:1e3,cancelToken:w,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,U=>U.code!==X.OPERATION_ABORTED,A)}(_,e,n,i));let u=null,h=null,m={};try{u=await jv(c)}catch(_){if(_.code===X.OPERATION_ABORTED)throw _;h=_}if(c.forEach(_=>_.cancel()),wt.reportApiInvoke(e.sid,{name:mi.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{m=function(_){if(!_.test_tags)return{};const y=_.test_tags,S=Object.keys(y),w={};return S.forEach(A=>{var k;const W=Ys(k=A.slice(4)).call(k),U=JSON.parse(y[A]),V=U[1];w[W]={tag:U[0]||"",value:V}}),w}(u)}catch{}return m}async function zG(e,n){const i=re("WEBCS_DOMAIN").concat(re("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:gb(),serviceIds:[ai.CHOOSE_SERVER,ai.CLOUD_PROXY_FALLBACK]}));try{return await jG({referenceList:i,asyncMapHandler:c=>async function(u,h,m){let _,{url:y,areaCode:S,serviceIds:w}=u;const A=Date.now(),[k,W]=yx(h,S,w);let U=oi.networkState;try{U&&oi.networkState===Ka.OFFLINE&&oi.onlineWaiter&&await lt.race([oi.onlineWaiter,es(gi.maxRetryTimeout)]),U=oi.networkState;const{data:V,headers:q}=await pd(y,{data:k,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_=q.http3==="1"?1:-1,(Ee=>{const me=[];if(Ee.response_body.forEach(ke=>{const Ye=ke.buffer.code;if(ke.uri===23&&Ye===0&&!ke.buffer.edges_services)if(ke.buffer.flag===4194310)ke.buffer.edges_services=[];else{const ut={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:Ee.detail[502]}),flag:ke.buffer.flag};me.push(ut)}if(Ye!==0){const ut=xv(Ye),pt={error:new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,ut.desc,{desc:ut.desc,retry:ut.retry,csIp:Ee.detail[502]}),flag:ke.buffer.flag};ke.buffer.flag===4194310?D.warning(pt.error.toString()):me.push(pt)}}),me.length)throw new Oe(X.CAN_NOT_GET_GATEWAY_SERVER,me.map(ke=>"flag: ".concat(ke.flag,", message: ").concat(ke.error.message)).join(" | "),{retry:!!me.find(ke=>ke.error.data.retry),csIp:Ee.detail[502],desc:[...new Set(me.map(ke=>{var Ye;return ke==null||(Ye=ke.error)===null||Ye===void 0||(Ye=Ye.data)===null||Ye===void 0?void 0:Ye.desc}).filter(ke=>!!ke))]})})(V);const ce=hb(V,ai.CHOOSE_SERVER),_e=hb(V,ai.CLOUD_PROXY_FALLBACK);return Ex(ce),{gatewayInfo:ax(ce,y),proxyInfo:_e,opid:W,requestTime:A,url:y,isHttp3:_,elapse:Date.now()-A}}catch(V){throw V}}(c,e,n),closeFn:c=>c.code===X.OPERATION_ABORTED||c.code===X.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(o){throw o}}async function GG(e,n,i,o){const c=re("PROXY_SERVER_TYPE3"),u=(k,W,U)=>{let V=U||c;return Array.isArray(V)&&(V=W%2==0?c[1]:c[0]),"https://".concat(V,"/ap/?url=").concat(k)};let h=null;const m=[],_=async()=>{const k=re("WEBCS_DOMAIN").slice(0,re("AJAX_REQUEST_CONCURRENT")).map((V,q)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(V,"/api/v2/transpond/webrtc?v=2"),q,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(V,"/api/v2/transpond/webrtc?v=2"):u("".concat(V,"/api/v2/transpond/webrtc?v=2"),q),{url:Y,areaCode:gb(),serviceIds:[ai.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ai.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ai.CLOUD_PROXY:ai.CLOUD_PROXY_FALLBACK]}}),W=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(V=>V.url)}),U=await _b({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:V=>(D.debug("[".concat(e.clientId,"] Connect to choose_server:"),V.url),VG(V,e,n,i)),allFailedhandler:V=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},W),V[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},W),U},y=async()=>{if(await es(1e3),h!==null)return h;const k=re("WEBCS_DOMAIN_BACKUP_LIST").map((V,q)=>{let Y;return Y=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(V,"/api/v2/transpond/webrtc?v=2"),q,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(V,"/api/v2/transpond/webrtc?v=2"):u("".concat(V,"/api/v2/transpond/webrtc?v=2"),q),{url:Y,areaCode:gb(),serviceIds:[ai.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?ai.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ai.CLOUD_PROXY:ai.CLOUD_PROXY_FALLBACK]}}),W=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:k.map(V=>V.url)}),U=await _b({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:k,asyncMapHandler:V=>(D.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),V.url),VG(V,e,n,i)),allFailedhandler:V=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},W),V[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},W),U};let S,w,A;try{({gatewayInfo:S,proxyInfo:w,url:A}=await jv([_(),y()]))}catch(k){throw k[0]}if(m.length&&m.forEach(k=>k.cancel&&typeof k.cancel=="function"&&k.cancel()),!S||!w)throw new Oe(X.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=A,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&A){const k=/^https?:\/\/(.+?)(\/.*)?$/.exec(A)[1];ot(c).call(c,k)&&(e.proxyServer=k,D.setProxyServer(k),wt.setProxyServer(k))}return h={gatewayInfo:S,proxyInfo:await fG(w,S.uid)},h}async function wfe(e,n,i){const o=re("UAP_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=o.map(u=>function(h,m,_,y){const S={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:pl,cname:m.cname,uid:m.uid.toString(),requestId:_x,seq:_x};_x+=1;const w={service_name:"tele_channel",json_body:JSON.stringify(S)};return cd(async()=>{const A=await pd(h,{data:w,cancelToken:_,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(A.code!==0){const W=new Oe(X.UNEXPECTED_RESPONSE,"cross channel ap error, code"+A.code,{retry:!0});throw D.error(W.toString()),W}const k=JSON.parse(A.json_body);if(k.code!==200){const W=new Oe(X.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(k.code,", reason: ").concat(k.reason));throw D.error(W.toString()),W}if(!k.servers||k.servers.length===0){const W=new Oe(X.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw D.error(W.toString()),W}return{vid:k.vid,workerToken:k.workerToken,addressList:(re("CHANNEL_MEDIA_RELAY_SERVERS")||k.servers).map(W=>"wss://".concat(W.address.replace(/\./g,"-"),".").concat(re("WORKER_DOMAIN"),":").concat(W.wss))}},void 0,A=>!!(A.code!==X.OPERATION_ABORTED&&A.code!==X.UNEXPECTED_RESPONSE||A.data&&A.data.retry),y)}(u,e,n,i));try{const u=await jv(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function Rfe(e,n,i){let o=null;const c=[],u=async h=>{const m=re(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(_=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"));return h&&(await es(1e3),o!==null)?o:await _b({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:_=>(D.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),_),function(y,S,w,A){const[k]=Sfe(S,[ai.CHOOSE_SERVER]);let W=oi.networkState;return cd(async()=>{W&&oi.networkState===Ka.OFFLINE&&oi.onlineWaiter&&await lt.race([oi.onlineWaiter,es(A&&A.maxRetryTimeout||gi.maxRetryTimeout)]),W=oi.networkState;const U=await pd(y,{data:k,cancelToken:w,headers:{"Content-Type":"multipart/form-data;"}},!0);return vfe(U,y)},()=>!1,U=>U.code!==X.OPERATION_ABORTED&&(U.code===X.UPDATE_TICKET_FAILED?U.data.retry:(D.warning("[".concat(S.clientId,"] update ticket network error, retry"),U),!0)),A)}(_,e,n,i)),allFailedhandler:_=>{throw _[0]},promisesCollector:c})};try{return o=await jv([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),o}catch(h){throw h[0]}}function HG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Sx(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?HG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):HG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class Cfe extends Ar{get isSuccess(){return!!this.configs}constructor(n,i){super(),$(this,"configs",void 0),$(this,"store",void 0),$(this,"joinInfo",void 0),$(this,"cancelToken",void 0),$(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),$(this,"interval",void 0),$(this,"mutex",void 0),$(this,"mutableParamsRead",!1),$(this,"configCache",{}),$(this,"limit_bitrate",void 0),this.mutex=new Cs("config-distribute",n),this.store=i}startGetConfigDistribute(n,i){this.joinInfo=n,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),re("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},re("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,wt.reportApiInvoke(null,{options:void 0,name:mi.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Lr.TRACER}).onSuccess(JSON.stringify(ld))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void D.debug("[config-distribute] get config distribute interrupted have no joininfo");let n;const i=await this.mutex.lock();try{n=await bfe(this.joinInfo,this.cancelToken,this.retryConfig),D.debug("[config-distribute] get config distribute",JSON.stringify(n));const o=function(c){var u;const h=VT(u=Object.keys(c).filter(y=>/^webrtc_ng_global_parameter/.test(y))).call(u);for(let y=0;y<h.length;y++)for(let S=h.length-1;S>y;S--){const w=h[S],A=c[w].value;if(typeof A.__priority=="number"){const k=A.__priority,W=h[S-1],U=c[W].value;if(typeof U.__priority=="number"){if(!(k>U.__priority))continue;{const V=w;h[S]=h[S-1],h[S-1]=V}}else{const V=w;h[S]=h[S-1],h[S-1]=V}}}const m=Date.now();let _={};return h.forEach(y=>{const S=c[y].value.__expires;S&&S<=m||(_[y]=c[y])}),_}(n);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const c=new Oe(X.NETWORK_RESPONSE_ERROR,o);D.warning("[config-distribute] ".concat(c.toString()))}finally{i()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(n){nG(n)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==n.id&&this.emit(lb.UPDATE_BITRATE_LIMIT,n):this.emit(lb.UPDATE_BITRATE_LIMIT,n))}getLowStreamConfigDistribute(){return this.limit_bitrate&&Sx({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(n){try{const i={},o=Object.keys(n),c=[];o.forEach(u=>{const h=n[u].value;i[u]=h;const m=h.__id;if(m&&this.configCache[u]&&this.configCache[u].__id===m)return;const _=h.__type,y=n[u].value,S=n[u].tag;let w=0;_?_===kW.REALTIME&&(w=1):Object.keys(y).some(A=>Object.prototype.hasOwnProperty.call(AL,A)||!JL()&&Object.prototype.hasOwnProperty.call(wA,A)?(w=1,!0):void 0),c.push({tag:S,isApplied:w,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:m,params:_,isApplied:y}=u;this.store.sessionId&&wt.abTest(this.store.sessionId,{intSucc:1,isApplied:y,tag:h,feature:m,params:_,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=i}catch(i){D.debug("handleABTestConfigDistribute error",i)}}cacheGlobalParameterConfig(n){const i=function(c){const u={};return Object.keys(c).forEach(h=>{const m=c[h].value,_=m.__expires,y=m.__type;Object.keys(m).forEach(S=>{S==="__id"||S==="__type"||S==="__priority"||S==="__expires"||Object.prototype.hasOwnProperty.call(u,S)||(u[S]=Sx(Sx({value:m[S]},_&&{expires:_}),y&&{type:y}))})}),u}(n);try{var o;const c=(o=i.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete i.LIMIT_BITRATE,c&&nG(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(i),this.handleABTestConfigDistribute(n),function(m){try{const _=Date.now();Object.keys(m).forEach(y=>{const{value:S,type:w,expires:A}=m[y];A&&A<=_||((w===kW.REALTIME||Object.prototype.hasOwnProperty.call(AL,y))&&(ld[y]=S,fr[y]=S,D.debug("Update realtime parameters from config distribute",y,S)),w||JL()||!Object.prototype.hasOwnProperty.call(wA,y)||(ld[y]=S,fr[y]=S,D.debug("Update gateway parameters from config distribute",y,S)))})}catch(_){D.error("Error update config immediately: ".concat(m),_.message)}}(i);const u=JSON.stringify(i),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),D.debug("Caching global parameters ".concat(u))}catch(c){D.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(n){try{const i=Date.now();Object.keys(n).forEach(o=>{if(o==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(fr,o)){const{value:c,expires:u}=n[o];if(u&&u<=i)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(fr[o],c)||(ld[o]=c,fr[o]=c,this.emit(lb.UPDATE_CLIENT_ROLE_OPTIONS,c),D.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(i){D.error("Error handling global parameter config:",i.message)}}}class Ife extends Ar{constructor(){super(...arguments),$(this,"resultStorage",new Map)}setLocalAudioStats(n,i,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",n,this.checkAudioInputLevel(o,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",n,this.checkSendAudioBitrate(o,i))}setLocalVideoStats(n,i,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",n,this.checkSendVideoBitrate(o,i)),this.record("FRAMERATE_INPUT_TOO_LOW",n,this.checkFramerateInput(o,i)),this.record("FRAMERATE_SENT_TOO_LOW",n,this.checkFramerateSent(o))}setRemoteAudioStats(n,i){const o=n.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(i))}setRemoteVideoStats(n,i){const o=n.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(i))}record(n,i,o){if(re("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(n)||this.resultStorage.set(n,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(n);if(c&&(c.result.push(o),c.result.length>=5)){var u;const h=ot(u=c.result).call(u,!0);c.isPrevNormal&&!h&&this.emit("exception",$G[n],n,i),!c.isPrevNormal&&h&&this.emit("exception",$G[n]+2e3,n+"_RECOVER",i),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(n){return!(n.receiveBitrate>0&&n.receiveLevel===0)}checkAudioInputLevel(n,i){return i instanceof Ti&&!i.isActive||!!i.muted||n.sendVolumeLevel!==0}checkFramerateInput(n,i){let o=null;i._encoderConfig&&i._encoderConfig.frameRate&&(o=qa(i._encoderConfig.frameRate));const c=n.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(n){return!(n.captureFrameRate&&n.sendFrameRate&&n.captureFrameRate>5&&n.sendFrameRate<=1)}checkSendVideoBitrate(n,i){return!!i.muted||n.sendBitrate!==0}checkSendAudioBitrate(n,i){return i instanceof Ti&&!i.isActive||!!i.muted||n.sendBitrate!==0}checkVideoDecode(n){return n.receiveBitrate===0||n.decodeFrameRate!==0}}const $G={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Ps=new class{markSubscribeStart(e,n){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(n))}markPublishStart(e,n){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(n))}measureFromSubscribeStart(e,n){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(n));if(i.length>0){const o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(e,n){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(n));if(i.length>0){const o=i[i.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function KG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function k_(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?KG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):KG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class Eb{constructor(n){$(this,"store",void 0),$(this,"onStatsException",void 0),$(this,"onUploadPublishDuration",void 0),$(this,"onStatsChanged",void 0),$(this,"localStats",new Map),$(this,"remoteStats",new Map),$(this,"updateStatsInterval",void 0),$(this,"trafficStats",void 0),$(this,"trafficStatsPeerList",[]),$(this,"uplinkStats",void 0),$(this,"exceptionMonitor",void 0),$(this,"p2pChannel",void 0),$(this,"scalabilityMode",bA.L1T1),$(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=n,this.exceptionMonitor=new Ife,this.exceptionMonitor.on("exception",(i,o,c)=>{this.onStatsException&&this.onStatsException(i,o,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get($e.LocalAudioTrack)||k_({},DL)}getLocalVideoTrackStats(){return this.localStats.get($e.LocalVideoTrack)||k_({},LL)}getRemoteAudioTrackStats(n){const i=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},o={};if(n){var c;const u=(c=this.remoteStats.get(n))===null||c===void 0?void 0:c.audioStats;u&&(o[n]=i(n,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:m}]=u;m&&(o[h]=i(h,m))});return o}getRemoteNetworkQualityStats(n){const i={};if(n){var o;const c=(o=this.remoteStats.get(n))===null||o===void 0?void 0:o.networkStats;c&&(i[n]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(i[u]=h)});return i}getRemoteVideoTrackStats(n){const i=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(_=>_.peer_uid===u);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},o={};if(n){var c;const u=(c=this.remoteStats.get(n))===null||c===void 0?void 0:c.videoStats;u&&(o[n]=i(n,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:m}]=u;m&&(o[h]=i(h,m))});return o}getRTCStats(){let n=0,i=0,o=0,c=0;const u=this.localStats.get($e.LocalAudioTrack);u&&(n+=u.sendBytes,i+=u.sendBitrate);const h=this.localStats.get($e.LocalVideoTrack);h&&(n+=h.sendBytes,i+=h.sendBitrate);const m=this.localStats.get($e.LocalVideoLowTrack);m&&(n+=m.sendBytes,i+=m.sendBitrate),this.remoteStats.forEach(y=>{let{audioStats:S,videoStats:w}=y;S&&(o+=S.receiveBytes,c+=S.receiveBitrate),w&&(o+=w.receiveBytes,c+=w.receiveBitrate)});let _=1;return this.trafficStats&&(_+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:_,SendBitrate:i,SendBytes:n,RecvBytes:o,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(n){this.localStats.set(n,void 0)}removeLocalStats(n){n?this.localStats.delete(n):this.localStats.clear()}addRemoteStats(n){this.remoteStats.set(n,{})}removeRemoteStats(n){n?this.remoteStats.delete(n):this.remoteStats.clear()}addP2PChannel(n){this.p2pChannel=n}updateTrafficStats(n){n.peer_delay=n.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),n.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var o;const c=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(i.peer_uid),u=c!=null&&c.videoSSRC?Ps.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Ps.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=n}updateUplinkStats(n){this.uplinkStats&&this.uplinkStats.B_fir!==n.B_fir&&D.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(n.B_fir)),this.uplinkStats=n}static isRemoteVideoFreeze(n,i,o){if(!n)return!1;const c=!!o&&i.framesDecodeFreezeTime>o.framesDecodeFreezeTime,u=!o||i.framesDecodeCount>o.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(n){return!!n&&n._isFreeze()}isLocalVideoFreeze(n){return!(!n.inputFrame||!n.sentFrame)&&n.inputFrame.frameRate>5&&n.sentFrame.frameRate<3}updateLocalStats(n){Array.from(this.localStats.entries()).forEach(i=>{let[o,c]=i;switch(o){case $e.LocalVideoTrack:case $e.LocalVideoLowTrack:{const h=c,m=k_({},LL),_=n.getStats(),y=n.getLocalMedia(o);if(_){const S=_.videoSend.find(w=>w.ssrc===(y==null?void 0:y.ssrcs[0].ssrcId));if(S){const w=n.getLocalVideoSize(),A=n.getEncoderConfig($e.LocalVideoTrack);S.codec!=="H264"&&S.codec!=="H265"&&S.codec!=="VP8"&&S.codec!=="VP9"&&S.codec!=="AV1X"&&S.codec!=="AV1"||(m.codecType=S.codec),m.sendBytes=S.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,S.inputFrame?(m.captureFrameRate=S.inputFrame.frameRate,m.captureResolutionHeight=S.inputFrame.height,m.captureResolutionWidth=S.inputFrame.width):w&&(m.captureResolutionWidth=w.width,m.captureResolutionHeight=w.height),S.sentFrame?(m.sendFrameRate=S.sentFrame.frameRate,m.sendResolutionHeight=S.sentFrame.height,m.sendResolutionWidth=S.sentFrame.width):w&&(m.sendResolutionWidth=w.width,m.sendResolutionHeight=w.height),S.avgEncodeMs&&(m.encodeDelay=S.avgEncodeMs),A&&A.bitrateMax&&(m.targetSendBitrate=1e3*A.bitrateMax),m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(S)&&(m.totalFreezeTime+=1),S.scalabilityMode&&this.scalabilityMode!==S.scalabilityMode&&(D.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(S.scalabilityMode)),this.scalabilityMode=S.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(o,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&y&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,y.track,m);break}case $e.LocalAudioTrack:{const h=c,m=k_({},DL),_=n.getStats(),y=n.getLocalMedia(o);if(_){const S=_.audioSend.find(w=>w.ssrc===(y==null?void 0:y.ssrcs[0].ssrcId));if(S){if(S.codec!=="opus"&&S.codec!=="aac"&&S.codec!=="PCMU"&&S.codec!=="PCMA"&&S.codec!=="G722"||(m.codecType=S.codec),S.inputLevel)m.sendVolumeLevel=Math.round(32767*S.inputLevel);else{const w=n.getLocalAudioVolume();w&&(m.sendVolumeLevel=Math.round(32767*w))}m.sendBytes=S.bytes,m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set($e.LocalAudioTrack,m),m&&y&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,y.track,m);break}}})}updateRemoteStats(n){Array.from(this.remoteStats.entries()).forEach(i=>{var o,c;let[u,{videoStats:h,audioStats:m,videoPcStats:_}]=i;const y=m,S=h,w=_,A=k_({},WW),k=k_({},zW),W=k_({},dpe),{audioTrack:U,videoTrack:V,audioSSRC:q,videoSSRC:Y}=n.getRemoteMedia(u);let ce;ce=this.store.useP2P?n.getStats(!0):n.getStats();const _e=(o=ce)===null||o===void 0?void 0:o.audioRecv.find(Ye=>Ye.ssrc===q),Ee=(c=ce)===null||c===void 0?void 0:c.videoRecv.find(Ye=>Ye.ssrc===Y),me=this.trafficStats&&this.trafficStats.peer_delay.find(Ye=>Ye.peer_uid===u);if(_e&&(_e.codec!=="opus"&&_e.codec!=="aac"&&_e.codec!=="PCMU"&&_e.codec!=="PCMA"&&_e.codec!=="G722"||(A.codecType=_e.codec),_e.outputLevel?A.receiveLevel=Math.round(32767*_e.outputLevel):U&&(A.receiveLevel=Math.round(32767*U.getVolumeLevel())),A.receiveBytes=_e.bytes,A.receivePackets=_e.packets,A.receivePacketsLost=_e.packetsLost,A.receivePacketsDiscarded=_e.packetsDiscarded,A.packetLossRate=A.receivePacketsLost/(A.receivePackets+A.receivePacketsLost),A.receiveBitrate=y?8*Math.max(0,A.receiveBytes-y.receiveBytes):0,A.totalDuration=y?y.totalDuration+1:1,A.totalFreezeTime=y?y.totalFreezeTime:0,A.freezeRate=A.totalFreezeTime/A.totalDuration,A.receiveDelay=_e.jitterBufferMs,A.totalDuration>10&&Eb.isRemoteAudioFreeze(U)&&(A.totalFreezeTime+=1)),Ee){var ke;Ee.codec!=="H264"&&Ee.codec!=="H265"&&Ee.codec!=="VP8"&&Ee.codec!=="VP9"&&Ee.codec!=="AV1X"&&Ee.codec!=="AV1"||(k.codecType=Ee.codec),k.receiveBytes=Ee.bytes,k.receiveBitrate=S?8*Math.max(0,k.receiveBytes-S.receiveBytes):0,k.decodeFrameRate=Ee.decodeFrameRate<0?0:Ee.decodeFrameRate,k.renderFrameRate=Ee.decodeFrameRate<0?0:Ee.decodeFrameRate,Ee.outputFrame&&(k.renderFrameRate=Ee.outputFrame.frameRate),Ee.receivedFrame?(k.receiveFrameRate=Ee.receivedFrame.frameRate,k.receiveResolutionHeight=Ee.receivedFrame.height,k.receiveResolutionWidth=Ee.receivedFrame.width):V&&(k.receiveResolutionHeight=V._videoHeight||0,k.receiveResolutionWidth=V._videoWidth||0),Ee.framesRateFirefox!==void 0&&(k.receiveFrameRate=Math.round(Ee.framesRateFirefox)),k.receivePackets=Ee.packets,k.receivePacketsLost=Ee.packetsLost,k.packetLossRate=k.receivePacketsLost/(k.receivePackets+k.receivePacketsLost);const Ye=S?S.totalFreezeTime:0,ut=S?S.totalDuration:0;k.totalDuration=S?S.totalDuration+1:1,k.totalFreezeTime=(ke=Ee.totalFreezesDuration)!==null&&ke!==void 0?ke:Ye||0,k.receiveDelay=Ee.jitterBufferMs||0;const pt=!!Y&&n.getRemoteVideoIsReady(Y);Ee.totalFreezesDuration===void 0&&V&&pt&&Eb.isRemoteVideoFreeze(V,Ee,w)&&(k.totalFreezeTime+=1),k.freezeRate=Math.max(0,Math.min((k.totalFreezeTime-Ye)/(k.totalDuration-ut),1))}me&&(A.end2EndDelay=me.B_ad,k.end2EndDelay=me.B_vd,A.transportDelay=me.B_ed,k.transportDelay=me.B_ed,A.currentPacketLossRate=me.B_ealr4/100,k.currentPacketLossRate=me.B_evlr4/100,W.uplinkNetworkQuality=me.B_punq?me.B_punq:0,W.downlinkNetworkQuality=me.B_pdnq?me.B_pdnq:0),this.remoteStats.set(u,{audioStats:A,videoStats:k,videoPcStats:Ee,networkStats:W}),U&&this.exceptionMonitor.setRemoteAudioStats(U,A),V&&this.exceptionMonitor.setRemoteVideoStats(V,k)})}}class qG{constructor(){$(this,"destChannelMediaInfos",new Map),$(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(n){eG(n),this.srcChannelMediaInfo=n}addDestChannelInfo(n){eG(n),this.destChannelMediaInfos.set(n.channelName,n)}removeDestChannelInfo(n){zA(n),this.destChannelMediaInfos.delete(n)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function YG(e){if(!(e instanceof qG))return new Oe(X.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const n=e.getSrcChannelMediaInfo(),i=e.getDestChannelMediaInfo();if(!n)return new Oe(X.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new Oe(X.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Im{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(n,i){$(this,"uid",void 0),$(this,"_uintid",void 0),$(this,"_trust_in_room_",!0),$(this,"_trust_audio_enabled_state_",!0),$(this,"_trust_video_enabled_state_",!0),$(this,"_trust_audio_mute_state_",!0),$(this,"_trust_video_mute_state_",!0),$(this,"_audio_muted_",!1),$(this,"_video_muted_",!1),$(this,"_audio_enabled_",!0),$(this,"_video_enabled_",!0),$(this,"_audio_added_",!1),$(this,"_video_added_",!1),$(this,"_is_pre_created",!1),$(this,"_video_pre_subscribed",!1),$(this,"_audio_pre_subscribed",!1),$(this,"_trust_video_stream_added_state_",!0),$(this,"_trust_audio_stream_added_state_",!0),$(this,"_audioTrack",void 0),$(this,"_videoTrack",void 0),$(this,"_dataChannels",[]),$(this,"_audioSSRC",void 0),$(this,"_videoSSRC",void 0),$(this,"_audioOrtc",void 0),$(this,"_videoOrtc",void 0),$(this,"_cname",void 0),$(this,"_rtxSsrcId",void 0),$(this,"_videoMid",void 0),$(this,"_audioMid",void 0),this.uid=n,this._uintid=i}}function XG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function JG(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?XG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):XG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const yb="9",QG=4e4;function ZG(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function $p(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?ZG(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ZG(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}var Bv=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(Bv||{});const rP=new Map;function e9(e,n,i,o){let{scale:c}=e;if(c===0&&o===Bv.UP||c>=n.length-1&&o===Bv.DOWN)return e;let u=$p($p({},e),{},{scale:o===Bv.DOWN?++c:--c});switch(i){case"maintain-framerate":u=$p($p({},u),n[c].motion);break;case"maintain-resolution":u=$p($p({},u),n[c].detail);break;case"balanced":u=$p($p({},u),n[c].balanced)}return u}function t9(e,n){if(n){const i={overUse:0,underUse:0,adaptationList:n9(n)};rP.set(e,i)}else rP.delete(e)}function n9(e){const n=$p({},e),{bitrateMax:i,frameRate:o,scaleResolutionDownBy:c,bitrateMin:u}=n,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:_,BITRATE_MIN_THRESHOLD:y,BITRATE_MAX_THRESHOLD:S,BWE_SCALE_UP_THRESHOLD:w,BWE_SCALE_DOWN_THRESHOLD:A,PERF_SCALE_DOWN_THRESHOLD:k,PERF_SCALE_UP_THRESHOLD:W,BALANCE_BITRATE_FACTOR:U,BALANCE_FRAMERATE_FACTOR:V,BALANCE_RESOLUTION_FACTOR:q,MOTION_RESOLUTION_FACTOR:Y,MOTION_BITRATE_FACTOR:ce,DETAIL_FRAMERATE_FACTOR:_e,DETAIL_BITRATE_FACTOR:Ee}=CL,me=Math.min(n.frameRate,m),ke=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(A,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(k,1)*me),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:i,bitrateMin:u}}];for(let Ye=1;Ye<=_;Ye++){const ut={bwe_up:Math.round(Math.pow(w,Ye)*i),bwe_down:Math.round(Math.pow(A,Ye+1)*i),fps_up:Math.round(Math.pow(W,Ye)*me),fps_down:Math.round(Math.pow(k,Ye+1)*me)},pt={scaleResolutionDownBy:c/Math.pow(q,Ye),frameRate:Math.max(Math.round(Math.pow(V,Ye)*o),h),bitrateMax:Math.max(Math.round(Math.pow(U,Ye)*i),S),bitrateMin:Math.max(Math.round(Math.pow(U,Ye)*u),y)},yn={scaleResolutionDownBy:c/Math.pow(Y,Ye),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(ce,Ye)*i),S),bitrateMin:Math.max(Math.round(Math.pow(ce,Ye)*u),y)},vn={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(_e,Ye)*o),h),bitrateMax:Math.max(Math.round(Math.pow(Ee,Ye)*i),S),bitrateMin:Math.max(Math.round(Math.pow(Ee,Ye)*u),y)};ke.push({scale:Ye,threshold:ut,balanced:pt,motion:yn,detail:vn})}return ke}function Afe(e,n,i,o,c,u){const h=rP.get(e)||{overUse:0,underUse:0,adaptationList:n9(c)},{adaptationList:m}=h;rP.set(e,h);const{OVERUSE_TIMES_THRESHOLD:_,UNDERUSE_TIMES_THRESHOLD:y}=CL,{scale:S}=o;let w,A;return typeof n=="number"&&n>0&&function(k,W,U,V){if(W>=U.length)return!1;let{threshold:{fps_down:q}}=U[W];return re("FORCE_AG_HIGH_FRAMERATE")&&V==="maintain-framerate"&&(q=U[0].threshold.fps_down),k<q}(n,S,m,u)&&(h.overUse++,A=rb.CPU,h.overUse>_)||typeof i=="number"&&i>0&&function(k,W,U){if(W>=U.length)return!1;const{threshold:{bwe_down:V}}=U[W];return k<V}(i,S,m)&&(h.overUse++,A=rb.BANDWIDTH,h.overUse>_)?(h.overUse=0,h.underUse=0,w=e9(o,m,u,Bv.DOWN),[w,A]):(typeof n=="number"&&n>0&&typeof i=="number"&&i>0&&function(k,W,U,V){if(W===0)return;let{threshold:{fps_up:q}}=U[W];return re("FORCE_AG_HIGH_FRAMERATE")&&V==="maintain-framerate"&&(q=U[1].threshold.fps_up),k>q}(n,S,m,u)&&function(k,W,U){if(W===0)return;const{threshold:{bwe_up:V}}=U[W];return k>V}(i,S,m)&&(h.underUse++,h.underUse>y&&(h.overUse=0,h.underUse=0,w=e9(o,m,u,Bv.UP),w.scale===0&&(A=rb.NONE))),[w,A])}function r9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Tx(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?r9(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function Pfe(e){var n;return!!re("ENABLE_AG_ADAPTATION")&&!!(e instanceof zL||ot(n=e._hints).call(n,ar.CUSTOM_TRACK))&&(!!re("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(i){const o=Rn();if(o.os!==Ni.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return Number(c[0])>=i}(14)&&Z6(17,4)||Q6(14)&&eW(17,4,!0)))}const iP=new Map;function sP(e,n){const i=iP.get(e);if(i){const{timer:o}=i;window.clearTimeout(o),iP.delete(e)}n.qualityLimitationReason=rb.NONE,t9(e)}function Ofe(e,n){var i;let o;switch(n){case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoTrack:o=ot(i=e._hints).call(i,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:o=zn.Low}return o}function bx(e){const n=kn();if(e.some(i=>i._bypassWebAudio))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!n.webAudioMediaStreamDest)throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function wx(e,n){bx(e);const i=new Ti;return e.forEach(o=>i.addAudioTrack(o)),i}const kfe=!kn().supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Mp();function oP(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;return kfe?(i={spec:n,store:e},Gp("PlanBConnection").create(i)):new fh(n,e)}function Rx(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function i9(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(eb(e.turnServer.servers))return!1;if(re("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(n=>n.forceturn))return!0}return!1}catch{return!1}}var bn;function s9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function fd(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?s9(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let fh=(bn=class Q_ extends iG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var n,i;return(n=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&n!==void 0?n:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(n=>n.rtpMap&&n.rtpMap.encodingName.toLowerCase()||"").filter(n=>{var i;return ot(i=Object.keys(RA)).call(i,n)}))]}constructor(n,i){super(n,i),$(this,"id",or(5,"connection-")),$(this,"store",void 0),$(this,"peerConnection",void 0),$(this,"forceTurn",!1),$(this,"remoteSDP",void 0),$(this,"initialOffer",void 0),$(this,"transportEventReceiver",void 0),$(this,"statsFilter",void 0),$(this,"extension",{useXR:re("USE_XR")}),$(this,"localCapabilities",void 0),$(this,"remoteCodecs",void 0),$(this,"localCandidateCount",0),$(this,"allCandidatesReceived",!1),$(this,"isPreallocation",!1),$(this,"preSSRCMap",new Map),$(this,"dataStreamChannelMap",new Map),$(this,"establishPromise",void 0),$(this,"recoveredDataChannelIds",[]),$(this,"currentDataChannelId",1),$(this,"supportAV1RtpSpec",!1),$(this,"mutex",void 0),$(this,"qualityLimitationReason",rb.NONE),$(this,"isFirstConnected",!1),this.store=i,this.forceTurn=i9(n),this.mutex=new Cs("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(Q_.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=bL(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Nr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(n){const i=this.preSSRCMap.get(n);if(i!==void 0){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);if(o)return{transceiver:o,track:o.receiver.track,id:i}}}async updateRemoteRTPCapabilities(n,i){if(this.remoteCodecs=i,!this.remoteSDP)return void D.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(n,i,this.store.codec)){const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else D.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Rm(o.sdp),u=await wG({filterRTX:!re("USE_PUB_RTX")&&!re("USE_SUB_RTX"),filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterVideoCodec:re("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=QA(u),this.initialOffer=o,re("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const _=new RTCPeerConnection;_.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:bA.L1T3}]});const y=await _.createOffer();if(!y.sdp)return void _.close();const S=ya(y.sdp).mediaDescriptions[0];if(!S)return;const w=S.attributes.extmaps.find(A=>A.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return _.close(),w}catch{return}}();var n;m&&(this.supportAV1RtpSpec=!0,(n=u.send)===null||n===void 0||n.videoExtensions.push(m))}let h;return o.sdp&&AG(o.sdp)&&(h=xr(u),(i=h).send&&(Mv(mt.VIDEO,i.send.videoExtensions),Mv(mt.AUDIO,i.send.audioExtensions)),i.recv&&(Mv(mt.VIDEO,i.recv.videoExtensions),Mv(mt.AUDIO,i.recv.audioExtensions)),i.sendrecv&&(Mv(mt.VIDEO,i.sendrecv.videoExtensions),Mv(mt.AUDIO,i.sendrecv.audioExtensions))),fd(fd({},c),{},{rtpCapabilities:h||u,offerSDP:o.sdp})}catch(o){throw new Le(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}var i}async connect(n){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&AG(this.initialOffer.sdp)&&(i=n.rtpCapabilities,o=this.localCapabilities,i.send&&(YA(mt.VIDEO,i.send.videoExtensions,o.send.videoExtensions),YA(mt.AUDIO,i.send.audioExtensions,o.send.audioExtensions)),i.recv&&(YA(mt.VIDEO,i.recv.videoExtensions,o.recv.videoExtensions),YA(mt.AUDIO,i.recv.audioExtensions,o.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return xr(this._localCapabilities)}get rtpCapabilities(){return xr(this._rtpCapabilities)}get candidates(){return xr(this._candidates)}get iceParameters(){return xr(this._iceParameters)}get dtlsParameters(){return xr(this._dtlsParameters)}constructor(y){let S=arguments.length>1&&arguments[1]!==void 0&&arguments[1];$(this,"sessionDesc",void 0),$(this,"_localCapabilities",void 0),$(this,"_rtpCapabilities",void 0),$(this,"_candidates",void 0),$(this,"_originCandidates",void 0),$(this,"_iceParameters",void 0),$(this,"_isUseExtmapAllowMixed",void 0),$(this,"_dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname",void 0),$(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=S,y=xr(y);const{iceParameters:w,dtlsParameters:A,candidates:k,rtpCapabilities:W,setup:U,localCapabilities:V,cname:q}=y;this._rtpCapabilities=W,this._candidates=k,this._originCandidates=xr(k),this._iceParameters=w,this._dtlsParameters=A,this._localCapabilities=V,this.setup=U,this.cname=q,this.sessionDesc=this.updateRemoteRTPCapabilities(W),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(y){const S=this.candidates,w=this.dtlsParameters,A=this.iceParameters,k=this.rtpCapabilities.send;let W=this.sessionDesc.mediaDescriptions.length-1;for(let U=1;U<y;U++){const V=2*U+2e4,q=2*U+QG,{ssrcs:Y,ssrcGroups:ce}=O_([{ssrcId:V}],this.cname),{ssrcs:_e,ssrcGroups:Ee}=O_([{ssrcId:q,rtx:re("USE_SUB_RTX")?q+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:yb,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.videoCodecs.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:A.iceUfrag,icePwd:A.icePwd,unrecognized:[],candidates:S,extmaps:k.videoExtensions,fingerprints:w.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_e,ssrcGroups:Ee,rtcpFeedbackWildcards:[],payloads:k.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++W)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:yb,protos:["UDP","TLS","RTP","SAVPF"],fmts:k.audioCodecs.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:A.iceUfrag,icePwd:A.icePwd,unrecognized:[],candidates:S,extmaps:k.audioExtensions,fingerprints:w.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Y,ssrcGroups:ce,rtcpFeedbackWildcards:[],payloads:k.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++W)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return vm(this.sessionDesc)}send(y,S,w,A){const{ssrcs:k,ssrcGroups:W}=O_(S,this.cname,re("SYNC_GROUP")?w:void 0),U=this.findPreloadMediaDesc(k);if(U){if(Nr()&&this.firefoxSsrcMidMap.set(k[0].ssrcId,U.attributes.mid),A&&(A.twcc||A.remb)){const V=this.sessionDesc.mediaDescriptions.indexOf(U);return this.sessionDesc.mediaDescriptions[V]=this.mungSendMediaDesc(U,A),{mid:U.attributes.mid,needExchangeSDP:!0}}return{mid:U.attributes.mid,needExchangeSDP:!1}}{const V=this.findAvailableMediaIndex(y,k);let q;return V===-1||V===1&&(gs()||function(){const Y=Rn();return!(Y.name!==Mn.CHROME||!Y.osVersion)&&Number(Y.version)<=90}()||re("ENABLE_ENCODED_TRANSFORM")&&xp())||V===0&&re("USE_SUB_RTX")||tW()?(q=this.createOrRecycleSendMedia(y,k,W,"sendonly",A),this.updateBundleMids()):(q=xr(this.sessionDesc.mediaDescriptions[V]),q.attributes.direction="sendonly",q.attributes.ssrcs=k,q.attributes.ssrcGroups=W,this.sessionDesc.mediaDescriptions[V]=this.mungSendMediaDesc(q,A)),Nr()&&this.firefoxSsrcMidMap.set(k[0].ssrcId,q.attributes.mid),{mid:q.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:y,needExchangeSDP:S}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:y.attributes.mid,needExchangeSDP:S}}batchSend(y){const S=y.map(k=>{let{kind:W,ssrcMsg:U,mslabel:V}=k;return this.send(W,U,V)}),w=[];let A=!1;return S.forEach(k=>{let{mid:W,needExchangeSDP:U}=k;U&&(A=!0),w.push(W)}),{mids:w,needExchangeSDP:A}}stopSending(y){const S=this.sessionDesc.mediaDescriptions.filter(w=>w.attributes.mid&&y.indexOf(w.attributes.mid)!==-1);if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");S.forEach(w=>{w.attributes.mid==="0"||Nr()||tW()?w.attributes.ssrcs=[]:(w.attributes.ssrcs=[],w.attributes.direction="inactive",w.media.port="0")}),this.updateBundleMids()}mute(y){const S=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===y);if(!S)throw new Error("mediaDescription not found with ".concat(y," in remote SDP when calling RemoteSDP.mute."));S.attributes.direction="inactive"}unmute(y){const S=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===y);if(!S)throw new Error("mediaDescription not found with ".concat(y," in remote SDP when calling RemoteSDP.unmute."));S.attributes.direction="sendonly"}muteRemote(y){const S=this.sessionDesc.mediaDescriptions.filter(w=>ot(y).call(y,w.attributes.mid||""));if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(w=>{w.attributes.direction="inactive"})}unmuteRemote(y){const S=this.sessionDesc.mediaDescriptions.filter(w=>ot(y).call(y,w.attributes.mid||""));if(S.length!==y.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(w=>{w.attributes.direction="recvonly"})}receive(y,S,w,A){y.forEach((k,W)=>{this.createOrRecycleRecvMedia(k,[],"recvonly",S,w,A[W])}),this.updateBundleMids()}stopReceiving(y){const S=this.sessionDesc.mediaDescriptions.filter(w=>y.indexOf(w.attributes.mid)!==-1);if(S.length!==y.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");S.forEach(w=>{w.media.port="0",w.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(y){const S=this.sessionDesc||ya((w=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(w?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var w;this._rtpCapabilities=y;const A=this.rtpCapabilities.send,k=this.localCapabilities.send;for(const W of S.mediaDescriptions){if(W.attributes.iceUfrag=this._iceParameters.iceUfrag,W.attributes.icePwd=this._iceParameters.icePwd,W.attributes.fingerprints=this._dtlsParameters.fingerprints,W.attributes.candidates=this._candidates,W.attributes.setup=this.setup,W.media.mediaType==="application"&&(W.attributes.sctpPort="5000"),W.media.mediaType==="video"){if(A.videoCodecs.length===0){const U=k.videoCodecs.filter(V=>{var q,Y;return(q=V.rtpMap)===null||q===void 0?void 0:ot(Y=q.encodingName.toLowerCase()).call(Y,"vp8")})||[k.videoCodecs[0]];W.media.fmts=U.map(V=>V.payloadType.toString(10)),W.attributes.payloads=U,W.attributes.extmaps=[]}else if(W.media.fmts=A.videoCodecs.map(U=>U.payloadType.toString(10)),W.attributes.payloads=A.videoCodecs,W.attributes.extmaps=A.videoExtensions,re("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:U,ssrcGroups:V}=O_([{ssrcId:QG,rtx:re("USE_SUB_RTX")?40001:void 0}],this.cname);W.attributes.ssrcs=U,W.attributes.ssrcGroups=V}}if(W.media.mediaType==="audio"){if(A.audioCodecs.length===0){const U=k.audioCodecs.filter(V=>{var q,Y;return(q=V.rtpMap)===null||q===void 0?void 0:ot(Y=q.encodingName.toLowerCase()).call(Y,"opus")})||[k.audioCodecs[0]];W.media.fmts=U.map(V=>V.payloadType.toString(10)),W.attributes.payloads=U,W.attributes.extmaps=[]}else if(W.media.fmts=A.audioCodecs.map(U=>U.payloadType.toString(10)),W.attributes.payloads=A.audioCodecs,W.attributes.extmaps=A.audioExtensions,Vv(W),re("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:U,ssrcGroups:V}=O_([{ssrcId:2e4}],this.cname);W.attributes.ssrcs=U,W.attributes.ssrcGroups=V}}}return this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(y){const S=this._originCandidates.filter(A=>A.transport==="udp"),w=[];if(S.forEach(A=>{w.push(JG(JG({},A),{},{foundation:"tcpcandidate",priority:Number(A.priority)-1+"",transport:"tcp",port:Number(A.port)+90+""}))}),S.length!==0){switch(y){case As.TCP_RELAY:this._candidates=w;break;case As.UDP_TCP_RELAY:case As.RELAY:this._candidates=[...S,...w];break;default:this._candidates=S}for(const A of this.sessionDesc.mediaDescriptions)A.attributes.candidates=this.candidates}}restartICE(y){y=xr(y),this._iceParameters=y,this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.iceUfrag=y.iceUfrag,S.attributes.icePwd=y.icePwd})}predictReceivingMids(y){const S=[];for(let w=0;w<y;w++)S.push((this.currentMidIndex+w+1).toString(10));return S}findAvailableMediaIndex(y,S){return this.sessionDesc.mediaDescriptions.findIndex(w=>{const A=w.media.mediaType===y&&w.media.port!=="0"&&(w.attributes.direction==="sendonly"||w.attributes.direction==="sendrecv")&&w.attributes.ssrcs.length===0;if(Nr()){if(A){const k=this.firefoxSsrcMidMap.get(S[0].ssrcId);return!(k||w.attributes.mid!=="0"&&w.attributes.mid!=="1")||!(!k||k!==w.attributes.mid)}return!1}return A})}createOrRecycleDataChannel(){for(const w of this.sessionDesc.mediaDescriptions)if(w.media.mediaType==="application")return{mediaDesc:w,needExchangeSDP:!1};this.currentMidIndex+=1;const y="".concat(this.currentMidIndex),S={media:{mediaType:"application",port:yb,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(y),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(S),{mediaDesc:S,needExchangeSDP:!0}}createOrRecycleRecvMedia(y,S,w,A,k,W){const U=y._mediaStreamTrack.kind,V=this.rtpCapabilities.recv,q=fb(U,V,this.localCapabilities.send,U===mt.VIDEO?A:k),Y=U===mt.VIDEO?V.videoExtensions:V.audioExtensions;this.currentMidIndex+=1;const ce="".concat(this.currentMidIndex);let _e={media:{mediaType:U,port:yb,protos:["UDP","TLS","RTP","SAVPF"],fmts:q.map(me=>me.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:q,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:w,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(ce)}};_e=this.mungRecvMediaDsec(_e,y,W);const Ee=this.findFirstClosedMedia(U);if(Ee){const me=this.sessionDesc.mediaDescriptions.indexOf(Ee);this.sessionDesc.mediaDescriptions[me]=_e}else this.sessionDesc.mediaDescriptions.push(_e);return _e}updateRemoteCodec(y,S,w){const A=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(_e=>_e.rtpMap&&_e.rtpMap.encodingName.toLowerCase()||"").filter(_e=>{var Ee;return ot(Ee=Object.keys(RA)).call(Ee,_e)}))],k=new Set(S);if(A.every(_e=>k.has(_e)))return D.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(S)),!1;const W=this._rtpCapabilities.recv.videoCodecs.filter(_e=>S.some(Ee=>{var me;return ot(me=_e.rtpMap&&_e.rtpMap.encodingName.toLowerCase()||"").call(me,Ee)}));if(W.length===0)return D.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(A," codecs: ").concat(S)),!1;const U=[...new Set(W.map(_e=>_e.rtpMap&&_e.rtpMap.encodingName.toLowerCase()||""))];let V;if(D.debug("updateRemoteCodec, from ".concat(A," to ").concat(U)),y.length===0)V=this.sessionDesc.mediaDescriptions.filter(_e=>_e.media.mediaType==="video"&&_e.attributes.direction==="recvonly");else if(V=this.sessionDesc.mediaDescriptions.filter(_e=>_e.attributes.mid&&ot(y).call(y,_e.attributes.mid)&&_e.attributes.direction==="recvonly"),V.length!==y.length)return D.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(y,", codecs: ").concat(S)),!1;if(re("USE_PUB_RTX")||re("USE_SUB_RTX")){const _e=dx(W,this.rtpCapabilities.recv.videoCodecs);W.push(..._e)}this._rtpCapabilities.recv.videoCodecs=W;const q=this.localCapabilities.send,Y=this.rtpCapabilities.recv,ce=fb(mt.VIDEO,Y,q,w);return V.forEach(_e=>{const Ee=ce.map(me=>me.payloadType.toString(10));D.debug("updateRemoteCodec mid: ".concat(_e.attributes.mid,", from"),_e.attributes.payloads,"to",ce),_e.attributes.payloads=ce,_e.media.fmts=Ee}),!0}createOrRecycleSendMedia(y,S,w,A,k){const W=this.rtpCapabilities.send,U=y===mt.VIDEO?W.videoCodecs:W.audioCodecs,V=y===mt.VIDEO?W.videoExtensions:W.audioExtensions;this.currentMidIndex+=1;const q="".concat(this.currentMidIndex);let Y={media:{mediaType:y,port:yb,protos:["UDP","TLS","RTP","SAVPF"],fmts:U.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:V,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:w,rtcpFeedbackWildcards:[],payloads:U,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:A,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(q)}};Y=this.mungSendMediaDesc(Y,k);const ce=this.findFirstClosedMedia(y);if(ce){const _e=this.sessionDesc.mediaDescriptions.indexOf(ce);this.sessionDesc.mediaDescriptions[_e]=Y}else this.sessionDesc.mediaDescriptions.push(Y);return Y}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(y=>y.media.port!=="0").map(y=>y.attributes.mid)}mungRecvMediaDsec(y,S,w){const A=xr(y);return lx(A),Uv(A,S),ux(A,S),TG(A),JA(A,w,this.localCapabilities.send),A}mungSendMediaDesc(y,S){const w=xr(y);return JA(w,S,this.localCapabilities.recv),Vv(w),w}updateRecvMedia(y,S){const w=this.sessionDesc.mediaDescriptions.findIndex(A=>A.attributes.mid===y);if(w!==-1){const A=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[w],S);this.sessionDesc.mediaDescriptions[w]=A}}bumpMid(y){this.currentMidIndex+=y}findFirstClosedMedia(y){return this.sessionDesc.mediaDescriptions.find(S=>Nr()?S.media.port==="0"&&S.media.mediaType===y:S.media.port==="0")}findPreloadMediaDesc(y){return this.sessionDesc.mediaDescriptions.find(S=>{var w;return((w=S.attributes)===null||w===void 0||(w=w.ssrcs[0])===null||w===void 0?void 0:w.ssrcId)===y[0].ssrcId})}getSSRC(y){var S;return(S=this.sessionDesc.mediaDescriptions.find(w=>w.attributes.mid===y))===null||S===void 0?void 0:S.attributes.ssrcs}}(fd(fd({},n),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),n.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=CG(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),re("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(re("PRELOAD_MEDIA_COUNT"));const y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});const S=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(S)}const{preSSRCs:_}=n;if(Array.isArray(_)&&_.length>0){const{mids:y}=this.remoteSDP.batchSend(_.map(S=>({kind:S.kind,ssrcMsg:[{ssrcId:S.ssrcId,rtx:S.rtx}],mslabel:S.mslabel})));y.forEach((S,w)=>{this.preSSRCMap.set(_[w].ssrcId,S)}),await mb(this.peerConnection,this.remoteSDP,this.extension),D.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var i,o}async updateRemoteConnect(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:i}=n;this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:o}=n;if(Array.isArray(o)&&o.length>0){const{mids:c}=this.remoteSDP.batchSend(o.map(u=>Object.assign({},{kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));c.forEach((u,h)=>{this.preSSRCMap.set(o[h].ssrcId,u)})}await mb(this.peerConnection,this.remoteSDP,this.extension),D.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(n,i,o){var c=this;return hl(function*(){const u=yield wn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=qA();n.forEach(V=>{const q=c.peerConnection.addTransceiver(V._mediaStreamTrack,fd({direction:"sendonly"},V.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(q),V._updateRtpTransceiver(q)}),Nr()&&re("SIMULCAST")===!0&&(yield wn(c.applySimulcastForFirefox(h,n)));const _=yield wn(c.peerConnection.createOffer()),y=c.remoteSDP.predictReceivingMids(n.length),S=c.mungSendOfferSDP(_.sdp,n,y),w=ya(S),A=y.map(V=>{const q=w.mediaDescriptions.find(Y=>Y.attributes.mid===V);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return yG(q,re("USE_PUB_RTX"))});let k;try{k=yield A}catch(V){k=[],c.remoteSDP.receive(n,i,o,k);const q=c.remoteSDP.toString();throw yield wn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield wn(c.peerConnection.setRemoteDescription({type:"answer",sdp:q})),yield wn(c.stopSending(y,!0)),V}c.remoteSDP.receive(n,i,o,k);const W=c.remoteSDP.toString(),U=c.logSDPExchange(S,"offer","local","send");return yield wn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield wn(c.applySimulcastEncodings(h,n)),yield wn(c.applySendEncodings(h,n)),U==null||U(W),yield wn(c.peerConnection.setRemoteDescription({type:"answer",sdp:W})),h.map((V,q)=>{const Y=y[q];return{localSSRC:A[q],id:Y,transceiver:V}})}catch(h){throw h instanceof Le?h:new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(n);if(o&&o.readyState==="open")D.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:re("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(n,o)}i.forEach(u=>{u._updateOriginDataChannel(o)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),D.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else D.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof Le?o:new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(n){try{const i=this.dataStreamChannelMap.get(n);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(n)}catch(i){throw i instanceof Le?i:new Le(X.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(n,i){const o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>n.indexOf(_.mid)!==-1);if(c.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(_=>{var y;sP(this.id+_.mid,this),_.direction="inactive",(y=_.stop)===null||y===void 0||y.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(n);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(n,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(n,i,o,c);h&&(await mb(this.peerConnection,this.remoteSDP,this.extension),D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:o}=this.remoteSDP.batchSend(n);return o&&(await mb(this.peerConnection,this.remoteSDP,this.extension),D.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");n.forEach(u=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[m,_]=h;if(_===u)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(n);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(n," before remote SDP created."));this.remoteSDP.mute(n);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(n," before remote SDP created."));this.remoteSDP.unmute(n);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(n);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(h,m)=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(n,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(n){var i=this;return hl(function*(){const o=yield wn(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=kn().supportPCSetConfiguration,u=re("FORCE_TURN_TCP")||i.forceTurn;if(n===As.RELAY&&!c)return;if(c&&!u){const w=n===As.RELAY?"relay":"all",A=i.peerConnection.getConfiguration();A.iceTransportPolicy!==w&&(D.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(A.iceTransportPolicy,"] to [").concat(w,"]")),A.iceTransportPolicy=w,i.peerConnection.setConfiguration(A))}i.remoteSDP.updateCandidates(n);const h=yield wn(i.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Rm(h.sdp),{remoteIceParameters:_}=yield m.iceParameters;i.remoteSDP.restartICE(_);const y=i.remoteSDP.toString(),S=i.logSDPExchange(h.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield wn(i.peerConnection.setLocalDescription(h)),S==null||S(y),yield wn(i.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(c){D.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const n=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(As.TCP_RELAY),await mb(this.peerConnection,this.remoteSDP,this.extension)}catch(i){D.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{n()}}close(){var n;this.peerConnection.getTransceivers().forEach(i=>{sP(this.id+i.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return fd(fd({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}async updateEncoderConfig(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i],[n]);this.remoteSDP.updateRecvMedia(n,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(n,i){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===n);o.length===1&&(this.isVP8Simulcast(i)?Nr()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}async replaceTrack(n,i){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);o&&await o.sender.replaceTrack(n._mediaStreamTrack)}async getSelectedCandidatePair(){const n=this.peerConnection.getReceivers();if(n.length>0&&n[0].transport&&n[0].transport.iceTransport&&n[0].transport.iceTransport.getSelectedCandidatePair&&n[0].transport.iceTransport.getSelectedCandidatePair()){const i=n[0].transport.iceTransport,{local:o,remote:c}=i.getSelectedCandidatePair();return{local:fd(fd({},ch),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:fd(fd({},ch),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=n=>{if(n&&(n.errorCode||n.errorText)){var i;const o="code: ".concat(n.errorCode,", message: ").concat(n.errorText),c=n.port?"local: ".concat(n.port):"";D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(n.url||"",", host_candidate:").concat(c)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,o)}},this.peerConnection.onicegatheringstatechange=n=>{n&&n.target&&"iceGatheringState"in n.target&&D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(n.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const i={iceServers:[]};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&(eb(n.turnServer.servers)?i.iceServers=n.turnServer.servers:re("NEW_TURN_MODE")&&i.iceServers?(re("USE_TURN_SERVER_OF_GATEWAY")?n.turnServer.serversFromGateway&&i.iceServers.push(...Q_.newTurnServerConfigToIceServers(n.turnServer.serversFromGateway)):i.iceServers.push(...Q_.newTurnServerConfigToIceServers(n.turnServer.servers)),re("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):n.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...Q_.turnServerConfigToIceServers(n.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...Q_.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),re("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),re("ENABLE_ENCODED_TRANSFORM")&&kn().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(bm(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!re("FORCE_TURN_TCP")&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(n){const i=[];return n.forEach(o=>{const c=re("NEW_TURN_MODE");c===1?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(bm(o.turnServerURL),":443?transport=tcp")}):c===4&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(bm(o.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(n){const i=n.transport;if(i){this.transportEventReceiver=n,i.onstatechange=()=>{var c;i!=null&&i.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,i.state))},i.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const o=i.iceTransport;o&&(o.onstatechange=()=>{const c=i==null?void 0:i.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:c,remote:u}=o.getSelectedCandidatePair();D.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(n,i){var o,c;if(i||(i=this.peerConnection.getSenders().find(V=>V.track===n._mediaStreamTrack)),!i)return D.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(n))return D.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!kn().supportSetRtpSenderParameters)return D.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(n._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=function(U,V){return U.getTransceivers().find(q=>q.sender.track===V||q.receiver.track===V)}(this.peerConnection,n._mediaStreamTrack),_=gpe(n);if(Pfe(n)&&m&&i&&_&&this.getLocalVideoStats&&ot(o=["vp8","vp9"]).call(o,this.store.codec)){var y;const U=u.degradationPreference||(ot(y=n._hints).call(y,ar.CUSTOM_TRACK)?re("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(V,q,Y,ce,_e,Ee){if(sP(V,Y),_e(q),ce!=="balanced"&&ce!=="maintain-framerate"&&ce!=="maintain-resolution")return;let me=-1;t9(V,q);const ke=window.setInterval(()=>{const ut=iP.get(V);if(!re("ENABLE_AG_ADAPTATION")||!ut)return sP(V,Y),void _e(q);const pt=Ee();if(pt.sendPackets>0&&pt.OutgoingAvailableBandwidth>0){if(me===-1)return void(me=Date.now());if(Date.now()-me<1e3)return;const yn=pt.sendFrameRate,vn=pt.OutgoingAvailableBandwidth,[cr,Zr]=Afe(V,yn,vn,ut.adaptationConfig,q,ce);Zr&&(Y.qualityLimitationReason=Zr),cr&&ut.adaptationConfig.scale!==cr.scale&&(D.debug("[".concat(V,"] applyAdaptation: ").concat(Y.qualityLimitationReason,`
           sendFps `).concat(yn,", bwe ").concat(vn,", switch from ").concat(ut.adaptationConfig.scale," to ").concat(cr.scale," ")),ut.adaptationConfig=Tx(Tx({},ut.adaptationConfig),cr),_e(cr))}},re("CHECK_LOCAL_STATS_INTERVAL")),Ye=Tx({},q);iP.set(V,{timer:ke,adaptationConfig:Ye,originConfig:q,adaptationFunc:_e}),D.debug("[".concat(V,"] start adaptation, originConfig: ").concat(JSON.stringify(q),", degradationPreference: ").concat(ce))})(this.id+m.mid,_,this,U,V=>{i&&this.updateAdaptation(i,V)},this.getLocalVideoStats.bind(this))}if(n._encoderConfig){var S;const{bitrateMax:U,frameRate:V,scaleResolutionDownBy:q}=n._encoderConfig;U&&(h.maxBitrate=1e3*U),(ot(S=n._hints).call(S,ar.LOW_STREAM)||n.isUseScaleResolutionDownBy)&&(V&&(h.maxFramerate=qa(V)),q&&q>=1&&(h.scaleResolutionDownBy=q))}const{maxFramerate:w}=re("ENCODER_CONFIG_LIMIT");if(w&&typeof w=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,w):w),re("DSCP_TYPE")&&Mp()){var A;const U=re("DSCP_TYPE");ot(A=["very-low","low","medium","high"]).call(A,U)&&(h.networkPriority=U)}const k=i.getParameters(),W=(c=k.encodings)===null||c===void 0?void 0:c[0];Nr()&&!W&&(u.encodings=[h]),W&&Object.assign(W,h),Object.assign(k,u),D.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(k.encodings))),await i.setParameters(k),await async function(U,V,q){try{var Y;if(!kn().supportSetRtpSenderParameters||!function(ke){return ke==="vp9"||ke==="av1"}(U)||!re("ENABLE_SVC"))return;const ce={},_e={},Ee=V.getParameters(),me=(Y=Ee.encodings)===null||Y===void 0?void 0:Y[0];_e.scalabilityMode=qA(q),me&&Object.assign(me,_e),Object.assign(Ee,ce),await V.setParameters(Ee),D.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(Ee.encodings)))}catch(ce){D.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",ce)}}(this.store.codec,i,re("SVC_MODE"))}async updateAdaptation(n,i){var o,c;if(!n)return D.debug("[updateAdaptation] no rtpSender found");if(!kn().supportSetRtpSenderParameters)return D.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:_}=i;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=qa(m)),_&&_>=1&&ot(o=["vp8","vp9"]).call(o,this.store.codec)&&(u.scaleResolutionDownBy=_);const y=n.getParameters(),S=(c=y.encodings)===null||c===void 0?void 0:c[0];S&&Object.assign(S,u),Object.assign(y,{});try{await n.setParameters(y),D.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(y.encodings)))}catch(w){!("transport"in n)||n.transport&&n.transport.state==="connected"?this.peerConnectionState!=="connected"?D.debug("[updateAdaptation] peerConnection not connected}"):D.debug("[updateAdaptation] updateRtpSenderEncodings failed",w):D.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(n,i){try{if(!kn().supportSetRtpSenderParameters||n.length!==i.length)return;for(let o=0;o<n.length;o++){const c=n[o],u=i[o];u instanceof mr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{D.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(n,i,o){const c=ya(n);return i.forEach((u,h)=>{const m=o[h],_=c.mediaDescriptions.find(y=>y.attributes.mid===m);_&&(Uv(_,u),bG(_,u,this.store.codec))}),vm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,n,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(n,i){if(n.length===i.length)for(let _=0;_<n.length;_++){var o,c,u,h,m;const y=n[_],S=i[_];if(S instanceof mr&&!ot(o=S._hints).call(o,ar.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},A={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:A.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:A.high}];const k=y.sender.getParameters();await y.sender.setParameters(Object.assign(k,w))}}}async applySimulcastEncodings(n,i){if(!Nr()&&n.length===i.length)for(let o=0;o<n.length;o++){const c=i[o];if(c instanceof mr&&this.isVP8Simulcast(c)){const u=n[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(n){var i,o,c,u,h;return!!(n instanceof mr&&re("SIMULCAST")&&this.store.codec==="vp8"&&!ot(i=n._hints).call(i,ar.LOW_STREAM)&&(o=n._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=n._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=n._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=n._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,i,o,c){if(re("SDP_LOGGING"))return D.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(c,`
`),n),i==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(n){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(n);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(n){if(kn().supportPCSetConfiguration){const i=Q_.resolvePCConfiguration(n);this.peerConnection.setConfiguration(i)}}},Et(bn.prototype,"updateRemoteRTPCapabilities",[Go],Object.getOwnPropertyDescriptor(bn.prototype,"updateRemoteRTPCapabilities"),bn.prototype),Et(bn.prototype,"connect",[Go],Object.getOwnPropertyDescriptor(bn.prototype,"connect"),bn.prototype),Et(bn.prototype,"updateRemoteConnect",[Go],Object.getOwnPropertyDescriptor(bn.prototype,"updateRemoteConnect"),bn.prototype),Et(bn.prototype,"createDataChannels",[Go],Object.getOwnPropertyDescriptor(bn.prototype,"createDataChannels"),bn.prototype),Et(bn.prototype,"receive",[Go],Object.getOwnPropertyDescriptor(bn.prototype,"receive"),bn.prototype),Et(bn.prototype,"batchReceive",[Go],Object.getOwnPropertyDescriptor(bn.prototype,"batchReceive"),bn.prototype),Et(bn.prototype,"stopReceiving",[Go],Object.getOwnPropertyDescriptor(bn.prototype,"stopReceiving"),bn.prototype),Et(bn.prototype,"muteRemote",[Go],Object.getOwnPropertyDescriptor(bn.prototype,"muteRemote"),bn.prototype),Et(bn.prototype,"unmuteRemote",[Go],Object.getOwnPropertyDescriptor(bn.prototype,"unmuteRemote"),bn.prototype),Et(bn.prototype,"muteLocal",[Go],Object.getOwnPropertyDescriptor(bn.prototype,"muteLocal"),bn.prototype),Et(bn.prototype,"unmuteLocal",[Go],Object.getOwnPropertyDescriptor(bn.prototype,"unmuteLocal"),bn.prototype),Et(bn.prototype,"close",[Go],Object.getOwnPropertyDescriptor(bn.prototype,"close"),bn.prototype),Et(bn.prototype,"updateEncoderConfig",[Go],Object.getOwnPropertyDescriptor(bn.prototype,"updateEncoderConfig"),bn.prototype),Et(bn.prototype,"updateSendParameters",[Go],Object.getOwnPropertyDescriptor(bn.prototype,"updateSendParameters"),bn.prototype),Et(bn.prototype,"replaceTrack",[Go],Object.getOwnPropertyDescriptor(bn.prototype,"replaceTrack"),bn.prototype),Et(bn.prototype,"updateAdaptation",[Go],Object.getOwnPropertyDescriptor(bn.prototype,"updateAdaptation"),bn.prototype),Et(bn.prototype,"getRemoteSSRC",[Go],Object.getOwnPropertyDescriptor(bn.prototype,"getRemoteSSRC"),bn.prototype),bn);function Go(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(n));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}function Cx(e,n){let i=document.createElement("video"),o=document.createElement("canvas");i.setAttribute("style","display:none"),o.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),o.width=qa(n.width),o.height=qa(n.height);const c=qa(n.framerate||15);document.body.append(i),document.body.append(o);let u=e._mediaStreamTrack;i.srcObject=new MediaStream([u]),i.play();const h=o.getContext("2d");if(!h)throw new Oe(X.UNEXPECTED_ERROR,"can not get canvas context");const m=kn(),_=o.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];_.canvas||(_.canvas=o),o.startCapture=()=>{if(!i)return o.stopCapture&&o.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){const S=i.videoWidth,w=i.videoHeight/S,A=o.width*w;Math.abs(A-o.height)>=2&&(D.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(A)),o.height=A)}h.drawImage(i,0,0,o.width,o.height),_.requestFrame&&_.requestFrame(),u!==e._mediaStreamTrack&&(u=e._mediaStreamTrack,i.srcObject=new MediaStream([u]))},o.stopCapture=UL(()=>o.startCapture&&o.startCapture(),c);const y=_.stop;return _.stop=()=>{y.call(_),i&&(i.remove(),i.srcObject=null,i=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),D.debug("clean low stream renderer")},_}var aP=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(aP||{}),ci=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e[e.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e[e.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e[e.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e}(ci||{}),N_=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(N_||{}),li=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e[e.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e[e.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e[e.AVG_DECODE=2200]="AVG_DECODE",e[e.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e[e.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e[e.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e[e.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e}(li||{}),D_=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(D_||{}),o9=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(o9||{}),mh=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e[e.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",e}(mh||{}),Ho=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e[e.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",e[e.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",e[e.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",e}(Ho||{}),a9=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(a9||{}),$o=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}($o||{}),cP=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(cP||{});const L_=1e3,x_=6,lP=3,Nfe=Math.max(x_,lP);function Ft(e,n,i){i!=null&&Number.isFinite(i)&&(e[n]=Math.round(Math.max(0,i)))}function c9(e){const n={[$o.CONN_TYPE]:0,[$o.RTT]:e.rtt,[$o.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const i=e.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(n[$o.CONN_TYPE]=1),i==="tcp"&&(n[$o.CONN_TYPE]=3),i==="tls"&&(n[$o.CONN_TYPE]=4);break}case"srflx":n[$o.CONN_TYPE]=2;break;case"unknown":n[$o.CONN_TYPE]=5;break;default:n[$o.CONN_TYPE]=0}return n}function l9(e){let n=0;switch(e){case"none":n=0;break;case"cpu":n=1;break;case"bandwidth":n=2;break;case"other":n=3}return n}class u9 extends Ar{constructor(n){super(),$(this,"store",void 0),$(this,"uploadWRTCStatsTimer",void 0),$(this,"uploadOutboundDenoiserStatsTimer",void 0),$(this,"uploadExtStatsTimer",void 0),$(this,"uploadExtUsageStatsTimer",void 0),$(this,"uploadInboundExtStatsTimer",void 0),$(this,"requestStats",void 0),$(this,"requestTransportStats",void 0),$(this,"requestLocalMedia",void 0),$(this,"requestRemoteMedia",void 0),$(this,"requestAllTracks",void 0),$(this,"requestVideoIsReady",void 0),$(this,"requestUploadStats",void 0),$(this,"requestUpload",void 0),$(this,"uploadOutboundStarted",!1),$(this,"uploadInboundStarted",!1),$(this,"uploadTransportStarted",!1),$(this,"uploadBaseStatsStarted",!1),$(this,"uploadExtensionUsageStarted",!1),$(this,"lastRecvStats",void 0),$(this,"lastSendStats",void 0),$(this,"lastRefRecvStats",void 0),$(this,"lastRefSendStats",void 0),$(this,"lastFullRecvStats",void 0),$(this,"lastFullSendStats",void 0),$(this,"needUploadRenderFreezeTime",!0),this.store=n}uploadWRTCStats(n){if(!this.requestStats||!this.requestUploadStats)return;const i=n%lP==0,o=n%x_==0;let c,u;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),c||u){var h;const m={};if(this.uploadTransportStarted&&c){const y=this.getTransportStats(c,u,i);y&&(m.misc=[y])}if(this.uploadOutboundStarted&&c){const y=this.getOutboundStats(c,o?this.lastFullSendStats:i?this.lastRefSendStats:this.lastSendStats,i,o);y&&(m.outbound=[y])}if(this.uploadInboundStarted&&u){const y=this.getInboundStats(u,o?this.lastFullRecvStats:i?this.lastRefRecvStats:this.lastRecvStats,i,o);y&&(m.inbound=y)}const _=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;_&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[cP.RTC_PEER_CONNECTION_STATE]=TL[_]):m.misc=[{addition:{[cP.RTC_PEER_CONNECTION_STATE]:TL[_]}}]),this.requestUploadStats(m)}this.lastRecvStats=u,this.lastSendStats=c,o&&(this.lastFullRecvStats=u,this.lastFullSendStats=c),i&&(this.lastRefRecvStats=u,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let n=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var i,o;const c=(i=this.requestTransportStats)===null||i===void 0?void 0:i.call(this);return void(c&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[cP.RTC_PEER_CONNECTION_STATE]:TL[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(n),++n===Nfe+1&&(n=1)},L_)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(n,i,o){if(!this.requestStats)return;if(!o)return n.rtt==null?void 0:{addition:{[$o.RTT]:n.rtt,[$o.CONN_TYPE]:void 0,[$o.STATS_UPDATE_INTERVAL]:n.updateInterval||void 0}};const c=c9(n);if(this.store.useP2P){if(i){const u=c9(i);c[$o.CONN_TYPE]+=u[$o.CONN_TYPE]<<3}c[$o.CONN_TYPE]+=110}else c[$o.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(n,i,o,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let h,m,_;return u.forEach(y=>{let[S,{track:w,ssrcs:A}]=y;switch(S){case $e.LocalVideoLowTrack:case $e.LocalVideoTrack:if(S===$e.LocalVideoTrack){const k=function(V,q,Y,ce,_e,Ee){const me=q.videoSend.find(pt=>pt.ssrc===V);if(!me)return;const ke={},{sentFrame:Ye,inputFrame:ut}=me;if(Ee&&(Ft(ke,ci.QP_SUM,me.qpSumPerFrame),ut&&Ye)){const pt=ut.frameRate,yn=Ye.frameRate;ke[ci.FREEZE]=function(vn,cr){let Zr=!0;return Zr=!(vn<=5)&&(vn<=10?cr<3:vn<=20?cr<4:cr<5),Zr}(pt,yn)?1:0}if(_e){switch(Ye&&(Ft(ke,ci.HEIGHT,Ye.height),Ft(ke,ci.WIDTH,Ye.width),Ft(ke,ci.FRAME_RATE,Ye.frameRate)),ke[ci.DISABLED]=ce._originMediaStreamTrack&&!ce._originMediaStreamTrack.enabled||ce._mediaStreamTrack&&!ce._mediaStreamTrack.enabled?1:0,me.adaptionChangeReason){case"none":ke[ci.ADAPTATION]=0;break;case"cpu":ke[ci.ADAPTATION]=1;break;case"bandwidth":ke[ci.ADAPTATION]=2;break;case"other":ke[ci.ADAPTATION]=3}let pt=0;me.adaptionChangeReason&&(pt+=l9(me.adaptionChangeReason)),q.qualityLimitationReason&&(pt+=l9(q.qualityLimitationReason)<<3),ke[ci.ADAPTATION]=pt,ke[ci.PLAYER_STATUS]=xL[ce._player?ce._player.videoElementStatus:"uninit"],Ft(ke,ci.NACKS,me.nacksCount),Ft(ke,ci.PLIS,me.plisCount),Ft(ke,ci.FIRS,me.firsCount),Ft(ke,ci.AVG_ENCODE,me.avgEncodeMs),Ft(ke,ci.HUGE_FRAME_SENT,me.hugeFramesSent),Ft(ke,ci.BYTES_RETRANSMIT,me.retransmittedBytesSent),Ft(ke,ci.PACKAGES_RETRANSMIT,me.retransmittedPacketsSent),Ft(ke,ci.KEY_FRAMES_ENCODED,me.keyFramesEncoded);const yn=Y&&Y.videoSend.find(vn=>vn.ssrc===V);if(yn){let vn=_e?L_:L_*x_;yn.timestamp&&me.timestamp&&(vn=me.timestamp-yn.timestamp),yn.packets!=null&&me.packets!=null&&Ft(ke,ci.PACKAGE_RATE,1e3*(me.packets-yn.packets)/vn),me.packetsLost!=null&&yn.packetsLost!=null&&Ft(ke,ci.PACKAGE_LOST,me.packetsLost-yn.packetsLost),yn.bytes!=null&&me.bytes!=null&&Ft(ke,ci.BITRATE,8*(me.bytes-yn.bytes)/vn)}}return ke}(A[0].ssrcId,n,i,w,o,c),W=w&&function(V,q,Y,ce){const _e=q.videoSend.find(me=>me.ssrc===V);if(!_e)return null;const Ee={};if(ce){const me=_e.inputFrame,ke=me&&me.height||Y.videoHeight||0,Ye=me&&me.width||Y.videoWidth||0,ut=me&&me.frameRate||0;Ft(Ee,aP.HEIGHT,ke),Ft(Ee,aP.WIDTH,Ye),Ft(Ee,aP.FRAME_RATE,ut)}return Ee}(A[0].ssrcId,n,w,o),U=function(V,q){const Y={};return q&&(Ft(Y,ci.RETRANSMIT,V.bitrate.retransmit),Ft(Y,ci.TARGET_ENCODED,V.bitrate.targetEncoded),Ft(Y,ci.ACTUAL_ENCODED,V.bitrate.actualEncoded),Ft(Y,ci.TRANSMIT,V.bitrate.transmit),Ft(Y,ci.BANDWIDTH,V.sendBandwidth)),Y}(n,o);m=Object.assign({},k,W,U)}else _=function(k,W,U,V){const q=W.videoSend.find(ce=>ce.ssrc===k);if(!q)return;const Y={};if(V){const ce=q.sentFrame;if(ce&&(Ft(Y,N_.HEIGHT,ce.height),Ft(Y,N_.WIDTH,ce.width),Ft(Y,N_.FRAME_RATE,ce.frameRate)),U){const _e=U.videoSend.find(Ee=>Ee.ssrc===k);if(_e){let Ee=L_*x_;_e.timestamp&&q.timestamp&&(Ee=q.timestamp-_e.timestamp),_e.packets!=null&&q.packets!=null&&Ft(Y,N_.PACKAGE_RATE,1e3*(q.packets-_e.packets)/Ee),q.packetsLost!=null&&_e.packetsLost!=null&&Ft(Y,N_.PACKAGE_LOST,q.packetsLost-_e.packetsLost),_e.bytes!=null&&q.bytes!=null&&Ft(Y,N_.BITRATE,8*(q.bytes-_e.bytes)/Ee)}}}return Y}(A[0].ssrcId,n,i,o);break;case $e.LocalAudioTrack:h=w&&function(k,W,U,V,q){const Y=W.audioSend.find(_e=>_e.ssrc===k);if(!Y)return;const ce={};if(q){ce[mh.DISABLED]=V._originMediaStreamTrack&&!V._originMediaStreamTrack.enabled||V._mediaStreamTrack&&!V._mediaStreamTrack.enabled?1:0;const _e=100*V._source.getAccurateVolumeLevel(),Ee=Y.inputLevel;if(Ee!=null){const ke=Math.ceil(50*Math.log10(100*Ee+1));Ft(ce,mh.LEVEL,ke)}Ft(ce,o9.PCM_LEVEL,_e),Ft(ce,mh.AEC_RETURN_LOSS,Y.aecReturnLoss),Ft(ce,mh.AEC_RETURN_LOSS_ENH,Y.aecReturnLossEnhancement),Ft(ce,mh.BYTES_RETRANSMIT,Y.retransmittedBytesSent),Ft(ce,mh.PACKAGES_RETRANSMIT,Y.retransmittedPacketsSent),ce[mh.FREEZE]=0;const me=U&&U.audioSend.find(ke=>ke.ssrc===k);if(me){let ke=L_*x_;me.timestamp&&Y.timestamp&&(ke=Y.timestamp-me.timestamp),me.bytes!=null&&Y.bytes!=null&&Ft(ce,mh.BITRATE,8*(Y.bytes-me.bytes)/ke),me.packets!=null&&Y.packets!=null&&Ft(ce,mh.PACKAGE_RATE,1e3*(Y.packets-me.packets)/ke)}}return ce}(A[0].ssrcId,n,i,w,o)}}),{high:m,low:_,audio:h}}getInboundStats(n,i,o,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(m=>{let[_,y]=m;const S={peer:_.uid};if(y.has(mt.VIDEO)&&_.videoTrack){const w=_._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(_._videoSSRC)||!1,A=_.videoTrack?function(k,W,U,V,q,Y,ce,_e){const Ee=W.videoRecv.find(vn=>vn.ssrc===k);if(!Ee)return;const me={},{receivedFrame:ke,outputFrame:Ye,decodeFrameRate:ut}=Ee,pt=U&&U.videoRecv.find(vn=>vn.ssrc===k);if(Ft(me,D_.FRAME_RATE_DECODE,ut),Ee.framesRateFirefox&&Ft(me,li.FRAME_RATE,Ee.framesRateFirefox),ke&&Ft(me,li.FRAME_RATE,ke.frameRate),Ft(me,li.FRAMES_DROPPED,Ee.framesDroppedCount),Ft(me,li.BYTES_RETRANSMIT,Ee.retransmittedBytesReceived),Ft(me,li.PACKAGES_RETRANSMIT,Ee.retransmittedPacketsReceived),Ft(me,li.PACKAGES_DISCARDED,Ee.packetsDiscarded),Ft(me,li.AVG_DECODE,Ee.avgDecodeMs),Ft(me,li.AVG_PROCESSING_DELAY,Ee.avgProcessingDelayMs),Ft(me,li.AVG_ASSEMBLY_TIME,Ee.avgFramesAssembledFromMultiplePacketsMs),Ft(me,li.AVG_INTER_FRAME_DELAY,Ee.avgInterFrameDelayMs),Ft(me,li.KEY_FRAMES_DECODED,Ee.keyFramesDecoded),pt){const vn=W.timestamp-U.timestamp||L_*(_e?x_:ce?lP:1);Ee.packetsLost!=null&&pt.packetsLost!=null&&Ft(me,li.PACKAGE_LOST,Ee.packetsLost-pt.packetsLost),pt.bytes!=null&&Ee.bytes!=null&&Ft(me,li.BITRATE,8*(Ee.bytes-pt.bytes)/vn),pt.packets!=null&&Ee.packets!=null&&Ft(me,li.PACKAGE_RATE,1e3*(Ee.packets-pt.packets)/vn)}if(_e&&(Ft(me,li.QP_SUM,Ee.qpSumPerFrame),me[li.FREEZE]=q&&Eb.isRemoteVideoFreeze(V,Ee,pt)?1:0),ce){var yn;ke?(Ft(me,li.HEIGHT,ke.height),Ft(me,li.WIDTH,ke.width)):V&&(Ft(me,li.HEIGHT,V._videoHeight||0),Ft(me,li.WIDTH,V._videoWidth||0)),Ye&&Ft(me,D_.FRAME_RATE_OUTPUT,Ye.frameRate);const vn=(yn=V._player)===null||yn===void 0?void 0:yn.rendFrameRate.toFixed(0);if(vn&&Ft(me,D_.FRAME_RATE_RENDER,+vn),Ft(me,li.JITTER_BUFFER,Ee.jitterBufferMs),Ft(me,li.CURRENT_DELAY,Ee.currentDelayMs),Ft(me,li.FIRS,Ee.firsCount),Ft(me,li.NACKS,Ee.nacksCount),Ft(me,li.PLIS,Ee.plisCount),V){me[li.DISABLED]=V._originMediaStreamTrack.enabled&&V._mediaStreamTrack.enabled?0:1;const cr=V._player;if(cr){const{freezeTimeCounterList:Zr,renderFreezeAccTime:Wr,videoElementStatus:qo}=cr;if(Zr&&Zr.length>0&&Ft(me,D_.FREEZE_TIME,Zr.splice(0,1)[0]),Y&&Fp.visibility==="visible"&&qo===Xs.PLAYING&&kn().supportRequestVideoFrameCallback){const je=Math.min(6e3,Wr);cr.renderFreezeAccTime=Math.max(0,Wr-je),Ft(me,D_.FREEZE_TIME_RENDER,je)}if(typeof Ee.totalFreezesDuration=="number"){const je=pt&&pt.totalFreezesDuration?Ee.totalFreezesDuration-pt.totalFreezesDuration:Ee.totalFreezesDuration;Ft(me,D_.FREEZE_DURATION,1e3*je)}}}if(me[li.PLAYER_STATUS]=xL[V._player?V._player.videoElementStatus:"uninit"],pt&&Ee.totalInterFrameDelay!==void 0&&Ee.totalSquaredInterFrameDelay!==void 0&&pt.totalInterFrameDelay!==void 0&&pt.totalSquaredInterFrameDelay!==void 0){const cr=Ee.totalInterFrameDelay-pt.totalInterFrameDelay,Zr=Ee.totalSquaredInterFrameDelay-pt.totalSquaredInterFrameDelay,Wr=Ee.framesDecodeCount-pt.framesDecodeCount,qo=cr/Wr*1e3,je=Math.round(1e3*Math.sqrt((Zr-Math.pow(cr,2)/Wr)/Wr));!isNaN(je)&&qo+je>Math.max(3*qo,qo+150)&&(me[li.I_FRAME_DELAY]=je)}}return me}(_._videoSSRC,n,i,_.videoTrack,w===!0,this.needUploadRenderFreezeTime,o,c):void 0;A&&(S.video=A)}if(y.has(mt.AUDIO)&&_.audioTrack){const w=_.audioTrack?function(A,k,W,U,V,q){const Y=k.audioRecv.find(me=>me.ssrc===A);if(!Y)return;const ce={},_e=W&&W.audioRecv.find(me=>me.ssrc===A);if(Ft(ce,Ho.JITTER,Y.jitterMs),Ft(ce,Ho.BYTES_RETRANSMIT,Y.retransmittedBytesReceived),Ft(ce,Ho.PACKAGES_RETRANSMIT,Y.retransmittedPacketsReceived),Ft(ce,Ho.PACKAGES_DISCARDED,Y.packetsDiscarded),Ft(ce,Ho.AVG_PROCESSING_DELAY,Y.avgProcessingDelayMs),_e){const me=k.timestamp-W.timestamp||L_*(q?x_:V?lP:1);Y.packets!=null&&_e.packets!=null&&Ft(ce,Ho.PACKAGE_RATE,1e3*(Y.packets-_e.packets)/me),V&&_e.bytes!=null&&Y.bytes!=null&&Ft(ce,Ho.BITRATE,8*(Y.bytes-_e.bytes)/me),Y.packetsLost!=null&&_e.packetsLost!=null&&Ft(ce,Ho.PACKAGE_LOST,Y.packetsLost-_e.packetsLost)}if(q){const{receivedFrames:me,droppedFrames:ke}=Y;me!=null&&ke!=null&&(ce[Ho.FREEZE]=(Ee=me)===0||100*ke/Ee>20?1:0)}var Ee;if(V){const me=100*U._source.getAccurateVolumeLevel(),ke=Y.outputLevel;if(ke!=null){const Ye=Math.ceil(50*Math.log10(100*ke+1));Ft(ce,a9.LEVEL,Ye)}if(Ft(ce,Ho.PCM_LEVEL,me),U&&(ce[Ho.DISABLED]=U._originMediaStreamTrack.enabled&&U._mediaStreamTrack.enabled?0:1),Ft(ce,Ho.JITTER_BUFFER,Y.jitterBufferMs),Ft(ce,Ho.CURRENT_DELAY,Y.jitterBufferMs),ce[Ho.PLAYER_STATUS]=xL[zo.getPlayerState(U.getTrackId())],_e){const Ye=Y.concealedSamples-_e.concealedSamples;Ye>0&&Ft(ce,Ho.CONCEALED_SAMPLES,Ye);const ut=Y.totalSamplesReceived-_e.totalSamplesReceived;ut>0&&Ft(ce,Ho.TOTAL_SAMPLES_RECEIVED,ut)}}return ce}(_._audioSSRC,n,i,_.audioTrack,o,c):void 0;w&&(S.audio=w)}(S.video||S.audio)&&h.push(S)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const n=(this.requestAllTracks()||[]).find(i=>i instanceof NA);if(n&&n._external.getDenoiserStats){const i=n._external.getDenoiserStats();i&&this.requestUpload(cb.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(n=>{n.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(n=>{let[i,o]=n;o.has(mt.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),o.has(mt.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const n=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const i=Date.now(),o={connectionInterval:re("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const y of u)!y.muted&&y.enabled&&(c=c.concat(await y.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[y,S]of h)S.has(mt.VIDEO)&&y.videoTrack&&(c=c.concat(await y.videoTrack.getProcessorUsage())),S.has(mt.AUDIO)&&y.audioTrack&&(c=c.concat(await y.audioTrack.getProcessorUsage()));if(c.length===0)return;o.details=function(y,S){const w={};for(const{id:U,value:V,level:q,direction:Y}of y){var A;const ce=(A=S.get(U))!==null&&A!==void 0?A:0,_e=V===2?ce+re("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ce;var k,W;S.set(U,_e),w[U]?(V===2&&(w[U].value=V),q>w[U].level&&(w[U].level=q),Y==="remote"&&(w[U].remoteUidCount+=1),w[U].totalTs=(k=S.get(U))!==null&&k!==void 0?k:0):w[U]={value:V,level:q,remoteUidCount:Y==="local"?0:1,totalTs:(W=S.get(U))!==null&&W!==void 0?W:0}}return Object.keys(w).map(U=>{const{level:V,value:q,totalTs:Y}=w[U];return{id:U,level:V,value:q,totalTs:Y}})}(c,n);const m=Date.now(),_=m>i?m:i+1;this.requestUpload&&this.requestUpload(cb.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:_})},re("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const Dfe=re("ICE_RESTART_INTERVAL");let uP=new Map,Wv=new Map,Am=[As.UDP_TCP_RELAY,As.TCP_RELAY,As.RELAY],Ix=re("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&kn().supportPCSetConfiguration;function d9(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=uP.get(e.id);i&&(window.clearTimeout(i),uP.delete(e.id));const o=Wv.get(e.id);n&&o&&o.index===Am.length-1&&(D.debug("[".concat(e.id,"] reset ICE restart policy")),Wv.delete(e.id))}function h9(e,n,i){if(uP.size===0&&Wv.size===0&&(Array.isArray(re("RESTART_SEQUENCE"))&&re("RESTART_SEQUENCE").length>0&&!function(m,_){if(m.length!==_.length)return!1;for(let y=0;y<m.length;y+=1){const S=m[y];if(m.filter(w=>w===S).length!==_.filter(w=>w===S).length)return!1}return!0}(Am,re("RESTART_SEQUENCE"))&&(Am=re("RESTART_SEQUENCE").filter(m=>{var _;if(ot(_=Object.values(As)).call(_,m))return!0}),D.debug("use reconnection policy from config distribution, queues: ".concat(Am.join(" => ")))),Ix=re("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&kn().supportPCSetConfiguration),Am.length===0)return void i();let o,{index:c=0,type:u}=Wv.get(e.id)||{};if(Ix&&u===As.RELAY)return void i();let h=u&&c>=Am.length-1;if(Ix)u=As.RELAY;else{if(h)return void i();u?(c++,u=Am[c]):(u=Am[0],c=0)}D.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),n(u),Wv.set(e.id,{index:c,type:u}),o=window.setTimeout(()=>h9(e,n,i),Dfe),uP.set(e.id,o)}var un;function p9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function gh(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?p9(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):p9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}function f9(e){var n,i,o,c=2;for(typeof Symbol<"u"&&(i=JD,o=Symbol.iterator);c--;){if(i&&(n=e[i])!=null)return n.call(e);if(o&&(n=e[o])!=null)return new dP(n.call(e));i="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function dP(e){function n(i){if(Object(i)!==i)return lt.reject(new TypeError(i+" is not an object."));var o=i.done;return lt.resolve(i.value).then(function(c){return{value:c,done:o}})}return dP=function(i){this.s=i,this.n=i.next},dP.prototype={s:null,n:null,next:function(){return n(this.n.apply(this.s,arguments))},return:function(i){var o=this.s.return;return o===void 0?lt.resolve({value:i,done:!0}):n(o.apply(this.s,arguments))},throw:function(i){var o=this.s.return;return o===void 0?lt.reject(i):n(o.apply(this.s,arguments))}},new dP(e)}let vb=(un=class extends Ar{get state(){return this._state}set state(e){const n=this._state;this._state=e,this.emit(Ot.StateChange,n,this._state)}constructor(e,n){super(),$(this,"isPlanB",void 0),$(this,"store",void 0),$(this,"statsUploader",void 0),$(this,"connection",void 0),$(this,"localTrackMap",new Map),$(this,"remoteUserMap",new Map),$(this,"localDataChannels",[]),$(this,"remoteDataChannelMap",new Map),$(this,"pendingLocalTracks",[]),$(this,"pendingRemoteTracks",[]),$(this,"pendingLocalDataChannels",[]),$(this,"pendingRemoteDataChannels",[]),$(this,"statsCollector",void 0),$(this,"shouldForwardP2PCreation",void 0),$(this,"iceFailedCount",0),$(this,"dtlsFailedCount",0),$(this,"mutex",void 0),$(this,"_state",Bn.Disconnected),$(this,"_pcStatsUploadType",re("NEW_ICE_RESTART")?zp.FIRST_CONNECTION:zp.OLD_FIRST_CONNECTION),$(this,"_isStartRestartIce",!1),$(this,"_restartTimer",void 0),$(this,"_isTryConnecting",!1),$(this,"_iceError",null),$(this,"_forceTurn",!1),$(this,"_isWaitPcToRePub",!1),$(this,"handleMuteLocalTrack",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Bn.Connected)return void c(new Le(X.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(i);if(h.length===0)return void o();const m=h.find(y=>y[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const _=this.createMuteMessage(h);await sr(this,Ot.RequestMuteLocal,_),o()}catch(h){c(h)}finally{u()}}),$(this,"handleUnmuteLocalTrack",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Bn.Connected)return void c(new Le(X.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void o();const m=h.find(y=>y[0]==="videoLowTrack");if(m){const y=m[1];if(y.track._originMediaStreamTrack.stop(),!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding){const S=i._mediaStreamTrack.clone();y.track._mediaStreamTrack=S,y.track._originMediaStreamTrack=S}else{const S=Cx(i,tb(this,Ot.RequestLowStreamParameter));y.track._mediaStreamTrack=S,y.track._originMediaStreamTrack=S}await new lt((S,w)=>{this.handleReplaceTrack(y.track,S,w,!0)})}await this.connection.unmuteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const _=this.createUnmuteMessage(h);await sr(this,Ot.RequestUnmuteLocal,_),o()}catch(h){c(h)}finally{u()}}),$(this,"handleUpdateVideoEncoder",async(i,o,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get($e.LocalVideoTrack);if(!this.connection||!_||_.track!==i||this.state!==Bn.Connected)return void o();const{id:y,track:S}=_;await this.connection.updateSendParameters(y,S),await this.connection.updateEncoderConfig(y,S),this.emit(Ot.UpdateVideoEncoder,S),o()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),$(this,"handleUpdateVideoSendParameters",async(i,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get($e.LocalVideoTrack);if(!this.connection||!h||h.track!==i||this.state!==Bn.Connected)return void o();const{id:m,track:_}=h;await this.connection.updateSendParameters(m,_),o()}catch(h){c(h)}finally{u()}}),$(this,"handleReplaceMixingTrack",async(i,o,c,u)=>{if(!this.connection||this.state!==Bn.Connected)return void o();const h=wx([i]);let m;D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,h),o()}catch(y){c(y)}finally{var _;(_=m)===null||_===void 0||_()}}),$(this,"handleReplaceTrack",async(i,o,c,u)=>{let h;D.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const y=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:w}]=S;return i===w});if(!this.connection||!y||this.state!==Bn.Connected)return void o();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(i,y[1].id)),this.isPlanB){const S=y[1];S.id=i._mediaStreamTrack.id,this.localTrackMap.set(y[0],S)}if(y[0]===$e.LocalVideoTrack&&!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding){const S=this.localTrackMap.get($e.LocalVideoLowTrack);if(S){const w=i._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=w,S.track._originMediaStreamTrack=w,await new lt((A,k)=>{this.handleReplaceTrack(S.track,A,k,!0)})}}o()}catch(y){c(y)}finally{var _;(_=h)===null||_===void 0||_()}}),$(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),$(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),$(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),$(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),$(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=n,this.statsCollector.addP2PChannel(this),this.statsUploader=new u9(this.store),this.bindStatsUploaderEvents(),this.mutex=new Cs("P2PChannel-mutex",this.store.clientId),this.isPlanB=!kn().supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&Mp(),this.shouldForwardP2PCreation=re("FORWARD_P2P_CREATION")&&kn().supportPCSetConfiguration&&lL(),this.shouldForwardP2PCreation&&(this.connection=oP(this.store),this.emit(Ot.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var n;this.state=Bn.New,this._forceTurn=i9(e),D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!i||(i&&this.connection&&(D.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=oP(this.store,e),this.emit(Ot.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=re("NEW_ICE_RESTART")?zp.FIRST_CONNECTION:zp.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");re("ENABLE_PREALLOC_PC")&&this.state===Bn.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Bn.Connected)}updateRemoteRTPCapabilities(e){const n=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return ot(u=[$e.LocalVideoLowTrack,$e.LocalVideoTrack]).call(u,h)}),i=n.map(c=>{let[,{id:u}]=c;return u}),o=n.map(c=>{let[u]=c;return u});if(this.connection instanceof fh){if(wt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!ot(e).call(e,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>ot(e).call(e,u));c&&(this.store.codec=c,D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async getEstablishParams(){var e;if(this.connection instanceof fh&&this.connection.peerConnectionState!=="closed"&&ot(e=[Bn.New,Bn.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Bn.Connected){if(this.state===Bn.Disconnected)throw new Le(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(i=>{var o;ot(o=this.pendingLocalDataChannels).call(o,i)||this.pendingLocalDataChannels.push(i)}),[]}const n=this.filterTobePublishedDataChannels(e);return n.length===0?[]:(n.forEach(i=>{const o=Date.now();this.store.publish(i.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,n),n.forEach(i=>{this.localDataChannels.push(i);const o=Date.now();this.store.publish(i.id+"","datachannel",void 0,o)}),e.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(e,n,i){var o=this;return hl(function*(){const c=yield wn(o.mutex.lock("From P2PChannel.publish"));try{var u;const h=o.connection&&ot(u=["disconnected","failed"]).call(u,o.connection.peerConnectionState);if(!o.connection||o.state!==Bn.Connected||h){if(o.state===Bn.Disconnected)throw new Le(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(e);const _=e.filter(y=>o.pendingLocalTracks.indexOf(y)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(_),void(h&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,Ps.markPublishStart(o.store.clientId,o.store.pubId);const m=o.filterTobePublishedTracks(e,n,i);if(m.length===0)return void(yield wn(o.tryToUnmuteAudio(e)));yield*sA(f9(o.doPublish(o.connection,m)))}finally{c()}})()}doPublish(e,n){var i=this;return hl(function*(){n.forEach(A=>{let{track:k,type:W}=A;const U=Date.now();i.store.publish(k.getTrackId(),W===$e.LocalAudioTrack?"audio":"video",U)}),i.bindLocalTrackEvents(n);const o=n.map(A=>{let{track:k}=A;return k}),c=yield wn(e.send(o,i.store.codec,i.store.audioCodec)),u=(yield wn(c.next())).value,h=i.createGatewayPublishMessage(n,u);let m;try{m=yield h}catch(A){throw c.throw(A),(A==null?void 0:A.code)===X.WS_ABORT&&n.forEach(k=>{let{track:W}=k;i.pendingLocalTracks.indexOf(W)===-1&&i.pendingLocalTracks.push(W)}),i.unbindLocalTrackEvents(n),A}const _=i.mapPubResToRemoteConfig(h,m,o),y=(yield wn(c.next(_))).value;if(i.state===Bn.Disconnected)throw new Le(X.UNEXPECTED_ERROR,"PeerConnection already disconnected.");re("ENABLE_VIDEO_SEI");const S=re("ENABLE_ENCODED_TRANSFORM"),w=re("ENABLE_AUDIO_METADATA");o.forEach(async A=>{const k=A.getRTCRtpTransceiver();if(!k||!S)return;const{interceptLocalVideoFrame:W,interceptLocalAudioFrame:U}=ZA();A.trackMediaType===mt.VIDEO?await W(k.sender,A):A.trackMediaType===mt.AUDIO&&await U(k.sender,{metadata:w?()=>{const V=A.metadata.shift();return V&&V.value}:void 0})}),n.forEach(A=>{let{type:k}=A;i.statsCollector.addLocalStats(k)}),i.assignLocalTracks(n,y),i.statsUploader.startUploadOutboundStats(),n.forEach(A=>{let{track:k,type:W}=A;const U=Date.now();i.store.publish(k.getTrackId(),W===$e.LocalAudioTrack?"audio":"video",void 0,U)})})()}async updateVideoStreamParameter(e,n){const i=this.localTrackMap.get(n);if(!i||!this.connection)return;if(!(i.track instanceof mr))return D.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=i,c=function(u,h){const m={};return u.height&&u.width&&(m.scaleResolutionDownBy=cx(u,h)),m.maxFramerate=u.framerate?qa(u.framerate):void 0,m.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,m}(e,o);if(o._encoderConfig||(o._encoderConfig={}),n!==$e.LocalVideoLowTrack||!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=o._originMediaStreamTrack;if(!u.canvas)return D.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(h,m){const _=h.canvas;m.width&&(_.width=qa(m.width)),m.height&&(_.height=qa(m.height)),m.framerate&&(_.stopCapture&&_.stopCapture(),_.stopCapture=UL(()=>{!_.startCapture&&_.stopCapture&&_.stopCapture(),_.startCapture&&_.startCapture()},qa(m.framerate)))})(u,e)}c.maxBitrate!=null&&(o._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=c.maxFramerate:o._encoderConfig.frameRate={max:c.maxFramerate}),D.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(e){var n=this;return hl(function*(){if(!n.connection||n.state!==Bn.Connected)return;const i=yield wn(n.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=n.localTrackMap.get($e.LocalVideoTrack);if(!c)throw new Le(X.UNEXPECTED_ERROR,"Could not find high stream");if(n.localTrackMap.has($e.LocalVideoLowTrack))throw new Le(X.UNEXPECTED_ERROR,"[".concat(n.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:n.getLowVideoTrack(c.track,e),type:$e.LocalVideoLowTrack}];if(yield*sA(f9(n.doPublish(n.connection,u))),c.track.muted||!c.track.enabled){var o;const h=(o=n.localTrackMap.get($e.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;h!==void 0&&(yield wn(n.connection.muteLocal([h])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(D.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Es(this,Ot.RequestRePublish,this.pendingLocalTracks),this.emit(Ot.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(D.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Es(this,Ot.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let n=this.pendingRemoteTracks.length-1;n>=0;n--){const{user:i,kind:o}=this.pendingRemoteTracks[n];(o!==mt.AUDIO||i._audio_added_&&i._audioSSRC)&&(o!==mt.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(n,1)}if(e)await Es(this,Ot.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:n,kind:i}of this.pendingRemoteTracks)await this.subscribe(n,i,i===mt.VIDEO?n._videoSSRC:n._audioSSRC);this.pendingRemoteTracks.forEach(n=>{let{user:i}=n;this.emit(Ot.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Bn.Connected)return void e.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)});const n=this.filterTobeUnpublishedTracks(e);if(n.length===0)return;const i=n.find(o=>o[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,n)}async unpublishDataChannel(e){if(!this.connection||this.state!==Bn.Connected)return void e.forEach(i=>{const o=this.pendingLocalDataChannels.indexOf(i);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const n=this.filterTobeUnpublishedDataChannels(e);return n.length!==0?(n.forEach(i=>{const o=this.localDataChannels.indexOf(i);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),n.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Bn.Connected)return;const e=this.localTrackMap.get($e.LocalVideoLowTrack);if(!e)return;e.track.close();const n=[[$e.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,n)}async doUnpublish(e,n){const i=this.createGatewayUnpublishMessage(n);return await e.stopSending(n.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(n),this.unbindLocalTrackEvents(n.map(o=>{let[c,{track:u}]=o;return{type:c,track:u}})),n.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,n){if(!this.connection||this.state!==Bn.Connected)throw new Le(X.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=n.filter(o=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(o.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(o=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(o.id,o):this.remoteDataChannelMap.set(e,new Map([[o.id,o]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:_}=h;return m.uid===e.uid&&_===o.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),i.map(o=>o.id)}async subscribe(e,n,i,o,c){var u;if(!this.connection||this.state!==Bn.Connected)throw new Le(X.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(e))!==null&&u!==void 0&&u.has(n))return;let h,m,_;const y=this.connection.getPreMedia(i);if(y)D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),_=y.transceiver,h=y.track,m=y.id;else if(c){const A=c.find(W=>{let{stream_type:U}=W;return U===n});if(!A)throw new Le(X.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(n," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(n,"."));const k=await this.connection.receive(n,A.ssrcs,String(e._uintid),A.attributes);this.connection instanceof fh&&(_=k.transceiver),h=k.track,m=k.id}else{const A=await this.connection.receive(n,[{ssrcId:i,rtx:o}],String(e._uintid),void 0);this.connection instanceof fh&&(_=A.transceiver),h=A.track,m=A.id}if(n===mt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new Pv(h,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),_&&e._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new Av(h,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),_&&e._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(e,e._videoTrack)),_&&re("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:A,interceptRemoteAudioFrame:k}=ZA();n==mt.VIDEO?await A(_.receiver,{onSei:re("ENABLE_VIDEO_SEI")&&(W=>{var U;return(U=e._videoTrack)===null||U===void 0?void 0:U._onSei(W)})}):n==mt.AUDIO&&await k(_.receiver,{enableTopn:!!re("ENABLE_AUDIO_TOPN"),enableMetadata:!!re("ENABLE_AUDIO_METADATA"),onMetadata:W=>{this.safeEmit(Ot.AudioMetadata,W)}})}const S=this.remoteUserMap.get(e);S?S.set(n,m):this.remoteUserMap.set(e,new Map([[n,m]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const w=this.pendingRemoteTracks.findIndex(A=>{let{user:k,kind:W}=A;return k.uid===e.uid&&n===W});w!==-1&&(this.pendingRemoteTracks.splice(w,1),this.emit(Ot.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Bn.Connected)throw new Le(X.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var u;let{user:h,mediaType:m}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(m))});const n=[],i=new Map;e.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);u?i.set(c.ssrcId,u):n.push(c)});const o=await this.connection.batchReceive(n.map(c=>{let{user:u,mediaType:h,ssrcId:m,rtxSsrcId:_}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:_}],mslabel:String(u._uintid)}}));n.forEach((c,u)=>{i.set(c.ssrcId,o[u])});for(const{user:c,mediaType:u,ssrcId:h}of e){const m=i.get(h);if(!m)return void D.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:_,id:y,transceiver:S}=m;if(S&&re("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:W}=ZA();u==mt.VIDEO?await k(S.receiver,{onSei:re("ENABLE_VIDEO_SEI")&&(U=>{var V;return(V=c._videoTrack)===null||V===void 0?void 0:V._onSei(U)})}):u==mt.AUDIO&&await W(S.receiver,{enableTopn:!!re("ENABLE_AUDIO_TOPN"),enableMetadata:!!re("ENABLE_AUDIO_METADATA"),onMetadata:U=>{this.safeEmit(Ot.AudioMetadata,U)}})}if(u===mt.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(_):(c._audioTrack=new Pv(_,c.uid,c._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),S&&c._audioTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(_):(c._videoTrack=new Av(_,c.uid,c._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),S&&c._videoTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._videoTrack)),re("ENABLE_VIDEO_SEI")&&S){const{interceptRemoteVideoFrame:k,interceptRemoteAudioFrame:W}=ZA();u==mt.VIDEO?await k(S.receiver,{onSei:U=>{var V;(V=c._videoTrack)===null||V===void 0||V._onSei(U)}}):u==mt.AUDIO&&await W(S.receiver)}const w=this.remoteUserMap.get(c);w?w.set(u,y):this.remoteUserMap.set(c,new Map([[u,y]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const A=this.pendingRemoteTracks.findIndex(k=>{let{user:W,kind:U}=k;return W.uid===c.uid&&u===U});A!==-1&&(this.pendingRemoteTracks.splice(A,1),this.emit(Ot.MediaReconnectEnd,c.uid))}}async unsubscribe(e,n,i){const o=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:_}=h;return n!==void 0?m.uid===e.uid&&n===_:m.uid===e.uid});if(o.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===Bn.Connected||i||o.forEach(h=>{let{kind:m}=h;var _;if(m===mt.AUDIO)(_=e._audioTrack)===null||_===void 0||_._destroy(),e._audioTrack=void 0;else if(m===mt.VIDEO){var y;(y=e._videoTrack)===null||y===void 0||y._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Bn.Connected)return;const c=this.filterTobeUnSubscribedTracks(e,n);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:_}]=h;var y,S;if(_===mt.VIDEO&&m._videoSSRC&&((y=this.connection)===null||y===void 0||y.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),_===mt.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),i||((S=m._videoTrack)===null||S===void 0||S._destroy(),m._videoTrack=void 0);else if(_===mt.AUDIO){var w;this.unbindRemoteTrackEvents(m._audioTrack),!i&&((w=m._audioTrack)===null||w===void 0||w._destroy(),m._audioTrack=void 0)}}),u}async unsubscribeDataChannel(e,n){if(n.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(e,n);if(i.length===0)return;n.forEach(c=>{c._close()});const o=this.remoteDataChannelMap.get(e);return i.forEach(c=>{o&&o.delete(c.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let n=[];for(const{user:c,mediaType:u}of e){const h=this.pendingRemoteTracks.filter(m=>{let{user:_,kind:y}=m;return u!==void 0?_.uid===c.uid&&u===y:_.uid===c.uid});h.forEach(m=>{const _=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(_,1)}),n=n.concat(h)}if(!this.connection||this.state!==Bn.Connected)return void n.forEach(c=>{let{user:u,kind:h}=c;var m;if(h===mt.AUDIO)(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0;else if(h===mt.VIDEO){var _;(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0}});const i=ja(e).call(e,(c,u)=>{let{user:h,mediaType:m}=u;const _=this.filterTobeUnSubscribedTracks(h,m);return c.concat(_)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(c=>{let[,{id:u}]=c;return u}));const o=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(c=>{let[u,{kind:h}]=c;var m,_;if(h===mt.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===mt.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0;else if(h===mt.AUDIO){var y;this.unbindRemoteTrackEvents(u._audioTrack),(y=u._audioTrack)===null||y===void 0||y._destroy(),u._audioTrack=void 0}}),o}isPreSubScribe(e){return!this.connection||this.state!==Bn.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,n){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void D.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(n))return void D.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."));const o=n===mt.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,n){return this.unmuteRemoteNoLock(e,n)}async unmuteRemoteNoLock(e,n){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void D.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(n)||D.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."))}addAudioMetadata(e){const n=this.localTrackMap.get($e.LocalAudioTrack),i=n&&n.track;i&&i.metadata.push(e)}getAllTracks(e){const n=this.localTrackMap.get($e.LocalAudioTrack);if((n==null?void 0:n.track)instanceof Ti){const i=n.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==$e.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===$e.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===$e.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,n,i,o,c){if(e){const h=this.localTrackMap.get($e.LocalAudioTrack),m=o?this.localTrackMap.get($e.LocalVideoLowTrack):this.localTrackMap.get($e.LocalVideoTrack);wt.publish(this.store.sessionId,{eventElapse:Ps.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof Br),m=o?(u=this.localTrackMap.get($e.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof mr);wt.publish(this.store.sessionId,{eventElapse:Ps.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,n,i,o){const c=o===mt.VIDEO?i._videoSSRC:i._audioSSRC;c&&wt.subscribe(this.store.sessionId,{succ:e,ec:n,video:o===mt.VIDEO,audio:o===mt.AUDIO,peerid:i.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Ps.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){D.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Cs("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=oP(this.store),this.emit(Ot.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get($e.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ti){if(e.track.trackList.length>0){const n=e.track;e.track.trackList.forEach(i=>{n.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Bn.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var n;return((n=this.connection)===null||n===void 0?void 0:n.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get($e.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get($e.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const n=this.localTrackMap.get(e);return n&&n.track instanceof mr||n&&n.track instanceof Br?n.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}async hasRemoteMediaWithLock(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}getRemoteMedia(e){var n;const i=Array.from(Pc(n=this.remoteUserMap).call(n)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const n=this.localTrackMap.get($e.LocalAudioTrack);return n&&e.push({level:100*n.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=VT(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.connection&&(D.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Bn.Reconnecting,re("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n]=e;var i;n._videoTrack&&n._videoTrack._player&&((i=n._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),n._videoTrack._player.isKeepLastFrame=!0,n._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=oP(this.store),this.emit(Ot.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var n;let[i,{track:o}]=e;switch(i){case $e.LocalVideoTrack:ot(n=o._hints).call(n,ar.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case $e.LocalAudioTrack:o instanceof Ti?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case $e.LocalVideoLowTrack:}}),this.emit(Ot.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;Array.from(Pc(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(n,o)}),this.emit(Ot.MediaReconnectStart,n.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[n,i]=e;Array.from(Pc(i).call(i)).forEach(o=>{this.setPendingRemoteDataChannel(n,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),D.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,n){for(const i of this.pendingRemoteDataChannels){const{user:o,id:c}=i;if((e instanceof Im?e.uid:e)===o.uid&&c===n)return!0}return!1}setPendingRemoteDataChannel(e,n){this.hasPendingRemoteDataChannel(e,n)||this.pendingRemoteDataChannels.push({user:e,id:n})}hasPendingRemoteMedia(e,n){for(const i of this.pendingRemoteTracks){const{user:o,kind:c}=i;if((e instanceof Im?e.uid:e)===o.uid&&n===c)return!0}return!1}setPendingRemoteMedia(e,n){this.hasPendingRemoteMedia(e,n)||this.pendingRemoteTracks.push({user:e,kind:n})}restartICE(e){var n=this;return hl(function*(){if(!n.connection||n.state!==Bn.Connected)return;const i=yield wn(n.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield wn(n.connection.restartICE(e));const u=yield wn(o.next());if(u.done)return;const h=u.value,m=yield h;switch(Rx(n.connection)&&n.reportPCStats(Date.now(),!1,n._pcStatsUploadType),e){case As.UDP_TCP_RELAY:n._pcStatsUploadType=zp.UDP_TCP_RESTART;break;case As.TCP_RELAY:n._pcStatsUploadType=zp.TCP_RESTART;break;case As.RELAY:n._pcStatsUploadType=zp.RELAY_RESTART;break;default:n._pcStatsUploadType=zp.OLD_RESTART}n._isTryConnecting=!0,o.next(m)}catch(u){var c;(c=o)===null||c===void 0||c.throw(u)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),n=this.localTrackMap.get($e.LocalVideoTrack),i=this.localTrackMap.get($e.LocalAudioTrack),o=e.videoSend.find(k=>k.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId)),c=e.audioSend.find(k=>k.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!o||!c)return 1;const u=Ic(this,Ot.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,y=(_&&u?(_+u)/2:_||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*y/1500,w=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,A=n==null?void 0:n.track;if(A&&A._encoderConfig&&A._hints.indexOf(ar.SCREEN_TRACK)===-1){const k=A._encoderConfig.bitrateMax,W=e.bitrate.actualEncoded;if(k&&W){const U=(1e3*k-W)/(1e3*k);return qz[U<.15?0:U<.3?1:U<.45?2:U<.6?3:4][w]}}return w}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let n=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(W=>W.ssrc===c),m=e.videoRecv.find(W=>W.ssrc===u);if(!h&&!m)return void(n+=1);const _=Ic(this,Ot.NeedSignalRTT),y=e.rtt,S=(y&&_?(y+_)/2:y||_)||0,w=h?h.jitterMs:void 0,A=e.recvPacketLossRate;let k=.7*A*100/50+.3*S/1500;w&&(k=.6*A*100/50+.2*S/1500+.2*w/400),n+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(n/this.remoteUserMap.size):n}async muteLocalTrack(e){return new lt((n,i)=>{this.handleMuteLocalTrack(e,n,i)})}async replaceTrack(e,n){var i;if(D.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(n.getTrackId(),"]")),!this.connection||this.state!==Bn.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return e===h});if(!o)return;const c=o[0];if(e!==n&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:n,type:c}]),o[1].track=n),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(n,o[1].id)),this.isPlanB){const u=o[1];u.id=n._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===$e.LocalVideoTrack&&!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding){const u=this.localTrackMap.get($e.LocalVideoLowTrack);if(u){const h=e._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new lt((m,_)=>{this.handleReplaceTrack(u.track,m,_,!0)})}}}filterTobePublishedTracks(e,n,i){const o=[],c=this.getAllTracks();e=mv(e=e.filter(_=>c.indexOf(_)===-1));let u,h=!1;const m=this.localTrackMap.get($e.LocalAudioTrack);for(const _ of e){if(_ instanceof mr&&(this.localTrackMap.has($e.LocalVideoTrack)||h?new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:$e.LocalVideoTrack}),h=!0),n)){const y=this.getLowVideoTrack(_,i);o.push({track:y,type:$e.LocalVideoLowTrack})}if(_ instanceof Br)if(m){const y=m.track;if(y instanceof Ti)bx([_]),y.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0);else{const S=wx([y,_]);D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(S.getTrackId(),"]")),this.replaceTrack(y,S)}}else u instanceof Ti?(bx([_]),u.addAudioTrack(_)):u||!_._useAudioElement&&kn().webAudioMediaStreamDest&&!_._bypassWebAudio?u=wx(u?[_,u]:[_]):u=_}return u&&(D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),o.push({track:u,type:$e.LocalAudioTrack})),o}filterTobeUnpublishedTracks(e){const n=[],i=this.getAllTracks();e=mv(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof Br){const c=this.localTrackMap.get($e.LocalAudioTrack);if(!c)continue;c.track instanceof Ti?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(n.push([$e.LocalAudioTrack,c]),c.track.close())):n.push([$e.LocalAudioTrack,c])}if(o instanceof mr){const c=this.localTrackMap.get($e.LocalVideoTrack);if(!c)continue;n.push([$e.LocalVideoTrack,c]);const u=this.localTrackMap.get($e.LocalVideoLowTrack);u&&n.push([$e.LocalVideoLowTrack,u])}}return n}filterTobePublishedDataChannels(e){return e=(e=mv(e)).filter(n=>this.localDataChannels.findIndex(i=>i.id===n.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=mv(e)).filter(n=>this.localDataChannels.indexOf(n)!==-1)).filter(n=>n._originDataChannel)}bindLocalTrackEvents(e){e.forEach(n=>{let{track:i,type:o}=n;switch(o){case $e.LocalVideoTrack:i.addListener(gt.GET_STATS,this.handleGetLocalVideoStats),i.addListener(gt.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(gt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(gt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case $e.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,n){e instanceof Ti?e.trackList.forEach(i=>{i.addListener(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(gt.GET_STATS,this.handleGetLocalAudioStats),i.addListener(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(gt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),n||(e.addListener(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(gt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(n=>{let[i,{track:o}]=n;return{track:o,type:i}})),e.forEach(n=>{let{track:i,type:o}=n;switch(o){case $e.LocalVideoTrack:i.off(gt.GET_STATS,this.handleGetLocalVideoStats),i.off(gt.GET_RTC_STATS,this.handleGetRTCStats),i.off(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(gt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(gt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case $e.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ti?e.trackList.forEach(n=>{n.off(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(gt.GET_STATS,this.handleGetLocalAudioStats),n.off(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(gt.GET_STATS,this.handleGetLocalAudioStats),e.off(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(gt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,n){n instanceof Av&&n.addListener(gt.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),n instanceof Pv&&n.addListener(gt.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(gt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;i.has(mt.AUDIO)&&this.unbindRemoteTrackEvents(n._audioTrack),i.has(mt.VIDEO)&&this.unbindRemoteTrackEvents(n._videoTrack)})}createGatewayPublishMessage(e,n){return e.map((i,o)=>{var c;let u,h,{track:m,type:_}=i;switch(_){case $e.LocalAudioTrack:u=zn.Audio,h={dtx:m instanceof NA&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case $e.LocalVideoTrack:u=ot(c=m._hints).call(c,ar.SCREEN_TRACK)?zn.Screen:zn.High,h=gh(gh({},hG(m)),{},{codec:this.store.codec,svc_mode:qA()});break;case $e.LocalVideoLowTrack:u=zn.Low,h=gh(gh({},hG(m)),{},{codec:this.store.codec,svc_mode:qA()})}return{stream_type:u,attributes:h,ssrcs:n[o]}})}createGatewayUnpublishMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=n;switch(c){case $e.LocalVideoTrack:o=ot(i=u._hints).call(i,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoLowTrack:o=zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,n){e.forEach((i,o)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:n[o].id,ssrcs:n[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(n=>{let[i]=n;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async n=>{if(D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(n,")")),this.emit(Ot.PeerConnectionStateChange,n),n==="connecting"&&e instanceof fh&&!Nr()&&re("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{n==="connecting"&&e.extendCandidate()},re("FIRST_TCP_CANDIDATE_INTERVAL")),n!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),n==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof fh&&d9(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=zp.DISCONNECTED_OR_FAILED,Ic(this,Ot.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const i=this.pendingLocalTracks.map(c=>c.getTrackId()),o=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));wt.reportApiInvoke(this.store.sessionId,{name:mi.REPUB_AFTER_PC_CONNECTED,options:i.concat(o),tag:Lr.TRACER}).onSuccess(),this.republish()}if(re("NEW_ICE_RESTART")&&e instanceof fh&&!Nr()&&!this._forceTurn){if(ot(sG).call(sG,n)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const i=c=>{Rx(e)&&(D.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Ic(this,Ot.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ot.RequestRestartICE,c))},o=()=>{Rx(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),D.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Ot.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{h9(e,i,o)},800))}}else{if(n==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&re("ICE_RESTART")&&Ic(this,Ot.QueryClientConnectionState)==="CONNECTED"&&this.emit(Ot.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Ot.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);n==="failed"&&(D.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Ot.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=n=>{n!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(n,")")),wt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:n,tag:Lr.TRACER}).onSuccess(),this.emit(Ot.IceConnectionStateChange,n)},e.onICETransportStateChange=n=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(n,")"))},e.onDTLSTransportStateChange=n=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(n,")"))},e.onDTLSTransportError=n=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(n,")"))},e.onFirstAudioDecoded=n=>{var i;const o=Array.from(Pc(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===n);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(bv.FIRST_FRAME_DECODED),wt.firstRemoteFrame(this.store.sessionId,Di.FIRST_AUDIO_DECODE,br.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Ps.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=n=>{var i;const o=Array.from(Pc(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===n);o&&wt.firstRemoteFrame(this.store.sessionId,Di.FIRST_AUDIO_RECEIVED,br.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Ps.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(n,i,o)=>{this.reportVideoFirstFrameDecoded(n,i,o)},e.onFirstVideoReceived=n=>{var i;const o=Array.from(Pc(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===n);o&&wt.firstRemoteFrame(this.store.sessionId,Di.FIRST_VIDEO_RECEIVED,br.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Ps.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(n,i)=>{const o=n.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&o===c||this.emit(Ot.ConnectionTypeChange,o),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(wm(i))," -> ").concat(JSON.stringify(wm(n)),")"))},e.onSelectedRemoteCandidateChanged=(n,i)=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(wm(i))," -> ").concat(JSON.stringify(wm(n)),")"))},e.onFirstVideoDecodedTimeout=n=>{this.reportVideoFirstFrameDecoded(n,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const n=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return gh(gh({},n),i)},e.onICECandidateError=n=>{this._iceError=n}}resetConnection(e){e instanceof fh&&function(n){Wv.delete(n.id),d9(n)}(e),e.close(),this.emit(Ot.PeerConnectionStateChange,"closed"),function(n){n.onConnectionStateChange=void 0,n.onICEConnectionStateChange=void 0,n.onICETransportStateChange=void 0,n.onDTLSTransportStateChange=void 0,n.onDTLSTransportError=void 0,n.onFirstAudioDecoded=void 0,n.onFirstAudioReceived=void 0,n.onFirstVideoDecoded=void 0,n.onFirstVideoReceived=void 0,n.onSelectedLocalCandidateChanged=void 0,n.onSelectedRemoteCandidateChanged=void 0,n.onFirstVideoDecodedTimeout=void 0,n.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const n=[];if(this.getAllTracks().indexOf(e)===-1)return n;const i=this.localTrackMap.get($e.LocalAudioTrack);if(e instanceof Br&&(i==null?void 0:i.track)instanceof Ti)return i.track.isActive||n.push([$e.LocalAudioTrack,i]),n;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(n.push(o),o[0]===$e.LocalVideoTrack)){const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&n.push([$e.LocalVideoLowTrack,c])}return n}filterTobeUnmutedTracks(e){const n=[],i=this.localTrackMap.get($e.LocalAudioTrack);if(e instanceof Br&&(i==null?void 0:i.track)instanceof Ti)return i.track.isActive&&n.push([$e.LocalAudioTrack,i]),n;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===$e.LocalVideoTrack){n.push(o);const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&n.push([$e.LocalVideoLowTrack,c])}else n.push(o);return n}createMuteMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=n;switch(c){case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoTrack:o=ot(i=u._hints).call(i,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:o=zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=n;switch(c){case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoTrack:o=ot(i=u._hints).call(i,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:o=zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,n){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(n){const c=o.get(n);if(!c)return i;i.push([e,{kind:n,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}filterTobeUnSubscribedDataChannels(e,n){const i=[];return n.forEach(o=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(o.id)&&i.push(o)}),i}createUnsubscribeMessage(e){const n=[];return e.forEach(i=>{let[o,{kind:c,id:u}]=i;switch(c){case mt.VIDEO:return void(o._videoSSRC&&n.push({stream_type:mt.VIDEO,ssrcId:o._videoSSRC}));case mt.AUDIO:return void(o._audioSSRC&&n.push({stream_type:mt.AUDIO,ssrcId:o._audioSSRC}))}}),n}createUnsubscribeAllMessage(e){const n=new Map;return e.forEach(i=>{let[o,{kind:c}]=i;if(n.has(o)){let u=n.get(o);c===mt.VIDEO?u|=Li.Video:u|=Li.Audio,n.set(o,u)}else c===mt.VIDEO?n.set(o,Li.Video):n.set(o,Li.Audio)}),{users:Array.from(n.entries()).map(i=>{let[o,c]=i;return{stream_id:o.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(n=>{let[i,{kind:o}]=n;const c=this.remoteUserMap.get(i);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const n=this.localTrackMap.get($e.LocalVideoTrack),i=this.localTrackMap.get($e.LocalVideoLowTrack);n&&(await n.track.setBitrateLimit(e.uplink),await new lt((o,c)=>{this.handleUpdateVideoEncoder(n.track,o,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new lt((o,c)=>{this.handleUpdateVideoEncoder(i.track,o,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,n,i){return e.map((o,c)=>{var u;let{stream_type:h}=o;const m=(u=n.find(_=>{let{stream_type:y}=_;return h===y}))===null||u===void 0?void 0:u.attributes;if(m&&re("DISABLE_SCREEN_SHARE_REMB")){const _=i[c]._hints;(ot(_).call(_,ar.SCREEN_TRACK)||ot(_).call(_,ar.SCREEN_LOW_TRACK))&&(m.remb=!1,D.debug("disable remb for screen share, hints:",_))}return m})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof Br){var n;const o=this.filterTobeUnmutedTracks(e[i]);if(o.length===0)continue;await((n=this.connection)===null||n===void 0?void 0:n.unmuteLocal(o.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(o);return void await sr(this,Ot.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var n;return!((n=this.connection)===null||n===void 0||!n.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,n)=>this.emit(Ot.RequestUpload,e,n),this.statsUploader.requestUploadStats=e=>this.emit(Ot.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await es(_L(this.dtlsFailedCount,gi)),this.emit(Ot.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),n=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),n.length>0&&await Es(this,Ot.RequestUnpublishForReconnectPC,n),this.disconnectForReconnect(),this.emit(Ot.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has($e.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof mr)}throwIfTrackTypeNotMatch(e){if(e.filter(n=>n instanceof mr).length>1)throw new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(n=>n instanceof Br).length>1&&(e.some(n=>n instanceof Br&&n._bypassWebAudio)||!kn().webAudioMediaStreamDest))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const n of e){if(n instanceof mr&&this.pendingLocalTracks.some(i=>i instanceof mr))throw new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n instanceof Br&&this.pendingLocalTracks.some(i=>i instanceof Br)&&(!kn().webAudioMediaStreamDest||n._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Br&&i._bypassWebAudio)))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,n){var i;const o=!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding,c=gh(gh({},{width:160,height:120,framerate:15,bitrate:50}),n);let u;u=o?e._mediaStreamTrack.clone():Cx(e,c);const h=or(8,"track-low-"),m=new mr(u,gh(gh({},o&&{scaleResolutionDownBy:cx(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(b_.TRANSCEIVER_UPDATED,_=>{e._updateRtpTransceiver(_,Sv.LOW_STREAM)}),m._hints.push(ar.LOW_STREAM),ot(i=e._hints).call(i,ar.SCREEN_TRACK)&&m._hints.push(ar.SCREEN_LOW_TRACK),e.on("sei-to-send",_=>{m.emit("sei-to-send",_)}),e.addListener(gt.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,n,i){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof fh){var c,u,h,m;const _=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:y,dtlsTransportState:S,peerConnectionState:w}=this.connection,{local:A,remote:k}=await this.connection.getSelectedCandidatePair();wt.pcStats(this.store.sessionId,{startTime:_,eventElapse:e-_||0,iceconnectionsate:y,dtlsstate:S,connectionstate:w,intSucc:n?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(c=A==null?void 0:A.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=A.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(A.address,":").concat(A.port),selectedRemoteCandidateProtocol:(h=k.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=k.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(k.address,":").concat(k.port),restartCnt:i,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,n,i,o){var c;const u=Array.from(Pc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");wt.firstRemoteVideoDecode(this.store.sessionId,Di.FIRST_VIDEO_DECODE,br.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:n,videoheight:i,subscribeElapse:Ps.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(e,n,i){if(!this.connection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(n);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[n,{track:i}]=e;n===$e.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Sv.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},Et(un.prototype,"startP2PConnection",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"startP2PConnection"),un.prototype),Et(un.prototype,"connect",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"connect"),un.prototype),Et(un.prototype,"updateRemoteRTPCapabilities",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"updateRemoteRTPCapabilities"),un.prototype),Et(un.prototype,"publishDataChannel",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"publishDataChannel"),un.prototype),Et(un.prototype,"unpublish",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"unpublish"),un.prototype),Et(un.prototype,"unpublishDataChannel",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"unpublishDataChannel"),un.prototype),Et(un.prototype,"unpublishLowStream",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"unpublishLowStream"),un.prototype),Et(un.prototype,"subscribeDataChannel",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"subscribeDataChannel"),un.prototype),Et(un.prototype,"subscribe",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"subscribe"),un.prototype),Et(un.prototype,"massSubscribe",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"massSubscribe"),un.prototype),Et(un.prototype,"unsubscribe",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"unsubscribe"),un.prototype),Et(un.prototype,"unsubscribeDataChannel",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"unsubscribeDataChannel"),un.prototype),Et(un.prototype,"massUnsubscribe",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"massUnsubscribe"),un.prototype),Et(un.prototype,"muteRemote",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"muteRemote"),un.prototype),Et(un.prototype,"unmuteRemote",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"unmuteRemote"),un.prototype),Et(un.prototype,"hasRemoteMediaWithLock",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"hasRemoteMediaWithLock"),un.prototype),Et(un.prototype,"disconnectForReconnect",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"disconnectForReconnect"),un.prototype),Et(un.prototype,"updateBitrateLimit",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"updateBitrateLimit"),un.prototype),Et(un.prototype,"remoteMediaSsrcChanged",[Qs],Object.getOwnPropertyDescriptor(un.prototype,"remoteMediaSsrcChanged"),un.prototype),un);function Qs(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(n));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}function m9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function g9(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?m9(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):m9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const Lfe=Date.now(),xfe=20,Ax=new Map,hP=new Map;async function _9(e){const n=Ax.get(e),i=Array.isArray(n)&&n[n.length-1],o=hP.get(e);if(!i)return void(o.isSyncing=!1);const c={uid:i.uid,payload:i.payload};o.firstRecvTs===0&&(o.firstRecvTs=i.recvTs,o.firstSendTs=i.sendTs);const u=i.sendTs-o.firstSendTs,h=u-(Date.now()-o.firstRecvTs);h>0&&(o.firstRecvTs=Date.now()-u);let m=i.mediaDelay+h;m<=0?(n.pop(),E9(i.context,c),m=0):m=Math.min(m,xfe),setTimeout(()=>n.length&&_9(e),m)}function E9(e,n){e.safeEmit(fn.STREAM_MESSAGE,n.uid,n.payload),e.onStreamMessage&&e.onStreamMessage(n)}function Mfe(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return E9(i,{uid:e.uid,payload:e.payload});const o="".concat(i.id,"-").concat(e.uid),c=Ax.get(o)||[],u=c.findIndex(y=>e.sendTs>=y.sendTs),h=g9(g9({},e),{},{context:i,mediaDelay:n,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),Ax.set(o,c);let m=!1;var _;hP.has(o)?m=!((_=hP.get(o))===null||_===void 0||!_.isSyncing):hP.set(o,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||_9(o)}const Ufe=Rn().name;function y9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function v9(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?y9(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):y9(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const zv="websdk_ng_cache_parameter",Vfe=re("MAX_PRELOAD_ASYNC_LENGTH"),Ffe=1e4,M_=new Map,U_=[];let Px=null,Ox=0,kx=0;const pP=new Map,jfe=function(e,n){const i=[];let o=0;const c=async()=>{const u=i.shift();u&&await u(),i.length>0&&o<n?c():o--};return async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return new lt(async(_,y)=>{i.push(async()=>{try{const S=await e(...h);_(S)}catch(S){y(S)}}),o<n&&(o++,c())})}}(S9,Vfe),Nx=Wo.CancelToken.source();async function S9(e,n,i,o,c,u){try{if(!re("ENABLE_PRELOAD"))return;if(!kn().supportWebCrypto)return void Em(()=>{D.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new Le(X.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&Zi(i,"token",1,2047),Zi(e,"appid",1,2047),zA(n),o&&GA(o);const h=S_();D.debug("preload channel ".concat(n,", uid is ").concat(o));const m={appId:e,cname:n,token:i||e,uid:typeof o!="string"?o:null,sid:h,proxyServer:c};let _,y;typeof o=="string"?(m.stringUid=o,[y,_]=await lt.all([Tfe(o,{sid:h,appId:e},Nx.token),zG(v9(v9({},m),{},{token:i||e,uid:0}),Nx.token)]),m.uid=y.uid,_.gatewayInfo.uid=m.uid,_.gatewayInfo.res.uid=m.uid):(u&&(m.stringUid=u),_=await zG(m,Nx.token));const S={sid:h,appId:e,cname:n,token:i||e,uid:m.stringUid||o,intUid:m.uid||_.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:y,ap:_};await async function(w){let A;try{w.uid&&b9({appId:w.appId,cname:w.cname,token:w.token,uid:w.uid,stringUid:w.stringUid});const k=I9(w),W=await async function(V,q){try{const Y=await window.crypto.subtle.importKey("raw",pW(q),"AES-GCM",!1,["encrypt"]),ce=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},Y,v_(window.btoa(JSON.stringify(V))));return ym(new Uint8Array(ce))}catch{return}}(w,w.token||w.appId);if(!W)return;A=C9(zv);const U=A?JSON.parse(A):[];U.push({[k]:W}),U.length>re("AP_CACHE_NUM")&&U.shift(),fP(zv,JSON.stringify(U))}catch(k){D.warn("Error caching server parameters:",k.message),fP(zv,"")}}(S),Ox++}catch(h){throw kx++,function(m){Px||(Px=window.setTimeout(()=>{let y="";pP.forEach((S,w)=>{y+="".concat(w,": ").concat(S," ;")}),wt.reportApiInvoke(null,{name:mi.PRELOAD,options:{success:Ox,failed:kx,err:y}}).onError(m),Ox=0,kx=0,pP.clear(),Px=null},Ffe));const _=pP.get(m.code)||0;pP.set(m.code,_+1)}(h),h}}async function T9(e){try{if(re("AP_REQUEST_DETAIL")||re("ENABLE_ROLE_SELECT_EDGE"))return;const n=b9(e);if(!n||e.cloudProxyServer!=="disabled")return;const i=await async function(o,c){try{const u=await window.crypto.subtle.importKey("raw",pW(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,v_(o));return JSON.parse(window.atob(ym(new Uint8Array(h))))}catch{return}}(n,e.token||e.appId);if(!i||!function(o,c){return o.cname===c.cname&&o.appId===c.appId&&o.token===c.token?c.stringUid?o.stringUid===c.stringUid:typeof c.uid=="number"?o.uid===c.uid:o.uid==c.uid:!1}(i,e))return;if(i&&Date.now()-i.ts<re("AP_CACHE_LIFETIME"))return i}catch(n){D.warn("Error get preloadInfo",n.message)}}function b9(e){let n;try{if(n=C9(zv),!n)return;const i=JSON.parse(n),o=I9(e),c=function(h,m){for(let _=h.length-1;_>=0;_--)if(m(h[_]))return _;return-1}(i,h=>o in h);if(c===-1)return;const u=i.splice(c,1)[0];return fP(zv,JSON.stringify(i)),u[o]}catch(i){D.warn("Error delete preload info: ".concat(n),i.message),fP(zv,"")}}function Dx(e){if(e){let n=M_.get(e);n&&(window.clearTimeout(n),n=null,M_.delete(e)),ot(U_).call(U_,e)||e.cloudProxyServer!=="disabled"||U_.push(e)}if(M_.size<re("AP_CACHE_NUM")&&U_.length>0){const n=U_.shift();M_.set(n,window.setTimeout(async()=>{const{appId:i,cname:o,token:c,stringUid:u,uid:h,proxyServer:m}=n;try{await jfe(i,o,c,h,m,u),M_.has(n)&&Dx(n)}catch(_){D.warn("update preload failed",_.message),w9(n)}},re("AP_UPDATE_INTERVAL")))}}function w9(e){const n=U_.indexOf(e);n!==-1&&U_.splice(n,1);let i=M_.get(e);i&&(window.clearTimeout(i),i=null,M_.delete(e),Dx())}function R9(e,n){const i=e.sua,o=e.ap;n&&i&&wt.reqUserAccount(e.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:n,uid:e.intUid,errorCode:null,extend:i.req}),wt.reportResourceTiming(e.ap.url,e.sid),wt.joinWebProxyAP(e.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[ai.CHOOSE_SERVER,ai.CLOUD_PROXY_FALLBACK].toString()}),wt.joinChooseServer(e.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[ai.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function C9(e){return window.atob(window.localStorage.getItem(e)||"")}function fP(e,n){window.localStorage.setItem(e,window.btoa(n))}function I9(e){let n="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(n+="_s_".concat(e.uid)),typeof e.uid=="number"&&(n+="_".concat(e.uid)),e.token&&(n+="_".concat(e.token)),vW(n)}function Bfe(e){let n=function(){const i=Gfe.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,o){let c=i.appId;c!==void 0&&(ui(o,10),Pm(o,c));let u=i.cid;u!==void 0&&(ui(o,16),ui(o,u));let h=i.cname;h!==void 0&&(ui(o,26),Pm(o,h));let m=i.deviceId;m!==void 0&&(ui(o,34),Pm(o,m));let _=i.elapse;_!==void 0&&(ui(o,40),Om(o,_));let y=i.fileSize;y!==void 0&&(ui(o,48),Om(o,Gv(y)));let S=i.height;S!==void 0&&(ui(o,56),Om(o,Gv(S)));let w=i.jpg;w!==void 0&&(ui(o,66),ui(o,w.length),P9(o,w));let A=i.networkType;A!==void 0&&(ui(o,72),Om(o,Gv(A)));let k=i.osType;k!==void 0&&(ui(o,80),Om(o,Gv(k)));let W=i.requestId;W!==void 0&&(ui(o,90),Pm(o,W));let U=i.sdkVersion;U!==void 0&&(ui(o,98),Pm(o,U));let V=i.sequence;V!==void 0&&(ui(o,104),Om(o,Gv(V)));let q=i.sid;q!==void 0&&(ui(o,114),Pm(o,q));let Y=i.timestamp;Y!==void 0&&(ui(o,120),Om(o,Y));let ce=i.uid;ce!==void 0&&(ui(o,128),ui(o,ce));let _e=i.vid;_e!==void 0&&(ui(o,136),ui(o,_e));let Ee=i.width;Ee!==void 0&&(ui(o,144),Om(o,Gv(Ee)));let me=i.service;me!==void 0&&(ui(o,152),ui(o,me));let ke=i.callbackData;ke!==void 0&&(ui(o,162),ui(o,ke.length),P9(o,ke));let Ye=i.ticket;Ye!==void 0&&(ui(o,170),Pm(o,Ye));let ut=i.vendorConfigs;ut!==void 0&&(ui(o,178),Pm(o,ut))}(e,n),function(i){let o=i.bytes,c=i.limit;return o.length===c?o:o.subarray(0,c)}(n)}function Wfe(e){return function(i){let o={};e:for(;!Hfe(i);){let c=Sb(i);switch(c>>>3){case 0:break e;case 1:o.code=Sb(i);break;case 2:o.msg=O9(i,Sb(i));break;case 3:o.requestId=O9(i,Sb(i));break;case 4:o.timestamp=$fe(i,!1);break;default:zfe(i,7&c)}}return o}({bytes:n=e,offset:0,limit:n.length});var n}function zfe(e,n){switch(n){case 0:for(;128&cu(e););break;case 2:Lx(e,Sb(e));break;case 5:Lx(e,4);break;case 1:Lx(e,8);break;default:throw new Error("Unimplemented type: "+n)}}function Gv(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Gfe=[];function Lx(e,n){if(e.offset+n>e.limit)throw new Error("Skip past limit");e.offset+=n}function Hfe(e){return e.offset>=e.limit}function mP(e,n){let i=e.bytes,o=e.offset,c=e.limit,u=o+n;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function A9(e,n){let i=e.offset;if(i+n>e.limit)throw new Error("Read past limit");return e.offset+=n,i}function P9(e,n){let i=mP(e,n.length);e.bytes.set(n,i)}function O9(e,n){let i=A9(e,n),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<n;m++){let _,y,S,w,A=c[m+i];(128&A)==0?h+=o(A):(224&A)==192?m+1>=n?h+=u:(_=c[m+i+1],(192&_)!=128?h+=u:(w=(31&A)<<6|63&_,w<128?h+=u:(h+=o(w),m++))):(240&A)==224?m+2>=n?h+=u:(_=c[m+i+1],y=c[m+i+2],(49344&(_|y<<8))!=32896?h+=u:(w=(15&A)<<12|(63&_)<<6|63&y,w<2048||w>=55296&&w<=57343?h+=u:(h+=o(w),m+=2))):(248&A)==240?m+3>=n?h+=u:(_=c[m+i+1],y=c[m+i+2],S=c[m+i+3],(12632256&(_|y<<8|S<<16))!=8421504?h+=u:(w=(7&A)<<18|(63&_)<<12|(63&y)<<6|63&S,w<65536||w>1114111?h+=u:(w-=65536,h+=o(55296+(w>>10),56320+(1023&w)),m+=3))):h+=u}return h}function Pm(e,n){let i=n.length,o=0;for(let h=0;h<i;h++){let m=n.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+n.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}ui(e,o);let c=mP(e,o),u=e.bytes;for(let h=0;h<i;h++){let m=n.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+n.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function cu(e){return e.bytes[A9(e,1)]}function k9(e,n){let i=mP(e,1);e.bytes[i]=n}function Sb(e){let n,i=0,o=0;do n=cu(e),i<32&&(o|=(127&n)<<i),i+=7;while(128&n);return o}function ui(e,n){for(n>>>=0;n>=128;)k9(e,127&n|128),n>>>=7;k9(e,n)}function $fe(e,n){let i,o=0,c=0,u=0;return i=cu(e),o=127&i,128&i&&(i=cu(e),o|=(127&i)<<7,128&i&&(i=cu(e),o|=(127&i)<<14,128&i&&(i=cu(e),o|=(127&i)<<21,128&i&&(i=cu(e),c=127&i,128&i&&(i=cu(e),c|=(127&i)<<7,128&i&&(i=cu(e),c|=(127&i)<<14,128&i&&(i=cu(e),c|=(127&i)<<21,128&i&&(i=cu(e),u=127&i,128&i&&(i=cu(e),u|=(127&i)<<7))))))))),{low:o|c<<28,high:c>>>4|u<<24,unsigned:n}}function Om(e,n){let i=n.low>>>0,o=(n.low>>>28|n.high<<4)>>>0,c=n.high>>>24,u=c===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=mP(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:m[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:m[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:m[h]=u!==1?128|i:127&i}}const N9={},D9={},gP=4294967296,Kfe=gP*gP,qfe=Kfe/2;x9(0,!0);const L9=x9(0),Yfe=Tb(0,-2147483648,!1),Xfe=Tb(-1,2147483647,!1);function x9(e,n){let i,o,c;return n?(c=0<=(e>>>=0)&&e<256)&&(o=D9[e],o)?o:(i=Tb(e,0,!0),c&&(D9[e]=i),i):(c=-128<=(e|=0)&&e<128)&&(o=N9[e],o)?o:(i=Tb(e,e<0?-1:0,!1),c&&(N9[e]=i),i)}function Tb(e,n,i){return{low:0|e,high:0|n,unsigned:!!i}}function M9(e,n){if(isNaN(e))return L9;{if(e<=-9223372036854776e3)return Yfe;if(e+1>=qfe)return Xfe}return e<0?L9:Tb(e%gP|0,e/gP|0,n)}function U9(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}class xx extends Ar{get connectionState(){return this._connectionState}set connectionState(n){if(this._connectionState===n)return;const i=this._connectionState;this._connectionState=n,this.emit(hd.CONNECTION_STATE_CHANGE,n,i)}get quality(){return this._quality}set quality(n){this._quality=n>1?1:n<.1?.1:n,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(n){var i;super(),$(this,"name","AgoraRTCImageModeration"),$(this,"_connectionState",gl.CONNECTING),$(this,"_sequence",0),$(this,"_moderationStartTime",void 0),$(this,"_workerConnection",void 0),$(this,"_workerMessageLengthLimit",void 0),$(this,"_qualityRatio",void 0),$(this,"_connectInfo",void 0),$(this,"_cancelTokenSource",Wo.CancelToken.source()),$(this,"_retryConfig",void 0),$(this,"_moderationInterval",void 0),$(this,"_moderationTimer",null),$(this,"_moderationMode",1),$(this,"_quality",1),$(this,"_qualityTimer",null),$(this,"_ticket",void 0),$(this,"_moderationIntervalMinimum",void 0),$(this,"_uploadFailedNum",0),$(this,"_uploadNum",0),$(this,"_uploadTimer",null),$(this,"_extraInfo",void 0),$(this,"_vendor",""),$(this,"_encoder",new TextEncoder),$(this,"_moderationId",void 0),$(this,"inspectImage",()=>{if(this.connectionState!==gl.CONNECTED)throw new Oe(X.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===gl.CONNECTED?this.requestToInspectImage():D.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=or(5,"image-moderation-"),this._workerMessageLengthLimit=re("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=re("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=n.interval)!==null&&i!==void 0?i:1e3,n.extraInfo&&(this._extraInfo=this._encoder.encode(n.extraInfo)),n.vendor&&(this._vendor=n.vendor),this._qualityRatio=re("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new db("worker-"+this._moderationId,gi),this.on(hd.STATE_CHANGE,(o,c)=>{D.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Dv[o]," ").concat(c||""))}),this.handleWorkerEvents()}async init(n,i){this.emit(hd.STATE_CHANGE,Dv.CONNECT_AP),this._connectInfo=n;const o=this._cancelTokenSource.token;return this._retryConfig=i,new lt((c,u)=>{this.on(hd.CONNECTION_STATE_CHANGE,(h,m)=>{h===gl.CONNECTED&&c()}),this.requestAP(n,o,i).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(n){var i;this._moderationInterval=(i=n.interval)!==null&&i!==void 0?i:1e3,n.extraInfo&&(this._extraInfo=this._encoder.encode(n.extraInfo)),n.vendor&&(this._vendor=n.vendor),D.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(n))),this.connectionState===gl.CONNECTED&&this.inspectImage()}async requestAP(n,i,o){const c=re("WEBCS_DOMAIN").map(_=>"https://".concat(_,"/api/v1")),u=await function(_,y,S,w){let{appId:A,areaCode:k,cname:W,sid:U,token:V,uid:q}=y;Fv++;const Y="moderation_plugin",ce={service_name:Y,json_body:JSON.stringify({appId:A,areaCode:k,cname:W,command:"allocateEdge",requestId:Fv,seq:Fv,sid:U,appToken:V,ts:Date.now(),uid:q+""})};let _e,Ee,me=_[0];return cd(async()=>{_e=Date.now();const ke=await pd(me,{data:ce,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Ee=Date.now()-_e,ke.code!==0){const pt=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+ke.code,{retry:!0,responseTime:Ee});throw D.error(pt.toString()),pt}const Ye=JSON.parse(ke.json_body);if(Ye.code!==200){const pt=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ye.code,", reason: ").concat(Ye.reason),{code:Ye.code,responseTime:Ee});throw D.error(pt.toString()),pt}if(!Ye.servers||!Array.isArray(Ye.servers)||Ye.servers.length===0){const pt=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ye.code,responseTime:Ee});throw D.error(pt.toString()),pt}if(!Ye.servers.some(pt=>!!pt.wss)){const pt=new Oe(X.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ye.code,responseTime:Ee});throw D.error(pt.toString()),pt}const ut=re("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ye.servers.map(pt=>{let{address:yn,wss:vn}=pt;if(yn&&vn)return"wss://".concat(yn.replace(/\./g,"-"),".").concat(ut,":").concat(vn,"/moderation")}).filter(pt=>!!pt),workerToken:Ye.workerToken,vid:Ye.vid,ticket:Ye.appTicket,responseTime:Ee}},(ke,Ye)=>(wt.apworkerEvent(U,{success:!0,sc:200,serviceName:Y,responseDetail:JSON.stringify(ke.addressList),firstSuccess:Ye===0,responseTime:Ee,serverIp:_[Ye%_.length]}),!1),(ke,Ye)=>(wt.apworkerEvent(U,{success:!1,sc:ke.data&&ke.data.code||200,serviceName:Y,responseTime:Ee,serverIp:_[Ye%_.length]}),!!(ke.code!==X.OPERATION_ABORTED&&ke.code!==X.UNEXPECTED_RESPONSE||ke.data&&ke.data.retry)&&(me=_[(Ye+1)%_.length],!0)),w)}(c,n,i,o);this.emit(hd.STATE_CHANGE,Dv.AP_CONNECTED);const{addressList:h,ticket:m}=u;return this._ticket=m,h}async connectWorker(n){this.emit(hd.STATE_CHANGE,Dv.CONNECT_WORKER),await this._workerConnection.init(n,1e4)}handleWorkerEvents(){this._workerConnection.on(Kt.CONNECTED,async()=>{this.emit(hd.STATE_CHANGE,Dv.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=gl.CONNECTED}),this._workerConnection.on(Kt.CLOSED,()=>{this.connectionState=gl.CLOSED}),this._workerConnection.on(Kt.FAILED,()=>{this.connectionState=gl.CLOSED}),this._workerConnection.on(Kt.RECONNECTING,()=>{this.connectionState=this.connectionState===gl.CONNECTED?gl.RECONNECTING:gl.CONNECTING}),this._workerConnection.on(Kt.ON_MESSAGE,async n=>{if(n.data instanceof ArrayBuffer){const i=Wfe(new Uint8Array(n.data));re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&D.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,D.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{wt.reportApiInvoke(this._connectInfo.sid||null,{name:mi.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:Lr.TRACER}).onError(new Oe(X.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},re("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else D.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Kt.WILL_RECONNECT,(n,i,o)=>{n==="recover"&&o(n),o("tryNext")}),this._workerConnection.on(Kt.REQUEST_NEW_URLS,(n,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(n).catch(i)})}static intToLong(n){return{low:n|=0,high:n>>31,unsigned:n>=0}}async requestToInspectImage(){const n=Ic(this,hd.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(n){if(!n.isPlaying)return void(re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&D.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(n,i);this._workerConnection.sendMessage(o,!0,!0)}else re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&D.debug("Only the track being published can be inspected")}async generateRequestData(n,i){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_}=i;const y=Date.now(),S=await n.getCurrentFrameImage("image/jpeg",this.quality),w=await l8(S,o,c),A=this._sequence+"-"+u+"-"+_+"-"+y+"-"+or(12,""),k={appId:o,cid:u,cname:c,deviceId:"",elapse:xx.intToLong(Number(y-this._moderationStartTime)),fileSize:S.buffer.byteLength,height:S.height,width:S.width,jpg:w,networkType:6,osType:7,requestId:A,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:M9(y),uid:_,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete k.callbackData;const W=Bfe(k);if(W.byteLength<this._workerMessageLengthLimit){if(re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const U=function(V){for(var q=1;q<arguments.length;q++){var Y=arguments[q]!=null?arguments[q]:{};q%2?U9(Object(Y),!0).forEach(function(ce){$(V,ce,Y[ce])}):Object.getOwnPropertyDescriptors?Object.defineProperties(V,Object.getOwnPropertyDescriptors(Y)):U9(Object(Y)).forEach(function(ce){Object.defineProperty(V,ce,Object.getOwnPropertyDescriptor(Y,ce))})}return V}({},k);delete U.jpg,D.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(U))}return W}{const U=this.quality*this._qualityRatio;return this.quality=U,await this.generateRequestData(n,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Wo.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=gl.CLOSED,this.emit(hd.STATE_CHANGE,Dv.CLOSED)}}function V9(e){if(er(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Oe(X.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Oe(X.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Jfe={name:"ImageModeration",create:function(e){let{config:n}=e;return V9(n),new xx(n)}};var F9,j9,B9,W9,z9,G9,H9,$9,K9,q9,Y9,X9,J9,Q9,Z9,eH,tH,nH,rH,iH,sH,oH,aH,cH,lH,uH,dH,hH,pH,fH,mH,gH,_H,EH,yH,vH,SH,TH,bH,wH,RH,ht;function CH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function lu(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?CH(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):CH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}Cs.setLogger(D);let Qfe=(F9=xt(),j9=xt({argsMap:(e,n)=>{if(!Array.isArray(n)){if(!(n instanceof Rv))return[n];n=[n]}return n.map(i=>i?Object(i).toString():"null")}}),B9=xt({argsMap:(e,n)=>(n||(n=[]),Array.isArray(n)||n.trackMediaType!==wv.DATA?(Array.isArray(n)||(n=[n]),n.map(i=>i.getTrackId())):[n.getChannelId()])}),W9=xt({argsMap:(e,n,i,o)=>[typeof n=="object"?n.uid:n,i,o]}),z9=xt({argsMap:(e,n,i)=>[n,i]}),G9=xt({argsMap:(e,n)=>n.map(i=>{let{user:o,mediaType:c}=i;return[o==null?void 0:o.uid,c]})}),H9=xt({argsMap:(e,n,i,o)=>[typeof n=="object"?n.uid:n,i,o]}),$9=xt({argsMap:(e,n)=>n.map(i=>{let{user:o,mediaType:c}=i;return{uid:o==null?void 0:o.uid,mediaType:c}})}),K9=xt(),q9=xt(),Y9=xt(),X9=xt(),J9=xt(),Q9=xt(),Z9=xt(),eH=xt(),tH=xt(),nH=xt(),rH=xt(),iH=xt(),sH=xt(),oH=xt(),aH=xt(),cH=xt({argsMap:(e,n)=>[n]}),lH=xt(),uH=xt(),dH=xt(),hH=xt(),pH=xt(),fH=xt(),mH=xt(),gH=xt(),_H=xt({argsMap:(e,n)=>(Array.isArray(n)||(n=[n]),[JSON.stringify(n)])}),EH=xt(),yH=xt(),vH=xt(),SH=xt(),TH=xt(),bH=xt(),wH=xt({reportResult:!0}),RH=xt(),ht=class extends Ar{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,n){let i;if(super(),$(this,"store",void 0),$(this,"_uid",void 0),$(this,"_channelName",void 0),$(this,"_uintUid",void 0),$(this,"_users",[]),$(this,"_config",void 0),$(this,"_clientId",void 0),$(this,"_appId",void 0),$(this,"_sessionId",null),$(this,"_key",void 0),$(this,"_rtmConfig",{}),$(this,"_joinInfo",void 0),$(this,"_gateway",void 0),$(this,"_statsCollector",void 0),$(this,"_configDistribute",void 0),$(this,"_leaveMutex",void 0),$(this,"_publishMutex",void 0),$(this,"_renewTokenMutex",void 0),$(this,"_subscribeMutex",void 0),$(this,"_encryptionMode","none"),$(this,"_encryptionSecret",null),$(this,"_encryptionSalt",null),$(this,"_encryptDataStream",!1),$(this,"_encryptDataStreamKey",null),$(this,"_encryptDataStreamIv",null),$(this,"_proxyServer",void 0),$(this,"_turnServer",{servers:[],mode:"auto"}),$(this,"_cloudProxyServerMode","disabled"),$(this,"_isDualStreamEnabled",!1),$(this,"_defaultStreamFallbackType",void 0),$(this,"_lowStreamParameter",void 0),$(this,"_streamFallbackTypeCacheMap",new Map),$(this,"_remoteStreamTypeCacheMap",new Map),$(this,"_axiosCancelSource",Wo.CancelToken.source()),$(this,"_audioVolumeIndicationInterval",void 0),$(this,"_networkQualityInterval",void 0),$(this,"_userOfflineTimeout",void 0),$(this,"_streamRemovedTimeout",void 0),$(this,"_liveTranscodeStreamingClient",void 0),$(this,"_liveRawStreamingClient",void 0),$(this,"_channelMediaRelayClient",void 0),$(this,"_networkQualitySensitivity","normal"),$(this,"_p2pChannel",void 0),$(this,"_useLocalAccessPoint",!1),$(this,"_setLocalAPVersion",void 0),$(this,"_joinAndNotLeaveYet",!1),$(this,"_numberOfJoinCount",0),$(this,"_remoteDefaultVideoStreamType",void 0),$(this,"_inspect",void 0),$(this,"_moderation",void 0),$(this,"_license",void 0),$(this,"_pendingPublishedUsers",[]),$(this,"ntpAlignErrorCount",0),$(this,"remoteInboundOffset",0),$(this,"_peerConnectionState",void 0),$(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),$(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),$(this,"_handleUserOnline",c=>{if(re("BLOCK_LOCAL_CLIENT")&&P_(c.uid,this.channelName))return void D.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&D.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(fn.USER_JOINED,u));else{const h=new Im(c.uid,c.uint_id||c.uid);this._users.push(h),D.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(fn.USER_JOINED,h)}}),$(this,"_handleUserOffline",c=>{if(re("BLOCK_LOCAL_CLIENT")&&P_(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:EA(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),D.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(fn.USER_LEAVED,u,c.reason))}),$(this,"_handleAddAudioOrVideoStream",(c,u,h,m,_,y,S)=>{if(re("BLOCK_LOCAL_CLIENT")&&P_(u,this.channelName))return;const w=this._users.find(k=>k.uid===u);if(!w)return void D.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));D.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(w.uid,c,void 0,void 0,void 0,Date.now());const A=c==="audio"?w.hasAudio:w.hasVideo;w._uintid||(w._uintid=_||u),c==="audio"?w._trust_audio_stream_added_state_=!0:w._trust_video_stream_added_state_=!0,c==="audio"?(w._audio_added_=!0,h!==void 0&&(w._audioSSRC=h),m!==void 0&&(w._cname=m),y&&(w._audioOrtc=y)):(w._video_added_=!0,h!==void 0&&(w._videoSSRC=h),m!==void 0&&(w._cname=m),S!==void 0&&(w._rtxSsrcId=S),y&&(w._videoOrtc=y)),(c==="audio"?w.hasAudio:w.hasVideo)&&!A&&(D.info("[".concat(this._clientId,"] remote user ").concat(w.uid," published ").concat(c)),this.safeEmit(fn.USER_PUBLISHED,w,c)),c==="video"?wt.onGatewayStream(this._sessionId,Di.ON_ADD_VIDEO_STREAM,br.ON_ADD_VIDEO_STREAM,{peer:_||u,ssrc:w._videoSSRC}):wt.onGatewayStream(this._sessionId,Di.ON_ADD_AUDIO_STREAM,br.ON_ADD_AUDIO_STREAM,{peer:_||u,ssrc:w._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(w,c,h).then(k=>{if(k&&(D.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(w.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof vb))return this._p2pChannel.unsubscribe(w,c,!0).then(()=>this._subscribe(w,c,!0).catch(W=>{D.error("[".concat(this._clientId,"] resubscribe error"),W.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(w,c)&&(D.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(w.uid," after reconnect.")),this._subscribe(w,c,!0).catch(k=>{D.error("[".concat(this._clientId,"] resubscribe error"),k.toString())}))}),$(this,"_handleRemoveStream",c=>{if(re("BLOCK_LOCAL_CLIENT")&&P_(c.uid,this.channelName))return;const u=this._users.find(m=>m.uid===c.uid);if(!u)return void D.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));D.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(fn.USER_UNPUBLISHED,u,"audio"),D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(fn.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(fn.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(fn.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof vb&&this._p2pChannel.unsubscribe(u).then(m=>{if(m)return this._gateway.unsubscribe(m,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),wt.onGatewayStream(this._sessionId,Di.ON_REMOVE_STREAM,br.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),$(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(re("BLOCK_LOCAL_CLIENT")&&P_(u,this.channelName))return;const m=this._users.find(S=>S.uid===u);if(!m)return void D.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));D.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const _=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const S=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===S)return;{const w=m._audio_enabled_?"enable-local-audio":"disable-local-audio";D.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(w)),this.safeEmit(fn.USER_INFO_UPDATED,u,w)}}else{m._trust_video_enabled_state_=!0;const S=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===S)return;{const w=m._video_enabled_?"enable-local-video":"disable-local-video";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(w)),this.safeEmit(fn.USER_INFO_UPDATED,u,w)}}const y=c==="audio"?m.hasAudio:m.hasVideo;return _!==y?!_&&y?(D.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(fn.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),D.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(fn.USER_UNPUBLISHED,m,c)):void 0}),$(this,"_handleMuteStream",(c,u,h)=>{if(re("BLOCK_LOCAL_CLIENT")&&P_(c,this.channelName))return;D.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const m=this._users.find(S=>S.uid===c);if(!m)return void D.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const _=u==="audio"?m.hasAudio:m.hasVideo;if(u==="audio"){m._trust_audio_mute_state_=!0;const S=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===S)return;{const w=m._audio_muted_?"mute-audio":"unmute-audio";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(w)),this.safeEmit(fn.USER_INFO_UPDATED,c,w)}}else{m._trust_video_mute_state_=!0;const S=m._video_muted_;if(m._video_muted_=h,m._video_muted_===S)return;{const w=m._video_muted_?"mute-video":"unmute-video";D.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(w)),this.safeEmit(fn.USER_INFO_UPDATED,c,w)}}const y=u==="audio"?m.hasAudio:m.hasVideo;if(_!==y){if(!_&&y)return(u==="audio"?m._audioSSRC:m._videoSSRC)?(D.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(fn.USER_PUBLISHED,m,u)):void D.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),u==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,u),D.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(fn.USER_UNPUBLISHED,m,u)}}),$(this,"_handleP2PLost",async c=>{D.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():D.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),$(this,"_handleTokenWillExpire",()=>{D.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(fn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),$(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),D.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),$(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(fn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(fn.NETWORK_QUALITY,c)}),$(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,m)=>{const _=this._users.find(S=>S.uid===u);if(!_)return void D.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));D.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(_.uid,c,void 0,void 0,void 0,Date.now());const y=c==="audio"?_.hasAudio:_.hasVideo;c==="audio"?_._trust_audio_stream_added_state_=!0:_._trust_video_stream_added_state_=!0,c==="audio"?(_._audio_added_=!0,h!==void 0&&(_._audioSSRC=h),m!==void 0&&(_._audioMid=m)):(_._video_added_=!0,h!==void 0&&(_._videoSSRC=h),m!==void 0&&(_._videoMid=m)),(c==="audio"?_.hasAudio:_.hasVideo)&&!y&&(D.info("[".concat(this._clientId,"] remote user ").concat(_.uid," published ").concat(c)),this.safeEmit(fn.USER_PUBLISHED,_,c)),this._p2pChannel.hasPendingRemoteMedia(_,c)&&(D.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(_.uid," after reconnect.")),this._subscribe(_,c,!0).catch(S=>{D.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._config=e,this._clientId=n||or(5,"client-"),this.store=new class{constructor(c,u,h,m){Wt(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:T_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(u,h){switch(h.type){case mn.SET_SESSION_ID:return ft(ft({},u),{},{sessionId:h.sessionId});case mn.SET_P2P_ID:return ft(ft({},u),{},{p2pId:h.p2pId});case mn.SET_UID:return ft(ft({},u),{},{uid:h.uid});case mn.SET_INT_UID:return ft(ft({},u),{},{intUid:h.intUid});case mn.SET_PUB_ID:return ft(ft({},u),{},{pubId:h.pubId});case mn.KEY_METRIC_CLIENT_CREATED:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{clientCreated:h.metric})});case mn.KEY_METRIC_JOIN_START:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{joinStart:h.metric})});case mn.AVOID_JOIN_START:return ft(ft({},u),{},{avoidJoinStart:h.avoidJoinStart});case mn.KEY_METRIC_JOIN_END:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{joinEnd:h.metric})});case mn.KEY_METRIC_REQUEST_AP_START:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{requestAPStart:h.metric})});case mn.KEY_METRIC_REQUEST_AP_END:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{requestAPEnd:h.metric})});case mn.KEY_METRIC_JOIN_GATEWAY_START:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case mn.KEY_METRIC_JOIN_GATEWAY_END:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case mn.KEY_METRIC_PEER_CONNECTION_START:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case mn.KEY_METRIC_PEER_CONNECTION_END:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case mn.KEY_METRIC_DESCRIPTION_START:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{descriptionStart:h.metric})});case mn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case mn.KEY_METRIC_ICE_CONNECTION_END:return ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case mn.KEY_METRIC_PUBLISH:{const m=u.keyMetrics.publish,_=m.findIndex(y=>y.trackId===h.metric.trackId);return _!==-1?(m[_]=ft(ft({},m[_]),h.metric),ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{publish:[...m]})})):ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case mn.KEY_METRIC_SUBSCRIBE:{const m=u.keyMetrics.subscribe,_=m.findIndex(y=>y.userId===h.metric.userId&&y.type===h.metric.type);return _!==-1?(m[_]=ft(ft({},m[_]),h.metric),ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{subscribe:[...m]})})):ft(ft({},u),{},{keyMetrics:ft(ft({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case mn.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case mn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=ft(ft({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case mn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case mn.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[]},u;case mn.SET_USE_P2P:return ft(ft({},u),{},{useP2P:h.val});case mn.SET_TRANSPORT_TYPE:return ft(ft({},u),{},{p2pTransport:h.val});default:return u}}(this.state,c)}set sessionId(c){this.dispatch({type:mn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:mn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:mn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:mn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:mn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:mn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:mn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:mn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:mn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:mn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:mn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:mn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:mn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:mn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:mn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:mn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:mn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:mn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:mn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:mn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:mn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,m){this.dispatch({type:mn.KEY_METRIC_PUBLISH,metric:ft(ft({trackId:c,type:u},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,u,h,m,_,y,S){this.dispatch({type:mn.KEY_METRIC_SUBSCRIBE,metric:ft(ft(ft(ft(ft({userId:c,type:u},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),_&&{firstFrame:_}),y&&{streamAdded:y}),S&&{firstDecoded:S})})}massSubscribe(c,u,h,m){c.forEach(_=>{this.dispatch({type:mn.KEY_METRIC_SUBSCRIBE,metric:ft(ft(ft({userId:_.userId,type:_.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:mn.RECORD_JOIN_CHANNEL_SERVICE,record:ft(ft({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:mn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:mn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:mn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:mn.AVOID_JOIN_START,avoidJoinStart:c})}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new Cs("client-leave",this._clientId),this._publishMutex=new Cs("client-publish",this._clientId),this._renewTokenMutex=new Cs("client-renewtoken",this._clientId),this._subscribeMutex=new Cs("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),D.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(pl," build: ").concat(IL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{fL(e.clientRoleOptions),i=Object.assign({},e.clientRoleOptions)}catch(c){D.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var o;this._statsCollector=new Eb(this.store),this._statsCollector.onStatsException=(c,u,h)=>{D.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),this.safeEmit(fn.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,m)=>{const _=this._users.find(y=>y.uid===c);_&&wt.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:u,videoPublishDuration:h,peer:_._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new gfe(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||gi,httpRetryConfig:e.httpRetryConfig||gi,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:i}),this._configDistribute=new Cfe(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},Gp("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new vb(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,n,i,o,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];Xn("JOIN_GATEWAY_USE_443PORT_ONLY",u),Xn("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof ox&&(m.use443PortOnly=u,m.tryDoubleDomain=h),async function(_,y,S){pA.get(_)||pA.set(_,[]),fA.get(_)||fA.set(_,y),oh.get(_)||oh.set(_,0);const w=pA.get(_),A=fA.get(_);if(!w||!A)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(oh.get(_)===A){const q=YT();w.push(q),await q.promise}oh.set(_,oh.get(_)+1);for(var k=arguments.length,W=new Array(k>3?k-3:0),U=3;U<k;U++)W[U-3]=arguments[U];const V=await S(...W);return oh.set(_,oh.get(_)-1),oh.get(_)===A-1&&w.length>0&&(w[0].resolve(),w.shift()),oh.get(_)===0&&(pA.set(_,[]),fA.set(_,0),oh.set(_,0)),V}("client.join",re("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,n,i,o,c)}async join(e,n,i,o,c){const u=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const h=(SA||SA||(SA=(window.location.protocol.split(":")[0]||"").toUpperCase(),SA))==="HTTPS",m=bW()?window.isSecureContext:"Browser Not Support";(!bW()&&!h||!window.isSecureContext)&&D.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),D.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),wt.setAppId(e);try{if(!i&&i!==null)throw new Oe(X.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&Zi(i,"token",1,2047),Zi(e,"appid",1,2047),zA(n),o&&GA(o),c&&Zi(c,"optionalInfo",1,2047)}catch(U){throw wt.reportApiInvoke(S_(),{name:mi.JOIN,options:[e,n,i,o],states:{isHttps:h,isSecureContext:m},tag:Lr.TRACER}).onError(U),U}if(this._leaveMutex.isLocked&&(D.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),D.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const U=new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw wt.reportApiInvoke(S_(),{name:mi.JOIN,options:[e,n,i,o],states:{isHttps:h,isSecureContext:m},tag:Lr.TRACER}).onError(U),U}this._gateway.state="CONNECTING";const _=await T9({appId:e,cname:n,uid:o,stringUid:typeof o=="string"?o:void 0,token:i||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const y=(_==null?void 0:_.sid)||S_();D.info("[".concat(this._clientId,"] start join channel ").concat(n,", join number: ").concat(u)),this._sessionId||(this._sessionId=y,this.store.sessionId=this._sessionId);const S=wt.reportApiInvoke(y,{id:this._clientId,name:mi.JOIN,options:[e,n,i,o],states:{isHttps:h,isSecureContext:m},tag:Lr.TRACER}),w=lu(lu(lu({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:n,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!_},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:re("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(w.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(w.stringUid=o,this._uintUid?(w.uid=this._uintUid,this._uintUid=void 0):w.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(w.aesmode=this._encryptionMode,w.aespassword=await(async U=>{const V=function(_e){const Ee=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),me=new Uint8Array(new ArrayBuffer(Ee.length));for(let ke=0;ke<Ee.length;ke+=1)me[ke]=Ee.charCodeAt(ke);return me}(),q=await window.crypto.subtle.importKey("spki",V,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),Y=hL(U),ce=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},q,Y);return function(_e){let Ee="";for(let me=0;me<_e.length;me+=1)Ee+=String.fromCharCode(_e[me]);return window.btoa(Ee)}(new Uint8Array(ce))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(w.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const U=new TextEncoder,V=re("USE_PURE_ENCRYPTION_MASTER_KEY")?U.encode(w.appId+this._encryptionSecret+this._encryptionSecret):U.encode(w.appId+w.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(q,Y,ce){const _e=await window.crypto.subtle.importKey("raw",Y,"PBKDF2",!1,["deriveBits","deriveKey"]),Ee=q==="aes-128-gcm2"?128:256,me=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:DW,hash:"SHA-256",salt:ce},_e,Ee+$he);return new Uint8Array(me).subarray(Ee/8)}(this._encryptionMode,V,v_(this._encryptionSalt)),this._encryptDataStreamKey=await async function(q,Y,ce){const _e=await window.crypto.subtle.importKey("raw",Y,"PBKDF2",!1,["deriveBits","deriveKey"]),Ee=q==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:DW,hash:"SHA-256",salt:ce},_e,{name:"AES-GCM",length:Ee},!0,["encrypt","decrypt"])}(this._encryptionMode,V,v_(this._encryptionSalt))}else m?D.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):D.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,D.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:n,appId:e,stringUid:w.stringUid});const A=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&A===this._sessionId&&wt.joinChannelTimeout(this._sessionId,5)},5e3);try{var k;let U;const V=w.cloudProxyServer;if(ot(k=["proxy3","proxy4","proxy5"]).call(k,V)){const Ee=re("PROXY_SERVER_TYPE3");Array.isArray(Ee)?w.proxyServer=Ee[0]:w.proxyServer=Ee}if(wt.setProxyServer(w.proxyServer),D.setProxyServer(w.proxyServer),this.store.requestAPStart(),_){if(D.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(w.stringUid?", ".concat(w.stringUid," => ").concat(_.intUid):""," ")),w.stringUid&&!w.uid&&(w.uid=_.intUid),U={gatewayInfo:_.ap.gatewayInfo},re("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&w.turnServer.mode==="auto")if(_.ap.proxyInfo.addresses.length===0)D.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const Ee=(await fG(_.ap.proxyInfo,_.ap.gatewayInfo.uid)).map(me=>({turnServerURL:me.address,tcpport:me.tcpport||ys.tcpport,udpport:me.udpport||ys.udpport,username:me.username||ys.username,password:me.password||ys.password,forceturn:!1,security:!0}));w.turnServer={mode:"manual",servers:Ee}}R9(_,w.stringUid)}else{if(w.stringUid&&!w.uid){let Ee;[Ee,U]=await lt.all([WG(w.stringUid,w,this._axiosCancelSource.token,this._config.httpRetryConfig||gi,this.store),BG(w,this._axiosCancelSource.token,this._config.httpRetryConfig||gi,!0,this.store)]),D.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(w.stringUid," => ").concat(Ee)),w.uid=Ee,U.gatewayInfo.uid=Ee,U.gatewayInfo.res.uid=Ee}else U=await BG(w,this._axiosCancelSource.token,this._config.httpRetryConfig||gi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(w,this._axiosCancelSource.token),this._configDistribute.on(lb.UPDATE_BITRATE_LIMIT,Ee=>{this._p2pChannel.updateBitrateLimit(Ee)}),this._configDistribute.on(lb.UPDATE_CLIENT_ROLE_OPTIONS,Ee=>{this._setClientRoleOptions(Ee)})},0),this._key=i||e;const q=U.gatewayInfo,Y=w.uid?w.uid:q.uid;this._joinInfo=lu(lu({},w),{},{cid:q.cid,uid:Y,vid:q.vid,apResponse:q.res,apGatewayAddress:q.apGatewayAddress,uni_lbs_ip:q.uni_lbs_ip,gatewayAddrs:q.gatewayAddrs}),this.store.intUid=Y,this.store.cid=q.cid;const ce=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));S.onSuccess(ce),this._appId=e,this._channelName=w.cname,this._uid=ce,this.store.uid=ce,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(gs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const _e=w.stringUid?"string uid: ".concat(w.stringUid,",uid: ").concat(w.uid):"uid: ".concat(this._uid);return D.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(n,",").concat(_e)),setTimeout(()=>{D.startUpload()},5e3),this.store.joinEnd(),W=this,ot(A_).call(A_,W)||A_.push(W),this._cloudProxyServerMode==="disabled"&&kn().supportWebCrypto&&re("ENABLE_PRELOAD")&&Dx(this._joinInfo),ce}catch(U){const V=Array.isArray(U)?U[0]:U;throw V&&V.code===X.OPERATION_ABORTED?D.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),V):D.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),V),V.code!==X.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),S.onError(V),V}var W}_joinGateway(){if(!this._joinInfo||!this._key)throw new Oe(X.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!re("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){D.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(gs()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(n){const i=A_.indexOf(n);i!==-1&&A_.splice(i,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return D.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",jn.LEAVE),D.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Rv))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new Oe(X.INVALID_PARAMS,"param list is empty");const i=e;if(this._gateway.role==="audience")throw new Oe(X.INVALID_OPERATION,"audience can not publish stream");for(const c of i){if(!(c instanceof Rv))throw new Oe(X.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&n)throw new Oe(X.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}D.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),n&&i.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof mr&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(i),D.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw D.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}}async _publishDataChannel(e){er(e.id,"id",0,65535,!0),Up(e.ordered,"ordered"),Zi(e.metadata,"metadata",0,512),D.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const n=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new Oe(X.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re("FORCE_TURN")&&!re("TURN_ENABLE_TCP")&&!re("TURN_ENABLE_UDP"))throw new Oe(X.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=function(c){return NG(c,!1)}(e),o=await this._p2pChannel.publishDataChannel([i]);if(o.length>0){if(typeof i._originDataChannelId!="number")throw D.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Oe(X.CREATE_DATACHANNEL_ERROR);try{await lt.all(o.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await i._waitTillOpen()}catch(c){if(c.code!==X.DISCONNECT_P2P)throw c}}return D.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw D.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{n()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let n=[];if(e)if(Array.isArray(e))n=e;else{if(!(e instanceof Rv))return this._unpublishDataChannel([e]);n=[e]}else this.store.useP2P||await this._unpublishDataChannel(),n=this._p2pChannel.getAllTracks(!0);D.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(n.map(o=>"".concat(o.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(n);o&&await this._gateway.sendExtensionMessage(Qr.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(n);o&&await this._gateway.unpublish(o,this._uid),D.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(n.map(c=>"".concat(c.getTrackId()))))}}catch(o){throw D.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),D.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));const n=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),D.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(o=>"".concat(o.id))))}catch(i){throw D.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{n&&n()}}async subscribe(e,n,i){if(!(e instanceof Im)){const o=this.remoteUsers.find(c=>c.uid===e);if(!o)throw new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");e=o}return n==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,n)}async presubscribe(e,n){if(Ci(n,"mediaType",["audio","video"]),this.store.useP2P)throw new Oe(X.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const i=n===mt.AUDIO,o=n===mt.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:m,cname:_,uint_id:y}=await this._gateway.presubscribe(e,n,!0);if(u==null)throw new Oe(X.UNEXPECTED_RESPONSE,"no ssrc id");let S=this._users.find(A=>A.uid===e);S||(S=new Im(e,y||e),S._is_pre_created=!0,this._users.push(S)),_&&(S._cname=_),S._uintid||(S._uintid=y||e),i&&(S._audioSSRC=u,S._audio_pre_subscribed=!0,h&&(S._audioOrtc=h)),o&&(S._videoSSRC=u,S._video_pre_subscribed=!0,h&&(S._videoOrtc=h),m!=null&&(S._rtxSsrcId=m)),D.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(S,n,u,m,h);const w=i?S._audioTrack:S._videoTrack;if(!w)throw new Oe(X.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(S._trust_audio_stream_added_state_=!0,S._audio_added_=!0),o&&(S._trust_video_stream_added_state_=!0,S._video_added_=!0),w}catch(u){throw D.error("[".concat(this._clientId,"] presub user ").concat(e," error"),u),u}finally{c()}}async _subscribeDataChannel(e,n){var i;if(er(n,"channelId",0,65535,!0),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===e))throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new Oe(X.INVALID_REMOTE_USER,"user is not published");const c=(i=e._dataChannels)===null||i===void 0?void 0:i.find(m=>m.id===n);if(!c)throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(e,[c]);if(m&&ot(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Oe(X.CREATE_DATACHANNEL_ERROR);const _={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(e.uid,_,!0),await c._waitTillOpen()}catch(_){if((_==null?void 0:_.code)!==X.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[c]),_;await this._p2pChannel.unsubscribeDataChannel(e,[c]),this._p2pChannel.setPendingRemoteDataChannel(e,c.id)}return D.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(e,n,i){if(Ci(n,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e)){const u=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){const u=new Oe(X.INVALID_REMOTE_USER,"user is not published");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!i&&(n==="audio"&&!e.hasAudio||n==="video"&&!e.hasVideo)){const u=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(n,", remote track is not published")),u}const c=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(n));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,n))await this._p2pChannel.unmuteRemote(e,n);else try{const h=n==="audio"?e._audioSSRC:e._videoSSRC,m=n==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,n,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,n,h,m)}catch(h){throw h}D.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(n)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(h=>{D.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=n==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new Oe(X.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw D.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{c()}}async _subscribe(e,n,i){if(this.store.useP2P)return this._p2pSubscribe(e,n);if(Ci(n,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(y=>y===e)){const y=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),y}if(!e.hasAudio&&!e.hasVideo){const y=new Oe(X.INVALID_REMOTE_USER,"user is not published");throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),y}if(!(i||(n!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(n!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const y=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw D.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(n,", remote track is not published")),y}let c=n==="audio"?e._audioSSRC:e._videoSSRC,u=n==="audio"?e._audioOrtc:e._videoOrtc,h=n==="video"?e._rtxSsrcId:void 0,m={stream_type:n==="audio"?mt.AUDIO:mt.VIDEO,ssrcId:c};const _=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(n));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,n))await this._p2pChannel.unmuteRemote(e,n);else try{const S=n==="audio"?e._audioSSRC:e._videoSSRC;S!==void 0&&S!==c&&(c=S,u=n==="audio"?e._audioOrtc:e._videoOrtc,h=n==="video"?e._rtxSsrcId:void 0,m={stream_type:n==="audio"?mt.AUDIO:mt.VIDEO,ssrcId:c}),Ps.markSubscribeStart(this.store.clientId,c),this.store.subscribe(e.uid,n,Date.now()),await this._p2pChannel.subscribe(e,n,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(e.uid,m,!0)}catch(w){if((w==null?void 0:w.code)!==X.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,n),w;await this._p2pChannel.unsubscribe(e,n,!0),this._p2pChannel.setPendingRemoteMedia(e,n)}this.store.subscribe(e.uid,n,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,n)}catch(S){throw this._p2pChannel.reportSubscribeEvent(!1,S==null?void 0:S.code,e,n),S}D.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(n)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(S=>{D.warning("[".concat(this._clientId,"] auto set fallback failed"),S)});const y=n==="audio"?e._audioTrack:e._videoTrack;if(!y)throw new Oe(X.UNEXPECTED_ERROR,"can not find remote track in user object");return y}catch(y){throw D.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),y),y}finally{_()}}async massSubscribe(e){if(Vp(e,"subscribeList"),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const n=Date.now(),i=new Map,o=await this._subscribeMutex.lock();D.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(m=>{let{user:_,mediaType:y}=m;return"user: ".concat(_==null?void 0:_.uid,", mediaType: ").concat(y)}).join("; ")));const c=(e=[...e]).map(m=>{let{user:_,mediaType:y}=m;return{user:_,mediaType:y}}),u=await this._p2pChannel.globalLock();try{var h;for(let _=e.length-1;_>=0;_--){const y=e[_],{user:S,mediaType:w}=y;if(Ci(w,"mediaType",["audio","video"]),!S){const U=new Oe(X.INVALID_PARAMS,"user property does not exist in subscribeList item");throw D.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),U}if(!this._users.find(U=>U===S)){const U=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");D.error("[".concat(this._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),c[_].error=U,e.splice(_,1);continue}if(w==="audio"&&(!S.hasAudio||S._audioSSRC===void 0)||w==="video"&&(!S.hasVideo||S._videoSSRC===void 0)){const U=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);D.error("[".concat(this._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(w,", remote user is not published")),c[_].error=U,e.splice(_,1);continue}const k=Li.Video|Li.LwoVideo,W=i.get(S);if(W){if(w==="video"?W&k:W&Li.Audio){e.splice(_,1),D.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(w," twice"));continue}i.set(S,W|(w==="video"?k:Li.Audio))}else i.set(S,w==="video"?k:Li.Audio)}for(let _=e.length-1;_>=0;_--){const y=e[_],{user:S,mediaType:w}=y,A=Li.Video|Li.LwoVideo;if(this._p2pChannel.hasRemoteMedia(S,w)){await this._p2pChannel.unmuteRemoteNoLock(S,w);const k=i.get(S);i.set(S,w==="video"?k^A:k^Li.Audio),e.splice(_,1)}}this.store.massSubscribe(e.map(_=>({userId:_.user.uid,type:_.mediaType})),n);let m=ja(h=Array.from(i.entries())).call(h,(_,y)=>{let[S,w]=y;if(w===0)return _;const A={stream_id:S.uid,stream_type:w};return w&Li.Audio&&(A.audio_ssrc=S._audioSSRC),w&Li.Video&&(A.video_ssrc=S._videoSSRC),_.push(A),_},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(y=>{let{user:S,mediaType:w}=y;return{user:S,mediaType:w,ssrcId:w===mt.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:w===mt.VIDEO?S._rtxSsrcId:void 0}}));const _=new Map;if(m=m.filter(y=>y.video_ssrc&&!this._p2pChannel.isPreSubScribe(y.video_ssrc)||y.audio_ssrc&&!this._p2pChannel.isPreSubScribe(y.audio_ssrc)||!y.video_ssrc&&!y.audio_ssrc),m.length>0){const y=await this._gateway.subscribeAll(m,!0);((y==null?void 0:y.users)||[]).forEach(S=>{let{stream_id:w,video_error_code:A,audio_error_code:k,error_code:W}=S;(A||k||W)&&_.set(w,{video_error_code:A,audio_error_code:k,error_code:W})})}if(Array.from(_.entries()).length>0){const y=[];Array.from(_.entries()).forEach(S=>{let[w,A]=S;const k=this.remoteUsers.find(W=>W.uid===w);if(k){let W;A.error_code||A.video_error_code&&A.audio_error_code?W=void 0:A.video_error_code?W=mt.VIDEO:A.audio_error_code&&(W=mt.AUDIO),y.push({user:k,mediaType:W})}}),y.length>0&&await this._p2pChannel.massUnsubscribeNoLock(y)}for(const y of c){const S=_.get(y.user.uid);if(S){const w=S.error_code||y.mediaType==="audio"&&S.audio_error_code||y.mediaType==="video"&&S.video_error_code;if(w){const A=ub(w);D.error("user:".concat(y.user.uid," mediaType:").concat(y.mediaType," has massSubscribe error ").concat(A.desc)),y.error=new Oe(X.SUBSCRIBE_FAILED,"code ".concat(w,": ").concat(A.desc))}}y.error||(y.mediaType==="video"?y.track=y.user.videoTrack:y.track=y.user.audioTrack)}return this.store.massSubscribe(c.filter(y=>!y.error).map(y=>({userId:y.user.uid,type:y.mediaType})),void 0,Date.now()),c.forEach(y=>{var S;wt.subscribe(this.store.sessionId,{succ:!!y.error,ec:((S=y.error)===null||S===void 0?void 0:S.code)||null,video:y.mediaType===mt.VIDEO,audio:y.mediaType===mt.AUDIO,peerid:y.user.uid,subscribeRequestid:y.mediaType===mt.VIDEO?y.user._videoSSRC:y.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-n),preSsrc:this._p2pChannel.isPreSubScribe(y.user._videoSSRC)},!0)}),D.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(y=>{let{user:S,mediaType:w}=y;return"user: ".concat(S==null?void 0:S.uid,", mediaType: ").concat(w)}).join("; "))),c}catch(_){throw await this._p2pChannel.massUnsubscribeNoLock(e),_}}finally{u(),o()}}async unsubscribe(e,n,i){if(!(e instanceof Im)){const u=this.remoteUsers.find(h=>h.uid===e);if(!u)throw new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");e=u}if(n||this.store.useP2P){if(n==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(n&&Ci(n,"mediaType",["audio","video"]),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===e)){const u=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),u}D.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(n));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,n);else{const u=await this._p2pChannel.unsubscribe(e,n);u&&await this._gateway.unsubscribe(u,e.uid),n&&n!=="audio"||(e._audio_pre_subscribed=!1),n&&n!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&EA(this._users,e),D.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(n))}}catch(u){if(u.code===X.DISCONNECT_P2P)return void D.warning("disconnecting p2p, abort unsubscribe request.");throw D.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(e,n){if(n&&er(n,"id",0,65535,!0),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new Oe(X.INVALID_REMOTE_USER,"user is not in the channel");throw D.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}let o;if(typeof n=="number"){const c=e._dataChannels.find(u=>u.id===n);c&&(o=[c])}else o=e._dataChannels;if(o===void 0){const c=new Oe(X.REMOTE_USER_IS_NOT_PUBLISHED);throw D.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(n,", remote datachannel is not published")),c}D.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(e,o);c&&await this._gateway.unsubscribeDataChannel(c,e.uid),D.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===X.DISCONNECT_P2P)return void D.warning("disconnecting p2p, abort unsubscribe request.");throw D.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}}async massUnsubscribe(e){if(Vp(e,"unsubscribeList"),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");D.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:o,mediaType:c}=i;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];const n=new Map;for(let i=e.length-1;i>=0;i--){const{user:o,mediaType:c}=e[i];if(!o){const m=new Oe(X.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw D.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(Ci(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===o)){D.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),e.splice(i,1);continue}const h=Li.Video|Li.LwoVideo;if(n.has(o)){const m=n.get(o);let _;switch(c){case"video":_=m&h;break;case"audio":_=m&Li.Audio;break;default:_=m&(Li.Audio|h)}if(_){D.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(c," twice.")),e.splice(i,1);continue}c?c==="audio"?n.set(o,m|Li.Audio):c==="video"&&n.set(o,m|h):n.set(o,m|Li.Audio|h)}else c?c==="audio"?n.set(o,Li.Audio):c==="video"&&n.set(o,h):n.set(o,Li.Audio|h)}try{const i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),D.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(o=>{let{user:c,mediaType:u}=o;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(i){if(i.code===X.DISCONNECT_P2P)return void D.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw D.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new Le(X.INVALID_PARAMS);Dr(i.width)||uL(i.width,"streamParameter.width"),Dr(i.height)||uL(i.height,"streamParameter.height"),Dr(i.framerate)||uL(i.framerate,"streamParameter.framerate"),Dr(i.bitrate)||er(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&D.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),D.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const n=this._configDistribute.getLowStreamConfigDistribute();if(n&&n.bitrate&&e.bitrate&&n.bitrate<e.bitrate&&(e.bitrate=n.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,$e.LocalVideoLowTrack)}async enableDualStream(){if(!kn().supportDualStream)throw wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Oe(X.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Oe(X.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),D.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia($e.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,wt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),D.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,n){if(function(o){Ci(o,"role",["audience","host"])}(e),n&&fL(n),this.mode==="rtc"||this.mode==="p2p")throw D.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Oe(X.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(n&&n.level&&e==="host")throw new Oe(X.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Oe(X.INVALID_OPERATION,"can not set client role to audience when publishing stream");const i=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==i&&re("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,n),this._config.role=e,this._gateway.reconnect("recover",_s.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,n),this._config.role=e),D.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(n&&n.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let n=!1;try{e&&fL(e),await this._gateway.setClientRole(this._config.role,e),n=!0}catch{}finally{D.info("[".concat(this._clientId,"] set client role options ").concat(n?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const n=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!n||!n.timestamp)return 0;const i=n.timestamp-Date.now();return Math.abs(i)>1e3+n.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,n){if(Zi(e,"proxyServer"),!n){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(X.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,wt.setProxyServer(this._proxyServer),D.setProxyServer(this._proxyServer),D.info("[".concat(this._clientId,"] Set proxy server ").concat(n?"by initialize call":""," success."))}setTurnServer(e,n){if(Array.isArray(e)||(e=[e]),!n){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Oe(X.INVALID_OPERATION,"You have already set the proxy")}if(eb(e))return this._turnServer={servers:e,mode:"original-manual"},void D.info("[".concat(this._clientId,"] Set original turnserver ").concat(n?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>dW(i)),this._turnServer={servers:e,mode:"manual"},D.info("[".concat(this._clientId,"] Set turnserver ").concat(n?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"you should set license before join channel");if(Zi(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Oe(X.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,D.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Oe(X.INVALID_OPERATION,"You have already set the proxy");const n=[3,4,5];let i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new Oe(X.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new Oe(X.INVALID_PARAMS,"proxy server mode must be ".concat(n.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,D.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Oe(X.INVALID_OPERATION,"Stop proxy server after leave channel");wt.setProxyServer(),D.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",D.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Oe(X.INVALID_PARAMS,"accessPoints is required.");Vp(e.accessPoints.serverList,"accessPoints.serverList"),Zi(e.accessPoints.domain,"accessPoints.domain");const n=(A,k)=>{er(A,k,0,65535,!0)};let i=443;if(e.accessPoints.port&&(n(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(X.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");re("CLOSE_AFB_FOR_LOCAL_AP")&&(Xn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Xn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,u=e.accessPoints.serverList.map(A=>o.test(A)?"".concat(A.replace(/\./g,"-"),".").concat(c):A),h=u.map(A=>"".concat(A,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Xn("WEBCS_DOMAIN",h),Xn("WEBCS_DOMAIN_BACKUP_LIST",h),Xn("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Vp(e.report.hostname,"report.hostname"),Xn("EVENT_REPORT_DOMAIN",e.report.hostname[0]),Xn("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(Xn("EVENT_REPORT_DOMAIN",u[0]),Xn("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let m=6443;e.report&&e.report.port&&(n(e.report.port,"report.port"),m=e.report.port),Xn("STATS_COLLECTOR_PORT",m),e.report?Xn("ENABLE_EVENT_REPORT",!0):Xn("ENABLE_EVENT_REPORT",!1);let _="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Vp(e.log.hostname,"log.hostname"),_=e.log.hostname[0]):_=u[0];let y=6444;e.log&&e.log.port&&(n(e.log.port,"log.port"),y=e.log.port),Xn("LOG_UPLOAD_SERVER","".concat(_,":").concat(y));let S=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Vp(e.cds.hostname,"cds.hostname"),S=e.cds.hostname):S=u;let w=443;e.cds&&e.cds.port&&(n(e.cds.port,"cds.port"),w=e.cds.port),Xn("CDS_AP",S.map(A=>"".concat(A,":").concat(w))),e.cds?Xn("ENABLE_CONFIG_DISTRIBUTE",!0):Xn("ENABLE_CONFIG_DISTRIBUTE",!1),D.info("set local access point v2 success")}setLocalAccessPoints(e,n){if(Vp(e,"serverList"),Zi(n,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Oe(X.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(o=>i.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(n):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Xn("WEBCS_DOMAIN",e),Xn("WEBCS_DOMAIN_BACKUP_LIST",e),Xn("GATEWAY_DOMAINS",[n]),Xn("EVENT_REPORT_DOMAIN",e[0]),Xn("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),Xn("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),D.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Ci(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(n){throw D.error("[".concat(this._clientId,"] set default remote video stream type error"),n.toString()),n}else D.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,n){Ci(n,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,n),setTimeout(()=>{const i=this._users.find(o=>o.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw D.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}D.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(n)),this._remoteStreamTypeCacheMap.set(e,n)}async setStreamFallbackOption(e,n){Ci(n,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,n)}catch(i){throw D.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}D.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(n)),this._streamFallbackTypeCacheMap.set(e,n)}setEncryptionConfig(e,n,i,o){(function(u){Ci(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),Zi(n,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(ot(c).call(c,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new Oe(X.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new Oe(X.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(Up(o,"encryptDataStream"),!ot(c).call(c,e))throw new Oe(X.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(n)||D.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=n,i&&(this._encryptionSalt=ym(i))}async renewToken(e){if(Zi(e,"token",1,2047),!this._key||!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"renewToken should not be called before user join");const n=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const i=await this._renewTokenMutex.lock();try{if(re("USE_NEW_TOKEN")){D.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await Rfe(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||gi);D.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:o})}else D.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});D.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=n,this._joinInfo.token=n,D.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?D.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(fn.VOLUME_INDICATOR,e)},re("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),n=this._gateway.getInChannelInfo();return e.Duration=Math.round(n.duration/1e3),e}async startLiveStreaming(e,n){if(!n){if(this.codec!=="h264")throw new Oe(X.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Oe(X.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Oe(X.LIVE_STREAMING_TASK_CONFLICT);const i=n?Bp.TRANSCODE:Bp.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(Bp.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const n=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!n.length)throw new Oe(X.INVALID_PARAMS,"can not find live streaming url to stop");await lt.all(n.map(i=>i&&i.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){YG(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){YG(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof vb&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var n;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const c=new TextEncoder;e.payload=c.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ot(n=["aes-128-gcm2","aes-256-gcm2"]).call(n,this._encryptionMode)&&(o=!0,e.payload=await async function(c,u,h){var m;const _=ja(m=Array.from(h)).call(m,(U,V)=>U+V,0),y={serverTs:0,seq:Khe++,length:h.length,checkSum:_},S=new Uint8Array(yW(_,2)),w=new ArrayBuffer(Ev),A=new DataView(w);A.setUint32(0,y.serverTs),A.setUint16(4,y.seq),A.setUint16(6,y.length),A.setUint16(8,y.checkSum);const k=16-h.length%16;h=fW(h,new Uint8Array(k));const W=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:NW,additionalData:S},u,h);return fW(new Uint8Array(w),new Uint8Array(W))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new Oe(X.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(jt.DATA_STREAM,{payload:ym(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-Lfe},!i)}sendMetadata(e){if(!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Oe(X.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(jt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:ym(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(npe),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not send custom report, not joined");await wt.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,n){Ci(n.spatialLayer,"spatialLayer",[0,1,2,3]),Ci(n.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,n)}catch(i){throw D.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){const{apRTM:n=!1,rtmFlag:i}=e;if(Up(n,"apRTM"),er(i,"rtmFlag",0),this._rtmConfig.apRTM=n,this._rtmConfig.rtmFlag=i,D.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=n,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(D.debug("[".concat(this._clientId,"] reset client")),function(e){const n=kv.indexOf(e);n!==-1&&kv.splice(n,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Wo.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&w9(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&wt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(n=>n._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Cs("client-publish",this._clientId),this._subscribeMutex=new Cs("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,n){var i;const o=e||S_();e?D.debug("[".concat(this._clientId,"] new Session ").concat(o)):D.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const c=e?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,wt.addSid(o);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(n==null?void 0:n.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};wt.sessionInit(this._sessionId,lu({cname:n.channel,appid:n.appId},u)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re("FORCE_TURN")&&!re("TURN_ENABLE_TCP")&&!re("TURN_ENABLE_UDP"))throw new Oe(X.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");D.debug("[".concat(this._clientId,"] publish high stream"));try{const i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await i.next()).value;if(o){try{await this._gateway.sendExtensionMessage(Qr.PUBLISH,o,!0)}catch(c){throw i.throw(c),c}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await i.next()).value;if(o){var n;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==X.DISCONNECT_P2P)throw i.throw(u),u}await i.next(((n=c)===null||n===void 0?void 0:n.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of e)c instanceof mr&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{D.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,e),(i==null?void 0:i.code)===X.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Oe(X.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Oe(X.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));D.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await i.next()).value;if(o){var n;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==X.DISCONNECT_P2P)throw i.throw(u),u}i.next(((n=c)===null||n===void 0?void 0:n.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===X.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){const n=()=>{if(!this._joinInfo||!this._appId)return new Oe(X.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Gp("LiveStreaming").create(o));var o;return i.onLiveStreamError=(c,u)=>{wt.reportApiInvoke(this._sessionId,{name:mi.ON_LIVE_STREAM_ERROR,options:[c,u],tag:Lr.TRACER}).onSuccess(),this.safeEmit(fn.LIVE_STREAMING_ERROR,c,u)},i.onLiveStreamWarning=(c,u)=>{wt.reportApiInvoke(this._sessionId,{name:mi.ON_LIVE_STREAM_WARNING,options:[c,u],tag:Lr.TRACER}).onSuccess(),this.safeEmit(fn.LIVE_STREAMING_WARNING,c,u)},i.on(ix.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new Oe(X.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,_,y,S){const w=re("UAP_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(A=>_.proxyServer?"https://".concat(_.proxyServer,"/ap/?url=").concat(A+"/api/v1?action=uap"):"https://".concat(A,"/api/v1?action=uap"));return await yfe(w,m,_,y,S)})(c,this._joinInfo,this._axiosCancelSource.token,gi).then(u).catch(h)}),i};return e===Bp.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||n(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||n(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Oe(X.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:n,sendResolutionHeight:i}=this.getLocalVideoStats(),o=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:n,height:i}},Gp("ChannelMediaRelay").create(e));o.on("state",c=>{c===va.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(fn.CHANNEL_MEDIA_RELAY_STATE,c)}),o.on("event",c=>{this.safeEmit(fn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,n){const{added:i,deleted:o}=e,c=[];if(n){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{i.every(_=>_.uid!==h._uintid||_.stream_id!==m.id)&&u.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(i)&&i.length>0&&i.forEach(u=>{const{uid:h,stream_id:m,ordered:_,max_retrans_times:y,metadata:S}=u,w=this._users.find(A=>A._uintid===h);if(!w)return void D.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(D.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),ot(c).call(c,w)||c.push(w),w._uintid||(w._uintid=h),w._dataChannels.findIndex(A=>A.id===u.stream_id)===-1){const A={id:m,ordered:!!_,maxRetransmits:y,metadata:S},k=function(W){return NG(W,!0)}(A);w._dataChannels.push(k),D.info("[".concat(this._clientId,"] remote user ").concat(w.uid," published datachannel")),n||this.safeEmit(fn.USER_PUBLISHED,w,"datachannel",A)}this._p2pChannel.hasPendingRemoteDataChannel(w,u.stream_id)&&(D.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(w.uid," after reconnect.")),this._subscribeDataChannel(w,u.stream_id).catch(A=>{D.error("[".concat(this._clientId,"] resubscribe datachannel error"),A.toString())}))}),n&&(this.safeEmit(fn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(u=>{const{uid:h,stream_id:m}=u,_=this._users.find(S=>S._uintid===h);if(!_)return void D.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const y=_._dataChannels.find(S=>S.id===u.stream_id);y&&(D.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(_,[y]).then(S=>{if(_._dataChannels=_._dataChannels.filter(w=>w!==y),S)return this._gateway.unsubscribeDataChannel(S,_.uid)}),D.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(y.id)),this.safeEmit(fn.USER_UNPUBLISHED,_,"datachannel",y._config))})}_handleRemoveDataChannels(e){const n=this._users.find(i=>i.uid===e.uid);if(n){if(n._dataChannels!==void 0&&n._dataChannels.length>0){D.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const i=()=>{D.info("[".concat(this._clientId,"] remote user ").concat(n.uid," unpublished datachannel")),n._dataChannels.forEach(o=>{this.safeEmit(fn.USER_UNPUBLISHED,n,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(n,n._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,n.uid)}),i()}}else D.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on($i.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(n){return void D.error("Error loading sdk config",n.message)}if(e)try{const n=JSON.parse(window.atob(e)),i=Date.now();Object.keys(n).forEach(o=>{const{value:c,type:u,expires:h}=n[o];h&&h<=i||u||JL()||!Object.prototype.hasOwnProperty.call(wA,o)||(ld[o]=c,fr[o]=c,D.debug("Update gateway parameters from config distribute",o,c))})}catch(n){D.error("Error update config from local cache",n.message)}})()}),this._gateway.on($i.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on($i.CONNECTION_STATE_CHANGE,(e,n,i)=>{var o;if(i===jn.FALLBACK)return;const c=()=>{this.safeEmit(fn.CONNECTION_STATE_CHANGE,e,n,i)};if(wt.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:mi.CONNECTION_STATE_CHANGE,options:[e,n,i],tag:Lr.TRACER}).onSuccess(JSON.stringify({cur:e,prev:n,reason:i})),D.info("[".concat(this._clientId,"] signal connection state change: ").concat(n," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(_=>{D.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),_)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(_=>{D.warning("[".concat(this._clientId,"] auto set remote stream type failed"),_)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{D.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{D.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{D.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(D.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,mt.AUDIO,!1)),h._trust_video_mute_state_||(D.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,mt.VIDEO,!1)),h._trust_audio_enabled_state_||(D.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(D.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(D.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(D.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(D.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on($i.REQUEST_NEW_GATEWAY_LIST,async(e,n)=>{if(!this._joinInfo)return n(new Oe(X.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i;const o=await T9(lu(lu({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(i=o.ap,R9(o),this._joinInfo.preload=!0):(i=await vx(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||gi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const c=[];i.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:h}=u;const[m,_]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:_}):c.push({host:m,port:_})}),e(c)}catch(i){n(i)}}),this._gateway.on($i.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(fn.NETWORK_QUALITY,e)}),this._gateway.on($i.STREAM_TYPE_CHANGE,(e,n)=>{this.safeEmit(fn.STREAM_TYPE_CHANGED,e,n),wt.reportApiInvoke(this._sessionId,{name:mi.STREAM_TYPE_CHANGE,options:[e,n],tag:Lr.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:n}))}),this._gateway.on($i.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on($i.REQUEST_P2P_CONNECTION_PARAMS,async(e,n,i)=>{try{let o=await this._p2pChannel.getEstablishParams();re("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(e)),n(o)}catch(o){i(o)}}),this._gateway.on($i.JOIN_RESPONSE,(e,n)=>{if(this.store.useP2P)return;let i;e.attributes?i=e.attributes.userAttributes.preSubSsrcs:D.debug("no attributes in joinResponse");const o=vG(e.ortc,n,i);this._p2pChannel.connect(o)}),this._gateway.on($i.PRE_CONNECT_PC,async e=>{const{candidates:n,fingerprint:i}=e;if(this._joinInfo&&n.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:u}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(u,"_").concat(c),icePwd:"".concat(u,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=re("FINGERPRINT"))!==null&&o!==void 0?o:i}]},candidates:n,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(gn.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(gn.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(gn.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(gn.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(gn.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(gn.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(gn.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(gn.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(gn.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,mt.AUDIO,!0)),this._gateway.signal.on(gn.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,mt.AUDIO,!1)),this._gateway.signal.on(gn.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,mt.VIDEO,!0)),this._gateway.signal.on(gn.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,mt.VIDEO,!1)),this._gateway.signal.on(gn.RECEIVE_METADATA,e=>{const n=v_(e.metadata);this.safeEmit(fn.RECEIVE_METADATA,e.uid,n)}),this._gateway.signal.on(gn.ON_DATA_STREAM,async e=>{var n;if(!e)return;let i=v_(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ot(n=["aes-128-gcm2","aes-256-gcm2"]).call(n,this._encryptionMode)){if(e.payload.length<Ev)throw new Oe(X.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(Ev));i=await async function(u,h,m){const _=m.subarray(0,Ev),y=_.slice(8,Ev),S=(y[0]<<8)+y[1],w=(_[6]<<8)+_[7],A=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:NW,additionalData:new Uint8Array(yW(S,2))},h,m.subarray(Ev));return new Uint8Array(A).subarray(0,w)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let o=0;if(e.ordered||e.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(m=>m.uid===e.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(u==null?void 0:u._audioSSRC));o=h==null?void 0:h.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),Mfe(lu(lu({},e),{},{payload:i}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(gn.ON_CRYPT_ERROR,()=>{Em(()=>{D.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(fn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(gn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(gn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{D.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,jn.TOKEN_EXPIRE),this.safeEmit(fn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(gn.ON_STREAM_FALLBACK_UPDATE,e=>{D.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(fn.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(gn.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),D.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(gn.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(gn.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Bt.REQUEST_TIMEOUT,(e,n)=>{if(this._joinInfo)switch(e){case jt.PUBLISH:{if(!n)return;const c=n.ortc;if(c){var i,o;const u=c.some(_=>{let{stream_type:y}=_;return y===zn.Audio}),h=c.some(_=>{let{stream_type:y}=_;return y!==zn.Audio}),m=c.some(_=>{let{stream_type:y}=_;return y===zn.Screen||y===zn.ScreenLow});n.state==="offer"&&wt.publish(this._joinInfo.sid,{eventElapse:Ps.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:X.TIMEOUT,audio:u,video:h,p2pid:n.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(i=c.find(_=>{let{stream_type:y}=_;return y===zn.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:h?(o=c.find(_=>{let{stream_type:y}=_;return y!==zn.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case jt.SUBSCRIBE:n&&wt.subscribe(this._joinInfo.sid,{succ:!1,ec:X.TIMEOUT,audio:n.stream_type===mt.AUDIO,video:n.stream_type===mt.VIDEO,peerid:n.stream_id,subscribeRequestid:n.ssrcId,p2pid:this.store.p2pId,eventElapse:Ps.measureFromSubscribeStart(this.store.clientId,n.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(n.ssrcId)})}}),this._gateway.signal.on(gn.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(gn.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;re("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(o=>!P_(o.string_id||o.stream_id,this.channelName)));const n=[],i=[];for(const o of e.users){let c=this._users.find(S=>S._uintid===o.stream_id);c?c._trust_in_room_=!0:(c=new Im(o.string_id||o.stream_id,o.stream_id),this._users.push(c),this.getListeners(fn.PUBLISHED_USER_LIST).length===0&&(D.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(fn.USER_JOINED,c)));const u=Li.Audio&o.stream_type,h=(Li.Video|Li.LwoVideo)&o.stream_type,m=(65280&o.stream_type)!=0,_=u&&c.hasAudio,y=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=o.video_ssrc,c._rtxSsrcId=o.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=o.audio_ssrc),u&&!_&&this.getListeners(fn.PUBLISHED_USER_LIST).length===0&&(D.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(fn.USER_PUBLISHED,c,"audio")),h&&!y&&this.getListeners(fn.PUBLISHED_USER_LIST).length===0&&(D.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(fn.USER_PUBLISHED,c,"video")),(u&&!_||h&&!y||m)&&n.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&i.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&i.push({user:c,mediaType:"audio"})}i.length>0&&(D.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(o=>{D.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(fn.PUBLISHED_USER_LIST).length>0?re("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=n:(D.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(n.map(o=>o.uid).join(", "))),this.safeEmit(fn.PUBLISHED_USER_LIST,n)):D.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(n.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(gn.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:n}=e;this._p2pChannel instanceof vb&&this._p2pChannel.updateRemoteRTPCapabilities(n.map(i=>i.toLowerCase()).filter(i=>{var o;return ot(o=Object.keys(RA)).call(o,i)}))})}_handleP2PEvents(){this._gateway.signal.on(gn.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Qr.PUBLISH,(e,n,i)=>{const{uid:o}=e;e.forEach(c=>{const{kind:u,ssrcs:h,mid:m,isMuted:_}=c;this._handleP2PAddAudioOrVideoStream(u,o,h[0].ssrcId,m);const y=this._users.find(S=>S.uid===o);return y&&this.store.useP2P?this._p2pChannel.mockSubscribe(y,u,h[0].ssrcId,m).then(()=>{n()}).catch(i):n(),this._handleMuteStream(o,u,!!_)})}),this._gateway.signal.on(Qr.CALL,async(e,n,i)=>{if(this.store.useP2P)try{var o;n(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},e))}catch(c){i(c)}}),this._gateway.signal.on(Bt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(Qr.UNPUBLISH,async(e,n,i)=>{if(this.store.useP2P){const{unpubMsg:o,uid:c}=e,u=this._users.find(h=>h.uid===c);if(!u)return D.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void n();try{o.forEach(async h=>{let{stream_type:m}=h;const _=m===zn.Audio?mt.AUDIO:mt.VIDEO;await this._p2pChannel.unsubscribe(u,_),this._handleMuteStream(c,_,!0)}),n()}catch(h){i(h)}}}),this._gateway.signal.on(Qr.CONTROL,async(e,n)=>{const{action:i}=e;switch(i){case Tm.MUTE_LOCAL_VIDEO:this._handleMuteStream(n,mt.VIDEO,!0);break;case Tm.MUTE_LOCAL_AUDIO:this._handleMuteStream(n,mt.AUDIO,!0);break;case Tm.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",n),this._handleMuteStream(n,mt.VIDEO,!1);break;case Tm.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",n),this._handleMuteStream(n,mt.AUDIO,!1)}}),this._gateway.signal.on(Qr.RESTART_ICE,async(e,n,i)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:c}=e;o!==Eo.SEND_ONLY||c?n(await this._p2pChannel.restartICE(o,c)):(this._p2pChannel.handleDisconnect(o),n())}catch(o){i(o)}}),this._gateway.signal.on(Qr.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:n,direction:i}=e;this._p2pChannel.addRemoteCandidate(n,i)}}),this._p2pChannel.on(Ot.RequestP2PRestartICE,async(e,n,i)=>{try{const{direction:o}=e;n(await this._gateway.sendExtensionMessage(Qr.RESTART_ICE,e,o===Eo.SEND_ONLY))}catch(o){i(o)}}),this._p2pChannel.on(Ot.LocalCandidate,e=>{this._gateway.sendExtensionMessage(Qr.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Ot.RequestP2PMuteLocal,async(e,n,i)=>{try{await this._gateway.sendExtensionMessage(Qr.CONTROL,e,!0),n()}catch(o){i(o)}}),this._p2pChannel.on(Ot.RequestP2PUnmuteRemote,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(o){o.code===X.DISCONNECT_P2P?n():i(o)}else n()}),this._p2pChannel.on(Ot.RequestP2PMuteRemote,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(o){o.code===X.DISCONNECT_P2P?n():i(o)}else n()}),this._p2pChannel.on(Ot.StateChange,(e,n)=>{n===Bn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Ot.PeerConnectionStateChange,e=>{const n=this._peerConnectionState;e!==n&&(this.safeEmit(fn.PEERCONNECTION_STATE_CHANGE,e,n),this._peerConnectionState=e)}),this._p2pChannel.on(Ot.RequestMuteLocal,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(o){o.code===X.DISCONNECT_P2P?n():i(o)}else n()}),this._p2pChannel.on(Ot.RequestUnmuteLocal,async(e,n,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),n()}catch(o){o.code===X.DISCONNECT_P2P?n():i(o)}else n()}),this._p2pChannel.on(Ot.RequestRePublish,(e,n,i)=>{this.publish(e,!1).then(n).catch(i)}),this._p2pChannel.on(Ot.RequestRePublishDataChannel,(e,n,i)=>{lt.all(e.map(async o=>{const c=await this._p2pChannel.publishDataChannel([o]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==X.DISCONNECT_P2P)throw u}})).then(n).catch(i)}),this._p2pChannel.on(Ot.RequestReSubscribe,async(e,n,i)=>{try{for(const{user:o,kind:c}of e)c===mt.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");n()}catch(o){i(o)}}),this._p2pChannel.on(Ot.RequestUpload,(e,n)=>{this._gateway.upload(e,n)}),this._p2pChannel.on(Ot.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Ot.MediaReconnectStart,e=>{this.safeEmit(fn.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Ot.MediaReconnectEnd,e=>{this.safeEmit(fn.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Ot.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Ot.RequestRestartICE,async e=>{if(this.store.useP2P)return;const n=await this._p2pChannel.restartICE(e),i=await n.next();if(i.done)return;const o=i.value;let c;try{c=await this._gateway.restartICE({iceParameters:o})}catch(h){return void n.throw(h)}const{iceParameters:u}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await n.next({remoteIceParameters:u})}),this._p2pChannel.on(Ot.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Ot.RequestReconnectPC,async()=>{var e;const{iceParameters:n,dtlsParameters:i,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:n,dtlsParameters:i,rtpCapabilities:o}),h=vG(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Ot.RequestUnpublishForReconnectPC,async(e,n,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),n()):i()}),this._p2pChannel.on(Ot.P2PLost,()=>{this.safeEmit(fn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Ot.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Ot.ConnectionTypeChange,e=>{this.safeEmit(fn.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Ot.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Ot.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Ot.AudioMetadata,e=>{this.safeEmit(fn.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const i=(n={config:e},Gp("ContentInspect").create(n));this._inspect=i,this.handleVideoInspectEvents(i);const{appId:o,cname:c,sid:u,token:h,uid:m,cid:_,vid:y}=this._joinInfo;await i.init({appId:o,areaCode:"",cname:c,sid:u,token:h,uid:m,cid:_,vid:y?Number(y):0},gi)}catch(i){throw Array.isArray(i)?i[0]:i}var n}handleVideoInspectEvents(e){e.on(Ki.CONNECTION_STATE_CHANGE,(n,i)=>{if(this.safeEmit(fn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,n,i),i===su.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(fn.CONTENT_INSPECT_ERROR,new Oe(X.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Ki.INSPECT_RESULT,(n,i)=>{var o;if((i==null?void 0:i.code)===X.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return D.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(fn.CONTENT_INSPECT_RESULT,n,i)}),e.on(Ki.CLIENT_LOCAL_VIDEO_TRACK,n=>{n(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,n){if(Up(e,"enabled"),e){if(!n)throw new Oe(X.INVALID_PARAMS,"config is required");if(V9(n),!this._joinInfo)throw new Oe(X.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(n);else{const o=(i={config:n},Gp("ImageModeration").create(i));this._moderation=o,this.handleImageModerationEvents(o);const{appId:c,cname:u,sid:h,token:m,uid:_,cid:y,vid:S}=this._joinInfo;await o.init({appId:c,areaCode:"",cname:u,sid:h,token:m,uid:_,cid:y,vid:S?Number(S):0},gi)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var i;if(!this._moderation)throw new Oe(X.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(e){e.on(hd.CONNECTION_STATE_CHANGE,(n,i)=>{if(this.safeEmit(fn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,n,i),n===gl.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Oe(X.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(hd.CLIENT_LOCAL_VIDEO_TRACK,n=>{n(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(n){Ci(n,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new Oe(X.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,D.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return D.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Up(e,"enabled"),Xn("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,n){switch(n){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},Et(ht.prototype,"leave",[F9],Object.getOwnPropertyDescriptor(ht.prototype,"leave"),ht.prototype),Et(ht.prototype,"publish",[j9],Object.getOwnPropertyDescriptor(ht.prototype,"publish"),ht.prototype),Et(ht.prototype,"unpublish",[B9],Object.getOwnPropertyDescriptor(ht.prototype,"unpublish"),ht.prototype),Et(ht.prototype,"subscribe",[W9],Object.getOwnPropertyDescriptor(ht.prototype,"subscribe"),ht.prototype),Et(ht.prototype,"presubscribe",[z9],Object.getOwnPropertyDescriptor(ht.prototype,"presubscribe"),ht.prototype),Et(ht.prototype,"massSubscribe",[G9],Object.getOwnPropertyDescriptor(ht.prototype,"massSubscribe"),ht.prototype),Et(ht.prototype,"unsubscribe",[H9],Object.getOwnPropertyDescriptor(ht.prototype,"unsubscribe"),ht.prototype),Et(ht.prototype,"massUnsubscribe",[$9],Object.getOwnPropertyDescriptor(ht.prototype,"massUnsubscribe"),ht.prototype),Et(ht.prototype,"setLowStreamParameter",[K9],Object.getOwnPropertyDescriptor(ht.prototype,"setLowStreamParameter"),ht.prototype),Et(ht.prototype,"enableDualStream",[q9],Object.getOwnPropertyDescriptor(ht.prototype,"enableDualStream"),ht.prototype),Et(ht.prototype,"disableDualStream",[Y9],Object.getOwnPropertyDescriptor(ht.prototype,"disableDualStream"),ht.prototype),Et(ht.prototype,"setClientRole",[X9],Object.getOwnPropertyDescriptor(ht.prototype,"setClientRole"),ht.prototype),Et(ht.prototype,"_setClientRoleOptions",[J9],Object.getOwnPropertyDescriptor(ht.prototype,"_setClientRoleOptions"),ht.prototype),Et(ht.prototype,"setProxyServer",[Q9],Object.getOwnPropertyDescriptor(ht.prototype,"setProxyServer"),ht.prototype),Et(ht.prototype,"setTurnServer",[Z9],Object.getOwnPropertyDescriptor(ht.prototype,"setTurnServer"),ht.prototype),Et(ht.prototype,"setLicense",[eH],Object.getOwnPropertyDescriptor(ht.prototype,"setLicense"),ht.prototype),Et(ht.prototype,"startProxyServer",[tH],Object.getOwnPropertyDescriptor(ht.prototype,"startProxyServer"),ht.prototype),Et(ht.prototype,"stopProxyServer",[nH],Object.getOwnPropertyDescriptor(ht.prototype,"stopProxyServer"),ht.prototype),Et(ht.prototype,"setLocalAccessPointsV2",[rH],Object.getOwnPropertyDescriptor(ht.prototype,"setLocalAccessPointsV2"),ht.prototype),Et(ht.prototype,"setLocalAccessPoints",[iH],Object.getOwnPropertyDescriptor(ht.prototype,"setLocalAccessPoints"),ht.prototype),Et(ht.prototype,"setRemoteDefaultVideoStreamType",[sH],Object.getOwnPropertyDescriptor(ht.prototype,"setRemoteDefaultVideoStreamType"),ht.prototype),Et(ht.prototype,"setRemoteVideoStreamType",[oH],Object.getOwnPropertyDescriptor(ht.prototype,"setRemoteVideoStreamType"),ht.prototype),Et(ht.prototype,"setStreamFallbackOption",[aH],Object.getOwnPropertyDescriptor(ht.prototype,"setStreamFallbackOption"),ht.prototype),Et(ht.prototype,"setEncryptionConfig",[cH],Object.getOwnPropertyDescriptor(ht.prototype,"setEncryptionConfig"),ht.prototype),Et(ht.prototype,"renewToken",[lH],Object.getOwnPropertyDescriptor(ht.prototype,"renewToken"),ht.prototype),Et(ht.prototype,"enableAudioVolumeIndicator",[uH],Object.getOwnPropertyDescriptor(ht.prototype,"enableAudioVolumeIndicator"),ht.prototype),Et(ht.prototype,"startLiveStreaming",[dH],Object.getOwnPropertyDescriptor(ht.prototype,"startLiveStreaming"),ht.prototype),Et(ht.prototype,"setLiveTranscoding",[hH],Object.getOwnPropertyDescriptor(ht.prototype,"setLiveTranscoding"),ht.prototype),Et(ht.prototype,"stopLiveStreaming",[pH],Object.getOwnPropertyDescriptor(ht.prototype,"stopLiveStreaming"),ht.prototype),Et(ht.prototype,"startChannelMediaRelay",[fH],Object.getOwnPropertyDescriptor(ht.prototype,"startChannelMediaRelay"),ht.prototype),Et(ht.prototype,"updateChannelMediaRelay",[mH],Object.getOwnPropertyDescriptor(ht.prototype,"updateChannelMediaRelay"),ht.prototype),Et(ht.prototype,"stopChannelMediaRelay",[gH],Object.getOwnPropertyDescriptor(ht.prototype,"stopChannelMediaRelay"),ht.prototype),Et(ht.prototype,"sendCustomReportMessage",[_H],Object.getOwnPropertyDescriptor(ht.prototype,"sendCustomReportMessage"),ht.prototype),Et(ht.prototype,"pickSVCLayer",[EH],Object.getOwnPropertyDescriptor(ht.prototype,"pickSVCLayer"),ht.prototype),Et(ht.prototype,"setRTMConfig",[yH],Object.getOwnPropertyDescriptor(ht.prototype,"setRTMConfig"),ht.prototype),Et(ht.prototype,"enableContentInspect",[vH],Object.getOwnPropertyDescriptor(ht.prototype,"enableContentInspect"),ht.prototype),Et(ht.prototype,"disableContentInspect",[SH],Object.getOwnPropertyDescriptor(ht.prototype,"disableContentInspect"),ht.prototype),Et(ht.prototype,"setImageModeration",[TH],Object.getOwnPropertyDescriptor(ht.prototype,"setImageModeration"),ht.prototype),Et(ht.prototype,"setP2PTransport",[bH],Object.getOwnPropertyDescriptor(ht.prototype,"setP2PTransport"),ht.prototype),Et(ht.prototype,"getJoinChannelServiceRecords",[wH],Object.getOwnPropertyDescriptor(ht.prototype,"getJoinChannelServiceRecords"),ht.prototype),Et(ht.prototype,"setPublishAudioFilterEnabled",[RH],Object.getOwnPropertyDescriptor(ht.prototype,"setPublishAudioFilterEnabled"),ht.prototype),ht);class bb{constructor(n,i){$(this,"id",0),$(this,"element",void 0),$(this,"peerPair",void 0),$(this,"context",void 0),$(this,"audioPlayerElement",void 0),$(this,"audioTrack",void 0),bb.count+=1,this.id=bb.count,this.element=n,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=n=>{const i=document.createElement("audio");i.srcObject=new MediaStream([n.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;const n=async(o,c)=>{const u=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(u),o.iceGatheringState==="complete"?o.localDescription:new lt(h=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&h(o.localDescription)}})},i=async(o,c)=>await o.setRemoteDescription(c);try{const o=await n(this.peerPair[0],"offer");await i(this.peerPair[1],o);const c=await n(this.peerPair[1],"answer");await i(this.peerPair[0],c)}catch(o){throw new Oe(X.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(n){if(this.audioTrack)return this.audioTrack;let i;try{n instanceof HTMLVideoElement&&(n.captureStream?n.captureStream():n.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(n).connect(i)}catch(c){throw new Oe(X.LOCAL_AEC_ERROR,c.toString()).print()}if(!i)throw new Oe(X.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=i.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const n=this.element,i=await this.getTracksFromMediaElement(n);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){D.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(n=>{n.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var IH,_P;$(bb,"count",0);const Zfe=window.AudioContext||window.webkitAudioContext,eme=new(IH=xt({report:wt}),Et((_P=class{constructor(){$(this,"units",[]),$(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return D.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Zfe);let n=this.units.find(i=>i&&i.getElement()===e);return n||(n=new bb(e,this.context),this.units.push(n)),n.startEchoCancellation(),D.debug("start processing local audio echo cancellation, id is",n.id),n.id}_doesEnvironmentNeedAEC(){return Rn().name!==Mn.SAFARI}}).prototype,"processExternalMediaAEC",[IH],Object.getOwnPropertyDescriptor(_P.prototype,"processExternalMediaAEC"),_P.prototype),_P);function AH(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function PH(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?AH(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):AH(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}const Mx=window||document;function OH(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!Mx)return;const i=_i._cspEventHandlerPointer;if(i&&n)return void console.error(i,n);const o=c=>{if(!(c&&c.blockedURI&&(_i.onSecurityPolicyViolation||_i.getListeners(hh.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;re("CSP_DETECTED_HOSTNAME_LIST").some(h=>ot(u).call(u,h))&&(_i.onSecurityPolicyViolation&&typeof _i.onSecurityPolicyViolation=="function"&&_i.onSecurityPolicyViolation(c),_i.getListeners(hh.SECURITY_POLICY_VIOLATION).length>0&&_i.safeEmit(hh.SECURITY_POLICY_VIOLATION,c))};i&&Mx.removeEventListener("securitypolicyviolation",i),(n||e&&typeof e=="function"||_i.getListeners(hh.SECURITY_POLICY_VIOLATION).length>0)&&Mx.addEventListener("securitypolicyviolation",o),_i._cspEventHandlerPointer=o}var tme=N,nme=p6,kH=RegExp.prototype,rme=function(e){return e===kH||tme(kH,e)?nme(e):e.flags},Zs=l(rme);function Hv(e){let n=e.length;for(;--n>=0;)e[n]=0}const Ux=256,NH=286,wb=30,Rb=15,Vx=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),EP=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),ime=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),DH=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Kp=new Array(576);Hv(Kp);const Cb=new Array(60);Hv(Cb);const Ib=new Array(512);Hv(Ib);const Ab=new Array(256);Hv(Ab);const Fx=new Array(29);Hv(Fx);const yP=new Array(wb);function jx(e,n,i,o,c){this.static_tree=e,this.extra_bits=n,this.extra_base=i,this.elems=o,this.max_length=c,this.has_stree=e&&e.length}let LH,xH,MH;function Bx(e,n){this.dyn_tree=e,this.max_code=0,this.stat_desc=n}Hv(yP);const UH=e=>e<256?Ib[e]:Ib[256+(e>>>7)],Pb=(e,n)=>{e.pending_buf[e.pending++]=255&n,e.pending_buf[e.pending++]=n>>>8&255},Uc=(e,n,i)=>{e.bi_valid>16-i?(e.bi_buf|=n<<e.bi_valid&65535,Pb(e,e.bi_buf),e.bi_buf=n>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=n<<e.bi_valid&65535,e.bi_valid+=i)},_h=(e,n,i)=>{Uc(e,i[2*n],i[2*n+1])},VH=(e,n)=>{let i=0;do i|=1&e,e>>>=1,i<<=1;while(--n>0);return i>>>1},FH=(e,n,i)=>{const o=new Array(16);let c,u,h=0;for(c=1;c<=Rb;c++)h=h+i[c-1]<<1,o[c]=h;for(u=0;u<=n;u++){let m=e[2*u+1];m!==0&&(e[2*u]=VH(o[m]++,m))}},jH=e=>{let n;for(n=0;n<NH;n++)e.dyn_ltree[2*n]=0;for(n=0;n<wb;n++)e.dyn_dtree[2*n]=0;for(n=0;n<19;n++)e.bl_tree[2*n]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},BH=e=>{e.bi_valid>8?Pb(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},WH=(e,n,i,o)=>{const c=2*n,u=2*i;return e[c]<e[u]||e[c]===e[u]&&o[n]<=o[i]},Wx=(e,n,i)=>{const o=e.heap[i];let c=i<<1;for(;c<=e.heap_len&&(c<e.heap_len&&WH(n,e.heap[c+1],e.heap[c],e.depth)&&c++,!WH(n,o,e.heap[c],e.depth));)e.heap[i]=e.heap[c],i=c,c<<=1;e.heap[i]=o},zH=(e,n,i)=>{let o,c,u,h,m=0;if(e.sym_next!==0)do o=255&e.pending_buf[e.sym_buf+m++],o+=(255&e.pending_buf[e.sym_buf+m++])<<8,c=e.pending_buf[e.sym_buf+m++],o===0?_h(e,c,n):(u=Ab[c],_h(e,u+Ux+1,n),h=Vx[u],h!==0&&(c-=Fx[u],Uc(e,c,h)),o--,u=UH(o),_h(e,u,i),h=EP[u],h!==0&&(o-=yP[u],Uc(e,o,h)));while(m<e.sym_next);_h(e,256,n)},zx=(e,n)=>{const i=n.dyn_tree,o=n.stat_desc.static_tree,c=n.stat_desc.has_stree,u=n.stat_desc.elems;let h,m,_,y=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<u;h++)i[2*h]!==0?(e.heap[++e.heap_len]=y=h,e.depth[h]=0):i[2*h+1]=0;for(;e.heap_len<2;)_=e.heap[++e.heap_len]=y<2?++y:0,i[2*_]=1,e.depth[_]=0,e.opt_len--,c&&(e.static_len-=o[2*_+1]);for(n.max_code=y,h=e.heap_len>>1;h>=1;h--)Wx(e,i,h);_=u;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Wx(e,i,1),m=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=m,i[2*_]=i[2*h]+i[2*m],e.depth[_]=(e.depth[h]>=e.depth[m]?e.depth[h]:e.depth[m])+1,i[2*h+1]=i[2*m+1]=_,e.heap[1]=_++,Wx(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((S,w)=>{const A=w.dyn_tree,k=w.max_code,W=w.stat_desc.static_tree,U=w.stat_desc.has_stree,V=w.stat_desc.extra_bits,q=w.stat_desc.extra_base,Y=w.stat_desc.max_length;let ce,_e,Ee,me,ke,Ye,ut=0;for(me=0;me<=Rb;me++)S.bl_count[me]=0;for(A[2*S.heap[S.heap_max]+1]=0,ce=S.heap_max+1;ce<573;ce++)_e=S.heap[ce],me=A[2*A[2*_e+1]+1]+1,me>Y&&(me=Y,ut++),A[2*_e+1]=me,_e>k||(S.bl_count[me]++,ke=0,_e>=q&&(ke=V[_e-q]),Ye=A[2*_e],S.opt_len+=Ye*(me+ke),U&&(S.static_len+=Ye*(W[2*_e+1]+ke)));if(ut!==0){do{for(me=Y-1;S.bl_count[me]===0;)me--;S.bl_count[me]--,S.bl_count[me+1]+=2,S.bl_count[Y]--,ut-=2}while(ut>0);for(me=Y;me!==0;me--)for(_e=S.bl_count[me];_e!==0;)Ee=S.heap[--ce],Ee>k||(A[2*Ee+1]!==me&&(S.opt_len+=(me-A[2*Ee+1])*A[2*Ee],A[2*Ee+1]=me),_e--)}})(e,n),FH(i,y,e.bl_count)},GH=(e,n,i)=>{let o,c,u=-1,h=n[1],m=0,_=7,y=4;for(h===0&&(_=138,y=3),n[2*(i+1)+1]=65535,o=0;o<=i;o++)c=h,h=n[2*(o+1)+1],++m<_&&c===h||(m<y?e.bl_tree[2*c]+=m:c!==0?(c!==u&&e.bl_tree[2*c]++,e.bl_tree[32]++):m<=10?e.bl_tree[34]++:e.bl_tree[36]++,m=0,u=c,h===0?(_=138,y=3):c===h?(_=6,y=3):(_=7,y=4))},HH=(e,n,i)=>{let o,c,u=-1,h=n[1],m=0,_=7,y=4;for(h===0&&(_=138,y=3),o=0;o<=i;o++)if(c=h,h=n[2*(o+1)+1],!(++m<_&&c===h)){if(m<y)do _h(e,c,e.bl_tree);while(--m!=0);else c!==0?(c!==u&&(_h(e,c,e.bl_tree),m--),_h(e,16,e.bl_tree),Uc(e,m-3,2)):m<=10?(_h(e,17,e.bl_tree),Uc(e,m-3,3)):(_h(e,18,e.bl_tree),Uc(e,m-11,7));m=0,u=c,h===0?(_=138,y=3):c===h?(_=6,y=3):(_=7,y=4)}};let $H=!1;const KH=(e,n,i,o)=>{Uc(e,0+(o?1:0),3),BH(e),Pb(e,i),Pb(e,~i),i&&e.pending_buf.set(e.window.subarray(n,n+i),e.pending),e.pending+=i};var sme=e=>{$H||((()=>{let n,i,o,c,u;const h=new Array(16);for(o=0,c=0;c<28;c++)for(Fx[c]=o,n=0;n<1<<Vx[c];n++)Ab[o++]=c;for(Ab[o-1]=c,u=0,c=0;c<16;c++)for(yP[c]=u,n=0;n<1<<EP[c];n++)Ib[u++]=c;for(u>>=7;c<wb;c++)for(yP[c]=u<<7,n=0;n<1<<EP[c]-7;n++)Ib[256+u++]=c;for(i=0;i<=Rb;i++)h[i]=0;for(n=0;n<=143;)Kp[2*n+1]=8,n++,h[8]++;for(;n<=255;)Kp[2*n+1]=9,n++,h[9]++;for(;n<=279;)Kp[2*n+1]=7,n++,h[7]++;for(;n<=287;)Kp[2*n+1]=8,n++,h[8]++;for(FH(Kp,287,h),n=0;n<wb;n++)Cb[2*n+1]=5,Cb[2*n]=VH(n,5);LH=new jx(Kp,Vx,257,NH,Rb),xH=new jx(Cb,EP,0,wb,Rb),MH=new jx(new Array(0),ime,0,19,7)})(),$H=!0),e.l_desc=new Bx(e.dyn_ltree,LH),e.d_desc=new Bx(e.dyn_dtree,xH),e.bl_desc=new Bx(e.bl_tree,MH),e.bi_buf=0,e.bi_valid=0,jH(e)},ome=(e,n,i,o)=>{let c,u,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(m=>{let _,y=4093624447;for(_=0;_<=31;_++,y>>>=1)if(1&y&&m.dyn_ltree[2*_]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(_=32;_<Ux;_++)if(m.dyn_ltree[2*_]!==0)return 1;return 0})(e)),zx(e,e.l_desc),zx(e,e.d_desc),h=(m=>{let _;for(GH(m,m.dyn_ltree,m.l_desc.max_code),GH(m,m.dyn_dtree,m.d_desc.max_code),zx(m,m.bl_desc),_=18;_>=3&&m.bl_tree[2*DH[_]+1]===0;_--);return m.opt_len+=3*(_+1)+5+5+4,_})(e),c=e.opt_len+3+7>>>3,u=e.static_len+3+7>>>3,u<=c&&(c=u)):c=u=i+5,i+4<=c&&n!==-1?KH(e,n,i,o):e.strategy===4||u===c?(Uc(e,2+(o?1:0),3),zH(e,Kp,Cb)):(Uc(e,4+(o?1:0),3),((m,_,y,S)=>{let w;for(Uc(m,_-257,5),Uc(m,y-1,5),Uc(m,S-4,4),w=0;w<S;w++)Uc(m,m.bl_tree[2*DH[w]+1],3);HH(m,m.dyn_ltree,_-1),HH(m,m.dyn_dtree,y-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),zH(e,e.dyn_ltree,e.dyn_dtree)),jH(e),o&&BH(e)},ame=(e,n,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=n,e.pending_buf[e.sym_buf+e.sym_next++]=n>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,n===0?e.dyn_ltree[2*i]++:(e.matches++,n--,e.dyn_ltree[2*(Ab[i]+Ux+1)]++,e.dyn_dtree[2*UH(n)]++),e.sym_next===e.sym_end),cme=e=>{Uc(e,2,3),_h(e,256,Kp),(n=>{n.bi_valid===16?(Pb(n,n.bi_buf),n.bi_buf=0,n.bi_valid=0):n.bi_valid>=8&&(n.pending_buf[n.pending++]=255&n.bi_buf,n.bi_buf>>=8,n.bi_valid-=8)})(e)},lme={_tr_init:sme,_tr_stored_block:KH,_tr_flush_block:ome,_tr_tally:ame,_tr_align:cme},Ob=(e,n,i,o)=>{let c=65535&e|0,u=e>>>16&65535|0,h=0;for(;i!==0;){h=i>2e3?2e3:i,i-=h;do c=c+n[o++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const ume=new Uint32Array((()=>{let e,n=[];for(var i=0;i<256;i++){e=i;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;n[i]=e}return n})());var vo=(e,n,i,o)=>{const c=ume,u=o+i;e^=-1;for(let h=o;h<u;h++)e=e>>>8^c[255&(e^n[h])];return-1^e},V_={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},vP={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:dme,_tr_stored_block:Gx,_tr_flush_block:hme,_tr_tally:km,_tr_align:pme}=lme,{Z_NO_FLUSH:Nm,Z_PARTIAL_FLUSH:fme,Z_FULL_FLUSH:mme,Z_FINISH:uu,Z_BLOCK:qH,Z_OK:Ko,Z_STREAM_END:YH,Z_STREAM_ERROR:Eh,Z_DATA_ERROR:gme,Z_BUF_ERROR:Hx,Z_DEFAULT_COMPRESSION:_me,Z_FILTERED:Eme,Z_HUFFMAN_ONLY:SP,Z_RLE:yme,Z_FIXED:vme,Z_DEFAULT_STRATEGY:Sme,Z_UNKNOWN:Tme,Z_DEFLATED:TP}=vP,$x=286,bme=30,wme=19,Rme=2*$x+1,Cme=15,F_=258,yh=262,$v=42,j_=113,kb=666,B_=(e,n)=>(e.msg=V_[n],n),XH=e=>2*e-(e>4?9:0),Dm=e=>{let n=e.length;for(;--n>=0;)e[n]=0},Ime=e=>{let n,i,o,c=e.w_size;n=e.hash_size,o=n;do i=e.head[--o],e.head[o]=i>=c?i-c:0;while(--n);n=c,o=n;do i=e.prev[--o],e.prev[o]=i>=c?i-c:0;while(--n)};let Lm=(e,n,i)=>(n<<e.hash_shift^i)&e.hash_mask;const El=e=>{const n=e.state;let i=n.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(e.output.set(n.pending_buf.subarray(n.pending_out,n.pending_out+i),e.next_out),e.next_out+=i,n.pending_out+=i,e.total_out+=i,e.avail_out-=i,n.pending-=i,n.pending===0&&(n.pending_out=0))},yl=(e,n)=>{hme(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,n),e.block_start=e.strstart,El(e.strm)},Hr=(e,n)=>{e.pending_buf[e.pending++]=n},Nb=(e,n)=>{e.pending_buf[e.pending++]=n>>>8&255,e.pending_buf[e.pending++]=255&n},Kx=(e,n,i,o)=>{let c=e.avail_in;return c>o&&(c=o),c===0?0:(e.avail_in-=c,n.set(e.input.subarray(e.next_in,e.next_in+c),i),e.state.wrap===1?e.adler=Ob(e.adler,n,c,i):e.state.wrap===2&&(e.adler=vo(e.adler,n,c,i)),e.next_in+=c,e.total_in+=c,c)},JH=(e,n)=>{let i,o,c=e.max_chain_length,u=e.strstart,h=e.prev_length,m=e.nice_match;const _=e.strstart>e.w_size-yh?e.strstart-(e.w_size-yh):0,y=e.window,S=e.w_mask,w=e.prev,A=e.strstart+F_;let k=y[u+h-1],W=y[u+h];e.prev_length>=e.good_match&&(c>>=2),m>e.lookahead&&(m=e.lookahead);do if(i=n,y[i+h]===W&&y[i+h-1]===k&&y[i]===y[u]&&y[++i]===y[u+1]){u+=2,i++;do;while(y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&y[++u]===y[++i]&&u<A);if(o=F_-(A-u),u=A-F_,o>h){if(e.match_start=n,h=o,o>=m)break;k=y[u+h-1],W=y[u+h]}}while((n=w[n&S])>_&&--c!=0);return h<=e.lookahead?h:e.lookahead},Kv=e=>{const n=e.w_size;let i,o,c;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=n+(n-yh)&&(e.window.set(e.window.subarray(n,n+n-o),0),e.match_start-=n,e.strstart-=n,e.block_start-=n,e.insert>e.strstart&&(e.insert=e.strstart),Ime(e),o+=n),e.strm.avail_in===0)break;if(i=Kx(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=Lm(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=Lm(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<yh&&e.strm.avail_in!==0)},QH=(e,n)=>{let i,o,c,u=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,m=e.strm.avail_in;do{if(i=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,o=e.strstart-e.block_start,i>o+e.strm.avail_in&&(i=o+e.strm.avail_in),i>c&&(i=c),i<u&&(i===0&&n!==uu||n===Nm||i!==o+e.strm.avail_in)))break;h=n===uu&&i===o+e.strm.avail_in?1:0,Gx(e,0,0,h),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,El(e.strm),o&&(o>i&&(o=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+o),e.strm.next_out),e.strm.next_out+=o,e.strm.avail_out-=o,e.strm.total_out+=o,e.block_start+=o,i-=o),i&&(Kx(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(h===0);return m-=e.strm.avail_in,m&&(m>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=m&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-m,e.strm.next_in),e.strstart),e.strstart+=m,e.insert+=m>e.w_size-e.insert?e.w_size-e.insert:m),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:n!==Nm&&n!==uu&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(Kx(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,u=c>e.w_size?e.w_size:c,o=e.strstart-e.block_start,(o>=u||(o||n===uu)&&n!==Nm&&e.strm.avail_in===0&&o<=c)&&(i=o>c?c:o,h=n===uu&&e.strm.avail_in===0&&i===o?1:0,Gx(e,e.block_start,i,h),e.block_start+=i,El(e.strm)),h?3:1)},qx=(e,n)=>{let i,o;for(;;){if(e.lookahead<yh){if(Kv(e),e.lookahead<yh&&n===Nm)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=Lm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-yh&&(e.match_length=JH(e,i)),e.match_length>=3)if(o=km(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=Lm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Lm(e,e.ins_h,e.window[e.strstart+1]);else o=km(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(yl(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,n===uu?(yl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(yl(e,!1),e.strm.avail_out===0)?1:2},qv=(e,n)=>{let i,o,c;for(;;){if(e.lookahead<yh){if(Kv(e),e.lookahead<yh&&n===Nm)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=Lm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-yh&&(e.match_length=JH(e,i),e.match_length<=5&&(e.strategy===Eme||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,o=km(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=Lm(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(yl(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(o=km(e,0,e.window[e.strstart-1]),o&&yl(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=km(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,n===uu?(yl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(yl(e,!1),e.strm.avail_out===0)?1:2};function vh(e,n,i,o,c){this.good_length=e,this.max_lazy=n,this.nice_length=i,this.max_chain=o,this.func=c}const Db=[new vh(0,0,0,0,QH),new vh(4,4,8,4,qx),new vh(4,5,16,8,qx),new vh(4,6,32,32,qx),new vh(4,4,16,16,qv),new vh(8,16,32,32,qv),new vh(8,16,128,128,qv),new vh(8,32,128,256,qv),new vh(32,128,258,1024,qv),new vh(32,258,258,4096,qv)];function Ame(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=TP,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Rme),this.dyn_dtree=new Uint16Array(2*(2*bme+1)),this.bl_tree=new Uint16Array(2*(2*wme+1)),Dm(this.dyn_ltree),Dm(this.dyn_dtree),Dm(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Cme+1),this.heap=new Uint16Array(2*$x+1),Dm(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*$x+1),Dm(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Lb=e=>{if(!e)return 1;const n=e.state;return!n||n.strm!==e||n.status!==$v&&n.status!==57&&n.status!==69&&n.status!==73&&n.status!==91&&n.status!==103&&n.status!==j_&&n.status!==kb?1:0},ZH=e=>{if(Lb(e))return B_(e,Eh);e.total_in=e.total_out=0,e.data_type=Tme;const n=e.state;return n.pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=n.wrap===2?57:n.wrap?$v:j_,e.adler=n.wrap===2?0:1,n.last_flush=-2,dme(n),Ko},e7=e=>{const n=ZH(e);return n===Ko&&(i=>{i.window_size=2*i.w_size,Dm(i.head),i.max_lazy_match=Db[i.level].max_lazy,i.good_match=Db[i.level].good_length,i.nice_match=Db[i.level].nice_length,i.max_chain_length=Db[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(e.state),n},t7=(e,n,i,o,c,u)=>{if(!e)return Eh;let h=1;if(n===_me&&(n=6),o<0?(h=0,o=-o):o>15&&(h=2,o-=16),c<1||c>9||i!==TP||o<8||o>15||n<0||n>9||u<0||u>vme||o===8&&h!==1)return B_(e,Eh);o===8&&(o=9);const m=new Ame;return e.state=m,m.strm=e,m.status=$v,m.wrap=h,m.gzhead=null,m.w_bits=o,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=n,m.strategy=u,m.method=i,e7(e)};var Pme=(e,n)=>{if(Lb(e)||n>qH||n<0)return e?B_(e,Eh):Eh;const i=e.state;if(!e.output||e.avail_in!==0&&!e.input||i.status===kb&&n!==uu)return B_(e,e.avail_out===0?Hx:Eh);const o=i.last_flush;if(i.last_flush=n,i.pending!==0){if(El(e),e.avail_out===0)return i.last_flush=-1,Ko}else if(e.avail_in===0&&XH(n)<=XH(o)&&n!==uu)return B_(e,Hx);if(i.status===kb&&e.avail_in!==0)return B_(e,Hx);if(i.status===$v&&i.wrap===0&&(i.status=j_),i.status===$v){let c=TP+(i.w_bits-8<<4)<<8,u=-1;if(u=i.strategy>=SP||i.level<2?0:i.level<6?1:i.level===6?2:3,c|=u<<6,i.strstart!==0&&(c|=32),c+=31-c%31,Nb(i,c),i.strstart!==0&&(Nb(i,e.adler>>>16),Nb(i,65535&e.adler)),e.adler=1,i.status=j_,El(e),i.pending!==0)return i.last_flush=-1,Ko}if(i.status===57){if(e.adler=0,Hr(i,31),Hr(i,139),Hr(i,8),i.gzhead)Hr(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),Hr(i,255&i.gzhead.time),Hr(i,i.gzhead.time>>8&255),Hr(i,i.gzhead.time>>16&255),Hr(i,i.gzhead.time>>24&255),Hr(i,i.level===9?2:i.strategy>=SP||i.level<2?4:0),Hr(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(Hr(i,255&i.gzhead.extra.length),Hr(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=vo(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(Hr(i,0),Hr(i,0),Hr(i,0),Hr(i,0),Hr(i,0),Hr(i,i.level===9?2:i.strategy>=SP||i.level<2?4:0),Hr(i,3),i.status=j_,El(e),i.pending!==0)return i.last_flush=-1,Ko}if(i.status===69){if(i.gzhead.extra){let c=i.pending,u=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+u>i.pending_buf_size;){let m=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+m),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>c&&(e.adler=vo(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex+=m,El(e),i.pending!==0)return i.last_flush=-1,Ko;c=0,u-=m}let h=new Uint8Array(i.gzhead.extra);i.pending_buf.set(h.subarray(i.gzindex,i.gzindex+u),i.pending),i.pending+=u,i.gzhead.hcrc&&i.pending>c&&(e.adler=vo(e.adler,i.pending_buf,i.pending-c,c)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=vo(e.adler,i.pending_buf,i.pending-u,u)),El(e),i.pending!==0)return i.last_flush=-1,Ko;u=0}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,Hr(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=vo(e.adler,i.pending_buf,i.pending-u,u)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let c,u=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>u&&(e.adler=vo(e.adler,i.pending_buf,i.pending-u,u)),El(e),i.pending!==0)return i.last_flush=-1,Ko;u=0}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,Hr(i,c)}while(c!==0);i.gzhead.hcrc&&i.pending>u&&(e.adler=vo(e.adler,i.pending_buf,i.pending-u,u))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(El(e),i.pending!==0))return i.last_flush=-1,Ko;Hr(i,255&e.adler),Hr(i,e.adler>>8&255),e.adler=0}if(i.status=j_,El(e),i.pending!==0)return i.last_flush=-1,Ko}if(e.avail_in!==0||i.lookahead!==0||n!==Nm&&i.status!==kb){let c=i.level===0?QH(i,n):i.strategy===SP?((u,h)=>{let m;for(;;){if(u.lookahead===0&&(Kv(u),u.lookahead===0)){if(h===Nm)return 1;break}if(u.match_length=0,m=km(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,m&&(yl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===uu?(yl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(yl(u,!1),u.strm.avail_out===0)?1:2})(i,n):i.strategy===yme?((u,h)=>{let m,_,y,S;const w=u.window;for(;;){if(u.lookahead<=F_){if(Kv(u),u.lookahead<=F_&&h===Nm)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(y=u.strstart-1,_=w[y],_===w[++y]&&_===w[++y]&&_===w[++y])){S=u.strstart+F_;do;while(_===w[++y]&&_===w[++y]&&_===w[++y]&&_===w[++y]&&_===w[++y]&&_===w[++y]&&_===w[++y]&&_===w[++y]&&y<S);u.match_length=F_-(S-y),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(m=km(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(m=km(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),m&&(yl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===uu?(yl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(yl(u,!1),u.strm.avail_out===0)?1:2})(i,n):Db[i.level].func(i,n);if(c!==3&&c!==4||(i.status=kb),c===1||c===3)return e.avail_out===0&&(i.last_flush=-1),Ko;if(c===2&&(n===fme?pme(i):n!==qH&&(Gx(i,0,0,!1),n===mme&&(Dm(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),El(e),e.avail_out===0))return i.last_flush=-1,Ko}return n!==uu?Ko:i.wrap<=0?YH:(i.wrap===2?(Hr(i,255&e.adler),Hr(i,e.adler>>8&255),Hr(i,e.adler>>16&255),Hr(i,e.adler>>24&255),Hr(i,255&e.total_in),Hr(i,e.total_in>>8&255),Hr(i,e.total_in>>16&255),Hr(i,e.total_in>>24&255)):(Nb(i,e.adler>>>16),Nb(i,65535&e.adler)),El(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Ko:YH)},Ome=(e,n)=>{let i=n.length;if(Lb(e))return Eh;const o=e.state,c=o.wrap;if(c===2||c===1&&o.status!==$v||o.lookahead)return Eh;if(c===1&&(e.adler=Ob(e.adler,n,i,0)),o.wrap=0,i>=o.w_size){c===0&&(Dm(o.head),o.strstart=0,o.block_start=0,o.insert=0);let _=new Uint8Array(o.w_size);_.set(n.subarray(i-o.w_size,i),0),n=_,i=o.w_size}const u=e.avail_in,h=e.next_in,m=e.input;for(e.avail_in=i,e.next_in=0,e.input=n,Kv(o);o.lookahead>=3;){let _=o.strstart,y=o.lookahead-2;do o.ins_h=Lm(o,o.ins_h,o.window[_+3-1]),o.prev[_&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=_,_++;while(--y);o.strstart=_,o.lookahead=2,Kv(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,e.next_in=h,e.input=m,e.avail_in=u,o.wrap=c,Ko},xb={deflateInit:(e,n)=>t7(e,n,TP,15,8,Sme),deflateInit2:t7,deflateReset:e7,deflateResetKeep:ZH,deflateSetHeader:(e,n)=>Lb(e)||e.state.wrap!==2?Eh:(e.state.gzhead=n,Ko),deflate:Pme,deflateEnd:e=>{if(Lb(e))return Eh;const n=e.state.status;return e.state=null,n===j_?B_(e,gme):Ko},deflateSetDictionary:Ome,deflateInfo:"pako deflate (from Nodeca project)"};const kme=(e,n)=>Object.prototype.hasOwnProperty.call(e,n);var bP={assign:function(e){const n=Array.prototype.slice.call(arguments,1);for(;n.length;){const i=n.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(const o in i)kme(i,o)&&(e[o]=i[o])}}return e},flattenChunks:e=>{let n=0;for(let o=0,c=e.length;o<c;o++)n+=e[o].length;const i=new Uint8Array(n);for(let o=0,c=0,u=e.length;o<u;o++){let h=e[o];i.set(h,c),c+=h.length}return i}};let n7=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{n7=!1}const Mb=new Uint8Array(256);for(let e=0;e<256;e++)Mb[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Mb[254]=Mb[254]=1;var Ub={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let n,i,o,c,u,h=e.length,m=0;for(c=0;c<h;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),c++)),m+=i<128?1:i<2048?2:i<65536?3:4;for(n=new Uint8Array(m),u=0,c=0;u<m;c++)i=e.charCodeAt(c),(64512&i)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(i=65536+(i-55296<<10)+(o-56320),c++)),i<128?n[u++]=i:i<2048?(n[u++]=192|i>>>6,n[u++]=128|63&i):i<65536?(n[u++]=224|i>>>12,n[u++]=128|i>>>6&63,n[u++]=128|63&i):(n[u++]=240|i>>>18,n[u++]=128|i>>>12&63,n[u++]=128|i>>>6&63,n[u++]=128|63&i);return n},buf2string:(e,n)=>{const i=n||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,n));let o,c;const u=new Array(2*i);for(c=0,o=0;o<i;){let h=e[o++];if(h<128){u[c++]=h;continue}let m=Mb[h];if(m>4)u[c++]=65533,o+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&o<i;)h=h<<6|63&e[o++],m--;m>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&n7)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let _="";for(let y=0;y<m;y++)_+=String.fromCharCode(h[y]);return _})(u,c)},utf8border:(e,n)=>{(n=n||e.length)>e.length&&(n=e.length);let i=n-1;for(;i>=0&&(192&e[i])==128;)i--;return i<0||i===0?n:i+Mb[e[i]]>n?i:n}},r7=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const i7=Object.prototype.toString,{Z_NO_FLUSH:Nme,Z_SYNC_FLUSH:Dme,Z_FULL_FLUSH:Lme,Z_FINISH:xme,Z_OK:wP,Z_STREAM_END:Mme,Z_DEFAULT_COMPRESSION:Ume,Z_DEFAULT_STRATEGY:Vme,Z_DEFLATED:Fme}=vP;function RP(e){this.options=bP.assign({level:Ume,method:Fme,chunkSize:16384,windowBits:15,memLevel:8,strategy:Vme},e||{});let n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r7,this.strm.avail_out=0;let i=xb.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(i!==wP)throw new Error(V_[i]);if(n.header&&xb.deflateSetHeader(this.strm,n.header),n.dictionary){let o;if(o=typeof n.dictionary=="string"?Ub.string2buf(n.dictionary):i7.call(n.dictionary)==="[object ArrayBuffer]"?new Uint8Array(n.dictionary):n.dictionary,i=xb.deflateSetDictionary(this.strm,o),i!==wP)throw new Error(V_[i]);this._dict_set=!0}}function jme(e,n){const i=new RP(n);if(i.push(e,!0),i.err)throw i.msg||V_[i.err];return i.result}RP.prototype.push=function(e,n){const i=this.strm,o=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=n===~~n?n:n===!0?xme:Nme,typeof e=="string"?i.input=Ub.string2buf(e):i7.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),(u===Dme||u===Lme)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(c=xb.deflate(i,u),c===Mme)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),c=xb.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===wP;if(i.avail_out!==0){if(u>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},RP.prototype.onData=function(e){this.chunks.push(e)},RP.prototype.onEnd=function(e){e===wP&&(this.result=bP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Bme={deflate:jme};const CP=16209;var Wme=function(e,n){let i,o,c,u,h,m,_,y,S,w,A,k,W,U,V,q,Y,ce,_e,Ee,me,ke,Ye,ut;const pt=e.state;i=e.next_in,Ye=e.input,o=i+(e.avail_in-5),c=e.next_out,ut=e.output,u=c-(n-e.avail_out),h=c+(e.avail_out-257),m=pt.dmax,_=pt.wsize,y=pt.whave,S=pt.wnext,w=pt.window,A=pt.hold,k=pt.bits,W=pt.lencode,U=pt.distcode,V=(1<<pt.lenbits)-1,q=(1<<pt.distbits)-1;e:do{k<15&&(A+=Ye[i++]<<k,k+=8,A+=Ye[i++]<<k,k+=8),Y=W[A&V];t:for(;;){if(ce=Y>>>24,A>>>=ce,k-=ce,ce=Y>>>16&255,ce===0)ut[c++]=65535&Y;else{if(!(16&ce)){if((64&ce)==0){Y=W[(65535&Y)+(A&(1<<ce)-1)];continue t}if(32&ce){pt.mode=16191;break e}e.msg="invalid literal/length code",pt.mode=CP;break e}_e=65535&Y,ce&=15,ce&&(k<ce&&(A+=Ye[i++]<<k,k+=8),_e+=A&(1<<ce)-1,A>>>=ce,k-=ce),k<15&&(A+=Ye[i++]<<k,k+=8,A+=Ye[i++]<<k,k+=8),Y=U[A&q];n:for(;;){if(ce=Y>>>24,A>>>=ce,k-=ce,ce=Y>>>16&255,!(16&ce)){if((64&ce)==0){Y=U[(65535&Y)+(A&(1<<ce)-1)];continue n}e.msg="invalid distance code",pt.mode=CP;break e}if(Ee=65535&Y,ce&=15,k<ce&&(A+=Ye[i++]<<k,k+=8,k<ce&&(A+=Ye[i++]<<k,k+=8)),Ee+=A&(1<<ce)-1,Ee>m){e.msg="invalid distance too far back",pt.mode=CP;break e}if(A>>>=ce,k-=ce,ce=c-u,Ee>ce){if(ce=Ee-ce,ce>y&&pt.sane){e.msg="invalid distance too far back",pt.mode=CP;break e}if(me=0,ke=w,S===0){if(me+=_-ce,ce<_e){_e-=ce;do ut[c++]=w[me++];while(--ce);me=c-Ee,ke=ut}}else if(S<ce){if(me+=_+S-ce,ce-=S,ce<_e){_e-=ce;do ut[c++]=w[me++];while(--ce);if(me=0,S<_e){ce=S,_e-=ce;do ut[c++]=w[me++];while(--ce);me=c-Ee,ke=ut}}}else if(me+=S-ce,ce<_e){_e-=ce;do ut[c++]=w[me++];while(--ce);me=c-Ee,ke=ut}for(;_e>2;)ut[c++]=ke[me++],ut[c++]=ke[me++],ut[c++]=ke[me++],_e-=3;_e&&(ut[c++]=ke[me++],_e>1&&(ut[c++]=ke[me++]))}else{me=c-Ee;do ut[c++]=ut[me++],ut[c++]=ut[me++],ut[c++]=ut[me++],_e-=3;while(_e>2);_e&&(ut[c++]=ut[me++],_e>1&&(ut[c++]=ut[me++]))}break}}break}}while(i<o&&c<h);_e=k>>3,i-=_e,k-=_e<<3,A&=(1<<k)-1,e.next_in=i,e.next_out=c,e.avail_in=i<o?o-i+5:5-(i-o),e.avail_out=c<h?h-c+257:257-(c-h),pt.hold=A,pt.bits=k};const IP=15,zme=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Gme=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Hme=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),$me=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Vb=(e,n,i,o,c,u,h,m)=>{const _=m.bits;let y,S,w,A,k,W,U=0,V=0,q=0,Y=0,ce=0,_e=0,Ee=0,me=0,ke=0,Ye=0,ut=null;const pt=new Uint16Array(16),yn=new Uint16Array(16);let vn,cr,Zr,Wr=null;for(U=0;U<=IP;U++)pt[U]=0;for(V=0;V<o;V++)pt[n[i+V]]++;for(ce=_,Y=IP;Y>=1&&pt[Y]===0;Y--);if(ce>Y&&(ce=Y),Y===0)return c[u++]=20971520,c[u++]=20971520,m.bits=1,0;for(q=1;q<Y&&pt[q]===0;q++);for(ce<q&&(ce=q),me=1,U=1;U<=IP;U++)if(me<<=1,me-=pt[U],me<0)return-1;if(me>0&&(e===0||Y!==1))return-1;for(yn[1]=0,U=1;U<IP;U++)yn[U+1]=yn[U]+pt[U];for(V=0;V<o;V++)n[i+V]!==0&&(h[yn[n[i+V]]++]=V);if(e===0?(ut=Wr=h,W=20):e===1?(ut=zme,Wr=Gme,W=257):(ut=Hme,Wr=$me,W=0),Ye=0,V=0,U=q,k=u,_e=ce,Ee=0,w=-1,ke=1<<ce,A=ke-1,e===1&&ke>852||e===2&&ke>592)return 1;for(;;){vn=U-Ee,h[V]+1<W?(cr=0,Zr=h[V]):h[V]>=W?(cr=Wr[h[V]-W],Zr=ut[h[V]-W]):(cr=96,Zr=0),y=1<<U-Ee,S=1<<_e,q=S;do S-=y,c[k+(Ye>>Ee)+S]=vn<<24|cr<<16|Zr|0;while(S!==0);for(y=1<<U-1;Ye&y;)y>>=1;if(y!==0?(Ye&=y-1,Ye+=y):Ye=0,V++,--pt[U]==0){if(U===Y)break;U=n[i+h[V]]}if(U>ce&&(Ye&A)!==w){for(Ee===0&&(Ee=ce),k+=q,_e=U-Ee,me=1<<_e;_e+Ee<Y&&(me-=pt[_e+Ee],!(me<=0));)_e++,me<<=1;if(ke+=1<<_e,e===1&&ke>852||e===2&&ke>592)return 1;w=Ye&A,c[w]=ce<<24|_e<<16|k-u|0}}return Ye!==0&&(c[k+Ye]=U-Ee<<24|64<<16|0),m.bits=ce,0};const{Z_FINISH:s7,Z_BLOCK:Kme,Z_TREES:AP,Z_OK:W_,Z_STREAM_END:qme,Z_NEED_DICT:Yme,Z_STREAM_ERROR:du,Z_DATA_ERROR:o7,Z_MEM_ERROR:a7,Z_BUF_ERROR:Xme,Z_DEFLATED:c7}=vP,PP=16180,OP=16190,qp=16191,Yx=16192,Xx=16194,kP=16199,NP=16200,Jx=16206,qi=16209,l7=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Jme(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const z_=e=>{if(!e)return 1;const n=e.state;return!n||n.strm!==e||n.mode<PP||n.mode>16211?1:0},u7=e=>{if(z_(e))return du;const n=e.state;return e.total_in=e.total_out=n.total=0,e.msg="",n.wrap&&(e.adler=1&n.wrap),n.mode=PP,n.last=0,n.havedict=0,n.flags=-1,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(852),n.distcode=n.distdyn=new Int32Array(592),n.sane=1,n.back=-1,W_},d7=e=>{if(z_(e))return du;const n=e.state;return n.wsize=0,n.whave=0,n.wnext=0,u7(e)},h7=(e,n)=>{let i;if(z_(e))return du;const o=e.state;return n<0?(i=0,n=-n):(i=5+(n>>4),n<48&&(n&=15)),n&&(n<8||n>15)?du:(o.window!==null&&o.wbits!==n&&(o.window=null),o.wrap=i,o.wbits=n,d7(e))},p7=(e,n)=>{if(!e)return du;const i=new Jme;e.state=i,i.strm=e,i.window=null,i.mode=PP;const o=h7(e,n);return o!==W_&&(e.state=null),o};let Qx,Zx,f7=!0;const Qme=e=>{if(f7){Qx=new Int32Array(512),Zx=new Int32Array(32);let n=0;for(;n<144;)e.lens[n++]=8;for(;n<256;)e.lens[n++]=9;for(;n<280;)e.lens[n++]=7;for(;n<288;)e.lens[n++]=8;for(Vb(1,e.lens,0,288,Qx,0,e.work,{bits:9}),n=0;n<32;)e.lens[n++]=5;Vb(2,e.lens,0,32,Zx,0,e.work,{bits:5}),f7=!1}e.lencode=Qx,e.lenbits=9,e.distcode=Zx,e.distbits=5},m7=(e,n,i,o)=>{let c;const u=e.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),o>=u.wsize?(u.window.set(n.subarray(i-u.wsize,i),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>o&&(c=o),u.window.set(n.subarray(i-o,i-o+c),u.wnext),(o-=c)?(u.window.set(n.subarray(i-o,i),0),u.wnext=o,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var Zme=(e,n)=>{let i,o,c,u,h,m,_,y,S,w,A,k,W,U,V,q,Y,ce,_e,Ee,me,ke,Ye=0;const ut=new Uint8Array(4);let pt,yn;const vn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(z_(e)||!e.output||!e.input&&e.avail_in!==0)return du;i=e.state,i.mode===qp&&(i.mode=Yx),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,y=i.hold,S=i.bits,w=m,A=_,ke=W_;e:for(;;)switch(i.mode){case PP:if(i.wrap===0){i.mode=Yx;break}for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(2&i.wrap&&y===35615){i.wbits===0&&(i.wbits=15),i.check=0,ut[0]=255&y,ut[1]=y>>>8&255,i.check=vo(i.check,ut,2,0),y=0,S=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&y)<<8)+(y>>8))%31){e.msg="incorrect header check",i.mode=qi;break}if((15&y)!==c7){e.msg="unknown compression method",i.mode=qi;break}if(y>>>=4,S-=4,me=8+(15&y),i.wbits===0&&(i.wbits=me),me>15||me>i.wbits){e.msg="invalid window size",i.mode=qi;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&y?16189:qp,y=0,S=0;break;case 16181:for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(i.flags=y,(255&Zs(i))!==c7){e.msg="unknown compression method",i.mode=qi;break}if(57344&Zs(i)){e.msg="unknown header flags set",i.mode=qi;break}i.head&&(i.head.text=y>>8&1),512&Zs(i)&&4&i.wrap&&(ut[0]=255&y,ut[1]=y>>>8&255,i.check=vo(i.check,ut,2,0)),y=0,S=0,i.mode=16182;case 16182:for(;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.head&&(i.head.time=y),512&Zs(i)&&4&i.wrap&&(ut[0]=255&y,ut[1]=y>>>8&255,ut[2]=y>>>16&255,ut[3]=y>>>24&255,i.check=vo(i.check,ut,4,0)),y=0,S=0,i.mode=16183;case 16183:for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.head&&(i.head.xflags=255&y,i.head.os=y>>8),512&Zs(i)&&4&i.wrap&&(ut[0]=255&y,ut[1]=y>>>8&255,i.check=vo(i.check,ut,2,0)),y=0,S=0,i.mode=16184;case 16184:if(1024&Zs(i)){for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.length=y,i.head&&(i.head.extra_len=y),512&Zs(i)&&4&i.wrap&&(ut[0]=255&y,ut[1]=y>>>8&255,i.check=vo(i.check,ut,2,0)),y=0,S=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&Zs(i)&&(k=i.length,k>m&&(k=m),k&&(i.head&&(me=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(o.subarray(u,u+k),me)),512&Zs(i)&&4&i.wrap&&(i.check=vo(i.check,o,k,u)),m-=k,u+=k,i.length-=k),i.length))break e;i.length=0,i.mode=16186;case 16186:if(2048&Zs(i)){if(m===0)break e;k=0;do me=o[u+k++],i.head&&me&&i.length<65536&&(i.head.name+=String.fromCharCode(me));while(me&&k<m);if(512&Zs(i)&&4&i.wrap&&(i.check=vo(i.check,o,k,u)),m-=k,u+=k,me)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&Zs(i)){if(m===0)break e;k=0;do me=o[u+k++],i.head&&me&&i.length<65536&&(i.head.comment+=String.fromCharCode(me));while(me&&k<m);if(512&Zs(i)&&4&i.wrap&&(i.check=vo(i.check,o,k,u)),m-=k,u+=k,me)break e}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&Zs(i)){for(;S<16;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(4&i.wrap&&y!==(65535&i.check)){e.msg="header crc mismatch",i.mode=qi;break}y=0,S=0}i.head&&(i.head.hcrc=Zs(i)>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=qp;break;case 16189:for(;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}e.adler=i.check=l7(y),y=0,S=0,i.mode=OP;case OP:if(i.havedict===0)return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=y,i.bits=S,Yme;e.adler=i.check=1,i.mode=qp;case qp:if(n===Kme||n===AP)break e;case Yx:if(i.last){y>>>=7&S,S-=7&S,i.mode=Jx;break}for(;S<3;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}switch(i.last=1&y,y>>>=1,S-=1,3&y){case 0:i.mode=16193;break;case 1:if(Qme(i),i.mode=kP,n===AP){y>>>=2,S-=2;break e}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=qi}y>>>=2,S-=2;break;case 16193:for(y>>>=7&S,S-=7&S;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if((65535&y)!=(y>>>16^65535)){e.msg="invalid stored block lengths",i.mode=qi;break}if(i.length=65535&y,y=0,S=0,i.mode=Xx,n===AP)break e;case Xx:i.mode=16195;case 16195:if(k=i.length,k){if(k>m&&(k=m),k>_&&(k=_),k===0)break e;c.set(o.subarray(u,u+k),h),m-=k,u+=k,_-=k,h+=k,i.length-=k;break}i.mode=qp;break;case 16196:for(;S<14;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(i.nlen=257+(31&y),y>>>=5,S-=5,i.ndist=1+(31&y),y>>>=5,S-=5,i.ncode=4+(15&y),y>>>=4,S-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=qi;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;S<3;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.lens[vn[i.have++]]=7&y,y>>>=3,S-=3}for(;i.have<19;)i.lens[vn[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,pt={bits:i.lenbits},ke=Vb(0,i.lens,0,19,i.lencode,0,i.work,pt),i.lenbits=pt.bits,ke){e.msg="invalid code lengths set",i.mode=qi;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;Ye=i.lencode[y&(1<<i.lenbits)-1],V=Ye>>>24,q=Ye>>>16&255,Y=65535&Ye,!(V<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(Y<16)y>>>=V,S-=V,i.lens[i.have++]=Y;else{if(Y===16){for(yn=V+2;S<yn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(y>>>=V,S-=V,i.have===0){e.msg="invalid bit length repeat",i.mode=qi;break}me=i.lens[i.have-1],k=3+(3&y),y>>>=2,S-=2}else if(Y===17){for(yn=V+3;S<yn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=V,S-=V,me=0,k=3+(7&y),y>>>=3,S-=3}else{for(yn=V+7;S<yn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=V,S-=V,me=0,k=11+(127&y),y>>>=7,S-=7}if(i.have+k>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=qi;break}for(;k--;)i.lens[i.have++]=me}}if(i.mode===qi)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=qi;break}if(i.lenbits=9,pt={bits:i.lenbits},ke=Vb(1,i.lens,0,i.nlen,i.lencode,0,i.work,pt),i.lenbits=pt.bits,ke){e.msg="invalid literal/lengths set",i.mode=qi;break}if(i.distbits=6,i.distcode=i.distdyn,pt={bits:i.distbits},ke=Vb(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,pt),i.distbits=pt.bits,ke){e.msg="invalid distances set",i.mode=qi;break}if(i.mode=kP,n===AP)break e;case kP:i.mode=NP;case NP:if(m>=6&&_>=258){e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=y,i.bits=S,Wme(e,A),h=e.next_out,c=e.output,_=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,y=i.hold,S=i.bits,i.mode===qp&&(i.back=-1);break}for(i.back=0;Ye=i.lencode[y&(1<<i.lenbits)-1],V=Ye>>>24,q=Ye>>>16&255,Y=65535&Ye,!(V<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(q&&(240&q)==0){for(ce=V,_e=q,Ee=Y;Ye=i.lencode[Ee+((y&(1<<ce+_e)-1)>>ce)],V=Ye>>>24,q=Ye>>>16&255,Y=65535&Ye,!(ce+V<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=ce,S-=ce,i.back+=ce}if(y>>>=V,S-=V,i.back+=V,i.length=Y,q===0){i.mode=16205;break}if(32&q){i.back=-1,i.mode=qp;break}if(64&q){e.msg="invalid literal/length code",i.mode=qi;break}i.extra=15&q,i.mode=16201;case 16201:if(i.extra){for(yn=i.extra;S<yn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.length+=y&(1<<i.extra)-1,y>>>=i.extra,S-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;Ye=i.distcode[y&(1<<i.distbits)-1],V=Ye>>>24,q=Ye>>>16&255,Y=65535&Ye,!(V<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if((240&q)==0){for(ce=V,_e=q,Ee=Y;Ye=i.distcode[Ee+((y&(1<<ce+_e)-1)>>ce)],V=Ye>>>24,q=Ye>>>16&255,Y=65535&Ye,!(ce+V<=S);){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}y>>>=ce,S-=ce,i.back+=ce}if(y>>>=V,S-=V,i.back+=V,64&q){e.msg="invalid distance code",i.mode=qi;break}i.offset=Y,i.extra=15&q,i.mode=16203;case 16203:if(i.extra){for(yn=i.extra;S<yn;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}i.offset+=y&(1<<i.extra)-1,y>>>=i.extra,S-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=qi;break}i.mode=16204;case 16204:if(_===0)break e;if(k=A-_,i.offset>k){if(k=i.offset-k,k>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=qi;break}k>i.wnext?(k-=i.wnext,W=i.wsize-k):W=i.wnext-k,k>i.length&&(k=i.length),U=i.window}else U=c,W=h-i.offset,k=i.length;k>_&&(k=_),_-=k,i.length-=k;do c[h++]=U[W++];while(--k);i.length===0&&(i.mode=NP);break;case 16205:if(_===0)break e;c[h++]=i.length,_--,i.mode=NP;break;case Jx:if(i.wrap){for(;S<32;){if(m===0)break e;m--,y|=o[u++]<<S,S+=8}if(A-=_,e.total_out+=A,i.total+=A,4&i.wrap&&A&&(e.adler=i.check=Zs(i)?vo(i.check,c,A,h-A):Ob(i.check,c,A,h-A)),A=_,4&i.wrap&&(Zs(i)?y:l7(y))!==i.check){e.msg="incorrect data check",i.mode=qi;break}y=0,S=0}i.mode=16207;case 16207:if(i.wrap&&Zs(i)){for(;S<32;){if(m===0)break e;m--,y+=o[u++]<<S,S+=8}if(4&i.wrap&&y!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=qi;break}y=0,S=0}i.mode=16208;case 16208:ke=qme;break e;case qi:ke=o7;break e;case 16210:return a7;default:return du}return e.next_out=h,e.avail_out=_,e.next_in=u,e.avail_in=m,i.hold=y,i.bits=S,(i.wsize||A!==e.avail_out&&i.mode<qi&&(i.mode<Jx||n!==s7))&&m7(e,e.output,e.next_out,A-e.avail_out),w-=e.avail_in,A-=e.avail_out,e.total_in+=w,e.total_out+=A,i.total+=A,4&i.wrap&&A&&(e.adler=i.check=Zs(i)?vo(i.check,c,A,e.next_out-A):Ob(i.check,c,A,e.next_out-A)),e.data_type=i.bits+(i.last?64:0)+(i.mode===qp?128:0)+(i.mode===kP||i.mode===Xx?256:0),(w===0&&A===0||n===s7)&&ke===W_&&(ke=Xme),ke},Yp={inflateReset:d7,inflateReset2:h7,inflateResetKeep:u7,inflateInit:e=>p7(e,15),inflateInit2:p7,inflate:Zme,inflateEnd:e=>{if(z_(e))return du;let n=e.state;return n.window&&(n.window=null),e.state=null,W_},inflateGetHeader:(e,n)=>{if(z_(e))return du;const i=e.state;return(2&i.wrap)==0?du:(i.head=n,n.done=!1,W_)},inflateSetDictionary:(e,n)=>{const i=n.length;let o,c,u;return z_(e)?du:(o=e.state,o.wrap!==0&&o.mode!==OP?du:o.mode===OP&&(c=1,c=Ob(c,n,i,0),c!==o.check)?o7:(u=m7(e,n,i,i),u?(o.mode=16210,a7):(o.havedict=1,W_)))},inflateInfo:"pako inflate (from Nodeca project)"},ege=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const g7=Object.prototype.toString,{Z_NO_FLUSH:tge,Z_FINISH:nge,Z_OK:Fb,Z_STREAM_END:eM,Z_NEED_DICT:tM,Z_STREAM_ERROR:rge,Z_DATA_ERROR:_7,Z_MEM_ERROR:ige}=vP;function DP(e){this.options=bP.assign({chunkSize:65536,windowBits:15,to:""},e||{});const n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,n.windowBits===0&&(n.windowBits=-15)),!(n.windowBits>=0&&n.windowBits<16)||e&&e.windowBits||(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&(15&n.windowBits)==0&&(n.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r7,this.strm.avail_out=0;let i=Yp.inflateInit2(this.strm,n.windowBits);if(i!==Fb)throw new Error(V_[i]);if(this.header=new ege,Yp.inflateGetHeader(this.strm,this.header),n.dictionary&&(typeof n.dictionary=="string"?n.dictionary=Ub.string2buf(n.dictionary):g7.call(n.dictionary)==="[object ArrayBuffer]"&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(i=Yp.inflateSetDictionary(this.strm,n.dictionary),i!==Fb)))throw new Error(V_[i])}function sge(e,n){const i=new DP(n);if(i.push(e),i.err)throw i.msg||V_[i.err];return i.result}DP.prototype.push=function(e,n){const i=this.strm,o=this.options.chunkSize,c=this.options.dictionary;let u,h,m;if(this.ended)return!1;for(h=n===~~n?n:n===!0?nge:tge,g7.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(o),i.next_out=0,i.avail_out=o),u=Yp.inflate(i,h),u===tM&&c&&(u=Yp.inflateSetDictionary(i,c),u===Fb?u=Yp.inflate(i,h):u===_7&&(u=tM));i.avail_in>0&&u===eM&&i.state.wrap>0&&e[i.next_in]!==0;)Yp.inflateReset(i),u=Yp.inflate(i,h);switch(u){case rge:case _7:case tM:case ige:return this.onEnd(u),this.ended=!0,!1}if(m=i.avail_out,i.next_out&&(i.avail_out===0||u===eM))if(this.options.to==="string"){let _=Ub.utf8border(i.output,i.next_out),y=i.next_out-_,S=Ub.buf2string(i.output,_);i.next_out=y,i.avail_out=o-y,y&&i.output.set(i.output.subarray(_,_+y),0),this.onData(S)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(u!==Fb||m!==0){if(u===eM)return u=Yp.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},DP.prototype.onData=function(e){this.chunks.push(e)},DP.prototype.onEnd=function(e){e===Fb&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=bP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var oge={inflate:sge};const{deflate:age}=Bme,{inflate:cge}=oge;var lge=age,uge=cge,E7=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(E7||{});class dge{constructor(){$(this,"_sequence",0),$(this,"_startTime",Date.now()),$(this,"isUseOneByte",!0)}get startTime(){const n=Date.now()-this._startTime;return n<Math.pow(2,16)?n:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(n){const i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:n};if(n.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const _={id:0,length:4,data:m.buffer},y={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[_]};i.commonPacketHeader.extension=1,i.extension=y,i.payload=this.compress(n),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;re("SHOW_DATASTREAM2_LOG")&&D.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));const o=new ArrayBuffer(i.commonPacketHeader.length),c=new Uint8Array(o),u=new DataView(o);let h=0;if(u.setUint16(h,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),h+=2,u.setUint32(h,i.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,i.commonStreamHeader,!0),h+=2,i.extension){const m=this.serializeExtension(i.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(i.payload),h),h+=i.payload.byteLength,h!==i.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(n){if(n.byteLength<4)return new ArrayBuffer(0);const i=new DataView(n);let o=0;const c=i.getUint16(o,!0);o+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:i.getUint16(o+2,!0)<<16|i.getUint16(o,!0)};let h,m;if(o+=4,re("SHOW_DATASTREAM2_LOG")&&D.debug("receive data header: ".concat(JSON.stringify(u))),i.getUint16(o,!0),o+=2,u.extension){m=this.deserializeExtension(n.slice(o)),o+=2+m.length,h=n.slice(o);let _=!1;if(m.datas.length>0){const y=m.datas.find(S=>S.id===0);y&&(_=(1&new DataView(y.data).getUint32(0,!0))==1)}h=_?this.decompress(h):h}else h=n.slice(8);return h}serializeExtension(n){const{profile:i,length:o,datas:c}=n,u=new ArrayBuffer(o+2),h=new Uint8Array(u),m=new DataView(u);let _=0;if(m.setUint8(_++,i),m.setUint8(_++,o),c.forEach(y=>{i?(m.setUint8(_++,y.id),m.setUint8(_++,y.length),h.set(new Uint8Array(y.data),_),_+=y.data.byteLength):(m.setUint8(_++,y.id|y.length<<4),h.set(new Uint8Array(y.data),_),_+=y.data.byteLength)}),_!==o+2)throw Error("serialize extension error, is ".concat(_,"!==").concat(o+2));return u}deserializeExtension(n){const i=new DataView(n);let o=0;const c=i.getUint8(o);o++;const u=i.getUint8(o);o++;const h=c===E7.TWO_BYTE,m=[],_=new DataView(n,2);let y=0;for(;y<u;){let S=0,w=0,A=new ArrayBuffer(0);h?(S=_.getUint8(y),y++,w=_.getUint8(y),y++):(S=15&_.getUint8(y),w=_.getUint8(y)>>4,y++),w>0&&(A=_.buffer.slice(y+2,y+2+w),y+=A.byteLength),m.push({id:S,length:w,data:A})}if(y!==u)throw Error("parse error");return{profile:c,length:u,datas:m}}decompress(n){return uge(new Uint8Array(n))}compress(n){return lge(new Uint8Array(n))}}const hge={name:"DataStream",create:(e,n)=>{const i=n?new ype(e):new vpe(e);return i.useDataStream(new dge),i}};class pge extends Ar{constructor(n,i,o){super(),$(this,"ws",void 0),$(this,"requestId",1),$(this,"heartBeatTimer",void 0),$(this,"joinInfo",void 0),$(this,"clientId",void 0),$(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),$(this,"onClose",c=>{this.emit("close"),this.dispose()}),$(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=n,this.clientId=i,this.ws=new db("cross-channel-".concat(this.clientId),o),this.ws.on(Kt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Kt.CONNECTED,this.onOpen),this.ws.on(Kt.ON_MESSAGE,this.onMessage),this.ws.on(Kt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(n){const i=this.requestId++;return n.requestId=i,n.seq=i,this.ws.sendMessage(n),i}waitStatus(n){return new lt((i,o)=>{const c=window.setTimeout(()=>{o(new Oe(X.TIMEOUT,"wait status timeout, status: ".concat(n)))},5e3);this.once(n,u=>{window.clearTimeout(c),u.state&&u.state!==0?o(new Oe(X.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(n))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new Oe(X.WS_ABORT))})})}async request(n){if(this.ws.state==="closed")throw new Oe(X.WS_DISCONNECT);const i=()=>new lt((h,m)=>{this.ws.once(Kt.CLOSED,()=>m(new Oe(X.WS_ABORT))),this.ws.once(Kt.CONNECTED,h)});this.ws.state!=="connected"&&await i();const o=this.sendMessage(n),c=new lt((h,m)=>{const _=()=>{m(new Oe(X.WS_ABORT))};this.ws.once(Kt.RECONNECTING,_),this.ws.once(Kt.CLOSED,_),this.once("req_".concat(o),h),es(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(Kt.RECONNECTING,_),this.ws.off(Kt.CLOSED,_),m(new Oe(X.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new Oe(X.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(n){this.ws.removeAllListeners(Kt.REQUEST_NEW_URLS),this.ws.on(Kt.REQUEST_NEW_URLS,i=>{i(n)}),await this.ws.init(n)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(n){const i=this.requestId++;return n.requestId=i,this.ws.sendMessage(n),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class fge extends Ar{set state(n){n!==this._state&&(n!==va.RELAY_STATE_FAILURE&&(this.errorCode=Nv.RELAY_OK),this.emit("state",n,this.errorCode),this._state=n)}get state(){return this._state}constructor(n,i,o,c,u){super(),$(this,"joinInfo",void 0),$(this,"sid",void 0),$(this,"clientId",void 0),$(this,"cancelToken",Wo.CancelToken.source()),$(this,"workerToken",void 0),$(this,"requestId",0),$(this,"signal",void 0),$(this,"prevChannelMediaConfig",void 0),$(this,"httpRetryConfig",void 0),$(this,"_resolution",void 0),$(this,"_state",va.RELAY_STATE_IDLE),$(this,"errorCode",Nv.RELAY_OK),$(this,"onStatus",h=>{D.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",Wp.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",Wp.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Nv.SRC_TOKEN_EXPIRED,this.state=va.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Nv.DEST_TOKEN_EXPIRED,this.state=va.RELAY_STATE_FAILURE))}),$(this,"onReconnect",async()=>{D.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Wp.NETWORK_DISCONNECTED),this.state=va.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==va.RELAY_STATE_IDLE&&(D.error("auto restart channel media relay failed",h.toString()),this.errorCode=Nv.SERVER_CONNECTION_LOST,this.state=va.RELAY_STATE_FAILURE)})}),this.joinInfo=n,this.clientId=i,this.sid=S_(),this.signal=new pge(this.joinInfo,this.clientId,o),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(n){if(this.state!==va.RELAY_STATE_IDLE)throw new Oe(X.INVALID_OPERATION);this.state=va.RELAY_STATE_CONNECTING,await this.connect(),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(n)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new Oe(X.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new Oe(X.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new Oe(X.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=n}async updateChannelMediaRelay(n){if(this.state!==va.RELAY_STATE_RUNNING)throw new Oe(X.INVALID_OPERATION);await this.sendUpdateMessage(n),this.prevChannelMediaConfig=n}async setVideoProfile(n){if(this._resolution=n,this.state!==va.RELAY_STATE_RUNNING)throw new Oe(X.INVALID_OPERATION);const i=this.genMessage(yo.SetVideoProfile);await this.signal.request(i),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),D.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=va.RELAY_STATE_IDLE,this.dispose()}dispose(){D.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Wo.CancelToken.source(),this.state=va.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const n=await wfe(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=n.workerToken,await this.signal.connect(n.addressList),this.emit("event",Wp.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(n){const i=this.genMessage(yo.StopPacketTransfer);await this.signal.request(i),await this.signal.waitStatus("Normal Quit"),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(yo.SetSdkProfile,n);await this.signal.request(o),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(yo.SetSourceChannel,n);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Wp.PACKET_JOINED_SRC_CHANNEL),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(yo.SetSourceUserId,n);await this.signal.request(u),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(yo.SetDestChannel,n);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Wp.PACKET_JOINED_DEST_CHANNEL),D.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(yo.StartPacketTransfer,n);await this.signal.request(m),this.emit("event",Wp.PACKET_SENT_TO_DEST_CHANNEL),this.state=va.RELAY_STATE_RUNNING,D.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(n){const i=this.genMessage(yo.UpdateDestChannel,n);await this.signal.request(i),this.emit("event",Wp.PACKET_UPDATE_DEST_CHANNEL),D.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const n=this.genMessage(yo.StopPacketTransfer);await this.signal.request(n),D.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(n,i){const o=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:pl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let m=null,_=null;switch(n){case yo.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case yo.SetSourceChannel:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new Oe(X.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:_.channelName,token:_.token||this.joinInfo.appId},h;case yo.SetSourceUserId:if(_=i&&i.getSrcChannelMediaInfo(),!_)throw new Oe(X.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:_.uid+""},h;case yo.SetDestChannel:if(m=i&&i.getDestChannelMediaInfo(),!m)throw new Oe(X.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(y=>{o.push(y.channelName),c.push(y.uid+""),u.push(y.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:u},h;case yo.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case yo.Reconnect:return h.clientRequest={command:"Reconnect"},h;case yo.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case yo.UpdateDestChannel:if(m=i&&i.getDestChannelMediaInfo(),!m)throw new Oe(X.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(y=>{o.push(y.channelName),c.push(y.uid+""),u.push(y.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:u},h;case yo.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const mge={name:"ChannelMediaRelay",create:function(e){return new fge(e.joinInfo,e.clientId,e.websocketRetryConfig||gi,e.httpRetryConfig||gi,e.resolution)}};function y7(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function jb(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?y7(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):y7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class gge extends Ar{constructor(n,i,o,c){super(),$(this,"spec",void 0),$(this,"token",void 0),$(this,"websocket",void 0),$(this,"pingpongTimer",void 0),$(this,"reconnectMode","retry"),$(this,"serviceMode",void 0),$(this,"reqId",0),$(this,"commandReqId",0),$(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),$(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(wt.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===Bp.TRANSCODE?1:2}),this.emit(Sm.PUBLISH_STREAM_STATUS,h))}),this.spec=i,this.token=n,this.serviceMode=c,this.websocket=new db("live-streaming",o),this.websocket.on(Kt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Kt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Kt.REQUEST_NEW_URLS,(u,h)=>{Es(this,Sm.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(Kt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(n){return this.websocket.init(n)}async request(n,i,o,c){this.reqId+=1,n==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Oe(X.UNEXPECTED_ERROR);const m=jb({command:n,sdkVersion:pl==="4.23.2"?"0.0.1":pl,seq:h,requestId:h,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new Oe(X.WS_DISCONNECT);const _=()=>new lt((A,k)=>{this.websocket.once(Kt.CLOSED,()=>k(new Oe(X.WS_ABORT))),this.websocket.once(Kt.CONNECTED,A)});this.websocket.state!=="connected"&&await _(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const y=new lt((A,k)=>{const W=()=>{k(new Oe(X.WS_ABORT))};this.websocket.once(Kt.RECONNECTING,W),this.websocket.once(Kt.CLOSED,W),this.once("@".concat(h,"-").concat(this.spec.sid),U=>{A(U)})});c&&wt.workerEvent(this.spec.sid,jb(jb({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));const S=Date.now();this.websocket.sendMessage(m);let w=null;try{w=await y}catch(A){if(this.websocket.state==="closed")throw A;return await _(),await this.request(n,i,o)}return c&&wt.workerEvent(this.spec.sid,jb(jb({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(w.serverResponse),serverCode:w.code,success:w.code===200,responseTime:Date.now()-S})),w.code!==200&&this.handleResponseError(w),w}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const n=pl==="4.23.2"?"0.0.1":pl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:n,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(n){switch(n.code){case bi.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void D.warning("live stream response already exists stream");case bi.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case bi.LIVE_STREAM_RESPONSE_BAD_STREAM:case bi.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Oe(X.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:n.code}).throw();case bi.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(n.serverResponse.command==="UnpublishStream")return;throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case bi.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Oe(X.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:n.code}).throw();case bi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const i=new Oe(X.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Sm.WARNING,i,n.serverResponse.url)}case bi.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const i=new Oe(X.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Sm.WARNING,i,n.serverResponse.url)}case bi.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case bi.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Oe(X.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:n.code}).throw();case bi.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const i=new Oe(X.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Sm.WARNING,i,n.serverResponse.url)}case bi.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code}).throw();case bi.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case bi.LIVE_STREAM_RESPONSE_WORKER_LOST:case bi.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(n.serverResponse.command==="UnpublishStream")return;throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case bi.ERROR_FAIL_SEND_MESSAGE:if(n.serverResponse.command==="UnpublishStream")return;if(n.serverResponse.command==="UpdateTranscoding"||n.serverResponse.command==="ControlStream")return new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:n.code}).throw();throw new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case bi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Oe(X.LIVE_STREAMING_CDN_ERROR,"",{code:n.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(vA)},6e3)}}function v7(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Sa(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?v7(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):v7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class _ge extends Ar{constructor(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:gi,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:gi;super(),$(this,"onLiveStreamWarning",void 0),$(this,"onLiveStreamError",void 0),$(this,"spec",void 0),$(this,"retryTimeout",1e4),$(this,"connection",void 0),$(this,"httpRetryConfig",void 0),$(this,"wsRetryConfig",void 0),$(this,"streamingTasks",new Map),$(this,"isStartingStreamingTask",!1),$(this,"taskMutex",new Cs("live-streaming")),$(this,"cancelToken",Wo.CancelToken.source()),$(this,"transcodingConfig",void 0),$(this,"uapResponse",void 0),$(this,"lastTaskId",1),$(this,"statusError",new Map),this.spec=n,this.httpRetryConfig=o,this.wsRetryConfig=i}async setTranscodingConfig(n){const i=Sa(Sa({},rfe),n);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(D.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(h=>Sa(Sa(Sa({},nfe),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Dr(h.width)||er(h.width,"config.width",0,1e4),Dr(h.height)||er(h.height,"config.height",0,1e4),Dr(h.videoBitrate)||er(h.videoBitrate,"config.videoBitrate",1,1e6),Dr(h.videoFrameRate)||er(h.videoFrameRate,"config.videoFrameRate"),Dr(h.lowLatency)||Up(h.lowLatency,"config.lowLatency"),Dr(h.audioSampleRate)||Ci(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Dr(h.audioBitrate)||er(h.audioBitrate,"config.audioBitrate",1,128),Dr(h.audioChannels)||Ci(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Dr(h.videoGop)||er(h.videoGop,"config.videoGop"),Dr(h.videoCodecProfile)||Ci(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Dr(h.userCount)||er(h.userCount,"config.userCount",0,17),Dr(h.backgroundColor)||er(h.backgroundColor,"config.backgroundColor",0,16777215),Dr(h.userConfigExtraInfo)||Zi(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Dr(h.transcodingUsers)&&(Vp(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,_)=>{GA(m.uid),Dr(m.x)||er(m.x,"transcodingUser[".concat(_,"].x"),0,1e4),Dr(m.y)||er(m.y,"transcodingUser[".concat(_,"].y"),0,1e4),Dr(m.width)||er(m.width,"transcodingUser[".concat(_,"].width"),0,1e4),Dr(m.height)||er(m.height,"transcodingUser[".concat(_,"].height"),0,1e4),Dr(m.zOrder)||er(m.zOrder-1,"transcodingUser[".concat(_,"].zOrder"),0,100),Dr(m.alpha)||er(m.alpha,"transcodingUser[".concat(_,"].alpha"),0,1,!1)})),Dr(h.watermark)||rx(h.watermark,"watermark"),Dr(h.backgroundImage)||rx(h.backgroundImage,"backgroundImage"),h.images&&!Dr(h.images)&&(Vp(h.images,"config.images"),h.images.forEach((m,_)=>{rx(m,"images[".concat(_,"]"))}))}(i);const o=[];i.images&&o.push(...i.images.map(h=>Sa(Sa(Sa({},nx),h),{},{zOrder:255}))),i.backgroundImage&&(o.push(Sa(Sa(Sa({},nx),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(o.push(Sa(Sa(Sa({},nx),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=o,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(h=>Sa({},h)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);const c=(i.userConfigs||[]).map(h=>typeof h.uid=="number"?lt.resolve(h.uid):WG(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await lt.all(c)).forEach((h,m)=>{i.userConfigs&&i.userConfigs[m]&&(i.userConfigs[m].uid=h)}),this.transcodingConfig=i,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Rc(u=this.streamingTasks).call(u)).map(m=>m.taskId).join("#")});D.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{D.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{D.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(_=>{D.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)})})}}async startLiveStreamingTask(n,i,o){if(!this.transcodingConfig&&i===Bp.TRANSCODE)throw new Oe(X.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:n,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};D.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(n,", mode: ").concat(i));const u=await this.taskMutex.lock();if(!this.connection&&o)return void u();if(this.streamingTasks.get(n)&&!o)return u(),new Oe(X.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(m){throw u(),m}switch(i){case Bp.TRANSCODE:c.transcodingConfig=Sa({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new lt((y,S)=>{es(this.retryTimeout).then(()=>{if(o)return S(o);const w=this.statusError.get(n);return w?(this.statusError.delete(n),S(w)):void 0})}),_=await lt.race([this.connection.request("request",{clientRequest:c},!0,{url:n,command:"PublishStream",workerType:i===Bp.TRANSCODE?1:2,requestByUser:!o,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,D.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(_.code)),this.streamingTasks.set(n,{clientRequest:c,mode:i,url:n,taskId:h}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||o)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(n,i,m)):await this.startLiveStreamingTask(n,i,m)}}stopLiveStreamingTask(n){return new lt((i,o)=>{const c=this.streamingTasks.get(n);if(!c||!this.connection)return new Oe(X.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{D.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(n),i()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:n,command:"UnPublishStream",workerType:u===Bp.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{D.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(n),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),i()}).catch(o)})}resetAllTask(){var n;const i=Array.from(Rc(n=this.streamingTasks).call(n));this.terminate();for(const o of i)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Wo.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(n){if(this.connection)throw new Oe(X.UNEXPECTED_ERROR,"live streaming connection has already connected");const i=await Es(this,ix.REQUEST_WORKER_MANAGER_LIST,n);return this.uapResponse=i,this.connection=new gge(i.workerToken,this.spec,this.wsRetryConfig,n),this.connection.on(Sm.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on(Sm.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(Sm.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new Oe(X.UNEXPECTED_ERROR,"can not get new live streaming address list"));Es(this,ix.REQUEST_WORKER_MANAGER_LIST,n).then(u=>{this.uapResponse=u,o(u.addressList)}).catch(c)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(n){const i=n.serverStatus&&n.serverStatus.url||"empty_url",o=this.streamingTasks.get(i),c=n.reason;switch(n.code){case bi.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case bi.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Oe(X.LIVE_STREAMING_CDN_ERROR,"",{code:n.code});if(o)return D.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,h);if(!this.isStartingStreamingTask)return;this.statusError.set(i,h)}case bi.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Oe(X.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,h)}case bi.LIVE_STREAM_RESPONSE_WORKER_LOST:case bi.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Rc(u=this.streamingTasks).call(u));for(const m of h)m.abortTask?m.abortTask():(D.warning("[".concat(this.spec.clientId,"] publish stream status code"),n.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Oe(X.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:n.code})).then(()=>{D.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(_=>{D.error(_.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,_)}));return}}}hasUrl(n){return this.streamingTasks.has(n)}}const Ege={name:"LiveStreaming",create:function(e){return new _ge(e.joinInfo,e.websocketRetryConfig||gi,e.httpRetryConfig||gi)}};function yge(e){let n=b7();return function(i,o){let c=i.appId;c!==void 0&&($n(o,10),Sh(o,c));let u=i.cid;u!==void 0&&($n(o,16),$n(o,u));let h=i.cname;h!==void 0&&($n(o,26),Sh(o,h));let m=i.deviceId;m!==void 0&&($n(o,34),Sh(o,m));let _=i.elapse;_!==void 0&&($n(o,40),xm(o,_));let y=i.fileSize;y!==void 0&&($n(o,48),xm(o,Yv(y)));let S=i.height;S!==void 0&&($n(o,56),xm(o,Yv(S)));let w=i.jpg;w!==void 0&&($n(o,66),$n(o,w.length),function(qo,je){let st=Xv(qo,je.length);qo.bytes.set(je,st)}(o,w));let A=i.networkType;A!==void 0&&($n(o,72),xm(o,Yv(A)));let k=i.osType;k!==void 0&&($n(o,80),xm(o,Yv(k)));let W=i.requestId;W!==void 0&&($n(o,90),Sh(o,W));let U=i.sdkVersion;U!==void 0&&($n(o,98),Sh(o,U));let V=i.sequence;V!==void 0&&($n(o,104),xm(o,Yv(V)));let q=i.sid;q!==void 0&&($n(o,114),Sh(o,q));let Y=i.timestamp;Y!==void 0&&($n(o,120),xm(o,Y));let ce=i.uid;ce!==void 0&&($n(o,128),$n(o,ce));let _e=i.vid;_e!==void 0&&($n(o,136),$n(o,_e));let Ee=i.width;Ee!==void 0&&($n(o,144),xm(o,Yv(Ee)));let me=i.service;me!==void 0&&($n(o,152),$n(o,me));let ke=i.callbackData;ke!==void 0&&($n(o,162),Sh(o,ke));let Ye=i.jpgEncryption;Ye!==void 0&&($n(o,168),$n(o,Ye));let ut=i.requestType;ut!==void 0&&($n(o,176),$n(o,ut));let pt=i.scorePorn;pt!==void 0&&($n(o,185),oM(o,pt));let yn=i.scoreSexy;yn!==void 0&&($n(o,193),oM(o,yn));let vn=i.scoreNeutral;vn!==void 0&&($n(o,201),oM(o,vn));let cr=i.scene;cr!==void 0&&($n(o,208),$n(o,cr));let Zr=i.ossFilePrefix;Zr!==void 0&&($n(o,218),Sh(o,Zr));let Wr=i.serviceVendor;if(Wr!==void 0)for(let qo of Wr){$n(o,226);let je=b7();Tge(qo,je),$n(o,je.limit),Cge(o,je),Rge(je)}}(e,n),function(i){let o=i.bytes,c=i.limit;return o.length===c?o:o.subarray(0,c)}(n)}function vge(e){return function(i){let o={};e:for(;!w7(i);){let c=Th(i);switch(c>>>3){case 0:break e;case 1:o.code=Th(i);break;case 2:o.msg=R7(i,Th(i));break;case 3:{let u=bge(i);o.data=Sge(i),i.limit=u;break}default:S7(i,7&c)}}return o}({bytes:n=e,offset:0,limit:n.length});var n}function Sge(e){let n={};e:for(;!w7(e);){let i=Th(e);switch(i>>>3){case 0:break e;case 1:n.requestId=R7(e,Th(e));break;case 2:n.requestType=Th(e)>>>0;break;case 3:n.scorePorn=sM(e);break;case 4:n.scoreSexy=sM(e);break;case 5:n.scoreNeutral=sM(e);break;case 6:n.requestScene=Th(e)>>>0;break;case 7:n.scene=Th(e)>>>0;break;default:S7(e,7&i)}}return n}function Tge(e,n){let i=e.service;i!==void 0&&($n(n,8),$n(n,i));let o=e.vendor;o!==void 0&&($n(n,16),$n(n,o));let c=e.token;c!==void 0&&($n(n,26),Sh(n,c));let u=e.callbackUrl;u!==void 0&&($n(n,34),Sh(n,u))}function bge(e){let n=Th(e),i=e.limit;return e.limit=e.offset+n,i}function S7(e,n){switch(n){case 0:for(;128&C7(e););break;case 2:rM(e,Th(e));break;case 5:rM(e,4);break;case 1:rM(e,8);break;default:throw new Error("Unimplemented type: "+n)}}let wge=new Float32Array(1);new Uint8Array(wge.buffer);let nM=new Float64Array(1),Ta=new Uint8Array(nM.buffer);function Yv(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let T7=[];function b7(){const e=T7.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Rge(e){T7.push(e)}function rM(e,n){if(e.offset+n>e.limit)throw new Error("Skip past limit");e.offset+=n}function w7(e){return e.offset>=e.limit}function Xv(e,n){let i=e.bytes,o=e.offset,c=e.limit,u=o+n;if(u>i.length){let h=new Uint8Array(2*u);h.set(i),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function iM(e,n){let i=e.offset;if(i+n>e.limit)throw new Error("Read past limit");return e.offset+=n,i}function R7(e,n){let i=iM(e,n),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<n;m++){let _,y,S,w,A=c[m+i];(128&A)==0?h+=o(A):(224&A)==192?m+1>=n?h+=u:(_=c[m+i+1],(192&_)!=128?h+=u:(w=(31&A)<<6|63&_,w<128?h+=u:(h+=o(w),m++))):(240&A)==224?m+2>=n?h+=u:(_=c[m+i+1],y=c[m+i+2],(49344&(_|y<<8))!=32896?h+=u:(w=(15&A)<<12|(63&_)<<6|63&y,w<2048||w>=55296&&w<=57343?h+=u:(h+=o(w),m+=2))):(248&A)==240?m+3>=n?h+=u:(_=c[m+i+1],y=c[m+i+2],S=c[m+i+3],(12632256&(_|y<<8|S<<16))!=8421504?h+=u:(w=(7&A)<<18|(63&_)<<12|(63&y)<<6|63&S,w<65536||w>1114111?h+=u:(w-=65536,h+=o(55296+(w>>10),56320+(1023&w)),m+=3))):h+=u}return h}function Sh(e,n){let i=n.length,o=0;for(let h=0;h<i;h++){let m=n.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+n.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}$n(e,o);let c=Xv(e,o),u=e.bytes;for(let h=0;h<i;h++){let m=n.charCodeAt(h);m>=55296&&m<=56319&&h+1<i&&(m=(m<<10)+n.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function Cge(e,n){let i=Xv(e,n.limit),o=e.bytes,c=n.bytes;for(let u=0,h=n.limit;u<h;u++)o[u+i]=c[u]}function C7(e){return e.bytes[iM(e,1)]}function I7(e,n){let i=Xv(e,1);e.bytes[i]=n}function sM(e){let n=iM(e,8),i=e.bytes;return Ta[0]=i[n++],Ta[1]=i[n++],Ta[2]=i[n++],Ta[3]=i[n++],Ta[4]=i[n++],Ta[5]=i[n++],Ta[6]=i[n++],Ta[7]=i[n++],nM[0]}function oM(e,n){let i=Xv(e,8),o=e.bytes;nM[0]=n,o[i++]=Ta[0],o[i++]=Ta[1],o[i++]=Ta[2],o[i++]=Ta[3],o[i++]=Ta[4],o[i++]=Ta[5],o[i++]=Ta[6],o[i++]=Ta[7]}function Th(e){let n,i=0,o=0;do n=C7(e),i<32&&(o|=(127&n)<<i),i+=7;while(128&n);return o}function $n(e,n){for(n>>>=0;n>=128;)I7(e,127&n|128),n>>>=7;I7(e,n)}function xm(e,n){let i=n.low>>>0,o=(n.low>>>28|n.high<<4)>>>0,c=n.high>>>24,u=c===0?o===0?i<16384?i<128?1:2:i<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=Xv(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?i>>>21|128:i>>>21&127;case 3:m[h+2]=u!==3?i>>>14|128:i>>>14&127;case 2:m[h+1]=u!==2?i>>>7|128:i>>>7&127;case 1:m[h]=u!==1?128|i:127&i}}function A7(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}const Ige=new Map([["moderation",1],["supervise",2]]);class Age extends Ar{get connectionState(){return this._connectionState}set connectionState(n){if(this._connectionState===n)return;const i=this._connectionState;this._connectionState=n,this.emit(Ki.CONNECTION_STATE_CHANGE,i,n)}get inspectType(){return this._inspectType}set inspectType(n){var i;this._inspectMode=ja(i=n.map(o=>Ige.get(o)||0)).call(i,(o,c)=>o+c),this._inspectType=n}get quality(){return this._quality}set quality(n){this._quality=n>1?1:n<.1?.1:n,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(n){super(),$(this,"name","AgoraRTCVideoContentInspect"),$(this,"_connectionState",su.CONNECTING),$(this,"_innerConnectionState",void 0),$(this,"sequence",0),$(this,"inspectStartTime",void 0),$(this,"workerManagerConnection",void 0),$(this,"workerConnection",void 0),$(this,"workerMessageLengthLimit",void 0),$(this,"inspectIntervalMinimum",void 0),$(this,"qualityRatio",void 0),$(this,"_connectInfo",void 0),$(this,"_cancelTokenSource",Wo.CancelToken.source()),$(this,"_retryConfig",void 0),$(this,"wmSequence",0),$(this,"inspectInterval",void 0),$(this,"inspectTimer",null),$(this,"ossFilePrefix",void 0),$(this,"extraInfo",void 0),$(this,"_inspectType",void 0),$(this,"_inspectMode",void 0),$(this,"_quality",1),$(this,"qualityTimer",null),$(this,"_inspectId",void 0),$(this,"_needWorkUrlOnly",!1),$(this,"inspectImage",()=>{if(this.connectionState!==su.CONNECTED)throw new Oe(X.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===su.CONNECTED?this.requestToInspectImage():D.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=or(5,"inspect-"),this.workerMessageLengthLimit=re("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=re("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=re("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=n.interval,this.ossFilePrefix=n.ossFilePrefix,this.extraInfo=n.extraInfo,this.inspectType=n.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new db("worker-manager-"+this._inspectId,gi),this.on(Ki.STATE_CHANGE,(i,o)=>{this._innerConnectionState=i,D.debug("[".concat(this._inspectId,"] Inspect operation :").concat(ou[i]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new db("worker-"+this._inspectId,gi),this.handleWorkerEvents()}async init(n,i){this.emit(Ki.STATE_CHANGE,ou.CONNECT_AP),this._connectInfo=n;const o=this._cancelTokenSource.token;return this._retryConfig=i,new lt((c,u)=>{this.on(Ki.CONNECTION_STATE_CHANGE,(h,m)=>{m===su.CONNECTED&&c()}),this.requestAP(n,o,i).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(n,i,o){const c=re("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),u=await function(m,_,y,S){let{appId:w,areaCode:A,cname:k,sid:W,token:U,uid:V}=_;Fv++;const q="image_moderation_api",Y={service_name:q,json_body:JSON.stringify({appId:w,areaCode:A,cname:k,command:"allocateEdge",requestId:Fv,seq:Fv,sid:W,token:U,ts:Date.now(),uid:V+""})};let ce,_e,Ee=m[0];return cd(async()=>{ce=Date.now();const me=await pd(Ee,{data:Y,cancelToken:y,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(_e=Date.now()-ce,me.code!==0){const pt=new Oe(X.UNEXPECTED_RESPONSE,"image inspect ap error, code"+me.code,{retry:!0,responseTime:_e});throw D.error(pt.toString()),pt}const ke=JSON.parse(me.json_body);if(ke.code!==200){const pt=new Oe(X.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(ke.code,", reason: ").concat(ke.reason),{code:ke.code,responseTime:_e});throw D.error(pt.toString()),pt}if(!ke.servers||!Array.isArray(ke.servers)||ke.servers.length===0){const pt=new Oe(X.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:ke.code,responseTime:_e});throw D.error(pt.toString()),pt}const Ye=re("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ut=re("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:ke.servers.map(pt=>{let{address:yn,wss:vn}=pt;if(yn&&vn)return"wss://".concat(yn.replace(/\./g,"-"),".").concat(Ye,":").concat(ut||vn)}).filter(pt=>!!pt),workerToken:ke.workerToken,vid:ke.vid,responseTime:_e}},(me,ke)=>(wt.apworkerEvent(W,{success:!0,sc:200,serviceName:q,responseDetail:JSON.stringify(me.addressList),firstSuccess:ke===0,responseTime:_e,serverIp:m[ke%m.length]}),!1),(me,ke)=>(wt.apworkerEvent(W,{success:!1,sc:me.data&&me.data.code||200,serviceName:q,responseTime:_e,serverIp:m[ke%m.length]}),!!(me.code!==X.OPERATION_ABORTED&&me.code!==X.UNEXPECTED_RESPONSE||me.data&&me.data.retry)&&(Ee=m[(ke+1)%m.length],!0)),S)}(c,n,i,o);this.emit(Ki.STATE_CHANGE,ou.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(n){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(Ki.STATE_CHANGE,ou.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(n,1e4)}async connectWorker(n){await this.workerConnection.init([n])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Kt.CONNECTED,async()=>{this.emit(Ki.STATE_CHANGE,ou.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Kt.CLOSED,()=>{this._innerConnectionState<ou.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Kt.FAILED,()=>{this._innerConnectionState<ou.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Kt.RECONNECTING,()=>{this._innerConnectionState<ou.GET_WORKER_MANAGER_RESPONSE&&D.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Kt.ON_MESSAGE,async n=>{this.emit(Ki.STATE_CHANGE,ou.GET_WORKER_MANAGER_RESPONSE);const i=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(n.data);if(o.code!==200)throw D.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new Oe(X.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&i))throw D.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new Oe(X.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const c=re("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,u=i.replace(/:\d+\/?$/,":".concat(c));this.emit(Ki.STATE_CHANGE,ou.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(Ki.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(Kt.WILL_RECONNECT,(n,i,o)=>{o(n)}),this.workerManagerConnection.on(Kt.REQUEST_NEW_URLS,(n,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(n).catch(i)})}handleWorkerEvents(){this.workerConnection.on(Kt.CONNECTED,async()=>{this.emit(Ki.STATE_CHANGE,ou.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=su.CONNECTED}),this.workerConnection.on(Kt.ON_MESSAGE,async n=>{if(n.data instanceof ArrayBuffer){const o=vge(new Uint8Array(n.data));if(re("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&D.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Ki.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var i;const c={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},u=ja(i=Object.keys(c)).call(i,(m,_)=>c[m]>c[_]?m:_,"porn"),h=Object.keys(c).find(m=>m===u);this.emit(Ki.INSPECT_RESULT,h)}else this.emit(Ki.INSPECT_RESULT,void 0,new Oe(X.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(Ki.INSPECT_RESULT,void 0,new Oe(X.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else D.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Ki.INSPECT_RESULT,void 0,new Oe(X.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Kt.CLOSED,()=>{this.connectionState=su.CLOSED}),this.workerConnection.on(Kt.FAILED,()=>{this.connectionState=su.CLOSED}),this.workerConnection.on(Kt.RECONNECTING,()=>{this.connectionState=this.connectionState===su.CONNECTED?su.RECONNECTING:su.CONNECTING}),this.workerConnection.on(Kt.WILL_RECONNECT,(n,i,o)=>{n==="recover"&&o(n),o("tryNext")}),this.workerConnection.on(Kt.REQUEST_NEW_URLS,(n,i)=>{this.workerManagerConnection.close(),this.once(Ki.REQUEST_NEW_WORKER_URL,o=>{n([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{i(o)})})}async requestToInspectImage(){this.sequence++;const n=Ic(this,Ki.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(n){if(!n.isPlaying)return void this.emit(Ki.INSPECT_RESULT,void 0,new Oe(X.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(n,i);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(Ki.INSPECT_RESULT,void 0,new Oe(X.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(n,i){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_}=i;const y=Date.now(),S=await n.getCurrentFrameImage("image/jpeg",this.quality),w=await l8(S,o,c),A=this.sequence+"-"+u+"-"+_+"-"+y+"-"+or(12,""),k={appId:o,cid:u,cname:c,deviceId:"",elapse:(W=Number(y-this.inspectStartTime),{low:W|=0,high:W>>31,unsigned:W>=0}),fileSize:w.byteLength,jpgEncryption:2,height:S.height,width:S.width,jpg:w,networkType:6,osType:7,requestId:A,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:M9(y),uid:_,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var W;this.extraInfo===void 0&&delete k.callbackData,this.ossFilePrefix===void 0&&delete k.ossFilePrefix;const U=yge(k);if(U.byteLength<this.workerMessageLengthLimit){if(re("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const V=function(q){for(var Y=1;Y<arguments.length;Y++){var ce=arguments[Y]!=null?arguments[Y]:{};Y%2?A7(Object(ce),!0).forEach(function(_e){$(q,_e,ce[_e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(q,Object.getOwnPropertyDescriptors(ce)):A7(Object(ce)).forEach(function(_e){Object.defineProperty(q,_e,Object.getOwnPropertyDescriptor(ce,_e))})}return q}({},k);delete V.jpg,D.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(V))}return U}{const V=this.quality*this.qualityRatio;return this.quality=V,await this.generateRequestData(n,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:_})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Wo.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=su.CLOSED,this.emit(Ki.STATE_CHANGE,ou.CLOSED)}}const Pge={name:"ContentInspect",create:function(e){let{config:n}=e;return function(i){if(!i)throw new Oe(X.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new Oe(X.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(i.inspectType)];o.forEach(c=>{var u;if(!ot(u=["supervise","moderation"]).call(u,c))throw new Oe(X.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),i.inspectType=o}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new Oe(X.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(n),new Age(n)}};var P7=l(yt.Object.getOwnPropertySymbols),Oge=xn,kge=Mo.indexOf,Nge=up,aM=oe([].indexOf),O7=!!aM&&1/aM([1],1,-0)<0;Oge({target:"Array",proto:!0,forced:O7||!Nge("indexOf")},{indexOf:function(e){var n=arguments.length>1?arguments[1]:void 0;return O7?aM(this,e,n)||0:kge(this,e,n)}});var Dge=Fa("Array").indexOf,Lge=N,xge=Dge,cM=Array.prototype,Mge=function(e){var n=e.indexOf;return e===cM||Lge(cM,e)&&n===cM.indexOf?xge:n},k7=l(Mge);function Uge(e,n){if(e==null)return{};var i,o,c=function(h,m){if(h==null)return{};var _,y,S={},w=Jz(h);for(y=0;y<w.length;y++)_=w[y],k7(m).call(m,_)>=0||(S[_]=h[_]);return S}(e,n);if(P7){var u=P7(e);for(o=0;o<u.length;o++)i=u[o],k7(n).call(n,i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(c[i]=e[i])}return c}let N7=class{get localCapabilities(){return xr(this._localCapabilities)}get rtpCapabilities(){return xr(this._rtpCapabilities)}get candidates(){return xr(this._candidates)}get iceParameters(){return xr(this._iceParameters)}get dtlsParameters(){return xr(this._dtlsParameters)}constructor(e){$(this,"sessionDesc",void 0),$(this,"_localCapabilities",void 0),$(this,"_rtpCapabilities",void 0),$(this,"_candidates",void 0),$(this,"_iceParameters",void 0),$(this,"_dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname","o/i14u9pJrxRKAsu"),$(this,"firefoxSsrcMidMap",new Map),e=xr(e);const{remoteIceParameters:n,remoteDtlsParameters:i,candidates:o,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:m,videoCodec:_,audioCodec:y}=e;let S;this.setup=m,S=h===Eo.RECEIVE_ONLY?ya(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):ya(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=o,this._iceParameters=n,this._dtlsParameters=i,this._localCapabilities=u;const w=h===Eo.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,A=h===Eo.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,k=h===Eo.RECEIVE_ONLY?c.send.videoCodecs:fb(mt.VIDEO,w,A,_),W=h===Eo.RECEIVE_ONLY?c.send.audioCodecs:fb(mt.AUDIO,w,A,y);for(const U of S.mediaDescriptions)U.attributes.iceUfrag=n.iceUfrag,U.attributes.icePwd=n.icePwd,U.attributes.fingerprints=i.fingerprints,U.attributes.candidates=o,U.attributes.setup=this.setup,U.media.mediaType==="application"&&(U.attributes.sctpPort="5000"),U.media.mediaType==="video"&&(U.media.fmts=k.map(V=>V.payloadType.toString(10)),U.attributes.payloads=k,U.attributes.extmaps=w.videoExtensions),U.media.mediaType==="audio"&&(U.media.fmts=W.map(V=>V.payloadType.toString(10)),U.attributes.payloads=W,U.attributes.extmaps=w.audioExtensions,Vv(U));this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return vm(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(n=>this.hasMid(n)):this.sessionDesc.mediaDescriptions.some(n=>n.attributes.mid===e)}send(e,n,i,o,c){i=i.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=O_(n,this.cname,re("SYNC_GROUP")?i:void 0),m=this.findPreloadMediaDesc(u);if(m){if(Nr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const _=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const _=this.findAvailableMediaIndex(e,u,o);let y;return _===-1?(y=this.createOrRecycleSendMedia(e,u,h,"sendonly",o,c),this.updateBundleMids()):(y=xr(this.sessionDesc.mediaDescriptions[_]),y.attributes.direction="sendonly",y.attributes.ssrcs=u,y.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[_]=this.mungSendMediaDesc(y,c)),Nr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,y.attributes.mid),{needExchangeSDP:!0,mid:y.attributes.mid}}}stopSending(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,n,i){const o=[];return e.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let m,_=!1;h===-1?(_=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",n,i),this.updateBundleMids()):(m=xr(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),o.push({mid:m.attributes.mid,needCreateTransceiver:_})}),o}stopReceiving(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(n.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:n,protocol:i,address:o,port:c,type:u,relatedAddress:h,relatedPort:m,priority:_}=new RTCIceCandidate(e),y={foundation:n??"",componentId:"1",transport:i??"",priority:_?_+"":"",connectionAddress:o??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(S=>S.priority===y.priority&&S.connectionAddress===y.connectionAddress&&S.port===y.port)||(this._candidates.push(y),this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,n,i,o,c){const u=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=fb(u,h,this.localCapabilities.send,u===mt.AUDIO?c:o),_=u===mt.VIDEO?h.videoExtensions:h.audioExtensions,y="".concat(++this.currentMidIndex);let S={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(A=>A.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(y)}};S=this.mungRecvMediaDsec(S,e);const w=this.findFirstClosedMedia(u);if(w){const A=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[A]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}muteRemote(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>ot(e).call(e,i.attributes.mid||""));if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){const n=this.sessionDesc.mediaDescriptions.filter(i=>ot(e).call(e,i.attributes.mid||""));if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(e,n,i){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const c=o.media.mediaType===e&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(Nr()){if(c){const u=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(u||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!u||u!==o.attributes.mid)}return!1}return c&&o.attributes.mid===i})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(n=>{const i=n.media.mediaType===e&&n.media.port!=="0"&&(n.attributes.direction==="recvonly"||n.attributes.direction==="sendrecv");return n.attributes.mid!=="0"&&n.attributes.mid!=="1"&&i})}predictReceivingMids(e){const n=[];for(let i=0;i<e;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}restartICE(e){e=xr(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,n,i,o,c,u){const h=this.rtpCapabilities.send,m=e===mt.VIDEO?h.videoCodecs:h.audioCodecs,_=e===mt.VIDEO?h.videoExtensions:h.audioExtensions;Nr()&&(c="".concat(++this.currentMidIndex));let y={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(w=>w.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:_,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:c}};y=this.mungSendMediaDesc(y,u);const S=this.findFirstClosedMedia(e);if(S){const w=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[w]=y}else this.sessionDesc.mediaDescriptions.push(y);return y}mungRecvMediaDsec(e,n,i){const o=xr(e);return lx(o),Uv(o,n),ux(o,n),TG(o),JA(o,i,this.localCapabilities.send),o}mungSendMediaDesc(e,n){const i=xr(e);return JA(i,n,this.localCapabilities.recv),Vv(i),i}updateRecvMedia(e,n){const i=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(i!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(n=>{var i;return((i=n.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(n=>Nr()?n.media.port==="0"&&n.media.mediaType===e:n.media.port==="0")}};const Vge=["sdp"];var hr;function D7(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function Mm(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?D7(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):D7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let L7=(hr=class lS extends rG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var n,i;return(n=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&n!==void 0?n:null}get localCodecs(){return[]}set isInRestartIce(n){this._isInRestartIce=n}get isInRestartIce(){return this._isInRestartIce}constructor(n,i,o){super(n,i),$(this,"direction",void 0),$(this,"name",void 0),$(this,"store",void 0),$(this,"spec",void 0),$(this,"peerConnection",void 0),$(this,"initialOffer",void 0),$(this,"transport",void 0),$(this,"statsFilter",void 0),$(this,"localCandidateCount",0),$(this,"_isInRestartIce",!1),$(this,"mutex",void 0),$(this,"onLocalCandidate",void 0),$(this,"remoteSDP",void 0),$(this,"pendingCandidates",[]),$(this,"localCapabilities",void 0),$(this,"isReady",!1),$(this,"restartCnt",0),$(this,"curTurnServerIndex",0),this.store=i,this.spec=n,this.mutex=new Cs("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(lS.resolvePCConfiguration(n,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??Eo.SEND_ONLY,this.name=this.direction===Eo.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=bL(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Nr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(n){try{const i=await wG();if(this.localCapabilities=QA(i),n){const{sdp:o}=n,c=Uge(n,Vge),u=function(){const S={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},w=pb(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},k={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},W={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(au(w,S,"videoExtensions",A,k,W),au(w,S,"videoCodecs",A,k,W),au(w,S,"audioExtensions",A,k,W),au(w,S,"audioCodecs",A,k,W),re("RAISE_H264_BASELINE_PRIORITY")){const U=W.videoCodecs.findIndex(V=>V.rtpMap&&V.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&V.fmtp&&V.fmtp.parameters["profile-level-id"]==="42001f");if(U!==-1){const V=W.videoCodecs.findIndex(q=>q.rtpMap&&q.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(V<U){D.debug("raising H264 baseline profile priority");const q=W.videoCodecs[U];W.videoCodecs.splice(U,1),W.videoCodecs.splice(V,0,q)}V!==-1&&re("FILTER_SEND_H264_BASELINE")&&(A.videoCodecs=A.videoCodecs.filter(q=>!(q.rtpMap&&q.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&q.fmtp&&q.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:A,recv:k,sendrecv:W}}({},{},o);this.remoteSDP=new N7({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Rm(h.sdp);await this.peerConnection.setLocalDescription(h);const _=await RG({},{},h.sdp);this.localCapabilities=QA(_);const y=this.peerConnection.getTransceivers()[0];return y!=null&&y.receiver&&y.receiver.transport&&this.tryBindTransportEvents(y.receiver.transport),Mm(Mm({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Rm(o.sdp);return this.initialOffer=o,Mm(Mm({},c),{},{sdp:o.sdp})}}catch(i){throw new Le(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(n){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:i,iceParameters:o,dtlsParameters:c}=n,u=await RG({},{},i);this.remoteSDP=new N7({remoteIceParameters:o,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(n){try{n&&this.pendingCandidates.push(n),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new Le(X.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(n,i,o){var c=this;return hl(function*(){const u=yield wn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(n,i,o);n.forEach((V,q)=>{if(m[q].needCreateTransceiver){const Y=c.peerConnection.addTransceiver(V._mediaStreamTrack,{direction:"sendonly"});h.push(Y),V._updateRtpTransceiver(Y)}else{const Y=c.peerConnection.getTransceivers().find(ce=>ce.mid===m[q].mid);if(!Y)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[q].mid));h.push(Y),V._updateRtpTransceiver(Y)}}),Nr()&&re("SIMULCAST")===!0&&(yield wn(c.applySimulcastForFirefox(h,n)));const _=m.map(V=>V.mid),y=yield wn(c.peerConnection.createOffer()),S=c.mungSendOfferSDP(y.sdp,n,_),w=ya(S),A=_.map(V=>{const q=w.mediaDescriptions.find(Y=>Y.attributes.mid===V);if(!q)throw new Error("Cannot extract ssrc from mediaDescription.");return yG(q,re("USE_PUB_RTX"))}),k=h.map((V,q)=>{const Y=_[q];return{localSSRC:A[q],id:Y}});yield wn(c.peerConnection.setLocalDescription({type:"offer",sdp:S}));try{yield k}catch(V){const q=c.remoteSDP.toString();throw yield wn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield wn(c.peerConnection.setRemoteDescription({type:"answer",sdp:q})),yield wn(c.stopSending(_,!0)),V}yield wn(c.applySimulcastEncodings(h,n)),yield wn(c.applySendEncodings(h,n));const W=c.remoteSDP.toString(),U=c.logSDPExchange(S,"offer","local","send");return U==null||U(W),yield wn(c.setRemoteDescription({type:"answer",sdp:W})),h.map((V,q)=>{const Y=_[q];return{localSSRC:A[q],id:Y}})}catch(h){throw h instanceof Le?h:new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(n,i){const o=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(_=>n.indexOf(_.mid)!==-1);if(c.length!==n.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(n.length,") when trying to call P2PConnection.stopSending."));c.map(_=>{var y;_.direction="inactive",(y=_.stop)===null||y===void 0||y.call(_)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(n);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(n,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(n,i,o,c);if(h){const _=this.remoteSDP.toString(),y=this.logSDPExchange(_,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:_});const S=await this.peerConnection.createAnswer(),w=this.mungReceiveAnswerSDP(S.sdp,u,n);y==null||y(w||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:w}),D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP."))}else D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(_=>_.mid===u);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(n,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(n,i,o,c);if(h){const m=this.remoteSDP.toString(),_=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const y=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(y.sdp,u,n);_==null||_(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," by exchanging SDP."))}else D.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(n," no need to exchange SDP."))}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(n);const i=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(n){try{if(this.store.p2pTransport===T_.Auto&&(this.store.p2pTransport=T_.SdRtn,kn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(lS.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,kn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(lS.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!n){this.restartCnt++,this.isReady=!1;const i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=Rm(i.sdp);return this.store.descriptionStart(),this.direction===Eo.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(n),this.store.descriptionStart(),this.direction===Eo.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=Rm(i.sdp);return await this.peerConnection.setLocalDescription(i),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var n;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}async updateEncoderConfig(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i],[n]);this.remoteSDP.updateRecvMedia(n,i);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(n,i){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===n);o.length===1&&(this.isVP8Simulcast(i)?Nr()||await this.applySimulcastEncodings(o,[i]):await this.applySendEncodings(o,[i]))}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}async replaceTrack(n,i){const o=this.peerConnection.getTransceivers().find(c=>c.mid===i);o&&await o.sender.replaceTrack(n._mediaStreamTrack)}async getSelectedCandidatePair(){const n=this.peerConnection.getReceivers();if(n.length>0&&n[0].transport&&n[0].transport.iceTransport&&n[0].transport.iceTransport.getSelectedCandidatePair&&n[0].transport.iceTransport.getSelectedCandidatePair()){const i=n[0].transport.iceTransport,{local:o,remote:c}=i.getSelectedCandidatePair();return{local:Mm(Mm({},ch),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Mm(Mm({},ch),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n,i;ot(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=n=>{if(n.candidate){var i;n.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,n.candidate.toJSON())),this.localCandidateCount+=1}else D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return n.iceServers?c.iceServers=n.iceServers:n.turnServer&&n.turnServer.mode!=="off"&&(eb(n.turnServer.servers)?c.iceServers=n.turnServer.servers:(c.iceServers&&c.iceServers.push(...lS.turnServerConfigToIceServers(n.turnServer.servers,i,o)),re("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&n.turnServer.serversFromGateway&&c.iceServers.push(...lS.turnServerConfigToIceServers(n.turnServer.serversFromGateway,i,o)),ot(u=[T_.Relay,T_.SdRtn]).call(u,i)&&(c.iceTransportPolicy="relay"),re("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),re("ENABLE_ENCODED_TRANSFORM")&&kn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),D.debug("P2PConnection p2pTransport is ".concat(i)),c}static turnServerConfigToIceServers(n,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=n.filter(m=>m.tcpport);D.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(o));const h=u.length>o?u[o]:u[0];switch(i){case T_.SdRtn:const m=n.filter(y=>{var S;return ot(S=y.username).call(S,"glb:")&&y.turnServerURL==y.turnServerURL}),_=m.length>o?m[o]:m[0];_&&(c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turn:".concat(bm(_.turnServerURL),":").concat(_.tcpport,"?transport=udp")}),c.push({username:_.username,credential:_.password,credentialType:"password",urls:"turns:".concat(bm(_.turnServerURL),":").concat(_.tcpport,"?transport=tcp")}));break;case T_.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(bm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(bm(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(n){if(n){this.transport=n,n.onstatechange=()=>{var o;n!=null&&n.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,n.state))},n.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const o=n==null?void 0:n.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:o,remote:c}=i.getSelectedCandidatePair();D.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(n,i){var o;if(i||(i=this.peerConnection.getSenders().find(S=>S.track===n._mediaStreamTrack)),!i)return D.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(n))return D.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!kn().supportSetRtpSenderParameters)return D.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(n._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(n._encoderConfig){var h;const{bitrateMax:S,frameRate:w,scaleResolutionDownBy:A}=n._encoderConfig;S&&(u.maxBitrate=1e3*S),ot(h=n._hints).call(h,ar.LOW_STREAM)&&(w&&(u.maxFramerate=qa(w)),A&&A>=1&&(u.scaleResolutionDownBy=A))}if(re("DSCP_TYPE")&&Mp()){var m;const S=re("DSCP_TYPE");ot(m=["very-low","low","medium","high"]).call(m,S)&&(u.networkPriority=S)}const _=i.getParameters(),y=(o=_.encodings)===null||o===void 0?void 0:o[0];Nr()&&!y&&(c.encodings=[u]),y&&Object.assign(y,u),Object.assign(_,c),D.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_.encodings))),await i.setParameters(_)}async applySendEncodings(n,i){try{if(!kn().supportSetRtpSenderParameters||n.length!==i.length)return;for(let o=0;o<n.length;o++){const c=n[o],u=i[o];u instanceof mr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{D.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(n,i,o){const c=ya(n);return i.forEach((u,h)=>{const m=o[h],_=c.mediaDescriptions.find(y=>y.attributes.mid===m);_&&(Uv(_,u),bG(_,u,this.store.codec))}),vm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,n,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onFirstVideoDecodedTimeout=n=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(n,i){if(n.length===i.length)for(let _=0;_<n.length;_++){var o,c,u,h,m;const y=n[_],S=i[_];if(S instanceof mr&&!ot(o=S._hints).call(o,ar.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const w={},A={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};w.encodings=[{rid:"m",active:!0,maxBitrate:A.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:A.high}];const k=y.sender.getParameters();await y.sender.setParameters(Object.assign(k,w))}}}async applySimulcastEncodings(n,i){if(!Nr()&&n.length===i.length)for(let o=0;o<n.length;o++){const c=i[o];if(c instanceof mr&&this.isVP8Simulcast(c)){const u=n[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const _=u.sender.getParameters();await u.sender.setParameters(Object.assign(_,h))}}}isVP8Simulcast(n){var i,o,c,u,h;return!!(n instanceof mr&&re("SIMULCAST")&&this.store.codec==="vp8"&&!ot(i=n._hints).call(i,ar.LOW_STREAM)&&(o=n._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=n._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=n._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=n._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(n,i,o,c){if(re("SDP_LOGGING"))return D.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(i," SDP during P2PConnection.").concat(c,`
`),n),i==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async muteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(n);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(h=>h.mid&&n.indexOf(h.mid)!==-1);if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async h=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(n);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(n,i){var o,c;if(i=(o=i)!==null&&o!==void 0?o:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var u;const h=(u=ya(i).mediaDescriptions.find(m=>m.attributes.mid===n))===null||u===void 0?void 0:u.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(n){var i;await this.peerConnection.setRemoteDescription(n),ot(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(n,i,o){const c=ya(n),u=c.mediaDescriptions.find(h=>h.attributes.mid===i);return u&&o===mt.AUDIO&&u.media.mediaType==="audio"&&Vv(u),vm(c)}},Et(hr.prototype,"establish",[hu],Object.getOwnPropertyDescriptor(hr.prototype,"establish"),hr.prototype),Et(hr.prototype,"connect",[hu],Object.getOwnPropertyDescriptor(hr.prototype,"connect"),hr.prototype),Et(hr.prototype,"receive",[hu],Object.getOwnPropertyDescriptor(hr.prototype,"receive"),hr.prototype),Et(hr.prototype,"mockReceive",[hu],Object.getOwnPropertyDescriptor(hr.prototype,"mockReceive"),hr.prototype),Et(hr.prototype,"stopReceiving",[hu],Object.getOwnPropertyDescriptor(hr.prototype,"stopReceiving"),hr.prototype),Et(hr.prototype,"restartICE",[hu],Object.getOwnPropertyDescriptor(hr.prototype,"restartICE"),hr.prototype),Et(hr.prototype,"close",[hu],Object.getOwnPropertyDescriptor(hr.prototype,"close"),hr.prototype),Et(hr.prototype,"updateEncoderConfig",[hu],Object.getOwnPropertyDescriptor(hr.prototype,"updateEncoderConfig"),hr.prototype),Et(hr.prototype,"updateSendParameters",[hu],Object.getOwnPropertyDescriptor(hr.prototype,"updateSendParameters"),hr.prototype),Et(hr.prototype,"replaceTrack",[hu],Object.getOwnPropertyDescriptor(hr.prototype,"replaceTrack"),hr.prototype),Et(hr.prototype,"muteLocal",[hu],Object.getOwnPropertyDescriptor(hr.prototype,"muteLocal"),hr.prototype),Et(hr.prototype,"unmuteLocal",[hu],Object.getOwnPropertyDescriptor(hr.prototype,"unmuteLocal"),hr.prototype),hr);function hu(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(n));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}let md=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var x7,M7,U7,V7,F7,j7,B7,W7,z7,G7,H7,Rr;function $7(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function LP(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?$7(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):$7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let Fge=(x7=gd(md.SEND_ONLY),M7=gd(md.SEND_ONLY),U7=gd(),V7=gd(md.RECEIVE_ONLY),F7=gd(md.RECEIVE_ONLY),j7=gd(md.RECEIVE_ONLY),B7=gd(md.RECEIVE_ONLY),W7=gd(md.RECEIVE_ONLY),z7=gd(md.RECEIVE_ONLY),G7=gd(),H7=gd(md.RECEIVE_ONLY),Rr=class extends Ar{get state(){return this._state}set state(e){const n=this._state;this._state=e,this.emit(Ot.StateChange,n,this._state)}constructor(e,n){super(),$(this,"isPlanB",!1),$(this,"store",void 0),$(this,"statsUploader",void 0),$(this,"sendConnection",void 0),$(this,"recvConnection",void 0),$(this,"localTrackMap",new Map),$(this,"remoteUserMap",new Map),$(this,"localDataChannels",[]),$(this,"pendingLocalTracks",[]),$(this,"pendingRemoteTracks",[]),$(this,"statsCollector",void 0),$(this,"dtlsFailedCount",0),$(this,"sendMutex",void 0),$(this,"recvMutex",void 0),$(this,"_state",Bn.Disconnected),$(this,"_restartStates",["disconnected","failed"]),$(this,"reconnectInterval",void 0),$(this,"uploadUnplinkStarted",!1),$(this,"uploadDownlinkStarted",!1),$(this,"uplinkStateUploadInterval",void 0),$(this,"downlinkStatsUploadInterval",void 0),$(this,"handleMuteLocalTrack",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Bn.Connected)return void c(new Le(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const _=this.filterTobeMutedTracks(i);if(_.length===0)return void o();const y=_.find(k=>k[0]==="videoLowTrack");y&&y[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(_.map(k=>{let[,{id:W}]=k;return W}));let S=!1;var h,m;i.trackMediaType==="video"?S=!((h=this.localTrackMap.get($e.LocalAudioTrack))===null||h===void 0||!h.track._muted):S=((m=this.localTrackMap.get($e.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const w=this.createMuteMessage(_);await sr(this,Ot.RequestMuteLocal,w);const A=i.trackMediaType==="video"?Tm.MUTE_LOCAL_VIDEO:Tm.MUTE_LOCAL_AUDIO;await sr(this,Ot.RequestP2PMuteLocal,{action:A,message:w,isMuteAll:S}),o()}catch(_){c(_)}finally{u()}}),$(this,"handleUnmuteLocalTrack",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Bn.Connected)return void c(new Le(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(i);if(h.length===0)return void o();await this.sendConnection.unmuteLocal(h.map(y=>{let[,{id:S}]=y;return S}));const m=this.createUnmuteMessage(h),_=i.trackMediaType==="video"?Tm.UNMUTE_LOCAL_VIDEO:Tm.UNMUTE_LOCAL_AUDIO;await sr(this,Ot.RequestP2PMuteLocal,{action:_,message:m}),o()}catch(h){c(h)}finally{u()}}),$(this,"handleUpdateVideoEncoder",async(i,o,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const _=this.localTrackMap.get($e.LocalVideoTrack);if(!this.sendConnection||!_||_.track!==i||this.state!==Bn.Connected)return void o();const{id:y,track:S}=_;y&&(await this.sendConnection.updateSendParameters(y,S),await this.sendConnection.updateEncoderConfig(y,S),this.emit(Ot.UpdateVideoEncoder,S)),o()}catch(_){c(_)}finally{var m;(m=h)===null||m===void 0||m()}}),$(this,"handleUpdateVideoSendParameters",async(i,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get($e.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==i||this.state!==Bn.Connected)return void o();const{id:m,track:_}=h;m&&await this.sendConnection.updateSendParameters(m,_),o()}catch(h){c(h)}finally{u()}}),$(this,"handleReplaceTrack",async(i,o,c,u)=>{let h;D.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const y=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:w}]=S;return i===w});if(!this.sendConnection||!y||y[1].id===void 0||this.state!==Bn.Connected)return void o();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(i,y[1].id)),y[0]===$e.LocalVideoTrack&&kn().supportDualStreamEncoding){const S=this.localTrackMap.get($e.LocalVideoLowTrack);if(S){const w=i._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=w,S.track._originMediaStreamTrack=w,await new lt((A,k)=>{this.handleReplaceTrack(S.track,A,k,!0)})}}o()}catch(y){c(y)}finally{var _;(_=h)===null||_===void 0||_()}}),$(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),$(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),$(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),$(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=n,this.statsCollector.addP2PChannel(this),this.statsUploader=new u9(e),this.bindStatsUploaderEvents(),this.sendMutex=new Cs("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new Cs("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},re("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,n){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,n){let i;try{if(n){this.recvConnection&&(D.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new L7(e,this.store,Eo.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(n);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=Bn.New,this.sendConnection&&(D.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new L7(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Bn.Connected}async addRemoteCandidate(e,n){if(n===Eo.RECEIVE_ONLY){if(!this.sendConnection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Le(X.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,n,i){var o=this;return hl(function*(){const c=yield wn(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==Bn.Connected){o.throwIfTrackTypeNotMatch(e);const y=e.filter(S=>o.pendingLocalTracks.indexOf(S)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(y))}o.store.pubId=o.store.pubId+1,Ps.markPublishStart(o.store.clientId,o.store.pubId);const u=o.filterTobePublishedTracks(e,n,i);if(u.length===0)return void(yield wn(o.tryToUnmuteAudio(e)));u.forEach(y=>{let{track:S,type:w}=y;const A=Date.now();o.store.publish(S.getTrackId(),w===$e.LocalAudioTrack?"audio":"video",A)}),o.bindLocalTrackEvents(u);const h=yield wn(o.sendConnection.send(u.map(y=>{let{track:S}=y;return S}),o.store.codec,o.store.audioCodec)),m=(yield wn(h.next())).value,_=o.createGatewayPublishMessage(u,m);try{yield _}catch(y){throw h.throw(y),(y==null?void 0:y.code)===X.WS_ABORT&&u.forEach(S=>{let{track:w}=S;o.pendingLocalTracks.indexOf(w)===-1&&o.pendingLocalTracks.push(w)}),o.unbindLocalTrackEvents(u),y}yield wn(h.next()),u.forEach(y=>{let{type:S}=y;o.statsCollector.addLocalStats(S)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(u,m),u.forEach(y=>{let{track:S,type:w}=y;const A=Date.now();o.store.publish(S.getTrackId(),w===$e.LocalAudioTrack?"audio":"video",void 0,A)}),o.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Bn.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!ot(e).call(e,c)));const n=this.filterTobeUnpublishedTracks(e);if(n.length===0)return;const i=n.find(c=>c[0]==="videoLowTrack");i&&i[1].track.close();const o=this.createGatewayUnpublishMessage(n);if(await this.sendConnection.stopSending(n.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(n),this.unbindLocalTrackEvents(n.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),n.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Bn.Connected)return i&&i[1].track.close(),o;e.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const n=[],i=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[c,{track:u,ssrcs:h}]=o;const m={stream_type:Ofe(u,c),ssrcs:h};u._muted||!u._enabled?n.push(m):i.push(m)}),n.length>0&&n.forEach(o=>{sr(this,Ot.RequestMuteLocal,[o])}),i.length>0&&i.forEach(o=>{sr(this,Ot.RequestUnmuteLocal,[o])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return hl(function*(){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(D.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Es(this,Ot.RequestRePublish,this.pendingLocalTracks),this.emit(Ot.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,n,i,o){var c;if(!this.recvConnection)throw new Le(X.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(n))return;const{track:u,mid:h,transceiver:m}=await this.recvConnection.receive(n,[{ssrcId:i}],String(e.uid),o);n===mt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new Pv(u,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new Av(u,e.uid,e._uintid,this.store),D.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack));const _=this.remoteUserMap.get(e);_?_.set(n,h):this.remoteUserMap.set(e,new Map([[n,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const y=this.pendingRemoteTracks.findIndex(S=>{let{user:w,kind:A}=S;return w.uid===e.uid&&n===A});y!==-1&&(this.pendingRemoteTracks.splice(y,1),this.emit(Ot.MediaReconnectEnd,e.uid))}async mockSubscribe(e,n,i,o){if(!this.recvConnection)throw new Le(X.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(n,[{ssrcId:i}],String(e.uid),o)}async unsubscribe(e,n,i){const o=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return n!==void 0?h.uid===e.uid&&n===m:h.uid===e.uid});if(o.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||i||o.forEach(u=>{let{kind:h}=u;var m;if(h===mt.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(h===mt.VIDEO){var _;(_=e._videoTrack)===null||_===void 0||_._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(e,n);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:m}]=u;var _,y;if(m===mt.VIDEO&&h._videoSSRC&&((_=this.recvConnection)===null||_===void 0||_.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===mt.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),i||((y=h._videoTrack)===null||y===void 0||y._destroy(),h._videoTrack=void 0);else if(m===mt.AUDIO){var S;this.unbindRemoteTrackEvents(h._audioTrack),!i&&((S=h._audioTrack)===null||S===void 0||S._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;sr(this,Ot.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(n=>{let[,i]=n;[mt.VIDEO,mt.AUDIO].forEach(o=>{i.has(o)?sr(this,Ot.RequestP2PUnmuteRemote,o):sr(this,Ot.RequestP2PMuteRemote,o)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Le(X.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,n){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void D.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(n))return void D.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."));const o=n===mt.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,n){return this.unmuteRemoteNoLock(e,n)}async unmuteRemoteNoLock(e,n){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void D.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(n)||D.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(n,"."))}getAllTracks(e){const n=this.localTrackMap.get($e.LocalAudioTrack);if((n==null?void 0:n.track)instanceof Ti){const i=n.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==$e.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===$e.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[o]=i;return!(e&&o===$e.LocalVideoLowTrack)}).map(i=>{let[,{track:o}]=i;return o})}reportPublishEvent(e,n,i,o,c){if(e){const h=this.localTrackMap.get($e.LocalAudioTrack),m=o?this.localTrackMap.get($e.LocalVideoLowTrack):this.localTrackMap.get($e.LocalVideoTrack);wt.publish(this.store.sessionId,{eventElapse:Ps.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;i||(i=[]);const h=i.find(_=>_ instanceof Br),m=o?(u=this.localTrackMap.get($e.LocalVideoTrack))===null||u===void 0?void 0:u.track:i.find(_=>_ instanceof mr);wt.publish(this.store.sessionId,{eventElapse:Ps.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:n,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(ar.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,n,i,o){const c=o===mt.VIDEO?i._videoSSRC:i._audioSSRC;c&&wt.subscribe(this.store.sessionId,{succ:e,ec:n,video:o===mt.VIDEO,audio:o===mt.AUDIO,peerid:i.uid,subscribeRequestid:o===mt.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:Ps.measureFromSubscribeStart(this.store.clientId,c)})}reset(){D.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Cs("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new Cs("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get($e.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Ti){if(e.track.trackList.length>0){const n=e.track;e.track.trackList.forEach(i=>{n.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Bn.Disconnected}getStats(e){var n,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(n=this.sendConnection)===null||n===void 0?void 0:n.getStats()}getRemoteVideoIsReady(e){var n;return((n=this.recvConnection)===null||n===void 0?void 0:n.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get($e.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get($e.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const n=this.localTrackMap.get(e);return n&&n.track instanceof mr||n&&n.track instanceof Br?n.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}async hasRemoteMediaWithLock(e,n){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!n||i.has(n))}getRemoteMedia(e){var n;const i=Array.from(Pc(n=this.remoteUserMap).call(n)).find(o=>o.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[o]=i;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const n=this.localTrackMap.get($e.LocalAudioTrack);return n&&e.push({level:100*n.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=VT(e).call(e,(i,o)=>i.level-o.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(D.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Bn.Reconnecting,re("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n]=e;var i;n._videoTrack&&n._videoTrack._player&&((i=n._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),n._videoTrack._player.isKeepLastFrame=!0,n._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var n;let[i,{track:o}]=e;switch(i){case $e.LocalVideoTrack:ot(n=o._hints).call(n,ar.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case $e.LocalAudioTrack:o instanceof Ti?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case $e.LocalVideoLowTrack:}}),this.emit(Ot.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;Array.from(Pc(i).call(i)).forEach(o=>{this.setPendingRemoteMedia(n,o)}),this.emit(Ot.MediaReconnectStart,n.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),D.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,n){for(const i of this.pendingRemoteTracks){const{user:o,kind:c}=i;if((e instanceof Im?e.uid:e)===o.uid&&n===c)return!0}return!1}setPendingRemoteMedia(e,n){this.hasPendingRemoteMedia(e,n)||this.pendingRemoteTracks.push({user:e,kind:n})}async restartICE(e,n){let i,o;if(e===Eo.SEND_ONLY){if(!this.sendConnection)throw new Le(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new Le(X.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(n){const c=await o.restartICE(n);return o.isInRestartIce=!1,c}{const c=await o.restartICE();if(c){const u=await Es(this,Ot.RequestP2PRestartICE,{direction:Eo.RECEIVE_ONLY,iceParameter:c});await o.restartICE(u),o.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),n=this.localTrackMap.get($e.LocalVideoTrack),i=this.localTrackMap.get($e.LocalAudioTrack),o=e.videoSend.find(k=>{var W;return k.ssrc===(n==null||(W=n.ssrcs)===null||W===void 0?void 0:W[0].ssrcId)}),c=e.audioSend.find(k=>{var W;return k.ssrc===(i==null||(W=i.ssrcs)===null||W===void 0?void 0:W[0].ssrcId)});if(!o||!c)return 1;const u=Ic(this,Ot.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,_=h&&m?(h+m)/2:h||m,y=(_&&u?(_+u)/2:_||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*y/1500,w=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,A=n==null?void 0:n.track;if(A&&A._encoderConfig&&A._hints.indexOf(ar.SCREEN_TRACK)===-1){const k=A._encoderConfig.bitrateMax,W=e.bitrate.actualEncoded;if(k&&W){const U=(1e3*k-W)/(1e3*k);return qz[U<.15?0:U<.3?1:U<.45?2:U<.6?3:4][w]}}return w}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let n=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(W=>W.ssrc===c),m=e.videoRecv.find(W=>W.ssrc===u);if(!h&&!m)return void(n+=1);const _=Ic(this,Ot.NeedSignalRTT),y=e.rtt,S=(y&&_?(y+_)/2:y||_)||0,w=h?h.jitterMs:void 0,A=e.recvPacketLossRate;let k=.7*A*100/50+.3*S/1500;w&&(k=.6*A*100/50+.2*S/1500+.2*w/400),n+=k<.1?1:k<.17?2:k<.36?3:k<.59?4:5}),this.remoteUserMap.size>0?Math.round(n/this.remoteUserMap.size):n}async muteLocalTrack(e){return new lt((n,i)=>{this.handleMuteLocalTrack(e,n,i)})}filterTobePublishedTracks(e,n,i){const o=[],c=kn(),u=this.getAllTracks();e=mv(e=e.filter(_=>u.indexOf(_)===-1));let h=!1,m=!1;for(const _ of e){if(_ instanceof mr&&(this.localTrackMap.has($e.LocalVideoTrack)||h?new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:_,type:$e.LocalVideoTrack}),h=!0),n)){const y=this.getLowVideoTrack(_,i);o.push({track:y,type:$e.LocalVideoLowTrack})}if(_ instanceof Br){const y=this.localTrackMap.get($e.LocalAudioTrack);if(y){if(!(y.track instanceof Ti))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");y.track.addAudioTrack(_),this.bindLocalAudioTrackEvents(_,!0)}else if(m){const S=o.find(w=>{let{type:A}=w;return A===$e.LocalAudioTrack});if(!(S.track instanceof Ti))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(_._bypassWebAudio)throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(_)}else{if(!c.webAudioMediaStreamDest||_ instanceof Ti||_._bypassWebAudio)o.push({track:_,type:$e.LocalAudioTrack});else{const S=new Ti;S.addAudioTrack(_),o.push({track:S,type:$e.LocalAudioTrack})}m=!0}}}return o}filterTobeUnpublishedTracks(e){const n=[],i=this.getAllTracks();e=mv(e=e.filter(o=>i.indexOf(o)!==-1));for(const o of e){if(o instanceof Br){const c=this.localTrackMap.get($e.LocalAudioTrack);if(!c)continue;c.track instanceof Ti?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(n.push([$e.LocalAudioTrack,c]),c.track.close())):n.push([$e.LocalAudioTrack,c])}if(o instanceof mr){const c=this.localTrackMap.get($e.LocalVideoTrack);if(!c)continue;n.push([$e.LocalVideoTrack,c]);const u=this.localTrackMap.get($e.LocalVideoLowTrack);u&&n.push([$e.LocalVideoLowTrack,u])}}return n}bindLocalTrackEvents(e){e.forEach(n=>{let{track:i,type:o}=n;switch(o){case $e.LocalVideoTrack:i.addListener(gt.GET_STATS,this.handleGetLocalVideoStats),i.addListener(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(gt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(gt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case $e.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,n){e instanceof Ti?e.trackList.forEach(i=>{i.addListener(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(gt.GET_STATS,this.handleGetLocalAudioStats),i.addListener(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(gt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),n||e.addListener(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(n=>{let[i,{track:o}]=n;return{track:o,type:i}})),e.forEach(n=>{let{track:i,type:o}=n;switch(o){case $e.LocalVideoTrack:i.off(gt.GET_STATS,this.handleGetLocalVideoStats),i.off(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(gt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(gt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case $e.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ti?e.trackList.forEach(n=>{n.off(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(gt.GET_STATS,this.handleGetLocalAudioStats),n.off(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(gt.GET_STATS,this.handleGetLocalAudioStats),e.off(gt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(gt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(gt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(gt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(gt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,n){n instanceof Av&&n.addListener(gt.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),n instanceof Pv&&n.addListener(gt.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(gt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[n,i]=e;i.has(mt.AUDIO)&&this.unbindRemoteTrackEvents(n._audioTrack),i.has(mt.VIDEO)&&this.unbindRemoteTrackEvents(n._videoTrack)})}createGatewayPublishMessage(e,n){return e.map((i,o)=>{var c;let u,{track:h,type:m}=i;switch(m){case $e.LocalAudioTrack:u=zn.Audio;break;case $e.LocalVideoTrack:u=ot(c=h._hints).call(c,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:u=zn.Low}return{kind:m===$e.LocalAudioTrack?mt.AUDIO:mt.VIDEO,stream_type:u,mid:n[o].id,ssrcs:n[o].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=n;switch(c){case $e.LocalVideoTrack:o=ot(i=u._hints).call(i,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoLowTrack:o=zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,n){e.forEach((i,o)=>{let{track:c,type:u}=i;this.localTrackMap.set(u,{track:c,id:n[o].id,ssrcs:n[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(n=>{let[i]=n;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async n=>{var i;D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(n,")")),this.emit(Ot.PeerConnectionStateChange,n),n!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),n==="connected"&&(e.isInRestartIce=!1),ot(i=this._restartStates).call(i,n)&&!e.isInRestartIce&&(n==="disconnected"&&await es(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=n=>{n!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(n,")")),wt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:n,tag:Lr.TRACER}).onSuccess(),this.emit(Ot.IceConnectionStateChange,n)},e.onICETransportStateChange=n=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(n,")"))},e.onDTLSTransportStateChange=n=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(n,")"))},e.onDTLSTransportError=n=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(n,")"))},e.onFirstAudioDecoded=n=>{var i;const o=Array.from(Pc(i=this.remoteUserMap).call(i)).find(u=>u._audioSSRC===n);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(bv.FIRST_FRAME_DECODED),wt.firstRemoteFrame(this.store.sessionId,Di.FIRST_AUDIO_DECODE,br.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Ps.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=n=>{var i;const o=Array.from(Pc(i=this.remoteUserMap).call(i)).find(c=>c._audioSSRC===n);o&&wt.firstRemoteFrame(this.store.sessionId,Di.FIRST_AUDIO_RECEIVED,br.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Ps.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(n,i,o)=>{this.reportVideoFirstFrameDecoded(n,i,o)},e.onFirstVideoReceived=n=>{var i;const o=Array.from(Pc(i=this.remoteUserMap).call(i)).find(c=>c._videoSSRC===n);o&&wt.firstRemoteFrame(this.store.sessionId,Di.FIRST_VIDEO_RECEIVED,br.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Ps.measureFromSubscribeStart(this.store.clientId,n),subscribeRequestid:n,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(n,i)=>{const o=n.candidateType==="relay",c=i.candidateType==="relay";i.candidateType!=="unknown"&&o===c||this.emit(Ot.ConnectionTypeChange,o),D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(wm(i))," -> ").concat(JSON.stringify(wm(n)),")"))},e.onSelectedRemoteCandidateChanged=(n,i)=>{D.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(wm(i))," -> ").concat(JSON.stringify(wm(n)),")"))},e.onFirstVideoDecodedTimeout=n=>{this.reportVideoFirstFrameDecoded(n,void 0,void 0,!0)},e.onLocalCandidate=n=>{this.emit(Ot.LocalCandidate,{candidate:n,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const n=e===Eo.SEND_ONLY?this.sendConnection:this.recvConnection;n&&!n.isInRestartIce&&(n.isInRestartIce=!0,D.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(n.name,"] start use restartICE")),e===Eo.SEND_ONLY?this.restartICE(e):Es(this,Ot.RequestP2PRestartICE,{direction:Eo.SEND_ONLY}))}filterTobeMutedTracks(e){const n=[];if(this.getAllTracks().indexOf(e)===-1)return n;const i=this.localTrackMap.get($e.LocalAudioTrack);if(e instanceof Br&&(i==null?void 0:i.track)instanceof Ti)return i.track.isActive||n.push([$e.LocalAudioTrack,i]),n;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(n.push(o),o[0]===$e.LocalVideoTrack)){const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&n.push([$e.LocalVideoLowTrack,c])}return n}filterTobeUnmutedTracks(e){const n=[],i=this.localTrackMap.get($e.LocalAudioTrack);if(e instanceof Br&&(i==null?void 0:i.track)instanceof Ti)return i.track.isActive&&n.push([$e.LocalAudioTrack,i]),n;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===$e.LocalVideoTrack){n.push(o);const c=this.localTrackMap.get($e.LocalVideoLowTrack);c&&n.push([$e.LocalVideoLowTrack,c])}else n.push(o);return n}createMuteMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=n;switch(c){case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoTrack:o=ot(i=u._hints).call(i,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:o=zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(n=>{var i;let o,[c,{track:u,ssrcs:h,id:m}]=n;switch(c){case $e.LocalAudioTrack:o=zn.Audio;break;case $e.LocalVideoTrack:o=ot(i=u._hints).call(i,ar.SCREEN_TRACK)?zn.Screen:zn.High;break;case $e.LocalVideoLowTrack:o=zn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,n){const i=[],o=this.remoteUserMap.get(e);if(!o)return i;if(n){const c=o.get(n);if(!c)return i;i.push([e,{kind:n,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;i.push([e,{kind:u,id:h}])});return i}createUnsubscribeMessage(e){const n=[];return e.forEach(i=>{let[o,{kind:c,id:u}]=i;switch(c){case mt.VIDEO:return void(o._videoSSRC&&n.push({stream_type:mt.VIDEO,ssrcId:o._videoSSRC}));case mt.AUDIO:return void(o._audioSSRC&&n.push({stream_type:mt.AUDIO,ssrcId:o._audioSSRC}))}}),n}withdrawRemoteTracks(e){e.forEach(n=>{let[i,{kind:o}]=n;const c=this.remoteUserMap.get(i);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const n=this.localTrackMap.get($e.LocalVideoTrack),i=this.localTrackMap.get($e.LocalVideoLowTrack);n&&(await n.track.setBitrateLimit(e.uplink),await new lt((o,c)=>{this.handleUpdateVideoEncoder(n.track,o,c,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new lt((o,c)=>{this.handleUpdateVideoEncoder(i.track,o,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,n=this.recvConnection.peerConnectionState;return e!=="connected"&&n!=="connected"}return!0}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Br){const i=this.filterTobeUnmutedTracks(e[n]);if(i.length===0)continue;const o=this.createUnmuteMessage(i);return void await sr(this,Ot.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:n}]=e;return!!n}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var n;return!((n=this.recvConnection)===null||n===void 0||!n.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,n)=>this.emit(Ot.RequestUpload,e,n),this.statsUploader.requestUploadStats=e=>this.emit(Ot.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await es(_L(this.dtlsFailedCount,gi)),this.emit(Ot.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has($e.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof mr)}throwIfTrackTypeNotMatch(e){if(e.filter(n=>n instanceof mr).length>1)throw new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(n=>n instanceof Br).length>1&&(e.some(n=>n instanceof Br&&n._bypassWebAudio)||!kn().webAudioMediaStreamDest))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const n of e){if(n instanceof mr&&this.pendingLocalTracks.some(i=>i instanceof mr))throw new Le(X.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(n instanceof Br&&this.pendingLocalTracks.some(i=>i instanceof Br)&&(!kn().webAudioMediaStreamDest||n._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof Br&&i._bypassWebAudio)))throw new Le(X.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,n){const i=!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&kn().supportDualStreamEncoding,o=LP(LP({},{width:160,height:120,framerate:15,bitrate:50}),n);let c;c=i?e._mediaStreamTrack.clone():Cx(e,o);const u=or(8,"track-low-"),h=new mr(c,LP(LP({},i&&{scaleResolutionDownBy:cx(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,u);return h.on(b_.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,Sv.LOW_STREAM)}),h._hints.push(ar.LOW_STREAM),e.addListener(gt.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,n,i,o){var c;const u=Array.from(Pc(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(_=>_.userId===u.uid&&_.type==="video");wt.firstRemoteVideoDecode(this.store.sessionId,Di.FIRST_VIDEO_DECODE,br.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:n,videoheight:i,subscribeElapse:Ps.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,n,i){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(n);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==i}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Le(X.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Le(X.NOT_SUPPORTED)}async subscribeDataChannel(e,n){throw new Le(X.NOT_SUPPORTED)}async unsubscribeDataChannel(e,n){throw new Le(X.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,n){throw new Le(X.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,n){throw new Le(X.NOT_SUPPORTED)}async preConnect(e){throw new Le(X.NOT_SUPPORTED)}getEstablishParams(){throw new Le(X.NOT_SUPPORTED)}async reSubscribe(e){throw new Le(X.NOT_SUPPORTED)}async updateVideoStreamParameter(e,n){throw new Le(X.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[n,{track:i}]=e;n===$e.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,Sv.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},Et(Rr.prototype,"p2pConnect",[x7],Object.getOwnPropertyDescriptor(Rr.prototype,"p2pConnect"),Rr.prototype),Et(Rr.prototype,"unpublish",[M7],Object.getOwnPropertyDescriptor(Rr.prototype,"unpublish"),Rr.prototype),Et(Rr.prototype,"unpublishLowStream",[U7],Object.getOwnPropertyDescriptor(Rr.prototype,"unpublishLowStream"),Rr.prototype),Et(Rr.prototype,"subscribe",[V7],Object.getOwnPropertyDescriptor(Rr.prototype,"subscribe"),Rr.prototype),Et(Rr.prototype,"mockSubscribe",[F7],Object.getOwnPropertyDescriptor(Rr.prototype,"mockSubscribe"),Rr.prototype),Et(Rr.prototype,"unsubscribe",[j7],Object.getOwnPropertyDescriptor(Rr.prototype,"unsubscribe"),Rr.prototype),Et(Rr.prototype,"muteRemote",[B7],Object.getOwnPropertyDescriptor(Rr.prototype,"muteRemote"),Rr.prototype),Et(Rr.prototype,"unmuteRemote",[W7],Object.getOwnPropertyDescriptor(Rr.prototype,"unmuteRemote"),Rr.prototype),Et(Rr.prototype,"hasRemoteMediaWithLock",[z7],Object.getOwnPropertyDescriptor(Rr.prototype,"hasRemoteMediaWithLock"),Rr.prototype),Et(Rr.prototype,"disconnectForReconnect",[G7],Object.getOwnPropertyDescriptor(Rr.prototype,"disconnectForReconnect"),Rr.prototype),Et(Rr.prototype,"remoteMediaSsrcChanged",[H7],Object.getOwnPropertyDescriptor(Rr.prototype,"remoteMediaSsrcChanged"),Rr.prototype),Rr);function gd(e){return function(n,i,o){const c=n[i];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];switch(e){case md.SEND_ONLY:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}case md.RECEIVE_ONLY:{const _=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_()}}default:{const _=await this.sendMutex.lock("From P2PChannel2.".concat(i)),y=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await c.apply(this,h)}finally{_(),y()}}}},o}}class G_ extends Ar{constructor(n,i){super(),$(this,"signal",void 0),$(this,"token",void 0),$(this,"tokenTimeout",void 0),$(this,"tokenInterval",void 0),$(this,"_sequence",0),$(this,"userMap",new Map),$(this,"encoder",new TextEncoder),this.signal=n,this.token=i;const o=()=>{this.signal.connectionState===lr.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*re("P2P_TOKEN_INTERVAL"))};o()}async send(n,i,o,c,u){var h,m,_;if(this.userMap.size===0)return;const y=Array.from(Rc(h=this.userMap).call(h))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),c=(m=c)!==null&&m!==void 0?m:or(6,""),u=(_=u)!==null&&_!==void 0?_:this._sequence++;const S={_id:c,_type:n,_seq:u,_message:i,token:"".concat(this.token,"_").concat(y)};re("SHOW_P2P_LOG")&&D.debug("send message",S,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(S)).forEach(A=>{this.signal.request(jt.DATA_STREAM,{payload:ym(this.encoder.encode(A))})});const w=new lt((A,k)=>{const W=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),U),this.off("res-@".concat(c),q),this.off(Lv.ABORT,V),D.debug("[external-signal] request timeout, type: ".concat(n,", requestId: ").concat(c)),this.userMap.size===0?k(new Le(X.INVALID_REMOTE_USER)):k(new Le(X.TIMEOUT))},re("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),U=()=>{W&&window.clearTimeout(W),this.off(Lv.ABORT,V),o&&A()},V=()=>{W&&window.clearTimeout(W),this.off("res-@".concat(c,"_ack"),U),this.off("res-@".concat(c),q),k(new Le(X.EXTERNAL_SIGNAL_ABORT,"type: ".concat(n,", requestId: ").concat(c)))};this.once(Lv.ABORT,V),this.once("res-@".concat(c,"_ack"),U);const q=(ce,_e)=>{Y=!0,W&&window.clearTimeout(W),this.off("res-@".concat(c,"_ack"),U),this.off(Lv.ABORT,V),ce==="success"?A(_e):k(new Le(X.P2P_MESSAGE_FAILED,"request ".concat(n," failed, requestId: ").concat(c)))};let Y=!1;o||(this.once("res-@".concat(c),q),es(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{Y||D.warning("external_signal request timeout, type: ".concat(n,", requestId: ").concat(c,", ").concat(S))}))});try{return await w}catch(A){if(A.code===X.TIMEOUT)return await this.send(n,i,o,c,u);throw A}}onMessage(n){var i;const{_uid:o}=n;let c,u=this.userMap.get(o);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in n)||n._type!==Qr.CHECK)return;const{token:y}=n;c=new Map,u={uid:o,isStart:!0,token:y,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,u),this.signal.emit(gn.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in n&&"total"in n){var h;const{id:y,total:S}=n,w=(h=c.get(y))!==null&&h!==void 0?h:[];if(w.push(n),c.has(y)||c.set(y,w),w.length!==S)return;{const A=VT(w).call(w,(k,W)=>k.index-W.index).map(k=>k.payload).join("");c.delete(y),(n=JSON.parse(A))._uid=o}}const{_type:m,token:_}=n;if(ot(i=[Qr.ACK,Qr.CHECK]).call(i,m))return m===Qr.CHECK&&this.handleCheckToken(u,_),void this.receiveMessage(n);_==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(n):D.debug('Receive unexpected message", '.concat(_,", cur_token: ").concat(u.token,"_").concat(this.token),n)}check(){const n={_id:or(6,""),token:this.token,_type:Qr.CHECK};re("SHOW_P2P_LOG")&&D.debug("send message",n),this.signal.request(jt.DATA_STREAM,{payload:ym(this.encoder.encode(JSON.stringify(n)))})}ack(n){const i={_id:n,_type:Qr.ACK,token:this.token};re("SHOW_P2P_LOG")&&D.debug("send message",i),this.signal.request(jt.DATA_STREAM,{payload:ym(this.encoder.encode(JSON.stringify(i)))})}response(n,i,o){this.send(Qr.RESPONSE,JSON.stringify({success:!o,message:i}),!0,n)}handleReceivedMessage(n){const i=()=>{this.userMap.forEach(y=>{const{receivedMessagesMap:S,nextExpectedSequenceNumber:w}=y;for(;S.has(w);){const A=S.get(w);S.delete(w),this.receiveMessage(A),y.nextExpectedSequenceNumber++}})};if(!n)return void i();const{_uid:o,_seq:c}=n,u=this.userMap.get(o),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:_}=u;if(c<_)return this.ack(n._id),void D.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(n._message));h.set(c,n),m&&c===_&&(this.receiveMessage(n),h.delete(_),u.nextExpectedSequenceNumber++,i())}receiveMessage(n){const{_id:i,_type:o,_message:c,_uid:u}=n;if(re("SHOW_P2P_LOG")&&D.debug("receive message",n),i){let h;switch(n._type!==Qr.ACK&&(c&&(h=JSON.parse(c)),this.ack(n._id)),n._type){case Qr.CANDIDATE:case Qr.CONTROL:this.signal.emit(o,h,u);break;case Qr.PUBLISH:case Qr.UNPUBLISH:case Qr.RESTART_ICE:case Qr.CALL:h.uid=u,Es(this.signal,o,h).then(m=>{this.response(n._id,m)}).catch(()=>{this.response(n._id,void 0,!0)});break;case Qr.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case Qr.RESPONSE:{const{success:m,message:_}=h;this.emit("res-@".concat(i),m?"success":"failed",_);break}}}}splitMessage(n){if(n.length<G_.MAX_MESSAGE_SIZE)return[n];const i=[],{remoteToken:o}=JSON.parse(n),c=or(6,"");let u=0,h=800;const m=Math.ceil(n.length/h);for(;n.length>0;){u++;const _={id:c,index:u,total:m,payload:n.slice(0,h),token:"".concat(this.token,"_").concat(o)};JSON.stringify(_).length>G_.MAX_MESSAGE_SIZE?h-=50:(i.push(_),n=n.slice(h))}return i.map(_=>JSON.stringify(_))}handleCheckToken(n,i){return n.token!==i?(D.debug("token changed, from ".concat(n.token," to ").concat(i)),this.reset(n.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{D.debug("token timeout, ".concat(i)),this.reset(n.uid)},re("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const n=await Es(this.signal,Qr.CALL,void 0),i=await this.send(Qr.CALL,n);this.signal.emit(Bt.P2P_CONNECTION,i,!0)}async reset(n,i){const o=this.userMap.get(n);o&&(this.emit(Lv.ABORT),this.signal.emit(gn.ON_USER_OFFLINE,{uid:o.uid,reason:ife.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(D.debug("change local token from ".concat(i," to ").concat(i)),this.token=or(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Lv.ABORT)}}$(G_,"MAX_SIZE",1),$(G_,"MAX_MESSAGE_SIZE",1024);class jge extends Ar{get connectionState(){return this._connectionState}set connectionState(n){n!==this._connectionState&&(this._connectionState=n,n===lr.CONNECTED?this.emit(Bt.WS_CONNECTED):n===lr.RECONNECTING?this.emit(Bt.WS_RECONNECTING,this._websocketReconnectReason):n===lr.CLOSED&&this.emit(Bt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(n,i){super(),$(this,"_disconnectedReason",void 0),$(this,"_websocketReconnectReason",void 0),$(this,"_connectionState",lr.CLOSED),$(this,"reconnectToken",void 0),$(this,"p2pToken",void 0),$(this,"websocket",void 0),$(this,"openConnectionTime",void 0),$(this,"clientId",void 0),$(this,"lastMsgTime",Date.now()),$(this,"uploadCache",[]),$(this,"uploadCacheInterval",void 0),$(this,"rttRolling",new TW(5)),$(this,"pingpongTimer",void 0),$(this,"pingpongTimeoutCount",0),$(this,"joinResponse",void 0),$(this,"multiIpOption",void 0),$(this,"initError",void 0),$(this,"spec",void 0),$(this,"store",void 0),$(this,"_external_signal",void 0),$(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Bt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case gn.ON_DATA_STREAM:return void this.handleDataStream(c._message);case gn.MUTE_AUDIO:case gn.MUTE_VIDEO:case gn.ON_P2P_LOST:case gn.ON_USER_ONLINE:return;case gn.ON_USER_OFFLINE:const{uid:u}=c._message;return D.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===gn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===gn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(jn.UID_BANNED);break;case 15:this.close(jn.IP_BANNED);break;case 16:this.close(jn.CHANNEL_BANNED)}if(c._type===gn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Dt.ERR_LICENSE_MISSING:this.close(jn.LICENSE_MISSING);break;case Dt.ERR_LICENSE_EXPIRED:this.close(jn.LICENSE_EXPIRED);break;case Dt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(jn.LICENSE_MINUTES_EXCEEDED);break;case Dt.ERR_LICENSE_PERIOD_INVALID:this.close(jn.LICENSE_PERIOD_INVALID);break;case Dt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(jn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Dt.ERR_LICENSE_ILLEGAL:this.close(jn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=n.clientId,this.spec=n,this.store=i,this.websocket=new ox("gateway-".concat(this.clientId),this.spec.retryConfig,!0,re("JOIN_GATEWAY_USE_DUAL_DOMAIN"),re("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===lr.CONNECTED&&this.reconnect("retry",_s.OFFLINE)}),this.p2pToken=or(6,""),this._external_signal=new G_(this,this.p2pToken)}async request(n,i,o,c){const u=or(6,""),h={_id:u,_type:n,_message:i},m=this.websocket.connectionID,_=()=>new lt((W,U)=>{if(this.connectionState===lr.CONNECTED)return W();const V=()=>{this.off(Bt.WS_CLOSED,q),W()},q=()=>{this.off(Bt.WS_CONNECTED,V),U(new Le(X.WS_ABORT))};this.once(Bt.WS_CONNECTED,V),this.once(Bt.WS_CLOSED,q)});if(this.connectionState!==lr.CONNECTING&&this.connectionState!==lr.RECONNECTING||n===jt.JOIN||n===jt.REJOIN||await _(),this.websocket.sendMessage(h,!0),c)return;const y=new lt((W,U)=>{let V=!1;const q=(ce,_e)=>{V=!0,W({isSuccess:ce==="success",message:_e||{}}),this.off(Bt.WS_CLOSED,Y),this.off(Bt.WS_RECONNECTING,Y),this.emit(Bt.REQUEST_SUCCESS,n,i)};this.once("res-@".concat(u),q);const Y=()=>{U(new Le(X.WS_ABORT,"type: ".concat(n))),this.off(Bt.WS_CLOSED,Y),this.off(Bt.WS_RECONNECTING,Y),this.off("res-@".concat(u),q)};this.once(Bt.WS_CLOSED,Y),this.once(Bt.WS_RECONNECTING,Y),es(re("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||V||(D.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(n)),this.emit(Bt.REQUEST_TIMEOUT,n,i))})});let S=null;try{S=await y}catch(W){if(this.connectionState===lr.CLOSED||n===jt.LEAVE)throw new Le(X.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?W.throw():n===jt.JOIN||n===jt.REJOIN?null:(await _(),await this.request(n,i))}if(S.isSuccess)return S.message;const w=Number(S.message.error_code||S.message.code),A=ub(w),k=new Le(X.UNEXPECTED_RESPONSE,"".concat(A.desc,": ").concat(S.message.error_str),{code:w,data:S.message,desc:A.desc});return A.action==="success"?S.message:(D.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(n,", error_code: ").concat(w,", message: ").concat(A.desc,", action: ").concat(A.action)),w===Dt.ERR_TOO_MANY_BROADCASTERS?((n===jt.JOIN||n===jt.REJOIN)&&(this.initError=k,this.close()),k.throw()):A.action==="failed"?k.throw():A.action==="quit"?(this.initError=k,this.close(),k.throw()):(w===Dt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,D.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",_s.MULTI_IP)):this.reconnect(A.action,_s.SERVER_ERROR),n===jt.JOIN||n===jt.REJOIN?null:await this.request(n,i)))}waitMessage(n,i){return new lt(o=>{const c=u=>{(!i||i(u))&&(this.off(n,c),o(u))};this.on(n,c)})}uploadWRTCStats(n){if(!this.store.sessionId)return void D.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:n};this.upload(cb.WRTC_STATS,i)}upload(n,i){const o={_type:n,_message:i};try{this.websocket.sendMessage(o)}catch{const u=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==lr.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},re("UPLOAD_CACHE_INTERVAL")||2e3))}}send(n,i){const o={_type:n,_message:i};this.websocket.sendMessage(o)}async sendExtensionMessage(n,i,o){return await this._external_signal.send(n,i,o)}init(n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new lt((i,o)=>{this.once(Bt.WS_CONNECTED,()=>i(this.joinResponse)),this.once(Bt.WS_CLOSED,()=>o(this.initError||new Le(X.WS_ABORT))),this.connectionState=lr.CONNECTING,this.websocket.init(n).catch(o)})}close(n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=n||jn.LEAVE,this.connectionState=lr.CLOSED,D.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=or(6,""),this._external_signal.clear(),this._external_signal=new G_(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Bt.ABORT_P2P_EXECUTION);const n=await Es(this,Bt.REQUEST_JOIN_INFO),i=await this.request(jt.JOIN,n);if(!i)return this.emit(Bt.REPORT_JOIN_GATEWAY,X.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(Bt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=lr.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(n,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(n,i)}handleDataStream(n){try{var i;const o=v_(n.payload),c=new TextDecoder().decode(o),u=JSON.parse(c);"total"in u&&"id"in u||ot(i=Object.values(Qr)).call(i,u._type)?(u._uid=n.uid,this._external_signal.onMessage(u)):this.emit(gn.ON_DATA_STREAM,n)}catch{this.emit(gn.ON_DATA_STREAM,n)}}handleNotification(n){D.debug("[".concat(this.clientId,"] receive notification: "),n);const i=ub(n.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(jn.UID_BANNED),void this.close()):void this.reconnect(i.action,_s.SERVER_ERROR);D.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const n=re("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=n&&(D.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",_s.TIMEOUT):this.request(jt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-i;this.rttRolling.add(o),re("REPORT_STATS")&&this.send(jt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(Kt.RECONNECT_CREATE_CONNECTION,n=>{this.emit(Bt.WS_RECONNECT_CREATE_CONNECTION,n)}),this.websocket.on(Kt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Kt.CLOSED,()=>{this.connectionState=lr.CLOSED}),this.websocket.on(Kt.FAILED,()=>{this._disconnectedReason=jn.NETWORK_ERROR,this.connectionState=lr.CLOSED}),this.websocket.on(Kt.RECONNECTING,n=>{this._websocketReconnectReason=n,this.joinResponse=void 0,this.connectionState===lr.CONNECTED?this.connectionState=lr.RECONNECTING:this.connectionState=lr.CONNECTING}),this.websocket.on(Kt.WILL_RECONNECT,(n,i,o)=>{n!=="retry"?(D.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(n)),this.reconnectToken=void 0):D.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(n)}),this.websocket.on(Kt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(n=>{if(this.emit(Bt.REPORT_JOIN_GATEWAY,n,this.url||""),n instanceof Le&&n.code===X.UNEXPECTED_RESPONSE&&n.data.code===Dt.ERR_NO_AUTHORIZED)return D.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",_s.SERVER_ERROR);D.error("[".concat(this.clientId,"] join gateway request failed"),n.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",_s.SERVER_ERROR):(this.initError=n,this.close())})}),this.websocket.on(Kt.REQUEST_NEW_URLS,(n,i)=>{Es(this,Bt.REQUEST_RECOVER,this.multiIpOption).then(n).catch(i)}),this.websocket.on(Kt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(gn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const Bge={name:"P2PChannel",create:function(e){let{store:n,statsCollector:i}=e;return new Fge(n,i)},createSubmodule:function(e){let{store:n,spec:i}=e;return new jge(i,n)}};function K7(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function q7(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?K7(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):K7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}class Wge{constructor(n){$(this,"sessionDesc",void 0),$(this,"localCapabilities",void 0),$(this,"rtpCapabilities",void 0),$(this,"candidates",void 0),$(this,"_originCandidates",void 0),$(this,"iceParameters",void 0),$(this,"dtlsParameters",void 0),$(this,"setup",void 0),$(this,"currentMidIndex",void 0),$(this,"cname",void 0),n=xr(n);const{iceParameters:i,dtlsParameters:o,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:m,sdkCodec:_,cname:y}=n,S=ya(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=xr(c),this.iceParameters=i,this.dtlsParameters=o,this.setup=h,this.localCapabilities=m,this.cname=y;for(let w=0;w<S.mediaDescriptions.length;w++){const A=S.mediaDescriptions[w];if(A.attributes.iceUfrag=i.iceUfrag,A.attributes.icePwd=i.icePwd,A.attributes.fingerprints=o.fingerprints,A.attributes.candidates=c,A.attributes.setup=h,A.media.mediaType==="video"){A.media.fmts=u.videoCodecs.map(W=>W.payloadType.toString(10));let k=u.videoCodecs.filter(W=>{var U,V;return(U=W.rtpMap)===null||U===void 0?void 0:ot(V=U.encodingName.toLowerCase()).call(V,_)});k.length===0&&(k=u.videoCodecs),A.attributes.payloads=k,A.attributes.extmaps=u.videoExtensions}A.media.mediaType==="audio"&&(A.media.fmts=u.audioCodecs.map(k=>k.payloadType.toString(10)),A.attributes.payloads=u.audioCodecs,A.attributes.extmaps=u.audioExtensions),S.mediaDescriptions[w]=this.mungMediaDesc(A)}this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return vm(this.sessionDesc)}send(n,i,o){const{ssrcs:c,ssrcGroups:u}=O_(i,this.cname),h=this.sessionDesc.mediaDescriptions.find(y=>n===mt.VIDEO?y.media.mediaType==="video":y.media.mediaType==="audio"),m=c[0].attributes.label,_=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:m,mslabel:_}}batchSend(n){return n.map(i=>{let{kind:o,ssrcMsg:c}=i;return this.send(o,c,void 0)})}stopSending(n){this.sessionDesc.mediaDescriptions.forEach(i=>{const o=[],c=[],u=[];i.attributes.ssrcs.forEach(h=>{ot(n).call(n,h.attributes.label||"")?u.push(h):o.push(h)}),i.attributes.ssrcGroups.forEach(h=>{var m;ot(m=u.map(_=>_.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),i.attributes.ssrcs=o,i.attributes.ssrcGroups=c})}mute(n){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(n){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===n);if(!i)throw new Error("mediaDescription not found with ".concat(n," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(n,i,o){n.forEach((c,u)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(y=>y.attributes.mid===h.kind),_=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=_})}stopReceiving(n){}updateCandidates(n){const i=this._originCandidates.filter(c=>c.transport==="udp"),o=[];if(i.forEach(c=>{o.push(q7(q7({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),i.length!==0){switch(n){case As.TCP_RELAY:this.candidates=o;break;case As.UDP_TCP_RELAY:case As.RELAY:this.candidates=[...i,...o];break;default:this.candidates=i}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(n){n=xr(n),this.iceParameters=n,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=n.iceUfrag,i.attributes.icePwd=n.icePwd})}predictReceivingMids(n){const i=[];for(let o=0;o<n;o++)i.push((this.currentMidIndex+o+1).toString(10));return i}mungRecvMediaDsec(n,i){const o=xr(n);return Uv(o,i),ux(o,i),o}updateRecvMedia(n,i){const o=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===n);if(o!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],i);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(n){this.currentMidIndex+=n}updateTrackLabel(n,i,o){const c=this.sessionDesc.mediaDescriptions.find(h=>n===mt.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===i);var u;h&&(h.attributes.label=o,(u=h.attributes.msid)===null||u===void 0||u.replace(i,o))}}mungMediaDesc(n){const i=xr(n);return lx(i),function(o){const c=o.attributes.extmaps.find(u=>XA(u.extensionName));c&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(c),1),o.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(i),i}getSSRC(n){for(const i of this.sessionDesc.mediaDescriptions)for(const o of i.attributes.ssrcs)if(o.attributes.label===n)return[o]}}var rr;function Y7(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),i.push.apply(i,o)}return i}function xP(e){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?Y7(Object(i),!0).forEach(function(o){$(e,o,i[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Y7(Object(i)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(i,o))})}return e}let zge=(rr=class Rw extends iG{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(n=>n.rtpMap&&n.rtpMap.encodingName.toLowerCase()||"").filter(n=>{var i;return ot(i=Object.keys(RA)).call(i,n)}))]}constructor(n,i){super(n,i),$(this,"store",void 0),$(this,"peerConnection",void 0),$(this,"remoteSDP",void 0),$(this,"initialOffer",void 0),$(this,"statsFilter",void 0),$(this,"useRTX",!1),$(this,"localCapabilities",void 0),$(this,"localCandidateCount",0),$(this,"allCandidatesReceived",!1),$(this,"establishPromise",void 0),$(this,"mutex",void 0),this.store=i,this.mutex=new Cs("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(Rw.resolvePCConfiguration(n),{optional:[{googDscp:!0}]}),this.statsFilter=bL(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,Nr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const n=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Rm(n.sdp),o=pb(n.sdp,{filterRTX:!this.useRTX,filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=n,xP(xP({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:n.sdp})}catch(n){throw new Le(X.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async updateRemoteConnect(){}async connect(n){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Wge(xP(xP({},n),{},{rtpCapabilities:n.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(n,i){throw new Le(X.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(n){}send(n,i){var o=this;return hl(function*(){const c=yield wn(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=n.map(A=>o.peerConnection.addTrack(A._mediaStreamTrack)),h=yield wn(o.peerConnection.createOffer()),m=ya(h.sdp),_=n.map(A=>{const k=A._mediaStreamTrack,W=m.mediaDescriptions.find(U=>U.attributes.mid===k.kind);if(!W)throw new Error("Cannot extract ssrc from mediaDescription.");return function(U,V,q){const Y=U.attributes.ssrcs.filter(_e=>_e.attributes.label===V),ce=U.attributes.ssrcGroups;if(Y.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(ce&&Y.length>1){const _e=ce.find(Ee=>Ee.ssrcIds.indexOf(Y[0].ssrcId)!==-1);return _e?[{ssrcId:_e.ssrcIds[0],rtx:q?_e.ssrcIds[1]:void 0}]:[{ssrcId:Y[0].ssrcId}]}return[{ssrcId:Y[0].ssrcId}]}(W,k.id,o.useRTX)});let y;try{y=yield _}catch(A){throw u.forEach(k=>{gs()&&k.replaceTrack(null),o.peerConnection.removeTrack(k)}),A}const S=o.mungSendOfferSDP(h.sdp,n);o.remoteSDP.receive(n,i,y);const w=o.remoteSDP.toString();return yield wn(o.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield wn(o.applySendEncodings(u,n)),yield wn(o.peerConnection.setRemoteDescription({type:"answer",sdp:w})),n.map((A,k)=>{const W=A._mediaStreamTrack.id;return{localSSRC:_[k],id:W}})}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getSenders().filter(u=>{var h;return n.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==n.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(u=>{gs()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(n);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(n,i,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(n," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(n,i,c),m=new lt((S,w)=>{const A=setTimeout(()=>{w(new Error("Cannot receive track, id: ".concat(u)))},1e4),k=W=>{const U=Rn();if((U.name==="Safari"&&Number(U.version)===11||mo())&&W.track.id!==u&&W.streams[0].id===h){var V;const q=W.streams[0].getTracks()[0];return(V=this.remoteSDP)===null||V===void 0||V.updateTrackLabel(n,u,W.track.id),this.peerConnection.removeEventListener("track",k),clearTimeout(A),void S(q)}if(W.track.id===u)return this.peerConnection.removeEventListener("track",k),clearTimeout(A),void S(W.track)};this.peerConnection.addEventListener("track",k)}),_=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_});const y=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(y),{track:await m,id:u}}catch(u){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(n);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(n){}async unmuteRemote(n){}async muteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(o=>{var c;return n.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(i.length!==n.length)throw new Error("sender' length doesn't match mids' length.");i.map(o=>{if(gs()&&o.track)o.track.enabled=!1;else{const c=o.getParameters();c.encodings.forEach(u=>u.active=!1),o.setParameters(c)}})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(u=>{var h;return n.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==n.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async u=>{if(gs()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(m=>m.active=!0),await u.setParameters(h)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(n){var i=this;return hl(function*(){const o=yield wn(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=kn().supportPCSetConfiguration;if(n===As.RELAY&&!c)return;if(c){const y=i.peerConnection.getConfiguration(),S=n===As.RELAY?"relay":"all";y.iceTransportPolicy!==S&&(D.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(y.iceTransportPolicy,"] to [").concat(S,"]")),y.iceTransportPolicy=S,i.peerConnection.setConfiguration(y))}n!==As.RELAY&&i.remoteSDP.updateCandidates(n);const u=yield wn(i.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Rm(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;i.remoteSDP.restartICE(m);const _=i.remoteSDP.toString();yield wn(i.peerConnection.setLocalDescription(u)),yield wn(i.peerConnection.setRemoteDescription({type:"answer",sdp:_}))}catch(c){D.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}close(){var n;this.peerConnection.close(),(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(n){return this.statsFilter.getVideoIsReady(n)}async updateEncoderConfig(n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(X.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(n,i){const o=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===n});o.length===1&&await this.applySendEncodings(o,[i])}setStatsRemoteVideoIsReady(n,i){this.statsFilter.setVideoIsReady2(n,i)}async replaceTrack(n,i){const o=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===i});o&&await o.replaceTrack(n._mediaStreamTrack)}createDataChannels(n,i){throw new Le(X.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(n){throw new Le(X.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var n;(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var n;(n=this.onConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=n=>{n.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,D.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(n){const i={iceServers:[],sdpSemantics:"plan-b"};return n.iceServers?i.iceServers=n.iceServers:n.turnServer&&n.turnServer.mode!=="off"&&(eb(n.turnServer.servers)?i.iceServers=n.turnServer.servers:(i.iceServers&&i.iceServers.push(...Rw.turnServerConfigToIceServers(n.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&n.turnServer.serversFromGateway&&i.iceServers.push(...Rw.turnServerConfigToIceServers(n.turnServer.serversFromGateway)),n.turnServer.servers.concat(n.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(n){const i=[];return n.forEach(o=>{o.security?o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(n,i){var o;if(i||(i=this.peerConnection.getSenders().find(y=>{var S;return((S=y.track)===null||S===void 0?void 0:S.id)===n._mediaStreamTrack.id})),!i)return D.warn("[".concat(n.getTrackId(),"] no rtpSender found}"));if(!kn().supportSetRtpSenderParameters)return D.warn("Browser not support set rtp-sender parameters");const c={},u={};if(n instanceof mr)switch(n._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(re("DSCP_TYPE")&&Mp()){var h;const y=re("DSCP_TYPE");ot(h=["very-low","low","medium","high"]).call(h,y)&&(u.networkPriority=y)}const m=i.getParameters(),_=(o=m.encodings)===null||o===void 0?void 0:o[0];_&&Object.assign(_,u),Object.assign(m,c),D.debug("[".concat(n.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await i.setParameters(m)}async applySendEncodings(n,i){try{if(!kn().supportSetRtpSenderParameters||n.length!==i.length)return;for(let o=0;o<n.length;o++){const c=n[o],u=i[o];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{D.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(n,i){const o=ya(n);return i.forEach((c,u)=>{const h=c._mediaStreamTrack,m=o.mediaDescriptions.find(_=>_.attributes.mid===h.kind);m&&Uv(m,c)}),vm(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=n=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoReceived=n=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstAudioDecoded=n=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,n)},this.statsFilter.onFirstVideoDecoded=(n,i,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,n,i,o)},this.statsFilter.onSelectedLocalCandidateChanged=(n,i)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,n,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(n,i)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,n,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const i=this.remoteSDP.batchSend(n).map((u,h)=>{let{id:m,mslabel:_}=u;const{kind:y}=n[h];return new lt((S,w)=>{const A=setTimeout(()=>{w(new Error("Cannot receive track, id: ".concat(m)))},1e4),k=W=>{const U=Rn();if(U.name==="Safari"&&Number(U.version)===11&&W.track.id!==m&&W.streams[0].id===_){var V;const q=W.streams[0].getTracks()[0];return(V=this.remoteSDP)===null||V===void 0||V.updateTrackLabel(y,m,W.track.id),this.peerConnection.removeEventListener("track",k),clearTimeout(A),void S({track:q,id:m})}if(W.track.id===m)return this.peerConnection.removeEventListener("track",k),clearTimeout(A),void S({track:W.track,id:m})};this.peerConnection.addEventListener("track",k)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await lt.all(i)}catch(i){throw new Le(X.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(n){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(n);return i==null?void 0:i[0].ssrcId}setConfiguration(n){if(kn().supportPCSetConfiguration){const i=Rw.resolvePCConfiguration(n);this.peerConnection.setConfiguration(i)}}},Et(rr.prototype,"connect",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"connect"),rr.prototype),Et(rr.prototype,"stopSending",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"stopSending"),rr.prototype),Et(rr.prototype,"receive",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"receive"),rr.prototype),Et(rr.prototype,"stopReceiving",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"stopReceiving"),rr.prototype),Et(rr.prototype,"muteRemote",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"muteRemote"),rr.prototype),Et(rr.prototype,"unmuteRemote",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"unmuteRemote"),rr.prototype),Et(rr.prototype,"muteLocal",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"muteLocal"),rr.prototype),Et(rr.prototype,"unmuteLocal",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"unmuteLocal"),rr.prototype),Et(rr.prototype,"close",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"close"),rr.prototype),Et(rr.prototype,"updateEncoderConfig",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"updateEncoderConfig"),rr.prototype),Et(rr.prototype,"updateSendParameters",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"updateSendParameters"),rr.prototype),Et(rr.prototype,"replaceTrack",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"replaceTrack"),rr.prototype),Et(rr.prototype,"getRemoteSSRC",[vl],Object.getOwnPropertyDescriptor(rr.prototype,"getRemoteSSRC"),rr.prototype),rr);function vl(e,n,i){const o=e[n];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(n));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}const Gge={name:"PlanBConnection",create:function(e){let{store:n,spec:i}=e;return new zge(i,n)}},Hge={interceptLocalAudioFrame:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!kn().supportWebRTCEncodedTransform)return void D.warning("browser not support audio encoded transform");if(LA.has(e)||!e.track)return;const i={track:e.track};if(xp()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void D.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(D.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const _=n.metadata&&n.metadata();_?function(y,S){const{chunk:w,controller:A}=S,k=re("ENABLE_AUDIO_PTS_METADATA")?jp.AUDIO_64_BIT_PTS:jp.METADATA;w.data=function(W,U,V){const q=V.byteLength,Y=q+KL+Wz,ce=HL+$L+Y,_e=new ArrayBuffer(W.byteLength+ce),Ee=new DataView(_e);Ee.setUint8(0,Bz),Ee.setUint16(1,Y),Ee.setUint8(3,U),Ee.setUint16(4,q);for(let ke=0;ke<q;ke++)Ee.setUint8(6+ke,V[ke]);const me=new Uint8Array(Ee.buffer);return me.set(new Uint8Array(W),ce),me.buffer}(w.data,k,y),A.enqueue(w)}(_,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(gs()){if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const c=DA(),u=new MessageChannel;await new lt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);e.transform=h,await new lt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;if(m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id)D.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o);else if(m.data.getMetadata){const y=n.metadata&&n.metadata();y&&u.port1.postMessage({metadata:y})}},i.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=LA.get(e);if(c){LA.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){D.warning(m&&m.message)}}}LA.set(e,i),e.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!kn().supportWebRTCEncodedTransform)return void D.warning("browser not support audio encoded transform");if(jA.has(e))return;const i={track:e.track,onMetadata:n.onMetadata};if(xp()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");sL(Mn.CHROME,87,116)||(n.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(h){return void D.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(D.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)),n.enableTopn?function(_,y,S){var w;const A=zz(new DataView(y.data));if(!A)return S.enqueue(y);const k=_.track.id;Rpe.set(k,_.track);const W=(w=A.tlv.find(_e=>_e.tag===jp.AUDIO_LEVEL))===null||w===void 0?void 0:w.value;let U=0;typeof W=="number"&&(U=127-W);const V=Math.round(Math.pow(10,U/60)-1),{selected:q,speaker:Y}=function(_e,Ee){let me=Ov.get(_e);if(me||(me=function(ke){const Ye=new Hz;return Ov.set(ke,Ye),ud||(ud=new bpe(re("TOPN_SILENCE_THRESHOLD")||500),ud.on("ActiveSpeakerChanged",ut=>{ut!=null&&(UA=ut)})),ud.addSpeakers([Ye]),Ye}(_e)),Ov.size<=$z)return{selected:!0,speaker:me};if(!ud)throw new Error("no active speaker detector");return ud.levelChanged(me.id,Ee),I_=ud.loudest.map(ke=>ke.id),UA&&!ot(I_).call(I_,UA)&&I_.length>=$z&&I_.pop(),{selected:ot(I_).call(I_,me.id)||me.id===UA,speaker:me}}(_,V),ce=function(_e,Ee,me){const ke=dd.get(_e)||new wpe(_e,Ee);return ke.score=me,dd.set(_e,ke),function(Ye){if(VA.set(Ye,!0),!FA)return void(FA=Date.now());const ut=Date.now();ut-FA>1e3&&(VA.get(Ye)?VA.set(Ye,!1):(Kz(Ye),VA.delete(Ye)),FA=ut)}(_e),ke}(k,_.track,Y.energyScore);ce.addSample(q),ce.active&&(y.data=A.frame.buffer,S.enqueue(y))}(e,h,m):n.enableMetadata?function(_,y,S){const w=zz(new DataView(_.data));if(!w)return y.enqueue(_);const A=w.tlv.find(k=>k.tag===jp.METADATA||k.tag===jp.AUDIO_64_BIT_PTS);A&&S&&A.value instanceof Uint8Array&&S(A.value),_.data=w.frame.buffer,y.enqueue(_)}(h,m,n.onMetadata):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(gs()){if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const c=DA(),u=new MessageChannel;await new lt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);e.transform=h,await new lt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(D.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):m.data.metadata&&i.onMetadata&&i.onMetadata(m.data.metadata)},i.worker=c}function o(){e.track.removeEventListener("ended",o),function(c){const u=jA.get(c);if(u){(function(_){const y=Ov.get(_);y&&(Ov.delete(_),ud&&(ud.removeSpeakers([y]),Ov.size===0&&(ud.destroy(),ud=null)))})(c),Kz(c.track.id),jA.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){D.warning(_&&_.message)}}}(e)}jA.set(e,i),e.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(e,n){if(!kn().supportWebRTCEncodedTransform)return void D.warning("browser not support video encoded transform");if(BA.has(e)||!e.track)return;const i={track:e.track};if(xp()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(m){return void D.error("create video-encoded-streams error",m&&m.message)}const u=[];n.on("sei-to-send",m=>{u.push(m)});const h=new TransformStream({transform(m,_){i.controller||(i.controller=_),e.track&&e.track.id!==i.track.id&&(D.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const y=u.shift();y&&(m.data=function(S,w){const A=function(Y){const ce=Y.length;let _e=[],Ee=0;for(;Ee<ce;)Ee+2<ce&&Y[Ee]===0&&Y[Ee+1]===0&&(Y[Ee+2]===0||Y[Ee+2]===1||Y[Ee+2]===2||Y[Ee+2]===3)?(_e.push(Y[Ee],Y[Ee+1],3,Y[Ee+2]),Ee+=3):(_e.push(Y[Ee]),Ee++);return new Uint8Array(_e)}(w),k=A.length,W=Math.floor(k/255),U=k%255,V=new Uint8Array(6+W+1+k+S.byteLength);V[0]=0,V[1]=0,V[2]=0,V[3]=1,V[4]=6,V[5]=101;let q=0;for(;q<W;)V[6+q]=255,q++;return V[6+q]=U,q++,V.set(A,6+q),V.set(new Uint8Array(S),6+q+k),V.buffer}(m.data,y)),_.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!gs())return;{if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const c=DA(),u=new MessageChannel;await new lt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);e.transform=h,await new lt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),n.on("sei-to-send",m=>{u.port1.postMessage({sei:m})}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id&&(D.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o))},i.worker=c}}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=BA.get(e);if(c){BA.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){D.warning(m&&m.message)}}}BA.set(e,i),e.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!kn().supportWebRTCEncodedTransform)return void D.warning("browser not support video encoded transform");if(!e.track)return;if(ab.has(e)){const c=ab.get(e);return void(c&&(c.onSei=n.onSei))}const i={track:e.track,onSei:n.onSei};if(xp()){if(!e.createEncodedStreams)return void D.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void D.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){i.controller||(i.controller=m),e.track&&e.track.id!==i.track.id&&(D.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o));const _=function(y){const S=new DataView(y.data);let w=0;for(;w+4<y.data.byteLength;){if(S.getUint8(w+0)===0&&S.getUint8(w+1)===0&&S.getUint8(w+2)===0&&S.getUint8(w+3)===1&&S.getUint8(w+4)===6){let A=w+6,k=0,W=0;for(;(W=S.getUint8(A++))===255;)k+=255;k+=W;const U=Cpe(y.data,A,k);return new Uint8Array(U)}w++}return null}(h);_&&i.onSei&&i.onSei(_),m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(gs()){if(typeof RTCRtpScriptTransform>"u")return void D.warning("browser not support RTCRtpScriptTransform");const c=DA(),u=new MessageChannel;await new lt(m=>c.onmessage=_=>{_.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);e.transform=h,await new lt(m=>c.onmessage=_=>{_.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var _;m.data.transformed&&e.track&&((_=e.track)===null||_===void 0?void 0:_.id)!==i.track.id?(D.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",o),i.track=e.track,i.track.addEventListener("ended",o)):m.data.sei&&i.onSei&&i.onSei(m.data.sei)},i.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}(function(c){const u=ab.get(c);if(u){ab.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(_){D.warning(_&&_.message)}}})(e)}ab.set(e,i),e.track.addEventListener("ended",o)}},$ge={name:"InterceptFrame",create:()=>Hge};wL(),Xn("PROCESS_ID","process-".concat(or(8,""),"-").concat(or(4,""),"-").concat(or(4,""),"-").concat(or(4,""),"-").concat(or(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(n){return void D.error("Error loading sdk config",n.message)}if(e)try{const n=JSON.parse(window.atob(e)),i=Date.now();D.debug("Loading global parameters from cache",n),Object.keys(n).forEach(o=>{if(Object.prototype.hasOwnProperty.call(fr,o)){const{value:c,expires:u}=n[o];if(u&&u<=i)return;ld[o]=c,fr[o]=c}})}catch(n){D.error("Error loading mutableParamsCache: ".concat(e),n.message)}}(),Array.isArray(ld.AREAS)&&ld.AREAS.length>0&&mx(ld.AREAS,!0);const X7=(e,n,i)=>{D.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(n))),Xn(e,n,i)};Cm(mge,!1),Cm(Ege,!1),Cm(Jfe,!1),Cm(Pge,!1),Cm(hge,!1),Cm(Bge,!1),Cm(Gge,!1),Cm($ge,!1);const _i=function(e){const n=new Ar,i=e,o={getListeners:n.getListeners.bind(n),on:(c,u)=>(function(h,m){h===hh.SECURITY_POLICY_VIOLATION&&OH(m,!0)}(c,u),n.on.bind(n)(c,u)),addListener:n.addListener.bind(n),once:n.once.bind(n),off:n.off.bind(n),removeAllListeners:n.removeAllListeners.bind(n),emit:n.emit.bind(n),safeEmit:n.safeEmit.bind(n)};return PH(PH({},i),o)}({__TRACK_LIST__:vv,VERSION:pl,BUILD:IL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:X7,getParameter:re,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let n=new RTCPeerConnection;const i=await async function(o){let c;return kn().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),c=(await o.createOffer()).sdp):c=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(n);if(!i)return e;n.close(),n=null,e=function(o){const c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ H265/i)&&c.video.push("H265"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c}(i)}catch(n){throw new Oe(X.CREATE_OFFER_FAILED,n.toString&&n.toString()).print()}return e},checkSystemRequirements:function(){const e=wt.reportApiInvoke(null,{name:mi.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Lr.TRACER});let n=!1;try{const u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;n=!!(u&&h&&m),n&&lL()&&J6(75)&&new u().close()}catch(u){return D.error("check system requirement failed: ",u),!1}let i=!1;const o=Rn();o.name===Mn.CHROME&&Number(o.version)>=58&&(ad.engine.name!=="WebKit"||function(){const u=Rn();if(gA()){if(u.os===Ni.MAC_OS)return!0;if(u.os===Ni.IOS){const h=ad.os.version&&ad.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(i=!0),(o.name===Mn.FIREFOX&&Number(o.version)>=56||o.name===Mn.OPERA&&Number(o.version)>=45||o.name===Mn.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(mo()||tu())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||rW()||Rn().name===Mn.QQ)&&(i=!0),D.debug("checkSystemRequirements, api:",n,"browser",i);const c=n&&i;return e.onSuccess(c),c},getDevices:function(e){return Lc.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Lc.getRecordingDevices(e)},getCameras:function(e){return Lc.getCamerasDevices(e)},getElectronScreenSources:JW,getPlaybackDevices:function(e){return Lc.getSpeakers(e)},createClient:function(){var e;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=or(5,"client-"),o=wt.reportApiInvoke(null,{id:i,name:mi.CREATE_CLIENT,options:[n],tag:Lr.TRACER});try{(function(c){Ci(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Ci(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Ci(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&Zi(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&dW(c.turnServer),c.httpRetryConfig!==void 0&&uW(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&uW(c.websocketRetryConfig)})(n)}catch(c){throw o.onError(c),c}return(Z6(16,0)||eW(16,0,!0))&&(n.codec==="vp9"&&(n.codec="vp8",D.debug("browser not support vp9, force use vp8")),Xn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),n.audioCodec===void 0&&(n.audioCodec="opus"),o.onSuccess(),new Qfe(lu(lu({forceWaitGatewayResponse:!0},n),{},{role:ot(e=["rtc","p2p"]).call(e,n.mode)?"host":n.role||"audience"}),i)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=re("CAMERA_CAPTURE_CONFIG"),i=or(8,"track-cam-"),o=wt.reportApiInvoke(null,{id:i,tag:Lr.TRACER,name:mi.CREATE_CAM_VIDEO_TRACK,options:[wr({},e),n]});n&&(e.encoderConfig=n);const c=kA(e);let u=null;D.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{u=(await Dc({video:c},i)).getVideoTracks()[0]||null}catch(m){throw o.onError(m),m}if(!u){const m=new Le(X.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(m),m.throw(D)}e.optimizationMode&&GL(i,u,e,lh(e.encoderConfig));const h=new zL(u,e,c,e.scalabiltyMode?IA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return o.onSuccess(h.getTrackId()),D.info("create camera video success, trackId:",i),h},createCustomVideoTrack:function(e){const n=or(8,"track-cus-"),i=wt.reportApiInvoke(null,{id:n,tag:Lr.TRACER,name:mi.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),o=new mr(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?IA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n,[ar.CUSTOM_TRACK]);return i.onSuccess(o.getTrackId()),D.info("create custom video track success with config",e,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const i=typeof n=="object"?function(A){return a8(A)}(n):void 0;i&&(n="auto");const o=or(8,"track-scr-v-"),c=wt.reportApiInvoke(null,{id:o,tag:Lr.TRACER,name:mi.CREATE_SCREEN_VIDEO_TRACK,options:[wr({},e),n]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const u=function(A){const k={};A.screenSourceType&&(k.mediaSource=A.screenSourceType),A.extensionId&&xp()&&(k.extensionId=A.extensionId);const{displaySurface:W,selfBrowserSurface:U,surfaceSwitching:V,systemAudio:q,preferCurrentTab:Y}=A;(XT(107)||oL(107)||aL(93))&&(W&&(Ci(W,"displaySurface",["browser","window","monitor"]),k.displaySurface=W),U?(Ci(U,"selfBrowserSurface",["exclude","include"]),k.selfBrowserSurface=U):k.selfBrowserSurface="include",V&&(Ci(V,"surfaceSwitching",["exclude","include"]),k.surfaceSwitching=V)),(XT(105)||oL(105)||aL(91))&&q&&(Ci(q,"systemAudio",["exclude","include"]),k.systemAudio=q),(XT(94)||oL(94)||aL(80))&&Y&&(k.preferCurrentTab=!0),A.electronScreenSourceId&&(k.sourceId=A.electronScreenSourceId);const ce=A.encoderConfig?NL(A.encoderConfig):null;return k.mandatory={chromeMediaSource:"desktop",maxWidth:ce?ce.width:void 0,maxHeight:ce?ce.height:void 0},ce&&(ce.frameRate&&(typeof ce.frameRate=="number"?(k.mandatory.maxFrameRate=ce.frameRate,k.mandatory.minFrameRate=ce.frameRate):(k.mandatory.maxFrameRate=ce.frameRate.max||ce.frameRate.ideal||ce.frameRate.exact||void 0,k.mandatory.minFrameRate=ce.frameRate.min||ce.frameRate.ideal||ce.frameRate.exact||void 0),k.frameRate=ce.frameRate),ce.width&&(k.width=ce.width),ce.height&&(k.height=ce.height)),k}(e);let h=null,m=null;const _=kn();if(!_.supportShareAudio&&n==="enable"){const A=new Le(X.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(A),A.throw(D)}D.info("start create screen video track with config",e,"withAudio",n,"trackId",o);const y=_.supportShareAudio&&n!=="disable";try{const A=await Dc({screen:u,screenAudio:y?i||!0:void 0},o);h=A.getVideoTracks()[0]||null,m=A.getAudioTracks()[0]||null}catch(A){throw c.onError(A),A}if(!h){const A=new Le(X.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(A),A.throw(D)}if(!m&&n==="enable"){h&&h.stop();const A=new Le(X.SHARE_AUDIO_NOT_ALLOWED);return c.onError(A),A.throw(D)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(GL(o,h,e,e.encoderConfig&&NL(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const S=new mr(h,e.encoderConfig?NL(e.encoderConfig):{},e.scalabiltyMode?IA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[ar.SCREEN_TRACK]);if(!m)return c.onSuccess(S.getTrackId()),D.info("create screen video track success","video:",S.getTrackId()),S;const w=new Br(m,void 0,or(8,"track-scr-a-"),!1);return c.onSuccess([S.getTrackId(),w.getTrackId()]),D.info("create screen video track success","video:",S.getTrackId(),"audio:",w.getTrackId()),[S,w]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=re("CAMERA_CAPTURE_CONFIG"),o=or(8,"track-mic-"),c=or(8,"track-cam-"),u=wt.reportApiInvoke(null,{id:"".concat(o,"-").concat(c),tag:Lr.TRACER,name:mi.CREATE_MIC_AND_CAM_TRACKS,options:[e,n,i]});i&&(n.encoderConfig=i);const h=kA(n),m=c8(e);let _=null,y=null;D.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(n)));try{const A=await Dc({audio:m,video:h},"".concat(o,"-").concat(c));_=A.getAudioTracks()[0],y=A.getVideoTracks()[0]}catch(A){throw u.onError(A),A}if(!_||!y){const A=new Le(X.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(A),A.throw(D)}n.optimizationMode&&GL(c,y,n,lh(n.encoderConfig));const S=new NA(_,e,m,o),w=new zL(y,n,h,n.scalabiltyMode?IA(n.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},n.optimizationMode,c);return u.onSuccess([S.getTrackId(),w.getTrackId()]),D.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[S,w]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=or(8,"track-mic-"),i=wt.reportApiInvoke(null,{id:n,tag:Lr.TRACER,name:mi.CREATE_MIC_AUDIO_TRACK,options:[e]}),o=c8(e);let c=null;D.info("start create microphone audio track with config",JSON.stringify(e),"trackId",n);try{c=(await Dc({audio:o},n)).getAudioTracks()[0]||null}catch(h){throw i.onError(h),h}if(!c){const h=new Le(X.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(h),h.throw(D)}const u=new NA(c,e,o,n);return i.onSuccess(u.getTrackId()),D.info("create microphone audio track success, trackId:",n),u},createCustomAudioTrack:function(e){const n=or(8,"track-cus-"),i=wt.reportApiInvoke(null,{id:n,tag:Lr.TRACER,name:mi.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),o=new Br(e.mediaStreamTrack,e.encoderConfig?AA(e.encoderConfig):{},n,!1);return D.info("create custom audio track success with config",e,"trackId",o.getTrackId()),i.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(e){var n;const{cacheOnlineFile:i,encoderConfig:o}=e;let{source:c}=e;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(n=File.name)!==null&&n!==void 0?n:"File":c,cacheOnlineFile:i,encoderConfig:o},h=or(8,"track-buf-"),m=wt.reportApiInvoke(null,{id:h,tag:Lr.TRACER,name:mi.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(re("DISABLE_WEBAUDIO"))throw new Le(X.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");D.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const _=c;if(!(c instanceof AudioBuffer))try{c=await async function(w,A){let k=null;if(typeof w=="string"){const U=q8.get(w);if(U)return D.debug("use cached audio resource: ",w),U;try{k=(await cd(()=>Wo.get(w,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(V){throw new Le(X.FETCH_AUDIO_FILE_FAILED,V.toString())}}else k=await new lt((V,q)=>{const Y=new FileReader;Y.onload=ce=>{ce.target?V(ce.target.result):q(new Le(X.READ_LOCAL_AUDIO_FILE_ERROR))},Y.onerror=()=>{q(new Le(X.READ_LOCAL_AUDIO_FILE_ERROR))},Y.readAsArrayBuffer(w)});const W=await function(U){const V=Cv();return new lt((q,Y)=>{V.decodeAudioData(U,ce=>{q(ce)},ce=>{Y(new Le(X.DECODE_AUDIO_FILE_FAILED,ce.toString()))})})}(k);return typeof w=="string"&&A&&q8.set(w,W),W}(c,i)}catch(w){return m.onError(w),w.throw(D)}const y=new Epe(c),S=new _pe(_,y,o?AA(o):{},h);return D.info("create buffer source audio track success, trackId:",h),m.onSuccess(S.getTrackId()),S},setAppType:function(e){if(D.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw D.debug("Invalid appType"),new Oe(X.INVALID_PARAMS,"invalid app type",e);Xn("APP_TYPE",Math.floor(e))},setLogLevel:function(e){D.setLogLevel(e)},enableLogUpload:function(){re("USE_NEW_LOG")?Xn("UPLOAD_LOG",!0):D.enableLogUpload()},disableLogUpload:function(){re("USE_NEW_LOG")?Xn("UPLOAD_LOG",!1):D.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new qG},checkAudioTrackIsActive:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=wt.reportApiInvoke(null,{tag:Lr.TRACER,name:mi.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[n]});if(!(e instanceof Br||e instanceof Pv)){const _=new Oe(X.INVALID_TRACK,"the parameter is not a audio track");return i.onError(_),_.throw()}n&&n<1e3&&(n=1e3);const o=e instanceof Br?e.getTrackLabel():"remote_track",c=e.getVolumeLevel();let u=c,h=c;const m=Date.now();return new lt(_=>{const y=setInterval(()=>{const S=e.getVolumeLevel();u=S>u?S:u,h=S<h?S:h;const w=u-h>1e-4,A=Date.now()-m;if(w||A>n){clearInterval(y);const k=w,W={duration:A,deviceLabel:o,maxVolumeLevel:u,result:k};D.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(W))),i.onSuccess(W),_(k)}},200)})},checkVideoTrackIsActive:async function(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=wt.reportApiInvoke(null,{tag:Lr.TRACER,name:mi.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[n]});if(!(e instanceof mr||e instanceof Av)){const w=new Oe(X.INVALID_TRACK,"the parameter is not a video track");return i.onError(w),w.throw()}n&&n<1e3&&(n=1e3);const o=e instanceof mr?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(gs()||gA())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,_=0;try{const w=Date.now();m=await function(A,k,W,U){let V,q=0,Y=null;return new lt((ce,_e)=>{function Ee(){q>U&&V&&(V(),ce(q));const me=W.getContext("2d");if(!me){const ut=new Oe(X.UNEXPECTED_ERROR,"can not get canvas 2d context.");return D.error(ut.toString()),void _e(ut)}me.drawImage(A,0,0,160,120);const ke=me.getImageData(0,0,W.width,W.height),Ye=Math.floor(ke.data.length/3);if(Y){for(let ut=0;ut<Ye;ut+=3)if(ke.data[ut]!==Y[ut])return q+=1,void(Y=ke.data);Y=ke.data}else Y=ke.data}setTimeout(()=>{V&&(V(),ce(q))},k),V=UL(()=>{Ee()},30)})}(u,n,h,4),_=Date.now()-w}catch(w){throw i.onError(w),w}Ufe===Mn.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const y=m>4,S={duration:_,changedPicNum:m,deviceLabel:o,result:y};return D.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(S))),i.onSuccess(S),y},setArea:mx,audioElementPlayCenter:zo,resumeAudioContext:function(){zo.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){eme.processExternalMediaAEC(e)},registerExtensions:function(e){const n=re("PLUGIN_INFO")||[];e.forEach(i=>{"name"in i&&!ot(n).call(n,i.name)&&n.push(i.name);const o=i;o.__registered__=!0,o.logger.hookLog=D.extLog,o.reporter.hookApiInvoke=wt.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(c=>{o.parameters[c]=re(c)})}),X7("PLUGIN_INFO",n)},ChannelMediaRelayError:Nv,ChannelMediaRelayEvent:Wp,ChannelMediaRelayState:va,RemoteStreamFallbackType:upe,RemoteStreamType:lpe,ConnectionDisconnectedReason:jn,AudienceLatencyLevelType:jhe,AREAS:Un,preload:async function(e,n,i,o){return S9(e,n,i,o)}});return Object.defineProperties(_i,{onAudioAutoplayFailed:{get:()=>xc.onAudioAutoplayFailed,set:e=>{xc.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>xc.onAutoplayFailed,set:e=>{xc.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>_i._onSecurityPolicyViolation,set(e){_i._onSecurityPolicyViolation=e,OH(e)}},__CLIENT_LIST__:{get:()=>re("SHOW_GLOBAL_CLIENT_LIST")?A_:[]}}),Lc.on(w_.CAMERA_DEVICE_CHANGED,e=>{D.info("camera device changed",JSON.stringify(e)),_i.onCameraChanged&&_i.onCameraChanged(e),_i.safeEmit(hh.CAMERA_CHANGED,e)}),Lc.on(w_.RECORDING_DEVICE_CHANGED,e=>{D.info("microphone device changed",JSON.stringify(e)),_i.onMicrophoneChanged&&_i.onMicrophoneChanged(e),_i.safeEmit(hh.MICROPHONE_CHANGED,e)}),Lc.on(w_.PLAYOUT_DEVICE_CHANGED,e=>{D.debug("playout device changed",JSON.stringify(e)),_i.onPlaybackDeviceChanged&&_i.onPlaybackDeviceChanged(e),_i.safeEmit(hh.PLAYBACK_DEVICE_CHANGED,e)}),zo.onAutoplayFailed=()=>{D.info("detect audio element autoplay failed"),xc.onAudioAutoplayFailed&&xc.onAudioAutoplayFailed()},Jn.on("autoplay-failed",()=>{D.info("detect webaudio autoplay failed"),xc.onAudioAutoplayFailed&&xc.onAudioAutoplayFailed(),_i.safeEmit(hh.AUTOPLAY_FAILED)}),Jn.on(ns.STATE_CHANGE,(e,n)=>{D.info("audio context state changed: ".concat(n," => ").concat(e)),_i.onAudioContextStateChanged&&_i.onAudioContextStateChanged(e,n),_i.safeEmit(hh.AUDIO_CONTEXT_STATE_CHANGED,e,n)}),oi.on(fv.NETWORK_STATE_CHANGE,(e,n)=>{D.info("[network-indicator] network state changed, ".concat(n," => ").concat(e))}),window&&(window.__ARTC__=_i),_i})}(XO)),XO.exports}var q5e=K5e();const SR=u0(q5e),Y5e={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_AGORA_APP_ID:"9442a472625f44e7b2c5065b9f9b3988",VITE_FIREBASE_API_KEY:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",VITE_FIREBASE_APP_ID:"1:294433070603:web:136cddd196eea9614fb10e",VITE_FIREBASE_AUTH_DOMAIN:"disruptive-metaverse.firebaseapp.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"294433070603",VITE_FIREBASE_PROJECT_ID:"disruptive-metaverse",VITE_FIREBASE_STORAGE_BUCKET:"disruptive-metaverse.appspot.com"},ose="9442a472625f44e7b2c5065b9f9b3988";console.log("AgoraProvider: DEFAULT_AGORA_APP_ID:",ose);console.log("AgoraProvider: import.meta.env:",Y5e);const X5e=SR.createClient({mode:"rtc",codec:"vp8"});let aw=null;const ase=L.createContext(null),cse=({children:r,appId:t=ose,channel:s=null,token:a=null,uid:l=null,enabled:d=!0,startMuted:f=!0,onClientReady:E=()=>{}})=>{console.log("AgoraProvider: appId prop:",t);const[v,T]=L.useState(!1),[R,I]=L.useState(!1),[N,F]=L.useState([]),[j,G]=L.useState(null),[H,te]=L.useState(null),[K,ee]=L.useState(null),[de,se]=L.useState(!1),[ge,Z]=L.useState(!1),[Q,ne]=L.useState(!1),[oe,pe]=L.useState(null),[he,le]=L.useState(!1),Me=Zh(),He=L.useRef(X5e),rt=L.useRef({appId:t,channel:s,uid:l,enabled:d}),we=L.useRef(!1),Ce=L.useRef(null);L.useRef(null),L.useEffect(()=>{rt.current={appId:t,channel:s,uid:l,enabled:d},console.log("AgoraProvider: Updated props ref:",{appId:t,channel:s,uid:l,enabled:d})},[t,s,l,d]),L.useEffect(()=>{console.log("AgoraProvider: Props changed:",{appId:t,channel:s,uid:l,enabled:d}),typeof window<"u"&&!window.agoraClient&&(window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:He.current},console.log("AgoraProvider: Initialized window.agoraClient"))},[t,s,l,d]),L.useEffect(()=>{console.log("AgoraProvider: Setting current channel:",s),te(s)},[s]),L.useEffect(()=>{if(!He.current)return;const nt=dt=>{console.log(`Connection state changed to: ${dt}`),dt==="DISCONNECTED"?(T(!1),console.log("Disconnected from Agora")):dt==="CONNECTED"&&(T(!0),G(null))};return He.current.on("connection-state-change",nt),()=>{He.current.off("connection-state-change",nt)}},[]),L.useEffect(()=>{if(!s||!d){console.log("AgoraProvider: Skipping initialization - channel or enabled is falsy",{channel:s,enabled:d});return}console.log("AgoraProvider: Initial setup for channel",s,"with UID",l);const nt=async(Ut,ln)=>{console.log("AgoraProvider: User published:",Ut.uid,ln);try{await He.current.subscribe(Ut,ln),console.log("AgoraProvider: Subscribed to user:",Ut.uid,"mediaType:",ln),ln==="audio"&&(Ut.audioTrack.play(),console.log("AgoraProvider: Playing audio track for user:",Ut.uid)),F(Ln=>Ln.some(qt=>qt.uid===Ut.uid)?Ln:[...Ln,Ut])}catch(Ln){console.error("AgoraProvider: Error subscribing to user:",Ln)}},dt=(Ut,ln)=>{console.log("AgoraProvider: User unpublished:",Ut.uid,ln),ln==="audio"&&Ut.audioTrack&&(Ut.audioTrack.stop(),console.log("AgoraProvider: Stopped audio track for user:",Ut.uid))},Xe=Ut=>{console.log("AgoraProvider: User joined:",Ut.uid),F(ln=>ln.some(Ln=>Ln.uid===Ut.uid)?ln:[...ln,Ut])},Ct=Ut=>{console.log("AgoraProvider: User left:",Ut.uid),F(ln=>ln.filter(Ln=>Ln.uid!==Ut.uid))};He.current.on("user-published",nt),He.current.on("user-unpublished",dt),He.current.on("user-joined",Xe),He.current.on("user-left",Ct);const dn=async()=>{if(we.current){console.log("AgoraProvider: Already initializing, skipping duplicate initialization");return}we.current=!0;try{if(v&&Ce.current===s){console.log("AgoraProvider: Already joined to channel",s),se(!0),E(He.current);return}if(He.current.connectionState==="CONNECTING"||He.current.connectionState==="CONNECTED")if(console.log("AgoraProvider: Client already in connecting/connected state:",He.current.connectionState),Ce.current&&Ce.current!==s){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Te()}catch(Ut){console.error("AgoraProvider: Error leaving channel:",Ut)}}else{console.log("AgoraProvider: Client already connected or connecting, setting joined state to true"),T(!0),se(!0),Ce.current=s,aw=s,E(He.current);return}console.log("AgoraProvider: Joining channel",s,"current joined channel:",Ce.current),await Ne(),console.log("AgoraProvider: Join channel completed")}catch(Ut){console.error("AgoraProvider: Error during initialization:",Ut)}finally{we.current=!1}};return console.log("AgoraProvider: Running initialization"),dn(),()=>{console.log("AgoraProvider: Cleaning up event listeners"),He.current.off("user-published",nt),He.current.off("user-unpublished",dt),He.current.off("user-joined",Xe),He.current.off("user-left",Ct)}},[s,d,l,E,v]);const ye=async()=>{if(!d||K)return K;console.log("Initializing microphone");try{const nt=await SR.createMicrophoneAudioTrack();return await nt.setMuted(f),ee(nt),console.log("Microphone initialized successfully"),nt}catch(nt){return console.error("Error initializing microphone:",nt),G("Failed to initialize microphone. Please check your permissions."),null}};L.useEffect(()=>{(async()=>{if(s)try{const Ct=await sg(s);Ct&&Ct.voiceDisabled?(console.log("AgoraProvider: Voice is disabled for this space"),le(!0),v&&await Te()):le(!1)}catch(Xe){console.error("AgoraProvider: Error checking if voice is disabled:",Xe)}})();const dt=Xe=>{Xe.detail&&typeof Xe.detail.voiceDisabled=="boolean"&&(console.log("AgoraProvider: Voice setting changed:",Xe.detail.voiceDisabled),le(Xe.detail.voiceDisabled),Xe.detail.voiceDisabled&&v?Te():!Xe.detail.voiceDisabled&&!v&&d&&s&&Ne())};return window.addEventListener("SpaceVoiceSettingChanged",dt),()=>{window.removeEventListener("SpaceVoiceSettingChanged",dt)}},[s,v,d]);const Ne=async()=>{if(!d)return console.log("AgoraProvider: Agora is disabled, not joining channel"),!1;if(he)return console.log("AgoraProvider: Voice is disabled for this space, not joining channel"),G("Voice chat is disabled for this space"),!1;if(!s)return console.error("AgoraProvider: No channel specified"),G("No channel specified"),!1;if(console.log("AgoraProvider: joinChannel called for channel",s,"with UID",l),console.log("AgoraProvider: Current state:",{isJoined:v,isJoining:ge,connectionState:He.current.connectionState,joinedChannel:Ce.current}),v&&Ce.current===s)return console.log("AgoraProvider: Already joined to channel:",s),!0;if(ge)return console.log("AgoraProvider: Already in the process of joining"),!1;if(He.current.connectionState==="CONNECTED")if(Ce.current&&Ce.current!==s){console.log("AgoraProvider: Connected to different channel, leaving first");try{await Te()}catch(nt){console.error("AgoraProvider: Error leaving channel:",nt)}}else return console.log("AgoraProvider: Client already connected, setting joined state to true"),T(!0),se(!0),Ce.current=s,aw=s,E(He.current),!0;if(He.current.connectionState==="CONNECTING")return console.log("AgoraProvider: Client already connecting, waiting for connection"),Z(!0),new Promise(nt=>{const dt=setInterval(()=>{He.current.connectionState==="CONNECTED"&&(clearInterval(dt),T(!0),Z(!1),se(!0),Ce.current=s,aw=s,E(He.current),nt(!0))},500);setTimeout(()=>{clearInterval(dt),console.log("AgoraProvider: Connection timeout, considering join failed"),Z(!1),nt(!1)},1e4)});try{if(console.log("AgoraProvider: Joining channel:",s,"with UID:",l||"random"),console.log("AgoraProvider: Using appId:",t,"Type:",typeof t,"Length:",t.length),!t||t.trim()===""){const dt="AgoraProvider: App ID is empty or invalid";return console.error(dt),G(dt),Z(!1),!1}Z(!0);const nt=l||Math.floor(Math.random()*1e6);return await He.current.join(t,s,a,nt),console.log("AgoraProvider: Joined channel successfully with UID:",He.current.uid),T(!0),Z(!1),se(!0),Ce.current=s,aw=s,E(He.current),!0}catch(nt){return console.error("AgoraProvider: Error joining channel:",nt),G(`Error joining channel: ${nt.toString()}`),Z(!1),!1}},Te=async()=>{if(v)try{K&&await He.current.unpublish(K),await He.current.leave(),aw=null,Ce.current=null,console.log("Left channel successfully"),T(!1),F([])}catch(nt){console.error("Error leaving channel:",nt),G(nt.message||"Failed to leave channel")}};L.useEffect(()=>()=>{K&&K.close()},[]),L.useEffect(()=>{d&&s&&(!v||Ce.current!==s)&&Ne()},[d,s,v]);const Se=()=>{if(!K)return!1;try{return K.isActive&&!K.muted}catch(nt){return console.error("Error checking microphone status:",nt),!1}};L.useEffect(()=>{const nt=()=>{const Xe=Se();Xe!==R&&(console.log("Syncing microphone state:",{actualStatus:Xe,currentState:R}),I(Xe),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:Xe}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Xe,window.agoraClient.microphoneTrack=K))};K&&nt();const dt=setInterval(nt,1e3);return()=>{clearInterval(dt)}},[K,R]);const Ae=async()=>{var nt;if(he)return console.log("AgoraProvider: Voice is disabled for this space, cannot toggle"),Me({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const dt=R!==void 0?R:K?!K.muted:!1;if(console.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:R,currentState:dt,hasMicTrack:!!K,trackMuted:K==null?void 0:K.muted}),!K&&(console.log("AgoraProvider: No microphone track, initializing..."),!await ye()))return console.error("AgoraProvider: Failed to initialize microphone"),dt;const Xe=!dt;if(console.log("AgoraProvider: New voice state will be:",Xe),dt){if(K)try{console.log("AgoraProvider: Muting microphone track"),await K.setMuted(!0),K.muted||(console.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await K.setEnabled(!1)),console.log("AgoraProvider: Microphone track muted successfully, muted state:",K.muted)}catch(Ct){return console.error("Error muting track:",Ct),dt}}else if(K)try{He.current&&v&&!((nt=He.current.localTracks)!=null&&nt.includes(K))&&(console.log("AgoraProvider: Publishing microphone track"),await He.current.publish(K),console.log("AgoraProvider: Microphone track published successfully")),console.log("AgoraProvider: Unmuting microphone track"),await K.setMuted(!1),K.muted&&(console.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await K.setEnabled(!0)),console.log("AgoraProvider: Microphone track unmuted successfully, muted state:",K.muted)}catch(Ct){return console.error("Error unmuting track:",Ct),dt}return I(Xe),Xe}catch(dt){return console.error("AgoraProvider: Error toggling voice:",dt),R}},Ue=async nt=>{try{ee(nt),console.log("Microphone track updated successfully")}catch(dt){throw console.error("Error updating microphone track:",dt),dt}},ze=async()=>{if(!He.current||!s)return console.error("AgoraProvider: Voice chat not connected"),!1;try{if(Q)return console.log("AgoraProvider: Stopping screen share"),oe&&(Array.isArray(oe)?(await He.current.unpublish(oe),oe.forEach(nt=>nt.close())):(await He.current.unpublish(oe),oe.close()),pe(null)),ne(!1),console.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;console.log("AgoraProvider: Starting screen share");try{const nt=await SR.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return console.log("AgoraProvider: Screen track created:",nt),nt.on("track-ended",()=>{console.log("AgoraProvider: Screen sharing ended by browser UI"),He.current.unpublish(nt),nt.close(),pe(null),ne(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await He.current.publish(nt),pe(nt),ne(!0),console.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=nt,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch(nt){return console.error("AgoraProvider: Error creating screen track:",nt),ne(!1),pe(null),!1}}catch(nt){return console.error("AgoraProvider: Error toggling screen share:",nt),ne(!1),pe(null),!1}};L.useEffect(()=>{if(console.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:He.current,isScreenSharing:!1,screenTrack:null};const nt=Xe=>{console.log("AgoraProvider: Received ToggleScreenShare event"),ze().then(Ct=>{Xe.detail&&Xe.detail.callback&&Xe.detail.callback(!0,Ct)}).catch(Ct=>{console.error("AgoraProvider: Error handling ToggleScreenShare event:",Ct),Xe.detail&&Xe.detail.callback&&Xe.detail.callback(!1,Q)})},dt=Xe=>{console.log("AgoraProvider: Received JoinVoiceChat event"),Ne().then(Ct=>{Xe.detail&&Xe.detail.callback&&Xe.detail.callback(Ct)}).catch(Ct=>{console.error("AgoraProvider: Error handling JoinVoiceChat event:",Ct),Xe.detail&&Xe.detail.callback&&Xe.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",nt),window.addEventListener("JoinVoiceChat",dt),()=>{window.removeEventListener("ToggleScreenShare",nt),window.removeEventListener("JoinVoiceChat",dt),typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&(console.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),L.useEffect(()=>{console.log("AgoraProvider: Voice enabled state changed:",R),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=R,window.agoraClient.microphoneTrack=K,window.agoraClient.client=He.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:R}})),console.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:R}))},[R,K]);const et={client:He.current,isJoined:v,isVoiceEnabled:R,users:N,error:j,channel:H,appId:t,toggleVoice:Ae,leaveChannel:Te,joinChannel:Ne,microphoneTrack:K,isReady:de,createMicrophoneTrack:Ue,isScreenSharing:Q,screenTrack:oe,toggleScreenShare:ze,voiceDisabled:he};return P.jsx(ase.Provider,{value:et,children:r})},lse=()=>{const r=L.useContext(ase);if(!r)throw new Error("useAgoraContext must be used within an AgoraProvider");return r};cse.propTypes={children:Ur.node.isRequired,appId:Ur.string.isRequired,channel:Ur.string.isRequired,token:Ur.string,uid:Ur.oneOfType([Ur.string,Ur.number])};const J5e=()=>{var we,Ce;const{client:r,isVoiceEnabled:t,isJoined:s,users:a,error:l,microphoneTrack:d,isReady:f,channel:E,appId:v,toggleVoice:T,joinChannel:R,leaveChannel:I,createMicrophoneTrack:N,isScreenSharing:F,screenTrack:j,toggleScreenShare:G,voiceDisabled:H}=lse(),[te,K]=L.useState(t!==void 0?t:((we=window.agoraClient)==null?void 0:we.isVoiceEnabled)||!1),[ee,de]=L.useState(F!==void 0?F:((Ce=window.agoraClient)==null?void 0:Ce.isScreenSharing)||!1),[se,ge]=L.useState(H!==void 0?H:!1),[Z,Q]=L.useState(!0);L.useEffect(()=>{var ye;t!==void 0?K(t):((ye=window.agoraClient)==null?void 0:ye.isVoiceEnabled)!==void 0?K(window.agoraClient.isVoiceEnabled):d&&K(!d.muted)},[t,d]),L.useEffect(()=>{var ye;F!==void 0?de(F):((ye=window.agoraClient)==null?void 0:ye.isScreenSharing)!==void 0&&de(window.agoraClient.isScreenSharing)},[F]),L.useEffect(()=>{H!==void 0&&ge(H)},[H]);const ne=L.useRef({isVoiceEnabled:te,isScreenSharing:ee,isJoined:s,users:a,error:l,isReady:f,channel:E,appId:v,voiceDisabled:se});L.useEffect(()=>{ne.current={isVoiceEnabled:te,isScreenSharing:ee,isJoined:s,users:a,error:l,isReady:f,channel:E,appId:v,voiceDisabled:se}},[te,ee,s,a,l,f,E,v,se]),L.useEffect(()=>{const ye=setTimeout(()=>{Q(!1)},5e3);return()=>clearTimeout(ye)},[]),L.useEffect(()=>{f&&Q(!1)},[f]),L.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:t,localVoiceEnabled:te,contextIsScreenSharing:F,localScreenSharing:ee,isJoined:s,users:a.length,error:l,isReady:f,channel:E,appId:v,hasMicrophoneTrack:!!d,trackMuted:d==null?void 0:d.muted,hasScreenTrack:!!j})},[t,te,F,ee,s,a,l,f,E,v,d,j]);const oe=async()=>{try{console.log("useVoiceChat: Toggling voice from:",te);const ye=await T();if(console.log("useVoiceChat: Toggle result:",ye),ye!==void 0)K(ye);else{const Ne=!te;K(Ne),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Ne)}return ye!==void 0?ye:!te}catch(ye){return console.error("useVoiceChat: Error toggling voice:",ye),te}},pe=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",ee);const ye=await G();if(console.log("useVoiceChat: Screen share toggle result:",ye),ye!==void 0)de(ye);else{const Ne=!ee;de(Ne),window.agoraClient&&(window.agoraClient.isScreenSharing=Ne)}return ye!==void 0?ye:!ee}catch(ye){return console.error("useVoiceChat: Error toggling screen share:",ye),ee}},he=async()=>{te&&d&&await oe()},le=async()=>{!te&&d&&await oe()},Me=ye=>a.some(Ne=>{var Te;return Ne.uid===ye&&((Te=Ne.audioTrack)==null?void 0:Te.isPlaying)}),He=L.useCallback(()=>{if(!d||!te)return 0;try{return d.getVolumeLevel()}catch(ye){return console.error("Error getting volume level:",ye),0}},[d,te]);return{isVoiceEnabled:te,isScreenSharing:ee,isJoined:s,users:a,error:l,toggleVoice:oe,toggleScreenShare:pe,mute:he,unmute:le,isUserSpeaking:Me,getVolumeLevel:He,microphoneTrack:d,screenTrack:j,isLoading:Z,channel:E,appId:v,joinChannel:R,leaveChannel:I,client:r,setMicrophoneDevice:async ye=>{try{if(!ye){console.error("No device ID provided");return}if(!r||!s){console.error("Client not initialized or not joined to a channel");return}d&&(te&&await r.unpublish(d),await d.close());const Ne=await SR.createMicrophoneAudioTrack({microphoneId:ye,encoderConfig:"music_standard"});N&&await N(Ne),te&&await r.publish(Ne),console.log("Microphone device changed successfully")}catch(Ne){throw console.error("Error changing microphone device:",Ne),Ne}},voiceDisabled:se}},Q5e=({size:r="md",tooltipPlacement:t="top",defaultMuted:s=!0,joinOnClick:a=!0,className:l="voice-button"})=>{const{isVoiceEnabled:d,toggleVoice:f,isJoined:E,joinChannel:v,channel:T,client:R,voiceDisabled:I}=J5e(),[N,F]=L.useState(!1),[j,G]=L.useState(!1);L.useEffect(()=>{const K=()=>{be.log("VoiceButton: Player instantiated, showing button"),G(!0)};return window.addEventListener("PlayerInstantiated",K),window.isPlayerInstantiated&&(be.log("VoiceButton: Player was already instantiated"),G(!0)),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]),L.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:d,isJoined:E,channel:T,hasClient:!!R,clientState:R==null?void 0:R.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:j,voiceDisabled:I})},[d,E,T,R,j,I]);const H=async()=>{if(!(N||I)){F(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:d,isJoined:E});try{if(!E&&a)try{console.log("VoiceButton: Not joined, attempting to join channel"),await v(),console.log("VoiceButton: Joined channel successfully")}catch(ee){ee.message&&ee.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",ee)}console.log("VoiceButton: Toggling voice state from:",d);const K=await f();console.log("VoiceButton: Voice toggled, new state:",K)}catch(K){console.error("VoiceButton: Error toggling voice:",K)}finally{F(!1)}}},te=()=>I?"Voice chat is disabled for this space":j?N?"Processing...":E?d?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!j||I?null:P.jsx(eg,{label:te(),placement:t,hasArrow:!0,children:P.jsxs(kt,{position:"relative",cursor:"pointer",onClick:H,children:[P.jsx(vf,{size:r,borderRadius:"full",bg:d?"green.500":"red.500",icon:d?P.jsx(dV,{color:"white"}):P.jsx(uV,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),N&&P.jsx(kt,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:P.jsx(Af,{size:"sm",color:"white"})})]})})},Z5e=ni.createContext({user:null}),e6e=({userNickname:r})=>{const{client:t,channel:s,screenTrack:a,isScreenSharing:l,toggleScreenShare:d}=lse(),[f,E]=L.useState([]),[v,T]=L.useState(!1),[R,I]=L.useState(!0);L.useRef({});const N=L.useRef(null);L.useRef(null);const{user:F}=L.useContext(Z5e)||{user:null},[j,G]=L.useState({}),H=L.useRef(a),[te,K]=L.useState(null),{isOpen:ee,onOpen:de,onClose:se}=ag(),[ge,Z]=L.useState(!1),Q=L.useRef(null),ne=L.useRef(null);L.useEffect(()=>{H.current=a},[a]),L.useEffect(()=>{if(!t||!s){T(!1);return}const Me=setTimeout(()=>{I(!1)},5e3);console.log("Setting up screen share display with existing client:",t),console.log("Current channel:",s);const He=t.connectionState;if(console.log("Current connection state:",He),He==="CONNECTED")T(!0),I(!1);else{T(!1);const rt=we=>{console.log("Connection state changed:",we),we==="CONNECTED"?(T(!0),I(!1)):T(!1)};return t.on("connection-state-change",rt),()=>{t.off("connection-state-change",rt),clearTimeout(Me)}}return()=>{clearTimeout(Me)}},[t,s]),L.useEffect(()=>{const Me=async()=>{const He={...j};let rt=!1;for(const we of f){if(j[we.uid])continue;let Ce=null,ye=we.uid;if(typeof ye=="string"&&(ye.includes("-")?(Ce=ye.split("-")[0],ye=ye.split("-")[1]):ye.includes("_")&&(Ce=ye.split("_")[0],ye=ye.split("_")[1])),ye)try{console.log("Trying to fetch nickname for user ID:",ye);const Ne=await Jh(ye);Ne&&Ne.Nickname?(console.log("Found nickname in Firebase for user ID:",ye,"Nickname:",Ne.Nickname),He[we.uid]=Ne.Nickname,rt=!0):Ce?(console.log("Using extracted name for user ID:",ye,"Name:",Ce),He[we.uid]=Ce,rt=!0):(He[we.uid]="User",rt=!0)}catch(Ne){console.error("Error fetching user profile:",Ne),Ce?(He[we.uid]=Ce,rt=!0):(He[we.uid]="User",rt=!0)}else Ce?(He[we.uid]=Ce,rt=!0):(He[we.uid]="User",rt=!0)}rt&&G(He)};f.length>0&&Me()},[f,j]),L.useEffect(()=>{if(!t||!s||!v)return;console.log("Setting up screen share event handlers");const Me=async(we,Ce)=>{if(console.log("User published:",we.uid,Ce,we),Ce==="video"){console.log("Remote video track detected:",we.uid);try{await t.subscribe(we,Ce),console.log("Subscribed to remote video track:",we.uid),E(ye=>ye.some(Ne=>Ne.uid===we.uid)?ye:[...ye,we])}catch(ye){console.error("Error subscribing to remote video track:",ye)}}},He=(we,Ce)=>{if(console.log("User unpublished:",we.uid,Ce),Ce==="video"){if(console.log("Remote video track unpublished:",we.uid),we.videoTrack)try{we.videoTrack.stop()}catch(ye){console.error("Error stopping video track:",ye)}if(E(ye=>ye.filter(Ne=>Ne.uid!==we.uid)),l&&H.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),H.current.play(N.current)}catch(ye){console.error("Error replaying local screen track:",ye)}}},rt=we=>{console.log("User left:",we.uid);const Ce=f.find(ye=>ye.uid===we.uid);if(Ce&&Ce.videoTrack)try{Ce.videoTrack.stop()}catch(ye){console.error("Error stopping video track:",ye)}if(E(ye=>ye.filter(Ne=>Ne.uid!==we.uid)),l&&H.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote user left"),H.current.play(N.current)}catch(ye){console.error("Error replaying local screen track:",ye)}};return t.on("user-published",Me),t.on("user-unpublished",He),t.on("user-left",rt),()=>{t.off("user-published",Me),t.off("user-unpublished",He),t.off("user-left",rt)}},[t,s,v,f,l]),L.useEffect(()=>{if(console.log("Remote screens changed:",f.length,f),f.forEach(Me=>{if(Me.videoTrack)try{console.log("Playing video track for:",Me.uid),Me.videoTrack.play(`video-container-${Me.uid}`)}catch(He){console.error("Error playing video track:",He)}}),l&&H.current&&N.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),H.current.play(N.current)}catch(Me){console.error("Error replaying local screen track:",Me)}},[f,l]),L.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,a),l&&a&&N.current)try{console.log("Playing local screen track"),a.play(N.current)}catch(Me){console.error("Error playing local screen track:",Me)}},[l,a]),L.useEffect(()=>()=>{if(f.forEach(Me=>{if(Me.videoTrack)try{Me.videoTrack.stop()}catch(He){console.error("Error stopping video track on unmount:",He)}}),a)try{a.stop()}catch(Me){console.error("Error stopping local screen track on unmount:",Me)}},[f,a]);const oe=()=>{console.log("Stopping local screen share"),d()},pe=Me=>(console.log("Getting display name for UID:",Me,"type:",typeof Me),l&&F&&(Me===F.uid||Me===(t==null?void 0:t.uid))?r||"You":j[Me]?j[Me]:typeof Me=="string"?Me.includes("-")?Me.split("-")[0]:Me.includes("_")?Me.split("_")[0]:Me:"User"),he=Me=>{console.log("Opening modal for remote screen",Me),K(Me),de()},le=()=>{console.log("Opening modal for local screen"),K({isLocal:!0}),de()};return L.useEffect(()=>{ee&&te?(console.log("Modal opened, activeScreen:",te),setTimeout(()=>{if(te.isLocal&&H.current)try{console.log("Playing local screen in modal"),H.current.play("modal-screen-container"),Z(!0)}catch(Me){console.error("Error playing local screen in modal:",Me)}else if(te.videoTrack)try{console.log("Playing remote screen in modal"),te.videoTrack.play("modal-screen-container"),Z(!0)}catch(Me){console.error("Error playing remote screen in modal:",Me)}},500)):ee||(Z(!1),K(null),setTimeout(()=>{if(l&&H.current)try{H.current.play("local-screen-container")}catch(Me){console.error("Error playing local screen in small container:",Me)}f.forEach(Me=>{if(Me.videoTrack)try{Me.videoTrack.play(`video-container-${Me.uid}`)}catch(He){console.error(`Error playing remote screen ${Me.uid} in small container:`,He)}})},500))},[ee,te,l,f]),!v||R&&f.length===0&&!l||f.length===0&&!l?null:P.jsxs(P.Fragment,{children:[!ee&&P.jsxs(kt,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:Q,children:[l&&a&&P.jsxs(kt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:le,children:[P.jsx(kt,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),P.jsx(kt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:r?`${r}'s Screen`:"Your Screen"})]}),f.map(Me=>{const He=j[Me.uid]||pe(Me.uid);return P.jsxs(kt,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>he(Me),children:[P.jsx(kt,{id:`video-container-${Me.uid}`,width:"100%",height:"100%",position:"relative"}),P.jsx(kt,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${He}'s Screen`})]},Me.uid)})]}),ee&&P.jsx(kt,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:se,children:P.jsxs(kt,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:Me=>Me.stopPropagation(),children:[!ge&&P.jsxs(kt,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[P.jsx(Af,{size:"xl"}),P.jsx(St,{mt:4,children:"Loading screen share..."})]}),P.jsx(kt,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:ne}),P.jsx(kt,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:se,children:""}),P.jsx(kt,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:te!=null&&te.isLocal?r?`${r}'s Screen`:"Your Screen":`${j[te==null?void 0:te.uid]||pe(te==null?void 0:te.uid)}'s Screen`}),(te==null?void 0:te.isLocal)&&P.jsx(kt,{position:"absolute",bottom:4,right:4,children:P.jsx(is,{colorScheme:"red",size:"sm",onClick:oe,children:"Stop Sharing"})})]})})]})},t6e=({onClose:r})=>{const t=Zh(),[s,a]=L.useState(!1),[l,d]=L.useState(!1);L.useEffect(()=>{const v=()=>{window.agoraClient&&d(!!window.agoraClient.isScreenSharing)};v();const T=setInterval(v,1e3),R=()=>{v()};return window.addEventListener("ScreenShareToggled",R),()=>{clearInterval(T),window.removeEventListener("ScreenShareToggled",R)}},[]);const f=async v=>{if(v.preventDefault(),v.stopPropagation(),r&&r(),!window.agoraClient||!window.agoraClient.client){t({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(a(!0),window.agoraClient.isJoined)E();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const T=new CustomEvent("JoinVoiceChat",{detail:{callback:R=>{if(!R){console.error("ScreenShareMenuOption: Failed to join voice chat"),t({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),a(!1);return}E()}}});window.dispatchEvent(T)}}catch(T){console.error("Error in screen share handler:",T),a(!1),t({title:"Screen sharing error",description:T.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},E=async()=>{try{const v=new CustomEvent("ToggleScreenShare",{detail:{callback:(T,R)=>{a(!1),T?(d(R),t(R?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):t({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(v)}catch(v){console.error("Error toggling screen share:",v),a(!1),t({title:"Screen sharing error",description:v.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return P.jsx(St,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:f,color:l?"red.300":"white",children:s?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function n6e({open:r,onClose:t}){const[s,a]=L.useState(0);return P.jsxs(tc,{isOpen:r,onClose:t,size:"md",isCentered:!0,children:[P.jsx(ic,{backdropFilter:"blur(4px)"}),P.jsxs(nc,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[P.jsx(Cu,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),P.jsx(Xc,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),P.jsx(rc,{p:0,display:"flex",children:P.jsxs(UR,{orientation:"vertical",variant:"unstyled",index:s,onChange:a,display:"flex",flexGrow:1,children:[P.jsxs(VR,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[P.jsxs(zc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[P.jsx(Wn,{as:O5e,mb:1}),P.jsx(St,{fontSize:"xs",children:"Movement"})]}),P.jsxs(zc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[P.jsx(Wn,{as:k5e,mb:1}),P.jsx(St,{fontSize:"xs",children:"Camera"})]}),P.jsxs(zc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[P.jsx(Wn,{as:A5e,mb:1}),P.jsx(St,{fontSize:"xs",children:"Actions"})]}),P.jsxs(zc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[P.jsx(Wn,{as:P5e,mb:1}),P.jsx(St,{fontSize:"xs",children:"Tips"})]})]}),P.jsxs(hN,{flexGrow:1,display:"flex",flexDirection:"column",children:[P.jsxs(yu,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[P.jsx(St,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),P.jsxs(Qo,{wrap:"wrap",gap:3,children:[P.jsx(Tl,{keyLabel:"W",description:"Move Forward"}),P.jsx(Tl,{keyLabel:"A",description:"Move Left"}),P.jsx(Tl,{keyLabel:"S",description:"Move Backward"}),P.jsx(Tl,{keyLabel:"D",description:"Move Right"}),P.jsx(Tl,{keyLabel:"Shift",description:"Run"}),P.jsx(Tl,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),P.jsxs(yu,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[P.jsx(St,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),P.jsxs(Qo,{wrap:"wrap",gap:3,children:[P.jsx(Tl,{keyLabel:"Mouse",description:"Look Around"}),P.jsx(Tl,{keyLabel:"Click + Drag",description:"Rotate Camera"}),P.jsx(Tl,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),P.jsxs(yu,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[P.jsx(St,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),P.jsxs(Qo,{wrap:"wrap",gap:3,children:[P.jsx(Tl,{keyLabel:"E",description:"Interact"}),P.jsx(Tl,{keyLabel:"F",description:"Emote Menu"}),P.jsx(Tl,{keyLabel:"T",description:"Chat"}),P.jsx(Tl,{keyLabel:"M",description:"Mute Mic"})]})]}),P.jsxs(yu,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[P.jsx(St,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),P.jsxs(ji,{align:"stretch",spacing:2,children:[P.jsx(St,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),P.jsx(St,{fontSize:"xs",children:" Press ESC to access settings"}),P.jsx(St,{fontSize:"xs",children:" Click on players to view their profile"}),P.jsx(St,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const Tl=({keyLabel:r,description:t})=>P.jsx(kt,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:P.jsxs(Ii,{spacing:2,children:[P.jsx(kt,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:r}),P.jsx(St,{fontSize:"xs",children:t})]})}),r6e=()=>{const[r,t]=L.useState([]),[s,a]=L.useState(""),[l,d]=L.useState(0),[f,E]=L.useState(100),[v,T]=L.useState(100),[R,I]=L.useState(!0),[N,F]=L.useState(!0),[j,G]=L.useState(!1);L.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const se=await SR.getMicrophones();t(se),se.length>0&&a(se[0].deviceId)}catch(se){console.error("Error getting audio devices:",se)}})()},[]),L.useEffect(()=>{const de=setInterval(()=>{d(j?Math.random()*50:0)},100);return()=>clearInterval(de)},[j]);const H=de=>{const se=de.target.value;a(se),console.log("Microphone changed to:",se)},te=de=>{E(de),console.log("Microphone volume set to:",de)},K=de=>{T(de),console.log("Speaker volume set to:",de)},ee=()=>{G(!j)};return P.jsxs(ji,{spacing:6,align:"stretch",children:[P.jsxs(rs,{children:[P.jsxs(Eu,{children:["Microphone",P.jsx(af,{ml:2,colorScheme:j?"green":"red",children:j?"Enabled":"Muted"})]}),P.jsxs(xte,{value:s,onChange:H,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[r.map(de=>P.jsx("option",{value:de.deviceId,children:de.label||`Microphone ${de.deviceId.slice(0,5)}...`},de.deviceId)),r.length===0&&P.jsx("option",{value:"",children:"No microphones found"})]})]}),P.jsxs(kt,{children:[P.jsx(St,{mb:2,children:"Microphone Level"}),P.jsx(t0,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),P.jsxs(rs,{children:[P.jsxs(Eu,{children:["Microphone Volume: ",f,"%"]}),P.jsxs(IU,{value:f,onChange:te,min:0,max:100,step:1,colorScheme:"blue",children:[P.jsx(PU,{bg:"gray.700",children:P.jsx(OU,{})}),P.jsx(AU,{boxSize:6})]})]}),P.jsxs(rs,{children:[P.jsxs(Eu,{children:["Speaker Volume: ",v,"%"]}),P.jsxs(IU,{value:v,onChange:K,min:0,max:100,step:1,colorScheme:"blue",children:[P.jsx(PU,{bg:"gray.700",children:P.jsx(OU,{})}),P.jsx(AU,{boxSize:6})]})]}),P.jsxs(rs,{display:"flex",alignItems:"center",children:[P.jsx(Eu,{mb:"0",children:"Microphone Enabled"}),P.jsx(Zm,{isChecked:j,onChange:ee,colorScheme:"green",size:"lg"})]}),P.jsxs(rs,{display:"flex",alignItems:"center",children:[P.jsx(Eu,{mb:"0",children:"Echo Cancellation"}),P.jsx(Zm,{isChecked:R,onChange:()=>I(!R),colorScheme:"green",size:"lg"})]}),P.jsxs(rs,{display:"flex",alignItems:"center",children:[P.jsx(Eu,{mb:"0",children:"Noise Suppression"}),P.jsx(Zm,{isChecked:N,onChange:()=>F(!N),colorScheme:"green",size:"lg"})]}),P.jsxs(qS,{status:"info",borderRadius:"md",children:[P.jsx(YS,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function i6e({open:r,onClose:t,containerRef:s}){return P.jsx(Au,{containerRef:s,children:P.jsxs(tc,{isOpen:r,onClose:t,size:"lg",isCentered:!0,children:[P.jsx(ic,{}),P.jsxs(nc,{bg:"gray.900",color:"white",borderRadius:"lg",children:[P.jsx(Cu,{children:"Settings"}),P.jsx(Xc,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),P.jsx(rc,{children:P.jsxs(UR,{variant:"enclosed",children:[P.jsxs(VR,{mb:4,children:[P.jsx(zc,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),P.jsx(zc,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),P.jsxs(hN,{children:[P.jsx(yu,{children:P.jsx(kt,{p:4,bg:"gray.800",borderRadius:"md",children:P.jsx(r6e,{})})}),P.jsx(yu,{children:P.jsx(kt,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}function s6e(r){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(r)}function o6e(r){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(r)}function jS(r){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(r)}function use(r){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(r)}function a6e(r){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(r)}function c6e(r){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(r)}function l6e(r){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(r)}function $w(r){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(r)}function pV(r){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(r)}function aJ(r){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(r)}function pO(r){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(r)}function u6e(r){return Vr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(r)}const d6e=({isOpen:r,onClose:t})=>{const{spaceID:s}=Jc(),[a,l]=L.useState(0),[d,f]=L.useState(""),[E,v]=L.useState(""),[T,R]=L.useState(!1),[I,N]=L.useState(null),[F,j]=L.useState(null),[G,H]=L.useState(!1),[te,K]=L.useState(0),[ee,de]=L.useState(null),se=L.useRef(null),[ge,Z]=L.useState(null),[Q,ne]=L.useState(null),[oe,pe]=L.useState(!1),[he,le]=L.useState(0),[Me,He]=L.useState(null),rt=L.useRef(null),[we,Ce]=L.useState([]),[ye,Ne]=L.useState([]),[Te,Se]=L.useState(!1),[Ae,Ue]=L.useState(!1),[ze,et]=L.useState(!0),[nt,dt]=L.useState(!1),Xe=Zh();L.useEffect(()=>{r&&s&&Ct()},[r,s]);const Ct=async()=>{try{const Ge=await sg(s);Ge.logoUrl&&de(Ge.logoUrl),Ge.backgroundUrl&&He(Ge.backgroundUrl),Ge.voiceDisabled!==void 0&&Ue(Ge.voiceDisabled),Ge.accessibleToAllUsers!==void 0&&et(Ge.accessibleToAllUsers),f(Ge.name||""),v(Ge.description||""),dn(Ge)}catch(Ge){be.error("Error fetching space data:",Ge),Xe({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}},dn=async Ge=>{if(s&&r){Se(!0);try{const Pt=rV(),Yt=`space_${s}_owners`,hn=RX(Lk(Pt,"users"),CX("groups","array-contains",Yt)),an=await Mk(hn),ir=[];for(const di of an.docs){const yi=di.data(),ur=await Jh(di.id);ir.push({uid:di.id,email:yi.email,displayName:yi.displayName||ur.Nickname||"Unknown User",photoURL:yi.photoURL||ur.photoURL,firstName:ur.firstName,lastName:ur.lastName})}Ce(ir);const na=`space_${s}_hosts`,Vt=RX(Lk(Pt,"users"),CX("groups","array-contains",na)),sn=await Mk(Vt),wi=[];for(const di of sn.docs){const yi=di.data(),ur=await Jh(di.id);wi.push({uid:di.id,email:yi.email,displayName:yi.displayName||ur.Nickname||"Unknown User",photoURL:yi.photoURL||ur.photoURL,firstName:ur.firstName,lastName:ur.lastName})}Ne(wi)}catch(Pt){be.error("Error fetching space users:",Pt),Xe({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{Se(!1)}}};L.useEffect(()=>{s&&r&&a===3&&dn()},[s,r,a]);const Ut=Ge=>{const Pt=Ge.target.files[0];if(Pt){if(!Pt.type.startsWith("image/")){Xe({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}N(Pt);const Yt=new FileReader;Yt.onloadend=()=>{j(Yt.result)},Yt.readAsDataURL(Pt)}},ln=Ge=>{const Pt=Ge.target.files[0];if(Pt){if(!Pt.type.startsWith("image/")){Xe({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}Z(Pt);const Yt=new FileReader;Yt.onloadend=()=>{ne(Yt.result)},Yt.readAsDataURL(Pt)}},Ln=async()=>{if(!I){Xe({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{H(!0);const Ge=setInterval(()=>{K(Yt=>{const hn=Yt+10;return hn>=90?90:hn})},300),Pt=await bBe(s,I);clearInterval(Ge),K(100),de(Pt),Xe({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{N(null),j(null),K(0),H(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:Pt}}))}catch(Ge){console.error("Error uploading logo:",Ge),Xe({title:"Upload failed",description:Ge.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),H(!1),K(0)}},qt=async()=>{if(!ge){Xe({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{pe(!0);const Ge=setInterval(()=>{le(Yt=>{const hn=Yt+10;return hn>=90?90:hn})},300),Pt=await RBe(s,ge);clearInterval(Ge),le(100),He(Pt),Xe({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{Z(null),ne(null),le(0),pe(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:Pt}}))}catch(Ge){console.error("Error uploading background:",Ge),Xe({title:"Upload failed",description:Ge.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),pe(!1),le(0)}},Yn=async()=>{if(ee)try{H(!0),await wBe(s),de(null),Xe({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),H(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(Ge){console.error("Error deleting logo:",Ge),Xe({title:"Deletion failed",description:Ge.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),H(!1)}},$t=async()=>{if(Me)try{pe(!0),await CBe(s),He(null),Xe({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),pe(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(Ge){console.error("Error deleting background:",Ge),Xe({title:"Deletion failed",description:Ge.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),pe(!1)}},Re=()=>{se.current&&se.current.click()},Fe=()=>{rt.current&&rt.current.click()},Ke=async()=>{dt(!0);try{await IBe(s,{voiceDisabled:!Ae}),Ue(!Ae),Xe({title:"Settings Updated",description:`Voice chat has been ${Ae?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(Ge){be.error("Error updating voice settings:",Ge),Xe({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{dt(!1)}},_t=async()=>{dt(!0);try{await ABe(s,!ze),et(!ze),Xe({title:"Settings Updated",description:`Space is now ${ze?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(Ge){be.error("Error updating accessibility settings:",Ge),Xe({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{dt(!1)}},yt=async()=>{if(s){R(!0);try{const Ge=rV(),Pt=ta(Ge,"spaces",s);await Ad(Pt,{name:d,description:E}),Xe({title:"Success",description:"Space details updated successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceDetailsUpdated",{detail:{name:d,description:E}}))}catch(Ge){be.error("Error updating space details:",Ge),Xe({title:"Error",description:"Failed to update space details",status:"error",duration:3e3,isClosable:!0})}finally{R(!1)}}};return P.jsxs(tc,{isOpen:r,onClose:t,size:"lg",isCentered:!0,children:[P.jsx(ic,{backdropFilter:"blur(4px)"}),P.jsxs(nc,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"800px",h:"500px",overflow:"hidden",children:[P.jsx(Cu,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Manage Space"}),P.jsx(Xc,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),P.jsx(rc,{p:0,display:"flex",children:P.jsxs(UR,{orientation:"vertical",variant:"unstyled",index:a,onChange:l,display:"flex",flexGrow:1,children:[P.jsxs(VR,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[P.jsxs(zc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[P.jsx(Wn,{as:use,mb:1}),P.jsx(St,{fontSize:"xs",children:"Details"})]}),P.jsxs(zc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[P.jsx(Wn,{as:jS,mb:1}),P.jsx(St,{fontSize:"xs",children:"Logo"})]}),P.jsxs(zc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[P.jsx(Wn,{as:o6e,mb:1}),P.jsx(St,{fontSize:"xs",children:"Background"})]}),P.jsxs(zc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[P.jsx(Wn,{as:c6e,mb:1}),P.jsx(St,{fontSize:"xs",children:"Settings"})]}),P.jsxs(zc,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[P.jsx(Wn,{as:aJ,mb:1}),P.jsx(St,{fontSize:"xs",children:"Users"})]})]}),P.jsxs(hN,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",children:[P.jsxs(yu,{p:4,display:"flex",flexDirection:"column",children:[P.jsx(St,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Details"}),P.jsx(St,{fontSize:"xs",mb:4,children:"Edit the name and description of your space."}),P.jsxs(ji,{spacing:4,align:"stretch",children:[P.jsxs(rs,{children:[P.jsx(Eu,{fontSize:"xs",children:"Space Name"}),P.jsx(To,{value:d,onChange:Ge=>f(Ge.target.value),placeholder:"Enter space name",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white"})]}),P.jsxs(rs,{children:[P.jsx(Eu,{fontSize:"xs",children:"Description"}),P.jsx(jte,{value:E,onChange:Ge=>v(Ge.target.value),placeholder:"Enter space description",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},rows:5,resize:"vertical"}),P.jsx(OO,{fontSize:"xs",color:"whiteAlpha.700",children:"Provide a clear description of your space for users."})]}),P.jsx(is,{colorScheme:"blue",size:"sm",onClick:yt,isLoading:T,loadingText:"Saving...",alignSelf:"flex-start",mt:2,children:"Save Details"})]})]}),P.jsxs(yu,{p:4,display:"flex",flexDirection:"column",children:[P.jsx(St,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Logo"}),P.jsx(St,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(ee||F)&&P.jsxs(Qo,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[ee&&P.jsxs(kt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[P.jsx(St,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),P.jsx(xh,{src:ee,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),P.jsx(is,{mt:3,colorScheme:"red",leftIcon:P.jsx(Wn,{as:$w}),onClick:Yn,isLoading:G,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),F&&P.jsxs(kt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[P.jsx(St,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),P.jsx(xh,{src:F,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),P.jsxs(rs,{children:[P.jsx(Eu,{fontSize:"xs",children:"Upload New Logo"}),P.jsx(To,{type:"file",accept:"image/*",onChange:Ut,ref:se,display:"none"}),G&&P.jsxs(kt,{mt:3,mb:3,children:[P.jsxs(St,{fontSize:"xs",mb:1,children:["Uploading... ",te,"%"]}),P.jsx(t0,{value:te,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),P.jsxs(Ii,{mt:3,spacing:3,children:[P.jsx(is,{colorScheme:"blue",leftIcon:P.jsx(Wn,{as:jS}),onClick:Re,isDisabled:G,size:"sm",variant:"outline",children:"Browse"}),P.jsx(is,{colorScheme:"green",leftIcon:P.jsx(Wn,{as:pV}),onClick:Ln,isLoading:G,loadingText:"Uploading...",isDisabled:!I||G,size:"sm",children:"Upload"})]}),P.jsx(OO,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),P.jsxs(yu,{p:4,display:"flex",flexDirection:"column",children:[P.jsx(St,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Loading Background"}),P.jsx(St,{fontSize:"xs",mb:4,children:"Upload a background image for your space. This will be displayed during loading."}),(Me||Q)&&P.jsxs(Qo,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[Me&&P.jsxs(kt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[P.jsx(St,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),P.jsx(xh,{src:Me,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),P.jsx(is,{mt:3,colorScheme:"red",leftIcon:P.jsx(Wn,{as:$w}),onClick:$t,isLoading:oe,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),Q&&P.jsxs(kt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[P.jsx(St,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),P.jsx(xh,{src:Q,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),P.jsxs(rs,{children:[P.jsx(Eu,{fontSize:"xs",children:"Upload New Background"}),P.jsx(To,{type:"file",accept:"image/*",onChange:ln,ref:rt,display:"none"}),oe&&P.jsxs(kt,{mt:3,mb:3,children:[P.jsxs(St,{fontSize:"xs",mb:1,children:["Uploading... ",he,"%"]}),P.jsx(t0,{value:he,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),P.jsxs(Ii,{mt:3,spacing:3,children:[P.jsx(is,{colorScheme:"blue",leftIcon:P.jsx(Wn,{as:jS}),onClick:Fe,isDisabled:oe,size:"sm",variant:"outline",children:"Browse"}),P.jsx(is,{colorScheme:"green",leftIcon:P.jsx(Wn,{as:pV}),onClick:qt,isLoading:oe,loadingText:"Uploading...",isDisabled:!ge||oe,size:"sm",children:"Upload"})]}),P.jsx(OO,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),P.jsxs(yu,{p:4,display:"flex",flexDirection:"column",children:[P.jsx(St,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Settings"}),P.jsx(St,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),P.jsxs(ji,{spacing:4,align:"stretch",children:[P.jsx(kt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:P.jsxs(Ii,{justify:"space-between",align:"center",children:[P.jsxs(kt,{children:[P.jsxs(Ii,{mb:1,spacing:2,children:[P.jsxs(kt,{position:"relative",w:"16px",h:"16px",children:[P.jsx(Wn,{as:u6e,color:Ae?"red.400":"green.400"}),Ae&&P.jsx(kt,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),P.jsx(St,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),P.jsx(St,{fontSize:"xs",color:"whiteAlpha.800",children:Ae?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),P.jsx(Zm,{isChecked:!Ae,onChange:Ke,colorScheme:"green",size:"md",isDisabled:nt})]})}),P.jsx(kt,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:P.jsxs(Ii,{justify:"space-between",align:"center",children:[P.jsxs(kt,{children:[P.jsxs(Ii,{mb:1,spacing:2,children:[P.jsx(kt,{position:"relative",w:"16px",h:"16px",children:P.jsx(Wn,{as:aJ,color:ze?"green.400":"red.400"})}),P.jsx(St,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),P.jsx(St,{fontSize:"xs",color:"whiteAlpha.800",children:ze?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),P.jsx(St,{fontSize:"xs",color:"blue.300",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),P.jsx(Zm,{isChecked:ze,onChange:_t,colorScheme:"green",size:"md",isDisabled:nt})]})}),P.jsxs(qS,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[P.jsx(YS,{color:"blue.300"}),P.jsxs(kt,{children:[P.jsx(lk,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),P.jsx(uk,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),P.jsxs(yu,{p:4,display:"flex",flexDirection:"column",children:[P.jsx(St,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Manage Users"}),P.jsx(St,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),Te?P.jsx(Qo,{justify:"center",align:"center",h:"200px",children:P.jsx(Af,{color:"blue.300"})}):P.jsxs(ji,{spacing:4,align:"stretch",children:[P.jsxs(kt,{children:[P.jsxs(Ii,{mb:2,children:[P.jsx(Wn,{as:s6e,color:"green.400"}),P.jsx(St,{fontSize:"sm",fontWeight:"600",children:"Owners"}),P.jsx(af,{colorScheme:"green",ml:2,children:we.length})]}),P.jsx(kt,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:we.length===0?P.jsx(St,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):P.jsx(ji,{spacing:1,align:"stretch",children:we.map(Ge=>P.jsxs(Ii,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[P.jsx(vf,{size:"xs",src:Ge.photoURL,name:Ge.displayName}),P.jsxs(kt,{children:[P.jsx(St,{fontSize:"xs",children:Ge.displayName}),P.jsx(St,{fontSize:"xs",color:"whiteAlpha.600",children:Ge.firstName&&Ge.lastName?`${Ge.firstName} ${Ge.lastName}`:"Full name not available"})]}),P.jsx(pk,{}),P.jsx(af,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},Ge.uid))})})]}),P.jsxs(kt,{children:[P.jsxs(Ii,{mb:2,children:[P.jsx(Wn,{as:l6e,color:"purple.400"}),P.jsx(St,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),P.jsx(af,{colorScheme:"purple",ml:2,children:ye.length})]}),P.jsx(kt,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:ye.length===0?P.jsx(St,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):P.jsx(ji,{spacing:1,align:"stretch",children:ye.map(Ge=>P.jsxs(Ii,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[P.jsx(vf,{size:"xs",src:Ge.photoURL,name:Ge.displayName}),P.jsxs(kt,{children:[P.jsx(St,{fontSize:"xs",children:Ge.displayName}),P.jsx(St,{fontSize:"xs",color:"whiteAlpha.600",children:Ge.firstName&&Ge.lastName?`${Ge.firstName} ${Ge.lastName}`:"Full name not available"})]}),P.jsx(pk,{}),P.jsx(af,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},Ge.uid))})})]}),P.jsx(dE,{borderColor:"whiteAlpha.200"}),P.jsxs(qS,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",py:2,fontSize:"xs",children:[P.jsx(YS,{color:"blue.300",boxSize:4}),P.jsxs(kt,{children:[P.jsx(lk,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),P.jsx(uk,{fontSize:"xs",children:"User management features like adding/removing hosts and owners will be available in a future update."})]})]})]})]})]})]})})]})]})},h6e=({onTogglePlayerList:r,spaceID:t})=>{const{fullscreenRef:s}=Pd(),[a,l]=L.useState(!0),[d,f]=L.useState(!1),[E,v]=L.useState(!1),[T,R]=L.useState(!1),[I,N]=L.useState(!1),[F,j]=L.useState(!1),[G,H]=L.useState(null),[te,K]=L.useState(!1),[ee,de]=L.useState(!1),[se,ge]=L.useState(!1),[Z,Q]=L.useState(!1),ne=Zh(),{user:oe}=L.useContext(Pu),pe=(oe==null?void 0:oe.Nickname)||"Unknown",[he,le]=L.useState(!1),Me=async()=>{if(oe!=null&&oe.uid&&t)try{const Se=await Jh(oe.uid);let Ae=!1,Ue=!1;if(Se.groups){const et=`space_${t}_owners`,nt=`space_${t}_hosts`;Ae=Se.groups.includes(et),Ue=Se.groups.includes(nt)}const ze=await yie(oe.uid,"disruptiveAdmin");if(Q(ze),H({rpmURL:Se.rpmURL?Se.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}),de(Ae||ze),ge(Ue),!Ae&&!ze&&te){K(!1);const et=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(et),ne({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(Se){console.error("Error fetching profile data:",Se),de(!1),ge(!1),Q(!1)}else de(!1),ge(!1),Q(!1)};L.useEffect(()=>{Me()},[oe==null?void 0:oe.uid,t,te]),L.useEffect(()=>{const Se=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",Se),()=>{window.removeEventListener("PlayerInstantiated",Se)}},[]),L.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&le(window.agoraClient.voiceDisabled)}catch(Ue){console.error("Error checking if voice is disabled:",Ue)}})();const Ae=Ue=>{Ue.detail&&typeof Ue.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",Ue.detail.voiceDisabled),le(Ue.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",Ae),()=>{window.removeEventListener("SpaceVoiceSettingChanged",Ae)}},[]);const He=()=>v(!E),rt=()=>R(!T),we=()=>{j(!F),Ne()},Ce=()=>{N(!1),Me()},ye=Se=>{Se.stopPropagation(),typeof r=="function"&&(be.log("CanvasMainMenu: Toggling player list"),r())},Ne=()=>{f(!1)},Te=Se=>{if(Se.stopPropagation(),!ee){ne({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const Ae=!te;K(Ae);const Ue=new CustomEvent("editModeChanged",{detail:{enabled:Ae}});window.dispatchEvent(Ue),ne({title:Ae?"Edit Mode Enabled":"Edit Mode Disabled",description:Ae?"You can now make changes to the scene.":"Scene editing is now disabled.",status:Ae?"info":"success",duration:3e3,isClosable:!0,position:"top"})};return P.jsxs(P.Fragment,{children:[P.jsxs(HF,{isOpen:d,onClose:()=>f(!1),children:[P.jsx($F,{as:Pa,icon:P.jsx(y5e,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:d?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:d?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>f(!d)}),P.jsx(Au,{containerRef:s,children:P.jsx(KF,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:P.jsxs(ji,{align:"stretch",spacing:4,children:[P.jsxs(Ii,{children:[P.jsx(vf,{size:"md",src:G==null?void 0:G.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),P.jsxs(ji,{align:"start",spacing:0,children:[P.jsxs(Ii,{children:[P.jsx(St,{fontWeight:"bold",children:pe}),ee&&!Z&&P.jsx(eg,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:P.jsx(kt,{display:"inline-block",children:P.jsx(Wn,{as:lV,color:"green.400",boxSize:3})})}),!ee&&se&&!Z&&P.jsx(eg,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:P.jsx(kt,{display:"inline-block",children:P.jsx(Wn,{as:hV,color:"purple.400",boxSize:3})})}),Z&&P.jsx(eg,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:s},children:P.jsx(kt,{display:"inline-block",children:P.jsx(Wn,{as:D5e,color:"blue.400",boxSize:3})})})]}),P.jsx(St,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),P.jsxs(Ii,{spacing:4,justify:"center",children:[P.jsx(Pa,{icon:P.jsx(x5e,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:ye}),ee&&P.jsx(Pa,{icon:P.jsx(C5e,{}),variant:"ghost",colorScheme:te?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:Te}),P.jsx(Pa,{icon:P.jsx(kt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"}}),P.jsx(Pa,{icon:P.jsx(kt,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),P.jsx(dE,{borderColor:"whiteAlpha.300"}),P.jsxs(ji,{align:"stretch",spacing:2,children:[ee&&P.jsxs(Ii,{p:2,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},onClick:Se=>Se.stopPropagation(),justify:"space-between",children:[P.jsx(St,{fontSize:"md",children:"Edit Mode"}),P.jsx(Zm,{id:"edit-mode-toggle",isChecked:te,onChange:Te,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:te?"green.500":"black"}}})]}),ee&&P.jsx(St,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:we,children:"Manage Space"}),oe&&t&&!he&&P.jsx(t6e,{onClose:Ne}),P.jsx(St,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:He,children:"Settings"}),P.jsx(St,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:rt,children:"Controls"}),P.jsx(St,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",children:"Help"}),P.jsx(St,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),T&&P.jsx(n6e,{open:T,onClose:rt}),E&&P.jsx(i6e,{open:E,onClose:He}),I&&P.jsx(rse,{open:I,onClose:Ce}),P.jsx(d6e,{isOpen:F,onClose:we})]})},p6e=({isOpen:r,onClose:t,mediaScreenId:s,onImageChange:a})=>{const{spaceID:l}=Jc(),d=wg(),f=Zh(),E=L.useRef(null),v=L.useRef(null),T=L.useRef(),[R,I]=L.useState(null),[N,F]=L.useState(""),[j,G]=L.useState(!1),[H,te]=L.useState(0),[K,ee]=L.useState(null),[de,se]=L.useState(!0),[ge,Z]=L.useState(!1),[Q,ne]=L.useState(!1),[oe,pe]=L.useState(0),[he,le]=L.useState("image"),[Me,He]=L.useState(""),[rt,we]=L.useState(!1);L.useEffect(()=>{(async()=>{if(r&&s&&l){se(!0);try{const Ct=await df(l,s);if(Ct&&(Ct.imageUrl||Ct.videoUrl)){ee(Ct);const dn=Ct.mediaType==="video";le(dn?"video":"image"),we(Ct.displayAsVideo||!1),dn&&Ct.videoUrl&&(He(Ct.videoUrl),pe(1))}else ee(null)}catch(Ct){be.error("Error fetching existing image:",Ct),ee(null)}finally{se(!1)}}})()},[r,s,l]),L.useEffect(()=>{r||(I(null),F(""),te(0),He(""))},[r]);const Ce=L.useCallback(Xe=>{Xe.preventDefault(),Xe.stopPropagation(),ne(!0)},[]),ye=L.useCallback(Xe=>{Xe.preventDefault(),Xe.stopPropagation(),ne(!1)},[]),Ne=L.useCallback(Xe=>{Xe.preventDefault(),Xe.stopPropagation()},[]),Te=L.useCallback(Xe=>{if(Xe.preventDefault(),Xe.stopPropagation(),ne(!1),Xe.dataTransfer.files&&Xe.dataTransfer.files.length>0){const Ct=Xe.dataTransfer.files[0];Se(Ct)}},[]);L.useEffect(()=>{const Xe=v.current;if(Xe)return Xe.addEventListener("dragenter",Ce),Xe.addEventListener("dragleave",ye),Xe.addEventListener("dragover",Ne),Xe.addEventListener("drop",Te),()=>{Xe.removeEventListener("dragenter",Ce),Xe.removeEventListener("dragleave",ye),Xe.removeEventListener("dragover",Ne),Xe.removeEventListener("drop",Te)}},[Ce,ye,Ne,Te]);const Se=Xe=>{if(!Xe)return;if(!Xe.type.startsWith("image/")){f({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}I(Xe);const Ct=new FileReader;Ct.onloadend=()=>{F(Ct.result)},Ct.readAsDataURL(Xe)},Ae=Xe=>{const Ct=Xe.target.files[0];Se(Ct)},Ue=async Xe=>{const Ct=Xe.target.checked;if(we(Ct),K)try{await KBe(l,s,Ct),Ct?d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!0}):d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:K.imageUrl||null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!1}),ee({...K,displayAsVideo:Ct}),f({title:"Display mode updated",description:`The media screen will now be displayed as ${Ct?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),be.log(`Updated display mode for media screen ${s} to ${Ct?"video":"image"}`),a&&a({type:"update",mediaScreenId:s,displayAsVideo:Ct})}catch(dn){be.error("Error updating display mode:",dn),f({title:"Update failed",description:dn.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),we(!Ct)}},ze=async()=>{if(he==="image"&&!R){f({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(he==="video"&&!Me){f({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{G(!0);const Xe=setInterval(()=>{te(ln=>{const Ln=ln+10;return Ln>=90?90:Ln})},300);let Ct;he==="image"?Ct=await $X(l,s,R,{mediaType:he,displayAsVideo:rt}):(Ct=Me,await $X(l,s,null,{mediaType:"video",directUrl:Me,displayAsVideo:rt})),clearInterval(Xe),te(100);let dn=null,Ut=null;he==="image"?(dn=rt?null:Ct,Ut=(K==null?void 0:K.videoUrl)||null):(dn=!rt&&(K!=null&&K.imageUrl)?K.imageUrl:null,Ut=Ct),d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:dn,videoUrl:Ut,mediaType:he,displayAsVideo:rt}),be.log(`Uploaded and sent ${he} for media screen ${s} (display as video: ${rt})`),a&&a({type:"upload",mediaScreenId:s,imageUrl:he==="image"?Ct:K==null?void 0:K.imageUrl,videoUrl:he==="video"?Ct:K==null?void 0:K.videoUrl,mediaType:he,displayAsVideo:rt}),f({title:"Upload successful",description:`The ${he} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{I(null),F(""),G(!1),te(0),t()},1e3)}catch(Xe){be.error(`Error uploading ${he}:`,Xe),f({title:"Upload failed",description:Xe.message||`An error occurred while uploading the ${he}`,status:"error",duration:5e3,isClosable:!0}),G(!1),te(0)}},et=async()=>{Z(!1);try{G(!0),await $Be(l,s),d("SetMediaScreenImage",{mediaScreenId:s,imageUrl:he==="image"?null:(K==null?void 0:K.imageUrl)||null,videoUrl:he==="video"?null:(K==null?void 0:K.videoUrl)||null,mediaType:null,displayAsVideo:!1}),be.log(`Deleted ${he} for media screen ${s}`),a&&a({type:"delete",mediaScreenId:s}),f({title:`${he==="image"?"Image":"Video"} deleted`,description:`The ${he} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),ee(null),G(!1),He(""),we(!1),setTimeout(()=>{t()},500)}catch(Xe){be.error(`Error deleting ${he}:`,Xe),f({title:"Deletion failed",description:Xe.message||`An error occurred while deleting the ${he}`,status:"error",duration:5e3,isClosable:!0}),G(!1)}},nt=()=>{j||(I(null),F(""),te(0),t())},dt=Xe=>{pe(Xe),le(Xe===0?"image":"video")};return P.jsxs(P.Fragment,{children:[P.jsxs(tc,{isOpen:r,onClose:nt,size:"xl",children:[P.jsx(ic,{backdropFilter:"blur(10px)"}),P.jsxs(nc,{bg:"gray.800",color:"white",maxW:"900px",children:[P.jsx(Cu,{children:"Media Screen Content"}),P.jsx(Xc,{isDisabled:j}),P.jsxs(kt,{px:6,pb:2,children:[P.jsxs(Qo,{justify:"space-between",align:"center",bg:"gray.700",p:4,borderRadius:"md",mb:4,children:[P.jsxs(Ii,{spacing:4,children:[P.jsx(St,{fontWeight:"medium",children:"Display as:"}),P.jsxs(Ii,{spacing:2,children:[P.jsx(Wn,{as:jS,color:rt?"gray.400":"green.300"}),P.jsx(Zm,{colorScheme:"purple",size:"md",isChecked:rt,onChange:Ue}),P.jsx(Wn,{as:pO,color:rt?"purple.300":"gray.400"})]})]}),P.jsx(af,{colorScheme:rt?"purple":"green",fontSize:"sm",px:2,py:1,borderRadius:"md",children:rt?"Video Output":"Image Output"})]}),P.jsxs(St,{fontSize:"sm",color:"gray.400",mb:1,children:["Media Screen ID: ",P.jsx("strong",{children:s})]}),P.jsx(St,{fontSize:"xs",color:"gray.500",mb:2,children:"The toggle above controls how the content will be displayed in the 3D space, regardless of the content type you upload."}),P.jsx(dE,{mb:4})]}),P.jsx(rc,{children:P.jsxs(Qo,{children:[P.jsx(UR,{orientation:"vertical",variant:"solid-rounded",colorScheme:"blue",index:oe,onChange:dt,h:"100%",minW:"120px",mr:4,children:P.jsxs(VR,{children:[P.jsxs(zc,{_selected:{color:"white",bg:"blue.500"},mb:2,py:6,justifyContent:"flex-start",children:[P.jsx(Wn,{as:jS,mr:2})," Image"]}),P.jsxs(zc,{_selected:{color:"white",bg:"blue.500"},py:6,justifyContent:"flex-start",children:[P.jsx(Wn,{as:pO,mr:2})," Video"]})]})}),P.jsx(kt,{flex:"1",children:de?P.jsx(Qo,{justify:"center",align:"center",h:"150px",children:P.jsx(Af,{size:"xl",color:"blue.400"})}):P.jsxs(P.Fragment,{children:[P.jsx(kt,{children:oe===0?P.jsxs(ji,{spacing:4,align:"stretch",children:[K&&K.imageUrl&&he==="image"&&P.jsxs(kt,{children:[P.jsx(St,{fontWeight:"semibold",mb:2,children:"Current Image:"}),P.jsxs(Qo,{children:[P.jsx(kt,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:P.jsx(xh,{src:K.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),P.jsxs(ji,{align:"flex-start",spacing:2,children:[P.jsxs(St,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date(K.uploadedAt).toLocaleString()]}),P.jsxs(St,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),P.jsx(is,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:P.jsx(Wn,{as:$w}),onClick:()=>Z(!0),isDisabled:j,children:"Delete"})]})]}),P.jsx(dE,{my:4})]}),P.jsx(St,{fontWeight:"semibold",mb:2,children:K&&K.imageUrl&&he==="image"?"Replace with new image:":"Upload new image:"}),P.jsxs(kt,{ref:v,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:Q?"blue.400":"gray.500",bg:Q?"blue.900":"gray.700",p:6,textAlign:"center",transition:"all 0.2s",_hover:{borderColor:"blue.400",bg:"gray.600"},cursor:"pointer",onClick:()=>E.current.click(),children:[N?P.jsx(kt,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:P.jsx(xh,{src:N,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):P.jsxs(ji,{spacing:2,children:[P.jsx(Wn,{as:pV,boxSize:"24px",color:"gray.400"}),P.jsx(St,{children:"Drag and drop an image here, or click to browse"}),P.jsx(St,{fontSize:"xs",color:"gray.400",children:"Supports PNG, JPG, JPEG, GIF"})]}),P.jsx(To,{type:"file",accept:"image/*",onChange:Ae,ref:E,display:"none"})]}),R&&P.jsxs(St,{fontSize:"sm",children:["Selected file: ",R.name," (",Math.round(R.size/1024)," KB)"]})]}):P.jsxs(ji,{spacing:4,align:"stretch",children:[K&&K.videoUrl&&he==="video"&&P.jsxs(kt,{children:[P.jsx(St,{fontWeight:"semibold",mb:2,children:"Current Video URL:"}),P.jsxs(Qo,{children:[P.jsx(kt,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:P.jsx(St,{fontSize:"sm",wordBreak:"break-all",children:K.videoUrl})}),P.jsxs(ji,{align:"flex-start",spacing:2,children:[P.jsxs(St,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date(K.uploadedAt).toLocaleString()]}),P.jsxs(St,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),P.jsx(is,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:P.jsx(Wn,{as:$w}),onClick:()=>Z(!0),isDisabled:j,children:"Delete"})]})]}),P.jsx(dE,{my:4})]}),P.jsx(St,{fontWeight:"semibold",mb:2,children:K&&K.videoUrl&&he==="video"?"Replace with new video:":"Add video URL:"}),P.jsx(kt,{p:3,bg:"blue.900",borderRadius:"md",mb:4,borderLeftWidth:"4px",borderLeftColor:"blue.400",children:P.jsxs(Ii,{children:[P.jsx(Wn,{as:use,color:"blue.300"}),P.jsx(St,{fontSize:"sm",fontWeight:"medium",children:'After entering a URL, click the "Save Video URL" button at the bottom to save your changes.'})]})}),P.jsxs(rs,{children:[P.jsx(Eu,{fontSize:"sm",children:"Video URL"}),P.jsx(To,{placeholder:"Enter video URL (YouTube, Vimeo, etc.)",value:Me,onChange:Xe=>He(Xe.target.value),bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"blue.400"},_focus:{borderColor:"blue.400",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},size:"lg"}),P.jsx(St,{fontSize:"xs",color:"gray.400",mt:1,children:"Enter a URL from YouTube, Vimeo, or other video hosting services"})]}),P.jsxs(kt,{mt:4,p:4,bg:"gray.700",borderRadius:"md",children:[P.jsxs(Ii,{children:[P.jsx(Wn,{as:pO,color:"blue.300"}),P.jsx(St,{fontWeight:"medium",children:"Video Support"})]}),P.jsx(St,{fontSize:"sm",mt:2,color:"gray.300",children:"Video playback will be implemented in a future update. For now, you can add the URL which will be stored with the media screen."}),P.jsx(St,{fontSize:"sm",mt:2,color:"yellow.300",fontWeight:"medium",children:'Important: Click the "Upload" button at the bottom to save your video URL.'})]}),Me&&P.jsxs(kt,{mt:4,p:4,bg:"gray.900",borderRadius:"md",borderWidth:"1px",borderColor:"blue.500",children:[P.jsxs(Ii,{mb:2,children:[P.jsx(Wn,{as:a6e,color:"blue.300"}),P.jsx(St,{fontWeight:"medium",children:"URL Preview"})]}),P.jsx(St,{fontSize:"sm",wordBreak:"break-all",color:"gray.300",children:Me}),P.jsx(St,{fontSize:"xs",color:"gray.400",mt:2,children:"This URL will be saved when you click the Upload button below"})]})]})}),j&&P.jsxs(kt,{mt:4,children:[P.jsxs(St,{mb:2,children:["Uploading: ",H,"%"]}),P.jsx(t0,{value:H,colorScheme:"blue",size:"sm",borderRadius:"md"})]})]})})]})}),P.jsxs(SE,{children:[P.jsx(is,{variant:"ghost",mr:3,onClick:nt,isDisabled:j,children:"Cancel"}),P.jsx(is,{colorScheme:"blue",onClick:ze,isLoading:j,loadingText:"Uploading",isDisabled:he==="image"&&!R||he==="video"&&!Me||j||de,leftIcon:P.jsx(Wn,{as:he==="image"?jS:pO}),size:"lg",px:6,children:he==="image"?"Upload Image":"Save Video URL"})]})]})]}),P.jsx(nxe,{isOpen:ge,leastDestructiveRef:T,onClose:()=>Z(!1),children:P.jsx(ic,{children:P.jsxs(rxe,{bg:"gray.800",color:"white",children:[P.jsxs(Cu,{fontSize:"lg",fontWeight:"bold",children:["Delete ",he==="video"?"Video":"Image"]}),P.jsxs(rc,{children:["Are you sure you want to delete this ",he,"? This will revert the media screen to its blank state."]}),P.jsxs(SE,{children:[P.jsx(is,{ref:T,onClick:()=>Z(!1),children:"Cancel"}),P.jsx(is,{colorScheme:"red",onClick:et,ml:3,leftIcon:P.jsx(Wn,{as:$w}),children:"Delete"})]})]})})})]})},f6e=r=>{const[t,s]=L.useState(null),[a,l]=L.useState(""),[d,f]=L.useState(null),[E,v]=L.useState(!1),T=kf(),{spaceID:R}=Jc(),I=L.useCallback(j=>{var G,H;try{if(!j)return null;if(j.includes("youtube.com")||j.includes("youtu.be")){let te="";return j.includes("youtube.com/watch")?te=new URLSearchParams(new URL(j).search).get("v"):j.includes("youtu.be/")&&(te=j.split("youtu.be/")[1].split("?")[0]),te?`https://www.youtube.com/embed/${te}?autoplay=1`:j}if(j.includes("vimeo.com")){if(j.includes("player.vimeo.com/video"))return j;const te=(H=(G=j.split("vimeo.com/")[1])==null?void 0:G.split("?")[0])==null?void 0:H.split("/")[0];return te?`https://player.vimeo.com/video/${te}?autoplay=1`:j}return j}catch(te){return be.error("Error converting to embed URL:",te),j}},[]),N=L.useCallback(()=>{setTimeout(()=>{v(!1),be.log("Video processing state reset")},100)},[]);L.useEffect(()=>{let j=!0,G=null;const te=T("PlayMediaScreenVideo",async K=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",K,"isEditMode:",r),console.log("PlayMediaScreenVideo event received:",K);const{mediaScreenId:ee,videoUrl:de}=K||{};if(!ee){be.error("Media screen ID is missing in Unity event data."),N();return}if(r){console.log(`[DEBUG] Edit mode is active for screen ${ee}, setting ID but not playing video`),be.log("Edit mode is active, setting media screen ID but not playing video"),f(ee);return}if(v(!0),G=setTimeout(()=>{j&&(be.warn("Video processing timeout reached, resetting state"),v(!1))},5e3),de){if(console.log(`Using direct video URL from event: ${de}`),j)try{const se=I(de);console.log(`Setting video URL to: ${se} (original: ${de})`),s(se),l(`Media Screen ${ee}`),f(ee),be.log("Media screen video URL set directly from event:",se)}catch(se){be.error("Error setting video URL from direct URL:",se)}finally{N(),clearTimeout(G)}return}console.log(`Fetching media screen data for ID: ${ee}`);try{const se=await df(R,ee);if(console.log("Media screen data from Firestore:",se),!se||!se.videoUrl){be.error("No video URL found for media screen:",ee),N(),clearTimeout(G);return}if(!se.displayAsVideo){be.log("Media screen is not set to display as video:",ee),console.log("displayAsVideo flag is false for this media screen"),N(),clearTimeout(G);return}if(j)try{const ge=I(se.videoUrl);console.log(`Setting video URL to: ${ge} (original: ${se.videoUrl})`),s(ge),l(se.title||`Media Screen ${ee}`),f(ee),be.log("Media screen video URL set to:",ge)}catch(ge){be.error("Error setting video URL from Firestore:",ge)}finally{N(),clearTimeout(G)}}catch(se){be.error(`Error fetching media screen data for ${ee}:`,se),N(),clearTimeout(G)}}catch(ee){be.error("Error handling media screen video play:",ee),console.error("Error handling media screen video play:",ee),N(),clearTimeout(G)}});return()=>{j=!1,G&&clearTimeout(G),te()}},[T,R,r,I,N]);const F=L.useCallback(()=>{s(null),l(""),f(null),v(!1),be.log("Video player state reset")},[]);return[t,a,d,F,E]},m6e=()=>{const{spaceID:r}=Jc(),t=wg(),s=kf(),[a,l]=L.useState(!1);L.useEffect(()=>{if(window.isPlayerInstantiated){be.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const T=()=>{be.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",T),()=>{window.removeEventListener("PlayerInstantiated",T)}},[]);const d=L.useCallback(async T=>{try{return T.includes("vimeo.com")?await f(T):T.includes("youtube.com")||T.includes("youtu.be")?await E(T):"https://via.placeholder.com/640x360?text=Video"}catch(R){return be.error(`Error fetching thumbnail for ${T}:`,R),"https://via.placeholder.com/640x360?text=Error"}},[]),f=async T=>{try{const R=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(T)}`,I=await fetch(R);if(!I.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${I.statusText}`);const N=await I.json(),F=N.thumbnail_url.replace(/_\d+x\d+/,""),j=["640x360","295x166"];let G=null;for(let H of j){const te=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${F}_${H}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(te,{method:"HEAD"})).ok){G=te;break}}catch(K){be.warn(`Failed to validate thumbnail URL: ${te}`,K)}}return G||N.thumbnail_url}catch(R){return be.error(`Error fetching Vimeo thumbnail: ${R.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},E=async T=>{let R="";if(T.includes("youtube.com/watch")?R=new URLSearchParams(new URL(T).search).get("v"):T.includes("youtu.be/")&&(R=T.split("youtu.be/")[1].split("?")[0]),!R)throw new Error("Could not extract YouTube video ID");const I=`https://img.youtube.com/vi/${R}/maxresdefault.jpg`;try{if((await fetch(I,{method:"HEAD"})).ok)return I}catch(N){be.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${R}`,N)}return`https://img.youtube.com/vi/${R}/hqdefault.jpg`},v=L.useCallback(async T=>{try{if(!r||!T)return;be.log(`Refreshing thumbnail for media screen ${T}`);const R=await df(r,T);if(!R){be.log(`No media screen found with ID ${T}`);return}if(be.log("Media screen data:",R),!R.displayAsVideo||!R.videoUrl){be.log(`Media screen ${T} is not set to display as video or has no video URL`);return}const I=await d(R.videoUrl);t("SetMediaScreenThumbnail",{mediaScreenId:T,thumbnailUrl:I}),be.log(`Sent refreshed thumbnail for media screen ${T}: ${I}`)}catch(R){be.error(`Error refreshing thumbnail for media screen ${T}:`,R)}},[r,d,t]);L.useEffect(()=>{if(!a){be.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}be.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const R=s("SetMediaScreenThumbnail",async I=>{try{const{mediaScreenId:N,thumbnailUrl:F}=I;F==="refresh"&&N&&(console.log(`Received request to refresh thumbnail for media screen ${N}`),await v(N))}catch(N){console.error("Error handling SetMediaScreenThumbnail event:",N)}});return()=>{R()}},[s,v,a]),L.useEffect(()=>{if(!a){be.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}be.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const T=async()=>{try{if(!r)throw new Error("spaceID is not defined.");be.log("Fetching media screens for thumbnails...");const I=await Xj(r);be.log("All media screens:",I);const N=I.filter(G=>G.displayAsVideo&&G.videoUrl);if(be.log("Media screens set to display as videos:",N),N.length===0){be.log("No media screens set to display as videos found.");return}be.log(`Found ${N.length} media screens set to display as videos.`);const F=N.map(async G=>{try{const H=await d(G.videoUrl);return be.log(`Fetched thumbnail for ${G.id}: ${H}`),{mediaScreenId:G.id,thumbnailUrl:H}}catch(H){return be.error(`Error processing thumbnail for media screen ${G.id}:`,H),{mediaScreenId:G.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),j=await Promise.all(F);be.log("Fetched Media Screen Thumbnails",j),j.forEach(({mediaScreenId:G,thumbnailUrl:H})=>{t("SetMediaScreenThumbnail",{mediaScreenId:G,thumbnailUrl:H}),be.log(`Sent thumbnail to Unity for media screen ${G}: ${H}`)})}catch(I){be.error("Error fetching media screen thumbnails:",I)}};T();const R=setInterval(T,5*60*1e3);return()=>{clearInterval(R)}},[t,r,d,a])},cJ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},g6e=()=>P.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),_6e=({videoUrl:r,videoTitle:t,mediaScreenId:s,isOpen:a,onClose:l})=>{const{fullscreenRef:d}=Pd();return UN(a,`video-modal-${s}`),L.useEffect(()=>{if(a){const f=T=>{T.target.classList&&T.target.classList.contains("chakra-modal__overlay")&&(T.stopPropagation(),T.preventDefault())};document.addEventListener("mousemove",f,!0),document.addEventListener("mousedown",f,!0),document.addEventListener("mouseup",f,!0),document.addEventListener("click",f,!0),document.addEventListener("wheel",f,!0);const E=document.getElementById("unity-canvas"),v=document.getElementById("unity-container");if(E&&(E.style.pointerEvents="none"),v&&(v.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(T){console.error("Error disabling Unity input:",T)}return()=>{if(document.removeEventListener("mousemove",f,!0),document.removeEventListener("mousedown",f,!0),document.removeEventListener("mouseup",f,!0),document.removeEventListener("click",f,!0),document.removeEventListener("wheel",f,!0),E&&(E.style.pointerEvents="auto"),v&&(v.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(T){console.error("Error re-enabling Unity input:",T)}}}},[a]),P.jsxs(P.Fragment,{children:[P.jsx(g6e,{}),P.jsxs(tc,{isOpen:a,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:d},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${s}`,children:[P.jsx(ic,{bg:"rgba(0, 0, 0, 0.8)",onClick:f=>{f.target===f.currentTarget&&(l(),f.stopPropagation(),f.preventDefault())},onMouseMove:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseDown:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseUp:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onWheel:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},style:{pointerEvents:"auto"}}),P.jsxs(nc,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[P.jsx(Xc,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),P.jsx(rc,{p:0,width:"100%",children:r?P.jsx(kt,{className:"iframe-container",style:cJ.iframeContainer,children:P.jsx("iframe",{className:"video-iframe",src:r,style:cJ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:t||"Video Player"})}):P.jsxs(Qo,{direction:"column",align:"center",justify:"center",h:"400px",children:[P.jsx(Af,{size:"xl",mb:4}),P.jsx(St,{children:"Unable to load video"}),P.jsx(St,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},Os=(...r)=>{},E6e=()=>{const{isOpen:r,onOpen:t,onClose:s}=ag(),[a,l]=L.useState(null),[d,f]=L.useState("image"),E=L.useRef(null);UN(r,"image-viewer-modal");const v=L.useCallback(I=>{I.stopPropagation()},[]);return L.useEffect(()=>{if(r&&E.current){const I=E.current;I.addEventListener("mousemove",v),I.addEventListener("mousedown",v),I.addEventListener("mouseup",v),I.addEventListener("wheel",v);const N=document.getElementById("unity-canvas");return N&&(N.style.pointerEvents="none"),()=>{I.removeEventListener("mousemove",v),I.removeEventListener("mousedown",v),I.removeEventListener("mouseup",v),I.removeEventListener("wheel",v),N&&(N.style.pointerEvents="auto")}}},[r,v]),{isOpen:r,currentImageUrl:a,currentMediaType:d,openImageViewer:(I,N="image")=>{console.log(`[DEBUG] Opening image viewer with URL: ${I} and original media type: ${N}`);const F=typeof I=="string"&&(I.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||I.includes("firebasestorage")&&!I.includes("video")),j=F?"image":N;console.log(`[DEBUG] Detected URL as ${F?"image":"non-image"}, using media type: ${j}`),l(I),f(j),t()},closeImageViewer:()=>{s(),setTimeout(()=>{l(null),f("image")},300)},modalContentRef:E,preventPropagation:v}},y6e=()=>P.jsx("style",{dangerouslySetInnerHTML:{__html:`
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        .image-viewer-modal-content {
          pointer-events: auto !important;
        }
        
        .chakra-modal__overlay {
          pointer-events: auto !important;
        }
      `}}),N2=r=>{if(!r)return null;try{if(r.includes("firebasestorage.googleapis.com")){const t=new URL(r),s=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",s&&t.searchParams.set("alt",s),a&&t.searchParams.set("token",a),Os(`Cleaned Firebase URL from ${r} to ${t.toString()}`),t.toString()}return r}catch(t){return console.error("Error cleaning Firebase URL:",t),r}},v6e=()=>{const{spaceID:r}=Jc(),[t,s]=L.useState(!1),[a,l]=L.useState([]),[d,f]=L.useState(null),{isOpen:E,onOpen:v,onClose:T}=ag(),[R,I]=L.useState({}),[N,F]=L.useState(0);L.useRef(null);const j=wg(),{fullscreenRef:G}=Pd(),H=kf(),[te,K]=L.useState(!1),{isOpen:ee,currentImageUrl:de,currentMediaType:se,openImageViewer:ge,closeImageViewer:Z,modalContentRef:Q,preventPropagation:ne}=E6e(),[oe,pe,he,le,Me]=f6e(t),{isOpen:He,onOpen:rt,onClose:we}=ag();m6e(),Wie(),L.useEffect(()=>{if(window.isPlayerInstantiated){K(!0);return}const Se=()=>{K(!0)};return window.addEventListener("PlayerInstantiated",Se),()=>{window.removeEventListener("PlayerInstantiated",Se)}},[]);const Ce=L.useCallback(Se=>{if(Array.isArray(a)&&a.length>0){const Ae=a.find(Ue=>Ue.mediaScreenId===Se);if(Ae){const Ue=Ae.imageUrl,ze=Ae.videoUrl;return{screen:Ae,imageUrl:Ue,videoUrl:ze,mediaType:Ae.mediaType||"image",displayAsVideo:Ae.displayAsVideo||!1}}}else console.warn("mediaScreens is not an array or is empty:",a);if(de){let Ae=null;return Array.isArray(a)&&(Ae=a.find(Ue=>Ue.mediaScreenId===Se)),{screen:Ae||{mediaScreenId:Se},imageUrl:de,videoUrl:null,mediaType:(Ae==null?void 0:Ae.mediaType)||"image",displayAsVideo:(Ae==null?void 0:Ae.displayAsVideo)||!1}}return r&&Se&&df(r,Se).then(Ae=>{Ae&&l(Ue=>Array.isArray(Ue)&&Ue.some(et=>et.mediaScreenId===Se)?Ue.map(et=>et.mediaScreenId===Se?{...et,imageUrl:Ae.imageUrl,videoUrl:Ae.videoUrl,mediaType:Ae.mediaType||"image",displayAsVideo:Ae.displayAsVideo||!1,hasImage:!!Ae.imageUrl,source:"firestore-fetch",lastUpdated:new Date().toISOString()}:et):[...Array.isArray(Ue)?Ue:[],{mediaScreenId:Se,imageUrl:Ae.imageUrl,videoUrl:Ae.videoUrl,mediaType:Ae.mediaType||"image",displayAsVideo:Ae.displayAsVideo||!1,hasImage:!!Ae.imageUrl,source:"firestore-fetch",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}).catch(Ae=>{console.error(`Error fetching media screen data for ${Se}:`,Ae)}),console.warn("No screen data found for:",Se),null},[a,de,r,l]),ye=L.useCallback(Se=>{if(console.log(`[DEBUG] Processing click on screen: ${Se}, isEditMode: ${t}`),f(Se),t)console.log(`[DEBUG] Opening upload modal for screen: ${Se} in edit mode`),v();else{const Ae=Ce(Se);if(Ae){if(console.log(`[DEBUG] Screen data for ${Se}:`,Ae),Os("Screen data details:",{mediaScreenId:Se,imageUrl:Ae.imageUrl,videoUrl:Ae.videoUrl,mediaType:Ae.mediaType,displayAsVideo:Ae.displayAsVideo}),He&&he===Se)return;if(Ae.displayAsVideo&&Ae.videoUrl)Os(`Opening video player for: ${Ae.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:Se,videoUrl:Ae.videoUrl});else if(Ae.imageUrl){Os(`Opening viewer modal with ${Ae.mediaType}: ${Ae.imageUrl}`);const ze=N2(Ae.imageUrl);ge(ze,Ae.mediaType||"image")}else r&&df(r,Se).then(ze=>{if(ze){if(ze.displayAsVideo&&ze.videoUrl)Os(`Opening video player for: ${ze.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:Se,videoUrl:ze.videoUrl});else if(ze.imageUrl){Os(`Opening viewer modal with image: ${ze.imageUrl}`);const et=N2(ze.imageUrl);ge(et,ze.mediaType||"image")}l(et=>Array.isArray(et)&&et.some(dt=>dt.mediaScreenId===Se)?et.map(dt=>dt.mediaScreenId===Se?{...dt,...ze,mediaScreenId:Se,source:"firestore-click",lastUpdated:new Date().toISOString()}:dt):[...Array.isArray(et)?et:[],{...ze,mediaScreenId:Se,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(ze=>{console.error(`Error fetching media screen data for ${Se}:`,ze)})}else r&&df(r,Se).then(Ue=>{if(Ue){if(Ue.displayAsVideo&&Ue.videoUrl)Os(`Opening video player for: ${Ue.videoUrl}`),j("PlayMediaScreenVideo",{mediaScreenId:Se,videoUrl:Ue.videoUrl});else if(Ue.imageUrl){Os(`Opening viewer modal with image: ${Ue.imageUrl}`);const ze=N2(Ue.imageUrl);ge(ze,Ue.mediaType||"image")}l(ze=>Array.isArray(ze)&&ze.some(nt=>nt.mediaScreenId===Se)?ze.map(nt=>nt.mediaScreenId===Se?{...nt,...Ue,mediaScreenId:Se,source:"firestore-click",lastUpdated:new Date().toISOString()}:nt):[...Array.isArray(ze)?ze:[],{...Ue,mediaScreenId:Se,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(Ue=>{console.error(`Error fetching media screen data for ${Se}:`,Ue)})}},[t,v,Ce,He,he,j,ge,r]);L.useEffect(()=>{if(!te)return;const Se=async()=>{if(r)try{const Ue=await Xj(r),ze={};Ue.forEach(et=>{et.id&&et.imageUrl&&(ze[et.id]=et.imageUrl)}),l(et=>et.map(nt=>{const dt=!!ze[nt.mediaScreenId],Xe=ze[nt.mediaScreenId],Ct=nt.mediaType||"image";return{...nt,hasImage:dt,imageUrl:Xe,mediaType:Ct}}))}catch(Ue){console.error("Error fetching media screen images:",Ue)}};Se();let Ae=null;return t&&(Ae=setInterval(Se,5e3)),()=>{Ae&&clearInterval(Ae)}},[r,t,N,te]);const Ne=Se=>{l(Ae=>Ae.map(Ue=>{if(Ue.mediaScreenId===Se.mediaScreenId){if(Se.type==="upload")return{...Ue,hasImage:!0,imageUrl:Se.imageUrl,mediaType:Se.mediaType||"image"};if(Se.type==="delete")return{...Ue,hasImage:!1,imageUrl:null,mediaType:null}}return Ue})),Se.type==="delete"?(setTimeout(()=>{l(Ae=>Ae.filter(Ue=>Ue.mediaScreenId!==Se.mediaScreenId))},100),setTimeout(()=>{l(Ae=>Ae.filter(Ue=>Ue.mediaScreenId!==Se.mediaScreenId))},1500)):setTimeout(()=>{l(Ae=>Ae.some(ze=>ze.mediaScreenId===Se.mediaScreenId)?Ae.map(ze=>ze.mediaScreenId===Se.mediaScreenId?{...ze,imageUrl:Se.imageUrl,hasImage:!0,mediaType:Se.mediaType||"image"}:ze):[...Ae,{mediaScreenId:Se.mediaScreenId,imageUrl:Se.imageUrl,hasImage:!0,mediaType:Se.mediaType||"image",source:"delayed-update",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},1e3)};L.useEffect(()=>{const Se=Ae=>{const Ue=Ae.detail.enabled;s(Ue),Ue?j("SetMediaScreenEditMode",{enabled:!0,showUploadIcon:!0}):j("SetMediaScreenEditMode",{enabled:!1,showUploadIcon:!1})};return window.addEventListener("editModeChanged",Se),()=>{window.removeEventListener("editModeChanged",Se)}},[j]),L.useEffect(()=>(window.JsSendMediaScreenClick=function(Se){console.log("Unity: MediaScreenClick received with data:",Se);try{const Ae=JSON.parse(Se),Ue=new CustomEvent("MediaScreenClick",{detail:JSON.stringify(Ae)});window.dispatchEvent(Ue)}catch(Ae){console.error("Error processing MediaScreenClick data:",Ae)}},window.handleMediaScreenClick=function(Se){console.log("Direct call to handleMediaScreenClick with ID:",Se),ye(Se)},window.TestJavaScriptFromUnity=function(Se){console.log("Unity called TestJavaScriptFromUnity with:",Se),alert("Unity called JavaScript: "+Se)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[ye]),L.useEffect(()=>{const Se=ze=>{try{const et=JSON.parse(ze.detail);be.log(`MediaScreen registered: ${et.mediaScreenId}`),Os("MediaScreen registered from Unity:",et),l(dt=>dt.some(Ct=>Ct.mediaScreenId===et.mediaScreenId)?dt.map(Ct=>Ct.mediaScreenId===et.mediaScreenId?{...Ct,...et,source:"event",lastUpdated:new Date().toISOString()}:Ct):[...dt,{...et,source:"event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),t&&j("SetMediaScreenEditMode",{mediaScreenId:et.mediaScreenId,enabled:!0,showUploadIcon:!0});const nt=et.mediaScreenId;nt&&df(r,nt).then(dt=>{dt&&(Os(`Media screen data for ${nt}:`,dt),dt.displayAsVideo&&dt.videoUrl&&(Os(`Media screen ${nt} should display as video, sending null imageUrl`),j("SetMediaScreenImage",{mediaScreenId:nt,imageUrl:null,displayAsVideo:!0})))}).catch(dt=>{console.error(`Error fetching media screen data for ${nt}:`,dt)})}catch(et){console.error("Error handling MediaScreen registration:",et)}},Ae=ze=>{try{Os("MediaScreenClick event received:",ze);let et;if(typeof ze=="string")et=ze,Os("MediaScreenClick: Direct call with ID:",et);else{Os("MediaScreenClick: Event from Unity:",ze),Os("MediaScreenClick: Event detail:",ze.detail);try{et=JSON.parse(ze.detail).mediaScreenId,Os("MediaScreenClick: Parsed mediaScreenId:",et)}catch(nt){if(console.error("MediaScreenClick: Error parsing event detail:",nt),ze.detail&&ze.detail.mediaScreenId)et=ze.detail.mediaScreenId,Os("MediaScreenClick: Using direct mediaScreenId from detail:",et);else throw new Error("Could not extract mediaScreenId from event")}}be.log(`MediaScreen clicked: ${et}`),Os("MediaScreen clicked:",et),ye(et)}catch(et){console.error("Error handling MediaScreen click:",et)}},Ue=ze=>{if(ze.detail&&ze.detail.eventName==="RegisterMediaScreen")Se({detail:ze.detail.eventData});else if(ze.detail&&ze.detail.eventName==="MediaScreenClick")Ae({detail:ze.detail.eventData});else if(ze.detail&&ze.detail.eventName==="SetMediaScreenImage")try{const et=JSON.parse(ze.detail.eventData);et.mediaScreenId&&(Os("SetMediaScreenImage event received:",et),l(nt=>Array.isArray(nt)&&nt.some(Xe=>Xe.mediaScreenId===et.mediaScreenId)?nt.map(Xe=>Xe.mediaScreenId===et.mediaScreenId?{...Xe,imageUrl:et.imageUrl,hasImage:!!et.imageUrl,displayAsVideo:et.displayAsVideo||!1,lastUpdated:new Date().toISOString()}:Xe):[...Array.isArray(nt)?nt:[],{mediaScreenId:et.mediaScreenId,imageUrl:et.imageUrl,hasImage:!!et.imageUrl,displayAsVideo:et.displayAsVideo||!1,source:"set-media-screen-image",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]))}catch(et){console.error("Error handling SetMediaScreenImage event:",et)}};return window.addEventListener("RegisterMediaScreen",Se),window.addEventListener("MediaScreenClick",Ae),window.addEventListener("reactUnityEvent",Ue),()=>{window.removeEventListener("RegisterMediaScreen",Se),window.removeEventListener("MediaScreenClick",Ae),window.removeEventListener("reactUnityEvent",Ue)}},[t,v,j,a,ee,He,ge,ye,r]),L.useEffect(()=>{const Se=Ae=>{try{Os("Direct MediaScreenClick event received:",Ae);let Ue;if(Ae.detail)try{Ue=JSON.parse(Ae.detail).mediaScreenId}catch(ze){console.error("Error parsing MediaScreenClick event detail:",ze);return}if(!Ue){console.error("No mediaScreenId found in MediaScreenClick event");return}Os(`Direct handler: Processing click for media screen ${Ue}`),ye(Ue)}catch(Ue){console.error("Error in direct MediaScreenClick handler:",Ue)}};return window.addEventListener("MediaScreenClick",Se),()=>{window.removeEventListener("MediaScreenClick",Se)}},[ye]),L.useEffect(()=>{oe&&rt()},[oe,rt]);const Te=()=>{le(),we()};return L.useEffect(()=>{const Ae=H("RegisterMediaScreen",Ue=>{try{if(be.log("Direct RegisterMediaScreen event received with data:",Ue),!Ue||!Ue.mediaScreenId){be.warn("RegisterMediaScreen event received with invalid data");return}const ze=Ue.mediaScreenId;be.log(`Media screen registered directly: ${ze}`),l(et=>et.some(dt=>dt.mediaScreenId===ze)?et.map(dt=>dt.mediaScreenId===ze?{...dt,...Ue,source:"direct-event",lastUpdated:new Date().toISOString()}:dt):[...et,{...Ue,source:"direct-event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),t&&j("SetMediaScreenEditMode",{mediaScreenId:ze,enabled:!0,showUploadIcon:!0})}catch(ze){console.error("Error handling direct RegisterMediaScreen event:",ze)}});return()=>{Ae()}},[H,t,j]),L.useEffect(()=>{const Ae=H("MediaScreenClick",Ue=>{try{if(be.log("Direct MediaScreenClick event received with data:",Ue),!Ue||!Ue.mediaScreenId){be.warn("MediaScreenClick event received with invalid data");return}const ze=Ue.mediaScreenId;be.log(`Media screen clicked directly: ${ze}`),ye(ze)}catch(ze){console.error("Error handling direct MediaScreenClick event:",ze)}});return()=>{Ae()}},[H,ye]),L.useEffect(()=>{t&&he&&(console.log(`[DEBUG] Detected currentVideoMediaScreenId change in edit mode: ${he}`),f(he),v(),le())},[t,he,v,le]),P.jsxs(P.Fragment,{children:[P.jsx(p6e,{isOpen:E,onClose:T,mediaScreenId:d,onImageChange:Ne}),P.jsx(y6e,{}),P.jsx(Au,{containerRef:G,children:P.jsxs(tc,{isOpen:ee,onClose:Z,size:"lg",isCentered:!0,portalProps:{containerRef:G},id:"image-viewer-modal",blockScrollOnMount:!0,children:[P.jsx(ic,{bg:"rgba(0, 0, 0, 0.8)",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne}),P.jsxs(nc,{ref:Q,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:[P.jsx(Xc,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),P.jsx(rc,{p:0,width:"100%",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:de?P.jsx(kt,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:se==="image"?P.jsx(xh,{src:de,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",de),onError:Se=>console.error("Error loading image:",Se,de),onClick:ne}):P.jsxs(kt,{width:"100%",textAlign:"center",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:[P.jsx(St,{mb:4,fontSize:"lg",children:"Video URL:"}),P.jsx(St,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:de}),P.jsx(St,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):P.jsx(Qo,{direction:"column",align:"center",justify:"center",h:"400px",onClick:ne,onMouseMove:ne,onMouseDown:ne,onMouseUp:ne,onWheel:ne,children:P.jsx(St,{children:"No image available"})})})]})]})}),P.jsx(_6e,{videoUrl:oe,videoTitle:pe,mediaScreenId:he,isOpen:He,onClose:Te})]})},dse=({backgroundUrl:r=null,containerRef:t})=>{const[s,a]=L.useState(!1),[l,d]=L.useState(r),f=L.useRef(null),E=L.useRef(null);return L.useEffect(()=>{const v=T=>{const{backgroundUrl:R}=T.detail;d(R),f.current&&(R?(f.current.style.backgroundImage=`url('${R}')`,f.current.style.display="block",E.current&&(E.current.style.display="block")):(f.current.style.display="none",E.current&&(E.current.style.display="none")))};return window.addEventListener("SpaceBackgroundUpdated",v),()=>{window.removeEventListener("SpaceBackgroundUpdated",v)}},[]),L.useEffect(()=>{d(r),f.current&&r!==l&&(f.current.style.backgroundImage=`url('${r}')`)},[r]),L.useEffect(()=>{if(!t||!t.current)return;const v=document.createElement("div");f.current=v,Object.assign(v.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:l?`url('${l}')`:"none",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"});const T=document.createElement("div");E.current=T,Object.assign(T.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",display:l?"block":"none"}),t.current.appendChild(v),t.current.appendChild(T);const R=()=>{console.log("PersistentBackground: Player instantiated event received"),a(!0),v.style.opacity="0",T.style.opacity="0",setTimeout(()=>{t.current&&t.current.contains(v)&&t.current.removeChild(v),t.current&&t.current.contains(T)&&t.current.removeChild(T)},1500)};if(window.isPlayerInstantiated)console.log("PersistentBackground: Player was already instantiated"),R();else{Rd.subscribe(wd.playerInstantiated,R);const I=()=>R();window.addEventListener("PlayerInstantiated",I);const N=setTimeout(()=>{console.log("PersistentBackground: Forcing background removal after timeout"),R()},3e4);return()=>{Rd.unsubscribe(wd.playerInstantiated,R),window.removeEventListener("PlayerInstantiated",I),clearTimeout(N),t.current&&t.current.contains(v)&&t.current.removeChild(v),t.current&&t.current.contains(T)&&t.current.removeChild(T)}}},[l,t]),null};dse.propTypes={backgroundUrl:Ur.string,containerRef:Ur.shape({current:Ur.instanceOf(Element)})};const hse=({containerRef:r})=>{const{spaceID:t}=Jc(),[s,a]=L.useState(!1),[l,d]=L.useState(!1),[f,E]=L.useState(0),[v,T]=L.useState("Initialising World"),[R,I]=L.useState(null),N=L.useRef(null),F=L.useRef(null),j=L.useRef(null),G=L.useRef(null);L.useEffect(()=>(be.log("PersistentLoader: Component mounted with spaceID:",t),be.log("PersistentLoader: Container ref:",r),()=>{be.log("PersistentLoader: Component unmounting")}),[]);const{error:H}=Jc(),[te,K]=L.useState(!1);return L.useEffect(()=>{H&&(be.error("PersistentLoader: Unity error detected:",H),K(!0),setTimeout(()=>{if(N.current){const ee=N.current.querySelector("div:first-child");ee&&(ee.textContent="Reconnecting...")}},3e3))},[H]),L.useEffect(()=>{(async()=>{if(t){be.log(`PersistentLoader: Fetching logo for space ${t}`);try{const de=await sg(t);de&&de.logoUrl?(be.log(`PersistentLoader: Found logo URL: ${de.logoUrl}`),I(de.logoUrl)):be.log(`PersistentLoader: No logo URL found for space ${t}`)}catch(de){be.error("PersistentLoader: Error fetching space logo:",de)}}else be.warn("PersistentLoader: No spaceID provided, cannot fetch logo")})()},[t]),L.useEffect(()=>{const ee=de=>{const{logoUrl:se}=de.detail;be.log(`PersistentLoader: Logo update event received with URL: ${se}`),I(se),F.current?se?(be.log("PersistentLoader: Updating logo element with new URL"),F.current.src=se,j.current.style.display="flex"):(be.log("PersistentLoader: Hiding logo element (no URL)"),j.current.style.display="none"):be.warn("PersistentLoader: Logo ref is null during update")};return be.log("PersistentLoader: Adding SpaceLogoUpdated event listener"),window.addEventListener("SpaceLogoUpdated",ee),()=>{be.log("PersistentLoader: Removing SpaceLogoUpdated event listener"),window.removeEventListener("SpaceLogoUpdated",ee)}},[]),L.useEffect(()=>{if(!r||!r.current){be.error("PersistentLoader: Container ref is null or has no current property");return}be.log("PersistentLoader: Creating loader elements");const ee=document.createElement("div");if(N.current=ee,Object.assign(ee.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% + 50px))",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.8)",borderRadius:"8px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.7)"}),R){be.log(`PersistentLoader: Creating logo element with URL: ${R}`);const He=document.createElement("div");j.current=He,Object.assign(He.style,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% - 40px))",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 1.5s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px"});const rt=document.createElement("img");F.current=rt,rt.src=R,rt.alt="Space Logo",rt.style.maxHeight="100px",rt.style.maxWidth="100%",rt.style.objectFit="contain",rt.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",He.appendChild(rt),r.current.appendChild(He),be.log("PersistentLoader: Logo container added to main container")}else be.log("PersistentLoader: No logo URL available, skipping logo creation");const de=document.createElement("style");de.textContent=`
      @keyframes progress-pulse {
        0% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
        50% { box-shadow: 0 0 15px rgba(255, 255, 255, 0.8); }
        100% { box-shadow: 0 0 5px rgba(255, 255, 255, 0.5); }
      }
      
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(de),be.log("PersistentLoader: Animation styles added to document head");const se=document.createElement("div");se.style.fontSize="16px",se.style.fontWeight="bold",se.style.textAlign="center",se.style.marginBottom="16px",se.style.color="#ffffff",se.textContent="Initialising World";const ge=document.createElement("div");ge.style.width="100%",ge.style.height="12px",ge.style.backgroundColor="rgba(255, 255, 255, 0.2)",ge.style.borderRadius="6px",ge.style.overflow="hidden",ge.style.position="relative",ge.style.boxShadow="0 0 10px rgba(0, 0, 0, 0.5) inset";const Z=document.createElement("div");Z.style.height="100%",Z.style.width="0%",Z.style.background="linear-gradient(90deg, #4facfe 0%, #00f2fe 100%)",Z.style.backgroundSize="200% 200%",Z.style.animation="progress-glow 2s ease infinite",Z.style.transition="width 0.5s ease-out",Z.style.borderRadius="6px",Z.style.boxShadow="0 0 10px rgba(255, 255, 255, 0.5)",ge.appendChild(Z);const Q=document.createElement("div");Q.style.marginTop="8px",Q.style.fontSize="14px",Q.style.fontWeight="bold",Q.style.color="#ffffff",Q.textContent="0%",ee.appendChild(se),ee.appendChild(ge),ee.appendChild(Q),r.current.appendChild(ee),be.log("PersistentLoader: Loader element added to container");const ne=He=>{E(He),Z.style.width=`${Math.round(He*100)}%`,Q.textContent=`${Math.round(He*100)}%`,be.log(`PersistentLoader: Progress updated to ${Math.round(He*100)}%`)},oe=He=>{T(He),se.textContent=He,be.log(`PersistentLoader: Loading stage updated to "${He}"`)},pe=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];te&&(pe[0].stage="Connecting to Space",pe[1].stage="Reconnecting...",pe[2].stage="Please Wait"),oe(pe[0].stage),ne(.05);const he=He=>{const rt=He.detail.progress;be.log(`PersistentLoader: Progress event received with value: ${rt}`),ne(rt),rt<.33?oe(pe[0].stage):rt<.66?oe(pe[1].stage):oe(pe[2].stage)},le=()=>{be.log("PersistentLoader: First scene loaded event received"),a(!0),oe(pe[1].stage),ne(.66)},Me=()=>{if(be.log("PersistentLoader: Player instantiated event received"),G.current&&(clearInterval(G.current),be.log("PersistentLoader: Progress interval cleared")),d(!0),oe(pe[2].stage),ne(1),te){be.log("PersistentLoader: Keeping loader visible due to Unity error");return}ee.style.opacity="0",j.current&&(j.current.style.opacity="0"),setTimeout(()=>{r.current&&r.current.contains(ee)?(r.current.removeChild(ee),be.log("PersistentLoader: Loader element removed after fade")):be.warn("PersistentLoader: Could not remove loader element (not found in container)"),j.current&&r.current&&r.current.contains(j.current)?(r.current.removeChild(j.current),be.log("PersistentLoader: Logo container removed after fade")):j.current&&be.warn("PersistentLoader: Could not remove logo container (not found in container)")},1500)};if(window.isPlayerInstantiated)be.log("PersistentLoader: Player was already instantiated"),Me();else{be.log("PersistentLoader: Subscribing to playerInstantiated event"),Rd.subscribe(wd.playerInstantiated,Me);const He=()=>Me();be.log("PersistentLoader: Adding PlayerInstantiated event listener"),window.addEventListener("PlayerInstantiated",He),be.log("PersistentLoader: Adding firstSceneLoaded event listener"),Rd.subscribe(wd.firstSceneLoaded,le),be.log("PersistentLoader: Adding UnityProgress event listener"),window.addEventListener("UnityProgress",he),G.current=setInterval(()=>{l||E(we=>{const Ce=Math.min(we+.01,.95);return Z.style.width=`${Math.round(Ce*100)}%`,Q.textContent=`${Math.round(Ce*100)}%`,Ce<.33&&v!==pe[0].stage?oe(pe[0].stage):Ce>=.33&&Ce<.66&&v!==pe[1].stage?oe(pe[1].stage):Ce>=.66&&v!==pe[2].stage&&oe(pe[2].stage),Ce})},500);const rt=setTimeout(()=>{be.log("PersistentLoader: Forcing loader removal after timeout"),Me()},6e4);return()=>{be.log("PersistentLoader: Cleaning up event listeners"),Rd.unsubscribe(wd.playerInstantiated,Me),window.removeEventListener("PlayerInstantiated",He),Rd.unsubscribe(wd.firstSceneLoaded,le),window.removeEventListener("UnityProgress",he),clearInterval(G.current),clearTimeout(rt),r.current&&r.current.contains(ee)&&(r.current.removeChild(ee),be.log("PersistentLoader: Loader element removed during cleanup")),j.current&&r.current&&r.current.contains(j.current)&&(r.current.removeChild(j.current),be.log("PersistentLoader: Logo container removed during cleanup"))}}},[R,r]),null};hse.propTypes={containerRef:Ur.shape({current:Ur.instanceOf(Element)})};const l0=()=>window.unityInstance||window.gameInstance||window.reactUnityInstance,r4=()=>{document.body.classList.add("unity-focused");const r=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","PageUp","PageDown","Home","End"],t=a=>{if(r.includes(a.key)){const l=a.target.tagName==="INPUT"||a.target.tagName==="TEXTAREA"||a.target.isContentEditable,d=document.querySelector("canvas")||document.getElementById("unity-canvas"),f=a.target.closest("canvas")||a.target.closest("#webgl-root"),E=document.activeElement===d;!l&&(f||E)&&a.preventDefault()}},s=a=>{document.querySelector("canvas")||document.getElementById("unity-canvas"),document.getElementById("unity-container")||document.getElementById("webgl-root"),a.target.closest("canvas")||a.target.closest("#webgl-root")?document.body.classList.add("unity-focused"):document.body.classList.remove("unity-focused")};return document.addEventListener("keydown",t),document.addEventListener("click",s),()=>{document.body.classList.remove("unity-focused"),document.removeEventListener("keydown",t),document.removeEventListener("click",s)}},pse=()=>{document.body.classList.remove("unity-focused")};function jk(r){return console.log(`Setting Unity keyboard capture: ${r}`),r?(document.body.classList.add("unity-focused"),window.unityKeyboardEnabled=!0):(document.body.classList.remove("unity-focused"),window.unityKeyboardEnabled=!1),r?r4():pse(),new Promise(t=>{try{const s=l0();if(s){try{r?s.SendMessage("WebGLInput","EnableKeyboardCapture"):s.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Unity keyboard capture ${r?"enabled":"disabled"} (using Unity preferred method)`),t(!0);return}catch(a){console.warn("Failed to use Unity preferred keyboard method, falling back to SetCaptureAllKeyboardInput",a)}try{s.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",r),console.log(`Unity keyboard capture ${r?"enabled":"disabled"} (using fallback method)`),t(!0);return}catch(a){console.warn("Failed to use SetCaptureAllKeyboardInput, trying module method",a)}if(s.Module){!r&&s.Module.WebGLInputHandler&&!window._originalWebGLInputHandler&&(window._originalWebGLInputHandler=s.Module.WebGLInputHandler),r&&window._originalWebGLInputHandler?(s.Module.WebGLInputHandler=window._originalWebGLInputHandler,window._originalWebGLInputHandler=null):r||(s.Module.WebGLInputHandler=null),console.log(`Unity keyboard capture ${r?"enabled":"disabled"} (using Module method)`),t(!0);return}}else console.warn("Unity instance not available, cannot set keyboard capture"),window.__pendingKeyboardCaptureState=r,document.getElementById("webgl-root")&&(console.log("webgl-root detected, will poll for Unity instance"),fV(r)),t(!1)}catch(s){console.error("Error setting Unity keyboard capture:",s),t(!1)}})}function fV(r){window.__unityInstancePoller&&clearTimeout(window.__unityInstancePoller);const t=20;let s=0;const a=()=>{s++;const l=l0();if(l){console.log(`Unity instance found after ${s} attempts`);try{r?l.SendMessage("WebGLInput","EnableKeyboardCapture"):l.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${r}`),window.__pendingKeyboardCaptureState=null}catch(d){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",d);try{l.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",r),console.log(`Applied pending keyboard state: ${r} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(f){console.error("Failed to apply pending keyboard state with fallback method",f)}}}else if(s<t){const d=Math.min(500*Math.pow(1.2,s),5e3);console.log(`Unity instance not found (attempt ${s}/${t}), retrying in ${d}ms`),window.__unityInstancePoller=setTimeout(a,d)}else console.warn(`Unity instance still not found after ${t} attempts, giving up`)};window.__unityInstancePoller=setTimeout(a,500)}function S6e(){const r=l0();if(!r)return!1;const t=document.querySelector("canvas")||document.getElementById("unity-canvas");return!!(t&&document.activeElement===t||r.Module&&r.Module.WebGLInputHandler)}function uS(r=!0){return console.log("Focusing Unity canvas"),r?r4():pse(),new Promise(t=>{try{const s=document.querySelector("canvas")||document.getElementById("unity-canvas");if(s){try{s.focus({preventScroll:!0})}catch{s.focus()}if(s.style.pointerEvents="auto",r){jk(!0).then(t);return}t(!0)}else console.warn("Unity canvas not found"),t(!1)}catch(s){console.error("Error focusing Unity canvas:",s),t(!1)}})}function bS(r=!0){return console.log(`${r?"Blocking":"Unblocking"} Unity keyboard input`),r4(),new Promise(t=>{try{if(r)jk(!1).then(s=>{var d;s&&console.log("Successfully disabled Unity keyboard capture");const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.blur(),a.style.pointerEvents="none"),window.__keyEventHandler||(window.__keyEventHandler=f=>{window.__blockKeyboardInput&&!["INPUT","TEXTAREA","SELECT"].includes(f.target.tagName)&&f.stopPropagation()},document.addEventListener("keydown",window.__keyEventHandler,!0),document.addEventListener("keyup",window.__keyEventHandler,!0),document.addEventListener("keypress",window.__keyEventHandler,!0)),window.__blockKeyboardInput=!0;const l=l0();(d=l==null?void 0:l.Module)!=null&&d.WebGLInputHandler&&(window._savedWebGLInputHandler=l.Module.WebGLInputHandler,l.Module.WebGLInputHandler=null),t(!0)});else{window.__blockKeyboardInput=!1,window.__keyEventHandler&&(document.removeEventListener("keydown",window.__keyEventHandler,!0),document.removeEventListener("keyup",window.__keyEventHandler,!0),document.removeEventListener("keypress",window.__keyEventHandler,!0),window.__keyEventHandler=null);const s=l0();s!=null&&s.Module&&window._savedWebGLInputHandler&&(s.Module.WebGLInputHandler=window._savedWebGLInputHandler,window._savedWebGLInputHandler=null);const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.style.pointerEvents="auto"),jk(!0).then(l=>{l&&console.log("Successfully re-enabled Unity keyboard capture"),t(!0)})}}catch(s){console.error("Error in blockUnityKeyboardInput:",s),t(!1)}})}function T6e(r){if(r){if(console.log("Registering Unity instance"),window.unityInstance=r,typeof window.__pendingKeyboardCaptureState=="boolean")try{const t=window.__pendingKeyboardCaptureState;console.log(`Applying pending keyboard state: ${t}`);try{t?r.SendMessage("WebGLInput","EnableKeyboardCapture"):r.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${t} (Unity preferred method)`),window.__pendingKeyboardCaptureState=null}catch(s){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",s);try{r.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",t),console.log(`Applied pending keyboard state: ${t} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(a){console.error("Failed to apply pending keyboard state with fallback method",a)}}}catch(t){console.error("Error applying pending keyboard state:",t)}window.__unityInstancePoller&&(clearTimeout(window.__unityInstancePoller),window.__unityInstancePoller=null)}}function b6e(){if(console.log("Initializing Unity keyboard helpers"),window.setUnityKeyboardCapture=jk,window.focusUnity=uS,window.blockUnityKeyboardInput=bS,window.hasUnityKeyboardFocus=S6e,window.getUnityInstance=l0,window.registerUnityInstance=T6e,document.getElementById("webgl-root")){const r=new MutationObserver(t=>{for(const s of t)if(s.addedNodes.length)for(let a=0;a<s.addedNodes.length;a++){const l=s.addedNodes[a];if(l.nodeName==="CANVAS"||l.querySelector&&l.querySelector("canvas")){console.log("Canvas detected, Unity might be loading. Setting up instance detection."),fV(!0),r.disconnect();break}}});r.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("canvas")&&(console.log("Canvas already exists, Unity might be loaded. Starting instance detection."),fV(!0))}if(typeof window<"u"&&typeof require=="function")try{const r=require("react");window.useUnityKeyboardFocus=function(){const[s,a]=r.useState(!1);return r.useEffect(()=>(s?(console.log("useUnityKeyboardFocus: Blocking Unity keyboard input"),bS(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("useUnityKeyboardFocus: Unblocking Unity keyboard input"),bS(!1),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{s&&(console.log("useUnityKeyboardFocus: Cleanup - unblocking Unity keyboard input"),bS(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[s]),[s,a]},console.log("Created useUnityKeyboardFocus hook globally")}catch(r){console.warn("Could not create React hook, React might not be available yet:",r)}}typeof window<"u"&&setTimeout(b6e,0);const w6e="9442a472625f44e7b2c5065b9f9b3988",D2=()=>document.querySelector("canvas")||document.getElementById("unity-canvas"),i4=L.forwardRef(({settings:r},t)=>{const{unityProvider:s,isLoaded:a,error:l}=Jc(),d=BBe();zBe();const f=wg(),E=YBe(d),{user:v}=L.useContext(Pu),[T,R]=L.useState(!1),[I,N]=L.useState(window.devicePixelRatio),[F,j]=HBe();Bie().find(Ne=>Ne.isLocalPlayer);const[H,te]=L.useState(!0),[K,ee]=L.useState(!0),[de,se]=L.useState(!1),[ge,Z]=L.useState(!1),[Q,ne]=L.useState(!1);L.useEffect(()=>{Q?(console.log("WebGLRenderer: Modal opened, disabling Unity keyboard capture"),bS(!0)):(console.log("WebGLRenderer: Modal closed, enabling Unity keyboard capture"),a&&!ge&&bS(!1).then(()=>{setTimeout(()=>{uS(!0)},100)}))},[Q,a,ge]);const oe=r.spaceID||"default",pe=L.useMemo(()=>{const Se=new URLSearchParams(window.location.search).get("sessionId")||oe;return console.log("WebGLRenderer: Using session ID:",Se),Se},[oe]),[he,le]=L.useState(null);L.useEffect(()=>{v!=null&&v.uid&&Jh(v.uid).then(Ne=>{le(Ne),console.log("WebGLRenderer: User profile loaded:",(Ne==null?void 0:Ne.Nickname)||"Unknown")}).catch(Ne=>{console.error("Error fetching user profile:",Ne)})},[v==null?void 0:v.uid]),L.useEffect(()=>{if(l||!v){be.log("WebGLRenderer: User not logged in or Unity error, showing sign-in modal");const Ne=setTimeout(()=>{Z(!0),ne(!0)},1e3);return()=>clearTimeout(Ne)}else Z(!1)},[l,v]),L.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const Ne=()=>{console.log("WebGLRenderer: Player instantiated event received"),ee(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),ee(!0)),Rd.subscribe(wd.playerInstantiated,Ne);const Te=setTimeout(()=>{K||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),ee(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{Rd.unsubscribe(wd.playerInstantiated,Ne),clearTimeout(Te)}},[K]),L.useEffect(()=>{const Ne=()=>{console.log("WebGLRenderer: Modal opened"),ne(!0)},Te=()=>{console.log("WebGLRenderer: Modal closed"),ne(!1)};return window.addEventListener("modal-opened",Ne),window.addEventListener("modal-closed",Te),()=>{window.removeEventListener("modal-opened",Ne),window.removeEventListener("modal-closed",Te)}},[]),L.useEffect(()=>{ne(F!==null)},[F]),L.useEffect(()=>{a||d?setTimeout(()=>{R(!0),be.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):be.warn("WebGLRenderer: Unity is NOT ready yet.")},[a,d]),L.useEffect(()=>{a&&s&&setTimeout(()=>{if(window.unityInstance)try{console.log("WebGLRenderer: Disabling Unity keyboard capture on initialization"),window.unityInstance.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",!1)}catch(Ne){console.error("WebGLRenderer: Error disabling Unity keyboard capture:",Ne)}},1e3)},[a,s]),L.useEffect(()=>{const Ne=document.getElementById("webgl-root");return Ne?(console.log("WebGLRenderer: Found webgl-root element, ensuring it is visible"),Ne.style.display="block",Ne.getAttribute("data-space-id")!==oe&&(Ne.setAttribute("data-space-id",oe),console.log(`WebGLRenderer: Set data-space-id attribute to ${oe}`))):console.error("WebGLRenderer: Could not find webgl-root element"),()=>{}},[oe]),L.useEffect(()=>{const Ne=()=>{const Ae=D2();Ae?(console.log("WebGLRenderer: Configuring Unity canvas for keyboard input"),Ae.tabIndex=1,Ae.style.outline="none",Ae.addEventListener("click",()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),Q||uS(!0)}),console.log("WebGLRenderer: Unity canvas configured with tabIndex=1")):console.warn("WebGLRenderer: Could not find Unity canvas to configure")};Ne();const Te=setTimeout(Ne,1e3),Se=()=>{console.log("WebGLRenderer: Received unityReady event, configuring canvas"),Ne()};return window.addEventListener("unityReady",Se),()=>{clearTimeout(Te),window.removeEventListener("unityReady",Se)}},[a,Q]);const Me=L.useCallback(()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),Q||uS(!0)},[Q]);L.useEffect(()=>{if(a&&s){const Ne=D2();if(Ne)return console.log("WebGLRenderer: Adding click handler to Unity canvas"),Ne.addEventListener("click",Me),()=>{Ne.removeEventListener("click",Me)}}},[a,s,Me]),L.useEffect(()=>{if(a&&s){console.log("WebGLRenderer: Setting up global click handler for focus management");const Ne=Te=>{if(Q){console.log("WebGLRenderer: Modal is open, not refocusing Unity on click");return}if(Te.target.tagName==="INPUT"||Te.target.tagName==="TEXTAREA"||Te.target.tagName==="SELECT"||Te.target.tagName==="BUTTON"){console.log("WebGLRenderer: Clicked on form element, not refocusing Unity");return}if(Te.target.closest(".chakra-modal__content")||Te.target.closest('[role="dialog"]')||Te.target.closest('[role="menu"]')||Te.target.closest(".chakra-popover__content")||Te.target.closest('[role="tooltip"]')){console.log("WebGLRenderer: Clicked inside modal/dialog content, not refocusing Unity");return}const Se=D2();if(Se&&(Te.target===Se||Se.contains(Te.target)))return;if(Te.target.closest(".webgl-overlay")||Te.target.closest(".game-ui")||Te.target.closest(".player-list")||Te.target.closest(".unity-ui-overlay")){console.log("WebGLRenderer: Clicked on UI overlay that should allow keyboard events"),setTimeout(()=>{Q||uS(!0)},50);return}console.log("WebGLRenderer: Clicked outside forms/modals/special UI, refocusing Unity canvas"),setTimeout(()=>{Se&&!Q&&((Se.tabIndex===void 0||Se.tabIndex<0)&&(Se.tabIndex=1),Se.focus(),uS(!0))},50)};return document.addEventListener("click",Ne,!0),()=>{document.removeEventListener("click",Ne,!0)}}},[a,s,Q]),L.useEffect(()=>{const Ne=Te=>{be.log("WebGLRenderer: Received 'sendUserToUnity' event"),f("FirebaseUserFromReact",Te)};return Rd.subscribe(wd.sendUserToUnity,Ne),()=>Rd.unsubscribe(wd.sendUserToUnity,Ne)},[f]);const{setFullscreenRef:He,fullscreenRef:rt}=Pd();L.useEffect(()=>{He(t.current)},[t,He]);const we=()=>{te(!H)},Ce=v&&r.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!v,userId:v==null?void 0:v.uid,isPlayerInstantiated:K,showVoiceChat:Ce,sessionId:pe}),L.useEffect(()=>{const Ne=Te=>{se(Te.detail.enabled)};return window.addEventListener("editModeChanged",Ne),()=>{window.removeEventListener("editModeChanged",Ne)}},[]),Wie(),GBe();const ye=L.useRef(null);return P.jsxs(kt,{className:"webgl-renderer",children:[r.urlLoadingBackground&&P.jsx(dse,{backgroundUrl:r.urlLoadingBackground,containerRef:ye}),!ge&&P.jsx(hse,{containerRef:ye}),ge&&P.jsx(kt,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:P.jsx(n4,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),P.jsx(xV,{containerRef:rt.current?rt:document.body,children:P.jsxs("div",{ref:t,style:{width:"100%",height:"100%",aspectRatio:"auto",position:"absolute"},children:[P.jsxs(kt,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[r.showAuthButton&&P.jsx(S5e,{}),Ce&&P.jsxs(cse,{appId:w6e,channel:pe,uid:v==null?void 0:v.uid,enabled:!0,children:[P.jsx(Q5e,{size:"md",defaultMuted:!0,joinOnClick:!0}),P.jsx(e6e,{userNickname:he==null?void 0:he.Nickname})]}),P.jsx(F5e,{}),P.jsx(kt,{position:"relative",zIndex:"9999",children:P.jsx(h6e,{onTogglePlayerList:we,spaceID:oe})})]}),P.jsxs(kt,{ref:ye,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[P.jsx(kt,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),P.jsx(kt,{...E,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:s?P.jsx(jie.Unity,{unityProvider:s,style:{width:"100%",height:"100%"},devicePixelRatio:I,tabIndex:1}):P.jsx(kt,{width:"100%",height:"100%"})}),P.jsx(kt,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:P.jsx(v5e,{})})]}),P.jsx(kt,{...E,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:r.showDisruptiveLogo&&P.jsx(xh,{src:r.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),P.jsx(kt,{...E,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3}),P.jsxs(kt,{...E,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[r.showHelpButton&&P.jsx(T5e,{}),P.jsx(W5e,{})]}),P.jsx(z5e,{}),P.jsx(G5e,{isOpen:F!==null,onClose:()=>{console.log(" Closing nameplate modal"),j()},playerName:(F==null?void 0:F.playerName)||"Unknown Player",playerId:(F==null?void 0:F.playerId)||"Unknown ID"}),P.jsx(H5e,{isVisible:H,onToggleVisibility:te,spaceID:oe}),P.jsx(v6e,{})]})})]})});i4.displayName="WebGLRenderer";i4.propTypes={settings:Ur.shape({urlLoadingBackground:Ur.string,showAuthButton:Ur.bool,showDisruptiveLogo:Ur.bool,urlDisruptiveLogo:Ur.string,showHelpButton:Ur.bool,enableVoiceChat:Ur.bool,spaceID:Ur.string})};const fse=({spaceID:r,overrideSettings:t})=>{const s=L.useRef(null),[a,l]=L.useState(!0),[d,f]=L.useState({spaceID:r,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[E,v]=L.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:r});return L.useEffect(()=>{(async()=>{try{const R=await sg(r);if(R){f(F=>({...F,spaceID:r,loaderUrl:R.loaderUrl,dataUrl:R.dataUrl,frameworkUrl:R.frameworkUrl,codeUrl:R.codeUrl}));const I=await KO(E.urlDisruptiveLogo);let N="";if(R.backgroundUrl)N=R.backgroundUrl;else if(R.backgroundGsUrl)try{N=await KO(R.backgroundGsUrl)}catch(F){be.warn("WebGLLoader: Error fetching background from GS URL:",F)}else if(R.gsUrlLoadingBackground)try{N=await KO(R.gsUrlLoadingBackground)}catch(F){be.warn("WebGLLoader: Error fetching background from legacy GS URL:",F)}v(F=>({...F,urlLoadingBackground:N,showAuthButton:R.showAuthButton!==void 0?R.showAuthButton:!0,showDisruptiveLogo:R.showDisruptiveLogo!==void 0?R.showDisruptiveLogo:!0,showHelpButton:R.showHelpButton!==void 0?R.showHelpButton:!0,enableVoiceChat:R.enableVoiceChat!==void 0?R.enableVoiceChat:!0,urlDisruptiveLogo:I,spaceID:r,...t||{}})),l(!1)}else be.error(`WebGLLoader: No configuration found for spaceID: ${r}`)}catch(R){be.error("WebGLLoader: Error fetching space data:",R)}finally{l(!1)}})()},[r,E.urlDisruptiveLogo,t]),L.useEffect(()=>{a||(be.log("WebGLLoader: Unity config from Firebase",d),be.log("WebGLLoader: Space settings from Firebase",E))},[a]),P.jsx(P.Fragment,{children:a?P.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):P.jsx(jBe,{...d,children:P.jsx(i4,{ref:s,settings:E})})})};fse.propTypes={spaceID:Ur.string.isRequired,overrideSettings:Ur.object};function lJ(){const r=document.getElementById("webgl-root");if(r){const t=r.getAttribute("data-space-id"),s=r.getAttribute("data-theme")||"default",a=()=>{const[l,d]=L.useState(null);return L.useEffect(()=>{Xxe(s).then(d)},[]),l?P.jsx(dke,{theme:l,children:P.jsx(PBe,{children:P.jsx(OBe,{children:P.jsx(fse,{spaceID:t})})})}):P.jsx("div",{children:"Loading theme..."})};try{n_e.createRoot(r).render(P.jsx(a,{}))}catch(l){console.warn("Error initializing WebGL:",l)}}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",lJ):lJ());export{__e as a,jye as b,Ai as c,Uye as d,C6e as e,R6e as f,Pye as g,Su as i,Lh as m,Vwe as t};
