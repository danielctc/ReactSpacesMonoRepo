function bye(n,t){for(var i=0;i<t.length;i++){const a=t[i];if(typeof a!="string"&&!Array.isArray(a)){for(const l in a)if(l!=="default"&&!(l in n)){const d=Object.getOwnPropertyDescriptor(a,l);d&&Object.defineProperty(n,l,d.get?d:{enumerable:!0,get:()=>a[l]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var Sy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fg(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var W2={exports:{}},uw={},G2={exports:{}},Tr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var H7;function Tye(){if(H7)return Tr;H7=1;var n=Symbol.for("react.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),f=Symbol.for("react.context"),_=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),I=Symbol.iterator;function O(Pe){return Pe===null||typeof Pe!="object"?null:(Pe=I&&Pe[I]||Pe["@@iterator"],typeof Pe=="function"?Pe:null)}var L={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},M=Object.assign,F={};function z(Pe,we,ke){this.props=Pe,this.context=we,this.refs=F,this.updater=ke||L}z.prototype.isReactComponent={},z.prototype.setState=function(Pe,we){if(typeof Pe!="object"&&typeof Pe!="function"&&Pe!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Pe,we,"setState")},z.prototype.forceUpdate=function(Pe){this.updater.enqueueForceUpdate(this,Pe,"forceUpdate")};function Z(){}Z.prototype=z.prototype;function K(Pe,we,ke){this.props=Pe,this.context=we,this.refs=F,this.updater=ke||L}var re=K.prototype=new Z;re.constructor=K,M(re,z.prototype),re.isPureReactComponent=!0;var ae=Array.isArray,ne=Object.prototype.hasOwnProperty,pe={current:null},X={key:!0,ref:!0,__self:!0,__source:!0};function J(Pe,we,ke){var Ue,Be={},qe=null,$e=null;if(we!=null)for(Ue in we.ref!==void 0&&($e=we.ref),we.key!==void 0&&(qe=""+we.key),we)ne.call(we,Ue)&&!X.hasOwnProperty(Ue)&&(Be[Ue]=we[Ue]);var it=arguments.length-2;if(it===1)Be.children=ke;else if(1<it){for(var Je=Array(it),Ct=0;Ct<it;Ct++)Je[Ct]=arguments[Ct+2];Be.children=Je}if(Pe&&Pe.defaultProps)for(Ue in it=Pe.defaultProps,it)Be[Ue]===void 0&&(Be[Ue]=it[Ue]);return{$$typeof:n,type:Pe,key:qe,ref:$e,props:Be,_owner:pe.current}}function Q(Pe,we){return{$$typeof:n,type:Pe.type,key:we,ref:Pe.ref,props:Pe.props,_owner:Pe._owner}}function se(Pe){return typeof Pe=="object"&&Pe!==null&&Pe.$$typeof===n}function de(Pe){var we={"=":"=0",":":"=2"};return"$"+Pe.replace(/[=:]/g,function(ke){return we[ke]})}var he=/\/+/g;function le(Pe,we){return typeof Pe=="object"&&Pe!==null&&Pe.key!=null?de(""+Pe.key):we.toString(36)}function Oe(Pe,we,ke,Ue,Be){var qe=typeof Pe;(qe==="undefined"||qe==="boolean")&&(Pe=null);var $e=!1;if(Pe===null)$e=!0;else switch(qe){case"string":case"number":$e=!0;break;case"object":switch(Pe.$$typeof){case n:case t:$e=!0}}if($e)return $e=Pe,Be=Be($e),Pe=Ue===""?"."+le($e,0):Ue,ae(Be)?(ke="",Pe!=null&&(ke=Pe.replace(he,"$&/")+"/"),Oe(Be,we,ke,"",function(Ct){return Ct})):Be!=null&&(se(Be)&&(Be=Q(Be,ke+(!Be.key||$e&&$e.key===Be.key?"":(""+Be.key).replace(he,"$&/")+"/")+Pe)),we.push(Be)),1;if($e=0,Ue=Ue===""?".":Ue+":",ae(Pe))for(var it=0;it<Pe.length;it++){qe=Pe[it];var Je=Ue+le(qe,it);$e+=Oe(qe,we,ke,Je,Be)}else if(Je=O(Pe),typeof Je=="function")for(Pe=Je.call(Pe),it=0;!(qe=Pe.next()).done;)qe=qe.value,Je=Ue+le(qe,it++),$e+=Oe(qe,we,ke,Je,Be);else if(qe==="object")throw we=String(Pe),Error("Objects are not valid as a React child (found: "+(we==="[object Object]"?"object with keys {"+Object.keys(Pe).join(", ")+"}":we)+"). If you meant to render a collection of children, use an array instead.");return $e}function Ve(Pe,we,ke){if(Pe==null)return Pe;var Ue=[],Be=0;return Oe(Pe,Ue,"","",function(qe){return we.call(ke,qe,Be++)}),Ue}function xe(Pe){if(Pe._status===-1){var we=Pe._result;we=we(),we.then(function(ke){(Pe._status===0||Pe._status===-1)&&(Pe._status=1,Pe._result=ke)},function(ke){(Pe._status===0||Pe._status===-1)&&(Pe._status=2,Pe._result=ke)}),Pe._status===-1&&(Pe._status=0,Pe._result=we)}if(Pe._status===1)return Pe._result.default;throw Pe._result}var Re={current:null},ve={transition:null},be={ReactCurrentDispatcher:Re,ReactCurrentBatchConfig:ve,ReactCurrentOwner:pe};function ze(){throw Error("act(...) is not supported in production builds of React.")}return Tr.Children={map:Ve,forEach:function(Pe,we,ke){Ve(Pe,function(){we.apply(this,arguments)},ke)},count:function(Pe){var we=0;return Ve(Pe,function(){we++}),we},toArray:function(Pe){return Ve(Pe,function(we){return we})||[]},only:function(Pe){if(!se(Pe))throw Error("React.Children.only expected to receive a single React element child.");return Pe}},Tr.Component=z,Tr.Fragment=i,Tr.Profiler=l,Tr.PureComponent=K,Tr.StrictMode=a,Tr.Suspense=v,Tr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=be,Tr.act=ze,Tr.cloneElement=function(Pe,we,ke){if(Pe==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Pe+".");var Ue=M({},Pe.props),Be=Pe.key,qe=Pe.ref,$e=Pe._owner;if(we!=null){if(we.ref!==void 0&&(qe=we.ref,$e=pe.current),we.key!==void 0&&(Be=""+we.key),Pe.type&&Pe.type.defaultProps)var it=Pe.type.defaultProps;for(Je in we)ne.call(we,Je)&&!X.hasOwnProperty(Je)&&(Ue[Je]=we[Je]===void 0&&it!==void 0?it[Je]:we[Je])}var Je=arguments.length-2;if(Je===1)Ue.children=ke;else if(1<Je){it=Array(Je);for(var Ct=0;Ct<Je;Ct++)it[Ct]=arguments[Ct+2];Ue.children=it}return{$$typeof:n,type:Pe.type,key:Be,ref:qe,props:Ue,_owner:$e}},Tr.createContext=function(Pe){return Pe={$$typeof:f,_currentValue:Pe,_currentValue2:Pe,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Pe.Provider={$$typeof:d,_context:Pe},Pe.Consumer=Pe},Tr.createElement=J,Tr.createFactory=function(Pe){var we=J.bind(null,Pe);return we.type=Pe,we},Tr.createRef=function(){return{current:null}},Tr.forwardRef=function(Pe){return{$$typeof:_,render:Pe}},Tr.isValidElement=se,Tr.lazy=function(Pe){return{$$typeof:C,_payload:{_status:-1,_result:Pe},_init:xe}},Tr.memo=function(Pe,we){return{$$typeof:b,type:Pe,compare:we===void 0?null:we}},Tr.startTransition=function(Pe){var we=ve.transition;ve.transition={};try{Pe()}finally{ve.transition=we}},Tr.unstable_act=ze,Tr.useCallback=function(Pe,we){return Re.current.useCallback(Pe,we)},Tr.useContext=function(Pe){return Re.current.useContext(Pe)},Tr.useDebugValue=function(){},Tr.useDeferredValue=function(Pe){return Re.current.useDeferredValue(Pe)},Tr.useEffect=function(Pe,we){return Re.current.useEffect(Pe,we)},Tr.useId=function(){return Re.current.useId()},Tr.useImperativeHandle=function(Pe,we,ke){return Re.current.useImperativeHandle(Pe,we,ke)},Tr.useInsertionEffect=function(Pe,we){return Re.current.useInsertionEffect(Pe,we)},Tr.useLayoutEffect=function(Pe,we){return Re.current.useLayoutEffect(Pe,we)},Tr.useMemo=function(Pe,we){return Re.current.useMemo(Pe,we)},Tr.useReducer=function(Pe,we,ke){return Re.current.useReducer(Pe,we,ke)},Tr.useRef=function(Pe){return Re.current.useRef(Pe)},Tr.useState=function(Pe){return Re.current.useState(Pe)},Tr.useSyncExternalStore=function(Pe,we,ke){return Re.current.useSyncExternalStore(Pe,we,ke)},Tr.useTransition=function(){return Re.current.useTransition()},Tr.version="18.3.1",Tr}var $7;function Hu(){return $7||($7=1,G2.exports=Tye()),G2.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K7;function wye(){if(K7)return uw;K7=1;var n=Hu(),t=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function f(_,v,b){var C,I={},O=null,L=null;b!==void 0&&(O=""+b),v.key!==void 0&&(O=""+v.key),v.ref!==void 0&&(L=v.ref);for(C in v)a.call(v,C)&&!d.hasOwnProperty(C)&&(I[C]=v[C]);if(_&&_.defaultProps)for(C in v=_.defaultProps,v)I[C]===void 0&&(I[C]=v[C]);return{$$typeof:t,type:_,key:O,ref:L,props:I,_owner:l.current}}return uw.Fragment=i,uw.jsx=f,uw.jsxs=f,uw}var q7;function Cye(){return q7||(q7=1,W2.exports=wye()),W2.exports}var T=Cye(),N=Hu();const hi=Fg(N),Y7=bye({__proto__:null,default:hi},[N]);var sO={},H2={exports:{}},ll={},$2={exports:{}},K2={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X7;function Rye(){return X7||(X7=1,function(n){function t(ve,be){var ze=ve.length;ve.push(be);e:for(;0<ze;){var Pe=ze-1>>>1,we=ve[Pe];if(0<l(we,be))ve[Pe]=be,ve[ze]=we,ze=Pe;else break e}}function i(ve){return ve.length===0?null:ve[0]}function a(ve){if(ve.length===0)return null;var be=ve[0],ze=ve.pop();if(ze!==be){ve[0]=ze;e:for(var Pe=0,we=ve.length,ke=we>>>1;Pe<ke;){var Ue=2*(Pe+1)-1,Be=ve[Ue],qe=Ue+1,$e=ve[qe];if(0>l(Be,ze))qe<we&&0>l($e,Be)?(ve[Pe]=$e,ve[qe]=ze,Pe=qe):(ve[Pe]=Be,ve[Ue]=ze,Pe=Ue);else if(qe<we&&0>l($e,ze))ve[Pe]=$e,ve[qe]=ze,Pe=qe;else break e}}return be}function l(ve,be){var ze=ve.sortIndex-be.sortIndex;return ze!==0?ze:ve.id-be.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;n.unstable_now=function(){return d.now()}}else{var f=Date,_=f.now();n.unstable_now=function(){return f.now()-_}}var v=[],b=[],C=1,I=null,O=3,L=!1,M=!1,F=!1,z=typeof setTimeout=="function"?setTimeout:null,Z=typeof clearTimeout=="function"?clearTimeout:null,K=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function re(ve){for(var be=i(b);be!==null;){if(be.callback===null)a(b);else if(be.startTime<=ve)a(b),be.sortIndex=be.expirationTime,t(v,be);else break;be=i(b)}}function ae(ve){if(F=!1,re(ve),!M)if(i(v)!==null)M=!0,xe(ne);else{var be=i(b);be!==null&&Re(ae,be.startTime-ve)}}function ne(ve,be){M=!1,F&&(F=!1,Z(J),J=-1),L=!0;var ze=O;try{for(re(be),I=i(v);I!==null&&(!(I.expirationTime>be)||ve&&!de());){var Pe=I.callback;if(typeof Pe=="function"){I.callback=null,O=I.priorityLevel;var we=Pe(I.expirationTime<=be);be=n.unstable_now(),typeof we=="function"?I.callback=we:I===i(v)&&a(v),re(be)}else a(v);I=i(v)}if(I!==null)var ke=!0;else{var Ue=i(b);Ue!==null&&Re(ae,Ue.startTime-be),ke=!1}return ke}finally{I=null,O=ze,L=!1}}var pe=!1,X=null,J=-1,Q=5,se=-1;function de(){return!(n.unstable_now()-se<Q)}function he(){if(X!==null){var ve=n.unstable_now();se=ve;var be=!0;try{be=X(!0,ve)}finally{be?le():(pe=!1,X=null)}}else pe=!1}var le;if(typeof K=="function")le=function(){K(he)};else if(typeof MessageChannel<"u"){var Oe=new MessageChannel,Ve=Oe.port2;Oe.port1.onmessage=he,le=function(){Ve.postMessage(null)}}else le=function(){z(he,0)};function xe(ve){X=ve,pe||(pe=!0,le())}function Re(ve,be){J=z(function(){ve(n.unstable_now())},be)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(ve){ve.callback=null},n.unstable_continueExecution=function(){M||L||(M=!0,xe(ne))},n.unstable_forceFrameRate=function(ve){0>ve||125<ve?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<ve?Math.floor(1e3/ve):5},n.unstable_getCurrentPriorityLevel=function(){return O},n.unstable_getFirstCallbackNode=function(){return i(v)},n.unstable_next=function(ve){switch(O){case 1:case 2:case 3:var be=3;break;default:be=O}var ze=O;O=be;try{return ve()}finally{O=ze}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(ve,be){switch(ve){case 1:case 2:case 3:case 4:case 5:break;default:ve=3}var ze=O;O=ve;try{return be()}finally{O=ze}},n.unstable_scheduleCallback=function(ve,be,ze){var Pe=n.unstable_now();switch(typeof ze=="object"&&ze!==null?(ze=ze.delay,ze=typeof ze=="number"&&0<ze?Pe+ze:Pe):ze=Pe,ve){case 1:var we=-1;break;case 2:we=250;break;case 5:we=1073741823;break;case 4:we=1e4;break;default:we=5e3}return we=ze+we,ve={id:C++,callback:be,priorityLevel:ve,startTime:ze,expirationTime:we,sortIndex:-1},ze>Pe?(ve.sortIndex=ze,t(b,ve),i(v)===null&&ve===i(b)&&(F?(Z(J),J=-1):F=!0,Re(ae,ze-Pe))):(ve.sortIndex=we,t(v,ve),M||L||(M=!0,xe(ne))),ve},n.unstable_shouldYield=de,n.unstable_wrapCallback=function(ve){var be=O;return function(){var ze=O;O=be;try{return ve.apply(this,arguments)}finally{O=ze}}}}(K2)),K2}var J7;function Iye(){return J7||(J7=1,$2.exports=Rye()),$2.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q7;function Aye(){if(Q7)return ll;Q7=1;var n=Hu(),t=Iye();function i(p){for(var g="https://reactjs.org/docs/error-decoder.html?invariant="+p,w=1;w<arguments.length;w++)g+="&args[]="+encodeURIComponent(arguments[w]);return"Minified React error #"+p+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function d(p,g){f(p,g),f(p+"Capture",g)}function f(p,g){for(l[p]=g,p=0;p<g.length;p++)a.add(g[p])}var _=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,C={},I={};function O(p){return v.call(I,p)?!0:v.call(C,p)?!1:b.test(p)?I[p]=!0:(C[p]=!0,!1)}function L(p,g,w,k){if(w!==null&&w.type===0)return!1;switch(typeof g){case"function":case"symbol":return!0;case"boolean":return k?!1:w!==null?!w.acceptsBooleans:(p=p.toLowerCase().slice(0,5),p!=="data-"&&p!=="aria-");default:return!1}}function M(p,g,w,k){if(g===null||typeof g>"u"||L(p,g,w,k))return!0;if(k)return!1;if(w!==null)switch(w.type){case 3:return!g;case 4:return g===!1;case 5:return isNaN(g);case 6:return isNaN(g)||1>g}return!1}function F(p,g,w,k,V,H,ue){this.acceptsBooleans=g===2||g===3||g===4,this.attributeName=k,this.attributeNamespace=V,this.mustUseProperty=w,this.propertyName=p,this.type=g,this.sanitizeURL=H,this.removeEmptyString=ue}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(p){z[p]=new F(p,0,!1,p,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(p){var g=p[0];z[g]=new F(g,1,!1,p[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(p){z[p]=new F(p,2,!1,p.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(p){z[p]=new F(p,2,!1,p,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(p){z[p]=new F(p,3,!1,p.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(p){z[p]=new F(p,3,!0,p,null,!1,!1)}),["capture","download"].forEach(function(p){z[p]=new F(p,4,!1,p,null,!1,!1)}),["cols","rows","size","span"].forEach(function(p){z[p]=new F(p,6,!1,p,null,!1,!1)}),["rowSpan","start"].forEach(function(p){z[p]=new F(p,5,!1,p.toLowerCase(),null,!1,!1)});var Z=/[\-:]([a-z])/g;function K(p){return p[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(p){var g=p.replace(Z,K);z[g]=new F(g,1,!1,p,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(p){var g=p.replace(Z,K);z[g]=new F(g,1,!1,p,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(p){var g=p.replace(Z,K);z[g]=new F(g,1,!1,p,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(p){z[p]=new F(p,1,!1,p.toLowerCase(),null,!1,!1)}),z.xlinkHref=new F("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(p){z[p]=new F(p,1,!1,p.toLowerCase(),null,!0,!0)});function re(p,g,w,k){var V=z.hasOwnProperty(g)?z[g]:null;(V!==null?V.type!==0:k||!(2<g.length)||g[0]!=="o"&&g[0]!=="O"||g[1]!=="n"&&g[1]!=="N")&&(M(g,w,V,k)&&(w=null),k||V===null?O(g)&&(w===null?p.removeAttribute(g):p.setAttribute(g,""+w)):V.mustUseProperty?p[V.propertyName]=w===null?V.type===3?!1:"":w:(g=V.attributeName,k=V.attributeNamespace,w===null?p.removeAttribute(g):(V=V.type,w=V===3||V===4&&w===!0?"":""+w,k?p.setAttributeNS(k,g,w):p.setAttribute(g,w))))}var ae=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ne=Symbol.for("react.element"),pe=Symbol.for("react.portal"),X=Symbol.for("react.fragment"),J=Symbol.for("react.strict_mode"),Q=Symbol.for("react.profiler"),se=Symbol.for("react.provider"),de=Symbol.for("react.context"),he=Symbol.for("react.forward_ref"),le=Symbol.for("react.suspense"),Oe=Symbol.for("react.suspense_list"),Ve=Symbol.for("react.memo"),xe=Symbol.for("react.lazy"),Re=Symbol.for("react.offscreen"),ve=Symbol.iterator;function be(p){return p===null||typeof p!="object"?null:(p=ve&&p[ve]||p["@@iterator"],typeof p=="function"?p:null)}var ze=Object.assign,Pe;function we(p){if(Pe===void 0)try{throw Error()}catch(w){var g=w.stack.trim().match(/\n( *(at )?)/);Pe=g&&g[1]||""}return`
`+Pe+p}var ke=!1;function Ue(p,g){if(!p||ke)return"";ke=!0;var w=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(g)if(g=function(){throw Error()},Object.defineProperty(g.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(g,[])}catch(st){var k=st}Reflect.construct(p,[],g)}else{try{g.call()}catch(st){k=st}p.call(g.prototype)}else{try{throw Error()}catch(st){k=st}p()}}catch(st){if(st&&k&&typeof st.stack=="string"){for(var V=st.stack.split(`
`),H=k.stack.split(`
`),ue=V.length-1,Ce=H.length-1;1<=ue&&0<=Ce&&V[ue]!==H[Ce];)Ce--;for(;1<=ue&&0<=Ce;ue--,Ce--)if(V[ue]!==H[Ce]){if(ue!==1||Ce!==1)do if(ue--,Ce--,0>Ce||V[ue]!==H[Ce]){var Me=`
`+V[ue].replace(" at new "," at ");return p.displayName&&Me.includes("<anonymous>")&&(Me=Me.replace("<anonymous>",p.displayName)),Me}while(1<=ue&&0<=Ce);break}}}finally{ke=!1,Error.prepareStackTrace=w}return(p=p?p.displayName||p.name:"")?we(p):""}function Be(p){switch(p.tag){case 5:return we(p.type);case 16:return we("Lazy");case 13:return we("Suspense");case 19:return we("SuspenseList");case 0:case 2:case 15:return p=Ue(p.type,!1),p;case 11:return p=Ue(p.type.render,!1),p;case 1:return p=Ue(p.type,!0),p;default:return""}}function qe(p){if(p==null)return null;if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p;switch(p){case X:return"Fragment";case pe:return"Portal";case Q:return"Profiler";case J:return"StrictMode";case le:return"Suspense";case Oe:return"SuspenseList"}if(typeof p=="object")switch(p.$$typeof){case de:return(p.displayName||"Context")+".Consumer";case se:return(p._context.displayName||"Context")+".Provider";case he:var g=p.render;return p=p.displayName,p||(p=g.displayName||g.name||"",p=p!==""?"ForwardRef("+p+")":"ForwardRef"),p;case Ve:return g=p.displayName||null,g!==null?g:qe(p.type)||"Memo";case xe:g=p._payload,p=p._init;try{return qe(p(g))}catch{}}return null}function $e(p){var g=p.type;switch(p.tag){case 24:return"Cache";case 9:return(g.displayName||"Context")+".Consumer";case 10:return(g._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return p=g.render,p=p.displayName||p.name||"",g.displayName||(p!==""?"ForwardRef("+p+")":"ForwardRef");case 7:return"Fragment";case 5:return g;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return qe(g);case 8:return g===J?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g}return null}function it(p){switch(typeof p){case"boolean":case"number":case"string":case"undefined":return p;case"object":return p;default:return""}}function Je(p){var g=p.type;return(p=p.nodeName)&&p.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function Ct(p){var g=Je(p)?"checked":"value",w=Object.getOwnPropertyDescriptor(p.constructor.prototype,g),k=""+p[g];if(!p.hasOwnProperty(g)&&typeof w<"u"&&typeof w.get=="function"&&typeof w.set=="function"){var V=w.get,H=w.set;return Object.defineProperty(p,g,{configurable:!0,get:function(){return V.call(this)},set:function(ue){k=""+ue,H.call(this,ue)}}),Object.defineProperty(p,g,{enumerable:w.enumerable}),{getValue:function(){return k},setValue:function(ue){k=""+ue},stopTracking:function(){p._valueTracker=null,delete p[g]}}}}function kt(p){p._valueTracker||(p._valueTracker=Ct(p))}function He(p){if(!p)return!1;var g=p._valueTracker;if(!g)return!0;var w=g.getValue(),k="";return p&&(k=Je(p)?p.checked?"true":"false":p.value),p=k,p!==w?(g.setValue(p),!0):!1}function lt(p){if(p=p||(typeof document<"u"?document:void 0),typeof p>"u")return null;try{return p.activeElement||p.body}catch{return p.body}}function mt(p,g){var w=g.checked;return ze({},g,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:w??p._wrapperState.initialChecked})}function Lt(p,g){var w=g.defaultValue==null?"":g.defaultValue,k=g.checked!=null?g.checked:g.defaultChecked;w=it(g.value!=null?g.value:w),p._wrapperState={initialChecked:k,initialValue:w,controlled:g.type==="checkbox"||g.type==="radio"?g.checked!=null:g.value!=null}}function Xt(p,g){g=g.checked,g!=null&&re(p,"checked",g,!1)}function $t(p,g){Xt(p,g);var w=it(g.value),k=g.type;if(w!=null)k==="number"?(w===0&&p.value===""||p.value!=w)&&(p.value=""+w):p.value!==""+w&&(p.value=""+w);else if(k==="submit"||k==="reset"){p.removeAttribute("value");return}g.hasOwnProperty("value")?je(p,g.type,w):g.hasOwnProperty("defaultValue")&&je(p,g.type,it(g.defaultValue)),g.checked==null&&g.defaultChecked!=null&&(p.defaultChecked=!!g.defaultChecked)}function Te(p,g,w){if(g.hasOwnProperty("value")||g.hasOwnProperty("defaultValue")){var k=g.type;if(!(k!=="submit"&&k!=="reset"||g.value!==void 0&&g.value!==null))return;g=""+p._wrapperState.initialValue,w||g===p.value||(p.value=g),p.defaultValue=g}w=p.name,w!==""&&(p.name=""),p.defaultChecked=!!p._wrapperState.initialChecked,w!==""&&(p.name=w)}function je(p,g,w){(g!=="number"||lt(p.ownerDocument)!==p)&&(w==null?p.defaultValue=""+p._wrapperState.initialValue:p.defaultValue!==""+w&&(p.defaultValue=""+w))}var Ke=Array.isArray;function gt(p,g,w,k){if(p=p.options,g){g={};for(var V=0;V<w.length;V++)g["$"+w[V]]=!0;for(w=0;w<p.length;w++)V=g.hasOwnProperty("$"+p[w].value),p[w].selected!==V&&(p[w].selected=V),V&&k&&(p[w].defaultSelected=!0)}else{for(w=""+it(w),g=null,V=0;V<p.length;V++){if(p[V].value===w){p[V].selected=!0,k&&(p[V].defaultSelected=!0);return}g!==null||p[V].disabled||(g=p[V])}g!==null&&(g.selected=!0)}}function Et(p,g){if(g.dangerouslySetInnerHTML!=null)throw Error(i(91));return ze({},g,{value:void 0,defaultValue:void 0,children:""+p._wrapperState.initialValue})}function wt(p,g){var w=g.value;if(w==null){if(w=g.children,g=g.defaultValue,w!=null){if(g!=null)throw Error(i(92));if(Ke(w)){if(1<w.length)throw Error(i(93));w=w[0]}g=w}g==null&&(g=""),w=g}p._wrapperState={initialValue:it(w)}}function Kt(p,g){var w=it(g.value),k=it(g.defaultValue);w!=null&&(w=""+w,w!==p.value&&(p.value=w),g.defaultValue==null&&p.defaultValue!==w&&(p.defaultValue=w)),k!=null&&(p.defaultValue=""+k)}function mn(p){var g=p.textContent;g===p._wrapperState.initialValue&&g!==""&&g!==null&&(p.value=g)}function vn(p){switch(p){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function rn(p,g){return p==null||p==="http://www.w3.org/1999/xhtml"?vn(g):p==="http://www.w3.org/2000/svg"&&g==="foreignObject"?"http://www.w3.org/1999/xhtml":p}var Tt,ir=function(p){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(g,w,k,V){MSApp.execUnsafeLocalFunction(function(){return p(g,w,k,V)})}:p}(function(p,g){if(p.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in p)p.innerHTML=g;else{for(Tt=Tt||document.createElement("div"),Tt.innerHTML="<svg>"+g.valueOf().toString()+"</svg>",g=Tt.firstChild;p.firstChild;)p.removeChild(p.firstChild);for(;g.firstChild;)p.appendChild(g.firstChild)}});function Ut(p,g){if(g){var w=p.firstChild;if(w&&w===p.lastChild&&w.nodeType===3){w.nodeValue=g;return}}p.textContent=g}var Wt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},gn=["Webkit","ms","Moz","O"];Object.keys(Wt).forEach(function(p){gn.forEach(function(g){g=g+p.charAt(0).toUpperCase()+p.substring(1),Wt[g]=Wt[p]})});function Ni(p,g,w){return g==null||typeof g=="boolean"||g===""?"":w||typeof g!="number"||g===0||Wt.hasOwnProperty(p)&&Wt[p]?(""+g).trim():g+"px"}function ys(p,g){p=p.style;for(var w in g)if(g.hasOwnProperty(w)){var k=w.indexOf("--")===0,V=Ni(w,g[w],k);w==="float"&&(w="cssFloat"),k?p.setProperty(w,V):p[w]=V}}var oi=ze({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Zo(p,g){if(g){if(oi[p]&&(g.children!=null||g.dangerouslySetInnerHTML!=null))throw Error(i(137,p));if(g.dangerouslySetInnerHTML!=null){if(g.children!=null)throw Error(i(60));if(typeof g.dangerouslySetInnerHTML!="object"||!("__html"in g.dangerouslySetInnerHTML))throw Error(i(61))}if(g.style!=null&&typeof g.style!="object")throw Error(i(62))}}function cc(p,g){if(p.indexOf("-")===-1)return typeof g.is=="string";switch(p){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var so=null;function oo(p){return p=p.target||p.srcElement||window,p.correspondingUseElement&&(p=p.correspondingUseElement),p.nodeType===3?p.parentNode:p}var Dc=null,Es=null,Da=null;function Mo(p){if(p=_m(p)){if(typeof Dc!="function")throw Error(i(280));var g=p.stateNode;g&&(g=ym(g),Dc(p.stateNode,p.type,g))}}function xa(p){Es?Da?Da.push(p):Da=[p]:Es=p}function lc(){if(Es){var p=Es,g=Da;if(Da=Es=null,Mo(p),g)for(p=0;p<g.length;p++)Mo(g[p])}}function vl(p,g){return p(g)}function La(){}var uc=!1;function _o(p,g,w){if(uc)return p(g,w);uc=!0;try{return vl(p,g,w)}finally{uc=!1,(Es!==null||Da!==null)&&(La(),lc())}}function Di(p,g){var w=p.stateNode;if(w===null)return null;var k=ym(w);if(k===null)return null;w=k[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(k=!k.disabled)||(p=p.type,k=!(p==="button"||p==="input"||p==="select"||p==="textarea")),p=!k;break e;default:p=!1}if(p)return null;if(w&&typeof w!="function")throw Error(i(231,g,typeof w));return w}var vt=!1;if(_)try{var pn={};Object.defineProperty(pn,"passive",{get:function(){vt=!0}}),window.addEventListener("test",pn,pn),window.removeEventListener("test",pn,pn)}catch{vt=!1}function vr(p,g,w,k,V,H,ue,Ce,Me){var st=Array.prototype.slice.call(arguments,3);try{g.apply(w,st)}catch(xt){this.onError(xt)}}var mi=!1,Uo=null,yo=!1,Zl=null,Cp={onError:function(p){mi=!0,Uo=p}};function Sl(p,g,w,k,V,H,ue,Ce,Me){mi=!1,Uo=null,vr.apply(Cp,arguments)}function eu(p,g,w,k,V,H,ue,Ce,Me){if(Sl.apply(this,arguments),mi){if(mi){var st=Uo;mi=!1,Uo=null}else throw Error(i(198));yo||(yo=!0,Zl=st)}}function wi(p){var g=p,w=p;if(p.alternate)for(;g.return;)g=g.return;else{p=g;do g=p,(g.flags&4098)!==0&&(w=g.return),p=g.return;while(p)}return g.tag===3?w:null}function Eo(p){if(p.tag===13){var g=p.memoizedState;if(g===null&&(p=p.alternate,p!==null&&(g=p.memoizedState)),g!==null)return g.dehydrated}return null}function Bi(p){if(wi(p)!==p)throw Error(i(188))}function Xd(p){var g=p.alternate;if(!g){if(g=wi(p),g===null)throw Error(i(188));return g!==p?null:p}for(var w=p,k=g;;){var V=w.return;if(V===null)break;var H=V.alternate;if(H===null){if(k=V.return,k!==null){w=k;continue}break}if(V.child===H.child){for(H=V.child;H;){if(H===w)return Bi(V),p;if(H===k)return Bi(V),g;H=H.sibling}throw Error(i(188))}if(w.return!==k.return)w=V,k=H;else{for(var ue=!1,Ce=V.child;Ce;){if(Ce===w){ue=!0,w=V,k=H;break}if(Ce===k){ue=!0,k=V,w=H;break}Ce=Ce.sibling}if(!ue){for(Ce=H.child;Ce;){if(Ce===w){ue=!0,w=H,k=V;break}if(Ce===k){ue=!0,k=H,w=V;break}Ce=Ce.sibling}if(!ue)throw Error(i(189))}}if(w.alternate!==k)throw Error(i(190))}if(w.tag!==3)throw Error(i(188));return w.stateNode.current===w?p:g}function Jd(p){return p=Xd(p),p!==null?dc(p):null}function dc(p){if(p.tag===5||p.tag===6)return p;for(p=p.child;p!==null;){var g=dc(p);if(g!==null)return g;p=p.sibling}return null}var Qd=t.unstable_scheduleCallback,Qu=t.unstable_cancelCallback,ea=t.unstable_shouldYield,Zd=t.unstable_requestPaint,qr=t.unstable_now,Ci=t.unstable_getCurrentPriorityLevel,xc=t.unstable_ImmediatePriority,bl=t.unstable_UserBlockingPriority,Ma=t.unstable_NormalPriority,Rp=t.unstable_LowPriority,eh=t.unstable_IdlePriority,tu=null,Vo=null;function nm(p){if(Vo&&typeof Vo.onCommitFiberRoot=="function")try{Vo.onCommitFiberRoot(tu,p,void 0,(p.current.flags&128)===128)}catch{}}var vo=Math.clz32?Math.clz32:th,Ip=Math.log,Tl=Math.LN2;function th(p){return p>>>=0,p===0?32:31-(Ip(p)/Tl|0)|0}var nh=64,Sr=4194304;function nu(p){switch(p&-p){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return p&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return p}}function ru(p,g){var w=p.pendingLanes;if(w===0)return 0;var k=0,V=p.suspendedLanes,H=p.pingedLanes,ue=w&268435455;if(ue!==0){var Ce=ue&~V;Ce!==0?k=nu(Ce):(H&=ue,H!==0&&(k=nu(H)))}else ue=w&~V,ue!==0?k=nu(ue):H!==0&&(k=nu(H));if(k===0)return 0;if(g!==0&&g!==k&&(g&V)===0&&(V=k&-k,H=g&-g,V>=H||V===16&&(H&4194240)!==0))return g;if((k&4)!==0&&(k|=w&16),g=p.entangledLanes,g!==0)for(p=p.entanglements,g&=k;0<g;)w=31-vo(g),V=1<<w,k|=p[w],g&=~V;return k}function Zu(p,g){switch(p){case 1:case 2:case 4:return g+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function hc(p,g){for(var w=p.suspendedLanes,k=p.pingedLanes,V=p.expirationTimes,H=p.pendingLanes;0<H;){var ue=31-vo(H),Ce=1<<ue,Me=V[ue];Me===-1?((Ce&w)===0||(Ce&k)!==0)&&(V[ue]=Zu(Ce,g)):Me<=g&&(p.expiredLanes|=Ce),H&=~Ce}}function ta(p){return p=p.pendingLanes&-1073741825,p!==0?p:p&1073741824?1073741824:0}function ed(){var p=nh;return nh<<=1,(nh&4194240)===0&&(nh=64),p}function wl(p){for(var g=[],w=0;31>w;w++)g.push(p);return g}function iu(p,g,w){p.pendingLanes|=g,g!==536870912&&(p.suspendedLanes=0,p.pingedLanes=0),p=p.eventTimes,g=31-vo(g),p[g]=w}function Qr(p,g){var w=p.pendingLanes&~g;p.pendingLanes=g,p.suspendedLanes=0,p.pingedLanes=0,p.expiredLanes&=g,p.mutableReadLanes&=g,p.entangledLanes&=g,g=p.entanglements;var k=p.eventTimes;for(p=p.expirationTimes;0<w;){var V=31-vo(w),H=1<<V;g[V]=0,k[V]=-1,p[V]=-1,w&=~H}}function pc(p,g){var w=p.entangledLanes|=g;for(p=p.entanglements;w;){var k=31-vo(w),V=1<<k;V&g|p[k]&g&&(p[k]|=g),w&=~V}}var ur=0;function Lc(p){return p&=-p,1<p?4<p?(p&268435455)!==0?16:536870912:4:1}var rm,su,rh,Ap,im,Pp=!1,na=[],ds=null,ra=null,ia=null,ou=new Map,sa=new Map,oa=[],sm="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Mc(p,g){switch(p){case"focusin":case"focusout":ds=null;break;case"dragenter":case"dragleave":ra=null;break;case"mouseover":case"mouseout":ia=null;break;case"pointerover":case"pointerout":ou.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":sa.delete(g.pointerId)}}function vs(p,g,w,k,V,H){return p===null||p.nativeEvent!==H?(p={blockedOn:g,domEventName:w,eventSystemFlags:k,nativeEvent:H,targetContainers:[V]},g!==null&&(g=_m(g),g!==null&&su(g)),p):(p.eventSystemFlags|=k,g=p.targetContainers,V!==null&&g.indexOf(V)===-1&&g.push(V),p)}function td(p,g,w,k,V){switch(g){case"focusin":return ds=vs(ds,p,g,w,k,V),!0;case"dragenter":return ra=vs(ra,p,g,w,k,V),!0;case"mouseover":return ia=vs(ia,p,g,w,k,V),!0;case"pointerover":var H=V.pointerId;return ou.set(H,vs(ou.get(H)||null,p,g,w,k,V)),!0;case"gotpointercapture":return H=V.pointerId,sa.set(H,vs(sa.get(H)||null,p,g,w,k,V)),!0}return!1}function Op(p){var g=Vp(p.target);if(g!==null){var w=wi(g);if(w!==null){if(g=w.tag,g===13){if(g=Eo(w),g!==null){p.blockedOn=g,im(p.priority,function(){rh(w)});return}}else if(g===3&&w.stateNode.current.memoizedState.isDehydrated){p.blockedOn=w.tag===3?w.stateNode.containerInfo:null;return}}}p.blockedOn=null}function Cl(p){if(p.blockedOn!==null)return!1;for(var g=p.targetContainers;0<g.length;){var w=Rr(p.domEventName,p.eventSystemFlags,g[0],p.nativeEvent);if(w===null){w=p.nativeEvent;var k=new w.constructor(w.type,w);so=k,w.target.dispatchEvent(k),so=null}else return g=_m(w),g!==null&&su(g),p.blockedOn=w,!1;g.shift()}return!0}function au(p,g,w){Cl(p)&&w.delete(g)}function om(){Pp=!1,ds!==null&&Cl(ds)&&(ds=null),ra!==null&&Cl(ra)&&(ra=null),ia!==null&&Cl(ia)&&(ia=null),ou.forEach(au),sa.forEach(au)}function Ua(p,g){p.blockedOn===g&&(p.blockedOn=null,Pp||(Pp=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,om)))}function Va(p){function g(V){return Ua(V,p)}if(0<na.length){Ua(na[0],p);for(var w=1;w<na.length;w++){var k=na[w];k.blockedOn===p&&(k.blockedOn=null)}}for(ds!==null&&Ua(ds,p),ra!==null&&Ua(ra,p),ia!==null&&Ua(ia,p),ou.forEach(g),sa.forEach(g),w=0;w<oa.length;w++)k=oa[w],k.blockedOn===p&&(k.blockedOn=null);for(;0<oa.length&&(w=oa[0],w.blockedOn===null);)Op(w),w.blockedOn===null&&oa.shift()}var Rl=ae.ReactCurrentBatchConfig,Se=!0;function De(p,g,w,k){var V=ur,H=Rl.transition;Rl.transition=null;try{ur=1,tn(p,g,w,k)}finally{ur=V,Rl.transition=H}}function rt(p,g,w,k){var V=ur,H=Rl.transition;Rl.transition=null;try{ur=4,tn(p,g,w,k)}finally{ur=V,Rl.transition=H}}function tn(p,g,w,k){if(Se){var V=Rr(p,g,w,k);if(V===null)pE(p,g,k,er,w),Mc(p,k);else if(td(V,p,g,w,k))k.stopPropagation();else if(Mc(p,k),g&4&&-1<sm.indexOf(p)){for(;V!==null;){var H=_m(V);if(H!==null&&rm(H),H=Rr(p,g,w,k),H===null&&pE(p,g,k,er,w),H===V)break;V=H}V!==null&&k.stopPropagation()}else pE(p,g,k,null,w)}}var er=null;function Rr(p,g,w,k){if(er=null,p=oo(k),p=Vp(p),p!==null)if(g=wi(p),g===null)p=null;else if(w=g.tag,w===13){if(p=Eo(g),p!==null)return p;p=null}else if(w===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;p=null}else g!==p&&(p=null);return er=p,null}function Yr(p){switch(p){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ci()){case xc:return 1;case bl:return 4;case Ma:case Rp:return 16;case eh:return 536870912;default:return 16}default:return 16}}var fn=null,zr=null,Ri=null;function Ks(){if(Ri)return Ri;var p,g=zr,w=g.length,k,V="value"in fn?fn.value:fn.textContent,H=V.length;for(p=0;p<w&&g[p]===V[p];p++);var ue=w-p;for(k=1;k<=ue&&g[w-k]===V[H-k];k++);return Ri=V.slice(p,1<k?1-k:void 0)}function aa(p){var g=p.keyCode;return"charCode"in p?(p=p.charCode,p===0&&g===13&&(p=13)):p=g,p===10&&(p=13),32<=p||p===13?p:0}function ca(){return!0}function nd(){return!1}function is(p){function g(w,k,V,H,ue){this._reactName=w,this._targetInst=V,this.type=k,this.nativeEvent=H,this.target=ue,this.currentTarget=null;for(var Ce in p)p.hasOwnProperty(Ce)&&(w=p[Ce],this[Ce]=w?w(H):H[Ce]);return this.isDefaultPrevented=(H.defaultPrevented!=null?H.defaultPrevented:H.returnValue===!1)?ca:nd,this.isPropagationStopped=nd,this}return ze(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var w=this.nativeEvent;w&&(w.preventDefault?w.preventDefault():typeof w.returnValue!="unknown"&&(w.returnValue=!1),this.isDefaultPrevented=ca)},stopPropagation:function(){var w=this.nativeEvent;w&&(w.stopPropagation?w.stopPropagation():typeof w.cancelBubble!="unknown"&&(w.cancelBubble=!0),this.isPropagationStopped=ca)},persist:function(){},isPersistent:ca}),g}var Il={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(p){return p.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ih=is(Il),Uc=ze({},Il,{view:0,detail:0}),Kg=is(Uc),am,rd,la,cu=ze({},Uc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Vc,button:0,buttons:0,relatedTarget:function(p){return p.relatedTarget===void 0?p.fromElement===p.srcElement?p.toElement:p.fromElement:p.relatedTarget},movementX:function(p){return"movementX"in p?p.movementX:(p!==la&&(la&&p.type==="mousemove"?(am=p.screenX-la.screenX,rd=p.screenY-la.screenY):rd=am=0,la=p),am)},movementY:function(p){return"movementY"in p?p.movementY:rd}}),cm=is(cu),qg=ze({},cu,{dataTransfer:0}),sE=is(qg),lm=ze({},Uc,{relatedTarget:0}),um=is(lm),id=ze({},Il,{animationName:0,elapsedTime:0,pseudoElement:0}),sd=is(id),od=ze({},Il,{clipboardData:function(p){return"clipboardData"in p?p.clipboardData:window.clipboardData}}),Yg=is(od),oE=ze({},Il,{data:0}),Gn=is(oE),dm={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ua={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},aE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function cE(p){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(p):(p=aE[p])?!!g[p]:!1}function Vc(){return cE}var A=ze({},Uc,{key:function(p){if(p.key){var g=dm[p.key]||p.key;if(g!=="Unidentified")return g}return p.type==="keypress"?(p=aa(p),p===13?"Enter":String.fromCharCode(p)):p.type==="keydown"||p.type==="keyup"?ua[p.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Vc,charCode:function(p){return p.type==="keypress"?aa(p):0},keyCode:function(p){return p.type==="keydown"||p.type==="keyup"?p.keyCode:0},which:function(p){return p.type==="keypress"?aa(p):p.type==="keydown"||p.type==="keyup"?p.keyCode:0}}),W=is(A),ie=ze({},cu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ge=is(ie),Qe=ze({},Uc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Vc}),ut=is(Qe),Gt=ze({},Il,{propertyName:0,elapsedTime:0,pseudoElement:0}),Zr=is(Gt),gi=ze({},cu,{deltaX:function(p){return"deltaX"in p?p.deltaX:"wheelDeltaX"in p?-p.wheelDeltaX:0},deltaY:function(p){return"deltaY"in p?p.deltaY:"wheelDeltaY"in p?-p.wheelDeltaY:"wheelDelta"in p?-p.wheelDelta:0},deltaZ:0,deltaMode:0}),Ir=is(gi),ao=[9,13,27,32],Ss=_&&"CompositionEvent"in window,fc=null;_&&"documentMode"in document&&(fc=document.documentMode);var da=_&&"TextEvent"in window&&!fc,kp=_&&(!Ss||fc&&8<fc&&11>=fc),hm=" ",mc=!1;function vR(p,g){switch(p){case"keyup":return ao.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function SR(p){return p=p.detail,typeof p=="object"&&"data"in p?p.data:null}var pm=!1;function yN(p,g){switch(p){case"compositionend":return SR(g);case"keypress":return g.which!==32?null:(mc=!0,hm);case"textInput":return p=g.data,p===hm&&mc?null:p;default:return null}}function bR(p,g){if(pm)return p==="compositionend"||!Ss&&vR(p,g)?(p=Ks(),Ri=zr=fn=null,pm=!1,p):null;switch(p){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return kp&&g.locale!=="ko"?null:g.data;default:return null}}var EN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function TR(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g==="input"?!!EN[p.type]:g==="textarea"}function q0(p,g,w,k){xa(k),g=fE(g,"onChange"),0<g.length&&(w=new ih("onChange","change",null,w,k),p.push({event:w,listeners:g}))}var Np=null,Xg=null;function vN(p){tb(p,0)}function Dp(p){var g=jp(p);if(He(g))return p}function SN(p,g){if(p==="change")return g}var wR=!1;if(_){var Y0;if(_){var jc="oninput"in document;if(!jc){var CR=document.createElement("div");CR.setAttribute("oninput","return;"),jc=typeof CR.oninput=="function"}Y0=jc}else Y0=!1;wR=Y0&&(!document.documentMode||9<document.documentMode)}function RR(){Np&&(Np.detachEvent("onpropertychange",ja),Xg=Np=null)}function ja(p){if(p.propertyName==="value"&&Dp(Xg)){var g=[];q0(g,Xg,p,oo(p)),_o(vN,g)}}function bN(p,g,w){p==="focusin"?(RR(),Np=g,Xg=w,Np.attachEvent("onpropertychange",ja)):p==="focusout"&&RR()}function TN(p){if(p==="selectionchange"||p==="keyup"||p==="keydown")return Dp(Xg)}function wN(p,g){if(p==="click")return Dp(g)}function CN(p,g){if(p==="input"||p==="change")return Dp(g)}function IR(p,g){return p===g&&(p!==0||1/p===1/g)||p!==p&&g!==g}var Al=typeof Object.is=="function"?Object.is:IR;function Jg(p,g){if(Al(p,g))return!0;if(typeof p!="object"||p===null||typeof g!="object"||g===null)return!1;var w=Object.keys(p),k=Object.keys(g);if(w.length!==k.length)return!1;for(k=0;k<w.length;k++){var V=w[k];if(!v.call(g,V)||!Al(p[V],g[V]))return!1}return!0}function AR(p){for(;p&&p.firstChild;)p=p.firstChild;return p}function X0(p,g){var w=AR(p);p=0;for(var k;w;){if(w.nodeType===3){if(k=p+w.textContent.length,p<=g&&k>=g)return{node:w,offset:g-p};p=k}e:{for(;w;){if(w.nextSibling){w=w.nextSibling;break e}w=w.parentNode}w=void 0}w=AR(w)}}function PR(p,g){return p&&g?p===g?!0:p&&p.nodeType===3?!1:g&&g.nodeType===3?PR(p,g.parentNode):"contains"in p?p.contains(g):p.compareDocumentPosition?!!(p.compareDocumentPosition(g)&16):!1:!1}function OR(){for(var p=window,g=lt();g instanceof p.HTMLIFrameElement;){try{var w=typeof g.contentWindow.location.href=="string"}catch{w=!1}if(w)p=g.contentWindow;else break;g=lt(p.document)}return g}function Qg(p){var g=p&&p.nodeName&&p.nodeName.toLowerCase();return g&&(g==="input"&&(p.type==="text"||p.type==="search"||p.type==="tel"||p.type==="url"||p.type==="password")||g==="textarea"||p.contentEditable==="true")}function J0(p){var g=OR(),w=p.focusedElem,k=p.selectionRange;if(g!==w&&w&&w.ownerDocument&&PR(w.ownerDocument.documentElement,w)){if(k!==null&&Qg(w)){if(g=k.start,p=k.end,p===void 0&&(p=g),"selectionStart"in w)w.selectionStart=g,w.selectionEnd=Math.min(p,w.value.length);else if(p=(g=w.ownerDocument||document)&&g.defaultView||window,p.getSelection){p=p.getSelection();var V=w.textContent.length,H=Math.min(k.start,V);k=k.end===void 0?H:Math.min(k.end,V),!p.extend&&H>k&&(V=k,k=H,H=V),V=X0(w,H);var ue=X0(w,k);V&&ue&&(p.rangeCount!==1||p.anchorNode!==V.node||p.anchorOffset!==V.offset||p.focusNode!==ue.node||p.focusOffset!==ue.offset)&&(g=g.createRange(),g.setStart(V.node,V.offset),p.removeAllRanges(),H>k?(p.addRange(g),p.extend(ue.node,ue.offset)):(g.setEnd(ue.node,ue.offset),p.addRange(g)))}}for(g=[],p=w;p=p.parentNode;)p.nodeType===1&&g.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof w.focus=="function"&&w.focus(),w=0;w<g.length;w++)p=g[w],p.element.scrollLeft=p.left,p.element.scrollTop=p.top}}var RN=_&&"documentMode"in document&&11>=document.documentMode,ct=null,Q0=null,Zg=null,Z0=!1;function kR(p,g,w){var k=w.window===w?w.document:w.nodeType===9?w:w.ownerDocument;Z0||ct==null||ct!==lt(k)||(k=ct,"selectionStart"in k&&Qg(k)?k={start:k.selectionStart,end:k.selectionEnd}:(k=(k.ownerDocument&&k.ownerDocument.defaultView||window).getSelection(),k={anchorNode:k.anchorNode,anchorOffset:k.anchorOffset,focusNode:k.focusNode,focusOffset:k.focusOffset}),Zg&&Jg(Zg,k)||(Zg=k,k=fE(Q0,"onSelect"),0<k.length&&(g=new ih("onSelect","select",null,g,w),p.push({event:g,listeners:k}),g.target=ct)))}function lE(p,g){var w={};return w[p.toLowerCase()]=g.toLowerCase(),w["Webkit"+p]="webkit"+g,w["Moz"+p]="moz"+g,w}var fm={animationend:lE("Animation","AnimationEnd"),animationiteration:lE("Animation","AnimationIteration"),animationstart:lE("Animation","AnimationStart"),transitionend:lE("Transition","TransitionEnd")},eb={},NR={};_&&(NR=document.createElement("div").style,"AnimationEvent"in window||(delete fm.animationend.animation,delete fm.animationiteration.animation,delete fm.animationstart.animation),"TransitionEvent"in window||delete fm.transitionend.transition);function xp(p){if(eb[p])return eb[p];if(!fm[p])return p;var g=fm[p],w;for(w in g)if(g.hasOwnProperty(w)&&w in NR)return eb[p]=g[w];return p}var Lp=xp("animationend"),DR=xp("animationiteration"),xR=xp("animationstart"),LR=xp("transitionend"),MR=new Map,uE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function sh(p,g){MR.set(p,g),d(g,[p])}for(var dE=0;dE<uE.length;dE++){var gc=uE[dE],IN=gc.toLowerCase(),e_=gc[0].toUpperCase()+gc.slice(1);sh(IN,"on"+e_)}sh(Lp,"onAnimationEnd"),sh(DR,"onAnimationIteration"),sh(xR,"onAnimationStart"),sh("dblclick","onDoubleClick"),sh("focusin","onFocus"),sh("focusout","onBlur"),sh(LR,"onTransitionEnd"),f("onMouseEnter",["mouseout","mouseover"]),f("onMouseLeave",["mouseout","mouseover"]),f("onPointerEnter",["pointerout","pointerover"]),f("onPointerLeave",["pointerout","pointerover"]),d("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),d("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),d("onBeforeInput",["compositionend","keypress","textInput","paste"]),d("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),d("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var t_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),AN=new Set("cancel close invalid load scroll toggle".split(" ").concat(t_));function UR(p,g,w){var k=p.type||"unknown-event";p.currentTarget=w,eu(k,g,void 0,p),p.currentTarget=null}function tb(p,g){g=(g&4)!==0;for(var w=0;w<p.length;w++){var k=p[w],V=k.event;k=k.listeners;e:{var H=void 0;if(g)for(var ue=k.length-1;0<=ue;ue--){var Ce=k[ue],Me=Ce.instance,st=Ce.currentTarget;if(Ce=Ce.listener,Me!==H&&V.isPropagationStopped())break e;UR(V,Ce,st),H=Me}else for(ue=0;ue<k.length;ue++){if(Ce=k[ue],Me=Ce.instance,st=Ce.currentTarget,Ce=Ce.listener,Me!==H&&V.isPropagationStopped())break e;UR(V,Ce,st),H=Me}}}if(yo)throw p=Zl,yo=!1,Zl=null,p}function xi(p,g){var w=g[s_];w===void 0&&(w=g[s_]=new Set);var k=p+"__bubble";w.has(k)||(VR(g,p,2,!1),w.add(k))}function nb(p,g,w){var k=0;g&&(k|=4),VR(w,p,k,g)}var hE="_reactListening"+Math.random().toString(36).slice(2);function Mp(p){if(!p[hE]){p[hE]=!0,a.forEach(function(w){w!=="selectionchange"&&(AN.has(w)||nb(w,!1,p),nb(w,!0,p))});var g=p.nodeType===9?p:p.ownerDocument;g===null||g[hE]||(g[hE]=!0,nb("selectionchange",!1,g))}}function VR(p,g,w,k){switch(Yr(g)){case 1:var V=De;break;case 4:V=rt;break;default:V=tn}w=V.bind(null,g,w,p),V=void 0,!vt||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(V=!0),k?V!==void 0?p.addEventListener(g,w,{capture:!0,passive:V}):p.addEventListener(g,w,!0):V!==void 0?p.addEventListener(g,w,{passive:V}):p.addEventListener(g,w,!1)}function pE(p,g,w,k,V){var H=k;if((g&1)===0&&(g&2)===0&&k!==null)e:for(;;){if(k===null)return;var ue=k.tag;if(ue===3||ue===4){var Ce=k.stateNode.containerInfo;if(Ce===V||Ce.nodeType===8&&Ce.parentNode===V)break;if(ue===4)for(ue=k.return;ue!==null;){var Me=ue.tag;if((Me===3||Me===4)&&(Me=ue.stateNode.containerInfo,Me===V||Me.nodeType===8&&Me.parentNode===V))return;ue=ue.return}for(;Ce!==null;){if(ue=Vp(Ce),ue===null)return;if(Me=ue.tag,Me===5||Me===6){k=H=ue;continue e}Ce=Ce.parentNode}}k=k.return}_o(function(){var st=H,xt=oo(w),Mt=[];e:{var Dt=MR.get(p);if(Dt!==void 0){var Zt=ih,an=p;switch(p){case"keypress":if(aa(w)===0)break e;case"keydown":case"keyup":Zt=W;break;case"focusin":an="focus",Zt=um;break;case"focusout":an="blur",Zt=um;break;case"beforeblur":case"afterblur":Zt=um;break;case"click":if(w.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Zt=cm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Zt=sE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Zt=ut;break;case Lp:case DR:case xR:Zt=sd;break;case LR:Zt=Zr;break;case"scroll":Zt=Kg;break;case"wheel":Zt=Ir;break;case"copy":case"cut":case"paste":Zt=Yg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Zt=ge}var cn=(g&4)!==0,os=!cn&&p==="scroll",et=cn?Dt!==null?Dt+"Capture":null:Dt;cn=[];for(var Fe=st,nt;Fe!==null;){nt=Fe;var Ft=nt.stateNode;if(nt.tag===5&&Ft!==null&&(nt=Ft,et!==null&&(Ft=Di(Fe,et),Ft!=null&&cn.push(mm(Fe,Ft,nt)))),os)break;Fe=Fe.return}0<cn.length&&(Dt=new Zt(Dt,an,null,w,xt),Mt.push({event:Dt,listeners:cn}))}}if((g&7)===0){e:{if(Dt=p==="mouseover"||p==="pointerover",Zt=p==="mouseout"||p==="pointerout",Dt&&w!==so&&(an=w.relatedTarget||w.fromElement)&&(Vp(an)||an[Fc]))break e;if((Zt||Dt)&&(Dt=xt.window===xt?xt:(Dt=xt.ownerDocument)?Dt.defaultView||Dt.parentWindow:window,Zt?(an=w.relatedTarget||w.toElement,Zt=st,an=an?Vp(an):null,an!==null&&(os=wi(an),an!==os||an.tag!==5&&an.tag!==6)&&(an=null)):(Zt=null,an=st),Zt!==an)){if(cn=cm,Ft="onMouseLeave",et="onMouseEnter",Fe="mouse",(p==="pointerout"||p==="pointerover")&&(cn=ge,Ft="onPointerLeave",et="onPointerEnter",Fe="pointer"),os=Zt==null?Dt:jp(Zt),nt=an==null?Dt:jp(an),Dt=new cn(Ft,Fe+"leave",Zt,w,xt),Dt.target=os,Dt.relatedTarget=nt,Ft=null,Vp(xt)===st&&(cn=new cn(et,Fe+"enter",an,w,xt),cn.target=nt,cn.relatedTarget=os,Ft=cn),os=Ft,Zt&&an)t:{for(cn=Zt,et=an,Fe=0,nt=cn;nt;nt=Up(nt))Fe++;for(nt=0,Ft=et;Ft;Ft=Up(Ft))nt++;for(;0<Fe-nt;)cn=Up(cn),Fe--;for(;0<nt-Fe;)et=Up(et),nt--;for(;Fe--;){if(cn===et||et!==null&&cn===et.alternate)break t;cn=Up(cn),et=Up(et)}cn=null}else cn=null;Zt!==null&&n_(Mt,Dt,Zt,cn,!1),an!==null&&os!==null&&n_(Mt,os,an,cn,!0)}}e:{if(Dt=st?jp(st):window,Zt=Dt.nodeName&&Dt.nodeName.toLowerCase(),Zt==="select"||Zt==="input"&&Dt.type==="file")var ln=SN;else if(TR(Dt))if(wR)ln=CN;else{ln=TN;var bn=bN}else(Zt=Dt.nodeName)&&Zt.toLowerCase()==="input"&&(Dt.type==="checkbox"||Dt.type==="radio")&&(ln=wN);if(ln&&(ln=ln(p,st))){q0(Mt,ln,w,xt);break e}bn&&bn(p,Dt,st),p==="focusout"&&(bn=Dt._wrapperState)&&bn.controlled&&Dt.type==="number"&&je(Dt,"number",Dt.value)}switch(bn=st?jp(st):window,p){case"focusin":(TR(bn)||bn.contentEditable==="true")&&(ct=bn,Q0=st,Zg=null);break;case"focusout":Zg=Q0=ct=null;break;case"mousedown":Z0=!0;break;case"contextmenu":case"mouseup":case"dragend":Z0=!1,kR(Mt,w,xt);break;case"selectionchange":if(RN)break;case"keydown":case"keyup":kR(Mt,w,xt)}var Rn;if(Ss)e:{switch(p){case"compositionstart":var jn="onCompositionStart";break e;case"compositionend":jn="onCompositionEnd";break e;case"compositionupdate":jn="onCompositionUpdate";break e}jn=void 0}else pm?vR(p,w)&&(jn="onCompositionEnd"):p==="keydown"&&w.keyCode===229&&(jn="onCompositionStart");jn&&(kp&&w.locale!=="ko"&&(pm||jn!=="onCompositionStart"?jn==="onCompositionEnd"&&pm&&(Rn=Ks()):(fn=xt,zr="value"in fn?fn.value:fn.textContent,pm=!0)),bn=fE(st,jn),0<bn.length&&(jn=new Gn(jn,p,null,w,xt),Mt.push({event:jn,listeners:bn}),Rn?jn.data=Rn:(Rn=SR(w),Rn!==null&&(jn.data=Rn)))),(Rn=da?yN(p,w):bR(p,w))&&(st=fE(st,"onBeforeInput"),0<st.length&&(xt=new Gn("onBeforeInput","beforeinput",null,w,xt),Mt.push({event:xt,listeners:st}),xt.data=Rn))}tb(Mt,g)})}function mm(p,g,w){return{instance:p,listener:g,currentTarget:w}}function fE(p,g){for(var w=g+"Capture",k=[];p!==null;){var V=p,H=V.stateNode;V.tag===5&&H!==null&&(V=H,H=Di(p,w),H!=null&&k.unshift(mm(p,H,V)),H=Di(p,g),H!=null&&k.push(mm(p,H,V))),p=p.return}return k}function Up(p){if(p===null)return null;do p=p.return;while(p&&p.tag!==5);return p||null}function n_(p,g,w,k,V){for(var H=g._reactName,ue=[];w!==null&&w!==k;){var Ce=w,Me=Ce.alternate,st=Ce.stateNode;if(Me!==null&&Me===k)break;Ce.tag===5&&st!==null&&(Ce=st,V?(Me=Di(w,H),Me!=null&&ue.unshift(mm(w,Me,Ce))):V||(Me=Di(w,H),Me!=null&&ue.push(mm(w,Me,Ce)))),w=w.return}ue.length!==0&&p.push({event:g,listeners:ue})}var PN=/\r\n?/g,ON=/\u0000|\uFFFD/g;function jR(p){return(typeof p=="string"?p:""+p).replace(PN,`
`).replace(ON,"")}function mE(p,g,w){if(g=jR(g),jR(p)!==g&&w)throw Error(i(425))}function gE(){}var _E=null,r_=null;function rb(p,g){return p==="textarea"||p==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var i_=typeof setTimeout=="function"?setTimeout:void 0,kN=typeof clearTimeout=="function"?clearTimeout:void 0,FR=typeof Promise=="function"?Promise:void 0,NN=typeof queueMicrotask=="function"?queueMicrotask:typeof FR<"u"?function(p){return FR.resolve(null).then(p).catch(DN)}:i_;function DN(p){setTimeout(function(){throw p})}function ib(p,g){var w=g,k=0;do{var V=w.nextSibling;if(p.removeChild(w),V&&V.nodeType===8)if(w=V.data,w==="/$"){if(k===0){p.removeChild(V),Va(g);return}k--}else w!=="$"&&w!=="$?"&&w!=="$!"||k++;w=V}while(w);Va(g)}function oh(p){for(;p!=null;p=p.nextSibling){var g=p.nodeType;if(g===1||g===3)break;if(g===8){if(g=p.data,g==="$"||g==="$!"||g==="$?")break;if(g==="/$")return null}}return p}function BR(p){p=p.previousSibling;for(var g=0;p;){if(p.nodeType===8){var w=p.data;if(w==="$"||w==="$!"||w==="$?"){if(g===0)return p;g--}else w==="/$"&&g++}p=p.previousSibling}return null}var gm=Math.random().toString(36).slice(2),lu="__reactFiber$"+gm,ah="__reactProps$"+gm,Fc="__reactContainer$"+gm,s_="__reactEvents$"+gm,xN="__reactListeners$"+gm,LN="__reactHandles$"+gm;function Vp(p){var g=p[lu];if(g)return g;for(var w=p.parentNode;w;){if(g=w[Fc]||w[lu]){if(w=g.alternate,g.child!==null||w!==null&&w.child!==null)for(p=BR(p);p!==null;){if(w=p[lu])return w;p=BR(p)}return g}p=w,w=p.parentNode}return null}function _m(p){return p=p[lu]||p[Fc],!p||p.tag!==5&&p.tag!==6&&p.tag!==13&&p.tag!==3?null:p}function jp(p){if(p.tag===5||p.tag===6)return p.stateNode;throw Error(i(33))}function ym(p){return p[ah]||null}var sb=[],Em=-1;function Bc(p){return{current:p}}function Li(p){0>Em||(p.current=sb[Em],sb[Em]=null,Em--)}function Ii(p,g){Em++,sb[Em]=p.current,p.current=g}var ch={},jo=Bc(ch),Fa=Bc(!1),Fp=ch;function Bp(p,g){var w=p.type.contextTypes;if(!w)return ch;var k=p.stateNode;if(k&&k.__reactInternalMemoizedUnmaskedChildContext===g)return k.__reactInternalMemoizedMaskedChildContext;var V={},H;for(H in w)V[H]=g[H];return k&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=g,p.__reactInternalMemoizedMaskedChildContext=V),V}function Ba(p){return p=p.childContextTypes,p!=null}function yE(){Li(Fa),Li(jo)}function zR(p,g,w){if(jo.current!==ch)throw Error(i(168));Ii(jo,g),Ii(Fa,w)}function EE(p,g,w){var k=p.stateNode;if(g=g.childContextTypes,typeof k.getChildContext!="function")return w;k=k.getChildContext();for(var V in k)if(!(V in g))throw Error(i(108,$e(p)||"Unknown",V));return ze({},w,k)}function vE(p){return p=(p=p.stateNode)&&p.__reactInternalMemoizedMergedChildContext||ch,Fp=jo.current,Ii(jo,p),Ii(Fa,Fa.current),!0}function WR(p,g,w){var k=p.stateNode;if(!k)throw Error(i(169));w?(p=EE(p,g,Fp),k.__reactInternalMemoizedMergedChildContext=p,Li(Fa),Li(jo),Ii(jo,p)):Li(Fa),Ii(Fa,w)}var zc=null,SE=!1,ob=!1;function GR(p){zc===null?zc=[p]:zc.push(p)}function MN(p){SE=!0,GR(p)}function lh(){if(!ob&&zc!==null){ob=!0;var p=0,g=ur;try{var w=zc;for(ur=1;p<w.length;p++){var k=w[p];do k=k(!0);while(k!==null)}zc=null,SE=!1}catch(V){throw zc!==null&&(zc=zc.slice(p+1)),Qd(xc,lh),V}finally{ur=g,ob=!1}}return null}var vm=[],ad=0,o_=null,bE=0,Wc=[],_c=0,zp=null,cd=1,ld="";function ud(p,g){vm[ad++]=bE,vm[ad++]=o_,o_=p,bE=g}function TE(p,g,w){Wc[_c++]=cd,Wc[_c++]=ld,Wc[_c++]=zp,zp=p;var k=cd;p=ld;var V=32-vo(k)-1;k&=~(1<<V),w+=1;var H=32-vo(g)+V;if(30<H){var ue=V-V%5;H=(k&(1<<ue)-1).toString(32),k>>=ue,V-=ue,cd=1<<32-vo(g)+V|w<<V|k,ld=H+p}else cd=1<<H|w<<V|k,ld=p}function wE(p){p.return!==null&&(ud(p,1),TE(p,1,0))}function a_(p){for(;p===o_;)o_=vm[--ad],vm[ad]=null,bE=vm[--ad],vm[ad]=null;for(;p===zp;)zp=Wc[--_c],Wc[_c]=null,ld=Wc[--_c],Wc[_c]=null,cd=Wc[--_c],Wc[_c]=null}var za=null,Wa=null,_i=!1,ha=null;function HR(p,g){var w=vc(5,null,null,0);w.elementType="DELETED",w.stateNode=g,w.return=p,g=p.deletions,g===null?(p.deletions=[w],p.flags|=16):g.push(w)}function $R(p,g){switch(p.tag){case 5:var w=p.type;return g=g.nodeType!==1||w.toLowerCase()!==g.nodeName.toLowerCase()?null:g,g!==null?(p.stateNode=g,za=p,Wa=oh(g.firstChild),!0):!1;case 6:return g=p.pendingProps===""||g.nodeType!==3?null:g,g!==null?(p.stateNode=g,za=p,Wa=null,!0):!1;case 13:return g=g.nodeType!==8?null:g,g!==null?(w=zp!==null?{id:cd,overflow:ld}:null,p.memoizedState={dehydrated:g,treeContext:w,retryLane:1073741824},w=vc(18,null,null,0),w.stateNode=g,w.return=p,p.child=w,za=p,Wa=null,!0):!1;default:return!1}}function CE(p){return(p.mode&1)!==0&&(p.flags&128)===0}function ab(p){if(_i){var g=Wa;if(g){var w=g;if(!$R(p,g)){if(CE(p))throw Error(i(418));g=oh(w.nextSibling);var k=za;g&&$R(p,g)?HR(k,w):(p.flags=p.flags&-4097|2,_i=!1,za=p)}}else{if(CE(p))throw Error(i(418));p.flags=p.flags&-4097|2,_i=!1,za=p}}}function KR(p){for(p=p.return;p!==null&&p.tag!==5&&p.tag!==3&&p.tag!==13;)p=p.return;za=p}function c_(p){if(p!==za)return!1;if(!_i)return KR(p),_i=!0,!1;var g;if((g=p.tag!==3)&&!(g=p.tag!==5)&&(g=p.type,g=g!=="head"&&g!=="body"&&!rb(p.type,p.memoizedProps)),g&&(g=Wa)){if(CE(p))throw qR(),Error(i(418));for(;g;)HR(p,g),g=oh(g.nextSibling)}if(KR(p),p.tag===13){if(p=p.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));e:{for(p=p.nextSibling,g=0;p;){if(p.nodeType===8){var w=p.data;if(w==="/$"){if(g===0){Wa=oh(p.nextSibling);break e}g--}else w!=="$"&&w!=="$!"&&w!=="$?"||g++}p=p.nextSibling}Wa=null}}else Wa=za?oh(p.stateNode.nextSibling):null;return!0}function qR(){for(var p=Wa;p;)p=oh(p.nextSibling)}function Sm(){Wa=za=null,_i=!1}function cb(p){ha===null?ha=[p]:ha.push(p)}var UN=ae.ReactCurrentBatchConfig;function l_(p,g,w){if(p=w.ref,p!==null&&typeof p!="function"&&typeof p!="object"){if(w._owner){if(w=w._owner,w){if(w.tag!==1)throw Error(i(309));var k=w.stateNode}if(!k)throw Error(i(147,p));var V=k,H=""+p;return g!==null&&g.ref!==null&&typeof g.ref=="function"&&g.ref._stringRef===H?g.ref:(g=function(ue){var Ce=V.refs;ue===null?delete Ce[H]:Ce[H]=ue},g._stringRef=H,g)}if(typeof p!="string")throw Error(i(284));if(!w._owner)throw Error(i(290,p))}return p}function RE(p,g){throw p=Object.prototype.toString.call(g),Error(i(31,p==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":p))}function lb(p){var g=p._init;return g(p._payload)}function uh(p){function g(et,Fe){if(p){var nt=et.deletions;nt===null?(et.deletions=[Fe],et.flags|=16):nt.push(Fe)}}function w(et,Fe){if(!p)return null;for(;Fe!==null;)g(et,Fe),Fe=Fe.sibling;return null}function k(et,Fe){for(et=new Map;Fe!==null;)Fe.key!==null?et.set(Fe.key,Fe):et.set(Fe.index,Fe),Fe=Fe.sibling;return et}function V(et,Fe){return et=yd(et,Fe),et.index=0,et.sibling=null,et}function H(et,Fe,nt){return et.index=nt,p?(nt=et.alternate,nt!==null?(nt=nt.index,nt<Fe?(et.flags|=2,Fe):nt):(et.flags|=2,Fe)):(et.flags|=1048576,Fe)}function ue(et){return p&&et.alternate===null&&(et.flags|=2),et}function Ce(et,Fe,nt,Ft){return Fe===null||Fe.tag!==6?(Fe=$b(nt,et.mode,Ft),Fe.return=et,Fe):(Fe=V(Fe,nt),Fe.return=et,Fe)}function Me(et,Fe,nt,Ft){var ln=nt.type;return ln===X?xt(et,Fe,nt.props.children,Ft,nt.key):Fe!==null&&(Fe.elementType===ln||typeof ln=="object"&&ln!==null&&ln.$$typeof===xe&&lb(ln)===Fe.type)?(Ft=V(Fe,nt.props),Ft.ref=l_(et,Fe,nt),Ft.return=et,Ft):(Ft=hv(nt.type,nt.key,nt.props,null,et.mode,Ft),Ft.ref=l_(et,Fe,nt),Ft.return=et,Ft)}function st(et,Fe,nt,Ft){return Fe===null||Fe.tag!==4||Fe.stateNode.containerInfo!==nt.containerInfo||Fe.stateNode.implementation!==nt.implementation?(Fe=Kb(nt,et.mode,Ft),Fe.return=et,Fe):(Fe=V(Fe,nt.children||[]),Fe.return=et,Fe)}function xt(et,Fe,nt,Ft,ln){return Fe===null||Fe.tag!==7?(Fe=ef(nt,et.mode,Ft,ln),Fe.return=et,Fe):(Fe=V(Fe,nt),Fe.return=et,Fe)}function Mt(et,Fe,nt){if(typeof Fe=="string"&&Fe!==""||typeof Fe=="number")return Fe=$b(""+Fe,et.mode,nt),Fe.return=et,Fe;if(typeof Fe=="object"&&Fe!==null){switch(Fe.$$typeof){case ne:return nt=hv(Fe.type,Fe.key,Fe.props,null,et.mode,nt),nt.ref=l_(et,null,Fe),nt.return=et,nt;case pe:return Fe=Kb(Fe,et.mode,nt),Fe.return=et,Fe;case xe:var Ft=Fe._init;return Mt(et,Ft(Fe._payload),nt)}if(Ke(Fe)||be(Fe))return Fe=ef(Fe,et.mode,nt,null),Fe.return=et,Fe;RE(et,Fe)}return null}function Dt(et,Fe,nt,Ft){var ln=Fe!==null?Fe.key:null;if(typeof nt=="string"&&nt!==""||typeof nt=="number")return ln!==null?null:Ce(et,Fe,""+nt,Ft);if(typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case ne:return nt.key===ln?Me(et,Fe,nt,Ft):null;case pe:return nt.key===ln?st(et,Fe,nt,Ft):null;case xe:return ln=nt._init,Dt(et,Fe,ln(nt._payload),Ft)}if(Ke(nt)||be(nt))return ln!==null?null:xt(et,Fe,nt,Ft,null);RE(et,nt)}return null}function Zt(et,Fe,nt,Ft,ln){if(typeof Ft=="string"&&Ft!==""||typeof Ft=="number")return et=et.get(nt)||null,Ce(Fe,et,""+Ft,ln);if(typeof Ft=="object"&&Ft!==null){switch(Ft.$$typeof){case ne:return et=et.get(Ft.key===null?nt:Ft.key)||null,Me(Fe,et,Ft,ln);case pe:return et=et.get(Ft.key===null?nt:Ft.key)||null,st(Fe,et,Ft,ln);case xe:var bn=Ft._init;return Zt(et,Fe,nt,bn(Ft._payload),ln)}if(Ke(Ft)||be(Ft))return et=et.get(nt)||null,xt(Fe,et,Ft,ln,null);RE(Fe,Ft)}return null}function an(et,Fe,nt,Ft){for(var ln=null,bn=null,Rn=Fe,jn=Fe=0,Rs=null;Rn!==null&&jn<nt.length;jn++){Rn.index>jn?(Rs=Rn,Rn=null):Rs=Rn.sibling;var Ar=Dt(et,Rn,nt[jn],Ft);if(Ar===null){Rn===null&&(Rn=Rs);break}p&&Rn&&Ar.alternate===null&&g(et,Rn),Fe=H(Ar,Fe,jn),bn===null?ln=Ar:bn.sibling=Ar,bn=Ar,Rn=Rs}if(jn===nt.length)return w(et,Rn),_i&&ud(et,jn),ln;if(Rn===null){for(;jn<nt.length;jn++)Rn=Mt(et,nt[jn],Ft),Rn!==null&&(Fe=H(Rn,Fe,jn),bn===null?ln=Rn:bn.sibling=Rn,bn=Rn);return _i&&ud(et,jn),ln}for(Rn=k(et,Rn);jn<nt.length;jn++)Rs=Zt(Rn,et,jn,nt[jn],Ft),Rs!==null&&(p&&Rs.alternate!==null&&Rn.delete(Rs.key===null?jn:Rs.key),Fe=H(Rs,Fe,jn),bn===null?ln=Rs:bn.sibling=Rs,bn=Rs);return p&&Rn.forEach(function(Sh){return g(et,Sh)}),_i&&ud(et,jn),ln}function cn(et,Fe,nt,Ft){var ln=be(nt);if(typeof ln!="function")throw Error(i(150));if(nt=ln.call(nt),nt==null)throw Error(i(151));for(var bn=ln=null,Rn=Fe,jn=Fe=0,Rs=null,Ar=nt.next();Rn!==null&&!Ar.done;jn++,Ar=nt.next()){Rn.index>jn?(Rs=Rn,Rn=null):Rs=Rn.sibling;var Sh=Dt(et,Rn,Ar.value,Ft);if(Sh===null){Rn===null&&(Rn=Rs);break}p&&Rn&&Sh.alternate===null&&g(et,Rn),Fe=H(Sh,Fe,jn),bn===null?ln=Sh:bn.sibling=Sh,bn=Sh,Rn=Rs}if(Ar.done)return w(et,Rn),_i&&ud(et,jn),ln;if(Rn===null){for(;!Ar.done;jn++,Ar=nt.next())Ar=Mt(et,Ar.value,Ft),Ar!==null&&(Fe=H(Ar,Fe,jn),bn===null?ln=Ar:bn.sibling=Ar,bn=Ar);return _i&&ud(et,jn),ln}for(Rn=k(et,Rn);!Ar.done;jn++,Ar=nt.next())Ar=Zt(Rn,et,jn,Ar.value,Ft),Ar!==null&&(p&&Ar.alternate!==null&&Rn.delete(Ar.key===null?jn:Ar.key),Fe=H(Ar,Fe,jn),bn===null?ln=Ar:bn.sibling=Ar,bn=Ar);return p&&Rn.forEach(function(ZN){return g(et,ZN)}),_i&&ud(et,jn),ln}function os(et,Fe,nt,Ft){if(typeof nt=="object"&&nt!==null&&nt.type===X&&nt.key===null&&(nt=nt.props.children),typeof nt=="object"&&nt!==null){switch(nt.$$typeof){case ne:e:{for(var ln=nt.key,bn=Fe;bn!==null;){if(bn.key===ln){if(ln=nt.type,ln===X){if(bn.tag===7){w(et,bn.sibling),Fe=V(bn,nt.props.children),Fe.return=et,et=Fe;break e}}else if(bn.elementType===ln||typeof ln=="object"&&ln!==null&&ln.$$typeof===xe&&lb(ln)===bn.type){w(et,bn.sibling),Fe=V(bn,nt.props),Fe.ref=l_(et,bn,nt),Fe.return=et,et=Fe;break e}w(et,bn);break}else g(et,bn);bn=bn.sibling}nt.type===X?(Fe=ef(nt.props.children,et.mode,Ft,nt.key),Fe.return=et,et=Fe):(Ft=hv(nt.type,nt.key,nt.props,null,et.mode,Ft),Ft.ref=l_(et,Fe,nt),Ft.return=et,et=Ft)}return ue(et);case pe:e:{for(bn=nt.key;Fe!==null;){if(Fe.key===bn)if(Fe.tag===4&&Fe.stateNode.containerInfo===nt.containerInfo&&Fe.stateNode.implementation===nt.implementation){w(et,Fe.sibling),Fe=V(Fe,nt.children||[]),Fe.return=et,et=Fe;break e}else{w(et,Fe);break}else g(et,Fe);Fe=Fe.sibling}Fe=Kb(nt,et.mode,Ft),Fe.return=et,et=Fe}return ue(et);case xe:return bn=nt._init,os(et,Fe,bn(nt._payload),Ft)}if(Ke(nt))return an(et,Fe,nt,Ft);if(be(nt))return cn(et,Fe,nt,Ft);RE(et,nt)}return typeof nt=="string"&&nt!==""||typeof nt=="number"?(nt=""+nt,Fe!==null&&Fe.tag===6?(w(et,Fe.sibling),Fe=V(Fe,nt),Fe.return=et,et=Fe):(w(et,Fe),Fe=$b(nt,et.mode,Ft),Fe.return=et,et=Fe),ue(et)):w(et,Fe)}return os}var bm=uh(!0),YR=uh(!1),IE=Bc(null),u_=null,Tm=null,AE=null;function ub(){AE=Tm=u_=null}function db(p){var g=IE.current;Li(IE),p._currentValue=g}function hb(p,g,w){for(;p!==null;){var k=p.alternate;if((p.childLanes&g)!==g?(p.childLanes|=g,k!==null&&(k.childLanes|=g)):k!==null&&(k.childLanes&g)!==g&&(k.childLanes|=g),p===w)break;p=p.return}}function dd(p,g){u_=p,AE=Tm=null,p=p.dependencies,p!==null&&p.firstContext!==null&&((p.lanes&g)!==0&&(Ha=!0),p.firstContext=null)}function Gc(p){var g=p._currentValue;if(AE!==p)if(p={context:p,memoizedValue:g,next:null},Tm===null){if(u_===null)throw Error(i(308));Tm=p,u_.dependencies={lanes:0,firstContext:p}}else Tm=Tm.next=p;return g}var Wp=null;function pb(p){Wp===null?Wp=[p]:Wp.push(p)}function XR(p,g,w,k){var V=g.interleaved;return V===null?(w.next=w,pb(g)):(w.next=V.next,V.next=w),g.interleaved=w,hd(p,k)}function hd(p,g){p.lanes|=g;var w=p.alternate;for(w!==null&&(w.lanes|=g),w=p,p=p.return;p!==null;)p.childLanes|=g,w=p.alternate,w!==null&&(w.childLanes|=g),w=p,p=p.return;return w.tag===3?w.stateNode:null}var dh=!1;function d_(p){p.updateQueue={baseState:p.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function JR(p,g){p=p.updateQueue,g.updateQueue===p&&(g.updateQueue={baseState:p.baseState,firstBaseUpdate:p.firstBaseUpdate,lastBaseUpdate:p.lastBaseUpdate,shared:p.shared,effects:p.effects})}function uu(p,g){return{eventTime:p,lane:g,tag:0,payload:null,callback:null,next:null}}function hh(p,g,w){var k=p.updateQueue;if(k===null)return null;if(k=k.shared,(xr&2)!==0){var V=k.pending;return V===null?g.next=g:(g.next=V.next,V.next=g),k.pending=g,hd(p,w)}return V=k.interleaved,V===null?(g.next=g,pb(k)):(g.next=V.next,V.next=g),k.interleaved=g,hd(p,w)}function h_(p,g,w){if(g=g.updateQueue,g!==null&&(g=g.shared,(w&4194240)!==0)){var k=g.lanes;k&=p.pendingLanes,w|=k,g.lanes=w,pc(p,w)}}function QR(p,g){var w=p.updateQueue,k=p.alternate;if(k!==null&&(k=k.updateQueue,w===k)){var V=null,H=null;if(w=w.firstBaseUpdate,w!==null){do{var ue={eventTime:w.eventTime,lane:w.lane,tag:w.tag,payload:w.payload,callback:w.callback,next:null};H===null?V=H=ue:H=H.next=ue,w=w.next}while(w!==null);H===null?V=H=g:H=H.next=g}else V=H=g;w={baseState:k.baseState,firstBaseUpdate:V,lastBaseUpdate:H,shared:k.shared,effects:k.effects},p.updateQueue=w;return}p=w.lastBaseUpdate,p===null?w.firstBaseUpdate=g:p.next=g,w.lastBaseUpdate=g}function PE(p,g,w,k){var V=p.updateQueue;dh=!1;var H=V.firstBaseUpdate,ue=V.lastBaseUpdate,Ce=V.shared.pending;if(Ce!==null){V.shared.pending=null;var Me=Ce,st=Me.next;Me.next=null,ue===null?H=st:ue.next=st,ue=Me;var xt=p.alternate;xt!==null&&(xt=xt.updateQueue,Ce=xt.lastBaseUpdate,Ce!==ue&&(Ce===null?xt.firstBaseUpdate=st:Ce.next=st,xt.lastBaseUpdate=Me))}if(H!==null){var Mt=V.baseState;ue=0,xt=st=Me=null,Ce=H;do{var Dt=Ce.lane,Zt=Ce.eventTime;if((k&Dt)===Dt){xt!==null&&(xt=xt.next={eventTime:Zt,lane:0,tag:Ce.tag,payload:Ce.payload,callback:Ce.callback,next:null});e:{var an=p,cn=Ce;switch(Dt=g,Zt=w,cn.tag){case 1:if(an=cn.payload,typeof an=="function"){Mt=an.call(Zt,Mt,Dt);break e}Mt=an;break e;case 3:an.flags=an.flags&-65537|128;case 0:if(an=cn.payload,Dt=typeof an=="function"?an.call(Zt,Mt,Dt):an,Dt==null)break e;Mt=ze({},Mt,Dt);break e;case 2:dh=!0}}Ce.callback!==null&&Ce.lane!==0&&(p.flags|=64,Dt=V.effects,Dt===null?V.effects=[Ce]:Dt.push(Ce))}else Zt={eventTime:Zt,lane:Dt,tag:Ce.tag,payload:Ce.payload,callback:Ce.callback,next:null},xt===null?(st=xt=Zt,Me=Mt):xt=xt.next=Zt,ue|=Dt;if(Ce=Ce.next,Ce===null){if(Ce=V.shared.pending,Ce===null)break;Dt=Ce,Ce=Dt.next,Dt.next=null,V.lastBaseUpdate=Dt,V.shared.pending=null}}while(!0);if(xt===null&&(Me=Mt),V.baseState=Me,V.firstBaseUpdate=st,V.lastBaseUpdate=xt,g=V.shared.interleaved,g!==null){V=g;do ue|=V.lane,V=V.next;while(V!==g)}else H===null&&(V.shared.lanes=0);Yp|=ue,p.lanes=ue,p.memoizedState=Mt}}function ZR(p,g,w){if(p=g.effects,g.effects=null,p!==null)for(g=0;g<p.length;g++){var k=p[g],V=k.callback;if(V!==null){if(k.callback=null,k=w,typeof V!="function")throw Error(i(191,V));V.call(k)}}}var p_={},du=Bc(p_),f_=Bc(p_),wm=Bc(p_);function Gp(p){if(p===p_)throw Error(i(174));return p}function fb(p,g){switch(Ii(wm,g),Ii(f_,p),Ii(du,p_),p=g.nodeType,p){case 9:case 11:g=(g=g.documentElement)?g.namespaceURI:rn(null,"");break;default:p=p===8?g.parentNode:g,g=p.namespaceURI||null,p=p.tagName,g=rn(g,p)}Li(du),Ii(du,g)}function Hp(){Li(du),Li(f_),Li(wm)}function eI(p){Gp(wm.current);var g=Gp(du.current),w=rn(g,p.type);g!==w&&(Ii(f_,p),Ii(du,w))}function Cm(p){f_.current===p&&(Li(du),Li(f_))}var zi=Bc(0);function ph(p){for(var g=p;g!==null;){if(g.tag===13){var w=g.memoizedState;if(w!==null&&(w=w.dehydrated,w===null||w.data==="$?"||w.data==="$!"))return g}else if(g.tag===19&&g.memoizedProps.revealOrder!==void 0){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var mb=[];function gb(){for(var p=0;p<mb.length;p++)mb[p]._workInProgressVersionPrimary=null;mb.length=0}var OE=ae.ReactCurrentDispatcher,_b=ae.ReactCurrentBatchConfig,hu=0,Ki=null,bs=null,Ts=null,Rm=!1,m_=!1,g_=0,VN=0;function Fo(){throw Error(i(321))}function yb(p,g){if(g===null)return!1;for(var w=0;w<g.length&&w<p.length;w++)if(!Al(p[w],g[w]))return!1;return!0}function Im(p,g,w,k,V,H){if(hu=H,Ki=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,OE.current=p===null||p.memoizedState===null?BN:dI,p=w(k,V),m_){H=0;do{if(m_=!1,g_=0,25<=H)throw Error(i(301));H+=1,Ts=bs=null,g.updateQueue=null,OE.current=zN,p=w(k,V)}while(m_)}if(OE.current=xE,g=bs!==null&&bs.next!==null,hu=0,Ts=bs=Ki=null,Rm=!1,g)throw Error(i(300));return p}function Eb(){var p=g_!==0;return g_=0,p}function pa(){var p={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ts===null?Ki.memoizedState=Ts=p:Ts=Ts.next=p,Ts}function Ga(){if(bs===null){var p=Ki.alternate;p=p!==null?p.memoizedState:null}else p=bs.next;var g=Ts===null?Ki.memoizedState:Ts.next;if(g!==null)Ts=g,bs=p;else{if(p===null)throw Error(i(310));bs=p,p={memoizedState:bs.memoizedState,baseState:bs.baseState,baseQueue:bs.baseQueue,queue:bs.queue,next:null},Ts===null?Ki.memoizedState=Ts=p:Ts=Ts.next=p}return Ts}function fh(p,g){return typeof g=="function"?g(p):g}function $p(p){var g=Ga(),w=g.queue;if(w===null)throw Error(i(311));w.lastRenderedReducer=p;var k=bs,V=k.baseQueue,H=w.pending;if(H!==null){if(V!==null){var ue=V.next;V.next=H.next,H.next=ue}k.baseQueue=V=H,w.pending=null}if(V!==null){H=V.next,k=k.baseState;var Ce=ue=null,Me=null,st=H;do{var xt=st.lane;if((hu&xt)===xt)Me!==null&&(Me=Me.next={lane:0,action:st.action,hasEagerState:st.hasEagerState,eagerState:st.eagerState,next:null}),k=st.hasEagerState?st.eagerState:p(k,st.action);else{var Mt={lane:xt,action:st.action,hasEagerState:st.hasEagerState,eagerState:st.eagerState,next:null};Me===null?(Ce=Me=Mt,ue=k):Me=Me.next=Mt,Ki.lanes|=xt,Yp|=xt}st=st.next}while(st!==null&&st!==H);Me===null?ue=k:Me.next=Ce,Al(k,g.memoizedState)||(Ha=!0),g.memoizedState=k,g.baseState=ue,g.baseQueue=Me,w.lastRenderedState=k}if(p=w.interleaved,p!==null){V=p;do H=V.lane,Ki.lanes|=H,Yp|=H,V=V.next;while(V!==p)}else V===null&&(w.lanes=0);return[g.memoizedState,w.dispatch]}function Am(p){var g=Ga(),w=g.queue;if(w===null)throw Error(i(311));w.lastRenderedReducer=p;var k=w.dispatch,V=w.pending,H=g.memoizedState;if(V!==null){w.pending=null;var ue=V=V.next;do H=p(H,ue.action),ue=ue.next;while(ue!==V);Al(H,g.memoizedState)||(Ha=!0),g.memoizedState=H,g.baseQueue===null&&(g.baseState=H),w.lastRenderedState=H}return[H,k]}function tI(){}function vb(p,g){var w=Ki,k=Ga(),V=g(),H=!Al(k.memoizedState,V);if(H&&(k.memoizedState=V,Ha=!0),k=k.queue,Hc(rI.bind(null,w,k,p),[p]),k.getSnapshot!==g||H||Ts!==null&&Ts.memoizedState.tag&1){if(w.flags|=2048,__(9,Sb.bind(null,w,k,V,g),void 0,null),co===null)throw Error(i(349));(hu&30)!==0||nI(w,g,V)}return V}function nI(p,g,w){p.flags|=16384,p={getSnapshot:g,value:w},g=Ki.updateQueue,g===null?(g={lastEffect:null,stores:null},Ki.updateQueue=g,g.stores=[p]):(w=g.stores,w===null?g.stores=[p]:w.push(p))}function Sb(p,g,w,k){g.value=w,g.getSnapshot=k,iI(g)&&kE(p)}function rI(p,g,w){return w(function(){iI(g)&&kE(p)})}function iI(p){var g=p.getSnapshot;p=p.value;try{var w=g();return!Al(p,w)}catch{return!0}}function kE(p){var g=hd(p,1);g!==null&&Yc(g,p,1,-1)}function NE(p){var g=pa();return typeof p=="function"&&(p=p()),g.memoizedState=g.baseState=p,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:fh,lastRenderedState:p},g.queue=p,p=p.dispatch=FN.bind(null,Ki,p),[g.memoizedState,p]}function __(p,g,w,k){return p={tag:p,create:g,destroy:w,deps:k,next:null},g=Ki.updateQueue,g===null?(g={lastEffect:null,stores:null},Ki.updateQueue=g,g.lastEffect=p.next=p):(w=g.lastEffect,w===null?g.lastEffect=p.next=p:(k=w.next,w.next=p,p.next=k,g.lastEffect=p)),p}function sI(){return Ga().memoizedState}function y_(p,g,w,k){var V=pa();Ki.flags|=p,V.memoizedState=__(1|g,w,void 0,k===void 0?null:k)}function Pm(p,g,w,k){var V=Ga();k=k===void 0?null:k;var H=void 0;if(bs!==null){var ue=bs.memoizedState;if(H=ue.destroy,k!==null&&yb(k,ue.deps)){V.memoizedState=__(g,w,H,k);return}}Ki.flags|=p,V.memoizedState=__(1|g,w,H,k)}function oI(p,g){return y_(8390656,8,p,g)}function Hc(p,g){return Pm(2048,8,p,g)}function Kp(p,g){return Pm(4,2,p,g)}function mh(p,g){return Pm(4,4,p,g)}function bb(p,g){if(typeof g=="function")return p=p(),g(p),function(){g(null)};if(g!=null)return p=p(),g.current=p,function(){g.current=null}}function Tb(p,g,w){return w=w!=null?w.concat([p]):null,Pm(4,4,bb.bind(null,g,p),w)}function pd(){}function DE(p,g){var w=Ga();g=g===void 0?null:g;var k=w.memoizedState;return k!==null&&g!==null&&yb(g,k[1])?k[0]:(w.memoizedState=[p,g],p)}function aI(p,g){var w=Ga();g=g===void 0?null:g;var k=w.memoizedState;return k!==null&&g!==null&&yb(g,k[1])?k[0]:(p=p(),w.memoizedState=[p,g],p)}function wb(p,g,w){return(hu&21)===0?(p.baseState&&(p.baseState=!1,Ha=!0),p.memoizedState=w):(Al(w,g)||(w=ed(),Ki.lanes|=w,Yp|=w,p.baseState=!0),g)}function jN(p,g){var w=ur;ur=w!==0&&4>w?w:4,p(!0);var k=_b.transition;_b.transition={};try{p(!1),g()}finally{ur=w,_b.transition=k}}function Cb(){return Ga().memoizedState}function cI(p,g,w){var k=qc(p);if(w={lane:k,action:w,hasEagerState:!1,eagerState:null,next:null},fd(p))lI(g,w);else if(w=XR(p,g,w,k),w!==null){var V=To();Yc(w,p,k,V),uI(w,g,k)}}function FN(p,g,w){var k=qc(p),V={lane:k,action:w,hasEagerState:!1,eagerState:null,next:null};if(fd(p))lI(g,V);else{var H=p.alternate;if(p.lanes===0&&(H===null||H.lanes===0)&&(H=g.lastRenderedReducer,H!==null))try{var ue=g.lastRenderedState,Ce=H(ue,w);if(V.hasEagerState=!0,V.eagerState=Ce,Al(Ce,ue)){var Me=g.interleaved;Me===null?(V.next=V,pb(g)):(V.next=Me.next,Me.next=V),g.interleaved=V;return}}catch{}finally{}w=XR(p,g,V,k),w!==null&&(V=To(),Yc(w,p,k,V),uI(w,g,k))}}function fd(p){var g=p.alternate;return p===Ki||g!==null&&g===Ki}function lI(p,g){m_=Rm=!0;var w=p.pending;w===null?g.next=g:(g.next=w.next,w.next=g),p.pending=g}function uI(p,g,w){if((w&4194240)!==0){var k=g.lanes;k&=p.pendingLanes,w|=k,g.lanes=w,pc(p,w)}}var xE={readContext:Gc,useCallback:Fo,useContext:Fo,useEffect:Fo,useImperativeHandle:Fo,useInsertionEffect:Fo,useLayoutEffect:Fo,useMemo:Fo,useReducer:Fo,useRef:Fo,useState:Fo,useDebugValue:Fo,useDeferredValue:Fo,useTransition:Fo,useMutableSource:Fo,useSyncExternalStore:Fo,useId:Fo,unstable_isNewReconciler:!1},BN={readContext:Gc,useCallback:function(p,g){return pa().memoizedState=[p,g===void 0?null:g],p},useContext:Gc,useEffect:oI,useImperativeHandle:function(p,g,w){return w=w!=null?w.concat([p]):null,y_(4194308,4,bb.bind(null,g,p),w)},useLayoutEffect:function(p,g){return y_(4194308,4,p,g)},useInsertionEffect:function(p,g){return y_(4,2,p,g)},useMemo:function(p,g){var w=pa();return g=g===void 0?null:g,p=p(),w.memoizedState=[p,g],p},useReducer:function(p,g,w){var k=pa();return g=w!==void 0?w(g):g,k.memoizedState=k.baseState=g,p={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:p,lastRenderedState:g},k.queue=p,p=p.dispatch=cI.bind(null,Ki,p),[k.memoizedState,p]},useRef:function(p){var g=pa();return p={current:p},g.memoizedState=p},useState:NE,useDebugValue:pd,useDeferredValue:function(p){return pa().memoizedState=p},useTransition:function(){var p=NE(!1),g=p[0];return p=jN.bind(null,p[1]),pa().memoizedState=p,[g,p]},useMutableSource:function(){},useSyncExternalStore:function(p,g,w){var k=Ki,V=pa();if(_i){if(w===void 0)throw Error(i(407));w=w()}else{if(w=g(),co===null)throw Error(i(349));(hu&30)!==0||nI(k,g,w)}V.memoizedState=w;var H={value:w,getSnapshot:g};return V.queue=H,oI(rI.bind(null,k,H,p),[p]),k.flags|=2048,__(9,Sb.bind(null,k,H,w,g),void 0,null),w},useId:function(){var p=pa(),g=co.identifierPrefix;if(_i){var w=ld,k=cd;w=(k&~(1<<32-vo(k)-1)).toString(32)+w,g=":"+g+"R"+w,w=g_++,0<w&&(g+="H"+w.toString(32)),g+=":"}else w=VN++,g=":"+g+"r"+w.toString(32)+":";return p.memoizedState=g},unstable_isNewReconciler:!1},dI={readContext:Gc,useCallback:DE,useContext:Gc,useEffect:Hc,useImperativeHandle:Tb,useInsertionEffect:Kp,useLayoutEffect:mh,useMemo:aI,useReducer:$p,useRef:sI,useState:function(){return $p(fh)},useDebugValue:pd,useDeferredValue:function(p){var g=Ga();return wb(g,bs.memoizedState,p)},useTransition:function(){var p=$p(fh)[0],g=Ga().memoizedState;return[p,g]},useMutableSource:tI,useSyncExternalStore:vb,useId:Cb,unstable_isNewReconciler:!1},zN={readContext:Gc,useCallback:DE,useContext:Gc,useEffect:Hc,useImperativeHandle:Tb,useInsertionEffect:Kp,useLayoutEffect:mh,useMemo:aI,useReducer:Am,useRef:sI,useState:function(){return Am(fh)},useDebugValue:pd,useDeferredValue:function(p){var g=Ga();return bs===null?g.memoizedState=p:wb(g,bs.memoizedState,p)},useTransition:function(){var p=Am(fh)[0],g=Ga().memoizedState;return[p,g]},useMutableSource:tI,useSyncExternalStore:vb,useId:Cb,unstable_isNewReconciler:!1};function yc(p,g){if(p&&p.defaultProps){g=ze({},g),p=p.defaultProps;for(var w in p)g[w]===void 0&&(g[w]=p[w]);return g}return g}function LE(p,g,w,k){g=p.memoizedState,w=w(k,g),w=w==null?g:ze({},g,w),p.memoizedState=w,p.lanes===0&&(p.updateQueue.baseState=w)}var ME={isMounted:function(p){return(p=p._reactInternals)?wi(p)===p:!1},enqueueSetState:function(p,g,w){p=p._reactInternals;var k=To(),V=qc(p),H=uu(k,V);H.payload=g,w!=null&&(H.callback=w),g=hh(p,H,V),g!==null&&(Yc(g,p,V,k),h_(g,p,V))},enqueueReplaceState:function(p,g,w){p=p._reactInternals;var k=To(),V=qc(p),H=uu(k,V);H.tag=1,H.payload=g,w!=null&&(H.callback=w),g=hh(p,H,V),g!==null&&(Yc(g,p,V,k),h_(g,p,V))},enqueueForceUpdate:function(p,g){p=p._reactInternals;var w=To(),k=qc(p),V=uu(w,k);V.tag=2,g!=null&&(V.callback=g),g=hh(p,V,k),g!==null&&(Yc(g,p,k,w),h_(g,p,k))}};function Rb(p,g,w,k,V,H,ue){return p=p.stateNode,typeof p.shouldComponentUpdate=="function"?p.shouldComponentUpdate(k,H,ue):g.prototype&&g.prototype.isPureReactComponent?!Jg(w,k)||!Jg(V,H):!0}function hI(p,g,w){var k=!1,V=ch,H=g.contextType;return typeof H=="object"&&H!==null?H=Gc(H):(V=Ba(g)?Fp:jo.current,k=g.contextTypes,H=(k=k!=null)?Bp(p,V):ch),g=new g(w,H),p.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=ME,p.stateNode=g,g._reactInternals=p,k&&(p=p.stateNode,p.__reactInternalMemoizedUnmaskedChildContext=V,p.__reactInternalMemoizedMaskedChildContext=H),g}function pI(p,g,w,k){p=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(w,k),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(w,k),g.state!==p&&ME.enqueueReplaceState(g,g.state,null)}function Ib(p,g,w,k){var V=p.stateNode;V.props=w,V.state=p.memoizedState,V.refs={},d_(p);var H=g.contextType;typeof H=="object"&&H!==null?V.context=Gc(H):(H=Ba(g)?Fp:jo.current,V.context=Bp(p,H)),V.state=p.memoizedState,H=g.getDerivedStateFromProps,typeof H=="function"&&(LE(p,g,H,w),V.state=p.memoizedState),typeof g.getDerivedStateFromProps=="function"||typeof V.getSnapshotBeforeUpdate=="function"||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(g=V.state,typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount(),g!==V.state&&ME.enqueueReplaceState(V,V.state,null),PE(p,w,V,k),V.state=p.memoizedState),typeof V.componentDidMount=="function"&&(p.flags|=4194308)}function Om(p,g){try{var w="",k=g;do w+=Be(k),k=k.return;while(k);var V=w}catch(H){V=`
Error generating stack: `+H.message+`
`+H.stack}return{value:p,source:g,stack:V,digest:null}}function Ab(p,g,w){return{value:p,source:null,stack:w??null,digest:g??null}}function Pb(p,g){try{console.error(g.value)}catch(w){setTimeout(function(){throw w})}}var WN=typeof WeakMap=="function"?WeakMap:Map;function Ob(p,g,w){w=uu(-1,w),w.tag=3,w.payload={element:null};var k=g.value;return w.callback=function(){ev||(ev=!0,Bb=k),Pb(p,g)},w}function md(p,g,w){w=uu(-1,w),w.tag=3;var k=p.type.getDerivedStateFromError;if(typeof k=="function"){var V=g.value;w.payload=function(){return k(V)},w.callback=function(){Pb(p,g)}}var H=p.stateNode;return H!==null&&typeof H.componentDidCatch=="function"&&(w.callback=function(){Pb(p,g),typeof k!="function"&&(gh===null?gh=new Set([this]):gh.add(this));var ue=g.stack;this.componentDidCatch(g.value,{componentStack:ue!==null?ue:""})}),w}function fI(p,g,w){var k=p.pingCache;if(k===null){k=p.pingCache=new WN;var V=new Set;k.set(g,V)}else V=k.get(g),V===void 0&&(V=new Set,k.set(g,V));V.has(w)||(V.add(w),p=VI.bind(null,p,g,w),g.then(p,p))}function mI(p){do{var g;if((g=p.tag===13)&&(g=p.memoizedState,g=g!==null?g.dehydrated!==null:!0),g)return p;p=p.return}while(p!==null);return null}function gI(p,g,w,k,V){return(p.mode&1)===0?(p===g?p.flags|=65536:(p.flags|=128,w.flags|=131072,w.flags&=-52805,w.tag===1&&(w.alternate===null?w.tag=17:(g=uu(-1,1),g.tag=2,hh(w,g,1))),w.lanes|=1),p):(p.flags|=65536,p.lanes=V,p)}var GN=ae.ReactCurrentOwner,Ha=!1;function fa(p,g,w,k){g.child=p===null?YR(g,null,w,k):bm(g,p.child,w,k)}function UE(p,g,w,k,V){w=w.render;var H=g.ref;return dd(g,V),k=Im(p,g,w,k,H,V),w=Eb(),p!==null&&!Ha?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~V,pu(p,g,V)):(_i&&w&&wE(g),g.flags|=1,fa(p,g,k,V),g.child)}function _I(p,g,w,k,V){if(p===null){var H=w.type;return typeof H=="function"&&!yh(H)&&H.defaultProps===void 0&&w.compare===null&&w.defaultProps===void 0?(g.tag=15,g.type=H,yI(p,g,H,k,V)):(p=hv(w.type,null,k,g,g.mode,V),p.ref=g.ref,p.return=g,g.child=p)}if(H=p.child,(p.lanes&V)===0){var ue=H.memoizedProps;if(w=w.compare,w=w!==null?w:Jg,w(ue,k)&&p.ref===g.ref)return pu(p,g,V)}return g.flags|=1,p=yd(H,k),p.ref=g.ref,p.return=g,g.child=p}function yI(p,g,w,k,V){if(p!==null){var H=p.memoizedProps;if(Jg(H,k)&&p.ref===g.ref)if(Ha=!1,g.pendingProps=k=H,(p.lanes&V)!==0)(p.flags&131072)!==0&&(Ha=!0);else return g.lanes=p.lanes,pu(p,g,V)}return kb(p,g,w,k,V)}function EI(p,g,w){var k=g.pendingProps,V=k.children,H=p!==null?p.memoizedState:null;if(k.mode==="hidden")if((g.mode&1)===0)g.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ii(Pl,Ec),Ec|=w;else{if((w&1073741824)===0)return p=H!==null?H.baseLanes|w:w,g.lanes=g.childLanes=1073741824,g.memoizedState={baseLanes:p,cachePool:null,transitions:null},g.updateQueue=null,Ii(Pl,Ec),Ec|=p,null;g.memoizedState={baseLanes:0,cachePool:null,transitions:null},k=H!==null?H.baseLanes:w,Ii(Pl,Ec),Ec|=k}else H!==null?(k=H.baseLanes|w,g.memoizedState=null):k=w,Ii(Pl,Ec),Ec|=k;return fa(p,g,V,w),g.child}function vI(p,g){var w=g.ref;(p===null&&w!==null||p!==null&&p.ref!==w)&&(g.flags|=512,g.flags|=2097152)}function kb(p,g,w,k,V){var H=Ba(w)?Fp:jo.current;return H=Bp(g,H),dd(g,V),w=Im(p,g,w,k,H,V),k=Eb(),p!==null&&!Ha?(g.updateQueue=p.updateQueue,g.flags&=-2053,p.lanes&=~V,pu(p,g,V)):(_i&&k&&wE(g),g.flags|=1,fa(p,g,w,V),g.child)}function SI(p,g,w,k,V){if(Ba(w)){var H=!0;vE(g)}else H=!1;if(dd(g,V),g.stateNode===null)WE(p,g),hI(g,w,k),Ib(g,w,k,V),k=!0;else if(p===null){var ue=g.stateNode,Ce=g.memoizedProps;ue.props=Ce;var Me=ue.context,st=w.contextType;typeof st=="object"&&st!==null?st=Gc(st):(st=Ba(w)?Fp:jo.current,st=Bp(g,st));var xt=w.getDerivedStateFromProps,Mt=typeof xt=="function"||typeof ue.getSnapshotBeforeUpdate=="function";Mt||typeof ue.UNSAFE_componentWillReceiveProps!="function"&&typeof ue.componentWillReceiveProps!="function"||(Ce!==k||Me!==st)&&pI(g,ue,k,st),dh=!1;var Dt=g.memoizedState;ue.state=Dt,PE(g,k,ue,V),Me=g.memoizedState,Ce!==k||Dt!==Me||Fa.current||dh?(typeof xt=="function"&&(LE(g,w,xt,k),Me=g.memoizedState),(Ce=dh||Rb(g,w,Ce,k,Dt,Me,st))?(Mt||typeof ue.UNSAFE_componentWillMount!="function"&&typeof ue.componentWillMount!="function"||(typeof ue.componentWillMount=="function"&&ue.componentWillMount(),typeof ue.UNSAFE_componentWillMount=="function"&&ue.UNSAFE_componentWillMount()),typeof ue.componentDidMount=="function"&&(g.flags|=4194308)):(typeof ue.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=k,g.memoizedState=Me),ue.props=k,ue.state=Me,ue.context=st,k=Ce):(typeof ue.componentDidMount=="function"&&(g.flags|=4194308),k=!1)}else{ue=g.stateNode,JR(p,g),Ce=g.memoizedProps,st=g.type===g.elementType?Ce:yc(g.type,Ce),ue.props=st,Mt=g.pendingProps,Dt=ue.context,Me=w.contextType,typeof Me=="object"&&Me!==null?Me=Gc(Me):(Me=Ba(w)?Fp:jo.current,Me=Bp(g,Me));var Zt=w.getDerivedStateFromProps;(xt=typeof Zt=="function"||typeof ue.getSnapshotBeforeUpdate=="function")||typeof ue.UNSAFE_componentWillReceiveProps!="function"&&typeof ue.componentWillReceiveProps!="function"||(Ce!==Mt||Dt!==Me)&&pI(g,ue,k,Me),dh=!1,Dt=g.memoizedState,ue.state=Dt,PE(g,k,ue,V);var an=g.memoizedState;Ce!==Mt||Dt!==an||Fa.current||dh?(typeof Zt=="function"&&(LE(g,w,Zt,k),an=g.memoizedState),(st=dh||Rb(g,w,st,k,Dt,an,Me)||!1)?(xt||typeof ue.UNSAFE_componentWillUpdate!="function"&&typeof ue.componentWillUpdate!="function"||(typeof ue.componentWillUpdate=="function"&&ue.componentWillUpdate(k,an,Me),typeof ue.UNSAFE_componentWillUpdate=="function"&&ue.UNSAFE_componentWillUpdate(k,an,Me)),typeof ue.componentDidUpdate=="function"&&(g.flags|=4),typeof ue.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof ue.componentDidUpdate!="function"||Ce===p.memoizedProps&&Dt===p.memoizedState||(g.flags|=4),typeof ue.getSnapshotBeforeUpdate!="function"||Ce===p.memoizedProps&&Dt===p.memoizedState||(g.flags|=1024),g.memoizedProps=k,g.memoizedState=an),ue.props=k,ue.state=an,ue.context=Me,k=st):(typeof ue.componentDidUpdate!="function"||Ce===p.memoizedProps&&Dt===p.memoizedState||(g.flags|=4),typeof ue.getSnapshotBeforeUpdate!="function"||Ce===p.memoizedProps&&Dt===p.memoizedState||(g.flags|=1024),k=!1)}return VE(p,g,w,k,H,V)}function VE(p,g,w,k,V,H){vI(p,g);var ue=(g.flags&128)!==0;if(!k&&!ue)return V&&WR(g,w,!1),pu(p,g,H);k=g.stateNode,GN.current=g;var Ce=ue&&typeof w.getDerivedStateFromError!="function"?null:k.render();return g.flags|=1,p!==null&&ue?(g.child=bm(g,p.child,null,H),g.child=bm(g,null,Ce,H)):fa(p,g,Ce,H),g.memoizedState=k.state,V&&WR(g,w,!0),g.child}function Nb(p){var g=p.stateNode;g.pendingContext?zR(p,g.pendingContext,g.pendingContext!==g.context):g.context&&zR(p,g.context,!1),fb(p,g.containerInfo)}function bI(p,g,w,k,V){return Sm(),cb(V),g.flags|=256,fa(p,g,w,k),g.child}var Db={dehydrated:null,treeContext:null,retryLane:0};function km(p){return{baseLanes:p,cachePool:null,transitions:null}}function jE(p,g,w){var k=g.pendingProps,V=zi.current,H=!1,ue=(g.flags&128)!==0,Ce;if((Ce=ue)||(Ce=p!==null&&p.memoizedState===null?!1:(V&2)!==0),Ce?(H=!0,g.flags&=-129):(p===null||p.memoizedState!==null)&&(V|=1),Ii(zi,V&1),p===null)return ab(g),p=g.memoizedState,p!==null&&(p=p.dehydrated,p!==null)?((g.mode&1)===0?g.lanes=1:p.data==="$!"?g.lanes=8:g.lanes=1073741824,null):(ue=k.children,p=k.fallback,H?(k=g.mode,H=g.child,ue={mode:"hidden",children:ue},(k&1)===0&&H!==null?(H.childLanes=0,H.pendingProps=ue):H=Eh(ue,k,0,null),p=ef(p,k,w,null),H.return=g,p.return=g,H.sibling=p,g.child=H,g.child.memoizedState=km(w),g.memoizedState=Db,p):FE(g,ue));if(V=p.memoizedState,V!==null&&(Ce=V.dehydrated,Ce!==null))return TI(p,g,ue,k,Ce,V,w);if(H){H=k.fallback,ue=g.mode,V=p.child,Ce=V.sibling;var Me={mode:"hidden",children:k.children};return(ue&1)===0&&g.child!==V?(k=g.child,k.childLanes=0,k.pendingProps=Me,g.deletions=null):(k=yd(V,Me),k.subtreeFlags=V.subtreeFlags&14680064),Ce!==null?H=yd(Ce,H):(H=ef(H,ue,w,null),H.flags|=2),H.return=g,k.return=g,k.sibling=H,g.child=k,k=H,H=g.child,ue=p.child.memoizedState,ue=ue===null?km(w):{baseLanes:ue.baseLanes|w,cachePool:null,transitions:ue.transitions},H.memoizedState=ue,H.childLanes=p.childLanes&~w,g.memoizedState=Db,k}return H=p.child,p=H.sibling,k=yd(H,{mode:"visible",children:k.children}),(g.mode&1)===0&&(k.lanes=w),k.return=g,k.sibling=null,p!==null&&(w=g.deletions,w===null?(g.deletions=[p],g.flags|=16):w.push(p)),g.child=k,g.memoizedState=null,k}function FE(p,g){return g=Eh({mode:"visible",children:g},p.mode,0,null),g.return=p,p.child=g}function qp(p,g,w,k){return k!==null&&cb(k),bm(g,p.child,null,w),p=FE(g,g.pendingProps.children),p.flags|=2,g.memoizedState=null,p}function TI(p,g,w,k,V,H,ue){if(w)return g.flags&256?(g.flags&=-257,k=Ab(Error(i(422))),qp(p,g,ue,k)):g.memoizedState!==null?(g.child=p.child,g.flags|=128,null):(H=k.fallback,V=g.mode,k=Eh({mode:"visible",children:k.children},V,0,null),H=ef(H,V,ue,null),H.flags|=2,k.return=g,H.return=g,k.sibling=H,g.child=k,(g.mode&1)!==0&&bm(g,p.child,null,ue),g.child.memoizedState=km(ue),g.memoizedState=Db,H);if((g.mode&1)===0)return qp(p,g,ue,null);if(V.data==="$!"){if(k=V.nextSibling&&V.nextSibling.dataset,k)var Ce=k.dgst;return k=Ce,H=Error(i(419)),k=Ab(H,k,void 0),qp(p,g,ue,k)}if(Ce=(ue&p.childLanes)!==0,Ha||Ce){if(k=co,k!==null){switch(ue&-ue){case 4:V=2;break;case 16:V=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:V=32;break;case 536870912:V=268435456;break;default:V=0}V=(V&(k.suspendedLanes|ue))!==0?0:V,V!==0&&V!==H.retryLane&&(H.retryLane=V,hd(p,V),Yc(k,p,V,-1))}return Gb(),k=Ab(Error(i(421))),qp(p,g,ue,k)}return V.data==="$?"?(g.flags|=128,g.child=p.child,g=lv.bind(null,p),V._reactRetry=g,null):(p=H.treeContext,Wa=oh(V.nextSibling),za=g,_i=!0,ha=null,p!==null&&(Wc[_c++]=cd,Wc[_c++]=ld,Wc[_c++]=zp,cd=p.id,ld=p.overflow,zp=g),g=FE(g,k.children),g.flags|=4096,g)}function wI(p,g,w){p.lanes|=g;var k=p.alternate;k!==null&&(k.lanes|=g),hb(p.return,g,w)}function BE(p,g,w,k,V){var H=p.memoizedState;H===null?p.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:k,tail:w,tailMode:V}:(H.isBackwards=g,H.rendering=null,H.renderingStartTime=0,H.last=k,H.tail=w,H.tailMode=V)}function zE(p,g,w){var k=g.pendingProps,V=k.revealOrder,H=k.tail;if(fa(p,g,k.children,w),k=zi.current,(k&2)!==0)k=k&1|2,g.flags|=128;else{if(p!==null&&(p.flags&128)!==0)e:for(p=g.child;p!==null;){if(p.tag===13)p.memoizedState!==null&&wI(p,w,g);else if(p.tag===19)wI(p,w,g);else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===g)break e;for(;p.sibling===null;){if(p.return===null||p.return===g)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}k&=1}if(Ii(zi,k),(g.mode&1)===0)g.memoizedState=null;else switch(V){case"forwards":for(w=g.child,V=null;w!==null;)p=w.alternate,p!==null&&ph(p)===null&&(V=w),w=w.sibling;w=V,w===null?(V=g.child,g.child=null):(V=w.sibling,w.sibling=null),BE(g,!1,V,w,H);break;case"backwards":for(w=null,V=g.child,g.child=null;V!==null;){if(p=V.alternate,p!==null&&ph(p)===null){g.child=V;break}p=V.sibling,V.sibling=w,w=V,V=p}BE(g,!0,w,null,H);break;case"together":BE(g,!1,null,null,void 0);break;default:g.memoizedState=null}return g.child}function WE(p,g){(g.mode&1)===0&&p!==null&&(p.alternate=null,g.alternate=null,g.flags|=2)}function pu(p,g,w){if(p!==null&&(g.dependencies=p.dependencies),Yp|=g.lanes,(w&g.childLanes)===0)return null;if(p!==null&&g.child!==p.child)throw Error(i(153));if(g.child!==null){for(p=g.child,w=yd(p,p.pendingProps),g.child=w,w.return=g;p.sibling!==null;)p=p.sibling,w=w.sibling=yd(p,p.pendingProps),w.return=g;w.sibling=null}return g.child}function CI(p,g,w){switch(g.tag){case 3:Nb(g),Sm();break;case 5:eI(g);break;case 1:Ba(g.type)&&vE(g);break;case 4:fb(g,g.stateNode.containerInfo);break;case 10:var k=g.type._context,V=g.memoizedProps.value;Ii(IE,k._currentValue),k._currentValue=V;break;case 13:if(k=g.memoizedState,k!==null)return k.dehydrated!==null?(Ii(zi,zi.current&1),g.flags|=128,null):(w&g.child.childLanes)!==0?jE(p,g,w):(Ii(zi,zi.current&1),p=pu(p,g,w),p!==null?p.sibling:null);Ii(zi,zi.current&1);break;case 19:if(k=(w&g.childLanes)!==0,(p.flags&128)!==0){if(k)return zE(p,g,w);g.flags|=128}if(V=g.memoizedState,V!==null&&(V.rendering=null,V.tail=null,V.lastEffect=null),Ii(zi,zi.current),k)break;return null;case 22:case 23:return g.lanes=0,EI(p,g,w)}return pu(p,g,w)}var RI,GE,xb,II;RI=function(p,g){for(var w=g.child;w!==null;){if(w.tag===5||w.tag===6)p.appendChild(w.stateNode);else if(w.tag!==4&&w.child!==null){w.child.return=w,w=w.child;continue}if(w===g)break;for(;w.sibling===null;){if(w.return===null||w.return===g)return;w=w.return}w.sibling.return=w.return,w=w.sibling}},GE=function(){},xb=function(p,g,w,k){var V=p.memoizedProps;if(V!==k){p=g.stateNode,Gp(du.current);var H=null;switch(w){case"input":V=mt(p,V),k=mt(p,k),H=[];break;case"select":V=ze({},V,{value:void 0}),k=ze({},k,{value:void 0}),H=[];break;case"textarea":V=Et(p,V),k=Et(p,k),H=[];break;default:typeof V.onClick!="function"&&typeof k.onClick=="function"&&(p.onclick=gE)}Zo(w,k);var ue;w=null;for(st in V)if(!k.hasOwnProperty(st)&&V.hasOwnProperty(st)&&V[st]!=null)if(st==="style"){var Ce=V[st];for(ue in Ce)Ce.hasOwnProperty(ue)&&(w||(w={}),w[ue]="")}else st!=="dangerouslySetInnerHTML"&&st!=="children"&&st!=="suppressContentEditableWarning"&&st!=="suppressHydrationWarning"&&st!=="autoFocus"&&(l.hasOwnProperty(st)?H||(H=[]):(H=H||[]).push(st,null));for(st in k){var Me=k[st];if(Ce=V!=null?V[st]:void 0,k.hasOwnProperty(st)&&Me!==Ce&&(Me!=null||Ce!=null))if(st==="style")if(Ce){for(ue in Ce)!Ce.hasOwnProperty(ue)||Me&&Me.hasOwnProperty(ue)||(w||(w={}),w[ue]="");for(ue in Me)Me.hasOwnProperty(ue)&&Ce[ue]!==Me[ue]&&(w||(w={}),w[ue]=Me[ue])}else w||(H||(H=[]),H.push(st,w)),w=Me;else st==="dangerouslySetInnerHTML"?(Me=Me?Me.__html:void 0,Ce=Ce?Ce.__html:void 0,Me!=null&&Ce!==Me&&(H=H||[]).push(st,Me)):st==="children"?typeof Me!="string"&&typeof Me!="number"||(H=H||[]).push(st,""+Me):st!=="suppressContentEditableWarning"&&st!=="suppressHydrationWarning"&&(l.hasOwnProperty(st)?(Me!=null&&st==="onScroll"&&xi("scroll",p),H||Ce===Me||(H=[])):(H=H||[]).push(st,Me))}w&&(H=H||[]).push("style",w);var st=H;(g.updateQueue=st)&&(g.flags|=4)}},II=function(p,g,w,k){w!==k&&(g.flags|=4)};function E_(p,g){if(!_i)switch(p.tailMode){case"hidden":g=p.tail;for(var w=null;g!==null;)g.alternate!==null&&(w=g),g=g.sibling;w===null?p.tail=null:w.sibling=null;break;case"collapsed":w=p.tail;for(var k=null;w!==null;)w.alternate!==null&&(k=w),w=w.sibling;k===null?g||p.tail===null?p.tail=null:p.tail.sibling=null:k.sibling=null}}function Bo(p){var g=p.alternate!==null&&p.alternate.child===p.child,w=0,k=0;if(g)for(var V=p.child;V!==null;)w|=V.lanes|V.childLanes,k|=V.subtreeFlags&14680064,k|=V.flags&14680064,V.return=p,V=V.sibling;else for(V=p.child;V!==null;)w|=V.lanes|V.childLanes,k|=V.subtreeFlags,k|=V.flags,V.return=p,V=V.sibling;return p.subtreeFlags|=k,p.childLanes=w,g}function HE(p,g,w){var k=g.pendingProps;switch(a_(g),g.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Bo(g),null;case 1:return Ba(g.type)&&yE(),Bo(g),null;case 3:return k=g.stateNode,Hp(),Li(Fa),Li(jo),gb(),k.pendingContext&&(k.context=k.pendingContext,k.pendingContext=null),(p===null||p.child===null)&&(c_(g)?g.flags|=4:p===null||p.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,ha!==null&&(sv(ha),ha=null))),GE(p,g),Bo(g),null;case 5:Cm(g);var V=Gp(wm.current);if(w=g.type,p!==null&&g.stateNode!=null)xb(p,g,w,k,V),p.ref!==g.ref&&(g.flags|=512,g.flags|=2097152);else{if(!k){if(g.stateNode===null)throw Error(i(166));return Bo(g),null}if(p=Gp(du.current),c_(g)){k=g.stateNode,w=g.type;var H=g.memoizedProps;switch(k[lu]=g,k[ah]=H,p=(g.mode&1)!==0,w){case"dialog":xi("cancel",k),xi("close",k);break;case"iframe":case"object":case"embed":xi("load",k);break;case"video":case"audio":for(V=0;V<t_.length;V++)xi(t_[V],k);break;case"source":xi("error",k);break;case"img":case"image":case"link":xi("error",k),xi("load",k);break;case"details":xi("toggle",k);break;case"input":Lt(k,H),xi("invalid",k);break;case"select":k._wrapperState={wasMultiple:!!H.multiple},xi("invalid",k);break;case"textarea":wt(k,H),xi("invalid",k)}Zo(w,H),V=null;for(var ue in H)if(H.hasOwnProperty(ue)){var Ce=H[ue];ue==="children"?typeof Ce=="string"?k.textContent!==Ce&&(H.suppressHydrationWarning!==!0&&mE(k.textContent,Ce,p),V=["children",Ce]):typeof Ce=="number"&&k.textContent!==""+Ce&&(H.suppressHydrationWarning!==!0&&mE(k.textContent,Ce,p),V=["children",""+Ce]):l.hasOwnProperty(ue)&&Ce!=null&&ue==="onScroll"&&xi("scroll",k)}switch(w){case"input":kt(k),Te(k,H,!0);break;case"textarea":kt(k),mn(k);break;case"select":case"option":break;default:typeof H.onClick=="function"&&(k.onclick=gE)}k=V,g.updateQueue=k,k!==null&&(g.flags|=4)}else{ue=V.nodeType===9?V:V.ownerDocument,p==="http://www.w3.org/1999/xhtml"&&(p=vn(w)),p==="http://www.w3.org/1999/xhtml"?w==="script"?(p=ue.createElement("div"),p.innerHTML="<script><\/script>",p=p.removeChild(p.firstChild)):typeof k.is=="string"?p=ue.createElement(w,{is:k.is}):(p=ue.createElement(w),w==="select"&&(ue=p,k.multiple?ue.multiple=!0:k.size&&(ue.size=k.size))):p=ue.createElementNS(p,w),p[lu]=g,p[ah]=k,RI(p,g,!1,!1),g.stateNode=p;e:{switch(ue=cc(w,k),w){case"dialog":xi("cancel",p),xi("close",p),V=k;break;case"iframe":case"object":case"embed":xi("load",p),V=k;break;case"video":case"audio":for(V=0;V<t_.length;V++)xi(t_[V],p);V=k;break;case"source":xi("error",p),V=k;break;case"img":case"image":case"link":xi("error",p),xi("load",p),V=k;break;case"details":xi("toggle",p),V=k;break;case"input":Lt(p,k),V=mt(p,k),xi("invalid",p);break;case"option":V=k;break;case"select":p._wrapperState={wasMultiple:!!k.multiple},V=ze({},k,{value:void 0}),xi("invalid",p);break;case"textarea":wt(p,k),V=Et(p,k),xi("invalid",p);break;default:V=k}Zo(w,V),Ce=V;for(H in Ce)if(Ce.hasOwnProperty(H)){var Me=Ce[H];H==="style"?ys(p,Me):H==="dangerouslySetInnerHTML"?(Me=Me?Me.__html:void 0,Me!=null&&ir(p,Me)):H==="children"?typeof Me=="string"?(w!=="textarea"||Me!=="")&&Ut(p,Me):typeof Me=="number"&&Ut(p,""+Me):H!=="suppressContentEditableWarning"&&H!=="suppressHydrationWarning"&&H!=="autoFocus"&&(l.hasOwnProperty(H)?Me!=null&&H==="onScroll"&&xi("scroll",p):Me!=null&&re(p,H,Me,ue))}switch(w){case"input":kt(p),Te(p,k,!1);break;case"textarea":kt(p),mn(p);break;case"option":k.value!=null&&p.setAttribute("value",""+it(k.value));break;case"select":p.multiple=!!k.multiple,H=k.value,H!=null?gt(p,!!k.multiple,H,!1):k.defaultValue!=null&&gt(p,!!k.multiple,k.defaultValue,!0);break;default:typeof V.onClick=="function"&&(p.onclick=gE)}switch(w){case"button":case"input":case"select":case"textarea":k=!!k.autoFocus;break e;case"img":k=!0;break e;default:k=!1}}k&&(g.flags|=4)}g.ref!==null&&(g.flags|=512,g.flags|=2097152)}return Bo(g),null;case 6:if(p&&g.stateNode!=null)II(p,g,p.memoizedProps,k);else{if(typeof k!="string"&&g.stateNode===null)throw Error(i(166));if(w=Gp(wm.current),Gp(du.current),c_(g)){if(k=g.stateNode,w=g.memoizedProps,k[lu]=g,(H=k.nodeValue!==w)&&(p=za,p!==null))switch(p.tag){case 3:mE(k.nodeValue,w,(p.mode&1)!==0);break;case 5:p.memoizedProps.suppressHydrationWarning!==!0&&mE(k.nodeValue,w,(p.mode&1)!==0)}H&&(g.flags|=4)}else k=(w.nodeType===9?w:w.ownerDocument).createTextNode(k),k[lu]=g,g.stateNode=k}return Bo(g),null;case 13:if(Li(zi),k=g.memoizedState,p===null||p.memoizedState!==null&&p.memoizedState.dehydrated!==null){if(_i&&Wa!==null&&(g.mode&1)!==0&&(g.flags&128)===0)qR(),Sm(),g.flags|=98560,H=!1;else if(H=c_(g),k!==null&&k.dehydrated!==null){if(p===null){if(!H)throw Error(i(318));if(H=g.memoizedState,H=H!==null?H.dehydrated:null,!H)throw Error(i(317));H[lu]=g}else Sm(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;Bo(g),H=!1}else ha!==null&&(sv(ha),ha=null),H=!0;if(!H)return g.flags&65536?g:null}return(g.flags&128)!==0?(g.lanes=w,g):(k=k!==null,k!==(p!==null&&p.memoizedState!==null)&&k&&(g.child.flags|=8192,(g.mode&1)!==0&&(p===null||(zi.current&1)!==0?Cs===0&&(Cs=3):Gb())),g.updateQueue!==null&&(g.flags|=4),Bo(g),null);case 4:return Hp(),GE(p,g),p===null&&Mp(g.stateNode.containerInfo),Bo(g),null;case 10:return db(g.type._context),Bo(g),null;case 17:return Ba(g.type)&&yE(),Bo(g),null;case 19:if(Li(zi),H=g.memoizedState,H===null)return Bo(g),null;if(k=(g.flags&128)!==0,ue=H.rendering,ue===null)if(k)E_(H,!1);else{if(Cs!==0||p!==null&&(p.flags&128)!==0)for(p=g.child;p!==null;){if(ue=ph(p),ue!==null){for(g.flags|=128,E_(H,!1),k=ue.updateQueue,k!==null&&(g.updateQueue=k,g.flags|=4),g.subtreeFlags=0,k=w,w=g.child;w!==null;)H=w,p=k,H.flags&=14680066,ue=H.alternate,ue===null?(H.childLanes=0,H.lanes=p,H.child=null,H.subtreeFlags=0,H.memoizedProps=null,H.memoizedState=null,H.updateQueue=null,H.dependencies=null,H.stateNode=null):(H.childLanes=ue.childLanes,H.lanes=ue.lanes,H.child=ue.child,H.subtreeFlags=0,H.deletions=null,H.memoizedProps=ue.memoizedProps,H.memoizedState=ue.memoizedState,H.updateQueue=ue.updateQueue,H.type=ue.type,p=ue.dependencies,H.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),w=w.sibling;return Ii(zi,zi.current&1|2),g.child}p=p.sibling}H.tail!==null&&qr()>xm&&(g.flags|=128,k=!0,E_(H,!1),g.lanes=4194304)}else{if(!k)if(p=ph(ue),p!==null){if(g.flags|=128,k=!0,w=p.updateQueue,w!==null&&(g.updateQueue=w,g.flags|=4),E_(H,!0),H.tail===null&&H.tailMode==="hidden"&&!ue.alternate&&!_i)return Bo(g),null}else 2*qr()-H.renderingStartTime>xm&&w!==1073741824&&(g.flags|=128,k=!0,E_(H,!1),g.lanes=4194304);H.isBackwards?(ue.sibling=g.child,g.child=ue):(w=H.last,w!==null?w.sibling=ue:g.child=ue,H.last=ue)}return H.tail!==null?(g=H.tail,H.rendering=g,H.tail=g.sibling,H.renderingStartTime=qr(),g.sibling=null,w=zi.current,Ii(zi,k?w&1|2:w&1),g):(Bo(g),null);case 22:case 23:return I_(),k=g.memoizedState!==null,p!==null&&p.memoizedState!==null!==k&&(g.flags|=8192),k&&(g.mode&1)!==0?(Ec&1073741824)!==0&&(Bo(g),g.subtreeFlags&6&&(g.flags|=8192)):Bo(g),null;case 24:return null;case 25:return null}throw Error(i(156,g.tag))}function HN(p,g){switch(a_(g),g.tag){case 1:return Ba(g.type)&&yE(),p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 3:return Hp(),Li(Fa),Li(jo),gb(),p=g.flags,(p&65536)!==0&&(p&128)===0?(g.flags=p&-65537|128,g):null;case 5:return Cm(g),null;case 13:if(Li(zi),p=g.memoizedState,p!==null&&p.dehydrated!==null){if(g.alternate===null)throw Error(i(340));Sm()}return p=g.flags,p&65536?(g.flags=p&-65537|128,g):null;case 19:return Li(zi),null;case 4:return Hp(),null;case 10:return db(g.type._context),null;case 22:case 23:return I_(),null;case 24:return null;default:return null}}var $E=!1,zo=!1,AI=typeof WeakSet=="function"?WeakSet:Set,sn=null;function Nm(p,g){var w=p.ref;if(w!==null)if(typeof w=="function")try{w(null)}catch(k){qi(p,g,k)}else w.current=null}function v_(p,g,w){try{w()}catch(k){qi(p,g,k)}}var PI=!1;function Lb(p,g){if(_E=Se,p=OR(),Qg(p)){if("selectionStart"in p)var w={start:p.selectionStart,end:p.selectionEnd};else e:{w=(w=p.ownerDocument)&&w.defaultView||window;var k=w.getSelection&&w.getSelection();if(k&&k.rangeCount!==0){w=k.anchorNode;var V=k.anchorOffset,H=k.focusNode;k=k.focusOffset;try{w.nodeType,H.nodeType}catch{w=null;break e}var ue=0,Ce=-1,Me=-1,st=0,xt=0,Mt=p,Dt=null;t:for(;;){for(var Zt;Mt!==w||V!==0&&Mt.nodeType!==3||(Ce=ue+V),Mt!==H||k!==0&&Mt.nodeType!==3||(Me=ue+k),Mt.nodeType===3&&(ue+=Mt.nodeValue.length),(Zt=Mt.firstChild)!==null;)Dt=Mt,Mt=Zt;for(;;){if(Mt===p)break t;if(Dt===w&&++st===V&&(Ce=ue),Dt===H&&++xt===k&&(Me=ue),(Zt=Mt.nextSibling)!==null)break;Mt=Dt,Dt=Mt.parentNode}Mt=Zt}w=Ce===-1||Me===-1?null:{start:Ce,end:Me}}else w=null}w=w||{start:0,end:0}}else w=null;for(r_={focusedElem:p,selectionRange:w},Se=!1,sn=g;sn!==null;)if(g=sn,p=g.child,(g.subtreeFlags&1028)!==0&&p!==null)p.return=g,sn=p;else for(;sn!==null;){g=sn;try{var an=g.alternate;if((g.flags&1024)!==0)switch(g.tag){case 0:case 11:case 15:break;case 1:if(an!==null){var cn=an.memoizedProps,os=an.memoizedState,et=g.stateNode,Fe=et.getSnapshotBeforeUpdate(g.elementType===g.type?cn:yc(g.type,cn),os);et.__reactInternalSnapshotBeforeUpdate=Fe}break;case 3:var nt=g.stateNode.containerInfo;nt.nodeType===1?nt.textContent="":nt.nodeType===9&&nt.documentElement&&nt.removeChild(nt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(Ft){qi(g,g.return,Ft)}if(p=g.sibling,p!==null){p.return=g.return,sn=p;break}sn=g.return}return an=PI,PI=!1,an}function S_(p,g,w){var k=g.updateQueue;if(k=k!==null?k.lastEffect:null,k!==null){var V=k=k.next;do{if((V.tag&p)===p){var H=V.destroy;V.destroy=void 0,H!==void 0&&v_(g,w,H)}V=V.next}while(V!==k)}}function b_(p,g){if(g=g.updateQueue,g=g!==null?g.lastEffect:null,g!==null){var w=g=g.next;do{if((w.tag&p)===p){var k=w.create;w.destroy=k()}w=w.next}while(w!==g)}}function Mb(p){var g=p.ref;if(g!==null){var w=p.stateNode;switch(p.tag){case 5:p=w;break;default:p=w}typeof g=="function"?g(p):g.current=p}}function OI(p){var g=p.alternate;g!==null&&(p.alternate=null,OI(g)),p.child=null,p.deletions=null,p.sibling=null,p.tag===5&&(g=p.stateNode,g!==null&&(delete g[lu],delete g[ah],delete g[s_],delete g[xN],delete g[LN])),p.stateNode=null,p.return=null,p.dependencies=null,p.memoizedProps=null,p.memoizedState=null,p.pendingProps=null,p.stateNode=null,p.updateQueue=null}function Ub(p){return p.tag===5||p.tag===3||p.tag===4}function kI(p){e:for(;;){for(;p.sibling===null;){if(p.return===null||Ub(p.return))return null;p=p.return}for(p.sibling.return=p.return,p=p.sibling;p.tag!==5&&p.tag!==6&&p.tag!==18;){if(p.flags&2||p.child===null||p.tag===4)continue e;p.child.return=p,p=p.child}if(!(p.flags&2))return p.stateNode}}function Vb(p,g,w){var k=p.tag;if(k===5||k===6)p=p.stateNode,g?w.nodeType===8?w.parentNode.insertBefore(p,g):w.insertBefore(p,g):(w.nodeType===8?(g=w.parentNode,g.insertBefore(p,w)):(g=w,g.appendChild(p)),w=w._reactRootContainer,w!=null||g.onclick!==null||(g.onclick=gE));else if(k!==4&&(p=p.child,p!==null))for(Vb(p,g,w),p=p.sibling;p!==null;)Vb(p,g,w),p=p.sibling}function KE(p,g,w){var k=p.tag;if(k===5||k===6)p=p.stateNode,g?w.insertBefore(p,g):w.appendChild(p);else if(k!==4&&(p=p.child,p!==null))for(KE(p,g,w),p=p.sibling;p!==null;)KE(p,g,w),p=p.sibling}var So=null,$c=!1;function fu(p,g,w){for(w=w.child;w!==null;)NI(p,g,w),w=w.sibling}function NI(p,g,w){if(Vo&&typeof Vo.onCommitFiberUnmount=="function")try{Vo.onCommitFiberUnmount(tu,w)}catch{}switch(w.tag){case 5:zo||Nm(w,g);case 6:var k=So,V=$c;So=null,fu(p,g,w),So=k,$c=V,So!==null&&($c?(p=So,w=w.stateNode,p.nodeType===8?p.parentNode.removeChild(w):p.removeChild(w)):So.removeChild(w.stateNode));break;case 18:So!==null&&($c?(p=So,w=w.stateNode,p.nodeType===8?ib(p.parentNode,w):p.nodeType===1&&ib(p,w),Va(p)):ib(So,w.stateNode));break;case 4:k=So,V=$c,So=w.stateNode.containerInfo,$c=!0,fu(p,g,w),So=k,$c=V;break;case 0:case 11:case 14:case 15:if(!zo&&(k=w.updateQueue,k!==null&&(k=k.lastEffect,k!==null))){V=k=k.next;do{var H=V,ue=H.destroy;H=H.tag,ue!==void 0&&((H&2)!==0||(H&4)!==0)&&v_(w,g,ue),V=V.next}while(V!==k)}fu(p,g,w);break;case 1:if(!zo&&(Nm(w,g),k=w.stateNode,typeof k.componentWillUnmount=="function"))try{k.props=w.memoizedProps,k.state=w.memoizedState,k.componentWillUnmount()}catch(Ce){qi(w,g,Ce)}fu(p,g,w);break;case 21:fu(p,g,w);break;case 22:w.mode&1?(zo=(k=zo)||w.memoizedState!==null,fu(p,g,w),zo=k):fu(p,g,w);break;default:fu(p,g,w)}}function DI(p){var g=p.updateQueue;if(g!==null){p.updateQueue=null;var w=p.stateNode;w===null&&(w=p.stateNode=new AI),g.forEach(function(k){var V=jI.bind(null,p,k);w.has(k)||(w.add(k),k.then(V,V))})}}function ma(p,g){var w=g.deletions;if(w!==null)for(var k=0;k<w.length;k++){var V=w[k];try{var H=p,ue=g,Ce=ue;e:for(;Ce!==null;){switch(Ce.tag){case 5:So=Ce.stateNode,$c=!1;break e;case 3:So=Ce.stateNode.containerInfo,$c=!0;break e;case 4:So=Ce.stateNode.containerInfo,$c=!0;break e}Ce=Ce.return}if(So===null)throw Error(i(160));NI(H,ue,V),So=null,$c=!1;var Me=V.alternate;Me!==null&&(Me.return=null),V.return=null}catch(st){qi(V,g,st)}}if(g.subtreeFlags&12854)for(g=g.child;g!==null;)jb(g,p),g=g.sibling}function jb(p,g){var w=p.alternate,k=p.flags;switch(p.tag){case 0:case 11:case 14:case 15:if(ma(g,p),$a(p),k&4){try{S_(3,p,p.return),b_(3,p)}catch(cn){qi(p,p.return,cn)}try{S_(5,p,p.return)}catch(cn){qi(p,p.return,cn)}}break;case 1:ma(g,p),$a(p),k&512&&w!==null&&Nm(w,w.return);break;case 5:if(ma(g,p),$a(p),k&512&&w!==null&&Nm(w,w.return),p.flags&32){var V=p.stateNode;try{Ut(V,"")}catch(cn){qi(p,p.return,cn)}}if(k&4&&(V=p.stateNode,V!=null)){var H=p.memoizedProps,ue=w!==null?w.memoizedProps:H,Ce=p.type,Me=p.updateQueue;if(p.updateQueue=null,Me!==null)try{Ce==="input"&&H.type==="radio"&&H.name!=null&&Xt(V,H),cc(Ce,ue);var st=cc(Ce,H);for(ue=0;ue<Me.length;ue+=2){var xt=Me[ue],Mt=Me[ue+1];xt==="style"?ys(V,Mt):xt==="dangerouslySetInnerHTML"?ir(V,Mt):xt==="children"?Ut(V,Mt):re(V,xt,Mt,st)}switch(Ce){case"input":$t(V,H);break;case"textarea":Kt(V,H);break;case"select":var Dt=V._wrapperState.wasMultiple;V._wrapperState.wasMultiple=!!H.multiple;var Zt=H.value;Zt!=null?gt(V,!!H.multiple,Zt,!1):Dt!==!!H.multiple&&(H.defaultValue!=null?gt(V,!!H.multiple,H.defaultValue,!0):gt(V,!!H.multiple,H.multiple?[]:"",!1))}V[ah]=H}catch(cn){qi(p,p.return,cn)}}break;case 6:if(ma(g,p),$a(p),k&4){if(p.stateNode===null)throw Error(i(162));V=p.stateNode,H=p.memoizedProps;try{V.nodeValue=H}catch(cn){qi(p,p.return,cn)}}break;case 3:if(ma(g,p),$a(p),k&4&&w!==null&&w.memoizedState.isDehydrated)try{Va(g.containerInfo)}catch(cn){qi(p,p.return,cn)}break;case 4:ma(g,p),$a(p);break;case 13:ma(g,p),$a(p),V=p.child,V.flags&8192&&(H=V.memoizedState!==null,V.stateNode.isHidden=H,!H||V.alternate!==null&&V.alternate.memoizedState!==null||(ZE=qr())),k&4&&DI(p);break;case 22:if(xt=w!==null&&w.memoizedState!==null,p.mode&1?(zo=(st=zo)||xt,ma(g,p),zo=st):ma(g,p),$a(p),k&8192){if(st=p.memoizedState!==null,(p.stateNode.isHidden=st)&&!xt&&(p.mode&1)!==0)for(sn=p,xt=p.child;xt!==null;){for(Mt=sn=xt;sn!==null;){switch(Dt=sn,Zt=Dt.child,Dt.tag){case 0:case 11:case 14:case 15:S_(4,Dt,Dt.return);break;case 1:Nm(Dt,Dt.return);var an=Dt.stateNode;if(typeof an.componentWillUnmount=="function"){k=Dt,w=Dt.return;try{g=k,an.props=g.memoizedProps,an.state=g.memoizedState,an.componentWillUnmount()}catch(cn){qi(k,w,cn)}}break;case 5:Nm(Dt,Dt.return);break;case 22:if(Dt.memoizedState!==null){T_(Mt);continue}}Zt!==null?(Zt.return=Dt,sn=Zt):T_(Mt)}xt=xt.sibling}e:for(xt=null,Mt=p;;){if(Mt.tag===5){if(xt===null){xt=Mt;try{V=Mt.stateNode,st?(H=V.style,typeof H.setProperty=="function"?H.setProperty("display","none","important"):H.display="none"):(Ce=Mt.stateNode,Me=Mt.memoizedProps.style,ue=Me!=null&&Me.hasOwnProperty("display")?Me.display:null,Ce.style.display=Ni("display",ue))}catch(cn){qi(p,p.return,cn)}}}else if(Mt.tag===6){if(xt===null)try{Mt.stateNode.nodeValue=st?"":Mt.memoizedProps}catch(cn){qi(p,p.return,cn)}}else if((Mt.tag!==22&&Mt.tag!==23||Mt.memoizedState===null||Mt===p)&&Mt.child!==null){Mt.child.return=Mt,Mt=Mt.child;continue}if(Mt===p)break e;for(;Mt.sibling===null;){if(Mt.return===null||Mt.return===p)break e;xt===Mt&&(xt=null),Mt=Mt.return}xt===Mt&&(xt=null),Mt.sibling.return=Mt.return,Mt=Mt.sibling}}break;case 19:ma(g,p),$a(p),k&4&&DI(p);break;case 21:break;default:ma(g,p),$a(p)}}function $a(p){var g=p.flags;if(g&2){try{e:{for(var w=p.return;w!==null;){if(Ub(w)){var k=w;break e}w=w.return}throw Error(i(160))}switch(k.tag){case 5:var V=k.stateNode;k.flags&32&&(Ut(V,""),k.flags&=-33);var H=kI(p);KE(p,H,V);break;case 3:case 4:var ue=k.stateNode.containerInfo,Ce=kI(p);Vb(p,Ce,ue);break;default:throw Error(i(161))}}catch(Me){qi(p,p.return,Me)}p.flags&=-3}g&4096&&(p.flags&=-4097)}function Dm(p,g,w){sn=p,Fb(p)}function Fb(p,g,w){for(var k=(p.mode&1)!==0;sn!==null;){var V=sn,H=V.child;if(V.tag===22&&k){var ue=V.memoizedState!==null||$E;if(!ue){var Ce=V.alternate,Me=Ce!==null&&Ce.memoizedState!==null||zo;Ce=$E;var st=zo;if($E=ue,(zo=Me)&&!st)for(sn=V;sn!==null;)ue=sn,Me=ue.child,ue.tag===22&&ue.memoizedState!==null?xI(V):Me!==null?(Me.return=ue,sn=Me):xI(V);for(;H!==null;)sn=H,Fb(H),H=H.sibling;sn=V,$E=Ce,zo=st}qE(p)}else(V.subtreeFlags&8772)!==0&&H!==null?(H.return=V,sn=H):qE(p)}}function qE(p){for(;sn!==null;){var g=sn;if((g.flags&8772)!==0){var w=g.alternate;try{if((g.flags&8772)!==0)switch(g.tag){case 0:case 11:case 15:zo||b_(5,g);break;case 1:var k=g.stateNode;if(g.flags&4&&!zo)if(w===null)k.componentDidMount();else{var V=g.elementType===g.type?w.memoizedProps:yc(g.type,w.memoizedProps);k.componentDidUpdate(V,w.memoizedState,k.__reactInternalSnapshotBeforeUpdate)}var H=g.updateQueue;H!==null&&ZR(g,H,k);break;case 3:var ue=g.updateQueue;if(ue!==null){if(w=null,g.child!==null)switch(g.child.tag){case 5:w=g.child.stateNode;break;case 1:w=g.child.stateNode}ZR(g,ue,w)}break;case 5:var Ce=g.stateNode;if(w===null&&g.flags&4){w=Ce;var Me=g.memoizedProps;switch(g.type){case"button":case"input":case"select":case"textarea":Me.autoFocus&&w.focus();break;case"img":Me.src&&(w.src=Me.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(g.memoizedState===null){var st=g.alternate;if(st!==null){var xt=st.memoizedState;if(xt!==null){var Mt=xt.dehydrated;Mt!==null&&Va(Mt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}zo||g.flags&512&&Mb(g)}catch(Dt){qi(g,g.return,Dt)}}if(g===p){sn=null;break}if(w=g.sibling,w!==null){w.return=g.return,sn=w;break}sn=g.return}}function T_(p){for(;sn!==null;){var g=sn;if(g===p){sn=null;break}var w=g.sibling;if(w!==null){w.return=g.return,sn=w;break}sn=g.return}}function xI(p){for(;sn!==null;){var g=sn;try{switch(g.tag){case 0:case 11:case 15:var w=g.return;try{b_(4,g)}catch(Me){qi(g,w,Me)}break;case 1:var k=g.stateNode;if(typeof k.componentDidMount=="function"){var V=g.return;try{k.componentDidMount()}catch(Me){qi(g,V,Me)}}var H=g.return;try{Mb(g)}catch(Me){qi(g,H,Me)}break;case 5:var ue=g.return;try{Mb(g)}catch(Me){qi(g,ue,Me)}}}catch(Me){qi(g,g.return,Me)}if(g===p){sn=null;break}var Ce=g.sibling;if(Ce!==null){Ce.return=g.return,sn=Ce;break}sn=g.return}}var $N=Math.ceil,YE=ae.ReactCurrentDispatcher,XE=ae.ReactCurrentOwner,Kc=ae.ReactCurrentBatchConfig,xr=0,co=null,ss=null,ws=0,Ec=0,Pl=Bc(0),Cs=0,bo=null,Yp=0,JE=0,QE=0,w_=null,ga=null,ZE=0,xm=1/0,mu=null,ev=!1,Bb=null,gh=null,Lm=!1,gu=null,tv=0,Xp=0,zb=null,C_=-1,nv=0;function To(){return(xr&6)!==0?qr():C_!==-1?C_:C_=qr()}function qc(p){return(p.mode&1)===0?1:(xr&2)!==0&&ws!==0?ws&-ws:UN.transition!==null?(nv===0&&(nv=ed()),nv):(p=ur,p!==0||(p=window.event,p=p===void 0?16:Yr(p.type)),p)}function Yc(p,g,w,k){if(50<Xp)throw Xp=0,zb=null,Error(i(185));iu(p,w,k),((xr&2)===0||p!==co)&&(p===co&&((xr&2)===0&&(JE|=w),Cs===4&&gd(p,ws)),Wo(p,k),w===1&&xr===0&&(g.mode&1)===0&&(xm=qr()+500,SE&&lh()))}function Wo(p,g){var w=p.callbackNode;hc(p,g);var k=ru(p,p===co?ws:0);if(k===0)w!==null&&Qu(w),p.callbackNode=null,p.callbackPriority=0;else if(g=k&-k,p.callbackPriority!==g){if(w!=null&&Qu(w),g===1)p.tag===0?MN(Jp.bind(null,p)):GR(Jp.bind(null,p)),NN(function(){(xr&6)===0&&lh()}),w=null;else{switch(Lc(k)){case 1:w=xc;break;case 4:w=bl;break;case 16:w=Ma;break;case 536870912:w=eh;break;default:w=Ma}w=A_(w,rv.bind(null,p))}p.callbackPriority=g,p.callbackNode=w}}function rv(p,g){if(C_=-1,nv=0,(xr&6)!==0)throw Error(i(327));var w=p.callbackNode;if(Mm()&&p.callbackNode!==w)return null;var k=ru(p,p===co?ws:0);if(k===0)return null;if((k&30)!==0||(k&p.expiredLanes)!==0||g)g=_u(p,k);else{g=k;var V=xr;xr|=2;var H=LI();(co!==p||ws!==g)&&(mu=null,xm=qr()+500,_h(p,g));do try{KN();break}catch(Ce){Wb(p,Ce)}while(!0);ub(),YE.current=H,xr=V,ss!==null?g=0:(co=null,ws=0,g=Cs)}if(g!==0){if(g===2&&(V=ta(p),V!==0&&(k=V,g=iv(p,V))),g===1)throw w=bo,_h(p,0),gd(p,k),Wo(p,qr()),w;if(g===6)gd(p,k);else{if(V=p.current.alternate,(k&30)===0&&!ov(V)&&(g=_u(p,k),g===2&&(H=ta(p),H!==0&&(k=H,g=iv(p,H))),g===1))throw w=bo,_h(p,0),gd(p,k),Wo(p,qr()),w;switch(p.finishedWork=V,p.finishedLanes=k,g){case 0:case 1:throw Error(i(345));case 2:Qp(p,ga,mu);break;case 3:if(gd(p,k),(k&130023424)===k&&(g=ZE+500-qr(),10<g)){if(ru(p,0)!==0)break;if(V=p.suspendedLanes,(V&k)!==k){To(),p.pingedLanes|=p.suspendedLanes&V;break}p.timeoutHandle=i_(Qp.bind(null,p,ga,mu),g);break}Qp(p,ga,mu);break;case 4:if(gd(p,k),(k&4194240)===k)break;for(g=p.eventTimes,V=-1;0<k;){var ue=31-vo(k);H=1<<ue,ue=g[ue],ue>V&&(V=ue),k&=~H}if(k=V,k=qr()-k,k=(120>k?120:480>k?480:1080>k?1080:1920>k?1920:3e3>k?3e3:4320>k?4320:1960*$N(k/1960))-k,10<k){p.timeoutHandle=i_(Qp.bind(null,p,ga,mu),k);break}Qp(p,ga,mu);break;case 5:Qp(p,ga,mu);break;default:throw Error(i(329))}}}return Wo(p,qr()),p.callbackNode===w?rv.bind(null,p):null}function iv(p,g){var w=w_;return p.current.memoizedState.isDehydrated&&(_h(p,g).flags|=256),p=_u(p,g),p!==2&&(g=ga,ga=w,g!==null&&sv(g)),p}function sv(p){ga===null?ga=p:ga.push.apply(ga,p)}function ov(p){for(var g=p;;){if(g.flags&16384){var w=g.updateQueue;if(w!==null&&(w=w.stores,w!==null))for(var k=0;k<w.length;k++){var V=w[k],H=V.getSnapshot;V=V.value;try{if(!Al(H(),V))return!1}catch{return!1}}}if(w=g.child,g.subtreeFlags&16384&&w!==null)w.return=g,g=w;else{if(g===p)break;for(;g.sibling===null;){if(g.return===null||g.return===p)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function gd(p,g){for(g&=~QE,g&=~JE,p.suspendedLanes|=g,p.pingedLanes&=~g,p=p.expirationTimes;0<g;){var w=31-vo(g),k=1<<w;p[w]=-1,g&=~k}}function Jp(p){if((xr&6)!==0)throw Error(i(327));Mm();var g=ru(p,0);if((g&1)===0)return Wo(p,qr()),null;var w=_u(p,g);if(p.tag!==0&&w===2){var k=ta(p);k!==0&&(g=k,w=iv(p,k))}if(w===1)throw w=bo,_h(p,0),gd(p,g),Wo(p,qr()),w;if(w===6)throw Error(i(345));return p.finishedWork=p.current.alternate,p.finishedLanes=g,Qp(p,ga,mu),Wo(p,qr()),null}function R_(p,g){var w=xr;xr|=1;try{return p(g)}finally{xr=w,xr===0&&(xm=qr()+500,SE&&lh())}}function _d(p){gu!==null&&gu.tag===0&&(xr&6)===0&&Mm();var g=xr;xr|=1;var w=Kc.transition,k=ur;try{if(Kc.transition=null,ur=1,p)return p()}finally{ur=k,Kc.transition=w,xr=g,(xr&6)===0&&lh()}}function I_(){Ec=Pl.current,Li(Pl)}function _h(p,g){p.finishedWork=null,p.finishedLanes=0;var w=p.timeoutHandle;if(w!==-1&&(p.timeoutHandle=-1,kN(w)),ss!==null)for(w=ss.return;w!==null;){var k=w;switch(a_(k),k.tag){case 1:k=k.type.childContextTypes,k!=null&&yE();break;case 3:Hp(),Li(Fa),Li(jo),gb();break;case 5:Cm(k);break;case 4:Hp();break;case 13:Li(zi);break;case 19:Li(zi);break;case 10:db(k.type._context);break;case 22:case 23:I_()}w=w.return}if(co=p,ss=p=yd(p.current,null),ws=Ec=g,Cs=0,bo=null,QE=JE=Yp=0,ga=w_=null,Wp!==null){for(g=0;g<Wp.length;g++)if(w=Wp[g],k=w.interleaved,k!==null){w.interleaved=null;var V=k.next,H=w.pending;if(H!==null){var ue=H.next;H.next=V,k.next=ue}w.pending=k}Wp=null}return p}function Wb(p,g){do{var w=ss;try{if(ub(),OE.current=xE,Rm){for(var k=Ki.memoizedState;k!==null;){var V=k.queue;V!==null&&(V.pending=null),k=k.next}Rm=!1}if(hu=0,Ts=bs=Ki=null,m_=!1,g_=0,XE.current=null,w===null||w.return===null){Cs=1,bo=g,ss=null;break}e:{var H=p,ue=w.return,Ce=w,Me=g;if(g=ws,Ce.flags|=32768,Me!==null&&typeof Me=="object"&&typeof Me.then=="function"){var st=Me,xt=Ce,Mt=xt.tag;if((xt.mode&1)===0&&(Mt===0||Mt===11||Mt===15)){var Dt=xt.alternate;Dt?(xt.updateQueue=Dt.updateQueue,xt.memoizedState=Dt.memoizedState,xt.lanes=Dt.lanes):(xt.updateQueue=null,xt.memoizedState=null)}var Zt=mI(ue);if(Zt!==null){Zt.flags&=-257,gI(Zt,ue,Ce,H,g),Zt.mode&1&&fI(H,st,g),g=Zt,Me=st;var an=g.updateQueue;if(an===null){var cn=new Set;cn.add(Me),g.updateQueue=cn}else an.add(Me);break e}else{if((g&1)===0){fI(H,st,g),Gb();break e}Me=Error(i(426))}}else if(_i&&Ce.mode&1){var os=mI(ue);if(os!==null){(os.flags&65536)===0&&(os.flags|=256),gI(os,ue,Ce,H,g),cb(Om(Me,Ce));break e}}H=Me=Om(Me,Ce),Cs!==4&&(Cs=2),w_===null?w_=[H]:w_.push(H),H=ue;do{switch(H.tag){case 3:H.flags|=65536,g&=-g,H.lanes|=g;var et=Ob(H,Me,g);QR(H,et);break e;case 1:Ce=Me;var Fe=H.type,nt=H.stateNode;if((H.flags&128)===0&&(typeof Fe.getDerivedStateFromError=="function"||nt!==null&&typeof nt.componentDidCatch=="function"&&(gh===null||!gh.has(nt)))){H.flags|=65536,g&=-g,H.lanes|=g;var Ft=md(H,Ce,g);QR(H,Ft);break e}}H=H.return}while(H!==null)}UI(w)}catch(ln){g=ln,ss===w&&w!==null&&(ss=w=w.return);continue}break}while(!0)}function LI(){var p=YE.current;return YE.current=xE,p===null?xE:p}function Gb(){(Cs===0||Cs===3||Cs===2)&&(Cs=4),co===null||(Yp&268435455)===0&&(JE&268435455)===0||gd(co,ws)}function _u(p,g){var w=xr;xr|=2;var k=LI();(co!==p||ws!==g)&&(mu=null,_h(p,g));do try{MI();break}catch(V){Wb(p,V)}while(!0);if(ub(),xr=w,YE.current=k,ss!==null)throw Error(i(261));return co=null,ws=0,Cs}function MI(){for(;ss!==null;)av(ss)}function KN(){for(;ss!==null&&!ea();)av(ss)}function av(p){var g=uv(p.alternate,p,Ec);p.memoizedProps=p.pendingProps,g===null?UI(p):ss=g,XE.current=null}function UI(p){var g=p;do{var w=g.alternate;if(p=g.return,(g.flags&32768)===0){if(w=HE(w,g,Ec),w!==null){ss=w;return}}else{if(w=HN(w,g),w!==null){w.flags&=32767,ss=w;return}if(p!==null)p.flags|=32768,p.subtreeFlags=0,p.deletions=null;else{Cs=6,ss=null;return}}if(g=g.sibling,g!==null){ss=g;return}ss=g=p}while(g!==null);Cs===0&&(Cs=5)}function Qp(p,g,w){var k=ur,V=Kc.transition;try{Kc.transition=null,ur=1,qN(p,g,w,k)}finally{Kc.transition=V,ur=k}return null}function qN(p,g,w,k){do Mm();while(gu!==null);if((xr&6)!==0)throw Error(i(327));w=p.finishedWork;var V=p.finishedLanes;if(w===null)return null;if(p.finishedWork=null,p.finishedLanes=0,w===p.current)throw Error(i(177));p.callbackNode=null,p.callbackPriority=0;var H=w.lanes|w.childLanes;if(Qr(p,H),p===co&&(ss=co=null,ws=0),(w.subtreeFlags&2064)===0&&(w.flags&2064)===0||Lm||(Lm=!0,A_(Ma,function(){return Mm(),null})),H=(w.flags&15990)!==0,(w.subtreeFlags&15990)!==0||H){H=Kc.transition,Kc.transition=null;var ue=ur;ur=1;var Ce=xr;xr|=4,XE.current=null,Lb(p,w),jb(w,p),J0(r_),Se=!!_E,r_=_E=null,p.current=w,Dm(w),Zd(),xr=Ce,ur=ue,Kc.transition=H}else p.current=w;if(Lm&&(Lm=!1,gu=p,tv=V),H=p.pendingLanes,H===0&&(gh=null),nm(w.stateNode),Wo(p,qr()),g!==null)for(k=p.onRecoverableError,w=0;w<g.length;w++)V=g[w],k(V.value,{componentStack:V.stack,digest:V.digest});if(ev)throw ev=!1,p=Bb,Bb=null,p;return(tv&1)!==0&&p.tag!==0&&Mm(),H=p.pendingLanes,(H&1)!==0?p===zb?Xp++:(Xp=0,zb=p):Xp=0,lh(),null}function Mm(){if(gu!==null){var p=Lc(tv),g=Kc.transition,w=ur;try{if(Kc.transition=null,ur=16>p?16:p,gu===null)var k=!1;else{if(p=gu,gu=null,tv=0,(xr&6)!==0)throw Error(i(331));var V=xr;for(xr|=4,sn=p.current;sn!==null;){var H=sn,ue=H.child;if((sn.flags&16)!==0){var Ce=H.deletions;if(Ce!==null){for(var Me=0;Me<Ce.length;Me++){var st=Ce[Me];for(sn=st;sn!==null;){var xt=sn;switch(xt.tag){case 0:case 11:case 15:S_(8,xt,H)}var Mt=xt.child;if(Mt!==null)Mt.return=xt,sn=Mt;else for(;sn!==null;){xt=sn;var Dt=xt.sibling,Zt=xt.return;if(OI(xt),xt===st){sn=null;break}if(Dt!==null){Dt.return=Zt,sn=Dt;break}sn=Zt}}}var an=H.alternate;if(an!==null){var cn=an.child;if(cn!==null){an.child=null;do{var os=cn.sibling;cn.sibling=null,cn=os}while(cn!==null)}}sn=H}}if((H.subtreeFlags&2064)!==0&&ue!==null)ue.return=H,sn=ue;else e:for(;sn!==null;){if(H=sn,(H.flags&2048)!==0)switch(H.tag){case 0:case 11:case 15:S_(9,H,H.return)}var et=H.sibling;if(et!==null){et.return=H.return,sn=et;break e}sn=H.return}}var Fe=p.current;for(sn=Fe;sn!==null;){ue=sn;var nt=ue.child;if((ue.subtreeFlags&2064)!==0&&nt!==null)nt.return=ue,sn=nt;else e:for(ue=Fe;sn!==null;){if(Ce=sn,(Ce.flags&2048)!==0)try{switch(Ce.tag){case 0:case 11:case 15:b_(9,Ce)}}catch(ln){qi(Ce,Ce.return,ln)}if(Ce===ue){sn=null;break e}var Ft=Ce.sibling;if(Ft!==null){Ft.return=Ce.return,sn=Ft;break e}sn=Ce.return}}if(xr=V,lh(),Vo&&typeof Vo.onPostCommitFiberRoot=="function")try{Vo.onPostCommitFiberRoot(tu,p)}catch{}k=!0}return k}finally{ur=w,Kc.transition=g}}return!1}function cv(p,g,w){g=Om(w,g),g=Ob(p,g,1),p=hh(p,g,1),g=To(),p!==null&&(iu(p,1,g),Wo(p,g))}function qi(p,g,w){if(p.tag===3)cv(p,p,w);else for(;g!==null;){if(g.tag===3){cv(g,p,w);break}else if(g.tag===1){var k=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof k.componentDidCatch=="function"&&(gh===null||!gh.has(k))){p=Om(w,p),p=md(g,p,1),g=hh(g,p,1),p=To(),g!==null&&(iu(g,1,p),Wo(g,p));break}}g=g.return}}function VI(p,g,w){var k=p.pingCache;k!==null&&k.delete(g),g=To(),p.pingedLanes|=p.suspendedLanes&w,co===p&&(ws&w)===w&&(Cs===4||Cs===3&&(ws&130023424)===ws&&500>qr()-ZE?_h(p,0):QE|=w),Wo(p,g)}function Hb(p,g){g===0&&((p.mode&1)===0?g=1:(g=Sr,Sr<<=1,(Sr&130023424)===0&&(Sr=4194304)));var w=To();p=hd(p,g),p!==null&&(iu(p,g,w),Wo(p,w))}function lv(p){var g=p.memoizedState,w=0;g!==null&&(w=g.retryLane),Hb(p,w)}function jI(p,g){var w=0;switch(p.tag){case 13:var k=p.stateNode,V=p.memoizedState;V!==null&&(w=V.retryLane);break;case 19:k=p.stateNode;break;default:throw Error(i(314))}k!==null&&k.delete(g),Hb(p,w)}var uv;uv=function(p,g,w){if(p!==null)if(p.memoizedProps!==g.pendingProps||Fa.current)Ha=!0;else{if((p.lanes&w)===0&&(g.flags&128)===0)return Ha=!1,CI(p,g,w);Ha=(p.flags&131072)!==0}else Ha=!1,_i&&(g.flags&1048576)!==0&&TE(g,bE,g.index);switch(g.lanes=0,g.tag){case 2:var k=g.type;WE(p,g),p=g.pendingProps;var V=Bp(g,jo.current);dd(g,w),V=Im(null,g,k,p,V,w);var H=Eb();return g.flags|=1,typeof V=="object"&&V!==null&&typeof V.render=="function"&&V.$$typeof===void 0?(g.tag=1,g.memoizedState=null,g.updateQueue=null,Ba(k)?(H=!0,vE(g)):H=!1,g.memoizedState=V.state!==null&&V.state!==void 0?V.state:null,d_(g),V.updater=ME,g.stateNode=V,V._reactInternals=g,Ib(g,k,p,w),g=VE(null,g,k,!0,H,w)):(g.tag=0,_i&&H&&wE(g),fa(null,g,V,w),g=g.child),g;case 16:k=g.elementType;e:{switch(WE(p,g),p=g.pendingProps,V=k._init,k=V(k._payload),g.type=k,V=g.tag=Zp(k),p=yc(k,p),V){case 0:g=kb(null,g,k,p,w);break e;case 1:g=SI(null,g,k,p,w);break e;case 11:g=UE(null,g,k,p,w);break e;case 14:g=_I(null,g,k,yc(k.type,p),w);break e}throw Error(i(306,k,""))}return g;case 0:return k=g.type,V=g.pendingProps,V=g.elementType===k?V:yc(k,V),kb(p,g,k,V,w);case 1:return k=g.type,V=g.pendingProps,V=g.elementType===k?V:yc(k,V),SI(p,g,k,V,w);case 3:e:{if(Nb(g),p===null)throw Error(i(387));k=g.pendingProps,H=g.memoizedState,V=H.element,JR(p,g),PE(g,k,null,w);var ue=g.memoizedState;if(k=ue.element,H.isDehydrated)if(H={element:k,isDehydrated:!1,cache:ue.cache,pendingSuspenseBoundaries:ue.pendingSuspenseBoundaries,transitions:ue.transitions},g.updateQueue.baseState=H,g.memoizedState=H,g.flags&256){V=Om(Error(i(423)),g),g=bI(p,g,k,w,V);break e}else if(k!==V){V=Om(Error(i(424)),g),g=bI(p,g,k,w,V);break e}else for(Wa=oh(g.stateNode.containerInfo.firstChild),za=g,_i=!0,ha=null,w=YR(g,null,k,w),g.child=w;w;)w.flags=w.flags&-3|4096,w=w.sibling;else{if(Sm(),k===V){g=pu(p,g,w);break e}fa(p,g,k,w)}g=g.child}return g;case 5:return eI(g),p===null&&ab(g),k=g.type,V=g.pendingProps,H=p!==null?p.memoizedProps:null,ue=V.children,rb(k,V)?ue=null:H!==null&&rb(k,H)&&(g.flags|=32),vI(p,g),fa(p,g,ue,w),g.child;case 6:return p===null&&ab(g),null;case 13:return jE(p,g,w);case 4:return fb(g,g.stateNode.containerInfo),k=g.pendingProps,p===null?g.child=bm(g,null,k,w):fa(p,g,k,w),g.child;case 11:return k=g.type,V=g.pendingProps,V=g.elementType===k?V:yc(k,V),UE(p,g,k,V,w);case 7:return fa(p,g,g.pendingProps,w),g.child;case 8:return fa(p,g,g.pendingProps.children,w),g.child;case 12:return fa(p,g,g.pendingProps.children,w),g.child;case 10:e:{if(k=g.type._context,V=g.pendingProps,H=g.memoizedProps,ue=V.value,Ii(IE,k._currentValue),k._currentValue=ue,H!==null)if(Al(H.value,ue)){if(H.children===V.children&&!Fa.current){g=pu(p,g,w);break e}}else for(H=g.child,H!==null&&(H.return=g);H!==null;){var Ce=H.dependencies;if(Ce!==null){ue=H.child;for(var Me=Ce.firstContext;Me!==null;){if(Me.context===k){if(H.tag===1){Me=uu(-1,w&-w),Me.tag=2;var st=H.updateQueue;if(st!==null){st=st.shared;var xt=st.pending;xt===null?Me.next=Me:(Me.next=xt.next,xt.next=Me),st.pending=Me}}H.lanes|=w,Me=H.alternate,Me!==null&&(Me.lanes|=w),hb(H.return,w,g),Ce.lanes|=w;break}Me=Me.next}}else if(H.tag===10)ue=H.type===g.type?null:H.child;else if(H.tag===18){if(ue=H.return,ue===null)throw Error(i(341));ue.lanes|=w,Ce=ue.alternate,Ce!==null&&(Ce.lanes|=w),hb(ue,w,g),ue=H.sibling}else ue=H.child;if(ue!==null)ue.return=H;else for(ue=H;ue!==null;){if(ue===g){ue=null;break}if(H=ue.sibling,H!==null){H.return=ue.return,ue=H;break}ue=ue.return}H=ue}fa(p,g,V.children,w),g=g.child}return g;case 9:return V=g.type,k=g.pendingProps.children,dd(g,w),V=Gc(V),k=k(V),g.flags|=1,fa(p,g,k,w),g.child;case 14:return k=g.type,V=yc(k,g.pendingProps),V=yc(k.type,V),_I(p,g,k,V,w);case 15:return yI(p,g,g.type,g.pendingProps,w);case 17:return k=g.type,V=g.pendingProps,V=g.elementType===k?V:yc(k,V),WE(p,g),g.tag=1,Ba(k)?(p=!0,vE(g)):p=!1,dd(g,w),hI(g,k,V),Ib(g,k,V,w),VE(null,g,k,!0,p,w);case 19:return zE(p,g,w);case 22:return EI(p,g,w)}throw Error(i(156,g.tag))};function A_(p,g){return Qd(p,g)}function dv(p,g,w,k){this.tag=p,this.key=w,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=k,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vc(p,g,w,k){return new dv(p,g,w,k)}function yh(p){return p=p.prototype,!(!p||!p.isReactComponent)}function Zp(p){if(typeof p=="function")return yh(p)?1:0;if(p!=null){if(p=p.$$typeof,p===he)return 11;if(p===Ve)return 14}return 2}function yd(p,g){var w=p.alternate;return w===null?(w=vc(p.tag,g,p.key,p.mode),w.elementType=p.elementType,w.type=p.type,w.stateNode=p.stateNode,w.alternate=p,p.alternate=w):(w.pendingProps=g,w.type=p.type,w.flags=0,w.subtreeFlags=0,w.deletions=null),w.flags=p.flags&14680064,w.childLanes=p.childLanes,w.lanes=p.lanes,w.child=p.child,w.memoizedProps=p.memoizedProps,w.memoizedState=p.memoizedState,w.updateQueue=p.updateQueue,g=p.dependencies,w.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},w.sibling=p.sibling,w.index=p.index,w.ref=p.ref,w}function hv(p,g,w,k,V,H){var ue=2;if(k=p,typeof p=="function")yh(p)&&(ue=1);else if(typeof p=="string")ue=5;else e:switch(p){case X:return ef(w.children,V,H,g);case J:ue=8,V|=8;break;case Q:return p=vc(12,w,g,V|2),p.elementType=Q,p.lanes=H,p;case le:return p=vc(13,w,g,V),p.elementType=le,p.lanes=H,p;case Oe:return p=vc(19,w,g,V),p.elementType=Oe,p.lanes=H,p;case Re:return Eh(w,V,H,g);default:if(typeof p=="object"&&p!==null)switch(p.$$typeof){case se:ue=10;break e;case de:ue=9;break e;case he:ue=11;break e;case Ve:ue=14;break e;case xe:ue=16,k=null;break e}throw Error(i(130,p==null?p:typeof p,""))}return g=vc(ue,w,g,V),g.elementType=p,g.type=k,g.lanes=H,g}function ef(p,g,w,k){return p=vc(7,p,k,g),p.lanes=w,p}function Eh(p,g,w,k){return p=vc(22,p,k,g),p.elementType=Re,p.lanes=w,p.stateNode={isHidden:!1},p}function $b(p,g,w){return p=vc(6,p,null,g),p.lanes=w,p}function Kb(p,g,w){return g=vc(4,p.children!==null?p.children:[],p.key,g),g.lanes=w,g.stateNode={containerInfo:p.containerInfo,pendingChildren:null,implementation:p.implementation},g}function YN(p,g,w,k,V){this.tag=g,this.containerInfo=p,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=wl(0),this.expirationTimes=wl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wl(0),this.identifierPrefix=k,this.onRecoverableError=V,this.mutableSourceEagerHydrationData=null}function qb(p,g,w,k,V,H,ue,Ce,Me){return p=new YN(p,g,w,Ce,Me),g===1?(g=1,H===!0&&(g|=8)):g=0,H=vc(3,null,null,g),p.current=H,H.stateNode=p,H.memoizedState={element:k,isDehydrated:w,cache:null,transitions:null,pendingSuspenseBoundaries:null},d_(H),p}function XN(p,g,w){var k=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pe,key:k==null?null:""+k,children:p,containerInfo:g,implementation:w}}function FI(p){if(!p)return ch;p=p._reactInternals;e:{if(wi(p)!==p||p.tag!==1)throw Error(i(170));var g=p;do{switch(g.tag){case 3:g=g.stateNode.context;break e;case 1:if(Ba(g.type)){g=g.stateNode.__reactInternalMemoizedMergedChildContext;break e}}g=g.return}while(g!==null);throw Error(i(171))}if(p.tag===1){var w=p.type;if(Ba(w))return EE(p,w,g)}return g}function pv(p,g,w,k,V,H,ue,Ce,Me){return p=qb(w,k,!0,p,V,H,ue,Ce,Me),p.context=FI(null),w=p.current,k=To(),V=qc(w),H=uu(k,V),H.callback=g??null,hh(w,H,V),p.current.lanes=V,iu(p,V,k),Wo(p,k),p}function P_(p,g,w,k){var V=g.current,H=To(),ue=qc(V);return w=FI(w),g.context===null?g.context=w:g.pendingContext=w,g=uu(H,ue),g.payload={element:p},k=k===void 0?null:k,k!==null&&(g.callback=k),p=hh(V,g,ue),p!==null&&(Yc(p,V,ue,H),h_(p,V,ue)),ue}function fv(p){if(p=p.current,!p.child)return null;switch(p.child.tag){case 5:return p.child.stateNode;default:return p.child.stateNode}}function Yb(p,g){if(p=p.memoizedState,p!==null&&p.dehydrated!==null){var w=p.retryLane;p.retryLane=w!==0&&w<g?w:g}}function Xb(p,g){Yb(p,g),(p=p.alternate)&&Yb(p,g)}function O_(){return null}var Ol=typeof reportError=="function"?reportError:function(p){console.error(p)};function mv(p){this._internalRoot=p}gv.prototype.render=mv.prototype.render=function(p){var g=this._internalRoot;if(g===null)throw Error(i(409));P_(p,g,null,null)},gv.prototype.unmount=mv.prototype.unmount=function(){var p=this._internalRoot;if(p!==null){this._internalRoot=null;var g=p.containerInfo;_d(function(){P_(null,p,null,null)}),g[Fc]=null}};function gv(p){this._internalRoot=p}gv.prototype.unstable_scheduleHydration=function(p){if(p){var g=Ap();p={blockedOn:null,target:p,priority:g};for(var w=0;w<oa.length&&g!==0&&g<oa[w].priority;w++);oa.splice(w,0,p),w===0&&Op(p)}};function Jb(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)}function Um(p){return!(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11&&(p.nodeType!==8||p.nodeValue!==" react-mount-point-unstable "))}function Qb(){}function JN(p,g,w,k,V){if(V){if(typeof k=="function"){var H=k;k=function(){var st=fv(ue);H.call(st)}}var ue=pv(g,k,p,0,null,!1,!1,"",Qb);return p._reactRootContainer=ue,p[Fc]=ue.current,Mp(p.nodeType===8?p.parentNode:p),_d(),ue}for(;V=p.lastChild;)p.removeChild(V);if(typeof k=="function"){var Ce=k;k=function(){var st=fv(Me);Ce.call(st)}}var Me=qb(p,0,!1,null,null,!1,!1,"",Qb);return p._reactRootContainer=Me,p[Fc]=Me.current,Mp(p.nodeType===8?p.parentNode:p),_d(function(){P_(g,Me,w,k)}),Me}function tf(p,g,w,k,V){var H=w._reactRootContainer;if(H){var ue=H;if(typeof V=="function"){var Ce=V;V=function(){var Me=fv(ue);Ce.call(Me)}}P_(g,ue,p,V)}else ue=JN(w,g,p,V,k);return fv(ue)}rm=function(p){switch(p.tag){case 3:var g=p.stateNode;if(g.current.memoizedState.isDehydrated){var w=nu(g.pendingLanes);w!==0&&(pc(g,w|1),Wo(g,qr()),(xr&6)===0&&(xm=qr()+500,lh()))}break;case 13:_d(function(){var k=hd(p,1);if(k!==null){var V=To();Yc(k,p,1,V)}}),Xb(p,1)}},su=function(p){if(p.tag===13){var g=hd(p,134217728);if(g!==null){var w=To();Yc(g,p,134217728,w)}Xb(p,134217728)}},rh=function(p){if(p.tag===13){var g=qc(p),w=hd(p,g);if(w!==null){var k=To();Yc(w,p,g,k)}Xb(p,g)}},Ap=function(){return ur},im=function(p,g){var w=ur;try{return ur=p,g()}finally{ur=w}},Dc=function(p,g,w){switch(g){case"input":if($t(p,w),g=w.name,w.type==="radio"&&g!=null){for(w=p;w.parentNode;)w=w.parentNode;for(w=w.querySelectorAll("input[name="+JSON.stringify(""+g)+'][type="radio"]'),g=0;g<w.length;g++){var k=w[g];if(k!==p&&k.form===p.form){var V=ym(k);if(!V)throw Error(i(90));He(k),$t(k,V)}}}break;case"textarea":Kt(p,w);break;case"select":g=w.value,g!=null&&gt(p,!!w.multiple,g,!1)}},vl=R_,La=_d;var vh={usingClientEntryPoint:!1,Events:[_m,jp,ym,xa,lc,R_]},Ed={findFiberByHostInstance:Vp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},QN={bundleType:Ed.bundleType,version:Ed.version,rendererPackageName:Ed.rendererPackageName,rendererConfig:Ed.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ae.ReactCurrentDispatcher,findHostInstanceByFiber:function(p){return p=Jd(p),p===null?null:p.stateNode},findFiberByHostInstance:Ed.findFiberByHostInstance||O_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _v=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_v.isDisabled&&_v.supportsFiber)try{tu=_v.inject(QN),Vo=_v}catch{}}return ll.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=vh,ll.createPortal=function(p,g){var w=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Jb(g))throw Error(i(200));return XN(p,g,null,w)},ll.createRoot=function(p,g){if(!Jb(p))throw Error(i(299));var w=!1,k="",V=Ol;return g!=null&&(g.unstable_strictMode===!0&&(w=!0),g.identifierPrefix!==void 0&&(k=g.identifierPrefix),g.onRecoverableError!==void 0&&(V=g.onRecoverableError)),g=qb(p,1,!1,null,null,w,!1,k,V),p[Fc]=g.current,Mp(p.nodeType===8?p.parentNode:p),new mv(g)},ll.findDOMNode=function(p){if(p==null)return null;if(p.nodeType===1)return p;var g=p._reactInternals;if(g===void 0)throw typeof p.render=="function"?Error(i(188)):(p=Object.keys(p).join(","),Error(i(268,p)));return p=Jd(g),p=p===null?null:p.stateNode,p},ll.flushSync=function(p){return _d(p)},ll.hydrate=function(p,g,w){if(!Um(g))throw Error(i(200));return tf(null,p,g,!0,w)},ll.hydrateRoot=function(p,g,w){if(!Jb(p))throw Error(i(405));var k=w!=null&&w.hydratedSources||null,V=!1,H="",ue=Ol;if(w!=null&&(w.unstable_strictMode===!0&&(V=!0),w.identifierPrefix!==void 0&&(H=w.identifierPrefix),w.onRecoverableError!==void 0&&(ue=w.onRecoverableError)),g=pv(g,null,p,1,w??null,V,!1,H,ue),p[Fc]=g.current,Mp(p),k)for(p=0;p<k.length;p++)w=k[p],V=w._getVersion,V=V(w._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[w,V]:g.mutableSourceEagerHydrationData.push(w,V);return new gv(g)},ll.render=function(p,g,w){if(!Um(g))throw Error(i(200));return tf(null,p,g,!1,w)},ll.unmountComponentAtNode=function(p){if(!Um(p))throw Error(i(40));return p._reactRootContainer?(_d(function(){tf(null,null,p,!1,function(){p._reactRootContainer=null,p[Fc]=null})}),!0):!1},ll.unstable_batchedUpdates=R_,ll.unstable_renderSubtreeIntoContainer=function(p,g,w,k){if(!Um(w))throw Error(i(200));if(p==null||p._reactInternals===void 0)throw Error(i(38));return tf(p,g,w,!1,k)},ll.version="18.3.1-next-f1338f8080-20240426",ll}var Z7;function LQ(){if(Z7)return H2.exports;Z7=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(t){console.error(t)}}return n(),H2.exports=Aye(),H2.exports}var eK;function Pye(){if(eK)return sO;eK=1;var n=LQ();return sO.createRoot=n.createRoot,sO.hydrateRoot=n.hydrateRoot,sO}var Oye=Pye();const kye=Fg(Oye);function Nye(n,t,i,a){return n.addEventListener(t,i,a),()=>{n.removeEventListener(t,i,a)}}function a1(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}function Dye(){return!!(globalThis!=null&&globalThis.document)}function MQ(n){return n.parentElement&&MQ(n.parentElement)?!0:n.hidden}function xye(n){const t=n.getAttribute("contenteditable");return t!=="false"&&t!=null}function Lye(n){return!!n.getAttribute("disabled")||!!n.getAttribute("aria-disabled")}function Mye(n){var t;return((t=UQ(n))==null?void 0:t.defaultView)??window}function UQ(n){return a1(n)?n.ownerDocument:document}function Uye(n){return n.view??window}function Vye(n){return UQ(n).activeElement}function jye(n){const t=Uye(n);return typeof t.PointerEvent<"u"&&n instanceof t.PointerEvent?n.pointerType==="mouse":n instanceof t.MouseEvent}function VQ(n){return!!n.touches}function Fye(n){return VQ(n)&&n.touches.length>1}function Bye(n,t="page"){const i=n.touches[0]||n.changedTouches[0];return{x:i[`${t}X`],y:i[`${t}Y`]}}function zye(n,t="page"){return{x:n[`${t}X`],y:n[`${t}Y`]}}function jQ(n,t="page"){return VQ(n)?Bye(n,t):zye(n,t)}function Wye(n){return t=>{const i=jye(t);(!i||i&&t.button===0)&&n(t)}}function Gye(n,t=!1){function i(l){n(l,{point:jQ(l)})}return t?Wye(i):i}function UO(n,t,i,a){return Nye(n,t,Gye(i,t==="pointerdown"),a)}function Hye(n,...t){if(n==null)throw new TypeError("Cannot convert undefined or null to object");const i={...n};for(const a of t)if(a!=null)for(const l in a)Object.prototype.hasOwnProperty.call(a,l)&&(l in i&&delete i[l],i[l]=a[l]);return i}const nr=n=>n?"":void 0,Lf=n=>n?!0:void 0;function $ye(n){return Array.isArray(n)}function Bu(n){const t=typeof n;return n!=null&&(t==="object"||t==="function")&&!$ye(n)}function Kye(n){const t=n==null?0:n.length;return t?n[t-1]:void 0}function qye(n){const t=parseFloat(n.toString()),i=n.toString().replace(String(t),"");return{unitless:!i,value:t,unit:i}}function _U(n){if(n==null)return n;const{unitless:t}=qye(n);return t||typeof n=="number"?`${n}px`:n}const FQ=(n,t)=>parseInt(n[1],10)>parseInt(t[1],10)?1:-1,ij=n=>Object.fromEntries(Object.entries(n).sort(FQ));function tK(n){const t=ij(n);return Object.assign(Object.values(t),t)}function Yye(n){const t=Object.keys(ij(n));return new Set(t)}function nK(n){if(!n)return n;n=_U(n)??n;const t=-.02;return typeof n=="number"?`${n+t}`:n.replace(/(\d+\.?\d*)/u,i=>`${parseFloat(i)+t}`)}function Ow(n,t){const i=["@media screen"];return n&&i.push("and",`(min-width: ${_U(n)})`),t&&i.push("and",`(max-width: ${_U(t)})`),i.join(" ")}function Xye(n){if(!n)return null;n.base=n.base??"0px";const t=tK(n),i=Object.entries(n).sort(FQ).map(([d,f],_,v)=>{let[,b]=v[_+1]??[];return b=parseFloat(b)>0?nK(b):void 0,{_minW:nK(f),breakpoint:d,minW:f,maxW:b,maxWQuery:Ow(null,b),minWQuery:Ow(f),minMaxQuery:Ow(f,b)}}),a=Yye(n),l=Array.from(a.values());return{keys:a,normalized:t,isResponsive(d){const f=Object.keys(d);return f.length>0&&f.every(_=>a.has(_))},asObject:ij(n),asArray:tK(n),details:i,get(d){return i.find(f=>f.breakpoint===d)},media:[null,...t.map(d=>Ow(d)).slice(1)],toArrayValue(d){if(!Bu(d))throw new Error("toArrayValue: value must be an object");const f=l.map(_=>d[_]??null);for(;Kye(f)===null;)f.pop();return f},toObjectValue(d){if(!Array.isArray(d))throw new Error("toObjectValue: value must be an array");return d.reduce((f,_,v)=>{const b=l[v];return b!=null&&_!=null&&(f[b]=_),f},{})}}}function BQ(...n){return function(...i){n.forEach(a=>a==null?void 0:a(...i))}}function Nn(...n){return function(i){n.some(a=>(a==null||a(i),i==null?void 0:i.defaultPrevented))}}function c1(n){return N.Children.toArray(n).filter(t=>N.isValidElement(t))}function l1(n){const t=Object.assign({},n);for(let i in t)t[i]===void 0&&delete t[i];return t}function Jye(n,t){return`${n} returned \`undefined\`. Seems you forgot to wrap component within ${t}`}function Ti(n={}){const{name:t,strict:i=!0,hookName:a="useContext",providerName:l="Provider",errorMessage:d,defaultValue:f}=n,_=N.createContext(f);_.displayName=t;function v(){var C;const b=N.useContext(_);if(!b&&i){const I=new Error(d??Jye(a,l));throw I.name="ContextError",(C=Error.captureStackTrace)==null||C.call(Error,I,v),I}return b}return[_.Provider,v,_]}const _n=(...n)=>n.filter(Boolean).join(" "),zQ=n=>n.hasAttribute("tabindex"),Qye=n=>zQ(n)&&n.tabIndex===-1;function Ek(n){if(!a1(n)||MQ(n)||Lye(n))return!1;const{localName:t}=n;if(["input","select","textarea","button"].indexOf(t)>=0)return!0;const a={a:()=>n.hasAttribute("href"),audio:()=>n.hasAttribute("controls"),video:()=>n.hasAttribute("controls")};return t in a?a[t]():xye(n)?!0:zQ(n)}function Zye(n){return n?a1(n)&&Ek(n)&&!Qye(n):!1}const eEe=["input:not(:disabled):not([disabled])","select:not(:disabled):not([disabled])","textarea:not(:disabled):not([disabled])","embed","iframe","object","a[href]","area[href]","button:not(:disabled):not([disabled])","[tabindex]","audio[controls]","video[controls]","*[tabindex]:not([aria-disabled])","*[contenteditable]"],tEe=eEe.join(),nEe=n=>n.offsetWidth>0&&n.offsetHeight>0;function WQ(n){const t=Array.from(n.querySelectorAll(tEe));return t.unshift(n),t.filter(i=>Ek(i)&&nEe(i))}function rEe(n,t,i,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?i:n}const iEe=n=>{const t=new WeakMap;return(a,l,d,f)=>{if(typeof a>"u")return n(a,l,d);t.has(a)||t.set(a,new Map);const _=t.get(a);if(_.has(l))return _.get(l);const v=n(a,l,d,f);return _.set(l,v),v}},GQ=iEe(rEe),sEe=n=>n.default||n;function sj(n){const{wasSelected:t,enabled:i,isSelected:a,mode:l="unmount"}=n;return!!(!i||a||l==="keepMounted"&&t)}function oEe(n){const t=parseFloat(n);return typeof t!="number"||Number.isNaN(t)?0:t}function oj(n,t){let i=oEe(n);const a=10**(t??10);return i=Math.round(i*a)/a,t?i.toFixed(t):i.toString()}function yU(n){if(!Number.isFinite(n))return 0;let t=1,i=0;for(;Math.round(n*t)/t!==n;)t*=10,i+=1;return i}function rK(n,t,i){return(n-t)*100/(i-t)}function aEe(n,t,i){return(i-t)*n+t}function iK(n,t,i){const a=Math.round((n-t)/i)*i+t,l=yU(i);return oj(a,l)}function VO(n,t,i){return n==null?n:(i<t&&console.warn("clamp: max cannot be less than min"),Math.min(Math.max(n,t),i))}function L0(n,t=[]){const i=Object.assign({},n);for(const a of t)a in i&&delete i[a];return i}function HQ(n,t){const i={};for(const a of t)a in n&&(i[a]=n[a]);return i}function aj(n,t){return Array.isArray(n)?n.map(i=>i===null?null:t(i)):Bu(n)?Object.keys(n).reduce((i,a)=>(i[a]=t(n[a]),i),{}):n!=null?t(n):null}const cEe=n=>typeof n=="function";function ml(n,...t){return cEe(n)?n(...t):n}function lEe(n){const t=n.ownerDocument.defaultView||window,{overflow:i,overflowX:a,overflowY:l}=t.getComputedStyle(n);return/auto|scroll|overlay|hidden/.test(i+l+a)}function uEe(n){return n.localName==="html"?n:n.assignedSlot||n.parentElement||n.ownerDocument.documentElement}function $Q(n){return["html","body","#document"].includes(n.localName)?n.ownerDocument.body:a1(n)&&lEe(n)?n:$Q(uEe(n))}function dEe(n,t){const i={},a={};for(const[l,d]of Object.entries(n))t.includes(l)?i[l]=d:a[l]=d;return[i,a]}function hEe(n,...t){const i=Object.getOwnPropertyDescriptors(n),a=Object.keys(i),l=f=>{const _={};for(let v=0;v<f.length;v++){const b=f[v];i[b]&&(Object.defineProperty(_,b,i[b]),delete i[b])}return _},d=f=>l(Array.isArray(f)?f:a.filter(f));return t.map(d).concat(l(a))}function sK(n,t,i={}){const{stop:a,getKey:l}=i;function d(f,_=[]){if(Bu(f)||Array.isArray(f)){const v={};for(const[b,C]of Object.entries(f)){const I=(l==null?void 0:l(b))??b,O=[..._,I];if(a!=null&&a(f,O))return t(f,_);v[I]=d(C,O)}return v}return t(f,_)}return d(n)}var kw={exports:{}};kw.exports;var oK;function pEe(){return oK||(oK=1,function(n,t){var i=200,a="__lodash_hash_undefined__",l=800,d=16,f=9007199254740991,_="[object Arguments]",v="[object Array]",b="[object AsyncFunction]",C="[object Boolean]",I="[object Date]",O="[object Error]",L="[object Function]",M="[object GeneratorFunction]",F="[object Map]",z="[object Number]",Z="[object Null]",K="[object Object]",re="[object Proxy]",ae="[object RegExp]",ne="[object Set]",pe="[object String]",X="[object Undefined]",J="[object WeakMap]",Q="[object ArrayBuffer]",se="[object DataView]",de="[object Float32Array]",he="[object Float64Array]",le="[object Int8Array]",Oe="[object Int16Array]",Ve="[object Int32Array]",xe="[object Uint8Array]",Re="[object Uint8ClampedArray]",ve="[object Uint16Array]",be="[object Uint32Array]",ze=/[\\^$.*+?()[\]{}|]/g,Pe=/^\[object .+?Constructor\]$/,we=/^(?:0|[1-9]\d*)$/,ke={};ke[de]=ke[he]=ke[le]=ke[Oe]=ke[Ve]=ke[xe]=ke[Re]=ke[ve]=ke[be]=!0,ke[_]=ke[v]=ke[Q]=ke[C]=ke[se]=ke[I]=ke[O]=ke[L]=ke[F]=ke[z]=ke[K]=ke[ae]=ke[ne]=ke[pe]=ke[J]=!1;var Ue=typeof Sy=="object"&&Sy&&Sy.Object===Object&&Sy,Be=typeof self=="object"&&self&&self.Object===Object&&self,qe=Ue||Be||Function("return this")(),$e=t&&!t.nodeType&&t,it=$e&&!0&&n&&!n.nodeType&&n,Je=it&&it.exports===$e,Ct=Je&&Ue.process,kt=function(){try{var Se=it&&it.require&&it.require("util").types;return Se||Ct&&Ct.binding&&Ct.binding("util")}catch{}}(),He=kt&&kt.isTypedArray;function lt(Se,De,rt){switch(rt.length){case 0:return Se.call(De);case 1:return Se.call(De,rt[0]);case 2:return Se.call(De,rt[0],rt[1]);case 3:return Se.call(De,rt[0],rt[1],rt[2])}return Se.apply(De,rt)}function mt(Se,De){for(var rt=-1,tn=Array(Se);++rt<Se;)tn[rt]=De(rt);return tn}function Lt(Se){return function(De){return Se(De)}}function Xt(Se,De){return Se==null?void 0:Se[De]}function $t(Se,De){return function(rt){return Se(De(rt))}}var Te=Array.prototype,je=Function.prototype,Ke=Object.prototype,gt=qe["__core-js_shared__"],Et=je.toString,wt=Ke.hasOwnProperty,Kt=function(){var Se=/[^.]+$/.exec(gt&&gt.keys&&gt.keys.IE_PROTO||"");return Se?"Symbol(src)_1."+Se:""}(),mn=Ke.toString,vn=Et.call(Object),rn=RegExp("^"+Et.call(wt).replace(ze,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Tt=Je?qe.Buffer:void 0,ir=qe.Symbol,Ut=qe.Uint8Array;Tt&&Tt.allocUnsafe;var Wt=$t(Object.getPrototypeOf,Object),gn=Object.create,Ni=Ke.propertyIsEnumerable,ys=Te.splice,oi=ir?ir.toStringTag:void 0,Zo=function(){try{var Se=hc(Object,"defineProperty");return Se({},"",{}),Se}catch{}}(),cc=Tt?Tt.isBuffer:void 0,so=Math.max,oo=Date.now,Dc=hc(qe,"Map"),Es=hc(Object,"create"),Da=function(){function Se(){}return function(De){if(!Mc(De))return{};if(gn)return gn(De);Se.prototype=De;var rt=new Se;return Se.prototype=void 0,rt}}();function Mo(Se){var De=-1,rt=Se==null?0:Se.length;for(this.clear();++De<rt;){var tn=Se[De];this.set(tn[0],tn[1])}}function xa(){this.__data__=Es?Es(null):{},this.size=0}function lc(Se){var De=this.has(Se)&&delete this.__data__[Se];return this.size-=De?1:0,De}function vl(Se){var De=this.__data__;if(Es){var rt=De[Se];return rt===a?void 0:rt}return wt.call(De,Se)?De[Se]:void 0}function La(Se){var De=this.__data__;return Es?De[Se]!==void 0:wt.call(De,Se)}function uc(Se,De){var rt=this.__data__;return this.size+=this.has(Se)?0:1,rt[Se]=Es&&De===void 0?a:De,this}Mo.prototype.clear=xa,Mo.prototype.delete=lc,Mo.prototype.get=vl,Mo.prototype.has=La,Mo.prototype.set=uc;function _o(Se){var De=-1,rt=Se==null?0:Se.length;for(this.clear();++De<rt;){var tn=Se[De];this.set(tn[0],tn[1])}}function Di(){this.__data__=[],this.size=0}function vt(Se){var De=this.__data__,rt=Zd(De,Se);if(rt<0)return!1;var tn=De.length-1;return rt==tn?De.pop():ys.call(De,rt,1),--this.size,!0}function pn(Se){var De=this.__data__,rt=Zd(De,Se);return rt<0?void 0:De[rt][1]}function vr(Se){return Zd(this.__data__,Se)>-1}function mi(Se,De){var rt=this.__data__,tn=Zd(rt,Se);return tn<0?(++this.size,rt.push([Se,De])):rt[tn][1]=De,this}_o.prototype.clear=Di,_o.prototype.delete=vt,_o.prototype.get=pn,_o.prototype.has=vr,_o.prototype.set=mi;function Uo(Se){var De=-1,rt=Se==null?0:Se.length;for(this.clear();++De<rt;){var tn=Se[De];this.set(tn[0],tn[1])}}function yo(){this.size=0,this.__data__={hash:new Mo,map:new(Dc||_o),string:new Mo}}function Zl(Se){var De=Zu(this,Se).delete(Se);return this.size-=De?1:0,De}function Cp(Se){return Zu(this,Se).get(Se)}function Sl(Se){return Zu(this,Se).has(Se)}function eu(Se,De){var rt=Zu(this,Se),tn=rt.size;return rt.set(Se,De),this.size+=rt.size==tn?0:1,this}Uo.prototype.clear=yo,Uo.prototype.delete=Zl,Uo.prototype.get=Cp,Uo.prototype.has=Sl,Uo.prototype.set=eu;function wi(Se){var De=this.__data__=new _o(Se);this.size=De.size}function Eo(){this.__data__=new _o,this.size=0}function Bi(Se){var De=this.__data__,rt=De.delete(Se);return this.size=De.size,rt}function Xd(Se){return this.__data__.get(Se)}function Jd(Se){return this.__data__.has(Se)}function dc(Se,De){var rt=this.__data__;if(rt instanceof _o){var tn=rt.__data__;if(!Dc||tn.length<i-1)return tn.push([Se,De]),this.size=++rt.size,this;rt=this.__data__=new Uo(tn)}return rt.set(Se,De),this.size=rt.size,this}wi.prototype.clear=Eo,wi.prototype.delete=Bi,wi.prototype.get=Xd,wi.prototype.has=Jd,wi.prototype.set=dc;function Qd(Se,De){var rt=ra(Se),tn=!rt&&ds(Se),er=!rt&&!tn&&sa(Se),Rr=!rt&&!tn&&!er&&Op(Se),Yr=rt||tn||er||Rr,fn=Yr?mt(Se.length,String):[],zr=fn.length;for(var Ri in Se)Yr&&(Ri=="length"||er&&(Ri=="offset"||Ri=="parent")||Rr&&(Ri=="buffer"||Ri=="byteLength"||Ri=="byteOffset")||wl(Ri,zr))||fn.push(Ri);return fn}function Qu(Se,De,rt){(rt!==void 0&&!na(Se[De],rt)||rt===void 0&&!(De in Se))&&qr(Se,De,rt)}function ea(Se,De,rt){var tn=Se[De];(!(wt.call(Se,De)&&na(tn,rt))||rt===void 0&&!(De in Se))&&qr(Se,De,rt)}function Zd(Se,De){for(var rt=Se.length;rt--;)if(na(Se[rt][0],De))return rt;return-1}function qr(Se,De,rt){De=="__proto__"&&Zo?Zo(Se,De,{configurable:!0,enumerable:!0,value:rt,writable:!0}):Se[De]=rt}var Ci=ru();function xc(Se){return Se==null?Se===void 0?X:Z:oi&&oi in Object(Se)?ta(Se):rm(Se)}function bl(Se){return vs(Se)&&xc(Se)==_}function Ma(Se){if(!Mc(Se)||pc(Se))return!1;var De=oa(Se)?rn:Pe;return De.test(Pp(Se))}function Rp(Se){return vs(Se)&&sm(Se.length)&&!!ke[xc(Se)]}function eh(Se){if(!Mc(Se))return Lc(Se);var De=ur(Se),rt=[];for(var tn in Se)tn=="constructor"&&(De||!wt.call(Se,tn))||rt.push(tn);return rt}function tu(Se,De,rt,tn,er){Se!==De&&Ci(De,function(Rr,Yr){if(er||(er=new wi),Mc(Rr))Vo(Se,De,Yr,rt,tu,tn,er);else{var fn=tn?tn(rh(Se,Yr),Rr,Yr+"",Se,De,er):void 0;fn===void 0&&(fn=Rr),Qu(Se,Yr,fn)}},au)}function Vo(Se,De,rt,tn,er,Rr,Yr){var fn=rh(Se,rt),zr=rh(De,rt),Ri=Yr.get(zr);if(Ri){Qu(Se,rt,Ri);return}var Ks=Rr?Rr(fn,zr,rt+"",Se,De,Yr):void 0,aa=Ks===void 0;if(aa){var ca=ra(zr),nd=!ca&&sa(zr),is=!ca&&!nd&&Op(zr);Ks=zr,ca||nd||is?ra(fn)?Ks=fn:ou(fn)?Ks=nh(fn):nd?(aa=!1,Ks=Ip(zr)):is?(aa=!1,Ks=th(zr)):Ks=[]:td(zr)||ds(zr)?(Ks=fn,ds(fn)?Ks=Cl(fn):(!Mc(fn)||oa(fn))&&(Ks=ed(zr))):aa=!1}aa&&(Yr.set(zr,Ks),er(Ks,zr,tn,Rr,Yr),Yr.delete(zr)),Qu(Se,rt,Ks)}function nm(Se,De){return Ap(su(Se,De,Va),Se+"")}var vo=Zo?function(Se,De){return Zo(Se,"toString",{configurable:!0,enumerable:!1,value:Ua(De),writable:!0})}:Va;function Ip(Se,De){return Se.slice()}function Tl(Se){var De=new Se.constructor(Se.byteLength);return new Ut(De).set(new Ut(Se)),De}function th(Se,De){var rt=Tl(Se.buffer);return new Se.constructor(rt,Se.byteOffset,Se.length)}function nh(Se,De){var rt=-1,tn=Se.length;for(De||(De=Array(tn));++rt<tn;)De[rt]=Se[rt];return De}function Sr(Se,De,rt,tn){var er=!rt;rt||(rt={});for(var Rr=-1,Yr=De.length;++Rr<Yr;){var fn=De[Rr],zr=void 0;zr===void 0&&(zr=Se[fn]),er?qr(rt,fn,zr):ea(rt,fn,zr)}return rt}function nu(Se){return nm(function(De,rt){var tn=-1,er=rt.length,Rr=er>1?rt[er-1]:void 0,Yr=er>2?rt[2]:void 0;for(Rr=Se.length>3&&typeof Rr=="function"?(er--,Rr):void 0,Yr&&iu(rt[0],rt[1],Yr)&&(Rr=er<3?void 0:Rr,er=1),De=Object(De);++tn<er;){var fn=rt[tn];fn&&Se(De,fn,tn,Rr)}return De})}function ru(Se){return function(De,rt,tn){for(var er=-1,Rr=Object(De),Yr=tn(De),fn=Yr.length;fn--;){var zr=Yr[++er];if(rt(Rr[zr],zr,Rr)===!1)break}return De}}function Zu(Se,De){var rt=Se.__data__;return Qr(De)?rt[typeof De=="string"?"string":"hash"]:rt.map}function hc(Se,De){var rt=Xt(Se,De);return Ma(rt)?rt:void 0}function ta(Se){var De=wt.call(Se,oi),rt=Se[oi];try{Se[oi]=void 0;var tn=!0}catch{}var er=mn.call(Se);return tn&&(De?Se[oi]=rt:delete Se[oi]),er}function ed(Se){return typeof Se.constructor=="function"&&!ur(Se)?Da(Wt(Se)):{}}function wl(Se,De){var rt=typeof Se;return De=De??f,!!De&&(rt=="number"||rt!="symbol"&&we.test(Se))&&Se>-1&&Se%1==0&&Se<De}function iu(Se,De,rt){if(!Mc(rt))return!1;var tn=typeof De;return(tn=="number"?ia(rt)&&wl(De,rt.length):tn=="string"&&De in rt)?na(rt[De],Se):!1}function Qr(Se){var De=typeof Se;return De=="string"||De=="number"||De=="symbol"||De=="boolean"?Se!=="__proto__":Se===null}function pc(Se){return!!Kt&&Kt in Se}function ur(Se){var De=Se&&Se.constructor,rt=typeof De=="function"&&De.prototype||Ke;return Se===rt}function Lc(Se){var De=[];if(Se!=null)for(var rt in Object(Se))De.push(rt);return De}function rm(Se){return mn.call(Se)}function su(Se,De,rt){return De=so(De===void 0?Se.length-1:De,0),function(){for(var tn=arguments,er=-1,Rr=so(tn.length-De,0),Yr=Array(Rr);++er<Rr;)Yr[er]=tn[De+er];er=-1;for(var fn=Array(De+1);++er<De;)fn[er]=tn[er];return fn[De]=rt(Yr),lt(Se,this,fn)}}function rh(Se,De){if(!(De==="constructor"&&typeof Se[De]=="function")&&De!="__proto__")return Se[De]}var Ap=im(vo);function im(Se){var De=0,rt=0;return function(){var tn=oo(),er=d-(tn-rt);if(rt=tn,er>0){if(++De>=l)return arguments[0]}else De=0;return Se.apply(void 0,arguments)}}function Pp(Se){if(Se!=null){try{return Et.call(Se)}catch{}try{return Se+""}catch{}}return""}function na(Se,De){return Se===De||Se!==Se&&De!==De}var ds=bl(function(){return arguments}())?bl:function(Se){return vs(Se)&&wt.call(Se,"callee")&&!Ni.call(Se,"callee")},ra=Array.isArray;function ia(Se){return Se!=null&&sm(Se.length)&&!oa(Se)}function ou(Se){return vs(Se)&&ia(Se)}var sa=cc||Rl;function oa(Se){if(!Mc(Se))return!1;var De=xc(Se);return De==L||De==M||De==b||De==re}function sm(Se){return typeof Se=="number"&&Se>-1&&Se%1==0&&Se<=f}function Mc(Se){var De=typeof Se;return Se!=null&&(De=="object"||De=="function")}function vs(Se){return Se!=null&&typeof Se=="object"}function td(Se){if(!vs(Se)||xc(Se)!=K)return!1;var De=Wt(Se);if(De===null)return!0;var rt=wt.call(De,"constructor")&&De.constructor;return typeof rt=="function"&&rt instanceof rt&&Et.call(rt)==vn}var Op=He?Lt(He):Rp;function Cl(Se){return Sr(Se,au(Se))}function au(Se){return ia(Se)?Qd(Se):eh(Se)}var om=nu(function(Se,De,rt,tn){tu(Se,De,rt,tn)});function Ua(Se){return function(){return Se}}function Va(Se){return Se}function Rl(){return!1}n.exports=om}(kw,kw.exports)),kw.exports}var fEe=pEe();const ep=Fg(fEe);function to(n,t=[]){const i=N.useRef(n);return N.useEffect(()=>{i.current=n}),N.useCallback((...a)=>{var l;return(l=i.current)==null?void 0:l.call(i,...a)},t)}function Iy(n,t,i,a){const l=to(i);return N.useEffect(()=>{const d=typeof n=="function"?n():n??document;if(!(!i||!d))return d.addEventListener(t,l,a),()=>{d.removeEventListener(t,l,a)}},[t,n,a,l,i]),()=>{const d=typeof n=="function"?n():n??document;d==null||d.removeEventListener(t,l,a)}}function KQ(n){const{isOpen:t,ref:i}=n,[a,l]=N.useState(t),[d,f]=N.useState(!1);return N.useEffect(()=>{d||(l(t),f(!0))},[t,d,a]),Iy(()=>i.current,"animationend",()=>{l(t)}),{present:!(t?!1:!a),onComplete(){var C;const v=Mye(i.current),b=new v.CustomEvent("animationend",{bubbles:!0});(C=i.current)==null||C.dispatchEvent(b)}}}var q2,aK;function mEe(){return aK||(aK=1,q2=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var t=document.activeElement,i=[],a=0;a<n.rangeCount;a++)i.push(n.getRangeAt(a));switch(t.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":t.blur();break;default:t=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||i.forEach(function(l){n.addRange(l)}),t&&t.focus()}}),q2}var Y2,cK;function gEe(){if(cK)return Y2;cK=1;var n=mEe(),t={"text/plain":"Text","text/html":"Url",default:"Text"},i="Copy to clipboard: #{key}, Enter";function a(d){var f=(/mac os x/i.test(navigator.userAgent)?"":"Ctrl")+"+C";return d.replace(/#{\s*key\s*}/g,f)}function l(d,f){var _,v,b,C,I,O,L=!1;f||(f={}),_=f.debug||!1;try{b=n(),C=document.createRange(),I=document.getSelection(),O=document.createElement("span"),O.textContent=d,O.ariaHidden="true",O.style.all="unset",O.style.position="fixed",O.style.top=0,O.style.clip="rect(0, 0, 0, 0)",O.style.whiteSpace="pre",O.style.webkitUserSelect="text",O.style.MozUserSelect="text",O.style.msUserSelect="text",O.style.userSelect="text",O.addEventListener("copy",function(F){if(F.stopPropagation(),f.format)if(F.preventDefault(),typeof F.clipboardData>"u"){_&&console.warn("unable to use e.clipboardData"),_&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var z=t[f.format]||t.default;window.clipboardData.setData(z,d)}else F.clipboardData.clearData(),F.clipboardData.setData(f.format,d);f.onCopy&&(F.preventDefault(),f.onCopy(F.clipboardData))}),document.body.appendChild(O),C.selectNodeContents(O),I.addRange(C);var M=document.execCommand("copy");if(!M)throw new Error("copy command was unsuccessful");L=!0}catch(F){_&&console.error("unable to copy using execCommand: ",F),_&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(f.format||"text",d),f.onCopy&&f.onCopy(window.clipboardData),L=!0}catch(z){_&&console.error("unable to copy using clipboardData: ",z),_&&console.error("falling back to prompt"),v=a("message"in f?f.message:i),window.prompt(v,d)}}finally{I&&(typeof I.removeRange=="function"?I.removeRange(C):I.removeAllRanges()),O&&document.body.removeChild(O),b()}return L}return Y2=l,Y2}var _Ee=gEe();const lK=Fg(_Ee);function uK(n,t={}){const[i,a]=N.useState(!1),[l,d]=N.useState(n);N.useEffect(()=>d(n),[n]);const{timeout:f=1500,..._}=typeof t=="number"?{timeout:t}:t,v=N.useCallback(b=>{const C=typeof b=="string"?b:l;"clipboard"in navigator?navigator.clipboard.writeText(C).then(()=>a(!0)).catch(()=>a(lK(C,_))):a(lK(C,_))},[l,_]);return N.useEffect(()=>{let b=null;return i&&(b=window.setTimeout(()=>{a(!1)},f)),()=>{b&&window.clearTimeout(b)}},[f,i]),{value:l,setValue:d,onCopy:v,hasCopied:i}}function qQ(n){const{value:t,defaultValue:i,onChange:a,shouldUpdate:l=(O,L)=>O!==L}=n,d=to(a),f=to(l),[_,v]=N.useState(i),b=t!==void 0,C=b?t:_,I=to(O=>{const M=typeof O=="function"?O(C):O;f(C,M)&&(b||v(M),d(M))},[b,d,C,f]);return[C,I]}function yEe(n={}){const{onChange:t,precision:i,defaultValue:a,value:l,step:d=1,min:f=Number.MIN_SAFE_INTEGER,max:_=Number.MAX_SAFE_INTEGER,keepWithinRange:v=!0}=n,b=to(t),[C,I]=N.useState(()=>a==null?"":X2(a,d,i)??""),O=typeof l<"u",L=O?l:C,M=YQ(hg(L),d),F=i??M,z=N.useCallback(se=>{se!==L&&(O||I(se.toString()),b==null||b(se.toString(),hg(se)))},[b,O,L]),Z=N.useCallback(se=>{let de=se;return v&&(de=VO(de,f,_)),oj(de,F)},[F,v,_,f]),K=N.useCallback((se=d)=>{let de;L===""?de=hg(se):de=hg(L)+se,de=Z(de),z(de)},[Z,d,z,L]),re=N.useCallback((se=d)=>{let de;L===""?de=hg(-se):de=hg(L)-se,de=Z(de),z(de)},[Z,d,z,L]),ae=N.useCallback(()=>{let se;a==null?se="":se=X2(a,d,i)??f,z(se)},[a,i,d,z,f]),ne=N.useCallback(se=>{const de=X2(se,d,F)??f;z(de)},[F,d,z,f]),pe=hg(L);return{isOutOfRange:pe>_||pe<f,isAtMax:pe===_,isAtMin:pe===f,precision:F,value:L,valueAsNumber:pe,update:z,reset:ae,increment:K,decrement:re,clamp:Z,cast:ne,setValue:I}}function hg(n){return parseFloat(n.toString().replace(/[^\w.-]+/g,""))}function YQ(n,t){return Math.max(yU(t),yU(n))}function X2(n,t,i){const a=hg(n);if(Number.isNaN(a))return;const l=YQ(a,t);return oj(a,i??l)}function yp(n={}){const{onClose:t,onOpen:i,isOpen:a,id:l}=n,d=to(i),f=to(t),[_,v]=N.useState(n.defaultIsOpen||!1),b=a!==void 0?a:_,C=a!==void 0,I=N.useId(),O=l??`disclosure-${I}`,L=N.useCallback(()=>{C||v(!1),f==null||f()},[C,f]),M=N.useCallback(()=>{C||v(!0),d==null||d()},[C,d]),F=N.useCallback(()=>{b?L():M()},[b,M,L]);function z(K={}){return{...K,"aria-expanded":b,"aria-controls":O,onClick(re){var ae;(ae=K.onClick)==null||ae.call(K,re),F()}}}function Z(K={}){return{...K,hidden:!b,id:O}}return{isOpen:b,onOpen:M,onClose:L,onToggle:F,isControlled:C,getButtonProps:z,getDisclosureProps:Z}}const op=globalThis!=null&&globalThis.document?N.useLayoutEffect:N.useEffect,zf=(n,t)=>{const i=N.useRef(!1),a=N.useRef(!1);N.useEffect(()=>{if(i.current&&a.current)return n();a.current=!0},t),N.useEffect(()=>(i.current=!0,()=>{i.current=!1}),[])};function EEe(n){const t=n.current;if(!t)return!1;const i=Vye(t);return!i||t.contains(i)?!1:!!Zye(i)}function XQ(n,t){const{shouldFocus:i,visible:a,focusRef:l}=t,d=i&&!a;zf(()=>{if(!d||EEe(n))return;const f=(l==null?void 0:l.current)||n.current;let _;if(f)return _=requestAnimationFrame(()=>{f.focus({preventScroll:!0})}),()=>{cancelAnimationFrame(_)}},[d,n,l])}const vEe={preventScroll:!0,shouldFocus:!1};function SEe(n,t=vEe){const{focusRef:i,preventScroll:a,shouldFocus:l,visible:d}=t,f=bEe(n)?n.current:n,_=l&&d,v=N.useRef(_),b=N.useRef(d);op(()=>{!b.current&&d&&(v.current=_),b.current=d},[d,_]);const C=N.useCallback(()=>{if(!(!d||!f||!v.current)&&(v.current=!1,!f.contains(document.activeElement)))if(i!=null&&i.current)requestAnimationFrame(()=>{var I;(I=i.current)==null||I.focus({preventScroll:a})});else{const I=WQ(f);I.length>0&&requestAnimationFrame(()=>{I[0].focus({preventScroll:a})})}},[d,a,f,i]);zf(()=>{C()},[C]),Iy(f,"transitionend",C)}function bEe(n){return"current"in n}function TEe(n){return"current"in n}const JQ=()=>typeof window<"u";function wEe(){const n=navigator.userAgentData;return(n==null?void 0:n.platform)??navigator.platform}const CEe=n=>JQ()&&n.test(navigator.vendor),REe=n=>JQ()&&n.test(wEe()),IEe=()=>REe(/mac|iphone|ipad|ipod/i),AEe=()=>IEe()&&CEe(/apple/i);function PEe(n){const{ref:t,elements:i,enabled:a}=n,l=()=>{var d;return((d=t.current)==null?void 0:d.ownerDocument)??document};Iy(l,"pointerdown",d=>{var b,C;if(!AEe()||!a)return;const f=((C=(b=d.composedPath)==null?void 0:b.call(d))==null?void 0:C[0])??d.target,v=(i??[t]).some(I=>{const O=TEe(I)?I.current:I;return(O==null?void 0:O.contains(f))||O===f});l().activeElement!==f&&v&&(d.preventDefault(),f.focus())})}function OEe(n,t){const i=N.useId();return N.useMemo(()=>n||[t,i].filter(Boolean).join("-"),[n,t,i])}function kEe(n,...t){const i=OEe(n);return N.useMemo(()=>t.map(a=>`${a}-${i}`),[i,t])}function NEe(n,t){const i=to(n);N.useEffect(()=>{let a=null;const l=()=>i();return t!==null&&(a=window.setInterval(l,t)),()=>{a&&window.clearInterval(a)}},[t,i])}function QQ(n){const t=N.useRef(null);return t.current=n,t}function DEe(n,t){if(n!=null){if(typeof n=="function"){n(t);return}try{n.current=t}catch{throw new Error(`Cannot assign value '${t}' to ref '${n}'`)}}}function Vi(...n){return t=>{n.forEach(i=>{DEe(i,t)})}}function xEe(...n){return N.useMemo(()=>Vi(...n),n)}function ZQ(n){const{ref:t,handler:i,enabled:a=!0}=n,l=to(i),f=N.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}).current;N.useEffect(()=>{if(!a)return;const _=I=>{J2(I,t)&&(f.isPointerDown=!0)},v=I=>{if(f.ignoreEmulatedMouseEvents){f.ignoreEmulatedMouseEvents=!1;return}f.isPointerDown&&i&&J2(I,t)&&(f.isPointerDown=!1,l(I))},b=I=>{f.ignoreEmulatedMouseEvents=!0,i&&f.isPointerDown&&J2(I,t)&&(f.isPointerDown=!1,l(I))},C=eZ(t.current);return C.addEventListener("mousedown",_,!0),C.addEventListener("mouseup",v,!0),C.addEventListener("touchstart",_,!0),C.addEventListener("touchend",b,!0),()=>{C.removeEventListener("mousedown",_,!0),C.removeEventListener("mouseup",v,!0),C.removeEventListener("touchstart",_,!0),C.removeEventListener("touchend",b,!0)}},[i,t,l,f,a])}function J2(n,t){var a,l;const i=((a=n.composedPath)==null?void 0:a.call(n)[0])??n.target;return i&&!eZ(i).contains(i)?!1:!((l=t.current)!=null&&l.contains(i))}function eZ(n){return(n==null?void 0:n.ownerDocument)??document}function LEe(n,t){const i=to(n);N.useEffect(()=>{if(t==null)return;let a=null;return a=window.setTimeout(()=>{i()},t),()=>{a&&window.clearTimeout(a)}},[t,i])}const tZ=1/60*1e3,MEe=typeof performance<"u"?()=>performance.now():()=>Date.now(),nZ=typeof window<"u"?n=>window.requestAnimationFrame(n):n=>setTimeout(()=>n(MEe()),tZ);function UEe(n){let t=[],i=[],a=0,l=!1,d=!1;const f=new WeakSet,_={schedule:(v,b=!1,C=!1)=>{const I=C&&l,O=I?t:i;return b&&f.add(v),O.indexOf(v)===-1&&(O.push(v),I&&l&&(a=t.length)),v},cancel:v=>{const b=i.indexOf(v);b!==-1&&i.splice(b,1),f.delete(v)},process:v=>{if(l){d=!0;return}if(l=!0,[t,i]=[i,t],i.length=0,a=t.length,a)for(let b=0;b<a;b++){const C=t[b];C(v),f.has(C)&&(_.schedule(C),n())}l=!1,d&&(d=!1,_.process(v))}};return _}const VEe=40;let EU=!0,gC=!1,vU=!1;const YS={delta:0,timestamp:0},HC=["read","update","preRender","render","postRender"],u1=HC.reduce((n,t)=>(n[t]=UEe(()=>gC=!0),n),{}),jEe=HC.reduce((n,t)=>{const i=u1[t];return n[t]=(a,l=!1,d=!1)=>(gC||zEe(),i.schedule(a,l,d)),n},{}),FEe=HC.reduce((n,t)=>(n[t]=u1[t].cancel,n),{});HC.reduce((n,t)=>(n[t]=()=>u1[t].process(YS),n),{});const BEe=n=>u1[n].process(YS),rZ=n=>{gC=!1,YS.delta=EU?tZ:Math.max(Math.min(n-YS.timestamp,VEe),1),YS.timestamp=n,vU=!0,HC.forEach(BEe),vU=!1,gC&&(EU=!1,nZ(rZ))},zEe=()=>{gC=!0,EU=!0,vU||nZ(rZ)},dK=()=>YS;var WEe=Object.defineProperty,GEe=(n,t,i)=>t in n?WEe(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i,Md=(n,t,i)=>(GEe(n,typeof t!="symbol"?t+"":t,i),i);class HEe{constructor(t,i,a){if(Md(this,"history",[]),Md(this,"startEvent",null),Md(this,"lastEvent",null),Md(this,"lastEventInfo",null),Md(this,"handlers",{}),Md(this,"removeListeners",()=>{}),Md(this,"threshold",3),Md(this,"win"),Md(this,"updatePoint",()=>{if(!(this.lastEvent&&this.lastEventInfo))return;const _=Q2(this.lastEventInfo,this.history),v=this.startEvent!==null,b=YEe(_.offset,{x:0,y:0})>=this.threshold;if(!v&&!b)return;const{timestamp:C}=dK();this.history.push({..._.point,timestamp:C});const{onStart:I,onMove:O}=this.handlers;v||(I==null||I(this.lastEvent,_),this.startEvent=this.lastEvent),O==null||O(this.lastEvent,_)}),Md(this,"onPointerMove",(_,v)=>{this.lastEvent=_,this.lastEventInfo=v,jEe.update(this.updatePoint,!0)}),Md(this,"onPointerUp",(_,v)=>{const b=Q2(v,this.history),{onEnd:C,onSessionEnd:I}=this.handlers;I==null||I(_,b),this.end(),!(!C||!this.startEvent)&&(C==null||C(_,b))}),this.win=t.view??window,Fye(t))return;this.handlers=i,a&&(this.threshold=a),t.stopPropagation(),t.preventDefault();const l={point:jQ(t)},{timestamp:d}=dK();this.history=[{...l.point,timestamp:d}];const{onSessionStart:f}=i;f==null||f(t,Q2(l,this.history)),this.removeListeners=qEe(UO(this.win,"pointermove",this.onPointerMove),UO(this.win,"pointerup",this.onPointerUp),UO(this.win,"pointercancel",this.onPointerUp))}updateHandlers(t){this.handlers=t}end(){var t;(t=this.removeListeners)==null||t.call(this),FEe.update(this.updatePoint)}}function hK(n,t){return{x:n.x-t.x,y:n.y-t.y}}function Q2(n,t){return{point:n.point,delta:hK(n.point,t[t.length-1]),offset:hK(n.point,t[0]),velocity:KEe(t,.1)}}const $Ee=n=>n*1e3;function KEe(n,t){if(n.length<2)return{x:0,y:0};let i=n.length-1,a=null;const l=n[n.length-1];for(;i>=0&&(a=n[i],!(l.timestamp-a.timestamp>$Ee(t)));)i--;if(!a)return{x:0,y:0};const d=(l.timestamp-a.timestamp)/1e3;if(d===0)return{x:0,y:0};const f={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}function qEe(...n){return t=>n.reduce((i,a)=>a(i),t)}function Z2(n,t){return Math.abs(n-t)}function pK(n){return"x"in n&&"y"in n}function YEe(n,t){if(typeof n=="number"&&typeof t=="number")return Z2(n,t);if(pK(n)&&pK(t)){const i=Z2(n.x,t.x),a=Z2(n.y,t.y);return Math.sqrt(i**2+a**2)}return 0}function XEe(n,t){const{onPan:i,onPanStart:a,onPanEnd:l,onPanSessionStart:d,onPanSessionEnd:f,threshold:_}=t,v=!!(i||a||l||d||f),b=N.useRef(null),C=QQ({onSessionStart:d,onSessionEnd:f,onStart:a,onMove:i,onEnd(I,O){b.current=null,l==null||l(I,O)}});N.useEffect(()=>{var I;(I=b.current)==null||I.updateHandlers(C.current)}),N.useEffect(()=>{const I=n.current;if(!I||!v)return;function O(L){b.current=new HEe(L,C.current,_)}return UO(I,"pointerdown",O)},[n,v,C,_]),N.useEffect(()=>()=>{var I;(I=b.current)==null||I.end(),b.current=null},[])}const Po={open:(n,t)=>`${n}[data-open], ${n}[open], ${n}[data-state=open] ${t}`,closed:(n,t)=>`${n}[data-closed], ${n}[data-state=closed] ${t}`,hover:(n,t)=>`${n}:hover ${t}, ${n}[data-hover] ${t}`,focus:(n,t)=>`${n}:focus ${t}, ${n}[data-focus] ${t}`,focusVisible:(n,t)=>`${n}:focus-visible ${t}`,focusWithin:(n,t)=>`${n}:focus-within ${t}`,active:(n,t)=>`${n}:active ${t}, ${n}[data-active] ${t}`,disabled:(n,t)=>`${n}:disabled ${t}, ${n}[data-disabled] ${t}`,invalid:(n,t)=>`${n}:invalid ${t}, ${n}[data-invalid] ${t}`,checked:(n,t)=>`${n}:checked ${t}, ${n}[data-checked] ${t}`,placeholderShown:(n,t)=>`${n}:placeholder-shown ${t}`},Wh=n=>iZ(t=>n(t,"&"),"[role=group]","[data-group]",".group"),bf=n=>iZ(t=>n(t,"~ &"),"[data-peer]",".peer"),iZ=(n,...t)=>t.map(n).join(", "),XS={_hover:"&:hover, &[data-hover]",_active:"&:active, &[data-active]",_focus:"&:focus, &[data-focus]",_highlighted:"&[data-highlighted]",_focusWithin:"&:focus-within, &[data-focus-within]",_focusVisible:"&:focus-visible, &[data-focus-visible]",_disabled:"&:disabled, &[disabled], &[aria-disabled=true], &[data-disabled]",_readOnly:"&[aria-readonly=true], &[readonly], &[data-readonly]",_before:"&::before",_after:"&::after",_empty:"&:empty, &[data-empty]",_expanded:"&[aria-expanded=true], &[data-expanded], &[data-state=expanded]",_checked:"&[aria-checked=true], &[data-checked], &[data-state=checked]",_grabbed:"&[aria-grabbed=true], &[data-grabbed]",_pressed:"&[aria-pressed=true], &[data-pressed]",_invalid:"&[aria-invalid=true], &[data-invalid]",_valid:"&[data-valid], &[data-state=valid]",_loading:"&[data-loading], &[aria-busy=true]",_selected:"&[aria-selected=true], &[data-selected]",_hidden:"&[hidden], &[data-hidden]",_autofill:"&:-webkit-autofill",_even:"&:nth-of-type(even)",_odd:"&:nth-of-type(odd)",_first:"&:first-of-type",_firstLetter:"&::first-letter",_last:"&:last-of-type",_notFirst:"&:not(:first-of-type)",_notLast:"&:not(:last-of-type)",_visited:"&:visited",_activeLink:"&[aria-current=page]",_activeStep:"&[aria-current=step]",_indeterminate:"&:indeterminate, &[aria-checked=mixed], &[data-indeterminate], &[data-state=indeterminate]",_groupOpen:Wh(Po.open),_groupClosed:Wh(Po.closed),_groupHover:Wh(Po.hover),_peerHover:bf(Po.hover),_groupFocus:Wh(Po.focus),_peerFocus:bf(Po.focus),_groupFocusVisible:Wh(Po.focusVisible),_peerFocusVisible:bf(Po.focusVisible),_groupActive:Wh(Po.active),_peerActive:bf(Po.active),_groupDisabled:Wh(Po.disabled),_peerDisabled:bf(Po.disabled),_groupInvalid:Wh(Po.invalid),_peerInvalid:bf(Po.invalid),_groupChecked:Wh(Po.checked),_peerChecked:bf(Po.checked),_groupFocusWithin:Wh(Po.focusWithin),_peerFocusWithin:bf(Po.focusWithin),_peerPlaceholderShown:bf(Po.placeholderShown),_placeholder:"&::placeholder, &[data-placeholder]",_placeholderShown:"&:placeholder-shown, &[data-placeholder-shown]",_fullScreen:"&:fullscreen, &[data-fullscreen]",_selection:"&::selection",_rtl:"[dir=rtl] &, &[dir=rtl]",_ltr:"[dir=ltr] &, &[dir=ltr]",_mediaDark:"@media (prefers-color-scheme: dark)",_mediaReduceMotion:"@media (prefers-reduced-motion: reduce)",_dark:".chakra-ui-dark &:not([data-theme]),[data-theme=dark] &:not([data-theme]),&[data-theme=dark]",_light:".chakra-ui-light &:not([data-theme]),[data-theme=light] &:not([data-theme]),&[data-theme=light]",_horizontal:"&[data-orientation=horizontal]",_vertical:"&[data-orientation=vertical]",_open:"&[data-open], &[open], &[data-state=open]",_closed:"&[data-closed], &[data-state=closed]",_complete:"&[data-complete]",_incomplete:"&[data-incomplete]",_current:"&[data-current]"},sZ=Object.keys(XS),JEe=n=>/!(important)?$/.test(n),fK=n=>typeof n=="string"?n.replace(/!(important)?$/,"").trim():n,QEe=(n,t)=>i=>{const a=String(t),l=JEe(a),d=fK(a),f=n?`${n}.${d}`:d;let _=Bu(i.__cssMap)&&f in i.__cssMap?i.__cssMap[f].varRef:t;return _=fK(_),l?`${_} !important`:_};function cj(n){const{scale:t,transform:i,compose:a}=n;return(d,f)=>{const _=QEe(t,d)(f);let v=(i==null?void 0:i(_,f))??_;return a&&(v=a(v,f)),v}}const oO=(...n)=>t=>n.reduce((i,a)=>a(i),t);function Mu(n,t){return i=>{const a={property:i,scale:n};return a.transform=cj({scale:n,transform:t}),a}}const ZEe=({rtl:n,ltr:t})=>i=>i.direction==="rtl"?n:t;function eve(n){const{property:t,scale:i,transform:a}=n;return{scale:i,property:ZEe(t),transform:i?cj({scale:i,compose:a}):a}}const oZ=["rotate(var(--chakra-rotate, 0))","scaleX(var(--chakra-scale-x, 1))","scaleY(var(--chakra-scale-y, 1))","skewX(var(--chakra-skew-x, 0))","skewY(var(--chakra-skew-y, 0))"];function tve(){return["translateX(var(--chakra-translate-x, 0))","translateY(var(--chakra-translate-y, 0))",...oZ].join(" ")}function nve(){return["translate3d(var(--chakra-translate-x, 0), var(--chakra-translate-y, 0), 0)",...oZ].join(" ")}const rve={"--chakra-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-sepia":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-drop-shadow":"var(--chakra-empty,/*!*/ /*!*/)",filter:["var(--chakra-blur)","var(--chakra-brightness)","var(--chakra-contrast)","var(--chakra-grayscale)","var(--chakra-hue-rotate)","var(--chakra-invert)","var(--chakra-saturate)","var(--chakra-sepia)","var(--chakra-drop-shadow)"].join(" ")},ive={backdropFilter:["var(--chakra-backdrop-blur)","var(--chakra-backdrop-brightness)","var(--chakra-backdrop-contrast)","var(--chakra-backdrop-grayscale)","var(--chakra-backdrop-hue-rotate)","var(--chakra-backdrop-invert)","var(--chakra-backdrop-opacity)","var(--chakra-backdrop-saturate)","var(--chakra-backdrop-sepia)"].join(" "),"--chakra-backdrop-blur":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-brightness":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-contrast":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-grayscale":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-hue-rotate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-invert":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-opacity":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-saturate":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-backdrop-sepia":"var(--chakra-empty,/*!*/ /*!*/)"};function sve(n){return{"--chakra-ring-offset-shadow":"var(--chakra-ring-inset) 0 0 0 var(--chakra-ring-offset-width) var(--chakra-ring-offset-color)","--chakra-ring-shadow":"var(--chakra-ring-inset) 0 0 0 calc(var(--chakra-ring-width) + var(--chakra-ring-offset-width)) var(--chakra-ring-color)","--chakra-ring-width":n,boxShadow:["var(--chakra-ring-offset-shadow)","var(--chakra-ring-shadow)","var(--chakra-shadow, 0 0 #0000)"].join(", ")}}const ove={"row-reverse":{space:"--chakra-space-x-reverse",divide:"--chakra-divide-x-reverse"},"column-reverse":{space:"--chakra-space-y-reverse",divide:"--chakra-divide-y-reverse"}},SU={"to-t":"to top","to-tr":"to top right","to-r":"to right","to-br":"to bottom right","to-b":"to bottom","to-bl":"to bottom left","to-l":"to left","to-tl":"to top left"},ave=new Set(Object.values(SU)),bU=new Set(["none","-moz-initial","inherit","initial","revert","unset"]),cve=n=>n.trim();function lve(n,t){if(n==null||bU.has(n))return n;if(!(TU(n)||bU.has(n)))return`url('${n}')`;const l=/(^[a-z-A-Z]+)\((.*)\)/g.exec(n),d=l==null?void 0:l[1],f=l==null?void 0:l[2];if(!d||!f)return n;const _=d.includes("-gradient")?d:`${d}-gradient`,[v,...b]=f.split(",").map(cve).filter(Boolean);if((b==null?void 0:b.length)===0)return n;const C=v in SU?SU[v]:v;b.unshift(C);const I=b.map(O=>{if(ave.has(O))return O;const L=O.indexOf(" "),[M,F]=L!==-1?[O.substr(0,L),O.substr(L+1)]:[O],z=TU(F)?F:F&&F.split(" "),Z=`colors.${M}`,K=Z in t.__cssMap?t.__cssMap[Z].varRef:M;return z?[K,...Array.isArray(z)?z:[z]].join(" "):K});return`${_}(${I.join(", ")})`}const TU=n=>typeof n=="string"&&n.includes("(")&&n.includes(")"),uve=(n,t)=>lve(n,t??{});function dve(n){return/^var\(--.+\)$/.test(n)}const hve=n=>{const t=parseFloat(n.toString()),i=n.toString().replace(String(t),"");return{unitless:!i,value:t,unit:i}},Gh=n=>t=>`${n}(${t})`,Vr={filter(n){return n!=="auto"?n:rve},backdropFilter(n){return n!=="auto"?n:ive},ring(n){return sve(Vr.px(n))},bgClip(n){return n==="text"?{color:"transparent",backgroundClip:"text"}:{backgroundClip:n}},transform(n){return n==="auto"?tve():n==="auto-gpu"?nve():n},vh(n){return n==="$100vh"?"var(--chakra-vh)":n},px(n){if(n==null)return n;const{unitless:t}=hve(n);return t||typeof n=="number"?`${n}px`:n},fraction(n){return typeof n!="number"||n>1?n:`${n*100}%`},float(n,t){const i={left:"right",right:"left"};return t.direction==="rtl"?i[n]:n},degree(n){if(dve(n)||n==null)return n;const t=typeof n=="string"&&!n.endsWith("deg");return typeof n=="number"||t?`${n}deg`:n},gradient:uve,blur:Gh("blur"),opacity:Gh("opacity"),brightness:Gh("brightness"),contrast:Gh("contrast"),dropShadow:Gh("drop-shadow"),grayscale:Gh("grayscale"),hueRotate:n=>Gh("hue-rotate")(Vr.degree(n)),invert:Gh("invert"),saturate:Gh("saturate"),sepia:Gh("sepia"),bgImage(n){return n==null||TU(n)||bU.has(n)?n:`url(${n})`},outline(n){const t=String(n)==="0"||String(n)==="none";return n!==null&&t?{outline:"2px solid transparent",outlineOffset:"2px"}:{outline:n}},flexDirection(n){const{space:t,divide:i}=ove[n]??{},a={flexDirection:n};return t&&(a[t]=1),i&&(a[i]=1),a}},Ge={borderWidths:Mu("borderWidths"),borderStyles:Mu("borderStyles"),colors:Mu("colors"),borders:Mu("borders"),gradients:Mu("gradients",Vr.gradient),radii:Mu("radii",Vr.px),space:Mu("space",oO(Vr.vh,Vr.px)),spaceT:Mu("space",oO(Vr.vh,Vr.px)),degreeT(n){return{property:n,transform:Vr.degree}},prop(n,t,i){return{property:n,scale:t,...t&&{transform:cj({scale:t,transform:i})}}},propT(n,t){return{property:n,transform:t}},sizes:Mu("sizes",oO(Vr.vh,Vr.px)),sizesT:Mu("sizes",oO(Vr.vh,Vr.fraction)),shadows:Mu("shadows"),logical:eve,blur:Mu("blur",Vr.blur)},jO={background:Ge.colors("background"),backgroundColor:Ge.colors("backgroundColor"),backgroundImage:Ge.gradients("backgroundImage"),backgroundSize:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundAttachment:!0,backgroundClip:{transform:Vr.bgClip},bgSize:Ge.prop("backgroundSize"),bgPosition:Ge.prop("backgroundPosition"),bg:Ge.colors("background"),bgColor:Ge.colors("backgroundColor"),bgPos:Ge.prop("backgroundPosition"),bgRepeat:Ge.prop("backgroundRepeat"),bgAttachment:Ge.prop("backgroundAttachment"),bgGradient:Ge.gradients("backgroundImage"),bgClip:{transform:Vr.bgClip}};Object.assign(jO,{bgImage:jO.backgroundImage,bgImg:jO.backgroundImage});const ti={border:Ge.borders("border"),borderWidth:Ge.borderWidths("borderWidth"),borderStyle:Ge.borderStyles("borderStyle"),borderColor:Ge.colors("borderColor"),borderRadius:Ge.radii("borderRadius"),borderTop:Ge.borders("borderTop"),borderBlockStart:Ge.borders("borderBlockStart"),borderTopLeftRadius:Ge.radii("borderTopLeftRadius"),borderStartStartRadius:Ge.logical({scale:"radii",property:{ltr:"borderTopLeftRadius",rtl:"borderTopRightRadius"}}),borderEndStartRadius:Ge.logical({scale:"radii",property:{ltr:"borderBottomLeftRadius",rtl:"borderBottomRightRadius"}}),borderTopRightRadius:Ge.radii("borderTopRightRadius"),borderStartEndRadius:Ge.logical({scale:"radii",property:{ltr:"borderTopRightRadius",rtl:"borderTopLeftRadius"}}),borderEndEndRadius:Ge.logical({scale:"radii",property:{ltr:"borderBottomRightRadius",rtl:"borderBottomLeftRadius"}}),borderRight:Ge.borders("borderRight"),borderInlineEnd:Ge.borders("borderInlineEnd"),borderBottom:Ge.borders("borderBottom"),borderBlockEnd:Ge.borders("borderBlockEnd"),borderBottomLeftRadius:Ge.radii("borderBottomLeftRadius"),borderBottomRightRadius:Ge.radii("borderBottomRightRadius"),borderLeft:Ge.borders("borderLeft"),borderInlineStart:{property:"borderInlineStart",scale:"borders"},borderInlineStartRadius:Ge.logical({scale:"radii",property:{ltr:["borderTopLeftRadius","borderBottomLeftRadius"],rtl:["borderTopRightRadius","borderBottomRightRadius"]}}),borderInlineEndRadius:Ge.logical({scale:"radii",property:{ltr:["borderTopRightRadius","borderBottomRightRadius"],rtl:["borderTopLeftRadius","borderBottomLeftRadius"]}}),borderX:Ge.borders(["borderLeft","borderRight"]),borderInline:Ge.borders("borderInline"),borderY:Ge.borders(["borderTop","borderBottom"]),borderBlock:Ge.borders("borderBlock"),borderTopWidth:Ge.borderWidths("borderTopWidth"),borderBlockStartWidth:Ge.borderWidths("borderBlockStartWidth"),borderTopColor:Ge.colors("borderTopColor"),borderBlockStartColor:Ge.colors("borderBlockStartColor"),borderTopStyle:Ge.borderStyles("borderTopStyle"),borderBlockStartStyle:Ge.borderStyles("borderBlockStartStyle"),borderBottomWidth:Ge.borderWidths("borderBottomWidth"),borderBlockEndWidth:Ge.borderWidths("borderBlockEndWidth"),borderBottomColor:Ge.colors("borderBottomColor"),borderBlockEndColor:Ge.colors("borderBlockEndColor"),borderBottomStyle:Ge.borderStyles("borderBottomStyle"),borderBlockEndStyle:Ge.borderStyles("borderBlockEndStyle"),borderLeftWidth:Ge.borderWidths("borderLeftWidth"),borderInlineStartWidth:Ge.borderWidths("borderInlineStartWidth"),borderLeftColor:Ge.colors("borderLeftColor"),borderInlineStartColor:Ge.colors("borderInlineStartColor"),borderLeftStyle:Ge.borderStyles("borderLeftStyle"),borderInlineStartStyle:Ge.borderStyles("borderInlineStartStyle"),borderRightWidth:Ge.borderWidths("borderRightWidth"),borderInlineEndWidth:Ge.borderWidths("borderInlineEndWidth"),borderRightColor:Ge.colors("borderRightColor"),borderInlineEndColor:Ge.colors("borderInlineEndColor"),borderRightStyle:Ge.borderStyles("borderRightStyle"),borderInlineEndStyle:Ge.borderStyles("borderInlineEndStyle"),borderTopRadius:Ge.radii(["borderTopLeftRadius","borderTopRightRadius"]),borderBottomRadius:Ge.radii(["borderBottomLeftRadius","borderBottomRightRadius"]),borderLeftRadius:Ge.radii(["borderTopLeftRadius","borderBottomLeftRadius"]),borderRightRadius:Ge.radii(["borderTopRightRadius","borderBottomRightRadius"])};Object.assign(ti,{rounded:ti.borderRadius,roundedTop:ti.borderTopRadius,roundedTopLeft:ti.borderTopLeftRadius,roundedTopRight:ti.borderTopRightRadius,roundedTopStart:ti.borderStartStartRadius,roundedTopEnd:ti.borderStartEndRadius,roundedBottom:ti.borderBottomRadius,roundedBottomLeft:ti.borderBottomLeftRadius,roundedBottomRight:ti.borderBottomRightRadius,roundedBottomStart:ti.borderEndStartRadius,roundedBottomEnd:ti.borderEndEndRadius,roundedLeft:ti.borderLeftRadius,roundedRight:ti.borderRightRadius,roundedStart:ti.borderInlineStartRadius,roundedEnd:ti.borderInlineEndRadius,borderStart:ti.borderInlineStart,borderEnd:ti.borderInlineEnd,borderTopStartRadius:ti.borderStartStartRadius,borderTopEndRadius:ti.borderStartEndRadius,borderBottomStartRadius:ti.borderEndStartRadius,borderBottomEndRadius:ti.borderEndEndRadius,borderStartRadius:ti.borderInlineStartRadius,borderEndRadius:ti.borderInlineEndRadius,borderStartWidth:ti.borderInlineStartWidth,borderEndWidth:ti.borderInlineEndWidth,borderStartColor:ti.borderInlineStartColor,borderEndColor:ti.borderInlineEndColor,borderStartStyle:ti.borderInlineStartStyle,borderEndStyle:ti.borderInlineEndStyle});const pve={color:Ge.colors("color"),textColor:Ge.colors("color"),fill:Ge.colors("fill"),stroke:Ge.colors("stroke"),accentColor:Ge.colors("accentColor"),textFillColor:Ge.colors("textFillColor")},vk={alignItems:!0,alignContent:!0,justifyItems:!0,justifyContent:!0,flexWrap:!0,flexDirection:{transform:Vr.flexDirection},flex:!0,flexFlow:!0,flexGrow:!0,flexShrink:!0,flexBasis:Ge.sizes("flexBasis"),justifySelf:!0,alignSelf:!0,order:!0,placeItems:!0,placeContent:!0,placeSelf:!0,gap:Ge.space("gap"),rowGap:Ge.space("rowGap"),columnGap:Ge.space("columnGap")};Object.assign(vk,{flexDir:vk.flexDirection});const ju={width:Ge.sizesT("width"),inlineSize:Ge.sizesT("inlineSize"),height:Ge.sizes("height"),blockSize:Ge.sizes("blockSize"),boxSize:Ge.sizes(["width","height"]),minWidth:Ge.sizes("minWidth"),minInlineSize:Ge.sizes("minInlineSize"),minHeight:Ge.sizes("minHeight"),minBlockSize:Ge.sizes("minBlockSize"),maxWidth:Ge.sizes("maxWidth"),maxInlineSize:Ge.sizes("maxInlineSize"),maxHeight:Ge.sizes("maxHeight"),maxBlockSize:Ge.sizes("maxBlockSize"),overflow:!0,overflowX:!0,overflowY:!0,overscrollBehavior:!0,overscrollBehaviorX:!0,overscrollBehaviorY:!0,display:!0,aspectRatio:!0,hideFrom:{scale:"breakpoints",transform:(n,t)=>{var l,d;return{[`@media screen and (min-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(n))==null?void 0:d.minW)??n})`]:{display:"none"}}}},hideBelow:{scale:"breakpoints",transform:(n,t)=>{var l,d;return{[`@media screen and (max-width: ${((d=(l=t.__breakpoints)==null?void 0:l.get(n))==null?void 0:d._minW)??n})`]:{display:"none"}}}},verticalAlign:!0,boxSizing:!0,boxDecorationBreak:!0,float:Ge.propT("float",Vr.float),objectFit:!0,objectPosition:!0,visibility:!0,isolation:!0};Object.assign(ju,{w:ju.width,h:ju.height,minW:ju.minWidth,maxW:ju.maxWidth,minH:ju.minHeight,maxH:ju.maxHeight,overscroll:ju.overscrollBehavior,overscrollX:ju.overscrollBehaviorX,overscrollY:ju.overscrollBehaviorY});const fve={filter:{transform:Vr.filter},blur:Ge.blur("--chakra-blur"),brightness:Ge.propT("--chakra-brightness",Vr.brightness),contrast:Ge.propT("--chakra-contrast",Vr.contrast),hueRotate:Ge.propT("--chakra-hue-rotate",Vr.hueRotate),invert:Ge.propT("--chakra-invert",Vr.invert),saturate:Ge.propT("--chakra-saturate",Vr.saturate),dropShadow:Ge.propT("--chakra-drop-shadow",Vr.dropShadow),backdropFilter:{transform:Vr.backdropFilter},backdropBlur:Ge.blur("--chakra-backdrop-blur"),backdropBrightness:Ge.propT("--chakra-backdrop-brightness",Vr.brightness),backdropContrast:Ge.propT("--chakra-backdrop-contrast",Vr.contrast),backdropHueRotate:Ge.propT("--chakra-backdrop-hue-rotate",Vr.hueRotate),backdropInvert:Ge.propT("--chakra-backdrop-invert",Vr.invert),backdropSaturate:Ge.propT("--chakra-backdrop-saturate",Vr.saturate)},mve={ring:{transform:Vr.ring},ringColor:Ge.colors("--chakra-ring-color"),ringOffset:Ge.prop("--chakra-ring-offset-width"),ringOffsetColor:Ge.colors("--chakra-ring-offset-color"),ringInset:Ge.prop("--chakra-ring-inset")},gve={appearance:!0,cursor:!0,resize:!0,userSelect:!0,pointerEvents:!0,outline:{transform:Vr.outline},outlineOffset:!0,outlineColor:Ge.colors("outlineColor")},aZ={gridGap:Ge.space("gridGap"),gridColumnGap:Ge.space("gridColumnGap"),gridRowGap:Ge.space("gridRowGap"),gridColumn:!0,gridRow:!0,gridAutoFlow:!0,gridAutoColumns:!0,gridColumnStart:!0,gridColumnEnd:!0,gridRowStart:!0,gridRowEnd:!0,gridAutoRows:!0,gridTemplate:!0,gridTemplateColumns:!0,gridTemplateRows:!0,gridTemplateAreas:!0,gridArea:!0};function _ve(n,t,i,a){const l=typeof t=="string"?t.split("."):[t];for(a=0;a<l.length&&n;a+=1)n=n[l[a]];return n===void 0?i:n}const yve=n=>{const t=new WeakMap;return(a,l,d,f)=>{if(typeof a>"u")return n(a,l,d);t.has(a)||t.set(a,new Map);const _=t.get(a);if(_.has(l))return _.get(l);const v=n(a,l,d,f);return _.set(l,v),v}},Eve=yve(_ve),vve={border:"0px",clip:"rect(0, 0, 0, 0)",width:"1px",height:"1px",margin:"-1px",padding:"0px",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"},Sve={position:"static",width:"auto",height:"auto",clip:"auto",padding:"0",margin:"0",overflow:"visible",whiteSpace:"normal"},eM=(n,t,i)=>{const a={},l=Eve(n,t,{});for(const d in l)d in i&&i[d]!=null||(a[d]=l[d]);return a},bve={srOnly:{transform(n){return n===!0?vve:n==="focusable"?Sve:{}}},layerStyle:{processResult:!0,transform:(n,t,i)=>eM(t,`layerStyles.${n}`,i)},textStyle:{processResult:!0,transform:(n,t,i)=>eM(t,`textStyles.${n}`,i)},apply:{processResult:!0,transform:(n,t,i)=>eM(t,n,i)}},Xw={position:!0,pos:Ge.prop("position"),zIndex:Ge.prop("zIndex","zIndices"),inset:Ge.spaceT("inset"),insetX:Ge.spaceT(["left","right"]),insetInline:Ge.spaceT("insetInline"),insetY:Ge.spaceT(["top","bottom"]),insetBlock:Ge.spaceT("insetBlock"),top:Ge.spaceT("top"),insetBlockStart:Ge.spaceT("insetBlockStart"),bottom:Ge.spaceT("bottom"),insetBlockEnd:Ge.spaceT("insetBlockEnd"),left:Ge.spaceT("left"),insetInlineStart:Ge.logical({scale:"space",property:{ltr:"left",rtl:"right"}}),right:Ge.spaceT("right"),insetInlineEnd:Ge.logical({scale:"space",property:{ltr:"right",rtl:"left"}})};Object.assign(Xw,{insetStart:Xw.insetInlineStart,insetEnd:Xw.insetInlineEnd});const wU={boxShadow:Ge.shadows("boxShadow"),mixBlendMode:!0,blendMode:Ge.prop("mixBlendMode"),backgroundBlendMode:!0,bgBlendMode:Ge.prop("backgroundBlendMode"),opacity:!0};Object.assign(wU,{shadow:wU.boxShadow});const es={margin:Ge.spaceT("margin"),marginTop:Ge.spaceT("marginTop"),marginBlockStart:Ge.spaceT("marginBlockStart"),marginRight:Ge.spaceT("marginRight"),marginInlineEnd:Ge.spaceT("marginInlineEnd"),marginBottom:Ge.spaceT("marginBottom"),marginBlockEnd:Ge.spaceT("marginBlockEnd"),marginLeft:Ge.spaceT("marginLeft"),marginInlineStart:Ge.spaceT("marginInlineStart"),marginX:Ge.spaceT(["marginInlineStart","marginInlineEnd"]),marginInline:Ge.spaceT("marginInline"),marginY:Ge.spaceT(["marginTop","marginBottom"]),marginBlock:Ge.spaceT("marginBlock"),padding:Ge.space("padding"),paddingTop:Ge.space("paddingTop"),paddingBlockStart:Ge.space("paddingBlockStart"),paddingRight:Ge.space("paddingRight"),paddingBottom:Ge.space("paddingBottom"),paddingBlockEnd:Ge.space("paddingBlockEnd"),paddingLeft:Ge.space("paddingLeft"),paddingInlineStart:Ge.space("paddingInlineStart"),paddingInlineEnd:Ge.space("paddingInlineEnd"),paddingX:Ge.space(["paddingInlineStart","paddingInlineEnd"]),paddingInline:Ge.space("paddingInline"),paddingY:Ge.space(["paddingTop","paddingBottom"]),paddingBlock:Ge.space("paddingBlock")};Object.assign(es,{m:es.margin,mt:es.marginTop,mr:es.marginRight,me:es.marginInlineEnd,marginEnd:es.marginInlineEnd,mb:es.marginBottom,ml:es.marginLeft,ms:es.marginInlineStart,marginStart:es.marginInlineStart,mx:es.marginX,my:es.marginY,p:es.padding,pt:es.paddingTop,py:es.paddingY,px:es.paddingX,pb:es.paddingBottom,pl:es.paddingLeft,ps:es.paddingInlineStart,paddingStart:es.paddingInlineStart,pr:es.paddingRight,pe:es.paddingInlineEnd,paddingEnd:es.paddingInlineEnd});const Tve={scrollBehavior:!0,scrollSnapAlign:!0,scrollSnapStop:!0,scrollSnapType:!0,scrollMargin:Ge.spaceT("scrollMargin"),scrollMarginTop:Ge.spaceT("scrollMarginTop"),scrollMarginBottom:Ge.spaceT("scrollMarginBottom"),scrollMarginLeft:Ge.spaceT("scrollMarginLeft"),scrollMarginRight:Ge.spaceT("scrollMarginRight"),scrollMarginX:Ge.spaceT(["scrollMarginLeft","scrollMarginRight"]),scrollMarginY:Ge.spaceT(["scrollMarginTop","scrollMarginBottom"]),scrollPadding:Ge.spaceT("scrollPadding"),scrollPaddingTop:Ge.spaceT("scrollPaddingTop"),scrollPaddingBottom:Ge.spaceT("scrollPaddingBottom"),scrollPaddingLeft:Ge.spaceT("scrollPaddingLeft"),scrollPaddingRight:Ge.spaceT("scrollPaddingRight"),scrollPaddingX:Ge.spaceT(["scrollPaddingLeft","scrollPaddingRight"]),scrollPaddingY:Ge.spaceT(["scrollPaddingTop","scrollPaddingBottom"])},wve={fontFamily:Ge.prop("fontFamily","fonts"),fontSize:Ge.prop("fontSize","fontSizes",Vr.px),fontWeight:Ge.prop("fontWeight","fontWeights"),lineHeight:Ge.prop("lineHeight","lineHeights"),letterSpacing:Ge.prop("letterSpacing","letterSpacings"),textAlign:!0,fontStyle:!0,textIndent:!0,wordBreak:!0,overflowWrap:!0,textOverflow:!0,textTransform:!0,whiteSpace:!0,isTruncated:{transform(n){if(n===!0)return{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}},noOfLines:{static:{overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:"var(--chakra-line-clamp)"},property:"--chakra-line-clamp"}},Cve={textDecorationColor:Ge.colors("textDecorationColor"),textDecoration:!0,textDecor:{property:"textDecoration"},textDecorationLine:!0,textDecorationStyle:!0,textDecorationThickness:!0,textUnderlineOffset:!0,textShadow:Ge.shadows("textShadow")},Rve={clipPath:!0,transform:Ge.propT("transform",Vr.transform),transformOrigin:!0,translateX:Ge.spaceT("--chakra-translate-x"),translateY:Ge.spaceT("--chakra-translate-y"),skewX:Ge.degreeT("--chakra-skew-x"),skewY:Ge.degreeT("--chakra-skew-y"),scaleX:Ge.prop("--chakra-scale-x"),scaleY:Ge.prop("--chakra-scale-y"),scale:Ge.prop(["--chakra-scale-x","--chakra-scale-y"]),rotate:Ge.degreeT("--chakra-rotate")},Ive={listStyleType:!0,listStylePosition:!0,listStylePos:Ge.prop("listStylePosition"),listStyleImage:!0,listStyleImg:Ge.prop("listStyleImage")},Ave={transition:!0,transitionDelay:!0,animation:!0,willChange:!0,transitionDuration:Ge.prop("transitionDuration","transition.duration"),transitionProperty:Ge.prop("transitionProperty","transition.property"),transitionTimingFunction:Ge.prop("transitionTimingFunction","transition.easing")},lj=ep({},jO,ti,pve,vk,ju,fve,mve,gve,aZ,bve,Xw,wU,es,Tve,wve,Cve,Rve,Ive,Ave),Pve=Object.assign({},es,ju,vk,aZ,Xw),Ove=Object.keys(Pve),kve=[...Object.keys(lj),...sZ],Nve={...lj,...XS},Dve=n=>n in Nve,xve=n=>t=>{if(!t.__breakpoints)return n;const{isResponsive:i,toArrayValue:a,media:l}=t.__breakpoints,d={};for(const f in n){let _=ml(n[f],t);if(_==null)continue;if(_=Bu(_)&&i(_)?a(_):_,!Array.isArray(_)){d[f]=_;continue}const v=_.slice(0,l.length).length;for(let b=0;b<v;b+=1){const C=l==null?void 0:l[b];if(!C){d[f]=_[b];continue}d[C]=d[C]||{},_[b]!=null&&(d[C][f]=_[b])}}return d};function Lve(n){const t=[];let i="",a=!1;for(let l=0;l<n.length;l++){const d=n[l];d==="("?(a=!0,i+=d):d===")"?(a=!1,i+=d):d===","&&!a?(t.push(i),i=""):i+=d}return i=i.trim(),i&&t.push(i),t}function Mve(n){return/^var\(--.+\)$/.test(n)}const Uve=(n,t)=>n.startsWith("--")&&typeof t=="string"&&!Mve(t),Vve=(n,t)=>{if(t==null)return t;const i=f=>{var _,v;return(v=(_=n.__cssMap)==null?void 0:_[f])==null?void 0:v.varRef},a=f=>i(f)??f,[l,d]=Lve(t);return t=i(l)??a(d)??a(t),t};function jve(n){const{configs:t={},pseudos:i={},theme:a}=n,l=(d,f=!1)=>{var C;const _=ml(d,a),v=xve(_)(a);let b={};for(let I in v){const O=v[I];let L=ml(O,a);I in i&&(I=i[I]),Uve(I,L)&&(L=Vve(a,L));let M=t[I];if(M===!0&&(M={property:I}),Bu(L)){b[I]=b[I]??{},b[I]=ep({},b[I],l(L,!0));continue}let F=((C=M==null?void 0:M.transform)==null?void 0:C.call(M,L,a,_))??L;F=M!=null&&M.processResult?l(F,!0):F;const z=ml(M==null?void 0:M.property,a);if(!f&&(M!=null&&M.static)){const Z=ml(M.static,a);b=ep({},b,Z)}if(z&&Array.isArray(z)){for(const Z of z)b[Z]=F;continue}if(z){z==="&"&&Bu(F)?b=ep({},b,F):b[z]=F;continue}if(Bu(F)){b=ep({},b,F);continue}b[I]=F}return b};return l}const cZ=n=>t=>jve({theme:t,pseudos:XS,configs:lj})(n);function A8e(n){return n}function P8e(n){return n}function $i(n){return{definePartsStyle(t){return t},defineMultiStyleConfig(t){return{parts:n,...t}}}}function Fve(n,t,i){var a,l;return((l=(a=n.__cssMap)==null?void 0:a[`${t}.${i}`])==null?void 0:l.varRef)??i}function Bve(n,t){if(Array.isArray(n))return n;if(Bu(n))return t(n);if(n!=null)return[n]}function zve(n,t){for(let i=t+1;i<n.length;i++)if(n[i]!=null)return i;return-1}function Wve(n){const t=n.__breakpoints;return function(a,l,d,f){var O,L;if(!t)return;const _={},v=Bve(d,t.toArrayValue);if(!v)return _;const b=v.length,C=b===1,I=!!a.parts;for(let M=0;M<b;M++){const F=t.details[M],z=t.details[zve(v,M)],Z=Ow(F.minW,z==null?void 0:z._minW),K=ml((O=a[l])==null?void 0:O[v[M]],f);if(K){if(I){(L=a.parts)==null||L.forEach(re=>{ep(_,{[re]:C?K[re]:{[Z]:K[re]}})});continue}if(!I){C?ep(_,K):_[Z]=K;continue}_[Z]=K}}return _}}function Gve(n){return t=>{const{variant:i,size:a,theme:l}=t,d=Wve(l);return ep({},ml(n.baseStyle??{},t),d(n,"sizes",a,t),d(n,"variants",i,t))}}function Fi(n){return L0(n,["styleConfig","size","variant","colorScheme"])}function lZ(n){return Bu(n)&&n.reference?n.reference:String(n)}const d1=(n,...t)=>t.map(lZ).join(` ${n} `).replace(/calc/g,""),mK=(...n)=>`calc(${d1("+",...n)})`,gK=(...n)=>`calc(${d1("-",...n)})`,CU=(...n)=>`calc(${d1("*",...n)})`,_K=(...n)=>`calc(${d1("/",...n)})`,yK=n=>{const t=lZ(n);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:CU(t,-1)},Rf=Object.assign(n=>({add:(...t)=>Rf(mK(n,...t)),subtract:(...t)=>Rf(gK(n,...t)),multiply:(...t)=>Rf(CU(n,...t)),divide:(...t)=>Rf(_K(n,...t)),negate:()=>Rf(yK(n)),toString:()=>n.toString()}),{add:mK,subtract:gK,multiply:CU,divide:_K,negate:yK});function Hve(n,t="-"){return n.replace(/\s+/g,t)}function $ve(n){const t=Hve(n.toString());return qve(Kve(t))}function Kve(n){return n.includes("\\.")?n:!Number.isInteger(parseFloat(n.toString()))?n.replace(".","\\."):n}function qve(n){return n.replace(/[!-,/:-@[-^`{-~]/g,"\\$&")}function Yve(n,t=""){return[t,n].filter(Boolean).join("-")}function Xve(n,t){return`var(${n}${t?`, ${t}`:""})`}function Jve(n,t=""){return $ve(`--${Yve(n,t)}`)}function Vn(n,t,i){const a=Jve(n,i);return{variable:a,reference:Xve(a,t)}}function Qve(n,t){const i={};for(const a of t){if(Array.isArray(a)){const[l,d]=a;i[l]=Vn(`${n}-${l}`,d);continue}i[a]=Vn(`${n}-${a}`)}return i}const Zve=["colors","borders","borderWidths","borderStyles","fonts","fontSizes","fontWeights","gradients","letterSpacings","lineHeights","radii","space","shadows","sizes","zIndices","transition","blur","breakpoints"];function eSe(n){return HQ(n,Zve)}function tSe(n){return n.semanticTokens}function nSe(n){const{__cssMap:t,__cssVars:i,__breakpoints:a,...l}=n;return l}function rSe(n){const t=eSe(n),i=tSe(n),a=d=>sZ.includes(d)||d==="default",l={};return sK(t,(d,f)=>{d!=null&&(l[f.join(".")]={isSemantic:!1,value:d})}),sK(i,(d,f)=>{d!=null&&(l[f.join(".")]={isSemantic:!0,value:d})},{stop:d=>Object.keys(d).every(a)}),l}function EK(n,t){return Vn(String(n).replace(/\./g,"-"),void 0,t)}function iSe(n){var f;const t=rSe(n),i=(f=n.config)==null?void 0:f.cssVarPrefix;let a={};const l={};function d(_,v){const C=[String(_).split(".")[0],v].join(".");if(!t[C])return v;const{reference:O}=EK(C,i);return O}for(const[_,v]of Object.entries(t)){const{isSemantic:b,value:C}=v,{variable:I,reference:O}=EK(_,i);if(!b){if(_.startsWith("space")){const M=_.split("."),[F,...z]=M,Z=`${F}.-${z.join(".")}`,K=Rf.negate(C),re=Rf.negate(O);l[Z]={value:K,var:I,varRef:re}}a[I]=C,l[_]={value:C,var:I,varRef:O};continue}const L=Bu(C)?C:{default:C};a=ep(a,Object.entries(L).reduce((M,[F,z])=>{if(!z)return M;const Z=d(_,`${z}`);if(F==="default")return M[I]=Z,M;const K=(XS==null?void 0:XS[F])??F;return M[K]={[I]:Z},M},{})),l[_]={value:O,var:I,varRef:O}}return{cssVars:a,cssMap:l}}function sSe(n){const t=nSe(n),{cssMap:i,cssVars:a}=iSe(t);return Object.assign(t,{__cssVars:{...{"--chakra-ring-inset":"var(--chakra-empty,/*!*/ /*!*/)","--chakra-ring-offset-width":"0px","--chakra-ring-offset-color":"#fff","--chakra-ring-color":"rgba(66, 153, 225, 0.6)","--chakra-ring-offset-shadow":"0 0 #0000","--chakra-ring-shadow":"0 0 #0000","--chakra-space-x-reverse":"0","--chakra-space-y-reverse":"0"},...a},__cssMap:i,__breakpoints:Xye(t.breakpoints)}),t}function si(n,t={}){let i=!1;function a(){if(!i){i=!0;return}throw new Error("[anatomy] .part(...) should only be called once. Did you mean to use .extend(...) ?")}function l(...C){a();for(const I of C)t[I]=v(I);return si(n,t)}function d(...C){for(const I of C)I in t||(t[I]=v(I));return si(n,t)}function f(){return Object.fromEntries(Object.entries(t).map(([I,O])=>[I,O.selector]))}function _(){return Object.fromEntries(Object.entries(t).map(([I,O])=>[I,O.className]))}function v(C){const L=`chakra-${(["container","root"].includes(C??"")?[n]:[n,C]).filter(Boolean).join("__")}`;return{className:L,selector:`.${L}`,toString:()=>C}}return{parts:l,toPart:v,extend:d,selectors:f,classnames:_,get keys(){return Object.keys(t)},__type:{}}}const oSe=si("accordion").parts("root","container","button","panel","icon"),aSe=si("alert").parts("title","description","container","icon","spinner"),cSe=si("avatar").parts("label","badge","container","excessLabel","group"),lSe=si("breadcrumb").parts("link","item","container","separator");si("button").parts();const uSe=si("checkbox").parts("control","icon","container","label");si("progress").parts("track","filledTrack","label");const dSe=si("drawer").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),hSe=si("editable").parts("preview","input","textarea"),pSe=si("form").parts("container","requiredIndicator","helperText"),fSe=si("formError").parts("text","icon"),mSe=si("input").parts("addon","field","element","group"),gSe=si("list").parts("container","item","icon"),_Se=si("menu").parts("button","list","item","groupTitle","icon","command","divider"),ySe=si("modal").parts("overlay","dialogContainer","dialog","header","closeButton","body","footer"),ESe=si("numberinput").parts("root","field","stepperGroup","stepper");si("pininput").parts("field");const vSe=si("popover").parts("content","header","body","footer","popper","arrow","closeButton"),SSe=si("progress").parts("label","filledTrack","track"),bSe=si("radio").parts("container","control","label"),TSe=si("select").parts("field","icon"),wSe=si("slider").parts("container","track","thumb","filledTrack","mark"),CSe=si("stat").parts("container","label","helpText","number","icon"),RSe=si("switch").parts("container","track","thumb","label"),ISe=si("table").parts("table","thead","tbody","tr","th","td","tfoot","caption"),ASe=si("tabs").parts("root","tab","tablist","tabpanel","tabpanels","indicator"),PSe=si("tag").parts("container","label","closeButton"),OSe=si("card").parts("container","header","body","footer");si("stepper").parts("stepper","step","title","description","indicator","separator","icon","number");const{definePartsStyle:kSe,defineMultiStyleConfig:NSe}=$i(oSe.keys),DSe={borderTopWidth:"1px",borderColor:"inherit",_last:{borderBottomWidth:"1px"}},xSe={transitionProperty:"common",transitionDuration:"normal",fontSize:"md",_focusVisible:{boxShadow:"outline"},_hover:{bg:"blackAlpha.50"},_disabled:{opacity:.4,cursor:"not-allowed"},px:"4",py:"2"},LSe={pt:"2",px:"4",pb:"5"},MSe={fontSize:"1.25em"},USe=kSe({container:DSe,button:xSe,panel:LSe,icon:MSe}),VSe=NSe({baseStyle:USe});function by(n,t,i){return Math.min(Math.max(n,i),t)}class jSe extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}}var Nw=jSe;function uj(n){if(typeof n!="string")throw new Nw(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let t=n.trim();t=KSe.test(n)?zSe(n):n;const i=WSe.exec(t);if(i){const f=Array.from(i).slice(1);return[...f.slice(0,3).map(_=>parseInt(_C(_,2),16)),parseInt(_C(f[3]||"f",2),16)/255]}const a=GSe.exec(t);if(a){const f=Array.from(a).slice(1);return[...f.slice(0,3).map(_=>parseInt(_,16)),parseInt(f[3]||"ff",16)/255]}const l=HSe.exec(t);if(l){const f=Array.from(l).slice(1);return[...f.slice(0,3).map(_=>parseInt(_,10)),parseFloat(f[3]||"1")]}const d=$Se.exec(t);if(d){const[f,_,v,b]=Array.from(d).slice(1).map(parseFloat);if(by(0,100,_)!==_)throw new Nw(n);if(by(0,100,v)!==v)throw new Nw(n);return[...qSe(f,_,v),Number.isNaN(b)?1:b]}throw new Nw(n)}function FSe(n){let t=5381,i=n.length;for(;i;)t=t*33^n.charCodeAt(--i);return(t>>>0)%2341}const vK=n=>parseInt(n.replace(/_/g,""),36),BSe="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,t)=>{const i=vK(t.substring(0,3)),a=vK(t.substring(3)).toString(16);let l="";for(let d=0;d<6-a.length;d++)l+="0";return n[i]=`${l}${a}`,n},{});function zSe(n){const t=n.toLowerCase().trim(),i=BSe[FSe(t)];if(!i)throw new Nw(n);return`#${i}`}const _C=(n,t)=>Array.from(Array(t)).map(()=>n).join(""),WSe=new RegExp(`^#${_C("([a-f0-9])",3)}([a-f0-9])?$`,"i"),GSe=new RegExp(`^#${_C("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),HSe=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${_C(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),$Se=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,KSe=/^[a-z]+$/i,SK=n=>Math.round(n*255),qSe=(n,t,i)=>{let a=i/100;if(t===0)return[a,a,a].map(SK);const l=(n%360+360)%360/60,d=(1-Math.abs(2*a-1))*(t/100),f=d*(1-Math.abs(l%2-1));let _=0,v=0,b=0;l>=0&&l<1?(_=d,v=f):l>=1&&l<2?(_=f,v=d):l>=2&&l<3?(v=d,b=f):l>=3&&l<4?(v=f,b=d):l>=4&&l<5?(_=f,b=d):l>=5&&l<6&&(_=d,b=f);const C=a-d/2,I=_+C,O=v+C,L=b+C;return[I,O,L].map(SK)};function YSe(n,t,i,a){return`rgba(${by(0,255,n).toFixed()}, ${by(0,255,t).toFixed()}, ${by(0,255,i).toFixed()}, ${parseFloat(by(0,1,a).toFixed(3))})`}function XSe(n,t){const[i,a,l,d]=uj(n);return YSe(i,a,l,d-t)}function JSe(n){const[t,i,a,l]=uj(n);let d=f=>{const _=by(0,255,f).toString(16);return _.length===1?`0${_}`:_};return`#${d(t)}${d(i)}${d(a)}${l<1?d(Math.round(l*255)):""}`}const QSe=n=>Object.keys(n).length===0;function ZSe(n,t,i,a,l){for(t=t.split?t.split("."):t,a=0;a<t.length;a++)n=n?n[t[a]]:l;return n===l?i:n}const Pc=(n,t,i)=>{const a=ZSe(n,`colors.${t}`,t);try{return JSe(a),a}catch{return i??"#000000"}},e0e=n=>{const[t,i,a]=uj(n);return(t*299+i*587+a*114)/1e3},t0e=n=>t=>{const i=Pc(t,n);return e0e(i)<128?"dark":"light"},n0e=n=>t=>t0e(n)(t)==="dark",d0=(n,t)=>i=>{const a=Pc(i,n);return XSe(a,1-t)};function bK(n="1rem",t="rgba(255, 255, 255, 0.15)"){return{backgroundImage:`linear-gradient(
    45deg,
    ${t} 25%,
    transparent 25%,
    transparent 50%,
    ${t} 50%,
    ${t} 75%,
    transparent 75%,
    transparent
  )`,backgroundSize:`${n} ${n}`}}const r0e=()=>`#${Math.floor(Math.random()*16777215).toString(16).padEnd(6,"0")}`;function i0e(n){const t=r0e();return!n||QSe(n)?t:n.string&&n.colors?o0e(n.string,n.colors):n.string&&!n.colors?s0e(n.string):n.colors&&!n.string?a0e(n.colors):t}function s0e(n){let t=0;if(n.length===0)return t.toString();for(let a=0;a<n.length;a+=1)t=n.charCodeAt(a)+((t<<5)-t),t=t&t;let i="#";for(let a=0;a<3;a+=1){const l=t>>a*8&255;i+=`00${l.toString(16)}`.substr(-2)}return i}function o0e(n,t){let i=0;if(n.length===0)return t[0];for(let a=0;a<n.length;a+=1)i=n.charCodeAt(a)+((i<<5)-i),i=i&i;return i=(i%t.length+t.length)%t.length,t[i]}function a0e(n){return n[Math.floor(Math.random()*n.length)]}function Un(n,t){return i=>i.colorMode==="dark"?t:n}function dj(n){const{orientation:t,vertical:i,horizontal:a}=n;return t?t==="vertical"?i:a:{}}function uZ(n){return Bu(n)&&n.reference?n.reference:String(n)}const h1=(n,...t)=>t.map(uZ).join(` ${n} `).replace(/calc/g,""),TK=(...n)=>`calc(${h1("+",...n)})`,wK=(...n)=>`calc(${h1("-",...n)})`,RU=(...n)=>`calc(${h1("*",...n)})`,CK=(...n)=>`calc(${h1("/",...n)})`,RK=n=>{const t=uZ(n);return t!=null&&!Number.isNaN(parseFloat(t))?String(t).startsWith("-")?String(t).slice(1):`-${t}`:RU(t,-1)},If=Object.assign(n=>({add:(...t)=>If(TK(n,...t)),subtract:(...t)=>If(wK(n,...t)),multiply:(...t)=>If(RU(n,...t)),divide:(...t)=>If(CK(n,...t)),negate:()=>If(RK(n)),toString:()=>n.toString()}),{add:TK,subtract:wK,multiply:RU,divide:CK,negate:RK});function c0e(n){return!Number.isInteger(parseFloat(n.toString()))}function l0e(n,t="-"){return n.replace(/\s+/g,t)}function dZ(n){const t=l0e(n.toString());return t.includes("\\.")?n:c0e(n)?t.replace(".","\\."):n}function u0e(n,t=""){return[t,dZ(n)].filter(Boolean).join("-")}function d0e(n,t){return`var(${dZ(n)}${t?`, ${t}`:""})`}function h0e(n,t=""){return`--${u0e(n,t)}`}function Lo(n,t){const i=h0e(n,t==null?void 0:t.prefix);return{variable:i,reference:d0e(i,p0e(t==null?void 0:t.fallback))}}function p0e(n){return n==null?void 0:n.reference}const{definePartsStyle:$C,defineMultiStyleConfig:f0e}=$i(aSe.keys),Kl=Vn("alert-fg"),Wf=Vn("alert-bg"),m0e=$C({container:{bg:Wf.reference,px:"4",py:"3"},title:{fontWeight:"bold",lineHeight:"6",marginEnd:"2"},description:{lineHeight:"6"},icon:{color:Kl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"6"},spinner:{color:Kl.reference,flexShrink:0,marginEnd:"3",w:"5",h:"5"}});function hj(n){const{theme:t,colorScheme:i}=n,a=d0(`${i}.200`,.16)(t);return{light:`colors.${i}.100`,dark:a}}const g0e=$C(n=>{const{colorScheme:t}=n,i=hj(n);return{container:{[Kl.variable]:`colors.${t}.600`,[Wf.variable]:i.light,_dark:{[Kl.variable]:`colors.${t}.200`,[Wf.variable]:i.dark}}}}),_0e=$C(n=>{const{colorScheme:t}=n,i=hj(n);return{container:{[Kl.variable]:`colors.${t}.600`,[Wf.variable]:i.light,_dark:{[Kl.variable]:`colors.${t}.200`,[Wf.variable]:i.dark},paddingStart:"3",borderStartWidth:"4px",borderStartColor:Kl.reference}}}),y0e=$C(n=>{const{colorScheme:t}=n,i=hj(n);return{container:{[Kl.variable]:`colors.${t}.600`,[Wf.variable]:i.light,_dark:{[Kl.variable]:`colors.${t}.200`,[Wf.variable]:i.dark},pt:"2",borderTopWidth:"4px",borderTopColor:Kl.reference}}}),E0e=$C(n=>{const{colorScheme:t}=n;return{container:{[Kl.variable]:"colors.white",[Wf.variable]:`colors.${t}.600`,_dark:{[Kl.variable]:"colors.gray.900",[Wf.variable]:`colors.${t}.200`},color:Kl.reference}}}),v0e={subtle:g0e,"left-accent":_0e,"top-accent":y0e,solid:E0e},S0e=f0e({baseStyle:m0e,variants:v0e,defaultProps:{variant:"subtle",colorScheme:"blue"}}),hZ={px:"1px",.5:"0.125rem",1:"0.25rem",1.5:"0.375rem",2:"0.5rem",2.5:"0.625rem",3:"0.75rem",3.5:"0.875rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem",12:"3rem",14:"3.5rem",16:"4rem",20:"5rem",24:"6rem",28:"7rem",32:"8rem",36:"9rem",40:"10rem",44:"11rem",48:"12rem",52:"13rem",56:"14rem",60:"15rem",64:"16rem",72:"18rem",80:"20rem",96:"24rem"},b0e={max:"max-content",min:"min-content",full:"100%","3xs":"14rem","2xs":"16rem",xs:"20rem",sm:"24rem",md:"28rem",lg:"32rem",xl:"36rem","2xl":"42rem","3xl":"48rem","4xl":"56rem","5xl":"64rem","6xl":"72rem","7xl":"80rem","8xl":"90rem",prose:"60ch"},T0e={sm:"640px",md:"768px",lg:"1024px",xl:"1280px"},pZ={...hZ,...b0e,container:T0e},w0e=n=>typeof n=="function";function Oc(n,...t){return w0e(n)?n(...t):n}const{definePartsStyle:fZ,defineMultiStyleConfig:C0e}=$i(cSe.keys),JS=Vn("avatar-border-color"),Jw=Vn("avatar-bg"),yC=Vn("avatar-font-size"),h0=Vn("avatar-size"),R0e={borderRadius:"full",border:"0.2em solid",borderColor:JS.reference,[JS.variable]:"white",_dark:{[JS.variable]:"colors.gray.800"}},I0e={bg:Jw.reference,fontSize:yC.reference,width:h0.reference,height:h0.reference,lineHeight:"1",[Jw.variable]:"colors.gray.200",_dark:{[Jw.variable]:"colors.whiteAlpha.400"}},A0e=n=>{const{name:t,theme:i}=n,a=t?i0e({string:t}):"colors.gray.400",l=n0e(a)(i);let d="white";return l||(d="gray.800"),{bg:Jw.reference,fontSize:yC.reference,color:d,borderColor:JS.reference,verticalAlign:"top",width:h0.reference,height:h0.reference,"&:not([data-loaded])":{[Jw.variable]:a},[JS.variable]:"colors.white",_dark:{[JS.variable]:"colors.gray.800"}}},P0e={fontSize:yC.reference,lineHeight:"1"},O0e=fZ(n=>({badge:Oc(R0e,n),excessLabel:Oc(I0e,n),container:Oc(A0e,n),label:P0e}));function lg(n){const t=n!=="100%"?pZ[n]:void 0;return fZ({container:{[h0.variable]:t??n,[yC.variable]:`calc(${t??n} / 2.5)`},excessLabel:{[h0.variable]:t??n,[yC.variable]:`calc(${t??n} / 2.5)`}})}const k0e={"2xs":lg(4),xs:lg(6),sm:lg(8),md:lg(12),lg:lg(16),xl:lg(24),"2xl":lg(32),full:lg("100%")},N0e=C0e({baseStyle:O0e,sizes:k0e,defaultProps:{size:"md"}}),no=Qve("badge",["bg","color","shadow"]),D0e={px:1,textTransform:"uppercase",fontSize:"xs",borderRadius:"sm",fontWeight:"bold",bg:no.bg.reference,color:no.color.reference,boxShadow:no.shadow.reference},x0e=n=>{const{colorScheme:t,theme:i}=n,a=d0(`${t}.500`,.6)(i);return{[no.bg.variable]:`colors.${t}.500`,[no.color.variable]:"colors.white",_dark:{[no.bg.variable]:a,[no.color.variable]:"colors.whiteAlpha.800"}}},L0e=n=>{const{colorScheme:t,theme:i}=n,a=d0(`${t}.200`,.16)(i);return{[no.bg.variable]:`colors.${t}.100`,[no.color.variable]:`colors.${t}.800`,_dark:{[no.bg.variable]:a,[no.color.variable]:`colors.${t}.200`}}},M0e=n=>{const{colorScheme:t,theme:i}=n,a=d0(`${t}.200`,.8)(i);return{[no.color.variable]:`colors.${t}.500`,_dark:{[no.color.variable]:a},[no.shadow.variable]:`inset 0 0 0px 1px ${no.color.reference}`}},U0e={solid:x0e,subtle:L0e,outline:M0e},Qw={baseStyle:D0e,variants:U0e,defaultProps:{variant:"subtle",colorScheme:"gray"}},{defineMultiStyleConfig:V0e,definePartsStyle:j0e}=$i(lSe.keys),tM=Vn("breadcrumb-link-decor"),F0e={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",outline:"none",color:"inherit",textDecoration:tM.reference,[tM.variable]:"none","&:not([aria-current=page])":{cursor:"pointer",_hover:{[tM.variable]:"underline"},_focusVisible:{boxShadow:"outline"}}},B0e=j0e({link:F0e}),z0e=V0e({baseStyle:B0e}),W0e={lineHeight:"1.2",borderRadius:"md",fontWeight:"semibold",transitionProperty:"common",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{_disabled:{bg:"initial"}}},mZ=n=>{const{colorScheme:t,theme:i}=n;if(t==="gray")return{color:Un("gray.800","whiteAlpha.900")(n),_hover:{bg:Un("gray.100","whiteAlpha.200")(n)},_active:{bg:Un("gray.200","whiteAlpha.300")(n)}};const a=d0(`${t}.200`,.12)(i),l=d0(`${t}.200`,.24)(i);return{color:Un(`${t}.600`,`${t}.200`)(n),bg:"transparent",_hover:{bg:Un(`${t}.50`,a)(n)},_active:{bg:Un(`${t}.100`,l)(n)}}},G0e=n=>{const{colorScheme:t}=n,i=Un("gray.200","whiteAlpha.300")(n);return{border:"1px solid",borderColor:t==="gray"?i:"currentColor",".chakra-button__group[data-attached][data-orientation=horizontal] > &:not(:last-of-type)":{marginEnd:"-1px"},".chakra-button__group[data-attached][data-orientation=vertical] > &:not(:last-of-type)":{marginBottom:"-1px"},...Oc(mZ,n)}},H0e={yellow:{bg:"yellow.400",color:"black",hoverBg:"yellow.500",activeBg:"yellow.600"},cyan:{bg:"cyan.400",color:"black",hoverBg:"cyan.500",activeBg:"cyan.600"}},$0e=n=>{const{colorScheme:t}=n;if(t==="gray"){const _=Un("gray.100","whiteAlpha.200")(n);return{bg:_,color:Un("gray.800","whiteAlpha.900")(n),_hover:{bg:Un("gray.200","whiteAlpha.300")(n),_disabled:{bg:_}},_active:{bg:Un("gray.300","whiteAlpha.400")(n)}}}const{bg:i=`${t}.500`,color:a="white",hoverBg:l=`${t}.600`,activeBg:d=`${t}.700`}=H0e[t]??{},f=Un(i,`${t}.200`)(n);return{bg:f,color:Un(a,"gray.800")(n),_hover:{bg:Un(l,`${t}.300`)(n),_disabled:{bg:f}},_active:{bg:Un(d,`${t}.400`)(n)}}},K0e=n=>{const{colorScheme:t}=n;return{padding:0,height:"auto",lineHeight:"normal",verticalAlign:"baseline",color:Un(`${t}.500`,`${t}.200`)(n),_hover:{textDecoration:"underline",_disabled:{textDecoration:"none"}},_active:{color:Un(`${t}.700`,`${t}.500`)(n)}}},q0e={bg:"none",color:"inherit",display:"inline",lineHeight:"inherit",m:"0",p:"0"},Y0e={ghost:mZ,outline:G0e,solid:$0e,link:K0e,unstyled:q0e},X0e={lg:{h:"12",minW:"12",fontSize:"lg",px:"6"},md:{h:"10",minW:"10",fontSize:"md",px:"4"},sm:{h:"8",minW:"8",fontSize:"sm",px:"3"},xs:{h:"6",minW:"6",fontSize:"xs",px:"2"}},J0e={baseStyle:W0e,variants:Y0e,sizes:X0e,defaultProps:{variant:"solid",size:"md",colorScheme:"gray"}},{definePartsStyle:Ay,defineMultiStyleConfig:Q0e}=$i(OSe.keys),Sk=Vn("card-bg"),Mf=Vn("card-padding"),gZ=Vn("card-shadow"),FO=Vn("card-radius"),_Z=Vn("card-border-width","0"),yZ=Vn("card-border-color"),Z0e=Ay({container:{[Sk.variable]:"colors.chakra-body-bg",backgroundColor:Sk.reference,boxShadow:gZ.reference,borderRadius:FO.reference,color:"chakra-body-text",borderWidth:_Z.reference,borderColor:yZ.reference},body:{padding:Mf.reference,flex:"1 1 0%"},header:{padding:Mf.reference},footer:{padding:Mf.reference}}),ebe={sm:Ay({container:{[FO.variable]:"radii.base",[Mf.variable]:"space.3"}}),md:Ay({container:{[FO.variable]:"radii.md",[Mf.variable]:"space.5"}}),lg:Ay({container:{[FO.variable]:"radii.xl",[Mf.variable]:"space.7"}})},tbe={elevated:Ay({container:{[gZ.variable]:"shadows.base",_dark:{[Sk.variable]:"colors.gray.700"}}}),outline:Ay({container:{[_Z.variable]:"1px",[yZ.variable]:"colors.chakra-border-color"}}),filled:Ay({container:{[Sk.variable]:"colors.chakra-subtle-bg"}}),unstyled:{body:{[Mf.variable]:0},header:{[Mf.variable]:0},footer:{[Mf.variable]:0}}},nbe=Q0e({baseStyle:Z0e,variants:tbe,sizes:ebe,defaultProps:{variant:"elevated",size:"md"}}),{definePartsStyle:BO,defineMultiStyleConfig:rbe}=$i(uSe.keys),Zw=Vn("checkbox-size"),ibe=n=>{const{colorScheme:t}=n;return{w:Zw.reference,h:Zw.reference,transitionProperty:"box-shadow",transitionDuration:"normal",border:"2px solid",borderRadius:"sm",borderColor:"inherit",color:"white",_checked:{bg:Un(`${t}.500`,`${t}.200`)(n),borderColor:Un(`${t}.500`,`${t}.200`)(n),color:Un("white","gray.900")(n),_hover:{bg:Un(`${t}.600`,`${t}.300`)(n),borderColor:Un(`${t}.600`,`${t}.300`)(n)},_disabled:{borderColor:Un("gray.200","transparent")(n),bg:Un("gray.200","whiteAlpha.300")(n),color:Un("gray.500","whiteAlpha.500")(n)}},_indeterminate:{bg:Un(`${t}.500`,`${t}.200`)(n),borderColor:Un(`${t}.500`,`${t}.200`)(n),color:Un("white","gray.900")(n)},_disabled:{bg:Un("gray.100","whiteAlpha.100")(n),borderColor:Un("gray.100","transparent")(n)},_focusVisible:{boxShadow:"outline"},_invalid:{borderColor:Un("red.500","red.300")(n)}}},sbe={_disabled:{cursor:"not-allowed"}},obe={userSelect:"none",_disabled:{opacity:.4}},abe={transitionProperty:"transform",transitionDuration:"normal"},cbe=BO(n=>({icon:abe,container:sbe,control:Oc(ibe,n),label:obe})),lbe={sm:BO({control:{[Zw.variable]:"sizes.3"},label:{fontSize:"sm"},icon:{fontSize:"3xs"}}),md:BO({control:{[Zw.variable]:"sizes.4"},label:{fontSize:"md"},icon:{fontSize:"2xs"}}),lg:BO({control:{[Zw.variable]:"sizes.5"},label:{fontSize:"lg"},icon:{fontSize:"2xs"}})},fg=rbe({baseStyle:cbe,sizes:lbe,defaultProps:{size:"md",colorScheme:"blue"}}),eC=Lo("close-button-size"),dw=Lo("close-button-bg"),ube={w:[eC.reference],h:[eC.reference],borderRadius:"md",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed",boxShadow:"none"},_hover:{[dw.variable]:"colors.blackAlpha.100",_dark:{[dw.variable]:"colors.whiteAlpha.100"}},_active:{[dw.variable]:"colors.blackAlpha.200",_dark:{[dw.variable]:"colors.whiteAlpha.200"}},_focusVisible:{boxShadow:"outline"},bg:dw.reference},dbe={lg:{[eC.variable]:"sizes.10",fontSize:"md"},md:{[eC.variable]:"sizes.8",fontSize:"xs"},sm:{[eC.variable]:"sizes.6",fontSize:"2xs"}},hbe={baseStyle:ube,sizes:dbe,defaultProps:{size:"md"}},{variants:pbe,defaultProps:fbe}=Qw,mbe={fontFamily:"mono",fontSize:"sm",px:"0.2em",borderRadius:"sm",bg:no.bg.reference,color:no.color.reference,boxShadow:no.shadow.reference},gbe={baseStyle:mbe,variants:pbe,defaultProps:fbe},_be={w:"100%",mx:"auto",maxW:"prose",px:"4"},ybe={baseStyle:_be},Ebe={opacity:.6,borderColor:"inherit"},vbe={borderStyle:"solid"},Sbe={borderStyle:"dashed"},bbe={solid:vbe,dashed:Sbe},Tbe={baseStyle:Ebe,variants:bbe,defaultProps:{variant:"solid"}},{definePartsStyle:IU,defineMultiStyleConfig:wbe}=$i(dSe.keys),nM=Vn("drawer-bg"),rM=Vn("drawer-box-shadow");function SS(n){return IU(n==="full"?{dialog:{maxW:"100vw",h:"100vh"}}:{dialog:{maxW:n}})}const Cbe={bg:"blackAlpha.600",zIndex:"modal"},Rbe={display:"flex",zIndex:"modal",justifyContent:"center"},Ibe=n=>{const{isFullHeight:t}=n;return{...t&&{height:"100vh"},zIndex:"modal",maxH:"100vh",color:"inherit",[nM.variable]:"colors.white",[rM.variable]:"shadows.lg",_dark:{[nM.variable]:"colors.gray.700",[rM.variable]:"shadows.dark-lg"},bg:nM.reference,boxShadow:rM.reference}},Abe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},Pbe={position:"absolute",top:"2",insetEnd:"3"},Obe={px:"6",py:"2",flex:"1",overflow:"auto"},kbe={px:"6",py:"4"},Nbe=IU(n=>({overlay:Cbe,dialogContainer:Rbe,dialog:Oc(Ibe,n),header:Abe,closeButton:Pbe,body:Obe,footer:kbe})),Dbe={xs:SS("xs"),sm:SS("md"),md:SS("lg"),lg:SS("2xl"),xl:SS("4xl"),full:SS("full")},xbe=wbe({baseStyle:Nbe,sizes:Dbe,defaultProps:{size:"xs"}}),{definePartsStyle:Lbe,defineMultiStyleConfig:Mbe}=$i(hSe.keys),Ube={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal"},Vbe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},jbe={borderRadius:"md",py:"1",transitionProperty:"common",transitionDuration:"normal",width:"full",_focusVisible:{boxShadow:"outline"},_placeholder:{opacity:.6}},Fbe=Lbe({preview:Ube,input:Vbe,textarea:jbe}),Bbe=Mbe({baseStyle:Fbe}),{definePartsStyle:zbe,defineMultiStyleConfig:Wbe}=$i(pSe.keys),QS=Vn("form-control-color"),Gbe={marginStart:"1",[QS.variable]:"colors.red.500",_dark:{[QS.variable]:"colors.red.300"},color:QS.reference},Hbe={mt:"2",[QS.variable]:"colors.gray.600",_dark:{[QS.variable]:"colors.whiteAlpha.600"},color:QS.reference,lineHeight:"normal",fontSize:"sm"},$be=zbe({container:{width:"100%",position:"relative"},requiredIndicator:Gbe,helperText:Hbe}),Kbe=Wbe({baseStyle:$be}),{definePartsStyle:qbe,defineMultiStyleConfig:Ybe}=$i(fSe.keys),ZS=Vn("form-error-color"),Xbe={[ZS.variable]:"colors.red.500",_dark:{[ZS.variable]:"colors.red.300"},color:ZS.reference,mt:"2",fontSize:"sm",lineHeight:"normal"},Jbe={marginEnd:"0.5em",[ZS.variable]:"colors.red.500",_dark:{[ZS.variable]:"colors.red.300"},color:ZS.reference},Qbe=qbe({text:Xbe,icon:Jbe}),Zbe=Ybe({baseStyle:Qbe}),eTe={fontSize:"md",marginEnd:"3",mb:"2",fontWeight:"medium",transitionProperty:"common",transitionDuration:"normal",opacity:1,_disabled:{opacity:.4}},tTe={baseStyle:eTe},nTe={fontFamily:"heading",fontWeight:"bold"},rTe={"4xl":{fontSize:["6xl",null,"7xl"],lineHeight:1},"3xl":{fontSize:["5xl",null,"6xl"],lineHeight:1},"2xl":{fontSize:["4xl",null,"5xl"],lineHeight:[1.2,null,1]},xl:{fontSize:["3xl",null,"4xl"],lineHeight:[1.33,null,1.2]},lg:{fontSize:["2xl",null,"3xl"],lineHeight:[1.33,null,1.2]},md:{fontSize:"xl",lineHeight:1.2},sm:{fontSize:"md",lineHeight:1.2},xs:{fontSize:"sm",lineHeight:1.2}},iTe={baseStyle:nTe,sizes:rTe,defaultProps:{size:"xl"}},{definePartsStyle:Pf,defineMultiStyleConfig:sTe}=$i(mSe.keys),xS=Vn("input-height"),LS=Vn("input-font-size"),MS=Vn("input-padding"),US=Vn("input-border-radius"),oTe=Pf({addon:{height:xS.reference,fontSize:LS.reference,px:MS.reference,borderRadius:US.reference},field:{width:"100%",height:xS.reference,fontSize:LS.reference,px:MS.reference,borderRadius:US.reference,minWidth:0,outline:0,position:"relative",appearance:"none",transitionProperty:"common",transitionDuration:"normal",_disabled:{opacity:.4,cursor:"not-allowed"}}}),ug={lg:{[LS.variable]:"fontSizes.lg",[MS.variable]:"space.4",[US.variable]:"radii.md",[xS.variable]:"sizes.12"},md:{[LS.variable]:"fontSizes.md",[MS.variable]:"space.4",[US.variable]:"radii.md",[xS.variable]:"sizes.10"},sm:{[LS.variable]:"fontSizes.sm",[MS.variable]:"space.3",[US.variable]:"radii.sm",[xS.variable]:"sizes.8"},xs:{[LS.variable]:"fontSizes.xs",[MS.variable]:"space.2",[US.variable]:"radii.sm",[xS.variable]:"sizes.6"}},aTe={lg:Pf({field:ug.lg,group:ug.lg}),md:Pf({field:ug.md,group:ug.md}),sm:Pf({field:ug.sm,group:ug.sm}),xs:Pf({field:ug.xs,group:ug.xs})};function pj(n){const{focusBorderColor:t,errorBorderColor:i}=n;return{focusBorderColor:t||Un("blue.500","blue.300")(n),errorBorderColor:i||Un("red.500","red.300")(n)}}const cTe=Pf(n=>{const{theme:t}=n,{focusBorderColor:i,errorBorderColor:a}=pj(n);return{field:{border:"1px solid",borderColor:"inherit",bg:"inherit",_hover:{borderColor:Un("gray.300","whiteAlpha.400")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Pc(t,a),boxShadow:`0 0 0 1px ${Pc(t,a)}`},_focusVisible:{zIndex:1,borderColor:Pc(t,i),boxShadow:`0 0 0 1px ${Pc(t,i)}`}},addon:{border:"1px solid",borderColor:Un("inherit","whiteAlpha.50")(n),bg:Un("gray.100","whiteAlpha.300")(n)}}}),lTe=Pf(n=>{const{theme:t}=n,{focusBorderColor:i,errorBorderColor:a}=pj(n);return{field:{border:"2px solid",borderColor:"transparent",bg:Un("gray.100","whiteAlpha.50")(n),_hover:{bg:Un("gray.200","whiteAlpha.100")(n)},_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Pc(t,a)},_focusVisible:{bg:"transparent",borderColor:Pc(t,i)}},addon:{border:"2px solid",borderColor:"transparent",bg:Un("gray.100","whiteAlpha.50")(n)}}}),uTe=Pf(n=>{const{theme:t}=n,{focusBorderColor:i,errorBorderColor:a}=pj(n);return{field:{borderBottom:"1px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent",_readOnly:{boxShadow:"none !important",userSelect:"all"},_invalid:{borderColor:Pc(t,a),boxShadow:`0px 1px 0px 0px ${Pc(t,a)}`},_focusVisible:{borderColor:Pc(t,i),boxShadow:`0px 1px 0px 0px ${Pc(t,i)}`}},addon:{borderBottom:"2px solid",borderColor:"inherit",borderRadius:"0",px:"0",bg:"transparent"}}}),dTe=Pf({field:{bg:"transparent",px:"0",height:"auto"},addon:{bg:"transparent",px:"0",height:"auto"}}),hTe={outline:cTe,filled:lTe,flushed:uTe,unstyled:dTe},ii=sTe({baseStyle:oTe,sizes:aTe,variants:hTe,defaultProps:{size:"md",variant:"outline"}}),iM=Vn("kbd-bg"),pTe={[iM.variable]:"colors.gray.100",_dark:{[iM.variable]:"colors.whiteAlpha.100"},bg:iM.reference,borderRadius:"md",borderWidth:"1px",borderBottomWidth:"3px",fontSize:"0.8em",fontWeight:"bold",lineHeight:"normal",px:"0.4em",whiteSpace:"nowrap"},fTe={baseStyle:pTe},mTe={transitionProperty:"common",transitionDuration:"fast",transitionTimingFunction:"ease-out",cursor:"pointer",textDecoration:"none",outline:"none",color:"inherit",_hover:{textDecoration:"underline"},_focusVisible:{boxShadow:"outline"}},gTe={baseStyle:mTe},{defineMultiStyleConfig:_Te,definePartsStyle:yTe}=$i(gSe.keys),ETe={marginEnd:"2",display:"inline",verticalAlign:"text-bottom"},vTe=yTe({icon:ETe}),STe=_Te({baseStyle:vTe}),{defineMultiStyleConfig:bTe,definePartsStyle:TTe}=$i(_Se.keys),Hh=Vn("menu-bg"),sM=Vn("menu-shadow"),wTe={[Hh.variable]:"#fff",[sM.variable]:"shadows.sm",_dark:{[Hh.variable]:"colors.gray.700",[sM.variable]:"shadows.dark-lg"},color:"inherit",minW:"3xs",py:"2",zIndex:"dropdown",borderRadius:"md",borderWidth:"1px",bg:Hh.reference,boxShadow:sM.reference},CTe={py:"1.5",px:"3",transitionProperty:"background",transitionDuration:"ultra-fast",transitionTimingFunction:"ease-in",_focus:{[Hh.variable]:"colors.gray.100",_dark:{[Hh.variable]:"colors.whiteAlpha.100"}},_active:{[Hh.variable]:"colors.gray.200",_dark:{[Hh.variable]:"colors.whiteAlpha.200"}},_expanded:{[Hh.variable]:"colors.gray.100",_dark:{[Hh.variable]:"colors.whiteAlpha.100"}},_disabled:{opacity:.4,cursor:"not-allowed"},bg:Hh.reference},RTe={mx:4,my:2,fontWeight:"semibold",fontSize:"sm"},ITe={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0},ATe={opacity:.6},PTe={border:0,borderBottom:"1px solid",borderColor:"inherit",my:"2",opacity:.6},OTe={transitionProperty:"common",transitionDuration:"normal"},kTe=TTe({button:OTe,list:wTe,item:CTe,groupTitle:RTe,icon:ITe,command:ATe,divider:PTe}),NTe=bTe({baseStyle:kTe}),{defineMultiStyleConfig:DTe,definePartsStyle:AU}=$i(ySe.keys),oM=Vn("modal-bg"),aM=Vn("modal-shadow"),xTe={bg:"blackAlpha.600",zIndex:"modal"},LTe=n=>{const{isCentered:t,scrollBehavior:i}=n;return{display:"flex",zIndex:"modal",justifyContent:"center",alignItems:t?"center":"flex-start",overflow:i==="inside"?"hidden":"auto",overscrollBehaviorY:"none"}},MTe=n=>{const{isCentered:t,scrollBehavior:i}=n;return{borderRadius:"md",color:"inherit",my:t?"auto":"16",mx:t?"auto":void 0,zIndex:"modal",maxH:i==="inside"?"calc(100% - 7.5rem)":void 0,[oM.variable]:"colors.white",[aM.variable]:"shadows.lg",_dark:{[oM.variable]:"colors.gray.700",[aM.variable]:"shadows.dark-lg"},bg:oM.reference,boxShadow:aM.reference}},UTe={px:"6",py:"4",fontSize:"xl",fontWeight:"semibold"},VTe={position:"absolute",top:"2",insetEnd:"3"},jTe=n=>{const{scrollBehavior:t}=n;return{px:"6",py:"2",flex:"1",overflow:t==="inside"?"auto":void 0}},FTe={px:"6",py:"4"},BTe=AU(n=>({overlay:xTe,dialogContainer:Oc(LTe,n),dialog:Oc(MTe,n),header:UTe,closeButton:VTe,body:Oc(jTe,n),footer:FTe}));function Ud(n){return AU(n==="full"?{dialog:{maxW:"100vw",minH:"$100vh",my:"0",borderRadius:"0"}}:{dialog:{maxW:n}})}const zTe={xs:Ud("xs"),sm:Ud("sm"),md:Ud("md"),lg:Ud("lg"),xl:Ud("xl"),"2xl":Ud("2xl"),"3xl":Ud("3xl"),"4xl":Ud("4xl"),"5xl":Ud("5xl"),"6xl":Ud("6xl"),full:Ud("full")},WTe=DTe({baseStyle:BTe,sizes:zTe,defaultProps:{size:"md"}}),EZ={letterSpacings:{tighter:"-0.05em",tight:"-0.025em",normal:"0",wide:"0.025em",wider:"0.05em",widest:"0.1em"},lineHeights:{normal:"normal",none:1,shorter:1.25,short:1.375,base:1.5,tall:1.625,taller:"2",3:".75rem",4:"1rem",5:"1.25rem",6:"1.5rem",7:"1.75rem",8:"2rem",9:"2.25rem",10:"2.5rem"},fontWeights:{hairline:100,thin:200,light:300,normal:400,medium:500,semibold:600,bold:700,extrabold:800,black:900},fonts:{heading:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',body:'-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',mono:'SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace'},fontSizes:{"3xs":"0.45rem","2xs":"0.625rem",xs:"0.75rem",sm:"0.875rem",md:"1rem",lg:"1.125rem",xl:"1.25rem","2xl":"1.5rem","3xl":"1.875rem","4xl":"2.25rem","5xl":"3rem","6xl":"3.75rem","7xl":"4.5rem","8xl":"6rem","9xl":"8rem"}},{defineMultiStyleConfig:GTe,definePartsStyle:vZ}=$i(ESe.keys),fj=Lo("number-input-stepper-width"),SZ=Lo("number-input-input-padding"),HTe=If(fj).add("0.5rem").toString(),cM=Lo("number-input-bg"),lM=Lo("number-input-color"),uM=Lo("number-input-border-color"),$Te={[fj.variable]:"sizes.6",[SZ.variable]:HTe},KTe=n=>{var t;return((t=Oc(ii.baseStyle,n))==null?void 0:t.field)??{}},qTe={width:fj.reference},YTe={borderStart:"1px solid",borderStartColor:uM.reference,color:lM.reference,bg:cM.reference,[lM.variable]:"colors.chakra-body-text",[uM.variable]:"colors.chakra-border-color",_dark:{[lM.variable]:"colors.whiteAlpha.800",[uM.variable]:"colors.whiteAlpha.300"},_active:{[cM.variable]:"colors.gray.200",_dark:{[cM.variable]:"colors.whiteAlpha.300"}},_disabled:{opacity:.4,cursor:"not-allowed"}},XTe=vZ(n=>({root:$Te,field:Oc(KTe,n)??{},stepperGroup:qTe,stepper:YTe}));function aO(n){var d,f;const t=(d=ii.sizes)==null?void 0:d[n],i={lg:"md",md:"md",sm:"sm",xs:"sm"},a=((f=t.field)==null?void 0:f.fontSize)??"md",l=EZ.fontSizes[a];return vZ({field:{...t.field,paddingInlineEnd:SZ.reference,verticalAlign:"top"},stepper:{fontSize:If(l).multiply(.75).toString(),_first:{borderTopEndRadius:i[n]},_last:{borderBottomEndRadius:i[n],mt:"-1px",borderTopWidth:1}}})}const JTe={xs:aO("xs"),sm:aO("sm"),md:aO("md"),lg:aO("lg")},QTe=GTe({baseStyle:XTe,sizes:JTe,variants:ii.variants,defaultProps:ii.defaultProps});var yQ;const ZTe={...(yQ=ii.baseStyle)==null?void 0:yQ.field,textAlign:"center"},ewe={lg:{fontSize:"lg",w:12,h:12,borderRadius:"md"},md:{fontSize:"md",w:10,h:10,borderRadius:"md"},sm:{fontSize:"sm",w:8,h:8,borderRadius:"sm"},xs:{fontSize:"xs",w:6,h:6,borderRadius:"sm"}};var EQ;const twe={outline:n=>{var t,i;return((i=Oc((t=ii.variants)==null?void 0:t.outline,n))==null?void 0:i.field)??{}},flushed:n=>{var t,i;return((i=Oc((t=ii.variants)==null?void 0:t.flushed,n))==null?void 0:i.field)??{}},filled:n=>{var t,i;return((i=Oc((t=ii.variants)==null?void 0:t.filled,n))==null?void 0:i.field)??{}},unstyled:((EQ=ii.variants)==null?void 0:EQ.unstyled.field)??{}},nwe={baseStyle:ZTe,sizes:ewe,variants:twe,defaultProps:ii.defaultProps},{defineMultiStyleConfig:rwe,definePartsStyle:iwe}=$i(vSe.keys),cO=Lo("popper-bg"),swe=Lo("popper-arrow-bg"),IK=Lo("popper-arrow-shadow-color"),owe={zIndex:"popover"},awe={[cO.variable]:"colors.white",bg:cO.reference,[swe.variable]:cO.reference,[IK.variable]:"colors.gray.200",_dark:{[cO.variable]:"colors.gray.700",[IK.variable]:"colors.whiteAlpha.300"},width:"xs",border:"1px solid",borderColor:"inherit",borderRadius:"md",boxShadow:"sm",zIndex:"inherit",_focusVisible:{outline:0,boxShadow:"outline"}},cwe={px:3,py:2,borderBottomWidth:"1px"},lwe={px:3,py:2},uwe={px:3,py:2,borderTopWidth:"1px"},dwe={position:"absolute",borderRadius:"md",top:1,insetEnd:2,padding:2},hwe=iwe({popper:owe,content:awe,header:cwe,body:lwe,footer:uwe,closeButton:dwe}),pwe=rwe({baseStyle:hwe}),{defineMultiStyleConfig:fwe,definePartsStyle:Dw}=$i(SSe.keys),mwe=n=>{const{colorScheme:t,theme:i,isIndeterminate:a,hasStripe:l}=n,d=Un(bK(),bK("1rem","rgba(0,0,0,0.1)"))(n),f=Un(`${t}.500`,`${t}.200`)(n),_=`linear-gradient(
    to right,
    transparent 0%,
    ${Pc(i,f)} 50%,
    transparent 100%
  )`;return{...!a&&l&&d,...a?{bgImage:_}:{bgColor:f}}},gwe={lineHeight:"1",fontSize:"0.25em",fontWeight:"bold",color:"white"},_we=n=>({bg:Un("gray.100","whiteAlpha.300")(n)}),ywe=n=>({transitionProperty:"common",transitionDuration:"slow",...mwe(n)}),Ewe=Dw(n=>({label:gwe,filledTrack:ywe(n),track:_we(n)})),vwe={xs:Dw({track:{h:"1"}}),sm:Dw({track:{h:"2"}}),md:Dw({track:{h:"3"}}),lg:Dw({track:{h:"4"}})},Swe=fwe({sizes:vwe,baseStyle:Ewe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:bwe,definePartsStyle:zO}=$i(bSe.keys),Twe=n=>{var i;const t=(i=Oc(fg.baseStyle,n))==null?void 0:i.control;return{...t,borderRadius:"full",_checked:{...t==null?void 0:t._checked,_before:{content:'""',display:"inline-block",pos:"relative",w:"50%",h:"50%",borderRadius:"50%",bg:"currentColor"}}}},wwe=zO(n=>{var t,i;return{label:(t=fg.baseStyle)==null?void 0:t.call(fg,n).label,container:(i=fg.baseStyle)==null?void 0:i.call(fg,n).container,control:Twe(n)}}),Cwe={md:zO({control:{w:"4",h:"4"},label:{fontSize:"md"}}),lg:zO({control:{w:"5",h:"5"},label:{fontSize:"lg"}}),sm:zO({control:{width:"3",height:"3"},label:{fontSize:"sm"}})},Rwe=bwe({baseStyle:wwe,sizes:Cwe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:Iwe,definePartsStyle:Awe}=$i(TSe.keys),lO=Vn("select-bg");var vQ;const Pwe={...(vQ=ii.baseStyle)==null?void 0:vQ.field,appearance:"none",paddingBottom:"1px",lineHeight:"normal",bg:lO.reference,[lO.variable]:"colors.white",_dark:{[lO.variable]:"colors.gray.700"},"> option, > optgroup":{bg:lO.reference}},Owe={width:"6",height:"100%",insetEnd:"2",position:"relative",color:"currentColor",fontSize:"xl",_disabled:{opacity:.5}},kwe=Awe({field:Pwe,icon:Owe}),uO={paddingInlineEnd:"8"};var SQ,bQ,TQ,wQ,CQ,RQ,IQ,AQ;const Nwe={lg:{...(SQ=ii.sizes)==null?void 0:SQ.lg,field:{...(bQ=ii.sizes)==null?void 0:bQ.lg.field,...uO}},md:{...(TQ=ii.sizes)==null?void 0:TQ.md,field:{...(wQ=ii.sizes)==null?void 0:wQ.md.field,...uO}},sm:{...(CQ=ii.sizes)==null?void 0:CQ.sm,field:{...(RQ=ii.sizes)==null?void 0:RQ.sm.field,...uO}},xs:{...(IQ=ii.sizes)==null?void 0:IQ.xs,field:{...(AQ=ii.sizes)==null?void 0:AQ.xs.field,...uO},icon:{insetEnd:"1"}}},Dwe=Iwe({baseStyle:kwe,sizes:Nwe,variants:ii.variants,defaultProps:ii.defaultProps}),dM=Vn("skeleton-start-color"),hM=Vn("skeleton-end-color"),xwe={[dM.variable]:"colors.gray.100",[hM.variable]:"colors.gray.400",_dark:{[dM.variable]:"colors.gray.800",[hM.variable]:"colors.gray.600"},background:dM.reference,borderColor:hM.reference,opacity:.7,borderRadius:"sm"},Lwe={baseStyle:xwe},pM=Vn("skip-link-bg"),Mwe={borderRadius:"md",fontWeight:"semibold",_focusVisible:{boxShadow:"outline",padding:"4",position:"fixed",top:"6",insetStart:"6",[pM.variable]:"colors.white",_dark:{[pM.variable]:"colors.gray.700"},bg:pM.reference}},Uwe={baseStyle:Mwe},{defineMultiStyleConfig:Vwe,definePartsStyle:p1}=$i(wSe.keys),jy=Vn("slider-thumb-size"),EC=Vn("slider-track-size"),mg=Vn("slider-bg"),jwe=n=>{const{orientation:t}=n;return{display:"inline-block",position:"relative",cursor:"pointer",_disabled:{opacity:.6,cursor:"default",pointerEvents:"none"},...dj({orientation:t,vertical:{h:"100%",px:Rf(jy.reference).divide(2).toString()},horizontal:{w:"100%",py:Rf(jy.reference).divide(2).toString()}})}},Fwe=n=>({...dj({orientation:n.orientation,horizontal:{h:EC.reference},vertical:{w:EC.reference}}),overflow:"hidden",borderRadius:"sm",[mg.variable]:"colors.gray.200",_dark:{[mg.variable]:"colors.whiteAlpha.200"},_disabled:{[mg.variable]:"colors.gray.300",_dark:{[mg.variable]:"colors.whiteAlpha.300"}},bg:mg.reference}),Bwe=n=>{const{orientation:t}=n;return{...dj({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",_active:{transform:"translateX(-50%) scale(1.15)"}},horizontal:{top:"50%",transform:"translateY(-50%)",_active:{transform:"translateY(-50%) scale(1.15)"}}}),w:jy.reference,h:jy.reference,display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",outline:0,zIndex:1,borderRadius:"full",bg:"white",boxShadow:"base",border:"1px solid",borderColor:"transparent",transitionProperty:"transform",transitionDuration:"normal",_focusVisible:{boxShadow:"outline"},_disabled:{bg:"gray.300"}}},zwe=n=>{const{colorScheme:t}=n;return{width:"inherit",height:"inherit",[mg.variable]:`colors.${t}.500`,_dark:{[mg.variable]:`colors.${t}.200`},bg:mg.reference}},Wwe=p1(n=>({container:jwe(n),track:Fwe(n),thumb:Bwe(n),filledTrack:zwe(n)})),Gwe=p1({container:{[jy.variable]:"sizes.4",[EC.variable]:"sizes.1"}}),Hwe=p1({container:{[jy.variable]:"sizes.3.5",[EC.variable]:"sizes.1"}}),$we=p1({container:{[jy.variable]:"sizes.2.5",[EC.variable]:"sizes.0.5"}}),Kwe={lg:Gwe,md:Hwe,sm:$we},qwe=Vwe({baseStyle:Wwe,sizes:Kwe,defaultProps:{size:"md",colorScheme:"blue"}}),vy=Lo("spinner-size"),Ywe={width:[vy.reference],height:[vy.reference]},Xwe={xs:{[vy.variable]:"sizes.3"},sm:{[vy.variable]:"sizes.4"},md:{[vy.variable]:"sizes.6"},lg:{[vy.variable]:"sizes.8"},xl:{[vy.variable]:"sizes.12"}},Jwe={baseStyle:Ywe,sizes:Xwe,defaultProps:{size:"md"}},{defineMultiStyleConfig:Qwe,definePartsStyle:bZ}=$i(CSe.keys),Zwe={fontWeight:"medium"},eCe={opacity:.8,marginBottom:"2"},tCe={verticalAlign:"baseline",fontWeight:"semibold"},nCe={marginEnd:1,w:"3.5",h:"3.5",verticalAlign:"middle"},rCe=bZ({container:{},label:Zwe,helpText:eCe,number:tCe,icon:nCe}),iCe={md:bZ({label:{fontSize:"sm"},helpText:{fontSize:"sm"},number:{fontSize:"2xl"}})},sCe=Qwe({baseStyle:rCe,sizes:iCe,defaultProps:{size:"md"}}),{defineMultiStyleConfig:oCe,definePartsStyle:xw}=$i(["stepper","step","title","description","indicator","separator","icon","number"]),Af=Vn("stepper-indicator-size"),VS=Vn("stepper-icon-size"),jS=Vn("stepper-title-font-size"),Lw=Vn("stepper-description-font-size"),hw=Vn("stepper-accent-color"),aCe=xw(({colorScheme:n})=>({stepper:{display:"flex",justifyContent:"space-between",gap:"4","&[data-orientation=vertical]":{flexDirection:"column",alignItems:"flex-start"},"&[data-orientation=horizontal]":{flexDirection:"row",alignItems:"center"},[hw.variable]:`colors.${n}.500`,_dark:{[hw.variable]:`colors.${n}.200`}},title:{fontSize:jS.reference,fontWeight:"medium"},description:{fontSize:Lw.reference,color:"chakra-subtle-text"},number:{fontSize:jS.reference},step:{flexShrink:0,position:"relative",display:"flex",gap:"2","&[data-orientation=horizontal]":{alignItems:"center"},flex:"1","&:last-of-type:not([data-stretch])":{flex:"initial"}},icon:{flexShrink:0,width:VS.reference,height:VS.reference},indicator:{flexShrink:0,borderRadius:"full",width:Af.reference,height:Af.reference,display:"flex",justifyContent:"center",alignItems:"center","&[data-status=active]":{borderWidth:"2px",borderColor:hw.reference},"&[data-status=complete]":{bg:hw.reference,color:"chakra-inverse-text"},"&[data-status=incomplete]":{borderWidth:"2px"}},separator:{bg:"chakra-border-color",flex:"1","&[data-status=complete]":{bg:hw.reference},"&[data-orientation=horizontal]":{width:"100%",height:"2px",marginStart:"2"},"&[data-orientation=vertical]":{width:"2px",position:"absolute",height:"100%",maxHeight:`calc(100% - ${Af.reference} - 8px)`,top:`calc(${Af.reference} + 4px)`,insetStart:`calc(${Af.reference} / 2 - 1px)`}}})),cCe=oCe({baseStyle:aCe,sizes:{xs:xw({stepper:{[Af.variable]:"sizes.4",[VS.variable]:"sizes.3",[jS.variable]:"fontSizes.xs",[Lw.variable]:"fontSizes.xs"}}),sm:xw({stepper:{[Af.variable]:"sizes.6",[VS.variable]:"sizes.4",[jS.variable]:"fontSizes.sm",[Lw.variable]:"fontSizes.xs"}}),md:xw({stepper:{[Af.variable]:"sizes.8",[VS.variable]:"sizes.5",[jS.variable]:"fontSizes.md",[Lw.variable]:"fontSizes.sm"}}),lg:xw({stepper:{[Af.variable]:"sizes.10",[VS.variable]:"sizes.6",[jS.variable]:"fontSizes.lg",[Lw.variable]:"fontSizes.md"}})},defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:lCe,definePartsStyle:WO}=$i(RSe.keys),tC=Lo("switch-track-width"),Py=Lo("switch-track-height"),fM=Lo("switch-track-diff"),uCe=If.subtract(tC,Py),PU=Lo("switch-thumb-x"),pw=Lo("switch-bg"),dCe=n=>{const{colorScheme:t}=n;return{borderRadius:"full",p:"0.5",width:[tC.reference],height:[Py.reference],transitionProperty:"common",transitionDuration:"fast",[pw.variable]:"colors.gray.300",_dark:{[pw.variable]:"colors.whiteAlpha.400"},_focusVisible:{boxShadow:"outline"},_disabled:{opacity:.4,cursor:"not-allowed"},_checked:{[pw.variable]:`colors.${t}.500`,_dark:{[pw.variable]:`colors.${t}.200`}},bg:pw.reference}},hCe={bg:"white",transitionProperty:"transform",transitionDuration:"normal",borderRadius:"inherit",width:[Py.reference],height:[Py.reference],_checked:{transform:`translateX(${PU.reference})`}},pCe=WO(n=>({container:{[fM.variable]:uCe,[PU.variable]:fM.reference,_rtl:{[PU.variable]:If(fM).negate().toString()}},track:dCe(n),thumb:hCe})),fCe={sm:WO({container:{[tC.variable]:"1.375rem",[Py.variable]:"sizes.3"}}),md:WO({container:{[tC.variable]:"1.875rem",[Py.variable]:"sizes.4"}}),lg:WO({container:{[tC.variable]:"2.875rem",[Py.variable]:"sizes.6"}})},mCe=lCe({baseStyle:pCe,sizes:fCe,defaultProps:{size:"md",colorScheme:"blue"}}),{defineMultiStyleConfig:gCe,definePartsStyle:e0}=$i(ISe.keys),_Ce=e0({table:{fontVariantNumeric:"lining-nums tabular-nums",borderCollapse:"collapse",width:"full"},th:{fontFamily:"heading",fontWeight:"bold",textTransform:"uppercase",letterSpacing:"wider",textAlign:"start"},td:{textAlign:"start"},caption:{mt:4,fontFamily:"heading",textAlign:"center",fontWeight:"medium"}}),bk={"&[data-is-numeric=true]":{textAlign:"end"}},yCe=e0(n=>{const{colorScheme:t}=n;return{th:{color:Un("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Un(`${t}.100`,`${t}.700`)(n),...bk},td:{borderBottom:"1px",borderColor:Un(`${t}.100`,`${t}.700`)(n),...bk},caption:{color:Un("gray.600","gray.100")(n)},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),ECe=e0(n=>{const{colorScheme:t}=n;return{th:{color:Un("gray.600","gray.400")(n),borderBottom:"1px",borderColor:Un(`${t}.100`,`${t}.700`)(n),...bk},td:{borderBottom:"1px",borderColor:Un(`${t}.100`,`${t}.700`)(n),...bk},caption:{color:Un("gray.600","gray.100")(n)},tbody:{tr:{"&:nth-of-type(odd)":{"th, td":{borderBottomWidth:"1px",borderColor:Un(`${t}.100`,`${t}.700`)(n)},td:{background:Un(`${t}.100`,`${t}.700`)(n)}}}},tfoot:{tr:{"&:last-of-type":{th:{borderBottomWidth:0}}}}}}),vCe={simple:yCe,striped:ECe,unstyled:{}},SCe={sm:e0({th:{px:"4",py:"1",lineHeight:"4",fontSize:"xs"},td:{px:"4",py:"2",fontSize:"sm",lineHeight:"4"},caption:{px:"4",py:"2",fontSize:"xs"}}),md:e0({th:{px:"6",py:"3",lineHeight:"4",fontSize:"xs"},td:{px:"6",py:"4",lineHeight:"5"},caption:{px:"6",py:"2",fontSize:"sm"}}),lg:e0({th:{px:"8",py:"4",lineHeight:"5",fontSize:"sm"},td:{px:"8",py:"5",lineHeight:"6"},caption:{px:"6",py:"2",fontSize:"md"}})},bCe=gCe({baseStyle:_Ce,variants:vCe,sizes:SCe,defaultProps:{variant:"simple",size:"md",colorScheme:"gray"}}),pl=Vn("tabs-color"),Bd=Vn("tabs-bg"),dO=Vn("tabs-border-color"),{defineMultiStyleConfig:TCe,definePartsStyle:ap}=$i(ASe.keys),wCe=n=>{const{orientation:t}=n;return{display:t==="vertical"?"flex":"block"}},CCe=n=>{const{isFitted:t}=n;return{flex:t?1:void 0,transitionProperty:"common",transitionDuration:"normal",_focusVisible:{zIndex:1,boxShadow:"outline"},_disabled:{cursor:"not-allowed",opacity:.4}}},RCe=n=>{const{align:t="start",orientation:i}=n;return{justifyContent:{end:"flex-end",center:"center",start:"flex-start"}[t],flexDirection:i==="vertical"?"column":"row"}},ICe={p:4},ACe=ap(n=>({root:wCe(n),tab:CCe(n),tablist:RCe(n),tabpanel:ICe})),PCe={sm:ap({tab:{py:1,px:4,fontSize:"sm"}}),md:ap({tab:{fontSize:"md",py:2,px:4}}),lg:ap({tab:{fontSize:"lg",py:3,px:4}})},OCe=ap(n=>{const{colorScheme:t,orientation:i}=n,a=i==="vertical",l=a?"borderStart":"borderBottom",d=a?"marginStart":"marginBottom";return{tablist:{[l]:"2px solid",borderColor:"inherit"},tab:{[l]:"2px solid",borderColor:"transparent",[d]:"-2px",_selected:{[pl.variable]:`colors.${t}.600`,_dark:{[pl.variable]:`colors.${t}.300`},borderColor:"currentColor"},_active:{[Bd.variable]:"colors.gray.200",_dark:{[Bd.variable]:"colors.whiteAlpha.300"}},_disabled:{_active:{bg:"none"}},color:pl.reference,bg:Bd.reference}}}),kCe=ap(n=>{const{colorScheme:t}=n;return{tab:{borderTopRadius:"md",border:"1px solid",borderColor:"transparent",mb:"-1px",[dO.variable]:"transparent",_selected:{[pl.variable]:`colors.${t}.600`,[dO.variable]:"colors.white",_dark:{[pl.variable]:`colors.${t}.300`,[dO.variable]:"colors.gray.800"},borderColor:"inherit",borderBottomColor:dO.reference},color:pl.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),NCe=ap(n=>{const{colorScheme:t}=n;return{tab:{border:"1px solid",borderColor:"inherit",[Bd.variable]:"colors.gray.50",_dark:{[Bd.variable]:"colors.whiteAlpha.50"},mb:"-1px",_notLast:{marginEnd:"-1px"},_selected:{[Bd.variable]:"colors.white",[pl.variable]:`colors.${t}.600`,_dark:{[Bd.variable]:"colors.gray.800",[pl.variable]:`colors.${t}.300`},borderColor:"inherit",borderTopColor:"currentColor",borderBottomColor:"transparent"},color:pl.reference,bg:Bd.reference},tablist:{mb:"-1px",borderBottom:"1px solid",borderColor:"inherit"}}}),DCe=ap(n=>{const{colorScheme:t,theme:i}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",color:"gray.600",_selected:{color:Pc(i,`${t}.700`),bg:Pc(i,`${t}.100`)}}}}),xCe=ap(n=>{const{colorScheme:t}=n;return{tab:{borderRadius:"full",fontWeight:"semibold",[pl.variable]:"colors.gray.600",_dark:{[pl.variable]:"inherit"},_selected:{[pl.variable]:"colors.white",[Bd.variable]:`colors.${t}.600`,_dark:{[pl.variable]:"colors.gray.800",[Bd.variable]:`colors.${t}.300`}},color:pl.reference,bg:Bd.reference}}}),LCe=ap({}),MCe={line:OCe,enclosed:kCe,"enclosed-colored":NCe,"soft-rounded":DCe,"solid-rounded":xCe,unstyled:LCe},UCe=TCe({baseStyle:ACe,sizes:PCe,variants:MCe,defaultProps:{size:"md",variant:"line",colorScheme:"blue"}}),{defineMultiStyleConfig:VCe,definePartsStyle:Oy}=$i(PSe.keys),AK=Vn("tag-bg"),PK=Vn("tag-color"),mM=Vn("tag-shadow"),GO=Vn("tag-min-height"),HO=Vn("tag-min-width"),$O=Vn("tag-font-size"),KO=Vn("tag-padding-inline"),jCe={fontWeight:"medium",lineHeight:1.2,outline:0,[PK.variable]:no.color.reference,[AK.variable]:no.bg.reference,[mM.variable]:no.shadow.reference,color:PK.reference,bg:AK.reference,boxShadow:mM.reference,borderRadius:"md",minH:GO.reference,minW:HO.reference,fontSize:$O.reference,px:KO.reference,_focusVisible:{[mM.variable]:"shadows.outline"}},FCe={lineHeight:1.2,overflow:"visible"},BCe={fontSize:"lg",w:"5",h:"5",transitionProperty:"common",transitionDuration:"normal",borderRadius:"full",marginStart:"1.5",marginEnd:"-1",opacity:.5,_disabled:{opacity:.4},_focusVisible:{boxShadow:"outline",bg:"rgba(0, 0, 0, 0.14)"},_hover:{opacity:.8},_active:{opacity:1}},zCe=Oy({container:jCe,label:FCe,closeButton:BCe}),WCe={sm:Oy({container:{[GO.variable]:"sizes.5",[HO.variable]:"sizes.5",[$O.variable]:"fontSizes.xs",[KO.variable]:"space.2"},closeButton:{marginEnd:"-2px",marginStart:"0.35rem"}}),md:Oy({container:{[GO.variable]:"sizes.6",[HO.variable]:"sizes.6",[$O.variable]:"fontSizes.sm",[KO.variable]:"space.2"}}),lg:Oy({container:{[GO.variable]:"sizes.8",[HO.variable]:"sizes.8",[$O.variable]:"fontSizes.md",[KO.variable]:"space.3"}})},GCe={subtle:Oy(n=>{var t;return{container:(t=Qw.variants)==null?void 0:t.subtle(n)}}),solid:Oy(n=>{var t;return{container:(t=Qw.variants)==null?void 0:t.solid(n)}}),outline:Oy(n=>{var t;return{container:(t=Qw.variants)==null?void 0:t.outline(n)}})},HCe=VCe({variants:GCe,baseStyle:zCe,sizes:WCe,defaultProps:{size:"md",variant:"subtle",colorScheme:"gray"}});var PQ;const $Ce={...(PQ=ii.baseStyle)==null?void 0:PQ.field,paddingY:"2",minHeight:"20",lineHeight:"short",verticalAlign:"top"};var OQ;const KCe={outline:n=>{var t;return((t=ii.variants)==null?void 0:t.outline(n).field)??{}},flushed:n=>{var t;return((t=ii.variants)==null?void 0:t.flushed(n).field)??{}},filled:n=>{var t;return((t=ii.variants)==null?void 0:t.filled(n).field)??{}},unstyled:((OQ=ii.variants)==null?void 0:OQ.unstyled.field)??{}};var kQ,NQ,DQ,xQ;const qCe={xs:((kQ=ii.sizes)==null?void 0:kQ.xs.field)??{},sm:((NQ=ii.sizes)==null?void 0:NQ.sm.field)??{},md:((DQ=ii.sizes)==null?void 0:DQ.md.field)??{},lg:((xQ=ii.sizes)==null?void 0:xQ.lg.field)??{}},YCe={baseStyle:$Ce,sizes:qCe,variants:KCe,defaultProps:{size:"md",variant:"outline"}},hO=Lo("tooltip-bg"),gM=Lo("tooltip-fg"),XCe=Lo("popper-arrow-bg"),JCe={bg:hO.reference,color:gM.reference,[hO.variable]:"colors.gray.700",[gM.variable]:"colors.whiteAlpha.900",_dark:{[hO.variable]:"colors.gray.300",[gM.variable]:"colors.gray.900"},[XCe.variable]:hO.reference,px:"2",py:"0.5",borderRadius:"sm",fontWeight:"medium",fontSize:"sm",boxShadow:"md",maxW:"xs",zIndex:"tooltip"},QCe={baseStyle:JCe},ZCe={Accordion:VSe,Alert:S0e,Avatar:N0e,Badge:Qw,Breadcrumb:z0e,Button:J0e,Checkbox:fg,CloseButton:hbe,Code:gbe,Container:ybe,Divider:Tbe,Drawer:xbe,Editable:Bbe,Form:Kbe,FormError:Zbe,FormLabel:tTe,Heading:iTe,Input:ii,Kbd:fTe,Link:gTe,List:STe,Menu:NTe,Modal:WTe,NumberInput:QTe,PinInput:nwe,Popover:pwe,Progress:Swe,Radio:Rwe,Select:Dwe,Skeleton:Lwe,SkipLink:Uwe,Slider:qwe,Spinner:Jwe,Stat:sCe,Switch:mCe,Table:bCe,Tabs:UCe,Tag:HCe,Textarea:YCe,Tooltip:QCe,Card:nbe,Stepper:cCe},eRe={none:0,"1px":"1px solid","2px":"2px solid","4px":"4px solid","8px":"8px solid"},tRe={base:"0em",sm:"30em",md:"48em",lg:"62em",xl:"80em","2xl":"96em"},nRe={transparent:"transparent",current:"currentColor",black:"#000000",white:"#FFFFFF",whiteAlpha:{50:"rgba(255, 255, 255, 0.04)",100:"rgba(255, 255, 255, 0.06)",200:"rgba(255, 255, 255, 0.08)",300:"rgba(255, 255, 255, 0.16)",400:"rgba(255, 255, 255, 0.24)",500:"rgba(255, 255, 255, 0.36)",600:"rgba(255, 255, 255, 0.48)",700:"rgba(255, 255, 255, 0.64)",800:"rgba(255, 255, 255, 0.80)",900:"rgba(255, 255, 255, 0.92)"},blackAlpha:{50:"rgba(0, 0, 0, 0.04)",100:"rgba(0, 0, 0, 0.06)",200:"rgba(0, 0, 0, 0.08)",300:"rgba(0, 0, 0, 0.16)",400:"rgba(0, 0, 0, 0.24)",500:"rgba(0, 0, 0, 0.36)",600:"rgba(0, 0, 0, 0.48)",700:"rgba(0, 0, 0, 0.64)",800:"rgba(0, 0, 0, 0.80)",900:"rgba(0, 0, 0, 0.92)"},gray:{50:"#F7FAFC",100:"#EDF2F7",200:"#E2E8F0",300:"#CBD5E0",400:"#A0AEC0",500:"#718096",600:"#4A5568",700:"#2D3748",800:"#1A202C",900:"#171923"},red:{50:"#FFF5F5",100:"#FED7D7",200:"#FEB2B2",300:"#FC8181",400:"#F56565",500:"#E53E3E",600:"#C53030",700:"#9B2C2C",800:"#822727",900:"#63171B"},orange:{50:"#FFFAF0",100:"#FEEBC8",200:"#FBD38D",300:"#F6AD55",400:"#ED8936",500:"#DD6B20",600:"#C05621",700:"#9C4221",800:"#7B341E",900:"#652B19"},yellow:{50:"#FFFFF0",100:"#FEFCBF",200:"#FAF089",300:"#F6E05E",400:"#ECC94B",500:"#D69E2E",600:"#B7791F",700:"#975A16",800:"#744210",900:"#5F370E"},green:{50:"#F0FFF4",100:"#C6F6D5",200:"#9AE6B4",300:"#68D391",400:"#48BB78",500:"#38A169",600:"#2F855A",700:"#276749",800:"#22543D",900:"#1C4532"},teal:{50:"#E6FFFA",100:"#B2F5EA",200:"#81E6D9",300:"#4FD1C5",400:"#38B2AC",500:"#319795",600:"#2C7A7B",700:"#285E61",800:"#234E52",900:"#1D4044"},blue:{50:"#ebf8ff",100:"#bee3f8",200:"#90cdf4",300:"#63b3ed",400:"#4299e1",500:"#3182ce",600:"#2b6cb0",700:"#2c5282",800:"#2a4365",900:"#1A365D"},cyan:{50:"#EDFDFD",100:"#C4F1F9",200:"#9DECF9",300:"#76E4F7",400:"#0BC5EA",500:"#00B5D8",600:"#00A3C4",700:"#0987A0",800:"#086F83",900:"#065666"},purple:{50:"#FAF5FF",100:"#E9D8FD",200:"#D6BCFA",300:"#B794F4",400:"#9F7AEA",500:"#805AD5",600:"#6B46C1",700:"#553C9A",800:"#44337A",900:"#322659"},pink:{50:"#FFF5F7",100:"#FED7E2",200:"#FBB6CE",300:"#F687B3",400:"#ED64A6",500:"#D53F8C",600:"#B83280",700:"#97266D",800:"#702459",900:"#521B41"}},rRe={none:"0",sm:"0.125rem",base:"0.25rem",md:"0.375rem",lg:"0.5rem",xl:"0.75rem","2xl":"1rem","3xl":"1.5rem",full:"9999px"},iRe={xs:"0 0 0 1px rgba(0, 0, 0, 0.05)",sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",base:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)","2xl":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",outline:"0 0 0 3px rgba(66, 153, 225, 0.6)",inner:"inset 0 2px 4px 0 rgba(0,0,0,0.06)",none:"none","dark-lg":"rgba(0, 0, 0, 0.1) 0px 0px 0px 1px, rgba(0, 0, 0, 0.2) 0px 5px 10px, rgba(0, 0, 0, 0.4) 0px 15px 40px"},sRe={common:"background-color, border-color, color, fill, stroke, opacity, box-shadow, transform",colors:"background-color, border-color, color, fill, stroke",dimensions:"width, height",position:"left, right, top, bottom",background:"background-color, background-image, background-position"},oRe={"ease-in":"cubic-bezier(0.4, 0, 1, 1)","ease-out":"cubic-bezier(0, 0, 0.2, 1)","ease-in-out":"cubic-bezier(0.4, 0, 0.2, 1)"},aRe={"ultra-fast":"50ms",faster:"100ms",fast:"150ms",normal:"200ms",slow:"300ms",slower:"400ms","ultra-slow":"500ms"},cRe={property:sRe,easing:oRe,duration:aRe},lRe={hide:-1,auto:"auto",base:0,docked:10,dropdown:1e3,sticky:1100,banner:1200,overlay:1300,modal:1400,popover:1500,skipLink:1600,toast:1700,tooltip:1800},uRe={none:0,sm:"4px",base:"8px",md:"12px",lg:"16px",xl:"24px","2xl":"40px","3xl":"64px"},dRe={breakpoints:tRe,zIndices:lRe,radii:rRe,blur:uRe,colors:nRe,...EZ,sizes:pZ,shadows:iRe,space:hZ,borders:eRe,transition:cRe},hRe={colors:{"chakra-body-text":{_light:"gray.800",_dark:"whiteAlpha.900"},"chakra-body-bg":{_light:"white",_dark:"gray.800"},"chakra-border-color":{_light:"gray.200",_dark:"whiteAlpha.300"},"chakra-inverse-text":{_light:"white",_dark:"gray.800"},"chakra-subtle-bg":{_light:"gray.100",_dark:"gray.700"},"chakra-subtle-text":{_light:"gray.600",_dark:"gray.400"},"chakra-placeholder-color":{_light:"gray.500",_dark:"whiteAlpha.400"}}},pRe={global:{body:{fontFamily:"body",color:"chakra-body-text",bg:"chakra-body-bg",transitionProperty:"background-color",transitionDuration:"normal",lineHeight:"base"},"*::placeholder":{color:"chakra-placeholder-color"},"*, *::before, &::after":{borderColor:"chakra-border-color"}}},fRe="ltr",mRe={useSystemColorMode:!1,initialColorMode:"light",cssVarPrefix:"chakra"},gRe={semanticTokens:hRe,direction:fRe,...dRe,components:ZCe,styles:pRe,config:mRe};function _Re(n){if(n.sheet)return n.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===n)return document.styleSheets[t]}function yRe(n){var t=document.createElement("style");return t.setAttribute("data-emotion",n.key),n.nonce!==void 0&&t.setAttribute("nonce",n.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}var ERe=function(){function n(i){var a=this;this._insertTag=function(l){var d;a.tags.length===0?a.insertionPoint?d=a.insertionPoint.nextSibling:a.prepend?d=a.container.firstChild:d=a.before:d=a.tags[a.tags.length-1].nextSibling,a.container.insertBefore(l,d),a.tags.push(l)},this.isSpeedy=i.speedy===void 0?!0:i.speedy,this.tags=[],this.ctr=0,this.nonce=i.nonce,this.key=i.key,this.container=i.container,this.prepend=i.prepend,this.insertionPoint=i.insertionPoint,this.before=null}var t=n.prototype;return t.hydrate=function(a){a.forEach(this._insertTag)},t.insert=function(a){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(yRe(this));var l=this.tags[this.tags.length-1];if(this.isSpeedy){var d=_Re(l);try{d.insertRule(a,d.cssRules.length)}catch{}}else l.appendChild(document.createTextNode(a));this.ctr++},t.flush=function(){this.tags.forEach(function(a){var l;return(l=a.parentNode)==null?void 0:l.removeChild(a)}),this.tags=[],this.ctr=0},n}(),tc="-ms-",Tk="-moz-",ni="-webkit-",TZ="comm",mj="rule",gj="decl",vRe="@import",wZ="@keyframes",SRe="@layer",bRe=Math.abs,f1=String.fromCharCode,TRe=Object.assign;function wRe(n,t){return Aa(n,0)^45?(((t<<2^Aa(n,0))<<2^Aa(n,1))<<2^Aa(n,2))<<2^Aa(n,3):0}function CZ(n){return n.trim()}function CRe(n,t){return(n=t.exec(n))?n[0]:n}function ri(n,t,i){return n.replace(t,i)}function OU(n,t){return n.indexOf(t)}function Aa(n,t){return n.charCodeAt(t)|0}function vC(n,t,i){return n.slice(t,i)}function qh(n){return n.length}function _j(n){return n.length}function pO(n,t){return t.push(n),n}function RRe(n,t){return n.map(t).join("")}var m1=1,p0=1,RZ=0,yl=0,po=0,M0="";function g1(n,t,i,a,l,d,f){return{value:n,root:t,parent:i,type:a,props:l,children:d,line:m1,column:p0,length:f,return:""}}function fw(n,t){return TRe(g1("",null,null,"",null,null,0),n,{length:-n.length},t)}function IRe(){return po}function ARe(){return po=yl>0?Aa(M0,--yl):0,p0--,po===10&&(p0=1,m1--),po}function ql(){return po=yl<RZ?Aa(M0,yl++):0,p0++,po===10&&(p0=1,m1++),po}function cp(){return Aa(M0,yl)}function qO(){return yl}function KC(n,t){return vC(M0,n,t)}function SC(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function IZ(n){return m1=p0=1,RZ=qh(M0=n),yl=0,[]}function AZ(n){return M0="",n}function YO(n){return CZ(KC(yl-1,kU(n===91?n+2:n===40?n+1:n)))}function PRe(n){for(;(po=cp())&&po<33;)ql();return SC(n)>2||SC(po)>3?"":" "}function ORe(n,t){for(;--t&&ql()&&!(po<48||po>102||po>57&&po<65||po>70&&po<97););return KC(n,qO()+(t<6&&cp()==32&&ql()==32))}function kU(n){for(;ql();)switch(po){case n:return yl;case 34:case 39:n!==34&&n!==39&&kU(po);break;case 40:n===41&&kU(n);break;case 92:ql();break}return yl}function kRe(n,t){for(;ql()&&n+po!==57;)if(n+po===84&&cp()===47)break;return"/*"+KC(t,yl-1)+"*"+f1(n===47?n:ql())}function NRe(n){for(;!SC(cp());)ql();return KC(n,yl)}function DRe(n){return AZ(XO("",null,null,null,[""],n=IZ(n),0,[0],n))}function XO(n,t,i,a,l,d,f,_,v){for(var b=0,C=0,I=f,O=0,L=0,M=0,F=1,z=1,Z=1,K=0,re="",ae=l,ne=d,pe=a,X=re;z;)switch(M=K,K=ql()){case 40:if(M!=108&&Aa(X,I-1)==58){OU(X+=ri(YO(K),"&","&\f"),"&\f")!=-1&&(Z=-1);break}case 34:case 39:case 91:X+=YO(K);break;case 9:case 10:case 13:case 32:X+=PRe(M);break;case 92:X+=ORe(qO()-1,7);continue;case 47:switch(cp()){case 42:case 47:pO(xRe(kRe(ql(),qO()),t,i),v);break;default:X+="/"}break;case 123*F:_[b++]=qh(X)*Z;case 125*F:case 59:case 0:switch(K){case 0:case 125:z=0;case 59+C:Z==-1&&(X=ri(X,/\f/g,"")),L>0&&qh(X)-I&&pO(L>32?kK(X+";",a,i,I-1):kK(ri(X," ","")+";",a,i,I-2),v);break;case 59:X+=";";default:if(pO(pe=OK(X,t,i,b,C,l,_,re,ae=[],ne=[],I),d),K===123)if(C===0)XO(X,t,pe,pe,ae,d,I,_,ne);else switch(O===99&&Aa(X,3)===110?100:O){case 100:case 108:case 109:case 115:XO(n,pe,pe,a&&pO(OK(n,pe,pe,0,0,l,_,re,l,ae=[],I),ne),l,ne,I,_,a?ae:ne);break;default:XO(X,pe,pe,pe,[""],ne,0,_,ne)}}b=C=L=0,F=Z=1,re=X="",I=f;break;case 58:I=1+qh(X),L=M;default:if(F<1){if(K==123)--F;else if(K==125&&F++==0&&ARe()==125)continue}switch(X+=f1(K),K*F){case 38:Z=C>0?1:(X+="\f",-1);break;case 44:_[b++]=(qh(X)-1)*Z,Z=1;break;case 64:cp()===45&&(X+=YO(ql())),O=cp(),C=I=qh(re=X+=NRe(qO())),K++;break;case 45:M===45&&qh(X)==2&&(F=0)}}return d}function OK(n,t,i,a,l,d,f,_,v,b,C){for(var I=l-1,O=l===0?d:[""],L=_j(O),M=0,F=0,z=0;M<a;++M)for(var Z=0,K=vC(n,I+1,I=bRe(F=f[M])),re=n;Z<L;++Z)(re=CZ(F>0?O[Z]+" "+K:ri(K,/&\f/g,O[Z])))&&(v[z++]=re);return g1(n,t,i,l===0?mj:_,v,b,C)}function xRe(n,t,i){return g1(n,t,i,TZ,f1(IRe()),vC(n,2,-2),0)}function kK(n,t,i,a){return g1(n,t,i,gj,vC(n,0,a),vC(n,a+1,-1),a)}function t0(n,t){for(var i="",a=_j(n),l=0;l<a;l++)i+=t(n[l],l,n,t)||"";return i}function LRe(n,t,i,a){switch(n.type){case SRe:if(n.children.length)break;case vRe:case gj:return n.return=n.return||n.value;case TZ:return"";case wZ:return n.return=n.value+"{"+t0(n.children,a)+"}";case mj:n.value=n.props.join(",")}return qh(i=t0(n.children,a))?n.return=n.value+"{"+i+"}":""}function MRe(n){var t=_j(n);return function(i,a,l,d){for(var f="",_=0;_<t;_++)f+=n[_](i,a,l,d)||"";return f}}function URe(n){return function(t){t.root||(t=t.return)&&n(t)}}var NK=function(t){var i=new WeakMap;return function(a){if(i.has(a))return i.get(a);var l=t(a);return i.set(a,l),l}};function PZ(n){var t=Object.create(null);return function(i){return t[i]===void 0&&(t[i]=n(i)),t[i]}}var VRe=function(t,i,a){for(var l=0,d=0;l=d,d=cp(),l===38&&d===12&&(i[a]=1),!SC(d);)ql();return KC(t,yl)},jRe=function(t,i){var a=-1,l=44;do switch(SC(l)){case 0:l===38&&cp()===12&&(i[a]=1),t[a]+=VRe(yl-1,i,a);break;case 2:t[a]+=YO(l);break;case 4:if(l===44){t[++a]=cp()===58?"&\f":"",i[a]=t[a].length;break}default:t[a]+=f1(l)}while(l=ql());return t},FRe=function(t,i){return AZ(jRe(IZ(t),i))},DK=new WeakMap,BRe=function(t){if(!(t.type!=="rule"||!t.parent||t.length<1)){for(var i=t.value,a=t.parent,l=t.column===a.column&&t.line===a.line;a.type!=="rule";)if(a=a.parent,!a)return;if(!(t.props.length===1&&i.charCodeAt(0)!==58&&!DK.get(a))&&!l){DK.set(t,!0);for(var d=[],f=FRe(i,d),_=a.props,v=0,b=0;v<f.length;v++)for(var C=0;C<_.length;C++,b++)t.props[b]=d[v]?f[v].replace(/&\f/g,_[C]):_[C]+" "+f[v]}}},zRe=function(t){if(t.type==="decl"){var i=t.value;i.charCodeAt(0)===108&&i.charCodeAt(2)===98&&(t.return="",t.value="")}};function OZ(n,t){switch(wRe(n,t)){case 5103:return ni+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return ni+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return ni+n+Tk+n+tc+n+n;case 6828:case 4268:return ni+n+tc+n+n;case 6165:return ni+n+tc+"flex-"+n+n;case 5187:return ni+n+ri(n,/(\w+).+(:[^]+)/,ni+"box-$1$2"+tc+"flex-$1$2")+n;case 5443:return ni+n+tc+"flex-item-"+ri(n,/flex-|-self/,"")+n;case 4675:return ni+n+tc+"flex-line-pack"+ri(n,/align-content|flex-|-self/,"")+n;case 5548:return ni+n+tc+ri(n,"shrink","negative")+n;case 5292:return ni+n+tc+ri(n,"basis","preferred-size")+n;case 6060:return ni+"box-"+ri(n,"-grow","")+ni+n+tc+ri(n,"grow","positive")+n;case 4554:return ni+ri(n,/([^-])(transform)/g,"$1"+ni+"$2")+n;case 6187:return ri(ri(ri(n,/(zoom-|grab)/,ni+"$1"),/(image-set)/,ni+"$1"),n,"")+n;case 5495:case 3959:return ri(n,/(image-set\([^]*)/,ni+"$1$`$1");case 4968:return ri(ri(n,/(.+:)(flex-)?(.*)/,ni+"box-pack:$3"+tc+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+ni+n+n;case 4095:case 3583:case 4068:case 2532:return ri(n,/(.+)-inline(.+)/,ni+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(qh(n)-1-t>6)switch(Aa(n,t+1)){case 109:if(Aa(n,t+4)!==45)break;case 102:return ri(n,/(.+:)(.+)-([^]+)/,"$1"+ni+"$2-$3$1"+Tk+(Aa(n,t+3)==108?"$3":"$2-$3"))+n;case 115:return~OU(n,"stretch")?OZ(ri(n,"stretch","fill-available"),t)+n:n}break;case 4949:if(Aa(n,t+1)!==115)break;case 6444:switch(Aa(n,qh(n)-3-(~OU(n,"!important")&&10))){case 107:return ri(n,":",":"+ni)+n;case 101:return ri(n,/(.+:)([^;!]+)(;|!.+)?/,"$1"+ni+(Aa(n,14)===45?"inline-":"")+"box$3$1"+ni+"$2$3$1"+tc+"$2box$3")+n}break;case 5936:switch(Aa(n,t+11)){case 114:return ni+n+tc+ri(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return ni+n+tc+ri(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return ni+n+tc+ri(n,/[svh]\w+-[tblr]{2}/,"lr")+n}return ni+n+tc+n+n}return n}var WRe=function(t,i,a,l){if(t.length>-1&&!t.return)switch(t.type){case gj:t.return=OZ(t.value,t.length);break;case wZ:return t0([fw(t,{value:ri(t.value,"@","@"+ni)})],l);case mj:if(t.length)return RRe(t.props,function(d){switch(CRe(d,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return t0([fw(t,{props:[ri(d,/:(read-\w+)/,":"+Tk+"$1")]})],l);case"::placeholder":return t0([fw(t,{props:[ri(d,/:(plac\w+)/,":"+ni+"input-$1")]}),fw(t,{props:[ri(d,/:(plac\w+)/,":"+Tk+"$1")]}),fw(t,{props:[ri(d,/:(plac\w+)/,tc+"input-$1")]})],l)}return""})}},GRe=[WRe],HRe=function(t){var i=t.key;if(i==="css"){var a=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(a,function(F){var z=F.getAttribute("data-emotion");z.indexOf(" ")!==-1&&(document.head.appendChild(F),F.setAttribute("data-s",""))})}var l=t.stylisPlugins||GRe,d={},f,_=[];f=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+i+' "]'),function(F){for(var z=F.getAttribute("data-emotion").split(" "),Z=1;Z<z.length;Z++)d[z[Z]]=!0;_.push(F)});var v,b=[BRe,zRe];{var C,I=[LRe,URe(function(F){C.insert(F)})],O=MRe(b.concat(l,I)),L=function(z){return t0(DRe(z),O)};v=function(z,Z,K,re){C=K,L(z?z+"{"+Z.styles+"}":Z.styles),re&&(M.inserted[Z.name]=!0)}}var M={key:i,sheet:new ERe({key:i,container:f,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:d,registered:{},insert:v};return M.sheet.hydrate(_),M};function Fy(){return Fy=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)({}).hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},Fy.apply(null,arguments)}var _M={exports:{}},di={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xK;function $Re(){if(xK)return di;xK=1;var n=typeof Symbol=="function"&&Symbol.for,t=n?Symbol.for("react.element"):60103,i=n?Symbol.for("react.portal"):60106,a=n?Symbol.for("react.fragment"):60107,l=n?Symbol.for("react.strict_mode"):60108,d=n?Symbol.for("react.profiler"):60114,f=n?Symbol.for("react.provider"):60109,_=n?Symbol.for("react.context"):60110,v=n?Symbol.for("react.async_mode"):60111,b=n?Symbol.for("react.concurrent_mode"):60111,C=n?Symbol.for("react.forward_ref"):60112,I=n?Symbol.for("react.suspense"):60113,O=n?Symbol.for("react.suspense_list"):60120,L=n?Symbol.for("react.memo"):60115,M=n?Symbol.for("react.lazy"):60116,F=n?Symbol.for("react.block"):60121,z=n?Symbol.for("react.fundamental"):60117,Z=n?Symbol.for("react.responder"):60118,K=n?Symbol.for("react.scope"):60119;function re(ne){if(typeof ne=="object"&&ne!==null){var pe=ne.$$typeof;switch(pe){case t:switch(ne=ne.type,ne){case v:case b:case a:case d:case l:case I:return ne;default:switch(ne=ne&&ne.$$typeof,ne){case _:case C:case M:case L:case f:return ne;default:return pe}}case i:return pe}}}function ae(ne){return re(ne)===b}return di.AsyncMode=v,di.ConcurrentMode=b,di.ContextConsumer=_,di.ContextProvider=f,di.Element=t,di.ForwardRef=C,di.Fragment=a,di.Lazy=M,di.Memo=L,di.Portal=i,di.Profiler=d,di.StrictMode=l,di.Suspense=I,di.isAsyncMode=function(ne){return ae(ne)||re(ne)===v},di.isConcurrentMode=ae,di.isContextConsumer=function(ne){return re(ne)===_},di.isContextProvider=function(ne){return re(ne)===f},di.isElement=function(ne){return typeof ne=="object"&&ne!==null&&ne.$$typeof===t},di.isForwardRef=function(ne){return re(ne)===C},di.isFragment=function(ne){return re(ne)===a},di.isLazy=function(ne){return re(ne)===M},di.isMemo=function(ne){return re(ne)===L},di.isPortal=function(ne){return re(ne)===i},di.isProfiler=function(ne){return re(ne)===d},di.isStrictMode=function(ne){return re(ne)===l},di.isSuspense=function(ne){return re(ne)===I},di.isValidElementType=function(ne){return typeof ne=="string"||typeof ne=="function"||ne===a||ne===b||ne===d||ne===l||ne===I||ne===O||typeof ne=="object"&&ne!==null&&(ne.$$typeof===M||ne.$$typeof===L||ne.$$typeof===f||ne.$$typeof===_||ne.$$typeof===C||ne.$$typeof===z||ne.$$typeof===Z||ne.$$typeof===K||ne.$$typeof===F)},di.typeOf=re,di}var LK;function KRe(){return LK||(LK=1,_M.exports=$Re()),_M.exports}var yM,MK;function qRe(){if(MK)return yM;MK=1;var n=KRe(),t={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},a={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},l={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},d={};d[n.ForwardRef]=a,d[n.Memo]=l;function f(M){return n.isMemo(M)?l:d[M.$$typeof]||t}var _=Object.defineProperty,v=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,C=Object.getOwnPropertyDescriptor,I=Object.getPrototypeOf,O=Object.prototype;function L(M,F,z){if(typeof F!="string"){if(O){var Z=I(F);Z&&Z!==O&&L(M,Z,z)}var K=v(F);b&&(K=K.concat(b(F)));for(var re=f(M),ae=f(F),ne=0;ne<K.length;++ne){var pe=K[ne];if(!i[pe]&&!(z&&z[pe])&&!(ae&&ae[pe])&&!(re&&re[pe])){var X=C(F,pe);try{_(M,pe,X)}catch{}}}}return M}return yM=L,yM}var YRe=qRe();const XRe=Fg(YRe);var JRe=!0;function kZ(n,t,i){var a="";return i.split(" ").forEach(function(l){n[l]!==void 0?t.push(n[l]+";"):l&&(a+=l+" ")}),a}var yj=function(t,i,a){var l=t.key+"-"+i.name;(a===!1||JRe===!1)&&t.registered[l]===void 0&&(t.registered[l]=i.styles)},Ej=function(t,i,a){yj(t,i,a);var l=t.key+"-"+i.name;if(t.inserted[i.name]===void 0){var d=i;do t.insert(i===d?"."+l:"",d,t.sheet,!0),d=d.next;while(d!==void 0)}};function QRe(n){for(var t=0,i,a=0,l=n.length;l>=4;++a,l-=4)i=n.charCodeAt(a)&255|(n.charCodeAt(++a)&255)<<8|(n.charCodeAt(++a)&255)<<16|(n.charCodeAt(++a)&255)<<24,i=(i&65535)*1540483477+((i>>>16)*59797<<16),i^=i>>>24,t=(i&65535)*1540483477+((i>>>16)*59797<<16)^(t&65535)*1540483477+((t>>>16)*59797<<16);switch(l){case 3:t^=(n.charCodeAt(a+2)&255)<<16;case 2:t^=(n.charCodeAt(a+1)&255)<<8;case 1:t^=n.charCodeAt(a)&255,t=(t&65535)*1540483477+((t>>>16)*59797<<16)}return t^=t>>>13,t=(t&65535)*1540483477+((t>>>16)*59797<<16),((t^t>>>15)>>>0).toString(36)}var ZRe={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},eIe=/[A-Z]|^ms/g,tIe=/_EMO_([^_]+?)_([^]*?)_EMO_/g,NZ=function(t){return t.charCodeAt(1)===45},UK=function(t){return t!=null&&typeof t!="boolean"},EM=PZ(function(n){return NZ(n)?n:n.replace(eIe,"-$&").toLowerCase()}),VK=function(t,i){switch(t){case"animation":case"animationName":if(typeof i=="string")return i.replace(tIe,function(a,l,d){return Yh={name:l,styles:d,next:Yh},l})}return ZRe[t]!==1&&!NZ(t)&&typeof i=="number"&&i!==0?i+"px":i};function bC(n,t,i){if(i==null)return"";var a=i;if(a.__emotion_styles!==void 0)return a;switch(typeof i){case"boolean":return"";case"object":{var l=i;if(l.anim===1)return Yh={name:l.name,styles:l.styles,next:Yh},l.name;var d=i;if(d.styles!==void 0){var f=d.next;if(f!==void 0)for(;f!==void 0;)Yh={name:f.name,styles:f.styles,next:Yh},f=f.next;var _=d.styles+";";return _}return nIe(n,t,i)}case"function":{if(n!==void 0){var v=Yh,b=i(n);return Yh=v,bC(n,t,b)}break}}var C=i;if(t==null)return C;var I=t[C];return I!==void 0?I:C}function nIe(n,t,i){var a="";if(Array.isArray(i))for(var l=0;l<i.length;l++)a+=bC(n,t,i[l])+";";else for(var d in i){var f=i[d];if(typeof f!="object"){var _=f;t!=null&&t[_]!==void 0?a+=d+"{"+t[_]+"}":UK(_)&&(a+=EM(d)+":"+VK(d,_)+";")}else if(Array.isArray(f)&&typeof f[0]=="string"&&(t==null||t[f[0]]===void 0))for(var v=0;v<f.length;v++)UK(f[v])&&(a+=EM(d)+":"+VK(d,f[v])+";");else{var b=bC(n,t,f);switch(d){case"animation":case"animationName":{a+=EM(d)+":"+b+";";break}default:a+=d+"{"+b+"}"}}}return a}var jK=/label:\s*([^\s;{]+)\s*(;|$)/g,Yh;function _1(n,t,i){if(n.length===1&&typeof n[0]=="object"&&n[0]!==null&&n[0].styles!==void 0)return n[0];var a=!0,l="";Yh=void 0;var d=n[0];if(d==null||d.raw===void 0)a=!1,l+=bC(i,t,d);else{var f=d;l+=f[0]}for(var _=1;_<n.length;_++)if(l+=bC(i,t,n[_]),a){var v=d;l+=v[_]}jK.lastIndex=0;for(var b="",C;(C=jK.exec(l))!==null;)b+="-"+C[1];var I=QRe(l)+b;return{name:I,styles:l,next:Yh}}var rIe=function(t){return t()},DZ=Y7.useInsertionEffect?Y7.useInsertionEffect:!1,xZ=DZ||rIe,FK=DZ||N.useLayoutEffect,vj=N.createContext(typeof HTMLElement<"u"?HRe({key:"css"}):null);vj.Provider;var iIe=function(){return N.useContext(vj)},Sj=function(t){return N.forwardRef(function(i,a){var l=N.useContext(vj);return t(i,l,a)})},f0=N.createContext({}),sIe=function(t,i){if(typeof i=="function"){var a=i(t);return a}return Fy({},t,i)},oIe=NK(function(n){return NK(function(t){return sIe(n,t)})}),aIe=function(t){var i=N.useContext(f0);return t.theme!==i&&(i=oIe(i)(t.theme)),N.createElement(f0.Provider,{value:i},t.children)},bj={}.hasOwnProperty,NU="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",cIe=function(t,i){var a={};for(var l in i)bj.call(i,l)&&(a[l]=i[l]);return a[NU]=t,a},lIe=function(t){var i=t.cache,a=t.serialized,l=t.isStringTag;return yj(i,a,l),xZ(function(){return Ej(i,a,l)}),null},uIe=Sj(function(n,t,i){var a=n.css;typeof a=="string"&&t.registered[a]!==void 0&&(a=t.registered[a]);var l=n[NU],d=[a],f="";typeof n.className=="string"?f=kZ(t.registered,d,n.className):n.className!=null&&(f=n.className+" ");var _=_1(d,void 0,N.useContext(f0));f+=t.key+"-"+_.name;var v={};for(var b in n)bj.call(n,b)&&b!=="css"&&b!==NU&&(v[b]=n[b]);return v.className=f,i&&(v.ref=i),N.createElement(N.Fragment,null,N.createElement(lIe,{cache:t,serialized:_,isStringTag:typeof l=="string"}),N.createElement(l,v))}),dIe=uIe,BK=function(t,i){var a=arguments;if(i==null||!bj.call(i,"css"))return N.createElement.apply(void 0,a);var l=a.length,d=new Array(l);d[0]=dIe,d[1]=cIe(t,i);for(var f=2;f<l;f++)d[f]=a[f];return N.createElement.apply(null,d)};(function(n){var t;t||(t=n.JSX||(n.JSX={}))})(BK||(BK={}));var y1=Sj(function(n,t){var i=n.styles,a=_1([i],void 0,N.useContext(f0)),l=N.useRef();return FK(function(){var d=t.key+"-global",f=new t.sheet.constructor({key:d,nonce:t.sheet.nonce,container:t.sheet.container,speedy:t.sheet.isSpeedy}),_=!1,v=document.querySelector('style[data-emotion="'+d+" "+a.name+'"]');return t.sheet.tags.length&&(f.before=t.sheet.tags[0]),v!==null&&(_=!0,v.setAttribute("data-emotion",d),f.hydrate([v])),l.current=[f,_],function(){f.flush()}},[t]),FK(function(){var d=l.current,f=d[0],_=d[1];if(_){d[1]=!1;return}if(a.next!==void 0&&Ej(t,a.next,!0),f.tags.length){var v=f.tags[f.tags.length-1].nextElementSibling;f.before=v,f.flush()}t.insert("",a,f,!1)},[t,a.name]),null});function hIe(){for(var n=arguments.length,t=new Array(n),i=0;i<n;i++)t[i]=arguments[i];return _1(t)}function qC(){var n=hIe.apply(void 0,arguments),t="animation-"+n.name;return{name:t,styles:"@keyframes "+t+"{"+n.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}const Tj=N.createContext({});Tj.displayName="ColorModeContext";function E1(){const n=N.useContext(Tj);if(n===void 0)throw new Error("useColorMode must be used within a ColorModeProvider");return n}function bg(n,t){const{colorMode:i}=E1();return i==="dark"?t:n}const fO={light:"chakra-ui-light",dark:"chakra-ui-dark"};function pIe(n={}){const{preventTransition:t=!0,nonce:i}=n,a={setDataset:l=>{const d=t?a.preventTransition():void 0;document.documentElement.dataset.theme=l,document.documentElement.style.colorScheme=l,d==null||d()},setClassName(l){document.body.classList.add(l?fO.dark:fO.light),document.body.classList.remove(l?fO.light:fO.dark)},query(){return window.matchMedia("(prefers-color-scheme: dark)")},getSystemTheme(l){return a.query().matches??l==="dark"?"dark":"light"},addListener(l){const d=a.query(),f=_=>{l(_.matches?"dark":"light")};return typeof d.addListener=="function"?d.addListener(f):d.addEventListener("change",f),()=>{typeof d.removeListener=="function"?d.removeListener(f):d.removeEventListener("change",f)}},preventTransition(){const l=document.createElement("style");return l.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),i!==void 0&&(l.nonce=i),document.head.appendChild(l),()=>{window.getComputedStyle(document.body),requestAnimationFrame(()=>{requestAnimationFrame(()=>{document.head.removeChild(l)})})}}};return a}const fIe="chakra-ui-color-mode";function mIe(n){return{ssr:!1,type:"localStorage",get(t){if(!(globalThis!=null&&globalThis.document))return t;let i;try{i=localStorage.getItem(n)||t}catch{}return i||t},set(t){try{localStorage.setItem(n,t)}catch{}}}}const gIe=mIe(fIe),zK=()=>{},_Ie=Dye()?N.useLayoutEffect:N.useEffect;function WK(n,t){return n.type==="cookie"&&n.ssr?n.get(t):t}const LZ=function(t){const{value:i,children:a,options:{useSystemColorMode:l,initialColorMode:d,disableTransitionOnChange:f}={},colorModeManager:_=gIe}=t,v=iIe(),b=d==="dark"?"dark":"light",[C,I]=N.useState(()=>WK(_,b)),[O,L]=N.useState(()=>WK(_)),{getSystemTheme:M,setClassName:F,setDataset:z,addListener:Z}=N.useMemo(()=>pIe({preventTransition:f,nonce:v==null?void 0:v.nonce}),[f,v==null?void 0:v.nonce]),K=d==="system"&&!C?O:C,re=N.useCallback(pe=>{const X=pe==="system"?M():pe;I(X),F(X==="dark"),z(X),_.set(X)},[_,M,F,z]);_Ie(()=>{d==="system"&&L(M())},[]),N.useEffect(()=>{const pe=_.get();if(pe){re(pe);return}if(d==="system"){re("system");return}re(b)},[_,b,d,re]);const ae=N.useCallback(()=>{re(K==="dark"?"light":"dark")},[K,re]);N.useEffect(()=>{if(l)return Z(re)},[l,Z,re]);const ne=N.useMemo(()=>({colorMode:i??K,toggleColorMode:i?zK:ae,setColorMode:i?zK:re,forced:i!==void 0}),[K,ae,re,i]);return T.jsx(Tj.Provider,{value:ne,children:a})};LZ.displayName="ColorModeProvider";const MZ=String.raw,UZ=MZ`
  :root,
  :host {
    --chakra-vh: 100vh;
  }

  @supports (height: -webkit-fill-available) {
    :root,
    :host {
      --chakra-vh: -webkit-fill-available;
    }
  }

  @supports (height: -moz-fill-available) {
    :root,
    :host {
      --chakra-vh: -moz-fill-available;
    }
  }

  @supports (height: 100dvh) {
    :root,
    :host {
      --chakra-vh: 100dvh;
    }
  }
`,yIe=()=>T.jsx(y1,{styles:UZ}),EIe=({scope:n=""})=>T.jsx(y1,{styles:MZ`
      html {
        line-height: 1.5;
        -webkit-text-size-adjust: 100%;
        font-family: system-ui, sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
      }

      body {
        position: relative;
        min-height: 100%;
        margin: 0;
        font-feature-settings: "kern";
      }

      ${n} :where(*, *::before, *::after) {
        border-width: 0;
        border-style: solid;
        box-sizing: border-box;
        word-wrap: break-word;
      }

      main {
        display: block;
      }

      ${n} hr {
        border-top-width: 1px;
        box-sizing: content-box;
        height: 0;
        overflow: visible;
      }

      ${n} :where(pre, code, kbd,samp) {
        font-family: SFMono-Regular, Menlo, Monaco, Consolas, monospace;
        font-size: 1em;
      }

      ${n} a {
        background-color: transparent;
        color: inherit;
        text-decoration: inherit;
      }

      ${n} abbr[title] {
        border-bottom: none;
        text-decoration: underline;
        -webkit-text-decoration: underline dotted;
        text-decoration: underline dotted;
      }

      ${n} :where(b, strong) {
        font-weight: bold;
      }

      ${n} small {
        font-size: 80%;
      }

      ${n} :where(sub,sup) {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
      }

      ${n} sub {
        bottom: -0.25em;
      }

      ${n} sup {
        top: -0.5em;
      }

      ${n} img {
        border-style: none;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        font-family: inherit;
        font-size: 100%;
        line-height: 1.15;
        margin: 0;
      }

      ${n} :where(button, input) {
        overflow: visible;
      }

      ${n} :where(button, select) {
        text-transform: none;
      }

      ${n} :where(
          button::-moz-focus-inner,
          [type="button"]::-moz-focus-inner,
          [type="reset"]::-moz-focus-inner,
          [type="submit"]::-moz-focus-inner
        ) {
        border-style: none;
        padding: 0;
      }

      ${n} fieldset {
        padding: 0.35em 0.75em 0.625em;
      }

      ${n} legend {
        box-sizing: border-box;
        color: inherit;
        display: table;
        max-width: 100%;
        padding: 0;
        white-space: normal;
      }

      ${n} progress {
        vertical-align: baseline;
      }

      ${n} textarea {
        overflow: auto;
      }

      ${n} :where([type="checkbox"], [type="radio"]) {
        box-sizing: border-box;
        padding: 0;
      }

      ${n} input[type="number"]::-webkit-inner-spin-button,
      ${n} input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none !important;
      }

      ${n} input[type="number"] {
        -moz-appearance: textfield;
      }

      ${n} input[type="search"] {
        -webkit-appearance: textfield;
        outline-offset: -2px;
      }

      ${n} input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none !important;
      }

      ${n} ::-webkit-file-upload-button {
        -webkit-appearance: button;
        font: inherit;
      }

      ${n} details {
        display: block;
      }

      ${n} summary {
        display: list-item;
      }

      template {
        display: none;
      }

      [hidden] {
        display: none !important;
      }

      ${n} :where(
          blockquote,
          dl,
          dd,
          h1,
          h2,
          h3,
          h4,
          h5,
          h6,
          hr,
          figure,
          p,
          pre
        ) {
        margin: 0;
      }

      ${n} button {
        background: transparent;
        padding: 0;
      }

      ${n} fieldset {
        margin: 0;
        padding: 0;
      }

      ${n} :where(ol, ul) {
        margin: 0;
        padding: 0;
      }

      ${n} textarea {
        resize: vertical;
      }

      ${n} :where(button, [role="button"]) {
        cursor: pointer;
      }

      ${n} button::-moz-focus-inner {
        border: 0 !important;
      }

      ${n} table {
        border-collapse: collapse;
      }

      ${n} :where(h1, h2, h3, h4, h5, h6) {
        font-size: inherit;
        font-weight: inherit;
      }

      ${n} :where(button, input, optgroup, select, textarea) {
        padding: 0;
        line-height: inherit;
        color: inherit;
      }

      ${n} :where(img, svg, video, canvas, audio, iframe, embed, object) {
        display: block;
      }

      ${n} :where(img, video) {
        max-width: 100%;
        height: auto;
      }

      [data-js-focus-visible]
        :focus:not([data-focus-visible-added]):not(
          [data-focus-visible-disabled]
        ) {
        outline: none;
        box-shadow: none;
      }

      ${n} select::-ms-expand {
        display: none;
      }

      ${UZ}
    `});function vIe(n){const{cssVarsRoot:t,theme:i,children:a}=n,l=N.useMemo(()=>sSe(i),[i]);return T.jsxs(aIe,{theme:l,children:[T.jsx(SIe,{root:t}),a]})}function SIe({root:n=":host, :root"}){const t=[n,"[data-theme]"].join(",");return T.jsx(y1,{styles:i=>({[t]:i.__cssVars})})}Ti({name:"StylesContext",errorMessage:"useStyles: `styles` is undefined. Seems you forgot to wrap the components in `<StylesProvider />` "});function bIe(){const{colorMode:n}=E1();return T.jsx(y1,{styles:t=>{const i=GQ(t,"styles.global"),a=ml(i,{theme:t,colorMode:n});return a?cZ(a)(t):void 0}})}const[TIe,wIe]=Ti({strict:!1,name:"PortalManagerContext"});function wj(n){const{children:t,zIndex:i}=n;return T.jsx(TIe,{value:{zIndex:i},children:t})}wj.displayName="PortalManager";const Cj=N.createContext({getDocument(){return document},getWindow(){return window}});Cj.displayName="EnvironmentContext";function CIe({defer:n}={}){const[,t]=N.useReducer(i=>i+1,0);return op(()=>{n&&t()},[n]),N.useContext(Cj)}function VZ(n){const{children:t,environment:i,disabled:a}=n,l=N.useRef(null),d=N.useMemo(()=>i||{getDocument:()=>{var _;return((_=l.current)==null?void 0:_.ownerDocument)??document},getWindow:()=>{var _;return((_=l.current)==null?void 0:_.ownerDocument.defaultView)??window}},[i]),f=!a||!i;return T.jsxs(Cj.Provider,{value:d,children:[t,f&&T.jsx("span",{id:"__chakra_env",hidden:!0,ref:l})]})}VZ.displayName="EnvironmentProvider";const RIe=n=>{const{children:t,colorModeManager:i,portalZIndex:a,resetScope:l,resetCSS:d=!0,theme:f={},environment:_,cssVarsRoot:v,disableEnvironment:b,disableGlobalStyle:C}=n,I=T.jsx(VZ,{environment:_,disabled:b,children:t});return T.jsx(vIe,{theme:f,cssVarsRoot:v,children:T.jsxs(LZ,{colorModeManager:i,options:f.config,children:[d?T.jsx(EIe,{scope:l}):T.jsx(yIe,{}),!C&&T.jsx(bIe,{}),a?T.jsx(wj,{zIndex:a,children:I}):I]})})},Rj=N.createContext({});function Ij(n){const t=N.useRef(null);return t.current===null&&(t.current=n()),t.current}const YC=N.createContext(null),Aj=N.createContext({transformPagePoint:n=>n,isStatic:!1,reducedMotion:"never"});class IIe extends N.Component{getSnapshotBeforeUpdate(t){const i=this.props.childRef.current;if(i&&t.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=i.offsetHeight||0,a.width=i.offsetWidth||0,a.top=i.offsetTop,a.left=i.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function AIe({children:n,isPresent:t}){const i=N.useId(),a=N.useRef(null),l=N.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=N.useContext(Aj);return N.useInsertionEffect(()=>{const{width:f,height:_,top:v,left:b}=l.current;if(t||!a.current||!f||!_)return;a.current.dataset.motionPopId=i;const C=document.createElement("style");return d&&(C.nonce=d),document.head.appendChild(C),C.sheet&&C.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${_}px !important;
            top: ${v}px !important;
            left: ${b}px !important;
          }
        `),()=>{document.head.removeChild(C)}},[t]),T.jsx(IIe,{isPresent:t,childRef:a,sizeRef:l,children:N.cloneElement(n,{ref:a})})}const PIe=({children:n,initial:t,isPresent:i,onExitComplete:a,custom:l,presenceAffectsLayout:d,mode:f})=>{const _=Ij(OIe),v=N.useId(),b=N.useCallback(I=>{_.set(I,!0);for(const O of _.values())if(!O)return;a&&a()},[_,a]),C=N.useMemo(()=>({id:v,initial:t,isPresent:i,custom:l,onExitComplete:b,register:I=>(_.set(I,!1),()=>_.delete(I))}),d?[Math.random(),b]:[i,b]);return N.useMemo(()=>{_.forEach((I,O)=>_.set(O,!1))},[i]),N.useEffect(()=>{!i&&!_.size&&a&&a()},[i]),f==="popLayout"&&(n=T.jsx(AIe,{isPresent:i,children:n})),T.jsx(YC.Provider,{value:C,children:n})};function OIe(){return new Map}function Pj(n=!0){const t=N.useContext(YC);if(t===null)return[!0,null];const{isPresent:i,onExitComplete:a,register:l}=t,d=N.useId();N.useEffect(()=>{n&&l(d)},[n]);const f=N.useCallback(()=>n&&a&&a(d),[d,a,n]);return!i&&a?[!1,f]:[!0]}function kIe(){return NIe(N.useContext(YC))}function NIe(n){return n===null?!0:n.isPresent}const mO=n=>n.key||"";function GK(n){const t=[];return N.Children.forEach(n,i=>{N.isValidElement(i)&&t.push(i)}),t}const Oj=typeof window<"u",jZ=Oj?N.useLayoutEffect:N.useEffect,U0=({children:n,custom:t,initial:i=!0,onExitComplete:a,presenceAffectsLayout:l=!0,mode:d="sync",propagate:f=!1})=>{const[_,v]=Pj(f),b=N.useMemo(()=>GK(n),[n]),C=f&&!_?[]:b.map(mO),I=N.useRef(!0),O=N.useRef(b),L=Ij(()=>new Map),[M,F]=N.useState(b),[z,Z]=N.useState(b);jZ(()=>{I.current=!1,O.current=b;for(let ae=0;ae<z.length;ae++){const ne=mO(z[ae]);C.includes(ne)?L.delete(ne):L.get(ne)!==!0&&L.set(ne,!1)}},[z,C.length,C.join("-")]);const K=[];if(b!==M){let ae=[...b];for(let ne=0;ne<z.length;ne++){const pe=z[ne],X=mO(pe);C.includes(X)||(ae.splice(ne,0,pe),K.push(pe))}d==="wait"&&K.length&&(ae=K),Z(GK(ae)),F(b);return}const{forceRender:re}=N.useContext(Rj);return T.jsx(T.Fragment,{children:z.map(ae=>{const ne=mO(ae),pe=f&&!_?!1:b===z||C.includes(ne),X=()=>{if(L.has(ne))L.set(ne,!0);else return;let J=!0;L.forEach(Q=>{Q||(J=!1)}),J&&(re==null||re(),Z(O.current),f&&(v==null||v()),a&&a())};return T.jsx(PIe,{isPresent:pe,initial:!I.current||i?void 0:!1,custom:pe?void 0:t,presenceAffectsLayout:l,mode:d,onExitComplete:pe?void 0:X,children:ae},ne)})})},Yl=n=>n;let FZ=Yl;function kj(n){let t;return()=>(t===void 0&&(t=n()),t)}const m0=(n,t,i)=>{const a=t-n;return a===0?1:(i-n)/a},Uf=n=>n*1e3,Vf=n=>n/1e3,DIe={useManualTiming:!1};function xIe(n){let t=new Set,i=new Set,a=!1,l=!1;const d=new WeakSet;let f={delta:0,timestamp:0,isProcessing:!1};function _(b){d.has(b)&&(v.schedule(b),n()),b(f)}const v={schedule:(b,C=!1,I=!1)=>{const L=I&&a?t:i;return C&&d.add(b),L.has(b)||L.add(b),b},cancel:b=>{i.delete(b),d.delete(b)},process:b=>{if(f=b,a){l=!0;return}a=!0,[t,i]=[i,t],t.forEach(_),t.clear(),a=!1,l&&(l=!1,v.process(b))}};return v}const gO=["read","resolveKeyframes","update","preRender","render","postRender"],LIe=40;function BZ(n,t){let i=!1,a=!0;const l={delta:0,timestamp:0,isProcessing:!1},d=()=>i=!0,f=gO.reduce((Z,K)=>(Z[K]=xIe(d),Z),{}),{read:_,resolveKeyframes:v,update:b,preRender:C,render:I,postRender:O}=f,L=()=>{const Z=performance.now();i=!1,l.delta=a?1e3/60:Math.max(Math.min(Z-l.timestamp,LIe),1),l.timestamp=Z,l.isProcessing=!0,_.process(l),v.process(l),b.process(l),C.process(l),I.process(l),O.process(l),l.isProcessing=!1,i&&t&&(a=!1,n(L))},M=()=>{i=!0,a=!0,l.isProcessing||n(L)};return{schedule:gO.reduce((Z,K)=>{const re=f[K];return Z[K]=(ae,ne=!1,pe=!1)=>(i||M(),re.schedule(ae,ne,pe)),Z},{}),cancel:Z=>{for(let K=0;K<gO.length;K++)f[gO[K]].cancel(Z)},state:l,steps:f}}const{schedule:rs,cancel:Og,state:Ca,steps:vM}=BZ(typeof requestAnimationFrame<"u"?requestAnimationFrame:Yl,!0),zZ=N.createContext({strict:!1}),HK={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},g0={};for(const n in HK)g0[n]={isEnabled:t=>HK[n].some(i=>!!t[i])};function MIe(n){for(const t in n)g0[t]={...g0[t],...n[t]}}const UIe=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function wk(n){return n.startsWith("while")||n.startsWith("drag")&&n!=="draggable"||n.startsWith("layout")||n.startsWith("onTap")||n.startsWith("onPan")||n.startsWith("onLayout")||UIe.has(n)}let WZ=n=>!wk(n);function VIe(n){n&&(WZ=t=>t.startsWith("on")?!wk(t):n(t))}try{VIe(require("@emotion/is-prop-valid").default)}catch{}function jIe(n,t,i){const a={};for(const l in n)l==="values"&&typeof n.values=="object"||(WZ(l)||i===!0&&wk(l)||!t&&!wk(l)||n.draggable&&l.startsWith("onDrag"))&&(a[l]=n[l]);return a}function FIe(n){if(typeof Proxy>"u")return n;const t=new Map,i=(...a)=>n(...a);return new Proxy(i,{get:(a,l)=>l==="create"?n:(t.has(l)||t.set(l,n(l)),t.get(l))})}const v1=N.createContext({});function TC(n){return typeof n=="string"||Array.isArray(n)}function S1(n){return n!==null&&typeof n=="object"&&typeof n.start=="function"}const Nj=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Dj=["initial",...Nj];function b1(n){return S1(n.animate)||Dj.some(t=>TC(n[t]))}function GZ(n){return!!(b1(n)||n.variants)}function BIe(n,t){if(b1(n)){const{initial:i,animate:a}=n;return{initial:i===!1||TC(i)?i:void 0,animate:TC(a)?a:void 0}}return n.inherit!==!1?t:{}}function zIe(n){const{initial:t,animate:i}=BIe(n,N.useContext(v1));return N.useMemo(()=>({initial:t,animate:i}),[$K(t),$K(i)])}function $K(n){return Array.isArray(n)?n.join(" "):n}const WIe=Symbol.for("motionComponentSymbol");function FS(n){return n&&typeof n=="object"&&Object.prototype.hasOwnProperty.call(n,"current")}function GIe(n,t,i){return N.useCallback(a=>{a&&n.onMount&&n.onMount(a),t&&(a?t.mount(a):t.unmount()),i&&(typeof i=="function"?i(a):FS(i)&&(i.current=a))},[t])}const xj=n=>n.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),HIe="framerAppearId",HZ="data-"+xj(HIe),{schedule:Lj}=BZ(queueMicrotask,!1),$Z=N.createContext({});function $Ie(n,t,i,a,l){var d,f;const{visualElement:_}=N.useContext(v1),v=N.useContext(zZ),b=N.useContext(YC),C=N.useContext(Aj).reducedMotion,I=N.useRef(null);a=a||v.renderer,!I.current&&a&&(I.current=a(n,{visualState:t,parent:_,props:i,presenceContext:b,blockInitialAnimation:b?b.initial===!1:!1,reducedMotionConfig:C}));const O=I.current,L=N.useContext($Z);O&&!O.projection&&l&&(O.type==="html"||O.type==="svg")&&KIe(I.current,i,l,L);const M=N.useRef(!1);N.useInsertionEffect(()=>{O&&M.current&&O.update(i,b)});const F=i[HZ],z=N.useRef(!!F&&!(!((d=window.MotionHandoffIsComplete)===null||d===void 0)&&d.call(window,F))&&((f=window.MotionHasOptimisedAnimation)===null||f===void 0?void 0:f.call(window,F)));return jZ(()=>{O&&(M.current=!0,window.MotionIsMounted=!0,O.updateFeatures(),Lj.render(O.render),z.current&&O.animationState&&O.animationState.animateChanges())}),N.useEffect(()=>{O&&(!z.current&&O.animationState&&O.animationState.animateChanges(),z.current&&(queueMicrotask(()=>{var Z;(Z=window.MotionHandoffMarkAsComplete)===null||Z===void 0||Z.call(window,F)}),z.current=!1))}),O}function KIe(n,t,i,a){const{layoutId:l,layout:d,drag:f,dragConstraints:_,layoutScroll:v,layoutRoot:b}=t;n.projection=new i(n.latestValues,t["data-framer-portal-id"]?void 0:KZ(n.parent)),n.projection.setOptions({layoutId:l,layout:d,alwaysMeasureLayout:!!f||_&&FS(_),visualElement:n,animationType:typeof d=="string"?d:"both",initialPromotionConfig:a,layoutScroll:v,layoutRoot:b})}function KZ(n){if(n)return n.options.allowProjection!==!1?n.projection:KZ(n.parent)}function qIe({preloadedFeatures:n,createVisualElement:t,useRender:i,useVisualState:a,Component:l}){var d,f;n&&MIe(n);function _(b,C){let I;const O={...N.useContext(Aj),...b,layoutId:YIe(b)},{isStatic:L}=O,M=zIe(b),F=a(b,L);if(!L&&Oj){XIe();const z=JIe(O);I=z.MeasureLayout,M.visualElement=$Ie(l,F,O,t,z.ProjectionNode)}return T.jsxs(v1.Provider,{value:M,children:[I&&M.visualElement?T.jsx(I,{visualElement:M.visualElement,...O}):null,i(l,b,GIe(F,M.visualElement,C),F,L,M.visualElement)]})}_.displayName=`motion.${typeof l=="string"?l:`create(${(f=(d=l.displayName)!==null&&d!==void 0?d:l.name)!==null&&f!==void 0?f:""})`}`;const v=N.forwardRef(_);return v[WIe]=l,v}function YIe({layoutId:n}){const t=N.useContext(Rj).id;return t&&n!==void 0?t+"-"+n:n}function XIe(n,t){N.useContext(zZ).strict}function JIe(n){const{drag:t,layout:i}=g0;if(!t&&!i)return{};const a={...t,...i};return{MeasureLayout:t!=null&&t.isEnabled(n)||i!=null&&i.isEnabled(n)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}const QIe=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Mj(n){return typeof n!="string"||n.includes("-")?!1:!!(QIe.indexOf(n)>-1||/[A-Z]/u.test(n))}function KK(n){const t=[{},{}];return n==null||n.values.forEach((i,a)=>{t[0][a]=i.get(),t[1][a]=i.getVelocity()}),t}function Uj(n,t,i,a){if(typeof t=="function"){const[l,d]=KK(a);t=t(i!==void 0?i:n.custom,l,d)}if(typeof t=="string"&&(t=n.variants&&n.variants[t]),typeof t=="function"){const[l,d]=KK(a);t=t(i!==void 0?i:n.custom,l,d)}return t}const DU=n=>Array.isArray(n),ZIe=n=>!!(n&&typeof n=="object"&&n.mix&&n.toValue),eAe=n=>DU(n)?n[n.length-1]||0:n,sc=n=>!!(n&&n.getVelocity);function JO(n){const t=sc(n)?n.get():n;return ZIe(t)?t.toValue():t}function tAe({scrapeMotionValuesFromProps:n,createRenderState:t,onUpdate:i},a,l,d){const f={latestValues:nAe(a,l,d,n),renderState:t()};return i&&(f.onMount=_=>i({props:a,current:_,...f}),f.onUpdate=_=>i(_)),f}const qZ=n=>(t,i)=>{const a=N.useContext(v1),l=N.useContext(YC),d=()=>tAe(n,t,a,l);return i?d():Ij(d)};function nAe(n,t,i,a){const l={},d=a(n,{});for(const O in d)l[O]=JO(d[O]);let{initial:f,animate:_}=n;const v=b1(n),b=GZ(n);t&&b&&!v&&n.inherit!==!1&&(f===void 0&&(f=t.initial),_===void 0&&(_=t.animate));let C=i?i.initial===!1:!1;C=C||f===!1;const I=C?_:f;if(I&&typeof I!="boolean"&&!S1(I)){const O=Array.isArray(I)?I:[I];for(let L=0;L<O.length;L++){const M=Uj(n,O[L]);if(M){const{transitionEnd:F,transition:z,...Z}=M;for(const K in Z){let re=Z[K];if(Array.isArray(re)){const ae=C?re.length-1:0;re=re[ae]}re!==null&&(l[K]=re)}for(const K in F)l[K]=F[K]}}}return l}const V0=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Qy=new Set(V0),YZ=n=>t=>typeof t=="string"&&t.startsWith(n),XZ=YZ("--"),rAe=YZ("var(--"),Vj=n=>rAe(n)?iAe.test(n.split("/*")[0].trim()):!1,iAe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,JZ=(n,t)=>t&&typeof n=="number"?t.transform(n):n,Gf=(n,t,i)=>i>t?t:i<n?n:i,j0={test:n=>typeof n=="number",parse:parseFloat,transform:n=>n},wC={...j0,transform:n=>Gf(0,1,n)},_O={...j0,default:1},XC=n=>({test:t=>typeof t=="string"&&t.endsWith(n)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${n}`}),pg=XC("deg"),lp=XC("%"),Bn=XC("px"),sAe=XC("vh"),oAe=XC("vw"),qK={...lp,parse:n=>lp.parse(n)/100,transform:n=>lp.transform(n*100)},aAe={borderWidth:Bn,borderTopWidth:Bn,borderRightWidth:Bn,borderBottomWidth:Bn,borderLeftWidth:Bn,borderRadius:Bn,radius:Bn,borderTopLeftRadius:Bn,borderTopRightRadius:Bn,borderBottomRightRadius:Bn,borderBottomLeftRadius:Bn,width:Bn,maxWidth:Bn,height:Bn,maxHeight:Bn,top:Bn,right:Bn,bottom:Bn,left:Bn,padding:Bn,paddingTop:Bn,paddingRight:Bn,paddingBottom:Bn,paddingLeft:Bn,margin:Bn,marginTop:Bn,marginRight:Bn,marginBottom:Bn,marginLeft:Bn,backgroundPositionX:Bn,backgroundPositionY:Bn},cAe={rotate:pg,rotateX:pg,rotateY:pg,rotateZ:pg,scale:_O,scaleX:_O,scaleY:_O,scaleZ:_O,skew:pg,skewX:pg,skewY:pg,distance:Bn,translateX:Bn,translateY:Bn,translateZ:Bn,x:Bn,y:Bn,z:Bn,perspective:Bn,transformPerspective:Bn,opacity:wC,originX:qK,originY:qK,originZ:Bn},YK={...j0,transform:Math.round},jj={...aAe,...cAe,zIndex:YK,size:Bn,fillOpacity:wC,strokeOpacity:wC,numOctaves:YK},lAe={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},uAe=V0.length;function dAe(n,t,i){let a="",l=!0;for(let d=0;d<uAe;d++){const f=V0[d],_=n[f];if(_===void 0)continue;let v=!0;if(typeof _=="number"?v=_===(f.startsWith("scale")?1:0):v=parseFloat(_)===0,!v||i){const b=JZ(_,jj[f]);if(!v){l=!1;const C=lAe[f]||f;a+=`${C}(${b}) `}i&&(t[f]=b)}}return a=a.trim(),i?a=i(t,l?"":a):l&&(a="none"),a}function Fj(n,t,i){const{style:a,vars:l,transformOrigin:d}=n;let f=!1,_=!1;for(const v in t){const b=t[v];if(Qy.has(v)){f=!0;continue}else if(XZ(v)){l[v]=b;continue}else{const C=JZ(b,jj[v]);v.startsWith("origin")?(_=!0,d[v]=C):a[v]=C}}if(t.transform||(f||i?a.transform=dAe(t,n.transform,i):a.transform&&(a.transform="none")),_){const{originX:v="50%",originY:b="50%",originZ:C=0}=d;a.transformOrigin=`${v} ${b} ${C}`}}const hAe={offset:"stroke-dashoffset",array:"stroke-dasharray"},pAe={offset:"strokeDashoffset",array:"strokeDasharray"};function fAe(n,t,i=1,a=0,l=!0){n.pathLength=1;const d=l?hAe:pAe;n[d.offset]=Bn.transform(-a);const f=Bn.transform(t),_=Bn.transform(i);n[d.array]=`${f} ${_}`}function XK(n,t,i){return typeof n=="string"?n:Bn.transform(t+i*n)}function mAe(n,t,i){const a=XK(t,n.x,n.width),l=XK(i,n.y,n.height);return`${a} ${l}`}function Bj(n,{attrX:t,attrY:i,attrScale:a,originX:l,originY:d,pathLength:f,pathSpacing:_=1,pathOffset:v=0,...b},C,I){if(Fj(n,b,I),C){n.style.viewBox&&(n.attrs.viewBox=n.style.viewBox);return}n.attrs=n.style,n.style={};const{attrs:O,style:L,dimensions:M}=n;O.transform&&(M&&(L.transform=O.transform),delete O.transform),M&&(l!==void 0||d!==void 0||L.transform)&&(L.transformOrigin=mAe(M,l!==void 0?l:.5,d!==void 0?d:.5)),t!==void 0&&(O.x=t),i!==void 0&&(O.y=i),a!==void 0&&(O.scale=a),f!==void 0&&fAe(O,f,_,v,!1)}const zj=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),QZ=()=>({...zj(),attrs:{}}),Wj=n=>typeof n=="string"&&n.toLowerCase()==="svg";function ZZ(n,{style:t,vars:i},a,l){Object.assign(n.style,t,l&&l.getProjectionStyles(a));for(const d in i)n.style.setProperty(d,i[d])}const eee=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function tee(n,t,i,a){ZZ(n,t,void 0,a);for(const l in t.attrs)n.setAttribute(eee.has(l)?l:xj(l),t.attrs[l])}const Ck={};function gAe(n){Object.assign(Ck,n)}function nee(n,{layout:t,layoutId:i}){return Qy.has(n)||n.startsWith("origin")||(t||i!==void 0)&&(!!Ck[n]||n==="opacity")}function Gj(n,t,i){var a;const{style:l}=n,d={};for(const f in l)(sc(l[f])||t.style&&sc(t.style[f])||nee(f,n)||((a=i==null?void 0:i.getValue(f))===null||a===void 0?void 0:a.liveStyle)!==void 0)&&(d[f]=l[f]);return d}function ree(n,t,i){const a=Gj(n,t,i);for(const l in n)if(sc(n[l])||sc(t[l])){const d=V0.indexOf(l)!==-1?"attr"+l.charAt(0).toUpperCase()+l.substring(1):l;a[d]=n[l]}return a}function _Ae(n,t){try{t.dimensions=typeof n.getBBox=="function"?n.getBBox():n.getBoundingClientRect()}catch{t.dimensions={x:0,y:0,width:0,height:0}}}const JK=["x","y","width","height","cx","cy","r"],yAe={useVisualState:qZ({scrapeMotionValuesFromProps:ree,createRenderState:QZ,onUpdate:({props:n,prevProps:t,current:i,renderState:a,latestValues:l})=>{if(!i)return;let d=!!n.drag;if(!d){for(const _ in l)if(Qy.has(_)){d=!0;break}}if(!d)return;let f=!t;if(t)for(let _=0;_<JK.length;_++){const v=JK[_];n[v]!==t[v]&&(f=!0)}f&&rs.read(()=>{_Ae(i,a),rs.render(()=>{Bj(a,l,Wj(i.tagName),n.transformTemplate),tee(i,a)})})}})},EAe={useVisualState:qZ({scrapeMotionValuesFromProps:Gj,createRenderState:zj})};function iee(n,t,i){for(const a in t)!sc(t[a])&&!nee(a,i)&&(n[a]=t[a])}function vAe({transformTemplate:n},t){return N.useMemo(()=>{const i=zj();return Fj(i,t,n),Object.assign({},i.vars,i.style)},[t])}function SAe(n,t){const i=n.style||{},a={};return iee(a,i,n),Object.assign(a,vAe(n,t)),a}function bAe(n,t){const i={},a=SAe(n,t);return n.drag&&n.dragListener!==!1&&(i.draggable=!1,a.userSelect=a.WebkitUserSelect=a.WebkitTouchCallout="none",a.touchAction=n.drag===!0?"none":`pan-${n.drag==="x"?"y":"x"}`),n.tabIndex===void 0&&(n.onTap||n.onTapStart||n.whileTap)&&(i.tabIndex=0),i.style=a,i}function TAe(n,t,i,a){const l=N.useMemo(()=>{const d=QZ();return Bj(d,t,Wj(a),n.transformTemplate),{...d.attrs,style:{...d.style}}},[t]);if(n.style){const d={};iee(d,n.style,n),l.style={...d,...l.style}}return l}function wAe(n=!1){return(i,a,l,{latestValues:d},f)=>{const v=(Mj(i)?TAe:bAe)(a,d,f,i),b=jIe(a,typeof i=="string",n),C=i!==N.Fragment?{...b,...v,ref:l}:{},{children:I}=a,O=N.useMemo(()=>sc(I)?I.get():I,[I]);return N.createElement(i,{...C,children:O})}}function CAe(n,t){return function(a,{forwardMotionProps:l}={forwardMotionProps:!1}){const f={...Mj(a)?yAe:EAe,preloadedFeatures:n,useRender:wAe(l),createVisualElement:t,Component:a};return qIe(f)}}function see(n,t){if(!Array.isArray(t))return!1;const i=t.length;if(i!==n.length)return!1;for(let a=0;a<i;a++)if(t[a]!==n[a])return!1;return!0}function T1(n,t,i){const a=n.getProps();return Uj(a,t,i!==void 0?i:a.custom,n)}const RAe=kj(()=>window.ScrollTimeline!==void 0);class IAe{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>"finished"in t?t.finished:t))}getAll(t){return this.animations[0][t]}setAll(t,i){for(let a=0;a<this.animations.length;a++)this.animations[a][t]=i}attachTimeline(t,i){const a=this.animations.map(l=>{if(RAe()&&l.attachTimeline)return l.attachTimeline(t);if(typeof i=="function")return i(l)});return()=>{a.forEach((l,d)=>{l&&l(),this.animations[d].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let i=0;i<this.animations.length;i++)t=Math.max(t,this.animations[i].duration);return t}runAll(t){this.animations.forEach(i=>i[t]())}flatten(){this.runAll("flatten")}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}class AAe extends IAe{then(t,i){return Promise.all(this.animations).then(t).catch(i)}}function Hj(n,t){return n?n[t]||n.default||n:void 0}const xU=2e4;function oee(n){let t=0;const i=50;let a=n.next(t);for(;!a.done&&t<xU;)t+=i,a=n.next(t);return t>=xU?1/0:t}function $j(n){return typeof n=="function"}function QK(n,t){n.timeline=t,n.onfinish=null}const Kj=n=>Array.isArray(n)&&typeof n[0]=="number",PAe={linearEasing:void 0};function OAe(n,t){const i=kj(n);return()=>{var a;return(a=PAe[t])!==null&&a!==void 0?a:i()}}const Rk=OAe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),aee=(n,t,i=10)=>{let a="";const l=Math.max(Math.round(t/i),2);for(let d=0;d<l;d++)a+=n(m0(0,l-1,d))+", ";return`linear(${a.substring(0,a.length-2)})`};function cee(n){return!!(typeof n=="function"&&Rk()||!n||typeof n=="string"&&(n in LU||Rk())||Kj(n)||Array.isArray(n)&&n.every(cee))}const Mw=([n,t,i,a])=>`cubic-bezier(${n}, ${t}, ${i}, ${a})`,LU={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Mw([0,.65,.55,1]),circOut:Mw([.55,0,1,.45]),backIn:Mw([.31,.01,.66,-.59]),backOut:Mw([.33,1.53,.69,.99])};function lee(n,t){if(n)return typeof n=="function"&&Rk()?aee(n,t):Kj(n)?Mw(n):Array.isArray(n)?n.map(i=>lee(i,t)||LU.easeOut):LU[n]}const Fd={x:!1,y:!1};function uee(){return Fd.x||Fd.y}function kAe(n,t,i){var a;if(n instanceof Element)return[n];if(typeof n=="string"){let l=document;const d=(a=void 0)!==null&&a!==void 0?a:l.querySelectorAll(n);return d?Array.from(d):[]}return Array.from(n)}function dee(n,t){const i=kAe(n),a=new AbortController,l={passive:!0,...t,signal:a.signal};return[i,l,()=>a.abort()]}function ZK(n){return t=>{t.pointerType==="touch"||uee()||n(t)}}function NAe(n,t,i={}){const[a,l,d]=dee(n,i),f=ZK(_=>{const{target:v}=_,b=t(_);if(typeof b!="function"||!v)return;const C=ZK(I=>{b(I),v.removeEventListener("pointerleave",C)});v.addEventListener("pointerleave",C,l)});return a.forEach(_=>{_.addEventListener("pointerenter",f,l)}),d}const hee=(n,t)=>t?n===t?!0:hee(n,t.parentElement):!1,qj=n=>n.pointerType==="mouse"?typeof n.button!="number"||n.button<=0:n.isPrimary!==!1,DAe=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function xAe(n){return DAe.has(n.tagName)||n.tabIndex!==-1}const Uw=new WeakSet;function eq(n){return t=>{t.key==="Enter"&&n(t)}}function SM(n,t){n.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const LAe=(n,t)=>{const i=n.currentTarget;if(!i)return;const a=eq(()=>{if(Uw.has(i))return;SM(i,"down");const l=eq(()=>{SM(i,"up")}),d=()=>SM(i,"cancel");i.addEventListener("keyup",l,t),i.addEventListener("blur",d,t)});i.addEventListener("keydown",a,t),i.addEventListener("blur",()=>i.removeEventListener("keydown",a),t)};function tq(n){return qj(n)&&!uee()}function MAe(n,t,i={}){const[a,l,d]=dee(n,i),f=_=>{const v=_.currentTarget;if(!tq(_)||Uw.has(v))return;Uw.add(v);const b=t(_),C=(L,M)=>{window.removeEventListener("pointerup",I),window.removeEventListener("pointercancel",O),!(!tq(L)||!Uw.has(v))&&(Uw.delete(v),typeof b=="function"&&b(L,{success:M}))},I=L=>{C(L,i.useGlobalTarget||hee(v,L.target))},O=L=>{C(L,!1)};window.addEventListener("pointerup",I,l),window.addEventListener("pointercancel",O,l)};return a.forEach(_=>{!xAe(_)&&_.getAttribute("tabindex")===null&&(_.tabIndex=0),(i.useGlobalTarget?window:_).addEventListener("pointerdown",f,l),_.addEventListener("focus",b=>LAe(b,l),l)}),d}function UAe(n){return n==="x"||n==="y"?Fd[n]?null:(Fd[n]=!0,()=>{Fd[n]=!1}):Fd.x||Fd.y?null:(Fd.x=Fd.y=!0,()=>{Fd.x=Fd.y=!1})}const pee=new Set(["width","height","top","left","right","bottom",...V0]);let QO;function VAe(){QO=void 0}const up={now:()=>(QO===void 0&&up.set(Ca.isProcessing||DIe.useManualTiming?Ca.timestamp:performance.now()),QO),set:n=>{QO=n,queueMicrotask(VAe)}};function Yj(n,t){n.indexOf(t)===-1&&n.push(t)}function Xj(n,t){const i=n.indexOf(t);i>-1&&n.splice(i,1)}class Jj{constructor(){this.subscriptions=[]}add(t){return Yj(this.subscriptions,t),()=>Xj(this.subscriptions,t)}notify(t,i,a){const l=this.subscriptions.length;if(l)if(l===1)this.subscriptions[0](t,i,a);else for(let d=0;d<l;d++){const f=this.subscriptions[d];f&&f(t,i,a)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function fee(n,t){return t?n*(1e3/t):0}const nq=30,jAe=n=>!isNaN(parseFloat(n));class FAe{constructor(t,i={}){this.version="11.18.2",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(a,l=!0)=>{const d=up.now();this.updatedAt!==d&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(a),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),l&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=i.owner}setCurrent(t){this.current=t,this.updatedAt=up.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=jAe(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,i){this.events[t]||(this.events[t]=new Jj);const a=this.events[t].add(i);return t==="change"?()=>{a(),rs.read(()=>{this.events.change.getSize()||this.stop()})}:a}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,i){this.passiveEffect=t,this.stopPassiveEffect=i}set(t,i=!0){!i||!this.passiveEffect?this.updateAndNotify(t,i):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,i,a){this.set(i),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-a}jump(t,i=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=up.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>nq)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,nq);return fee(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(t){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=t(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function CC(n,t){return new FAe(n,t)}function BAe(n,t,i){n.hasValue(t)?n.getValue(t).set(i):n.addValue(t,CC(i))}function zAe(n,t){const i=T1(n,t);let{transitionEnd:a={},transition:l={},...d}=i||{};d={...d,...a};for(const f in d){const _=eAe(d[f]);BAe(n,f,_)}}function WAe(n){return!!(sc(n)&&n.add)}function MU(n,t){const i=n.getValue("willChange");if(WAe(i))return i.add(t)}function mee(n){return n.props[HZ]}const gee=(n,t,i)=>(((1-3*i+3*t)*n+(3*i-6*t))*n+3*t)*n,GAe=1e-7,HAe=12;function $Ae(n,t,i,a,l){let d,f,_=0;do f=t+(i-t)/2,d=gee(f,a,l)-n,d>0?i=f:t=f;while(Math.abs(d)>GAe&&++_<HAe);return f}function JC(n,t,i,a){if(n===t&&i===a)return Yl;const l=d=>$Ae(d,0,1,n,i);return d=>d===0||d===1?d:gee(l(d),t,a)}const _ee=n=>t=>t<=.5?n(2*t)/2:(2-n(2*(1-t)))/2,yee=n=>t=>1-n(1-t),Eee=JC(.33,1.53,.69,.99),Qj=yee(Eee),vee=_ee(Qj),See=n=>(n*=2)<1?.5*Qj(n):.5*(2-Math.pow(2,-10*(n-1))),Zj=n=>1-Math.sin(Math.acos(n)),bee=yee(Zj),Tee=_ee(Zj),wee=n=>/^0[^.\s]+$/u.test(n);function KAe(n){return typeof n=="number"?n===0:n!==null?n==="none"||n==="0"||wee(n):!0}const nC=n=>Math.round(n*1e5)/1e5,eF=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function qAe(n){return n==null}const YAe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,tF=(n,t)=>i=>!!(typeof i=="string"&&YAe.test(i)&&i.startsWith(n)||t&&!qAe(i)&&Object.prototype.hasOwnProperty.call(i,t)),Cee=(n,t,i)=>a=>{if(typeof a!="string")return a;const[l,d,f,_]=a.match(eF);return{[n]:parseFloat(l),[t]:parseFloat(d),[i]:parseFloat(f),alpha:_!==void 0?parseFloat(_):1}},XAe=n=>Gf(0,255,n),bM={...j0,transform:n=>Math.round(XAe(n))},Ty={test:tF("rgb","red"),parse:Cee("red","green","blue"),transform:({red:n,green:t,blue:i,alpha:a=1})=>"rgba("+bM.transform(n)+", "+bM.transform(t)+", "+bM.transform(i)+", "+nC(wC.transform(a))+")"};function JAe(n){let t="",i="",a="",l="";return n.length>5?(t=n.substring(1,3),i=n.substring(3,5),a=n.substring(5,7),l=n.substring(7,9)):(t=n.substring(1,2),i=n.substring(2,3),a=n.substring(3,4),l=n.substring(4,5),t+=t,i+=i,a+=a,l+=l),{red:parseInt(t,16),green:parseInt(i,16),blue:parseInt(a,16),alpha:l?parseInt(l,16)/255:1}}const UU={test:tF("#"),parse:JAe,transform:Ty.transform},BS={test:tF("hsl","hue"),parse:Cee("hue","saturation","lightness"),transform:({hue:n,saturation:t,lightness:i,alpha:a=1})=>"hsla("+Math.round(n)+", "+lp.transform(nC(t))+", "+lp.transform(nC(i))+", "+nC(wC.transform(a))+")"},nc={test:n=>Ty.test(n)||UU.test(n)||BS.test(n),parse:n=>Ty.test(n)?Ty.parse(n):BS.test(n)?BS.parse(n):UU.parse(n),transform:n=>typeof n=="string"?n:n.hasOwnProperty("red")?Ty.transform(n):BS.transform(n)},QAe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function ZAe(n){var t,i;return isNaN(n)&&typeof n=="string"&&(((t=n.match(eF))===null||t===void 0?void 0:t.length)||0)+(((i=n.match(QAe))===null||i===void 0?void 0:i.length)||0)>0}const Ree="number",Iee="color",ePe="var",tPe="var(",rq="${}",nPe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function RC(n){const t=n.toString(),i=[],a={color:[],number:[],var:[]},l=[];let d=0;const _=t.replace(nPe,v=>(nc.test(v)?(a.color.push(d),l.push(Iee),i.push(nc.parse(v))):v.startsWith(tPe)?(a.var.push(d),l.push(ePe),i.push(v)):(a.number.push(d),l.push(Ree),i.push(parseFloat(v))),++d,rq)).split(rq);return{values:i,split:_,indexes:a,types:l}}function Aee(n){return RC(n).values}function Pee(n){const{split:t,types:i}=RC(n),a=t.length;return l=>{let d="";for(let f=0;f<a;f++)if(d+=t[f],l[f]!==void 0){const _=i[f];_===Ree?d+=nC(l[f]):_===Iee?d+=nc.transform(l[f]):d+=l[f]}return d}}const rPe=n=>typeof n=="number"?0:n;function iPe(n){const t=Aee(n);return Pee(n)(t.map(rPe))}const kg={test:ZAe,parse:Aee,createTransformer:Pee,getAnimatableNone:iPe},sPe=new Set(["brightness","contrast","saturate","opacity"]);function oPe(n){const[t,i]=n.slice(0,-1).split("(");if(t==="drop-shadow")return n;const[a]=i.match(eF)||[];if(!a)return n;const l=i.replace(a,"");let d=sPe.has(t)?1:0;return a!==i&&(d*=100),t+"("+d+l+")"}const aPe=/\b([a-z-]*)\(.*?\)/gu,VU={...kg,getAnimatableNone:n=>{const t=n.match(aPe);return t?t.map(oPe).join(" "):n}},cPe={...jj,color:nc,backgroundColor:nc,outlineColor:nc,fill:nc,stroke:nc,borderColor:nc,borderTopColor:nc,borderRightColor:nc,borderBottomColor:nc,borderLeftColor:nc,filter:VU,WebkitFilter:VU},nF=n=>cPe[n];function Oee(n,t){let i=nF(n);return i!==VU&&(i=kg),i.getAnimatableNone?i.getAnimatableNone(t):void 0}const lPe=new Set(["auto","none","0"]);function uPe(n,t,i){let a=0,l;for(;a<n.length&&!l;){const d=n[a];typeof d=="string"&&!lPe.has(d)&&RC(d).values.length&&(l=n[a]),a++}if(l&&i)for(const d of t)n[d]=Oee(i,l)}const iq=n=>n===j0||n===Bn,sq=(n,t)=>parseFloat(n.split(", ")[t]),oq=(n,t)=>(i,{transform:a})=>{if(a==="none"||!a)return 0;const l=a.match(/^matrix3d\((.+)\)$/u);if(l)return sq(l[1],t);{const d=a.match(/^matrix\((.+)\)$/u);return d?sq(d[1],n):0}},dPe=new Set(["x","y","z"]),hPe=V0.filter(n=>!dPe.has(n));function pPe(n){const t=[];return hPe.forEach(i=>{const a=n.getValue(i);a!==void 0&&(t.push([i,a.get()]),a.set(i.startsWith("scale")?1:0))}),t}const _0={width:({x:n},{paddingLeft:t="0",paddingRight:i="0"})=>n.max-n.min-parseFloat(t)-parseFloat(i),height:({y:n},{paddingTop:t="0",paddingBottom:i="0"})=>n.max-n.min-parseFloat(t)-parseFloat(i),top:(n,{top:t})=>parseFloat(t),left:(n,{left:t})=>parseFloat(t),bottom:({y:n},{top:t})=>parseFloat(t)+(n.max-n.min),right:({x:n},{left:t})=>parseFloat(t)+(n.max-n.min),x:oq(4,13),y:oq(5,14)};_0.translateX=_0.x;_0.translateY=_0.y;const ky=new Set;let jU=!1,FU=!1;function kee(){if(FU){const n=Array.from(ky).filter(a=>a.needsMeasurement),t=new Set(n.map(a=>a.element)),i=new Map;t.forEach(a=>{const l=pPe(a);l.length&&(i.set(a,l),a.render())}),n.forEach(a=>a.measureInitialState()),t.forEach(a=>{a.render();const l=i.get(a);l&&l.forEach(([d,f])=>{var _;(_=a.getValue(d))===null||_===void 0||_.set(f)})}),n.forEach(a=>a.measureEndState()),n.forEach(a=>{a.suspendedScrollY!==void 0&&window.scrollTo(0,a.suspendedScrollY)})}FU=!1,jU=!1,ky.forEach(n=>n.complete()),ky.clear()}function Nee(){ky.forEach(n=>{n.readKeyframes(),n.needsMeasurement&&(FU=!0)})}function fPe(){Nee(),kee()}class rF{constructor(t,i,a,l,d,f=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=i,this.name=a,this.motionValue=l,this.element=d,this.isAsync=f}scheduleResolve(){this.isScheduled=!0,this.isAsync?(ky.add(this),jU||(jU=!0,rs.read(Nee),rs.resolveKeyframes(kee))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:i,element:a,motionValue:l}=this;for(let d=0;d<t.length;d++)if(t[d]===null)if(d===0){const f=l==null?void 0:l.get(),_=t[t.length-1];if(f!==void 0)t[0]=f;else if(a&&i){const v=a.readValue(i,_);v!=null&&(t[0]=v)}t[0]===void 0&&(t[0]=_),l&&f===void 0&&l.set(t[0])}else t[d]=t[d-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),ky.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,ky.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const Dee=n=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(n),mPe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function gPe(n){const t=mPe.exec(n);if(!t)return[,];const[,i,a,l]=t;return[`--${i??a}`,l]}function xee(n,t,i=1){const[a,l]=gPe(n);if(!a)return;const d=window.getComputedStyle(t).getPropertyValue(a);if(d){const f=d.trim();return Dee(f)?parseFloat(f):f}return Vj(l)?xee(l,t,i+1):l}const Lee=n=>t=>t.test(n),_Pe={test:n=>n==="auto",parse:n=>n},Mee=[j0,Bn,lp,pg,oAe,sAe,_Pe],aq=n=>Mee.find(Lee(n));class Uee extends rF{constructor(t,i,a,l,d){super(t,i,a,l,d,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:i,name:a}=this;if(!i||!i.current)return;super.readKeyframes();for(let v=0;v<t.length;v++){let b=t[v];if(typeof b=="string"&&(b=b.trim(),Vj(b))){const C=xee(b,i.current);C!==void 0&&(t[v]=C),v===t.length-1&&(this.finalKeyframe=b)}}if(this.resolveNoneKeyframes(),!pee.has(a)||t.length!==2)return;const[l,d]=t,f=aq(l),_=aq(d);if(f!==_)if(iq(f)&&iq(_))for(let v=0;v<t.length;v++){const b=t[v];typeof b=="string"&&(t[v]=parseFloat(b))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:i}=this,a=[];for(let l=0;l<t.length;l++)KAe(t[l])&&a.push(l);a.length&&uPe(t,a,i)}measureInitialState(){const{element:t,unresolvedKeyframes:i,name:a}=this;if(!t||!t.current)return;a==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=_0[a](t.measureViewportBox(),window.getComputedStyle(t.current)),i[0]=this.measuredOrigin;const l=i[i.length-1];l!==void 0&&t.getValue(a,l).jump(l,!1)}measureEndState(){var t;const{element:i,name:a,unresolvedKeyframes:l}=this;if(!i||!i.current)return;const d=i.getValue(a);d&&d.jump(this.measuredOrigin,!1);const f=l.length-1,_=l[f];l[f]=_0[a](i.measureViewportBox(),window.getComputedStyle(i.current)),_!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=_),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([v,b])=>{i.getValue(v).set(b)}),this.resolveNoneKeyframes()}}const cq=(n,t)=>t==="zIndex"?!1:!!(typeof n=="number"||Array.isArray(n)||typeof n=="string"&&(kg.test(n)||n==="0")&&!n.startsWith("url("));function yPe(n){const t=n[0];if(n.length===1)return!0;for(let i=0;i<n.length;i++)if(n[i]!==t)return!0}function EPe(n,t,i,a){const l=n[0];if(l===null)return!1;if(t==="display"||t==="visibility")return!0;const d=n[n.length-1],f=cq(l,t),_=cq(d,t);return!f||!_?!1:yPe(n)||(i==="spring"||$j(i))&&a}const vPe=n=>n!==null;function w1(n,{repeat:t,repeatType:i="loop"},a){const l=n.filter(vPe),d=t&&i!=="loop"&&t%2===1?0:l.length-1;return!d||a===void 0?l[d]:a}const SPe=40;class Vee{constructor({autoplay:t=!0,delay:i=0,type:a="keyframes",repeat:l=0,repeatDelay:d=0,repeatType:f="loop",..._}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=up.now(),this.options={autoplay:t,delay:i,type:a,repeat:l,repeatDelay:d,repeatType:f,..._},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>SPe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&fPe(),this._resolved}onKeyframesResolved(t,i){this.resolvedAt=up.now(),this.hasAttemptedResolve=!0;const{name:a,type:l,velocity:d,delay:f,onComplete:_,onUpdate:v,isGenerator:b}=this.options;if(!b&&!EPe(t,a,l,d))if(f)this.options.duration=0;else{v&&v(w1(t,this.options,i)),_&&_(),this.resolveFinishedPromise();return}const C=this.initPlayback(t,i);C!==!1&&(this._resolved={keyframes:t,finalKeyframe:i,...C},this.onPostResolved())}onPostResolved(){}then(t,i){return this.currentFinishedPromise.then(t,i)}flatten(){this.options.type="keyframes",this.options.ease="linear"}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}const gs=(n,t,i)=>n+(t-n)*i;function TM(n,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(t-n)*6*i:i<1/2?t:i<2/3?n+(t-n)*(2/3-i)*6:n}function bPe({hue:n,saturation:t,lightness:i,alpha:a}){n/=360,t/=100,i/=100;let l=0,d=0,f=0;if(!t)l=d=f=i;else{const _=i<.5?i*(1+t):i+t-i*t,v=2*i-_;l=TM(v,_,n+1/3),d=TM(v,_,n),f=TM(v,_,n-1/3)}return{red:Math.round(l*255),green:Math.round(d*255),blue:Math.round(f*255),alpha:a}}function Ik(n,t){return i=>i>0?t:n}const wM=(n,t,i)=>{const a=n*n,l=i*(t*t-a)+a;return l<0?0:Math.sqrt(l)},TPe=[UU,Ty,BS],wPe=n=>TPe.find(t=>t.test(n));function lq(n){const t=wPe(n);if(!t)return!1;let i=t.parse(n);return t===BS&&(i=bPe(i)),i}const uq=(n,t)=>{const i=lq(n),a=lq(t);if(!i||!a)return Ik(n,t);const l={...i};return d=>(l.red=wM(i.red,a.red,d),l.green=wM(i.green,a.green,d),l.blue=wM(i.blue,a.blue,d),l.alpha=gs(i.alpha,a.alpha,d),Ty.transform(l))},CPe=(n,t)=>i=>t(n(i)),QC=(...n)=>n.reduce(CPe),BU=new Set(["none","hidden"]);function RPe(n,t){return BU.has(n)?i=>i<=0?n:t:i=>i>=1?t:n}function IPe(n,t){return i=>gs(n,t,i)}function iF(n){return typeof n=="number"?IPe:typeof n=="string"?Vj(n)?Ik:nc.test(n)?uq:OPe:Array.isArray(n)?jee:typeof n=="object"?nc.test(n)?uq:APe:Ik}function jee(n,t){const i=[...n],a=i.length,l=n.map((d,f)=>iF(d)(d,t[f]));return d=>{for(let f=0;f<a;f++)i[f]=l[f](d);return i}}function APe(n,t){const i={...n,...t},a={};for(const l in i)n[l]!==void 0&&t[l]!==void 0&&(a[l]=iF(n[l])(n[l],t[l]));return l=>{for(const d in a)i[d]=a[d](l);return i}}function PPe(n,t){var i;const a=[],l={color:0,var:0,number:0};for(let d=0;d<t.values.length;d++){const f=t.types[d],_=n.indexes[f][l[f]],v=(i=n.values[_])!==null&&i!==void 0?i:0;a[d]=v,l[f]++}return a}const OPe=(n,t)=>{const i=kg.createTransformer(t),a=RC(n),l=RC(t);return a.indexes.var.length===l.indexes.var.length&&a.indexes.color.length===l.indexes.color.length&&a.indexes.number.length>=l.indexes.number.length?BU.has(n)&&!l.values.length||BU.has(t)&&!a.values.length?RPe(n,t):QC(jee(PPe(a,l),l.values),i):Ik(n,t)};function Fee(n,t,i){return typeof n=="number"&&typeof t=="number"&&typeof i=="number"?gs(n,t,i):iF(n)(n,t)}const kPe=5;function Bee(n,t,i){const a=Math.max(t-kPe,0);return fee(i-n(a),t-a)}const xs={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},dq=.001;function NPe({duration:n=xs.duration,bounce:t=xs.bounce,velocity:i=xs.velocity,mass:a=xs.mass}){let l,d,f=1-t;f=Gf(xs.minDamping,xs.maxDamping,f),n=Gf(xs.minDuration,xs.maxDuration,Vf(n)),f<1?(l=b=>{const C=b*f,I=C*n,O=C-i,L=zU(b,f),M=Math.exp(-I);return dq-O/L*M},d=b=>{const I=b*f*n,O=I*i+i,L=Math.pow(f,2)*Math.pow(b,2)*n,M=Math.exp(-I),F=zU(Math.pow(b,2),f);return(-l(b)+dq>0?-1:1)*((O-L)*M)/F}):(l=b=>{const C=Math.exp(-b*n),I=(b-i)*n+1;return-.001+C*I},d=b=>{const C=Math.exp(-b*n),I=(i-b)*(n*n);return C*I});const _=5/n,v=xPe(l,d,_);if(n=Uf(n),isNaN(v))return{stiffness:xs.stiffness,damping:xs.damping,duration:n};{const b=Math.pow(v,2)*a;return{stiffness:b,damping:f*2*Math.sqrt(a*b),duration:n}}}const DPe=12;function xPe(n,t,i){let a=i;for(let l=1;l<DPe;l++)a=a-n(a)/t(a);return a}function zU(n,t){return n*Math.sqrt(1-t*t)}const LPe=["duration","bounce"],MPe=["stiffness","damping","mass"];function hq(n,t){return t.some(i=>n[i]!==void 0)}function UPe(n){let t={velocity:xs.velocity,stiffness:xs.stiffness,damping:xs.damping,mass:xs.mass,isResolvedFromDuration:!1,...n};if(!hq(n,MPe)&&hq(n,LPe))if(n.visualDuration){const i=n.visualDuration,a=2*Math.PI/(i*1.2),l=a*a,d=2*Gf(.05,1,1-(n.bounce||0))*Math.sqrt(l);t={...t,mass:xs.mass,stiffness:l,damping:d}}else{const i=NPe(n);t={...t,...i,mass:xs.mass},t.isResolvedFromDuration=!0}return t}function zee(n=xs.visualDuration,t=xs.bounce){const i=typeof n!="object"?{visualDuration:n,keyframes:[0,1],bounce:t}:n;let{restSpeed:a,restDelta:l}=i;const d=i.keyframes[0],f=i.keyframes[i.keyframes.length-1],_={done:!1,value:d},{stiffness:v,damping:b,mass:C,duration:I,velocity:O,isResolvedFromDuration:L}=UPe({...i,velocity:-Vf(i.velocity||0)}),M=O||0,F=b/(2*Math.sqrt(v*C)),z=f-d,Z=Vf(Math.sqrt(v/C)),K=Math.abs(z)<5;a||(a=K?xs.restSpeed.granular:xs.restSpeed.default),l||(l=K?xs.restDelta.granular:xs.restDelta.default);let re;if(F<1){const ne=zU(Z,F);re=pe=>{const X=Math.exp(-F*Z*pe);return f-X*((M+F*Z*z)/ne*Math.sin(ne*pe)+z*Math.cos(ne*pe))}}else if(F===1)re=ne=>f-Math.exp(-Z*ne)*(z+(M+Z*z)*ne);else{const ne=Z*Math.sqrt(F*F-1);re=pe=>{const X=Math.exp(-F*Z*pe),J=Math.min(ne*pe,300);return f-X*((M+F*Z*z)*Math.sinh(J)+ne*z*Math.cosh(J))/ne}}const ae={calculatedDuration:L&&I||null,next:ne=>{const pe=re(ne);if(L)_.done=ne>=I;else{let X=0;F<1&&(X=ne===0?Uf(M):Bee(re,ne,pe));const J=Math.abs(X)<=a,Q=Math.abs(f-pe)<=l;_.done=J&&Q}return _.value=_.done?f:pe,_},toString:()=>{const ne=Math.min(oee(ae),xU),pe=aee(X=>ae.next(ne*X).value,ne,30);return ne+"ms "+pe}};return ae}function pq({keyframes:n,velocity:t=0,power:i=.8,timeConstant:a=325,bounceDamping:l=10,bounceStiffness:d=500,modifyTarget:f,min:_,max:v,restDelta:b=.5,restSpeed:C}){const I=n[0],O={done:!1,value:I},L=J=>_!==void 0&&J<_||v!==void 0&&J>v,M=J=>_===void 0?v:v===void 0||Math.abs(_-J)<Math.abs(v-J)?_:v;let F=i*t;const z=I+F,Z=f===void 0?z:f(z);Z!==z&&(F=Z-I);const K=J=>-F*Math.exp(-J/a),re=J=>Z+K(J),ae=J=>{const Q=K(J),se=re(J);O.done=Math.abs(Q)<=b,O.value=O.done?Z:se};let ne,pe;const X=J=>{L(O.value)&&(ne=J,pe=zee({keyframes:[O.value,M(O.value)],velocity:Bee(re,J,O.value),damping:l,stiffness:d,restDelta:b,restSpeed:C}))};return X(0),{calculatedDuration:null,next:J=>{let Q=!1;return!pe&&ne===void 0&&(Q=!0,ae(J),X(J)),ne!==void 0&&J>=ne?pe.next(J-ne):(!Q&&ae(J),O)}}}const VPe=JC(.42,0,1,1),jPe=JC(0,0,.58,1),Wee=JC(.42,0,.58,1),FPe=n=>Array.isArray(n)&&typeof n[0]!="number",BPe={linear:Yl,easeIn:VPe,easeInOut:Wee,easeOut:jPe,circIn:Zj,circInOut:Tee,circOut:bee,backIn:Qj,backInOut:vee,backOut:Eee,anticipate:See},fq=n=>{if(Kj(n)){FZ(n.length===4);const[t,i,a,l]=n;return JC(t,i,a,l)}else if(typeof n=="string")return BPe[n];return n};function zPe(n,t,i){const a=[],l=i||Fee,d=n.length-1;for(let f=0;f<d;f++){let _=l(n[f],n[f+1]);if(t){const v=Array.isArray(t)?t[f]||Yl:t;_=QC(v,_)}a.push(_)}return a}function WPe(n,t,{clamp:i=!0,ease:a,mixer:l}={}){const d=n.length;if(FZ(d===t.length),d===1)return()=>t[0];if(d===2&&t[0]===t[1])return()=>t[1];const f=n[0]===n[1];n[0]>n[d-1]&&(n=[...n].reverse(),t=[...t].reverse());const _=zPe(t,a,l),v=_.length,b=C=>{if(f&&C<n[0])return t[0];let I=0;if(v>1)for(;I<n.length-2&&!(C<n[I+1]);I++);const O=m0(n[I],n[I+1],C);return _[I](O)};return i?C=>b(Gf(n[0],n[d-1],C)):b}function GPe(n,t){const i=n[n.length-1];for(let a=1;a<=t;a++){const l=m0(0,t,a);n.push(gs(i,1,l))}}function HPe(n){const t=[0];return GPe(t,n.length-1),t}function $Pe(n,t){return n.map(i=>i*t)}function KPe(n,t){return n.map(()=>t||Wee).splice(0,n.length-1)}function Ak({duration:n=300,keyframes:t,times:i,ease:a="easeInOut"}){const l=FPe(a)?a.map(fq):fq(a),d={done:!1,value:t[0]},f=$Pe(i&&i.length===t.length?i:HPe(t),n),_=WPe(f,t,{ease:Array.isArray(l)?l:KPe(t,l)});return{calculatedDuration:n,next:v=>(d.value=_(v),d.done=v>=n,d)}}const qPe=n=>{const t=({timestamp:i})=>n(i);return{start:()=>rs.update(t,!0),stop:()=>Og(t),now:()=>Ca.isProcessing?Ca.timestamp:up.now()}},YPe={decay:pq,inertia:pq,tween:Ak,keyframes:Ak,spring:zee},XPe=n=>n/100;class sF extends Vee{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:v}=this.options;v&&v()};const{name:i,motionValue:a,element:l,keyframes:d}=this.options,f=(l==null?void 0:l.KeyframeResolver)||rF,_=(v,b)=>this.onKeyframesResolved(v,b);this.resolver=new f(d,_,i,a,l),this.resolver.scheduleResolve()}flatten(){super.flatten(),this._resolved&&Object.assign(this._resolved,this.initPlayback(this._resolved.keyframes))}initPlayback(t){const{type:i="keyframes",repeat:a=0,repeatDelay:l=0,repeatType:d,velocity:f=0}=this.options,_=$j(i)?i:YPe[i]||Ak;let v,b;_!==Ak&&typeof t[0]!="number"&&(v=QC(XPe,Fee(t[0],t[1])),t=[0,100]);const C=_({...this.options,keyframes:t});d==="mirror"&&(b=_({...this.options,keyframes:[...t].reverse(),velocity:-f})),C.calculatedDuration===null&&(C.calculatedDuration=oee(C));const{calculatedDuration:I}=C,O=I+l,L=O*(a+1)-l;return{generator:C,mirroredGenerator:b,mapPercentToKeyframes:v,calculatedDuration:I,resolvedDuration:O,totalDuration:L}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,i=!1){const{resolved:a}=this;if(!a){const{keyframes:J}=this.options;return{done:!0,value:J[J.length-1]}}const{finalKeyframe:l,generator:d,mirroredGenerator:f,mapPercentToKeyframes:_,keyframes:v,calculatedDuration:b,totalDuration:C,resolvedDuration:I}=a;if(this.startTime===null)return d.next(0);const{delay:O,repeat:L,repeatType:M,repeatDelay:F,onUpdate:z}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-C/this.speed,this.startTime)),i?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const Z=this.currentTime-O*(this.speed>=0?1:-1),K=this.speed>=0?Z<0:Z>C;this.currentTime=Math.max(Z,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=C);let re=this.currentTime,ae=d;if(L){const J=Math.min(this.currentTime,C)/I;let Q=Math.floor(J),se=J%1;!se&&J>=1&&(se=1),se===1&&Q--,Q=Math.min(Q,L+1),!!(Q%2)&&(M==="reverse"?(se=1-se,F&&(se-=F/I)):M==="mirror"&&(ae=f)),re=Gf(0,1,se)*I}const ne=K?{done:!1,value:v[0]}:ae.next(re);_&&(ne.value=_(ne.value));let{done:pe}=ne;!K&&b!==null&&(pe=this.speed>=0?this.currentTime>=C:this.currentTime<=0);const X=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&pe);return X&&l!==void 0&&(ne.value=w1(v,this.options,l)),z&&z(ne.value),X&&this.finish(),ne}get duration(){const{resolved:t}=this;return t?Vf(t.calculatedDuration):0}get time(){return Vf(this.currentTime)}set time(t){t=Uf(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const i=this.playbackSpeed!==t;this.playbackSpeed=t,i&&(this.time=Vf(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=qPe,onPlay:i,startTime:a}=this.options;this.driver||(this.driver=t(d=>this.tick(d))),i&&i();const l=this.driver.now();this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=l):this.startTime=a??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const JPe=new Set(["opacity","clipPath","filter","transform"]);function QPe(n,t,i,{delay:a=0,duration:l=300,repeat:d=0,repeatType:f="loop",ease:_="easeInOut",times:v}={}){const b={[t]:i};v&&(b.offset=v);const C=lee(_,l);return Array.isArray(C)&&(b.easing=C),n.animate(b,{delay:a,duration:l,easing:Array.isArray(C)?"linear":C,fill:"both",iterations:d+1,direction:f==="reverse"?"alternate":"normal"})}const ZPe=kj(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),Pk=10,eOe=2e4;function tOe(n){return $j(n.type)||n.type==="spring"||!cee(n.ease)}function nOe(n,t){const i=new sF({...t,keyframes:n,repeat:0,delay:0,isGenerator:!0});let a={done:!1,value:n[0]};const l=[];let d=0;for(;!a.done&&d<eOe;)a=i.sample(d),l.push(a.value),d+=Pk;return{times:void 0,keyframes:l,duration:d-Pk,ease:"linear"}}const Gee={anticipate:See,backInOut:vee,circInOut:Tee};function rOe(n){return n in Gee}class mq extends Vee{constructor(t){super(t);const{name:i,motionValue:a,element:l,keyframes:d}=this.options;this.resolver=new Uee(d,(f,_)=>this.onKeyframesResolved(f,_),i,a,l),this.resolver.scheduleResolve()}initPlayback(t,i){let{duration:a=300,times:l,ease:d,type:f,motionValue:_,name:v,startTime:b}=this.options;if(!_.owner||!_.owner.current)return!1;if(typeof d=="string"&&Rk()&&rOe(d)&&(d=Gee[d]),tOe(this.options)){const{onComplete:I,onUpdate:O,motionValue:L,element:M,...F}=this.options,z=nOe(t,F);t=z.keyframes,t.length===1&&(t[1]=t[0]),a=z.duration,l=z.times,d=z.ease,f="keyframes"}const C=QPe(_.owner.current,v,t,{...this.options,duration:a,times:l,ease:d});return C.startTime=b??this.calcStartTime(),this.pendingTimeline?(QK(C,this.pendingTimeline),this.pendingTimeline=void 0):C.onfinish=()=>{const{onComplete:I}=this.options;_.set(w1(t,this.options,i)),I&&I(),this.cancel(),this.resolveFinishedPromise()},{animation:C,duration:a,times:l,type:f,ease:d,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:i}=t;return Vf(i)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:i}=t;return Vf(i.currentTime||0)}set time(t){const{resolved:i}=this;if(!i)return;const{animation:a}=i;a.currentTime=Uf(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:i}=t;return i.playbackRate}set speed(t){const{resolved:i}=this;if(!i)return;const{animation:a}=i;a.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:i}=t;return i.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:i}=t;return i.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:i}=this;if(!i)return Yl;const{animation:a}=i;QK(a,t)}return Yl}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:i}=t;i.playState==="finished"&&this.updateFinishedPromise(),i.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:i}=t;i.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:i,keyframes:a,duration:l,type:d,ease:f,times:_}=t;if(i.playState==="idle"||i.playState==="finished")return;if(this.time){const{motionValue:b,onUpdate:C,onComplete:I,element:O,...L}=this.options,M=new sF({...L,keyframes:a,duration:l,type:d,ease:f,times:_,isGenerator:!0}),F=Uf(this.time);b.setWithVelocity(M.sample(F-Pk).value,M.sample(F).value,Pk)}const{onStop:v}=this.options;v&&v(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:i,name:a,repeatDelay:l,repeatType:d,damping:f,type:_}=t;if(!i||!i.owner||!(i.owner.current instanceof HTMLElement))return!1;const{onUpdate:v,transformTemplate:b}=i.owner.getProps();return ZPe()&&a&&JPe.has(a)&&!v&&!b&&!l&&d!=="mirror"&&f!==0&&_!=="inertia"}}const iOe={type:"spring",stiffness:500,damping:25,restSpeed:10},sOe=n=>({type:"spring",stiffness:550,damping:n===0?2*Math.sqrt(550):30,restSpeed:10}),oOe={type:"keyframes",duration:.8},aOe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},cOe=(n,{keyframes:t})=>t.length>2?oOe:Qy.has(n)?n.startsWith("scale")?sOe(t[1]):iOe:aOe;function lOe({when:n,delay:t,delayChildren:i,staggerChildren:a,staggerDirection:l,repeat:d,repeatType:f,repeatDelay:_,from:v,elapsed:b,...C}){return!!Object.keys(C).length}const oF=(n,t,i,a={},l,d)=>f=>{const _=Hj(a,n)||{},v=_.delay||a.delay||0;let{elapsed:b=0}=a;b=b-Uf(v);let C={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:t.getVelocity(),..._,delay:-b,onUpdate:O=>{t.set(O),_.onUpdate&&_.onUpdate(O)},onComplete:()=>{f(),_.onComplete&&_.onComplete()},name:n,motionValue:t,element:d?void 0:l};lOe(_)||(C={...C,...cOe(n,C)}),C.duration&&(C.duration=Uf(C.duration)),C.repeatDelay&&(C.repeatDelay=Uf(C.repeatDelay)),C.from!==void 0&&(C.keyframes[0]=C.from);let I=!1;if((C.type===!1||C.duration===0&&!C.repeatDelay)&&(C.duration=0,C.delay===0&&(I=!0)),I&&!d&&t.get()!==void 0){const O=w1(C.keyframes,_);if(O!==void 0)return rs.update(()=>{C.onUpdate(O),C.onComplete()}),new AAe([])}return!d&&mq.supports(C)?new mq(C):new sF(C)};function uOe({protectedKeys:n,needsAnimating:t},i){const a=n.hasOwnProperty(i)&&t[i]!==!0;return t[i]=!1,a}function Hee(n,t,{delay:i=0,transitionOverride:a,type:l}={}){var d;let{transition:f=n.getDefaultTransition(),transitionEnd:_,...v}=t;a&&(f=a);const b=[],C=l&&n.animationState&&n.animationState.getState()[l];for(const I in v){const O=n.getValue(I,(d=n.latestValues[I])!==null&&d!==void 0?d:null),L=v[I];if(L===void 0||C&&uOe(C,I))continue;const M={delay:i,...Hj(f||{},I)};let F=!1;if(window.MotionHandoffAnimation){const Z=mee(n);if(Z){const K=window.MotionHandoffAnimation(Z,I,rs);K!==null&&(M.startTime=K,F=!0)}}MU(n,I),O.start(oF(I,O,L,n.shouldReduceMotion&&pee.has(I)?{type:!1}:M,n,F));const z=O.animation;z&&b.push(z)}return _&&Promise.all(b).then(()=>{rs.update(()=>{_&&zAe(n,_)})}),b}function WU(n,t,i={}){var a;const l=T1(n,t,i.type==="exit"?(a=n.presenceContext)===null||a===void 0?void 0:a.custom:void 0);let{transition:d=n.getDefaultTransition()||{}}=l||{};i.transitionOverride&&(d=i.transitionOverride);const f=l?()=>Promise.all(Hee(n,l,i)):()=>Promise.resolve(),_=n.variantChildren&&n.variantChildren.size?(b=0)=>{const{delayChildren:C=0,staggerChildren:I,staggerDirection:O}=d;return dOe(n,t,C+b,I,O,i)}:()=>Promise.resolve(),{when:v}=d;if(v){const[b,C]=v==="beforeChildren"?[f,_]:[_,f];return b().then(()=>C())}else return Promise.all([f(),_(i.delay)])}function dOe(n,t,i=0,a=0,l=1,d){const f=[],_=(n.variantChildren.size-1)*a,v=l===1?(b=0)=>b*a:(b=0)=>_-b*a;return Array.from(n.variantChildren).sort(hOe).forEach((b,C)=>{b.notify("AnimationStart",t),f.push(WU(b,t,{...d,delay:i+v(C)}).then(()=>b.notify("AnimationComplete",t)))}),Promise.all(f)}function hOe(n,t){return n.sortNodePosition(t)}function pOe(n,t,i={}){n.notify("AnimationStart",t);let a;if(Array.isArray(t)){const l=t.map(d=>WU(n,d,i));a=Promise.all(l)}else if(typeof t=="string")a=WU(n,t,i);else{const l=typeof t=="function"?T1(n,t,i.custom):t;a=Promise.all(Hee(n,l,i))}return a.then(()=>{n.notify("AnimationComplete",t)})}const fOe=Dj.length;function $ee(n){if(!n)return;if(!n.isControllingVariants){const i=n.parent?$ee(n.parent)||{}:{};return n.props.initial!==void 0&&(i.initial=n.props.initial),i}const t={};for(let i=0;i<fOe;i++){const a=Dj[i],l=n.props[a];(TC(l)||l===!1)&&(t[a]=l)}return t}const mOe=[...Nj].reverse(),gOe=Nj.length;function _Oe(n){return t=>Promise.all(t.map(({animation:i,options:a})=>pOe(n,i,a)))}function yOe(n){let t=_Oe(n),i=gq(),a=!0;const l=v=>(b,C)=>{var I;const O=T1(n,C,v==="exit"?(I=n.presenceContext)===null||I===void 0?void 0:I.custom:void 0);if(O){const{transition:L,transitionEnd:M,...F}=O;b={...b,...F,...M}}return b};function d(v){t=v(n)}function f(v){const{props:b}=n,C=$ee(n.parent)||{},I=[],O=new Set;let L={},M=1/0;for(let z=0;z<gOe;z++){const Z=mOe[z],K=i[Z],re=b[Z]!==void 0?b[Z]:C[Z],ae=TC(re),ne=Z===v?K.isActive:null;ne===!1&&(M=z);let pe=re===C[Z]&&re!==b[Z]&&ae;if(pe&&a&&n.manuallyAnimateOnMount&&(pe=!1),K.protectedKeys={...L},!K.isActive&&ne===null||!re&&!K.prevProp||S1(re)||typeof re=="boolean")continue;const X=EOe(K.prevProp,re);let J=X||Z===v&&K.isActive&&!pe&&ae||z>M&&ae,Q=!1;const se=Array.isArray(re)?re:[re];let de=se.reduce(l(Z),{});ne===!1&&(de={});const{prevResolvedValues:he={}}=K,le={...he,...de},Oe=Re=>{J=!0,O.has(Re)&&(Q=!0,O.delete(Re)),K.needsAnimating[Re]=!0;const ve=n.getValue(Re);ve&&(ve.liveStyle=!1)};for(const Re in le){const ve=de[Re],be=he[Re];if(L.hasOwnProperty(Re))continue;let ze=!1;DU(ve)&&DU(be)?ze=!see(ve,be):ze=ve!==be,ze?ve!=null?Oe(Re):O.add(Re):ve!==void 0&&O.has(Re)?Oe(Re):K.protectedKeys[Re]=!0}K.prevProp=re,K.prevResolvedValues=de,K.isActive&&(L={...L,...de}),a&&n.blockInitialAnimation&&(J=!1),J&&(!(pe&&X)||Q)&&I.push(...se.map(Re=>({animation:Re,options:{type:Z}})))}if(O.size){const z={};O.forEach(Z=>{const K=n.getBaseTarget(Z),re=n.getValue(Z);re&&(re.liveStyle=!0),z[Z]=K??null}),I.push({animation:z})}let F=!!I.length;return a&&(b.initial===!1||b.initial===b.animate)&&!n.manuallyAnimateOnMount&&(F=!1),a=!1,F?t(I):Promise.resolve()}function _(v,b){var C;if(i[v].isActive===b)return Promise.resolve();(C=n.variantChildren)===null||C===void 0||C.forEach(O=>{var L;return(L=O.animationState)===null||L===void 0?void 0:L.setActive(v,b)}),i[v].isActive=b;const I=f(v);for(const O in i)i[O].protectedKeys={};return I}return{animateChanges:f,setActive:_,setAnimateFunction:d,getState:()=>i,reset:()=>{i=gq(),a=!0}}}function EOe(n,t){return typeof t=="string"?t!==n:Array.isArray(t)?!see(t,n):!1}function fy(n=!1){return{isActive:n,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function gq(){return{animate:fy(!0),whileInView:fy(),whileHover:fy(),whileTap:fy(),whileDrag:fy(),whileFocus:fy(),exit:fy()}}class Bg{constructor(t){this.isMounted=!1,this.node=t}update(){}}class vOe extends Bg{constructor(t){super(t),t.animationState||(t.animationState=yOe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();S1(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:i}=this.node.prevProps||{};t!==i&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let SOe=0;class bOe extends Bg{constructor(){super(...arguments),this.id=SOe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:i}=this.node.presenceContext,{isPresent:a}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===a)return;const l=this.node.animationState.setActive("exit",!t);i&&!t&&l.then(()=>i(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const TOe={animation:{Feature:vOe},exit:{Feature:bOe}};function IC(n,t,i,a={passive:!0}){return n.addEventListener(t,i,a),()=>n.removeEventListener(t,i)}function ZC(n){return{point:{x:n.pageX,y:n.pageY}}}const wOe=n=>t=>qj(t)&&n(t,ZC(t));function rC(n,t,i,a){return IC(n,t,wOe(i),a)}const _q=(n,t)=>Math.abs(n-t);function COe(n,t){const i=_q(n.x,t.x),a=_q(n.y,t.y);return Math.sqrt(i**2+a**2)}class Kee{constructor(t,i,{transformPagePoint:a,contextWindow:l,dragSnapToOrigin:d=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const I=RM(this.lastMoveEventInfo,this.history),O=this.startEvent!==null,L=COe(I.offset,{x:0,y:0})>=3;if(!O&&!L)return;const{point:M}=I,{timestamp:F}=Ca;this.history.push({...M,timestamp:F});const{onStart:z,onMove:Z}=this.handlers;O||(z&&z(this.lastMoveEvent,I),this.startEvent=this.lastMoveEvent),Z&&Z(this.lastMoveEvent,I)},this.handlePointerMove=(I,O)=>{this.lastMoveEvent=I,this.lastMoveEventInfo=CM(O,this.transformPagePoint),rs.update(this.updatePoint,!0)},this.handlePointerUp=(I,O)=>{this.end();const{onEnd:L,onSessionEnd:M,resumeAnimation:F}=this.handlers;if(this.dragSnapToOrigin&&F&&F(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const z=RM(I.type==="pointercancel"?this.lastMoveEventInfo:CM(O,this.transformPagePoint),this.history);this.startEvent&&L&&L(I,z),M&&M(I,z)},!qj(t))return;this.dragSnapToOrigin=d,this.handlers=i,this.transformPagePoint=a,this.contextWindow=l||window;const f=ZC(t),_=CM(f,this.transformPagePoint),{point:v}=_,{timestamp:b}=Ca;this.history=[{...v,timestamp:b}];const{onSessionStart:C}=i;C&&C(t,RM(_,this.history)),this.removeListeners=QC(rC(this.contextWindow,"pointermove",this.handlePointerMove),rC(this.contextWindow,"pointerup",this.handlePointerUp),rC(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),Og(this.updatePoint)}}function CM(n,t){return t?{point:t(n.point)}:n}function yq(n,t){return{x:n.x-t.x,y:n.y-t.y}}function RM({point:n},t){return{point:n,delta:yq(n,qee(t)),offset:yq(n,ROe(t)),velocity:IOe(t,.1)}}function ROe(n){return n[0]}function qee(n){return n[n.length-1]}function IOe(n,t){if(n.length<2)return{x:0,y:0};let i=n.length-1,a=null;const l=qee(n);for(;i>=0&&(a=n[i],!(l.timestamp-a.timestamp>Uf(t)));)i--;if(!a)return{x:0,y:0};const d=Vf(l.timestamp-a.timestamp);if(d===0)return{x:0,y:0};const f={x:(l.x-a.x)/d,y:(l.y-a.y)/d};return f.x===1/0&&(f.x=0),f.y===1/0&&(f.y=0),f}const Yee=1e-4,AOe=1-Yee,POe=1+Yee,Xee=.01,OOe=0-Xee,kOe=0+Xee;function Xl(n){return n.max-n.min}function NOe(n,t,i){return Math.abs(n-t)<=i}function Eq(n,t,i,a=.5){n.origin=a,n.originPoint=gs(t.min,t.max,n.origin),n.scale=Xl(i)/Xl(t),n.translate=gs(i.min,i.max,n.origin)-n.originPoint,(n.scale>=AOe&&n.scale<=POe||isNaN(n.scale))&&(n.scale=1),(n.translate>=OOe&&n.translate<=kOe||isNaN(n.translate))&&(n.translate=0)}function iC(n,t,i,a){Eq(n.x,t.x,i.x,a?a.originX:void 0),Eq(n.y,t.y,i.y,a?a.originY:void 0)}function vq(n,t,i){n.min=i.min+t.min,n.max=n.min+Xl(t)}function DOe(n,t,i){vq(n.x,t.x,i.x),vq(n.y,t.y,i.y)}function Sq(n,t,i){n.min=t.min-i.min,n.max=n.min+Xl(t)}function sC(n,t,i){Sq(n.x,t.x,i.x),Sq(n.y,t.y,i.y)}function xOe(n,{min:t,max:i},a){return t!==void 0&&n<t?n=a?gs(t,n,a.min):Math.max(n,t):i!==void 0&&n>i&&(n=a?gs(i,n,a.max):Math.min(n,i)),n}function bq(n,t,i){return{min:t!==void 0?n.min+t:void 0,max:i!==void 0?n.max+i-(n.max-n.min):void 0}}function LOe(n,{top:t,left:i,bottom:a,right:l}){return{x:bq(n.x,i,l),y:bq(n.y,t,a)}}function Tq(n,t){let i=t.min-n.min,a=t.max-n.max;return t.max-t.min<n.max-n.min&&([i,a]=[a,i]),{min:i,max:a}}function MOe(n,t){return{x:Tq(n.x,t.x),y:Tq(n.y,t.y)}}function UOe(n,t){let i=.5;const a=Xl(n),l=Xl(t);return l>a?i=m0(t.min,t.max-a,n.min):a>l&&(i=m0(n.min,n.max-l,t.min)),Gf(0,1,i)}function VOe(n,t){const i={};return t.min!==void 0&&(i.min=t.min-n.min),t.max!==void 0&&(i.max=t.max-n.min),i}const GU=.35;function jOe(n=GU){return n===!1?n=0:n===!0&&(n=GU),{x:wq(n,"left","right"),y:wq(n,"top","bottom")}}function wq(n,t,i){return{min:Cq(n,t),max:Cq(n,i)}}function Cq(n,t){return typeof n=="number"?n:n[t]||0}const Rq=()=>({translate:0,scale:1,origin:0,originPoint:0}),zS=()=>({x:Rq(),y:Rq()}),Iq=()=>({min:0,max:0}),Zs=()=>({x:Iq(),y:Iq()});function Fu(n){return[n("x"),n("y")]}function Jee({top:n,left:t,right:i,bottom:a}){return{x:{min:t,max:i},y:{min:n,max:a}}}function FOe({x:n,y:t}){return{top:t.min,right:n.max,bottom:t.max,left:n.min}}function BOe(n,t){if(!t)return n;const i=t({x:n.left,y:n.top}),a=t({x:n.right,y:n.bottom});return{top:i.y,left:i.x,bottom:a.y,right:a.x}}function IM(n){return n===void 0||n===1}function HU({scale:n,scaleX:t,scaleY:i}){return!IM(n)||!IM(t)||!IM(i)}function gy(n){return HU(n)||Qee(n)||n.z||n.rotate||n.rotateX||n.rotateY||n.skewX||n.skewY}function Qee(n){return Aq(n.x)||Aq(n.y)}function Aq(n){return n&&n!=="0%"}function Ok(n,t,i){const a=n-i,l=t*a;return i+l}function Pq(n,t,i,a,l){return l!==void 0&&(n=Ok(n,l,a)),Ok(n,i,a)+t}function $U(n,t=0,i=1,a,l){n.min=Pq(n.min,t,i,a,l),n.max=Pq(n.max,t,i,a,l)}function Zee(n,{x:t,y:i}){$U(n.x,t.translate,t.scale,t.originPoint),$U(n.y,i.translate,i.scale,i.originPoint)}const Oq=.999999999999,kq=1.0000000000001;function zOe(n,t,i,a=!1){const l=i.length;if(!l)return;t.x=t.y=1;let d,f;for(let _=0;_<l;_++){d=i[_],f=d.projectionDelta;const{visualElement:v}=d.options;v&&v.props.style&&v.props.style.display==="contents"||(a&&d.options.layoutScroll&&d.scroll&&d!==d.root&&GS(n,{x:-d.scroll.offset.x,y:-d.scroll.offset.y}),f&&(t.x*=f.x.scale,t.y*=f.y.scale,Zee(n,f)),a&&gy(d.latestValues)&&GS(n,d.latestValues))}t.x<kq&&t.x>Oq&&(t.x=1),t.y<kq&&t.y>Oq&&(t.y=1)}function WS(n,t){n.min=n.min+t,n.max=n.max+t}function Nq(n,t,i,a,l=.5){const d=gs(n.min,n.max,l);$U(n,t,i,d,a)}function GS(n,t){Nq(n.x,t.x,t.scaleX,t.scale,t.originX),Nq(n.y,t.y,t.scaleY,t.scale,t.originY)}function ete(n,t){return Jee(BOe(n.getBoundingClientRect(),t))}function WOe(n,t,i){const a=ete(n,i),{scroll:l}=t;return l&&(WS(a.x,l.offset.x),WS(a.y,l.offset.y)),a}const tte=({current:n})=>n?n.ownerDocument.defaultView:null,GOe=new WeakMap;class HOe{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Zs(),this.visualElement=t}start(t,{snapToCursor:i=!1}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const l=C=>{const{dragSnapToOrigin:I}=this.getProps();I?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(ZC(C).point)},d=(C,I)=>{const{drag:O,dragPropagation:L,onDragStart:M}=this.getProps();if(O&&!L&&(this.openDragLock&&this.openDragLock(),this.openDragLock=UAe(O),!this.openDragLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Fu(z=>{let Z=this.getAxisMotionValue(z).get()||0;if(lp.test(Z)){const{projection:K}=this.visualElement;if(K&&K.layout){const re=K.layout.layoutBox[z];re&&(Z=Xl(re)*(parseFloat(Z)/100))}}this.originPoint[z]=Z}),M&&rs.postRender(()=>M(C,I)),MU(this.visualElement,"transform");const{animationState:F}=this.visualElement;F&&F.setActive("whileDrag",!0)},f=(C,I)=>{const{dragPropagation:O,dragDirectionLock:L,onDirectionLock:M,onDrag:F}=this.getProps();if(!O&&!this.openDragLock)return;const{offset:z}=I;if(L&&this.currentDirection===null){this.currentDirection=$Oe(z),this.currentDirection!==null&&M&&M(this.currentDirection);return}this.updateAxis("x",I.point,z),this.updateAxis("y",I.point,z),this.visualElement.render(),F&&F(C,I)},_=(C,I)=>this.stop(C,I),v=()=>Fu(C=>{var I;return this.getAnimationState(C)==="paused"&&((I=this.getAxisMotionValue(C).animation)===null||I===void 0?void 0:I.play())}),{dragSnapToOrigin:b}=this.getProps();this.panSession=new Kee(t,{onSessionStart:l,onStart:d,onMove:f,onSessionEnd:_,resumeAnimation:v},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:b,contextWindow:tte(this.visualElement)})}stop(t,i){const a=this.isDragging;if(this.cancel(),!a)return;const{velocity:l}=i;this.startAnimation(l);const{onDragEnd:d}=this.getProps();d&&rs.postRender(()=>d(t,i))}cancel(){this.isDragging=!1;const{projection:t,animationState:i}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:a}=this.getProps();!a&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(t,i,a){const{drag:l}=this.getProps();if(!a||!yO(t,l,this.currentDirection))return;const d=this.getAxisMotionValue(t);let f=this.originPoint[t]+a[t];this.constraints&&this.constraints[t]&&(f=xOe(f,this.constraints[t],this.elastic[t])),d.set(f)}resolveConstraints(){var t;const{dragConstraints:i,dragElastic:a}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,d=this.constraints;i&&FS(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&l?this.constraints=LOe(l.layoutBox,i):this.constraints=!1,this.elastic=jOe(a),d!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&Fu(f=>{this.constraints!==!1&&this.getAxisMotionValue(f)&&(this.constraints[f]=VOe(l.layoutBox[f],this.constraints[f]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:i}=this.getProps();if(!t||!FS(t))return!1;const a=t.current,{projection:l}=this.visualElement;if(!l||!l.layout)return!1;const d=WOe(a,l.root,this.visualElement.getTransformPagePoint());let f=MOe(l.layout.layoutBox,d);if(i){const _=i(FOe(f));this.hasMutatedConstraints=!!_,_&&(f=Jee(_))}return f}startAnimation(t){const{drag:i,dragMomentum:a,dragElastic:l,dragTransition:d,dragSnapToOrigin:f,onDragTransitionEnd:_}=this.getProps(),v=this.constraints||{},b=Fu(C=>{if(!yO(C,i,this.currentDirection))return;let I=v&&v[C]||{};f&&(I={min:0,max:0});const O=l?200:1e6,L=l?40:1e7,M={type:"inertia",velocity:a?t[C]:0,bounceStiffness:O,bounceDamping:L,timeConstant:750,restDelta:1,restSpeed:10,...d,...I};return this.startAxisValueAnimation(C,M)});return Promise.all(b).then(_)}startAxisValueAnimation(t,i){const a=this.getAxisMotionValue(t);return MU(this.visualElement,t),a.start(oF(t,a,0,i,this.visualElement,!1))}stopAnimation(){Fu(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Fu(t=>{var i;return(i=this.getAxisMotionValue(t).animation)===null||i===void 0?void 0:i.pause()})}getAnimationState(t){var i;return(i=this.getAxisMotionValue(t).animation)===null||i===void 0?void 0:i.state}getAxisMotionValue(t){const i=`_drag${t.toUpperCase()}`,a=this.visualElement.getProps(),l=a[i];return l||this.visualElement.getValue(t,(a.initial?a.initial[t]:void 0)||0)}snapToCursor(t){Fu(i=>{const{drag:a}=this.getProps();if(!yO(i,a,this.currentDirection))return;const{projection:l}=this.visualElement,d=this.getAxisMotionValue(i);if(l&&l.layout){const{min:f,max:_}=l.layout.layoutBox[i];d.set(t[i]-gs(f,_,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:i}=this.getProps(),{projection:a}=this.visualElement;if(!FS(i)||!a||!this.constraints)return;this.stopAnimation();const l={x:0,y:0};Fu(f=>{const _=this.getAxisMotionValue(f);if(_&&this.constraints!==!1){const v=_.get();l[f]=UOe({min:v,max:v},this.constraints[f])}});const{transformTemplate:d}=this.visualElement.getProps();this.visualElement.current.style.transform=d?d({},""):"none",a.root&&a.root.updateScroll(),a.updateLayout(),this.resolveConstraints(),Fu(f=>{if(!yO(f,t,null))return;const _=this.getAxisMotionValue(f),{min:v,max:b}=this.constraints[f];_.set(gs(v,b,l[f]))})}addListeners(){if(!this.visualElement.current)return;GOe.set(this.visualElement,this);const t=this.visualElement.current,i=rC(t,"pointerdown",v=>{const{drag:b,dragListener:C=!0}=this.getProps();b&&C&&this.start(v)}),a=()=>{const{dragConstraints:v}=this.getProps();FS(v)&&v.current&&(this.constraints=this.resolveRefConstraints())},{projection:l}=this.visualElement,d=l.addEventListener("measure",a);l&&!l.layout&&(l.root&&l.root.updateScroll(),l.updateLayout()),rs.read(a);const f=IC(window,"resize",()=>this.scalePositionWithinConstraints()),_=l.addEventListener("didUpdate",({delta:v,hasLayoutChanged:b})=>{this.isDragging&&b&&(Fu(C=>{const I=this.getAxisMotionValue(C);I&&(this.originPoint[C]+=v[C].translate,I.set(I.get()+v[C].translate))}),this.visualElement.render())});return()=>{f(),i(),d(),_&&_()}}getProps(){const t=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:a=!1,dragPropagation:l=!1,dragConstraints:d=!1,dragElastic:f=GU,dragMomentum:_=!0}=t;return{...t,drag:i,dragDirectionLock:a,dragPropagation:l,dragConstraints:d,dragElastic:f,dragMomentum:_}}}function yO(n,t,i){return(t===!0||t===n)&&(i===null||i===n)}function $Oe(n,t=10){let i=null;return Math.abs(n.y)>t?i="y":Math.abs(n.x)>t&&(i="x"),i}class KOe extends Bg{constructor(t){super(t),this.removeGroupControls=Yl,this.removeListeners=Yl,this.controls=new HOe(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Yl}unmount(){this.removeGroupControls(),this.removeListeners()}}const Dq=n=>(t,i)=>{n&&rs.postRender(()=>n(t,i))};class qOe extends Bg{constructor(){super(...arguments),this.removePointerDownListener=Yl}onPointerDown(t){this.session=new Kee(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:tte(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:i,onPan:a,onPanEnd:l}=this.node.getProps();return{onSessionStart:Dq(t),onStart:Dq(i),onMove:a,onEnd:(d,f)=>{delete this.session,l&&rs.postRender(()=>l(d,f))}}}mount(){this.removePointerDownListener=rC(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const ZO={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function xq(n,t){return t.max===t.min?0:n/(t.max-t.min)*100}const mw={correct:(n,t)=>{if(!t.target)return n;if(typeof n=="string")if(Bn.test(n))n=parseFloat(n);else return n;const i=xq(n,t.target.x),a=xq(n,t.target.y);return`${i}% ${a}%`}},YOe={correct:(n,{treeScale:t,projectionDelta:i})=>{const a=n,l=kg.parse(n);if(l.length>5)return a;const d=kg.createTransformer(n),f=typeof l[0]!="number"?1:0,_=i.x.scale*t.x,v=i.y.scale*t.y;l[0+f]/=_,l[1+f]/=v;const b=gs(_,v,.5);return typeof l[2+f]=="number"&&(l[2+f]/=b),typeof l[3+f]=="number"&&(l[3+f]/=b),d(l)}};class XOe extends N.Component{componentDidMount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:a,layoutId:l}=this.props,{projection:d}=t;gAe(JOe),d&&(i.group&&i.group.add(d),a&&a.register&&l&&a.register(d),d.root.didUpdate(),d.addEventListener("animationComplete",()=>{this.safeToRemove()}),d.setOptions({...d.options,onExitComplete:()=>this.safeToRemove()})),ZO.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:i,visualElement:a,drag:l,isPresent:d}=this.props,f=a.projection;return f&&(f.isPresent=d,l||t.layoutDependency!==i||i===void 0?f.willUpdate():this.safeToRemove(),t.isPresent!==d&&(d?f.promote():f.relegate()||rs.postRender(()=>{const _=f.getStack();(!_||!_.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),Lj.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:i,switchLayoutGroup:a}=this.props,{projection:l}=t;l&&(l.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(l),a&&a.deregister&&a.deregister(l))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function nte(n){const[t,i]=Pj(),a=N.useContext(Rj);return T.jsx(XOe,{...n,layoutGroup:a,switchLayoutGroup:N.useContext($Z),isPresent:t,safeToRemove:i})}const JOe={borderRadius:{...mw,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:mw,borderTopRightRadius:mw,borderBottomLeftRadius:mw,borderBottomRightRadius:mw,boxShadow:YOe};function QOe(n,t,i){const a=sc(n)?n:CC(n);return a.start(oF("",a,t,i)),a.animation}function ZOe(n){return n instanceof SVGElement&&n.tagName!=="svg"}const eke=(n,t)=>n.depth-t.depth;class tke{constructor(){this.children=[],this.isDirty=!1}add(t){Yj(this.children,t),this.isDirty=!0}remove(t){Xj(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(eke),this.isDirty=!1,this.children.forEach(t)}}function nke(n,t){const i=up.now(),a=({timestamp:l})=>{const d=l-i;d>=t&&(Og(a),n(d-t))};return rs.read(a,!0),()=>Og(a)}const rte=["TopLeft","TopRight","BottomLeft","BottomRight"],rke=rte.length,Lq=n=>typeof n=="string"?parseFloat(n):n,Mq=n=>typeof n=="number"||Bn.test(n);function ike(n,t,i,a,l,d){l?(n.opacity=gs(0,i.opacity!==void 0?i.opacity:1,ske(a)),n.opacityExit=gs(t.opacity!==void 0?t.opacity:1,0,oke(a))):d&&(n.opacity=gs(t.opacity!==void 0?t.opacity:1,i.opacity!==void 0?i.opacity:1,a));for(let f=0;f<rke;f++){const _=`border${rte[f]}Radius`;let v=Uq(t,_),b=Uq(i,_);if(v===void 0&&b===void 0)continue;v||(v=0),b||(b=0),v===0||b===0||Mq(v)===Mq(b)?(n[_]=Math.max(gs(Lq(v),Lq(b),a),0),(lp.test(b)||lp.test(v))&&(n[_]+="%")):n[_]=b}(t.rotate||i.rotate)&&(n.rotate=gs(t.rotate||0,i.rotate||0,a))}function Uq(n,t){return n[t]!==void 0?n[t]:n.borderRadius}const ske=ite(0,.5,bee),oke=ite(.5,.95,Yl);function ite(n,t,i){return a=>a<n?0:a>t?1:i(m0(n,t,a))}function Vq(n,t){n.min=t.min,n.max=t.max}function Uu(n,t){Vq(n.x,t.x),Vq(n.y,t.y)}function jq(n,t){n.translate=t.translate,n.scale=t.scale,n.originPoint=t.originPoint,n.origin=t.origin}function Fq(n,t,i,a,l){return n-=t,n=Ok(n,1/i,a),l!==void 0&&(n=Ok(n,1/l,a)),n}function ake(n,t=0,i=1,a=.5,l,d=n,f=n){if(lp.test(t)&&(t=parseFloat(t),t=gs(f.min,f.max,t/100)-f.min),typeof t!="number")return;let _=gs(d.min,d.max,a);n===d&&(_-=t),n.min=Fq(n.min,t,i,_,l),n.max=Fq(n.max,t,i,_,l)}function Bq(n,t,[i,a,l],d,f){ake(n,t[i],t[a],t[l],t.scale,d,f)}const cke=["x","scaleX","originX"],lke=["y","scaleY","originY"];function zq(n,t,i,a){Bq(n.x,t,cke,i?i.x:void 0,a?a.x:void 0),Bq(n.y,t,lke,i?i.y:void 0,a?a.y:void 0)}function Wq(n){return n.translate===0&&n.scale===1}function ste(n){return Wq(n.x)&&Wq(n.y)}function Gq(n,t){return n.min===t.min&&n.max===t.max}function uke(n,t){return Gq(n.x,t.x)&&Gq(n.y,t.y)}function Hq(n,t){return Math.round(n.min)===Math.round(t.min)&&Math.round(n.max)===Math.round(t.max)}function ote(n,t){return Hq(n.x,t.x)&&Hq(n.y,t.y)}function $q(n){return Xl(n.x)/Xl(n.y)}function Kq(n,t){return n.translate===t.translate&&n.scale===t.scale&&n.originPoint===t.originPoint}class dke{constructor(){this.members=[]}add(t){Yj(this.members,t),t.scheduleRender()}remove(t){if(Xj(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(t){const i=this.members.findIndex(l=>t===l);if(i===0)return!1;let a;for(let l=i;l>=0;l--){const d=this.members[l];if(d.isPresent!==!1){a=d;break}}return a?(this.promote(a),!0):!1}promote(t,i){const a=this.lead;if(t!==a&&(this.prevLead=a,this.lead=t,t.show(),a)){a.instance&&a.scheduleRender(),t.scheduleRender(),t.resumeFrom=a,i&&(t.resumeFrom.preserveOpacity=!0),a.snapshot&&(t.snapshot=a.snapshot,t.snapshot.latestValues=a.animationValues||a.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:l}=t.options;l===!1&&a.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:i,resumingFrom:a}=t;i.onExitComplete&&i.onExitComplete(),a&&a.options.onExitComplete&&a.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function hke(n,t,i){let a="";const l=n.x.translate/t.x,d=n.y.translate/t.y,f=(i==null?void 0:i.z)||0;if((l||d||f)&&(a=`translate3d(${l}px, ${d}px, ${f}px) `),(t.x!==1||t.y!==1)&&(a+=`scale(${1/t.x}, ${1/t.y}) `),i){const{transformPerspective:b,rotate:C,rotateX:I,rotateY:O,skewX:L,skewY:M}=i;b&&(a=`perspective(${b}px) ${a}`),C&&(a+=`rotate(${C}deg) `),I&&(a+=`rotateX(${I}deg) `),O&&(a+=`rotateY(${O}deg) `),L&&(a+=`skewX(${L}deg) `),M&&(a+=`skewY(${M}deg) `)}const _=n.x.scale*t.x,v=n.y.scale*t.y;return(_!==1||v!==1)&&(a+=`scale(${_}, ${v})`),a||"none"}const _y={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Vw=typeof window<"u"&&window.MotionDebug!==void 0,AM=["","X","Y","Z"],pke={visibility:"hidden"},qq=1e3;let fke=0;function PM(n,t,i,a){const{latestValues:l}=t;l[n]&&(i[n]=l[n],t.setStaticValue(n,0),a&&(a[n]=0))}function ate(n){if(n.hasCheckedOptimisedAppear=!0,n.root===n)return;const{visualElement:t}=n.options;if(!t)return;const i=mee(t);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:l,layoutId:d}=n.options;window.MotionCancelOptimisedAnimation(i,"transform",rs,!(l||d))}const{parent:a}=n;a&&!a.hasCheckedOptimisedAppear&&ate(a)}function cte({attachResizeListener:n,defaultParent:t,measureScroll:i,checkIsScrollRoot:a,resetTransform:l}){return class{constructor(f={},_=t==null?void 0:t()){this.id=fke++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Vw&&(_y.totalNodes=_y.resolvedTargetDeltas=_y.recalculatedProjection=0),this.nodes.forEach(_ke),this.nodes.forEach(bke),this.nodes.forEach(Tke),this.nodes.forEach(yke),Vw&&window.MotionDebug.record(_y)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=f,this.root=_?_.root||_:this,this.path=_?[..._.path,_]:[],this.parent=_,this.depth=_?_.depth+1:0;for(let v=0;v<this.path.length;v++)this.path[v].shouldResetTransform=!0;this.root===this&&(this.nodes=new tke)}addEventListener(f,_){return this.eventHandlers.has(f)||this.eventHandlers.set(f,new Jj),this.eventHandlers.get(f).add(_)}notifyListeners(f,..._){const v=this.eventHandlers.get(f);v&&v.notify(..._)}hasListeners(f){return this.eventHandlers.has(f)}mount(f,_=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=ZOe(f),this.instance=f;const{layoutId:v,layout:b,visualElement:C}=this.options;if(C&&!C.current&&C.mount(f),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),_&&(b||v)&&(this.isLayoutDirty=!0),n){let I;const O=()=>this.root.updateBlockedByResize=!1;n(f,()=>{this.root.updateBlockedByResize=!0,I&&I(),I=nke(O,250),ZO.hasAnimatedSinceResize&&(ZO.hasAnimatedSinceResize=!1,this.nodes.forEach(Xq))})}v&&this.root.registerSharedNode(v,this),this.options.animate!==!1&&C&&(v||b)&&this.addEventListener("didUpdate",({delta:I,hasLayoutChanged:O,hasRelativeTargetChanged:L,layout:M})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const F=this.options.transition||C.getDefaultTransition()||Ake,{onLayoutAnimationStart:z,onLayoutAnimationComplete:Z}=C.getProps(),K=!this.targetLayout||!ote(this.targetLayout,M)||L,re=!O&&L;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||re||O&&(K||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(I,re);const ae={...Hj(F,"layout"),onPlay:z,onComplete:Z};(C.shouldReduceMotion||this.options.layoutRoot)&&(ae.delay=0,ae.type=!1),this.startAnimation(ae)}else O||Xq(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=M})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const f=this.getStack();f&&f.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,Og(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(wke),this.animationId++)}getTransformTemplate(){const{visualElement:f}=this.options;return f&&f.getProps().transformTemplate}willUpdate(f=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&ate(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let C=0;C<this.path.length;C++){const I=this.path[C];I.shouldResetTransform=!0,I.updateScroll("snapshot"),I.options.layoutRoot&&I.willUpdate(!1)}const{layoutId:_,layout:v}=this.options;if(_===void 0&&!v)return;const b=this.getTransformTemplate();this.prevTransformTemplateValue=b?b(this.latestValues,""):void 0,this.updateSnapshot(),f&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Yq);return}this.isUpdating||this.nodes.forEach(vke),this.isUpdating=!1,this.nodes.forEach(Ske),this.nodes.forEach(mke),this.nodes.forEach(gke),this.clearAllSnapshots();const _=up.now();Ca.delta=Gf(0,1e3/60,_-Ca.timestamp),Ca.timestamp=_,Ca.isProcessing=!0,vM.update.process(Ca),vM.preRender.process(Ca),vM.render.process(Ca),Ca.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Lj.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Eke),this.sharedNodes.forEach(Cke)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,rs.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){rs.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let v=0;v<this.path.length;v++)this.path[v].updateScroll();const f=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Zs(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:_}=this.options;_&&_.notify("LayoutMeasure",this.layout.layoutBox,f?f.layoutBox:void 0)}updateScroll(f="measure"){let _=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===f&&(_=!1),_){const v=a(this.instance);this.scroll={animationId:this.root.animationId,phase:f,isRoot:v,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:v}}}resetTransform(){if(!l)return;const f=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,_=this.projectionDelta&&!ste(this.projectionDelta),v=this.getTransformTemplate(),b=v?v(this.latestValues,""):void 0,C=b!==this.prevTransformTemplateValue;f&&(_||gy(this.latestValues)||C)&&(l(this.instance,b),this.shouldResetTransform=!1,this.scheduleRender())}measure(f=!0){const _=this.measurePageBox();let v=this.removeElementScroll(_);return f&&(v=this.removeTransform(v)),Pke(v),{animationId:this.root.animationId,measuredBox:_,layoutBox:v,latestValues:{},source:this.id}}measurePageBox(){var f;const{visualElement:_}=this.options;if(!_)return Zs();const v=_.measureViewportBox();if(!(((f=this.scroll)===null||f===void 0?void 0:f.wasRoot)||this.path.some(Oke))){const{scroll:C}=this.root;C&&(WS(v.x,C.offset.x),WS(v.y,C.offset.y))}return v}removeElementScroll(f){var _;const v=Zs();if(Uu(v,f),!((_=this.scroll)===null||_===void 0)&&_.wasRoot)return v;for(let b=0;b<this.path.length;b++){const C=this.path[b],{scroll:I,options:O}=C;C!==this.root&&I&&O.layoutScroll&&(I.wasRoot&&Uu(v,f),WS(v.x,I.offset.x),WS(v.y,I.offset.y))}return v}applyTransform(f,_=!1){const v=Zs();Uu(v,f);for(let b=0;b<this.path.length;b++){const C=this.path[b];!_&&C.options.layoutScroll&&C.scroll&&C!==C.root&&GS(v,{x:-C.scroll.offset.x,y:-C.scroll.offset.y}),gy(C.latestValues)&&GS(v,C.latestValues)}return gy(this.latestValues)&&GS(v,this.latestValues),v}removeTransform(f){const _=Zs();Uu(_,f);for(let v=0;v<this.path.length;v++){const b=this.path[v];if(!b.instance||!gy(b.latestValues))continue;HU(b.latestValues)&&b.updateSnapshot();const C=Zs(),I=b.measurePageBox();Uu(C,I),zq(_,b.latestValues,b.snapshot?b.snapshot.layoutBox:void 0,C)}return gy(this.latestValues)&&zq(_,this.latestValues),_}setTargetDelta(f){this.targetDelta=f,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(f){this.options={...this.options,...f,crossfade:f.crossfade!==void 0?f.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ca.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(f=!1){var _;const v=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=v.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=v.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=v.isSharedProjectionDirty);const b=!!this.resumingFrom||this!==v;if(!(f||b&&this.isSharedProjectionDirty||this.isProjectionDirty||!((_=this.parent)===null||_===void 0)&&_.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:I,layoutId:O}=this.options;if(!(!this.layout||!(I||O))){if(this.resolvedRelativeTargetAt=Ca.timestamp,!this.targetDelta&&!this.relativeTarget){const L=this.getClosestProjectingParent();L&&L.layout&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Zs(),this.relativeTargetOrigin=Zs(),sC(this.relativeTargetOrigin,this.layout.layoutBox,L.layout.layoutBox),Uu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=Zs(),this.targetWithTransforms=Zs()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),DOe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Uu(this.target,this.layout.layoutBox),Zee(this.target,this.targetDelta)):Uu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const L=this.getClosestProjectingParent();L&&!!L.resumingFrom==!!this.resumingFrom&&!L.options.layoutScroll&&L.target&&this.animationProgress!==1?(this.relativeParent=L,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Zs(),this.relativeTargetOrigin=Zs(),sC(this.relativeTargetOrigin,this.target,L.target),Uu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Vw&&_y.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||HU(this.parent.latestValues)||Qee(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var f;const _=this.getLead(),v=!!this.resumingFrom||this!==_;let b=!0;if((this.isProjectionDirty||!((f=this.parent)===null||f===void 0)&&f.isProjectionDirty)&&(b=!1),v&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(b=!1),this.resolvedRelativeTargetAt===Ca.timestamp&&(b=!1),b)return;const{layout:C,layoutId:I}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(C||I))return;Uu(this.layoutCorrected,this.layout.layoutBox);const O=this.treeScale.x,L=this.treeScale.y;zOe(this.layoutCorrected,this.treeScale,this.path,v),_.layout&&!_.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(_.target=_.layout.layoutBox,_.targetWithTransforms=Zs());const{target:M}=_;if(!M){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(jq(this.prevProjectionDelta.x,this.projectionDelta.x),jq(this.prevProjectionDelta.y,this.projectionDelta.y)),iC(this.projectionDelta,this.layoutCorrected,M,this.latestValues),(this.treeScale.x!==O||this.treeScale.y!==L||!Kq(this.projectionDelta.x,this.prevProjectionDelta.x)||!Kq(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",M)),Vw&&_y.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(f=!0){var _;if((_=this.options.visualElement)===null||_===void 0||_.scheduleRender(),f){const v=this.getStack();v&&v.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=zS(),this.projectionDelta=zS(),this.projectionDeltaWithTransform=zS()}setAnimationOrigin(f,_=!1){const v=this.snapshot,b=v?v.latestValues:{},C={...this.latestValues},I=zS();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!_;const O=Zs(),L=v?v.source:void 0,M=this.layout?this.layout.source:void 0,F=L!==M,z=this.getStack(),Z=!z||z.members.length<=1,K=!!(F&&!Z&&this.options.crossfade===!0&&!this.path.some(Ike));this.animationProgress=0;let re;this.mixTargetDelta=ae=>{const ne=ae/1e3;Jq(I.x,f.x,ne),Jq(I.y,f.y,ne),this.setTargetDelta(I),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(sC(O,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Rke(this.relativeTarget,this.relativeTargetOrigin,O,ne),re&&uke(this.relativeTarget,re)&&(this.isProjectionDirty=!1),re||(re=Zs()),Uu(re,this.relativeTarget)),F&&(this.animationValues=C,ike(C,b,this.latestValues,ne,K,Z)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=ne},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(f){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(Og(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=rs.update(()=>{ZO.hasAnimatedSinceResize=!0,this.currentAnimation=QOe(0,qq,{...f,onUpdate:_=>{this.mixTargetDelta(_),f.onUpdate&&f.onUpdate(_)},onComplete:()=>{f.onComplete&&f.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const f=this.getStack();f&&f.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(qq),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const f=this.getLead();let{targetWithTransforms:_,target:v,layout:b,latestValues:C}=f;if(!(!_||!v||!b)){if(this!==f&&this.layout&&b&&lte(this.options.animationType,this.layout.layoutBox,b.layoutBox)){v=this.target||Zs();const I=Xl(this.layout.layoutBox.x);v.x.min=f.target.x.min,v.x.max=v.x.min+I;const O=Xl(this.layout.layoutBox.y);v.y.min=f.target.y.min,v.y.max=v.y.min+O}Uu(_,v),GS(_,C),iC(this.projectionDeltaWithTransform,this.layoutCorrected,_,C)}}registerSharedNode(f,_){this.sharedNodes.has(f)||this.sharedNodes.set(f,new dke),this.sharedNodes.get(f).add(_);const b=_.options.initialPromotionConfig;_.promote({transition:b?b.transition:void 0,preserveFollowOpacity:b&&b.shouldPreserveFollowOpacity?b.shouldPreserveFollowOpacity(_):void 0})}isLead(){const f=this.getStack();return f?f.lead===this:!0}getLead(){var f;const{layoutId:_}=this.options;return _?((f=this.getStack())===null||f===void 0?void 0:f.lead)||this:this}getPrevLead(){var f;const{layoutId:_}=this.options;return _?(f=this.getStack())===null||f===void 0?void 0:f.prevLead:void 0}getStack(){const{layoutId:f}=this.options;if(f)return this.root.sharedNodes.get(f)}promote({needsReset:f,transition:_,preserveFollowOpacity:v}={}){const b=this.getStack();b&&b.promote(this,v),f&&(this.projectionDelta=void 0,this.needsReset=!0),_&&this.setOptions({transition:_})}relegate(){const f=this.getStack();return f?f.relegate(this):!1}resetSkewAndRotation(){const{visualElement:f}=this.options;if(!f)return;let _=!1;const{latestValues:v}=f;if((v.z||v.rotate||v.rotateX||v.rotateY||v.rotateZ||v.skewX||v.skewY)&&(_=!0),!_)return;const b={};v.z&&PM("z",f,b,this.animationValues);for(let C=0;C<AM.length;C++)PM(`rotate${AM[C]}`,f,b,this.animationValues),PM(`skew${AM[C]}`,f,b,this.animationValues);f.render();for(const C in b)f.setStaticValue(C,b[C]),this.animationValues&&(this.animationValues[C]=b[C]);f.scheduleRender()}getProjectionStyles(f){var _,v;if(!this.instance||this.isSVG)return;if(!this.isVisible)return pke;const b={visibility:""},C=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,b.opacity="",b.pointerEvents=JO(f==null?void 0:f.pointerEvents)||"",b.transform=C?C(this.latestValues,""):"none",b;const I=this.getLead();if(!this.projectionDelta||!this.layout||!I.target){const F={};return this.options.layoutId&&(F.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,F.pointerEvents=JO(f==null?void 0:f.pointerEvents)||""),this.hasProjected&&!gy(this.latestValues)&&(F.transform=C?C({},""):"none",this.hasProjected=!1),F}const O=I.animationValues||I.latestValues;this.applyTransformsToTarget(),b.transform=hke(this.projectionDeltaWithTransform,this.treeScale,O),C&&(b.transform=C(O,b.transform));const{x:L,y:M}=this.projectionDelta;b.transformOrigin=`${L.origin*100}% ${M.origin*100}% 0`,I.animationValues?b.opacity=I===this?(v=(_=O.opacity)!==null&&_!==void 0?_:this.latestValues.opacity)!==null&&v!==void 0?v:1:this.preserveOpacity?this.latestValues.opacity:O.opacityExit:b.opacity=I===this?O.opacity!==void 0?O.opacity:"":O.opacityExit!==void 0?O.opacityExit:0;for(const F in Ck){if(O[F]===void 0)continue;const{correct:z,applyTo:Z}=Ck[F],K=b.transform==="none"?O[F]:z(O[F],I);if(Z){const re=Z.length;for(let ae=0;ae<re;ae++)b[Z[ae]]=K}else b[F]=K}return this.options.layoutId&&(b.pointerEvents=I===this?JO(f==null?void 0:f.pointerEvents)||"":"none"),b}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(f=>{var _;return(_=f.currentAnimation)===null||_===void 0?void 0:_.stop()}),this.root.nodes.forEach(Yq),this.root.sharedNodes.clear()}}}function mke(n){n.updateLayout()}function gke(n){var t;const i=((t=n.resumeFrom)===null||t===void 0?void 0:t.snapshot)||n.snapshot;if(n.isLead()&&n.layout&&i&&n.hasListeners("didUpdate")){const{layoutBox:a,measuredBox:l}=n.layout,{animationType:d}=n.options,f=i.source!==n.layout.source;d==="size"?Fu(I=>{const O=f?i.measuredBox[I]:i.layoutBox[I],L=Xl(O);O.min=a[I].min,O.max=O.min+L}):lte(d,i.layoutBox,a)&&Fu(I=>{const O=f?i.measuredBox[I]:i.layoutBox[I],L=Xl(a[I]);O.max=O.min+L,n.relativeTarget&&!n.currentAnimation&&(n.isProjectionDirty=!0,n.relativeTarget[I].max=n.relativeTarget[I].min+L)});const _=zS();iC(_,a,i.layoutBox);const v=zS();f?iC(v,n.applyTransform(l,!0),i.measuredBox):iC(v,a,i.layoutBox);const b=!ste(_);let C=!1;if(!n.resumeFrom){const I=n.getClosestProjectingParent();if(I&&!I.resumeFrom){const{snapshot:O,layout:L}=I;if(O&&L){const M=Zs();sC(M,i.layoutBox,O.layoutBox);const F=Zs();sC(F,a,L.layoutBox),ote(M,F)||(C=!0),I.options.layoutRoot&&(n.relativeTarget=F,n.relativeTargetOrigin=M,n.relativeParent=I)}}}n.notifyListeners("didUpdate",{layout:a,snapshot:i,delta:v,layoutDelta:_,hasLayoutChanged:b,hasRelativeTargetChanged:C})}else if(n.isLead()){const{onExitComplete:a}=n.options;a&&a()}n.options.transition=void 0}function _ke(n){Vw&&_y.totalNodes++,n.parent&&(n.isProjecting()||(n.isProjectionDirty=n.parent.isProjectionDirty),n.isSharedProjectionDirty||(n.isSharedProjectionDirty=!!(n.isProjectionDirty||n.parent.isProjectionDirty||n.parent.isSharedProjectionDirty)),n.isTransformDirty||(n.isTransformDirty=n.parent.isTransformDirty))}function yke(n){n.isProjectionDirty=n.isSharedProjectionDirty=n.isTransformDirty=!1}function Eke(n){n.clearSnapshot()}function Yq(n){n.clearMeasurements()}function vke(n){n.isLayoutDirty=!1}function Ske(n){const{visualElement:t}=n.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),n.resetTransform()}function Xq(n){n.finishAnimation(),n.targetDelta=n.relativeTarget=n.target=void 0,n.isProjectionDirty=!0}function bke(n){n.resolveTargetDelta()}function Tke(n){n.calcProjection()}function wke(n){n.resetSkewAndRotation()}function Cke(n){n.removeLeadSnapshot()}function Jq(n,t,i){n.translate=gs(t.translate,0,i),n.scale=gs(t.scale,1,i),n.origin=t.origin,n.originPoint=t.originPoint}function Qq(n,t,i,a){n.min=gs(t.min,i.min,a),n.max=gs(t.max,i.max,a)}function Rke(n,t,i,a){Qq(n.x,t.x,i.x,a),Qq(n.y,t.y,i.y,a)}function Ike(n){return n.animationValues&&n.animationValues.opacityExit!==void 0}const Ake={duration:.45,ease:[.4,0,.1,1]},Zq=n=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(n),eY=Zq("applewebkit/")&&!Zq("chrome/")?Math.round:Yl;function tY(n){n.min=eY(n.min),n.max=eY(n.max)}function Pke(n){tY(n.x),tY(n.y)}function lte(n,t,i){return n==="position"||n==="preserve-aspect"&&!NOe($q(t),$q(i),.2)}function Oke(n){var t;return n!==n.root&&((t=n.scroll)===null||t===void 0?void 0:t.wasRoot)}const kke=cte({attachResizeListener:(n,t)=>IC(n,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),OM={current:void 0},ute=cte({measureScroll:n=>({x:n.scrollLeft,y:n.scrollTop}),defaultParent:()=>{if(!OM.current){const n=new kke({});n.mount(window),n.setOptions({layoutScroll:!0}),OM.current=n}return OM.current},resetTransform:(n,t)=>{n.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:n=>window.getComputedStyle(n).position==="fixed"}),Nke={pan:{Feature:qOe},drag:{Feature:KOe,ProjectionNode:ute,MeasureLayout:nte}};function nY(n,t,i){const{props:a}=n;n.animationState&&a.whileHover&&n.animationState.setActive("whileHover",i==="Start");const l="onHover"+i,d=a[l];d&&rs.postRender(()=>d(t,ZC(t)))}class Dke extends Bg{mount(){const{current:t}=this.node;t&&(this.unmount=NAe(t,i=>(nY(this.node,i,"Start"),a=>nY(this.node,a,"End"))))}unmount(){}}class xke extends Bg{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=QC(IC(this.node.current,"focus",()=>this.onFocus()),IC(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function rY(n,t,i){const{props:a}=n;n.animationState&&a.whileTap&&n.animationState.setActive("whileTap",i==="Start");const l="onTap"+(i==="End"?"":i),d=a[l];d&&rs.postRender(()=>d(t,ZC(t)))}class Lke extends Bg{mount(){const{current:t}=this.node;t&&(this.unmount=MAe(t,i=>(rY(this.node,i,"Start"),(a,{success:l})=>rY(this.node,a,l?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const KU=new WeakMap,kM=new WeakMap,Mke=n=>{const t=KU.get(n.target);t&&t(n)},Uke=n=>{n.forEach(Mke)};function Vke({root:n,...t}){const i=n||document;kM.has(i)||kM.set(i,{});const a=kM.get(i),l=JSON.stringify(t);return a[l]||(a[l]=new IntersectionObserver(Uke,{root:n,...t})),a[l]}function jke(n,t,i){const a=Vke(t);return KU.set(n,i),a.observe(n),()=>{KU.delete(n),a.unobserve(n)}}const Fke={some:0,all:1};class Bke extends Bg{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:i,margin:a,amount:l="some",once:d}=t,f={root:i?i.current:void 0,rootMargin:a,threshold:typeof l=="number"?l:Fke[l]},_=v=>{const{isIntersecting:b}=v;if(this.isInView===b||(this.isInView=b,d&&!b&&this.hasEnteredView))return;b&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",b);const{onViewportEnter:C,onViewportLeave:I}=this.node.getProps(),O=b?C:I;O&&O(v)};return jke(this.node.current,f,_)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:i}=this.node;["amount","margin","root"].some(zke(t,i))&&this.startObserver()}unmount(){}}function zke({viewport:n={}},{viewport:t={}}={}){return i=>n[i]!==t[i]}const Wke={inView:{Feature:Bke},tap:{Feature:Lke},focus:{Feature:xke},hover:{Feature:Dke}},Gke={layout:{ProjectionNode:ute,MeasureLayout:nte}},qU={current:null},dte={current:!1};function Hke(){if(dte.current=!0,!!Oj)if(window.matchMedia){const n=window.matchMedia("(prefers-reduced-motion)"),t=()=>qU.current=n.matches;n.addListener(t),t()}else qU.current=!1}const $ke=[...Mee,nc,kg],Kke=n=>$ke.find(Lee(n)),iY=new WeakMap;function qke(n,t,i){for(const a in t){const l=t[a],d=i[a];if(sc(l))n.addValue(a,l);else if(sc(d))n.addValue(a,CC(l,{owner:n}));else if(d!==l)if(n.hasValue(a)){const f=n.getValue(a);f.liveStyle===!0?f.jump(l):f.hasAnimated||f.set(l)}else{const f=n.getStaticValue(a);n.addValue(a,CC(f!==void 0?f:l,{owner:n}))}}for(const a in i)t[a]===void 0&&n.removeValue(a);return t}const sY=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Yke{scrapeMotionValuesFromProps(t,i,a){return{}}constructor({parent:t,props:i,presenceContext:a,reducedMotionConfig:l,blockInitialAnimation:d,visualState:f},_={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=rF,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const L=up.now();this.renderScheduledAt<L&&(this.renderScheduledAt=L,rs.render(this.render,!1,!0))};const{latestValues:v,renderState:b,onUpdate:C}=f;this.onUpdate=C,this.latestValues=v,this.baseTarget={...v},this.initialValues=i.initial?{...v}:{},this.renderState=b,this.parent=t,this.props=i,this.presenceContext=a,this.depth=t?t.depth+1:0,this.reducedMotionConfig=l,this.options=_,this.blockInitialAnimation=!!d,this.isControllingVariants=b1(i),this.isVariantNode=GZ(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:I,...O}=this.scrapeMotionValuesFromProps(i,{},this);for(const L in O){const M=O[L];v[L]!==void 0&&sc(M)&&M.set(v[L],!1)}}mount(t){this.current=t,iY.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,a)=>this.bindToMotionValue(a,i)),dte.current||Hke(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:qU.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){iY.delete(this.current),this.projection&&this.projection.unmount(),Og(this.notifyUpdate),Og(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const i=this.features[t];i&&(i.unmount(),i.isMounted=!1)}this.current=null}bindToMotionValue(t,i){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const a=Qy.has(t),l=i.on("change",_=>{this.latestValues[t]=_,this.props.onUpdate&&rs.preRender(this.notifyUpdate),a&&this.projection&&(this.projection.isTransformDirty=!0)}),d=i.on("renderRequest",this.scheduleRender);let f;window.MotionCheckAppearSync&&(f=window.MotionCheckAppearSync(this,t,i)),this.valueSubscriptions.set(t,()=>{l(),d(),f&&f(),i.owner&&i.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in g0){const i=g0[t];if(!i)continue;const{isEnabled:a,Feature:l}=i;if(!this.features[t]&&l&&a(this.props)&&(this.features[t]=new l(this)),this.features[t]){const d=this.features[t];d.isMounted?d.update():(d.mount(),d.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Zs()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,i){this.latestValues[t]=i}update(t,i){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let a=0;a<sY.length;a++){const l=sY[a];this.propEventSubscriptions[l]&&(this.propEventSubscriptions[l](),delete this.propEventSubscriptions[l]);const d="on"+l,f=t[d];f&&(this.propEventSubscriptions[l]=this.on(l,f))}this.prevMotionValues=qke(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue(),this.onUpdate&&this.onUpdate(this)}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(t),()=>i.variantChildren.delete(t)}addValue(t,i){const a=this.values.get(t);i!==a&&(a&&this.removeValue(t),this.bindToMotionValue(t,i),this.values.set(t,i),this.latestValues[t]=i.get())}removeValue(t){this.values.delete(t);const i=this.valueSubscriptions.get(t);i&&(i(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,i){if(this.props.values&&this.props.values[t])return this.props.values[t];let a=this.values.get(t);return a===void 0&&i!==void 0&&(a=CC(i===null?void 0:i,{owner:this}),this.addValue(t,a)),a}readValue(t,i){var a;let l=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(a=this.getBaseTargetFromProps(this.props,t))!==null&&a!==void 0?a:this.readValueFromInstance(this.current,t,this.options);return l!=null&&(typeof l=="string"&&(Dee(l)||wee(l))?l=parseFloat(l):!Kke(l)&&kg.test(i)&&(l=Oee(t,i)),this.setBaseTarget(t,sc(l)?l.get():l)),sc(l)?l.get():l}setBaseTarget(t,i){this.baseTarget[t]=i}getBaseTarget(t){var i;const{initial:a}=this.props;let l;if(typeof a=="string"||typeof a=="object"){const f=Uj(this.props,a,(i=this.presenceContext)===null||i===void 0?void 0:i.custom);f&&(l=f[t])}if(a&&l!==void 0)return l;const d=this.getBaseTargetFromProps(this.props,t);return d!==void 0&&!sc(d)?d:this.initialValues[t]!==void 0&&l===void 0?void 0:this.baseTarget[t]}on(t,i){return this.events[t]||(this.events[t]=new Jj),this.events[t].add(i)}notify(t,...i){this.events[t]&&this.events[t].notify(...i)}}class hte extends Yke{constructor(){super(...arguments),this.KeyframeResolver=Uee}sortInstanceNodePosition(t,i){return t.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(t,i){return t.style?t.style[i]:void 0}removeValueFromRenderState(t,{vars:i,style:a}){delete i[t],delete a[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;sc(t)&&(this.childSubscription=t.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function Xke(n){return window.getComputedStyle(n)}class Jke extends hte{constructor(){super(...arguments),this.type="html",this.renderInstance=ZZ}readValueFromInstance(t,i){if(Qy.has(i)){const a=nF(i);return a&&a.default||0}else{const a=Xke(t),l=(XZ(i)?a.getPropertyValue(i):a[i])||0;return typeof l=="string"?l.trim():l}}measureInstanceViewportBox(t,{transformPagePoint:i}){return ete(t,i)}build(t,i,a){Fj(t,i,a.transformTemplate)}scrapeMotionValuesFromProps(t,i,a){return Gj(t,i,a)}}class Qke extends hte{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Zs}getBaseTargetFromProps(t,i){return t[i]}readValueFromInstance(t,i){if(Qy.has(i)){const a=nF(i);return a&&a.default||0}return i=eee.has(i)?i:xj(i),t.getAttribute(i)}scrapeMotionValuesFromProps(t,i,a){return ree(t,i,a)}build(t,i,a){Bj(t,i,this.isSVGTag,a.transformTemplate)}renderInstance(t,i,a,l){tee(t,i,a,l)}mount(t){this.isSVGTag=Wj(t.tagName),super.mount(t)}}const Zke=(n,t)=>Mj(n)?new Qke(t):new Jke(t,{allowProjection:n!==N.Fragment}),e1e=CAe({...TOe,...Wke,...Nke,...Gke},Zke),Jf=FIe(e1e),t1e=(n,t)=>n.find(i=>i.id===t);function oY(n,t){const i=pte(n,t),a=i?n[i].findIndex(l=>l.id===t):-1;return{position:i,index:a}}function pte(n,t){for(const[i,a]of Object.entries(n))if(t1e(a,t))return i}function n1e(n){const t=n.includes("right"),i=n.includes("left");let a="center";return t&&(a="flex-end"),i&&(a="flex-start"),{display:"flex",flexDirection:"column",alignItems:a}}function r1e(n){const i=n==="top"||n==="bottom"?"0 auto":void 0,a=n.includes("top")?"env(safe-area-inset-top, 0px)":void 0,l=n.includes("bottom")?"env(safe-area-inset-bottom, 0px)":void 0,d=n.includes("left")?void 0:"env(safe-area-inset-right, 0px)",f=n.includes("right")?void 0:"env(safe-area-inset-left, 0px)";return{position:"fixed",zIndex:"var(--toast-z-index, 5500)",pointerEvents:"none",display:"flex",flexDirection:"column",margin:i,top:a,bottom:l,right:d,left:f}}var i1e=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,s1e=PZ(function(n){return i1e.test(n)||n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)<91}),o1e=s1e,a1e=function(t){return t!=="theme"},aY=function(t){return typeof t=="string"&&t.charCodeAt(0)>96?o1e:a1e},cY=function(t,i,a){var l;if(i){var d=i.shouldForwardProp;l=t.__emotion_forwardProp&&d?function(f){return t.__emotion_forwardProp(f)&&d(f)}:d}return typeof l!="function"&&a&&(l=t.__emotion_forwardProp),l},c1e=function(t){var i=t.cache,a=t.serialized,l=t.isStringTag;return yj(i,a,l),xZ(function(){return Ej(i,a,l)}),null},l1e=function n(t,i){var a=t.__emotion_real===t,l=a&&t.__emotion_base||t,d,f;i!==void 0&&(d=i.label,f=i.target);var _=cY(t,i,a),v=_||aY(l),b=!v("as");return function(){var C=arguments,I=a&&t.__emotion_styles!==void 0?t.__emotion_styles.slice(0):[];if(d!==void 0&&I.push("label:"+d+";"),C[0]==null||C[0].raw===void 0)I.push.apply(I,C);else{var O=C[0];I.push(O[0]);for(var L=C.length,M=1;M<L;M++)I.push(C[M],O[M])}var F=Sj(function(z,Z,K){var re=b&&z.as||l,ae="",ne=[],pe=z;if(z.theme==null){pe={};for(var X in z)pe[X]=z[X];pe.theme=N.useContext(f0)}typeof z.className=="string"?ae=kZ(Z.registered,ne,z.className):z.className!=null&&(ae=z.className+" ");var J=_1(I.concat(ne),Z.registered,pe);ae+=Z.key+"-"+J.name,f!==void 0&&(ae+=" "+f);var Q=b&&_===void 0?aY(re):v,se={};for(var de in z)b&&de==="as"||Q(de)&&(se[de]=z[de]);return se.className=ae,K&&(se.ref=K),N.createElement(N.Fragment,null,N.createElement(c1e,{cache:Z,serialized:J,isStringTag:typeof re=="string"}),N.createElement(re,se))});return F.displayName=d!==void 0?d:"Styled("+(typeof l=="string"?l:l.displayName||l.name||"Component")+")",F.defaultProps=t.defaultProps,F.__emotion_real=F,F.__emotion_base=l,F.__emotion_styles=I,F.__emotion_forwardProp=_,Object.defineProperty(F,"toString",{value:function(){return"."+f}}),F.withComponent=function(z,Z){var K=n(z,Fy({},i,Z,{shouldForwardProp:cY(F,Z,!0)}));return K.apply(void 0,I)},F}},u1e=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],YU=l1e.bind(null);u1e.forEach(function(n){YU[n]=YU(n)});const d1e=new Set([...kve,"textStyle","layerStyle","apply","noOfLines","focusBorderColor","errorBorderColor","as","__css","css","sx"]),h1e=new Set(["htmlWidth","htmlHeight","htmlSize","htmlTranslate"]);function p1e(n){return(h1e.has(n)||!d1e.has(n))&&n[0]!=="_"}const f1e=sEe(YU),m1e=({baseStyle:n})=>t=>{const{theme:i,css:a,__css:l,sx:d,...f}=t,[_]=hEe(f,Dve),v=ml(n,t),b=Hye({},l,v,l1(_),d),C=cZ(b)(t.theme);return a?[C,a]:C};function NM(n,t){const{baseStyle:i,...a}=t??{};a.shouldForwardProp||(a.shouldForwardProp=p1e);const l=m1e({baseStyle:i}),d=f1e(n,a)(l);return N.forwardRef(function(v,b){const{children:C,...I}=v,{colorMode:O,forced:L}=E1(),M=L?O:void 0;return N.createElement(d,{ref:b,"data-theme":M,...I},C)})}function g1e(){const n=new Map;return new Proxy(NM,{apply(t,i,a){return NM(...a)},get(t,i){return n.has(i)||n.set(i,NM(i)),n.get(i)}})}const Vt=g1e(),_1e={initial:n=>{const{position:t}=n,i=["top","bottom"].includes(t)?"y":"x";let a=["top-right","bottom-right"].includes(t)?1:-1;return t==="bottom"&&(a=1),{opacity:0,[i]:a*24}},animate:{opacity:1,y:0,x:0,scale:1,transition:{duration:.4,ease:[.4,0,.2,1]}},exit:{opacity:0,scale:.85,transition:{duration:.2,ease:[.4,0,1,1]}}},fte=N.memo(n=>{const{id:t,message:i,onCloseComplete:a,onRequestRemove:l,requestClose:d=!1,position:f="bottom",duration:_=5e3,containerStyle:v,motionVariants:b=_1e,toastSpacing:C="0.5rem"}=n,[I,O]=N.useState(_),L=kIe();zf(()=>{L||a==null||a()},[L]),zf(()=>{O(_)},[_]);const M=()=>O(null),F=()=>O(_),z=()=>{L&&l()};N.useEffect(()=>{L&&d&&l()},[L,d,l]),LEe(z,I);const Z=N.useMemo(()=>({pointerEvents:"auto",maxWidth:560,minWidth:300,margin:C,...v}),[v,C]),K=N.useMemo(()=>n1e(f),[f]);return T.jsx(Jf.div,{layout:!0,className:"chakra-toast",variants:b,initial:"initial",animate:"animate",exit:"exit",onHoverStart:M,onHoverEnd:F,custom:{position:f},style:K,children:T.jsx(Vt.div,{role:"status","aria-atomic":"true",className:"chakra-toast__inner",__css:Z,children:ml(i,{id:t,onClose:z})})})});fte.displayName="ToastComponent";function zt(n){return N.forwardRef(n)}var DM,lY;function y1e(){if(lY)return DM;lY=1;var n=typeof Element<"u",t=typeof Map=="function",i=typeof Set=="function",a=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function l(d,f){if(d===f)return!0;if(d&&f&&typeof d=="object"&&typeof f=="object"){if(d.constructor!==f.constructor)return!1;var _,v,b;if(Array.isArray(d)){if(_=d.length,_!=f.length)return!1;for(v=_;v--!==0;)if(!l(d[v],f[v]))return!1;return!0}var C;if(t&&d instanceof Map&&f instanceof Map){if(d.size!==f.size)return!1;for(C=d.entries();!(v=C.next()).done;)if(!f.has(v.value[0]))return!1;for(C=d.entries();!(v=C.next()).done;)if(!l(v.value[1],f.get(v.value[0])))return!1;return!0}if(i&&d instanceof Set&&f instanceof Set){if(d.size!==f.size)return!1;for(C=d.entries();!(v=C.next()).done;)if(!f.has(v.value[0]))return!1;return!0}if(a&&ArrayBuffer.isView(d)&&ArrayBuffer.isView(f)){if(_=d.length,_!=f.length)return!1;for(v=_;v--!==0;)if(d[v]!==f[v])return!1;return!0}if(d.constructor===RegExp)return d.source===f.source&&d.flags===f.flags;if(d.valueOf!==Object.prototype.valueOf&&typeof d.valueOf=="function"&&typeof f.valueOf=="function")return d.valueOf()===f.valueOf();if(d.toString!==Object.prototype.toString&&typeof d.toString=="function"&&typeof f.toString=="function")return d.toString()===f.toString();if(b=Object.keys(d),_=b.length,_!==Object.keys(f).length)return!1;for(v=_;v--!==0;)if(!Object.prototype.hasOwnProperty.call(f,b[v]))return!1;if(n&&d instanceof Element)return!1;for(v=_;v--!==0;)if(!((b[v]==="_owner"||b[v]==="__v"||b[v]==="__o")&&d.$$typeof)&&!l(d[b[v]],f[b[v]]))return!1;return!0}return d!==d&&f!==f}return DM=function(f,_){try{return l(f,_)}catch(v){if((v.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw v}},DM}var E1e=y1e();const v1e=Fg(E1e);function F0(){const n=N.useContext(f0);if(!n)throw Error("useTheme: `theme` is undefined. Seems you forgot to wrap your app in `<ChakraProvider />` or `<ThemeProvider />`");return n}function mte(){const n=E1(),t=F0();return{...n,theme:t}}function S1e(n,t,i){if(t==null)return t;const a=l=>{var d,f;return(f=(d=n.__cssMap)==null?void 0:d[l])==null?void 0:f.value};return a(t)??a(i)??i}function b1e(n,t,i){const a=Array.isArray(t)?t:[t],l=Array.isArray(i)?i:[i];return d=>{const f=l.filter(Boolean),_=a.map((v,b)=>{const C=`${n}.${v}`;return S1e(d,C,f[b]??v)});return Array.isArray(t)?_:_[0]}}function gte(n,t={}){const{styleConfig:i,...a}=t,{theme:l,colorMode:d}=mte(),f=n?GQ(l,`components.${n}`):void 0,_=i||f,v=ep({theme:l,colorMode:d},(_==null?void 0:_.defaultProps)??{},l1(L0(a,["children"])),(C,I)=>C?void 0:I),b=N.useRef({});if(_){const I=Gve(_)(v);v1e(b.current,I)||(b.current=I)}return b.current}function Xu(n,t={}){return gte(n,t)}function ka(n,t={}){return gte(n,t)}const uY={path:T.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[T.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),T.jsx("path",{fill:"currentColor",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),T.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]}),viewBox:"0 0 24 24"},En=zt((n,t)=>{const{as:i,viewBox:a,color:l="currentColor",focusable:d=!1,children:f,className:_,__css:v,...b}=n,C=_n("chakra-icon",_),I=Xu("Icon",n),O={w:"1em",h:"1em",display:"inline-block",lineHeight:"1em",flexShrink:0,color:l,...v,...I},L={ref:t,focusable:d,className:C,__css:O},M=a??uY.viewBox;if(i&&typeof i!="string")return T.jsx(Vt.svg,{as:i,...L,...b});const F=f??uY.path;return T.jsx(Vt.svg,{verticalAlign:"middle",viewBox:M,...L,...b,children:F})});En.displayName="Icon";function T1e(n){return T.jsx(En,{viewBox:"0 0 24 24",...n,children:T.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.014,12.014,0,0,0,12,0Zm6.927,8.2-6.845,9.289a1.011,1.011,0,0,1-1.43.188L5.764,13.769a1,1,0,1,1,1.25-1.562l4.076,3.261,6.227-8.451A1,1,0,1,1,18.927,8.2Z"})})}function w1e(n){return T.jsx(En,{viewBox:"0 0 24 24",...n,children:T.jsx("path",{fill:"currentColor",d:"M12,0A12,12,0,1,0,24,12,12.013,12.013,0,0,0,12,0Zm.25,5a1.5,1.5,0,1,1-1.5,1.5A1.5,1.5,0,0,1,12.25,5ZM14.5,18.5h-4a1,1,0,0,1,0-2h.75a.25.25,0,0,0,.25-.25v-4.5a.25.25,0,0,0-.25-.25H10.5a1,1,0,0,1,0-2h1a2,2,0,0,1,2,2v4.75a.25.25,0,0,0,.25.25h.75a1,1,0,1,1,0,2Z"})})}function dY(n){return T.jsx(En,{viewBox:"0 0 24 24",...n,children:T.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})}const C1e=qC({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}),qd=zt((n,t)=>{const i=Xu("Spinner",n),{label:a="Loading...",thickness:l="2px",speed:d="0.45s",emptyColor:f="transparent",className:_,...v}=Fi(n),b=_n("chakra-spinner",_),C={display:"inline-block",borderColor:"currentColor",borderStyle:"solid",borderRadius:"99999px",borderWidth:l,borderBottomColor:f,borderLeftColor:f,animation:`${C1e} ${d} linear infinite`,...i};return T.jsx(Vt.div,{ref:t,__css:C,className:b,...v,children:a&&T.jsx(Vt.span,{srOnly:!0,children:a})})});qd.displayName="Spinner";const[R1e,aF]=Ti({name:"AlertContext",hookName:"useAlertContext",providerName:"<Alert />"}),[I1e,cF]=Ti({name:"AlertStylesContext",hookName:"useAlertStyles",providerName:"<Alert />"}),_te={info:{icon:w1e,colorScheme:"blue"},warning:{icon:dY,colorScheme:"orange"},success:{icon:T1e,colorScheme:"green"},error:{icon:dY,colorScheme:"red"},loading:{icon:qd,colorScheme:"blue"}};function A1e(n){return _te[n].colorScheme}function P1e(n){return _te[n].icon}const tp=zt(function(t,i){const{status:a="info",addRole:l=!0,...d}=Fi(t),f=t.colorScheme??A1e(a),_=ka("Alert",{...t,colorScheme:f}),v={width:"100%",display:"flex",alignItems:"center",position:"relative",overflow:"hidden",..._.container};return T.jsx(R1e,{value:{status:a},children:T.jsx(I1e,{value:_,children:T.jsx(Vt.div,{"data-status":a,role:l?"alert":void 0,ref:i,...d,className:_n("chakra-alert",t.className),__css:v})})})});tp.displayName="Alert";function np(n){const{status:t}=aF(),i=P1e(t),a=cF(),l=t==="loading"?a.spinner:a.icon;return T.jsx(Vt.span,{display:"inherit","data-status":t,...n,className:_n("chakra-alert__icon",n.className),__css:l,children:n.children||T.jsx(i,{h:"100%",w:"100%"})})}np.displayName="AlertIcon";const HS=zt(function(t,i){const a=cF(),{status:l}=aF();return T.jsx(Vt.div,{ref:i,"data-status":l,...t,className:_n("chakra-alert__title",t.className),__css:a.title})});HS.displayName="AlertTitle";const $S=zt(function(t,i){const{status:a}=aF(),l=cF(),d={display:"inline",...l.description};return T.jsx(Vt.div,{ref:i,"data-status":a,...t,className:_n("chakra-alert__desc",t.className),__css:d})});$S.displayName="AlertDescription";function O1e(n){return T.jsx(En,{focusable:"false","aria-hidden":!0,...n,children:T.jsx("path",{fill:"currentColor",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"})})}const lF=zt(function(t,i){const a=Xu("CloseButton",t),{children:l,isDisabled:d,__css:f,..._}=Fi(t),v={outline:0,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0};return T.jsx(Vt.button,{type:"button","aria-label":"Close",ref:i,disabled:d,__css:{...v,...a,...f},..._,children:l||T.jsx(O1e,{width:"1em",height:"1em"})})});lF.displayName="CloseButton";const k1e=n=>{const{status:t,variant:i="solid",id:a,title:l,isClosable:d,onClose:f,description:_,colorScheme:v,icon:b}=n,C=a?{root:`toast-${a}`,title:`toast-${a}-title`,description:`toast-${a}-description`}:void 0;return T.jsxs(tp,{addRole:!1,status:t,variant:i,id:C==null?void 0:C.root,alignItems:"start",borderRadius:"md",boxShadow:"lg",paddingEnd:8,textAlign:"start",width:"auto",colorScheme:v,children:[T.jsx(np,{children:b}),T.jsxs(Vt.div,{flex:"1",maxWidth:"100%",children:[l&&T.jsx(HS,{id:C==null?void 0:C.title,children:l}),_&&T.jsx($S,{id:C==null?void 0:C.description,display:"block",children:_})]}),d&&T.jsx(lF,{size:"sm",onClick:f,position:"absolute",insetEnd:1,top:1})]})};function yte(n={}){const{render:t,toastComponent:i=k1e}=n;return l=>typeof t=="function"?t({...l,...n}):T.jsx(i,{...l,...n})}const N1e={top:[],"top-left":[],"top-right":[],"bottom-left":[],bottom:[],"bottom-right":[]},Jh=D1e(N1e);function D1e(n){let t=n;const i=new Set,a=l=>{t=l(t),i.forEach(d=>d())};return{getState:()=>t,subscribe:l=>(i.add(l),()=>{a(()=>n),i.delete(l)}),removeToast:(l,d)=>{a(f=>({...f,[d]:f[d].filter(_=>_.id!=l)}))},notify:(l,d)=>{const f=x1e(l,d),{position:_,id:v}=f;return a(b=>{const I=_.includes("top")?[f,...b[_]??[]]:[...b[_]??[],f];return{...b,[_]:I}}),v},update:(l,d)=>{l&&a(f=>{const _={...f},{position:v,index:b}=oY(_,l);return v&&b!==-1&&(_[v][b]={..._[v][b],...d,message:yte(d)}),_})},closeAll:({positions:l}={})=>{a(d=>(l??["bottom","bottom-right","bottom-left","top","top-left","top-right"]).reduce((v,b)=>(v[b]=d[b].map(C=>({...C,requestClose:!0})),v),{...d}))},close:l=>{a(d=>{const f=pte(d,l);return f?{...d,[f]:d[f].map(_=>_.id==l?{..._,requestClose:!0}:_)}:d})},isActive:l=>!!oY(Jh.getState(),l).position}}let hY=0;function x1e(n,t={}){hY+=1;const i=t.id??hY,a=t.position??"bottom";return{id:i,message:n,position:a,duration:t.duration,onCloseComplete:t.onCloseComplete,onRequestRemove:()=>Jh.removeToast(String(i),a),status:t.status,requestClose:!1,containerStyle:t.containerStyle}}var Ete=LQ();const[vte,L1e]=Ti({strict:!1,name:"PortalContext"}),uF="chakra-portal",M1e=".chakra-portal",U1e=n=>T.jsx("div",{className:"chakra-portal-zIndex",style:{position:"absolute",zIndex:n.zIndex,top:0,left:0,right:0},children:n.children}),V1e=n=>{const{appendToParentPortal:t,children:i}=n,[a,l]=N.useState(null),d=N.useRef(null),[,f]=N.useState({});N.useEffect(()=>f({}),[]);const _=L1e(),v=wIe();op(()=>{if(!a)return;const C=a.ownerDocument,I=t?_??C.body:C.body;if(!I)return;d.current=C.createElement("div"),d.current.className=uF,I.appendChild(d.current),f({});const O=d.current;return()=>{I.contains(O)&&I.removeChild(O)}},[a]);const b=v!=null&&v.zIndex?T.jsx(U1e,{zIndex:v==null?void 0:v.zIndex,children:i}):i;return d.current?Ete.createPortal(T.jsx(vte,{value:d.current,children:b}),d.current):T.jsx("span",{ref:C=>{C&&l(C)}})},j1e=n=>{const{children:t,containerRef:i,appendToParentPortal:a}=n,l=i.current,d=l??(typeof window<"u"?document.body:void 0),f=N.useMemo(()=>{const v=l==null?void 0:l.ownerDocument.createElement("div");return v&&(v.className=uF),v},[l]),[,_]=N.useState({});return op(()=>_({}),[]),op(()=>{if(!(!f||!d))return d.appendChild(f),()=>{d.removeChild(f)}},[f,d]),d&&f?Ete.createPortal(T.jsx(vte,{value:a?f:null,children:t}),f):null};function Ju(n){const t={appendToParentPortal:!0,...n},{containerRef:i,...a}=t;return i?T.jsx(j1e,{containerRef:i,...a}):T.jsx(V1e,{...a})}Ju.className=uF;Ju.selector=M1e;Ju.displayName="Portal";const[F1e,B1e]=Ti({name:"ToastOptionsContext",strict:!1}),z1e=n=>{const t=N.useSyncExternalStore(Jh.subscribe,Jh.getState,Jh.getState),{motionVariants:i,component:a=fte,portalProps:l,animatePresenceProps:d}=n,_=Object.keys(t).map(v=>{const b=t[v];return T.jsx("div",{role:"region","aria-live":"polite","aria-label":`Notifications-${v}`,id:`chakra-toast-manager-${v}`,style:r1e(v),children:T.jsx(U0,{...d,initial:!1,children:b.map(C=>T.jsx(a,{motionVariants:i,...C},C.id))})},v)});return T.jsx(Ju,{...l,children:_})},W1e=n=>function({children:i,theme:a=n,toastOptions:l,...d}){return T.jsxs(RIe,{theme:a,...d,children:[T.jsx(F1e,{value:l==null?void 0:l.defaultOptions,children:i}),T.jsx(z1e,{...l})]})},G1e=W1e(gRe);function pY(n){return n.sort((t,i)=>{const a=t.compareDocumentPosition(i);if(a&Node.DOCUMENT_POSITION_FOLLOWING||a&Node.DOCUMENT_POSITION_CONTAINED_BY)return-1;if(a&Node.DOCUMENT_POSITION_PRECEDING||a&Node.DOCUMENT_POSITION_CONTAINS)return 1;if(a&Node.DOCUMENT_POSITION_DISCONNECTED||a&Node.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC)throw Error("Cannot sort the given nodes.");return 0})}const H1e=n=>typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE;function fY(n,t,i){let a=n+1;return i&&a>=t&&(a=0),a}function mY(n,t,i){let a=n-1;return i&&a<0&&(a=t),a}const xM=typeof window<"u"?N.useLayoutEffect:N.useEffect,gY=n=>n;var $1e=Object.defineProperty,K1e=(n,t,i)=>t in n?$1e(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i,Ds=(n,t,i)=>(K1e(n,typeof t!="symbol"?t+"":t,i),i);class q1e{constructor(){Ds(this,"descendants",new Map),Ds(this,"register",t=>{if(t!=null)return H1e(t)?this.registerNode(t):i=>{this.registerNode(i,t)}}),Ds(this,"unregister",t=>{this.descendants.delete(t);const i=pY(Array.from(this.descendants.keys()));this.assignIndex(i)}),Ds(this,"destroy",()=>{this.descendants.clear()}),Ds(this,"assignIndex",t=>{this.descendants.forEach(i=>{const a=t.indexOf(i.node);i.index=a,i.node.dataset.index=i.index.toString()})}),Ds(this,"count",()=>this.descendants.size),Ds(this,"enabledCount",()=>this.enabledValues().length),Ds(this,"values",()=>Array.from(this.descendants.values()).sort((i,a)=>i.index-a.index)),Ds(this,"enabledValues",()=>this.values().filter(t=>!t.disabled)),Ds(this,"item",t=>{if(this.count()!==0)return this.values()[t]}),Ds(this,"enabledItem",t=>{if(this.enabledCount()!==0)return this.enabledValues()[t]}),Ds(this,"first",()=>this.item(0)),Ds(this,"firstEnabled",()=>this.enabledItem(0)),Ds(this,"last",()=>this.item(this.descendants.size-1)),Ds(this,"lastEnabled",()=>{const t=this.enabledValues().length-1;return this.enabledItem(t)}),Ds(this,"indexOf",t=>{var i;return t?((i=this.descendants.get(t))==null?void 0:i.index)??-1:-1}),Ds(this,"enabledIndexOf",t=>t==null?-1:this.enabledValues().findIndex(i=>i.node.isSameNode(t))),Ds(this,"next",(t,i=!0)=>{const a=fY(t,this.count(),i);return this.item(a)}),Ds(this,"nextEnabled",(t,i=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=fY(l,this.enabledCount(),i);return this.enabledItem(d)}),Ds(this,"prev",(t,i=!0)=>{const a=mY(t,this.count()-1,i);return this.item(a)}),Ds(this,"prevEnabled",(t,i=!0)=>{const a=this.item(t);if(!a)return;const l=this.enabledIndexOf(a.node),d=mY(l,this.enabledCount()-1,i);return this.enabledItem(d)}),Ds(this,"registerNode",(t,i)=>{if(!t||this.descendants.has(t))return;const a=Array.from(this.descendants.keys()).concat(t),l=pY(a);i!=null&&i.disabled&&(i.disabled=!!i.disabled);const d={node:t,index:-1,...i};this.descendants.set(t,d),this.assignIndex(l)})}}function Ste(){const[n,t]=Ti({name:"DescendantsProvider",errorMessage:"useDescendantsContext must be used within DescendantsProvider"});return[n,t,()=>{const l=N.useRef(new q1e);return xM(()=>()=>l.current.destroy()),l.current},l=>{const d=t(),[f,_]=N.useState(-1),v=N.useRef(null);xM(()=>()=>{v.current&&d.unregister(v.current)},[]),xM(()=>{if(!v.current)return;const C=Number(v.current.dataset.index);f!=C&&!Number.isNaN(C)&&_(C)});const b=gY(l?d.register(l):d.register);return{descendants:d,index:f,enabledIndex:d.enabledIndexOf(v.current),register:Vi(b,v)}}]}const _Y={easeIn:[.4,0,1,1],easeOut:[0,0,.2,1]},Ny={enter:{duration:.2,ease:_Y.easeOut},exit:{duration:.1,ease:_Y.easeIn}},Dy={enter:(n,t)=>({...n,delay:typeof t=="number"?t:t==null?void 0:t.enter}),exit:(n,t)=>({...n,delay:typeof t=="number"?t:t==null?void 0:t.exit})},[Y1e,X1e]=Ti({name:"AvatarStylesContext",hookName:"useAvatarStyles",providerName:"<Avatar/>"});function J1e(n){const t=n.trim().split(" "),i=t[0]??"",a=t.length>1?t[t.length-1]:"";return i&&a?`${i.charAt(0)}${a.charAt(0)}`:i.charAt(0)}function bte(n){const{name:t,getInitials:i,...a}=n,l=X1e();return T.jsx(Vt.div,{role:"img","aria-label":t,...a,__css:l.label,children:t?i==null?void 0:i(t):null})}bte.displayName="AvatarName";const Tte=n=>T.jsxs(Vt.svg,{viewBox:"0 0 128 128",color:"#fff",width:"100%",height:"100%",className:"chakra-avatar__svg",...n,children:[T.jsx("path",{fill:"currentColor",d:"M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"}),T.jsx("path",{fill:"currentColor",d:"M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"})]});function wte(n){const{loading:t,src:i,srcSet:a,onLoad:l,onError:d,crossOrigin:f,sizes:_,ignoreFallback:v}=n,[b,C]=N.useState("pending");N.useEffect(()=>{C(i?"loading":"pending")},[i]);const I=N.useRef(null),O=N.useCallback(()=>{if(!i)return;L();const M=new Image;M.src=i,f&&(M.crossOrigin=f),a&&(M.srcset=a),_&&(M.sizes=_),t&&(M.loading=t),M.onload=F=>{L(),C("loaded"),l==null||l(F)},M.onerror=F=>{L(),C("failed"),d==null||d(F)},I.current=M},[i,f,a,_,l,d,t]),L=()=>{I.current&&(I.current.onload=null,I.current.onerror=null,I.current=null)};return op(()=>{if(!v)return b==="loading"&&O(),()=>{L()}},[b,O,v]),v?"loaded":b}const Q1e=(n,t)=>n!=="loaded"&&t==="beforeLoadOrError"||n==="failed"&&t==="onError";function Cte(n){const{src:t,srcSet:i,onError:a,onLoad:l,getInitials:d,name:f,borderRadius:_,loading:v,iconLabel:b,icon:C=T.jsx(Tte,{}),ignoreFallback:I,referrerPolicy:O,crossOrigin:L}=n,F=wte({src:t,onError:a,crossOrigin:L,ignoreFallback:I})==="loaded";return!t||!F?f?T.jsx(bte,{className:"chakra-avatar__initials",getInitials:d,name:f}):N.cloneElement(C,{role:"img","aria-label":b}):T.jsx(Vt.img,{src:t,srcSet:i,alt:f??b,onLoad:l,referrerPolicy:O,crossOrigin:L??void 0,className:"chakra-avatar__img",loading:v,__css:{width:"100%",height:"100%",objectFit:"cover",borderRadius:_}})}Cte.displayName="AvatarImage";const Z1e={display:"inline-flex",alignItems:"center",justifyContent:"center",textAlign:"center",textTransform:"uppercase",fontWeight:"medium",position:"relative",flexShrink:0},Ep=zt((n,t)=>{const i=ka("Avatar",n),[a,l]=N.useState(!1),{src:d,srcSet:f,name:_,showBorder:v,borderRadius:b="full",onError:C,onLoad:I,getInitials:O=J1e,icon:L=T.jsx(Tte,{}),iconLabel:M=" avatar",loading:F,children:z,borderColor:Z,ignoreFallback:K,crossOrigin:re,referrerPolicy:ae,...ne}=Fi(n),pe={borderRadius:b,borderWidth:v?"2px":void 0,...Z1e,...i.container};return Z&&(pe.borderColor=Z),T.jsx(Vt.span,{ref:t,...ne,className:_n("chakra-avatar",n.className),"data-loaded":nr(a),__css:pe,children:T.jsxs(Y1e,{value:i,children:[T.jsx(Cte,{src:d,srcSet:f,loading:F,onLoad:Nn(I,()=>{l(!0)}),onError:C,getInitials:O,name:_,borderRadius:b,icon:L,iconLabel:M,ignoreFallback:K,crossOrigin:re,referrerPolicy:ae}),z]})})});Ep.displayName="Avatar";const Of=zt(function(t,i){const a=Xu("Badge",t),{className:l,...d}=Fi(t);return T.jsx(Vt.span,{ref:i,className:_n("chakra-badge",t.className),...d,__css:{display:"inline-block",whiteSpace:"nowrap",verticalAlign:"middle",...a}})});Of.displayName="Badge";const ft=Vt("div");ft.displayName="Box";const[k8e,eNe]=Ti({strict:!1,name:"ButtonGroupContext"});function jw(n){const{children:t,className:i,...a}=n,l=N.isValidElement(t)?N.cloneElement(t,{"aria-hidden":!0,focusable:!1}):t,d=_n("chakra-button__icon",i);return T.jsx(Vt.span,{display:"inline-flex",alignSelf:"center",flexShrink:0,...a,className:d,children:l})}jw.displayName="ButtonIcon";function XU(n){const{label:t,placement:i,spacing:a="0.5rem",children:l=T.jsx(qd,{color:"currentColor",width:"1em",height:"1em"}),className:d,__css:f,..._}=n,v=_n("chakra-button__spinner",d),b=i==="start"?"marginEnd":"marginStart",C=N.useMemo(()=>({display:"flex",alignItems:"center",position:t?"relative":"absolute",[b]:t?a:0,fontSize:"1em",lineHeight:"normal",...f}),[f,t,b,a]);return T.jsx(Vt.div,{className:v,..._,__css:C,children:l})}XU.displayName="ButtonSpinner";function tNe(n){const[t,i]=N.useState(!n);return{ref:N.useCallback(d=>{d&&i(d.tagName==="BUTTON")},[]),type:t?"button":void 0}}const Jn=zt((n,t)=>{const i=eNe(),a=Xu("Button",{...i,...n}),{isDisabled:l=i==null?void 0:i.isDisabled,isLoading:d,isActive:f,children:_,leftIcon:v,rightIcon:b,loadingText:C,iconSpacing:I="0.5rem",type:O,spinner:L,spinnerPlacement:M="start",className:F,as:z,shouldWrapChildren:Z,...K}=Fi(n),re=N.useMemo(()=>{const X={...a==null?void 0:a._focus,zIndex:1};return{display:"inline-flex",appearance:"none",alignItems:"center",justifyContent:"center",userSelect:"none",position:"relative",whiteSpace:"nowrap",verticalAlign:"middle",outline:"none",...a,...!!i&&{_focus:X}}},[a,i]),{ref:ae,type:ne}=tNe(z),pe={rightIcon:b,leftIcon:v,iconSpacing:I,children:_,shouldWrapChildren:Z};return T.jsxs(Vt.button,{disabled:l||d,ref:xEe(t,ae),as:z,type:O??ne,"data-active":nr(f),"data-loading":nr(d),__css:re,className:_n("chakra-button",F),...K,children:[d&&M==="start"&&T.jsx(XU,{className:"chakra-button__spinner--start",label:C,placement:"start",spacing:I,children:L}),d?C||T.jsx(Vt.span,{opacity:0,children:T.jsx(yY,{...pe})}):T.jsx(yY,{...pe}),d&&M==="end"&&T.jsx(XU,{className:"chakra-button__spinner--end",label:C,placement:"end",spacing:I,children:L})]})});Jn.displayName="Button";function yY(n){const{leftIcon:t,rightIcon:i,children:a,iconSpacing:l,shouldWrapChildren:d}=n;return d?T.jsxs("span",{style:{display:"contents"},children:[t&&T.jsx(jw,{marginEnd:l,children:t}),a,i&&T.jsx(jw,{marginStart:l,children:i})]}):T.jsxs(T.Fragment,{children:[t&&T.jsx(jw,{marginEnd:l,children:t}),a,i&&T.jsx(jw,{marginStart:l,children:i})]})}const ko=zt((n,t)=>{const{icon:i,children:a,isRound:l,"aria-label":d,...f}=n,_=i||a,v=N.isValidElement(_)?N.cloneElement(_,{"aria-hidden":!0,focusable:!1}):null;return T.jsx(Jn,{px:"0",py:"0",borderRadius:l?"full":void 0,ref:t,"aria-label":d,...f,children:v})});ko.displayName="IconButton";const Rte=Vt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});Rte.displayName="Center";const nNe={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};zt(function(t,i){const{axis:a="both",...l}=t;return T.jsx(Vt.div,{ref:i,__css:nNe[a],...l,position:"absolute"})});var rNe=()=>typeof document<"u",EY=!1,eR=null,By=!1,JU=!1,QU=new Set;function dF(n,t){QU.forEach(i=>i(n,t))}var iNe=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function sNe(n){return!(n.metaKey||!iNe&&n.altKey||n.ctrlKey||n.key==="Control"||n.key==="Shift"||n.key==="Meta")}function vY(n){By=!0,sNe(n)&&(eR="keyboard",dF("keyboard",n))}function bS(n){if(eR="pointer",n.type==="mousedown"||n.type==="pointerdown"){By=!0;const t=n.composedPath?n.composedPath()[0]:n.target;let i=!1;try{i=t.matches(":focus-visible")}catch{}if(i)return;dF("pointer",n)}}function oNe(n){return n.mozInputSource===0&&n.isTrusted?!0:n.detail===0&&!n.pointerType}function aNe(n){oNe(n)&&(By=!0,eR="virtual")}function cNe(n){n.target===window||n.target===document||n.target instanceof Element&&n.target.hasAttribute("tabindex")||(!By&&!JU&&(eR="virtual",dF("virtual",n)),By=!1,JU=!1)}function lNe(){By=!1,JU=!0}function SY(){return eR!=="pointer"}function uNe(){if(!rNe()||EY)return;const{focus:n}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...i){By=!0,n.apply(this,i)},document.addEventListener("keydown",vY,!0),document.addEventListener("keyup",vY,!0),document.addEventListener("click",aNe,!0),window.addEventListener("focus",cNe,!0),window.addEventListener("blur",lNe,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",bS,!0),document.addEventListener("pointermove",bS,!0),document.addEventListener("pointerup",bS,!0)):(document.addEventListener("mousedown",bS,!0),document.addEventListener("mousemove",bS,!0),document.addEventListener("mouseup",bS,!0)),EY=!0}function dNe(n){uNe(),n(SY());const t=()=>n(SY());return QU.add(t),()=>{QU.delete(t)}}const[hNe,Ite]=Ti({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[pNe,B0]=Ti({strict:!1,name:"FormControlContext"});function fNe(n){const{id:t,isRequired:i,isInvalid:a,isDisabled:l,isReadOnly:d,...f}=n,_=N.useId(),v=t||`field-${_}`,b=`${v}-label`,C=`${v}-feedback`,I=`${v}-helptext`,[O,L]=N.useState(!1),[M,F]=N.useState(!1),[z,Z]=N.useState(!1),K=N.useCallback((X={},J=null)=>({id:I,...X,ref:Vi(J,Q=>{Q&&F(!0)})}),[I]),re=N.useCallback((X={},J=null)=>({...X,ref:J,"data-focus":nr(z),"data-disabled":nr(l),"data-invalid":nr(a),"data-readonly":nr(d),id:X.id!==void 0?X.id:b,htmlFor:X.htmlFor!==void 0?X.htmlFor:v}),[v,l,z,a,d,b]),ae=N.useCallback((X={},J=null)=>({id:C,...X,ref:Vi(J,Q=>{Q&&L(!0)}),"aria-live":"polite"}),[C]),ne=N.useCallback((X={},J=null)=>({...X,...f,ref:J,role:"group","data-focus":nr(z),"data-disabled":nr(l),"data-invalid":nr(a),"data-readonly":nr(d)}),[f,l,z,a,d]),pe=N.useCallback((X={},J=null)=>({...X,ref:J,role:"presentation","aria-hidden":!0,children:X.children||"*"}),[]);return{isRequired:!!i,isInvalid:!!a,isReadOnly:!!d,isDisabled:!!l,isFocused:!!z,onFocus:()=>Z(!0),onBlur:()=>Z(!1),hasFeedbackText:O,setHasFeedbackText:L,hasHelpText:M,setHasHelpText:F,id:v,labelId:b,feedbackId:C,helpTextId:I,htmlProps:f,getHelpTextProps:K,getErrorMessageProps:ae,getRootProps:ne,getLabelProps:re,getRequiredIndicatorProps:pe}}const kr=zt(function(t,i){const a=ka("Form",t),l=Fi(t),{getRootProps:d,htmlProps:f,..._}=fNe(l),v=_n("chakra-form-control",t.className);return T.jsx(pNe,{value:_,children:T.jsx(hNe,{value:a,children:T.jsx(Vt.div,{...d({},i),className:v,__css:a.container})})})});kr.displayName="FormControl";const n0=zt(function(t,i){const a=B0(),l=Ite(),d=_n("chakra-form__helper-text",t.className);return T.jsx(Vt.div,{...a==null?void 0:a.getHelpTextProps(t,i),__css:l.helperText,className:d})});n0.displayName="FormHelperText";function hF(n){const{isDisabled:t,isInvalid:i,isReadOnly:a,isRequired:l,...d}=pF(n);return{...d,disabled:t,readOnly:a,required:l,"aria-invalid":Lf(i),"aria-required":Lf(l),"aria-readonly":Lf(a)}}function pF(n){const t=B0(),{id:i,disabled:a,readOnly:l,required:d,isRequired:f,isInvalid:_,isReadOnly:v,isDisabled:b,onFocus:C,onBlur:I,...O}=n,L=n["aria-describedby"]?[n["aria-describedby"]]:[];return t!=null&&t.hasFeedbackText&&(t!=null&&t.isInvalid)&&L.push(t.feedbackId),t!=null&&t.hasHelpText&&L.push(t.helpTextId),{...O,"aria-describedby":L.join(" ")||void 0,id:i??(t==null?void 0:t.id),isDisabled:a??b??(t==null?void 0:t.isDisabled),isReadOnly:l??v??(t==null?void 0:t.isReadOnly),isRequired:d??f??(t==null?void 0:t.isRequired),isInvalid:_??(t==null?void 0:t.isInvalid),onFocus:Nn(t==null?void 0:t.onFocus,C),onBlur:Nn(t==null?void 0:t.onBlur,I)}}const mNe={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function gNe(n={}){const t=pF(n),{isDisabled:i,isReadOnly:a,isRequired:l,isInvalid:d,id:f,onBlur:_,onFocus:v,"aria-describedby":b}=t,{defaultChecked:C,isChecked:I,isFocusable:O,onChange:L,isIndeterminate:M,name:F,value:z,tabIndex:Z=void 0,"aria-label":K,"aria-labelledby":re,"aria-invalid":ae,...ne}=n,pe=L0(ne,["isDisabled","isReadOnly","isRequired","isInvalid","id","onBlur","onFocus","aria-describedby"]),X=to(L),J=to(_),Q=to(v),[se,de]=N.useState(!1),[he,le]=N.useState(!1),[Oe,Ve]=N.useState(!1),[xe,Re]=N.useState(!1);N.useEffect(()=>dNe(de),[]);const ve=N.useRef(null),[be,ze]=N.useState(!0),[Pe,we]=N.useState(!!C),ke=I!==void 0,Ue=ke?I:Pe,Be=N.useCallback(Lt=>{if(a||i){Lt.preventDefault();return}ke||we(Ue?Lt.currentTarget.checked:M?!0:Lt.currentTarget.checked),X==null||X(Lt)},[a,i,Ue,ke,M,X]);op(()=>{ve.current&&(ve.current.indeterminate=!!M)},[M]),zf(()=>{i&&le(!1)},[i,le]),op(()=>{const Lt=ve.current;if(!(Lt!=null&&Lt.form))return;const Xt=()=>{we(!!C)};return Lt.form.addEventListener("reset",Xt),()=>{var $t;return($t=Lt.form)==null?void 0:$t.removeEventListener("reset",Xt)}},[]);const qe=i&&!O,$e=N.useCallback(Lt=>{Lt.key===" "&&Re(!0)},[Re]),it=N.useCallback(Lt=>{Lt.key===" "&&Re(!1)},[Re]);op(()=>{if(!ve.current)return;ve.current.checked!==Ue&&we(ve.current.checked)},[ve.current]);const Je=N.useCallback((Lt={},Xt=null)=>{const $t=Te=>{he&&Te.preventDefault(),Re(!0)};return{...Lt,ref:Xt,"data-active":nr(xe),"data-hover":nr(Oe),"data-checked":nr(Ue),"data-focus":nr(he),"data-focus-visible":nr(he&&se),"data-indeterminate":nr(M),"data-disabled":nr(i),"data-invalid":nr(d),"data-readonly":nr(a),"aria-hidden":!0,onMouseDown:Nn(Lt.onMouseDown,$t),onMouseUp:Nn(Lt.onMouseUp,()=>Re(!1)),onMouseEnter:Nn(Lt.onMouseEnter,()=>Ve(!0)),onMouseLeave:Nn(Lt.onMouseLeave,()=>Ve(!1))}},[xe,Ue,i,he,se,Oe,M,d,a]),Ct=N.useCallback((Lt={},Xt=null)=>({...Lt,ref:Xt,"data-active":nr(xe),"data-hover":nr(Oe),"data-checked":nr(Ue),"data-focus":nr(he),"data-focus-visible":nr(he&&se),"data-indeterminate":nr(M),"data-disabled":nr(i),"data-invalid":nr(d),"data-readonly":nr(a)}),[xe,Ue,i,he,se,Oe,M,d,a]),kt=N.useCallback((Lt={},Xt=null)=>({...pe,htmlFor:be?f:void 0,...Lt,ref:Vi(Xt,$t=>{$t&&ze($t.tagName==="LABEL")}),onClick:Nn(Lt.onClick,()=>{var $t;be||(($t=ve.current)==null||$t.click(),requestAnimationFrame(()=>{var Te;(Te=ve.current)==null||Te.focus({preventScroll:!0})}))}),"data-disabled":nr(i),"data-checked":nr(Ue),"data-invalid":nr(d)}),[pe,i,Ue,d,be,f]),He=N.useCallback((Lt={},Xt=null)=>({...Lt,ref:Vi(ve,Xt),type:"checkbox",name:F,value:z,id:f,tabIndex:Z,onChange:Nn(Lt.onChange,Be),onBlur:Nn(Lt.onBlur,J,()=>le(!1)),onFocus:Nn(Lt.onFocus,Q,()=>le(!0)),onKeyDown:Nn(Lt.onKeyDown,$e),onKeyUp:Nn(Lt.onKeyUp,it),required:l,checked:Ue,disabled:qe,readOnly:a,"aria-label":K,"aria-labelledby":re,"aria-invalid":ae?!!ae:d,"aria-describedby":b,"aria-disabled":i,"aria-checked":M?"mixed":Ue,style:mNe}),[F,z,f,Z,Be,J,Q,$e,it,l,Ue,qe,a,K,re,ae,d,b,i,M]),lt=N.useCallback((Lt={},Xt=null)=>({...Lt,ref:Xt,onMouseDown:Nn(Lt.onMouseDown,_Ne),"data-disabled":nr(i),"data-checked":nr(Ue),"data-invalid":nr(d)}),[Ue,i,d]);return{state:{isInvalid:d,isFocused:he,isChecked:Ue,isActive:xe,isHovered:Oe,isIndeterminate:M,isDisabled:i,isReadOnly:a,isRequired:l},getRootProps:kt,getCheckboxProps:Je,getIndicatorProps:Ct,getInputProps:He,getLabelProps:lt,htmlProps:pe}}function _Ne(n){n.preventDefault(),n.stopPropagation()}const wg=zt(function(t,i){const{borderLeftWidth:a,borderBottomWidth:l,borderTopWidth:d,borderRightWidth:f,borderWidth:_,borderStyle:v,borderColor:b,...C}=Xu("Divider",t),{className:I,orientation:O="horizontal",__css:L,...M}=Fi(t),F={vertical:{borderLeftWidth:a||f||_||"1px",height:"100%"},horizontal:{borderBottomWidth:l||d||_||"1px",width:"100%"}};return T.jsx(Vt.hr,{ref:i,"aria-orientation":O,...M,__css:{...C,border:"0",borderColor:b,borderStyle:v,...F[O],...L},className:_n("chakra-divider",I)})});wg.displayName="Divider";const ji=zt(function(t,i){const{direction:a,align:l,justify:d,wrap:f,basis:_,grow:v,shrink:b,...C}=t,I={display:"flex",flexDirection:a,alignItems:l,justifyContent:d,flexWrap:f,flexBasis:_,flexGrow:v,flexShrink:b};return T.jsx(Vt.div,{ref:i,__css:I,...C})});ji.displayName="Flex";function yNe(n,t){if(n==null)return{};var i={};for(var a in n)if({}.hasOwnProperty.call(n,a)){if(t.indexOf(a)!==-1)continue;i[a]=n[a]}return i}var LM={exports:{}},MM,bY;function ENe(){if(bY)return MM;bY=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return MM=n,MM}var UM,TY;function vNe(){if(TY)return UM;TY=1;var n=ENe();function t(){}function i(){}return i.resetWarningCache=t,UM=function(){function a(f,_,v,b,C,I){if(I!==n){var O=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw O.name="Invariant Violation",O}}a.isRequired=a;function l(){return a}var d={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:l,element:a,elementType:a,instanceOf:l,node:a,objectOf:l,oneOf:l,oneOfType:l,shape:l,exact:l,checkPropTypes:i,resetWarningCache:t};return d.PropTypes=d,d},UM}var wY;function SNe(){return wY||(wY=1,LM.exports=vNe()()),LM.exports}var bNe=SNe();const Sn=Fg(bNe);var ZU="data-focus-lock",Ate="data-focus-lock-disabled",TNe="data-no-focus-lock",wNe="data-autofocus-inside",CNe="data-no-autofocus";function VM(n,t){return typeof n=="function"?n(t):n&&(n.current=t),n}function RNe(n,t){var i=N.useState(function(){return{value:n,callback:t,facade:{get current(){return i.value},set current(a){var l=i.value;l!==a&&(i.value=a,i.callback(a,l))}}}})[0];return i.callback=t,i.facade}var INe=typeof window<"u"?N.useLayoutEffect:N.useEffect,CY=new WeakMap;function Pte(n,t){var i=RNe(null,function(a){return n.forEach(function(l){return VM(l,a)})});return INe(function(){var a=CY.get(i);if(a){var l=new Set(a),d=new Set(n),f=i.current;l.forEach(function(_){d.has(_)||VM(_,null)}),d.forEach(function(_){l.has(_)||VM(_,f)})}CY.set(i,n)},[n]),i}var jM={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},Qh=function(){return Qh=Object.assign||function(t){for(var i,a=1,l=arguments.length;a<l;a++){i=arguments[a];for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&(t[d]=i[d])}return t},Qh.apply(this,arguments)};function tR(n,t){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(i[a[l]]=n[a[l]]);return i}function ANe(n,t,i){if(i||arguments.length===2)for(var a=0,l=t.length,d;a<l;a++)(d||!(a in t))&&(d||(d=Array.prototype.slice.call(t,0,a)),d[a]=t[a]);return n.concat(d||Array.prototype.slice.call(t))}function Ote(n){return n}function kte(n,t){t===void 0&&(t=Ote);var i=[],a=!1,l={read:function(){if(a)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:n},useMedium:function(d){var f=t(d,a);return i.push(f),function(){i=i.filter(function(_){return _!==f})}},assignSyncMedium:function(d){for(a=!0;i.length;){var f=i;i=[],f.forEach(d)}i={push:function(_){return d(_)},filter:function(){return i}}},assignMedium:function(d){a=!0;var f=[];if(i.length){var _=i;i=[],_.forEach(d),f=i}var v=function(){var C=f;f=[],C.forEach(d)},b=function(){return Promise.resolve().then(v)};b(),i={push:function(C){f.push(C),b()},filter:function(C){return f=f.filter(C),i}}}};return l}function fF(n,t){return t===void 0&&(t=Ote),kte(n,t)}function Nte(n){n===void 0&&(n={});var t=kte(null);return t.options=Qh({async:!0,ssr:!1},n),t}var Dte=function(n){var t=n.sideCar,i=tR(n,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var a=t.read();if(!a)throw new Error("Sidecar medium not found");return N.createElement(a,Qh({},i))};Dte.isSideCarExport=!0;function PNe(n,t){return n.useMedium(t),Dte}var xte=fF({},function(n){var t=n.target,i=n.currentTarget;return{target:t,currentTarget:i}}),Lte=fF(),ONe=fF(),kNe=Nte({async:!0,ssr:typeof document<"u"}),NNe=N.createContext(void 0),DNe=[],mF=N.forwardRef(function(t,i){var a,l=N.useState(),d=l[0],f=l[1],_=N.useRef(),v=N.useRef(!1),b=N.useRef(null),C=N.useState({}),I=C[1],O=t.children,L=t.disabled,M=L===void 0?!1:L,F=t.noFocusGuards,z=F===void 0?!1:F,Z=t.persistentFocus,K=Z===void 0?!1:Z,re=t.crossFrame,ae=re===void 0?!0:re,ne=t.autoFocus,pe=ne===void 0?!0:ne;t.allowTextSelection;var X=t.group,J=t.className,Q=t.whiteList,se=t.hasPositiveIndices,de=t.shards,he=de===void 0?DNe:de,le=t.as,Oe=le===void 0?"div":le,Ve=t.lockProps,xe=Ve===void 0?{}:Ve,Re=t.sideCar,ve=t.returnFocus,be=ve===void 0?!1:ve,ze=t.focusOptions,Pe=t.onActivation,we=t.onDeactivation,ke=N.useState({}),Ue=ke[0],Be=N.useCallback(function(Xt){var $t=Xt.captureFocusRestore;if(!b.current){var Te,je=(Te=document)==null?void 0:Te.activeElement;b.current=je,je!==document.body&&(b.current=$t(je))}_.current&&Pe&&Pe(_.current),v.current=!0,I()},[Pe]),qe=N.useCallback(function(){v.current=!1,we&&we(_.current),I()},[we]),$e=N.useCallback(function(Xt){var $t=b.current;if($t){var Te=(typeof $t=="function"?$t():$t)||document.body,je=typeof be=="function"?be(Te):be;if(je){var Ke=typeof je=="object"?je:void 0;b.current=null,Xt?Promise.resolve().then(function(){return Te.focus(Ke)}):Te.focus(Ke)}}},[be]),it=N.useCallback(function(Xt){v.current&&xte.useMedium(Xt)},[]),Je=Lte.useMedium,Ct=N.useCallback(function(Xt){_.current!==Xt&&(_.current=Xt,f(Xt))},[]),kt=Fy((a={},a[Ate]=M&&"disabled",a[ZU]=X,a),xe),He=z!==!0,lt=He&&z!=="tail",mt=Pte([i,Ct]),Lt=N.useMemo(function(){return{observed:_,shards:he,enabled:!M,active:v.current}},[M,v.current,he,d]);return hi.createElement(N.Fragment,null,He&&[hi.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:M?-1:0,style:jM}),se?hi.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:M?-1:1,style:jM}):null],!M&&hi.createElement(Re,{id:Ue,sideCar:kNe,observed:d,disabled:M,persistentFocus:K,crossFrame:ae,autoFocus:pe,whiteList:Q,shards:he,onActivation:Be,onDeactivation:qe,returnFocus:$e,focusOptions:ze,noFocusGuards:z}),hi.createElement(Oe,Fy({ref:mt},kt,{className:J,onBlur:Je,onFocus:it}),hi.createElement(NNe.Provider,{value:Lt},O)),lt&&hi.createElement("div",{"data-focus-guard":!0,tabIndex:M?-1:0,style:jM}))});mF.propTypes={};function eV(n,t){return eV=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,a){return i.__proto__=a,i},eV(n,t)}function xNe(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,eV(n,t)}function AC(n){"@babel/helpers - typeof";return AC=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},AC(n)}function LNe(n,t){if(AC(n)!="object"||!n)return n;var i=n[Symbol.toPrimitive];if(i!==void 0){var a=i.call(n,t);if(AC(a)!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function MNe(n){var t=LNe(n,"string");return AC(t)=="symbol"?t:t+""}function UNe(n,t,i){return(t=MNe(t))in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function VNe(n,t){function i(a){return a.displayName||a.name||"Component"}return function(l){var d=[],f;function _(){f=n(d.map(function(b){return b.props})),t(f)}var v=function(b){xNe(C,b);function C(){return b.apply(this,arguments)||this}C.peek=function(){return f};var I=C.prototype;return I.componentDidMount=function(){d.push(this),_()},I.componentDidUpdate=function(){_()},I.componentWillUnmount=function(){var L=d.indexOf(this);d.splice(L,1),_()},I.render=function(){return hi.createElement(l,this.props)},C}(N.PureComponent);return UNe(v,"displayName","SideEffect("+i(l)+")"),v}}var Tp=function(n){for(var t=Array(n.length),i=0;i<n.length;++i)t[i]=n[i];return t},zy=function(n){return Array.isArray(n)?n:[n]},Mte=function(n){return Array.isArray(n)?n[0]:n},jNe=function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var t=window.getComputedStyle(n,null);return!t||!t.getPropertyValue?!1:t.getPropertyValue("display")==="none"||t.getPropertyValue("visibility")==="hidden"},Ute=function(n){return n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode},Vte=function(n){return n===document||n&&n.nodeType===Node.DOCUMENT_NODE},FNe=function(n){return n.hasAttribute("inert")},BNe=function(n,t){return!n||Vte(n)||!jNe(n)&&!FNe(n)&&t(Ute(n))},jte=function(n,t){var i=n.get(t);if(i!==void 0)return i;var a=BNe(t,jte.bind(void 0,n));return n.set(t,a),a},zNe=function(n,t){return n&&!Vte(n)?HNe(n)?t(Ute(n)):!1:!0},Fte=function(n,t){var i=n.get(t);if(i!==void 0)return i;var a=zNe(t,Fte.bind(void 0,n));return n.set(t,a),a},Bte=function(n){return n.dataset},WNe=function(n){return n.tagName==="BUTTON"},zte=function(n){return n.tagName==="INPUT"},Wte=function(n){return zte(n)&&n.type==="radio"},GNe=function(n){return!((zte(n)||WNe(n))&&(n.type==="hidden"||n.disabled))},HNe=function(n){var t=n.getAttribute(CNe);return![!0,"true",""].includes(t)},gF=function(n){var t;return!!(n&&(!((t=Bte(n))===null||t===void 0)&&t.focusGuard))},tV=function(n){return!gF(n)},$Ne=function(n){return!!n},KNe=function(n,t){var i=Math.max(0,n.tabIndex),a=Math.max(0,t.tabIndex),l=i-a,d=n.index-t.index;if(l){if(!i)return 1;if(!a)return-1}return l||d},qNe=function(n){return n.tabIndex<0&&!n.hasAttribute("tabindex")?0:n.tabIndex},_F=function(n,t,i){return Tp(n).map(function(a,l){var d=qNe(a);return{node:a,index:l,tabIndex:i&&d===-1?(a.dataset||{}).focusGuard?0:-1:d}}).filter(function(a){return!t||a.tabIndex>=0}).sort(KNe)},YNe=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"],yF=YNe.join(","),XNe="".concat(yF,", [data-focus-guard]"),Gte=function(n,t){return Tp((n.shadowRoot||n).children).reduce(function(i,a){return i.concat(a.matches(t?XNe:yF)?[a]:[],Gte(a))},[])},JNe=function(n,t){var i;return n instanceof HTMLIFrameElement&&(!((i=n.contentDocument)===null||i===void 0)&&i.body)?y0([n.contentDocument.body],t):[n]},y0=function(n,t){return n.reduce(function(i,a){var l,d=Gte(a,t),f=(l=[]).concat.apply(l,d.map(function(_){return JNe(_,t)}));return i.concat(f,a.parentNode?Tp(a.parentNode.querySelectorAll(yF)).filter(function(_){return _===a}):[])},[])},QNe=function(n){var t=n.querySelectorAll("[".concat(wNe,"]"));return Tp(t).map(function(i){return y0([i])}).reduce(function(i,a){return i.concat(a)},[])},EF=function(n,t){return Tp(n).filter(function(i){return jte(t,i)}).filter(function(i){return GNe(i)})},RY=function(n,t){return t===void 0&&(t=new Map),Tp(n).filter(function(i){return Fte(t,i)})},vF=function(n,t,i){return _F(EF(y0(n,i),t),!0,i)},PC=function(n,t){return _F(EF(y0(n),t),!1)},ZNe=function(n,t){return EF(QNe(n),t)},xy=function(n,t){return n.shadowRoot?xy(n.shadowRoot,t):Object.getPrototypeOf(n).contains!==void 0&&Object.getPrototypeOf(n).contains.call(n,t)?!0:Tp(n.children).some(function(i){var a;if(i instanceof HTMLIFrameElement){var l=(a=i.contentDocument)===null||a===void 0?void 0:a.body;return l?xy(l,t):!1}return xy(i,t)})},eDe=function(n){for(var t=new Set,i=n.length,a=0;a<i;a+=1)for(var l=a+1;l<i;l+=1){var d=n[a].compareDocumentPosition(n[l]);(d&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&t.add(l),(d&Node.DOCUMENT_POSITION_CONTAINS)>0&&t.add(a)}return n.filter(function(f,_){return!t.has(_)})},Hte=function(n){return n.parentNode?Hte(n.parentNode):n},SF=function(n){var t=zy(n);return t.filter(Boolean).reduce(function(i,a){var l=a.getAttribute(ZU);return i.push.apply(i,l?eDe(Tp(Hte(a).querySelectorAll("[".concat(ZU,'="').concat(l,'"]:not([').concat(Ate,'="disabled"])')))):[a]),i},[])},tDe=function(n){try{return n()}catch{return}},OC=function(n){if(n===void 0&&(n=document),!(!n||!n.activeElement)){var t=n.activeElement;return t.shadowRoot?OC(t.shadowRoot):t instanceof HTMLIFrameElement&&tDe(function(){return t.contentWindow.document})?OC(t.contentWindow.document):t}},nDe=function(n,t){return n===t},rDe=function(n,t){return!!Tp(n.querySelectorAll("iframe")).some(function(i){return nDe(i,t)})},$te=function(n,t){return t===void 0&&(t=OC(Mte(n).ownerDocument)),!t||t.dataset&&t.dataset.focusGuard?!1:SF(n).some(function(i){return xy(i,t)||rDe(i,t)})},iDe=function(n){n===void 0&&(n=document);var t=OC(n);return t?Tp(n.querySelectorAll("[".concat(TNe,"]"))).some(function(i){return xy(i,t)}):!1},sDe=function(n,t){return t.filter(Wte).filter(function(i){return i.name===n.name}).filter(function(i){return i.checked})[0]||n},bF=function(n,t){return Wte(n)&&n.name?sDe(n,t):n},oDe=function(n){var t=new Set;return n.forEach(function(i){return t.add(bF(i,n))}),n.filter(function(i){return t.has(i)})},IY=function(n){return n[0]&&n.length>1?bF(n[0],n):n[0]},AY=function(n,t){return n.indexOf(bF(t,n))},nV="NEW_FOCUS",aDe=function(n,t,i,a,l){var d=n.length,f=n[0],_=n[d-1],v=gF(a);if(!(a&&n.indexOf(a)>=0)){var b=a!==void 0?i.indexOf(a):-1,C=l?i.indexOf(l):b,I=l?n.indexOf(l):-1;if(b===-1)return I!==-1?I:nV;if(I===-1)return nV;var O=b-C,L=i.indexOf(f),M=i.indexOf(_),F=oDe(i),z=a!==void 0?F.indexOf(a):-1,Z=l?F.indexOf(l):z,K=F.filter(function(J){return J.tabIndex>=0}),re=a!==void 0?K.indexOf(a):-1,ae=l?K.indexOf(l):re,ne=re>=0&&ae>=0?ae-re:Z-z;if(!O&&I>=0||t.length===0)return I;var pe=AY(n,t[0]),X=AY(n,t[t.length-1]);if(b<=L&&v&&Math.abs(O)>1)return X;if(b>=M&&v&&Math.abs(O)>1)return pe;if(O&&Math.abs(ne)>1)return I;if(b<=L)return X;if(b>M)return pe;if(O)return Math.abs(O)>1?I:(d+I+O)%d}},cDe=function(n){return function(t){var i,a=(i=Bte(t))===null||i===void 0?void 0:i.autofocus;return t.autofocus||a!==void 0&&a!=="false"||n.indexOf(t)>=0}},PY=function(n,t,i){var a=n.map(function(d){var f=d.node;return f}),l=RY(a.filter(cDe(i)));return l&&l.length?IY(l):IY(RY(t))},rV=function(n,t){return t===void 0&&(t=[]),t.push(n),n.parentNode&&rV(n.parentNode.host||n.parentNode,t),t},FM=function(n,t){for(var i=rV(n),a=rV(t),l=0;l<i.length;l+=1){var d=i[l];if(a.indexOf(d)>=0)return d}return!1},Kte=function(n,t,i){var a=zy(n),l=zy(t),d=a[0],f=!1;return l.filter(Boolean).forEach(function(_){f=FM(f||_,_)||f,i.filter(Boolean).forEach(function(v){var b=FM(d,v);b&&(!f||xy(b,f)?f=b:f=FM(b,f))})}),f},OY=function(n,t){return n.reduce(function(i,a){return i.concat(ZNe(a,t))},[])},lDe=function(n,t){var i=new Map;return t.forEach(function(a){return i.set(a.node,a)}),n.map(function(a){return i.get(a)}).filter($Ne)},uDe=function(n,t){var i=OC(zy(n).length>0?document:Mte(n).ownerDocument),a=SF(n).filter(tV),l=Kte(i||n,n,a),d=new Map,f=PC(a,d),_=f.filter(function(M){var F=M.node;return tV(F)});if(_[0]){var v=PC([l],d).map(function(M){var F=M.node;return F}),b=lDe(v,_),C=b.map(function(M){var F=M.node;return F}),I=b.filter(function(M){var F=M.tabIndex;return F>=0}).map(function(M){var F=M.node;return F}),O=aDe(C,I,v,i,t);if(O===nV){var L=PY(f,I,OY(a,d))||PY(f,C,OY(a,d));if(L)return{node:L};console.warn("focus-lock: cannot find any node to move focus into");return}return O===void 0?O:b[O]}},dDe=function(n){var t=SF(n).filter(tV),i=Kte(n,n,t),a=_F(y0([i],!0),!0,!0),l=y0(t,!1);return a.map(function(d){var f=d.node,_=d.index;return{node:f,index:_,lockItem:l.indexOf(f)>=0,guard:gF(f)}})},TF=function(n,t){n&&("focus"in n&&n.focus(t),"contentWindow"in n&&n.contentWindow&&n.contentWindow.focus())},BM=0,zM=!1,qte=function(n,t,i){i===void 0&&(i={});var a=uDe(n,t);if(!zM&&a){if(BM>2){console.error("FocusLock: focus-fighting detected. Only one focus management system could be active. See https://github.com/theKashey/focus-lock/#focus-fighting"),zM=!0,setTimeout(function(){zM=!1},1);return}BM++,TF(a.node,i.focusOptions),BM--}};function gw(n){if(!n)return null;if(typeof WeakRef>"u")return function(){return n||null};var t=n?new WeakRef(n):null;return function(){return(t==null?void 0:t.deref())||null}}var hDe=function(n){if(!n)return null;for(var t=[],i=n;i&&i!==document.body;)t.push({current:gw(i),parent:gw(i.parentElement),left:gw(i.previousElementSibling),right:gw(i.nextElementSibling)}),i=i.parentElement;return{element:gw(n),stack:t,ownerDocument:n.ownerDocument}},pDe=function(n){var t,i,a,l,d;if(n)for(var f=n.stack,_=n.ownerDocument,v=new Map,b=0,C=f;b<C.length;b++){var I=C[b],O=(t=I.parent)===null||t===void 0?void 0:t.call(I);if(O&&_.contains(O)){for(var L=(i=I.left)===null||i===void 0?void 0:i.call(I),M=I.current(),F=O.contains(M)?M:void 0,z=(a=I.right)===null||a===void 0?void 0:a.call(I),Z=vF([O],v),K=(d=(l=F??(L==null?void 0:L.nextElementSibling))!==null&&l!==void 0?l:z)!==null&&d!==void 0?d:L;K;){for(var re=0,ae=Z;re<ae.length;re++){var ne=ae[re];if(K!=null&&K.contains(ne.node))return ne.node}K=K.nextElementSibling}if(Z.length)return Z[0].node}}},Yte=function(n){var t=hDe(n);return function(){return pDe(t)}},fDe=function(n,t,i){if(!n||!t)return console.error("no element or scope given"),{};var a=zy(t);if(a.every(function(f){return!xy(f,n)}))return console.error("Active element is not contained in the scope"),{};var l=i?vF(a,new Map):PC(a,new Map),d=l.findIndex(function(f){var _=f.node;return _===n});if(d!==-1)return{prev:l[d-1],next:l[d+1],first:l[0],last:l[l.length-1]}},mDe=function(n,t){var i=t?vF(zy(n),new Map):PC(zy(n),new Map);return{first:i[0],last:i[i.length-1]}},gDe=function(n){return Object.assign({scope:document.body,cycle:!0,onlyTabbable:!0},n)},Xte=function(n,t,i){t===void 0&&(t={});var a=gDe(t),l=fDe(n,a.scope,a.onlyTabbable);if(l){var d=i(l,a.cycle);d&&TF(d.node,a.focusOptions)}},_De=function(n,t){t===void 0&&(t={}),Xte(n,t,function(i,a){var l=i.next,d=i.first;return l||a&&d})},yDe=function(n,t){t===void 0&&(t={}),Xte(n,t,function(i,a){var l=i.prev,d=i.last;return l||a&&d})},Jte=function(n,t,i){var a,l=mDe(n,(a=t.onlyTabbable)!==null&&a!==void 0?a:!0),d=l[i];d&&TF(d.node,t.focusOptions)},EDe=function(n,t){t===void 0&&(t={}),Jte(n,t,"first")},vDe=function(n,t){t===void 0&&(t={}),Jte(n,t,"last")};function wF(n){setTimeout(n,1)}var SDe=function(t){return t&&"current"in t?t.current:t},Qte=function(){return document&&document.activeElement===document.body},bDe=function(){return Qte()||iDe()},r0=null,ul=null,kY=function(){return null},i0=null,kC=!1,CF=!1,TDe=function(){return!0},wDe=function(t){return(r0.whiteList||TDe)(t)},CDe=function(t,i){i0={observerNode:t,portaledElement:i}},RDe=function(t){return i0&&i0.portaledElement===t};function NY(n,t,i,a){var l=null,d=n;do{var f=a[d];if(f.guard)f.node.dataset.focusAutoGuard&&(l=f);else if(f.lockItem){if(d!==n)return;l=null}else break}while((d+=i)!==t);l&&(l.node.tabIndex=0)}var IDe=function(t){return t?!!kC:kC==="meanwhile"},ADe=function n(t,i,a){return i&&(i.host===t&&(!i.activeElement||a.contains(i.activeElement))||i.parentNode&&n(t,i.parentNode,a))},PDe=function(t,i){return i.some(function(a){return ADe(t,a,a)})},Zte=function(t){return PC(t,new Map)},ODe=function(t){return!Zte([t.parentNode]).some(function(i){return i.node===t})},kk=function(){var t=!1;if(r0){var i=r0,a=i.observed,l=i.persistentFocus,d=i.autoFocus,f=i.shards,_=i.crossFrame,v=i.focusOptions,b=i.noFocusGuards,C=a||i0&&i0.portaledElement;if(Qte()&&ul&&ul!==document.body&&(!document.body.contains(ul)||ODe(ul))){var I=kY();I&&I.focus()}var O=document&&document.activeElement;if(C){var L=[C].concat(f.map(SDe).filter(Boolean)),M=function(){if(!IDe(_)||!b||!ul||CF)return!1;var re=Zte(L),ae=re.findIndex(function(ne){var pe=ne.node;return pe===ul});return ae===0||ae===re.length-1};if((!O||wDe(O))&&(l||M()||!bDe()||!ul&&d)&&(C&&!($te(L)||O&&PDe(O,L)||RDe(O))&&(document&&!ul&&O&&!d?(O.blur&&O.blur(),document.body.focus()):(t=qte(L,ul,{focusOptions:v}),i0={})),ul=document&&document.activeElement,ul!==document.body&&(kY=Yte(ul)),kC=!1),document&&O!==document.activeElement&&document.querySelector("[data-focus-auto-guard]")){var F=document&&document.activeElement,z=dDe(L),Z=z.map(function(K){var re=K.node;return re}).indexOf(F);Z>-1&&(z.filter(function(K){var re=K.guard,ae=K.node;return re&&ae.dataset.focusAutoGuard}).forEach(function(K){var re=K.node;return re.removeAttribute("tabIndex")}),NY(Z,z.length,1,z),NY(Z,-1,-1,z))}}}return t},ene=function(t){kk()&&t&&(t.stopPropagation(),t.preventDefault())},RF=function(){return wF(kk)},kDe=function(t){var i=t.target,a=t.currentTarget;a.contains(i)||CDe(a,i)},NDe=function(){return null},tne=function(){CF=!0},nne=function(){CF=!1,kC="just",wF(function(){kC="meanwhile"})},DDe=function(){document.addEventListener("focusin",ene),document.addEventListener("focusout",RF),window.addEventListener("focus",tne),window.addEventListener("blur",nne)},xDe=function(){document.removeEventListener("focusin",ene),document.removeEventListener("focusout",RF),window.removeEventListener("focus",tne),window.removeEventListener("blur",nne)};function LDe(n){return n.filter(function(t){var i=t.disabled;return!i})}var rne={moveFocusInside:qte,focusInside:$te,focusNextElement:_De,focusPrevElement:yDe,focusFirstElement:EDe,focusLastElement:vDe,captureFocusRestore:Yte};function MDe(n){var t=n.slice(-1)[0];t&&!r0&&DDe();var i=r0,a=i&&t&&t.id===i.id;r0=t,i&&!a&&(i.onDeactivation(),n.filter(function(l){var d=l.id;return d===i.id}).length||i.returnFocus(!t)),t?(ul=null,(!a||i.observed!==t.observed)&&t.onActivation(rne),kk(),wF(kk)):(xDe(),ul=null)}xte.assignSyncMedium(kDe);Lte.assignMedium(RF);ONe.assignMedium(function(n){return n(rne)});const UDe=VNe(LDe,MDe)(NDe);var iV=N.forwardRef(function(t,i){return hi.createElement(mF,Fy({sideCar:UDe,ref:i},t))}),ine=mF.propTypes||{};ine.sideCar;yNe(ine,["sideCar"]);iV.propTypes={};const VDe=iV.default??iV,sne=n=>{const{initialFocusRef:t,finalFocusRef:i,contentRef:a,restoreFocus:l,children:d,isDisabled:f,autoFocus:_,persistentFocus:v,lockFocusAcrossFrames:b}=n,C=N.useCallback(()=>{t!=null&&t.current?t.current.focus():a!=null&&a.current&&WQ(a.current).length===0&&requestAnimationFrame(()=>{var M;(M=a.current)==null||M.focus()})},[t,a]),I=N.useCallback(()=>{var L;(L=i==null?void 0:i.current)==null||L.focus()},[i]),O=l&&!i;return T.jsx(VDe,{crossFrame:b,persistentFocus:v,autoFocus:_,disabled:f,onActivation:C,onDeactivation:I,returnFocus:O,children:d})};sne.displayName="FocusLock";const[jDe,FDe]=Ti({name:"FormErrorStylesContext",errorMessage:`useFormErrorStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormError />" `}),Xh=zt((n,t)=>{const i=ka("FormError",n),a=Fi(n),l=B0();return l!=null&&l.isInvalid?T.jsx(jDe,{value:i,children:T.jsx(Vt.div,{...l==null?void 0:l.getErrorMessageProps(a,t),className:_n("chakra-form__error-message",n.className),__css:{display:"flex",alignItems:"center",...i.text}})}):null});Xh.displayName="FormErrorMessage";const BDe=zt((n,t)=>{const i=FDe(),a=B0();if(!(a!=null&&a.isInvalid))return null;const l=_n("chakra-form__error-icon",n.className);return T.jsx(En,{ref:t,"aria-hidden":!0,...n,__css:i.icon,className:l,children:T.jsx("path",{fill:"currentColor",d:"M11.983,0a12.206,12.206,0,0,0-8.51,3.653A11.8,11.8,0,0,0,0,12.207,11.779,11.779,0,0,0,11.8,24h.214A12.111,12.111,0,0,0,24,11.791h0A11.766,11.766,0,0,0,11.983,0ZM10.5,16.542a1.476,1.476,0,0,1,1.449-1.53h.027a1.527,1.527,0,0,1,1.523,1.47,1.475,1.475,0,0,1-1.449,1.53h-.027A1.529,1.529,0,0,1,10.5,16.542ZM11,12.5v-6a1,1,0,0,1,2,0v6a1,1,0,1,1-2,0Z"})})});BDe.displayName="FormErrorIcon";const Gi=zt(function(t,i){const a=Xu("FormLabel",t),l=Fi(t),{className:d,children:f,requiredIndicator:_=T.jsx(one,{}),optionalIndicator:v=null,...b}=l,C=B0(),I=(C==null?void 0:C.getLabelProps(b,i))??{ref:i,...b};return T.jsxs(Vt.label,{...I,className:_n("chakra-form__label",l.className),__css:{display:"block",textAlign:"start",...a},children:[f,C!=null&&C.isRequired?_:v]})});Gi.displayName="FormLabel";const one=zt(function(t,i){const a=B0(),l=Ite();if(!(a!=null&&a.isRequired))return null;const d=_n("chakra-form__required-indicator",t.className);return T.jsx(Vt.span,{...a==null?void 0:a.getRequiredIndicatorProps(t,i),__css:l.requiredIndicator,className:d})});one.displayName="RequiredIndicator";const IF=zt(function(t,i){const{templateAreas:a,gap:l,rowGap:d,columnGap:f,column:_,row:v,autoFlow:b,autoRows:C,templateRows:I,autoColumns:O,templateColumns:L,...M}=t,F={display:"grid",gridTemplateAreas:a,gridGap:l,gridRowGap:d,gridColumnGap:f,gridAutoColumns:O,gridColumn:_,gridRow:v,gridAutoFlow:b,gridAutoRows:C,gridTemplateRows:I,gridTemplateColumns:L};return T.jsx(Vt.div,{ref:i,__css:F,...M})});IF.displayName="Grid";const ane=zt(function(t,i){const{columns:a,spacingX:l,spacingY:d,spacing:f,minChildWidth:_,...v}=t,b=F0(),C=_?WDe(_,b):GDe(a);return T.jsx(IF,{ref:i,gap:f,columnGap:l,rowGap:d,templateColumns:C,...v})});ane.displayName="SimpleGrid";function zDe(n){return typeof n=="number"?`${n}px`:n}function WDe(n,t){return aj(n,i=>{const a=b1e("sizes",i,zDe(i))(t);return i===null?null:`repeat(auto-fit, minmax(${a}, 1fr))`})}function GDe(n){return aj(n,t=>t===null?null:`repeat(${t}, minmax(0, 1fr))`)}function zg(n){const{viewBox:t="0 0 24 24",d:i,displayName:a,defaultProps:l={}}=n,d=N.Children.toArray(n.path),f=zt((_,v)=>T.jsx(En,{ref:v,viewBox:t,...l,..._,children:d.length?d:T.jsx("path",{fill:"currentColor",d:i})}));return f.displayName=a,f}const sV=zt(function(t,i){const{htmlWidth:a,htmlHeight:l,alt:d,...f}=t;return T.jsx("img",{width:a,height:l,ref:i,alt:d,...f})});sV.displayName="NativeImage";const rp=zt(function(t,i){const{fallbackSrc:a,fallback:l,src:d,srcSet:f,align:_,fit:v,loading:b,ignoreFallback:C,crossOrigin:I,fallbackStrategy:O="beforeLoadOrError",referrerPolicy:L,...M}=t,F=a!==void 0||l!==void 0,z=b!=null||C||!F,Z=wte({...t,crossOrigin:I,ignoreFallback:z}),K=Q1e(Z,O),re={ref:i,objectFit:v,objectPosition:_,...z?M:L0(M,["onError","onLoad"])};return K?l||T.jsx(Vt.img,{as:sV,className:"chakra-image__placeholder",src:a,...re}):T.jsx(Vt.img,{as:sV,src:d,srcSet:f,crossOrigin:I,loading:b,referrerPolicy:L,className:"chakra-image",...re})});rp.displayName="Image";const Hi=zt(function(t,i){const{htmlSize:a,...l}=t,d=ka("Input",l),f=Fi(l),_=hF(f),v=_n("chakra-input",t.className);return T.jsx(Vt.input,{size:a,..._,__css:d.field,ref:i,className:v})});Hi.displayName="Input";Hi.id="Input";const[HDe,cne]=Ti({name:"InputGroupStylesContext",errorMessage:`useInputGroupStyles returned is 'undefined'. Seems you forgot to wrap the components in "<InputGroup />" `}),Ly=zt(function(t,i){const a=ka("Input",t),{children:l,className:d,...f}=Fi(t),_=_n("chakra-input__group",d),v={},b=c1(l),C=a.field;b.forEach(O=>{a&&(C&&O.type.id==="InputLeftElement"&&(v.paddingStart=C.height??C.h),C&&O.type.id==="InputRightElement"&&(v.paddingEnd=C.height??C.h),O.type.id==="InputRightAddon"&&(v.borderEndRadius=0),O.type.id==="InputLeftAddon"&&(v.borderStartRadius=0))});const I=b.map(O=>{var M,F;const L=l1({size:((M=O.props)==null?void 0:M.size)||t.size,variant:((F=O.props)==null?void 0:F.variant)||t.variant});return O.type.id!=="Input"?N.cloneElement(O,L):N.cloneElement(O,Object.assign(L,v,O.props))});return T.jsx(Vt.div,{className:_,ref:i,__css:{width:"100%",display:"flex",position:"relative",isolation:"isolate",...a.group},"data-group":!0,...f,children:T.jsx(HDe,{value:a,children:I})})});Ly.displayName="InputGroup";const $De={left:{marginEnd:"-1px",borderEndRadius:0,borderEndColor:"transparent"},right:{marginStart:"-1px",borderStartRadius:0,borderStartColor:"transparent"}},KDe=Vt("div",{baseStyle:{flex:"0 0 auto",width:"auto",display:"flex",alignItems:"center",whiteSpace:"nowrap"}}),AF=zt(function(t,i){const{placement:a="left",...l}=t,d=$De[a]??{},f=cne();return T.jsx(KDe,{ref:i,...l,__css:{...f.addon,...d}})});AF.displayName="InputAddon";const PF=zt(function(t,i){return T.jsx(AF,{ref:i,placement:"left",...t,className:_n("chakra-input__left-addon",t.className)})});PF.displayName="InputLeftAddon";PF.id="InputLeftAddon";const lne=zt(function(t,i){return T.jsx(AF,{ref:i,placement:"right",...t,className:_n("chakra-input__right-addon",t.className)})});lne.displayName="InputRightAddon";lne.id="InputRightAddon";const qDe=Vt("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:"0",zIndex:2}}),C1=zt(function(t,i){const{placement:a="left",...l}=t,d=cne(),f=d.field,v={[a==="left"?"insetStart":"insetEnd"]:"0",width:(f==null?void 0:f.height)??(f==null?void 0:f.h),height:(f==null?void 0:f.height)??(f==null?void 0:f.h),fontSize:f==null?void 0:f.fontSize,...d.element};return T.jsx(qDe,{ref:i,__css:v,...l})});C1.id="InputElement";C1.displayName="InputElement";const oC=zt(function(t,i){const{className:a,...l}=t,d=_n("chakra-input__left-element",a);return T.jsx(C1,{ref:i,placement:"left",className:d,...l})});oC.id="InputLeftElement";oC.displayName="InputLeftElement";const Nk=zt(function(t,i){const{className:a,...l}=t,d=_n("chakra-input__right-element",a);return T.jsx(C1,{ref:i,placement:"right",className:d,...l})});Nk.id="InputRightElement";Nk.displayName="InputRightElement";const Gl=zt(function(t,i){const a=Xu("Link",t),{className:l,isExternal:d,...f}=Fi(t);return T.jsx(Vt.a,{target:d?"_blank":void 0,rel:d?"noopener":void 0,ref:i,className:_n("chakra-link",l),...f,__css:a})});Gl.displayName="Link";const[YDe,une]=Ti({name:"ListStylesContext",errorMessage:`useListStyles returned is 'undefined'. Seems you forgot to wrap the components in "<List />" `}),R1=zt(function(t,i){const a=ka("List",t),{children:l,styleType:d="none",stylePosition:f,spacing:_,...v}=Fi(t),b=c1(l),I=_?{["& > *:not(style) ~ *:not(style)"]:{mt:_}}:{};return T.jsx(YDe,{value:a,children:T.jsx(Vt.ul,{ref:i,listStyleType:d,listStylePosition:f,role:"list",__css:{...a.container,...I},...v,children:b})})});R1.displayName="List";const XDe=zt((n,t)=>{const{as:i,...a}=n;return T.jsx(R1,{ref:t,as:"ol",styleType:"decimal",marginStart:"1em",...a})});XDe.displayName="OrderedList";const JDe=zt(function(t,i){const{as:a,...l}=t;return T.jsx(R1,{ref:i,as:"ul",styleType:"initial",marginStart:"1em",...l})});JDe.displayName="UnorderedList";const dne=zt(function(t,i){const a=une();return T.jsx(Vt.li,{ref:i,...t,__css:a.item})});dne.displayName="ListItem";const QDe=zt(function(t,i){const a=une();return T.jsx(En,{ref:i,role:"presentation",...t,__css:a.icon})});QDe.displayName="ListIcon";function ZDe(n,t={}){const{ssr:i=!0,fallback:a}=t,{getWindow:l}=CIe(),d=Array.isArray(n)?n:[n];let f=Array.isArray(a)?a:[a];f=f.filter(b=>b!=null);const[_,v]=N.useState(()=>d.map((b,C)=>({media:b,matches:i?!!f[C]:l().matchMedia(b).matches})));return N.useEffect(()=>{const b=l();v(d.map(O=>({media:O,matches:b.matchMedia(O).matches})));const C=d.map(O=>b.matchMedia(O)),I=O=>{v(L=>L.slice().map(M=>M.media===O.media?{...M,matches:O.matches}:M))};return C.forEach(O=>{typeof O.addListener=="function"?O.addListener(I):O.addEventListener("change",I)}),()=>{C.forEach(O=>{typeof O.removeListener=="function"?O.removeListener(I):O.removeEventListener("change",I)})}},[l]),_.map(b=>b.matches)}function exe(n,t,i,a){if(t==null)return a;if(!a)return n.find(f=>i(f).toLowerCase().startsWith(t.toLowerCase()));const l=n.filter(d=>i(d).toLowerCase().startsWith(t.toLowerCase()));if(l.length>0){let d;return l.includes(a)?(d=l.indexOf(a)+1,d===l.length&&(d=0),l[d]):(d=n.indexOf(l[0]),n[d])}return a}function txe(n){const{key:t}=n;return t.length===1||t.length>1&&/[^a-zA-Z0-9]/.test(t)}function nxe(n={}){const{timeout:t=300,preventDefault:i=()=>!0}=n,[a,l]=N.useState([]),d=N.useRef(void 0),f=()=>{d.current&&(clearTimeout(d.current),d.current=null)},_=()=>{f(),d.current=setTimeout(()=>{l([]),d.current=null},t)};N.useEffect(()=>f,[]);function v(b){return C=>{if(C.key==="Backspace"){const I=[...a];I.pop(),l(I);return}if(txe(C)){const I=a.concat(C.key);i(C)&&(C.preventDefault(),C.stopPropagation()),l(I),b(I.join("")),_()}}}return v}var gl="top",$u="bottom",Ku="right",_l="left",OF="auto",nR=[gl,$u,Ku,_l],E0="start",NC="end",rxe="clippingParents",hne="viewport",_w="popper",ixe="reference",DY=nR.reduce(function(n,t){return n.concat([t+"-"+E0,t+"-"+NC])},[]),pne=[].concat(nR,[OF]).reduce(function(n,t){return n.concat([t,t+"-"+E0,t+"-"+NC])},[]),sxe="beforeRead",oxe="read",axe="afterRead",cxe="beforeMain",lxe="main",uxe="afterMain",dxe="beforeWrite",hxe="write",pxe="afterWrite",fxe=[sxe,oxe,axe,cxe,lxe,uxe,dxe,hxe,pxe];function vp(n){return n?(n.nodeName||"").toLowerCase():null}function Jl(n){if(n==null)return window;if(n.toString()!=="[object Window]"){var t=n.ownerDocument;return t&&t.defaultView||window}return n}function Wy(n){var t=Jl(n).Element;return n instanceof t||n instanceof Element}function zu(n){var t=Jl(n).HTMLElement;return n instanceof t||n instanceof HTMLElement}function kF(n){if(typeof ShadowRoot>"u")return!1;var t=Jl(n).ShadowRoot;return n instanceof t||n instanceof ShadowRoot}function mxe(n){var t=n.state;Object.keys(t.elements).forEach(function(i){var a=t.styles[i]||{},l=t.attributes[i]||{},d=t.elements[i];!zu(d)||!vp(d)||(Object.assign(d.style,a),Object.keys(l).forEach(function(f){var _=l[f];_===!1?d.removeAttribute(f):d.setAttribute(f,_===!0?"":_)}))})}function gxe(n){var t=n.state,i={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,i.popper),t.styles=i,t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow),function(){Object.keys(t.elements).forEach(function(a){var l=t.elements[a],d=t.attributes[a]||{},f=Object.keys(t.styles.hasOwnProperty(a)?t.styles[a]:i[a]),_=f.reduce(function(v,b){return v[b]="",v},{});!zu(l)||!vp(l)||(Object.assign(l.style,_),Object.keys(d).forEach(function(v){l.removeAttribute(v)}))})}}const _xe={name:"applyStyles",enabled:!0,phase:"write",fn:mxe,effect:gxe,requires:["computeStyles"]};function dp(n){return n.split("-")[0]}var My=Math.max,Dk=Math.min,v0=Math.round;function oV(){var n=navigator.userAgentData;return n!=null&&n.brands&&Array.isArray(n.brands)?n.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function fne(){return!/^((?!chrome|android).)*safari/i.test(oV())}function S0(n,t,i){t===void 0&&(t=!1),i===void 0&&(i=!1);var a=n.getBoundingClientRect(),l=1,d=1;t&&zu(n)&&(l=n.offsetWidth>0&&v0(a.width)/n.offsetWidth||1,d=n.offsetHeight>0&&v0(a.height)/n.offsetHeight||1);var f=Wy(n)?Jl(n):window,_=f.visualViewport,v=!fne()&&i,b=(a.left+(v&&_?_.offsetLeft:0))/l,C=(a.top+(v&&_?_.offsetTop:0))/d,I=a.width/l,O=a.height/d;return{width:I,height:O,top:C,right:b+I,bottom:C+O,left:b,x:b,y:C}}function NF(n){var t=S0(n),i=n.offsetWidth,a=n.offsetHeight;return Math.abs(t.width-i)<=1&&(i=t.width),Math.abs(t.height-a)<=1&&(a=t.height),{x:n.offsetLeft,y:n.offsetTop,width:i,height:a}}function mne(n,t){var i=t.getRootNode&&t.getRootNode();if(n.contains(t))return!0;if(i&&kF(i)){var a=t;do{if(a&&n.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function Hf(n){return Jl(n).getComputedStyle(n)}function yxe(n){return["table","td","th"].indexOf(vp(n))>=0}function Wg(n){return((Wy(n)?n.ownerDocument:n.document)||window.document).documentElement}function I1(n){return vp(n)==="html"?n:n.assignedSlot||n.parentNode||(kF(n)?n.host:null)||Wg(n)}function xY(n){return!zu(n)||Hf(n).position==="fixed"?null:n.offsetParent}function Exe(n){var t=/firefox/i.test(oV()),i=/Trident/i.test(oV());if(i&&zu(n)){var a=Hf(n);if(a.position==="fixed")return null}var l=I1(n);for(kF(l)&&(l=l.host);zu(l)&&["html","body"].indexOf(vp(l))<0;){var d=Hf(l);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||t&&d.willChange==="filter"||t&&d.filter&&d.filter!=="none")return l;l=l.parentNode}return null}function rR(n){for(var t=Jl(n),i=xY(n);i&&yxe(i)&&Hf(i).position==="static";)i=xY(i);return i&&(vp(i)==="html"||vp(i)==="body"&&Hf(i).position==="static")?t:i||Exe(n)||t}function DF(n){return["top","bottom"].indexOf(n)>=0?"x":"y"}function aC(n,t,i){return My(n,Dk(t,i))}function vxe(n,t,i){var a=aC(n,t,i);return a>i?i:a}function gne(){return{top:0,right:0,bottom:0,left:0}}function _ne(n){return Object.assign({},gne(),n)}function yne(n,t){return t.reduce(function(i,a){return i[a]=n,i},{})}var Sxe=function(t,i){return t=typeof t=="function"?t(Object.assign({},i.rects,{placement:i.placement})):t,_ne(typeof t!="number"?t:yne(t,nR))};function bxe(n){var t,i=n.state,a=n.name,l=n.options,d=i.elements.arrow,f=i.modifiersData.popperOffsets,_=dp(i.placement),v=DF(_),b=[_l,Ku].indexOf(_)>=0,C=b?"height":"width";if(!(!d||!f)){var I=Sxe(l.padding,i),O=NF(d),L=v==="y"?gl:_l,M=v==="y"?$u:Ku,F=i.rects.reference[C]+i.rects.reference[v]-f[v]-i.rects.popper[C],z=f[v]-i.rects.reference[v],Z=rR(d),K=Z?v==="y"?Z.clientHeight||0:Z.clientWidth||0:0,re=F/2-z/2,ae=I[L],ne=K-O[C]-I[M],pe=K/2-O[C]/2+re,X=aC(ae,pe,ne),J=v;i.modifiersData[a]=(t={},t[J]=X,t.centerOffset=X-pe,t)}}function Txe(n){var t=n.state,i=n.options,a=i.element,l=a===void 0?"[data-popper-arrow]":a;l!=null&&(typeof l=="string"&&(l=t.elements.popper.querySelector(l),!l)||mne(t.elements.popper,l)&&(t.elements.arrow=l))}const wxe={name:"arrow",enabled:!0,phase:"main",fn:bxe,effect:Txe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function b0(n){return n.split("-")[1]}var Cxe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Rxe(n,t){var i=n.x,a=n.y,l=t.devicePixelRatio||1;return{x:v0(i*l)/l||0,y:v0(a*l)/l||0}}function LY(n){var t,i=n.popper,a=n.popperRect,l=n.placement,d=n.variation,f=n.offsets,_=n.position,v=n.gpuAcceleration,b=n.adaptive,C=n.roundOffsets,I=n.isFixed,O=f.x,L=O===void 0?0:O,M=f.y,F=M===void 0?0:M,z=typeof C=="function"?C({x:L,y:F}):{x:L,y:F};L=z.x,F=z.y;var Z=f.hasOwnProperty("x"),K=f.hasOwnProperty("y"),re=_l,ae=gl,ne=window;if(b){var pe=rR(i),X="clientHeight",J="clientWidth";if(pe===Jl(i)&&(pe=Wg(i),Hf(pe).position!=="static"&&_==="absolute"&&(X="scrollHeight",J="scrollWidth")),pe=pe,l===gl||(l===_l||l===Ku)&&d===NC){ae=$u;var Q=I&&pe===ne&&ne.visualViewport?ne.visualViewport.height:pe[X];F-=Q-a.height,F*=v?1:-1}if(l===_l||(l===gl||l===$u)&&d===NC){re=Ku;var se=I&&pe===ne&&ne.visualViewport?ne.visualViewport.width:pe[J];L-=se-a.width,L*=v?1:-1}}var de=Object.assign({position:_},b&&Cxe),he=C===!0?Rxe({x:L,y:F},Jl(i)):{x:L,y:F};if(L=he.x,F=he.y,v){var le;return Object.assign({},de,(le={},le[ae]=K?"0":"",le[re]=Z?"0":"",le.transform=(ne.devicePixelRatio||1)<=1?"translate("+L+"px, "+F+"px)":"translate3d("+L+"px, "+F+"px, 0)",le))}return Object.assign({},de,(t={},t[ae]=K?F+"px":"",t[re]=Z?L+"px":"",t.transform="",t))}function Ixe(n){var t=n.state,i=n.options,a=i.gpuAcceleration,l=a===void 0?!0:a,d=i.adaptive,f=d===void 0?!0:d,_=i.roundOffsets,v=_===void 0?!0:_,b={placement:dp(t.placement),variation:b0(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:l,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,LY(Object.assign({},b,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:f,roundOffsets:v})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,LY(Object.assign({},b,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:v})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const Axe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Ixe,data:{}};var EO={passive:!0};function Pxe(n){var t=n.state,i=n.instance,a=n.options,l=a.scroll,d=l===void 0?!0:l,f=a.resize,_=f===void 0?!0:f,v=Jl(t.elements.popper),b=[].concat(t.scrollParents.reference,t.scrollParents.popper);return d&&b.forEach(function(C){C.addEventListener("scroll",i.update,EO)}),_&&v.addEventListener("resize",i.update,EO),function(){d&&b.forEach(function(C){C.removeEventListener("scroll",i.update,EO)}),_&&v.removeEventListener("resize",i.update,EO)}}const Oxe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Pxe,data:{}};var kxe={left:"right",right:"left",bottom:"top",top:"bottom"};function ek(n){return n.replace(/left|right|bottom|top/g,function(t){return kxe[t]})}var Nxe={start:"end",end:"start"};function MY(n){return n.replace(/start|end/g,function(t){return Nxe[t]})}function xF(n){var t=Jl(n),i=t.pageXOffset,a=t.pageYOffset;return{scrollLeft:i,scrollTop:a}}function LF(n){return S0(Wg(n)).left+xF(n).scrollLeft}function Dxe(n,t){var i=Jl(n),a=Wg(n),l=i.visualViewport,d=a.clientWidth,f=a.clientHeight,_=0,v=0;if(l){d=l.width,f=l.height;var b=fne();(b||!b&&t==="fixed")&&(_=l.offsetLeft,v=l.offsetTop)}return{width:d,height:f,x:_+LF(n),y:v}}function xxe(n){var t,i=Wg(n),a=xF(n),l=(t=n.ownerDocument)==null?void 0:t.body,d=My(i.scrollWidth,i.clientWidth,l?l.scrollWidth:0,l?l.clientWidth:0),f=My(i.scrollHeight,i.clientHeight,l?l.scrollHeight:0,l?l.clientHeight:0),_=-a.scrollLeft+LF(n),v=-a.scrollTop;return Hf(l||i).direction==="rtl"&&(_+=My(i.clientWidth,l?l.clientWidth:0)-d),{width:d,height:f,x:_,y:v}}function MF(n){var t=Hf(n),i=t.overflow,a=t.overflowX,l=t.overflowY;return/auto|scroll|overlay|hidden/.test(i+l+a)}function Ene(n){return["html","body","#document"].indexOf(vp(n))>=0?n.ownerDocument.body:zu(n)&&MF(n)?n:Ene(I1(n))}function cC(n,t){var i;t===void 0&&(t=[]);var a=Ene(n),l=a===((i=n.ownerDocument)==null?void 0:i.body),d=Jl(a),f=l?[d].concat(d.visualViewport||[],MF(a)?a:[]):a,_=t.concat(f);return l?_:_.concat(cC(I1(f)))}function aV(n){return Object.assign({},n,{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height})}function Lxe(n,t){var i=S0(n,!1,t==="fixed");return i.top=i.top+n.clientTop,i.left=i.left+n.clientLeft,i.bottom=i.top+n.clientHeight,i.right=i.left+n.clientWidth,i.width=n.clientWidth,i.height=n.clientHeight,i.x=i.left,i.y=i.top,i}function UY(n,t,i){return t===hne?aV(Dxe(n,i)):Wy(t)?Lxe(t,i):aV(xxe(Wg(n)))}function Mxe(n){var t=cC(I1(n)),i=["absolute","fixed"].indexOf(Hf(n).position)>=0,a=i&&zu(n)?rR(n):n;return Wy(a)?t.filter(function(l){return Wy(l)&&mne(l,a)&&vp(l)!=="body"}):[]}function Uxe(n,t,i,a){var l=t==="clippingParents"?Mxe(n):[].concat(t),d=[].concat(l,[i]),f=d[0],_=d.reduce(function(v,b){var C=UY(n,b,a);return v.top=My(C.top,v.top),v.right=Dk(C.right,v.right),v.bottom=Dk(C.bottom,v.bottom),v.left=My(C.left,v.left),v},UY(n,f,a));return _.width=_.right-_.left,_.height=_.bottom-_.top,_.x=_.left,_.y=_.top,_}function vne(n){var t=n.reference,i=n.element,a=n.placement,l=a?dp(a):null,d=a?b0(a):null,f=t.x+t.width/2-i.width/2,_=t.y+t.height/2-i.height/2,v;switch(l){case gl:v={x:f,y:t.y-i.height};break;case $u:v={x:f,y:t.y+t.height};break;case Ku:v={x:t.x+t.width,y:_};break;case _l:v={x:t.x-i.width,y:_};break;default:v={x:t.x,y:t.y}}var b=l?DF(l):null;if(b!=null){var C=b==="y"?"height":"width";switch(d){case E0:v[b]=v[b]-(t[C]/2-i[C]/2);break;case NC:v[b]=v[b]+(t[C]/2-i[C]/2);break}}return v}function DC(n,t){t===void 0&&(t={});var i=t,a=i.placement,l=a===void 0?n.placement:a,d=i.strategy,f=d===void 0?n.strategy:d,_=i.boundary,v=_===void 0?rxe:_,b=i.rootBoundary,C=b===void 0?hne:b,I=i.elementContext,O=I===void 0?_w:I,L=i.altBoundary,M=L===void 0?!1:L,F=i.padding,z=F===void 0?0:F,Z=_ne(typeof z!="number"?z:yne(z,nR)),K=O===_w?ixe:_w,re=n.rects.popper,ae=n.elements[M?K:O],ne=Uxe(Wy(ae)?ae:ae.contextElement||Wg(n.elements.popper),v,C,f),pe=S0(n.elements.reference),X=vne({reference:pe,element:re,placement:l}),J=aV(Object.assign({},re,X)),Q=O===_w?J:pe,se={top:ne.top-Q.top+Z.top,bottom:Q.bottom-ne.bottom+Z.bottom,left:ne.left-Q.left+Z.left,right:Q.right-ne.right+Z.right},de=n.modifiersData.offset;if(O===_w&&de){var he=de[l];Object.keys(se).forEach(function(le){var Oe=[Ku,$u].indexOf(le)>=0?1:-1,Ve=[gl,$u].indexOf(le)>=0?"y":"x";se[le]+=he[Ve]*Oe})}return se}function Vxe(n,t){t===void 0&&(t={});var i=t,a=i.placement,l=i.boundary,d=i.rootBoundary,f=i.padding,_=i.flipVariations,v=i.allowedAutoPlacements,b=v===void 0?pne:v,C=b0(a),I=C?_?DY:DY.filter(function(M){return b0(M)===C}):nR,O=I.filter(function(M){return b.indexOf(M)>=0});O.length===0&&(O=I);var L=O.reduce(function(M,F){return M[F]=DC(n,{placement:F,boundary:l,rootBoundary:d,padding:f})[dp(F)],M},{});return Object.keys(L).sort(function(M,F){return L[M]-L[F]})}function jxe(n){if(dp(n)===OF)return[];var t=ek(n);return[MY(n),t,MY(t)]}function Fxe(n){var t=n.state,i=n.options,a=n.name;if(!t.modifiersData[a]._skip){for(var l=i.mainAxis,d=l===void 0?!0:l,f=i.altAxis,_=f===void 0?!0:f,v=i.fallbackPlacements,b=i.padding,C=i.boundary,I=i.rootBoundary,O=i.altBoundary,L=i.flipVariations,M=L===void 0?!0:L,F=i.allowedAutoPlacements,z=t.options.placement,Z=dp(z),K=Z===z,re=v||(K||!M?[ek(z)]:jxe(z)),ae=[z].concat(re).reduce(function(Ue,Be){return Ue.concat(dp(Be)===OF?Vxe(t,{placement:Be,boundary:C,rootBoundary:I,padding:b,flipVariations:M,allowedAutoPlacements:F}):Be)},[]),ne=t.rects.reference,pe=t.rects.popper,X=new Map,J=!0,Q=ae[0],se=0;se<ae.length;se++){var de=ae[se],he=dp(de),le=b0(de)===E0,Oe=[gl,$u].indexOf(he)>=0,Ve=Oe?"width":"height",xe=DC(t,{placement:de,boundary:C,rootBoundary:I,altBoundary:O,padding:b}),Re=Oe?le?Ku:_l:le?$u:gl;ne[Ve]>pe[Ve]&&(Re=ek(Re));var ve=ek(Re),be=[];if(d&&be.push(xe[he]<=0),_&&be.push(xe[Re]<=0,xe[ve]<=0),be.every(function(Ue){return Ue})){Q=de,J=!1;break}X.set(de,be)}if(J)for(var ze=M?3:1,Pe=function(Be){var qe=ae.find(function($e){var it=X.get($e);if(it)return it.slice(0,Be).every(function(Je){return Je})});if(qe)return Q=qe,"break"},we=ze;we>0;we--){var ke=Pe(we);if(ke==="break")break}t.placement!==Q&&(t.modifiersData[a]._skip=!0,t.placement=Q,t.reset=!0)}}const Bxe={name:"flip",enabled:!0,phase:"main",fn:Fxe,requiresIfExists:["offset"],data:{_skip:!1}};function VY(n,t,i){return i===void 0&&(i={x:0,y:0}),{top:n.top-t.height-i.y,right:n.right-t.width+i.x,bottom:n.bottom-t.height+i.y,left:n.left-t.width-i.x}}function jY(n){return[gl,Ku,$u,_l].some(function(t){return n[t]>=0})}function zxe(n){var t=n.state,i=n.name,a=t.rects.reference,l=t.rects.popper,d=t.modifiersData.preventOverflow,f=DC(t,{elementContext:"reference"}),_=DC(t,{altBoundary:!0}),v=VY(f,a),b=VY(_,l,d),C=jY(v),I=jY(b);t.modifiersData[i]={referenceClippingOffsets:v,popperEscapeOffsets:b,isReferenceHidden:C,hasPopperEscaped:I},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":C,"data-popper-escaped":I})}const Wxe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:zxe};function Gxe(n,t,i){var a=dp(n),l=[_l,gl].indexOf(a)>=0?-1:1,d=typeof i=="function"?i(Object.assign({},t,{placement:n})):i,f=d[0],_=d[1];return f=f||0,_=(_||0)*l,[_l,Ku].indexOf(a)>=0?{x:_,y:f}:{x:f,y:_}}function Hxe(n){var t=n.state,i=n.options,a=n.name,l=i.offset,d=l===void 0?[0,0]:l,f=pne.reduce(function(C,I){return C[I]=Gxe(I,t.rects,d),C},{}),_=f[t.placement],v=_.x,b=_.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=v,t.modifiersData.popperOffsets.y+=b),t.modifiersData[a]=f}const $xe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Hxe};function Kxe(n){var t=n.state,i=n.name;t.modifiersData[i]=vne({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})}const qxe={name:"popperOffsets",enabled:!0,phase:"read",fn:Kxe,data:{}};function Yxe(n){return n==="x"?"y":"x"}function Xxe(n){var t=n.state,i=n.options,a=n.name,l=i.mainAxis,d=l===void 0?!0:l,f=i.altAxis,_=f===void 0?!1:f,v=i.boundary,b=i.rootBoundary,C=i.altBoundary,I=i.padding,O=i.tether,L=O===void 0?!0:O,M=i.tetherOffset,F=M===void 0?0:M,z=DC(t,{boundary:v,rootBoundary:b,padding:I,altBoundary:C}),Z=dp(t.placement),K=b0(t.placement),re=!K,ae=DF(Z),ne=Yxe(ae),pe=t.modifiersData.popperOffsets,X=t.rects.reference,J=t.rects.popper,Q=typeof F=="function"?F(Object.assign({},t.rects,{placement:t.placement})):F,se=typeof Q=="number"?{mainAxis:Q,altAxis:Q}:Object.assign({mainAxis:0,altAxis:0},Q),de=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,he={x:0,y:0};if(pe){if(d){var le,Oe=ae==="y"?gl:_l,Ve=ae==="y"?$u:Ku,xe=ae==="y"?"height":"width",Re=pe[ae],ve=Re+z[Oe],be=Re-z[Ve],ze=L?-J[xe]/2:0,Pe=K===E0?X[xe]:J[xe],we=K===E0?-J[xe]:-X[xe],ke=t.elements.arrow,Ue=L&&ke?NF(ke):{width:0,height:0},Be=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:gne(),qe=Be[Oe],$e=Be[Ve],it=aC(0,X[xe],Ue[xe]),Je=re?X[xe]/2-ze-it-qe-se.mainAxis:Pe-it-qe-se.mainAxis,Ct=re?-X[xe]/2+ze+it+$e+se.mainAxis:we+it+$e+se.mainAxis,kt=t.elements.arrow&&rR(t.elements.arrow),He=kt?ae==="y"?kt.clientTop||0:kt.clientLeft||0:0,lt=(le=de==null?void 0:de[ae])!=null?le:0,mt=Re+Je-lt-He,Lt=Re+Ct-lt,Xt=aC(L?Dk(ve,mt):ve,Re,L?My(be,Lt):be);pe[ae]=Xt,he[ae]=Xt-Re}if(_){var $t,Te=ae==="x"?gl:_l,je=ae==="x"?$u:Ku,Ke=pe[ne],gt=ne==="y"?"height":"width",Et=Ke+z[Te],wt=Ke-z[je],Kt=[gl,_l].indexOf(Z)!==-1,mn=($t=de==null?void 0:de[ne])!=null?$t:0,vn=Kt?Et:Ke-X[gt]-J[gt]-mn+se.altAxis,rn=Kt?Ke+X[gt]+J[gt]-mn-se.altAxis:wt,Tt=L&&Kt?vxe(vn,Ke,rn):aC(L?vn:Et,Ke,L?rn:wt);pe[ne]=Tt,he[ne]=Tt-Ke}t.modifiersData[a]=he}}const Jxe={name:"preventOverflow",enabled:!0,phase:"main",fn:Xxe,requiresIfExists:["offset"]};function Qxe(n){return{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}}function Zxe(n){return n===Jl(n)||!zu(n)?xF(n):Qxe(n)}function eLe(n){var t=n.getBoundingClientRect(),i=v0(t.width)/n.offsetWidth||1,a=v0(t.height)/n.offsetHeight||1;return i!==1||a!==1}function tLe(n,t,i){i===void 0&&(i=!1);var a=zu(t),l=zu(t)&&eLe(t),d=Wg(t),f=S0(n,l,i),_={scrollLeft:0,scrollTop:0},v={x:0,y:0};return(a||!a&&!i)&&((vp(t)!=="body"||MF(d))&&(_=Zxe(t)),zu(t)?(v=S0(t,!0),v.x+=t.clientLeft,v.y+=t.clientTop):d&&(v.x=LF(d))),{x:f.left+_.scrollLeft-v.x,y:f.top+_.scrollTop-v.y,width:f.width,height:f.height}}function nLe(n){var t=new Map,i=new Set,a=[];n.forEach(function(d){t.set(d.name,d)});function l(d){i.add(d.name);var f=[].concat(d.requires||[],d.requiresIfExists||[]);f.forEach(function(_){if(!i.has(_)){var v=t.get(_);v&&l(v)}}),a.push(d)}return n.forEach(function(d){i.has(d.name)||l(d)}),a}function rLe(n){var t=nLe(n);return fxe.reduce(function(i,a){return i.concat(t.filter(function(l){return l.phase===a}))},[])}function iLe(n){var t;return function(){return t||(t=new Promise(function(i){Promise.resolve().then(function(){t=void 0,i(n())})})),t}}function sLe(n){var t=n.reduce(function(i,a){var l=i[a.name];return i[a.name]=l?Object.assign({},l,a,{options:Object.assign({},l.options,a.options),data:Object.assign({},l.data,a.data)}):a,i},{});return Object.keys(t).map(function(i){return t[i]})}var FY={placement:"bottom",modifiers:[],strategy:"absolute"};function BY(){for(var n=arguments.length,t=new Array(n),i=0;i<n;i++)t[i]=arguments[i];return!t.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function oLe(n){n===void 0&&(n={});var t=n,i=t.defaultModifiers,a=i===void 0?[]:i,l=t.defaultOptions,d=l===void 0?FY:l;return function(_,v,b){b===void 0&&(b=d);var C={placement:"bottom",orderedModifiers:[],options:Object.assign({},FY,d),modifiersData:{},elements:{reference:_,popper:v},attributes:{},styles:{}},I=[],O=!1,L={state:C,setOptions:function(Z){var K=typeof Z=="function"?Z(C.options):Z;F(),C.options=Object.assign({},d,C.options,K),C.scrollParents={reference:Wy(_)?cC(_):_.contextElement?cC(_.contextElement):[],popper:cC(v)};var re=rLe(sLe([].concat(a,C.options.modifiers)));return C.orderedModifiers=re.filter(function(ae){return ae.enabled}),M(),L.update()},forceUpdate:function(){if(!O){var Z=C.elements,K=Z.reference,re=Z.popper;if(BY(K,re)){C.rects={reference:tLe(K,rR(re),C.options.strategy==="fixed"),popper:NF(re)},C.reset=!1,C.placement=C.options.placement,C.orderedModifiers.forEach(function(se){return C.modifiersData[se.name]=Object.assign({},se.data)});for(var ae=0;ae<C.orderedModifiers.length;ae++){if(C.reset===!0){C.reset=!1,ae=-1;continue}var ne=C.orderedModifiers[ae],pe=ne.fn,X=ne.options,J=X===void 0?{}:X,Q=ne.name;typeof pe=="function"&&(C=pe({state:C,options:J,name:Q,instance:L})||C)}}}},update:iLe(function(){return new Promise(function(z){L.forceUpdate(),z(C)})}),destroy:function(){F(),O=!0}};if(!BY(_,v))return L;L.setOptions(b).then(function(z){!O&&b.onFirstUpdate&&b.onFirstUpdate(z)});function M(){C.orderedModifiers.forEach(function(z){var Z=z.name,K=z.options,re=K===void 0?{}:K,ae=z.effect;if(typeof ae=="function"){var ne=ae({state:C,name:Z,instance:L,options:re}),pe=function(){};I.push(ne||pe)}})}function F(){I.forEach(function(z){return z()}),I=[]}return L}}var aLe=[Oxe,qxe,Axe,_xe,$xe,Bxe,Jxe,wxe,Wxe],cLe=oLe({defaultModifiers:aLe});const TS=(n,t)=>({var:n,varRef:t?`var(${n}, ${t})`:`var(${n})`}),fo={arrowShadowColor:TS("--popper-arrow-shadow-color"),arrowSize:TS("--popper-arrow-size","8px"),arrowSizeHalf:TS("--popper-arrow-size-half"),arrowBg:TS("--popper-arrow-bg"),transformOrigin:TS("--popper-transform-origin"),arrowOffset:TS("--popper-arrow-offset")};function lLe(n){if(n.includes("top"))return"1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("bottom"))return"-1px -1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("right"))return"-1px 1px 0px 0 var(--popper-arrow-shadow-color)";if(n.includes("left"))return"1px -1px 0px 0 var(--popper-arrow-shadow-color)"}const uLe={top:"bottom center","top-start":"bottom left","top-end":"bottom right",bottom:"top center","bottom-start":"top left","bottom-end":"top right",left:"right center","left-start":"right top","left-end":"right bottom",right:"left center","right-start":"left top","right-end":"left bottom"},dLe=n=>uLe[n],zY={scroll:!0,resize:!0};function hLe(n){let t;return typeof n=="object"?t={enabled:!0,options:{...zY,...n}}:t={enabled:n,options:zY},t}const pLe={name:"matchWidth",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:({state:n})=>{n.styles.popper.width=`${n.rects.reference.width}px`},effect:({state:n})=>()=>{const t=n.elements.reference;n.elements.popper.style.width=`${t.offsetWidth}px`}},fLe={name:"transformOrigin",enabled:!0,phase:"write",fn:({state:n})=>{WY(n)},effect:({state:n})=>()=>{WY(n)}},WY=n=>{n.elements.popper.style.setProperty(fo.transformOrigin.var,dLe(n.placement))},mLe={name:"positionArrow",enabled:!0,phase:"afterWrite",fn:({state:n})=>{gLe(n)}},gLe=n=>{var i;if(!n.placement)return;const t=_Le(n.placement);if((i=n.elements)!=null&&i.arrow&&t){Object.assign(n.elements.arrow.style,{[t.property]:t.value,width:fo.arrowSize.varRef,height:fo.arrowSize.varRef,zIndex:-1});const a={[fo.arrowSizeHalf.var]:`calc(${fo.arrowSize.varRef} / 2 - 1px)`,[fo.arrowOffset.var]:`calc(${fo.arrowSizeHalf.varRef} * -1)`};for(const l in a)n.elements.arrow.style.setProperty(l,a[l])}},_Le=n=>{if(n.startsWith("top"))return{property:"bottom",value:fo.arrowOffset.varRef};if(n.startsWith("bottom"))return{property:"top",value:fo.arrowOffset.varRef};if(n.startsWith("left"))return{property:"right",value:fo.arrowOffset.varRef};if(n.startsWith("right"))return{property:"left",value:fo.arrowOffset.varRef}},yLe={name:"innerArrow",enabled:!0,phase:"main",requires:["arrow"],fn:({state:n})=>{GY(n)},effect:({state:n})=>()=>{GY(n)}},GY=n=>{if(!n.elements.arrow)return;const t=n.elements.arrow.querySelector("[data-popper-arrow-inner]");if(!t)return;const i=lLe(n.placement);i&&t.style.setProperty("--popper-arrow-default-shadow",i),Object.assign(t.style,{transform:"rotate(45deg)",background:fo.arrowBg.varRef,top:0,left:0,width:"100%",height:"100%",position:"absolute",zIndex:"inherit",boxShadow:"var(--popper-arrow-shadow, var(--popper-arrow-default-shadow))"})},ELe={"start-start":{ltr:"left-start",rtl:"right-start"},"start-end":{ltr:"left-end",rtl:"right-end"},"end-start":{ltr:"right-start",rtl:"left-start"},"end-end":{ltr:"right-end",rtl:"left-end"},start:{ltr:"left",rtl:"right"},end:{ltr:"right",rtl:"left"}},vLe={"auto-start":"auto-end","auto-end":"auto-start","top-start":"top-end","top-end":"top-start","bottom-start":"bottom-end","bottom-end":"bottom-start"};function SLe(n,t="ltr"){var a;const i=((a=ELe[n])==null?void 0:a[t])||n;return t==="ltr"?i:vLe[n]??i}function UF(n={}){const{enabled:t=!0,modifiers:i,placement:a="bottom",strategy:l="absolute",arrowPadding:d=8,eventListeners:f=!0,offset:_,gutter:v=8,flip:b=!0,boundary:C="clippingParents",preventOverflow:I=!0,matchWidth:O,direction:L="ltr"}=n,M=N.useRef(null),F=N.useRef(null),z=N.useRef(null),Z=SLe(a,L),K=N.useRef(()=>{}),re=N.useCallback(()=>{var se;!t||!M.current||!F.current||((se=K.current)==null||se.call(K),z.current=cLe(M.current,F.current,{placement:Z,modifiers:[yLe,mLe,fLe,{...pLe,enabled:!!O},{name:"eventListeners",...hLe(f)},{name:"arrow",options:{padding:d}},{name:"offset",options:{offset:_??[0,v]}},{name:"flip",enabled:!!b,options:{padding:8}},{name:"preventOverflow",enabled:!!I,options:{boundary:C}},...i??[]],strategy:l}),z.current.forceUpdate(),K.current=z.current.destroy)},[Z,t,i,O,f,d,_,v,b,I,C,l]);N.useEffect(()=>()=>{var se;!M.current&&!F.current&&((se=z.current)==null||se.destroy(),z.current=null)},[]);const ae=N.useCallback(se=>{M.current=se,re()},[re]),ne=N.useCallback((se={},de=null)=>({...se,ref:Vi(ae,de)}),[ae]),pe=N.useCallback(se=>{F.current=se,re()},[re]),X=N.useCallback((se={},de=null)=>({...se,ref:Vi(pe,de),style:{...se.style,position:l,minWidth:O?void 0:"max-content",inset:"0 auto auto 0"}}),[l,pe,O]),J=N.useCallback((se={},de=null)=>{const{size:he,shadowColor:le,bg:Oe,style:Ve,...xe}=se;return{...xe,ref:de,"data-popper-arrow":"",style:bLe(se)}},[]),Q=N.useCallback((se={},de=null)=>({...se,ref:de,"data-popper-arrow-inner":""}),[]);return{update(){var se;(se=z.current)==null||se.update()},forceUpdate(){var se;(se=z.current)==null||se.forceUpdate()},transformOrigin:fo.transformOrigin.varRef,referenceRef:ae,popperRef:pe,getPopperProps:X,getArrowProps:J,getArrowInnerProps:Q,getReferenceProps:ne}}function bLe(n){const{size:t,shadowColor:i,bg:a,style:l}=n,d={...l,position:"absolute"};return t&&(d["--popper-arrow-size"]=t),i&&(d["--popper-arrow-shadow-color"]=i),a&&(d["--popper-arrow-bg"]=a),d}function TLe(){const n=N.useRef(new Map),t=n.current,i=N.useCallback((l,d,f,_)=>{n.current.set(f,{type:d,el:l,options:_}),l.addEventListener(d,f,_)},[]),a=N.useCallback((l,d,f,_)=>{l.removeEventListener(d,f,_),n.current.delete(f)},[]);return N.useEffect(()=>()=>{t.forEach((l,d)=>{a(l.el,l.type,d,l.options)})},[a,t]),{add:i,remove:a}}function WM(n){var l,d;const t=((d=(l=n.composedPath)==null?void 0:l.call(n))==null?void 0:d[0])??n.target,{tagName:i,isContentEditable:a}=t;return i!=="INPUT"&&i!=="TEXTAREA"&&a!==!0}function Sne(n={}){const{ref:t,isDisabled:i,isFocusable:a,clickOnEnter:l=!0,clickOnSpace:d=!0,onMouseDown:f,onMouseUp:_,onClick:v,onKeyDown:b,onKeyUp:C,tabIndex:I,onMouseOver:O,onMouseLeave:L,...M}=n,[F,z]=N.useState(!0),[Z,K]=N.useState(!1),re=TLe(),ae=Re=>{Re&&Re.tagName!=="BUTTON"&&z(!1)},ne=F?I:I||0,pe=i&&!a,X=N.useCallback(Re=>{if(i){Re.stopPropagation(),Re.preventDefault();return}Re.currentTarget.focus(),v==null||v(Re)},[i,v]),J=N.useCallback(Re=>{Z&&WM(Re)&&(Re.preventDefault(),Re.stopPropagation(),K(!1),re.remove(document,"keyup",J,!1))},[Z,re]),Q=N.useCallback(Re=>{if(b==null||b(Re),i||Re.defaultPrevented||Re.metaKey||!WM(Re.nativeEvent)||F)return;const ve=l&&Re.key==="Enter";d&&Re.key===" "&&(Re.preventDefault(),K(!0)),ve&&(Re.preventDefault(),Re.currentTarget.click()),re.add(document,"keyup",J,!1)},[i,F,b,l,d,re,J]),se=N.useCallback(Re=>{if(C==null||C(Re),i||Re.defaultPrevented||Re.metaKey||!WM(Re.nativeEvent)||F)return;d&&Re.key===" "&&(Re.preventDefault(),K(!1),Re.currentTarget.click())},[d,F,i,C]),de=N.useCallback(Re=>{Re.button===0&&(K(!1),re.remove(document,"mouseup",de,!1))},[re]),he=N.useCallback(Re=>{if(Re.button!==0)return;if(i){Re.stopPropagation(),Re.preventDefault();return}F||K(!0),Re.currentTarget.focus({preventScroll:!0}),re.add(document,"mouseup",de,!1),f==null||f(Re)},[i,F,f,re,de]),le=N.useCallback(Re=>{Re.button===0&&(F||K(!1),_==null||_(Re))},[_,F]),Oe=N.useCallback(Re=>{if(i){Re.preventDefault();return}O==null||O(Re)},[i,O]),Ve=N.useCallback(Re=>{Z&&(Re.preventDefault(),K(!1)),L==null||L(Re)},[Z,L]),xe=Vi(t,ae);return F?{...M,ref:xe,type:"button","aria-disabled":pe?void 0:i,disabled:pe,onClick:X,onMouseDown:f,onMouseUp:_,onKeyUp:C,onKeyDown:b,onMouseOver:O,onMouseLeave:L}:{...M,ref:xe,role:"button","data-active":nr(Z),"aria-disabled":i?"true":void 0,tabIndex:pe?void 0:ne,onClick:X,onMouseDown:he,onMouseUp:le,onKeyUp:se,onKeyDown:Q,onMouseOver:Oe,onMouseLeave:Ve}}const[wLe,CLe,RLe,ILe]=Ste(),[ALe,iR]=Ti({strict:!1,name:"MenuContext"});function bne(n){return(n==null?void 0:n.ownerDocument)??document}function PLe(n){return bne(n).activeElement===n}function OLe(n={}){const{id:t,closeOnSelect:i=!0,closeOnBlur:a=!0,initialFocusRef:l,autoSelect:d=!0,isLazy:f,isOpen:_,defaultIsOpen:v,onClose:b,onOpen:C,placement:I="bottom-start",lazyBehavior:O="unmount",direction:L,computePositionOnMount:M=!1,...F}=n,z=N.useRef(null),Z=N.useRef(null),K=N.useRef(!0),re=RLe(),ae=N.useCallback(()=>{requestAnimationFrame(()=>{var ke;(ke=z.current)==null||ke.focus({preventScroll:!1})})},[]),ne=N.useCallback(()=>{const ke=setTimeout(()=>{var Ue,Be;if(l)(Ue=l.current)==null||Ue.focus();else if(!re.count())(Be=z.current)==null||Be.focus({preventScroll:!1});else{const qe=re.firstEnabled();qe&&Oe(qe.index)}});be.current.add(ke)},[re,l]),pe=N.useCallback(()=>{const ke=setTimeout(()=>{var Ue;if(!re.count())(Ue=z.current)==null||Ue.focus({preventScroll:!1});else{const Be=re.lastEnabled();Be&&Oe(Be.index)}});be.current.add(ke)},[re]),X=N.useCallback(()=>{C==null||C(),d?ne():ae()},[d,ne,ae,C]),{isOpen:J,onOpen:Q,onClose:se,onToggle:de}=yp({isOpen:_,defaultIsOpen:v,onClose:b,onOpen:X});ZQ({enabled:J&&a,ref:z,handler:ke=>{var Be,qe,$e;const Ue=((qe=(Be=ke.composedPath)==null?void 0:Be.call(ke))==null?void 0:qe[0])??ke.target;($e=Z.current)!=null&&$e.contains(Ue)||se()}});const he=UF({...F,enabled:J||M,placement:I,direction:L}),[le,Oe]=N.useState(-1);XQ(z,{focusRef:Z,visible:J,shouldFocus:!0});const Ve=KQ({isOpen:J,ref:z}),[xe,Re]=kEe(t,"menu-button","menu-list"),ve=N.useCallback(()=>{Q(),ae()},[Q,ae]),be=N.useRef(new Set([]));N.useEffect(()=>{const ke=be.current;return()=>{ke.forEach(Ue=>clearTimeout(Ue)),ke.clear()}},[]),zf(()=>{var ke;J||(Oe(-1),(ke=z.current)==null||ke.scrollTo(0,0))},[J]),zf(()=>{J&&le===-1&&ae()},[le,J]),N.useEffect(()=>{var Ue;if(!J)return;const ke=re.item(le);(Ue=ke==null?void 0:ke.node)==null||Ue.focus({preventScroll:!K.current})},[re,le,J]);const ze=N.useCallback(()=>{Q(),ne()},[ne,Q]),Pe=N.useCallback(()=>{K.current=!0,Q(),pe()},[Q,pe]),we=N.useCallback(()=>{var $e,it;const ke=bne(z.current),Ue=($e=z.current)==null?void 0:$e.contains(ke.activeElement);if(!(J&&!Ue))return;const qe=(it=re.item(le))==null?void 0:it.node;qe==null||qe.focus({preventScroll:!K.current})},[J,le,re]);return{openAndFocusMenu:ve,openAndFocusFirstItem:ze,openAndFocusLastItem:Pe,onTransitionEnd:we,unstable__animationState:Ve,descendants:re,popper:he,buttonId:xe,menuId:Re,forceUpdate:he.forceUpdate,orientation:"vertical",isOpen:J,onToggle:de,onOpen:Q,onClose:se,menuRef:z,buttonRef:Z,focusedIndex:le,closeOnSelect:i,closeOnBlur:a,autoSelect:d,setFocusedIndex:Oe,isLazy:f,lazyBehavior:O,initialFocusRef:l,scrollIntoViewRef:K}}function kLe(n={},t=null){const i=iR(),{onToggle:a,popper:l,openAndFocusFirstItem:d,openAndFocusLastItem:f,scrollIntoViewRef:_}=i,v=N.useCallback(b=>{const C=b.key,O={Enter:d,ArrowDown:d,ArrowUp:f}[C];O&&(_.current=!0,b.preventDefault(),b.stopPropagation(),O(b))},[d,f,_]);return{...n,ref:Vi(i.buttonRef,t,l.referenceRef),id:i.buttonId,"data-active":nr(i.isOpen),"aria-expanded":i.isOpen,"aria-haspopup":"menu","aria-controls":i.menuId,onClick:Nn(n.onClick,a),onKeyDown:Nn(n.onKeyDown,v)}}function cV(n){var t;return LLe(n)&&!!((t=n==null?void 0:n.getAttribute("role"))!=null&&t.startsWith("menuitem"))}function NLe(n={},t=null){const i=iR();if(!i)throw new Error("useMenuContext: context is undefined. Seems you forgot to wrap component within <Menu>");const{focusedIndex:a,setFocusedIndex:l,menuRef:d,isOpen:f,onClose:_,menuId:v,isLazy:b,lazyBehavior:C,scrollIntoViewRef:I,unstable__animationState:O}=i,L=CLe(),M=nxe({preventDefault:K=>K.key!==" "&&cV(K.target)}),F=N.useCallback(K=>{if(!K.currentTarget.contains(K.target))return;const re=K.key,ne={Tab:X=>X.preventDefault(),Escape:X=>{X.stopPropagation(),_()},ArrowDown:()=>{I.current=!0;const X=L.nextEnabled(a)??L.firstEnabled();X&&l(X.index)},ArrowUp:()=>{I.current=!0;const X=L.prevEnabled(a)??L.firstEnabled();X&&l(X.index)}}[re];if(ne){K.preventDefault(),ne(K);return}const pe=M(X=>{const J=exe(L.values(),X,Q=>{var se;return((se=Q==null?void 0:Q.node)==null?void 0:se.textContent)??""},L.item(a));if(J){const Q=L.indexOf(J.node);l(Q)}});cV(K.target)&&pe(K)},[L,a,M,_,l,I]),z=N.useRef(!1);f&&(z.current=!0);const Z=sj({wasSelected:z.current,enabled:b,mode:C,isSelected:O.present});return{...n,ref:Vi(d,t),children:Z?n.children:null,tabIndex:-1,role:"menu",id:v,style:{...n.style,transformOrigin:"var(--popper-transform-origin)"},"aria-orientation":"vertical",onKeyDown:Nn(n.onKeyDown,F)}}function DLe(n={}){const{popper:t,isOpen:i}=iR();return t.getPopperProps({...n,style:{visibility:i?"visible":"hidden",...n.style}})}function xLe(n={},t=null){const{onMouseEnter:i,onMouseMove:a,onMouseLeave:l,onClick:d,onFocus:f,isDisabled:_,isFocusable:v,closeOnSelect:b,type:C,...I}=n,O=iR(),{setFocusedIndex:L,focusedIndex:M,closeOnSelect:F,onClose:z,menuId:Z,scrollIntoViewRef:K}=O,re=N.useRef(null),ae=`${Z}-menuitem-${N.useId()}`,{index:ne,register:pe}=ILe({disabled:_&&!v}),X=N.useCallback(Oe=>{i==null||i(Oe),!_&&(K.current=!1,L(ne))},[L,ne,_,i,K]),J=N.useCallback(Oe=>{a==null||a(Oe),re.current&&!PLe(re.current)&&X(Oe)},[X,a]),Q=N.useCallback(Oe=>{l==null||l(Oe),!_&&L(-1)},[L,_,l]),se=N.useCallback(Oe=>{d==null||d(Oe),cV(Oe.currentTarget)&&(b??F)&&z()},[z,d,F,b]),de=N.useCallback(Oe=>{f==null||f(Oe),L(ne)},[L,f,ne]),he=ne===M,le=Sne({onClick:se,onFocus:de,onMouseEnter:X,onMouseMove:J,onMouseLeave:Q,ref:Vi(pe,re,t),isDisabled:_,isFocusable:v});return{...I,...le,type:C??le.type,id:ae,role:"menuitem",tabIndex:he?0:-1}}function LLe(n){if(!MLe(n))return!1;const t=n.ownerDocument.defaultView??window;return n instanceof t.HTMLElement}function MLe(n){return n!=null&&typeof n=="object"&&"nodeType"in n&&n.nodeType===Node.ELEMENT_NODE}const[ULe,sR]=Ti({name:"MenuStylesContext",errorMessage:`useMenuStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />" `}),A1=n=>{const{children:t}=n,i=ka("Menu",n),a=Fi(n),{direction:l}=F0(),{descendants:d,...f}=OLe({...a,direction:l}),_=N.useMemo(()=>f,[f]),{isOpen:v,onClose:b,forceUpdate:C}=_;return T.jsx(wLe,{value:d,children:T.jsx(ALe,{value:_,children:T.jsx(ULe,{value:i,children:ml(t,{isOpen:v,onClose:b,forceUpdate:C})})})})};A1.displayName="Menu";const VLe=zt((n,t)=>{const i=sR();return T.jsx(Vt.button,{ref:t,...n,__css:{display:"inline-flex",appearance:"none",alignItems:"center",outline:0,...i.button}})}),P1=zt((n,t)=>{const{children:i,as:a,...l}=n,d=kLe(l,t),f=a||VLe;return T.jsx(f,{...d,className:_n("chakra-menu__menu-button",n.className),children:T.jsx(Vt.span,{__css:{pointerEvents:"none",flex:"1 1 auto",minW:0},children:n.children})})});P1.displayName="MenuButton";const Tne=zt((n,t)=>{const i=sR();return T.jsx(Vt.span,{ref:t,...n,__css:i.command,className:"chakra-menu__command"})});Tne.displayName="MenuCommand";const wne=n=>{const{className:t,children:i,...a}=n,l=sR(),d=N.Children.only(i),f=N.isValidElement(d)?N.cloneElement(d,{focusable:"false","aria-hidden":!0,className:_n("chakra-menu__icon",d.props.className)}):null,_=_n("chakra-menu__icon-wrapper",t);return T.jsx(Vt.span,{className:_,...a,__css:l.icon,children:f})};wne.displayName="MenuIcon";const jLe=zt((n,t)=>{const{type:i,...a}=n,l=sR(),d=a.as||i?i??void 0:"button",f=N.useMemo(()=>({textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,...l.item}),[l.item]);return T.jsx(Vt.button,{ref:t,type:d,...a,__css:f})}),xk=zt((n,t)=>{const{icon:i,iconSpacing:a="0.75rem",command:l,commandSpacing:d="0.75rem",children:f,..._}=n,v=xLe(_,t),C=i||l?T.jsx("span",{style:{pointerEvents:"none",flex:1},children:f}):f;return T.jsxs(jLe,{...v,className:_n("chakra-menu__menuitem",v.className),children:[i&&T.jsx(wne,{fontSize:"0.8em",marginEnd:a,children:i}),C,l&&T.jsx(Tne,{marginStart:d,children:l})]})});xk.displayName="MenuItem";const FLe={enter:{visibility:"visible",opacity:1,scale:1,transition:{duration:.2,ease:[.4,0,.2,1]}},exit:{transitionEnd:{visibility:"hidden"},opacity:0,scale:.8,transition:{duration:.1,easings:"easeOut"}}},BLe=Vt(Jf.div),O1=zt(function(t,i){var O;const{rootProps:a,motionProps:l,...d}=t,{isOpen:f,onTransitionEnd:_,unstable__animationState:v}=iR(),b=NLe(d,i),C=DLe(a),I=sR();return T.jsx(Vt.div,{...C,__css:{zIndex:t.zIndex??((O=I.list)==null?void 0:O.zIndex)},children:T.jsx(BLe,{variants:FLe,initial:!1,animate:f?"enter":"exit",__css:{outline:0,...I.list},...l,...b,className:_n("chakra-menu__menu-list",b.className),onUpdate:_,onAnimationComplete:BQ(v.onComplete,b.onAnimationComplete)})})});O1.displayName="MenuList";var zLe=function(n){if(typeof document>"u")return null;var t=Array.isArray(n)?n[0]:n;return t.ownerDocument.body},wS=new WeakMap,vO=new WeakMap,SO={},GM=0,Cne=function(n){return n&&(n.host||Cne(n.parentNode))},WLe=function(n,t){return t.map(function(i){if(n.contains(i))return i;var a=Cne(i);return a&&n.contains(a)?a:(console.error("aria-hidden",i,"in not contained inside",n,". Doing nothing"),null)}).filter(function(i){return!!i})},GLe=function(n,t,i,a){var l=WLe(t,Array.isArray(n)?n:[n]);SO[i]||(SO[i]=new WeakMap);var d=SO[i],f=[],_=new Set,v=new Set(l),b=function(I){!I||_.has(I)||(_.add(I),b(I.parentNode))};l.forEach(b);var C=function(I){!I||v.has(I)||Array.prototype.forEach.call(I.children,function(O){if(_.has(O))C(O);else try{var L=O.getAttribute(a),M=L!==null&&L!=="false",F=(wS.get(O)||0)+1,z=(d.get(O)||0)+1;wS.set(O,F),d.set(O,z),f.push(O),F===1&&M&&vO.set(O,!0),z===1&&O.setAttribute(i,"true"),M||O.setAttribute(a,"true")}catch(Z){console.error("aria-hidden: cannot operate on ",O,Z)}})};return C(t),_.clear(),GM++,function(){f.forEach(function(I){var O=wS.get(I)-1,L=d.get(I)-1;wS.set(I,O),d.set(I,L),O||(vO.has(I)||I.removeAttribute(a),vO.delete(I)),L||I.removeAttribute(i)}),GM--,GM||(wS=new WeakMap,wS=new WeakMap,vO=new WeakMap,SO={})}},HLe=function(n,t,i){i===void 0&&(i="data-aria-hidden");var a=Array.from(Array.isArray(n)?n:[n]),l=zLe(n);return l?(a.push.apply(a,Array.from(l.querySelectorAll("[aria-live]"))),GLe(a,l,i,"aria-hidden")):function(){return null}},$Le=Object.defineProperty,KLe=(n,t,i)=>t in n?$Le(n,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[t]=i,qLe=(n,t,i)=>(KLe(n,t+"",i),i);class YLe{constructor(){qLe(this,"modals"),this.modals=new Set}add(t){return this.modals.add(t),this.modals.size}remove(t){this.modals.delete(t)}isTopModal(t){if(!t)return!1;const i=Array.from(this.modals)[this.modals.size-1];return t===i}}const lV=new YLe;function Rne(n,t){const[i,a]=N.useState(0);return N.useEffect(()=>{const l=n.current;if(l){if(t){const d=lV.add(l);a(d)}return()=>{lV.remove(l),a(0)}}},[t,n]),i}function XLe(n){const{isOpen:t,onClose:i,id:a,closeOnOverlayClick:l=!0,closeOnEsc:d=!0,useInert:f=!0,onOverlayClick:_,onEsc:v}=n,b=N.useRef(null),C=N.useRef(null),[I,O,L]=QLe(a,"chakra-modal","chakra-modal--header","chakra-modal--body");JLe(b,t&&f);const M=Rne(b,t),F=N.useRef(null),z=N.useCallback(Q=>{F.current=Q.target},[]),Z=N.useCallback(Q=>{Q.key==="Escape"&&(Q.stopPropagation(),d&&(i==null||i()),v==null||v())},[d,i,v]),[K,re]=N.useState(!1),[ae,ne]=N.useState(!1),pe=N.useCallback((Q={},se=null)=>({role:"dialog",...Q,ref:Vi(se,b),id:I,tabIndex:-1,"aria-modal":!0,"aria-labelledby":K?O:void 0,"aria-describedby":ae?L:void 0,onClick:Nn(Q.onClick,de=>de.stopPropagation())}),[L,ae,I,O,K]),X=N.useCallback(Q=>{Q.stopPropagation(),F.current===Q.target&&lV.isTopModal(b.current)&&(l&&(i==null||i()),_==null||_())},[i,l,_]),J=N.useCallback((Q={},se=null)=>({...Q,ref:Vi(se,C),onClick:Nn(Q.onClick,X),onKeyDown:Nn(Q.onKeyDown,Z),onMouseDown:Nn(Q.onMouseDown,z)}),[Z,z,X]);return{isOpen:t,onClose:i,headerId:O,bodyId:L,setBodyMounted:ne,setHeaderMounted:re,dialogRef:b,overlayRef:C,getDialogProps:pe,getDialogContainerProps:J,index:M}}function JLe(n,t){const i=n.current;N.useEffect(()=>{if(!(!n.current||!t))return HLe(n.current)},[t,n,i])}function QLe(n,...t){const i=N.useId(),a=n||i;return N.useMemo(()=>t.map(l=>`${l}-${a}`),[a,t])}const[ZLe,z0]=Ti({name:"ModalStylesContext",errorMessage:`useModalStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Modal />" `}),[e2e,Gy]=Ti({strict:!0,name:"ModalContext",errorMessage:"useModalContext: `context` is undefined. Seems you forgot to wrap modal components in `<Modal />`"}),Fs=n=>{const t={scrollBehavior:"outside",autoFocus:!0,trapFocus:!0,returnFocusOnClose:!0,blockScrollOnMount:!0,allowPinchZoom:!1,preserveScrollBarGap:!0,motionPreset:"scale",...n,lockFocusAcrossFrames:n.lockFocusAcrossFrames||!0},{portalProps:i,children:a,autoFocus:l,trapFocus:d,initialFocusRef:f,finalFocusRef:_,returnFocusOnClose:v,blockScrollOnMount:b,allowPinchZoom:C,preserveScrollBarGap:I,motionPreset:O,lockFocusAcrossFrames:L,animatePresenceProps:M,onCloseComplete:F}=t,z=ka("Modal",t),K={...XLe(t),autoFocus:l,trapFocus:d,initialFocusRef:f,finalFocusRef:_,returnFocusOnClose:v,blockScrollOnMount:b,allowPinchZoom:C,preserveScrollBarGap:I,motionPreset:O,lockFocusAcrossFrames:L};return T.jsx(e2e,{value:K,children:T.jsx(ZLe,{value:z,children:T.jsx(U0,{...M,onExitComplete:F,children:K.isOpen&&T.jsx(Ju,{...i,children:a})})})})};Fs.displayName="Modal";var tk="right-scroll-bar-position",nk="width-before-scroll-bar",t2e="with-scroll-bars-hidden",n2e="--removed-body-scroll-bar-size",Ine=Nte(),HM=function(){},k1=N.forwardRef(function(n,t){var i=N.useRef(null),a=N.useState({onScrollCapture:HM,onWheelCapture:HM,onTouchMoveCapture:HM}),l=a[0],d=a[1],f=n.forwardProps,_=n.children,v=n.className,b=n.removeScrollBar,C=n.enabled,I=n.shards,O=n.sideCar,L=n.noIsolation,M=n.inert,F=n.allowPinchZoom,z=n.as,Z=z===void 0?"div":z,K=n.gapMode,re=tR(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),ae=O,ne=Pte([i,t]),pe=Qh(Qh({},re),l);return N.createElement(N.Fragment,null,C&&N.createElement(ae,{sideCar:Ine,removeScrollBar:b,shards:I,noIsolation:L,inert:M,setCallbacks:d,allowPinchZoom:!!F,lockRef:i,gapMode:K}),f?N.cloneElement(N.Children.only(_),Qh(Qh({},pe),{ref:ne})):N.createElement(Z,Qh({},pe,{className:v,ref:ne}),_))});k1.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};k1.classNames={fullWidth:nk,zeroRight:tk};var r2e=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function i2e(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var t=r2e();return t&&n.setAttribute("nonce",t),n}function s2e(n,t){n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}function o2e(n){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(n)}var a2e=function(){var n=0,t=null;return{add:function(i){n==0&&(t=i2e())&&(s2e(t,i),o2e(t)),n++},remove:function(){n--,!n&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},c2e=function(){var n=a2e();return function(t,i){N.useEffect(function(){return n.add(t),function(){n.remove()}},[t&&i])}},Ane=function(){var n=c2e(),t=function(i){var a=i.styles,l=i.dynamic;return n(a,l),null};return t},l2e={left:0,top:0,right:0,gap:0},$M=function(n){return parseInt(n||"",10)||0},u2e=function(n){var t=window.getComputedStyle(document.body),i=t[n==="padding"?"paddingLeft":"marginLeft"],a=t[n==="padding"?"paddingTop":"marginTop"],l=t[n==="padding"?"paddingRight":"marginRight"];return[$M(i),$M(a),$M(l)]},d2e=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return l2e;var t=u2e(n),i=document.documentElement.clientWidth,a=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,a-i+t[2]-t[0])}},h2e=Ane(),s0="data-scroll-locked",p2e=function(n,t,i,a){var l=n.left,d=n.top,f=n.right,_=n.gap;return i===void 0&&(i="margin"),`
  .`.concat(t2e,` {
   overflow: hidden `).concat(a,`;
   padding-right: `).concat(_,"px ").concat(a,`;
  }
  body[`).concat(s0,`] {
    overflow: hidden `).concat(a,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(a,";"),i==="margin"&&`
    padding-left: `.concat(l,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(f,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(_,"px ").concat(a,`;
    `),i==="padding"&&"padding-right: ".concat(_,"px ").concat(a,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(tk,` {
    right: `).concat(_,"px ").concat(a,`;
  }
  
  .`).concat(nk,` {
    margin-right: `).concat(_,"px ").concat(a,`;
  }
  
  .`).concat(tk," .").concat(tk,` {
    right: 0 `).concat(a,`;
  }
  
  .`).concat(nk," .").concat(nk,` {
    margin-right: 0 `).concat(a,`;
  }
  
  body[`).concat(s0,`] {
    `).concat(n2e,": ").concat(_,`px;
  }
`)},HY=function(){var n=parseInt(document.body.getAttribute(s0)||"0",10);return isFinite(n)?n:0},f2e=function(){N.useEffect(function(){return document.body.setAttribute(s0,(HY()+1).toString()),function(){var n=HY()-1;n<=0?document.body.removeAttribute(s0):document.body.setAttribute(s0,n.toString())}},[])},m2e=function(n){var t=n.noRelative,i=n.noImportant,a=n.gapMode,l=a===void 0?"margin":a;f2e();var d=N.useMemo(function(){return d2e(l)},[l]);return N.createElement(h2e,{styles:p2e(d,!t,l,i?"":"!important")})},uV=!1;if(typeof window<"u")try{var bO=Object.defineProperty({},"passive",{get:function(){return uV=!0,!0}});window.addEventListener("test",bO,bO),window.removeEventListener("test",bO,bO)}catch{uV=!1}var CS=uV?{passive:!1}:!1,g2e=function(n){return n.tagName==="TEXTAREA"},Pne=function(n,t){if(!(n instanceof Element))return!1;var i=window.getComputedStyle(n);return i[t]!=="hidden"&&!(i.overflowY===i.overflowX&&!g2e(n)&&i[t]==="visible")},_2e=function(n){return Pne(n,"overflowY")},y2e=function(n){return Pne(n,"overflowX")},$Y=function(n,t){var i=t.ownerDocument,a=t;do{typeof ShadowRoot<"u"&&a instanceof ShadowRoot&&(a=a.host);var l=One(n,a);if(l){var d=kne(n,a),f=d[1],_=d[2];if(f>_)return!0}a=a.parentNode}while(a&&a!==i.body);return!1},E2e=function(n){var t=n.scrollTop,i=n.scrollHeight,a=n.clientHeight;return[t,i,a]},v2e=function(n){var t=n.scrollLeft,i=n.scrollWidth,a=n.clientWidth;return[t,i,a]},One=function(n,t){return n==="v"?_2e(t):y2e(t)},kne=function(n,t){return n==="v"?E2e(t):v2e(t)},S2e=function(n,t){return n==="h"&&t==="rtl"?-1:1},b2e=function(n,t,i,a,l){var d=S2e(n,window.getComputedStyle(t).direction),f=d*a,_=i.target,v=t.contains(_),b=!1,C=f>0,I=0,O=0;do{var L=kne(n,_),M=L[0],F=L[1],z=L[2],Z=F-z-d*M;(M||Z)&&One(n,_)&&(I+=Z,O+=M),_ instanceof ShadowRoot?_=_.host:_=_.parentNode}while(!v&&_!==document.body||v&&(t.contains(_)||t===_));return(C&&Math.abs(I)<1||!C&&Math.abs(O)<1)&&(b=!0),b},TO=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},KY=function(n){return[n.deltaX,n.deltaY]},qY=function(n){return n&&"current"in n?n.current:n},T2e=function(n,t){return n[0]===t[0]&&n[1]===t[1]},w2e=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},C2e=0,RS=[];function R2e(n){var t=N.useRef([]),i=N.useRef([0,0]),a=N.useRef(),l=N.useState(C2e++)[0],d=N.useState(Ane)[0],f=N.useRef(n);N.useEffect(function(){f.current=n},[n]),N.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(l));var F=ANe([n.lockRef.current],(n.shards||[]).map(qY),!0).filter(Boolean);return F.forEach(function(z){return z.classList.add("allow-interactivity-".concat(l))}),function(){document.body.classList.remove("block-interactivity-".concat(l)),F.forEach(function(z){return z.classList.remove("allow-interactivity-".concat(l))})}}},[n.inert,n.lockRef.current,n.shards]);var _=N.useCallback(function(F,z){if("touches"in F&&F.touches.length===2||F.type==="wheel"&&F.ctrlKey)return!f.current.allowPinchZoom;var Z=TO(F),K=i.current,re="deltaX"in F?F.deltaX:K[0]-Z[0],ae="deltaY"in F?F.deltaY:K[1]-Z[1],ne,pe=F.target,X=Math.abs(re)>Math.abs(ae)?"h":"v";if("touches"in F&&X==="h"&&pe.type==="range")return!1;var J=$Y(X,pe);if(!J)return!0;if(J?ne=X:(ne=X==="v"?"h":"v",J=$Y(X,pe)),!J)return!1;if(!a.current&&"changedTouches"in F&&(re||ae)&&(a.current=ne),!ne)return!0;var Q=a.current||ne;return b2e(Q,z,F,Q==="h"?re:ae)},[]),v=N.useCallback(function(F){var z=F;if(!(!RS.length||RS[RS.length-1]!==d)){var Z="deltaY"in z?KY(z):TO(z),K=t.current.filter(function(ne){return ne.name===z.type&&(ne.target===z.target||z.target===ne.shadowParent)&&T2e(ne.delta,Z)})[0];if(K&&K.should){z.cancelable&&z.preventDefault();return}if(!K){var re=(f.current.shards||[]).map(qY).filter(Boolean).filter(function(ne){return ne.contains(z.target)}),ae=re.length>0?_(z,re[0]):!f.current.noIsolation;ae&&z.cancelable&&z.preventDefault()}}},[]),b=N.useCallback(function(F,z,Z,K){var re={name:F,delta:z,target:Z,should:K,shadowParent:I2e(Z)};t.current.push(re),setTimeout(function(){t.current=t.current.filter(function(ae){return ae!==re})},1)},[]),C=N.useCallback(function(F){i.current=TO(F),a.current=void 0},[]),I=N.useCallback(function(F){b(F.type,KY(F),F.target,_(F,n.lockRef.current))},[]),O=N.useCallback(function(F){b(F.type,TO(F),F.target,_(F,n.lockRef.current))},[]);N.useEffect(function(){return RS.push(d),n.setCallbacks({onScrollCapture:I,onWheelCapture:I,onTouchMoveCapture:O}),document.addEventListener("wheel",v,CS),document.addEventListener("touchmove",v,CS),document.addEventListener("touchstart",C,CS),function(){RS=RS.filter(function(F){return F!==d}),document.removeEventListener("wheel",v,CS),document.removeEventListener("touchmove",v,CS),document.removeEventListener("touchstart",C,CS)}},[]);var L=n.removeScrollBar,M=n.inert;return N.createElement(N.Fragment,null,M?N.createElement(d,{styles:w2e(l)}):null,L?N.createElement(m2e,{gapMode:n.gapMode}):null)}function I2e(n){for(var t=null;n!==null;)n instanceof ShadowRoot&&(t=n.host,n=n.host),n=n.parentNode;return t}const A2e=PNe(Ine,R2e);var Nne=N.forwardRef(function(n,t){return N.createElement(k1,Qh({},n,{ref:t,sideCar:A2e}))});Nne.classNames=k1.classNames;function P2e(n){const{autoFocus:t,trapFocus:i,dialogRef:a,initialFocusRef:l,blockScrollOnMount:d,allowPinchZoom:f,finalFocusRef:_,returnFocusOnClose:v,preserveScrollBarGap:b,lockFocusAcrossFrames:C,isOpen:I}=Gy(),[O,L]=Pj();N.useEffect(()=>{!O&&L&&setTimeout(L)},[O,L]);const M=Rne(a,I);return T.jsx(sne,{autoFocus:t,isDisabled:!i,initialFocusRef:l,finalFocusRef:_,restoreFocus:v,contentRef:a,lockFocusAcrossFrames:C,children:T.jsx(Nne,{removeScrollBar:!b,allowPinchZoom:f,enabled:M===1&&d,forwardProps:!0,children:n.children})})}const O2e={initial:({offsetX:n,offsetY:t,transition:i,transitionEnd:a,delay:l})=>({opacity:0,x:n,y:t,transition:(i==null?void 0:i.exit)??Dy.exit(Ny.exit,l),transitionEnd:a==null?void 0:a.exit}),enter:({transition:n,transitionEnd:t,delay:i})=>({opacity:1,x:0,y:0,transition:(n==null?void 0:n.enter)??Dy.enter(Ny.enter,i),transitionEnd:t==null?void 0:t.enter}),exit:({offsetY:n,offsetX:t,transition:i,transitionEnd:a,reverse:l,delay:d})=>{const f={x:t,y:n};return{opacity:0,transition:(i==null?void 0:i.exit)??Dy.exit(Ny.exit,d),...l?{...f,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{...f,...a==null?void 0:a.exit}}}}},Fw={initial:"initial",animate:"enter",exit:"exit",variants:O2e},k2e=N.forwardRef(function(t,i){const{unmountOnExit:a,in:l,reverse:d=!0,className:f,offsetX:_=0,offsetY:v=8,transition:b,transitionEnd:C,delay:I,animatePresenceProps:O,...L}=t,M=a?l&&a:!0,F=l||a?"enter":"exit",z={offsetX:_,offsetY:v,reverse:d,transition:b,transitionEnd:C,delay:I};return T.jsx(U0,{...O,custom:z,children:M&&T.jsx(Jf.div,{ref:i,className:_n("chakra-offset-slide",f),custom:z,...Fw,animate:F,...L})})});k2e.displayName="SlideFade";const N2e={exit:({reverse:n,initialScale:t,transition:i,transitionEnd:a,delay:l})=>({opacity:0,...n?{scale:t,transitionEnd:a==null?void 0:a.exit}:{transitionEnd:{scale:t,...a==null?void 0:a.exit}},transition:(i==null?void 0:i.exit)??Dy.exit(Ny.exit,l)}),enter:({transitionEnd:n,transition:t,delay:i})=>({opacity:1,scale:1,transition:(t==null?void 0:t.enter)??Dy.enter(Ny.enter,i),transitionEnd:n==null?void 0:n.enter})},Dne={initial:"exit",animate:"enter",exit:"exit",variants:N2e},D2e=N.forwardRef(function(t,i){const{unmountOnExit:a,in:l,reverse:d=!0,initialScale:f=.95,className:_,transition:v,transitionEnd:b,delay:C,animatePresenceProps:I,...O}=t,L=a?l&&a:!0,M=l||a?"enter":"exit",F={initialScale:f,reverse:d,transition:v,transitionEnd:b,delay:C};return T.jsx(U0,{...I,custom:F,children:L&&T.jsx(Jf.div,{ref:i,className:_n("chakra-offset-slide",_),...Dne,animate:M,custom:F,...O})})});D2e.displayName="ScaleFade";const x2e={slideInBottom:{...Fw,custom:{offsetY:16,reverse:!0}},slideInRight:{...Fw,custom:{offsetX:16,reverse:!0}},slideInTop:{...Fw,custom:{offsetY:-16,reverse:!0}},slideInLeft:{...Fw,custom:{offsetX:-16,reverse:!0}},scale:{...Dne,custom:{initialScale:.95,reverse:!0}},none:{}},L2e=Vt(Jf.section),M2e=n=>x2e[n||"none"],xne=N.forwardRef((n,t)=>{const{preset:i,motionProps:a=M2e(i),...l}=n;return T.jsx(L2e,{ref:t,...a,...l})});xne.displayName="ModalTransition";const Bs=zt((n,t)=>{const{className:i,children:a,containerProps:l,motionProps:d,...f}=n,{getDialogProps:_,getDialogContainerProps:v}=Gy(),b=_(f,t),C=v(l),I=_n("chakra-modal__content",i),O=z0(),L={display:"flex",flexDirection:"column",position:"relative",width:"100%",outline:0,...O.dialog},M={display:"flex",width:"100vw",height:"$100vh",position:"fixed",left:0,top:0,...O.dialogContainer},{motionPreset:F}=Gy();return T.jsx(P2e,{children:T.jsx(Vt.div,{...C,className:"chakra-modal__content-container",tabIndex:-1,__css:M,children:T.jsx(xne,{preset:F,motionProps:d,className:I,...b,__css:L,children:a})})})});Bs.displayName="ModalContent";const zs=zt((n,t)=>{const{className:i,...a}=n,{bodyId:l,setBodyMounted:d}=Gy();N.useEffect(()=>(d(!0),()=>d(!1)),[d]);const f=_n("chakra-modal__body",i),_=z0();return T.jsx(Vt.div,{ref:t,className:f,id:l,...a,__css:_.body})});zs.displayName="ModalBody";const io=zt((n,t)=>{const{onClick:i,className:a,...l}=n,{onClose:d}=Gy(),f=_n("chakra-modal__close-btn",a),_=z0();return T.jsx(lF,{ref:t,__css:_.closeButton,className:f,onClick:Nn(i,v=>{v.stopPropagation(),d()}),...l})});io.displayName="ModalCloseButton";const Sp=zt((n,t)=>{const{className:i,...a}=n,l=_n("chakra-modal__footer",i),d=z0(),f={display:"flex",alignItems:"center",justifyContent:"flex-end",...d.footer};return T.jsx(Vt.footer,{ref:t,...a,__css:f,className:l})});Sp.displayName="ModalFooter";const xo=zt((n,t)=>{const{className:i,...a}=n,{headerId:l,setHeaderMounted:d}=Gy();N.useEffect(()=>(d(!0),()=>d(!1)),[d]);const f=_n("chakra-modal__header",i),_=z0(),v={flex:0,..._.header};return T.jsx(Vt.header,{ref:t,className:f,id:l,...a,__css:v})});xo.displayName="ModalHeader";const U2e={enter:({transition:n,transitionEnd:t,delay:i}={})=>({opacity:1,transition:(n==null?void 0:n.enter)??Dy.enter(Ny.enter,i),transitionEnd:t==null?void 0:t.enter}),exit:({transition:n,transitionEnd:t,delay:i}={})=>({opacity:0,transition:(n==null?void 0:n.exit)??Dy.exit(Ny.exit,i),transitionEnd:t==null?void 0:t.exit})},Lne={initial:"exit",animate:"enter",exit:"exit",variants:U2e},V2e=N.forwardRef(function(t,i){const{unmountOnExit:a,in:l,className:d,transition:f,transitionEnd:_,delay:v,animatePresenceProps:b,...C}=t,I=l||a?"enter":"exit",O=a?l&&a:!0,L={transition:f,transitionEnd:_,delay:v};return T.jsx(U0,{...b,custom:L,children:O&&T.jsx(Jf.div,{ref:i,className:_n("chakra-fade",d),custom:L,...Lne,animate:I,...C})})});V2e.displayName="Fade";const j2e=Vt(Jf.div),Ws=zt((n,t)=>{const{className:i,transition:a,motionProps:l,...d}=n,f=_n("chakra-modal__overlay",i),v={pos:"fixed",left:"0",top:"0",w:"100vw",h:"100vh",...z0().overlay},{motionPreset:b}=Gy(),I=l||(b==="none"?{}:Lne);return T.jsx(j2e,{...I,__css:v,ref:t,className:f,...d})});Ws.displayName="ModalOverlay";function F2e(n){const{leastDestructiveRef:t,...i}=n;return T.jsx(Fs,{...i,initialFocusRef:t})}const B2e=zt((n,t)=>T.jsx(Bs,{ref:t,role:"alertdialog",...n})),z2e=n=>T.jsx(En,{viewBox:"0 0 24 24",...n,children:T.jsx("path",{fill:"currentColor",d:"M21,5H3C2.621,5,2.275,5.214,2.105,5.553C1.937,5.892,1.973,6.297,2.2,6.6l9,12 c0.188,0.252,0.485,0.4,0.8,0.4s0.611-0.148,0.8-0.4l9-12c0.228-0.303,0.264-0.708,0.095-1.047C21.725,5.214,21.379,5,21,5z"})}),W2e=n=>T.jsx(En,{viewBox:"0 0 24 24",...n,children:T.jsx("path",{fill:"currentColor",d:"M12.8,5.4c-0.377-0.504-1.223-0.504-1.6,0l-9,12c-0.228,0.303-0.264,0.708-0.095,1.047 C2.275,18.786,2.621,19,3,19h18c0.379,0,0.725-0.214,0.895-0.553c0.169-0.339,0.133-0.744-0.095-1.047L12.8,5.4z"})});function YY(n,t,i,a){N.useEffect(()=>{if(!n.current||!a)return;const l=n.current.ownerDocument.defaultView??window,d=Array.isArray(t)?t:[t],f=new l.MutationObserver(_=>{for(const v of _)v.type==="attributes"&&v.attributeName&&d.includes(v.attributeName)&&i(v)});return f.observe(n.current,{attributes:!0,attributeFilter:d}),()=>f.disconnect()})}const G2e=50,XY=300;function H2e(n,t){const[i,a]=N.useState(!1),[l,d]=N.useState(null),[f,_]=N.useState(!0),v=N.useRef(null),b=()=>clearTimeout(v.current);NEe(()=>{l==="increment"&&n(),l==="decrement"&&t()},i?G2e:null);const C=N.useCallback(()=>{f&&n(),v.current=setTimeout(()=>{_(!1),a(!0),d("increment")},XY)},[n,f]),I=N.useCallback(()=>{f&&t(),v.current=setTimeout(()=>{_(!1),a(!0),d("decrement")},XY)},[t,f]),O=N.useCallback(()=>{_(!0),a(!1),b()},[]);return N.useEffect(()=>()=>b(),[]),{up:C,down:I,stop:O,isSpinning:i}}const $2e=/^[Ee0-9+\-.]$/;function K2e(n){return $2e.test(n)}function q2e(n,t){if(n.key==null)return!0;const i=n.ctrlKey||n.altKey||n.metaKey;return!(n.key.length===1)||i?!0:t(n.key)}function Y2e(n={}){const{focusInputOnChange:t=!0,clampValueOnBlur:i=!0,keepWithinRange:a=!0,min:l=Number.MIN_SAFE_INTEGER,max:d=Number.MAX_SAFE_INTEGER,step:f=1,isReadOnly:_,isDisabled:v,isRequired:b,isInvalid:C,pattern:I="[0-9]*(.[0-9]+)?",inputMode:O="decimal",allowMouseWheel:L,id:M,onChange:F,precision:z,name:Z,"aria-describedby":K,"aria-label":re,"aria-labelledby":ae,onFocus:ne,onBlur:pe,onInvalid:X,getAriaValueText:J,isValidCharacter:Q,format:se,parse:de,...he}=n,le=to(ne),Oe=to(pe),Ve=to(X),xe=to(Q??K2e),Re=to(J),ve=yEe(n),{update:be,increment:ze,decrement:Pe}=ve,[we,ke]=N.useState(!1),Ue=!(_||v),Be=N.useRef(null),qe=N.useRef(null),$e=N.useRef(null),it=N.useRef(null),Je=N.useCallback(Tt=>Tt.split("").filter(xe).join(""),[xe]),Ct=N.useCallback(Tt=>(de==null?void 0:de(Tt))??Tt,[de]),kt=N.useCallback(Tt=>((se==null?void 0:se(Tt))??Tt).toString(),[se]);zf(()=>{(ve.valueAsNumber>d||ve.valueAsNumber<l)&&(Ve==null||Ve("rangeOverflow",kt(ve.value),ve.valueAsNumber))},[ve.valueAsNumber,ve.value,kt,Ve]),op(()=>{if(!Be.current)return;if(Be.current.value!=ve.value){const ir=Ct(Be.current.value);ve.setValue(Je(ir))}},[Ct,Je]);const He=N.useCallback((Tt=f)=>{Ue&&ze(Tt)},[ze,Ue,f]),lt=N.useCallback((Tt=f)=>{Ue&&Pe(Tt)},[Pe,Ue,f]),mt=H2e(He,lt);YY($e,"disabled",mt.stop,mt.isSpinning),YY(it,"disabled",mt.stop,mt.isSpinning);const Lt=N.useCallback(Tt=>{if(Tt.nativeEvent.isComposing)return;const Ut=Ct(Tt.currentTarget.value);be(Je(Ut)),qe.current={start:Tt.currentTarget.selectionStart,end:Tt.currentTarget.selectionEnd}},[be,Je,Ct]),Xt=N.useCallback(Tt=>{var ir;le==null||le(Tt),qe.current&&(Tt.currentTarget.selectionStart=qe.current.start??((ir=Tt.currentTarget.value)==null?void 0:ir.length),Tt.currentTarget.selectionEnd=qe.current.end??Tt.currentTarget.selectionStart)},[le]),$t=N.useCallback(Tt=>{if(Tt.nativeEvent.isComposing)return;q2e(Tt,xe)||Tt.preventDefault();const ir=Te(Tt)*f,Ut=Tt.key,gn={ArrowUp:()=>He(ir),ArrowDown:()=>lt(ir),Home:()=>be(l),End:()=>be(d)}[Ut];gn&&(Tt.preventDefault(),gn(Tt))},[xe,f,He,lt,be,l,d]),Te=Tt=>{let ir=1;return(Tt.metaKey||Tt.ctrlKey)&&(ir=.1),Tt.shiftKey&&(ir=10),ir},je=N.useMemo(()=>{const Tt=Re==null?void 0:Re(ve.value);if(Tt!=null)return Tt;const ir=ve.value.toString();return ir||void 0},[ve.value,Re]),Ke=N.useCallback(()=>{let Tt=ve.value;if(ve.value==="")return;/^[eE]/.test(ve.value.toString())?ve.setValue(""):(ve.valueAsNumber<l&&(Tt=l),ve.valueAsNumber>d&&(Tt=d),ve.cast(Tt))},[ve,d,l]),gt=N.useCallback(()=>{ke(!1),i&&Ke()},[i,ke,Ke]),Et=N.useCallback(()=>{t&&requestAnimationFrame(()=>{var Tt;(Tt=Be.current)==null||Tt.focus()})},[t]),wt=N.useCallback(Tt=>{Tt.preventDefault(),mt.up(),Et()},[Et,mt]),Kt=N.useCallback(Tt=>{Tt.preventDefault(),mt.down(),Et()},[Et,mt]);Iy(()=>Be.current,"wheel",Tt=>{var Ni;const Ut=(((Ni=Be.current)==null?void 0:Ni.ownerDocument)??document).activeElement===Be.current;if(!L||!Ut)return;Tt.preventDefault();const Wt=Te(Tt)*f,gn=Math.sign(Tt.deltaY);gn===-1?He(Wt):gn===1&&lt(Wt)},{passive:!1});const mn=N.useCallback((Tt={},ir=null)=>{const Ut=v||a&&ve.isAtMax;return{...Tt,ref:Vi(ir,$e),role:"button",tabIndex:-1,onPointerDown:Nn(Tt.onPointerDown,Wt=>{Wt.button!==0||Ut||wt(Wt)}),onPointerLeave:Nn(Tt.onPointerLeave,mt.stop),onPointerUp:Nn(Tt.onPointerUp,mt.stop),disabled:Ut,"aria-disabled":Lf(Ut)}},[ve.isAtMax,a,wt,mt.stop,v]),vn=N.useCallback((Tt={},ir=null)=>{const Ut=v||a&&ve.isAtMin;return{...Tt,ref:Vi(ir,it),role:"button",tabIndex:-1,onPointerDown:Nn(Tt.onPointerDown,Wt=>{Wt.button!==0||Ut||Kt(Wt)}),onPointerLeave:Nn(Tt.onPointerLeave,mt.stop),onPointerUp:Nn(Tt.onPointerUp,mt.stop),disabled:Ut,"aria-disabled":Lf(Ut)}},[ve.isAtMin,a,Kt,mt.stop,v]),rn=N.useCallback((Tt={},ir=null)=>({name:Z,inputMode:O,type:"text",pattern:I,"aria-labelledby":ae,"aria-label":re,"aria-describedby":K,id:M,disabled:v,role:"spinbutton",...Tt,readOnly:Tt.readOnly??_,"aria-readonly":Tt.readOnly??_,"aria-required":Tt.required??b,required:Tt.required??b,ref:Vi(Be,ir),value:kt(ve.value),"aria-valuemin":l,"aria-valuemax":d,"aria-valuenow":Number.isNaN(ve.valueAsNumber)?void 0:ve.valueAsNumber,"aria-invalid":Lf(C??ve.isOutOfRange),"aria-valuetext":je,autoComplete:"off",autoCorrect:"off",onChange:Nn(Tt.onChange,Lt),onKeyDown:Nn(Tt.onKeyDown,$t),onFocus:Nn(Tt.onFocus,Xt,()=>ke(!0)),onBlur:Nn(Tt.onBlur,Oe,gt)}),[Z,O,I,ae,re,kt,K,M,v,b,_,C,ve.value,ve.valueAsNumber,ve.isOutOfRange,l,d,je,Lt,$t,Xt,Oe,gt]);return{value:kt(ve.value),valueAsNumber:ve.valueAsNumber,isFocused:we,isDisabled:v,isReadOnly:_,getIncrementButtonProps:mn,getDecrementButtonProps:vn,getInputProps:rn,htmlProps:he}}const[X2e,N1]=Ti({name:"NumberInputStylesContext",errorMessage:`useNumberInputStyles returned is 'undefined'. Seems you forgot to wrap the components in "<NumberInput />" `}),[J2e,VF]=Ti({name:"NumberInputContext",errorMessage:"useNumberInputContext: `context` is undefined. Seems you forgot to wrap number-input's components within <NumberInput />"}),Ls=zt(function(t,i){const a=ka("NumberInput",t),l=Fi(t),d=pF(l),{htmlProps:f,..._}=Y2e(d),v=N.useMemo(()=>_,[_]);return T.jsx(J2e,{value:v,children:T.jsx(X2e,{value:a,children:T.jsx(Vt.div,{...f,ref:i,className:_n("chakra-numberinput",t.className),__css:{position:"relative",zIndex:0,...a.root}})})})});Ls.displayName="NumberInput";const Ms=zt(function(t,i){const a=N1();return T.jsx(Vt.div,{"aria-hidden":!0,ref:i,...t,__css:{display:"flex",flexDirection:"column",position:"absolute",top:"0",insetEnd:"0px",margin:"1px",height:"calc(100% - 2px)",zIndex:1,...a.stepperGroup}})});Ms.displayName="NumberInputStepper";const Us=zt(function(t,i){const{getInputProps:a}=VF(),l=a(t,i),d=N1();return T.jsx(Vt.input,{...l,className:_n("chakra-numberinput__field",t.className),__css:{width:"100%",...d.field}})});Us.displayName="NumberInputField";const Mne=Vt("div",{baseStyle:{display:"flex",justifyContent:"center",alignItems:"center",flex:1,transitionProperty:"common",transitionDuration:"normal",userSelect:"none",cursor:"pointer",lineHeight:"normal"}}),Vs=zt(function(t,i){const a=N1(),{getDecrementButtonProps:l}=VF(),d=l(t,i);return T.jsx(Mne,{...d,__css:a.stepper,children:t.children??T.jsx(z2e,{})})});Vs.displayName="NumberDecrementStepper";const js=zt(function(t,i){const{getIncrementButtonProps:a}=VF(),l=a(t,i),d=N1();return T.jsx(Mne,{...l,__css:d.stepper,children:t.children??T.jsx(W2e,{})})});js.displayName="NumberIncrementStepper";const[Q2e,D1]=Ti({name:"PopoverContext",errorMessage:"usePopoverContext: `context` is undefined. Seems you forgot to wrap all popover components within `<Popover />`"}),[Z2e,Une]=Ti({name:"PopoverStylesContext",errorMessage:`usePopoverStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Popover />" `}),IS={click:"click",hover:"hover"};function eMe(n={}){const{closeOnBlur:t=!0,closeOnEsc:i=!0,initialFocusRef:a,id:l,returnFocusOnClose:d=!0,autoFocus:f=!0,arrowSize:_,arrowShadowColor:v,trigger:b=IS.click,openDelay:C=200,closeDelay:I=200,isLazy:O,lazyBehavior:L="unmount",computePositionOnMount:M,...F}=n,{isOpen:z,onClose:Z,onOpen:K,onToggle:re}=yp(n),[ae,ne]=N.useState(d);N.useEffect(()=>ne(d),[d]);const pe=N.useRef(null),X=N.useRef(null),J=N.useRef(null),Q=N.useRef(!1),se=N.useRef(!1);z&&(se.current=!0);const[de,he]=N.useState(!1),[le,Oe]=N.useState(!1),Ve=N.useId(),xe=l??Ve,[Re,ve,be,ze]=["popover-trigger","popover-content","popover-header","popover-body"].map($t=>`${$t}-${xe}`),{referenceRef:Pe,getArrowProps:we,getPopperProps:ke,getArrowInnerProps:Ue,forceUpdate:Be}=UF({...F,enabled:z||!!M}),qe=KQ({isOpen:z,ref:J});PEe({enabled:z,ref:X}),XQ(J,{focusRef:X,visible:z,shouldFocus:ae&&b===IS.click}),SEe(J,{focusRef:a,visible:z,shouldFocus:f&&b===IS.click}),ZQ({enabled:z&&t,ref:J,handler($t){var je;const Te=((je=$t.composedPath)==null?void 0:je.call($t)[0])??[$t.target];wO(X.current,Te)||(Te&&ne(!Ek(Te)),Z())}});const $e=sj({wasSelected:se.current,enabled:O,mode:L,isSelected:qe.present}),it=N.useCallback(($t={},Te=null)=>{const je={...$t,style:{...$t.style,transformOrigin:fo.transformOrigin.varRef,[fo.arrowSize.var]:_?`${_}px`:void 0,[fo.arrowShadowColor.var]:v},ref:Vi(J,Te),children:$e?$t.children:null,id:ve,tabIndex:-1,role:"dialog",onKeyDown:Nn($t.onKeyDown,Ke=>{Ke.nativeEvent.isComposing||i&&Ke.key==="Escape"&&(Ke.preventDefault(),Ke.stopPropagation(),Z())}),onBlur:Nn($t.onBlur,Ke=>{const gt=JY(Ke),Et=wO(J.current,gt),wt=wO(X.current,gt),Kt=!Et&&!wt;gt&&ne(!Ek(gt)),z&&t&&Kt&&Z()}),"aria-labelledby":de?be:void 0,"aria-describedby":le?ze:void 0};return b===IS.hover&&(je.role="tooltip",je.onMouseEnter=Nn($t.onMouseEnter,()=>{Q.current=!0}),je.onMouseLeave=Nn($t.onMouseLeave,Ke=>{Ke.nativeEvent.relatedTarget!==null&&(Q.current=!1,setTimeout(()=>Z(),I))})),je},[$e,ve,de,be,le,ze,b,i,Z,z,t,I,v,_]),Je=N.useCallback(($t={},Te=null)=>ke({...$t,style:{visibility:z?"visible":"hidden",...$t.style}},Te),[z,ke]),Ct=N.useCallback(($t,Te=null)=>({...$t,ref:Vi(Te,pe,Pe)}),[pe,Pe]),kt=N.useRef(void 0),He=N.useRef(void 0),lt=N.useCallback($t=>{pe.current==null&&Pe($t)},[Pe]),mt=N.useCallback(($t={},Te=null)=>{const je={...$t,ref:Vi(X,Te,lt),id:Re,"aria-haspopup":"dialog","aria-expanded":z,"aria-controls":ve};return b===IS.click&&(je.onClick=Nn($t.onClick,re)),b===IS.hover&&(je.onFocus=Nn($t.onFocus,()=>{kt.current===void 0&&K()}),je.onBlur=Nn($t.onBlur,Ke=>{const gt=JY(Ke),Et=!wO(J.current,gt);z&&t&&Et&&Z()}),je.onKeyDown=Nn($t.onKeyDown,Ke=>{Ke.key==="Escape"&&Z()}),je.onMouseEnter=Nn($t.onMouseEnter,()=>{Q.current=!0,kt.current=window.setTimeout(()=>K(),C)}),je.onMouseLeave=Nn($t.onMouseLeave,()=>{Q.current=!1,kt.current&&(clearTimeout(kt.current),kt.current=void 0),He.current=window.setTimeout(()=>{Q.current===!1&&Z()},I)})),je},[Re,z,ve,b,lt,re,K,t,Z,C,I]);N.useEffect(()=>()=>{kt.current&&clearTimeout(kt.current),He.current&&clearTimeout(He.current)},[]);const Lt=N.useCallback(($t={},Te=null)=>({...$t,id:be,ref:Vi(Te,je=>{he(!!je)})}),[be]),Xt=N.useCallback(($t={},Te=null)=>({...$t,id:ze,ref:Vi(Te,je=>{Oe(!!je)})}),[ze]);return{forceUpdate:Be,isOpen:z,onAnimationComplete:qe.onComplete,onClose:Z,getAnchorProps:Ct,getArrowProps:we,getArrowInnerProps:Ue,getPopoverPositionerProps:Je,getPopoverProps:it,getTriggerProps:mt,getHeaderProps:Lt,getBodyProps:Xt}}function wO(n,t){return n===t||(n==null?void 0:n.contains(t))}function JY(n){const t=n.currentTarget.ownerDocument.activeElement;return n.relatedTarget??t}function Vne(n){const t=ka("Popover",n),{children:i,...a}=Fi(n),l=F0(),d=eMe({...a,direction:l.direction});return T.jsx(Q2e,{value:d,children:T.jsx(Z2e,{value:t,children:ml(i,{isOpen:d.isOpen,onClose:d.onClose,forceUpdate:d.forceUpdate})})})}Vne.displayName="Popover";function jne(n){var i;const t=N.version;return typeof t!="string"||t.startsWith("18.")?n==null?void 0:n.ref:(i=n==null?void 0:n.props)==null?void 0:i.ref}const Fne=zt(function(t,i){const{getBodyProps:a}=D1(),l=Une();return T.jsx(Vt.div,{...a(t,i),className:_n("chakra-popover__body",t.className),__css:l.body})});Fne.displayName="PopoverBody";function tMe(n){if(n)return{enter:{...n.enter,visibility:"visible"},exit:{...n.exit,transitionEnd:{visibility:"hidden"}}}}const nMe={exit:{opacity:0,scale:.95,transition:{duration:.1,ease:[.4,0,1,1]}},enter:{scale:1,opacity:1,transition:{duration:.15,ease:[0,0,.2,1]}}},rMe=Vt(Jf.section),Bne=zt(function(t,i){const{variants:a=nMe,...l}=t,{isOpen:d}=D1();return T.jsx(rMe,{ref:i,variants:tMe(a),initial:!1,animate:d?"enter":"exit",...l})});Bne.displayName="PopoverTransition";const zne=zt(function(t,i){const{rootProps:a,motionProps:l,...d}=t,{getPopoverProps:f,getPopoverPositionerProps:_,onAnimationComplete:v}=D1(),b=Une(),C={position:"relative",display:"flex",flexDirection:"column",...b.content};return T.jsx(Vt.div,{..._(a),__css:b.popper,className:"chakra-popover__popper",children:T.jsx(Bne,{...l,...f(d,i),onAnimationComplete:BQ(v,d.onAnimationComplete),className:_n("chakra-popover__content",t.className),__css:C})})});zne.displayName="PopoverContent";function Wne(n){const t=N.Children.only(n.children),{getTriggerProps:i}=D1();return T.jsx(T.Fragment,{children:N.cloneElement(t,i(t.props,jne(t)))})}Wne.displayName="PopoverTrigger";function iMe(n,t,i){return(n-t)*100/(i-t)}qC({"0%":{strokeDasharray:"1, 400",strokeDashoffset:"0"},"50%":{strokeDasharray:"400, 400",strokeDashoffset:"-100"},"100%":{strokeDasharray:"400, 400",strokeDashoffset:"-260"}});qC({"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}});const sMe=qC({"0%":{left:"-40%"},"100%":{left:"100%"}}),oMe=qC({from:{backgroundPosition:"1rem 0"},to:{backgroundPosition:"0 0"}});function aMe(n){const{value:t=0,min:i,max:a,valueText:l,getValueText:d,isIndeterminate:f,role:_="progressbar"}=n,v=iMe(t,i,a);return{bind:{"data-indeterminate":f?"":void 0,"aria-valuemax":a,"aria-valuemin":i,"aria-valuenow":f?void 0:t,"aria-valuetext":(()=>{if(t!=null)return typeof d=="function"?d(t,v):l})(),role:_},percent:v,value:t}}const[cMe,lMe]=Ti({name:"ProgressStylesContext",errorMessage:`useProgressStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Progress />" `}),uMe=zt((n,t)=>{const{min:i,max:a,value:l,isIndeterminate:d,role:f,..._}=n,v=aMe({value:l,min:i,max:a,isIndeterminate:d,role:f}),C={height:"100%",...lMe().filledTrack};return T.jsx(Vt.div,{ref:t,style:{width:`${v.percent}%`,..._.style},...v.bind,..._,__css:C})}),Uy=zt((n,t)=>{var X;const{value:i,min:a=0,max:l=100,hasStripe:d,isAnimated:f,children:_,borderRadius:v,isIndeterminate:b,"aria-label":C,"aria-labelledby":I,"aria-valuetext":O,title:L,role:M,...F}=Fi(n),z=ka("Progress",n),Z=v??((X=z.track)==null?void 0:X.borderRadius),K={animation:`${oMe} 1s linear infinite`},ne={...!b&&d&&f&&K,...b&&{position:"absolute",willChange:"left",minWidth:"50%",animation:`${sMe} 1s ease infinite normal none running`}},pe={overflow:"hidden",position:"relative",...z.track};return T.jsx(Vt.div,{ref:t,borderRadius:Z,__css:pe,...F,children:T.jsxs(cMe,{value:z,children:[T.jsx(uMe,{"aria-label":C,"aria-labelledby":I,"aria-valuetext":O,min:a,max:l,value:i,isIndeterminate:b,css:ne,borderRadius:Z,title:L,role:M}),_]})})});Uy.displayName="Progress";const Gne=zt(function(t,i){const{children:a,placeholder:l,className:d,...f}=t;return T.jsxs(Vt.select,{...f,ref:i,className:_n("chakra-select",d),children:[l&&T.jsx("option",{value:"",children:l}),a]})});Gne.displayName="SelectField";const Hne=zt((n,t)=>{var re;const i=ka("Select",n),{rootProps:a,placeholder:l,icon:d,color:f,height:_,h:v,minH:b,minHeight:C,iconColor:I,iconSize:O,...L}=Fi(n),[M,F]=dEe(L,Ove),z=hF(F),Z={width:"100%",height:"fit-content",position:"relative",color:f},K={paddingEnd:"2rem",...i.field,_focus:{zIndex:"unset",...(re=i.field)==null?void 0:re._focus}};return T.jsxs(Vt.div,{className:"chakra-select__wrapper",__css:Z,...M,...a,children:[T.jsx(Gne,{ref:t,height:v??_,minH:b??C,placeholder:l,...z,__css:K,children:n.children}),T.jsx($ne,{"data-disabled":nr(z.disabled),...(I||f)&&{color:I||f},__css:i.icon,...O&&{fontSize:O},children:d})]})});Hne.displayName="Select";const dMe=n=>T.jsx("svg",{viewBox:"0 0 24 24",...n,children:T.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),hMe=Vt("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),$ne=n=>{const{children:t=T.jsx(dMe,{}),...i}=n,a=N.cloneElement(t,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return T.jsx(hMe,{...i,className:"chakra-select__icon-wrapper",children:N.isValidElement(t)?a:null})};$ne.displayName="SelectIcon";function KM(n){const{orientation:t,vertical:i,horizontal:a}=n;return t==="vertical"?i:a}function pMe(n){const{orientation:t,thumbPercents:i,isReversed:a}=n,l=L=>({position:"absolute",userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",touchAction:"none",...KM({orientation:t,vertical:{bottom:`calc(${i[L]}% - var(--slider-thumb-size) / 2)`},horizontal:{left:`calc(${i[L]}% - var(--slider-thumb-size) / 2)`}})}),d={position:"relative",touchAction:"none",WebkitTapHighlightColor:"rgba(0,0,0,0)",userSelect:"none",outline:0},f={position:"absolute",...KM({orientation:t,vertical:{left:"50%",transform:"translateX(-50%)",height:"100%"},horizontal:{top:"50%",transform:"translateY(-50%)",width:"100%"}})},_=i.length===1,v=[0,a?100-i[0]:i[0]],b=_?v:i;let C=b[0];!_&&a&&(C=100-C);const I=Math.abs(b[b.length-1]-b[0]),O={...f,...KM({orientation:t,vertical:a?{height:`${I}%`,top:`${C}%`}:{height:`${I}%`,bottom:`${C}%`},horizontal:a?{width:`${I}%`,right:`${C}%`}:{width:`${I}%`,left:`${C}%`}})};return{trackStyle:f,innerTrackStyle:O,rootStyle:d,getThumbStyle:l}}function fMe(n){const{isReversed:t,direction:i,orientation:a}=n;return i==="ltr"||a==="vertical"?t:!t}function mMe(n){const{min:t=0,max:i=100,onChange:a,value:l,defaultValue:d,isReversed:f,direction:_="ltr",orientation:v="horizontal",id:b,isDisabled:C,isReadOnly:I,onChangeStart:O,onChangeEnd:L,step:M=1,getAriaValueText:F,"aria-valuetext":z,"aria-label":Z,"aria-labelledby":K,name:re,focusThumbOnChange:ae=!0,...ne}=n,pe=to(O),X=to(L),J=to(F),Q=fMe({isReversed:f,direction:_,orientation:v}),[se,de]=qQ({value:l,defaultValue:d??_Me(t,i),onChange:a}),[he,le]=N.useState(!1),[Oe,Ve]=N.useState(!1),xe=!(C||I),Re=(i-t)/10,ve=M||(i-t)/100,be=VO(se,t,i),ze=i-be+t,we=rK(Q?ze:be,t,i),ke=v==="vertical",Ue=QQ({min:t,max:i,step:M,isDisabled:C,value:be,isInteractive:xe,isReversed:Q,isVertical:ke,eventSource:null,focusThumbOnChange:ae,orientation:v}),Be=N.useRef(null),qe=N.useRef(null),$e=N.useRef(null),it=N.useId(),Je=b??it,[Ct,kt]=[`slider-thumb-${Je}`,`slider-track-${Je}`],He=N.useCallback(Ut=>{var oo;if(!Be.current)return;const Wt=Ue.current;Wt.eventSource="pointer";const gn=Be.current.getBoundingClientRect(),{clientX:Ni,clientY:ys}=((oo=Ut.touches)==null?void 0:oo[0])??Ut,oi=ke?gn.bottom-ys:Ni-gn.left,Zo=ke?gn.height:gn.width;let cc=oi/Zo;Q&&(cc=1-cc);let so=aEe(cc,Wt.min,Wt.max);return Wt.step&&(so=parseFloat(iK(so,Wt.min,Wt.step))),so=VO(so,Wt.min,Wt.max),so},[ke,Q,Ue]),lt=N.useCallback(Ut=>{const Wt=Ue.current;Wt.isInteractive&&(Ut=parseFloat(iK(Ut,Wt.min,ve)),Ut=VO(Ut,Wt.min,Wt.max),de(Ut))},[ve,de,Ue]),mt=N.useMemo(()=>({stepUp(Ut=ve){const Wt=Q?be-Ut:be+Ut;lt(Wt)},stepDown(Ut=ve){const Wt=Q?be+Ut:be-Ut;lt(Wt)},reset(){lt(d||0)},stepTo(Ut){lt(Ut)}}),[lt,Q,be,ve,d]),Lt=N.useCallback(Ut=>{const Wt=Ue.current,Ni={ArrowRight:()=>mt.stepUp(),ArrowUp:()=>mt.stepUp(),ArrowLeft:()=>mt.stepDown(),ArrowDown:()=>mt.stepDown(),PageUp:()=>mt.stepUp(Re),PageDown:()=>mt.stepDown(Re),Home:()=>lt(Wt.min),End:()=>lt(Wt.max)}[Ut.key];Ni&&(Ut.preventDefault(),Ut.stopPropagation(),Ni(Ut),Wt.eventSource="keyboard")},[mt,lt,Re,Ue]),Xt=(J==null?void 0:J(be))??z,{getThumbStyle:$t,rootStyle:Te,trackStyle:je,innerTrackStyle:Ke}=N.useMemo(()=>{const Ut=Ue.current;return pMe({isReversed:Q,orientation:Ut.orientation,thumbPercents:[we]})},[Q,we,Ue]),gt=N.useCallback(()=>{Ue.current.focusThumbOnChange&&setTimeout(()=>{var Wt;return(Wt=qe.current)==null?void 0:Wt.focus()})},[Ue]);zf(()=>{const Ut=Ue.current;gt(),Ut.eventSource==="keyboard"&&(X==null||X(Ut.value))},[be,X]);function Et(Ut){const Wt=He(Ut);Wt!=null&&Wt!==Ue.current.value&&de(Wt)}XEe($e,{onPanSessionStart(Ut){const Wt=Ue.current;Wt.isInteractive&&(le(!0),gt(),Et(Ut),pe==null||pe(Wt.value))},onPanSessionEnd(){const Ut=Ue.current;Ut.isInteractive&&(le(!1),X==null||X(Ut.value))},onPan(Ut){Ue.current.isInteractive&&Et(Ut)}});const wt=N.useCallback((Ut={},Wt=null)=>({...Ut,...ne,ref:Vi(Wt,$e),tabIndex:-1,"aria-disabled":Lf(C),"data-focused":nr(Oe),style:{...Ut.style,...Te}}),[ne,C,Oe,Te]),Kt=N.useCallback((Ut={},Wt=null)=>({...Ut,ref:Vi(Wt,Be),id:kt,"data-disabled":nr(C),style:{...Ut.style,...je}}),[C,kt,je]),mn=N.useCallback((Ut={},Wt=null)=>({...Ut,ref:Wt,style:{...Ut.style,...Ke}}),[Ke]),vn=N.useCallback((Ut={},Wt=null)=>({...Ut,ref:Vi(Wt,qe),role:"slider",tabIndex:xe?0:void 0,id:Ct,"data-active":nr(he),"aria-valuetext":Xt,"aria-valuemin":t,"aria-valuemax":i,"aria-valuenow":be,"aria-orientation":v,"aria-disabled":Lf(C),"aria-readonly":Lf(I),"aria-label":Z,"aria-labelledby":Z?void 0:K,style:{...Ut.style,...$t(0)},onKeyDown:Nn(Ut.onKeyDown,Lt),onFocus:Nn(Ut.onFocus,()=>Ve(!0)),onBlur:Nn(Ut.onBlur,()=>Ve(!1))}),[xe,Ct,he,Xt,t,i,be,v,C,I,Z,K,$t,Lt]),rn=N.useCallback((Ut,Wt=null)=>{const gn=!(Ut.value<t||Ut.value>i),Ni=be>=Ut.value,ys=rK(Ut.value,t,i),oi={position:"absolute",pointerEvents:"none",...gMe({orientation:v,vertical:{bottom:Q?`${100-ys}%`:`${ys}%`},horizontal:{left:Q?`${100-ys}%`:`${ys}%`}})};return{...Ut,ref:Wt,role:"presentation","aria-hidden":!0,"data-disabled":nr(C),"data-invalid":nr(!gn),"data-highlighted":nr(Ni),style:{...Ut.style,...oi}}},[C,Q,i,t,v,be]),Tt=N.useCallback((Ut={},Wt=null)=>({...Ut,ref:Wt,type:"hidden",value:be,name:re}),[re,be]);return{state:{value:be,isFocused:Oe,isDragging:he},actions:mt,getRootProps:wt,getTrackProps:Kt,getInnerTrackProps:mn,getThumbProps:vn,getMarkerProps:rn,getInputProps:Tt}}function gMe(n){const{orientation:t,vertical:i,horizontal:a}=n;return t==="vertical"?i:a}function _Me(n,t){return t<n?n:n+(t-n)/2}const[yMe,x1]=Ti({name:"SliderContext",hookName:"useSliderContext",providerName:"<Slider />"}),[EMe,L1]=Ti({name:"SliderStylesContext",hookName:"useSliderStyles",providerName:"<Slider />"}),dV=zt((n,t)=>{const i={...n,orientation:(n==null?void 0:n.orientation)??"horizontal"},a=ka("Slider",i),l=Fi(i),{direction:d}=F0();l.direction=d;const{getInputProps:f,getRootProps:_,...v}=mMe(l),b=_(),C=f({},t);return T.jsx(yMe,{value:v,children:T.jsx(EMe,{value:a,children:T.jsxs(Vt.div,{...b,className:_n("chakra-slider",i.className),__css:a.container,children:[i.children,T.jsx("input",{...C})]})})})});dV.displayName="Slider";const hV=zt((n,t)=>{const{getThumbProps:i}=x1(),a=L1(),l=i(n,t);return T.jsx(Vt.div,{...l,className:_n("chakra-slider__thumb",n.className),__css:a.thumb})});hV.displayName="SliderThumb";const pV=zt((n,t)=>{const{getTrackProps:i}=x1(),a=L1(),l=i(n,t);return T.jsx(Vt.div,{...l,className:_n("chakra-slider__track",n.className),__css:a.track})});pV.displayName="SliderTrack";const fV=zt((n,t)=>{const{getInnerTrackProps:i}=x1(),a=L1(),l=i(n,t);return T.jsx(Vt.div,{...l,className:_n("chakra-slider__filled-track",n.className),__css:a.filledTrack})});fV.displayName="SliderFilledTrack";const vMe=zt((n,t)=>{const{getMarkerProps:i}=x1(),a=L1(),l=i(n,t);return T.jsx(Vt.div,{...l,className:_n("chakra-slider__marker",n.className),__css:a.mark})});vMe.displayName="SliderMark";const xC=Vt("div",{baseStyle:{flex:1,justifySelf:"stretch",alignSelf:"stretch"}});xC.displayName="Spacer";const Kne=n=>T.jsx(Vt.div,{className:"chakra-stack__item",...n,__css:{display:"inline-block",flex:"0 0 auto",minWidth:0,...n.__css}});Kne.displayName="StackItem";function SMe(n){const{spacing:t,direction:i}=n,a={column:{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},"column-reverse":{my:t,mx:0,borderLeftWidth:0,borderBottomWidth:"1px"},row:{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0},"row-reverse":{mx:t,my:0,borderLeftWidth:"1px",borderBottomWidth:0}};return{"&":aj(i,l=>a[l])}}const jF=zt((n,t)=>{const{isInline:i,direction:a,align:l,justify:d,spacing:f="0.5rem",wrap:_,children:v,divider:b,className:C,shouldWrapChildren:I,...O}=n,L=i?"row":a??"column",M=N.useMemo(()=>SMe({spacing:f,direction:L}),[f,L]),F=!!b,z=!I&&!F,Z=N.useMemo(()=>{const re=c1(v);return z?re:re.map((ae,ne)=>{const pe=typeof ae.key<"u"?ae.key:ne,X=ne+1===re.length,Q=I?T.jsx(Kne,{children:ae},pe):ae;if(!F)return Q;const se=N.cloneElement(b,{__css:M}),de=X?null:se;return T.jsxs(N.Fragment,{children:[Q,de]},pe)})},[b,M,F,z,I,v]),K=_n("chakra-stack",C);return T.jsx(Vt.div,{ref:t,display:"flex",alignItems:l,justifyContent:d,flexDirection:L,flexWrap:_,gap:F?void 0:f,className:K,...O,children:Z})});jF.displayName="Stack";const yr=zt((n,t)=>T.jsx(jF,{align:"center",...n,direction:"row",ref:t}));yr.displayName="HStack";const pi=zt((n,t)=>T.jsx(jF,{align:"center",...n,direction:"column",ref:t}));pi.displayName="VStack";const hp=zt(function(t,i){const a=ka("Switch",t),{spacing:l="0.5rem",children:d,...f}=Fi(t),{getIndicatorProps:_,getInputProps:v,getCheckboxProps:b,getRootProps:C,getLabelProps:I}=gNe(f),O=N.useMemo(()=>({display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:0,...a.container}),[a.container]),L=N.useMemo(()=>({display:"inline-flex",flexShrink:0,justifyContent:"flex-start",boxSizing:"content-box",cursor:"pointer",...a.track}),[a.track]),M=N.useMemo(()=>({userSelect:"none",marginStart:l,...a.label}),[l,a.label]);return T.jsxs(Vt.label,{...C(),className:_n("chakra-switch",t.className),__css:O,children:[T.jsx("input",{className:"chakra-switch__input",...v({},i)}),T.jsx(Vt.span,{...b(),className:"chakra-switch__track",__css:L,children:T.jsx(Vt.span,{__css:a.thumb,className:"chakra-switch__thumb",..._()})}),d&&T.jsx(Vt.span,{className:"chakra-switch__label",...I(),__css:M,children:d})]})});hp.displayName="Switch";const[bMe,TMe,wMe,CMe]=Ste();function RMe(n){const{defaultIndex:t,onChange:i,index:a,isManual:l,isLazy:d,lazyBehavior:f="unmount",orientation:_="horizontal",direction:v="ltr",...b}=n,[C,I]=N.useState(t??0),[O,L]=qQ({defaultValue:t??0,value:a,onChange:i});N.useEffect(()=>{a!=null&&I(a)},[a]);const M=wMe(),F=N.useId();return{id:`tabs-${n.id??F}`,selectedIndex:O,focusedIndex:C,setSelectedIndex:L,setFocusedIndex:I,isManual:l,isLazy:d,lazyBehavior:f,orientation:_,descendants:M,direction:v,htmlProps:b}}const[IMe,M1]=Ti({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function AMe(n){const{focusedIndex:t,orientation:i,direction:a}=M1(),l=TMe(),d=N.useCallback(f=>{const _=()=>{var re;const K=l.nextEnabled(t);K&&((re=K.node)==null||re.focus())},v=()=>{var re;const K=l.prevEnabled(t);K&&((re=K.node)==null||re.focus())},b=()=>{var re;const K=l.firstEnabled();K&&((re=K.node)==null||re.focus())},C=()=>{var re;const K=l.lastEnabled();K&&((re=K.node)==null||re.focus())},I=i==="horizontal",O=i==="vertical",L=f.key,M=a==="ltr"?"ArrowLeft":"ArrowRight",F=a==="ltr"?"ArrowRight":"ArrowLeft",Z={[M]:()=>I&&v(),[F]:()=>I&&_(),ArrowDown:()=>O&&_(),ArrowUp:()=>O&&v(),Home:b,End:C}[L];Z&&(f.preventDefault(),Z(f))},[l,t,i,a]);return{...n,role:"tablist","aria-orientation":i,onKeyDown:Nn(n.onKeyDown,d)}}function PMe(n){const{isDisabled:t=!1,isFocusable:i=!1,...a}=n,{setSelectedIndex:l,isManual:d,id:f,setFocusedIndex:_,selectedIndex:v}=M1(),{index:b,register:C}=CMe({disabled:t&&!i}),I=b===v,O=()=>{l(b)},L=()=>{_(b),!d&&!(t&&i)&&l(b)};return{...Sne({...a,ref:Vi(C,n.ref),isDisabled:t,isFocusable:i,onClick:Nn(n.onClick,O)}),id:qne(f,b),role:"tab",tabIndex:I?0:-1,type:"button","aria-selected":I,"aria-controls":Yne(f,b),onFocus:t?void 0:Nn(n.onFocus,L)}}const[OMe,kMe]=Ti({});function NMe(n){const t=M1(),{id:i,selectedIndex:a}=t,d=c1(n.children).map((f,_)=>N.createElement(OMe,{key:f.key??_,value:{isSelected:_===a,id:Yne(i,_),tabId:qne(i,_),selectedIndex:a}},f));return{...n,children:d}}function DMe(n){const{children:t,...i}=n,{isLazy:a,lazyBehavior:l}=M1(),{isSelected:d,id:f,tabId:_}=kMe(),v=N.useRef(!1);d&&(v.current=!0);const b=sj({wasSelected:v.current,isSelected:d,enabled:a,mode:l});return{tabIndex:0,...i,children:b?t:null,role:"tabpanel","aria-labelledby":_,hidden:!d,id:f}}function qne(n,t){return`${n}--tab-${t}`}function Yne(n,t){return`${n}--tabpanel-${t}`}const[xMe,U1]=Ti({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),T0=zt(function(t,i){const a=ka("Tabs",t),{children:l,className:d,...f}=Fi(t),{htmlProps:_,descendants:v,...b}=RMe(f),C=N.useMemo(()=>b,[b]),{isFitted:I,...O}=_,L={position:"relative",...a.root};return T.jsx(bMe,{value:v,children:T.jsx(IMe,{value:C,children:T.jsx(xMe,{value:a,children:T.jsx(Vt.div,{className:_n("chakra-tabs",d),ref:i,...O,__css:L,children:l})})})})});T0.displayName="Tabs";const Ra=zt(function(t,i){const a=U1(),l=PMe({...t,ref:i}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...a.tab};return T.jsx(Vt.button,{...l,className:_n("chakra-tabs__tab",t.className),__css:d})});Ra.displayName="Tab";const w0=zt(function(t,i){const a=AMe({...t,ref:i}),l=U1(),d={display:"flex",...l.tablist};return T.jsx(Vt.div,{...a,className:_n("chakra-tabs__tablist",t.className),__css:d})});w0.displayName="TabList";const Ic=zt(function(t,i){const a=DMe({...t,ref:i}),l=U1();return T.jsx(Vt.div,{outline:"0",...a,className:_n("chakra-tabs__tab-panel",t.className),__css:l.tabpanel})});Ic.displayName="TabPanel";const LC=zt(function(t,i){const a=NMe(t),l=U1();return T.jsx(Vt.div,{...a,width:"100%",ref:i,className:_n("chakra-tabs__tab-panels",t.className),__css:l.tabpanels})});LC.displayName="TabPanels";const[LMe,Xne]=Ti({name:"TagStylesContext",errorMessage:`useTagStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tag />" `}),Jne=zt((n,t)=>{const i=ka("Tag",n),a=Fi(n),l={display:"inline-flex",verticalAlign:"top",alignItems:"center",maxWidth:"100%",...i.container};return T.jsx(LMe,{value:i,children:T.jsx(Vt.span,{ref:t,...a,__css:l})})});Jne.displayName="Tag";const Qne=zt((n,t)=>{const i=Xne();return T.jsx(Vt.span,{ref:t,noOfLines:1,...n,__css:i.label})});Qne.displayName="TagLabel";const MMe=zt((n,t)=>T.jsx(En,{ref:t,verticalAlign:"top",marginEnd:"0.5rem",...n}));MMe.displayName="TagLeftIcon";const UMe=zt((n,t)=>T.jsx(En,{ref:t,verticalAlign:"top",marginStart:"0.5rem",...n}));UMe.displayName="TagRightIcon";const Zne=n=>T.jsx(En,{verticalAlign:"inherit",viewBox:"0 0 512 512",...n,children:T.jsx("path",{fill:"currentColor",d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})});Zne.displayName="TagCloseIcon";const ere=zt((n,t)=>{const{isDisabled:i,children:a,...l}=n,f={display:"flex",alignItems:"center",justifyContent:"center",outline:"0",...Xne().closeButton};return T.jsx(Vt.button,{ref:t,"aria-label":"close",...l,type:"button",disabled:i,__css:f,children:a||T.jsx(Zne,{})})});ere.displayName="TagCloseButton";const VMe=["h","minH","height","minHeight"],tre=zt((n,t)=>{const i=Xu("Textarea",n),{className:a,rows:l,...d}=Fi(n),f=hF(d),_=l?L0(i,VMe):i;return T.jsx(Vt.textarea,{ref:t,rows:l,...f,className:_n("chakra-textarea",a),__css:_})});tre.displayName="Textarea";function jMe(n,t){const i=n??"bottom",l={"top-start":{ltr:"top-left",rtl:"top-right"},"top-end":{ltr:"top-right",rtl:"top-left"},"bottom-start":{ltr:"bottom-left",rtl:"bottom-right"},"bottom-end":{ltr:"bottom-right",rtl:"bottom-left"}}[i];return(l==null?void 0:l[t])??i}function FMe(n,t){const i=l=>({...t,...l,position:jMe((l==null?void 0:l.position)??(t==null?void 0:t.position),n)}),a=l=>{const d=i(l),f=yte(d);return Jh.notify(f,d)};return a.update=(l,d)=>{Jh.update(l,i(d))},a.promise=(l,d)=>{const f=a({...d.loading,status:"loading",duration:null});l.then(_=>a.update(f,{status:"success",duration:5e3,...ml(d.success,_)})).catch(_=>a.update(f,{status:"error",duration:5e3,...ml(d.error,_)}))},a.closeAll=Jh.closeAll,a.close=Jh.close,a.isActive=Jh.isActive,a}function Na(n){const{theme:t}=mte(),i=B1e();return N.useMemo(()=>FMe(t.direction,{...i,...n}),[n,t.direction,i])}const BMe={exit:{scale:.85,opacity:0,transition:{opacity:{duration:.15,easings:"easeInOut"},scale:{duration:.2,easings:"easeInOut"}}},enter:{scale:1,opacity:1,transition:{opacity:{easings:"easeOut",duration:.2},scale:{duration:.2,ease:[.175,.885,.4,1.1]}}}},mV=n=>{var t;return((t=n.current)==null?void 0:t.ownerDocument)||document},rk=n=>{var t,i;return((i=(t=n.current)==null?void 0:t.ownerDocument)==null?void 0:i.defaultView)||window};function zMe(n={}){const{openDelay:t=0,closeDelay:i=0,closeOnClick:a=!0,closeOnMouseDown:l,closeOnScroll:d,closeOnPointerDown:f=l,closeOnEsc:_=!0,onOpen:v,onClose:b,placement:C,id:I,isOpen:O,defaultIsOpen:L,arrowSize:M=10,arrowShadowColor:F,arrowPadding:z,modifiers:Z,isDisabled:K,gutter:re,offset:ae,direction:ne,...pe}=n,{isOpen:X,onOpen:J,onClose:Q}=yp({isOpen:O,defaultIsOpen:L,onOpen:v,onClose:b}),{referenceRef:se,getPopperProps:de,getArrowInnerProps:he,getArrowProps:le}=UF({enabled:X,placement:C,arrowPadding:z,modifiers:Z,gutter:re,offset:ae,direction:ne}),Oe=N.useId(),xe=`tooltip-${I??Oe}`,Re=N.useRef(null),ve=N.useRef(void 0),be=N.useCallback(()=>{ve.current&&(clearTimeout(ve.current),ve.current=void 0)},[]),ze=N.useRef(void 0),Pe=N.useCallback(()=>{ze.current&&(clearTimeout(ze.current),ze.current=void 0)},[]),we=N.useCallback(()=>{Pe(),Q()},[Q,Pe]),ke=WMe(Re,we),Ue=N.useCallback(()=>{if(!K&&!ve.current){X&&ke();const He=rk(Re);ve.current=He.setTimeout(J,t)}},[ke,K,X,J,t]),Be=N.useCallback(()=>{be();const He=rk(Re);ze.current=He.setTimeout(we,i)},[i,we,be]),qe=N.useCallback(()=>{X&&a&&Be()},[a,Be,X]),$e=N.useCallback(()=>{X&&f&&Be()},[f,Be,X]),it=N.useCallback(He=>{X&&He.key==="Escape"&&Be()},[X,Be]);Iy(()=>mV(Re),"keydown",_?it:void 0),Iy(()=>{if(!d)return null;const He=Re.current;if(!He)return null;const lt=$Q(He);return lt.localName==="body"?rk(Re):lt},"scroll",()=>{X&&d&&we()},{passive:!0,capture:!0}),N.useEffect(()=>{K&&(be(),X&&Q())},[K,X,Q,be]),N.useEffect(()=>()=>{be(),Pe()},[be,Pe]),Iy(()=>Re.current,"pointerleave",Be);const Je=N.useCallback((He={},lt=null)=>({...He,ref:Vi(Re,lt,se),onPointerEnter:Nn(He.onPointerEnter,Lt=>{Lt.pointerType!=="touch"&&Ue()}),onClick:Nn(He.onClick,qe),onPointerDown:Nn(He.onPointerDown,$e),onFocus:Nn(He.onFocus,Ue),onBlur:Nn(He.onBlur,Be),"aria-describedby":X?xe:void 0}),[Ue,Be,$e,X,xe,qe,se]),Ct=N.useCallback((He={},lt=null)=>de({...He,style:{...He.style,[fo.arrowSize.var]:M?`${M}px`:void 0,[fo.arrowShadowColor.var]:F}},lt),[de,M,F]),kt=N.useCallback((He={},lt=null)=>{const mt={...He.style,position:"relative",transformOrigin:fo.transformOrigin.varRef};return{ref:lt,...pe,...He,id:xe,role:"tooltip",style:mt}},[pe,xe]);return{isOpen:X,show:Ue,hide:Be,getTriggerProps:Je,getTooltipProps:kt,getTooltipPositionerProps:Ct,getArrowProps:le,getArrowInnerProps:he}}const qM="chakra-ui:close-tooltip";function WMe(n,t){return N.useEffect(()=>{const i=mV(n);return i.addEventListener(qM,t),()=>i.removeEventListener(qM,t)},[t,n]),()=>{const i=mV(n),a=rk(n);i.dispatchEvent(new a.CustomEvent(qM))}}const GMe=Vt(Jf.div),jf=zt((n,t)=>{const i=Xu("Tooltip",n),a=Fi(n),l=F0(),{children:d,label:f,shouldWrapChildren:_,"aria-label":v,hasArrow:b,bg:C,portalProps:I,background:O,backgroundColor:L,bgColor:M,motionProps:F,animatePresenceProps:z,...Z}=a,K=O??L??C??M;if(K){i.bg=K;const se=Fve(l,"colors",K);i[fo.arrowBg.var]=se}const re=zMe({...Z,direction:l.direction}),ae=!N.isValidElement(d)||_;let ne;if(ae)ne=T.jsx(Vt.span,{display:"inline-block",tabIndex:0,...re.getTriggerProps(),children:d});else{const se=N.Children.only(d);ne=N.cloneElement(se,re.getTriggerProps(se.props,jne(se)))}const pe=!!v,X=re.getTooltipProps({},t),J=pe?L0(X,["role","id"]):X,Q=HQ(X,["role","id"]);return f?T.jsxs(T.Fragment,{children:[ne,T.jsx(U0,{...z,children:re.isOpen&&T.jsx(Ju,{...I,children:T.jsx(Vt.div,{...re.getTooltipPositionerProps(),__css:{zIndex:i.zIndex,pointerEvents:"none"},children:T.jsxs(GMe,{variants:BMe,initial:"exit",animate:"enter",exit:"exit",...F,...J,__css:i,children:[f,pe&&T.jsx(Vt.span,{srOnly:!0,...Q,children:v}),b&&T.jsx(Vt.div,{"data-popper-arrow":!0,className:"chakra-tooltip__arrow-wrapper",children:T.jsx(Vt.div,{"data-popper-arrow-inner":!0,className:"chakra-tooltip__arrow",__css:{bg:i.bg}})})]})})})})]}):T.jsx(T.Fragment,{children:d})});jf.displayName="Tooltip";const MC=zt(function(t,i){const a=Xu("Heading",t),{className:l,...d}=Fi(t);return T.jsx(Vt.h2,{ref:i,className:_n("chakra-heading",t.className),...d,__css:a})});MC.displayName="Heading";const at=zt(function(t,i){const a=Xu("Text",t),{className:l,align:d,decoration:f,casing:_,...v}=Fi(t),b=l1({textAlign:t.align,textDecoration:t.decoration,textTransform:t.casing});return T.jsx(Vt.p,{ref:i,className:_n("chakra-text",t.className),...b,...v,__css:a})});at.displayName="Text";const nre=zt(function(t,i){const{spacing:a="0.5rem",spacingX:l,spacingY:d,children:f,justify:_,direction:v,align:b,className:C,shouldWrapChildren:I,...O}=t,L=N.useMemo(()=>I?N.Children.map(f,(M,F)=>T.jsx(FF,{children:M},F)):f,[f,I]);return T.jsx(Vt.div,{ref:i,className:_n("chakra-wrap",C),...O,children:T.jsx(Vt.ul,{className:"chakra-wrap__list",__css:{display:"flex",flexWrap:"wrap",justifyContent:_,alignItems:b,flexDirection:v,listStyleType:"none",gap:a,columnGap:l,rowGap:d,padding:"0"},children:L})})});nre.displayName="Wrap";const FF=zt(function(t,i){const{className:a,...l}=t;return T.jsx(Vt.li,{ref:i,__css:{display:"flex",alignItems:"flex-start"},className:_n("chakra-wrap__listitem",a),...l})});FF.displayName="WrapItem";const HMe="modulepreload",$Me=function(n,t){return new URL(n,t).href},QY={},YM=function(t,i,a){let l=Promise.resolve();if(i&&i.length>0){const f=document.getElementsByTagName("link"),_=document.querySelector("meta[property=csp-nonce]"),v=(_==null?void 0:_.nonce)||(_==null?void 0:_.getAttribute("nonce"));l=Promise.allSettled(i.map(b=>{if(b=$Me(b,a),b in QY)return;QY[b]=!0;const C=b.endsWith(".css"),I=C?'[rel="stylesheet"]':"";if(!!a)for(let M=f.length-1;M>=0;M--){const F=f[M];if(F.href===b&&(!C||F.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${I}`))return;const L=document.createElement("link");if(L.rel=C?"stylesheet":HMe,C||(L.as="script"),L.crossOrigin="",L.href=b,v&&L.setAttribute("nonce",v),document.head.appendChild(L),C)return new Promise((M,F)=>{L.addEventListener("load",M),L.addEventListener("error",()=>F(new Error(`Unable to preload CSS for ${b}`)))})}))}function d(f){const _=new Event("vite:preloadError",{cancelable:!0});if(_.payload=f,window.dispatchEvent(_),!_.defaultPrevented)throw f}return l.then(f=>{for(const _ of f||[])_.status==="rejected"&&d(_.reason);return t().catch(d)})},CO=()=>{const n=new Date,t=n.getHours().toString().padStart(2,"0"),i=n.getMinutes().toString().padStart(2,"0"),a=n.getSeconds().toString().padStart(2,"0"),l=n.getMilliseconds().toString().padStart(3,"0");return`${t}:${i}:${a}.${l}`},$={log:(...n)=>{{const t=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.log(`[LOG] [${CO()}] `,...t)}},error:(...n)=>{{const t=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.error(`[ERROR] [${CO()}] `,...t)}},warn:(...n)=>{{const t=n.map((i,a)=>a===0&&typeof i=="string"?`
${i}`:i);console.warn(`[WARN] [${CO()}]`,...t)}},trace:n=>{console.trace(`[TRACE] [${CO()}] ${n}`)}};async function KMe(n){let t;try{switch(n){case"default":t=await YM(()=>import("./index.v0.9.22.js"),[],import.meta.url);break;default:t=await YM(()=>import("./index.v0.9.22.js"),[],import.meta.url)}return t.default}catch(i){return $.error("Failed to load theme:",i),t=await YM(()=>import("./index.v0.9.22.js"),[],import.meta.url),t.default}}const qMe=()=>{};var ZY={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rre=function(n){const t=[];let i=0;for(let a=0;a<n.length;a++){let l=n.charCodeAt(a);l<128?t[i++]=l:l<2048?(t[i++]=l>>6|192,t[i++]=l&63|128):(l&64512)===55296&&a+1<n.length&&(n.charCodeAt(a+1)&64512)===56320?(l=65536+((l&1023)<<10)+(n.charCodeAt(++a)&1023),t[i++]=l>>18|240,t[i++]=l>>12&63|128,t[i++]=l>>6&63|128,t[i++]=l&63|128):(t[i++]=l>>12|224,t[i++]=l>>6&63|128,t[i++]=l&63|128)}return t},YMe=function(n){const t=[];let i=0,a=0;for(;i<n.length;){const l=n[i++];if(l<128)t[a++]=String.fromCharCode(l);else if(l>191&&l<224){const d=n[i++];t[a++]=String.fromCharCode((l&31)<<6|d&63)}else if(l>239&&l<365){const d=n[i++],f=n[i++],_=n[i++],v=((l&7)<<18|(d&63)<<12|(f&63)<<6|_&63)-65536;t[a++]=String.fromCharCode(55296+(v>>10)),t[a++]=String.fromCharCode(56320+(v&1023))}else{const d=n[i++],f=n[i++];t[a++]=String.fromCharCode((l&15)<<12|(d&63)<<6|f&63)}}return t.join("")},ire={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let l=0;l<n.length;l+=3){const d=n[l],f=l+1<n.length,_=f?n[l+1]:0,v=l+2<n.length,b=v?n[l+2]:0,C=d>>2,I=(d&3)<<4|_>>4;let O=(_&15)<<2|b>>6,L=b&63;v||(L=64,f||(O=64)),a.push(i[C],i[I],i[O],i[L])}return a.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(rre(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):YMe(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const i=t?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let l=0;l<n.length;){const d=i[n.charAt(l++)],_=l<n.length?i[n.charAt(l)]:0;++l;const b=l<n.length?i[n.charAt(l)]:64;++l;const I=l<n.length?i[n.charAt(l)]:64;if(++l,d==null||_==null||b==null||I==null)throw new XMe;const O=d<<2|_>>4;if(a.push(O),b!==64){const L=_<<4&240|b>>2;if(a.push(L),I!==64){const M=b<<6&192|I;a.push(M)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class XMe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const JMe=function(n){const t=rre(n);return ire.encodeByteArray(t,!0)},Lk=function(n){return JMe(n).replace(/\./g,"")},sre=function(n){try{return ire.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QMe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZMe=()=>QMe().__FIREBASE_DEFAULTS__,eUe=()=>{if(typeof process>"u"||typeof ZY>"u")return;const n=ZY.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},tUe=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&sre(n[1]);return t&&JSON.parse(t)},V1=()=>{try{return qMe()||ZMe()||eUe()||tUe()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},ore=n=>{var t,i;return(i=(t=V1())===null||t===void 0?void 0:t.emulatorHosts)===null||i===void 0?void 0:i[n]},are=n=>{const t=ore(n);if(!t)return;const i=t.lastIndexOf(":");if(i<=0||i+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const a=parseInt(t.substring(i+1),10);return t[0]==="["?[t.substring(1,i-1),a]:[t.substring(0,i),a]},cre=()=>{var n;return(n=V1())===null||n===void 0?void 0:n.config},lre=n=>{var t;return(t=V1())===null||t===void 0?void 0:t[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nUe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,i)=>{this.resolve=t,this.reject=i})}wrapCallback(t){return(i,a)=>{i?this.reject(i):this.resolve(a),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(i):t(i,a))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ure(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i={alg:"none",type:"JWT"},a=t||"demo-project",l=n.iat||0,d=n.sub||n.user_id;if(!d)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const f=Object.assign({iss:`https://securetoken.google.com/${a}`,aud:a,iat:l,exp:l+3600,auth_time:l,sub:d,user_id:d,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Lk(JSON.stringify(i)),Lk(JSON.stringify(f)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oc(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function rUe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(oc())}function iUe(){var n;const t=(n=V1())===null||n===void 0?void 0:n.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function sUe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function oUe(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function aUe(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function cUe(){const n=oc();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function lUe(){return!iUe()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function uUe(){try{return typeof indexedDB=="object"}catch{return!1}}function dUe(){return new Promise((n,t)=>{try{let i=!0;const a="validate-browser-context-for-indexeddb-analytics-module",l=self.indexedDB.open(a);l.onsuccess=()=>{l.result.close(),i||self.indexedDB.deleteDatabase(a),n(!0)},l.onupgradeneeded=()=>{i=!1},l.onerror=()=>{var d;t(((d=l.error)===null||d===void 0?void 0:d.message)||"")}}catch(i){t(i)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hUe="FirebaseError";class wp extends Error{constructor(t,i,a){super(i),this.code=t,this.customData=a,this.name=hUe,Object.setPrototypeOf(this,wp.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,oR.prototype.create)}}class oR{constructor(t,i,a){this.service=t,this.serviceName=i,this.errors=a}create(t,...i){const a=i[0]||{},l=`${this.service}/${t}`,d=this.errors[t],f=d?pUe(d,a):"Error",_=`${this.serviceName}: ${f} (${l}).`;return new wp(l,_,a)}}function pUe(n,t){return n.replace(fUe,(i,a)=>{const l=t[a];return l!=null?String(l):`<${a}?>`})}const fUe=/\{\$([^}]+)}/g;function mUe(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}function $f(n,t){if(n===t)return!0;const i=Object.keys(n),a=Object.keys(t);for(const l of i){if(!a.includes(l))return!1;const d=n[l],f=t[l];if(eX(d)&&eX(f)){if(!$f(d,f))return!1}else if(d!==f)return!1}for(const l of a)if(!i.includes(l))return!1;return!0}function eX(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aR(n){const t=[];for(const[i,a]of Object.entries(n))Array.isArray(a)?a.forEach(l=>{t.push(encodeURIComponent(i)+"="+encodeURIComponent(l))}):t.push(encodeURIComponent(i)+"="+encodeURIComponent(a));return t.length?"&"+t.join("&"):""}function Bw(n){const t={};return n.replace(/^\?/,"").split("&").forEach(a=>{if(a){const[l,d]=a.split("=");t[decodeURIComponent(l)]=decodeURIComponent(d)}}),t}function zw(n){const t=n.indexOf("?");if(!t)return"";const i=n.indexOf("#",t);return n.substring(t,i>0?i:void 0)}function gUe(n,t){const i=new _Ue(n,t);return i.subscribe.bind(i)}class _Ue{constructor(t,i){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=i,this.task.then(()=>{t(this)}).catch(a=>{this.error(a)})}next(t){this.forEachObserver(i=>{i.next(t)})}error(t){this.forEachObserver(i=>{i.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,i,a){let l;if(t===void 0&&i===void 0&&a===void 0)throw new Error("Missing Observer.");yUe(t,["next","error","complete"])?l=t:l={next:t,error:i,complete:a},l.next===void 0&&(l.next=XM),l.error===void 0&&(l.error=XM),l.complete===void 0&&(l.complete=XM);const d=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?l.error(this.finalError):l.complete()}catch{}}),this.observers.push(l),d}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let i=0;i<this.observers.length;i++)this.sendOne(i,t)}sendOne(t,i){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{i(this.observers[t])}catch(a){typeof console<"u"&&console.error&&console.error(a)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function yUe(n,t){if(typeof n!="object"||n===null)return!1;for(const i of t)if(i in n&&typeof n[i]=="function")return!0;return!1}function XM(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function us(n){return n&&n._delegate?n._delegate:n}class Ng{constructor(t,i,a){this.name=t,this.instanceFactory=i,this.type=a,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yy="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EUe{constructor(t,i){this.name=t,this.container=i,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const i=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(i)){const a=new nUe;if(this.instancesDeferred.set(i,a),this.isInitialized(i)||this.shouldAutoInitialize())try{const l=this.getOrInitializeService({instanceIdentifier:i});l&&a.resolve(l)}catch{}}return this.instancesDeferred.get(i).promise}getImmediate(t){var i;const a=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),l=(i=t==null?void 0:t.optional)!==null&&i!==void 0?i:!1;if(this.isInitialized(a)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:a})}catch(d){if(l)return null;throw d}else{if(l)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(SUe(t))try{this.getOrInitializeService({instanceIdentifier:yy})}catch{}for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);try{const d=this.getOrInitializeService({instanceIdentifier:l});a.resolve(d)}catch{}}}}clearInstance(t=yy){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...t.filter(i=>"_delete"in i).map(i=>i._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=yy){return this.instances.has(t)}getOptions(t=yy){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:i={}}=t,a=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(a))throw Error(`${this.name}(${a}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const l=this.getOrInitializeService({instanceIdentifier:a,options:i});for(const[d,f]of this.instancesDeferred.entries()){const _=this.normalizeInstanceIdentifier(d);a===_&&f.resolve(l)}return l}onInit(t,i){var a;const l=this.normalizeInstanceIdentifier(i),d=(a=this.onInitCallbacks.get(l))!==null&&a!==void 0?a:new Set;d.add(t),this.onInitCallbacks.set(l,d);const f=this.instances.get(l);return f&&t(f,l),()=>{d.delete(t)}}invokeOnInitCallbacks(t,i){const a=this.onInitCallbacks.get(i);if(a)for(const l of a)try{l(t,i)}catch{}}getOrInitializeService({instanceIdentifier:t,options:i={}}){let a=this.instances.get(t);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:vUe(t),options:i}),this.instances.set(t,a),this.instancesOptions.set(t,i),this.invokeOnInitCallbacks(a,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,a)}catch{}return a||null}normalizeInstanceIdentifier(t=yy){return this.component?this.component.multipleInstances?t:yy:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function vUe(n){return n===yy?void 0:n}function SUe(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bUe{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const i=this.getProvider(t.name);if(i.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);i.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const i=new EUe(t,this);return this.providers.set(t,i),i}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Or;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Or||(Or={}));const TUe={debug:Or.DEBUG,verbose:Or.VERBOSE,info:Or.INFO,warn:Or.WARN,error:Or.ERROR,silent:Or.SILENT},wUe=Or.INFO,CUe={[Or.DEBUG]:"log",[Or.VERBOSE]:"log",[Or.INFO]:"info",[Or.WARN]:"warn",[Or.ERROR]:"error"},RUe=(n,t,...i)=>{if(t<n.logLevel)return;const a=new Date().toISOString(),l=CUe[t];if(l)console[l](`[${a}]  ${n.name}:`,...i);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class BF{constructor(t){this.name=t,this._logLevel=wUe,this._logHandler=RUe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Or))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?TUe[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Or.DEBUG,...t),this._logHandler(this,Or.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Or.VERBOSE,...t),this._logHandler(this,Or.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Or.INFO,...t),this._logHandler(this,Or.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Or.WARN,...t),this._logHandler(this,Or.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Or.ERROR,...t),this._logHandler(this,Or.ERROR,...t)}}const IUe=(n,t)=>t.some(i=>n instanceof i);let tX,nX;function AUe(){return tX||(tX=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function PUe(){return nX||(nX=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const dre=new WeakMap,gV=new WeakMap,hre=new WeakMap,JM=new WeakMap,zF=new WeakMap;function OUe(n){const t=new Promise((i,a)=>{const l=()=>{n.removeEventListener("success",d),n.removeEventListener("error",f)},d=()=>{i(Cg(n.result)),l()},f=()=>{a(n.error),l()};n.addEventListener("success",d),n.addEventListener("error",f)});return t.then(i=>{i instanceof IDBCursor&&dre.set(i,n)}).catch(()=>{}),zF.set(t,n),t}function kUe(n){if(gV.has(n))return;const t=new Promise((i,a)=>{const l=()=>{n.removeEventListener("complete",d),n.removeEventListener("error",f),n.removeEventListener("abort",f)},d=()=>{i(),l()},f=()=>{a(n.error||new DOMException("AbortError","AbortError")),l()};n.addEventListener("complete",d),n.addEventListener("error",f),n.addEventListener("abort",f)});gV.set(n,t)}let _V={get(n,t,i){if(n instanceof IDBTransaction){if(t==="done")return gV.get(n);if(t==="objectStoreNames")return n.objectStoreNames||hre.get(n);if(t==="store")return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return Cg(n[t])},set(n,t,i){return n[t]=i,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function NUe(n){_V=n(_V)}function DUe(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...i){const a=n.call(QM(this),t,...i);return hre.set(a,t.sort?t.sort():[t]),Cg(a)}:PUe().includes(n)?function(...t){return n.apply(QM(this),t),Cg(dre.get(this))}:function(...t){return Cg(n.apply(QM(this),t))}}function xUe(n){return typeof n=="function"?DUe(n):(n instanceof IDBTransaction&&kUe(n),IUe(n,AUe())?new Proxy(n,_V):n)}function Cg(n){if(n instanceof IDBRequest)return OUe(n);if(JM.has(n))return JM.get(n);const t=xUe(n);return t!==n&&(JM.set(n,t),zF.set(t,n)),t}const QM=n=>zF.get(n);function LUe(n,t,{blocked:i,upgrade:a,blocking:l,terminated:d}={}){const f=indexedDB.open(n,t),_=Cg(f);return a&&f.addEventListener("upgradeneeded",v=>{a(Cg(f.result),v.oldVersion,v.newVersion,Cg(f.transaction),v)}),i&&f.addEventListener("blocked",v=>i(v.oldVersion,v.newVersion,v)),_.then(v=>{d&&v.addEventListener("close",()=>d()),l&&v.addEventListener("versionchange",b=>l(b.oldVersion,b.newVersion,b))}).catch(()=>{}),_}const MUe=["get","getKey","getAll","getAllKeys","count"],UUe=["put","add","delete","clear"],ZM=new Map;function rX(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(ZM.get(t))return ZM.get(t);const i=t.replace(/FromIndex$/,""),a=t!==i,l=UUe.includes(i);if(!(i in(a?IDBIndex:IDBObjectStore).prototype)||!(l||MUe.includes(i)))return;const d=async function(f,..._){const v=this.transaction(f,l?"readwrite":"readonly");let b=v.store;return a&&(b=b.index(_.shift())),(await Promise.all([b[i](..._),l&&v.done]))[0]};return ZM.set(t,d),d}NUe(n=>({...n,get:(t,i,a)=>rX(t,i)||n.get(t,i,a),has:(t,i)=>!!rX(t,i)||n.has(t,i)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VUe{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(i=>{if(jUe(i)){const a=i.getImmediate();return`${a.library}/${a.version}`}else return null}).filter(i=>i).join(" ")}}function jUe(n){const t=n.getComponent();return(t==null?void 0:t.type)==="VERSION"}const yV="@firebase/app",iX="0.11.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kf=new BF("@firebase/app"),FUe="@firebase/app-compat",BUe="@firebase/analytics-compat",zUe="@firebase/analytics",WUe="@firebase/app-check-compat",GUe="@firebase/app-check",HUe="@firebase/auth",$Ue="@firebase/auth-compat",KUe="@firebase/database",qUe="@firebase/data-connect",YUe="@firebase/database-compat",XUe="@firebase/functions",JUe="@firebase/functions-compat",QUe="@firebase/installations",ZUe="@firebase/installations-compat",eVe="@firebase/messaging",tVe="@firebase/messaging-compat",nVe="@firebase/performance",rVe="@firebase/performance-compat",iVe="@firebase/remote-config",sVe="@firebase/remote-config-compat",oVe="@firebase/storage",aVe="@firebase/storage-compat",cVe="@firebase/firestore",lVe="@firebase/vertexai",uVe="@firebase/firestore-compat",dVe="firebase",hVe="11.5.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EV="[DEFAULT]",pVe={[yV]:"fire-core",[FUe]:"fire-core-compat",[zUe]:"fire-analytics",[BUe]:"fire-analytics-compat",[GUe]:"fire-app-check",[WUe]:"fire-app-check-compat",[HUe]:"fire-auth",[$Ue]:"fire-auth-compat",[KUe]:"fire-rtdb",[qUe]:"fire-data-connect",[YUe]:"fire-rtdb-compat",[XUe]:"fire-fn",[JUe]:"fire-fn-compat",[QUe]:"fire-iid",[ZUe]:"fire-iid-compat",[eVe]:"fire-fcm",[tVe]:"fire-fcm-compat",[nVe]:"fire-perf",[rVe]:"fire-perf-compat",[iVe]:"fire-rc",[sVe]:"fire-rc-compat",[oVe]:"fire-gcs",[aVe]:"fire-gcs-compat",[cVe]:"fire-fst",[uVe]:"fire-fst-compat",[lVe]:"fire-vertex","fire-js":"fire-js",[dVe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mk=new Map,fVe=new Map,vV=new Map;function sX(n,t){try{n.container.addComponent(t)}catch(i){Kf.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,i)}}function Hy(n){const t=n.name;if(vV.has(t))return Kf.debug(`There were multiple attempts to register component ${t}.`),!1;vV.set(t,n);for(const i of Mk.values())sX(i,n);for(const i of fVe.values())sX(i,n);return!0}function j1(n,t){const i=n.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),n.container.getProvider(t)}function Wl(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mVe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Rg=new oR("app","Firebase",mVe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gVe{constructor(t,i,a){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},i),this._name=i.name,this._automaticDataCollectionEnabled=i.automaticDataCollectionEnabled,this._container=a,this.container.addComponent(new Ng("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Rg.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zy=hVe;function pre(n,t={}){let i=n;typeof t!="object"&&(t={name:t});const a=Object.assign({name:EV,automaticDataCollectionEnabled:!1},t),l=a.name;if(typeof l!="string"||!l)throw Rg.create("bad-app-name",{appName:String(l)});if(i||(i=cre()),!i)throw Rg.create("no-options");const d=Mk.get(l);if(d){if($f(i,d.options)&&$f(a,d.config))return d;throw Rg.create("duplicate-app",{appName:l})}const f=new bUe(l);for(const v of vV.values())f.addComponent(v);const _=new gVe(i,a,f);return Mk.set(l,_),_}function WF(n=EV){const t=Mk.get(n);if(!t&&n===EV&&cre())return pre();if(!t)throw Rg.create("no-app",{appName:n});return t}function pp(n,t,i){var a;let l=(a=pVe[n])!==null&&a!==void 0?a:n;i&&(l+=`-${i}`);const d=l.match(/\s|\//),f=t.match(/\s|\//);if(d||f){const _=[`Unable to register library "${l}" with version "${t}":`];d&&_.push(`library name "${l}" contains illegal characters (whitespace or "/")`),d&&f&&_.push("and"),f&&_.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Kf.warn(_.join(" "));return}Hy(new Ng(`${l}-version`,()=>({library:l,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _Ve="firebase-heartbeat-database",yVe=1,UC="firebase-heartbeat-store";let eU=null;function fre(){return eU||(eU=LUe(_Ve,yVe,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(UC)}catch(i){console.warn(i)}}}}).catch(n=>{throw Rg.create("idb-open",{originalErrorMessage:n.message})})),eU}async function EVe(n){try{const i=(await fre()).transaction(UC),a=await i.objectStore(UC).get(mre(n));return await i.done,a}catch(t){if(t instanceof wp)Kf.warn(t.message);else{const i=Rg.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Kf.warn(i.message)}}}async function oX(n,t){try{const a=(await fre()).transaction(UC,"readwrite");await a.objectStore(UC).put(t,mre(n)),await a.done}catch(i){if(i instanceof wp)Kf.warn(i.message);else{const a=Rg.create("idb-set",{originalErrorMessage:i==null?void 0:i.message});Kf.warn(a.message)}}}function mre(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vVe=1024,SVe=30;class bVe{constructor(t){this.container=t,this._heartbeatsCache=null;const i=this.container.getProvider("app").getImmediate();this._storage=new wVe(i),this._heartbeatsCachePromise=this._storage.read().then(a=>(this._heartbeatsCache=a,a))}async triggerHeartbeat(){var t,i;try{const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=aX();if(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((i=this._heartbeatsCache)===null||i===void 0?void 0:i.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(f=>f.date===d))return;if(this._heartbeatsCache.heartbeats.push({date:d,agent:l}),this._heartbeatsCache.heartbeats.length>SVe){const f=CVe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(f,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){Kf.warn(a)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const i=aX(),{heartbeatsToSend:a,unsentEntries:l}=TVe(this._heartbeatsCache.heartbeats),d=Lk(JSON.stringify({version:2,heartbeats:a}));return this._heartbeatsCache.lastSentHeartbeatDate=i,l.length>0?(this._heartbeatsCache.heartbeats=l,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),d}catch(i){return Kf.warn(i),""}}}function aX(){return new Date().toISOString().substring(0,10)}function TVe(n,t=vVe){const i=[];let a=n.slice();for(const l of n){const d=i.find(f=>f.agent===l.agent);if(d){if(d.dates.push(l.date),cX(i)>t){d.dates.pop();break}}else if(i.push({agent:l.agent,dates:[l.date]}),cX(i)>t){i.pop();break}a=a.slice(1)}return{heartbeatsToSend:i,unsentEntries:a}}class wVe{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return uUe()?dUe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const i=await EVe(this.app);return i!=null&&i.heartbeats?i:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return oX(this.app,{lastSentHeartbeatDate:(i=t.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var i;if(await this._canUseIndexedDBPromise){const l=await this.read();return oX(this.app,{lastSentHeartbeatDate:(i=t.lastSentHeartbeatDate)!==null&&i!==void 0?i:l.lastSentHeartbeatDate,heartbeats:[...l.heartbeats,...t.heartbeats]})}else return}}function cX(n){return Lk(JSON.stringify({version:2,heartbeats:n})).length}function CVe(n){if(n.length===0)return-1;let t=0,i=n[0].date;for(let a=1;a<n.length;a++)n[a].date<i&&(i=n[a].date,t=a);return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RVe(n){Hy(new Ng("platform-logger",t=>new VUe(t),"PRIVATE")),Hy(new Ng("heartbeat",t=>new bVe(t),"PRIVATE")),pp(yV,iX,n),pp(yV,iX,"esm2017"),pp("fire-js","")}RVe("");function gre(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const IVe=gre,_re=new oR("auth","Firebase",gre());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uk=new BF("@firebase/auth");function AVe(n,...t){Uk.logLevel<=Or.WARN&&Uk.warn(`Auth (${Zy}): ${n}`,...t)}function ik(n,...t){Uk.logLevel<=Or.ERROR&&Uk.error(`Auth (${Zy}): ${n}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hd(n,...t){throw GF(n,...t)}function fp(n,...t){return GF(n,...t)}function yre(n,t,i){const a=Object.assign(Object.assign({},IVe()),{[t]:i});return new oR("auth","Firebase",a).create(t,{appName:n.name})}function Ff(n){return yre(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function GF(n,...t){if(typeof n!="string"){const i=t[0],a=[...t.slice(1)];return a[0]&&(a[0].appName=n.name),n._errorFactory.create(i,...a)}return _re.create(n,...t)}function Wn(n,t,...i){if(!n)throw GF(t,...i)}function kf(n){const t="INTERNAL ASSERTION FAILED: "+n;throw ik(t),new Error(t)}function qf(n,t){n||kf(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SV(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function PVe(){return lX()==="http:"||lX()==="https:"}function lX(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OVe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(PVe()||oUe()||"connection"in navigator)?navigator.onLine:!0}function kVe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cR{constructor(t,i){this.shortDelay=t,this.longDelay=i,qf(i>t,"Short delay should be less than long delay!"),this.isMobile=rUe()||aUe()}get(){return OVe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HF(n,t){qf(n.emulator,"Emulator should always be set here");const{url:i}=n.emulator;return t?`${i}${t.startsWith("/")?t.slice(1):t}`:i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ere{static initialize(t,i,a){this.fetchImpl=t,i&&(this.headersImpl=i),a&&(this.responseImpl=a)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;kf("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;kf("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;kf("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NVe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DVe=new cR(3e4,6e4);function Qf(n,t){return n.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:n.tenantId}):t}async function Zf(n,t,i,a,l={}){return vre(n,l,async()=>{let d={},f={};a&&(t==="GET"?f=a:d={body:JSON.stringify(a)});const _=aR(Object.assign({key:n.config.apiKey},f)).slice(1),v=await n._getAdditionalHeaders();v["Content-Type"]="application/json",n.languageCode&&(v["X-Firebase-Locale"]=n.languageCode);const b=Object.assign({method:t,headers:v},d);return sUe()||(b.referrerPolicy="no-referrer"),Ere.fetch()(Sre(n,n.config.apiHost,i,_),b)})}async function vre(n,t,i){n._canInitEmulator=!1;const a=Object.assign(Object.assign({},NVe),t);try{const l=new LVe(n),d=await Promise.race([i(),l.promise]);l.clearNetworkTimeout();const f=await d.json();if("needConfirmation"in f)throw RO(n,"account-exists-with-different-credential",f);if(d.ok&&!("errorMessage"in f))return f;{const _=d.ok?f.errorMessage:f.error.message,[v,b]=_.split(" : ");if(v==="FEDERATED_USER_ID_ALREADY_LINKED")throw RO(n,"credential-already-in-use",f);if(v==="EMAIL_EXISTS")throw RO(n,"email-already-in-use",f);if(v==="USER_DISABLED")throw RO(n,"user-disabled",f);const C=a[v]||v.toLowerCase().replace(/[_\s]+/g,"-");if(b)throw yre(n,C,b);Hd(n,C)}}catch(l){if(l instanceof wp)throw l;Hd(n,"network-request-failed",{message:String(l)})}}async function lR(n,t,i,a,l={}){const d=await Zf(n,t,i,a,l);return"mfaPendingCredential"in d&&Hd(n,"multi-factor-auth-required",{_serverResponse:d}),d}function Sre(n,t,i,a){const l=`${t}${i}?${a}`;return n.config.emulator?HF(n.config,l):`${n.config.apiScheme}://${l}`}function xVe(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class LVe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((i,a)=>{this.timer=setTimeout(()=>a(fp(this.auth,"network-request-failed")),DVe.get())})}}function RO(n,t,i){const a={appName:n.name};i.email&&(a.email=i.email),i.phoneNumber&&(a.phoneNumber=i.phoneNumber);const l=fp(n,t,a);return l.customData._tokenResponse=i,l}function uX(n){return n!==void 0&&n.enterprise!==void 0}class MVe{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const i of this.recaptchaEnforcementState)if(i.provider&&i.provider===t)return xVe(i.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function UVe(n,t){return Zf(n,"GET","/v2/recaptchaConfig",Qf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VVe(n,t){return Zf(n,"POST","/v1/accounts:delete",t)}async function bre(n,t){return Zf(n,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lC(n){if(n)try{const t=new Date(Number(n));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function jVe(n,t=!1){const i=us(n),a=await i.getIdToken(t),l=$F(a);Wn(l&&l.exp&&l.auth_time&&l.iat,i.auth,"internal-error");const d=typeof l.firebase=="object"?l.firebase:void 0,f=d==null?void 0:d.sign_in_provider;return{claims:l,token:a,authTime:lC(tU(l.auth_time)),issuedAtTime:lC(tU(l.iat)),expirationTime:lC(tU(l.exp)),signInProvider:f||null,signInSecondFactor:(d==null?void 0:d.sign_in_second_factor)||null}}function tU(n){return Number(n)*1e3}function $F(n){const[t,i,a]=n.split(".");if(t===void 0||i===void 0||a===void 0)return ik("JWT malformed, contained fewer than 3 sections"),null;try{const l=sre(i);return l?JSON.parse(l):(ik("Failed to decode base64 JWT payload"),null)}catch(l){return ik("Caught error parsing JWT payload as JSON",l==null?void 0:l.toString()),null}}function dX(n){const t=$F(n);return Wn(t,"internal-error"),Wn(typeof t.exp<"u","internal-error"),Wn(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VC(n,t,i=!1){if(i)return t;try{return await t}catch(a){throw a instanceof wp&&FVe(a)&&n.auth.currentUser===n&&await n.auth.signOut(),a}}function FVe({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BVe{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var i;if(t){const a=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),a}else{this.errorBackoff=3e4;const l=((i=this.user.stsTokenManager.expirationTime)!==null&&i!==void 0?i:0)-Date.now()-3e5;return Math.max(0,l)}}schedule(t=!1){if(!this.isRunning)return;const i=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},i)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bV{constructor(t,i){this.createdAt=t,this.lastLoginAt=i,this._initializeTime()}_initializeTime(){this.lastSignInTime=lC(this.lastLoginAt),this.creationTime=lC(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vk(n){var t;const i=n.auth,a=await n.getIdToken(),l=await VC(n,bre(i,{idToken:a}));Wn(l==null?void 0:l.users.length,i,"internal-error");const d=l.users[0];n._notifyReloadListener(d);const f=!((t=d.providerUserInfo)===null||t===void 0)&&t.length?Tre(d.providerUserInfo):[],_=WVe(n.providerData,f),v=n.isAnonymous,b=!(n.email&&d.passwordHash)&&!(_!=null&&_.length),C=v?b:!1,I={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:_,metadata:new bV(d.createdAt,d.lastLoginAt),isAnonymous:C};Object.assign(n,I)}async function zVe(n){const t=us(n);await Vk(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function WVe(n,t){return[...n.filter(a=>!t.some(l=>l.providerId===a.providerId)),...t]}function Tre(n){return n.map(t=>{var{providerId:i}=t,a=tR(t,["providerId"]);return{providerId:i,uid:a.rawId||"",displayName:a.displayName||null,email:a.email||null,phoneNumber:a.phoneNumber||null,photoURL:a.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GVe(n,t){const i=await vre(n,{},async()=>{const a=aR({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:l,apiKey:d}=n.config,f=Sre(n,l,"/v1/token",`key=${d}`),_=await n._getAdditionalHeaders();return _["Content-Type"]="application/x-www-form-urlencoded",Ere.fetch()(f,{method:"POST",headers:_,body:a})});return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}async function HVe(n,t){return Zf(n,"POST","/v2/accounts:revokeToken",Qf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Wn(t.idToken,"internal-error"),Wn(typeof t.idToken<"u","internal-error"),Wn(typeof t.refreshToken<"u","internal-error");const i="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):dX(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,i)}updateFromIdToken(t){Wn(t.length!==0,"internal-error");const i=dX(t);this.updateTokensAndExpiration(t,null,i)}async getToken(t,i=!1){return!i&&this.accessToken&&!this.isExpired?this.accessToken:(Wn(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,i){const{accessToken:a,refreshToken:l,expiresIn:d}=await GVe(t,i);this.updateTokensAndExpiration(a,l,Number(d))}updateTokensAndExpiration(t,i,a){this.refreshToken=i||null,this.accessToken=t||null,this.expirationTime=Date.now()+a*1e3}static fromJSON(t,i){const{refreshToken:a,accessToken:l,expirationTime:d}=i,f=new o0;return a&&(Wn(typeof a=="string","internal-error",{appName:t}),f.refreshToken=a),l&&(Wn(typeof l=="string","internal-error",{appName:t}),f.accessToken=l),d&&(Wn(typeof d=="number","internal-error",{appName:t}),f.expirationTime=d),f}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new o0,this.toJSON())}_performRefresh(){return kf("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dg(n,t){Wn(typeof n=="string"||typeof n>"u","internal-error",{appName:t})}class Nf{constructor(t){var{uid:i,auth:a,stsTokenManager:l}=t,d=tR(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new BVe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=i,this.auth=a,this.stsTokenManager=l,this.accessToken=l.accessToken,this.displayName=d.displayName||null,this.email=d.email||null,this.emailVerified=d.emailVerified||!1,this.phoneNumber=d.phoneNumber||null,this.photoURL=d.photoURL||null,this.isAnonymous=d.isAnonymous||!1,this.tenantId=d.tenantId||null,this.providerData=d.providerData?[...d.providerData]:[],this.metadata=new bV(d.createdAt||void 0,d.lastLoginAt||void 0)}async getIdToken(t){const i=await VC(this,this.stsTokenManager.getToken(this.auth,t));return Wn(i,this.auth,"internal-error"),this.accessToken!==i&&(this.accessToken=i,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),i}getIdTokenResult(t){return jVe(this,t)}reload(){return zVe(this)}_assign(t){this!==t&&(Wn(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(i=>Object.assign({},i)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const i=new Nf(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return i.metadata._copy(this.metadata),i}_onReload(t){Wn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,i=!1){let a=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),a=!0),i&&await Vk(this),await this.auth._persistUserIfCurrent(this),a&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Wl(this.auth.app))return Promise.reject(Ff(this.auth));const t=await this.getIdToken();return await VC(this,VVe(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,i){var a,l,d,f,_,v,b,C;const I=(a=i.displayName)!==null&&a!==void 0?a:void 0,O=(l=i.email)!==null&&l!==void 0?l:void 0,L=(d=i.phoneNumber)!==null&&d!==void 0?d:void 0,M=(f=i.photoURL)!==null&&f!==void 0?f:void 0,F=(_=i.tenantId)!==null&&_!==void 0?_:void 0,z=(v=i._redirectEventId)!==null&&v!==void 0?v:void 0,Z=(b=i.createdAt)!==null&&b!==void 0?b:void 0,K=(C=i.lastLoginAt)!==null&&C!==void 0?C:void 0,{uid:re,emailVerified:ae,isAnonymous:ne,providerData:pe,stsTokenManager:X}=i;Wn(re&&X,t,"internal-error");const J=o0.fromJSON(this.name,X);Wn(typeof re=="string",t,"internal-error"),dg(I,t.name),dg(O,t.name),Wn(typeof ae=="boolean",t,"internal-error"),Wn(typeof ne=="boolean",t,"internal-error"),dg(L,t.name),dg(M,t.name),dg(F,t.name),dg(z,t.name),dg(Z,t.name),dg(K,t.name);const Q=new Nf({uid:re,auth:t,email:O,emailVerified:ae,displayName:I,isAnonymous:ne,photoURL:M,phoneNumber:L,tenantId:F,stsTokenManager:J,createdAt:Z,lastLoginAt:K});return pe&&Array.isArray(pe)&&(Q.providerData=pe.map(se=>Object.assign({},se))),z&&(Q._redirectEventId=z),Q}static async _fromIdTokenResponse(t,i,a=!1){const l=new o0;l.updateFromServerResponse(i);const d=new Nf({uid:i.localId,auth:t,stsTokenManager:l,isAnonymous:a});return await Vk(d),d}static async _fromGetAccountInfoResponse(t,i,a){const l=i.users[0];Wn(l.localId!==void 0,"internal-error");const d=l.providerUserInfo!==void 0?Tre(l.providerUserInfo):[],f=!(l.email&&l.passwordHash)&&!(d!=null&&d.length),_=new o0;_.updateFromIdToken(a);const v=new Nf({uid:l.localId,auth:t,stsTokenManager:_,isAnonymous:f}),b={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:d,metadata:new bV(l.createdAt,l.lastLoginAt),isAnonymous:!(l.email&&l.passwordHash)&&!(d!=null&&d.length)};return Object.assign(v,b),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hX=new Map;function Df(n){qf(n instanceof Function,"Expected a class definition");let t=hX.get(n);return t?(qf(t instanceof n,"Instance stored in cache mismatched with class"),t):(t=new n,hX.set(n,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wre{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,i){this.storage[t]=i}async _get(t){const i=this.storage[t];return i===void 0?null:i}async _remove(t){delete this.storage[t]}_addListener(t,i){}_removeListener(t,i){}}wre.type="NONE";const pX=wre;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sk(n,t,i){return`firebase:${n}:${t}:${i}`}class a0{constructor(t,i,a){this.persistence=t,this.auth=i,this.userKey=a;const{config:l,name:d}=this.auth;this.fullUserKey=sk(this.userKey,l.apiKey,d),this.fullPersistenceKey=sk("persistence",l.apiKey,d),this.boundEventHandler=i._onStorageEvent.bind(i),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?Nf._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const i=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,i)return this.setCurrentUser(i)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,i,a="authUser"){if(!i.length)return new a0(Df(pX),t,a);const l=(await Promise.all(i.map(async b=>{if(await b._isAvailable())return b}))).filter(b=>b);let d=l[0]||Df(pX);const f=sk(a,t.config.apiKey,t.name);let _=null;for(const b of i)try{const C=await b._get(f);if(C){const I=Nf._fromJSON(t,C);b!==d&&(_=I),d=b;break}}catch{}const v=l.filter(b=>b._shouldAllowMigration);return!d._shouldAllowMigration||!v.length?new a0(d,t,a):(d=v[0],_&&await d._set(f,_.toJSON()),await Promise.all(i.map(async b=>{if(b!==d)try{await b._remove(f)}catch{}})),new a0(d,t,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fX(n){const t=n.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Are(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Cre(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Ore(t))return"Blackberry";if(kre(t))return"Webos";if(Rre(t))return"Safari";if((t.includes("chrome/")||Ire(t))&&!t.includes("edge/"))return"Chrome";if(Pre(t))return"Android";{const i=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,a=n.match(i);if((a==null?void 0:a.length)===2)return a[1]}return"Other"}function Cre(n=oc()){return/firefox\//i.test(n)}function Rre(n=oc()){const t=n.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Ire(n=oc()){return/crios\//i.test(n)}function Are(n=oc()){return/iemobile/i.test(n)}function Pre(n=oc()){return/android/i.test(n)}function Ore(n=oc()){return/blackberry/i.test(n)}function kre(n=oc()){return/webos/i.test(n)}function KF(n=oc()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function $Ve(n=oc()){var t;return KF(n)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function KVe(){return cUe()&&document.documentMode===10}function Nre(n=oc()){return KF(n)||Pre(n)||kre(n)||Ore(n)||/windows phone/i.test(n)||Are(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dre(n,t=[]){let i;switch(n){case"Browser":i=fX(oc());break;case"Worker":i=`${fX(oc())}-${n}`;break;default:i=n}const a=t.length?t.join(","):"FirebaseCore-web";return`${i}/JsCore/${Zy}/${a}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qVe{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,i){const a=d=>new Promise((f,_)=>{try{const v=t(d);f(v)}catch(v){_(v)}});a.onAbort=i,this.queue.push(a);const l=this.queue.length-1;return()=>{this.queue[l]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const i=[];try{for(const a of this.queue)await a(t),a.onAbort&&i.push(a.onAbort)}catch(a){i.reverse();for(const l of i)try{l()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:a==null?void 0:a.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YVe(n,t={}){return Zf(n,"GET","/v2/passwordPolicy",Qf(n,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XVe=6;class JVe{constructor(t){var i,a,l,d;const f=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(i=f.minPasswordLength)!==null&&i!==void 0?i:XVe,f.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=f.maxPasswordLength),f.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=f.containsLowercaseCharacter),f.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=f.containsUppercaseCharacter),f.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=f.containsNumericCharacter),f.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=f.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(l=(a=t.allowedNonAlphanumericCharacters)===null||a===void 0?void 0:a.join(""))!==null&&l!==void 0?l:"",this.forceUpgradeOnSignin=(d=t.forceUpgradeOnSignin)!==null&&d!==void 0?d:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var i,a,l,d,f,_;const v={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,v),this.validatePasswordCharacterOptions(t,v),v.isValid&&(v.isValid=(i=v.meetsMinPasswordLength)!==null&&i!==void 0?i:!0),v.isValid&&(v.isValid=(a=v.meetsMaxPasswordLength)!==null&&a!==void 0?a:!0),v.isValid&&(v.isValid=(l=v.containsLowercaseLetter)!==null&&l!==void 0?l:!0),v.isValid&&(v.isValid=(d=v.containsUppercaseLetter)!==null&&d!==void 0?d:!0),v.isValid&&(v.isValid=(f=v.containsNumericCharacter)!==null&&f!==void 0?f:!0),v.isValid&&(v.isValid=(_=v.containsNonAlphanumericCharacter)!==null&&_!==void 0?_:!0),v}validatePasswordLengthOptions(t,i){const a=this.customStrengthOptions.minPasswordLength,l=this.customStrengthOptions.maxPasswordLength;a&&(i.meetsMinPasswordLength=t.length>=a),l&&(i.meetsMaxPasswordLength=t.length<=l)}validatePasswordCharacterOptions(t,i){this.updatePasswordCharacterOptionsStatuses(i,!1,!1,!1,!1);let a;for(let l=0;l<t.length;l++)a=t.charAt(l),this.updatePasswordCharacterOptionsStatuses(i,a>="a"&&a<="z",a>="A"&&a<="Z",a>="0"&&a<="9",this.allowedNonAlphanumericCharacters.includes(a))}updatePasswordCharacterOptionsStatuses(t,i,a,l,d){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=i)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=a)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=l)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QVe{constructor(t,i,a,l){this.app=t,this.heartbeatServiceProvider=i,this.appCheckServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new mX(this),this.idTokenSubscription=new mX(this),this.beforeStateQueue=new qVe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=_re,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(t,i){return i&&(this._popupRedirectResolver=Df(i)),this._initializationPromise=this.queue(async()=>{var a,l;if(!this._deleted&&(this.persistenceManager=await a0.create(this,t),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(i),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const i=await bre(this,{idToken:t}),a=await Nf._fromGetAccountInfoResponse(this,i,t);await this.directlySetCurrentUser(a)}catch(i){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",i),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var i;if(Wl(this.app)){const f=this.app.settings.authIdToken;return f?new Promise(_=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(f).then(_,_))}):this.directlySetCurrentUser(null)}const a=await this.assertedPersistence.getCurrentUser();let l=a,d=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const f=(i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId,_=l==null?void 0:l._redirectEventId,v=await this.tryRedirectSignIn(t);(!f||f===_)&&(v!=null&&v.user)&&(l=v.user,d=!0)}if(!l)return this.directlySetCurrentUser(null);if(!l._redirectEventId){if(d)try{await this.beforeStateQueue.runMiddleware(l)}catch(f){l=a,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(f))}return l?this.reloadAndSetCurrentUserOrClear(l):this.directlySetCurrentUser(null)}return Wn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===l._redirectEventId?this.directlySetCurrentUser(l):this.reloadAndSetCurrentUserOrClear(l)}async tryRedirectSignIn(t){let i=null;try{i=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return i}async reloadAndSetCurrentUserOrClear(t){try{await Vk(t)}catch(i){if((i==null?void 0:i.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=kVe()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Wl(this.app))return Promise.reject(Ff(this));const i=t?us(t):null;return i&&Wn(i.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(i&&i._clone(this))}async _updateCurrentUser(t,i=!1){if(!this._deleted)return t&&Wn(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),i||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Wl(this.app)?Promise.reject(Ff(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Wl(this.app)?Promise.reject(Ff(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Df(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const i=this._getPasswordPolicyInternal();return i.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):i.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await YVe(this),i=new JVe(t);this.tenantId===null?this._projectPasswordPolicy=i:this._tenantPasswordPolicies[this.tenantId]=i}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new oR("auth","Firebase",t())}onAuthStateChanged(t,i,a){return this.registerStateListener(this.authStateSubscription,t,i,a)}beforeAuthStateChanged(t,i){return this.beforeStateQueue.pushCallback(t,i)}onIdTokenChanged(t,i,a){return this.registerStateListener(this.idTokenSubscription,t,i,a)}authStateReady(){return new Promise((t,i)=>{if(this.currentUser)t();else{const a=this.onAuthStateChanged(()=>{a(),t()},i)}})}async revokeAccessToken(t){if(this.currentUser){const i=await this.currentUser.getIdToken(),a={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:i};this.tenantId!=null&&(a.tenantId=this.tenantId),await HVe(this,a)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,i){const a=await this.getOrInitRedirectPersistenceManager(i);return t===null?a.removeCurrentUser():a.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const i=t&&Df(t)||this._popupRedirectResolver;Wn(i,this,"argument-error"),this.redirectPersistenceManager=await a0.create(this,[Df(i._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var i,a;return this._isInitialized&&await this.queue(async()=>{}),((i=this._currentUser)===null||i===void 0?void 0:i._redirectEventId)===t?this._currentUser:((a=this.redirectUser)===null||a===void 0?void 0:a._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,i;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=(i=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&i!==void 0?i:null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,i,a,l){if(this._deleted)return()=>{};const d=typeof i=="function"?i:i.next.bind(i);let f=!1;const _=this._isInitialized?Promise.resolve():this._initializationPromise;if(Wn(_,this,"internal-error"),_.then(()=>{f||d(this.currentUser)}),typeof i=="function"){const v=t.addObserver(i,a,l);return()=>{f=!0,v()}}else{const v=t.addObserver(i);return()=>{f=!0,v()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Wn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=Dre(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const i={"X-Client-Version":this.clientVersion};this.app.options.appId&&(i["X-Firebase-gmpid"]=this.app.options.appId);const a=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());a&&(i["X-Firebase-Client"]=a);const l=await this._getAppCheckToken();return l&&(i["X-Firebase-AppCheck"]=l),i}async _getAppCheckToken(){var t;if(Wl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const i=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return i!=null&&i.error&&AVe(`Error while retrieving App Check token: ${i.error}`),i==null?void 0:i.token}}function Gg(n){return us(n)}class mX{constructor(t){this.auth=t,this.observer=null,this.addObserver=gUe(i=>this.observer=i)}get next(){return Wn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let F1={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function ZVe(n){F1=n}function xre(n){return F1.loadJS(n)}function eje(){return F1.recaptchaEnterpriseScript}function tje(){return F1.gapiScript}function nje(n){return`__${n}${Math.floor(Math.random()*1e6)}`}class rje{constructor(){this.enterprise=new ije}ready(t){t()}execute(t,i){return Promise.resolve("token")}render(t,i){return""}}class ije{ready(t){t()}execute(t,i){return Promise.resolve("token")}render(t,i){return""}}const sje="recaptcha-enterprise",Lre="NO_RECAPTCHA";class oje{constructor(t){this.type=sje,this.auth=Gg(t)}async verify(t="verify",i=!1){async function a(d){if(!i){if(d.tenantId==null&&d._agentRecaptchaConfig!=null)return d._agentRecaptchaConfig.siteKey;if(d.tenantId!=null&&d._tenantRecaptchaConfigs[d.tenantId]!==void 0)return d._tenantRecaptchaConfigs[d.tenantId].siteKey}return new Promise(async(f,_)=>{UVe(d,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(v=>{if(v.recaptchaKey===void 0)_(new Error("recaptcha Enterprise site key undefined"));else{const b=new MVe(v);return d.tenantId==null?d._agentRecaptchaConfig=b:d._tenantRecaptchaConfigs[d.tenantId]=b,f(b.siteKey)}}).catch(v=>{_(v)})})}function l(d,f,_){const v=window.grecaptcha;uX(v)?v.enterprise.ready(()=>{v.enterprise.execute(d,{action:t}).then(b=>{f(b)}).catch(()=>{f(Lre)})}):_(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new rje().execute("siteKey",{action:"verify"}):new Promise((d,f)=>{a(this.auth).then(_=>{if(!i&&uX(window.grecaptcha))l(_,d,f);else{if(typeof window>"u"){f(new Error("RecaptchaVerifier is only supported in browser"));return}let v=eje();v.length!==0&&(v+=_),xre(v).then(()=>{l(_,d,f)}).catch(b=>{f(b)})}}).catch(_=>{f(_)})})}}async function gX(n,t,i,a=!1,l=!1){const d=new oje(n);let f;if(l)f=Lre;else try{f=await d.verify(i)}catch{f=await d.verify(i,!0)}const _=Object.assign({},t);if(i==="mfaSmsEnrollment"||i==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in _){const v=_.phoneEnrollmentInfo.phoneNumber,b=_.phoneEnrollmentInfo.recaptchaToken;Object.assign(_,{phoneEnrollmentInfo:{phoneNumber:v,recaptchaToken:b,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in _){const v=_.phoneSignInInfo.recaptchaToken;Object.assign(_,{phoneSignInInfo:{recaptchaToken:v,captchaResponse:f,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return _}return a?Object.assign(_,{captchaResp:f}):Object.assign(_,{captchaResponse:f}),Object.assign(_,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(_,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),_}async function jk(n,t,i,a,l){var d;if(!((d=n._getRecaptchaConfig())===null||d===void 0)&&d.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const f=await gX(n,t,i,i==="getOobCode");return a(n,f)}else return a(n,t).catch(async f=>{if(f.code==="auth/missing-recaptcha-token"){console.log(`${i} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const _=await gX(n,t,i,i==="getOobCode");return a(n,_)}else return Promise.reject(f)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aje(n,t){const i=j1(n,"auth");if(i.isInitialized()){const l=i.getImmediate(),d=i.getOptions();if($f(d,t??{}))return l;Hd(l,"already-initialized")}return i.initialize({options:t})}function cje(n,t){const i=(t==null?void 0:t.persistence)||[],a=(Array.isArray(i)?i:[i]).map(Df);t!=null&&t.errorMap&&n._updateErrorMap(t.errorMap),n._initializeWithPersistence(a,t==null?void 0:t.popupRedirectResolver)}function lje(n,t,i){const a=Gg(n);Wn(/^https?:\/\//.test(t),a,"invalid-emulator-scheme");const l=!1,d=Mre(t),{host:f,port:_}=uje(t),v=_===null?"":`:${_}`,b={url:`${d}//${f}${v}/`},C=Object.freeze({host:f,port:_,protocol:d.replace(":",""),options:Object.freeze({disableWarnings:l})});if(!a._canInitEmulator){Wn(a.config.emulator&&a.emulatorConfig,a,"emulator-config-failed"),Wn($f(b,a.config.emulator)&&$f(C,a.emulatorConfig),a,"emulator-config-failed");return}a.config.emulator=b,a.emulatorConfig=C,a.settings.appVerificationDisabledForTesting=!0,dje()}function Mre(n){const t=n.indexOf(":");return t<0?"":n.substr(0,t+1)}function uje(n){const t=Mre(n),i=/(\/\/)?([^?#/]+)/.exec(n.substr(t.length));if(!i)return{host:"",port:null};const a=i[2].split("@").pop()||"",l=/^(\[[^\]]+\])(:|$)/.exec(a);if(l){const d=l[1];return{host:d,port:_X(a.substr(d.length+1))}}else{const[d,f]=a.split(":");return{host:d,port:_X(f)}}}function _X(n){if(!n)return null;const t=Number(n);return isNaN(t)?null:t}function dje(){function n(){const t=document.createElement("p"),i=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",i.position="fixed",i.width="100%",i.backgroundColor="#ffffff",i.border=".1em solid #000000",i.color="#b50000",i.bottom="0px",i.left="0px",i.margin="0px",i.zIndex="10000",i.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qF{constructor(t,i){this.providerId=t,this.signInMethod=i}toJSON(){return kf("not implemented")}_getIdTokenResponse(t){return kf("not implemented")}_linkToIdToken(t,i){return kf("not implemented")}_getReauthenticationResolver(t){return kf("not implemented")}}async function hje(n,t){return Zf(n,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pje(n,t){return lR(n,"POST","/v1/accounts:signInWithPassword",Qf(n,t))}async function Ure(n,t){return Zf(n,"POST","/v1/accounts:sendOobCode",Qf(n,t))}async function fje(n,t){return Ure(n,t)}async function mje(n,t){return Ure(n,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gje(n,t){return lR(n,"POST","/v1/accounts:signInWithEmailLink",Qf(n,t))}async function _je(n,t){return lR(n,"POST","/v1/accounts:signInWithEmailLink",Qf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jC extends qF{constructor(t,i,a,l=null){super("password",a),this._email=t,this._password=i,this._tenantId=l}static _fromEmailAndPassword(t,i){return new jC(t,i,"password")}static _fromEmailAndCode(t,i,a=null){return new jC(t,i,"emailLink",a)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const i=typeof t=="string"?JSON.parse(t):t;if(i!=null&&i.email&&(i!=null&&i.password)){if(i.signInMethod==="password")return this._fromEmailAndPassword(i.email,i.password);if(i.signInMethod==="emailLink")return this._fromEmailAndCode(i.email,i.password,i.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const i={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return jk(t,i,"signInWithPassword",pje);case"emailLink":return gje(t,{email:this._email,oobCode:this._password});default:Hd(t,"internal-error")}}async _linkToIdToken(t,i){switch(this.signInMethod){case"password":const a={idToken:i,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return jk(t,a,"signUpPassword",hje);case"emailLink":return _je(t,{idToken:i,email:this._email,oobCode:this._password});default:Hd(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c0(n,t){return lR(n,"POST","/v1/accounts:signInWithIdp",Qf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yje="http://localhost";class $y extends qF{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const i=new $y(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(i.idToken=t.idToken),t.accessToken&&(i.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(i.nonce=t.nonce),t.pendingToken&&(i.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(i.accessToken=t.oauthToken,i.secret=t.oauthTokenSecret):Hd("argument-error"),i}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const i=typeof t=="string"?JSON.parse(t):t,{providerId:a,signInMethod:l}=i,d=tR(i,["providerId","signInMethod"]);if(!a||!l)return null;const f=new $y(a,l);return f.idToken=d.idToken||void 0,f.accessToken=d.accessToken||void 0,f.secret=d.secret,f.nonce=d.nonce,f.pendingToken=d.pendingToken||null,f}_getIdTokenResponse(t){const i=this.buildRequest();return c0(t,i)}_linkToIdToken(t,i){const a=this.buildRequest();return a.idToken=i,c0(t,a)}_getReauthenticationResolver(t){const i=this.buildRequest();return i.autoCreate=!1,c0(t,i)}buildRequest(){const t={requestUri:yje,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const i={};this.idToken&&(i.id_token=this.idToken),this.accessToken&&(i.access_token=this.accessToken),this.secret&&(i.oauth_token_secret=this.secret),i.providerId=this.providerId,this.nonce&&!this.pendingToken&&(i.nonce=this.nonce),t.postBody=aR(i)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eje(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function vje(n){const t=Bw(zw(n)).link,i=t?Bw(zw(t)).deep_link_id:null,a=Bw(zw(n)).deep_link_id;return(a?Bw(zw(a)).link:null)||a||i||t||n}class YF{constructor(t){var i,a,l,d,f,_;const v=Bw(zw(t)),b=(i=v.apiKey)!==null&&i!==void 0?i:null,C=(a=v.oobCode)!==null&&a!==void 0?a:null,I=Eje((l=v.mode)!==null&&l!==void 0?l:null);Wn(b&&C&&I,"argument-error"),this.apiKey=b,this.operation=I,this.code=C,this.continueUrl=(d=v.continueUrl)!==null&&d!==void 0?d:null,this.languageCode=(f=v.languageCode)!==null&&f!==void 0?f:null,this.tenantId=(_=v.tenantId)!==null&&_!==void 0?_:null}static parseLink(t){const i=vje(t);try{return new YF(i)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W0{constructor(){this.providerId=W0.PROVIDER_ID}static credential(t,i){return jC._fromEmailAndPassword(t,i)}static credentialWithLink(t,i){const a=YF.parseLink(i);return Wn(a,"argument-error"),jC._fromEmailAndCode(t,a.code,a.tenantId)}}W0.PROVIDER_ID="password";W0.EMAIL_PASSWORD_SIGN_IN_METHOD="password";W0.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vre{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uR extends Vre{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gg extends uR{constructor(){super("facebook.com")}static credential(t){return $y._fromParams({providerId:gg.PROVIDER_ID,signInMethod:gg.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return gg.credentialFromTaggedObject(t)}static credentialFromError(t){return gg.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return gg.credential(t.oauthAccessToken)}catch{return null}}}gg.FACEBOOK_SIGN_IN_METHOD="facebook.com";gg.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _g extends uR{constructor(){super("google.com"),this.addScope("profile")}static credential(t,i){return $y._fromParams({providerId:_g.PROVIDER_ID,signInMethod:_g.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:i})}static credentialFromResult(t){return _g.credentialFromTaggedObject(t)}static credentialFromError(t){return _g.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:i,oauthAccessToken:a}=t;if(!i&&!a)return null;try{return _g.credential(i,a)}catch{return null}}}_g.GOOGLE_SIGN_IN_METHOD="google.com";_g.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yg extends uR{constructor(){super("github.com")}static credential(t){return $y._fromParams({providerId:yg.PROVIDER_ID,signInMethod:yg.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return yg.credentialFromTaggedObject(t)}static credentialFromError(t){return yg.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return yg.credential(t.oauthAccessToken)}catch{return null}}}yg.GITHUB_SIGN_IN_METHOD="github.com";yg.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eg extends uR{constructor(){super("twitter.com")}static credential(t,i){return $y._fromParams({providerId:Eg.PROVIDER_ID,signInMethod:Eg.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:i})}static credentialFromResult(t){return Eg.credentialFromTaggedObject(t)}static credentialFromError(t){return Eg.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:i,oauthTokenSecret:a}=t;if(!i||!a)return null;try{return Eg.credential(i,a)}catch{return null}}}Eg.TWITTER_SIGN_IN_METHOD="twitter.com";Eg.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sje(n,t){return lR(n,"POST","/v1/accounts:signUp",Qf(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ky{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,i,a,l=!1){const d=await Nf._fromIdTokenResponse(t,a,l),f=yX(a);return new Ky({user:d,providerId:f,_tokenResponse:a,operationType:i})}static async _forOperation(t,i,a){await t._updateTokensIfNecessary(a,!0);const l=yX(a);return new Ky({user:t,providerId:l,_tokenResponse:a,operationType:i})}}function yX(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fk extends wp{constructor(t,i,a,l){var d;super(i.code,i.message),this.operationType=a,this.user=l,Object.setPrototypeOf(this,Fk.prototype),this.customData={appName:t.name,tenantId:(d=t.tenantId)!==null&&d!==void 0?d:void 0,_serverResponse:i.customData._serverResponse,operationType:a}}static _fromErrorAndOperation(t,i,a,l){return new Fk(t,i,a,l)}}function jre(n,t,i,a){return(t==="reauthenticate"?i._getReauthenticationResolver(n):i._getIdTokenResponse(n)).catch(d=>{throw d.code==="auth/multi-factor-auth-required"?Fk._fromErrorAndOperation(n,d,t,a):d})}async function bje(n,t,i=!1){const a=await VC(n,t._linkToIdToken(n.auth,await n.getIdToken()),i);return Ky._forOperation(n,"link",a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tje(n,t,i=!1){const{auth:a}=n;if(Wl(a.app))return Promise.reject(Ff(a));const l="reauthenticate";try{const d=await VC(n,jre(a,l,t,n),i);Wn(d.idToken,a,"internal-error");const f=$F(d.idToken);Wn(f,a,"internal-error");const{sub:_}=f;return Wn(n.uid===_,a,"user-mismatch"),Ky._forOperation(n,l,d)}catch(d){throw(d==null?void 0:d.code)==="auth/user-not-found"&&Hd(a,"user-mismatch"),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fre(n,t,i=!1){if(Wl(n.app))return Promise.reject(Ff(n));const a="signIn",l=await jre(n,a,t),d=await Ky._fromIdTokenResponse(n,a,l);return i||await n._updateCurrentUser(d.user),d}async function wje(n,t){return Fre(Gg(n),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bre(n){const t=Gg(n);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function Cje(n,t,i){const a=Gg(n);await jk(a,{requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"},"getOobCode",mje)}async function Rje(n,t,i){if(Wl(n.app))return Promise.reject(Ff(n));const a=Gg(n),f=await jk(a,{returnSecureToken:!0,email:t,password:i,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Sje).catch(v=>{throw v.code==="auth/password-does-not-meet-requirements"&&Bre(n),v}),_=await Ky._fromIdTokenResponse(a,"signIn",f);return await a._updateCurrentUser(_.user),_}function Ije(n,t,i){return Wl(n.app)?Promise.reject(Ff(n)):wje(us(n),W0.credential(t,i)).catch(async a=>{throw a.code==="auth/password-does-not-meet-requirements"&&Bre(n),a})}async function zre(n,t){const i=us(n),l={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()},{email:d}=await fje(i.auth,l);d!==n.email&&await n.reload()}function Aje(n,t,i,a){return us(n).onIdTokenChanged(t,i,a)}function Pje(n,t,i){return us(n).beforeAuthStateChanged(t,i)}function Oje(n,t,i,a){return us(n).onAuthStateChanged(t,i,a)}function kje(n){return us(n).signOut()}const Bk="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wre{constructor(t,i){this.storageRetriever=t,this.type=i}_isAvailable(){try{return this.storage?(this.storage.setItem(Bk,"1"),this.storage.removeItem(Bk),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,i){return this.storage.setItem(t,JSON.stringify(i)),Promise.resolve()}_get(t){const i=this.storage.getItem(t);return Promise.resolve(i?JSON.parse(i):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nje=1e3,Dje=10;class Gre extends Wre{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,i)=>this.onStorageEvent(t,i),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Nre(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const i of Object.keys(this.listeners)){const a=this.storage.getItem(i),l=this.localCache[i];a!==l&&t(i,l,a)}}onStorageEvent(t,i=!1){if(!t.key){this.forAllChangedKeys((f,_,v)=>{this.notifyListeners(f,v)});return}const a=t.key;i?this.detachListener():this.stopPolling();const l=()=>{const f=this.storage.getItem(a);!i&&this.localCache[a]===f||this.notifyListeners(a,f)},d=this.storage.getItem(a);KVe()&&d!==t.newValue&&t.newValue!==t.oldValue?setTimeout(l,Dje):l()}notifyListeners(t,i){this.localCache[t]=i;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(i&&JSON.parse(i))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,i,a)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:i,newValue:a}),!0)})},Nje)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,i){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,i){await super._set(t,i),this.localCache[t]=JSON.stringify(i)}async _get(t){const i=await super._get(t);return this.localCache[t]=JSON.stringify(i),i}async _remove(t){await super._remove(t),delete this.localCache[t]}}Gre.type="LOCAL";const xje=Gre;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hre extends Wre{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,i){}_removeListener(t,i){}}Hre.type="SESSION";const $re=Hre;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lje(n){return Promise.all(n.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(i){return{fulfilled:!1,reason:i}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B1{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const i=this.receivers.find(l=>l.isListeningto(t));if(i)return i;const a=new B1(t);return this.receivers.push(a),a}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const i=t,{eventId:a,eventType:l,data:d}=i.data,f=this.handlersMap[l];if(!(f!=null&&f.size))return;i.ports[0].postMessage({status:"ack",eventId:a,eventType:l});const _=Array.from(f).map(async b=>b(i.origin,d)),v=await Lje(_);i.ports[0].postMessage({status:"done",eventId:a,eventType:l,response:v})}_subscribe(t,i){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(i)}_unsubscribe(t,i){this.handlersMap[t]&&i&&this.handlersMap[t].delete(i),(!i||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}B1.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XF(n="",t=10){let i="";for(let a=0;a<t;a++)i+=Math.floor(Math.random()*10);return n+i}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mje{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,i,a=50){const l=typeof MessageChannel<"u"?new MessageChannel:null;if(!l)throw new Error("connection_unavailable");let d,f;return new Promise((_,v)=>{const b=XF("",20);l.port1.start();const C=setTimeout(()=>{v(new Error("unsupported_event"))},a);f={messageChannel:l,onMessage(I){const O=I;if(O.data.eventId===b)switch(O.data.status){case"ack":clearTimeout(C),d=setTimeout(()=>{v(new Error("timeout"))},3e3);break;case"done":clearTimeout(d),_(O.data.response);break;default:clearTimeout(C),clearTimeout(d),v(new Error("invalid_response"));break}}},this.handlers.add(f),l.port1.addEventListener("message",f.onMessage),this.target.postMessage({eventType:t,eventId:b,data:i},[l.port2])}).finally(()=>{f&&this.removeMessageHandler(f)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mp(){return window}function Uje(n){mp().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kre(){return typeof mp().WorkerGlobalScope<"u"&&typeof mp().importScripts=="function"}async function Vje(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function jje(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function Fje(){return Kre()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qre="firebaseLocalStorageDb",Bje=1,zk="firebaseLocalStorage",Yre="fbase_key";class dR{constructor(t){this.request=t}toPromise(){return new Promise((t,i)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{i(this.request.error)})})}}function z1(n,t){return n.transaction([zk],t?"readwrite":"readonly").objectStore(zk)}function zje(){const n=indexedDB.deleteDatabase(qre);return new dR(n).toPromise()}function TV(){const n=indexedDB.open(qre,Bje);return new Promise((t,i)=>{n.addEventListener("error",()=>{i(n.error)}),n.addEventListener("upgradeneeded",()=>{const a=n.result;try{a.createObjectStore(zk,{keyPath:Yre})}catch(l){i(l)}}),n.addEventListener("success",async()=>{const a=n.result;a.objectStoreNames.contains(zk)?t(a):(a.close(),await zje(),t(await TV()))})})}async function EX(n,t,i){const a=z1(n,!0).put({[Yre]:t,value:i});return new dR(a).toPromise()}async function Wje(n,t){const i=z1(n,!1).get(t),a=await new dR(i).toPromise();return a===void 0?null:a.value}function vX(n,t){const i=z1(n,!0).delete(t);return new dR(i).toPromise()}const Gje=800,Hje=3;class Xre{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await TV(),this.db)}async _withRetries(t){let i=0;for(;;)try{const a=await this._openDb();return await t(a)}catch(a){if(i++>Hje)throw a;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Kre()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=B1._getInstance(Fje()),this.receiver._subscribe("keyChanged",async(t,i)=>({keyProcessed:(await this._poll()).includes(i.key)})),this.receiver._subscribe("ping",async(t,i)=>["keyChanged"])}async initializeSender(){var t,i;if(this.activeServiceWorker=await Vje(),!this.activeServiceWorker)return;this.sender=new Mje(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&!((t=a[0])===null||t===void 0)&&t.fulfilled&&!((i=a[0])===null||i===void 0)&&i.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||jje()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await TV();return await EX(t,Bk,"1"),await vX(t,Bk),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,i){return this._withPendingWrite(async()=>(await this._withRetries(a=>EX(a,t,i)),this.localCache[t]=i,this.notifyServiceWorker(t)))}async _get(t){const i=await this._withRetries(a=>Wje(a,t));return this.localCache[t]=i,i}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(i=>vX(i,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(l=>{const d=z1(l,!1).getAll();return new dR(d).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const i=[],a=new Set;if(t.length!==0)for(const{fbase_key:l,value:d}of t)a.add(l),JSON.stringify(this.localCache[l])!==JSON.stringify(d)&&(this.notifyListeners(l,d),i.push(l));for(const l of Object.keys(this.localCache))this.localCache[l]&&!a.has(l)&&(this.notifyListeners(l,null),i.push(l));return i}notifyListeners(t,i){this.localCache[t]=i;const a=this.listeners[t];if(a)for(const l of Array.from(a))l(i)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Gje)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,i){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(i)}_removeListener(t,i){this.listeners[t]&&(this.listeners[t].delete(i),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Xre.type="LOCAL";const $je=Xre;new cR(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kje(n,t){return t?Df(t):(Wn(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JF extends qF{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return c0(t,this._buildIdpRequest())}_linkToIdToken(t,i){return c0(t,this._buildIdpRequest(i))}_getReauthenticationResolver(t){return c0(t,this._buildIdpRequest())}_buildIdpRequest(t){const i={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(i.idToken=t),i}}function qje(n){return Fre(n.auth,new JF(n),n.bypassAuthState)}function Yje(n){const{auth:t,user:i}=n;return Wn(i,t,"internal-error"),Tje(i,new JF(n),n.bypassAuthState)}async function Xje(n){const{auth:t,user:i}=n;return Wn(i,t,"internal-error"),bje(i,new JF(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jre{constructor(t,i,a,l,d=!1){this.auth=t,this.resolver=a,this.user=l,this.bypassAuthState=d,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(i)?i:[i]}execute(){return new Promise(async(t,i)=>{this.pendingPromise={resolve:t,reject:i};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(a){this.reject(a)}})}async onAuthEvent(t){const{urlResponse:i,sessionId:a,postBody:l,tenantId:d,error:f,type:_}=t;if(f){this.reject(f);return}const v={auth:this.auth,requestUri:i,sessionId:a,tenantId:d||void 0,postBody:l||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(_)(v))}catch(b){this.reject(b)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return qje;case"linkViaPopup":case"linkViaRedirect":return Xje;case"reauthViaPopup":case"reauthViaRedirect":return Yje;default:Hd(this.auth,"internal-error")}}resolve(t){qf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){qf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jje=new cR(2e3,1e4);class KS extends Jre{constructor(t,i,a,l,d){super(t,i,l,d),this.provider=a,this.authWindow=null,this.pollId=null,KS.currentPopupAction&&KS.currentPopupAction.cancel(),KS.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Wn(t,this.auth,"internal-error"),t}async onExecution(){qf(this.filter.length===1,"Popup operations only handle one event");const t=XF();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(i=>{this.reject(i)}),this.resolver._isIframeWebStorageSupported(this.auth,i=>{i||this.reject(fp(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(fp(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,KS.currentPopupAction=null}pollUserCancellation(){const t=()=>{var i,a;if(!((a=(i=this.authWindow)===null||i===void 0?void 0:i.window)===null||a===void 0)&&a.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(fp(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,Jje.get())};t()}}KS.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qje="pendingRedirect",ok=new Map;class Zje extends Jre{constructor(t,i,a=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],i,void 0,a),this.eventId=null}async execute(){let t=ok.get(this.auth._key());if(!t){try{const a=await eFe(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(a)}catch(i){t=()=>Promise.reject(i)}ok.set(this.auth._key(),t)}return this.bypassAuthState||ok.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const i=await this.auth._redirectUserForId(t.eventId);if(i)return this.user=i,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function eFe(n,t){const i=rFe(t),a=nFe(n);if(!await a._isAvailable())return!1;const l=await a._get(i)==="true";return await a._remove(i),l}function tFe(n,t){ok.set(n._key(),t)}function nFe(n){return Df(n._redirectPersistence)}function rFe(n){return sk(Qje,n.config.apiKey,n.name)}async function iFe(n,t,i=!1){if(Wl(n.app))return Promise.reject(Ff(n));const a=Gg(n),l=Kje(a,t),f=await new Zje(a,l,i).execute();return f&&!i&&(delete f.user._redirectEventId,await a._persistUserIfCurrent(f.user),await a._setRedirectUser(null,t)),f}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sFe=10*60*1e3;class oFe{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let i=!1;return this.consumers.forEach(a=>{this.isEventForConsumer(t,a)&&(i=!0,this.sendToConsumer(t,a),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!aFe(t)||(this.hasHandledPotentialRedirect=!0,i||(this.queuedRedirectEvent=t,i=!0)),i}sendToConsumer(t,i){var a;if(t.error&&!Qre(t)){const l=((a=t.error.code)===null||a===void 0?void 0:a.split("auth/")[1])||"internal-error";i.onError(fp(this.auth,l))}else i.onAuthEvent(t)}isEventForConsumer(t,i){const a=i.eventId===null||!!t.eventId&&t.eventId===i.eventId;return i.filter.includes(t.type)&&a}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=sFe&&this.cachedEventUids.clear(),this.cachedEventUids.has(SX(t))}saveEventToCache(t){this.cachedEventUids.add(SX(t)),this.lastProcessedEventTime=Date.now()}}function SX(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(t=>t).join("-")}function Qre({type:n,error:t}){return n==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function aFe(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Qre(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cFe(n,t={}){return Zf(n,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lFe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,uFe=/^https?/;async function dFe(n){if(n.config.emulator)return;const{authorizedDomains:t}=await cFe(n);for(const i of t)try{if(hFe(i))return}catch{}Hd(n,"unauthorized-domain")}function hFe(n){const t=SV(),{protocol:i,hostname:a}=new URL(t);if(n.startsWith("chrome-extension://")){const f=new URL(n);return f.hostname===""&&a===""?i==="chrome-extension:"&&n.replace("chrome-extension://","")===t.replace("chrome-extension://",""):i==="chrome-extension:"&&f.hostname===a}if(!uFe.test(i))return!1;if(lFe.test(n))return a===n;const l=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+l+"|"+l+")$","i").test(a)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pFe=new cR(3e4,6e4);function bX(){const n=mp().___jsl;if(n!=null&&n.H){for(const t of Object.keys(n.H))if(n.H[t].r=n.H[t].r||[],n.H[t].L=n.H[t].L||[],n.H[t].r=[...n.H[t].L],n.CP)for(let i=0;i<n.CP.length;i++)n.CP[i]=null}}function fFe(n){return new Promise((t,i)=>{var a,l,d;function f(){bX(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{bX(),i(fp(n,"network-request-failed"))},timeout:pFe.get()})}if(!((l=(a=mp().gapi)===null||a===void 0?void 0:a.iframes)===null||l===void 0)&&l.Iframe)t(gapi.iframes.getContext());else if(!((d=mp().gapi)===null||d===void 0)&&d.load)f();else{const _=nje("iframefcb");return mp()[_]=()=>{gapi.load?f():i(fp(n,"network-request-failed"))},xre(`${tje()}?onload=${_}`).catch(v=>i(v))}}).catch(t=>{throw ak=null,t})}let ak=null;function mFe(n){return ak=ak||fFe(n),ak}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gFe=new cR(5e3,15e3),_Fe="__/auth/iframe",yFe="emulator/auth/iframe",EFe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},vFe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function SFe(n){const t=n.config;Wn(t.authDomain,n,"auth-domain-config-required");const i=t.emulator?HF(t,yFe):`https://${n.config.authDomain}/${_Fe}`,a={apiKey:t.apiKey,appName:n.name,v:Zy},l=vFe.get(n.config.apiHost);l&&(a.eid=l);const d=n._getFrameworks();return d.length&&(a.fw=d.join(",")),`${i}?${aR(a).slice(1)}`}async function bFe(n){const t=await mFe(n),i=mp().gapi;return Wn(i,n,"internal-error"),t.open({where:document.body,url:SFe(n),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:EFe,dontclear:!0},a=>new Promise(async(l,d)=>{await a.restyle({setHideOnLeave:!1});const f=fp(n,"network-request-failed"),_=mp().setTimeout(()=>{d(f)},gFe.get());function v(){mp().clearTimeout(_),l(a)}a.ping(v).then(v,()=>{d(f)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TFe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},wFe=500,CFe=600,RFe="_blank",IFe="http://localhost";class TX{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function AFe(n,t,i,a=wFe,l=CFe){const d=Math.max((window.screen.availHeight-l)/2,0).toString(),f=Math.max((window.screen.availWidth-a)/2,0).toString();let _="";const v=Object.assign(Object.assign({},TFe),{width:a.toString(),height:l.toString(),top:d,left:f}),b=oc().toLowerCase();i&&(_=Ire(b)?RFe:i),Cre(b)&&(t=t||IFe,v.scrollbars="yes");const C=Object.entries(v).reduce((O,[L,M])=>`${O}${L}=${M},`,"");if($Ve(b)&&_!=="_self")return PFe(t||"",_),new TX(null);const I=window.open(t||"",_,C);Wn(I,n,"popup-blocked");try{I.focus()}catch{}return new TX(I)}function PFe(n,t){const i=document.createElement("a");i.href=n,i.target=t;const a=document.createEvent("MouseEvent");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(a)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OFe="__/auth/handler",kFe="emulator/auth/handler",NFe=encodeURIComponent("fac");async function wX(n,t,i,a,l,d){Wn(n.config.authDomain,n,"auth-domain-config-required"),Wn(n.config.apiKey,n,"invalid-api-key");const f={apiKey:n.config.apiKey,appName:n.name,authType:i,redirectUrl:a,v:Zy,eventId:l};if(t instanceof Vre){t.setDefaultLanguage(n.languageCode),f.providerId=t.providerId||"",mUe(t.getCustomParameters())||(f.customParameters=JSON.stringify(t.getCustomParameters()));for(const[C,I]of Object.entries({}))f[C]=I}if(t instanceof uR){const C=t.getScopes().filter(I=>I!=="");C.length>0&&(f.scopes=C.join(","))}n.tenantId&&(f.tid=n.tenantId);const _=f;for(const C of Object.keys(_))_[C]===void 0&&delete _[C];const v=await n._getAppCheckToken(),b=v?`#${NFe}=${encodeURIComponent(v)}`:"";return`${DFe(n)}?${aR(_).slice(1)}${b}`}function DFe({config:n}){return n.emulator?HF(n,kFe):`https://${n.authDomain}/${OFe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nU="webStorageSupport";class xFe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=$re,this._completeRedirectFn=iFe,this._overrideRedirectResult=tFe}async _openPopup(t,i,a,l){var d;qf((d=this.eventManagers[t._key()])===null||d===void 0?void 0:d.manager,"_initialize() not called before _openPopup()");const f=await wX(t,i,a,SV(),l);return AFe(t,f,XF())}async _openRedirect(t,i,a,l){await this._originValidation(t);const d=await wX(t,i,a,SV(),l);return Uje(d),new Promise(()=>{})}_initialize(t){const i=t._key();if(this.eventManagers[i]){const{manager:l,promise:d}=this.eventManagers[i];return l?Promise.resolve(l):(qf(d,"If manager is not set, promise should be"),d)}const a=this.initAndGetManager(t);return this.eventManagers[i]={promise:a},a.catch(()=>{delete this.eventManagers[i]}),a}async initAndGetManager(t){const i=await bFe(t),a=new oFe(t);return i.register("authEvent",l=>(Wn(l==null?void 0:l.authEvent,t,"invalid-auth-event"),{status:a.onEvent(l.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:a},this.iframes[t._key()]=i,a}_isIframeWebStorageSupported(t,i){this.iframes[t._key()].send(nU,{type:nU},l=>{var d;const f=(d=l==null?void 0:l[0])===null||d===void 0?void 0:d[nU];f!==void 0&&i(!!f),Hd(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const i=t._key();return this.originValidationPromises[i]||(this.originValidationPromises[i]=dFe(t)),this.originValidationPromises[i]}get _shouldInitProactively(){return Nre()||Rre()||KF()}}const LFe=xFe;var CX="@firebase/auth",RX="1.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MFe{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const i=this.auth.onIdTokenChanged(a=>{t((a==null?void 0:a.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,i),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const i=this.internalListeners.get(t);i&&(this.internalListeners.delete(t),i(),this.updateProactiveRefresh())}assertAuthConfigured(){Wn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UFe(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function VFe(n){Hy(new Ng("auth",(t,{options:i})=>{const a=t.getProvider("app").getImmediate(),l=t.getProvider("heartbeat"),d=t.getProvider("app-check-internal"),{apiKey:f,authDomain:_}=a.options;Wn(f&&!f.includes(":"),"invalid-api-key",{appName:a.name});const v={apiKey:f,authDomain:_,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Dre(n)},b=new QVe(a,l,d,v);return cje(b,i),b},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,i,a)=>{t.getProvider("auth-internal").initialize()})),Hy(new Ng("auth-internal",t=>{const i=Gg(t.getProvider("auth").getImmediate());return(a=>new MFe(a))(i)},"PRIVATE").setInstantiationMode("EXPLICIT")),pp(CX,RX,UFe(n)),pp(CX,RX,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jFe=5*60,FFe=lre("authIdTokenMaxAge")||jFe;let IX=null;const BFe=n=>async t=>{const i=t&&await t.getIdTokenResult(),a=i&&(new Date().getTime()-Date.parse(i.issuedAtTime))/1e3;if(a&&a>FFe)return;const l=i==null?void 0:i.token;IX!==l&&(IX=l,await fetch(n,{method:l?"POST":"DELETE",headers:l?{Authorization:`Bearer ${l}`}:{}}))};function W1(n=WF()){const t=j1(n,"auth");if(t.isInitialized())return t.getImmediate();const i=aje(n,{popupRedirectResolver:LFe,persistence:[$je,xje,$re]}),a=lre("authTokenSyncURL");if(a&&typeof isSecureContext=="boolean"&&isSecureContext){const d=new URL(a,location.origin);if(location.origin===d.origin){const f=BFe(d.toString());Pje(i,f,()=>f(i.currentUser)),Aje(i,_=>f(_))}}const l=ore("auth");return l&&lje(i,`http://${l}`),i}function zFe(){var n,t;return(t=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&t!==void 0?t:document}ZVe({loadJS(n){return new Promise((t,i)=>{const a=document.createElement("script");a.setAttribute("src",n),a.onload=t,a.onerror=l=>{const d=fp("internal-error");d.customData=l,i(d)},a.type="text/javascript",a.charset="UTF-8",zFe().appendChild(a)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});VFe("Browser");var AX=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ig,Zre;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(X,J){function Q(){}Q.prototype=J.prototype,X.D=J.prototype,X.prototype=new Q,X.prototype.constructor=X,X.C=function(se,de,he){for(var le=Array(arguments.length-2),Oe=2;Oe<arguments.length;Oe++)le[Oe-2]=arguments[Oe];return J.prototype[de].apply(se,le)}}function i(){this.blockSize=-1}function a(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(a,i),a.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function l(X,J,Q){Q||(Q=0);var se=Array(16);if(typeof J=="string")for(var de=0;16>de;++de)se[de]=J.charCodeAt(Q++)|J.charCodeAt(Q++)<<8|J.charCodeAt(Q++)<<16|J.charCodeAt(Q++)<<24;else for(de=0;16>de;++de)se[de]=J[Q++]|J[Q++]<<8|J[Q++]<<16|J[Q++]<<24;J=X.g[0],Q=X.g[1],de=X.g[2];var he=X.g[3],le=J+(he^Q&(de^he))+se[0]+3614090360&4294967295;J=Q+(le<<7&4294967295|le>>>25),le=he+(de^J&(Q^de))+se[1]+3905402710&4294967295,he=J+(le<<12&4294967295|le>>>20),le=de+(Q^he&(J^Q))+se[2]+606105819&4294967295,de=he+(le<<17&4294967295|le>>>15),le=Q+(J^de&(he^J))+se[3]+3250441966&4294967295,Q=de+(le<<22&4294967295|le>>>10),le=J+(he^Q&(de^he))+se[4]+4118548399&4294967295,J=Q+(le<<7&4294967295|le>>>25),le=he+(de^J&(Q^de))+se[5]+1200080426&4294967295,he=J+(le<<12&4294967295|le>>>20),le=de+(Q^he&(J^Q))+se[6]+2821735955&4294967295,de=he+(le<<17&4294967295|le>>>15),le=Q+(J^de&(he^J))+se[7]+4249261313&4294967295,Q=de+(le<<22&4294967295|le>>>10),le=J+(he^Q&(de^he))+se[8]+1770035416&4294967295,J=Q+(le<<7&4294967295|le>>>25),le=he+(de^J&(Q^de))+se[9]+2336552879&4294967295,he=J+(le<<12&4294967295|le>>>20),le=de+(Q^he&(J^Q))+se[10]+4294925233&4294967295,de=he+(le<<17&4294967295|le>>>15),le=Q+(J^de&(he^J))+se[11]+2304563134&4294967295,Q=de+(le<<22&4294967295|le>>>10),le=J+(he^Q&(de^he))+se[12]+1804603682&4294967295,J=Q+(le<<7&4294967295|le>>>25),le=he+(de^J&(Q^de))+se[13]+4254626195&4294967295,he=J+(le<<12&4294967295|le>>>20),le=de+(Q^he&(J^Q))+se[14]+2792965006&4294967295,de=he+(le<<17&4294967295|le>>>15),le=Q+(J^de&(he^J))+se[15]+1236535329&4294967295,Q=de+(le<<22&4294967295|le>>>10),le=J+(de^he&(Q^de))+se[1]+4129170786&4294967295,J=Q+(le<<5&4294967295|le>>>27),le=he+(Q^de&(J^Q))+se[6]+3225465664&4294967295,he=J+(le<<9&4294967295|le>>>23),le=de+(J^Q&(he^J))+se[11]+643717713&4294967295,de=he+(le<<14&4294967295|le>>>18),le=Q+(he^J&(de^he))+se[0]+3921069994&4294967295,Q=de+(le<<20&4294967295|le>>>12),le=J+(de^he&(Q^de))+se[5]+3593408605&4294967295,J=Q+(le<<5&4294967295|le>>>27),le=he+(Q^de&(J^Q))+se[10]+38016083&4294967295,he=J+(le<<9&4294967295|le>>>23),le=de+(J^Q&(he^J))+se[15]+3634488961&4294967295,de=he+(le<<14&4294967295|le>>>18),le=Q+(he^J&(de^he))+se[4]+3889429448&4294967295,Q=de+(le<<20&4294967295|le>>>12),le=J+(de^he&(Q^de))+se[9]+568446438&4294967295,J=Q+(le<<5&4294967295|le>>>27),le=he+(Q^de&(J^Q))+se[14]+3275163606&4294967295,he=J+(le<<9&4294967295|le>>>23),le=de+(J^Q&(he^J))+se[3]+4107603335&4294967295,de=he+(le<<14&4294967295|le>>>18),le=Q+(he^J&(de^he))+se[8]+1163531501&4294967295,Q=de+(le<<20&4294967295|le>>>12),le=J+(de^he&(Q^de))+se[13]+2850285829&4294967295,J=Q+(le<<5&4294967295|le>>>27),le=he+(Q^de&(J^Q))+se[2]+4243563512&4294967295,he=J+(le<<9&4294967295|le>>>23),le=de+(J^Q&(he^J))+se[7]+1735328473&4294967295,de=he+(le<<14&4294967295|le>>>18),le=Q+(he^J&(de^he))+se[12]+2368359562&4294967295,Q=de+(le<<20&4294967295|le>>>12),le=J+(Q^de^he)+se[5]+4294588738&4294967295,J=Q+(le<<4&4294967295|le>>>28),le=he+(J^Q^de)+se[8]+2272392833&4294967295,he=J+(le<<11&4294967295|le>>>21),le=de+(he^J^Q)+se[11]+1839030562&4294967295,de=he+(le<<16&4294967295|le>>>16),le=Q+(de^he^J)+se[14]+4259657740&4294967295,Q=de+(le<<23&4294967295|le>>>9),le=J+(Q^de^he)+se[1]+2763975236&4294967295,J=Q+(le<<4&4294967295|le>>>28),le=he+(J^Q^de)+se[4]+1272893353&4294967295,he=J+(le<<11&4294967295|le>>>21),le=de+(he^J^Q)+se[7]+4139469664&4294967295,de=he+(le<<16&4294967295|le>>>16),le=Q+(de^he^J)+se[10]+3200236656&4294967295,Q=de+(le<<23&4294967295|le>>>9),le=J+(Q^de^he)+se[13]+681279174&4294967295,J=Q+(le<<4&4294967295|le>>>28),le=he+(J^Q^de)+se[0]+3936430074&4294967295,he=J+(le<<11&4294967295|le>>>21),le=de+(he^J^Q)+se[3]+3572445317&4294967295,de=he+(le<<16&4294967295|le>>>16),le=Q+(de^he^J)+se[6]+76029189&4294967295,Q=de+(le<<23&4294967295|le>>>9),le=J+(Q^de^he)+se[9]+3654602809&4294967295,J=Q+(le<<4&4294967295|le>>>28),le=he+(J^Q^de)+se[12]+3873151461&4294967295,he=J+(le<<11&4294967295|le>>>21),le=de+(he^J^Q)+se[15]+530742520&4294967295,de=he+(le<<16&4294967295|le>>>16),le=Q+(de^he^J)+se[2]+3299628645&4294967295,Q=de+(le<<23&4294967295|le>>>9),le=J+(de^(Q|~he))+se[0]+4096336452&4294967295,J=Q+(le<<6&4294967295|le>>>26),le=he+(Q^(J|~de))+se[7]+1126891415&4294967295,he=J+(le<<10&4294967295|le>>>22),le=de+(J^(he|~Q))+se[14]+2878612391&4294967295,de=he+(le<<15&4294967295|le>>>17),le=Q+(he^(de|~J))+se[5]+4237533241&4294967295,Q=de+(le<<21&4294967295|le>>>11),le=J+(de^(Q|~he))+se[12]+1700485571&4294967295,J=Q+(le<<6&4294967295|le>>>26),le=he+(Q^(J|~de))+se[3]+2399980690&4294967295,he=J+(le<<10&4294967295|le>>>22),le=de+(J^(he|~Q))+se[10]+4293915773&4294967295,de=he+(le<<15&4294967295|le>>>17),le=Q+(he^(de|~J))+se[1]+2240044497&4294967295,Q=de+(le<<21&4294967295|le>>>11),le=J+(de^(Q|~he))+se[8]+1873313359&4294967295,J=Q+(le<<6&4294967295|le>>>26),le=he+(Q^(J|~de))+se[15]+4264355552&4294967295,he=J+(le<<10&4294967295|le>>>22),le=de+(J^(he|~Q))+se[6]+2734768916&4294967295,de=he+(le<<15&4294967295|le>>>17),le=Q+(he^(de|~J))+se[13]+1309151649&4294967295,Q=de+(le<<21&4294967295|le>>>11),le=J+(de^(Q|~he))+se[4]+4149444226&4294967295,J=Q+(le<<6&4294967295|le>>>26),le=he+(Q^(J|~de))+se[11]+3174756917&4294967295,he=J+(le<<10&4294967295|le>>>22),le=de+(J^(he|~Q))+se[2]+718787259&4294967295,de=he+(le<<15&4294967295|le>>>17),le=Q+(he^(de|~J))+se[9]+3951481745&4294967295,X.g[0]=X.g[0]+J&4294967295,X.g[1]=X.g[1]+(de+(le<<21&4294967295|le>>>11))&4294967295,X.g[2]=X.g[2]+de&4294967295,X.g[3]=X.g[3]+he&4294967295}a.prototype.u=function(X,J){J===void 0&&(J=X.length);for(var Q=J-this.blockSize,se=this.B,de=this.h,he=0;he<J;){if(de==0)for(;he<=Q;)l(this,X,he),he+=this.blockSize;if(typeof X=="string"){for(;he<J;)if(se[de++]=X.charCodeAt(he++),de==this.blockSize){l(this,se),de=0;break}}else for(;he<J;)if(se[de++]=X[he++],de==this.blockSize){l(this,se),de=0;break}}this.h=de,this.o+=J},a.prototype.v=function(){var X=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);X[0]=128;for(var J=1;J<X.length-8;++J)X[J]=0;var Q=8*this.o;for(J=X.length-8;J<X.length;++J)X[J]=Q&255,Q/=256;for(this.u(X),X=Array(16),J=Q=0;4>J;++J)for(var se=0;32>se;se+=8)X[Q++]=this.g[J]>>>se&255;return X};function d(X,J){var Q=_;return Object.prototype.hasOwnProperty.call(Q,X)?Q[X]:Q[X]=J(X)}function f(X,J){this.h=J;for(var Q=[],se=!0,de=X.length-1;0<=de;de--){var he=X[de]|0;se&&he==J||(Q[de]=he,se=!1)}this.g=Q}var _={};function v(X){return-128<=X&&128>X?d(X,function(J){return new f([J|0],0>J?-1:0)}):new f([X|0],0>X?-1:0)}function b(X){if(isNaN(X)||!isFinite(X))return I;if(0>X)return z(b(-X));for(var J=[],Q=1,se=0;X>=Q;se++)J[se]=X/Q|0,Q*=4294967296;return new f(J,0)}function C(X,J){if(X.length==0)throw Error("number format error: empty string");if(J=J||10,2>J||36<J)throw Error("radix out of range: "+J);if(X.charAt(0)=="-")return z(C(X.substring(1),J));if(0<=X.indexOf("-"))throw Error('number format error: interior "-" character');for(var Q=b(Math.pow(J,8)),se=I,de=0;de<X.length;de+=8){var he=Math.min(8,X.length-de),le=parseInt(X.substring(de,de+he),J);8>he?(he=b(Math.pow(J,he)),se=se.j(he).add(b(le))):(se=se.j(Q),se=se.add(b(le)))}return se}var I=v(0),O=v(1),L=v(16777216);n=f.prototype,n.m=function(){if(F(this))return-z(this).m();for(var X=0,J=1,Q=0;Q<this.g.length;Q++){var se=this.i(Q);X+=(0<=se?se:4294967296+se)*J,J*=4294967296}return X},n.toString=function(X){if(X=X||10,2>X||36<X)throw Error("radix out of range: "+X);if(M(this))return"0";if(F(this))return"-"+z(this).toString(X);for(var J=b(Math.pow(X,6)),Q=this,se="";;){var de=ae(Q,J).g;Q=Z(Q,de.j(J));var he=((0<Q.g.length?Q.g[0]:Q.h)>>>0).toString(X);if(Q=de,M(Q))return he+se;for(;6>he.length;)he="0"+he;se=he+se}},n.i=function(X){return 0>X?0:X<this.g.length?this.g[X]:this.h};function M(X){if(X.h!=0)return!1;for(var J=0;J<X.g.length;J++)if(X.g[J]!=0)return!1;return!0}function F(X){return X.h==-1}n.l=function(X){return X=Z(this,X),F(X)?-1:M(X)?0:1};function z(X){for(var J=X.g.length,Q=[],se=0;se<J;se++)Q[se]=~X.g[se];return new f(Q,~X.h).add(O)}n.abs=function(){return F(this)?z(this):this},n.add=function(X){for(var J=Math.max(this.g.length,X.g.length),Q=[],se=0,de=0;de<=J;de++){var he=se+(this.i(de)&65535)+(X.i(de)&65535),le=(he>>>16)+(this.i(de)>>>16)+(X.i(de)>>>16);se=le>>>16,he&=65535,le&=65535,Q[de]=le<<16|he}return new f(Q,Q[Q.length-1]&-2147483648?-1:0)};function Z(X,J){return X.add(z(J))}n.j=function(X){if(M(this)||M(X))return I;if(F(this))return F(X)?z(this).j(z(X)):z(z(this).j(X));if(F(X))return z(this.j(z(X)));if(0>this.l(L)&&0>X.l(L))return b(this.m()*X.m());for(var J=this.g.length+X.g.length,Q=[],se=0;se<2*J;se++)Q[se]=0;for(se=0;se<this.g.length;se++)for(var de=0;de<X.g.length;de++){var he=this.i(se)>>>16,le=this.i(se)&65535,Oe=X.i(de)>>>16,Ve=X.i(de)&65535;Q[2*se+2*de]+=le*Ve,K(Q,2*se+2*de),Q[2*se+2*de+1]+=he*Ve,K(Q,2*se+2*de+1),Q[2*se+2*de+1]+=le*Oe,K(Q,2*se+2*de+1),Q[2*se+2*de+2]+=he*Oe,K(Q,2*se+2*de+2)}for(se=0;se<J;se++)Q[se]=Q[2*se+1]<<16|Q[2*se];for(se=J;se<2*J;se++)Q[se]=0;return new f(Q,0)};function K(X,J){for(;(X[J]&65535)!=X[J];)X[J+1]+=X[J]>>>16,X[J]&=65535,J++}function re(X,J){this.g=X,this.h=J}function ae(X,J){if(M(J))throw Error("division by zero");if(M(X))return new re(I,I);if(F(X))return J=ae(z(X),J),new re(z(J.g),z(J.h));if(F(J))return J=ae(X,z(J)),new re(z(J.g),J.h);if(30<X.g.length){if(F(X)||F(J))throw Error("slowDivide_ only works with positive integers.");for(var Q=O,se=J;0>=se.l(X);)Q=ne(Q),se=ne(se);var de=pe(Q,1),he=pe(se,1);for(se=pe(se,2),Q=pe(Q,2);!M(se);){var le=he.add(se);0>=le.l(X)&&(de=de.add(Q),he=le),se=pe(se,1),Q=pe(Q,1)}return J=Z(X,de.j(J)),new re(de,J)}for(de=I;0<=X.l(J);){for(Q=Math.max(1,Math.floor(X.m()/J.m())),se=Math.ceil(Math.log(Q)/Math.LN2),se=48>=se?1:Math.pow(2,se-48),he=b(Q),le=he.j(J);F(le)||0<le.l(X);)Q-=se,he=b(Q),le=he.j(J);M(he)&&(he=O),de=de.add(he),X=Z(X,le)}return new re(de,X)}n.A=function(X){return ae(this,X).h},n.and=function(X){for(var J=Math.max(this.g.length,X.g.length),Q=[],se=0;se<J;se++)Q[se]=this.i(se)&X.i(se);return new f(Q,this.h&X.h)},n.or=function(X){for(var J=Math.max(this.g.length,X.g.length),Q=[],se=0;se<J;se++)Q[se]=this.i(se)|X.i(se);return new f(Q,this.h|X.h)},n.xor=function(X){for(var J=Math.max(this.g.length,X.g.length),Q=[],se=0;se<J;se++)Q[se]=this.i(se)^X.i(se);return new f(Q,this.h^X.h)};function ne(X){for(var J=X.g.length+1,Q=[],se=0;se<J;se++)Q[se]=X.i(se)<<1|X.i(se-1)>>>31;return new f(Q,X.h)}function pe(X,J){var Q=J>>5;J%=32;for(var se=X.g.length-Q,de=[],he=0;he<se;he++)de[he]=0<J?X.i(he+Q)>>>J|X.i(he+Q+1)<<32-J:X.i(he+Q);return new f(de,X.h)}a.prototype.digest=a.prototype.v,a.prototype.reset=a.prototype.s,a.prototype.update=a.prototype.u,Zre=a,f.prototype.add=f.prototype.add,f.prototype.multiply=f.prototype.j,f.prototype.modulo=f.prototype.A,f.prototype.compare=f.prototype.l,f.prototype.toNumber=f.prototype.m,f.prototype.toString=f.prototype.toString,f.prototype.getBits=f.prototype.i,f.fromNumber=b,f.fromString=C,Ig=f}).apply(typeof AX<"u"?AX:typeof self<"u"?self:typeof window<"u"?window:{});var IO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var eie,Ww,tie,ck,wV,nie,rie,iie;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(A,W,ie){return A==Array.prototype||A==Object.prototype||(A[W]=ie.value),A};function i(A){A=[typeof globalThis=="object"&&globalThis,A,typeof window=="object"&&window,typeof self=="object"&&self,typeof IO=="object"&&IO];for(var W=0;W<A.length;++W){var ie=A[W];if(ie&&ie.Math==Math)return ie}throw Error("Cannot find global object")}var a=i(this);function l(A,W){if(W)e:{var ie=a;A=A.split(".");for(var ge=0;ge<A.length-1;ge++){var Qe=A[ge];if(!(Qe in ie))break e;ie=ie[Qe]}A=A[A.length-1],ge=ie[A],W=W(ge),W!=ge&&W!=null&&t(ie,A,{configurable:!0,writable:!0,value:W})}}function d(A,W){A instanceof String&&(A+="");var ie=0,ge=!1,Qe={next:function(){if(!ge&&ie<A.length){var ut=ie++;return{value:W(ut,A[ut]),done:!1}}return ge=!0,{done:!0,value:void 0}}};return Qe[Symbol.iterator]=function(){return Qe},Qe}l("Array.prototype.values",function(A){return A||function(){return d(this,function(W,ie){return ie})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var f=f||{},_=this||self;function v(A){var W=typeof A;return W=W!="object"?W:A?Array.isArray(A)?"array":W:"null",W=="array"||W=="object"&&typeof A.length=="number"}function b(A){var W=typeof A;return W=="object"&&A!=null||W=="function"}function C(A,W,ie){return A.call.apply(A.bind,arguments)}function I(A,W,ie){if(!A)throw Error();if(2<arguments.length){var ge=Array.prototype.slice.call(arguments,2);return function(){var Qe=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(Qe,ge),A.apply(W,Qe)}}return function(){return A.apply(W,arguments)}}function O(A,W,ie){return O=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?C:I,O.apply(null,arguments)}function L(A,W){var ie=Array.prototype.slice.call(arguments,1);return function(){var ge=ie.slice();return ge.push.apply(ge,arguments),A.apply(this,ge)}}function M(A,W){function ie(){}ie.prototype=W.prototype,A.aa=W.prototype,A.prototype=new ie,A.prototype.constructor=A,A.Qb=function(ge,Qe,ut){for(var Gt=Array(arguments.length-2),Zr=2;Zr<arguments.length;Zr++)Gt[Zr-2]=arguments[Zr];return W.prototype[Qe].apply(ge,Gt)}}function F(A){const W=A.length;if(0<W){const ie=Array(W);for(let ge=0;ge<W;ge++)ie[ge]=A[ge];return ie}return[]}function z(A,W){for(let ie=1;ie<arguments.length;ie++){const ge=arguments[ie];if(v(ge)){const Qe=A.length||0,ut=ge.length||0;A.length=Qe+ut;for(let Gt=0;Gt<ut;Gt++)A[Qe+Gt]=ge[Gt]}else A.push(ge)}}class Z{constructor(W,ie){this.i=W,this.j=ie,this.h=0,this.g=null}get(){let W;return 0<this.h?(this.h--,W=this.g,this.g=W.next,W.next=null):W=this.i(),W}}function K(A){return/^[\s\xa0]*$/.test(A)}function re(){var A=_.navigator;return A&&(A=A.userAgent)?A:""}function ae(A){return ae[" "](A),A}ae[" "]=function(){};var ne=re().indexOf("Gecko")!=-1&&!(re().toLowerCase().indexOf("webkit")!=-1&&re().indexOf("Edge")==-1)&&!(re().indexOf("Trident")!=-1||re().indexOf("MSIE")!=-1)&&re().indexOf("Edge")==-1;function pe(A,W,ie){for(const ge in A)W.call(ie,A[ge],ge,A)}function X(A,W){for(const ie in A)W.call(void 0,A[ie],ie,A)}function J(A){const W={};for(const ie in A)W[ie]=A[ie];return W}const Q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function se(A,W){let ie,ge;for(let Qe=1;Qe<arguments.length;Qe++){ge=arguments[Qe];for(ie in ge)A[ie]=ge[ie];for(let ut=0;ut<Q.length;ut++)ie=Q[ut],Object.prototype.hasOwnProperty.call(ge,ie)&&(A[ie]=ge[ie])}}function de(A){var W=1;A=A.split(":");const ie=[];for(;0<W&&A.length;)ie.push(A.shift()),W--;return A.length&&ie.push(A.join(":")),ie}function he(A){_.setTimeout(()=>{throw A},0)}function le(){var A=be;let W=null;return A.g&&(W=A.g,A.g=A.g.next,A.g||(A.h=null),W.next=null),W}class Oe{constructor(){this.h=this.g=null}add(W,ie){const ge=Ve.get();ge.set(W,ie),this.h?this.h.next=ge:this.g=ge,this.h=ge}}var Ve=new Z(()=>new xe,A=>A.reset());class xe{constructor(){this.next=this.g=this.h=null}set(W,ie){this.h=W,this.g=ie,this.next=null}reset(){this.next=this.g=this.h=null}}let Re,ve=!1,be=new Oe,ze=()=>{const A=_.Promise.resolve(void 0);Re=()=>{A.then(Pe)}};var Pe=()=>{for(var A;A=le();){try{A.h.call(A.g)}catch(ie){he(ie)}var W=Ve;W.j(A),100>W.h&&(W.h++,A.next=W.g,W.g=A)}ve=!1};function we(){this.s=this.s,this.C=this.C}we.prototype.s=!1,we.prototype.ma=function(){this.s||(this.s=!0,this.N())},we.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function ke(A,W){this.type=A,this.g=this.target=W,this.defaultPrevented=!1}ke.prototype.h=function(){this.defaultPrevented=!0};var Ue=function(){if(!_.addEventListener||!Object.defineProperty)return!1;var A=!1,W=Object.defineProperty({},"passive",{get:function(){A=!0}});try{const ie=()=>{};_.addEventListener("test",ie,W),_.removeEventListener("test",ie,W)}catch{}return A}();function Be(A,W){if(ke.call(this,A?A.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,A){var ie=this.type=A.type,ge=A.changedTouches&&A.changedTouches.length?A.changedTouches[0]:null;if(this.target=A.target||A.srcElement,this.g=W,W=A.relatedTarget){if(ne){e:{try{ae(W.nodeName);var Qe=!0;break e}catch{}Qe=!1}Qe||(W=null)}}else ie=="mouseover"?W=A.fromElement:ie=="mouseout"&&(W=A.toElement);this.relatedTarget=W,ge?(this.clientX=ge.clientX!==void 0?ge.clientX:ge.pageX,this.clientY=ge.clientY!==void 0?ge.clientY:ge.pageY,this.screenX=ge.screenX||0,this.screenY=ge.screenY||0):(this.clientX=A.clientX!==void 0?A.clientX:A.pageX,this.clientY=A.clientY!==void 0?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0),this.button=A.button,this.key=A.key||"",this.ctrlKey=A.ctrlKey,this.altKey=A.altKey,this.shiftKey=A.shiftKey,this.metaKey=A.metaKey,this.pointerId=A.pointerId||0,this.pointerType=typeof A.pointerType=="string"?A.pointerType:qe[A.pointerType]||"",this.state=A.state,this.i=A,A.defaultPrevented&&Be.aa.h.call(this)}}M(Be,ke);var qe={2:"touch",3:"pen",4:"mouse"};Be.prototype.h=function(){Be.aa.h.call(this);var A=this.i;A.preventDefault?A.preventDefault():A.returnValue=!1};var $e="closure_listenable_"+(1e6*Math.random()|0),it=0;function Je(A,W,ie,ge,Qe){this.listener=A,this.proxy=null,this.src=W,this.type=ie,this.capture=!!ge,this.ha=Qe,this.key=++it,this.da=this.fa=!1}function Ct(A){A.da=!0,A.listener=null,A.proxy=null,A.src=null,A.ha=null}function kt(A){this.src=A,this.g={},this.h=0}kt.prototype.add=function(A,W,ie,ge,Qe){var ut=A.toString();A=this.g[ut],A||(A=this.g[ut]=[],this.h++);var Gt=lt(A,W,ge,Qe);return-1<Gt?(W=A[Gt],ie||(W.fa=!1)):(W=new Je(W,this.src,ut,!!ge,Qe),W.fa=ie,A.push(W)),W};function He(A,W){var ie=W.type;if(ie in A.g){var ge=A.g[ie],Qe=Array.prototype.indexOf.call(ge,W,void 0),ut;(ut=0<=Qe)&&Array.prototype.splice.call(ge,Qe,1),ut&&(Ct(W),A.g[ie].length==0&&(delete A.g[ie],A.h--))}}function lt(A,W,ie,ge){for(var Qe=0;Qe<A.length;++Qe){var ut=A[Qe];if(!ut.da&&ut.listener==W&&ut.capture==!!ie&&ut.ha==ge)return Qe}return-1}var mt="closure_lm_"+(1e6*Math.random()|0),Lt={};function Xt(A,W,ie,ge,Qe){if(Array.isArray(W)){for(var ut=0;ut<W.length;ut++)Xt(A,W[ut],ie,ge,Qe);return null}return ie=mn(ie),A&&A[$e]?A.K(W,ie,b(ge)?!!ge.capture:!1,Qe):$t(A,W,ie,!1,ge,Qe)}function $t(A,W,ie,ge,Qe,ut){if(!W)throw Error("Invalid event type");var Gt=b(Qe)?!!Qe.capture:!!Qe,Zr=wt(A);if(Zr||(A[mt]=Zr=new kt(A)),ie=Zr.add(W,ie,ge,Gt,ut),ie.proxy)return ie;if(ge=Te(),ie.proxy=ge,ge.src=A,ge.listener=ie,A.addEventListener)Ue||(Qe=Gt),Qe===void 0&&(Qe=!1),A.addEventListener(W.toString(),ge,Qe);else if(A.attachEvent)A.attachEvent(gt(W.toString()),ge);else if(A.addListener&&A.removeListener)A.addListener(ge);else throw Error("addEventListener and attachEvent are unavailable.");return ie}function Te(){function A(ie){return W.call(A.src,A.listener,ie)}const W=Et;return A}function je(A,W,ie,ge,Qe){if(Array.isArray(W))for(var ut=0;ut<W.length;ut++)je(A,W[ut],ie,ge,Qe);else ge=b(ge)?!!ge.capture:!!ge,ie=mn(ie),A&&A[$e]?(A=A.i,W=String(W).toString(),W in A.g&&(ut=A.g[W],ie=lt(ut,ie,ge,Qe),-1<ie&&(Ct(ut[ie]),Array.prototype.splice.call(ut,ie,1),ut.length==0&&(delete A.g[W],A.h--)))):A&&(A=wt(A))&&(W=A.g[W.toString()],A=-1,W&&(A=lt(W,ie,ge,Qe)),(ie=-1<A?W[A]:null)&&Ke(ie))}function Ke(A){if(typeof A!="number"&&A&&!A.da){var W=A.src;if(W&&W[$e])He(W.i,A);else{var ie=A.type,ge=A.proxy;W.removeEventListener?W.removeEventListener(ie,ge,A.capture):W.detachEvent?W.detachEvent(gt(ie),ge):W.addListener&&W.removeListener&&W.removeListener(ge),(ie=wt(W))?(He(ie,A),ie.h==0&&(ie.src=null,W[mt]=null)):Ct(A)}}}function gt(A){return A in Lt?Lt[A]:Lt[A]="on"+A}function Et(A,W){if(A.da)A=!0;else{W=new Be(W,this);var ie=A.listener,ge=A.ha||A.src;A.fa&&Ke(A),A=ie.call(ge,W)}return A}function wt(A){return A=A[mt],A instanceof kt?A:null}var Kt="__closure_events_fn_"+(1e9*Math.random()>>>0);function mn(A){return typeof A=="function"?A:(A[Kt]||(A[Kt]=function(W){return A.handleEvent(W)}),A[Kt])}function vn(){we.call(this),this.i=new kt(this),this.M=this,this.F=null}M(vn,we),vn.prototype[$e]=!0,vn.prototype.removeEventListener=function(A,W,ie,ge){je(this,A,W,ie,ge)};function rn(A,W){var ie,ge=A.F;if(ge)for(ie=[];ge;ge=ge.F)ie.push(ge);if(A=A.M,ge=W.type||W,typeof W=="string")W=new ke(W,A);else if(W instanceof ke)W.target=W.target||A;else{var Qe=W;W=new ke(ge,A),se(W,Qe)}if(Qe=!0,ie)for(var ut=ie.length-1;0<=ut;ut--){var Gt=W.g=ie[ut];Qe=Tt(Gt,ge,!0,W)&&Qe}if(Gt=W.g=A,Qe=Tt(Gt,ge,!0,W)&&Qe,Qe=Tt(Gt,ge,!1,W)&&Qe,ie)for(ut=0;ut<ie.length;ut++)Gt=W.g=ie[ut],Qe=Tt(Gt,ge,!1,W)&&Qe}vn.prototype.N=function(){if(vn.aa.N.call(this),this.i){var A=this.i,W;for(W in A.g){for(var ie=A.g[W],ge=0;ge<ie.length;ge++)Ct(ie[ge]);delete A.g[W],A.h--}}this.F=null},vn.prototype.K=function(A,W,ie,ge){return this.i.add(String(A),W,!1,ie,ge)},vn.prototype.L=function(A,W,ie,ge){return this.i.add(String(A),W,!0,ie,ge)};function Tt(A,W,ie,ge){if(W=A.i.g[String(W)],!W)return!0;W=W.concat();for(var Qe=!0,ut=0;ut<W.length;++ut){var Gt=W[ut];if(Gt&&!Gt.da&&Gt.capture==ie){var Zr=Gt.listener,gi=Gt.ha||Gt.src;Gt.fa&&He(A.i,Gt),Qe=Zr.call(gi,ge)!==!1&&Qe}}return Qe&&!ge.defaultPrevented}function ir(A,W,ie){if(typeof A=="function")ie&&(A=O(A,ie));else if(A&&typeof A.handleEvent=="function")A=O(A.handleEvent,A);else throw Error("Invalid listener argument");return 2147483647<Number(W)?-1:_.setTimeout(A,W||0)}function Ut(A){A.g=ir(()=>{A.g=null,A.i&&(A.i=!1,Ut(A))},A.l);const W=A.h;A.h=null,A.m.apply(null,W)}class Wt extends we{constructor(W,ie){super(),this.m=W,this.l=ie,this.h=null,this.i=!1,this.g=null}j(W){this.h=arguments,this.g?this.i=!0:Ut(this)}N(){super.N(),this.g&&(_.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function gn(A){we.call(this),this.h=A,this.g={}}M(gn,we);var Ni=[];function ys(A){pe(A.g,function(W,ie){this.g.hasOwnProperty(ie)&&Ke(W)},A),A.g={}}gn.prototype.N=function(){gn.aa.N.call(this),ys(this)},gn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var oi=_.JSON.stringify,Zo=_.JSON.parse,cc=class{stringify(A){return _.JSON.stringify(A,void 0)}parse(A){return _.JSON.parse(A,void 0)}};function so(){}so.prototype.h=null;function oo(A){return A.h||(A.h=A.i())}function Dc(){}var Es={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Da(){ke.call(this,"d")}M(Da,ke);function Mo(){ke.call(this,"c")}M(Mo,ke);var xa={},lc=null;function vl(){return lc=lc||new vn}xa.La="serverreachability";function La(A){ke.call(this,xa.La,A)}M(La,ke);function uc(A){const W=vl();rn(W,new La(W))}xa.STAT_EVENT="statevent";function _o(A,W){ke.call(this,xa.STAT_EVENT,A),this.stat=W}M(_o,ke);function Di(A){const W=vl();rn(W,new _o(W,A))}xa.Ma="timingevent";function vt(A,W){ke.call(this,xa.Ma,A),this.size=W}M(vt,ke);function pn(A,W){if(typeof A!="function")throw Error("Fn must not be null and must be a function");return _.setTimeout(function(){A()},W)}function vr(){this.g=!0}vr.prototype.xa=function(){this.g=!1};function mi(A,W,ie,ge,Qe,ut){A.info(function(){if(A.g)if(ut)for(var Gt="",Zr=ut.split("&"),gi=0;gi<Zr.length;gi++){var Ir=Zr[gi].split("=");if(1<Ir.length){var ao=Ir[0];Ir=Ir[1];var Ss=ao.split("_");Gt=2<=Ss.length&&Ss[1]=="type"?Gt+(ao+"="+Ir+"&"):Gt+(ao+"=redacted&")}}else Gt=null;else Gt=ut;return"XMLHTTP REQ ("+ge+") [attempt "+Qe+"]: "+W+`
`+ie+`
`+Gt})}function Uo(A,W,ie,ge,Qe,ut,Gt){A.info(function(){return"XMLHTTP RESP ("+ge+") [ attempt "+Qe+"]: "+W+`
`+ie+`
`+ut+" "+Gt})}function yo(A,W,ie,ge){A.info(function(){return"XMLHTTP TEXT ("+W+"): "+Cp(A,ie)+(ge?" "+ge:"")})}function Zl(A,W){A.info(function(){return"TIMEOUT: "+W})}vr.prototype.info=function(){};function Cp(A,W){if(!A.g)return W;if(!W)return null;try{var ie=JSON.parse(W);if(ie){for(A=0;A<ie.length;A++)if(Array.isArray(ie[A])){var ge=ie[A];if(!(2>ge.length)){var Qe=ge[1];if(Array.isArray(Qe)&&!(1>Qe.length)){var ut=Qe[0];if(ut!="noop"&&ut!="stop"&&ut!="close")for(var Gt=1;Gt<Qe.length;Gt++)Qe[Gt]=""}}}}return oi(ie)}catch{return W}}var Sl={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},eu={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},wi;function Eo(){}M(Eo,so),Eo.prototype.g=function(){return new XMLHttpRequest},Eo.prototype.i=function(){return{}},wi=new Eo;function Bi(A,W,ie,ge){this.j=A,this.i=W,this.l=ie,this.R=ge||1,this.U=new gn(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Xd}function Xd(){this.i=null,this.g="",this.h=!1}var Jd={},dc={};function Qd(A,W,ie){A.L=1,A.v=pc(ta(W)),A.m=ie,A.P=!0,Qu(A,null)}function Qu(A,W){A.F=Date.now(),qr(A),A.A=ta(A.v);var ie=A.A,ge=A.R;Array.isArray(ge)||(ge=[String(ge)]),ou(ie.i,"t",ge),A.C=0,ie=A.j.J,A.h=new Xd,A.g=oE(A.j,ie?W:null,!A.m),0<A.O&&(A.M=new Wt(O(A.Y,A,A.g),A.O)),W=A.U,ie=A.g,ge=A.ca;var Qe="readystatechange";Array.isArray(Qe)||(Qe&&(Ni[0]=Qe.toString()),Qe=Ni);for(var ut=0;ut<Qe.length;ut++){var Gt=Xt(ie,Qe[ut],ge||W.handleEvent,!1,W.h||W);if(!Gt)break;W.g[Gt.key]=Gt}W=A.H?J(A.H):{},A.m?(A.u||(A.u="POST"),W["Content-Type"]="application/x-www-form-urlencoded",A.g.ea(A.A,A.u,A.m,W)):(A.u="GET",A.g.ea(A.A,A.u,null,W)),uc(),mi(A.i,A.u,A.A,A.l,A.R,A.m)}Bi.prototype.ca=function(A){A=A.target;const W=this.M;W&&Ri(A)==3?W.j():this.Y(A)},Bi.prototype.Y=function(A){try{if(A==this.g)e:{const Ss=Ri(this.g);var W=this.g.Ba();const fc=this.g.Z();if(!(3>Ss)&&(Ss!=3||this.g&&(this.h.h||this.g.oa()||Ks(this.g)))){this.J||Ss!=4||W==7||(W==8||0>=fc?uc(3):uc(2)),xc(this);var ie=this.g.Z();this.X=ie;t:if(ea(this)){var ge=Ks(this.g);A="";var Qe=ge.length,ut=Ri(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ma(this),bl(this);var Gt="";break t}this.h.i=new _.TextDecoder}for(W=0;W<Qe;W++)this.h.h=!0,A+=this.h.i.decode(ge[W],{stream:!(ut&&W==Qe-1)});ge.length=0,this.h.g+=A,this.C=0,Gt=this.h.g}else Gt=this.g.oa();if(this.o=ie==200,Uo(this.i,this.u,this.A,this.l,this.R,Ss,ie),this.o){if(this.T&&!this.K){t:{if(this.g){var Zr,gi=this.g;if((Zr=gi.g?gi.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(Zr)){var Ir=Zr;break t}}Ir=null}if(ie=Ir)yo(this.i,this.l,ie,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Rp(this,ie);else{this.o=!1,this.s=3,Di(12),Ma(this),bl(this);break e}}if(this.P){ie=!0;let da;for(;!this.J&&this.C<Gt.length;)if(da=Zd(this,Gt),da==dc){Ss==4&&(this.s=4,Di(14),ie=!1),yo(this.i,this.l,null,"[Incomplete Response]");break}else if(da==Jd){this.s=4,Di(15),yo(this.i,this.l,Gt,"[Invalid Chunk]"),ie=!1;break}else yo(this.i,this.l,da,null),Rp(this,da);if(ea(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ss!=4||Gt.length!=0||this.h.h||(this.s=1,Di(16),ie=!1),this.o=this.o&&ie,!ie)yo(this.i,this.l,Gt,"[Invalid Chunked Response]"),Ma(this),bl(this);else if(0<Gt.length&&!this.W){this.W=!0;var ao=this.j;ao.g==this&&ao.ba&&!ao.M&&(ao.j.info("Great, no buffering proxy detected. Bytes received: "+Gt.length),qg(ao),ao.M=!0,Di(11))}}else yo(this.i,this.l,Gt,null),Rp(this,Gt);Ss==4&&Ma(this),this.o&&!this.J&&(Ss==4?um(this.j,this):(this.o=!1,qr(this)))}else aa(this.g),ie==400&&0<Gt.indexOf("Unknown SID")?(this.s=3,Di(12)):(this.s=0,Di(13)),Ma(this),bl(this)}}}catch{}finally{}};function ea(A){return A.g?A.u=="GET"&&A.L!=2&&A.j.Ca:!1}function Zd(A,W){var ie=A.C,ge=W.indexOf(`
`,ie);return ge==-1?dc:(ie=Number(W.substring(ie,ge)),isNaN(ie)?Jd:(ge+=1,ge+ie>W.length?dc:(W=W.slice(ge,ge+ie),A.C=ge+ie,W)))}Bi.prototype.cancel=function(){this.J=!0,Ma(this)};function qr(A){A.S=Date.now()+A.I,Ci(A,A.I)}function Ci(A,W){if(A.B!=null)throw Error("WatchDog timer not null");A.B=pn(O(A.ba,A),W)}function xc(A){A.B&&(_.clearTimeout(A.B),A.B=null)}Bi.prototype.ba=function(){this.B=null;const A=Date.now();0<=A-this.S?(Zl(this.i,this.A),this.L!=2&&(uc(),Di(17)),Ma(this),this.s=2,bl(this)):Ci(this,this.S-A)};function bl(A){A.j.G==0||A.J||um(A.j,A)}function Ma(A){xc(A);var W=A.M;W&&typeof W.ma=="function"&&W.ma(),A.M=null,ys(A.U),A.g&&(W=A.g,A.g=null,W.abort(),W.ma())}function Rp(A,W){try{var ie=A.j;if(ie.G!=0&&(ie.g==A||vo(ie.h,A))){if(!A.K&&vo(ie.h,A)&&ie.G==3){try{var ge=ie.Da.g.parse(W)}catch{ge=null}if(Array.isArray(ge)&&ge.length==3){var Qe=ge;if(Qe[0]==0){e:if(!ie.u){if(ie.g)if(ie.g.F+3e3<A.F)lm(ie),Il(ie);else break e;cm(ie),Di(18)}}else ie.za=Qe[1],0<ie.za-ie.T&&37500>Qe[2]&&ie.F&&ie.v==0&&!ie.C&&(ie.C=pn(O(ie.Za,ie),6e3));if(1>=nm(ie.h)&&ie.ca){try{ie.ca()}catch{}ie.ca=void 0}}else sd(ie,11)}else if((A.K||ie.g==A)&&lm(ie),!K(W))for(Qe=ie.Da.g.parse(W),W=0;W<Qe.length;W++){let Ir=Qe[W];if(ie.T=Ir[0],Ir=Ir[1],ie.G==2)if(Ir[0]=="c"){ie.K=Ir[1],ie.ia=Ir[2];const ao=Ir[3];ao!=null&&(ie.la=ao,ie.j.info("VER="+ie.la));const Ss=Ir[4];Ss!=null&&(ie.Aa=Ss,ie.j.info("SVER="+ie.Aa));const fc=Ir[5];fc!=null&&typeof fc=="number"&&0<fc&&(ge=1.5*fc,ie.L=ge,ie.j.info("backChannelRequestTimeoutMs_="+ge)),ge=ie;const da=A.g;if(da){const kp=da.g?da.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(kp){var ut=ge.h;ut.g||kp.indexOf("spdy")==-1&&kp.indexOf("quic")==-1&&kp.indexOf("h2")==-1||(ut.j=ut.l,ut.g=new Set,ut.h&&(Ip(ut,ut.h),ut.h=null))}if(ge.D){const hm=da.g?da.g.getResponseHeader("X-HTTP-Session-Id"):null;hm&&(ge.ya=hm,Qr(ge.I,ge.D,hm))}}ie.G=3,ie.l&&ie.l.ua(),ie.ba&&(ie.R=Date.now()-A.F,ie.j.info("Handshake RTT: "+ie.R+"ms")),ge=ie;var Gt=A;if(ge.qa=Yg(ge,ge.J?ge.ia:null,ge.W),Gt.K){Tl(ge.h,Gt);var Zr=Gt,gi=ge.L;gi&&(Zr.I=gi),Zr.B&&(xc(Zr),qr(Zr)),ge.g=Gt}else cu(ge);0<ie.i.length&&Uc(ie)}else Ir[0]!="stop"&&Ir[0]!="close"||sd(ie,7);else ie.G==3&&(Ir[0]=="stop"||Ir[0]=="close"?Ir[0]=="stop"?sd(ie,7):is(ie):Ir[0]!="noop"&&ie.l&&ie.l.ta(Ir),ie.v=0)}}uc(4)}catch{}}var eh=class{constructor(A,W){this.g=A,this.map=W}};function tu(A){this.l=A||10,_.PerformanceNavigationTiming?(A=_.performance.getEntriesByType("navigation"),A=0<A.length&&(A[0].nextHopProtocol=="hq"||A[0].nextHopProtocol=="h2")):A=!!(_.chrome&&_.chrome.loadTimes&&_.chrome.loadTimes()&&_.chrome.loadTimes().wasFetchedViaSpdy),this.j=A?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Vo(A){return A.h?!0:A.g?A.g.size>=A.j:!1}function nm(A){return A.h?1:A.g?A.g.size:0}function vo(A,W){return A.h?A.h==W:A.g?A.g.has(W):!1}function Ip(A,W){A.g?A.g.add(W):A.h=W}function Tl(A,W){A.h&&A.h==W?A.h=null:A.g&&A.g.has(W)&&A.g.delete(W)}tu.prototype.cancel=function(){if(this.i=th(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const A of this.g.values())A.cancel();this.g.clear()}};function th(A){if(A.h!=null)return A.i.concat(A.h.D);if(A.g!=null&&A.g.size!==0){let W=A.i;for(const ie of A.g.values())W=W.concat(ie.D);return W}return F(A.i)}function nh(A){if(A.V&&typeof A.V=="function")return A.V();if(typeof Map<"u"&&A instanceof Map||typeof Set<"u"&&A instanceof Set)return Array.from(A.values());if(typeof A=="string")return A.split("");if(v(A)){for(var W=[],ie=A.length,ge=0;ge<ie;ge++)W.push(A[ge]);return W}W=[],ie=0;for(ge in A)W[ie++]=A[ge];return W}function Sr(A){if(A.na&&typeof A.na=="function")return A.na();if(!A.V||typeof A.V!="function"){if(typeof Map<"u"&&A instanceof Map)return Array.from(A.keys());if(!(typeof Set<"u"&&A instanceof Set)){if(v(A)||typeof A=="string"){var W=[];A=A.length;for(var ie=0;ie<A;ie++)W.push(ie);return W}W=[],ie=0;for(const ge in A)W[ie++]=ge;return W}}}function nu(A,W){if(A.forEach&&typeof A.forEach=="function")A.forEach(W,void 0);else if(v(A)||typeof A=="string")Array.prototype.forEach.call(A,W,void 0);else for(var ie=Sr(A),ge=nh(A),Qe=ge.length,ut=0;ut<Qe;ut++)W.call(void 0,ge[ut],ie&&ie[ut],A)}var ru=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Zu(A,W){if(A){A=A.split("&");for(var ie=0;ie<A.length;ie++){var ge=A[ie].indexOf("="),Qe=null;if(0<=ge){var ut=A[ie].substring(0,ge);Qe=A[ie].substring(ge+1)}else ut=A[ie];W(ut,Qe?decodeURIComponent(Qe.replace(/\+/g," ")):"")}}}function hc(A){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,A instanceof hc){this.h=A.h,ed(this,A.j),this.o=A.o,this.g=A.g,wl(this,A.s),this.l=A.l;var W=A.i,ie=new na;ie.i=W.i,W.g&&(ie.g=new Map(W.g),ie.h=W.h),iu(this,ie),this.m=A.m}else A&&(W=String(A).match(ru))?(this.h=!1,ed(this,W[1]||"",!0),this.o=ur(W[2]||""),this.g=ur(W[3]||"",!0),wl(this,W[4]),this.l=ur(W[5]||"",!0),iu(this,W[6]||"",!0),this.m=ur(W[7]||"")):(this.h=!1,this.i=new na(null,this.h))}hc.prototype.toString=function(){var A=[],W=this.j;W&&A.push(Lc(W,su,!0),":");var ie=this.g;return(ie||W=="file")&&(A.push("//"),(W=this.o)&&A.push(Lc(W,su,!0),"@"),A.push(encodeURIComponent(String(ie)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ie=this.s,ie!=null&&A.push(":",String(ie))),(ie=this.l)&&(this.g&&ie.charAt(0)!="/"&&A.push("/"),A.push(Lc(ie,ie.charAt(0)=="/"?Ap:rh,!0))),(ie=this.i.toString())&&A.push("?",ie),(ie=this.m)&&A.push("#",Lc(ie,Pp)),A.join("")};function ta(A){return new hc(A)}function ed(A,W,ie){A.j=ie?ur(W,!0):W,A.j&&(A.j=A.j.replace(/:$/,""))}function wl(A,W){if(W){if(W=Number(W),isNaN(W)||0>W)throw Error("Bad port number "+W);A.s=W}else A.s=null}function iu(A,W,ie){W instanceof na?(A.i=W,oa(A.i,A.h)):(ie||(W=Lc(W,im)),A.i=new na(W,A.h))}function Qr(A,W,ie){A.i.set(W,ie)}function pc(A){return Qr(A,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),A}function ur(A,W){return A?W?decodeURI(A.replace(/%25/g,"%2525")):decodeURIComponent(A):""}function Lc(A,W,ie){return typeof A=="string"?(A=encodeURI(A).replace(W,rm),ie&&(A=A.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),A):null}function rm(A){return A=A.charCodeAt(0),"%"+(A>>4&15).toString(16)+(A&15).toString(16)}var su=/[#\/\?@]/g,rh=/[#\?:]/g,Ap=/[#\?]/g,im=/[#\?@]/g,Pp=/#/g;function na(A,W){this.h=this.g=null,this.i=A||null,this.j=!!W}function ds(A){A.g||(A.g=new Map,A.h=0,A.i&&Zu(A.i,function(W,ie){A.add(decodeURIComponent(W.replace(/\+/g," ")),ie)}))}n=na.prototype,n.add=function(A,W){ds(this),this.i=null,A=sa(this,A);var ie=this.g.get(A);return ie||this.g.set(A,ie=[]),ie.push(W),this.h+=1,this};function ra(A,W){ds(A),W=sa(A,W),A.g.has(W)&&(A.i=null,A.h-=A.g.get(W).length,A.g.delete(W))}function ia(A,W){return ds(A),W=sa(A,W),A.g.has(W)}n.forEach=function(A,W){ds(this),this.g.forEach(function(ie,ge){ie.forEach(function(Qe){A.call(W,Qe,ge,this)},this)},this)},n.na=function(){ds(this);const A=Array.from(this.g.values()),W=Array.from(this.g.keys()),ie=[];for(let ge=0;ge<W.length;ge++){const Qe=A[ge];for(let ut=0;ut<Qe.length;ut++)ie.push(W[ge])}return ie},n.V=function(A){ds(this);let W=[];if(typeof A=="string")ia(this,A)&&(W=W.concat(this.g.get(sa(this,A))));else{A=Array.from(this.g.values());for(let ie=0;ie<A.length;ie++)W=W.concat(A[ie])}return W},n.set=function(A,W){return ds(this),this.i=null,A=sa(this,A),ia(this,A)&&(this.h-=this.g.get(A).length),this.g.set(A,[W]),this.h+=1,this},n.get=function(A,W){return A?(A=this.V(A),0<A.length?String(A[0]):W):W};function ou(A,W,ie){ra(A,W),0<ie.length&&(A.i=null,A.g.set(sa(A,W),F(ie)),A.h+=ie.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const A=[],W=Array.from(this.g.keys());for(var ie=0;ie<W.length;ie++){var ge=W[ie];const ut=encodeURIComponent(String(ge)),Gt=this.V(ge);for(ge=0;ge<Gt.length;ge++){var Qe=ut;Gt[ge]!==""&&(Qe+="="+encodeURIComponent(String(Gt[ge]))),A.push(Qe)}}return this.i=A.join("&")};function sa(A,W){return W=String(W),A.j&&(W=W.toLowerCase()),W}function oa(A,W){W&&!A.j&&(ds(A),A.i=null,A.g.forEach(function(ie,ge){var Qe=ge.toLowerCase();ge!=Qe&&(ra(this,ge),ou(this,Qe,ie))},A)),A.j=W}function sm(A,W){const ie=new vr;if(_.Image){const ge=new Image;ge.onload=L(vs,ie,"TestLoadImage: loaded",!0,W,ge),ge.onerror=L(vs,ie,"TestLoadImage: error",!1,W,ge),ge.onabort=L(vs,ie,"TestLoadImage: abort",!1,W,ge),ge.ontimeout=L(vs,ie,"TestLoadImage: timeout",!1,W,ge),_.setTimeout(function(){ge.ontimeout&&ge.ontimeout()},1e4),ge.src=A}else W(!1)}function Mc(A,W){const ie=new vr,ge=new AbortController,Qe=setTimeout(()=>{ge.abort(),vs(ie,"TestPingServer: timeout",!1,W)},1e4);fetch(A,{signal:ge.signal}).then(ut=>{clearTimeout(Qe),ut.ok?vs(ie,"TestPingServer: ok",!0,W):vs(ie,"TestPingServer: server error",!1,W)}).catch(()=>{clearTimeout(Qe),vs(ie,"TestPingServer: error",!1,W)})}function vs(A,W,ie,ge,Qe){try{Qe&&(Qe.onload=null,Qe.onerror=null,Qe.onabort=null,Qe.ontimeout=null),ge(ie)}catch{}}function td(){this.g=new cc}function Op(A,W,ie){const ge=ie||"";try{nu(A,function(Qe,ut){let Gt=Qe;b(Qe)&&(Gt=oi(Qe)),W.push(ge+ut+"="+encodeURIComponent(Gt))})}catch(Qe){throw W.push(ge+"type="+encodeURIComponent("_badmap")),Qe}}function Cl(A){this.l=A.Ub||null,this.j=A.eb||!1}M(Cl,so),Cl.prototype.g=function(){return new au(this.l,this.j)},Cl.prototype.i=function(A){return function(){return A}}({});function au(A,W){vn.call(this),this.D=A,this.o=W,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}M(au,vn),n=au.prototype,n.open=function(A,W){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=A,this.A=W,this.readyState=1,Va(this)},n.send=function(A){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const W={headers:this.u,method:this.B,credentials:this.m,cache:void 0};A&&(W.body=A),(this.D||_).fetch(new Request(this.A,W)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ua(this)),this.readyState=0},n.Sa=function(A){if(this.g&&(this.l=A,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=A.headers,this.readyState=2,Va(this)),this.g&&(this.readyState=3,Va(this),this.g)))if(this.responseType==="arraybuffer")A.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof _.ReadableStream<"u"&&"body"in A){if(this.j=A.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;om(this)}else A.text().then(this.Ra.bind(this),this.ga.bind(this))};function om(A){A.j.read().then(A.Pa.bind(A)).catch(A.ga.bind(A))}n.Pa=function(A){if(this.g){if(this.o&&A.value)this.response.push(A.value);else if(!this.o){var W=A.value?A.value:new Uint8Array(0);(W=this.v.decode(W,{stream:!A.done}))&&(this.response=this.responseText+=W)}A.done?Ua(this):Va(this),this.readyState==3&&om(this)}},n.Ra=function(A){this.g&&(this.response=this.responseText=A,Ua(this))},n.Qa=function(A){this.g&&(this.response=A,Ua(this))},n.ga=function(){this.g&&Ua(this)};function Ua(A){A.readyState=4,A.l=null,A.j=null,A.v=null,Va(A)}n.setRequestHeader=function(A,W){this.u.append(A,W)},n.getResponseHeader=function(A){return this.h&&this.h.get(A.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const A=[],W=this.h.entries();for(var ie=W.next();!ie.done;)ie=ie.value,A.push(ie[0]+": "+ie[1]),ie=W.next();return A.join(`\r
`)};function Va(A){A.onreadystatechange&&A.onreadystatechange.call(A)}Object.defineProperty(au.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(A){this.m=A?"include":"same-origin"}});function Rl(A){let W="";return pe(A,function(ie,ge){W+=ge,W+=":",W+=ie,W+=`\r
`}),W}function Se(A,W,ie){e:{for(ge in ie){var ge=!1;break e}ge=!0}ge||(ie=Rl(ie),typeof A=="string"?ie!=null&&encodeURIComponent(String(ie)):Qr(A,W,ie))}function De(A){vn.call(this),this.headers=new Map,this.o=A||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}M(De,vn);var rt=/^https?$/i,tn=["POST","PUT"];n=De.prototype,n.Ha=function(A){this.J=A},n.ea=function(A,W,ie,ge){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+A);W=W?W.toUpperCase():"GET",this.D=A,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():wi.g(),this.v=this.o?oo(this.o):oo(wi),this.g.onreadystatechange=O(this.Ea,this);try{this.B=!0,this.g.open(W,String(A),!0),this.B=!1}catch(ut){er(this,ut);return}if(A=ie||"",ie=new Map(this.headers),ge)if(Object.getPrototypeOf(ge)===Object.prototype)for(var Qe in ge)ie.set(Qe,ge[Qe]);else if(typeof ge.keys=="function"&&typeof ge.get=="function")for(const ut of ge.keys())ie.set(ut,ge.get(ut));else throw Error("Unknown input type for opt_headers: "+String(ge));ge=Array.from(ie.keys()).find(ut=>ut.toLowerCase()=="content-type"),Qe=_.FormData&&A instanceof _.FormData,!(0<=Array.prototype.indexOf.call(tn,W,void 0))||ge||Qe||ie.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[ut,Gt]of ie)this.g.setRequestHeader(ut,Gt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{zr(this),this.u=!0,this.g.send(A),this.u=!1}catch(ut){er(this,ut)}};function er(A,W){A.h=!1,A.g&&(A.j=!0,A.g.abort(),A.j=!1),A.l=W,A.m=5,Rr(A),fn(A)}function Rr(A){A.A||(A.A=!0,rn(A,"complete"),rn(A,"error"))}n.abort=function(A){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=A||7,rn(this,"complete"),rn(this,"abort"),fn(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),fn(this,!0)),De.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Yr(this):this.bb())},n.bb=function(){Yr(this)};function Yr(A){if(A.h&&typeof f<"u"&&(!A.v[1]||Ri(A)!=4||A.Z()!=2)){if(A.u&&Ri(A)==4)ir(A.Ea,0,A);else if(rn(A,"readystatechange"),Ri(A)==4){A.h=!1;try{const Gt=A.Z();e:switch(Gt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var W=!0;break e;default:W=!1}var ie;if(!(ie=W)){var ge;if(ge=Gt===0){var Qe=String(A.D).match(ru)[1]||null;!Qe&&_.self&&_.self.location&&(Qe=_.self.location.protocol.slice(0,-1)),ge=!rt.test(Qe?Qe.toLowerCase():"")}ie=ge}if(ie)rn(A,"complete"),rn(A,"success");else{A.m=6;try{var ut=2<Ri(A)?A.g.statusText:""}catch{ut=""}A.l=ut+" ["+A.Z()+"]",Rr(A)}}finally{fn(A)}}}}function fn(A,W){if(A.g){zr(A);const ie=A.g,ge=A.v[0]?()=>{}:null;A.g=null,A.v=null,W||rn(A,"ready");try{ie.onreadystatechange=ge}catch{}}}function zr(A){A.I&&(_.clearTimeout(A.I),A.I=null)}n.isActive=function(){return!!this.g};function Ri(A){return A.g?A.g.readyState:0}n.Z=function(){try{return 2<Ri(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(A){if(this.g){var W=this.g.responseText;return A&&W.indexOf(A)==0&&(W=W.substring(A.length)),Zo(W)}};function Ks(A){try{if(!A.g)return null;if("response"in A.g)return A.g.response;switch(A.H){case"":case"text":return A.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in A.g)return A.g.mozResponseArrayBuffer}return null}catch{return null}}function aa(A){const W={};A=(A.g&&2<=Ri(A)&&A.g.getAllResponseHeaders()||"").split(`\r
`);for(let ge=0;ge<A.length;ge++){if(K(A[ge]))continue;var ie=de(A[ge]);const Qe=ie[0];if(ie=ie[1],typeof ie!="string")continue;ie=ie.trim();const ut=W[Qe]||[];W[Qe]=ut,ut.push(ie)}X(W,function(ge){return ge.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ca(A,W,ie){return ie&&ie.internalChannelParams&&ie.internalChannelParams[A]||W}function nd(A){this.Aa=0,this.i=[],this.j=new vr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ca("failFast",!1,A),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ca("baseRetryDelayMs",5e3,A),this.cb=ca("retryDelaySeedMs",1e4,A),this.Wa=ca("forwardChannelMaxRetries",2,A),this.wa=ca("forwardChannelRequestTimeoutMs",2e4,A),this.pa=A&&A.xmlHttpFactory||void 0,this.Xa=A&&A.Tb||void 0,this.Ca=A&&A.useFetchStreams||!1,this.L=void 0,this.J=A&&A.supportsCrossDomainXhr||!1,this.K="",this.h=new tu(A&&A.concurrentRequestLimit),this.Da=new td,this.P=A&&A.fastHandshake||!1,this.O=A&&A.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=A&&A.Rb||!1,A&&A.xa&&this.j.xa(),A&&A.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&A&&A.detectBufferingProxy||!1,this.ja=void 0,A&&A.longPollingTimeout&&0<A.longPollingTimeout&&(this.ja=A.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=nd.prototype,n.la=8,n.G=1,n.connect=function(A,W,ie,ge){Di(0),this.W=A,this.H=W||{},ie&&ge!==void 0&&(this.H.OSID=ie,this.H.OAID=ge),this.F=this.X,this.I=Yg(this,null,this.W),Uc(this)};function is(A){if(ih(A),A.G==3){var W=A.U++,ie=ta(A.I);if(Qr(ie,"SID",A.K),Qr(ie,"RID",W),Qr(ie,"TYPE","terminate"),rd(A,ie),W=new Bi(A,A.j,W),W.L=2,W.v=pc(ta(ie)),ie=!1,_.navigator&&_.navigator.sendBeacon)try{ie=_.navigator.sendBeacon(W.v.toString(),"")}catch{}!ie&&_.Image&&(new Image().src=W.v,ie=!0),ie||(W.g=oE(W.j,null),W.g.ea(W.v)),W.F=Date.now(),qr(W)}od(A)}function Il(A){A.g&&(qg(A),A.g.cancel(),A.g=null)}function ih(A){Il(A),A.u&&(_.clearTimeout(A.u),A.u=null),lm(A),A.h.cancel(),A.s&&(typeof A.s=="number"&&_.clearTimeout(A.s),A.s=null)}function Uc(A){if(!Vo(A.h)&&!A.s){A.s=!0;var W=A.Ga;Re||ze(),ve||(Re(),ve=!0),be.add(W,A),A.B=0}}function Kg(A,W){return nm(A.h)>=A.h.j-(A.s?1:0)?!1:A.s?(A.i=W.D.concat(A.i),!0):A.G==1||A.G==2||A.B>=(A.Va?0:A.Wa)?!1:(A.s=pn(O(A.Ga,A,W),id(A,A.B)),A.B++,!0)}n.Ga=function(A){if(this.s)if(this.s=null,this.G==1){if(!A){this.U=Math.floor(1e5*Math.random()),A=this.U++;const Qe=new Bi(this,this.j,A);let ut=this.o;if(this.S&&(ut?(ut=J(ut),se(ut,this.S)):ut=this.S),this.m!==null||this.O||(Qe.H=ut,ut=null),this.P)e:{for(var W=0,ie=0;ie<this.i.length;ie++){t:{var ge=this.i[ie];if("__data__"in ge.map&&(ge=ge.map.__data__,typeof ge=="string")){ge=ge.length;break t}ge=void 0}if(ge===void 0)break;if(W+=ge,4096<W){W=ie;break e}if(W===4096||ie===this.i.length-1){W=ie+1;break e}}W=1e3}else W=1e3;W=la(this,Qe,W),ie=ta(this.I),Qr(ie,"RID",A),Qr(ie,"CVER",22),this.D&&Qr(ie,"X-HTTP-Session-Id",this.D),rd(this,ie),ut&&(this.O?W="headers="+encodeURIComponent(String(Rl(ut)))+"&"+W:this.m&&Se(ie,this.m,ut)),Ip(this.h,Qe),this.Ua&&Qr(ie,"TYPE","init"),this.P?(Qr(ie,"$req",W),Qr(ie,"SID","null"),Qe.T=!0,Qd(Qe,ie,null)):Qd(Qe,ie,W),this.G=2}}else this.G==3&&(A?am(this,A):this.i.length==0||Vo(this.h)||am(this))};function am(A,W){var ie;W?ie=W.l:ie=A.U++;const ge=ta(A.I);Qr(ge,"SID",A.K),Qr(ge,"RID",ie),Qr(ge,"AID",A.T),rd(A,ge),A.m&&A.o&&Se(ge,A.m,A.o),ie=new Bi(A,A.j,ie,A.B+1),A.m===null&&(ie.H=A.o),W&&(A.i=W.D.concat(A.i)),W=la(A,ie,1e3),ie.I=Math.round(.5*A.wa)+Math.round(.5*A.wa*Math.random()),Ip(A.h,ie),Qd(ie,ge,W)}function rd(A,W){A.H&&pe(A.H,function(ie,ge){Qr(W,ge,ie)}),A.l&&nu({},function(ie,ge){Qr(W,ge,ie)})}function la(A,W,ie){ie=Math.min(A.i.length,ie);var ge=A.l?O(A.l.Na,A.l,A):null;e:{var Qe=A.i;let ut=-1;for(;;){const Gt=["count="+ie];ut==-1?0<ie?(ut=Qe[0].g,Gt.push("ofs="+ut)):ut=0:Gt.push("ofs="+ut);let Zr=!0;for(let gi=0;gi<ie;gi++){let Ir=Qe[gi].g;const ao=Qe[gi].map;if(Ir-=ut,0>Ir)ut=Math.max(0,Qe[gi].g-100),Zr=!1;else try{Op(ao,Gt,"req"+Ir+"_")}catch{ge&&ge(ao)}}if(Zr){ge=Gt.join("&");break e}}}return A=A.i.splice(0,ie),W.D=A,ge}function cu(A){if(!A.g&&!A.u){A.Y=1;var W=A.Fa;Re||ze(),ve||(Re(),ve=!0),be.add(W,A),A.v=0}}function cm(A){return A.g||A.u||3<=A.v?!1:(A.Y++,A.u=pn(O(A.Fa,A),id(A,A.v)),A.v++,!0)}n.Fa=function(){if(this.u=null,sE(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var A=2*this.R;this.j.info("BP detection timer enabled: "+A),this.A=pn(O(this.ab,this),A)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Di(10),Il(this),sE(this))};function qg(A){A.A!=null&&(_.clearTimeout(A.A),A.A=null)}function sE(A){A.g=new Bi(A,A.j,"rpc",A.Y),A.m===null&&(A.g.H=A.o),A.g.O=0;var W=ta(A.qa);Qr(W,"RID","rpc"),Qr(W,"SID",A.K),Qr(W,"AID",A.T),Qr(W,"CI",A.F?"0":"1"),!A.F&&A.ja&&Qr(W,"TO",A.ja),Qr(W,"TYPE","xmlhttp"),rd(A,W),A.m&&A.o&&Se(W,A.m,A.o),A.L&&(A.g.I=A.L);var ie=A.g;A=A.ia,ie.L=1,ie.v=pc(ta(W)),ie.m=null,ie.P=!0,Qu(ie,A)}n.Za=function(){this.C!=null&&(this.C=null,Il(this),cm(this),Di(19))};function lm(A){A.C!=null&&(_.clearTimeout(A.C),A.C=null)}function um(A,W){var ie=null;if(A.g==W){lm(A),qg(A),A.g=null;var ge=2}else if(vo(A.h,W))ie=W.D,Tl(A.h,W),ge=1;else return;if(A.G!=0){if(W.o)if(ge==1){ie=W.m?W.m.length:0,W=Date.now()-W.F;var Qe=A.B;ge=vl(),rn(ge,new vt(ge,ie)),Uc(A)}else cu(A);else if(Qe=W.s,Qe==3||Qe==0&&0<W.X||!(ge==1&&Kg(A,W)||ge==2&&cm(A)))switch(ie&&0<ie.length&&(W=A.h,W.i=W.i.concat(ie)),Qe){case 1:sd(A,5);break;case 4:sd(A,10);break;case 3:sd(A,6);break;default:sd(A,2)}}}function id(A,W){let ie=A.Ta+Math.floor(Math.random()*A.cb);return A.isActive()||(ie*=2),ie*W}function sd(A,W){if(A.j.info("Error code "+W),W==2){var ie=O(A.fb,A),ge=A.Xa;const Qe=!ge;ge=new hc(ge||"//www.google.com/images/cleardot.gif"),_.location&&_.location.protocol=="http"||ed(ge,"https"),pc(ge),Qe?sm(ge.toString(),ie):Mc(ge.toString(),ie)}else Di(2);A.G=0,A.l&&A.l.sa(W),od(A),ih(A)}n.fb=function(A){A?(this.j.info("Successfully pinged google.com"),Di(2)):(this.j.info("Failed to ping google.com"),Di(1))};function od(A){if(A.G=0,A.ka=[],A.l){const W=th(A.h);(W.length!=0||A.i.length!=0)&&(z(A.ka,W),z(A.ka,A.i),A.h.i.length=0,F(A.i),A.i.length=0),A.l.ra()}}function Yg(A,W,ie){var ge=ie instanceof hc?ta(ie):new hc(ie);if(ge.g!="")W&&(ge.g=W+"."+ge.g),wl(ge,ge.s);else{var Qe=_.location;ge=Qe.protocol,W=W?W+"."+Qe.hostname:Qe.hostname,Qe=+Qe.port;var ut=new hc(null);ge&&ed(ut,ge),W&&(ut.g=W),Qe&&wl(ut,Qe),ie&&(ut.l=ie),ge=ut}return ie=A.D,W=A.ya,ie&&W&&Qr(ge,ie,W),Qr(ge,"VER",A.la),rd(A,ge),ge}function oE(A,W,ie){if(W&&!A.J)throw Error("Can't create secondary domain capable XhrIo object.");return W=A.Ca&&!A.pa?new De(new Cl({eb:ie})):new De(A.pa),W.Ha(A.J),W}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Gn(){}n=Gn.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function dm(){}dm.prototype.g=function(A,W){return new ua(A,W)};function ua(A,W){vn.call(this),this.g=new nd(W),this.l=A,this.h=W&&W.messageUrlParams||null,A=W&&W.messageHeaders||null,W&&W.clientProtocolHeaderRequired&&(A?A["X-Client-Protocol"]="webchannel":A={"X-Client-Protocol":"webchannel"}),this.g.o=A,A=W&&W.initMessageHeaders||null,W&&W.messageContentType&&(A?A["X-WebChannel-Content-Type"]=W.messageContentType:A={"X-WebChannel-Content-Type":W.messageContentType}),W&&W.va&&(A?A["X-WebChannel-Client-Profile"]=W.va:A={"X-WebChannel-Client-Profile":W.va}),this.g.S=A,(A=W&&W.Sb)&&!K(A)&&(this.g.m=A),this.v=W&&W.supportsCrossDomainXhr||!1,this.u=W&&W.sendRawJson||!1,(W=W&&W.httpSessionIdParam)&&!K(W)&&(this.g.D=W,A=this.h,A!==null&&W in A&&(A=this.h,W in A&&delete A[W])),this.j=new Vc(this)}M(ua,vn),ua.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ua.prototype.close=function(){is(this.g)},ua.prototype.o=function(A){var W=this.g;if(typeof A=="string"){var ie={};ie.__data__=A,A=ie}else this.u&&(ie={},ie.__data__=oi(A),A=ie);W.i.push(new eh(W.Ya++,A)),W.G==3&&Uc(W)},ua.prototype.N=function(){this.g.l=null,delete this.j,is(this.g),delete this.g,ua.aa.N.call(this)};function aE(A){Da.call(this),A.__headers__&&(this.headers=A.__headers__,this.statusCode=A.__status__,delete A.__headers__,delete A.__status__);var W=A.__sm__;if(W){e:{for(const ie in W){A=ie;break e}A=void 0}(this.i=A)&&(A=this.i,W=W!==null&&A in W?W[A]:void 0),this.data=W}else this.data=A}M(aE,Da);function cE(){Mo.call(this),this.status=1}M(cE,Mo);function Vc(A){this.g=A}M(Vc,Gn),Vc.prototype.ua=function(){rn(this.g,"a")},Vc.prototype.ta=function(A){rn(this.g,new aE(A))},Vc.prototype.sa=function(A){rn(this.g,new cE)},Vc.prototype.ra=function(){rn(this.g,"b")},dm.prototype.createWebChannel=dm.prototype.g,ua.prototype.send=ua.prototype.o,ua.prototype.open=ua.prototype.m,ua.prototype.close=ua.prototype.close,iie=function(){return new dm},rie=function(){return vl()},nie=xa,wV={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Sl.NO_ERROR=0,Sl.TIMEOUT=8,Sl.HTTP_ERROR=6,ck=Sl,eu.COMPLETE="complete",tie=eu,Dc.EventType=Es,Es.OPEN="a",Es.CLOSE="b",Es.ERROR="c",Es.MESSAGE="d",vn.prototype.listen=vn.prototype.K,Ww=Dc,De.prototype.listenOnce=De.prototype.L,De.prototype.getLastError=De.prototype.Ka,De.prototype.getLastErrorCode=De.prototype.Ba,De.prototype.getStatus=De.prototype.Z,De.prototype.getResponseJson=De.prototype.Oa,De.prototype.getResponseText=De.prototype.oa,De.prototype.send=De.prototype.ea,De.prototype.setWithCredentials=De.prototype.Ha,eie=De}).apply(typeof IO<"u"?IO:typeof self<"u"?self:typeof window<"u"?window:{});const PX="@firebase/firestore",OX="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rc{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}rc.UNAUTHENTICATED=new rc(null),rc.GOOGLE_CREDENTIALS=new rc("google-credentials-uid"),rc.FIRST_PARTY=new rc("first-party-uid"),rc.MOCK_USER=new rc("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let G0="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qy=new BF("@firebase/firestore");function PS(){return qy.logLevel}function on(n,...t){if(qy.logLevel<=Or.DEBUG){const i=t.map(QF);qy.debug(`Firestore (${G0}): ${n}`,...i)}}function Yf(n,...t){if(qy.logLevel<=Or.ERROR){const i=t.map(QF);qy.error(`Firestore (${G0}): ${n}`,...i)}}function C0(n,...t){if(qy.logLevel<=Or.WARN){const i=t.map(QF);qy.warn(`Firestore (${G0}): ${n}`,...i)}}function QF(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(i){return JSON.stringify(i)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qn(n="Unexpected state"){const t=`FIRESTORE (${G0}) INTERNAL ASSERTION FAILED: `+n;throw Yf(t),new Error(t)}function fi(n,t){n||qn()}function rr(n,t){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ot={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class dn extends wp{constructor(t,i){super(t,i),this.code=t,this.message=i,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bf{constructor(){this.promise=new Promise((t,i)=>{this.resolve=t,this.reject=i})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sie{constructor(t,i){this.user=i,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class WFe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,i){t.enqueueRetryable(()=>i(rc.UNAUTHENTICATED))}shutdown(){}}class GFe{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,i){this.changeListener=i,t.enqueueRetryable(()=>i(this.token.user))}shutdown(){this.changeListener=null}}class HFe{constructor(t){this.t=t,this.currentUser=rc.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,i){fi(this.o===void 0);let a=this.i;const l=v=>this.i!==a?(a=this.i,i(v)):Promise.resolve();let d=new Bf;this.o=()=>{this.i++,this.currentUser=this.u(),d.resolve(),d=new Bf,t.enqueueRetryable(()=>l(this.currentUser))};const f=()=>{const v=d;t.enqueueRetryable(async()=>{await v.promise,await l(this.currentUser)})},_=v=>{on("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=v,this.o&&(this.auth.addAuthTokenListener(this.o),f())};this.t.onInit(v=>_(v)),setTimeout(()=>{if(!this.auth){const v=this.t.getImmediate({optional:!0});v?_(v):(on("FirebaseAuthCredentialsProvider","Auth not yet detected"),d.resolve(),d=new Bf)}},0),f()}getToken(){const t=this.i,i=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(i).then(a=>this.i!==t?(on("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):a?(fi(typeof a.accessToken=="string"),new sie(a.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return fi(t===null||typeof t=="string"),new rc(t)}}class $Fe{constructor(t,i,a){this.l=t,this.h=i,this.P=a,this.type="FirstParty",this.user=rc.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const t=this.I();return t&&this.T.set("Authorization",t),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class KFe{constructor(t,i,a){this.l=t,this.h=i,this.P=a}getToken(){return Promise.resolve(new $Fe(this.l,this.h,this.P))}start(t,i){t.enqueueRetryable(()=>i(rc.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class kX{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class qFe{constructor(t,i){this.A=i,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,Wl(t)&&t.settings.appCheckToken&&(this.V=t.settings.appCheckToken)}start(t,i){fi(this.o===void 0);const a=d=>{d.error!=null&&on("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${d.error.message}`);const f=d.token!==this.R;return this.R=d.token,on("FirebaseAppCheckTokenProvider",`Received ${f?"new":"existing"} token.`),f?i(d.token):Promise.resolve()};this.o=d=>{t.enqueueRetryable(()=>a(d))};const l=d=>{on("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=d,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(d=>l(d)),setTimeout(()=>{if(!this.appCheck){const d=this.A.getImmediate({optional:!0});d?l(d):on("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new kX(this.V));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(i=>i?(fi(typeof i.token=="string"),this.R=i.token,new kX(i.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YFe(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),i=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(i);else for(let a=0;a<n;a++)i[a]=Math.floor(256*Math.random());return i}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oie(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aie{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=62*Math.floor(4.129032258064516);let a="";for(;a.length<20;){const l=YFe(40);for(let d=0;d<l.length;++d)a.length<20&&l[d]<i&&(a+=t.charAt(l[d]%62))}return a}}function Er(n,t){return n<t?-1:n>t?1:0}function CV(n,t){let i=0;for(;i<n.length&&i<t.length;){const a=n.codePointAt(i),l=t.codePointAt(i);if(a!==l){if(a<128&&l<128)return Er(a,l);{const d=oie(),f=XFe(d.encode(NX(n,i)),d.encode(NX(t,i)));return f!==0?f:Er(a,l)}}i+=a>65535?2:1}return Er(n.length,t.length)}function NX(n,t){return n.codePointAt(t)>65535?n.substring(t,t+2):n.substring(t,t+1)}function XFe(n,t){for(let i=0;i<n.length&&i<t.length;++i)if(n[i]!==t[i])return Er(n[i],t[i]);return Er(n.length,t.length)}function R0(n,t,i){return n.length===t.length&&n.every((a,l)=>i(a,t[l]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DX=-62135596800,xX=1e6;class No{static now(){return No.fromMillis(Date.now())}static fromDate(t){return No.fromMillis(t.getTime())}static fromMillis(t){const i=Math.floor(t/1e3),a=Math.floor((t-1e3*i)*xX);return new No(i,a)}constructor(t,i){if(this.seconds=t,this.nanoseconds=i,i<0)throw new dn(Ot.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(i>=1e9)throw new dn(Ot.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+i);if(t<DX)throw new dn(Ot.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new dn(Ot.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/xX}_compareTo(t){return this.seconds===t.seconds?Er(this.nanoseconds,t.nanoseconds):Er(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds-DX;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zn{static fromTimestamp(t){return new Zn(t)}static min(){return new Zn(new No(0,0))}static max(){return new Zn(new No(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LX="__name__";class $h{constructor(t,i,a){i===void 0?i=0:i>t.length&&qn(),a===void 0?a=t.length-i:a>t.length-i&&qn(),this.segments=t,this.offset=i,this.len=a}get length(){return this.len}isEqual(t){return $h.comparator(this,t)===0}child(t){const i=this.segments.slice(this.offset,this.limit());return t instanceof $h?t.forEach(a=>{i.push(a)}):i.push(t),this.construct(i)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==t.get(i))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let i=0;i<this.length;i++)if(this.get(i)!==t.get(i))return!1;return!0}forEach(t){for(let i=this.offset,a=this.limit();i<a;i++)t(this.segments[i])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,i){const a=Math.min(t.length,i.length);for(let l=0;l<a;l++){const d=$h.compareSegments(t.get(l),i.get(l));if(d!==0)return d}return Er(t.length,i.length)}static compareSegments(t,i){const a=$h.isNumericId(t),l=$h.isNumericId(i);return a&&!l?-1:!a&&l?1:a&&l?$h.extractNumericId(t).compare($h.extractNumericId(i)):CV(t,i)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return Ig.fromString(t.substring(4,t.length-2))}}class ns extends $h{construct(t,i,a){return new ns(t,i,a)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const i=[];for(const a of t){if(a.indexOf("//")>=0)throw new dn(Ot.INVALID_ARGUMENT,`Invalid segment (${a}). Paths must not contain // in them.`);i.push(...a.split("/").filter(l=>l.length>0))}return new ns(i)}static emptyPath(){return new ns([])}}const JFe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Pa extends $h{construct(t,i,a){return new Pa(t,i,a)}static isValidIdentifier(t){return JFe.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Pa.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===LX}static keyField(){return new Pa([LX])}static fromServerFormat(t){const i=[];let a="",l=0;const d=()=>{if(a.length===0)throw new dn(Ot.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);i.push(a),a=""};let f=!1;for(;l<t.length;){const _=t[l];if(_==="\\"){if(l+1===t.length)throw new dn(Ot.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const v=t[l+1];if(v!=="\\"&&v!=="."&&v!=="`")throw new dn(Ot.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);a+=v,l+=2}else _==="`"?(f=!f,l++):_!=="."||f?(a+=_,l++):(d(),l++)}if(d(),f)throw new dn(Ot.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Pa(i)}static emptyPath(){return new Pa([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn{constructor(t){this.path=t}static fromPath(t){return new Pn(ns.fromString(t))}static fromName(t){return new Pn(ns.fromString(t).popFirst(5))}static empty(){return new Pn(ns.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&ns.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,i){return ns.comparator(t.path,i.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Pn(new ns(t.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FC=-1;function QFe(n,t){const i=n.toTimestamp().seconds,a=n.toTimestamp().nanoseconds+1,l=Zn.fromTimestamp(a===1e9?new No(i+1,0):new No(i,a));return new Dg(l,Pn.empty(),t)}function ZFe(n){return new Dg(n.readTime,n.key,FC)}class Dg{constructor(t,i,a){this.readTime=t,this.documentKey=i,this.largestBatchId=a}static min(){return new Dg(Zn.min(),Pn.empty(),FC)}static max(){return new Dg(Zn.max(),Pn.empty(),FC)}}function e3e(n,t){let i=n.readTime.compareTo(t.readTime);return i!==0?i:(i=Pn.comparator(n.documentKey,t.documentKey),i!==0?i:Er(n.largestBatchId,t.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t3e="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class n3e{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function H0(n){if(n.code!==Ot.FAILED_PRECONDITION||n.message!==t3e)throw n;on("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pt{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(i=>{this.isDone=!0,this.result=i,this.nextCallback&&this.nextCallback(i)},i=>{this.isDone=!0,this.error=i,this.catchCallback&&this.catchCallback(i)})}catch(t){return this.next(void 0,t)}next(t,i){return this.callbackAttached&&qn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(t,this.result):new Pt((a,l)=>{this.nextCallback=d=>{this.wrapSuccess(t,d).next(a,l)},this.catchCallback=d=>{this.wrapFailure(i,d).next(a,l)}})}toPromise(){return new Promise((t,i)=>{this.next(t,i)})}wrapUserFunction(t){try{const i=t();return i instanceof Pt?i:Pt.resolve(i)}catch(i){return Pt.reject(i)}}wrapSuccess(t,i){return t?this.wrapUserFunction(()=>t(i)):Pt.resolve(i)}wrapFailure(t,i){return t?this.wrapUserFunction(()=>t(i)):Pt.reject(i)}static resolve(t){return new Pt((i,a)=>{i(t)})}static reject(t){return new Pt((i,a)=>{a(t)})}static waitFor(t){return new Pt((i,a)=>{let l=0,d=0,f=!1;t.forEach(_=>{++l,_.next(()=>{++d,f&&d===l&&i()},v=>a(v))}),f=!0,d===l&&i()})}static or(t){let i=Pt.resolve(!1);for(const a of t)i=i.next(l=>l?Pt.resolve(l):a());return i}static forEach(t,i){const a=[];return t.forEach((l,d)=>{a.push(i.call(this,l,d))}),this.waitFor(a)}static mapArray(t,i){return new Pt((a,l)=>{const d=t.length,f=new Array(d);let _=0;for(let v=0;v<d;v++){const b=v;i(t[b]).next(C=>{f[b]=C,++_,_===d&&a(f)},C=>l(C))}})}static doWhile(t,i){return new Pt((a,l)=>{const d=()=>{t()===!0?i().next(()=>{d()},l):a()};d()})}}function r3e(n){const t=n.match(/Android ([\d.]+)/i),i=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(i)}function $0(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G1{constructor(t,i){this.previousValue=t,i&&(i.sequenceNumberHandler=a=>this.oe(a),this._e=a=>i.writeSequenceNumber(a))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}G1.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZF=-1;function H1(n){return n==null}function Wk(n){return n===0&&1/n==-1/0}function i3e(n){return typeof n=="number"&&Number.isInteger(n)&&!Wk(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cie="";function s3e(n){let t="";for(let i=0;i<n.length;i++)t.length>0&&(t=MX(t)),t=o3e(n.get(i),t);return MX(t)}function o3e(n,t){let i=t;const a=n.length;for(let l=0;l<a;l++){const d=n.charAt(l);switch(d){case"\0":i+="";break;case cie:i+="";break;default:i+=d}}return i}function MX(n){return n+cie+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UX(n){let t=0;for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&t++;return t}function Hg(n,t){for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&t(i,n[i])}function lie(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _s{constructor(t,i){this.comparator=t,this.root=i||Ia.EMPTY}insert(t,i){return new _s(this.comparator,this.root.insert(t,i,this.comparator).copy(null,null,Ia.BLACK,null,null))}remove(t){return new _s(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Ia.BLACK,null,null))}get(t){let i=this.root;for(;!i.isEmpty();){const a=this.comparator(t,i.key);if(a===0)return i.value;a<0?i=i.left:a>0&&(i=i.right)}return null}indexOf(t){let i=0,a=this.root;for(;!a.isEmpty();){const l=this.comparator(t,a.key);if(l===0)return i+a.left.size;l<0?a=a.left:(i+=a.left.size+1,a=a.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((i,a)=>(t(i,a),!1))}toString(){const t=[];return this.inorderTraversal((i,a)=>(t.push(`${i}:${a}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new AO(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new AO(this.root,t,this.comparator,!1)}getReverseIterator(){return new AO(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new AO(this.root,t,this.comparator,!0)}}class AO{constructor(t,i,a,l){this.isReverse=l,this.nodeStack=[];let d=1;for(;!t.isEmpty();)if(d=i?a(t.key,i):1,i&&l&&(d*=-1),d<0)t=this.isReverse?t.left:t.right;else{if(d===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const i={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return i}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Ia{constructor(t,i,a,l,d){this.key=t,this.value=i,this.color=a??Ia.RED,this.left=l??Ia.EMPTY,this.right=d??Ia.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,i,a,l,d){return new Ia(t??this.key,i??this.value,a??this.color,l??this.left,d??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,a){let l=this;const d=a(t,l.key);return l=d<0?l.copy(null,null,null,l.left.insert(t,i,a),null):d===0?l.copy(null,i,null,null,null):l.copy(null,null,null,null,l.right.insert(t,i,a)),l.fixUp()}removeMin(){if(this.left.isEmpty())return Ia.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,i){let a,l=this;if(i(t,l.key)<0)l.left.isEmpty()||l.left.isRed()||l.left.left.isRed()||(l=l.moveRedLeft()),l=l.copy(null,null,null,l.left.remove(t,i),null);else{if(l.left.isRed()&&(l=l.rotateRight()),l.right.isEmpty()||l.right.isRed()||l.right.left.isRed()||(l=l.moveRedRight()),i(t,l.key)===0){if(l.right.isEmpty())return Ia.EMPTY;a=l.right.min(),l=l.copy(a.key,a.value,null,null,l.right.removeMin())}l=l.copy(null,null,null,null,l.right.remove(t,i))}return l.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Ia.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Ia.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw qn();const t=this.left.check();if(t!==this.right.check())throw qn();return t+(this.isRed()?0:1)}}Ia.EMPTY=null,Ia.RED=!0,Ia.BLACK=!1;Ia.EMPTY=new class{constructor(){this.size=0}get key(){throw qn()}get value(){throw qn()}get color(){throw qn()}get left(){throw qn()}get right(){throw qn()}copy(t,i,a,l,d){return this}insert(t,i,a){return new Ia(t,i)}remove(t,i){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Do{constructor(t){this.comparator=t,this.data=new _s(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((i,a)=>(t(i),!1))}forEachInRange(t,i){const a=this.data.getIteratorFrom(t[0]);for(;a.hasNext();){const l=a.getNext();if(this.comparator(l.key,t[1])>=0)return;i(l.key)}}forEachWhile(t,i){let a;for(a=i!==void 0?this.data.getIteratorFrom(i):this.data.getIterator();a.hasNext();)if(!t(a.getNext().key))return}firstAfterOrEqual(t){const i=this.data.getIteratorFrom(t);return i.hasNext()?i.getNext().key:null}getIterator(){return new VX(this.data.getIterator())}getIteratorFrom(t){return new VX(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let i=this;return i.size<t.size&&(i=t,t=this),t.forEach(a=>{i=i.add(a)}),i}isEqual(t){if(!(t instanceof Do)||this.size!==t.size)return!1;const i=this.data.getIterator(),a=t.data.getIterator();for(;i.hasNext();){const l=i.getNext().key,d=a.getNext().key;if(this.comparator(l,d)!==0)return!1}return!0}toArray(){const t=[];return this.forEach(i=>{t.push(i)}),t}toString(){const t=[];return this.forEach(i=>t.push(i)),"SortedSet("+t.toString()+")"}copy(t){const i=new Do(this.comparator);return i.data=t,i}}class VX{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hl{constructor(t){this.fields=t,t.sort(Pa.comparator)}static empty(){return new Hl([])}unionWith(t){let i=new Do(Pa.comparator);for(const a of this.fields)i=i.add(a);for(const a of t)i=i.add(a);return new Hl(i.toArray())}covers(t){for(const i of this.fields)if(i.isPrefixOf(t))return!0;return!1}isEqual(t){return R0(this.fields,t.fields,(i,a)=>i.isEqual(a))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uie extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oa{constructor(t){this.binaryString=t}static fromBase64String(t){const i=function(l){try{return atob(l)}catch(d){throw typeof DOMException<"u"&&d instanceof DOMException?new uie("Invalid base64 string: "+d):d}}(t);return new Oa(i)}static fromUint8Array(t){const i=function(l){let d="";for(let f=0;f<l.length;++f)d+=String.fromCharCode(l[f]);return d}(t);return new Oa(i)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(i){return btoa(i)}(this.binaryString)}toUint8Array(){return function(i){const a=new Uint8Array(i.length);for(let l=0;l<i.length;l++)a[l]=i.charCodeAt(l);return a}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Er(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Oa.EMPTY_BYTE_STRING=new Oa("");const a3e=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function xg(n){if(fi(!!n),typeof n=="string"){let t=0;const i=a3e.exec(n);if(fi(!!i),i[1]){let l=i[1];l=(l+"000000000").substr(0,9),t=Number(l)}const a=new Date(n);return{seconds:Math.floor(a.getTime()/1e3),nanos:t}}return{seconds:eo(n.seconds),nanos:eo(n.nanos)}}function eo(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Lg(n){return typeof n=="string"?Oa.fromBase64String(n):Oa.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const die="server_timestamp",hie="__type__",pie="__previous_value__",fie="__local_write_time__";function e3(n){var t,i;return((i=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{})[hie])===null||i===void 0?void 0:i.stringValue)===die}function $1(n){const t=n.mapValue.fields[pie];return e3(t)?$1(t):t}function BC(n){const t=xg(n.mapValue.fields[fie].timestampValue);return new No(t.seconds,t.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c3e{constructor(t,i,a,l,d,f,_,v,b){this.databaseId=t,this.appId=i,this.persistenceKey=a,this.host=l,this.ssl=d,this.forceLongPolling=f,this.autoDetectLongPolling=_,this.longPollingOptions=v,this.useFetchStreams=b}}const Gk="(default)";class zC{constructor(t,i){this.projectId=t,this.database=i||Gk}static empty(){return new zC("","")}get isDefaultDatabase(){return this.database===Gk}isEqual(t){return t instanceof zC&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mie="__type__",l3e="__max__",PO={mapValue:{}},gie="__vector__",Hk="value";function Mg(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?e3(n)?4:d3e(n)?9007199254740991:u3e(n)?10:11:qn()}function bp(n,t){if(n===t)return!0;const i=Mg(n);if(i!==Mg(t))return!1;switch(i){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return BC(n).isEqual(BC(t));case 3:return function(l,d){if(typeof l.timestampValue=="string"&&typeof d.timestampValue=="string"&&l.timestampValue.length===d.timestampValue.length)return l.timestampValue===d.timestampValue;const f=xg(l.timestampValue),_=xg(d.timestampValue);return f.seconds===_.seconds&&f.nanos===_.nanos}(n,t);case 5:return n.stringValue===t.stringValue;case 6:return function(l,d){return Lg(l.bytesValue).isEqual(Lg(d.bytesValue))}(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return function(l,d){return eo(l.geoPointValue.latitude)===eo(d.geoPointValue.latitude)&&eo(l.geoPointValue.longitude)===eo(d.geoPointValue.longitude)}(n,t);case 2:return function(l,d){if("integerValue"in l&&"integerValue"in d)return eo(l.integerValue)===eo(d.integerValue);if("doubleValue"in l&&"doubleValue"in d){const f=eo(l.doubleValue),_=eo(d.doubleValue);return f===_?Wk(f)===Wk(_):isNaN(f)&&isNaN(_)}return!1}(n,t);case 9:return R0(n.arrayValue.values||[],t.arrayValue.values||[],bp);case 10:case 11:return function(l,d){const f=l.mapValue.fields||{},_=d.mapValue.fields||{};if(UX(f)!==UX(_))return!1;for(const v in f)if(f.hasOwnProperty(v)&&(_[v]===void 0||!bp(f[v],_[v])))return!1;return!0}(n,t);default:return qn()}}function WC(n,t){return(n.values||[]).find(i=>bp(i,t))!==void 0}function I0(n,t){if(n===t)return 0;const i=Mg(n),a=Mg(t);if(i!==a)return Er(i,a);switch(i){case 0:case 9007199254740991:return 0;case 1:return Er(n.booleanValue,t.booleanValue);case 2:return function(d,f){const _=eo(d.integerValue||d.doubleValue),v=eo(f.integerValue||f.doubleValue);return _<v?-1:_>v?1:_===v?0:isNaN(_)?isNaN(v)?0:-1:1}(n,t);case 3:return jX(n.timestampValue,t.timestampValue);case 4:return jX(BC(n),BC(t));case 5:return CV(n.stringValue,t.stringValue);case 6:return function(d,f){const _=Lg(d),v=Lg(f);return _.compareTo(v)}(n.bytesValue,t.bytesValue);case 7:return function(d,f){const _=d.split("/"),v=f.split("/");for(let b=0;b<_.length&&b<v.length;b++){const C=Er(_[b],v[b]);if(C!==0)return C}return Er(_.length,v.length)}(n.referenceValue,t.referenceValue);case 8:return function(d,f){const _=Er(eo(d.latitude),eo(f.latitude));return _!==0?_:Er(eo(d.longitude),eo(f.longitude))}(n.geoPointValue,t.geoPointValue);case 9:return FX(n.arrayValue,t.arrayValue);case 10:return function(d,f){var _,v,b,C;const I=d.fields||{},O=f.fields||{},L=(_=I[Hk])===null||_===void 0?void 0:_.arrayValue,M=(v=O[Hk])===null||v===void 0?void 0:v.arrayValue,F=Er(((b=L==null?void 0:L.values)===null||b===void 0?void 0:b.length)||0,((C=M==null?void 0:M.values)===null||C===void 0?void 0:C.length)||0);return F!==0?F:FX(L,M)}(n.mapValue,t.mapValue);case 11:return function(d,f){if(d===PO.mapValue&&f===PO.mapValue)return 0;if(d===PO.mapValue)return 1;if(f===PO.mapValue)return-1;const _=d.fields||{},v=Object.keys(_),b=f.fields||{},C=Object.keys(b);v.sort(),C.sort();for(let I=0;I<v.length&&I<C.length;++I){const O=CV(v[I],C[I]);if(O!==0)return O;const L=I0(_[v[I]],b[C[I]]);if(L!==0)return L}return Er(v.length,C.length)}(n.mapValue,t.mapValue);default:throw qn()}}function jX(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return Er(n,t);const i=xg(n),a=xg(t),l=Er(i.seconds,a.seconds);return l!==0?l:Er(i.nanos,a.nanos)}function FX(n,t){const i=n.values||[],a=t.values||[];for(let l=0;l<i.length&&l<a.length;++l){const d=I0(i[l],a[l]);if(d)return d}return Er(i.length,a.length)}function A0(n){return RV(n)}function RV(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const a=xg(i);return`time(${a.seconds},${a.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(i){return Lg(i).toBase64()}(n.bytesValue):"referenceValue"in n?function(i){return Pn.fromName(i).toString()}(n.referenceValue):"geoPointValue"in n?function(i){return`geo(${i.latitude},${i.longitude})`}(n.geoPointValue):"arrayValue"in n?function(i){let a="[",l=!0;for(const d of i.values||[])l?l=!1:a+=",",a+=RV(d);return a+"]"}(n.arrayValue):"mapValue"in n?function(i){const a=Object.keys(i.fields||{}).sort();let l="{",d=!0;for(const f of a)d?d=!1:l+=",",l+=`${f}:${RV(i.fields[f])}`;return l+"}"}(n.mapValue):qn()}function lk(n){switch(Mg(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=$1(n);return t?16+lk(t):16;case 5:return 2*n.stringValue.length;case 6:return Lg(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(a){return(a.values||[]).reduce((l,d)=>l+lk(d),0)}(n.arrayValue);case 10:case 11:return function(a){let l=0;return Hg(a.fields,(d,f)=>{l+=d.length+lk(f)}),l}(n.mapValue);default:throw qn()}}function BX(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function IV(n){return!!n&&"integerValue"in n}function t3(n){return!!n&&"arrayValue"in n}function zX(n){return!!n&&"nullValue"in n}function WX(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function uk(n){return!!n&&"mapValue"in n}function u3e(n){var t,i;return((i=(((t=n==null?void 0:n.mapValue)===null||t===void 0?void 0:t.fields)||{})[mie])===null||i===void 0?void 0:i.stringValue)===gie}function uC(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const t={mapValue:{fields:{}}};return Hg(n.mapValue.fields,(i,a)=>t.mapValue.fields[i]=uC(a)),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let i=0;i<(n.arrayValue.values||[]).length;++i)t.arrayValue.values[i]=uC(n.arrayValue.values[i]);return t}return Object.assign({},n)}function d3e(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===l3e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fl{constructor(t){this.value=t}static empty(){return new fl({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let i=this.value;for(let a=0;a<t.length-1;++a)if(i=(i.mapValue.fields||{})[t.get(a)],!uk(i))return null;return i=(i.mapValue.fields||{})[t.lastSegment()],i||null}}set(t,i){this.getFieldsMap(t.popLast())[t.lastSegment()]=uC(i)}setAll(t){let i=Pa.emptyPath(),a={},l=[];t.forEach((f,_)=>{if(!i.isImmediateParentOf(_)){const v=this.getFieldsMap(i);this.applyChanges(v,a,l),a={},l=[],i=_.popLast()}f?a[_.lastSegment()]=uC(f):l.push(_.lastSegment())});const d=this.getFieldsMap(i);this.applyChanges(d,a,l)}delete(t){const i=this.field(t.popLast());uk(i)&&i.mapValue.fields&&delete i.mapValue.fields[t.lastSegment()]}isEqual(t){return bp(this.value,t.value)}getFieldsMap(t){let i=this.value;i.mapValue.fields||(i.mapValue={fields:{}});for(let a=0;a<t.length;++a){let l=i.mapValue.fields[t.get(a)];uk(l)&&l.mapValue.fields||(l={mapValue:{fields:{}}},i.mapValue.fields[t.get(a)]=l),i=l}return i.mapValue.fields}applyChanges(t,i,a){Hg(i,(l,d)=>t[l]=d);for(const l of a)delete t[l]}clone(){return new fl(uC(this.value))}}function _ie(n){const t=[];return Hg(n.fields,(i,a)=>{const l=new Pa([i]);if(uk(a)){const d=_ie(a.mapValue).fields;if(d.length===0)t.push(l);else for(const f of d)t.push(l.child(f))}else t.push(l)}),new Hl(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ic{constructor(t,i,a,l,d,f,_){this.key=t,this.documentType=i,this.version=a,this.readTime=l,this.createTime=d,this.data=f,this.documentState=_}static newInvalidDocument(t){return new ic(t,0,Zn.min(),Zn.min(),Zn.min(),fl.empty(),0)}static newFoundDocument(t,i,a,l){return new ic(t,1,i,Zn.min(),a,l,0)}static newNoDocument(t,i){return new ic(t,2,i,Zn.min(),Zn.min(),fl.empty(),0)}static newUnknownDocument(t,i){return new ic(t,3,i,Zn.min(),Zn.min(),fl.empty(),2)}convertToFoundDocument(t,i){return!this.createTime.isEqual(Zn.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=i,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=fl.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=fl.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Zn.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof ic&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new ic(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $k{constructor(t,i){this.position=t,this.inclusive=i}}function GX(n,t,i){let a=0;for(let l=0;l<n.position.length;l++){const d=t[l],f=n.position[l];if(d.field.isKeyField()?a=Pn.comparator(Pn.fromName(f.referenceValue),i.key):a=I0(f,i.data.field(d.field)),d.dir==="desc"&&(a*=-1),a!==0)break}return a}function HX(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let i=0;i<n.position.length;i++)if(!bp(n.position[i],t.position[i]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kk{constructor(t,i="asc"){this.field=t,this.dir=i}}function h3e(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yie{}class mo extends yie{constructor(t,i,a){super(),this.field=t,this.op=i,this.value=a}static create(t,i,a){return t.isKeyField()?i==="in"||i==="not-in"?this.createKeyFieldInFilter(t,i,a):new f3e(t,i,a):i==="array-contains"?new _3e(t,a):i==="in"?new y3e(t,a):i==="not-in"?new E3e(t,a):i==="array-contains-any"?new v3e(t,a):new mo(t,i,a)}static createKeyFieldInFilter(t,i,a){return i==="in"?new m3e(t,a):new g3e(t,a)}matches(t){const i=t.data.field(this.field);return this.op==="!="?i!==null&&this.matchesComparison(I0(i,this.value)):i!==null&&Mg(this.value)===Mg(i)&&this.matchesComparison(I0(i,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return qn()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class $d extends yie{constructor(t,i){super(),this.filters=t,this.op=i,this.ce=null}static create(t,i){return new $d(t,i)}matches(t){return Eie(this)?this.filters.find(i=>!i.matches(t))===void 0:this.filters.find(i=>i.matches(t))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((t,i)=>t.concat(i.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function Eie(n){return n.op==="and"}function vie(n){return p3e(n)&&Eie(n)}function p3e(n){for(const t of n.filters)if(t instanceof $d)return!1;return!0}function AV(n){if(n instanceof mo)return n.field.canonicalString()+n.op.toString()+A0(n.value);if(vie(n))return n.filters.map(t=>AV(t)).join(",");{const t=n.filters.map(i=>AV(i)).join(",");return`${n.op}(${t})`}}function Sie(n,t){return n instanceof mo?function(a,l){return l instanceof mo&&a.op===l.op&&a.field.isEqual(l.field)&&bp(a.value,l.value)}(n,t):n instanceof $d?function(a,l){return l instanceof $d&&a.op===l.op&&a.filters.length===l.filters.length?a.filters.reduce((d,f,_)=>d&&Sie(f,l.filters[_]),!0):!1}(n,t):void qn()}function bie(n){return n instanceof mo?function(i){return`${i.field.canonicalString()} ${i.op} ${A0(i.value)}`}(n):n instanceof $d?function(i){return i.op.toString()+" {"+i.getFilters().map(bie).join(" ,")+"}"}(n):"Filter"}class f3e extends mo{constructor(t,i,a){super(t,i,a),this.key=Pn.fromName(a.referenceValue)}matches(t){const i=Pn.comparator(t.key,this.key);return this.matchesComparison(i)}}class m3e extends mo{constructor(t,i){super(t,"in",i),this.keys=Tie("in",i)}matches(t){return this.keys.some(i=>i.isEqual(t.key))}}class g3e extends mo{constructor(t,i){super(t,"not-in",i),this.keys=Tie("not-in",i)}matches(t){return!this.keys.some(i=>i.isEqual(t.key))}}function Tie(n,t){var i;return(((i=t.arrayValue)===null||i===void 0?void 0:i.values)||[]).map(a=>Pn.fromName(a.referenceValue))}class _3e extends mo{constructor(t,i){super(t,"array-contains",i)}matches(t){const i=t.data.field(this.field);return t3(i)&&WC(i.arrayValue,this.value)}}class y3e extends mo{constructor(t,i){super(t,"in",i)}matches(t){const i=t.data.field(this.field);return i!==null&&WC(this.value.arrayValue,i)}}class E3e extends mo{constructor(t,i){super(t,"not-in",i)}matches(t){if(WC(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const i=t.data.field(this.field);return i!==null&&!WC(this.value.arrayValue,i)}}class v3e extends mo{constructor(t,i){super(t,"array-contains-any",i)}matches(t){const i=t.data.field(this.field);return!(!t3(i)||!i.arrayValue.values)&&i.arrayValue.values.some(a=>WC(this.value.arrayValue,a))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S3e{constructor(t,i=null,a=[],l=[],d=null,f=null,_=null){this.path=t,this.collectionGroup=i,this.orderBy=a,this.filters=l,this.limit=d,this.startAt=f,this.endAt=_,this.le=null}}function $X(n,t=null,i=[],a=[],l=null,d=null,f=null){return new S3e(n,t,i,a,l,d,f)}function n3(n){const t=rr(n);if(t.le===null){let i=t.path.canonicalString();t.collectionGroup!==null&&(i+="|cg:"+t.collectionGroup),i+="|f:",i+=t.filters.map(a=>AV(a)).join(","),i+="|ob:",i+=t.orderBy.map(a=>function(d){return d.field.canonicalString()+d.dir}(a)).join(","),H1(t.limit)||(i+="|l:",i+=t.limit),t.startAt&&(i+="|lb:",i+=t.startAt.inclusive?"b:":"a:",i+=t.startAt.position.map(a=>A0(a)).join(",")),t.endAt&&(i+="|ub:",i+=t.endAt.inclusive?"a:":"b:",i+=t.endAt.position.map(a=>A0(a)).join(",")),t.le=i}return t.le}function r3(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<n.orderBy.length;i++)if(!h3e(n.orderBy[i],t.orderBy[i]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let i=0;i<n.filters.length;i++)if(!Sie(n.filters[i],t.filters[i]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!HX(n.startAt,t.startAt)&&HX(n.endAt,t.endAt)}function PV(n){return Pn.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hR{constructor(t,i=null,a=[],l=[],d=null,f="F",_=null,v=null){this.path=t,this.collectionGroup=i,this.explicitOrderBy=a,this.filters=l,this.limit=d,this.limitType=f,this.startAt=_,this.endAt=v,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function b3e(n,t,i,a,l,d,f,_){return new hR(n,t,i,a,l,d,f,_)}function i3(n){return new hR(n)}function KX(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function wie(n){return n.collectionGroup!==null}function dC(n){const t=rr(n);if(t.he===null){t.he=[];const i=new Set;for(const d of t.explicitOrderBy)t.he.push(d),i.add(d.field.canonicalString());const a=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(f){let _=new Do(Pa.comparator);return f.filters.forEach(v=>{v.getFlattenedFilters().forEach(b=>{b.isInequality()&&(_=_.add(b.field))})}),_})(t).forEach(d=>{i.has(d.canonicalString())||d.isKeyField()||t.he.push(new Kk(d,a))}),i.has(Pa.keyField().canonicalString())||t.he.push(new Kk(Pa.keyField(),a))}return t.he}function gp(n){const t=rr(n);return t.Pe||(t.Pe=T3e(t,dC(n))),t.Pe}function T3e(n,t){if(n.limitType==="F")return $X(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(l=>{const d=l.dir==="desc"?"asc":"desc";return new Kk(l.field,d)});const i=n.endAt?new $k(n.endAt.position,n.endAt.inclusive):null,a=n.startAt?new $k(n.startAt.position,n.startAt.inclusive):null;return $X(n.path,n.collectionGroup,t,n.filters,n.limit,i,a)}}function OV(n,t){const i=n.filters.concat([t]);return new hR(n.path,n.collectionGroup,n.explicitOrderBy.slice(),i,n.limit,n.limitType,n.startAt,n.endAt)}function qk(n,t,i){return new hR(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,i,n.startAt,n.endAt)}function K1(n,t){return r3(gp(n),gp(t))&&n.limitType===t.limitType}function Cie(n){return`${n3(gp(n))}|lt:${n.limitType}`}function OS(n){return`Query(target=${function(i){let a=i.path.canonicalString();return i.collectionGroup!==null&&(a+=" collectionGroup="+i.collectionGroup),i.filters.length>0&&(a+=`, filters: [${i.filters.map(l=>bie(l)).join(", ")}]`),H1(i.limit)||(a+=", limit: "+i.limit),i.orderBy.length>0&&(a+=`, orderBy: [${i.orderBy.map(l=>function(f){return`${f.field.canonicalString()} (${f.dir})`}(l)).join(", ")}]`),i.startAt&&(a+=", startAt: ",a+=i.startAt.inclusive?"b:":"a:",a+=i.startAt.position.map(l=>A0(l)).join(",")),i.endAt&&(a+=", endAt: ",a+=i.endAt.inclusive?"a:":"b:",a+=i.endAt.position.map(l=>A0(l)).join(",")),`Target(${a})`}(gp(n))}; limitType=${n.limitType})`}function q1(n,t){return t.isFoundDocument()&&function(a,l){const d=l.key.path;return a.collectionGroup!==null?l.key.hasCollectionId(a.collectionGroup)&&a.path.isPrefixOf(d):Pn.isDocumentKey(a.path)?a.path.isEqual(d):a.path.isImmediateParentOf(d)}(n,t)&&function(a,l){for(const d of dC(a))if(!d.field.isKeyField()&&l.data.field(d.field)===null)return!1;return!0}(n,t)&&function(a,l){for(const d of a.filters)if(!d.matches(l))return!1;return!0}(n,t)&&function(a,l){return!(a.startAt&&!function(f,_,v){const b=GX(f,_,v);return f.inclusive?b<=0:b<0}(a.startAt,dC(a),l)||a.endAt&&!function(f,_,v){const b=GX(f,_,v);return f.inclusive?b>=0:b>0}(a.endAt,dC(a),l))}(n,t)}function w3e(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Rie(n){return(t,i)=>{let a=!1;for(const l of dC(n)){const d=C3e(l,t,i);if(d!==0)return d;a=a||l.field.isKeyField()}return 0}}function C3e(n,t,i){const a=n.field.isKeyField()?Pn.comparator(t.key,i.key):function(d,f,_){const v=f.data.field(d),b=_.data.field(d);return v!==null&&b!==null?I0(v,b):qn()}(n.field,t,i);switch(n.dir){case"asc":return a;case"desc":return-1*a;default:return qn()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eE{constructor(t,i){this.mapKeyFn=t,this.equalsFn=i,this.inner={},this.innerSize=0}get(t){const i=this.mapKeyFn(t),a=this.inner[i];if(a!==void 0){for(const[l,d]of a)if(this.equalsFn(l,t))return d}}has(t){return this.get(t)!==void 0}set(t,i){const a=this.mapKeyFn(t),l=this.inner[a];if(l===void 0)return this.inner[a]=[[t,i]],void this.innerSize++;for(let d=0;d<l.length;d++)if(this.equalsFn(l[d][0],t))return void(l[d]=[t,i]);l.push([t,i]),this.innerSize++}delete(t){const i=this.mapKeyFn(t),a=this.inner[i];if(a===void 0)return!1;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],t))return a.length===1?delete this.inner[i]:a.splice(l,1),this.innerSize--,!0;return!1}forEach(t){Hg(this.inner,(i,a)=>{for(const[l,d]of a)t(l,d)})}isEmpty(){return lie(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R3e=new _s(Pn.comparator);function Xf(){return R3e}const Iie=new _s(Pn.comparator);function Gw(...n){let t=Iie;for(const i of n)t=t.insert(i.key,i);return t}function Aie(n){let t=Iie;return n.forEach((i,a)=>t=t.insert(i,a.overlayedDocument)),t}function wy(){return hC()}function Pie(){return hC()}function hC(){return new eE(n=>n.toString(),(n,t)=>n.isEqual(t))}const I3e=new _s(Pn.comparator),A3e=new Do(Pn.comparator);function Nr(...n){let t=A3e;for(const i of n)t=t.add(i);return t}const P3e=new Do(Er);function O3e(){return P3e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s3(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Wk(t)?"-0":t}}function Oie(n){return{integerValue:""+n}}function k3e(n,t){return i3e(t)?Oie(t):s3(n,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y1{constructor(){this._=void 0}}function N3e(n,t,i){return n instanceof Yk?function(l,d){const f={fields:{[hie]:{stringValue:die},[fie]:{timestampValue:{seconds:l.seconds,nanos:l.nanoseconds}}}};return d&&e3(d)&&(d=$1(d)),d&&(f.fields[pie]=d),{mapValue:f}}(i,t):n instanceof P0?Nie(n,t):n instanceof O0?Die(n,t):function(l,d){const f=kie(l,d),_=qX(f)+qX(l.Ie);return IV(f)&&IV(l.Ie)?Oie(_):s3(l.serializer,_)}(n,t)}function D3e(n,t,i){return n instanceof P0?Nie(n,t):n instanceof O0?Die(n,t):i}function kie(n,t){return n instanceof Xk?function(a){return IV(a)||function(d){return!!d&&"doubleValue"in d}(a)}(t)?t:{integerValue:0}:null}class Yk extends Y1{}class P0 extends Y1{constructor(t){super(),this.elements=t}}function Nie(n,t){const i=xie(t);for(const a of n.elements)i.some(l=>bp(l,a))||i.push(a);return{arrayValue:{values:i}}}class O0 extends Y1{constructor(t){super(),this.elements=t}}function Die(n,t){let i=xie(t);for(const a of n.elements)i=i.filter(l=>!bp(l,a));return{arrayValue:{values:i}}}class Xk extends Y1{constructor(t,i){super(),this.serializer=t,this.Ie=i}}function qX(n){return eo(n.integerValue||n.doubleValue)}function xie(n){return t3(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lie{constructor(t,i){this.field=t,this.transform=i}}function x3e(n,t){return n.field.isEqual(t.field)&&function(a,l){return a instanceof P0&&l instanceof P0||a instanceof O0&&l instanceof O0?R0(a.elements,l.elements,bp):a instanceof Xk&&l instanceof Xk?bp(a.Ie,l.Ie):a instanceof Yk&&l instanceof Yk}(n.transform,t.transform)}class L3e{constructor(t,i){this.version=t,this.transformResults=i}}class Wu{constructor(t,i){this.updateTime=t,this.exists=i}static none(){return new Wu}static exists(t){return new Wu(void 0,t)}static updateTime(t){return new Wu(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function dk(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}class X1{}function Mie(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new o3(n.key,Wu.none()):new pR(n.key,n.data,Wu.none());{const i=n.data,a=fl.empty();let l=new Do(Pa.comparator);for(let d of t.fields)if(!l.has(d)){let f=i.field(d);f===null&&d.length>1&&(d=d.popLast(),f=i.field(d)),f===null?a.delete(d):a.set(d,f),l=l.add(d)}return new $g(n.key,a,new Hl(l.toArray()),Wu.none())}}function M3e(n,t,i){n instanceof pR?function(l,d,f){const _=l.value.clone(),v=XX(l.fieldTransforms,d,f.transformResults);_.setAll(v),d.convertToFoundDocument(f.version,_).setHasCommittedMutations()}(n,t,i):n instanceof $g?function(l,d,f){if(!dk(l.precondition,d))return void d.convertToUnknownDocument(f.version);const _=XX(l.fieldTransforms,d,f.transformResults),v=d.data;v.setAll(Uie(l)),v.setAll(_),d.convertToFoundDocument(f.version,v).setHasCommittedMutations()}(n,t,i):function(l,d,f){d.convertToNoDocument(f.version).setHasCommittedMutations()}(0,t,i)}function pC(n,t,i,a){return n instanceof pR?function(d,f,_,v){if(!dk(d.precondition,f))return _;const b=d.value.clone(),C=JX(d.fieldTransforms,v,f);return b.setAll(C),f.convertToFoundDocument(f.version,b).setHasLocalMutations(),null}(n,t,i,a):n instanceof $g?function(d,f,_,v){if(!dk(d.precondition,f))return _;const b=JX(d.fieldTransforms,v,f),C=f.data;return C.setAll(Uie(d)),C.setAll(b),f.convertToFoundDocument(f.version,C).setHasLocalMutations(),_===null?null:_.unionWith(d.fieldMask.fields).unionWith(d.fieldTransforms.map(I=>I.field))}(n,t,i,a):function(d,f,_){return dk(d.precondition,f)?(f.convertToNoDocument(f.version).setHasLocalMutations(),null):_}(n,t,i)}function U3e(n,t){let i=null;for(const a of n.fieldTransforms){const l=t.data.field(a.field),d=kie(a.transform,l||null);d!=null&&(i===null&&(i=fl.empty()),i.set(a.field,d))}return i||null}function YX(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!function(a,l){return a===void 0&&l===void 0||!(!a||!l)&&R0(a,l,(d,f)=>x3e(d,f))}(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}class pR extends X1{constructor(t,i,a,l=[]){super(),this.key=t,this.value=i,this.precondition=a,this.fieldTransforms=l,this.type=0}getFieldMask(){return null}}class $g extends X1{constructor(t,i,a,l,d=[]){super(),this.key=t,this.data=i,this.fieldMask=a,this.precondition=l,this.fieldTransforms=d,this.type=1}getFieldMask(){return this.fieldMask}}function Uie(n){const t=new Map;return n.fieldMask.fields.forEach(i=>{if(!i.isEmpty()){const a=n.data.field(i);t.set(i,a)}}),t}function XX(n,t,i){const a=new Map;fi(n.length===i.length);for(let l=0;l<i.length;l++){const d=n[l],f=d.transform,_=t.data.field(d.field);a.set(d.field,D3e(f,_,i[l]))}return a}function JX(n,t,i){const a=new Map;for(const l of n){const d=l.transform,f=i.data.field(l.field);a.set(l.field,N3e(d,f,t))}return a}class o3 extends X1{constructor(t,i){super(),this.key=t,this.precondition=i,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class V3e extends X1{constructor(t,i){super(),this.key=t,this.precondition=i,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j3e{constructor(t,i,a,l){this.batchId=t,this.localWriteTime=i,this.baseMutations=a,this.mutations=l}applyToRemoteDocument(t,i){const a=i.mutationResults;for(let l=0;l<this.mutations.length;l++){const d=this.mutations[l];d.key.isEqual(t.key)&&M3e(d,t,a[l])}}applyToLocalView(t,i){for(const a of this.baseMutations)a.key.isEqual(t.key)&&(i=pC(a,t,i,this.localWriteTime));for(const a of this.mutations)a.key.isEqual(t.key)&&(i=pC(a,t,i,this.localWriteTime));return i}applyToLocalDocumentSet(t,i){const a=Pie();return this.mutations.forEach(l=>{const d=t.get(l.key),f=d.overlayedDocument;let _=this.applyToLocalView(f,d.mutatedFields);_=i.has(l.key)?null:_;const v=Mie(f,_);v!==null&&a.set(l.key,v),f.isValidDocument()||f.convertToNoDocument(Zn.min())}),a}keys(){return this.mutations.reduce((t,i)=>t.add(i.key),Nr())}isEqual(t){return this.batchId===t.batchId&&R0(this.mutations,t.mutations,(i,a)=>YX(i,a))&&R0(this.baseMutations,t.baseMutations,(i,a)=>YX(i,a))}}class a3{constructor(t,i,a,l){this.batch=t,this.commitVersion=i,this.mutationResults=a,this.docVersions=l}static from(t,i,a){fi(t.mutations.length===a.length);let l=function(){return I3e}();const d=t.mutations;for(let f=0;f<d.length;f++)l=l.insert(d[f].key,a[f].version);return new a3(t,i,a,l)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F3e{constructor(t,i){this.largestBatchId=t,this.mutation=i}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B3e{constructor(t,i){this.count=t,this.unchangedNames=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var uo,Br;function z3e(n){switch(n){case Ot.OK:return qn();case Ot.CANCELLED:case Ot.UNKNOWN:case Ot.DEADLINE_EXCEEDED:case Ot.RESOURCE_EXHAUSTED:case Ot.INTERNAL:case Ot.UNAVAILABLE:case Ot.UNAUTHENTICATED:return!1;case Ot.INVALID_ARGUMENT:case Ot.NOT_FOUND:case Ot.ALREADY_EXISTS:case Ot.PERMISSION_DENIED:case Ot.FAILED_PRECONDITION:case Ot.ABORTED:case Ot.OUT_OF_RANGE:case Ot.UNIMPLEMENTED:case Ot.DATA_LOSS:return!0;default:return qn()}}function Vie(n){if(n===void 0)return Yf("GRPC error has no .code"),Ot.UNKNOWN;switch(n){case uo.OK:return Ot.OK;case uo.CANCELLED:return Ot.CANCELLED;case uo.UNKNOWN:return Ot.UNKNOWN;case uo.DEADLINE_EXCEEDED:return Ot.DEADLINE_EXCEEDED;case uo.RESOURCE_EXHAUSTED:return Ot.RESOURCE_EXHAUSTED;case uo.INTERNAL:return Ot.INTERNAL;case uo.UNAVAILABLE:return Ot.UNAVAILABLE;case uo.UNAUTHENTICATED:return Ot.UNAUTHENTICATED;case uo.INVALID_ARGUMENT:return Ot.INVALID_ARGUMENT;case uo.NOT_FOUND:return Ot.NOT_FOUND;case uo.ALREADY_EXISTS:return Ot.ALREADY_EXISTS;case uo.PERMISSION_DENIED:return Ot.PERMISSION_DENIED;case uo.FAILED_PRECONDITION:return Ot.FAILED_PRECONDITION;case uo.ABORTED:return Ot.ABORTED;case uo.OUT_OF_RANGE:return Ot.OUT_OF_RANGE;case uo.UNIMPLEMENTED:return Ot.UNIMPLEMENTED;case uo.DATA_LOSS:return Ot.DATA_LOSS;default:return qn()}}(Br=uo||(uo={}))[Br.OK=0]="OK",Br[Br.CANCELLED=1]="CANCELLED",Br[Br.UNKNOWN=2]="UNKNOWN",Br[Br.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Br[Br.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Br[Br.NOT_FOUND=5]="NOT_FOUND",Br[Br.ALREADY_EXISTS=6]="ALREADY_EXISTS",Br[Br.PERMISSION_DENIED=7]="PERMISSION_DENIED",Br[Br.UNAUTHENTICATED=16]="UNAUTHENTICATED",Br[Br.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Br[Br.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Br[Br.ABORTED=10]="ABORTED",Br[Br.OUT_OF_RANGE=11]="OUT_OF_RANGE",Br[Br.UNIMPLEMENTED=12]="UNIMPLEMENTED",Br[Br.INTERNAL=13]="INTERNAL",Br[Br.UNAVAILABLE=14]="UNAVAILABLE",Br[Br.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W3e=new Ig([4294967295,4294967295],0);function QX(n){const t=oie().encode(n),i=new Zre;return i.update(t),new Uint8Array(i.digest())}function ZX(n){const t=new DataView(n.buffer),i=t.getUint32(0,!0),a=t.getUint32(4,!0),l=t.getUint32(8,!0),d=t.getUint32(12,!0);return[new Ig([i,a],0),new Ig([l,d],0)]}class c3{constructor(t,i,a){if(this.bitmap=t,this.padding=i,this.hashCount=a,i<0||i>=8)throw new Hw(`Invalid padding: ${i}`);if(a<0)throw new Hw(`Invalid hash count: ${a}`);if(t.length>0&&this.hashCount===0)throw new Hw(`Invalid hash count: ${a}`);if(t.length===0&&i!==0)throw new Hw(`Invalid padding when bitmap length is 0: ${i}`);this.Ee=8*t.length-i,this.de=Ig.fromNumber(this.Ee)}Ae(t,i,a){let l=t.add(i.multiply(Ig.fromNumber(a)));return l.compare(W3e)===1&&(l=new Ig([l.getBits(0),l.getBits(1)],0)),l.modulo(this.de).toNumber()}Re(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.Ee===0)return!1;const i=QX(t),[a,l]=ZX(i);for(let d=0;d<this.hashCount;d++){const f=this.Ae(a,l,d);if(!this.Re(f))return!1}return!0}static create(t,i,a){const l=t%8==0?0:8-t%8,d=new Uint8Array(Math.ceil(t/8)),f=new c3(d,l,i);return a.forEach(_=>f.insert(_)),f}insert(t){if(this.Ee===0)return;const i=QX(t),[a,l]=ZX(i);for(let d=0;d<this.hashCount;d++){const f=this.Ae(a,l,d);this.Ve(f)}}Ve(t){const i=Math.floor(t/8),a=t%8;this.bitmap[i]|=1<<a}}class Hw extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J1{constructor(t,i,a,l,d){this.snapshotVersion=t,this.targetChanges=i,this.targetMismatches=a,this.documentUpdates=l,this.resolvedLimboDocuments=d}static createSynthesizedRemoteEventForCurrentChange(t,i,a){const l=new Map;return l.set(t,fR.createSynthesizedTargetChangeForCurrentChange(t,i,a)),new J1(Zn.min(),l,new _s(Er),Xf(),Nr())}}class fR{constructor(t,i,a,l,d){this.resumeToken=t,this.current=i,this.addedDocuments=a,this.modifiedDocuments=l,this.removedDocuments=d}static createSynthesizedTargetChangeForCurrentChange(t,i,a){return new fR(a,i,Nr(),Nr(),Nr())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hk{constructor(t,i,a,l){this.me=t,this.removedTargetIds=i,this.key=a,this.fe=l}}class jie{constructor(t,i){this.targetId=t,this.ge=i}}class Fie{constructor(t,i,a=Oa.EMPTY_BYTE_STRING,l=null){this.state=t,this.targetIds=i,this.resumeToken=a,this.cause=l}}class eJ{constructor(){this.pe=0,this.ye=tJ(),this.we=Oa.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(t){t.approximateByteSize()>0&&(this.be=!0,this.we=t)}Fe(){let t=Nr(),i=Nr(),a=Nr();return this.ye.forEach((l,d)=>{switch(d){case 0:t=t.add(l);break;case 2:i=i.add(l);break;case 1:a=a.add(l);break;default:qn()}}),new fR(this.we,this.Se,t,i,a)}Me(){this.be=!1,this.ye=tJ()}xe(t,i){this.be=!0,this.ye=this.ye.insert(t,i)}Oe(t){this.be=!0,this.ye=this.ye.remove(t)}Ne(){this.pe+=1}Be(){this.pe-=1,fi(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class G3e{constructor(t){this.ke=t,this.qe=new Map,this.Qe=Xf(),this.$e=OO(),this.Ue=OO(),this.Ke=new _s(Er)}We(t){for(const i of t.me)t.fe&&t.fe.isFoundDocument()?this.Ge(i,t.fe):this.ze(i,t.key,t.fe);for(const i of t.removedTargetIds)this.ze(i,t.key,t.fe)}je(t){this.forEachTarget(t,i=>{const a=this.He(i);switch(t.state){case 0:this.Je(i)&&a.Ce(t.resumeToken);break;case 1:a.Be(),a.De||a.Me(),a.Ce(t.resumeToken);break;case 2:a.Be(),a.De||this.removeTarget(i);break;case 3:this.Je(i)&&(a.Le(),a.Ce(t.resumeToken));break;case 4:this.Je(i)&&(this.Ye(i),a.Ce(t.resumeToken));break;default:qn()}})}forEachTarget(t,i){t.targetIds.length>0?t.targetIds.forEach(i):this.qe.forEach((a,l)=>{this.Je(l)&&i(l)})}Ze(t){const i=t.targetId,a=t.ge.count,l=this.Xe(i);if(l){const d=l.target;if(PV(d))if(a===0){const f=new Pn(d.path);this.ze(i,f,ic.newNoDocument(f,Zn.min()))}else fi(a===1);else{const f=this.et(i);if(f!==a){const _=this.tt(t),v=_?this.nt(_,t,f):1;if(v!==0){this.Ye(i);const b=v===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(i,b)}}}}}tt(t){const i=t.ge.unchangedNames;if(!i||!i.bits)return null;const{bits:{bitmap:a="",padding:l=0},hashCount:d=0}=i;let f,_;try{f=Lg(a).toUint8Array()}catch(v){if(v instanceof uie)return C0("Decoding the base64 bloom filter in existence filter failed ("+v.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw v}try{_=new c3(f,l,d)}catch(v){return C0(v instanceof Hw?"BloomFilter error: ":"Applying bloom filter failed: ",v),null}return _.Ee===0?null:_}nt(t,i,a){return i.ge.count===a-this.st(t,i.targetId)?0:2}st(t,i){const a=this.ke.getRemoteKeysForTarget(i);let l=0;return a.forEach(d=>{const f=this.ke.it(),_=`projects/${f.projectId}/databases/${f.database}/documents/${d.path.canonicalString()}`;t.mightContain(_)||(this.ze(i,d,null),l++)}),l}ot(t){const i=new Map;this.qe.forEach((d,f)=>{const _=this.Xe(f);if(_){if(d.current&&PV(_.target)){const v=new Pn(_.target.path);this._t(v).has(f)||this.ut(f,v)||this.ze(f,v,ic.newNoDocument(v,t))}d.ve&&(i.set(f,d.Fe()),d.Me())}});let a=Nr();this.Ue.forEach((d,f)=>{let _=!0;f.forEachWhile(v=>{const b=this.Xe(v);return!b||b.purpose==="TargetPurposeLimboResolution"||(_=!1,!1)}),_&&(a=a.add(d))}),this.Qe.forEach((d,f)=>f.setReadTime(t));const l=new J1(t,i,this.Ke,this.Qe,a);return this.Qe=Xf(),this.$e=OO(),this.Ue=OO(),this.Ke=new _s(Er),l}Ge(t,i){if(!this.Je(t))return;const a=this.ut(t,i.key)?2:0;this.He(t).xe(i.key,a),this.Qe=this.Qe.insert(i.key,i),this.$e=this.$e.insert(i.key,this._t(i.key).add(t)),this.Ue=this.Ue.insert(i.key,this.ct(i.key).add(t))}ze(t,i,a){if(!this.Je(t))return;const l=this.He(t);this.ut(t,i)?l.xe(i,1):l.Oe(i),this.Ue=this.Ue.insert(i,this.ct(i).delete(t)),this.Ue=this.Ue.insert(i,this.ct(i).add(t)),a&&(this.Qe=this.Qe.insert(i,a))}removeTarget(t){this.qe.delete(t)}et(t){const i=this.He(t).Fe();return this.ke.getRemoteKeysForTarget(t).size+i.addedDocuments.size-i.removedDocuments.size}Ne(t){this.He(t).Ne()}He(t){let i=this.qe.get(t);return i||(i=new eJ,this.qe.set(t,i)),i}ct(t){let i=this.Ue.get(t);return i||(i=new Do(Er),this.Ue=this.Ue.insert(t,i)),i}_t(t){let i=this.$e.get(t);return i||(i=new Do(Er),this.$e=this.$e.insert(t,i)),i}Je(t){const i=this.Xe(t)!==null;return i||on("WatchChangeAggregator","Detected inactive target",t),i}Xe(t){const i=this.qe.get(t);return i&&i.De?null:this.ke.lt(t)}Ye(t){this.qe.set(t,new eJ),this.ke.getRemoteKeysForTarget(t).forEach(i=>{this.ze(t,i,null)})}ut(t,i){return this.ke.getRemoteKeysForTarget(t).has(i)}}function OO(){return new _s(Pn.comparator)}function tJ(){return new _s(Pn.comparator)}const H3e={asc:"ASCENDING",desc:"DESCENDING"},$3e={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},K3e={and:"AND",or:"OR"};class q3e{constructor(t,i){this.databaseId=t,this.useProto3Json=i}}function kV(n,t){return n.useProto3Json||H1(t)?t:{value:t}}function Jk(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Bie(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function Y3e(n,t){return Jk(n,t.toTimestamp())}function _p(n){return fi(!!n),Zn.fromTimestamp(function(i){const a=xg(i);return new No(a.seconds,a.nanos)}(n))}function l3(n,t){return NV(n,t).canonicalString()}function NV(n,t){const i=function(l){return new ns(["projects",l.projectId,"databases",l.database])}(n).child("documents");return t===void 0?i:i.child(t)}function zie(n){const t=ns.fromString(n);return fi(Kie(t)),t}function DV(n,t){return l3(n.databaseId,t.path)}function rU(n,t){const i=zie(t);if(i.get(1)!==n.databaseId.projectId)throw new dn(Ot.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+n.databaseId.projectId);if(i.get(3)!==n.databaseId.database)throw new dn(Ot.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+n.databaseId.database);return new Pn(Gie(i))}function Wie(n,t){return l3(n.databaseId,t)}function X3e(n){const t=zie(n);return t.length===4?ns.emptyPath():Gie(t)}function xV(n){return new ns(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Gie(n){return fi(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function nJ(n,t,i){return{name:DV(n,t),fields:i.value.mapValue.fields}}function J3e(n,t){let i;if("targetChange"in t){t.targetChange;const a=function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:qn()}(t.targetChange.targetChangeType||"NO_CHANGE"),l=t.targetChange.targetIds||[],d=function(b,C){return b.useProto3Json?(fi(C===void 0||typeof C=="string"),Oa.fromBase64String(C||"")):(fi(C===void 0||C instanceof Buffer||C instanceof Uint8Array),Oa.fromUint8Array(C||new Uint8Array))}(n,t.targetChange.resumeToken),f=t.targetChange.cause,_=f&&function(b){const C=b.code===void 0?Ot.UNKNOWN:Vie(b.code);return new dn(C,b.message||"")}(f);i=new Fie(a,l,d,_||null)}else if("documentChange"in t){t.documentChange;const a=t.documentChange;a.document,a.document.name,a.document.updateTime;const l=rU(n,a.document.name),d=_p(a.document.updateTime),f=a.document.createTime?_p(a.document.createTime):Zn.min(),_=new fl({mapValue:{fields:a.document.fields}}),v=ic.newFoundDocument(l,d,f,_),b=a.targetIds||[],C=a.removedTargetIds||[];i=new hk(b,C,v.key,v)}else if("documentDelete"in t){t.documentDelete;const a=t.documentDelete;a.document;const l=rU(n,a.document),d=a.readTime?_p(a.readTime):Zn.min(),f=ic.newNoDocument(l,d),_=a.removedTargetIds||[];i=new hk([],_,f.key,f)}else if("documentRemove"in t){t.documentRemove;const a=t.documentRemove;a.document;const l=rU(n,a.document),d=a.removedTargetIds||[];i=new hk([],d,l,null)}else{if(!("filter"in t))return qn();{t.filter;const a=t.filter;a.targetId;const{count:l=0,unchangedNames:d}=a,f=new B3e(l,d),_=a.targetId;i=new jie(_,f)}}return i}function Q3e(n,t){let i;if(t instanceof pR)i={update:nJ(n,t.key,t.value)};else if(t instanceof o3)i={delete:DV(n,t.key)};else if(t instanceof $g)i={update:nJ(n,t.key,t.data),updateMask:a4e(t.fieldMask)};else{if(!(t instanceof V3e))return qn();i={verify:DV(n,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(a=>function(d,f){const _=f.transform;if(_ instanceof Yk)return{fieldPath:f.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(_ instanceof P0)return{fieldPath:f.field.canonicalString(),appendMissingElements:{values:_.elements}};if(_ instanceof O0)return{fieldPath:f.field.canonicalString(),removeAllFromArray:{values:_.elements}};if(_ instanceof Xk)return{fieldPath:f.field.canonicalString(),increment:_.Ie};throw qn()}(0,a))),t.precondition.isNone||(i.currentDocument=function(l,d){return d.updateTime!==void 0?{updateTime:Y3e(l,d.updateTime)}:d.exists!==void 0?{exists:d.exists}:qn()}(n,t.precondition)),i}function Z3e(n,t){return n&&n.length>0?(fi(t!==void 0),n.map(i=>function(l,d){let f=l.updateTime?_p(l.updateTime):_p(d);return f.isEqual(Zn.min())&&(f=_p(d)),new L3e(f,l.transformResults||[])}(i,t))):[]}function e4e(n,t){return{documents:[Wie(n,t.path)]}}function t4e(n,t){const i={structuredQuery:{}},a=t.path;let l;t.collectionGroup!==null?(l=a,i.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(l=a.popLast(),i.structuredQuery.from=[{collectionId:a.lastSegment()}]),i.parent=Wie(n,l);const d=function(b){if(b.length!==0)return $ie($d.create(b,"and"))}(t.filters);d&&(i.structuredQuery.where=d);const f=function(b){if(b.length!==0)return b.map(C=>function(O){return{field:kS(O.field),direction:i4e(O.dir)}}(C))}(t.orderBy);f&&(i.structuredQuery.orderBy=f);const _=kV(n,t.limit);return _!==null&&(i.structuredQuery.limit=_),t.startAt&&(i.structuredQuery.startAt=function(b){return{before:b.inclusive,values:b.position}}(t.startAt)),t.endAt&&(i.structuredQuery.endAt=function(b){return{before:!b.inclusive,values:b.position}}(t.endAt)),{ht:i,parent:l}}function n4e(n){let t=X3e(n.parent);const i=n.structuredQuery,a=i.from?i.from.length:0;let l=null;if(a>0){fi(a===1);const C=i.from[0];C.allDescendants?l=C.collectionId:t=t.child(C.collectionId)}let d=[];i.where&&(d=function(I){const O=Hie(I);return O instanceof $d&&vie(O)?O.getFilters():[O]}(i.where));let f=[];i.orderBy&&(f=function(I){return I.map(O=>function(M){return new Kk(NS(M.field),function(z){switch(z){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(M.direction))}(O))}(i.orderBy));let _=null;i.limit&&(_=function(I){let O;return O=typeof I=="object"?I.value:I,H1(O)?null:O}(i.limit));let v=null;i.startAt&&(v=function(I){const O=!!I.before,L=I.values||[];return new $k(L,O)}(i.startAt));let b=null;return i.endAt&&(b=function(I){const O=!I.before,L=I.values||[];return new $k(L,O)}(i.endAt)),b3e(t,l,f,d,_,"F",v,b)}function r4e(n,t){const i=function(l){switch(l){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return qn()}}(t.purpose);return i==null?null:{"goog-listen-tags":i}}function Hie(n){return n.unaryFilter!==void 0?function(i){switch(i.unaryFilter.op){case"IS_NAN":const a=NS(i.unaryFilter.field);return mo.create(a,"==",{doubleValue:NaN});case"IS_NULL":const l=NS(i.unaryFilter.field);return mo.create(l,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const d=NS(i.unaryFilter.field);return mo.create(d,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const f=NS(i.unaryFilter.field);return mo.create(f,"!=",{nullValue:"NULL_VALUE"});default:return qn()}}(n):n.fieldFilter!==void 0?function(i){return mo.create(NS(i.fieldFilter.field),function(l){switch(l){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return qn()}}(i.fieldFilter.op),i.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(i){return $d.create(i.compositeFilter.filters.map(a=>Hie(a)),function(l){switch(l){case"AND":return"and";case"OR":return"or";default:return qn()}}(i.compositeFilter.op))}(n):qn()}function i4e(n){return H3e[n]}function s4e(n){return $3e[n]}function o4e(n){return K3e[n]}function kS(n){return{fieldPath:n.canonicalString()}}function NS(n){return Pa.fromServerFormat(n.fieldPath)}function $ie(n){return n instanceof mo?function(i){if(i.op==="=="){if(WX(i.value))return{unaryFilter:{field:kS(i.field),op:"IS_NAN"}};if(zX(i.value))return{unaryFilter:{field:kS(i.field),op:"IS_NULL"}}}else if(i.op==="!="){if(WX(i.value))return{unaryFilter:{field:kS(i.field),op:"IS_NOT_NAN"}};if(zX(i.value))return{unaryFilter:{field:kS(i.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:kS(i.field),op:s4e(i.op),value:i.value}}}(n):n instanceof $d?function(i){const a=i.getFilters().map(l=>$ie(l));return a.length===1?a[0]:{compositeFilter:{op:o4e(i.op),filters:a}}}(n):qn()}function a4e(n){const t=[];return n.fields.forEach(i=>t.push(i.canonicalString())),{fieldPaths:t}}function Kie(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tg{constructor(t,i,a,l,d=Zn.min(),f=Zn.min(),_=Oa.EMPTY_BYTE_STRING,v=null){this.target=t,this.targetId=i,this.purpose=a,this.sequenceNumber=l,this.snapshotVersion=d,this.lastLimboFreeSnapshotVersion=f,this.resumeToken=_,this.expectedCount=v}withSequenceNumber(t){return new Tg(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,i){return new Tg(this.target,this.targetId,this.purpose,this.sequenceNumber,i,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Tg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Tg(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c4e{constructor(t){this.Tt=t}}function l4e(n){const t=n4e({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?qk(t,t.limit,"L"):t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u4e{constructor(){this.Tn=new d4e}addToCollectionParentIndex(t,i){return this.Tn.add(i),Pt.resolve()}getCollectionParents(t,i){return Pt.resolve(this.Tn.getEntries(i))}addFieldIndex(t,i){return Pt.resolve()}deleteFieldIndex(t,i){return Pt.resolve()}deleteAllFieldIndexes(t){return Pt.resolve()}createTargetIndexes(t,i){return Pt.resolve()}getDocumentsMatchingTarget(t,i){return Pt.resolve(null)}getIndexType(t,i){return Pt.resolve(0)}getFieldIndexes(t,i){return Pt.resolve([])}getNextCollectionGroupToUpdate(t){return Pt.resolve(null)}getMinOffset(t,i){return Pt.resolve(Dg.min())}getMinOffsetFromCollectionGroup(t,i){return Pt.resolve(Dg.min())}updateCollectionGroup(t,i,a){return Pt.resolve()}updateIndexEntries(t,i){return Pt.resolve()}}class d4e{constructor(){this.index={}}add(t){const i=t.lastSegment(),a=t.popLast(),l=this.index[i]||new Do(ns.comparator),d=!l.has(a);return this.index[i]=l.add(a),d}has(t){const i=t.lastSegment(),a=t.popLast(),l=this.index[i];return l&&l.has(a)}getEntries(t){return(this.index[t]||new Do(ns.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rJ={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},qie=41943040;class hl{static withCacheSize(t){return new hl(t,hl.DEFAULT_COLLECTION_PERCENTILE,hl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,i,a){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=i,this.maximumSequenceNumbersToCollect=a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */hl.DEFAULT_COLLECTION_PERCENTILE=10,hl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,hl.DEFAULT=new hl(qie,hl.DEFAULT_COLLECTION_PERCENTILE,hl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),hl.DISABLED=new hl(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k0{constructor(t){this.$n=t}next(){return this.$n+=2,this.$n}static Un(){return new k0(0)}static Kn(){return new k0(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iJ="LruGarbageCollector",h4e=1048576;function sJ([n,t],[i,a]){const l=Er(n,i);return l===0?Er(t,a):l}class p4e{constructor(t){this.Hn=t,this.buffer=new Do(sJ),this.Jn=0}Yn(){return++this.Jn}Zn(t){const i=[t,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(i);else{const a=this.buffer.last();sJ(i,a)<0&&(this.buffer=this.buffer.delete(a).add(i))}}get maxValue(){return this.buffer.last()[0]}}class f4e{constructor(t,i,a){this.garbageCollector=t,this.asyncQueue=i,this.localStore=a,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(t){on(iJ,`Garbage collection scheduled in ${t}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(i){$0(i)?on(iJ,"Ignoring IndexedDB error during garbage collection: ",i):await H0(i)}await this.er(3e5)})}}class m4e{constructor(t,i){this.tr=t,this.params=i}calculateTargetCount(t,i){return this.tr.nr(t).next(a=>Math.floor(i/100*a))}nthSequenceNumber(t,i){if(i===0)return Pt.resolve(G1.ae);const a=new p4e(i);return this.tr.forEachTarget(t,l=>a.Zn(l.sequenceNumber)).next(()=>this.tr.rr(t,l=>a.Zn(l))).next(()=>a.maxValue)}removeTargets(t,i,a){return this.tr.removeTargets(t,i,a)}removeOrphanedDocuments(t,i){return this.tr.removeOrphanedDocuments(t,i)}collect(t,i){return this.params.cacheSizeCollectionThreshold===-1?(on("LruGarbageCollector","Garbage collection skipped; disabled"),Pt.resolve(rJ)):this.getCacheSize(t).next(a=>a<this.params.cacheSizeCollectionThreshold?(on("LruGarbageCollector",`Garbage collection skipped; Cache size ${a} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),rJ):this.ir(t,i))}getCacheSize(t){return this.tr.getCacheSize(t)}ir(t,i){let a,l,d,f,_,v,b;const C=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(I=>(I>this.params.maximumSequenceNumbersToCollect?(on("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${I}`),l=this.params.maximumSequenceNumbersToCollect):l=I,f=Date.now(),this.nthSequenceNumber(t,l))).next(I=>(a=I,_=Date.now(),this.removeTargets(t,a,i))).next(I=>(d=I,v=Date.now(),this.removeOrphanedDocuments(t,a))).next(I=>(b=Date.now(),PS()<=Or.DEBUG&&on("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${f-C}ms
	Determined least recently used ${l} in `+(_-f)+`ms
	Removed ${d} targets in `+(v-_)+`ms
	Removed ${I} documents in `+(b-v)+`ms
Total Duration: ${b-C}ms`),Pt.resolve({didRun:!0,sequenceNumbersCollected:l,targetsRemoved:d,documentsRemoved:I})))}}function g4e(n,t){return new m4e(n,t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _4e{constructor(){this.changes=new eE(t=>t.toString(),(t,i)=>t.isEqual(i)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,i){this.assertNotApplied(),this.changes.set(t,ic.newInvalidDocument(t).setReadTime(i))}getEntry(t,i){this.assertNotApplied();const a=this.changes.get(i);return a!==void 0?Pt.resolve(a):this.getFromCache(t,i)}getEntries(t,i){return this.getAllFromCache(t,i)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y4e{constructor(t,i){this.overlayedDocument=t,this.mutatedFields=i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E4e{constructor(t,i,a,l){this.remoteDocumentCache=t,this.mutationQueue=i,this.documentOverlayCache=a,this.indexManager=l}getDocument(t,i){let a=null;return this.documentOverlayCache.getOverlay(t,i).next(l=>(a=l,this.remoteDocumentCache.getEntry(t,i))).next(l=>(a!==null&&pC(a.mutation,l,Hl.empty(),No.now()),l))}getDocuments(t,i){return this.remoteDocumentCache.getEntries(t,i).next(a=>this.getLocalViewOfDocuments(t,a,Nr()).next(()=>a))}getLocalViewOfDocuments(t,i,a=Nr()){const l=wy();return this.populateOverlays(t,l,i).next(()=>this.computeViews(t,i,l,a).next(d=>{let f=Gw();return d.forEach((_,v)=>{f=f.insert(_,v.overlayedDocument)}),f}))}getOverlayedDocuments(t,i){const a=wy();return this.populateOverlays(t,a,i).next(()=>this.computeViews(t,i,a,Nr()))}populateOverlays(t,i,a){const l=[];return a.forEach(d=>{i.has(d)||l.push(d)}),this.documentOverlayCache.getOverlays(t,l).next(d=>{d.forEach((f,_)=>{i.set(f,_)})})}computeViews(t,i,a,l){let d=Xf();const f=hC(),_=function(){return hC()}();return i.forEach((v,b)=>{const C=a.get(b.key);l.has(b.key)&&(C===void 0||C.mutation instanceof $g)?d=d.insert(b.key,b):C!==void 0?(f.set(b.key,C.mutation.getFieldMask()),pC(C.mutation,b,C.mutation.getFieldMask(),No.now())):f.set(b.key,Hl.empty())}),this.recalculateAndSaveOverlays(t,d).next(v=>(v.forEach((b,C)=>f.set(b,C)),i.forEach((b,C)=>{var I;return _.set(b,new y4e(C,(I=f.get(b))!==null&&I!==void 0?I:null))}),_))}recalculateAndSaveOverlays(t,i){const a=hC();let l=new _s((f,_)=>f-_),d=Nr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,i).next(f=>{for(const _ of f)_.keys().forEach(v=>{const b=i.get(v);if(b===null)return;let C=a.get(v)||Hl.empty();C=_.applyToLocalView(b,C),a.set(v,C);const I=(l.get(_.batchId)||Nr()).add(v);l=l.insert(_.batchId,I)})}).next(()=>{const f=[],_=l.getReverseIterator();for(;_.hasNext();){const v=_.getNext(),b=v.key,C=v.value,I=Pie();C.forEach(O=>{if(!d.has(O)){const L=Mie(i.get(O),a.get(O));L!==null&&I.set(O,L),d=d.add(O)}}),f.push(this.documentOverlayCache.saveOverlays(t,b,I))}return Pt.waitFor(f)}).next(()=>a)}recalculateAndSaveOverlaysForDocumentKeys(t,i){return this.remoteDocumentCache.getEntries(t,i).next(a=>this.recalculateAndSaveOverlays(t,a))}getDocumentsMatchingQuery(t,i,a,l){return function(f){return Pn.isDocumentKey(f.path)&&f.collectionGroup===null&&f.filters.length===0}(i)?this.getDocumentsMatchingDocumentQuery(t,i.path):wie(i)?this.getDocumentsMatchingCollectionGroupQuery(t,i,a,l):this.getDocumentsMatchingCollectionQuery(t,i,a,l)}getNextDocuments(t,i,a,l){return this.remoteDocumentCache.getAllFromCollectionGroup(t,i,a,l).next(d=>{const f=l-d.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,i,a.largestBatchId,l-d.size):Pt.resolve(wy());let _=FC,v=d;return f.next(b=>Pt.forEach(b,(C,I)=>(_<I.largestBatchId&&(_=I.largestBatchId),d.get(C)?Pt.resolve():this.remoteDocumentCache.getEntry(t,C).next(O=>{v=v.insert(C,O)}))).next(()=>this.populateOverlays(t,b,d)).next(()=>this.computeViews(t,v,b,Nr())).next(C=>({batchId:_,changes:Aie(C)})))})}getDocumentsMatchingDocumentQuery(t,i){return this.getDocument(t,new Pn(i)).next(a=>{let l=Gw();return a.isFoundDocument()&&(l=l.insert(a.key,a)),l})}getDocumentsMatchingCollectionGroupQuery(t,i,a,l){const d=i.collectionGroup;let f=Gw();return this.indexManager.getCollectionParents(t,d).next(_=>Pt.forEach(_,v=>{const b=function(I,O){return new hR(O,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)}(i,v.child(d));return this.getDocumentsMatchingCollectionQuery(t,b,a,l).next(C=>{C.forEach((I,O)=>{f=f.insert(I,O)})})}).next(()=>f))}getDocumentsMatchingCollectionQuery(t,i,a,l){let d;return this.documentOverlayCache.getOverlaysForCollection(t,i.path,a.largestBatchId).next(f=>(d=f,this.remoteDocumentCache.getDocumentsMatchingQuery(t,i,a,d,l))).next(f=>{d.forEach((v,b)=>{const C=b.getKey();f.get(C)===null&&(f=f.insert(C,ic.newInvalidDocument(C)))});let _=Gw();return f.forEach((v,b)=>{const C=d.get(v);C!==void 0&&pC(C.mutation,b,Hl.empty(),No.now()),q1(i,b)&&(_=_.insert(v,b))}),_})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v4e{constructor(t){this.serializer=t,this.dr=new Map,this.Ar=new Map}getBundleMetadata(t,i){return Pt.resolve(this.dr.get(i))}saveBundleMetadata(t,i){return this.dr.set(i.id,function(l){return{id:l.id,version:l.version,createTime:_p(l.createTime)}}(i)),Pt.resolve()}getNamedQuery(t,i){return Pt.resolve(this.Ar.get(i))}saveNamedQuery(t,i){return this.Ar.set(i.name,function(l){return{name:l.name,query:l4e(l.bundledQuery),readTime:_p(l.readTime)}}(i)),Pt.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S4e{constructor(){this.overlays=new _s(Pn.comparator),this.Rr=new Map}getOverlay(t,i){return Pt.resolve(this.overlays.get(i))}getOverlays(t,i){const a=wy();return Pt.forEach(i,l=>this.getOverlay(t,l).next(d=>{d!==null&&a.set(l,d)})).next(()=>a)}saveOverlays(t,i,a){return a.forEach((l,d)=>{this.Et(t,i,d)}),Pt.resolve()}removeOverlaysForBatchId(t,i,a){const l=this.Rr.get(a);return l!==void 0&&(l.forEach(d=>this.overlays=this.overlays.remove(d)),this.Rr.delete(a)),Pt.resolve()}getOverlaysForCollection(t,i,a){const l=wy(),d=i.length+1,f=new Pn(i.child("")),_=this.overlays.getIteratorFrom(f);for(;_.hasNext();){const v=_.getNext().value,b=v.getKey();if(!i.isPrefixOf(b.path))break;b.path.length===d&&v.largestBatchId>a&&l.set(v.getKey(),v)}return Pt.resolve(l)}getOverlaysForCollectionGroup(t,i,a,l){let d=new _s((b,C)=>b-C);const f=this.overlays.getIterator();for(;f.hasNext();){const b=f.getNext().value;if(b.getKey().getCollectionGroup()===i&&b.largestBatchId>a){let C=d.get(b.largestBatchId);C===null&&(C=wy(),d=d.insert(b.largestBatchId,C)),C.set(b.getKey(),b)}}const _=wy(),v=d.getIterator();for(;v.hasNext()&&(v.getNext().value.forEach((b,C)=>_.set(b,C)),!(_.size()>=l)););return Pt.resolve(_)}Et(t,i,a){const l=this.overlays.get(a.key);if(l!==null){const f=this.Rr.get(l.largestBatchId).delete(a.key);this.Rr.set(l.largestBatchId,f)}this.overlays=this.overlays.insert(a.key,new F3e(i,a));let d=this.Rr.get(i);d===void 0&&(d=Nr(),this.Rr.set(i,d)),this.Rr.set(i,d.add(a.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b4e{constructor(){this.sessionToken=Oa.EMPTY_BYTE_STRING}getSessionToken(t){return Pt.resolve(this.sessionToken)}setSessionToken(t,i){return this.sessionToken=i,Pt.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u3{constructor(){this.Vr=new Do(Jo.mr),this.gr=new Do(Jo.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(t,i){const a=new Jo(t,i);this.Vr=this.Vr.add(a),this.gr=this.gr.add(a)}yr(t,i){t.forEach(a=>this.addReference(a,i))}removeReference(t,i){this.wr(new Jo(t,i))}Sr(t,i){t.forEach(a=>this.removeReference(a,i))}br(t){const i=new Pn(new ns([])),a=new Jo(i,t),l=new Jo(i,t+1),d=[];return this.gr.forEachInRange([a,l],f=>{this.wr(f),d.push(f.key)}),d}Dr(){this.Vr.forEach(t=>this.wr(t))}wr(t){this.Vr=this.Vr.delete(t),this.gr=this.gr.delete(t)}vr(t){const i=new Pn(new ns([])),a=new Jo(i,t),l=new Jo(i,t+1);let d=Nr();return this.gr.forEachInRange([a,l],f=>{d=d.add(f.key)}),d}containsKey(t){const i=new Jo(t,0),a=this.Vr.firstAfterOrEqual(i);return a!==null&&t.isEqual(a.key)}}class Jo{constructor(t,i){this.key=t,this.Cr=i}static mr(t,i){return Pn.comparator(t.key,i.key)||Er(t.Cr,i.Cr)}static pr(t,i){return Er(t.Cr,i.Cr)||Pn.comparator(t.key,i.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class T4e{constructor(t,i){this.indexManager=t,this.referenceDelegate=i,this.mutationQueue=[],this.Fr=1,this.Mr=new Do(Jo.mr)}checkEmpty(t){return Pt.resolve(this.mutationQueue.length===0)}addMutationBatch(t,i,a,l){const d=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const f=new j3e(d,i,a,l);this.mutationQueue.push(f);for(const _ of l)this.Mr=this.Mr.add(new Jo(_.key,d)),this.indexManager.addToCollectionParentIndex(t,_.key.path.popLast());return Pt.resolve(f)}lookupMutationBatch(t,i){return Pt.resolve(this.Or(i))}getNextMutationBatchAfterBatchId(t,i){const a=i+1,l=this.Nr(a),d=l<0?0:l;return Pt.resolve(this.mutationQueue.length>d?this.mutationQueue[d]:null)}getHighestUnacknowledgedBatchId(){return Pt.resolve(this.mutationQueue.length===0?ZF:this.Fr-1)}getAllMutationBatches(t){return Pt.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,i){const a=new Jo(i,0),l=new Jo(i,Number.POSITIVE_INFINITY),d=[];return this.Mr.forEachInRange([a,l],f=>{const _=this.Or(f.Cr);d.push(_)}),Pt.resolve(d)}getAllMutationBatchesAffectingDocumentKeys(t,i){let a=new Do(Er);return i.forEach(l=>{const d=new Jo(l,0),f=new Jo(l,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([d,f],_=>{a=a.add(_.Cr)})}),Pt.resolve(this.Br(a))}getAllMutationBatchesAffectingQuery(t,i){const a=i.path,l=a.length+1;let d=a;Pn.isDocumentKey(d)||(d=d.child(""));const f=new Jo(new Pn(d),0);let _=new Do(Er);return this.Mr.forEachWhile(v=>{const b=v.key.path;return!!a.isPrefixOf(b)&&(b.length===l&&(_=_.add(v.Cr)),!0)},f),Pt.resolve(this.Br(_))}Br(t){const i=[];return t.forEach(a=>{const l=this.Or(a);l!==null&&i.push(l)}),i}removeMutationBatch(t,i){fi(this.Lr(i.batchId,"removed")===0),this.mutationQueue.shift();let a=this.Mr;return Pt.forEach(i.mutations,l=>{const d=new Jo(l.key,i.batchId);return a=a.delete(d),this.referenceDelegate.markPotentiallyOrphaned(t,l.key)}).next(()=>{this.Mr=a})}qn(t){}containsKey(t,i){const a=new Jo(i,0),l=this.Mr.firstAfterOrEqual(a);return Pt.resolve(i.isEqual(l&&l.key))}performConsistencyCheck(t){return this.mutationQueue.length,Pt.resolve()}Lr(t,i){return this.Nr(t)}Nr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Or(t){const i=this.Nr(t);return i<0||i>=this.mutationQueue.length?null:this.mutationQueue[i]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w4e{constructor(t){this.kr=t,this.docs=function(){return new _s(Pn.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,i){const a=i.key,l=this.docs.get(a),d=l?l.size:0,f=this.kr(i);return this.docs=this.docs.insert(a,{document:i.mutableCopy(),size:f}),this.size+=f-d,this.indexManager.addToCollectionParentIndex(t,a.path.popLast())}removeEntry(t){const i=this.docs.get(t);i&&(this.docs=this.docs.remove(t),this.size-=i.size)}getEntry(t,i){const a=this.docs.get(i);return Pt.resolve(a?a.document.mutableCopy():ic.newInvalidDocument(i))}getEntries(t,i){let a=Xf();return i.forEach(l=>{const d=this.docs.get(l);a=a.insert(l,d?d.document.mutableCopy():ic.newInvalidDocument(l))}),Pt.resolve(a)}getDocumentsMatchingQuery(t,i,a,l){let d=Xf();const f=i.path,_=new Pn(f.child("__id-9223372036854775808__")),v=this.docs.getIteratorFrom(_);for(;v.hasNext();){const{key:b,value:{document:C}}=v.getNext();if(!f.isPrefixOf(b.path))break;b.path.length>f.length+1||e3e(ZFe(C),a)<=0||(l.has(C.key)||q1(i,C))&&(d=d.insert(C.key,C.mutableCopy()))}return Pt.resolve(d)}getAllFromCollectionGroup(t,i,a,l){qn()}qr(t,i){return Pt.forEach(this.docs,a=>i(a))}newChangeBuffer(t){return new C4e(this)}getSize(t){return Pt.resolve(this.size)}}class C4e extends _4e{constructor(t){super(),this.Ir=t}applyChanges(t){const i=[];return this.changes.forEach((a,l)=>{l.isValidDocument()?i.push(this.Ir.addEntry(t,l)):this.Ir.removeEntry(a)}),Pt.waitFor(i)}getFromCache(t,i){return this.Ir.getEntry(t,i)}getAllFromCache(t,i){return this.Ir.getEntries(t,i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R4e{constructor(t){this.persistence=t,this.Qr=new eE(i=>n3(i),r3),this.lastRemoteSnapshotVersion=Zn.min(),this.highestTargetId=0,this.$r=0,this.Ur=new u3,this.targetCount=0,this.Kr=k0.Un()}forEachTarget(t,i){return this.Qr.forEach((a,l)=>i(l)),Pt.resolve()}getLastRemoteSnapshotVersion(t){return Pt.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Pt.resolve(this.$r)}allocateTargetId(t){return this.highestTargetId=this.Kr.next(),Pt.resolve(this.highestTargetId)}setTargetsMetadata(t,i,a){return a&&(this.lastRemoteSnapshotVersion=a),i>this.$r&&(this.$r=i),Pt.resolve()}zn(t){this.Qr.set(t.target,t);const i=t.targetId;i>this.highestTargetId&&(this.Kr=new k0(i),this.highestTargetId=i),t.sequenceNumber>this.$r&&(this.$r=t.sequenceNumber)}addTargetData(t,i){return this.zn(i),this.targetCount+=1,Pt.resolve()}updateTargetData(t,i){return this.zn(i),Pt.resolve()}removeTargetData(t,i){return this.Qr.delete(i.target),this.Ur.br(i.targetId),this.targetCount-=1,Pt.resolve()}removeTargets(t,i,a){let l=0;const d=[];return this.Qr.forEach((f,_)=>{_.sequenceNumber<=i&&a.get(_.targetId)===null&&(this.Qr.delete(f),d.push(this.removeMatchingKeysForTargetId(t,_.targetId)),l++)}),Pt.waitFor(d).next(()=>l)}getTargetCount(t){return Pt.resolve(this.targetCount)}getTargetData(t,i){const a=this.Qr.get(i)||null;return Pt.resolve(a)}addMatchingKeys(t,i,a){return this.Ur.yr(i,a),Pt.resolve()}removeMatchingKeys(t,i,a){this.Ur.Sr(i,a);const l=this.persistence.referenceDelegate,d=[];return l&&i.forEach(f=>{d.push(l.markPotentiallyOrphaned(t,f))}),Pt.waitFor(d)}removeMatchingKeysForTargetId(t,i){return this.Ur.br(i),Pt.resolve()}getMatchingKeysForTargetId(t,i){const a=this.Ur.vr(i);return Pt.resolve(a)}containsKey(t,i){return Pt.resolve(this.Ur.containsKey(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yie{constructor(t,i){this.Wr={},this.overlays={},this.Gr=new G1(0),this.zr=!1,this.zr=!0,this.jr=new b4e,this.referenceDelegate=t(this),this.Hr=new R4e(this),this.indexManager=new u4e,this.remoteDocumentCache=function(l){return new w4e(l)}(a=>this.referenceDelegate.Jr(a)),this.serializer=new c4e(i),this.Yr=new v4e(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let i=this.overlays[t.toKey()];return i||(i=new S4e,this.overlays[t.toKey()]=i),i}getMutationQueue(t,i){let a=this.Wr[t.toKey()];return a||(a=new T4e(i,this.referenceDelegate),this.Wr[t.toKey()]=a),a}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(t,i,a){on("MemoryPersistence","Starting transaction:",t);const l=new I4e(this.Gr.next());return this.referenceDelegate.Zr(),a(l).next(d=>this.referenceDelegate.Xr(l).next(()=>d)).toPromise().then(d=>(l.raiseOnCommittedEvent(),d))}ei(t,i){return Pt.or(Object.values(this.Wr).map(a=>()=>a.containsKey(t,i)))}}class I4e extends n3e{constructor(t){super(),this.currentSequenceNumber=t}}class d3{constructor(t){this.persistence=t,this.ti=new u3,this.ni=null}static ri(t){return new d3(t)}get ii(){if(this.ni)return this.ni;throw qn()}addReference(t,i,a){return this.ti.addReference(a,i),this.ii.delete(a.toString()),Pt.resolve()}removeReference(t,i,a){return this.ti.removeReference(a,i),this.ii.add(a.toString()),Pt.resolve()}markPotentiallyOrphaned(t,i){return this.ii.add(i.toString()),Pt.resolve()}removeTarget(t,i){this.ti.br(i.targetId).forEach(l=>this.ii.add(l.toString()));const a=this.persistence.getTargetCache();return a.getMatchingKeysForTargetId(t,i.targetId).next(l=>{l.forEach(d=>this.ii.add(d.toString()))}).next(()=>a.removeTargetData(t,i))}Zr(){this.ni=new Set}Xr(t){const i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Pt.forEach(this.ii,a=>{const l=Pn.fromPath(a);return this.si(t,l).next(d=>{d||i.removeEntry(l,Zn.min())})}).next(()=>(this.ni=null,i.apply(t)))}updateLimboDocument(t,i){return this.si(t,i).next(a=>{a?this.ii.delete(i.toString()):this.ii.add(i.toString())})}Jr(t){return 0}si(t,i){return Pt.or([()=>Pt.resolve(this.ti.containsKey(i)),()=>this.persistence.getTargetCache().containsKey(t,i),()=>this.persistence.ei(t,i)])}}class Qk{constructor(t,i){this.persistence=t,this.oi=new eE(a=>s3e(a.path),(a,l)=>a.isEqual(l)),this.garbageCollector=g4e(this,i)}static ri(t,i){return new Qk(t,i)}Zr(){}Xr(t){return Pt.resolve()}forEachTarget(t,i){return this.persistence.getTargetCache().forEachTarget(t,i)}nr(t){const i=this.sr(t);return this.persistence.getTargetCache().getTargetCount(t).next(a=>i.next(l=>a+l))}sr(t){let i=0;return this.rr(t,a=>{i++}).next(()=>i)}rr(t,i){return Pt.forEach(this.oi,(a,l)=>this.ar(t,a,l).next(d=>d?Pt.resolve():i(l)))}removeTargets(t,i,a){return this.persistence.getTargetCache().removeTargets(t,i,a)}removeOrphanedDocuments(t,i){let a=0;const l=this.persistence.getRemoteDocumentCache(),d=l.newChangeBuffer();return l.qr(t,f=>this.ar(t,f,i).next(_=>{_||(a++,d.removeEntry(f,Zn.min()))})).next(()=>d.apply(t)).next(()=>a)}markPotentiallyOrphaned(t,i){return this.oi.set(i,t.currentSequenceNumber),Pt.resolve()}removeTarget(t,i){const a=i.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,a)}addReference(t,i,a){return this.oi.set(a,t.currentSequenceNumber),Pt.resolve()}removeReference(t,i,a){return this.oi.set(a,t.currentSequenceNumber),Pt.resolve()}updateLimboDocument(t,i){return this.oi.set(i,t.currentSequenceNumber),Pt.resolve()}Jr(t){let i=t.key.toString().length;return t.isFoundDocument()&&(i+=lk(t.data.value)),i}ar(t,i,a){return Pt.or([()=>this.persistence.ei(t,i),()=>this.persistence.getTargetCache().containsKey(t,i),()=>{const l=this.oi.get(i);return Pt.resolve(l!==void 0&&l>a)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h3{constructor(t,i,a,l){this.targetId=t,this.fromCache=i,this.Hi=a,this.Ji=l}static Yi(t,i){let a=Nr(),l=Nr();for(const d of i.docChanges)switch(d.type){case 0:a=a.add(d.doc.key);break;case 1:l=l.add(d.doc.key)}return new h3(t,i.fromCache,a,l)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A4e{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P4e{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return lUe()?8:r3e(oc())>0?6:4}()}initialize(t,i){this.ns=t,this.indexManager=i,this.Zi=!0}getDocumentsMatchingQuery(t,i,a,l){const d={result:null};return this.rs(t,i).next(f=>{d.result=f}).next(()=>{if(!d.result)return this.ss(t,i,l,a).next(f=>{d.result=f})}).next(()=>{if(d.result)return;const f=new A4e;return this._s(t,i,f).next(_=>{if(d.result=_,this.Xi)return this.us(t,i,f,_.size)})}).next(()=>d.result)}us(t,i,a,l){return a.documentReadCount<this.es?(PS()<=Or.DEBUG&&on("QueryEngine","SDK will not create cache indexes for query:",OS(i),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),Pt.resolve()):(PS()<=Or.DEBUG&&on("QueryEngine","Query:",OS(i),"scans",a.documentReadCount,"local documents and returns",l,"documents as results."),a.documentReadCount>this.ts*l?(PS()<=Or.DEBUG&&on("QueryEngine","The SDK decides to create cache indexes for query:",OS(i),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,gp(i))):Pt.resolve())}rs(t,i){if(KX(i))return Pt.resolve(null);let a=gp(i);return this.indexManager.getIndexType(t,a).next(l=>l===0?null:(i.limit!==null&&l===1&&(i=qk(i,null,"F"),a=gp(i)),this.indexManager.getDocumentsMatchingTarget(t,a).next(d=>{const f=Nr(...d);return this.ns.getDocuments(t,f).next(_=>this.indexManager.getMinOffset(t,a).next(v=>{const b=this.cs(i,_);return this.ls(i,b,f,v.readTime)?this.rs(t,qk(i,null,"F")):this.hs(t,b,i,v)}))})))}ss(t,i,a,l){return KX(i)||l.isEqual(Zn.min())?Pt.resolve(null):this.ns.getDocuments(t,a).next(d=>{const f=this.cs(i,d);return this.ls(i,f,a,l)?Pt.resolve(null):(PS()<=Or.DEBUG&&on("QueryEngine","Re-using previous result from %s to execute query: %s",l.toString(),OS(i)),this.hs(t,f,i,QFe(l,FC)).next(_=>_))})}cs(t,i){let a=new Do(Rie(t));return i.forEach((l,d)=>{q1(t,d)&&(a=a.add(d))}),a}ls(t,i,a,l){if(t.limit===null)return!1;if(a.size!==i.size)return!0;const d=t.limitType==="F"?i.last():i.first();return!!d&&(d.hasPendingWrites||d.version.compareTo(l)>0)}_s(t,i,a){return PS()<=Or.DEBUG&&on("QueryEngine","Using full collection scan to execute query:",OS(i)),this.ns.getDocumentsMatchingQuery(t,i,Dg.min(),a)}hs(t,i,a,l){return this.ns.getDocumentsMatchingQuery(t,a,l).next(d=>(i.forEach(f=>{d=d.insert(f.key,f)}),d))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p3="LocalStore",O4e=3e8;class k4e{constructor(t,i,a,l){this.persistence=t,this.Ps=i,this.serializer=l,this.Ts=new _s(Er),this.Is=new eE(d=>n3(d),r3),this.Es=new Map,this.ds=t.getRemoteDocumentCache(),this.Hr=t.getTargetCache(),this.Yr=t.getBundleCache(),this.As(a)}As(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new E4e(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",i=>t.collect(i,this.Ts))}}function N4e(n,t,i,a){return new k4e(n,t,i,a)}async function Xie(n,t){const i=rr(n);return await i.persistence.runTransaction("Handle user change","readonly",a=>{let l;return i.mutationQueue.getAllMutationBatches(a).next(d=>(l=d,i.As(t),i.mutationQueue.getAllMutationBatches(a))).next(d=>{const f=[],_=[];let v=Nr();for(const b of l){f.push(b.batchId);for(const C of b.mutations)v=v.add(C.key)}for(const b of d){_.push(b.batchId);for(const C of b.mutations)v=v.add(C.key)}return i.localDocuments.getDocuments(a,v).next(b=>({Rs:b,removedBatchIds:f,addedBatchIds:_}))})})}function D4e(n,t){const i=rr(n);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",a=>{const l=t.batch.keys(),d=i.ds.newChangeBuffer({trackRemovals:!0});return function(_,v,b,C){const I=b.batch,O=I.keys();let L=Pt.resolve();return O.forEach(M=>{L=L.next(()=>C.getEntry(v,M)).next(F=>{const z=b.docVersions.get(M);fi(z!==null),F.version.compareTo(z)<0&&(I.applyToRemoteDocument(F,b),F.isValidDocument()&&(F.setReadTime(b.commitVersion),C.addEntry(F)))})}),L.next(()=>_.mutationQueue.removeMutationBatch(v,I))}(i,a,t,d).next(()=>d.apply(a)).next(()=>i.mutationQueue.performConsistencyCheck(a)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(a,l,t.batch.batchId)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(a,function(_){let v=Nr();for(let b=0;b<_.mutationResults.length;++b)_.mutationResults[b].transformResults.length>0&&(v=v.add(_.batch.mutations[b].key));return v}(t))).next(()=>i.localDocuments.getDocuments(a,l))})}function Jie(n){const t=rr(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",i=>t.Hr.getLastRemoteSnapshotVersion(i))}function x4e(n,t){const i=rr(n),a=t.snapshotVersion;let l=i.Ts;return i.persistence.runTransaction("Apply remote event","readwrite-primary",d=>{const f=i.ds.newChangeBuffer({trackRemovals:!0});l=i.Ts;const _=[];t.targetChanges.forEach((C,I)=>{const O=l.get(I);if(!O)return;_.push(i.Hr.removeMatchingKeys(d,C.removedDocuments,I).next(()=>i.Hr.addMatchingKeys(d,C.addedDocuments,I)));let L=O.withSequenceNumber(d.currentSequenceNumber);t.targetMismatches.get(I)!==null?L=L.withResumeToken(Oa.EMPTY_BYTE_STRING,Zn.min()).withLastLimboFreeSnapshotVersion(Zn.min()):C.resumeToken.approximateByteSize()>0&&(L=L.withResumeToken(C.resumeToken,a)),l=l.insert(I,L),function(F,z,Z){return F.resumeToken.approximateByteSize()===0||z.snapshotVersion.toMicroseconds()-F.snapshotVersion.toMicroseconds()>=O4e?!0:Z.addedDocuments.size+Z.modifiedDocuments.size+Z.removedDocuments.size>0}(O,L,C)&&_.push(i.Hr.updateTargetData(d,L))});let v=Xf(),b=Nr();if(t.documentUpdates.forEach(C=>{t.resolvedLimboDocuments.has(C)&&_.push(i.persistence.referenceDelegate.updateLimboDocument(d,C))}),_.push(L4e(d,f,t.documentUpdates).next(C=>{v=C.Vs,b=C.fs})),!a.isEqual(Zn.min())){const C=i.Hr.getLastRemoteSnapshotVersion(d).next(I=>i.Hr.setTargetsMetadata(d,d.currentSequenceNumber,a));_.push(C)}return Pt.waitFor(_).next(()=>f.apply(d)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,v,b)).next(()=>v)}).then(d=>(i.Ts=l,d))}function L4e(n,t,i){let a=Nr(),l=Nr();return i.forEach(d=>a=a.add(d)),t.getEntries(n,a).next(d=>{let f=Xf();return i.forEach((_,v)=>{const b=d.get(_);v.isFoundDocument()!==b.isFoundDocument()&&(l=l.add(_)),v.isNoDocument()&&v.version.isEqual(Zn.min())?(t.removeEntry(_,v.readTime),f=f.insert(_,v)):!b.isValidDocument()||v.version.compareTo(b.version)>0||v.version.compareTo(b.version)===0&&b.hasPendingWrites?(t.addEntry(v),f=f.insert(_,v)):on(p3,"Ignoring outdated watch update for ",_,". Current version:",b.version," Watch version:",v.version)}),{Vs:f,fs:l}})}function M4e(n,t){const i=rr(n);return i.persistence.runTransaction("Get next mutation batch","readonly",a=>(t===void 0&&(t=ZF),i.mutationQueue.getNextMutationBatchAfterBatchId(a,t)))}function U4e(n,t){const i=rr(n);return i.persistence.runTransaction("Allocate target","readwrite",a=>{let l;return i.Hr.getTargetData(a,t).next(d=>d?(l=d,Pt.resolve(l)):i.Hr.allocateTargetId(a).next(f=>(l=new Tg(t,f,"TargetPurposeListen",a.currentSequenceNumber),i.Hr.addTargetData(a,l).next(()=>l))))}).then(a=>{const l=i.Ts.get(a.targetId);return(l===null||a.snapshotVersion.compareTo(l.snapshotVersion)>0)&&(i.Ts=i.Ts.insert(a.targetId,a),i.Is.set(t,a.targetId)),a})}async function LV(n,t,i){const a=rr(n),l=a.Ts.get(t),d=i?"readwrite":"readwrite-primary";try{i||await a.persistence.runTransaction("Release target",d,f=>a.persistence.referenceDelegate.removeTarget(f,l))}catch(f){if(!$0(f))throw f;on(p3,`Failed to update sequence numbers for target ${t}: ${f}`)}a.Ts=a.Ts.remove(t),a.Is.delete(l.target)}function oJ(n,t,i){const a=rr(n);let l=Zn.min(),d=Nr();return a.persistence.runTransaction("Execute query","readwrite",f=>function(v,b,C){const I=rr(v),O=I.Is.get(C);return O!==void 0?Pt.resolve(I.Ts.get(O)):I.Hr.getTargetData(b,C)}(a,f,gp(t)).next(_=>{if(_)return l=_.lastLimboFreeSnapshotVersion,a.Hr.getMatchingKeysForTargetId(f,_.targetId).next(v=>{d=v})}).next(()=>a.Ps.getDocumentsMatchingQuery(f,t,i?l:Zn.min(),i?d:Nr())).next(_=>(V4e(a,w3e(t),_),{documents:_,gs:d})))}function V4e(n,t,i){let a=n.Es.get(t)||Zn.min();i.forEach((l,d)=>{d.readTime.compareTo(a)>0&&(a=d.readTime)}),n.Es.set(t,a)}class aJ{constructor(){this.activeTargetIds=O3e()}Ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}vs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}bs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class j4e{constructor(){this.ho=new aJ,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,i,a){}addLocalQueryTarget(t,i=!0){return i&&this.ho.Ds(t),this.Po[t]||"not-current"}updateQueryState(t,i,a){this.Po[t]=i}removeLocalQueryTarget(t){this.ho.vs(t)}isLocalQueryTarget(t){return this.ho.activeTargetIds.has(t)}clearQueryState(t){delete this.Po[t]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(t){return this.ho.activeTargetIds.has(t)}start(){return this.ho=new aJ,Promise.resolve()}handleUserChange(t,i,a){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F4e{To(t){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cJ="ConnectivityMonitor";class lJ{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(t){this.Vo.push(t)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){on(cJ,"Network connectivity changed: AVAILABLE");for(const t of this.Vo)t(0)}Ro(){on(cJ,"Network connectivity changed: UNAVAILABLE");for(const t of this.Vo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kO=null;function MV(){return kO===null?kO=function(){return 268435456+Math.round(2147483648*Math.random())}():kO++,"0x"+kO.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iU="RestConnection",B4e={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class z4e{get fo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const i=t.ssl?"https":"http",a=encodeURIComponent(this.databaseId.projectId),l=encodeURIComponent(this.databaseId.database);this.po=i+"://"+t.host,this.yo=`projects/${a}/databases/${l}`,this.wo=this.databaseId.database===Gk?`project_id=${a}`:`project_id=${a}&database_id=${l}`}So(t,i,a,l,d){const f=MV(),_=this.bo(t,i.toUriEncodedString());on(iU,`Sending RPC '${t}' ${f}:`,_,a);const v={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(v,l,d),this.vo(t,_,v,a).then(b=>(on(iU,`Received RPC '${t}' ${f}: `,b),b),b=>{throw C0(iU,`RPC '${t}' ${f} failed with error: `,b,"url: ",_,"request:",a),b})}Co(t,i,a,l,d,f){return this.So(t,i,a,l,d)}Do(t,i,a){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+G0}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),i&&i.headers.forEach((l,d)=>t[d]=l),a&&a.headers.forEach((l,d)=>t[d]=l)}bo(t,i){const a=B4e[t];return`${this.po}/v1/${i}:${a}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W4e{constructor(t){this.Fo=t.Fo,this.Mo=t.Mo}xo(t){this.Oo=t}No(t){this.Bo=t}Lo(t){this.ko=t}onMessage(t){this.qo=t}close(){this.Mo()}send(t){this.Fo(t)}Qo(){this.Oo()}$o(){this.Bo()}Uo(t){this.ko(t)}Ko(t){this.qo(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ec="WebChannelConnection";class G4e extends z4e{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}vo(t,i,a,l){const d=MV();return new Promise((f,_)=>{const v=new eie;v.setWithCredentials(!0),v.listenOnce(tie.COMPLETE,()=>{try{switch(v.getLastErrorCode()){case ck.NO_ERROR:const C=v.getResponseJson();on(ec,`XHR for RPC '${t}' ${d} received:`,JSON.stringify(C)),f(C);break;case ck.TIMEOUT:on(ec,`RPC '${t}' ${d} timed out`),_(new dn(Ot.DEADLINE_EXCEEDED,"Request time out"));break;case ck.HTTP_ERROR:const I=v.getStatus();if(on(ec,`RPC '${t}' ${d} failed with status:`,I,"response text:",v.getResponseText()),I>0){let O=v.getResponseJson();Array.isArray(O)&&(O=O[0]);const L=O==null?void 0:O.error;if(L&&L.status&&L.message){const M=function(z){const Z=z.toLowerCase().replace(/_/g,"-");return Object.values(Ot).indexOf(Z)>=0?Z:Ot.UNKNOWN}(L.status);_(new dn(M,L.message))}else _(new dn(Ot.UNKNOWN,"Server responded with status "+v.getStatus()))}else _(new dn(Ot.UNAVAILABLE,"Connection failed."));break;default:qn()}}finally{on(ec,`RPC '${t}' ${d} completed.`)}});const b=JSON.stringify(l);on(ec,`RPC '${t}' ${d} sending request:`,l),v.send(i,"POST",b,a,15)})}Wo(t,i,a){const l=MV(),d=[this.po,"/","google.firestore.v1.Firestore","/",t,"/channel"],f=iie(),_=rie(),v={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},b=this.longPollingOptions.timeoutSeconds;b!==void 0&&(v.longPollingTimeout=Math.round(1e3*b)),this.useFetchStreams&&(v.useFetchStreams=!0),this.Do(v.initMessageHeaders,i,a),v.encodeInitMessageHeaders=!0;const C=d.join("");on(ec,`Creating RPC '${t}' stream ${l}: ${C}`,v);const I=f.createWebChannel(C,v);let O=!1,L=!1;const M=new W4e({Fo:z=>{L?on(ec,`Not sending because RPC '${t}' stream ${l} is closed:`,z):(O||(on(ec,`Opening RPC '${t}' stream ${l} transport.`),I.open(),O=!0),on(ec,`RPC '${t}' stream ${l} sending:`,z),I.send(z))},Mo:()=>I.close()}),F=(z,Z,K)=>{z.listen(Z,re=>{try{K(re)}catch(ae){setTimeout(()=>{throw ae},0)}})};return F(I,Ww.EventType.OPEN,()=>{L||(on(ec,`RPC '${t}' stream ${l} transport opened.`),M.Qo())}),F(I,Ww.EventType.CLOSE,()=>{L||(L=!0,on(ec,`RPC '${t}' stream ${l} transport closed`),M.Uo())}),F(I,Ww.EventType.ERROR,z=>{L||(L=!0,C0(ec,`RPC '${t}' stream ${l} transport errored:`,z),M.Uo(new dn(Ot.UNAVAILABLE,"The operation could not be completed")))}),F(I,Ww.EventType.MESSAGE,z=>{var Z;if(!L){const K=z.data[0];fi(!!K);const re=K,ae=(re==null?void 0:re.error)||((Z=re[0])===null||Z===void 0?void 0:Z.error);if(ae){on(ec,`RPC '${t}' stream ${l} received error:`,ae);const ne=ae.status;let pe=function(Q){const se=uo[Q];if(se!==void 0)return Vie(se)}(ne),X=ae.message;pe===void 0&&(pe=Ot.INTERNAL,X="Unknown error status: "+ne+" with message "+ae.message),L=!0,M.Uo(new dn(pe,X)),I.close()}else on(ec,`RPC '${t}' stream ${l} received:`,K),M.Ko(K)}}),F(_,nie.STAT_EVENT,z=>{z.stat===wV.PROXY?on(ec,`RPC '${t}' stream ${l} detected buffering proxy`):z.stat===wV.NOPROXY&&on(ec,`RPC '${t}' stream ${l} detected no buffering proxy`)}),setTimeout(()=>{M.$o()},0),M}}function sU(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q1(n){return new q3e(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qie{constructor(t,i,a=1e3,l=1.5,d=6e4){this.Ti=t,this.timerId=i,this.Go=a,this.zo=l,this.jo=d,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(t){this.cancel();const i=Math.floor(this.Ho+this.e_()),a=Math.max(0,Date.now()-this.Yo),l=Math.max(0,i-a);l>0&&on("ExponentialBackoff",`Backing off for ${l} ms (base delay: ${this.Ho} ms, delay with jitter: ${i} ms, last attempt: ${a} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,l,()=>(this.Yo=Date.now(),t())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uJ="PersistentStream";class Zie{constructor(t,i,a,l,d,f,_,v){this.Ti=t,this.n_=a,this.r_=l,this.connection=d,this.authCredentialsProvider=f,this.appCheckCredentialsProvider=_,this.listener=v,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new Qie(t,i)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(t){this.E_(),this.stream.send(t)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(t,i){this.E_(),this.d_(),this.a_.cancel(),this.i_++,t!==4?this.a_.reset():i&&i.code===Ot.RESOURCE_EXHAUSTED?(Yf(i.toString()),Yf("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):i&&i.code===Ot.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Lo(i)}A_(){}auth(){this.state=1;const t=this.R_(this.i_),i=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([a,l])=>{this.i_===i&&this.V_(a,l)},a=>{t(()=>{const l=new dn(Ot.UNKNOWN,"Fetching auth token failed: "+a.message);return this.m_(l)})})}V_(t,i){const a=this.R_(this.i_);this.stream=this.f_(t,i),this.stream.xo(()=>{a(()=>this.listener.xo())}),this.stream.No(()=>{a(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(l=>{a(()=>this.m_(l))}),this.stream.onMessage(l=>{a(()=>++this.__==1?this.g_(l):this.onNext(l))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(t){return on(uJ,`close with error: ${t}`),this.stream=null,this.close(4,t)}R_(t){return i=>{this.Ti.enqueueAndForget(()=>this.i_===t?i():(on(uJ,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class H4e extends Zie{constructor(t,i,a,l,d,f){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,a,l,f),this.serializer=d}f_(t,i){return this.connection.Wo("Listen",t,i)}g_(t){return this.onNext(t)}onNext(t){this.a_.reset();const i=J3e(this.serializer,t),a=function(d){if(!("targetChange"in d))return Zn.min();const f=d.targetChange;return f.targetIds&&f.targetIds.length?Zn.min():f.readTime?_p(f.readTime):Zn.min()}(t);return this.listener.p_(i,a)}y_(t){const i={};i.database=xV(this.serializer),i.addTarget=function(d,f){let _;const v=f.target;if(_=PV(v)?{documents:e4e(d,v)}:{query:t4e(d,v).ht},_.targetId=f.targetId,f.resumeToken.approximateByteSize()>0){_.resumeToken=Bie(d,f.resumeToken);const b=kV(d,f.expectedCount);b!==null&&(_.expectedCount=b)}else if(f.snapshotVersion.compareTo(Zn.min())>0){_.readTime=Jk(d,f.snapshotVersion.toTimestamp());const b=kV(d,f.expectedCount);b!==null&&(_.expectedCount=b)}return _}(this.serializer,t);const a=r4e(this.serializer,t);a&&(i.labels=a),this.I_(i)}w_(t){const i={};i.database=xV(this.serializer),i.removeTarget=t,this.I_(i)}}class $4e extends Zie{constructor(t,i,a,l,d,f){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,a,l,f),this.serializer=d}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(t,i){return this.connection.Wo("Write",t,i)}g_(t){return fi(!!t.streamToken),this.lastStreamToken=t.streamToken,fi(!t.writeResults||t.writeResults.length===0),this.listener.D_()}onNext(t){fi(!!t.streamToken),this.lastStreamToken=t.streamToken,this.a_.reset();const i=Z3e(t.writeResults,t.commitTime),a=_p(t.commitTime);return this.listener.v_(a,i)}C_(){const t={};t.database=xV(this.serializer),this.I_(t)}b_(t){const i={streamToken:this.lastStreamToken,writes:t.map(a=>Q3e(this.serializer,a))};this.I_(i)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K4e{}class q4e extends K4e{constructor(t,i,a,l){super(),this.authCredentials=t,this.appCheckCredentials=i,this.connection=a,this.serializer=l,this.F_=!1}M_(){if(this.F_)throw new dn(Ot.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,i,a,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,f])=>this.connection.So(t,NV(i,a),l,d,f)).catch(d=>{throw d.name==="FirebaseError"?(d.code===Ot.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new dn(Ot.UNKNOWN,d.toString())})}Co(t,i,a,l,d){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([f,_])=>this.connection.Co(t,NV(i,a),l,f,_,d)).catch(f=>{throw f.name==="FirebaseError"?(f.code===Ot.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),f):new dn(Ot.UNKNOWN,f.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class Y4e{constructor(t,i){this.asyncQueue=t,this.onlineStateHandler=i,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(t){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.L_("Offline")))}set(t){this.Q_(),this.x_=0,t==="Online"&&(this.N_=!1),this.L_(t)}L_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}k_(t){const i=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Yf(i),this.N_=!1):on("OnlineStateTracker",i)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yy="RemoteStore";class X4e{constructor(t,i,a,l,d){this.localStore=t,this.datastore=i,this.asyncQueue=a,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=d,this.z_.To(f=>{a.enqueueAndForget(async()=>{tE(this)&&(on(Yy,"Restarting streams for network reachability change."),await async function(v){const b=rr(v);b.W_.add(4),await mR(b),b.j_.set("Unknown"),b.W_.delete(4),await Z1(b)}(this))})}),this.j_=new Y4e(a,l)}}async function Z1(n){if(tE(n))for(const t of n.G_)await t(!0)}async function mR(n){for(const t of n.G_)await t(!1)}function ese(n,t){const i=rr(n);i.K_.has(t.targetId)||(i.K_.set(t.targetId,t),_3(i)?g3(i):K0(i).c_()&&m3(i,t))}function f3(n,t){const i=rr(n),a=K0(i);i.K_.delete(t),a.c_()&&tse(i,t),i.K_.size===0&&(a.c_()?a.P_():tE(i)&&i.j_.set("Unknown"))}function m3(n,t){if(n.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Zn.min())>0){const i=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(i)}K0(n).y_(t)}function tse(n,t){n.H_.Ne(t),K0(n).w_(t)}function g3(n){n.H_=new G3e({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>n.K_.get(t)||null,it:()=>n.datastore.serializer.databaseId}),K0(n).start(),n.j_.B_()}function _3(n){return tE(n)&&!K0(n).u_()&&n.K_.size>0}function tE(n){return rr(n).W_.size===0}function nse(n){n.H_=void 0}async function J4e(n){n.j_.set("Online")}async function Q4e(n){n.K_.forEach((t,i)=>{m3(n,t)})}async function Z4e(n,t){nse(n),_3(n)?(n.j_.q_(t),g3(n)):n.j_.set("Unknown")}async function e5e(n,t,i){if(n.j_.set("Online"),t instanceof Fie&&t.state===2&&t.cause)try{await async function(l,d){const f=d.cause;for(const _ of d.targetIds)l.K_.has(_)&&(await l.remoteSyncer.rejectListen(_,f),l.K_.delete(_),l.H_.removeTarget(_))}(n,t)}catch(a){on(Yy,"Failed to remove targets %s: %s ",t.targetIds.join(","),a),await Zk(n,a)}else if(t instanceof hk?n.H_.We(t):t instanceof jie?n.H_.Ze(t):n.H_.je(t),!i.isEqual(Zn.min()))try{const a=await Jie(n.localStore);i.compareTo(a)>=0&&await function(d,f){const _=d.H_.ot(f);return _.targetChanges.forEach((v,b)=>{if(v.resumeToken.approximateByteSize()>0){const C=d.K_.get(b);C&&d.K_.set(b,C.withResumeToken(v.resumeToken,f))}}),_.targetMismatches.forEach((v,b)=>{const C=d.K_.get(v);if(!C)return;d.K_.set(v,C.withResumeToken(Oa.EMPTY_BYTE_STRING,C.snapshotVersion)),tse(d,v);const I=new Tg(C.target,v,b,C.sequenceNumber);m3(d,I)}),d.remoteSyncer.applyRemoteEvent(_)}(n,i)}catch(a){on(Yy,"Failed to raise snapshot:",a),await Zk(n,a)}}async function Zk(n,t,i){if(!$0(t))throw t;n.W_.add(1),await mR(n),n.j_.set("Offline"),i||(i=()=>Jie(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{on(Yy,"Retrying IndexedDB access"),await i(),n.W_.delete(1),await Z1(n)})}function rse(n,t){return t().catch(i=>Zk(n,i,t))}async function eN(n){const t=rr(n),i=Ug(t);let a=t.U_.length>0?t.U_[t.U_.length-1].batchId:ZF;for(;t5e(t);)try{const l=await M4e(t.localStore,a);if(l===null){t.U_.length===0&&i.P_();break}a=l.batchId,n5e(t,l)}catch(l){await Zk(t,l)}ise(t)&&sse(t)}function t5e(n){return tE(n)&&n.U_.length<10}function n5e(n,t){n.U_.push(t);const i=Ug(n);i.c_()&&i.S_&&i.b_(t.mutations)}function ise(n){return tE(n)&&!Ug(n).u_()&&n.U_.length>0}function sse(n){Ug(n).start()}async function r5e(n){Ug(n).C_()}async function i5e(n){const t=Ug(n);for(const i of n.U_)t.b_(i.mutations)}async function s5e(n,t,i){const a=n.U_.shift(),l=a3.from(a,t,i);await rse(n,()=>n.remoteSyncer.applySuccessfulWrite(l)),await eN(n)}async function o5e(n,t){t&&Ug(n).S_&&await async function(a,l){if(function(f){return z3e(f)&&f!==Ot.ABORTED}(l.code)){const d=a.U_.shift();Ug(a).h_(),await rse(a,()=>a.remoteSyncer.rejectFailedWrite(d.batchId,l)),await eN(a)}}(n,t),ise(n)&&sse(n)}async function dJ(n,t){const i=rr(n);i.asyncQueue.verifyOperationInProgress(),on(Yy,"RemoteStore received new credentials");const a=tE(i);i.W_.add(3),await mR(i),a&&i.j_.set("Unknown"),await i.remoteSyncer.handleCredentialChange(t),i.W_.delete(3),await Z1(i)}async function a5e(n,t){const i=rr(n);t?(i.W_.delete(2),await Z1(i)):t||(i.W_.add(2),await mR(i),i.j_.set("Unknown"))}function K0(n){return n.J_||(n.J_=function(i,a,l){const d=rr(i);return d.M_(),new H4e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:J4e.bind(null,n),No:Q4e.bind(null,n),Lo:Z4e.bind(null,n),p_:e5e.bind(null,n)}),n.G_.push(async t=>{t?(n.J_.h_(),_3(n)?g3(n):n.j_.set("Unknown")):(await n.J_.stop(),nse(n))})),n.J_}function Ug(n){return n.Y_||(n.Y_=function(i,a,l){const d=rr(i);return d.M_(),new $4e(a,d.connection,d.authCredentials,d.appCheckCredentials,d.serializer,l)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:r5e.bind(null,n),Lo:o5e.bind(null,n),D_:i5e.bind(null,n),v_:s5e.bind(null,n)}),n.G_.push(async t=>{t?(n.Y_.h_(),await eN(n)):(await n.Y_.stop(),n.U_.length>0&&(on(Yy,`Stopping write stream with ${n.U_.length} pending writes`),n.U_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y3{constructor(t,i,a,l,d){this.asyncQueue=t,this.timerId=i,this.targetTimeMs=a,this.op=l,this.removalCallback=d,this.deferred=new Bf,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(f=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,i,a,l,d){const f=Date.now()+a,_=new y3(t,i,f,l,d);return _.start(a),_}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new dn(Ot.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function E3(n,t){if(Yf("AsyncQueue",`${t}: ${n}`),$0(n))return new dn(Ot.UNAVAILABLE,`${t}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l0{static emptySet(t){return new l0(t.comparator)}constructor(t){this.comparator=t?(i,a)=>t(i,a)||Pn.comparator(i.key,a.key):(i,a)=>Pn.comparator(i.key,a.key),this.keyedMap=Gw(),this.sortedSet=new _s(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const i=this.keyedMap.get(t);return i?this.sortedSet.indexOf(i):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((i,a)=>(t(i),!1))}add(t){const i=this.delete(t.key);return i.copy(i.keyedMap.insert(t.key,t),i.sortedSet.insert(t,null))}delete(t){const i=this.get(t);return i?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(i)):this}isEqual(t){if(!(t instanceof l0)||this.size!==t.size)return!1;const i=this.sortedSet.getIterator(),a=t.sortedSet.getIterator();for(;i.hasNext();){const l=i.getNext().key,d=a.getNext().key;if(!l.isEqual(d))return!1}return!0}toString(){const t=[];return this.forEach(i=>{t.push(i.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,i){const a=new l0;return a.comparator=this.comparator,a.keyedMap=t,a.sortedSet=i,a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hJ{constructor(){this.Z_=new _s(Pn.comparator)}track(t){const i=t.doc.key,a=this.Z_.get(i);a?t.type!==0&&a.type===3?this.Z_=this.Z_.insert(i,t):t.type===3&&a.type!==1?this.Z_=this.Z_.insert(i,{type:a.type,doc:t.doc}):t.type===2&&a.type===2?this.Z_=this.Z_.insert(i,{type:2,doc:t.doc}):t.type===2&&a.type===0?this.Z_=this.Z_.insert(i,{type:0,doc:t.doc}):t.type===1&&a.type===0?this.Z_=this.Z_.remove(i):t.type===1&&a.type===2?this.Z_=this.Z_.insert(i,{type:1,doc:a.doc}):t.type===0&&a.type===1?this.Z_=this.Z_.insert(i,{type:2,doc:t.doc}):qn():this.Z_=this.Z_.insert(i,t)}X_(){const t=[];return this.Z_.inorderTraversal((i,a)=>{t.push(a)}),t}}class N0{constructor(t,i,a,l,d,f,_,v,b){this.query=t,this.docs=i,this.oldDocs=a,this.docChanges=l,this.mutatedKeys=d,this.fromCache=f,this.syncStateChanged=_,this.excludesMetadataChanges=v,this.hasCachedResults=b}static fromInitialDocuments(t,i,a,l,d){const f=[];return i.forEach(_=>{f.push({type:0,doc:_})}),new N0(t,i,l0.emptySet(i),f,a,l,!0,!1,d)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&K1(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const i=this.docChanges,a=t.docChanges;if(i.length!==a.length)return!1;for(let l=0;l<i.length;l++)if(i[l].type!==a[l].type||!i[l].doc.isEqual(a[l].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c5e{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(t=>t.ra())}}class l5e{constructor(){this.queries=pJ(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(i,a){const l=rr(i),d=l.queries;l.queries=pJ(),d.forEach((f,_)=>{for(const v of _.ta)v.onError(a)})})(this,new dn(Ot.ABORTED,"Firestore shutting down"))}}function pJ(){return new eE(n=>Cie(n),K1)}async function ose(n,t){const i=rr(n);let a=3;const l=t.query;let d=i.queries.get(l);d?!d.na()&&t.ra()&&(a=2):(d=new c5e,a=t.ra()?0:1);try{switch(a){case 0:d.ea=await i.onListen(l,!0);break;case 1:d.ea=await i.onListen(l,!1);break;case 2:await i.onFirstRemoteStoreListen(l)}}catch(f){const _=E3(f,`Initialization of query '${OS(t.query)}' failed`);return void t.onError(_)}i.queries.set(l,d),d.ta.push(t),t.sa(i.onlineState),d.ea&&t.oa(d.ea)&&v3(i)}async function ase(n,t){const i=rr(n),a=t.query;let l=3;const d=i.queries.get(a);if(d){const f=d.ta.indexOf(t);f>=0&&(d.ta.splice(f,1),d.ta.length===0?l=t.ra()?0:1:!d.na()&&t.ra()&&(l=2))}switch(l){case 0:return i.queries.delete(a),i.onUnlisten(a,!0);case 1:return i.queries.delete(a),i.onUnlisten(a,!1);case 2:return i.onLastRemoteStoreUnlisten(a);default:return}}function u5e(n,t){const i=rr(n);let a=!1;for(const l of t){const d=l.query,f=i.queries.get(d);if(f){for(const _ of f.ta)_.oa(l)&&(a=!0);f.ea=l}}a&&v3(i)}function d5e(n,t,i){const a=rr(n),l=a.queries.get(t);if(l)for(const d of l.ta)d.onError(i);a.queries.delete(t)}function v3(n){n.ia.forEach(t=>{t.next()})}var UV,fJ;(fJ=UV||(UV={}))._a="default",fJ.Cache="cache";class cse{constructor(t,i,a){this.query=t,this.aa=i,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=a||{}}oa(t){if(!this.options.includeMetadataChanges){const a=[];for(const l of t.docChanges)l.type!==3&&a.push(l);t=new N0(t.query,t.docs,t.oldDocs,a,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let i=!1;return this.ua?this.la(t)&&(this.aa.next(t),i=!0):this.ha(t,this.onlineState)&&(this.Pa(t),i=!0),this.ca=t,i}onError(t){this.aa.error(t)}sa(t){this.onlineState=t;let i=!1;return this.ca&&!this.ua&&this.ha(this.ca,t)&&(this.Pa(this.ca),i=!0),i}ha(t,i){if(!t.fromCache||!this.ra())return!0;const a=i!=="Offline";return(!this.options.Ta||!a)&&(!t.docs.isEmpty()||t.hasCachedResults||i==="Offline")}la(t){if(t.docChanges.length>0)return!0;const i=this.ca&&this.ca.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!i)&&this.options.includeMetadataChanges===!0}Pa(t){t=N0.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.ua=!0,this.aa.next(t)}ra(){return this.options.source!==UV.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lse{constructor(t){this.key=t}}class use{constructor(t){this.key=t}}class h5e{constructor(t,i){this.query=t,this.fa=i,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Nr(),this.mutatedKeys=Nr(),this.ya=Rie(t),this.wa=new l0(this.ya)}get Sa(){return this.fa}ba(t,i){const a=i?i.Da:new hJ,l=i?i.wa:this.wa;let d=i?i.mutatedKeys:this.mutatedKeys,f=l,_=!1;const v=this.query.limitType==="F"&&l.size===this.query.limit?l.last():null,b=this.query.limitType==="L"&&l.size===this.query.limit?l.first():null;if(t.inorderTraversal((C,I)=>{const O=l.get(C),L=q1(this.query,I)?I:null,M=!!O&&this.mutatedKeys.has(O.key),F=!!L&&(L.hasLocalMutations||this.mutatedKeys.has(L.key)&&L.hasCommittedMutations);let z=!1;O&&L?O.data.isEqual(L.data)?M!==F&&(a.track({type:3,doc:L}),z=!0):this.va(O,L)||(a.track({type:2,doc:L}),z=!0,(v&&this.ya(L,v)>0||b&&this.ya(L,b)<0)&&(_=!0)):!O&&L?(a.track({type:0,doc:L}),z=!0):O&&!L&&(a.track({type:1,doc:O}),z=!0,(v||b)&&(_=!0)),z&&(L?(f=f.add(L),d=F?d.add(C):d.delete(C)):(f=f.delete(C),d=d.delete(C)))}),this.query.limit!==null)for(;f.size>this.query.limit;){const C=this.query.limitType==="F"?f.last():f.first();f=f.delete(C.key),d=d.delete(C.key),a.track({type:1,doc:C})}return{wa:f,Da:a,ls:_,mutatedKeys:d}}va(t,i){return t.hasLocalMutations&&i.hasCommittedMutations&&!i.hasLocalMutations}applyChanges(t,i,a,l){const d=this.wa;this.wa=t.wa,this.mutatedKeys=t.mutatedKeys;const f=t.Da.X_();f.sort((C,I)=>function(L,M){const F=z=>{switch(z){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return qn()}};return F(L)-F(M)}(C.type,I.type)||this.ya(C.doc,I.doc)),this.Ca(a),l=l!=null&&l;const _=i&&!l?this.Fa():[],v=this.pa.size===0&&this.current&&!l?1:0,b=v!==this.ga;return this.ga=v,f.length!==0||b?{snapshot:new N0(this.query,t.wa,d,f,t.mutatedKeys,v===0,b,!1,!!a&&a.resumeToken.approximateByteSize()>0),Ma:_}:{Ma:_}}sa(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new hJ,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(t){return!this.fa.has(t)&&!!this.wa.has(t)&&!this.wa.get(t).hasLocalMutations}Ca(t){t&&(t.addedDocuments.forEach(i=>this.fa=this.fa.add(i)),t.modifiedDocuments.forEach(i=>{}),t.removedDocuments.forEach(i=>this.fa=this.fa.delete(i)),this.current=t.current)}Fa(){if(!this.current)return[];const t=this.pa;this.pa=Nr(),this.wa.forEach(a=>{this.xa(a.key)&&(this.pa=this.pa.add(a.key))});const i=[];return t.forEach(a=>{this.pa.has(a)||i.push(new use(a))}),this.pa.forEach(a=>{t.has(a)||i.push(new lse(a))}),i}Oa(t){this.fa=t.gs,this.pa=Nr();const i=this.ba(t.documents);return this.applyChanges(i,!0)}Na(){return N0.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const S3="SyncEngine";class p5e{constructor(t,i,a){this.query=t,this.targetId=i,this.view=a}}class f5e{constructor(t){this.key=t,this.Ba=!1}}class m5e{constructor(t,i,a,l,d,f){this.localStore=t,this.remoteStore=i,this.eventManager=a,this.sharedClientState=l,this.currentUser=d,this.maxConcurrentLimboResolutions=f,this.La={},this.ka=new eE(_=>Cie(_),K1),this.qa=new Map,this.Qa=new Set,this.$a=new _s(Pn.comparator),this.Ua=new Map,this.Ka=new u3,this.Wa={},this.Ga=new Map,this.za=k0.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function g5e(n,t,i=!0){const a=gse(n);let l;const d=a.ka.get(t);return d?(a.sharedClientState.addLocalQueryTarget(d.targetId),l=d.view.Na()):l=await dse(a,t,i,!0),l}async function _5e(n,t){const i=gse(n);await dse(i,t,!0,!1)}async function dse(n,t,i,a){const l=await U4e(n.localStore,gp(t)),d=l.targetId,f=n.sharedClientState.addLocalQueryTarget(d,i);let _;return a&&(_=await y5e(n,t,d,f==="current",l.resumeToken)),n.isPrimaryClient&&i&&ese(n.remoteStore,l),_}async function y5e(n,t,i,a,l){n.Ha=(I,O,L)=>async function(F,z,Z,K){let re=z.view.ba(Z);re.ls&&(re=await oJ(F.localStore,z.query,!1).then(({documents:X})=>z.view.ba(X,re)));const ae=K&&K.targetChanges.get(z.targetId),ne=K&&K.targetMismatches.get(z.targetId)!=null,pe=z.view.applyChanges(re,F.isPrimaryClient,ae,ne);return gJ(F,z.targetId,pe.Ma),pe.snapshot}(n,I,O,L);const d=await oJ(n.localStore,t,!0),f=new h5e(t,d.gs),_=f.ba(d.documents),v=fR.createSynthesizedTargetChangeForCurrentChange(i,a&&n.onlineState!=="Offline",l),b=f.applyChanges(_,n.isPrimaryClient,v);gJ(n,i,b.Ma);const C=new p5e(t,i,f);return n.ka.set(t,C),n.qa.has(i)?n.qa.get(i).push(t):n.qa.set(i,[t]),b.snapshot}async function E5e(n,t,i){const a=rr(n),l=a.ka.get(t),d=a.qa.get(l.targetId);if(d.length>1)return a.qa.set(l.targetId,d.filter(f=>!K1(f,t))),void a.ka.delete(t);a.isPrimaryClient?(a.sharedClientState.removeLocalQueryTarget(l.targetId),a.sharedClientState.isActiveQueryTarget(l.targetId)||await LV(a.localStore,l.targetId,!1).then(()=>{a.sharedClientState.clearQueryState(l.targetId),i&&f3(a.remoteStore,l.targetId),VV(a,l.targetId)}).catch(H0)):(VV(a,l.targetId),await LV(a.localStore,l.targetId,!0))}async function v5e(n,t){const i=rr(n),a=i.ka.get(t),l=i.qa.get(a.targetId);i.isPrimaryClient&&l.length===1&&(i.sharedClientState.removeLocalQueryTarget(a.targetId),f3(i.remoteStore,a.targetId))}async function S5e(n,t,i){const a=A5e(n);try{const l=await function(f,_){const v=rr(f),b=No.now(),C=_.reduce((L,M)=>L.add(M.key),Nr());let I,O;return v.persistence.runTransaction("Locally write mutations","readwrite",L=>{let M=Xf(),F=Nr();return v.ds.getEntries(L,C).next(z=>{M=z,M.forEach((Z,K)=>{K.isValidDocument()||(F=F.add(Z))})}).next(()=>v.localDocuments.getOverlayedDocuments(L,M)).next(z=>{I=z;const Z=[];for(const K of _){const re=U3e(K,I.get(K.key).overlayedDocument);re!=null&&Z.push(new $g(K.key,re,_ie(re.value.mapValue),Wu.exists(!0)))}return v.mutationQueue.addMutationBatch(L,b,Z,_)}).next(z=>{O=z;const Z=z.applyToLocalDocumentSet(I,F);return v.documentOverlayCache.saveOverlays(L,z.batchId,Z)})}).then(()=>({batchId:O.batchId,changes:Aie(I)}))}(a.localStore,t);a.sharedClientState.addPendingMutation(l.batchId),function(f,_,v){let b=f.Wa[f.currentUser.toKey()];b||(b=new _s(Er)),b=b.insert(_,v),f.Wa[f.currentUser.toKey()]=b}(a,l.batchId,i),await gR(a,l.changes),await eN(a.remoteStore)}catch(l){const d=E3(l,"Failed to persist write");i.reject(d)}}async function hse(n,t){const i=rr(n);try{const a=await x4e(i.localStore,t);t.targetChanges.forEach((l,d)=>{const f=i.Ua.get(d);f&&(fi(l.addedDocuments.size+l.modifiedDocuments.size+l.removedDocuments.size<=1),l.addedDocuments.size>0?f.Ba=!0:l.modifiedDocuments.size>0?fi(f.Ba):l.removedDocuments.size>0&&(fi(f.Ba),f.Ba=!1))}),await gR(i,a,t)}catch(a){await H0(a)}}function mJ(n,t,i){const a=rr(n);if(a.isPrimaryClient&&i===0||!a.isPrimaryClient&&i===1){const l=[];a.ka.forEach((d,f)=>{const _=f.view.sa(t);_.snapshot&&l.push(_.snapshot)}),function(f,_){const v=rr(f);v.onlineState=_;let b=!1;v.queries.forEach((C,I)=>{for(const O of I.ta)O.sa(_)&&(b=!0)}),b&&v3(v)}(a.eventManager,t),l.length&&a.La.p_(l),a.onlineState=t,a.isPrimaryClient&&a.sharedClientState.setOnlineState(t)}}async function b5e(n,t,i){const a=rr(n);a.sharedClientState.updateQueryState(t,"rejected",i);const l=a.Ua.get(t),d=l&&l.key;if(d){let f=new _s(Pn.comparator);f=f.insert(d,ic.newNoDocument(d,Zn.min()));const _=Nr().add(d),v=new J1(Zn.min(),new Map,new _s(Er),f,_);await hse(a,v),a.$a=a.$a.remove(d),a.Ua.delete(t),b3(a)}else await LV(a.localStore,t,!1).then(()=>VV(a,t,i)).catch(H0)}async function T5e(n,t){const i=rr(n),a=t.batch.batchId;try{const l=await D4e(i.localStore,t);fse(i,a,null),pse(i,a),i.sharedClientState.updateMutationState(a,"acknowledged"),await gR(i,l)}catch(l){await H0(l)}}async function w5e(n,t,i){const a=rr(n);try{const l=await function(f,_){const v=rr(f);return v.persistence.runTransaction("Reject batch","readwrite-primary",b=>{let C;return v.mutationQueue.lookupMutationBatch(b,_).next(I=>(fi(I!==null),C=I.keys(),v.mutationQueue.removeMutationBatch(b,I))).next(()=>v.mutationQueue.performConsistencyCheck(b)).next(()=>v.documentOverlayCache.removeOverlaysForBatchId(b,C,_)).next(()=>v.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(b,C)).next(()=>v.localDocuments.getDocuments(b,C))})}(a.localStore,t);fse(a,t,i),pse(a,t),a.sharedClientState.updateMutationState(t,"rejected",i),await gR(a,l)}catch(l){await H0(l)}}function pse(n,t){(n.Ga.get(t)||[]).forEach(i=>{i.resolve()}),n.Ga.delete(t)}function fse(n,t,i){const a=rr(n);let l=a.Wa[a.currentUser.toKey()];if(l){const d=l.get(t);d&&(i?d.reject(i):d.resolve(),l=l.remove(t)),a.Wa[a.currentUser.toKey()]=l}}function VV(n,t,i=null){n.sharedClientState.removeLocalQueryTarget(t);for(const a of n.qa.get(t))n.ka.delete(a),i&&n.La.Ja(a,i);n.qa.delete(t),n.isPrimaryClient&&n.Ka.br(t).forEach(a=>{n.Ka.containsKey(a)||mse(n,a)})}function mse(n,t){n.Qa.delete(t.path.canonicalString());const i=n.$a.get(t);i!==null&&(f3(n.remoteStore,i),n.$a=n.$a.remove(t),n.Ua.delete(i),b3(n))}function gJ(n,t,i){for(const a of i)a instanceof lse?(n.Ka.addReference(a.key,t),C5e(n,a)):a instanceof use?(on(S3,"Document no longer in limbo: "+a.key),n.Ka.removeReference(a.key,t),n.Ka.containsKey(a.key)||mse(n,a.key)):qn()}function C5e(n,t){const i=t.key,a=i.path.canonicalString();n.$a.get(i)||n.Qa.has(a)||(on(S3,"New document in limbo: "+i),n.Qa.add(a),b3(n))}function b3(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const t=n.Qa.values().next().value;n.Qa.delete(t);const i=new Pn(ns.fromString(t)),a=n.za.next();n.Ua.set(a,new f5e(i)),n.$a=n.$a.insert(i,a),ese(n.remoteStore,new Tg(gp(i3(i.path)),a,"TargetPurposeLimboResolution",G1.ae))}}async function gR(n,t,i){const a=rr(n),l=[],d=[],f=[];a.ka.isEmpty()||(a.ka.forEach((_,v)=>{f.push(a.Ha(v,t,i).then(b=>{var C;if((b||i)&&a.isPrimaryClient){const I=b?!b.fromCache:(C=i==null?void 0:i.targetChanges.get(v.targetId))===null||C===void 0?void 0:C.current;a.sharedClientState.updateQueryState(v.targetId,I?"current":"not-current")}if(b){l.push(b);const I=h3.Yi(v.targetId,b);d.push(I)}}))}),await Promise.all(f),a.La.p_(l),await async function(v,b){const C=rr(v);try{await C.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>Pt.forEach(b,O=>Pt.forEach(O.Hi,L=>C.persistence.referenceDelegate.addReference(I,O.targetId,L)).next(()=>Pt.forEach(O.Ji,L=>C.persistence.referenceDelegate.removeReference(I,O.targetId,L)))))}catch(I){if(!$0(I))throw I;on(p3,"Failed to update sequence numbers: "+I)}for(const I of b){const O=I.targetId;if(!I.fromCache){const L=C.Ts.get(O),M=L.snapshotVersion,F=L.withLastLimboFreeSnapshotVersion(M);C.Ts=C.Ts.insert(O,F)}}}(a.localStore,d))}async function R5e(n,t){const i=rr(n);if(!i.currentUser.isEqual(t)){on(S3,"User change. New user:",t.toKey());const a=await Xie(i.localStore,t);i.currentUser=t,function(d,f){d.Ga.forEach(_=>{_.forEach(v=>{v.reject(new dn(Ot.CANCELLED,f))})}),d.Ga.clear()}(i,"'waitForPendingWrites' promise is rejected due to a user change."),i.sharedClientState.handleUserChange(t,a.removedBatchIds,a.addedBatchIds),await gR(i,a.Rs)}}function I5e(n,t){const i=rr(n),a=i.Ua.get(t);if(a&&a.Ba)return Nr().add(a.key);{let l=Nr();const d=i.qa.get(t);if(!d)return l;for(const f of d){const _=i.ka.get(f);l=l.unionWith(_.view.Sa)}return l}}function gse(n){const t=rr(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=hse.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=I5e.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=b5e.bind(null,t),t.La.p_=u5e.bind(null,t.eventManager),t.La.Ja=d5e.bind(null,t.eventManager),t}function A5e(n){const t=rr(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=T5e.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=w5e.bind(null,t),t}class e1{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=Q1(t.databaseInfo.databaseId),this.sharedClientState=this.Za(t),this.persistence=this.Xa(t),await this.persistence.start(),this.localStore=this.eu(t),this.gcScheduler=this.tu(t,this.localStore),this.indexBackfillerScheduler=this.nu(t,this.localStore)}tu(t,i){return null}nu(t,i){return null}eu(t){return N4e(this.persistence,new P4e,t.initialUser,this.serializer)}Xa(t){return new Yie(d3.ri,this.serializer)}Za(t){return new j4e}async terminate(){var t,i;(t=this.gcScheduler)===null||t===void 0||t.stop(),(i=this.indexBackfillerScheduler)===null||i===void 0||i.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}e1.provider={build:()=>new e1};class P5e extends e1{constructor(t){super(),this.cacheSizeBytes=t}tu(t,i){fi(this.persistence.referenceDelegate instanceof Qk);const a=this.persistence.referenceDelegate.garbageCollector;return new f4e(a,t.asyncQueue,i)}Xa(t){const i=this.cacheSizeBytes!==void 0?hl.withCacheSize(this.cacheSizeBytes):hl.DEFAULT;return new Yie(a=>Qk.ri(a,i),this.serializer)}}class jV{async initialize(t,i){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(i),this.remoteStore=this.createRemoteStore(i),this.eventManager=this.createEventManager(i),this.syncEngine=this.createSyncEngine(i,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=a=>mJ(this.syncEngine,a,1),this.remoteStore.remoteSyncer.handleCredentialChange=R5e.bind(null,this.syncEngine),await a5e(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return function(){return new l5e}()}createDatastore(t){const i=Q1(t.databaseInfo.databaseId),a=function(d){return new G4e(d)}(t.databaseInfo);return function(d,f,_,v){return new q4e(d,f,_,v)}(t.authCredentials,t.appCheckCredentials,a,i)}createRemoteStore(t){return function(a,l,d,f,_){return new X4e(a,l,d,f,_)}(this.localStore,this.datastore,t.asyncQueue,i=>mJ(this.syncEngine,i,0),function(){return lJ.D()?new lJ:new F4e}())}createSyncEngine(t,i){return function(l,d,f,_,v,b,C){const I=new m5e(l,d,f,_,v,b);return C&&(I.ja=!0),I}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,i)}async terminate(){var t,i;await async function(l){const d=rr(l);on(Yy,"RemoteStore shutting down."),d.W_.add(5),await mR(d),d.z_.shutdown(),d.j_.set("Unknown")}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(i=this.eventManager)===null||i===void 0||i.terminate()}}jV.provider={build:()=>new jV};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _se{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.iu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.iu(this.observer.error,t):Yf("Uncaught Error in snapshot listener:",t.toString()))}su(){this.muted=!0}iu(t,i){setTimeout(()=>{this.muted||t(i)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vg="FirestoreClient";class O5e{constructor(t,i,a,l,d){this.authCredentials=t,this.appCheckCredentials=i,this.asyncQueue=a,this.databaseInfo=l,this.user=rc.UNAUTHENTICATED,this.clientId=aie.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=d,this.authCredentials.start(a,async f=>{on(Vg,"Received user=",f.uid),await this.authCredentialListener(f),this.user=f}),this.appCheckCredentials.start(a,f=>(on(Vg,"Received new app check token=",f),this.appCheckCredentialListener(f,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Bf;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(i){const a=E3(i,"Failed to shutdown persistence");t.reject(a)}}),t.promise}}async function oU(n,t){n.asyncQueue.verifyOperationInProgress(),on(Vg,"Initializing OfflineComponentProvider");const i=n.configuration;await t.initialize(i);let a=i.initialUser;n.setCredentialChangeListener(async l=>{a.isEqual(l)||(await Xie(t.localStore,l),a=l)}),t.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=t}async function _J(n,t){n.asyncQueue.verifyOperationInProgress();const i=await k5e(n);on(Vg,"Initializing OnlineComponentProvider"),await t.initialize(i,n.configuration),n.setCredentialChangeListener(a=>dJ(t.remoteStore,a)),n.setAppCheckTokenChangeListener((a,l)=>dJ(t.remoteStore,l)),n._onlineComponents=t}async function k5e(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){on(Vg,"Using user provided OfflineComponentProvider");try{await oU(n,n._uninitializedComponentsProvider._offline)}catch(t){const i=t;if(!function(l){return l.name==="FirebaseError"?l.code===Ot.FAILED_PRECONDITION||l.code===Ot.UNIMPLEMENTED:!(typeof DOMException<"u"&&l instanceof DOMException)||l.code===22||l.code===20||l.code===11}(i))throw i;C0("Error using user provided cache. Falling back to memory cache: "+i),await oU(n,new e1)}}else on(Vg,"Using default OfflineComponentProvider"),await oU(n,new P5e(void 0));return n._offlineComponents}async function yse(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(on(Vg,"Using user provided OnlineComponentProvider"),await _J(n,n._uninitializedComponentsProvider._online)):(on(Vg,"Using default OnlineComponentProvider"),await _J(n,new jV))),n._onlineComponents}function N5e(n){return yse(n).then(t=>t.syncEngine)}async function Ese(n){const t=await yse(n),i=t.eventManager;return i.onListen=g5e.bind(null,t.syncEngine),i.onUnlisten=E5e.bind(null,t.syncEngine),i.onFirstRemoteStoreListen=_5e.bind(null,t.syncEngine),i.onLastRemoteStoreUnlisten=v5e.bind(null,t.syncEngine),i}function D5e(n,t,i={}){const a=new Bf;return n.asyncQueue.enqueueAndForget(async()=>function(d,f,_,v,b){const C=new _se({next:O=>{C.su(),f.enqueueAndForget(()=>ase(d,I));const L=O.docs.has(_);!L&&O.fromCache?b.reject(new dn(Ot.UNAVAILABLE,"Failed to get document because the client is offline.")):L&&O.fromCache&&v&&v.source==="server"?b.reject(new dn(Ot.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):b.resolve(O)},error:O=>b.reject(O)}),I=new cse(i3(_.path),C,{includeMetadataChanges:!0,Ta:!0});return ose(d,I)}(await Ese(n),n.asyncQueue,t,i,a)),a.promise}function x5e(n,t,i={}){const a=new Bf;return n.asyncQueue.enqueueAndForget(async()=>function(d,f,_,v,b){const C=new _se({next:O=>{C.su(),f.enqueueAndForget(()=>ase(d,I)),O.fromCache&&v.source==="server"?b.reject(new dn(Ot.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):b.resolve(O)},error:O=>b.reject(O)}),I=new cse(_,C,{includeMetadataChanges:!0,Ta:!0});return ose(d,I)}(await Ese(n),n.asyncQueue,t,i,a)),a.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vse(n){const t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yJ=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sse(n,t,i){if(!i)throw new dn(Ot.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function L5e(n,t,i,a){if(t===!0&&a===!0)throw new dn(Ot.INVALID_ARGUMENT,`${n} and ${i} cannot be used together.`)}function EJ(n){if(!Pn.isDocumentKey(n))throw new dn(Ot.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function vJ(n){if(Pn.isDocumentKey(n))throw new dn(Ot.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function tN(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const t=function(a){return a.constructor?a.constructor.name:null}(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":qn()}function Kd(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new dn(Ot.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=tN(n);throw new dn(Ot.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${i}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bse="firestore.googleapis.com",SJ=!0;class bJ{constructor(t){var i,a;if(t.host===void 0){if(t.ssl!==void 0)throw new dn(Ot.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=bse,this.ssl=SJ}else this.host=t.host,this.ssl=(i=t.ssl)!==null&&i!==void 0?i:SJ;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=qie;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<h4e)throw new dn(Ot.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}L5e("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=vse((a=t.experimentalLongPollingOptions)!==null&&a!==void 0?a:{}),function(d){if(d.timeoutSeconds!==void 0){if(isNaN(d.timeoutSeconds))throw new dn(Ot.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (must not be NaN)`);if(d.timeoutSeconds<5)throw new dn(Ot.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (minimum allowed value is 5)`);if(d.timeoutSeconds>30)throw new dn(Ot.INVALID_ARGUMENT,`invalid long polling timeout: ${d.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(a,l){return a.timeoutSeconds===l.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class nN{constructor(t,i,a,l){this._authCredentials=t,this._appCheckCredentials=i,this._databaseId=a,this._app=l,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new bJ({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new dn(Ot.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new dn(Ot.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new bJ(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=function(a){if(!a)return new WFe;switch(a.type){case"firstParty":return new KFe(a.sessionIndex||"0",a.iamToken||null,a.authTokenFactory||null);case"provider":return a.client;default:throw new dn(Ot.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(i){const a=yJ.get(i);a&&(on("ComponentProvider","Removing Datastore"),yJ.delete(i),a.terminate())}(this),Promise.resolve()}}function M5e(n,t,i,a={}){var l;const d=(n=Kd(n,nN))._getSettings(),f=Object.assign(Object.assign({},d),{emulatorOptions:n._getEmulatorOptions()}),_=`${t}:${i}`;d.host!==bse&&d.host!==_&&C0("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const v=Object.assign(Object.assign({},d),{host:_,ssl:!1,emulatorOptions:a});if(!$f(v,f)&&(n._setSettings(v),a.mockUserToken)){let b,C;if(typeof a.mockUserToken=="string")b=a.mockUserToken,C=rc.MOCK_USER;else{b=ure(a.mockUserToken,(l=n._app)===null||l===void 0?void 0:l.options.projectId);const I=a.mockUserToken.sub||a.mockUserToken.user_id;if(!I)throw new dn(Ot.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");C=new rc(I)}n._authCredentials=new GFe(new sie(b,C))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nE{constructor(t,i,a){this.converter=i,this._query=a,this.type="query",this.firestore=t}withConverter(t){return new nE(this.firestore,t,this._query)}}class kc{constructor(t,i,a){this.converter=i,this._key=a,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ag(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new kc(this.firestore,t,this._key)}}class Ag extends nE{constructor(t,i,a){super(t,i,i3(a)),this._path=a,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new kc(this.firestore,null,new Pn(t))}withConverter(t){return new Ag(this.firestore,t,this._path)}}function Ql(n,t,...i){if(n=us(n),Sse("collection","path",t),n instanceof nN){const a=ns.fromString(t,...i);return vJ(a),new Ag(n,null,a)}{if(!(n instanceof kc||n instanceof Ag))throw new dn(Ot.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(ns.fromString(t,...i));return vJ(a),new Ag(n.firestore,null,a)}}function gr(n,t,...i){if(n=us(n),arguments.length===1&&(t=aie.newId()),Sse("doc","path",t),n instanceof nN){const a=ns.fromString(t,...i);return EJ(a),new kc(n,null,new Pn(a))}{if(!(n instanceof kc||n instanceof Ag))throw new dn(Ot.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const a=n._path.child(ns.fromString(t,...i));return EJ(a),new kc(n.firestore,n instanceof Ag?n.converter:null,new Pn(a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TJ="AsyncQueue";class wJ{constructor(t=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new Qie(this,"async_queue_retry"),this.Su=()=>{const a=sU();a&&on(TJ,"Visibility state changed to "+a.visibilityState),this.a_.t_()},this.bu=t;const i=sU();i&&typeof i.addEventListener=="function"&&i.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Du(),this.vu(t)}enterRestrictedMode(t){if(!this.mu){this.mu=!0,this.yu=t||!1;const i=sU();i&&typeof i.removeEventListener=="function"&&i.removeEventListener("visibilitychange",this.Su)}}enqueue(t){if(this.Du(),this.mu)return new Promise(()=>{});const i=new Bf;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(t().then(i.resolve,i.reject),i.promise)).then(()=>i.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Vu.push(t),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(t){if(!$0(t))throw t;on(TJ,"Operation failed with retryable error: "+t)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(t){const i=this.bu.then(()=>(this.pu=!0,t().catch(a=>{this.gu=a,this.pu=!1;const l=function(f){let _=f.message||"";return f.stack&&(_=f.stack.includes(f.message)?f.stack:f.message+`
`+f.stack),_}(a);throw Yf("INTERNAL UNHANDLED ERROR: ",l),a}).then(a=>(this.pu=!1,a))));return this.bu=i,i}enqueueAfterDelay(t,i,a){this.Du(),this.wu.indexOf(t)>-1&&(i=0);const l=y3.createAndSchedule(this,t,i,a,d=>this.Fu(d));return this.fu.push(l),l}Du(){this.gu&&qn()}verifyOperationInProgress(){}async Mu(){let t;do t=this.bu,await t;while(t!==this.bu)}xu(t){for(const i of this.fu)if(i.timerId===t)return!0;return!1}Ou(t){return this.Mu().then(()=>{this.fu.sort((i,a)=>i.targetTimeMs-a.targetTimeMs);for(const i of this.fu)if(i.skipDelay(),t!=="all"&&i.timerId===t)break;return this.Mu()})}Nu(t){this.wu.push(t)}Fu(t){const i=this.fu.indexOf(t);this.fu.splice(i,1)}}class rE extends nN{constructor(t,i,a,l){super(t,i,a,l),this.type="firestore",this._queue=new wJ,this._persistenceKey=(l==null?void 0:l.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new wJ(t),this._firestoreClient=void 0,await t}}}function FV(n,t){const i=typeof n=="object"?n:WF(),a=typeof n=="string"?n:Gk,l=j1(i,"firestore").getImmediate({identifier:a});if(!l._initialized){const d=are("firestore");d&&M5e(l,...d)}return l}function T3(n){if(n._terminated)throw new dn(Ot.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||U5e(n),n._firestoreClient}function U5e(n){var t,i,a;const l=n._freezeSettings(),d=function(_,v,b,C){return new c3e(_,v,b,C.host,C.ssl,C.experimentalForceLongPolling,C.experimentalAutoDetectLongPolling,vse(C.experimentalLongPollingOptions),C.useFetchStreams)}(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,l);n._componentsProvider||!((i=l.localCache)===null||i===void 0)&&i._offlineComponentProvider&&(!((a=l.localCache)===null||a===void 0)&&a._onlineComponentProvider)&&(n._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),n._firestoreClient=new O5e(n._authCredentials,n._appCheckCredentials,n._queue,d,n._componentsProvider&&function(_){const v=_==null?void 0:_._online.build();return{_offline:_==null?void 0:_._offline.build(v),_online:v}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D0{constructor(t){this._byteString=t}static fromBase64String(t){try{return new D0(Oa.fromBase64String(t))}catch(i){throw new dn(Ot.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+i)}}static fromUint8Array(t){return new D0(Oa.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rN{constructor(...t){for(let i=0;i<t.length;++i)if(t[i].length===0)throw new dn(Ot.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Pa(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _R{constructor(t){this._methodName=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w3{constructor(t,i){if(!isFinite(t)||t<-90||t>90)throw new dn(Ot.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(i)||i<-180||i>180)throw new dn(Ot.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+i);this._lat=t,this._long=i}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Er(this._lat,t._lat)||Er(this._long,t._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C3{constructor(t){this._values=(t||[]).map(i=>i)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(a,l){if(a.length!==l.length)return!1;for(let d=0;d<a.length;++d)if(a[d]!==l[d])return!1;return!0}(this._values,t._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V5e=/^__.*__$/;class j5e{constructor(t,i,a){this.data=t,this.fieldMask=i,this.fieldTransforms=a}toMutation(t,i){return this.fieldMask!==null?new $g(t,this.data,this.fieldMask,i,this.fieldTransforms):new pR(t,this.data,i,this.fieldTransforms)}}class Tse{constructor(t,i,a){this.data=t,this.fieldMask=i,this.fieldTransforms=a}toMutation(t,i){return new $g(t,this.data,this.fieldMask,i,this.fieldTransforms)}}function wse(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw qn()}}class iN{constructor(t,i,a,l,d,f){this.settings=t,this.databaseId=i,this.serializer=a,this.ignoreUndefinedProperties=l,d===void 0&&this.Bu(),this.fieldTransforms=d||[],this.fieldMask=f||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(t){return new iN(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(t){var i;const a=(i=this.path)===null||i===void 0?void 0:i.child(t),l=this.ku({path:a,Qu:!1});return l.$u(t),l}Uu(t){var i;const a=(i=this.path)===null||i===void 0?void 0:i.child(t),l=this.ku({path:a,Qu:!1});return l.Bu(),l}Ku(t){return this.ku({path:void 0,Qu:!0})}Wu(t){return t1(t,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(t){return this.fieldMask.find(i=>t.isPrefixOf(i))!==void 0||this.fieldTransforms.find(i=>t.isPrefixOf(i.field))!==void 0}Bu(){if(this.path)for(let t=0;t<this.path.length;t++)this.$u(this.path.get(t))}$u(t){if(t.length===0)throw this.Wu("Document fields must not be empty");if(wse(this.Lu)&&V5e.test(t))throw this.Wu('Document fields cannot begin and end with "__"')}}class F5e{constructor(t,i,a){this.databaseId=t,this.ignoreUndefinedProperties=i,this.serializer=a||Q1(t)}ju(t,i,a,l=!1){return new iN({Lu:t,methodName:i,zu:a,path:Pa.emptyPath(),Qu:!1,Gu:l},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function sN(n){const t=n._freezeSettings(),i=Q1(n._databaseId);return new F5e(n._databaseId,!!t.ignoreUndefinedProperties,i)}function Cse(n,t,i,a,l,d={}){const f=n.ju(d.merge||d.mergeFields?2:0,t,i,l);A3("Data must be an object, but it was:",f,a);const _=Ise(a,f);let v,b;if(d.merge)v=new Hl(f.fieldMask),b=f.fieldTransforms;else if(d.mergeFields){const C=[];for(const I of d.mergeFields){const O=BV(t,I,i);if(!f.contains(O))throw new dn(Ot.INVALID_ARGUMENT,`Field '${O}' is specified in your field mask but missing from your input data.`);Pse(C,O)||C.push(O)}v=new Hl(C),b=f.fieldTransforms.filter(I=>v.covers(I.field))}else v=null,b=f.fieldTransforms;return new j5e(new fl(_),v,b)}class oN extends _R{_toFieldTransform(t){if(t.Lu!==2)throw t.Lu===1?t.Wu(`${this._methodName}() can only appear at the top level of your update data`):t.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof oN}}function Rse(n,t,i){return new iN({Lu:3,zu:t.settings.zu,methodName:n._methodName,Qu:i},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class R3 extends _R{constructor(t,i){super(t),this.Hu=i}_toFieldTransform(t){const i=Rse(this,t,!0),a=this.Hu.map(d=>iE(d,i)),l=new P0(a);return new Lie(t.path,l)}isEqual(t){return t instanceof R3&&$f(this.Hu,t.Hu)}}class I3 extends _R{constructor(t,i){super(t),this.Hu=i}_toFieldTransform(t){const i=Rse(this,t,!0),a=this.Hu.map(d=>iE(d,i)),l=new O0(a);return new Lie(t.path,l)}isEqual(t){return t instanceof I3&&$f(this.Hu,t.Hu)}}function B5e(n,t,i,a){const l=n.ju(1,t,i);A3("Data must be an object, but it was:",l,a);const d=[],f=fl.empty();Hg(a,(v,b)=>{const C=P3(t,v,i);b=us(b);const I=l.Uu(C);if(b instanceof oN)d.push(C);else{const O=iE(b,I);O!=null&&(d.push(C),f.set(C,O))}});const _=new Hl(d);return new Tse(f,_,l.fieldTransforms)}function z5e(n,t,i,a,l,d){const f=n.ju(1,t,i),_=[BV(t,a,i)],v=[l];if(d.length%2!=0)throw new dn(Ot.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let O=0;O<d.length;O+=2)_.push(BV(t,d[O])),v.push(d[O+1]);const b=[],C=fl.empty();for(let O=_.length-1;O>=0;--O)if(!Pse(b,_[O])){const L=_[O];let M=v[O];M=us(M);const F=f.Uu(L);if(M instanceof oN)b.push(L);else{const z=iE(M,F);z!=null&&(b.push(L),C.set(L,z))}}const I=new Hl(b);return new Tse(C,I,f.fieldTransforms)}function W5e(n,t,i,a=!1){return iE(i,n.ju(a?4:3,t))}function iE(n,t){if(Ase(n=us(n)))return A3("Unsupported field value:",t,n),Ise(n,t);if(n instanceof _R)return function(a,l){if(!wse(l.Lu))throw l.Wu(`${a._methodName}() can only be used with update() and set()`);if(!l.path)throw l.Wu(`${a._methodName}() is not currently supported inside arrays`);const d=a._toFieldTransform(l);d&&l.fieldTransforms.push(d)}(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.Qu&&t.Lu!==4)throw t.Wu("Nested arrays are not supported");return function(a,l){const d=[];let f=0;for(const _ of a){let v=iE(_,l.Ku(f));v==null&&(v={nullValue:"NULL_VALUE"}),d.push(v),f++}return{arrayValue:{values:d}}}(n,t)}return function(a,l){if((a=us(a))===null)return{nullValue:"NULL_VALUE"};if(typeof a=="number")return k3e(l.serializer,a);if(typeof a=="boolean")return{booleanValue:a};if(typeof a=="string")return{stringValue:a};if(a instanceof Date){const d=No.fromDate(a);return{timestampValue:Jk(l.serializer,d)}}if(a instanceof No){const d=new No(a.seconds,1e3*Math.floor(a.nanoseconds/1e3));return{timestampValue:Jk(l.serializer,d)}}if(a instanceof w3)return{geoPointValue:{latitude:a.latitude,longitude:a.longitude}};if(a instanceof D0)return{bytesValue:Bie(l.serializer,a._byteString)};if(a instanceof kc){const d=l.databaseId,f=a.firestore._databaseId;if(!f.isEqual(d))throw l.Wu(`Document reference is for database ${f.projectId}/${f.database} but should be for database ${d.projectId}/${d.database}`);return{referenceValue:l3(a.firestore._databaseId||l.databaseId,a._key.path)}}if(a instanceof C3)return function(f,_){return{mapValue:{fields:{[mie]:{stringValue:gie},[Hk]:{arrayValue:{values:f.toArray().map(b=>{if(typeof b!="number")throw _.Wu("VectorValues must only contain numeric values.");return s3(_.serializer,b)})}}}}}}(a,l);throw l.Wu(`Unsupported field value: ${tN(a)}`)}(n,t)}function Ise(n,t){const i={};return lie(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Hg(n,(a,l)=>{const d=iE(l,t.qu(a));d!=null&&(i[a]=d)}),{mapValue:{fields:i}}}function Ase(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof No||n instanceof w3||n instanceof D0||n instanceof kc||n instanceof _R||n instanceof C3)}function A3(n,t,i){if(!Ase(i)||!function(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}(i)){const a=tN(i);throw a==="an object"?t.Wu(n+" a custom object"):t.Wu(n+" "+a)}}function BV(n,t,i){if((t=us(t))instanceof rN)return t._internalPath;if(typeof t=="string")return P3(n,t);throw t1("Field path arguments must be of type string or ",n,!1,void 0,i)}const G5e=new RegExp("[~\\*/\\[\\]]");function P3(n,t,i){if(t.search(G5e)>=0)throw t1(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,i);try{return new rN(...t.split("."))._internalPath}catch{throw t1(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,i)}}function t1(n,t,i,a,l){const d=a&&!a.isEmpty(),f=l!==void 0;let _=`Function ${t}() called with invalid data`;i&&(_+=" (via `toFirestore()`)"),_+=". ";let v="";return(d||f)&&(v+=" (found",d&&(v+=` in field ${a}`),f&&(v+=` in document ${l}`),v+=")"),new dn(Ot.INVALID_ARGUMENT,_+n+v)}function Pse(n,t){return n.some(i=>i.isEqual(t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ose{constructor(t,i,a,l,d){this._firestore=t,this._userDataWriter=i,this._key=a,this._document=l,this._converter=d}get id(){return this._key.path.lastSegment()}get ref(){return new kc(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new H5e(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const i=this._document.data.field(O3("DocumentSnapshot.get",t));if(i!==null)return this._userDataWriter.convertValue(i)}}}class H5e extends Ose{data(){return super.data()}}function O3(n,t){return typeof t=="string"?P3(n,t):t instanceof rN?t._internalPath:t._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $5e(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new dn(Ot.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class k3{}class kse extends k3{}function zV(n,t,...i){let a=[];t instanceof k3&&a.push(t),a=a.concat(i),function(d){const f=d.filter(v=>v instanceof N3).length,_=d.filter(v=>v instanceof aN).length;if(f>1||f>0&&_>0)throw new dn(Ot.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(a);for(const l of a)n=l._apply(n);return n}class aN extends kse{constructor(t,i,a){super(),this._field=t,this._op=i,this._value=a,this.type="where"}static _create(t,i,a){return new aN(t,i,a)}_apply(t){const i=this._parse(t);return Nse(t._query,i),new nE(t.firestore,t.converter,OV(t._query,i))}_parse(t){const i=sN(t.firestore);return function(d,f,_,v,b,C,I){let O;if(b.isKeyField()){if(C==="array-contains"||C==="array-contains-any")throw new dn(Ot.INVALID_ARGUMENT,`Invalid Query. You can't perform '${C}' queries on documentId().`);if(C==="in"||C==="not-in"){IJ(I,C);const M=[];for(const F of I)M.push(RJ(v,d,F));O={arrayValue:{values:M}}}else O=RJ(v,d,I)}else C!=="in"&&C!=="not-in"&&C!=="array-contains-any"||IJ(I,C),O=W5e(_,f,I,C==="in"||C==="not-in");return mo.create(b,C,O)}(t._query,"where",i,t.firestore._databaseId,this._field,this._op,this._value)}}function CJ(n,t,i){const a=t,l=O3("where",n);return aN._create(l,a,i)}class N3 extends k3{constructor(t,i){super(),this.type=t,this._queryConstraints=i}static _create(t,i){return new N3(t,i)}_parse(t){const i=this._queryConstraints.map(a=>a._parse(t)).filter(a=>a.getFilters().length>0);return i.length===1?i[0]:$d.create(i,this._getOperator())}_apply(t){const i=this._parse(t);return i.getFilters().length===0?t:(function(l,d){let f=l;const _=d.getFlattenedFilters();for(const v of _)Nse(f,v),f=OV(f,v)}(t._query,i),new nE(t.firestore,t.converter,OV(t._query,i)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class D3 extends kse{constructor(t,i,a){super(),this.type=t,this._limit=i,this._limitType=a}static _create(t,i,a){return new D3(t,i,a)}_apply(t){return new nE(t.firestore,t.converter,qk(t._query,this._limit,this._limitType))}}function K5e(n){return D3._create("limit",n,"F")}function RJ(n,t,i){if(typeof(i=us(i))=="string"){if(i==="")throw new dn(Ot.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!wie(t)&&i.indexOf("/")!==-1)throw new dn(Ot.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${i}' contains a '/' character.`);const a=t.path.child(ns.fromString(i));if(!Pn.isDocumentKey(a))throw new dn(Ot.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${a}' is not because it has an odd number of segments (${a.length}).`);return BX(n,new Pn(a))}if(i instanceof kc)return BX(n,i._key);throw new dn(Ot.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${tN(i)}.`)}function IJ(n,t){if(!Array.isArray(n)||n.length===0)throw new dn(Ot.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Nse(n,t){const i=function(l,d){for(const f of l)for(const _ of f.getFlattenedFilters())if(d.indexOf(_.op)>=0)return _.op;return null}(n.filters,function(l){switch(l){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(i!==null)throw i===t.op?new dn(Ot.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new dn(Ot.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${i.toString()}' filters.`)}class q5e{convertValue(t,i="none"){switch(Mg(t)){case 0:return null;case 1:return t.booleanValue;case 2:return eo(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,i);case 5:return t.stringValue;case 6:return this.convertBytes(Lg(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,i);case 11:return this.convertObject(t.mapValue,i);case 10:return this.convertVectorValue(t.mapValue);default:throw qn()}}convertObject(t,i){return this.convertObjectMap(t.fields,i)}convertObjectMap(t,i="none"){const a={};return Hg(t,(l,d)=>{a[l]=this.convertValue(d,i)}),a}convertVectorValue(t){var i,a,l;const d=(l=(a=(i=t.fields)===null||i===void 0?void 0:i[Hk].arrayValue)===null||a===void 0?void 0:a.values)===null||l===void 0?void 0:l.map(f=>eo(f.doubleValue));return new C3(d)}convertGeoPoint(t){return new w3(eo(t.latitude),eo(t.longitude))}convertArray(t,i){return(t.values||[]).map(a=>this.convertValue(a,i))}convertServerTimestamp(t,i){switch(i){case"previous":const a=$1(t);return a==null?null:this.convertValue(a,i);case"estimate":return this.convertTimestamp(BC(t));default:return null}}convertTimestamp(t){const i=xg(t);return new No(i.seconds,i.nanos)}convertDocumentKey(t,i){const a=ns.fromString(t);fi(Kie(a));const l=new zC(a.get(1),a.get(3)),d=new Pn(a.popFirst(5));return l.isEqual(i)||Yf(`Document ${d} contains a document reference within a different database (${l.projectId}/${l.database}) which is not supported. It will be treated as a reference in the current database (${i.projectId}/${i.database}) instead.`),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dse(n,t,i){let a;return a=n?i&&(i.merge||i.mergeFields)?n.toFirestore(t,i):n.toFirestore(t):t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $w{constructor(t,i){this.hasPendingWrites=t,this.fromCache=i}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class xse extends Ose{constructor(t,i,a,l,d,f){super(t,i,a,l,f),this._firestore=t,this._firestoreImpl=t,this.metadata=d}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const i=new pk(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(i,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,i={}){if(this._document){const a=this._document.data.field(O3("DocumentSnapshot.get",t));if(a!==null)return this._userDataWriter.convertValue(a,i.serverTimestamps)}}}class pk extends xse{data(t={}){return super.data(t)}}class Y5e{constructor(t,i,a,l){this._firestore=t,this._userDataWriter=i,this._snapshot=l,this.metadata=new $w(l.hasPendingWrites,l.fromCache),this.query=a}get docs(){const t=[];return this.forEach(i=>t.push(i)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,i){this._snapshot.docs.forEach(a=>{t.call(i,new pk(this._firestore,this._userDataWriter,a.key,a,new $w(this._snapshot.mutatedKeys.has(a.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const i=!!t.includeMetadataChanges;if(i&&this._snapshot.excludesMetadataChanges)throw new dn(Ot.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===i||(this._cachedChanges=function(l,d){if(l._snapshot.oldDocs.isEmpty()){let f=0;return l._snapshot.docChanges.map(_=>{const v=new pk(l._firestore,l._userDataWriter,_.doc.key,_.doc,new $w(l._snapshot.mutatedKeys.has(_.doc.key),l._snapshot.fromCache),l.query.converter);return _.doc,{type:"added",doc:v,oldIndex:-1,newIndex:f++}})}{let f=l._snapshot.oldDocs;return l._snapshot.docChanges.filter(_=>d||_.type!==3).map(_=>{const v=new pk(l._firestore,l._userDataWriter,_.doc.key,_.doc,new $w(l._snapshot.mutatedKeys.has(_.doc.key),l._snapshot.fromCache),l.query.converter);let b=-1,C=-1;return _.type!==0&&(b=f.indexOf(_.doc.key),f=f.delete(_.doc.key)),_.type!==1&&(f=f.add(_.doc),C=f.indexOf(_.doc.key)),{type:X5e(_.type),doc:v,oldIndex:b,newIndex:C}})}}(this,i),this._cachedChangesIncludeMetadataChanges=i),this._cachedChanges}}function X5e(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return qn()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function go(n){n=Kd(n,kc);const t=Kd(n.firestore,rE);return D5e(T3(t),n._key).then(i=>Z5e(t,n,i))}class Lse extends q5e{constructor(t){super(),this.firestore=t}convertBytes(t){return new D0(t)}convertReference(t){const i=this.convertDocumentKey(t,this.firestore._databaseId);return new kc(this.firestore,null,i)}}function qu(n){n=Kd(n,nE);const t=Kd(n.firestore,rE),i=T3(t),a=new Lse(t);return $5e(n._query),x5e(i,n._query).then(l=>new Y5e(t,a,n,l))}function jg(n,t,i){n=Kd(n,kc);const a=Kd(n.firestore,rE),l=Dse(n.converter,t,i);return cN(a,[Cse(sN(a),"setDoc",n._key,l,n.converter!==null,i).toMutation(n._key,Wu.none())])}function Gs(n,t,i,...a){n=Kd(n,kc);const l=Kd(n.firestore,rE),d=sN(l);let f;return f=typeof(t=us(t))=="string"||t instanceof rN?z5e(d,"updateDoc",n._key,t,i,a):B5e(d,"updateDoc",n._key,t),cN(l,[f.toMutation(n._key,Wu.exists(!0))])}function J5e(n){return cN(Kd(n.firestore,rE),[new o3(n._key,Wu.none())])}function Q5e(n,t){const i=Kd(n.firestore,rE),a=gr(n),l=Dse(n.converter,t);return cN(i,[Cse(sN(n.firestore),"addDoc",a._key,l,n.converter!==null,{}).toMutation(a._key,Wu.exists(!1))]).then(()=>a)}function cN(n,t){return function(a,l){const d=new Bf;return a.asyncQueue.enqueueAndForget(async()=>S5e(await N5e(a),l,d)),d.promise}(T3(n),t)}function Z5e(n,t,i){const a=i.docs.get(t._key),l=new Lse(n);return new xse(n,l,t._key,a,new $w(i.hasPendingWrites,i.fromCache),t.converter)}function eBe(...n){return new R3("arrayUnion",n)}function tBe(...n){return new I3("arrayRemove",n)}(function(t,i=!0){(function(l){G0=l})(Zy),Hy(new Ng("firestore",(a,{instanceIdentifier:l,options:d})=>{const f=a.getProvider("app").getImmediate(),_=new rE(new HFe(a.getProvider("auth-internal")),new qFe(f,a.getProvider("app-check-internal")),function(b,C){if(!Object.prototype.hasOwnProperty.apply(b.options,["projectId"]))throw new dn(Ot.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new zC(b.options.projectId,C)}(f,l),f);return d=Object.assign({useFetchStreams:i},d),_._setSettings(d),_},"PUBLIC").setMultipleInstances(!0)),pp(PX,OX,t),pp(PX,OX,"esm2017")})();var nBe="firebase",rBe="11.5.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */pp(nBe,rBe,"app");const iBe=[{key:"VITE_FIREBASE_API_KEY",value:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU"},{key:"VITE_FIREBASE_AUTH_DOMAIN",value:"disruptive-metaverse.firebaseapp.com"},{key:"VITE_FIREBASE_PROJECT_ID",value:"disruptive-metaverse"},{key:"VITE_FIREBASE_STORAGE_BUCKET",value:"disruptive-metaverse.appspot.com"},{key:"VITE_FIREBASE_MESSAGING_SENDER_ID",value:"294433070603"},{key:"VITE_FIREBASE_APP_ID",value:"1:294433070603:web:136cddd196eea9614fb10e"}],WV=iBe.filter(n=>!n.value);if(WV.length>0){const t=`Missing environment variables: ${WV.map(i=>i.key).join(", ")}. Using fallback values. For production, it's recommended to set up your .env file.`;$.warn(t),console.warn(t)}const sBe={apiKey:"AIzaSyCaxoNKRIMaXhotGzdAjXc5gkARoqtS3bU",authDomain:"disruptive-metaverse.firebaseapp.com",projectId:"disruptive-metaverse",storageBucket:"disruptive-metaverse.appspot.com",messagingSenderId:"294433070603",appId:"1:294433070603:web:136cddd196eea9614fb10e"},oBe=WV.length>0;$.log(`Firebase initializing with ${oBe?"fallback":"environment"} configuration`);let aU,x3,zn;try{aU=pre(sBe),x3=W1(aU),zn=FV(aU),$.log("Firebase initialized successfully")}catch(n){$.error("Failed to initialize Firebase:",n),console.error("Failed to initialize Firebase:",n)}const Kw=n=>!0,AJ=(n,t)=>{const a=(n+t.charAt(0)).toLowerCase().replace(/[^a-z0-9]/g,"").substring(0,11),l=Math.floor(1e3+Math.random()*9e3);return a+l},Mse=async n=>{try{if(!n||typeof n!="string"||n.trim()==="")return $.error("userFirestore: Invalid username provided to isUsernameTaken"),!0;const t=n.toLowerCase().trim();$.log(`userFirestore: Checking if username "${t}" is taken`);const i=Ql(zn,"users"),a=zV(i,K5e(100)),l=await qu(a);let d=!1;return l.forEach(f=>{const _=f.data();_.username&&_.username.toLowerCase()===t&&(d=!0)}),$.log(`userFirestore: Username "${t}" is ${d?"taken":"available"}`),d}catch(t){return $.error("userFirestore: Error checking username availability:",t),!0}},aBe=async(n,t)=>{let i=AJ(n,t),a=0;const l=10;for(;a<l;){if(!await Mse(i))return i;i=AJ(n,t),a++}return i+Math.floor(Math.random()*100)},Yu=async n=>{try{$.log("userFirestore: Get user PUBLIC profile data for user ID: "+n);const t=gr(zn,"users",n),i=await go(t);if(i.exists()){const a=i.data();return $.log("userFirestore: Found PUBLIC Profile for : "+a.Nickname),delete a.email,delete a.emailVerified,a}else return $.error("userFirestore: user profile document not found"),null}catch(t){throw $.error("userFirestore: Error fetching user public profile data:",t),t}},cBe=async(n,t,i)=>{try{if($.log("userFirestore: Starting registerUser process"),$.log("userFirestore: Fields in additionalData:",Object.keys(i||{}).join(", ")),!i)throw $.error("userFirestore: additionalData is null or undefined"),new Error("Registration data is missing");const a={firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:i.username||"",Nickname:i.Nickname||"",rpmURL:i.rpmURL||"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb"};$.log("userFirestore: Critical fields captured for registration"),$.log("userFirestore: Creating user auth record");const d=(await Rje(x3,n,t)).user;await zre(d),$.log("userFirestore: Verification email sent"),$.log("userFirestore: Waiting for Cloud Function to create initial document..."),await new Promise(L=>setTimeout(L,5e3));const f=gr(zn,"users",d.uid),_=await go(f);if(_.exists()){$.log("userFirestore: Found document created by Cloud Function, updating with missing fields");const L=_.data(),M={};L.firstName||(M.firstName=a.firstName),L.lastName||(M.lastName=a.lastName),L.Nickname||(M.Nickname=a.Nickname),L.username||(M.username=a.username),L.companyName||(M.companyName=a.companyName),L.linkedInProfile||(M.linkedInProfile=a.linkedInProfile),L.rpmURL||(M.rpmURL=a.rpmURL),Object.keys(M).length>0&&($.log("userFirestore: Updating document with fields:",Object.keys(M).join(", ")),await Gs(f,{...M,lastUpdated:new Date}))}else{$.error("userFirestore: Cloud Function failed to create user document, creating manually"),await jg(f,{...a,id:d.uid,groups:["users"],createdAt:new Date,lastUpdated:new Date});const L=gr(zn,"users",d.uid,"private","data");await jg(L,{email:d.email,emailVerified:!1})}const v=await go(f);if(!v.exists())throw new Error("User document does not exist even after creation attempts");let b=v.data();b.firstName||(b.firstName=a.firstName),b.lastName||(b.lastName=a.lastName),b.Nickname||(b.Nickname=a.Nickname),b.username||(b.username=a.username),b.companyName||(b.companyName=a.companyName);let C=!1,I={};for(const L in a)(!b[L]||b[L]==="")&&(I[L]=a[L],C=!0);(!b.groups||!b.groups.includes("users"))&&(I.groups=b.groups?[...b.groups,"users"]:["users"],C=!0,$.log("userFirestore: Adding user to users group")),C&&($.log("userFirestore: Updating user document with missing fields"),$.log("userFirestore: Fields being updated:",Object.keys(I).join(", ")),await Gs(f,I),b=(await go(f)).data());const O={...d,...b,firstName:a.firstName,lastName:a.lastName,Nickname:a.Nickname,username:a.username,companyName:a.companyName,linkedInProfile:a.linkedInProfile};return $.log("userFirestore: Registration complete, returning user data"),$.log("userFirestore: Fields included in return data:",Object.keys(O).join(", ")),O}catch(a){throw $.error("userFirestore: Error creating user:",a),a}},Use=async(n,t)=>{try{$.log(`userFirestore: Updating rpmURL for user ID: ${n}`);const i=gr(zn,"users",n);await Gs(i,{rpmURL:t,lastUpdated:new Date().toISOString()}),$.log("userFirestore: rpmURL updated successfully.")}catch(i){throw $.error("userFirestore: Error updating rpmURL:",i),i}},lBe=async(n,t)=>{try{const i=await Yu(n);return i&&i.groups?i.groups.includes(t):!1}catch(i){return $.error("userFirestore: Error checking group membership:",i),!1}};var uBe={};const n1=()=>{const n=typeof process<"u"&&uBe&&!1;return typeof window<"u"&&new URLSearchParams(window.location.search).has("dev_mode"),n},dBe=(n,t)=>{if(!n1())return $.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},hBe=(n,t)=>{if(!n1())return $.warn(" SECURITY WARNING: Permission override attempted outside of development environment"),!1},L3=typeof n1=="function"?n1():!1;L3&&$.warn(" SECURITY WARNING: Permission overrides are ENABLED. This should only happen in development.");const pBe=async(n,t)=>{if(L3)return dBe();if(!n||!n.uid)return!1;try{if(n.groups){const l=`space_${t}_owners`;if(n.groups.includes(l))return console.log(`User ${n.uid} is an owner via groups property`),!0}const a=W1().currentUser;if(a&&a.uid===n.uid)try{const d=(await a.getIdTokenResult(!0)).claims.groups||[],f=`space_${t}_owners`;if(d.includes(f))return console.log(`User ${n.uid} is an owner via Firebase token claims`),!0}catch(l){console.error("Error getting token result:",l)}return!1}catch(i){return $.error("Error checking space owner permissions:",i),!1}},lN=async(n,t)=>{if(L3)return hBe();try{if($.log(`userPermissions: Checking if user ${n} belongs to group ${t}`),t==="users")return $.log(`userPermissions: TESTING MODE - Always allowing access to 'users' group for user ${n}`),!0;if(n){const i=await Yu(n);if($.log(`userPermissions: User profile for ${n}:`,i),i&&i.groups&&Array.isArray(i.groups)){if($.log(`userPermissions: User ${n} has groups:`,i.groups),i.groups.includes(t))return $.log(`userPermissions: User ${n} belongs to group ${t} (from user document)`),!0}else $.log(`userPermissions: User ${n} has no groups or groups is not an array`);if(t==="disruptiveAdmin")try{const l=W1().currentUser;if(l&&l.uid===n){const d=await l.getIdTokenResult();if($.log(`userPermissions: Token claims for ${n}:`,d.claims),d.claims&&d.claims.groups&&Array.isArray(d.claims.groups)&&d.claims.groups.includes(t))return $.log(`userPermissions: User ${n} belongs to group ${t} (from token claims)`),!0}}catch(a){$.error("userPermissions: Error checking token claims:",a)}}return $.log(`userPermissions: User ${n} does not belong to group ${t}`),!1}catch(i){return $.error("userPermissions: Error checking if user belongs to group:",i),!1}},fBe=["email","name","rpmURL","Nickname","username","created_on","height_cm","companyName","firstName","lastName","linkedInProfile","groups"],Wd={sendUserToUnity:"sendUserToUnity"};class mBe{constructor(){this.events={}}subscribe(t,i){this.events[t]||(this.events[t]=[]),this.events[t].push(i)}publish(t,i){const a=this.events[t];a?(a.forEach(l=>{l(i)}),$.log(`EventBus: Published event '${t}'`)):$.log(`EventBus: No subscribers for event '${t}'`)}unsubscribe(t,i){var l;const a=(l=this.events[t])==null?void 0:l.indexOf(i);a>-1&&this.events[t].splice(a,1)}}const Gd=new mBe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vse="firebasestorage.googleapis.com",jse="storageBucket",gBe=2*60*1e3,_Be=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s extends wp{constructor(t,i,a=0){super(cU(t),`Firebase Storage: ${i} (${cU(t)})`),this.status_=a,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,$s.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return cU(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var Hs;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(Hs||(Hs={}));function cU(n){return"storage/"+n}function M3(){const n="An unknown error occurred, please check the error payload for server response.";return new $s(Hs.UNKNOWN,n)}function yBe(n){return new $s(Hs.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function EBe(n){return new $s(Hs.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function vBe(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new $s(Hs.UNAUTHENTICATED,n)}function SBe(){return new $s(Hs.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function bBe(n){return new $s(Hs.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function TBe(){return new $s(Hs.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function wBe(){return new $s(Hs.CANCELED,"User canceled the upload/download.")}function CBe(n){return new $s(Hs.INVALID_URL,"Invalid URL '"+n+"'.")}function RBe(n){return new $s(Hs.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function IBe(){return new $s(Hs.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+jse+"' property when initializing the app?")}function ABe(){return new $s(Hs.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function PBe(){return new $s(Hs.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function OBe(n){return new $s(Hs.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function GV(n){return new $s(Hs.INVALID_ARGUMENT,n)}function Fse(){return new $s(Hs.APP_DELETED,"The Firebase app was deleted.")}function kBe(n){return new $s(Hs.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function fC(n,t){return new $s(Hs.INVALID_FORMAT,"String does not match format '"+n+"': "+t)}function yw(n){throw new $s(Hs.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $l{constructor(t,i){this.bucket=t,this.path_=i}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,i){let a;try{a=$l.makeFromUrl(t,i)}catch{return new $l(t,"")}if(a.path==="")return a;throw RBe(t)}static makeFromUrl(t,i){let a=null;const l="([A-Za-z0-9.\\-_]+)";function d(ae){ae.path.charAt(ae.path.length-1)==="/"&&(ae.path_=ae.path_.slice(0,-1))}const f="(/(.*))?$",_=new RegExp("^gs://"+l+f,"i"),v={bucket:1,path:3};function b(ae){ae.path_=decodeURIComponent(ae.path)}const C="v[A-Za-z0-9_]+",I=i.replace(/[.]/g,"\\."),O="(/([^?#]*).*)?$",L=new RegExp(`^https?://${I}/${C}/b/${l}/o${O}`,"i"),M={bucket:1,path:3},F=i===Vse?"(?:storage.googleapis.com|storage.cloud.google.com)":i,z="([^?#]*)",Z=new RegExp(`^https?://${F}/${l}/${z}`,"i"),re=[{regex:_,indices:v,postModify:d},{regex:L,indices:M,postModify:b},{regex:Z,indices:{bucket:1,path:2},postModify:b}];for(let ae=0;ae<re.length;ae++){const ne=re[ae],pe=ne.regex.exec(t);if(pe){const X=pe[ne.indices.bucket];let J=pe[ne.indices.path];J||(J=""),a=new $l(X,J),ne.postModify(a);break}}if(a==null)throw CBe(t);return a}}class NBe{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DBe(n,t,i){let a=1,l=null,d=null,f=!1,_=0;function v(){return _===2}let b=!1;function C(...z){b||(b=!0,t.apply(null,z))}function I(z){l=setTimeout(()=>{l=null,n(L,v())},z)}function O(){d&&clearTimeout(d)}function L(z,...Z){if(b){O();return}if(z){O(),C.call(null,z,...Z);return}if(v()||f){O(),C.call(null,z,...Z);return}a<64&&(a*=2);let re;_===1?(_=2,re=0):re=(a+Math.random())*1e3,I(re)}let M=!1;function F(z){M||(M=!0,O(),!b&&(l!==null?(z||(_=2),clearTimeout(l),I(0)):z||(_=1)))}return I(0),d=setTimeout(()=>{f=!0,F(!0)},i),F}function xBe(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LBe(n){return n!==void 0}function MBe(n){return typeof n=="object"&&!Array.isArray(n)}function U3(n){return typeof n=="string"||n instanceof String}function PJ(n){return V3()&&n instanceof Blob}function V3(){return typeof Blob<"u"}function OJ(n,t,i,a){if(a<t)throw GV(`Invalid value for '${n}'. Expected ${t} or greater.`);if(a>i)throw GV(`Invalid value for '${n}'. Expected ${i} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uN(n,t,i){let a=t;return i==null&&(a=`https://${t}`),`${i}://${a}/v0${n}`}function Bse(n){const t=encodeURIComponent;let i="?";for(const a in n)if(n.hasOwnProperty(a)){const l=t(a)+"="+t(n[a]);i=i+l+"&"}return i=i.slice(0,-1),i}var Vy;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Vy||(Vy={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UBe(n,t){const i=n>=500&&n<600,l=[408,429].indexOf(n)!==-1,d=t.indexOf(n)!==-1;return i||l||d}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VBe{constructor(t,i,a,l,d,f,_,v,b,C,I,O=!0){this.url_=t,this.method_=i,this.headers_=a,this.body_=l,this.successCodes_=d,this.additionalRetryCodes_=f,this.callback_=_,this.errorCallback_=v,this.timeout_=b,this.progressCallback_=C,this.connectionFactory_=I,this.retry=O,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((L,M)=>{this.resolve_=L,this.reject_=M,this.start_()})}start_(){const t=(a,l)=>{if(l){a(!1,new NO(!1,null,!0));return}const d=this.connectionFactory_();this.pendingConnection_=d;const f=_=>{const v=_.loaded,b=_.lengthComputable?_.total:-1;this.progressCallback_!==null&&this.progressCallback_(v,b)};this.progressCallback_!==null&&d.addUploadProgressListener(f),d.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&d.removeUploadProgressListener(f),this.pendingConnection_=null;const _=d.getErrorCode()===Vy.NO_ERROR,v=d.getStatus();if(!_||UBe(v,this.additionalRetryCodes_)&&this.retry){const C=d.getErrorCode()===Vy.ABORT;a(!1,new NO(!1,null,C));return}const b=this.successCodes_.indexOf(v)!==-1;a(!0,new NO(b,d))})},i=(a,l)=>{const d=this.resolve_,f=this.reject_,_=l.connection;if(l.wasSuccessCode)try{const v=this.callback_(_,_.getResponse());LBe(v)?d(v):d()}catch(v){f(v)}else if(_!==null){const v=M3();v.serverResponse=_.getErrorText(),this.errorCallback_?f(this.errorCallback_(_,v)):f(v)}else if(l.canceled){const v=this.appDelete_?Fse():wBe();f(v)}else{const v=TBe();f(v)}};this.canceled_?i(!1,new NO(!1,null,!0)):this.backoffId_=DBe(t,i,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,this.backoffId_!==null&&xBe(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class NO{constructor(t,i,a){this.wasSuccessCode=t,this.connection=i,this.canceled=!!a}}function jBe(n,t){t!==null&&t.length>0&&(n.Authorization="Firebase "+t)}function FBe(n,t){n["X-Firebase-Storage-Version"]="webjs/"+(t??"AppManager")}function BBe(n,t){t&&(n["X-Firebase-GMPID"]=t)}function zBe(n,t){t!==null&&(n["X-Firebase-AppCheck"]=t)}function WBe(n,t,i,a,l,d,f=!0){const _=Bse(n.urlParams),v=n.url+_,b=Object.assign({},n.headers);return BBe(b,t),jBe(b,i),FBe(b,d),zBe(b,a),new VBe(v,n.method,b,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,l,f)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GBe(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function HBe(...n){const t=GBe();if(t!==void 0){const i=new t;for(let a=0;a<n.length;a++)i.append(n[a]);return i.getBlob()}else{if(V3())return new Blob(n);throw new $s(Hs.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function $Be(n,t,i){return n.webkitSlice?n.webkitSlice(t,i):n.mozSlice?n.mozSlice(t,i):n.slice?n.slice(t,i):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KBe(n){if(typeof atob>"u")throw OBe("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ip={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class lU{constructor(t,i){this.data=t,this.contentType=i||null}}function qBe(n,t){switch(n){case ip.RAW:return new lU(zse(t));case ip.BASE64:case ip.BASE64URL:return new lU(Wse(n,t));case ip.DATA_URL:return new lU(XBe(t),JBe(t))}throw M3()}function zse(n){const t=[];for(let i=0;i<n.length;i++){let a=n.charCodeAt(i);if(a<=127)t.push(a);else if(a<=2047)t.push(192|a>>6,128|a&63);else if((a&64512)===55296)if(!(i<n.length-1&&(n.charCodeAt(i+1)&64512)===56320))t.push(239,191,189);else{const d=a,f=n.charCodeAt(++i);a=65536|(d&1023)<<10|f&1023,t.push(240|a>>18,128|a>>12&63,128|a>>6&63,128|a&63)}else(a&64512)===56320?t.push(239,191,189):t.push(224|a>>12,128|a>>6&63,128|a&63)}return new Uint8Array(t)}function YBe(n){let t;try{t=decodeURIComponent(n)}catch{throw fC(ip.DATA_URL,"Malformed data URL.")}return zse(t)}function Wse(n,t){switch(n){case ip.BASE64:{const l=t.indexOf("-")!==-1,d=t.indexOf("_")!==-1;if(l||d)throw fC(n,"Invalid character '"+(l?"-":"_")+"' found: is it base64url encoded?");break}case ip.BASE64URL:{const l=t.indexOf("+")!==-1,d=t.indexOf("/")!==-1;if(l||d)throw fC(n,"Invalid character '"+(l?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let i;try{i=KBe(t)}catch(l){throw l.message.includes("polyfill")?l:fC(n,"Invalid character found")}const a=new Uint8Array(i.length);for(let l=0;l<i.length;l++)a[l]=i.charCodeAt(l);return a}class Gse{constructor(t){this.base64=!1,this.contentType=null;const i=t.match(/^data:([^,]+)?,/);if(i===null)throw fC(ip.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const a=i[1]||null;a!=null&&(this.base64=QBe(a,";base64"),this.contentType=this.base64?a.substring(0,a.length-7):a),this.rest=t.substring(t.indexOf(",")+1)}}function XBe(n){const t=new Gse(n);return t.base64?Wse(ip.BASE64,t.rest):YBe(t.rest)}function JBe(n){return new Gse(n).contentType}function QBe(n,t){return n.length>=t.length?n.substring(n.length-t.length)===t:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg{constructor(t,i){let a=0,l="";PJ(t)?(this.data_=t,a=t.size,l=t.type):t instanceof ArrayBuffer?(i?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),a=this.data_.length):t instanceof Uint8Array&&(i?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),a=t.length),this.size_=a,this.type_=l}size(){return this.size_}type(){return this.type_}slice(t,i){if(PJ(this.data_)){const a=this.data_,l=$Be(a,t,i);return l===null?null:new vg(l)}else{const a=new Uint8Array(this.data_.buffer,t,i-t);return new vg(a,!0)}}static getBlob(...t){if(V3()){const i=t.map(a=>a instanceof vg?a.data_:a);return new vg(HBe.apply(null,i))}else{const i=t.map(f=>U3(f)?qBe(ip.RAW,f).data:f.data_);let a=0;i.forEach(f=>{a+=f.byteLength});const l=new Uint8Array(a);let d=0;return i.forEach(f=>{for(let _=0;_<f.length;_++)l[d++]=f[_]}),new vg(l,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hse(n){let t;try{t=JSON.parse(n)}catch{return null}return MBe(t)?t:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZBe(n){if(n.length===0)return null;const t=n.lastIndexOf("/");return t===-1?"":n.slice(0,t)}function e6e(n,t){const i=t.split("/").filter(a=>a.length>0).join("/");return n.length===0?i:n+"/"+i}function $se(n){const t=n.lastIndexOf("/",n.length-2);return t===-1?n:n.slice(t+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t6e(n,t){return t}class Rc{constructor(t,i,a,l){this.server=t,this.local=i||t,this.writable=!!a,this.xform=l||t6e}}let DO=null;function n6e(n){return!U3(n)||n.length<2?n:$se(n)}function Kse(){if(DO)return DO;const n=[];n.push(new Rc("bucket")),n.push(new Rc("generation")),n.push(new Rc("metageneration")),n.push(new Rc("name","fullPath",!0));function t(d,f){return n6e(f)}const i=new Rc("name");i.xform=t,n.push(i);function a(d,f){return f!==void 0?Number(f):f}const l=new Rc("size");return l.xform=a,n.push(l),n.push(new Rc("timeCreated")),n.push(new Rc("updated")),n.push(new Rc("md5Hash",null,!0)),n.push(new Rc("cacheControl",null,!0)),n.push(new Rc("contentDisposition",null,!0)),n.push(new Rc("contentEncoding",null,!0)),n.push(new Rc("contentLanguage",null,!0)),n.push(new Rc("contentType",null,!0)),n.push(new Rc("metadata","customMetadata",!0)),DO=n,DO}function r6e(n,t){function i(){const a=n.bucket,l=n.fullPath,d=new $l(a,l);return t._makeStorageReference(d)}Object.defineProperty(n,"ref",{get:i})}function i6e(n,t,i){const a={};a.type="file";const l=i.length;for(let d=0;d<l;d++){const f=i[d];a[f.local]=f.xform(a,t[f.server])}return r6e(a,n),a}function qse(n,t,i){const a=Hse(t);return a===null?null:i6e(n,a,i)}function s6e(n,t,i,a){const l=Hse(t);if(l===null||!U3(l.downloadTokens))return null;const d=l.downloadTokens;if(d.length===0)return null;const f=encodeURIComponent;return d.split(",").map(b=>{const C=n.bucket,I=n.fullPath,O="/b/"+f(C)+"/o/"+f(I),L=uN(O,i,a),M=Bse({alt:"media",token:b});return L+M})[0]}function o6e(n,t){const i={},a=t.length;for(let l=0;l<a;l++){const d=t[l];d.writable&&(i[d.server]=n[d.local])}return JSON.stringify(i)}class j3{constructor(t,i,a,l){this.url=t,this.method=i,this.handler=a,this.timeout=l,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yse(n){if(!n)throw M3()}function a6e(n,t){function i(a,l){const d=qse(n,l,t);return Yse(d!==null),d}return i}function c6e(n,t){function i(a,l){const d=qse(n,l,t);return Yse(d!==null),s6e(d,l,n.host,n._protocol)}return i}function Xse(n){function t(i,a){let l;return i.getStatus()===401?i.getErrorText().includes("Firebase App Check token is invalid")?l=SBe():l=vBe():i.getStatus()===402?l=EBe(n.bucket):i.getStatus()===403?l=bBe(n.path):l=a,l.status=i.getStatus(),l.serverResponse=a.serverResponse,l}return t}function Jse(n){const t=Xse(n);function i(a,l){let d=t(a,l);return a.getStatus()===404&&(d=yBe(n.path)),d.serverResponse=l.serverResponse,d}return i}function l6e(n,t,i){const a=t.fullServerUrl(),l=uN(a,n.host,n._protocol),d="GET",f=n.maxOperationRetryTime,_=new j3(l,d,c6e(n,i),f);return _.errorHandler=Jse(t),_}function u6e(n,t){const i=t.fullServerUrl(),a=uN(i,n.host,n._protocol),l="DELETE",d=n.maxOperationRetryTime;function f(v,b){}const _=new j3(a,l,f,d);return _.successCodes=[200,204],_.errorHandler=Jse(t),_}function d6e(n,t){return n&&n.contentType||t&&t.type()||"application/octet-stream"}function h6e(n,t,i){const a=Object.assign({},i);return a.fullPath=n.path,a.size=t.size(),a.contentType||(a.contentType=d6e(null,t)),a}function p6e(n,t,i,a,l){const d=t.bucketOnlyServerUrl(),f={"X-Goog-Upload-Protocol":"multipart"};function _(){let re="";for(let ae=0;ae<2;ae++)re=re+Math.random().toString().slice(2);return re}const v=_();f["Content-Type"]="multipart/related; boundary="+v;const b=h6e(t,a,l),C=o6e(b,i),I="--"+v+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+C+`\r
--`+v+`\r
Content-Type: `+b.contentType+`\r
\r
`,O=`\r
--`+v+"--",L=vg.getBlob(I,a,O);if(L===null)throw ABe();const M={name:b.fullPath},F=uN(d,n.host,n._protocol),z="POST",Z=n.maxUploadRetryTime,K=new j3(F,z,a6e(n,i),Z);return K.urlParams=M,K.headers=f,K.body=L.uploadData(),K.errorHandler=Xse(t),K}class f6e{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Vy.NO_ERROR,this.sendPromise_=new Promise(t=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Vy.ABORT,t()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Vy.NETWORK_ERROR,t()}),this.xhr_.addEventListener("load",()=>{t()})})}send(t,i,a,l){if(this.sent_)throw yw("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(i,t,!0),l!==void 0)for(const d in l)l.hasOwnProperty(d)&&this.xhr_.setRequestHeader(d,l[d].toString());return a!==void 0?this.xhr_.send(a):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw yw("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw yw("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw yw("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw yw("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",t)}}class m6e extends f6e{initXhr(){this.xhr_.responseType="text"}}function F3(){return new m6e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{constructor(t,i){this._service=t,i instanceof $l?this._location=i:this._location=$l.makeFromUrl(i,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,i){return new Xy(t,i)}get root(){const t=new $l(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return $se(this._location.path)}get storage(){return this._service}get parent(){const t=ZBe(this._location.path);if(t===null)return null;const i=new $l(this._location.bucket,t);return new Xy(this._service,i)}_throwIfRoot(t){if(this._location.path==="")throw kBe(t)}}function g6e(n,t,i){n._throwIfRoot("uploadBytes");const a=p6e(n.storage,n._location,Kse(),new vg(t,!0),i);return n.storage.makeRequestWithTokens(a,F3).then(l=>({metadata:l,ref:n}))}function _6e(n){n._throwIfRoot("getDownloadURL");const t=l6e(n.storage,n._location,Kse());return n.storage.makeRequestWithTokens(t,F3).then(i=>{if(i===null)throw PBe();return i})}function y6e(n){n._throwIfRoot("deleteObject");const t=u6e(n.storage,n._location);return n.storage.makeRequestWithTokens(t,F3)}function E6e(n,t){const i=e6e(n._location.path,t),a=new $l(n._location.bucket,i);return new Xy(n.storage,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v6e(n){return/^[A-Za-z]+:\/\//.test(n)}function S6e(n,t){return new Xy(n,t)}function Qse(n,t){if(n instanceof B3){const i=n;if(i._bucket==null)throw IBe();const a=new Xy(i,i._bucket);return t!=null?Qse(a,t):a}else return t!==void 0?E6e(n,t):n}function b6e(n,t){if(t&&v6e(t)){if(n instanceof B3)return S6e(n,t);throw GV("To use ref(service, url), the first argument must be a Storage instance.")}else return Qse(n,t)}function kJ(n,t){const i=t==null?void 0:t[jse];return i==null?null:$l.makeFromBucketSpec(i,n)}function T6e(n,t,i,a={}){n.host=`${t}:${i}`,n._protocol="http";const{mockUserToken:l}=a;l&&(n._overrideAuthToken=typeof l=="string"?l:ure(l,n.app.options.projectId))}class B3{constructor(t,i,a,l,d){this.app=t,this._authProvider=i,this._appCheckProvider=a,this._url=l,this._firebaseVersion=d,this._bucket=null,this._host=Vse,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=gBe,this._maxUploadRetryTime=_Be,this._requests=new Set,l!=null?this._bucket=$l.makeFromBucketSpec(l,this._host):this._bucket=kJ(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,this._url!=null?this._bucket=$l.makeFromBucketSpec(this._url,t):this._bucket=kJ(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){OJ("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){OJ("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const i=await t.getToken();if(i!==null)return i.accessToken}return null}async _getAppCheckToken(){if(Wl(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=this._appCheckProvider.getImmediate({optional:!0});return t?(await t.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(t=>t.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new Xy(this,t)}_makeRequest(t,i,a,l,d=!0){if(this._deleted)return new NBe(Fse());{const f=WBe(t,this._appId,a,l,i,this._firebaseVersion,d);return this._requests.add(f),f.getPromise().then(()=>this._requests.delete(f),()=>this._requests.delete(f)),f}}async makeRequestWithTokens(t,i){const[a,l]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,i,a,l).getPromise()}}const NJ="@firebase/storage",DJ="0.13.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zse="storage";function dN(n,t,i){return n=us(n),g6e(n,t,i)}function yR(n){return n=us(n),_6e(n)}function hN(n){return n=us(n),y6e(n)}function em(n,t){return n=us(n),b6e(n,t)}function tm(n=WF(),t){n=us(n);const a=j1(n,Zse).getImmediate({identifier:t}),l=are("storage");return l&&w6e(a,...l),a}function w6e(n,t,i,a={}){T6e(n,t,i,a)}function C6e(n,{instanceIdentifier:t}){const i=n.getProvider("app").getImmediate(),a=n.getProvider("auth-internal"),l=n.getProvider("app-check-internal");return new B3(i,a,l,t,Zy)}function R6e(){Hy(new Ng(Zse,C6e,"PUBLIC").setMultipleInstances(!0)),pp(NJ,DJ,""),pp(NJ,DJ,"esm2017")}R6e();const fk=async n=>{const t=tm(),i=em(t,n);try{return await yR(i)}catch(a){throw $.error("Failed to fetch HTTP URL from gs:// URL:","/src/packages/shared/firebase/firebaseStorage.js",a),a}};let Jy={};const Gu=async n=>{try{const t=gr(zn,"spaces",n),i=await go(t);if(i.exists()){let a=i.data();const l=a.name,d=a.description;if(a.webglBuildId){const f=gr(zn,"webglBuilds",a.webglBuildId),_=await go(f);if(_.exists()){const v=_.data();a={...a,...v,name:l||v.name,description:d||v.description}}else $.warn(`spacesFirestore: No document found for webglBuildId: ${a.webglBuildId}`)}return a=await I6e(a),a=A6e(a),console.log("Space data:",a),$.log(`spacesFirestore: Caching space data for: ${n}`),Jy[n]=a,a}else return $.warn(`spacesFirestore: No document found for item ID: ${n}`),null}catch(t){throw $.error("spacesFirestore: Error fetching item data:",t),t}},I6e=async n=>{const i=["gsUrlCode","gsUrlData","gsUrlFramework","gsUrlLoader","gsUrlLoadingBackground"].map(async a=>{const l=n[a];l&&l.startsWith("gs://")&&(n[a]=await fk(l))});return await Promise.all(i),n},A6e=n=>{const{gsUrlCode:t,gsUrlData:i,gsUrlFramework:a,gsUrlLoader:l,...d}=n;return{...d,codeUrl:t,dataUrl:i,frameworkUrl:a,loaderUrl:l}};let uU={};const eoe=async n=>{$.log("spacesFirestore: Get Videos from Firestore for space: ",n);try{if(uU[n])return $.log("spacesFirestore: Returning cached videos for space:",n),uU[n];const t=Ql(zn,`spaces/${n}/videos`),i=await qu(t),a=[];return i.forEach(l=>{a.push({id:l.id,...l.data()})}),uU[n]=a,a}catch(t){throw $.error("spacesFirestore: Error fetching Space videos from Firestore:",t),t}},P6e=async(n,t)=>{try{if(!n||!t)throw new Error("Missing required parameters: spaceId and logoFile");if(!t.type.startsWith("image/"))throw new Error("File must be an image");const i=tm(),a=Date.now(),l=t.name.split(".").pop(),d=`logo_${a}.${l}`,f=em(i,`spaces/${n}/logo/${d}`);$.log(`Uploading logo for space ${n}`);const _=await dN(f,t),v=await yR(_.ref),b=gr(zn,"spaces",n);return await Gs(b,{logoUrl:v,logoGsUrl:`gs://${_.ref.bucket}/${_.ref.fullPath}`,logoFileName:d,updatedAt:new Date().toISOString()}),$.log(`Successfully uploaded logo for space ${n}`),v}catch(i){throw $.error("Error uploading space logo:",i),i}},O6e=async n=>{try{const t=gr(zn,"spaces",n),i=await go(t);if(!i.exists())return $.warn(`No space found with ID: ${n}`),!1;const a=i.data();if(a.logoGsUrl){const l=tm(),d=em(l,a.logoGsUrl);try{await hN(d),$.log(`Deleted logo file from storage: ${a.logoGsUrl}`)}catch(f){$.warn(`Could not delete logo file from storage: ${f.message}`)}}return await Gs(t,{logoUrl:null,logoGsUrl:null,logoFileName:null,updatedAt:new Date().toISOString()}),$.log(`Successfully removed logo for space ${n}`),!0}catch(t){throw $.error("Error deleting space logo:",t),t}},k6e=async(n,t)=>{try{if(!n||!t)throw new Error("Missing required parameters: spaceId and backgroundFile");if(!t.type.startsWith("image/"))throw new Error("File must be an image");const i=tm(),a=Date.now(),l=t.name.split(".").pop(),d=`background_${a}.${l}`,f=em(i,`spaces/${n}/background/${d}`);$.log(`Uploading background for space ${n}`);const _=await dN(f,t),v=await yR(_.ref),b=gr(zn,"spaces",n);return await Gs(b,{backgroundUrl:v,backgroundGsUrl:`gs://${_.ref.bucket}/${_.ref.fullPath}`,backgroundFileName:d,gsUrlLoadingBackground:`gs://${_.ref.bucket}/${_.ref.fullPath}`,updatedAt:new Date().toISOString()}),$.log(`Successfully uploaded background for space ${n}`),v}catch(i){throw $.error("Error uploading space background:",i),i}},N6e=async n=>{try{const t=gr(zn,"spaces",n),i=await go(t);if(!i.exists())return $.warn(`No space found with ID: ${n}`),!1;const a=i.data();if(a.backgroundGsUrl){const l=tm(),d=em(l,a.backgroundGsUrl);try{await hN(d),$.log(`Deleted background file from storage: ${a.backgroundGsUrl}`)}catch(f){$.warn(`Could not delete background file from storage: ${f.message}`)}}return await Gs(t,{backgroundUrl:null,backgroundGsUrl:null,backgroundFileName:null,gsUrlLoadingBackground:null,updatedAt:new Date().toISOString()}),$.log(`Successfully removed background references for space ${n}`),!0}catch(t){throw $.error("Error deleting space background:",t),t}},D6e=async(n,t)=>{try{$.log(`spacesFirestore: Updating settings for space: ${n}`,t);const i=gr(zn,"spaces",n),a=await go(i);if(!a.exists())throw new Error(`Space with ID ${n} not found`);const l=a.data(),d={...t,accessibleToAllUsers:t.accessibleToAllUsers!==void 0?t.accessibleToAllUsers:l.accessibleToAllUsers!==void 0?l.accessibleToAllUsers:!0,updatedAt:new Date().toISOString()};await Gs(i,d),Jy[n]&&delete Jy[n],$.log(`spacesFirestore: Successfully updated settings for space: ${n}`)}catch(i){throw $.error(`spacesFirestore: Error updating settings for space: ${n}`,i),i}},x6e=async(n,t)=>{try{$.log(`spacesFirestore: Setting accessibleToAllUsers=${t} for space: ${n}`);const i=gr(zn,"spaces",n);if(!(await go(i)).exists())throw new Error(`Space with ID ${n} not found`);await Gs(i,{accessibleToAllUsers:t,updatedAt:new Date().toISOString()}),Jy[n]&&delete Jy[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceAccessibilityChanged",{detail:{spaceId:n,accessibleToAllUsers:t}})),$.log(`spacesFirestore: Successfully updated accessibleToAllUsers for space: ${n}`)}catch(i){throw $.error(`spacesFirestore: Error updating accessibleToAllUsers for space: ${n}`,i),i}},HV=async(n,t)=>{try{$.log(`spacesFirestore: Updating HLS stream for space: ${n}`,t);const i=gr(zn,"spaces",n);if(!(await go(i)).exists())throw new Error(`Space with ID ${n} not found`);const{streamUrl:l,playerIndex:d="0",enabled:f=!0,rtmpUrl:_="",streamKey:v=""}=t,b={HLSStreamURL:{streamUrl:l,playerIndex:d,enabled:f,rtmpUrl:_,streamKey:v,updatedAt:new Date().toISOString()},updatedAt:new Date().toISOString()};return await Gs(i,b),Jy[n]&&delete Jy[n],typeof window<"u"&&window.dispatchEvent(new CustomEvent("SpaceHLSStreamUpdated",{detail:{spaceId:n,streamUrl:l,playerIndex:d,enabled:f,rtmpUrl:_,streamKey:v}})),$.log(`spacesFirestore: Successfully updated HLS stream for space: ${n}`),!0}catch(i){throw $.error(`spacesFirestore: Error updating HLS stream for space: ${n}`,i),i}},toe=async n=>{try{$.log(`spacesFirestore: Getting HLS stream for space: ${n}`);const t=gr(zn,"spaces",n),i=await go(t);if(!i.exists())return $.warn(`spacesFirestore: Space with ID ${n} not found`),null;const a=i.data();return a.HLSStreamURL?($.log(`spacesFirestore: Found HLS stream for space: ${n}`,a.HLSStreamURL),a.HLSStreamURL):($.log(`spacesFirestore: No HLS stream found for space: ${n}`),null)}catch(t){throw $.error(`spacesFirestore: Error getting HLS stream for space: ${n}`,t),t}},L6e=async(n,t)=>{try{if(!n||!t)throw new Error("Missing required parameters: spaceId and videoFile");if(!t.type.startsWith("video/"))throw new Error("File must be a video");const i=5*1024*1024;if(t.size>i)throw new Error("Video file must be smaller than 5MB");const a=tm(),l=Date.now(),d=t.name.split(".").pop(),f=`video_bg_${l}.${d}`,_=em(a,`spaces/${n}/video_background/${f}`);$.log(`Uploading video background for space ${n}`);const v=await dN(_,t),b=await yR(v.ref),C=gr(zn,"spaces",n);return await Gs(C,{videoBackgroundUrl:b,videoBackgroundGsUrl:`gs://${v.ref.bucket}/${v.ref.fullPath}`,videoBackgroundFileName:f,updatedAt:new Date().toISOString()}),$.log(`Successfully uploaded video background for space ${n}`),b}catch(i){throw $.error("Error uploading space video background:",i),i}},M6e=async n=>{try{if(!n)throw new Error("Missing required parameter: spaceId");const t=gr(zn,"spaces",n),i=await go(t);if(!i.exists())throw new Error(`Space with ID ${n} not found`);const a=i.data();if(!a.videoBackgroundGsUrl){$.log(`No video background found for space ${n}`);return}const l=tm(),f=a.videoBackgroundGsUrl.replace("gs://",""),[_,...v]=f.split("/"),b=v.join("/"),C=em(l,b);try{await hN(C),$.log(`Deleted video background file from storage for space ${n}`)}catch(I){$.error(`Failed to delete video background file, it may not exist: ${I.message}`)}await Gs(t,{videoBackgroundUrl:null,videoBackgroundGsUrl:null,videoBackgroundFileName:null,updatedAt:new Date().toISOString()}),$.log(`Successfully removed video background for space ${n}`)}catch(t){throw $.error("Error deleting space video background:",t),t}},Nc=N.createContext(null),U6e=N.createContext(null),V6e=({children:n})=>{const[t,i]=N.useState(null),a=N.useRef(null),[l,d]=N.useState(!0),[f,_]=N.useState(!1),v=W1(),b=ne=>ne?ne.Nickname?ne.Nickname:`${ne.firstName} ${ne.lastName}`:"Anon";N.useEffect(()=>{const ne=Oje(v,async pe=>{if($.log("UserProvider: Firebase onAuthStateChanged() fired"),pe)try{const X=await Yu(pe.uid),J=b(X),Q={uid:pe.uid,email:pe.email,emailVerified:pe.emailVerified,...X,displayName:J};$.log(`UserProvider: User authenticated: ${pe.uid}`),i(Q),a.current=Q,L(Q)}catch(X){$.error("UserProvider: Error fetching user profile data:",X)}else i(null),a.current=null;d(!1)});return()=>{ne&&ne()}},[]);const C=async(ne,pe,X)=>{try{_(!0),$.log("UserProvider: Starting registration process"),$.log("UserProvider: Registration includes fields:",Object.keys(X||{}).join(", "));const J={...X},Q=["firstName","lastName","username","companyName","linkedInProfile"],se=Q.filter(Re=>!J[Re]);se.length>0&&$.warn(`UserProvider: Registration missing fields: ${se.join(", ")}`);const de=J.firstName&&J.lastName?`${J.firstName}${J.lastName.charAt(0).toUpperCase()}`:"";$.log("UserProvider: Generated default nickname for registration");const he={firstName:"",lastName:"",companyName:"",linkedInProfile:"",username:"",Nickname:J.Nickname||de,groups:["users"],rpmURL:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",...J};$.log("UserProvider: Prepared registration data with fields:",Object.keys(he).join(", "));const le=await cBe(ne,pe,he);$.log("UserProvider: Registration successful, received user data");const Oe=Q.filter(Re=>!le[Re]);Oe.length>0&&$.warn(`UserProvider: Returned user data missing fields: ${Oe.join(", ")}`),["firstName","lastName","Nickname","username","companyName"].forEach(Re=>{le[Re]||($.warn(`UserProvider: ${Re} is missing in returned data, using original value`),le[Re]=he[Re])});const xe={uid:le.uid,email:le.email,...le,displayName:b(le)};return $.log("UserProvider: Created user object with fields:",Object.keys(xe).join(", ")),i(xe),a.current=xe,$.log("UserProvider: User registered successfully with groups:",he.groups),await new Promise(Re=>setTimeout(Re,2e3)),_(!1),xe}catch(J){throw _(!1),$.error("UserProvider: Error during registration:",J),J}},I=async(ne,pe,X)=>{try{if($.log("UserProvider: Signing in user"),!X)throw new Error("CAPTCHA verification is required");const Q=(await Ije(v,ne,pe)).user;return $.log("UserProvider: User signed in successfully:",Q.email),Q}catch(J){throw $.error("UserProvider: Error signing in:",J),J}},O=async()=>{try{await kje(v),i(null),$.log("UserProvider: User signed out.")}catch(ne){throw $.error("UserProvider: Error signing out:",ne),ne}},L=()=>{const ne=a.current;if(ne){const pe=M(ne);$.log("UserProvider: sendUserToUnity() using the eventBus",pe),Gd.publish(Wd.sendUserToUnity,pe)}else $.log("UserProvider: No current user to send to Unity.")},M=ne=>{const pe={};return[...fBe,"uid"].forEach(J=>{ne.hasOwnProperty(J)&&(pe[J]=ne[J])}),pe},F=async ne=>!t||!t.uid?!1:await lN(t.uid,ne),z=async ne=>{if(!t||!t.uid)return!1;try{const pe=await Gu(ne);if(pe.usersAllowed.includes(t.uid)||pe.userAdmin.includes(t.uid)||pe.usersModerators.includes(t.uid))return!0;if(t.groups&&Array.isArray(t.groups)){const J=`space_${ne}_owners`,Q=`space_${ne}_hosts`;if(t.groups.includes(J)||t.groups.includes(Q))return $.log(`UserProvider: User ${t.uid} has access to space ${ne} as owner/host`),!0}return pe.accessibleToAllUsers===!0&&t.groups?t.groups.includes("users"):!1}catch(pe){return $.error("UserProvider: Error verifying user access to space:",pe),!1}},Z=async ne=>{if(!t||!t.uid)return!1;try{return(await Gu(ne)).userAdmin.includes(t.uid)}catch(pe){return $.error("UserProvider: Error verifying user admin status for space:",pe),!1}},K=async ne=>{if(!t||!t.uid)return!1;try{return(await Gu(ne)).usersModerators.includes(t.uid)}catch(pe){return $.error("UserProvider: Error verifying user moderator status for space:",pe),!1}},re=async()=>{try{const ne=v.currentUser;return ne&&!ne.emailVerified?(await zre(ne),$.log("UserProvider: Verification email resent to:",ne.email),!0):!1}catch(ne){throw $.error("UserProvider: Error resending verification email:",ne),ne}},ae=async()=>{try{const ne=v.currentUser;if(!ne)return $.warn("UserProvider: updateUser called but no current user exists"),null;$.log("UserProvider: Updating user data from Firestore");const pe=await Yu(ne.uid);if(!pe)return $.error("UserProvider: Failed to fetch updated user profile"),null;const X=b(pe),J={uid:ne.uid,email:ne.email,emailVerified:ne.emailVerified,...pe,displayName:X};return $.log("UserProvider: User data updated with fields:",Object.keys(J).join(", ")),i(J),a.current=J,L(J),J}catch(ne){throw $.error("UserProvider: Error updating user data:",ne),ne}};return T.jsx(U6e.Provider,{value:{registrationInProgress:f},children:T.jsx(Nc.Provider,{value:{user:t,loading:l,register:C,signIn:I,signOut:O,sendUserToUnity:L,isUserInGroup:F,userHasAccessToSpace:z,userIsAdminOfSpace:Z,userIsModeratorOfSpace:K,resendVerificationEmail:re,updateUser:ae},children:n})})},noe=N.createContext(),Yd=()=>N.useContext(noe),j6e=({children:n})=>{const[t,i]=N.useState(!1),a=N.useRef(null),[l,d]=N.useState(!1);N.useEffect(()=>{const v=()=>{const b=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);d(b)};return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[]);const f=N.useCallback(v=>{a.current=v},[]),_=N.useCallback(()=>{const v=a.current;if(!v)return;const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;if(l){console.log("Attempting mobile fullscreen...");const C=v.querySelector("video")||v;if(/iPhone|iPad|iPod/i.test(navigator.userAgent)){if(C.webkitEnterFullscreen)try{C.webkitEnterFullscreen(),i(!0);return}catch(I){console.error("iOS fullscreen error:",I)}try{if(C.webkitRequestFullscreen){C.webkitRequestFullscreen(),i(!0);return}}catch(I){console.error("iOS fallback fullscreen error:",I)}}if(/Android/i.test(navigator.userAgent))try{b?(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),i(!1)):(v.requestFullscreen?v.requestFullscreen():v.webkitRequestFullscreen?v.webkitRequestFullscreen():v.mozRequestFullScreen?v.mozRequestFullScreen():v.msRequestFullscreen&&v.msRequestFullscreen(),i(!0));return}catch(I){console.error("Android fullscreen error:",I)}}try{b?document.exitFullscreen?document.exitFullscreen().then(()=>{i(!1)}).catch(C=>console.error("Error exiting fullscreen:",C)):document.webkitExitFullscreen?(document.webkitExitFullscreen(),i(!1)):document.mozCancelFullScreen?(document.mozCancelFullScreen(),i(!1)):document.msExitFullscreen&&(document.msExitFullscreen(),i(!1)):v.requestFullscreen?v.requestFullscreen().then(()=>{i(!0)}).catch(C=>console.error("Error entering fullscreen:",C)):v.webkitRequestFullscreen?(v.webkitRequestFullscreen(),i(!0)):v.mozRequestFullScreen?(v.mozRequestFullScreen(),i(!0)):v.msRequestFullscreen&&(v.msRequestFullscreen(),i(!0))}catch(C){console.error("Fullscreen error:",C)}},[l]);return N.useEffect(()=>{const v=()=>{const b=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;i(!!b)};return document.addEventListener("fullscreenchange",v),document.addEventListener("webkitfullscreenchange",v),document.addEventListener("mozfullscreenchange",v),document.addEventListener("MSFullscreenChange",v),()=>{document.removeEventListener("fullscreenchange",v),document.removeEventListener("webkitfullscreenchange",v),document.removeEventListener("mozfullscreenchange",v),document.removeEventListener("MSFullscreenChange",v)}},[]),T.jsx(noe.Provider,{value:{isFullscreen:t,toggleFullscreen:_,fullscreenRef:a,setFullscreenRef:f,isMobile:l},children:T.jsx("div",{ref:f,style:{position:"relative",zIndex:1,width:"100%",height:"100%",overflow:"hidden"},children:n})})};var dU={},Ew={},vw={},xJ;function F6e(){if(xJ)return vw;xJ=1,Object.defineProperty(vw,"__esModule",{value:!0}),vw.useUnityCanvasId=void 0;var n=Hu(),t=0,i="react-unity-webgl-canvas",a=function(l){if(l.id!==void 0)return l.id;var d=(0,n.useMemo)(function(){return[i,++t].join("-")},[]);return d};return vw.useUnityCanvasId=a,vw}var Tf={},Sw={},LJ;function roe(){if(LJ)return Sw;LJ=1,Object.defineProperty(Sw,"__esModule",{value:!0}),Sw.UnityLoaderStatus=void 0;var n;return function(t){t.Idle="Idle",t.Loading="Loading",t.Loaded="Loaded",t.Error="Error"}(n||(Sw.UnityLoaderStatus=n={})),Sw}var bw={},MJ;function z3(){return MJ||(MJ=1,Object.defineProperty(bw,"__esModule",{value:!0}),bw.isBrowserEnvironment=void 0,bw.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),bw}var UJ;function B6e(){if(UJ)return Tf;UJ=1;var n=Tf&&Tf.__awaiter||function(f,_,v,b){function C(I){return I instanceof v?I:new v(function(O){O(I)})}return new(v||(v=Promise))(function(I,O){function L(z){try{F(b.next(z))}catch(Z){O(Z)}}function M(z){try{F(b.throw(z))}catch(Z){O(Z)}}function F(z){z.done?I(z.value):C(z.value).then(L,M)}F((b=b.apply(f,_||[])).next())})},t=Tf&&Tf.__generator||function(f,_){var v={label:0,sent:function(){if(I[0]&1)throw I[1];return I[1]},trys:[],ops:[]},b,C,I,O=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return O.next=L(0),O.throw=L(1),O.return=L(2),typeof Symbol=="function"&&(O[Symbol.iterator]=function(){return this}),O;function L(F){return function(z){return M([F,z])}}function M(F){if(b)throw new TypeError("Generator is already executing.");for(;O&&(O=0,F[0]&&(v=0)),v;)try{if(b=1,C&&(I=F[0]&2?C.return:F[0]?C.throw||((I=C.return)&&I.call(C),0):C.next)&&!(I=I.call(C,F[1])).done)return I;switch(C=0,I&&(F=[F[0]&2,I.value]),F[0]){case 0:case 1:I=F;break;case 4:return v.label++,{value:F[1],done:!1};case 5:v.label++,C=F[1],F=[0];continue;case 7:F=v.ops.pop(),v.trys.pop();continue;default:if(I=v.trys,!(I=I.length>0&&I[I.length-1])&&(F[0]===6||F[0]===2)){v=0;continue}if(F[0]===3&&(!I||F[1]>I[0]&&F[1]<I[3])){v.label=F[1];break}if(F[0]===6&&v.label<I[1]){v.label=I[1],I=F;break}if(I&&v.label<I[2]){v.label=I[2],v.ops.push(F);break}I[2]&&v.ops.pop(),v.trys.pop();continue}F=_.call(f,v)}catch(z){F=[6,z],C=0}finally{b=I=0}if(F[0]&5)throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}};Object.defineProperty(Tf,"__esModule",{value:!0}),Tf.useUnityInstance=void 0;var i=Hu(),a=roe(),l=z3(),d=function(f,_,v,b){(0,i.useEffect)(function(){(function(){return n(void 0,void 0,void 0,function(){var C,I;return t(this,function(O){switch(O.label){case 0:if(l.isBrowserEnvironment===!1)return[2];if(f!==a.UnityLoaderStatus.Loaded||_===null)return b.setUnityInstance(null),b.setInitialisationError(null),[2];O.label=1;case 1:return O.trys.push([1,3,,4]),[4,window.createUnityInstance(_,v,b.setLoadingProgression)];case 2:return C=O.sent(),b.setUnityInstance(C),b.setInitialisationError(null),[3,4];case 3:return I=O.sent(),b.setUnityInstance(null),b.setInitialisationError(I),[3,4];case 4:return[2]}})})})()},[f,_,v,b])};return Tf.useUnityInstance=d,Tf}var Tw={},VJ;function z6e(){if(VJ)return Tw;VJ=1,Object.defineProperty(Tw,"__esModule",{value:!0}),Tw.useUnityArguments=void 0;var n=Hu(),t=function(i){return(0,n.useMemo)(function(){return{dataUrl:i.unityProvider.unityConfig.dataUrl,frameworkUrl:i.unityProvider.unityConfig.frameworkUrl,codeUrl:i.unityProvider.unityConfig.codeUrl,streamingAssetsUrl:i.unityProvider.unityConfig.streamingAssetsUrl,memoryUrl:i.unityProvider.unityConfig.memoryUrl,symbolsUrl:i.unityProvider.unityConfig.symbolsUrl,workerUrl:i.unityProvider.unityConfig.workerUrl,companyName:i.unityProvider.unityConfig.companyName,productName:i.unityProvider.unityConfig.productName,productVersion:i.unityProvider.unityConfig.productVersion,webglContextAttributes:i.unityProvider.unityConfig.webglContextAttributes||{},cacheControl:i.unityProvider.unityConfig.cacheControl||function(){return"must-revalidate"},devicePixelRatio:i.devicePixelRatio||1,autoSyncPersistentDataPath:i.autoSyncPersistentDataPath,matchWebGLToCanvasSize:typeof i.matchWebGLToCanvasSize=="boolean"?i.matchWebGLToCanvasSize:!0,disabledCanvasEvents:i.disabledCanvasEvents||["contextmenu","dragstart"],print:function(a){},printErr:function(a){}}},[])};return Tw.useUnityArguments=t,Tw}var ww={},jJ;function W6e(){if(jJ)return ww;jJ=1,Object.defineProperty(ww,"__esModule",{value:!0}),ww.useUnityLoader=void 0;var n=Hu(),t=z3(),i=roe(),a=function(l){var d=(0,n.useState)(i.UnityLoaderStatus.Loading),f=d[0],_=d[1];return(0,n.useEffect)(function(){if(t.isBrowserEnvironment!==!1){if(l.loaderUrl===null){_(i.UnityLoaderStatus.Idle);return}var v=window.document.querySelector('script[src="'.concat(l.loaderUrl,'"]'));v===null?(v=window.document.createElement("script"),v.type="text/javascript",v.src=l.loaderUrl,v.async=!0,v.setAttribute("data-status","loading"),window.document.body.appendChild(v),v.addEventListener("load",function(){return v==null?void 0:v.setAttribute("data-status","loaded")}),v.addEventListener("error",function(){return v==null?void 0:v.setAttribute("data-status","error")})):_(v.getAttribute("data-status")==="loaded"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error);var b=function(C){return _(C.type==="load"?i.UnityLoaderStatus.Loaded:i.UnityLoaderStatus.Error)};return v.addEventListener("load",b),v.addEventListener("error",b),function(){v!==null&&(v.removeEventListener("load",b),v.removeEventListener("error",b),window.document.body.removeChild(v))}}},[l.loaderUrl]),f};return ww.useUnityLoader=a,ww}var FJ;function G6e(){if(FJ)return Ew;FJ=1,Object.defineProperty(Ew,"__esModule",{value:!0}),Ew.Unity=void 0;var n=Hu(),t=Hu(),i=F6e(),a=B6e(),l=z6e(),d=W6e(),f=(0,t.forwardRef)(function(_,v){var b=(0,t.useRef)(null),C=(0,i.useUnityCanvasId)(_),I=(0,l.useUnityArguments)(_),O=(0,d.useUnityLoader)(_.unityProvider.unityConfig);return(0,a.useUnityInstance)(O,b.current,I,_.unityProvider),(0,n.useImperativeHandle)(v,function(){return b.current}),(0,n.createElement)("canvas",{ref:b,id:C,style:_.style,className:_.className,tabIndex:_.tabIndex})});return Ew.Unity=f,Ew}var wf={},Cw={},BJ;function ioe(){if(BJ)return Cw;BJ=1,Object.defineProperty(Cw,"__esModule",{value:!0}),Cw.errorMessages=void 0;var n={genericNoUnityInstance:"No Unity Instance found.",requestFullscreenNoUnityInstance:"Unable to Set Fullscreen while Unity is not Instantiated.",requestPointerLockNoUnityInstanceOrCanvas:"Unable to Request Pointer Lock while Unity is not Instantiated or the Canvas is not found.",sendMessageNoUnityInstance:"Unable to Send Message while Unity is not Instantiated.",quitNoUnityInstance:"Unable to Quit Unity while Unity is not Instantiated.",screenshotNoUnityInstanceOrCanvas:"Unable to Take Screenshot while Unity is not Instantiated or Canvas is not available.",noEventListener:"Unable to find Event Listener in Event System for Event"};return Cw.errorMessages=n,Cw}var my={},zJ;function H6e(){if(zJ)return my;zJ=1;var n=my&&my.__spreadArray||function(_,v,b){if(b||arguments.length===2)for(var C=0,I=v.length,O;C<I;C++)(O||!(C in v))&&(O||(O=Array.prototype.slice.call(v,0,C)),O[C]=v[C]);return _.concat(O||Array.prototype.slice.call(v))};Object.defineProperty(my,"__esModule",{value:!0}),my.useEventSystem=void 0;var t=Hu(),i=ioe(),a=z3(),l=[],d=function(_){for(var v=[],b=1;b<arguments.length;b++)v[b-1]=arguments[b];var C=void 0;return l.forEach(function(I){C=I.apply(void 0,n([_],v,!1))}),C};a.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=d);var f=function(){var _=(0,t.useRef)([]),v=(0,t.useCallback)(function(I,O){_.current=n(n([],_.current,!0),[{eventName:I,callback:O}],!1)},[_]),b=(0,t.useCallback)(function(I,O){_.current=_.current.filter(function(L){return L.eventName!==I&&L.callback!==O})},[_]),C=(0,t.useCallback)(function(I){for(var O=[],L=1;L<arguments.length;L++)O[L-1]=arguments[L];var M=_.current.find(function(F){return F.eventName===I});if(typeof M>"u"){console.warn(i.errorMessages.noEventListener,{eventName:I});return}return M.callback.apply(M,O)},[_]);return(0,t.useEffect)(function(){return l.push(C),function(){l.splice(l.indexOf(C),1)}},[C]),{addEventListener:v,removeEventListener:b}};return my.useEventSystem=f,my}var Rw={},WJ;function $6e(){if(WJ)return Rw;WJ=1,Object.defineProperty(Rw,"__esModule",{value:!0}),Rw.useNullableState=void 0;var n=Hu(),t=function(i){return(0,n.useState)(i||null)};return Rw.useNullableState=t,Rw}var GJ;function K6e(){if(GJ)return wf;GJ=1;var n=wf&&wf.__awaiter||function(_,v,b,C){function I(O){return O instanceof b?O:new b(function(L){L(O)})}return new(b||(b=Promise))(function(O,L){function M(Z){try{z(C.next(Z))}catch(K){L(K)}}function F(Z){try{z(C.throw(Z))}catch(K){L(K)}}function z(Z){Z.done?O(Z.value):I(Z.value).then(M,F)}z((C=C.apply(_,v||[])).next())})},t=wf&&wf.__generator||function(_,v){var b={label:0,sent:function(){if(O[0]&1)throw O[1];return O[1]},trys:[],ops:[]},C,I,O,L=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return L.next=M(0),L.throw=M(1),L.return=M(2),typeof Symbol=="function"&&(L[Symbol.iterator]=function(){return this}),L;function M(z){return function(Z){return F([z,Z])}}function F(z){if(C)throw new TypeError("Generator is already executing.");for(;L&&(L=0,z[0]&&(b=0)),b;)try{if(C=1,I&&(O=z[0]&2?I.return:z[0]?I.throw||((O=I.return)&&O.call(I),0):I.next)&&!(O=O.call(I,z[1])).done)return O;switch(I=0,O&&(z=[z[0]&2,O.value]),z[0]){case 0:case 1:O=z;break;case 4:return b.label++,{value:z[1],done:!1};case 5:b.label++,I=z[1],z=[0];continue;case 7:z=b.ops.pop(),b.trys.pop();continue;default:if(O=b.trys,!(O=O.length>0&&O[O.length-1])&&(z[0]===6||z[0]===2)){b=0;continue}if(z[0]===3&&(!O||z[1]>O[0]&&z[1]<O[3])){b.label=z[1];break}if(z[0]===6&&b.label<O[1]){b.label=O[1],O=z;break}if(O&&b.label<O[2]){b.label=O[2],b.ops.push(z);break}O[2]&&b.ops.pop(),b.trys.pop();continue}z=v.call(_,b)}catch(Z){z=[6,Z],I=0}finally{C=O=0}if(z[0]&5)throw z[1];return{value:z[0]?z[1]:void 0,done:!0}}};Object.defineProperty(wf,"__esModule",{value:!0}),wf.useUnityContext=void 0;var i=Hu(),a=ioe(),l=H6e(),d=$6e(),f=function(_){var v=(0,d.useNullableState)(),b=v[0],C=v[1],I=(0,i.useState)(0),O=I[0],L=I[1],M=(0,i.useState)(!1),F=M[0],z=M[1],Z=(0,d.useNullableState)(),K=Z[0],re=Z[1],ae=(0,l.useEventSystem)(),ne=(0,i.useRef)({setLoadingProgression:L,setInitialisationError:re,setUnityInstance:C,setIsLoaded:z,unityConfig:_}),pe=(0,i.useCallback)(function(he){if(b===null){console.warn(a.errorMessages.requestFullscreenNoUnityInstance);return}b.SetFullscreen(he===!0?1:0)},[b]),X=(0,i.useCallback)(function(){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.requestPointerLockNoUnityInstanceOrCanvas);return}return b.Module.canvas.requestPointerLock()},[b]),J=(0,i.useCallback)(function(he,le,Oe){if(b===null){console.warn(a.errorMessages.sendMessageNoUnityInstance);return}b.SendMessage(he,le,Oe)},[b]),Q=(0,i.useCallback)(function(he,le){if(b===null||typeof b.Module.canvas>"u"){console.warn(a.errorMessages.screenshotNoUnityInstanceOrCanvas);return}return b.Module.canvas.toDataURL(he,le)},[b]),se=(0,i.useCallback)(function(){return b===null?(console.warn(a.errorMessages.quitNoUnityInstance),Promise.reject()):b.Quit()},[b]),de=(0,i.useCallback)(function(){return n(void 0,void 0,void 0,function(){var he;return t(this,function(le){switch(le.label){case 0:return b===null||typeof b.Module.canvas>"u"?(console.warn(a.errorMessages.genericNoUnityInstance),[2,Promise.reject()]):(he=b.Module.canvas,document.body.appendChild(he),he.style.display="none",[4,se()]);case 1:return le.sent(),he.remove(),[2]}})})},[b]);return(0,i.useEffect)(function(){z(O===1)},[O]),{unityProvider:ne.current,loadingProgression:O,initialisationError:K,isLoaded:F,UNSAFE__unityInstance:b,requestFullscreen:pe,requestPointerLock:X,sendMessage:J,takeScreenshot:Q,unload:se,UNSAFE__detachAndUnloadImmediate:de,addEventListener:ae.addEventListener,removeEventListener:ae.removeEventListener}};return wf.useUnityContext=f,wf}var HJ;function q6e(){return HJ||(HJ=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.useUnityContext=n.Unity=void 0;var t=G6e();Object.defineProperty(n,"Unity",{enumerable:!0,get:function(){return t.Unity}});var i=K6e();Object.defineProperty(n,"useUnityContext",{enumerable:!0,get:function(){return i.useUnityContext}})}(dU)),dU}var soe=q6e();const Vd="[UnityProvider]",$V=N.createContext(),Y6e=({spaceID:n,children:t,loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d,loadingBackground:f,showLoginButton:_,showDisruptiveLogo:v})=>{$.log(`${Vd} Initializing with spaceID:`,n),$.log(`${Vd} Unity URLs:`,{loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d});const{unityProvider:b,loadingProgression:C,isLoaded:I,sendMessage:O,addEventListener:L,removeEventListener:M,error:F}=soe.useUnityContext({loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d}),z={unityProvider:b,loadingProgression:C,isLoaded:I,sendMessage:O,addEventListener:L,removeEventListener:M,error:F,spaceID:n},Z=N.useRef(null),K=N.useRef(Date.now());N.useEffect(()=>{const pe=()=>{document.hidden?($.log(`${Vd} Page hidden, starting keep-alive`),re()):($.log(`${Vd} Page visible, stopping keep-alive`),ae())};return document.addEventListener("visibilitychange",pe),()=>{document.removeEventListener("visibilitychange",pe),ae()}},[]),N.useEffect(()=>{const pe=()=>{K.current=Date.now(),document.hidden&&O("WebGLInputManager","KeepAlive")};return window.addEventListener("mousemove",pe),window.addEventListener("keydown",pe),window.addEventListener("touchstart",pe),()=>{window.removeEventListener("mousemove",pe),window.removeEventListener("keydown",pe),window.removeEventListener("touchstart",pe)}},[O]);const re=()=>{Z.current||(Z.current=setInterval(()=>{I&&document.hidden&&(O("WebGLInputManager","KeepAlive"),$.debug(`${Vd} Sent keep-alive message`))},1e4))},ae=()=>{Z.current&&(clearInterval(Z.current),Z.current=null)};N.useEffect(()=>($.log(`${Vd} Component mounted`),()=>{$.log(`${Vd} Component unmounting`),ae()}),[]),N.useEffect(()=>{$.log(`${Vd} Loading progress:`,C)},[C]),N.useEffect(()=>{I&&($.log(`${Vd} Unity instance loaded for:`,n),document.hidden&&re())},[I,n]),N.useEffect(()=>{F&&$.error(`${Vd} Unity error:`,F)},[F]),$.log(`${Vd} Rendering provider with instance:`,z),N.useEffect(()=>{$.log("UnityProvider: Unity build URLs:",{loaderUrl:i,dataUrl:a,frameworkUrl:l,codeUrl:d})},[i,a,l,d]);const ne=[];if(i||ne.push("loaderUrl"),a||ne.push("dataUrl"),l||ne.push("frameworkUrl"),d||ne.push("codeUrl"),ne.length>0)return $.error(`UnityProvider: Missing required Unity build URLs: ${ne.join(", ")}`),T.jsx($V.Provider,{value:{unityProvider:null,loadingProgression:0,isLoaded:!1,sendMessage:()=>{},addEventListener:()=>{},removeEventListener:()=>{},error:new Error(`Missing required Unity build URLs: ${ne.join(", ")}`),spaceID:n},children:t});try{return N.useEffect(()=>{$.log("UnityProvider: Unity context created:",b),b?$.log("UnityProvider: Unity provider is available"):$.error("UnityProvider: Unity provider is not available"),I?$.log("UnityProvider: Unity is loaded"):$.log("UnityProvider: Unity is not loaded yet")},[b,I]),T.jsx($V.Provider,{value:z,children:t})}catch(pe){return $.error("UnityProvider: Error creating Unity context:",pe),T.jsxs("div",{style:{padding:"20px",color:"red",backgroundColor:"#ffeeee",border:"1px solid red",borderRadius:"5px"},children:[T.jsx("h3",{children:"Unity Error"}),T.jsxs("p",{children:["Error creating Unity context: ",pe.message]}),T.jsx("p",{children:"Please check the console for more details."})]})}},Qo=()=>N.useContext($V),ac=()=>{const{sendMessage:n,isLoaded:t}=Qo(),i=N.useRef([]),a=N.useCallback(()=>{if(t)for(;i.current.length>0;){const{eventName:d,data:f}=i.current.shift();$.log("useSendUnityEvent: Processing queued event to Unity:",d,f);try{n("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:d,data:JSON.stringify(f)}))}catch(_){$.error("useSendUnityEvent: Error sending event to Unity:",_),i.current.unshift({eventName:d,data:f});break}}},[n,t]);return N.useEffect(()=>{const d=setInterval(()=>{a()},1e3);return()=>clearInterval(d)},[a]),N.useCallback((d,f)=>{$.log("useSendUnityEvent: Queuing event for Unity:",d),i.current.push({eventName:d,data:f}),a()},[a])},El=()=>{const{addEventListener:n,removeEventListener:t}=Qo();return N.useCallback((i,a)=>{const l=d=>{$.log(i+" unity message received.");let f=null;if(d)try{f=JSON.parse(d)}catch(_){$.warn("Failed to parse JSON data from Unity message:",_)}a(f)};return n(i,l),()=>{t(i,l)}},[n,t])},ooe=()=>{const[n,t]=N.useState({}),[i,a]=N.useState(!1),[l,d]=N.useState(null),[f,_]=N.useState(0),v=ac(),b=El(),{spaceID:C,sendMessage:I,isLoaded:O}=Qo(),L=N.useCallback((Z,K)=>{if(!Z)return;$.log(`useHLSStream: Sending stream URL to Unity: ${Z} for player ${K}`);const re={identifier:"LiveProjector",playerIndex:K.toString(),streamUrl:Z};if(v("SetHLSStream",re),O&&I)try{$.log("useHLSStream: Sending with ReactIncomingEvent approach"),I("ReactIncomingEvent","HandleEvent",JSON.stringify({eventName:"SetHLSStream",data:JSON.stringify(re)})),$.log("useHLSStream: Sending with direct HLSStream approach"),I("HLSStream","SetHLSStream",JSON.stringify({identifier:"LiveProjector",playerIndex:K.toString(),streamUrl:Z})),$.log("useHLSStream: Sending with most direct approach possible"),I("LiveProjector","SetStreamUrl",Z),I("HLSStreamClient","SetStreamUrl",JSON.stringify({Index:K.toString(),Url:Z}))}catch(ae){$.error("useHLSStream: Error with direct message:",ae)}else $.warn("useHLSStream: Unity not loaded, could not send direct message")},[v,I,O]);N.useEffect(()=>{C&&M(C)},[C]);const M=async Z=>{try{if(!Z){$.warn("useHLSStream: Cannot load stream from Firebase - no spaceID");return}a(!0),$.log(`useHLSStream: Loading stream from Firebase for space ${Z}`);const K=await toe(Z);if(K&&K.streamUrl)if($.log(`useHLSStream: Loaded stream data from Firebase for space ${Z}`,K),d(K),O)$.log("useHLSStream: Unity is loaded, sending stream URL to Unity after delay"),setTimeout(()=>{L(K.streamUrl,K.playerIndex||"0")},500),setTimeout(()=>{$.log("useHLSStream: Sending backup stream URL to Unity after longer delay"),L(K.streamUrl,K.playerIndex||"0")},2e3);else{$.warn("useHLSStream: Unity is not loaded yet, will try again later");const re=setInterval(()=>{O&&($.log("useHLSStream: Unity is now loaded, sending stream URL to Unity"),L(K.streamUrl,K.playerIndex||"0"),clearInterval(re))},1e3);setTimeout(()=>{clearInterval(re)},3e4)}else $.log(`useHLSStream: No saved stream found for space ${Z}`),d(null)}catch(K){$.error(`useHLSStream: Error loading stream from Firebase for space ${Z}`,K)}finally{a(!1)}},F=N.useCallback(async()=>{C&&($.log(`useHLSStream: Forcing reload of stream data for space ${C}`),_(Z=>Z+1),await M(C))},[C]),z=N.useCallback(async(Z,K=0,re={})=>{try{if(!Z||!Z.trim()){$.error("useHLSStream: Invalid stream URL");return}a(!0),$.log(`useHLSStream: Setting HLS stream URL for LiveProjector[${K}]`,Z);const{enabled:ae=!0,rtmpUrl:ne="",streamKey:pe="",skipSendToUnity:X=!1}=re;if(X||L(Z,K),C)try{const J={streamUrl:Z,playerIndex:K.toString(),enabled:ae,rtmpUrl:ne,streamKey:pe,updatedAt:new Date().toISOString()};$.log(`useHLSStream: Saving stream URL to Firebase for space ${C}`,J),await HV(C,J),d(J)}catch(J){throw $.error(`useHLSStream: Error saving stream URL to Firebase for space ${C}`,J),J}else $.warn("useHLSStream: No spaceID available, stream URL not saved to Firebase")}finally{a(!1)}},[L,C]);return N.useEffect(()=>{const K=b("SetHLSStream",re=>{if(re)try{$.log("useHLSStream: Received player status update",re);const{identifier:ae,playerIndex:ne,isReady:pe,isPlaying:X}=re,J=`${ae}_${ne}`;t(Q=>({...Q,[J]:{identifier:ae,playerIndex:ne,isReady:pe,isPlaying:X}}))}catch(ae){$.error("useHLSStream: Error handling player status update",ae)}});return()=>{K()}},[b]),N.useEffect(()=>{if(l&&l.streamUrl){$.log("useHLSStream: Resending saved stream URL to Unity");const Z=setTimeout(()=>{L(l.streamUrl,l.playerIndex||"0")},1e3);return()=>clearTimeout(Z)}},[l,n,L,f]),N.useEffect(()=>{const Z=K=>{if(K.detail){if($.log("useHLSStream: Received stream update event",K.detail),C===K.detail.spaceId)$.log(`useHLSStream: Stream update is for our space ${C}, loading stream data`),M(C);else if(K.detail.streamUrl){$.log(`useHLSStream: Using stream URL directly from event: ${K.detail.streamUrl}`);const re=K.detail.playerIndex||"0";L(K.detail.streamUrl,re),d(K.detail)}}};return window.addEventListener("SpaceHLSStreamUpdated",Z),window.addEventListener("SpaceStreamUpdated",Z),()=>{window.removeEventListener("SpaceHLSStreamUpdated",Z),window.removeEventListener("SpaceStreamUpdated",Z)}},[C,L]),{setHLSStreamUrl:z,playerStatus:n,isLoading:i,savedStreamData:l,reloadStreamData:F}},X6e=()=>{const[n,t]=N.useState(!1),i=El();return N.useEffect(()=>{const l=i("FirstSceneLoaded",()=>{$.log("FirstSceneLoaded unity message received."),t(!0)});return()=>{l()}},[i]),n},J6e=()=>{const[n,t]=N.useState(null),i=El();return console.log(" Nameplate click hook initialized"),N.useEffect(()=>{console.log(" Setting up nameplate click listener...");const d=i("OpenNameplateModal",f=>{if(console.log(" Nameplate click detected!",f),!f){console.warn(" Received empty data in nameplate click handler");return}try{const _=typeof f=="string"?JSON.parse(f):f;t({playerName:_.playerName,playerId:_.playerId,uid:_.uid,isLocalPlayer:_.isLocalPlayer}),console.log(" Processed nameplate data:",_)}catch(_){console.error(" Error processing nameplate data:",_)}});return()=>{console.log(" Cleaning up nameplate click listener"),typeof d=="function"&&d()}},[i]),[n,()=>{console.log(" Resetting nameplate data"),t(null)}]},Q6e=()=>{const n=El(),{sendUserToUnity:t}=N.useContext(Nc);return N.useEffect(()=>{const a=n("RequestUserForUnity",()=>{$.log("React: Request from Unity to send user data"),t()});return()=>{a()}},[n,t]),!0},$J=async(n,t,i,a={})=>{try{const{mediaType:l="image",displayAsVideo:d=!1,directUrl:f=null}=a;if(!n||!t)throw new Error("Missing required parameters: spaceId and mediaScreenId");let _=null;if(i){if(!i.type.startsWith("image/"))throw new Error("File must be an image");const v=tm(),b=Date.now(),C=i.name.split(".").pop(),I=`${t}_${b}.${C}`,O=em(v,`spaces/${n}/mediaScreens/${I}`);$.log(`Uploading image for media screen ${t} in space ${n}`);const L=await dN(O,i);_=await yR(L.ref);const M=gr(zn,`spaces/${n}/mediaScreens`,t);await jg(M,{imageUrl:_,gsUrl:`gs://${L.ref.bucket}/${L.ref.fullPath}`,fileName:I,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else if(f){_=f;const v=gr(zn,`spaces/${n}/mediaScreens`,t);await jg(v,{videoUrl:f,mediaType:l,displayAsVideo:d,uploadedAt:new Date().toISOString(),updatedAt:new Date().toISOString()},{merge:!0})}else throw new Error("Either imageFile or directUrl must be provided");return $.log(`Successfully uploaded ${l} for media screen ${t} (display as video: ${d})`),_}catch(l){throw $.error(`Error uploading media screen ${(a==null?void 0:a.mediaType)||"image"}:`,l),l}},W3=async n=>{$.log(`Getting media screen images for space: ${n}`);try{const t=Ql(zn,`spaces/${n}/mediaScreens`),i=await qu(t),a=[];return i.forEach(l=>{a.push({id:l.id,...l.data()})}),a}catch(t){throw $.error("Error fetching media screen images from Firestore:",t),t}},xf=async(n,t)=>{try{const i=gr(zn,`spaces/${n}/mediaScreens`,t),a=await go(i);return a.exists()?{id:a.id,...a.data()}:($.warn(`No media screen found with ID: ${t}`),null)}catch(i){throw $.error("Error fetching media screen image:",i),i}},Z6e=async(n,t)=>{try{const i=await xf(n,t);if(!i)return $.warn(`No media screen found with ID: ${t} to delete`),!1;if(i.gsUrl){const l=tm(),d=em(l,i.gsUrl);try{await hN(d),$.log(`Deleted file from storage: ${i.gsUrl}`)}catch(f){$.warn(`Could not delete file from storage: ${f.message}`)}}const a=gr(zn,`spaces/${n}/mediaScreens`,t);return i.mediaType==="video"?(await Gs(a,{videoUrl:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),$.log(`Successfully removed video for media screen ${t}`)):(await Gs(a,{imageUrl:null,gsUrl:null,fileName:null,mediaType:null,displayAsVideo:!1,deletedAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),$.log(`Successfully removed image for media screen ${t}`)),!0}catch(i){throw $.error("Error deleting media screen image:",i),i}},eze=async(n,t,i)=>{try{if(!n||!t||typeof i!="boolean")throw new Error("Missing or invalid required parameters");const a=await xf(n,t);if(!a||!a.imageUrl&&!a.videoUrl)return $.warn(`No media screen content found with ID: ${t} to update`),!1;const l=gr(zn,`spaces/${n}/mediaScreens`,t);return await Gs(l,{displayAsVideo:i,updatedAt:new Date().toISOString()}),$.log(`Successfully updated display mode for media screen ${t} to ${i?"video":"image"}`),!0}catch(a){throw $.error("Error updating media screen display mode:",a),a}},tze=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const t=new URL(n),i=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",i&&t.searchParams.set("alt",i),a&&t.searchParams.set("token",a),console.log(`Cleaned Firebase URL from ${n} to ${t.toString()}`),t.toString()}return n}catch(t){return console.error("Error cleaning Firebase URL:",t),n}},aoe=()=>{const{spaceID:n}=Qo(),t=ac(),[i,a]=N.useState(!1);N.useEffect(()=>{if(window.isPlayerInstantiated){$.log("useUnityMediaScreenImages: Unity already ready (via window flag)"),a(!0);return}const l=()=>{$.log("useUnityMediaScreenImages: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),N.useEffect(()=>{if(!i){$.log("useUnityMediaScreenImages: Waiting for Unity to be ready before loading media screens");return}$.log("useUnityMediaScreenImages: Unity is ready, now loading media screens"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await W3(n);$.log("Fetched Media Screen Images",d),d.forEach(f=>{const{id:_,imageUrl:v,displayAsVideo:b,videoUrl:C}=f;let I=null;(!b||!C)&&(I=v?tze(v):null),t("SetMediaScreenImage",{mediaScreenId:_,imageUrl:I,videoUrl:C||null,displayAsVideo:b||!1,timestamp:Date.now()}),$.log(`Sent media screen data for ${_} to Unity (displayAsVideo: ${b})`),b&&C&&(t("SetMediaScreenDisplayMode",{mediaScreenId:_,displayAsVideo:!0,videoUrl:C,timestamp:Date.now()}),$.log(`Set display mode to video for screen ${_}`))})}catch(d){$.error("Error fetching media screen images:",d)}})()},[t,n,i])},nze=()=>{const{spaceID:n}=Qo(),t=ac(),[i,a]=N.useState(!1);N.useEffect(()=>{if(window.isPlayerInstantiated){$.log("useUnityThumbnails: Unity already ready (via window flag)"),a(!0);return}const l=()=>{$.log("useUnityThumbnails: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),N.useEffect(()=>{if(!i){$.log("useUnityThumbnails: Waiting for Unity to be ready before loading thumbnails");return}$.log("useUnityThumbnails: Unity is ready, now loading thumbnails"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=await eoe(n),f=async b=>{const C=`https://vimeo.com/api/oembed.json?url=${b}`,I=await fetch(C);if(!I.ok)throw new Error(`Failed to fetch thumbnail: ${I.statusText}`);const O=await I.json(),L=O.thumbnail_url.replace(/_\d+x\d+/,""),M=["640x360","295x166"];let F=null;for(let z of M){const Z=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${L}_${z}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(Z,{method:"HEAD"})).ok){F=Z;break}}catch(K){console.warn(`Failed to validate thumbnail URL: ${Z}`,K)}}return F||O.thumbnail_url},_=d.map(async b=>{const C=await f(b.url);return{gameObjectName:b.id,thumbnailUrl:C}}),v=await Promise.all(_);$.log("Fetched Thumbnails",v),v.forEach(({gameObjectName:b,thumbnailUrl:C})=>{t("SetThumbnail",{gameObjectName:b,thumbnailUrl:C})})}catch(d){$.error("Error fetching thumbnails:",d)}})()},[t,n,i])},coe=()=>{const[n,t]=N.useState([]),i=El();return N.useEffect(()=>{let a=!0,l=null;const d=()=>{window.unityInstance&&($.log("Requesting fresh player list"),window.unityInstance.SendMessage("NetworkManager","RequestPlayerList"))},f=L=>{if(a){$.log("UpdatePlayerList unity message received.");try{let M=[];if(typeof L=="object"&&L!==null?M=L.players||[]:M=JSON.parse(L).players||[],Array.isArray(M)){const F=Array.from(new Map(M.map(z=>[z.playerId,z])).values());t(F),l&&(clearTimeout(l),l=null)}}catch(M){$.error("Error handling player list data:",M),l||(l=setTimeout(d,1e3))}}},_=()=>{$.log("Player disconnected, requesting fresh player list"),d()},v=()=>{$.log("Player left, requesting fresh player list"),d()};d();const b=i("UpdatePlayerList",f),C=i("PlayerDisconnected",_),I=i("PlayerLeft",v),O=setInterval(d,5e3);return()=>{a=!1,l&&clearTimeout(l),typeof b=="function"&&b(),typeof C=="function"&&C(),typeof I=="function"&&I(),clearInterval(O)}},[i]),n},loe=()=>{const n=ac(),{isLoaded:t}=Qo(),[i,a]=N.useState(!1);N.useEffect(()=>{if(window.isPlayerInstantiated){$.log("usePlacePrefab: Unity already ready (via window flag)"),a(!0);return}const f=()=>{$.log("usePlacePrefab: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",f),()=>{window.removeEventListener("PlayerInstantiated",f)}},[]);const l=N.useCallback((f,_,v,b)=>{const C=_||{x:0,y:1,z:0},I=v||{x:0,y:0,z:0},O=b||{x:1,y:1,z:1};try{const L={prefabName:f||"TestPrefab",position:C,rotation:I,scale:O};return $.log("Sending prefab placement to Unity:",L),n("PlacePrefab",L),!0}catch(L){return $.error("Error placing prefab:",L),!1}},[n]),d=N.useCallback((f,_,v,b)=>{const C=_||{x:0,y:1,z:0},I=v||{x:0,y:0,z:0},O=b||{x:1,y:1,z:1};if(!window.unityInstance)return $.error("Unity not loaded, cannot place prefab directly"),!1;try{const L={prefabName:f||"TestPrefab",position:C,rotation:I,scale:O},M={eventName:"PlacePrefab",data:JSON.stringify(L)};return $.log("Directly sending prefab placement to Unity:",L),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(M)),!0}catch(L){return $.error("Error directly placing prefab:",L),!1}},[]);return{placePrefab:l,directPlacePrefab:d,isUnityLoaded:i&&t}},uoe=()=>{const n=ac(),t=N.useCallback((a,l,d,f,_,v)=>{const b=d||{x:0,y:1.5,z:0},C=f||{x:0,y:0,z:0},I=_||{x:1,y:1,z:1};try{const O={portalId:a,prefabName:l||"PortalObjectPrefab",position:b,rotation:C,scale:I,initialImageUrl:v};return $.log("Sending portal placement to Unity:",O),n("PlacePortalPrefab",O),!0}catch(O){return $.error("Error placing portal:",O),!1}},[n]),i=N.useCallback((a,l,d,f,_,v)=>{const b=d||{x:0,y:1.5,z:0},C=f||{x:0,y:0,z:0},I=_||{x:1,y:1,z:1};try{const O={portalId:a,prefabName:l||"PortalObjectPrefab",position:b,rotation:C,scale:I,initialImageUrl:v},L={eventName:"PlacePortalPrefab",data:JSON.stringify(O)};return $.log("Directly sending portal placement to Unity:",O),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(L)),!0}catch(O){return $.error("Error directly placing portal:",O),!1}},[]);return{placePortal:t,directPlacePortal:i,isUnityLoaded:!0}},doe=()=>{const n=ac(),t=N.useCallback((a,l,d,f,_)=>{const v=d||{x:0,y:0,z:0},b=f||{x:0,y:0,z:0},C=_||{x:1,y:1,z:1};try{const I={hotspotId:a,glbUrl:l,position:v,rotation:b,scale:C};return $.log("Sending seating hotspot placement to Unity:",I),n("SeatingHotspot",I),!0}catch(I){return $.error("Error placing seating hotspot:",I),!1}},[n]),i=N.useCallback((a,l,d,f,_)=>{const v=d||{x:0,y:0,z:0},b=f||{x:0,y:0,z:0},C=_||{x:1,y:1,z:1};try{const I={hotspotId:a,glbUrl:l,position:v,rotation:b,scale:C},O={eventName:"SeatingHotspot",data:JSON.stringify(I)};return $.log("Directly sending seating hotspot placement to Unity:",I),window.unityInstance.SendMessage("ReactIncomingEvent","HandleEvent",JSON.stringify(O)),!0}catch(I){return $.error("Error directly placing seating hotspot:",I),!1}},[]);return{placeCatalogueItem:t,directPlaceCatalogueItem:i,isUnityLoaded:!0}},rze=n=>{const[t,i]=N.useState(null),a=El(),{spaceID:l}=Qo();return N.useEffect(()=>{let f=!0;const v=a("PlayVideo",async b=>{try{const{gameObjectName:C}=b;if(!C){$.error("Game object name is missing in Unity event data.");return}const I=await eoe(l);$.log("SPACES VIDEOS",I);const O=I.find(L=>L.id===C);O&&f?(i(O.url),$.log("Video URL set to:",O.url)):console.error("Video not found for game object:",C)}catch(C){console.error("Error fetching space videos:",C)}});return()=>{f=!1,v()}},[a,l,n]),[t,()=>{i(null)}]};let xO;const ize=new Uint8Array(16);function sze(){if(!xO&&(xO=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!xO))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return xO(ize)}const wa=[];for(let n=0;n<256;++n)wa.push((n+256).toString(16).slice(1));function oze(n,t=0){return wa[n[t+0]]+wa[n[t+1]]+wa[n[t+2]]+wa[n[t+3]]+"-"+wa[n[t+4]]+wa[n[t+5]]+"-"+wa[n[t+6]]+wa[n[t+7]]+"-"+wa[n[t+8]]+wa[n[t+9]]+"-"+wa[n[t+10]]+wa[n[t+11]]+wa[n[t+12]]+wa[n[t+13]]+wa[n[t+14]]+wa[n[t+15]]}const aze=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),KJ={randomUUID:aze};function cze(n,t,i){if(KJ.randomUUID&&!n)return KJ.randomUUID();n=n||{};const a=n.random||(n.rng||sze)();return a[6]=a[6]&15|64,a[8]=a[8]&63|128,oze(a)}const pN="spaces",fN="objects",lze=async(n,t,i)=>{try{const a=gr(zn,pN,n,fN,t),l={...i,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),spaceId:n,objectId:t};return await jg(a,l),$.log(`Saved object ${t} to space ${n}`),!0}catch(a){return $.error("Error saving object to space:",a),!1}},qJ=async n=>{try{const t=Ql(zn,pN,n,fN),i=await qu(t),a=[];return i.forEach(l=>{a.push({id:l.id,...l.data()})}),$.log(`Retrieved ${a.length} objects for space ${n}`),a}catch(t){return $.error("Error getting space objects:",t),[]}},uze=async(n,t)=>{try{const i=gr(zn,pN,n,fN,t);return await J5e(i),$.log(`Deleted object ${t} from space ${n}`),!0}catch(i){return $.error("Error deleting space object:",i),!1}},dze=async(n,t,i)=>{try{const a=gr(zn,pN,n,fN,t),l={...i,updatedAt:new Date().toISOString()};return await Gs(a,l),$.log(`Updated object ${t} in space ${n}`),!0}catch(a){return $.error("Error updating space object:",a),!1}},hze=n=>{const[t,i]=N.useState([]),[a,l]=N.useState(!0),{placePrefab:d,isUnityLoaded:f}=loe();N.useEffect(()=>{(async()=>{if($.log(`useSpaceObjects: loadObjects called for spaceId: ${n}`),!n){$.log("useSpaceObjects: No spaceId provided, skipping loadObjects."),l(!1);return}$.log(`useSpaceObjects: Setting isLoading to true for spaceId: ${n}`),l(!0);try{$.log(`useSpaceObjects: Attempting to getSpaceObjects for spaceId: ${n}`);const O=await qJ(n);$.log(`useSpaceObjects: Got ${(O==null?void 0:O.length)||0} objects for spaceId: ${n}`,O),i(O),$.log(`useSpaceObjects: Attempting to place ${(O==null?void 0:O.length)||0} objects in Unity for spaceId: ${n}`),O&&O.length>0?(O.forEach((L,M)=>{$.log(`useSpaceObjects: Placing object ${M+1}/${O.length}: ${L.prefabName} (ID: ${L.id||L.objectId})`,L),d(L.prefabName,L.position,L.rotation,L.scale)}),$.log(`useSpaceObjects: Finished placing objects in Unity for spaceId: ${n}`)):$.log(`useSpaceObjects: No objects to place in Unity for spaceId: ${n}`)}catch(O){$.error(`useSpaceObjects: Error in loadObjects for spaceId: ${n}:`,O)}finally{$.log(`useSpaceObjects: Setting isLoading to false in finally block for spaceId: ${n}`),l(!1)}})()},[n,d]);const _=N.useCallback(async(I,O,L,M,F={})=>{if(!n)return!1;const z=cze(),Z={prefabName:I,position:O,rotation:L,scale:M,objectId:z,...F};$.log("useSpaceObjects: Saving object with data:",Z);const K=await lze(n,z,Z);return K?(i(re=>[...re,{id:z,...Z}]),$.log("useSpaceObjects: Object saved successfully, local state updated.",{objectId:z})):$.error("useSpaceObjects: Failed to save object to Firestore.",{spaceId:n,objectId:z,prefabName:I}),K},[n]),v=N.useCallback(async I=>{if(!n)return!1;const O=await uze(n,I);return O&&i(L=>L.filter(M=>M.id!==I)),O},[n]),b=N.useCallback(async(I,O)=>{if(!n)return!1;const L=await dze(n,I,O);return L&&i(M=>M.map(F=>F.id===I?{...F,...O}:F)),L},[n]),C=N.useCallback(async()=>{if(n){l(!0);try{const I=await qJ(n);i(I),I.forEach(O=>{d(O.prefabName,O.position,O.rotation,O.scale)})}catch(I){$.error("Error reloading space objects:",I)}finally{l(!1)}}},[n,d]);return{objects:t,isLoading:a,saveObject:_,deleteObject:v,updateObject:b,reloadObjects:C,isUnityLoaded:f}},pze=()=>{const[n,t]=N.useState(null),[i,a]=N.useState(!1),[l,d]=N.useState(null),f=El(),_=ac();N.useEffect(()=>f("KickPlayerResult",I=>{$.log("KickPlayerResult event received:",I),I?(t(I),a(!1),I.success?d(null):d(I.errorMessage||"Failed to kick player")):($.error("Invalid KickPlayerResult data from Unity"),d("Invalid result from Unity"),a(!1))}),[f]);const v=N.useCallback((C,I)=>{var O;try{if(!C){d("Player UID is required");return}a(!0),d(null),t(null);const L={uid:C,requestedBy:I||((O=window.currentUser)==null?void 0:O.uid)};$.log("Sending KickPlayer event to Unity:",L),_("KickPlayer",L)}catch(L){$.error("Error kicking player:",L),d(L.message||"Failed to send kick request"),a(!1)}},[_]),b=N.useCallback(()=>{t(null),d(null),a(!1)},[]);return{kickPlayer:v,isKicking:i,kickResult:n,error:l,resetKickState:b}},fze=n=>{const{placePortal:t}=uoe();N.useEffect(()=>{const i=async()=>{try{const a=Ql(zn,"spaces",n,"portals"),l=await qu(a);if(l.empty){$.log("useSpacePortals: No portals found for space:",n);return}$.log(`useSpacePortals: Found ${l.size} portals for space ${n}`),l.forEach(d=>{const f=d.data();$.log(`useSpacePortals: Placing portal ${f.portalId} in Unity:`,f),t(f.portalId,f.prefabName,f.position,f.rotation,f.scale)})}catch(a){$.error("useSpacePortals: Error loading portals:",a)}};if(window.unityInstance)$.log("useSpacePortals: Unity is ready, loading portals"),i();else{const a=()=>{$.log("useSpacePortals: Unity ready event received, loading portals"),i()};return window.addEventListener("PlayerInstantiated",a),()=>{window.removeEventListener("PlayerInstantiated",a)}}},[n,t])},mze=()=>{const[n,t]=N.useState(null),i=El();return N.useEffect(()=>{console.log("Setting up portal click listener...");const d=i("PortalClicked",f=>{console.log("Portal click event received:",f);try{const _=typeof f=="string"?JSON.parse(f):f;console.log("Parsed portal data:",_),t(_)}catch(_){console.error("Error parsing portal click data:",_,"Data:",f)}});return()=>{console.log("Cleaning up portal click listener"),typeof d=="function"&&d()}},[i]),{clickedPortal:n,clearClickedPortal:()=>{console.log("Clearing clicked portal state"),t(null)}}},gze=()=>{const n=El();N.useEffect(()=>{console.log("Setting up portal navigation listener...");const i=n("PortalNavigate",a=>{console.log(" PORTAL CLICKED BY PLAYER (non-edit mode)");try{const l=typeof a=="string"?JSON.parse(a):a;console.log("Portal data:",l);const d=l.portalId.split("_");if(d.length>=3){const f=d[2];console.log("Navigating to space:",f),window.location.href=`/?spaceId=${f}`}else console.error("Invalid portal ID format:",l.portalId)}catch(l){console.error("Error handling portal navigation:",l)}});return()=>{console.log("Cleaning up portal navigation listener"),typeof i=="function"&&i()}},[n])},_ze=n=>{const{placeCatalogueItem:t}=doe();N.useEffect(()=>{const i=async()=>{try{const a=Ql(zn,"spaces",n,"catalogue"),l=await qu(a);if(l.empty){$.log("useSpaceCatalogueItems: No catalogue items found for space:",n);return}$.log(`useSpaceCatalogueItems: Found ${l.size} items for space ${n}`),l.forEach(d=>{const f=d.data();$.log(`useSpaceCatalogueItems: Placing item ${f.itemId} in Unity:`,f),t(f.itemId,f.glbUrl,f.position,f.rotation,f.scale)})}catch(a){$.error("useSpaceCatalogueItems: Error loading catalogue items:",a)}};if(window.unityInstance)$.log("useSpaceCatalogueItems: Unity is ready, loading catalogue items"),i();else{const a=()=>{$.log("useSpaceCatalogueItems: Unity ready event received, loading catalogue items"),i()};return window.addEventListener("PlayerInstantiated",a),()=>{window.removeEventListener("PlayerInstantiated",a)}}},[n,t])},hoe=()=>{const[n,t]=N.useState(null),i=El();return N.useEffect(()=>{$.log("Setting up seating hotspot click listener...");const d=i("SeatingHotspotClicked",async f=>{$.log(" Seating hotspot click event received from Unity:",f);try{const _=typeof f=="string"?JSON.parse(f):f;$.log(" Parsed Unity click data:",_);const v=_.hotspotId.split("_");if(v.length>=3){const b=v.slice(1,-1).join("_");$.log(" Extracted spaceId:",b);const C=gr(zn,"spaces",b,"catalogue",_.hotspotId);$.log(" Fetching from Firebase path:",`spaces/${b}/catalogue/${_.hotspotId}`);const I=await go(C);if(I.exists()){const O=I.data();$.log(" Fetched Firebase data:",O),$.log(" Firebase position:",O.position),$.log(" Unity position:",_.position);const L={..._,position:O.position||_.position,rotation:O.rotation||_.rotation,scale:O.scale||_.scale};$.log(" Combined data being set:",L),t(L)}else $.warn(" Item not found in Firebase:",_.hotspotId),t(_)}else $.error(" Invalid hotspot ID format:",_.hotspotId),t(_)}catch(_){$.error(" Error handling seating hotspot click:",_,"Data:",f)}});return()=>{$.log("Cleaning up seating hotspot click listener"),typeof d=="function"&&d()}},[i]),{clickedItem:n,clearClickedItem:()=>{$.log("Clearing clicked item state"),t(null)}}},yze=n=>({opacity:1});var ER=n=>n.type==="checkbox",Cy=n=>n instanceof Date,Ac=n=>n==null;const poe=n=>typeof n=="object";var ro=n=>!Ac(n)&&!Array.isArray(n)&&poe(n)&&!Cy(n),Eze=n=>ro(n)&&n.target?ER(n.target)?n.target.checked:n.target.value:n,vze=n=>n.substring(0,n.search(/\.\d+(\.|$)/))||n,Sze=(n,t)=>n.has(vze(t)),bze=n=>{const t=n.constructor&&n.constructor.prototype;return ro(t)&&t.hasOwnProperty("isPrototypeOf")},G3=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Vu(n){let t;const i=Array.isArray(n),a=typeof FileList<"u"?n instanceof FileList:!1;if(n instanceof Date)t=new Date(n);else if(n instanceof Set)t=new Set(n);else if(!(G3&&(n instanceof Blob||a))&&(i||ro(n)))if(t=i?[]:{},!i&&!bze(n))t=n;else for(const l in n)n.hasOwnProperty(l)&&(t[l]=Vu(n[l]));else return n;return t}var mN=n=>Array.isArray(n)?n.filter(Boolean):[],ho=n=>n===void 0,hn=(n,t,i)=>{if(!t||!ro(n))return i;const a=mN(t.split(/[,[\].]+?/)).reduce((l,d)=>Ac(l)?l:l[d],n);return ho(a)||a===n?ho(n[t])?i:n[t]:a},Kh=n=>typeof n=="boolean",H3=n=>/^\w*$/.test(n),foe=n=>mN(n.replace(/["|']|\]/g,"").split(/\.|\[/)),ts=(n,t,i)=>{let a=-1;const l=H3(t)?[t]:foe(t),d=l.length,f=d-1;for(;++a<d;){const _=l[a];let v=i;if(a!==f){const b=n[_];v=ro(b)||Array.isArray(b)?b:isNaN(+l[a+1])?{}:[]}if(_==="__proto__"||_==="constructor"||_==="prototype")return;n[_]=v,n=n[_]}return n};const YJ={BLUR:"blur",FOCUS_OUT:"focusout"},zd={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Cf={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};hi.createContext(null);var Tze=(n,t,i,a=!0)=>{const l={defaultValues:t._defaultValues};for(const d in n)Object.defineProperty(l,d,{get:()=>{const f=d;return t._proxyFormState[f]!==zd.all&&(t._proxyFormState[f]=!a||zd.all),n[f]}});return l},dl=n=>ro(n)&&!Object.keys(n).length,wze=(n,t,i,a)=>{i(n);const{name:l,...d}=n;return dl(d)||Object.keys(d).length>=Object.keys(t).length||Object.keys(d).find(f=>t[f]===zd.all)},mk=n=>Array.isArray(n)?n:[n];function Cze(n){const t=hi.useRef(n);t.current=n,hi.useEffect(()=>{const i=!n.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{i&&i.unsubscribe()}},[n.disabled])}var sp=n=>typeof n=="string",Rze=(n,t,i,a,l)=>sp(n)?(a&&t.watch.add(n),hn(i,n,l)):Array.isArray(n)?n.map(d=>(a&&t.watch.add(d),hn(i,d))):(a&&(t.watchAll=!0),i),Ize=(n,t,i,a,l)=>t?{...i[n],types:{...i[n]&&i[n].types?i[n].types:{},[a]:l||!0}}:{},XJ=n=>({isOnSubmit:!n||n===zd.onSubmit,isOnBlur:n===zd.onBlur,isOnChange:n===zd.onChange,isOnAll:n===zd.all,isOnTouch:n===zd.onTouched}),JJ=(n,t,i)=>!i&&(t.watchAll||t.watch.has(n)||[...t.watch].some(a=>n.startsWith(a)&&/^\.\w+/.test(n.slice(a.length))));const mC=(n,t,i,a)=>{for(const l of i||Object.keys(n)){const d=hn(n,l);if(d){const{_f:f,..._}=d;if(f){if(f.refs&&f.refs[0]&&t(f.refs[0],l)&&!a)return!0;if(f.ref&&t(f.ref,f.name)&&!a)return!0;if(mC(_,t))break}else if(ro(_)&&mC(_,t))break}}};var Aze=(n,t,i)=>{const a=mk(hn(n,i));return ts(a,"root",t[i]),ts(n,i,a),n},$3=n=>n.type==="file",Zh=n=>typeof n=="function",r1=n=>{if(!G3)return!1;const t=n?n.ownerDocument:0;return n instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},gk=n=>sp(n),K3=n=>n.type==="radio",i1=n=>n instanceof RegExp;const QJ={value:!1,isValid:!1},ZJ={value:!0,isValid:!0};var moe=n=>{if(Array.isArray(n)){if(n.length>1){const t=n.filter(i=>i&&i.checked&&!i.disabled).map(i=>i.value);return{value:t,isValid:!!t.length}}return n[0].checked&&!n[0].disabled?n[0].attributes&&!ho(n[0].attributes.value)?ho(n[0].value)||n[0].value===""?ZJ:{value:n[0].value,isValid:!0}:ZJ:QJ}return QJ};const eQ={isValid:!1,value:null};var goe=n=>Array.isArray(n)?n.reduce((t,i)=>i&&i.checked&&!i.disabled?{isValid:!0,value:i.value}:t,eQ):eQ;function tQ(n,t,i="validate"){if(gk(n)||Array.isArray(n)&&n.every(gk)||Kh(n)&&!n)return{type:i,message:gk(n)?n:"",ref:t}}var AS=n=>ro(n)&&!i1(n)?n:{value:n,message:""},nQ=async(n,t,i,a,l,d)=>{const{ref:f,refs:_,required:v,maxLength:b,minLength:C,min:I,max:O,pattern:L,validate:M,name:F,valueAsNumber:z,mount:Z}=n._f,K=hn(i,F);if(!Z||t.has(F))return{};const re=_?_[0]:f,ae=he=>{l&&re.reportValidity&&(re.setCustomValidity(Kh(he)?"":he||""),re.reportValidity())},ne={},pe=K3(f),X=ER(f),J=pe||X,Q=(z||$3(f))&&ho(f.value)&&ho(K)||r1(f)&&f.value===""||K===""||Array.isArray(K)&&!K.length,se=Ize.bind(null,F,a,ne),de=(he,le,Oe,Ve=Cf.maxLength,xe=Cf.minLength)=>{const Re=he?le:Oe;ne[F]={type:he?Ve:xe,message:Re,ref:f,...se(he?Ve:xe,Re)}};if(d?!Array.isArray(K)||!K.length:v&&(!J&&(Q||Ac(K))||Kh(K)&&!K||X&&!moe(_).isValid||pe&&!goe(_).isValid)){const{value:he,message:le}=gk(v)?{value:!!v,message:v}:AS(v);if(he&&(ne[F]={type:Cf.required,message:le,ref:re,...se(Cf.required,le)},!a))return ae(le),ne}if(!Q&&(!Ac(I)||!Ac(O))){let he,le;const Oe=AS(O),Ve=AS(I);if(!Ac(K)&&!isNaN(K)){const xe=f.valueAsNumber||K&&+K;Ac(Oe.value)||(he=xe>Oe.value),Ac(Ve.value)||(le=xe<Ve.value)}else{const xe=f.valueAsDate||new Date(K),Re=ze=>new Date(new Date().toDateString()+" "+ze),ve=f.type=="time",be=f.type=="week";sp(Oe.value)&&K&&(he=ve?Re(K)>Re(Oe.value):be?K>Oe.value:xe>new Date(Oe.value)),sp(Ve.value)&&K&&(le=ve?Re(K)<Re(Ve.value):be?K<Ve.value:xe<new Date(Ve.value))}if((he||le)&&(de(!!he,Oe.message,Ve.message,Cf.max,Cf.min),!a))return ae(ne[F].message),ne}if((b||C)&&!Q&&(sp(K)||d&&Array.isArray(K))){const he=AS(b),le=AS(C),Oe=!Ac(he.value)&&K.length>+he.value,Ve=!Ac(le.value)&&K.length<+le.value;if((Oe||Ve)&&(de(Oe,he.message,le.message),!a))return ae(ne[F].message),ne}if(L&&!Q&&sp(K)){const{value:he,message:le}=AS(L);if(i1(he)&&!K.match(he)&&(ne[F]={type:Cf.pattern,message:le,ref:f,...se(Cf.pattern,le)},!a))return ae(le),ne}if(M){if(Zh(M)){const he=await M(K,i),le=tQ(he,re);if(le&&(ne[F]={...le,...se(Cf.validate,le.message)},!a))return ae(le.message),ne}else if(ro(M)){let he={};for(const le in M){if(!dl(he)&&!a)break;const Oe=tQ(await M[le](K,i),re,le);Oe&&(he={...Oe,...se(le,Oe.message)},ae(Oe.message),a&&(ne[F]=he))}if(!dl(he)&&(ne[F]={ref:re,...he},!a))return ne}}return ae(!0),ne};function Pze(n,t){const i=t.slice(0,-1).length;let a=0;for(;a<i;)n=ho(n)?a++:n[t[a++]];return n}function Oze(n){for(const t in n)if(n.hasOwnProperty(t)&&!ho(n[t]))return!1;return!0}function Oo(n,t){const i=Array.isArray(t)?t:H3(t)?[t]:foe(t),a=i.length===1?n:Pze(n,i),l=i.length-1,d=i[l];return a&&delete a[d],l!==0&&(ro(a)&&dl(a)||Array.isArray(a)&&Oze(a))&&Oo(n,i.slice(0,-1)),n}var hU=()=>{let n=[];return{get observers(){return n},next:l=>{for(const d of n)d.next&&d.next(l)},subscribe:l=>(n.push(l),{unsubscribe:()=>{n=n.filter(d=>d!==l)}}),unsubscribe:()=>{n=[]}}},KV=n=>Ac(n)||!poe(n);function Sg(n,t){if(KV(n)||KV(t))return n===t;if(Cy(n)&&Cy(t))return n.getTime()===t.getTime();const i=Object.keys(n),a=Object.keys(t);if(i.length!==a.length)return!1;for(const l of i){const d=n[l];if(!a.includes(l))return!1;if(l!=="ref"){const f=t[l];if(Cy(d)&&Cy(f)||ro(d)&&ro(f)||Array.isArray(d)&&Array.isArray(f)?!Sg(d,f):d!==f)return!1}}return!0}var _oe=n=>n.type==="select-multiple",kze=n=>K3(n)||ER(n),pU=n=>r1(n)&&n.isConnected,yoe=n=>{for(const t in n)if(Zh(n[t]))return!0;return!1};function s1(n,t={}){const i=Array.isArray(n);if(ro(n)||i)for(const a in n)Array.isArray(n[a])||ro(n[a])&&!yoe(n[a])?(t[a]=Array.isArray(n[a])?[]:{},s1(n[a],t[a])):Ac(n[a])||(t[a]=!0);return t}function Eoe(n,t,i){const a=Array.isArray(n);if(ro(n)||a)for(const l in n)Array.isArray(n[l])||ro(n[l])&&!yoe(n[l])?ho(t)||KV(i[l])?i[l]=Array.isArray(n[l])?s1(n[l],[]):{...s1(n[l])}:Eoe(n[l],Ac(t)?{}:t[l],i[l]):i[l]=!Sg(n[l],t[l]);return i}var Iw=(n,t)=>Eoe(n,t,s1(t)),voe=(n,{valueAsNumber:t,valueAsDate:i,setValueAs:a})=>ho(n)?n:t?n===""?NaN:n&&+n:i&&sp(n)?new Date(n):a?a(n):n;function fU(n){const t=n.ref;return $3(t)?t.files:K3(t)?goe(n.refs).value:_oe(t)?[...t.selectedOptions].map(({value:i})=>i):ER(t)?moe(n.refs).value:voe(ho(t.value)?n.ref.value:t.value,n)}var Nze=(n,t,i,a)=>{const l={};for(const d of n){const f=hn(t,d);f&&ts(l,d,f._f)}return{criteriaMode:i,names:[...n],fields:l,shouldUseNativeValidation:a}},Aw=n=>ho(n)?n:i1(n)?n.source:ro(n)?i1(n.value)?n.value.source:n.value:n;const rQ="AsyncFunction";var Dze=n=>!!n&&!!n.validate&&!!(Zh(n.validate)&&n.validate.constructor.name===rQ||ro(n.validate)&&Object.values(n.validate).find(t=>t.constructor.name===rQ)),xze=n=>n.mount&&(n.required||n.min||n.max||n.maxLength||n.minLength||n.pattern||n.validate);function iQ(n,t,i){const a=hn(n,i);if(a||H3(i))return{error:a,name:i};const l=i.split(".");for(;l.length;){const d=l.join("."),f=hn(t,d),_=hn(n,d);if(f&&!Array.isArray(f)&&i!==d)return{name:i};if(_&&_.type)return{name:d,error:_};l.pop()}return{name:i}}var Lze=(n,t,i,a,l)=>l.isOnAll?!1:!i&&l.isOnTouch?!(t||n):(i?a.isOnBlur:l.isOnBlur)?!n:(i?a.isOnChange:l.isOnChange)?n:!0,Mze=(n,t)=>!mN(hn(n,t)).length&&Oo(n,t);const Uze={mode:zd.onSubmit,reValidateMode:zd.onChange,shouldFocusError:!0};function Vze(n={}){let t={...Uze,...n},i={submitCount:0,isDirty:!1,isLoading:Zh(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},a={},l=ro(t.defaultValues)||ro(t.values)?Vu(t.defaultValues||t.values)||{}:{},d=t.shouldUnregister?{}:Vu(l),f={action:!1,mount:!1,watch:!1},_={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},v,b=0;const C={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},I={values:hU(),array:hU(),state:hU()},O=XJ(t.mode),L=XJ(t.reValidateMode),M=t.criteriaMode===zd.all,F=Te=>je=>{clearTimeout(b),b=setTimeout(Te,je)},z=async Te=>{if(!t.disabled&&(C.isValid||Te)){const je=t.resolver?dl((await J()).errors):await se(a,!0);je!==i.isValid&&I.state.next({isValid:je})}},Z=(Te,je)=>{!t.disabled&&(C.isValidating||C.validatingFields)&&((Te||Array.from(_.mount)).forEach(Ke=>{Ke&&(je?ts(i.validatingFields,Ke,je):Oo(i.validatingFields,Ke))}),I.state.next({validatingFields:i.validatingFields,isValidating:!dl(i.validatingFields)}))},K=(Te,je=[],Ke,gt,Et=!0,wt=!0)=>{if(gt&&Ke&&!t.disabled){if(f.action=!0,wt&&Array.isArray(hn(a,Te))){const Kt=Ke(hn(a,Te),gt.argA,gt.argB);Et&&ts(a,Te,Kt)}if(wt&&Array.isArray(hn(i.errors,Te))){const Kt=Ke(hn(i.errors,Te),gt.argA,gt.argB);Et&&ts(i.errors,Te,Kt),Mze(i.errors,Te)}if(C.touchedFields&&wt&&Array.isArray(hn(i.touchedFields,Te))){const Kt=Ke(hn(i.touchedFields,Te),gt.argA,gt.argB);Et&&ts(i.touchedFields,Te,Kt)}C.dirtyFields&&(i.dirtyFields=Iw(l,d)),I.state.next({name:Te,isDirty:he(Te,je),dirtyFields:i.dirtyFields,errors:i.errors,isValid:i.isValid})}else ts(d,Te,je)},re=(Te,je)=>{ts(i.errors,Te,je),I.state.next({errors:i.errors})},ae=Te=>{i.errors=Te,I.state.next({errors:i.errors,isValid:!1})},ne=(Te,je,Ke,gt)=>{const Et=hn(a,Te);if(Et){const wt=hn(d,Te,ho(Ke)?hn(l,Te):Ke);ho(wt)||gt&&gt.defaultChecked||je?ts(d,Te,je?wt:fU(Et._f)):Ve(Te,wt),f.mount&&z()}},pe=(Te,je,Ke,gt,Et)=>{let wt=!1,Kt=!1;const mn={name:Te};if(!t.disabled){const vn=!!(hn(a,Te)&&hn(a,Te)._f&&hn(a,Te)._f.disabled);if(!Ke||gt){C.isDirty&&(Kt=i.isDirty,i.isDirty=mn.isDirty=he(),wt=Kt!==mn.isDirty);const rn=vn||Sg(hn(l,Te),je);Kt=!!(!vn&&hn(i.dirtyFields,Te)),rn||vn?Oo(i.dirtyFields,Te):ts(i.dirtyFields,Te,!0),mn.dirtyFields=i.dirtyFields,wt=wt||C.dirtyFields&&Kt!==!rn}if(Ke){const rn=hn(i.touchedFields,Te);rn||(ts(i.touchedFields,Te,Ke),mn.touchedFields=i.touchedFields,wt=wt||C.touchedFields&&rn!==Ke)}wt&&Et&&I.state.next(mn)}return wt?mn:{}},X=(Te,je,Ke,gt)=>{const Et=hn(i.errors,Te),wt=C.isValid&&Kh(je)&&i.isValid!==je;if(t.delayError&&Ke?(v=F(()=>re(Te,Ke)),v(t.delayError)):(clearTimeout(b),v=null,Ke?ts(i.errors,Te,Ke):Oo(i.errors,Te)),(Ke?!Sg(Et,Ke):Et)||!dl(gt)||wt){const Kt={...gt,...wt&&Kh(je)?{isValid:je}:{},errors:i.errors,name:Te};i={...i,...Kt},I.state.next(Kt)}},J=async Te=>{Z(Te,!0);const je=await t.resolver(d,t.context,Nze(Te||_.mount,a,t.criteriaMode,t.shouldUseNativeValidation));return Z(Te),je},Q=async Te=>{const{errors:je}=await J(Te);if(Te)for(const Ke of Te){const gt=hn(je,Ke);gt?ts(i.errors,Ke,gt):Oo(i.errors,Ke)}else i.errors=je;return je},se=async(Te,je,Ke={valid:!0})=>{for(const gt in Te){const Et=Te[gt];if(Et){const{_f:wt,...Kt}=Et;if(wt){const mn=_.array.has(wt.name),vn=Et._f&&Dze(Et._f);vn&&C.validatingFields&&Z([gt],!0);const rn=await nQ(Et,_.disabled,d,M,t.shouldUseNativeValidation&&!je,mn);if(vn&&C.validatingFields&&Z([gt]),rn[wt.name]&&(Ke.valid=!1,je))break;!je&&(hn(rn,wt.name)?mn?Aze(i.errors,rn,wt.name):ts(i.errors,wt.name,rn[wt.name]):Oo(i.errors,wt.name))}!dl(Kt)&&await se(Kt,je,Ke)}}return Ke.valid},de=()=>{for(const Te of _.unMount){const je=hn(a,Te);je&&(je._f.refs?je._f.refs.every(Ke=>!pU(Ke)):!pU(je._f.ref))&&qe(Te)}_.unMount=new Set},he=(Te,je)=>!t.disabled&&(Te&&je&&ts(d,Te,je),!Sg(Pe(),l)),le=(Te,je,Ke)=>Rze(Te,_,{...f.mount?d:ho(je)?l:sp(Te)?{[Te]:je}:je},Ke,je),Oe=Te=>mN(hn(f.mount?d:l,Te,t.shouldUnregister?hn(l,Te,[]):[])),Ve=(Te,je,Ke={})=>{const gt=hn(a,Te);let Et=je;if(gt){const wt=gt._f;wt&&(!wt.disabled&&ts(d,Te,voe(je,wt)),Et=r1(wt.ref)&&Ac(je)?"":je,_oe(wt.ref)?[...wt.ref.options].forEach(Kt=>Kt.selected=Et.includes(Kt.value)):wt.refs?ER(wt.ref)?wt.refs.length>1?wt.refs.forEach(Kt=>(!Kt.defaultChecked||!Kt.disabled)&&(Kt.checked=Array.isArray(Et)?!!Et.find(mn=>mn===Kt.value):Et===Kt.value)):wt.refs[0]&&(wt.refs[0].checked=!!Et):wt.refs.forEach(Kt=>Kt.checked=Kt.value===Et):$3(wt.ref)?wt.ref.value="":(wt.ref.value=Et,wt.ref.type||I.values.next({name:Te,values:{...d}})))}(Ke.shouldDirty||Ke.shouldTouch)&&pe(Te,Et,Ke.shouldTouch,Ke.shouldDirty,!0),Ke.shouldValidate&&ze(Te)},xe=(Te,je,Ke)=>{for(const gt in je){const Et=je[gt],wt=`${Te}.${gt}`,Kt=hn(a,wt);(_.array.has(Te)||ro(Et)||Kt&&!Kt._f)&&!Cy(Et)?xe(wt,Et,Ke):Ve(wt,Et,Ke)}},Re=(Te,je,Ke={})=>{const gt=hn(a,Te),Et=_.array.has(Te),wt=Vu(je);ts(d,Te,wt),Et?(I.array.next({name:Te,values:{...d}}),(C.isDirty||C.dirtyFields)&&Ke.shouldDirty&&I.state.next({name:Te,dirtyFields:Iw(l,d),isDirty:he(Te,wt)})):gt&&!gt._f&&!Ac(wt)?xe(Te,wt,Ke):Ve(Te,wt,Ke),JJ(Te,_)&&I.state.next({...i}),I.values.next({name:f.mount?Te:void 0,values:{...d}})},ve=async Te=>{f.mount=!0;const je=Te.target;let Ke=je.name,gt=!0;const Et=hn(a,Ke),wt=()=>je.type?fU(Et._f):Eze(Te),Kt=mn=>{gt=Number.isNaN(mn)||Cy(mn)&&isNaN(mn.getTime())||Sg(mn,hn(d,Ke,mn))};if(Et){let mn,vn;const rn=wt(),Tt=Te.type===YJ.BLUR||Te.type===YJ.FOCUS_OUT,ir=!xze(Et._f)&&!t.resolver&&!hn(i.errors,Ke)&&!Et._f.deps||Lze(Tt,hn(i.touchedFields,Ke),i.isSubmitted,L,O),Ut=JJ(Ke,_,Tt);ts(d,Ke,rn),Tt?(Et._f.onBlur&&Et._f.onBlur(Te),v&&v(0)):Et._f.onChange&&Et._f.onChange(Te);const Wt=pe(Ke,rn,Tt,!1),gn=!dl(Wt)||Ut;if(!Tt&&I.values.next({name:Ke,type:Te.type,values:{...d}}),ir)return C.isValid&&(t.mode==="onBlur"&&Tt?z():Tt||z()),gn&&I.state.next({name:Ke,...Ut?{}:Wt});if(!Tt&&Ut&&I.state.next({...i}),t.resolver){const{errors:Ni}=await J([Ke]);if(Kt(rn),gt){const ys=iQ(i.errors,a,Ke),oi=iQ(Ni,a,ys.name||Ke);mn=oi.error,Ke=oi.name,vn=dl(Ni)}}else Z([Ke],!0),mn=(await nQ(Et,_.disabled,d,M,t.shouldUseNativeValidation))[Ke],Z([Ke]),Kt(rn),gt&&(mn?vn=!1:C.isValid&&(vn=await se(a,!0)));gt&&(Et._f.deps&&ze(Et._f.deps),X(Ke,vn,mn,Wt))}},be=(Te,je)=>{if(hn(i.errors,je)&&Te.focus)return Te.focus(),1},ze=async(Te,je={})=>{let Ke,gt;const Et=mk(Te);if(t.resolver){const wt=await Q(ho(Te)?Te:Et);Ke=dl(wt),gt=Te?!Et.some(Kt=>hn(wt,Kt)):Ke}else Te?(gt=(await Promise.all(Et.map(async wt=>{const Kt=hn(a,wt);return await se(Kt&&Kt._f?{[wt]:Kt}:Kt)}))).every(Boolean),!(!gt&&!i.isValid)&&z()):gt=Ke=await se(a);return I.state.next({...!sp(Te)||C.isValid&&Ke!==i.isValid?{}:{name:Te},...t.resolver||!Te?{isValid:Ke}:{},errors:i.errors}),je.shouldFocus&&!gt&&mC(a,be,Te?Et:_.mount),gt},Pe=Te=>{const je={...f.mount?d:l};return ho(Te)?je:sp(Te)?hn(je,Te):Te.map(Ke=>hn(je,Ke))},we=(Te,je)=>({invalid:!!hn((je||i).errors,Te),isDirty:!!hn((je||i).dirtyFields,Te),error:hn((je||i).errors,Te),isValidating:!!hn(i.validatingFields,Te),isTouched:!!hn((je||i).touchedFields,Te)}),ke=Te=>{Te&&mk(Te).forEach(je=>Oo(i.errors,je)),I.state.next({errors:Te?i.errors:{}})},Ue=(Te,je,Ke)=>{const gt=(hn(a,Te,{_f:{}})._f||{}).ref,Et=hn(i.errors,Te)||{},{ref:wt,message:Kt,type:mn,...vn}=Et;ts(i.errors,Te,{...vn,...je,ref:gt}),I.state.next({name:Te,errors:i.errors,isValid:!1}),Ke&&Ke.shouldFocus&&gt&&gt.focus&&gt.focus()},Be=(Te,je)=>Zh(Te)?I.values.subscribe({next:Ke=>Te(le(void 0,je),Ke)}):le(Te,je,!0),qe=(Te,je={})=>{for(const Ke of Te?mk(Te):_.mount)_.mount.delete(Ke),_.array.delete(Ke),je.keepValue||(Oo(a,Ke),Oo(d,Ke)),!je.keepError&&Oo(i.errors,Ke),!je.keepDirty&&Oo(i.dirtyFields,Ke),!je.keepTouched&&Oo(i.touchedFields,Ke),!je.keepIsValidating&&Oo(i.validatingFields,Ke),!t.shouldUnregister&&!je.keepDefaultValue&&Oo(l,Ke);I.values.next({values:{...d}}),I.state.next({...i,...je.keepDirty?{isDirty:he()}:{}}),!je.keepIsValid&&z()},$e=({disabled:Te,name:je,field:Ke,fields:gt})=>{(Kh(Te)&&f.mount||Te||_.disabled.has(je))&&(Te?_.disabled.add(je):_.disabled.delete(je),pe(je,fU(Ke?Ke._f:hn(gt,je)._f),!1,!1,!0))},it=(Te,je={})=>{let Ke=hn(a,Te);const gt=Kh(je.disabled)||Kh(t.disabled);return ts(a,Te,{...Ke||{},_f:{...Ke&&Ke._f?Ke._f:{ref:{name:Te}},name:Te,mount:!0,...je}}),_.mount.add(Te),Ke?$e({field:Ke,disabled:Kh(je.disabled)?je.disabled:t.disabled,name:Te}):ne(Te,!0,je.value),{...gt?{disabled:je.disabled||t.disabled}:{},...t.progressive?{required:!!je.required,min:Aw(je.min),max:Aw(je.max),minLength:Aw(je.minLength),maxLength:Aw(je.maxLength),pattern:Aw(je.pattern)}:{},name:Te,onChange:ve,onBlur:ve,ref:Et=>{if(Et){it(Te,je),Ke=hn(a,Te);const wt=ho(Et.value)&&Et.querySelectorAll&&Et.querySelectorAll("input,select,textarea")[0]||Et,Kt=kze(wt),mn=Ke._f.refs||[];if(Kt?mn.find(vn=>vn===wt):wt===Ke._f.ref)return;ts(a,Te,{_f:{...Ke._f,...Kt?{refs:[...mn.filter(pU),wt,...Array.isArray(hn(l,Te))?[{}]:[]],ref:{type:wt.type,name:Te}}:{ref:wt}}}),ne(Te,!1,void 0,wt)}else Ke=hn(a,Te,{}),Ke._f&&(Ke._f.mount=!1),(t.shouldUnregister||je.shouldUnregister)&&!(Sze(_.array,Te)&&f.action)&&_.unMount.add(Te)}}},Je=()=>t.shouldFocusError&&mC(a,be,_.mount),Ct=Te=>{Kh(Te)&&(I.state.next({disabled:Te}),mC(a,(je,Ke)=>{const gt=hn(a,Ke);gt&&(je.disabled=gt._f.disabled||Te,Array.isArray(gt._f.refs)&&gt._f.refs.forEach(Et=>{Et.disabled=gt._f.disabled||Te}))},0,!1))},kt=(Te,je)=>async Ke=>{let gt;Ke&&(Ke.preventDefault&&Ke.preventDefault(),Ke.persist&&Ke.persist());let Et=Vu(d);if(_.disabled.size)for(const wt of _.disabled)ts(Et,wt,void 0);if(I.state.next({isSubmitting:!0}),t.resolver){const{errors:wt,values:Kt}=await J();i.errors=wt,Et=Kt}else await se(a);if(Oo(i.errors,"root"),dl(i.errors)){I.state.next({errors:{}});try{await Te(Et,Ke)}catch(wt){gt=wt}}else je&&await je({...i.errors},Ke),Je(),setTimeout(Je);if(I.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:dl(i.errors)&&!gt,submitCount:i.submitCount+1,errors:i.errors}),gt)throw gt},He=(Te,je={})=>{hn(a,Te)&&(ho(je.defaultValue)?Re(Te,Vu(hn(l,Te))):(Re(Te,je.defaultValue),ts(l,Te,Vu(je.defaultValue))),je.keepTouched||Oo(i.touchedFields,Te),je.keepDirty||(Oo(i.dirtyFields,Te),i.isDirty=je.defaultValue?he(Te,Vu(hn(l,Te))):he()),je.keepError||(Oo(i.errors,Te),C.isValid&&z()),I.state.next({...i}))},lt=(Te,je={})=>{const Ke=Te?Vu(Te):l,gt=Vu(Ke),Et=dl(Te),wt=Et?l:gt;if(je.keepDefaultValues||(l=Ke),!je.keepValues){if(je.keepDirtyValues){const Kt=new Set([..._.mount,...Object.keys(Iw(l,d))]);for(const mn of Array.from(Kt))hn(i.dirtyFields,mn)?ts(wt,mn,hn(d,mn)):Re(mn,hn(wt,mn))}else{if(G3&&ho(Te))for(const Kt of _.mount){const mn=hn(a,Kt);if(mn&&mn._f){const vn=Array.isArray(mn._f.refs)?mn._f.refs[0]:mn._f.ref;if(r1(vn)){const rn=vn.closest("form");if(rn){rn.reset();break}}}}a={}}d=t.shouldUnregister?je.keepDefaultValues?Vu(l):{}:Vu(wt),I.array.next({values:{...wt}}),I.values.next({values:{...wt}})}_={mount:je.keepDirtyValues?_.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},f.mount=!C.isValid||!!je.keepIsValid||!!je.keepDirtyValues,f.watch=!!t.shouldUnregister,I.state.next({submitCount:je.keepSubmitCount?i.submitCount:0,isDirty:Et?!1:je.keepDirty?i.isDirty:!!(je.keepDefaultValues&&!Sg(Te,l)),isSubmitted:je.keepIsSubmitted?i.isSubmitted:!1,dirtyFields:Et?{}:je.keepDirtyValues?je.keepDefaultValues&&d?Iw(l,d):i.dirtyFields:je.keepDefaultValues&&Te?Iw(l,Te):je.keepDirty?i.dirtyFields:{},touchedFields:je.keepTouched?i.touchedFields:{},errors:je.keepErrors?i.errors:{},isSubmitSuccessful:je.keepIsSubmitSuccessful?i.isSubmitSuccessful:!1,isSubmitting:!1})},mt=(Te,je)=>lt(Zh(Te)?Te(d):Te,je);return{control:{register:it,unregister:qe,getFieldState:we,handleSubmit:kt,setError:Ue,_executeSchema:J,_getWatch:le,_getDirty:he,_updateValid:z,_removeUnmounted:de,_updateFieldArray:K,_updateDisabledField:$e,_getFieldArray:Oe,_reset:lt,_resetDefaultValues:()=>Zh(t.defaultValues)&&t.defaultValues().then(Te=>{mt(Te,t.resetOptions),I.state.next({isLoading:!1})}),_updateFormState:Te=>{i={...i,...Te}},_disableForm:Ct,_subjects:I,_proxyFormState:C,_setErrors:ae,get _fields(){return a},get _formValues(){return d},get _state(){return f},set _state(Te){f=Te},get _defaultValues(){return l},get _names(){return _},set _names(Te){_=Te},get _formState(){return i},set _formState(Te){i=Te},get _options(){return t},set _options(Te){t={...t,...Te}}},trigger:ze,register:it,handleSubmit:kt,watch:Be,setValue:Re,getValues:Pe,reset:mt,resetField:He,clearErrors:ke,unregister:qe,setError:Ue,setFocus:(Te,je={})=>{const Ke=hn(a,Te),gt=Ke&&Ke._f;if(gt){const Et=gt.refs?gt.refs[0]:gt.ref;Et.focus&&(Et.focus(),je.shouldSelect&&Zh(Et.select)&&Et.select())}},getFieldState:we}}function Soe(n={}){const t=hi.useRef(void 0),i=hi.useRef(void 0),[a,l]=hi.useState({isDirty:!1,isValidating:!1,isLoading:Zh(n.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:n.errors||{},disabled:n.disabled||!1,defaultValues:Zh(n.defaultValues)?void 0:n.defaultValues});t.current||(t.current={...Vze(n),formState:a});const d=t.current.control;return d._options=n,Cze({subject:d._subjects.state,next:f=>{wze(f,d._proxyFormState,d._updateFormState)&&l({...d._formState})}}),hi.useEffect(()=>d._disableForm(n.disabled),[d,n.disabled]),hi.useEffect(()=>{if(d._proxyFormState.isDirty){const f=d._getDirty();f!==a.isDirty&&d._subjects.state.next({isDirty:f})}},[d,a.isDirty]),hi.useEffect(()=>{n.values&&!Sg(n.values,i.current)?(d._reset(n.values,d._options.resetOptions),i.current=n.values,l(f=>({...f}))):d._resetDefaultValues()},[n.values,d]),hi.useEffect(()=>{n.errors&&d._setErrors(n.errors)},[n.errors,d]),hi.useEffect(()=>{d._state.mount||(d._updateValid(),d._state.mount=!0),d._state.watch&&(d._state.watch=!1,d._subjects.state.next({...d._formState})),d._removeUnmounted()}),hi.useEffect(()=>{n.shouldUnregister&&d._subjects.values.next({values:d._getWatch()})},[n.shouldUnregister,d]),t.current.formState=Tze(a,d),t.current}var jze=["sitekey","onChange","theme","type","tabindex","onExpired","onErrored","size","stoken","grecaptcha","badge","hl","isolated"];function qV(){return qV=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},qV.apply(this,arguments)}function Fze(n,t){if(n==null)return{};var i={},a=Object.keys(n),l,d;for(d=0;d<a.length;d++)l=a[d],!(t.indexOf(l)>=0)&&(i[l]=n[l]);return i}function LO(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Bze(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,YV(n,t)}function YV(n,t){return YV=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,l){return a.__proto__=l,a},YV(n,t)}var gN=function(n){Bze(t,n);function t(){var a;return a=n.call(this)||this,a.handleExpired=a.handleExpired.bind(LO(a)),a.handleErrored=a.handleErrored.bind(LO(a)),a.handleChange=a.handleChange.bind(LO(a)),a.handleRecaptchaRef=a.handleRecaptchaRef.bind(LO(a)),a}var i=t.prototype;return i.getCaptchaFunction=function(l){return this.props.grecaptcha?this.props.grecaptcha.enterprise?this.props.grecaptcha.enterprise[l]:this.props.grecaptcha[l]:null},i.getValue=function(){var l=this.getCaptchaFunction("getResponse");return l&&this._widgetId!==void 0?l(this._widgetId):null},i.getWidgetId=function(){return this.props.grecaptcha&&this._widgetId!==void 0?this._widgetId:null},i.execute=function(){var l=this.getCaptchaFunction("execute");if(l&&this._widgetId!==void 0)return l(this._widgetId);this._executeRequested=!0},i.executeAsync=function(){var l=this;return new Promise(function(d,f){l.executionResolve=d,l.executionReject=f,l.execute()})},i.reset=function(){var l=this.getCaptchaFunction("reset");l&&this._widgetId!==void 0&&l(this._widgetId)},i.forceReset=function(){var l=this.getCaptchaFunction("reset");l&&l()},i.handleExpired=function(){this.props.onExpired?this.props.onExpired():this.handleChange(null)},i.handleErrored=function(){this.props.onErrored&&this.props.onErrored(),this.executionReject&&(this.executionReject(),delete this.executionResolve,delete this.executionReject)},i.handleChange=function(l){this.props.onChange&&this.props.onChange(l),this.executionResolve&&(this.executionResolve(l),delete this.executionReject,delete this.executionResolve)},i.explicitRender=function(){var l=this.getCaptchaFunction("render");if(l&&this._widgetId===void 0){var d=document.createElement("div");this._widgetId=l(d,{sitekey:this.props.sitekey,callback:this.handleChange,theme:this.props.theme,type:this.props.type,tabindex:this.props.tabindex,"expired-callback":this.handleExpired,"error-callback":this.handleErrored,size:this.props.size,stoken:this.props.stoken,hl:this.props.hl,badge:this.props.badge,isolated:this.props.isolated}),this.captcha.appendChild(d)}this._executeRequested&&this.props.grecaptcha&&this._widgetId!==void 0&&(this._executeRequested=!1,this.execute())},i.componentDidMount=function(){this.explicitRender()},i.componentDidUpdate=function(){this.explicitRender()},i.handleRecaptchaRef=function(l){this.captcha=l},i.render=function(){var l=this.props;l.sitekey,l.onChange,l.theme,l.type,l.tabindex,l.onExpired,l.onErrored,l.size,l.stoken,l.grecaptcha,l.badge,l.hl,l.isolated;var d=Fze(l,jze);return N.createElement("div",qV({},d,{ref:this.handleRecaptchaRef}))},t}(N.Component);gN.displayName="ReCAPTCHA";gN.propTypes={sitekey:Sn.string.isRequired,onChange:Sn.func,grecaptcha:Sn.object,theme:Sn.oneOf(["dark","light"]),type:Sn.oneOf(["image","audio"]),tabindex:Sn.number,onExpired:Sn.func,onErrored:Sn.func,size:Sn.oneOf(["compact","normal","invisible"]),stoken:Sn.string,hl:Sn.string,badge:Sn.oneOf(["bottomright","bottomleft","inline"]),isolated:Sn.bool};gN.defaultProps={onChange:function(){},theme:"light",type:"image",tabindex:0,size:"normal",badge:"bottomright"};function XV(){return XV=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(n[a]=i[a])}return n},XV.apply(this,arguments)}function zze(n,t){if(n==null)return{};var i={},a=Object.keys(n),l,d;for(d=0;d<a.length;d++)l=a[d],!(t.indexOf(l)>=0)&&(i[l]=n[l]);return i}function Wze(n,t){n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.__proto__=t}var jd={},Gze=0;function Hze(n,t){return t=t||{},function(a){var l=a.displayName||a.name||"Component",d=function(_){Wze(v,_);function v(C,I){var O;return O=_.call(this,C,I)||this,O.state={},O.__scriptURL="",O}var b=v.prototype;return b.asyncScriptLoaderGetScriptLoaderID=function(){return this.__scriptLoaderID||(this.__scriptLoaderID="async-script-loader-"+Gze++),this.__scriptLoaderID},b.setupScriptURL=function(){return this.__scriptURL=typeof n=="function"?n():n,this.__scriptURL},b.asyncScriptLoaderHandleLoad=function(I){var O=this;this.setState(I,function(){return O.props.asyncScriptOnLoad&&O.props.asyncScriptOnLoad(O.state)})},b.asyncScriptLoaderTriggerOnScriptLoaded=function(){var I=jd[this.__scriptURL];if(!I||!I.loaded)throw new Error("Script is not loaded.");for(var O in I.observers)I.observers[O](I);delete window[t.callbackName]},b.componentDidMount=function(){var I=this,O=this.setupScriptURL(),L=this.asyncScriptLoaderGetScriptLoaderID(),M=t,F=M.globalName,z=M.callbackName,Z=M.scriptId;if(F&&typeof window[F]<"u"&&(jd[O]={loaded:!0,observers:{}}),jd[O]){var K=jd[O];if(K&&(K.loaded||K.errored)){this.asyncScriptLoaderHandleLoad(K);return}K.observers[L]=function(X){return I.asyncScriptLoaderHandleLoad(X)};return}var re={};re[L]=function(X){return I.asyncScriptLoaderHandleLoad(X)},jd[O]={loaded:!1,observers:re};var ae=document.createElement("script");ae.src=O,ae.async=!0;for(var ne in t.attributes)ae.setAttribute(ne,t.attributes[ne]);Z&&(ae.id=Z);var pe=function(J){if(jd[O]){var Q=jd[O],se=Q.observers;for(var de in se)J(se[de])&&delete se[de]}};z&&typeof window<"u"&&(window[z]=function(){return I.asyncScriptLoaderTriggerOnScriptLoaded()}),ae.onload=function(){var X=jd[O];X&&(X.loaded=!0,pe(function(J){return z?!1:(J(X),!0)}))},ae.onerror=function(){var X=jd[O];X&&(X.errored=!0,pe(function(J){return J(X),!0}))},document.body.appendChild(ae)},b.componentWillUnmount=function(){var I=this.__scriptURL;if(t.removeOnUnmount===!0)for(var O=document.getElementsByTagName("script"),L=0;L<O.length;L+=1)O[L].src.indexOf(I)>-1&&O[L].parentNode&&O[L].parentNode.removeChild(O[L]);var M=jd[I];M&&(delete M.observers[this.asyncScriptLoaderGetScriptLoaderID()],t.removeOnUnmount===!0&&delete jd[I])},b.render=function(){var I=t.globalName,O=this.props;O.asyncScriptOnLoad;var L=O.forwardedRef,M=zze(O,["asyncScriptOnLoad","forwardedRef"]);return I&&typeof window<"u"&&(M[I]=typeof window[I]<"u"?window[I]:void 0),M.ref=L,N.createElement(a,M)},v}(N.Component),f=N.forwardRef(function(_,v){return N.createElement(d,XV({},_,{forwardedRef:v}))});return f.displayName="AsyncScriptLoader("+l+")",f.propTypes={asyncScriptOnLoad:Sn.func},XRe(f,a)}}var JV="onloadcallback",$ze="grecaptcha";function QV(){return typeof window<"u"&&window.recaptchaOptions||{}}function Kze(){var n=QV(),t=n.useRecaptchaNet?"recaptcha.net":"www.google.com";return n.enterprise?"https://"+t+"/recaptcha/enterprise.js?onload="+JV+"&render=explicit":"https://"+t+"/recaptcha/api.js?onload="+JV+"&render=explicit"}const boe=Hze(Kze,{callbackName:JV,globalName:$ze,attributes:QV().nonce?{nonce:QV().nonce}:{}})(gN),_N=(n,t="generic-modal")=>{N.useEffect(()=>{if(!window.unityInstance)return;const i=()=>{try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),$.log(`Unity input disabled for ${t}`),document.body.classList.add("unity-input-disabled"),window.unityInputDisabled=!0,window.unityInputDisabledBy=t}catch(l){$.error(`Failed to disable Unity input for ${t}:`,l)}},a=()=>{try{window.unityInputDisabledBy===t?(window.unityInstance.SendMessage("WebGLInputManager","Enable"),$.log(`Unity input re-enabled (was disabled by ${t})`),document.body.classList.remove("unity-input-disabled"),window.unityInputDisabled=!1,window.unityInputDisabledBy=null):$.log(`Not re-enabling Unity input for ${t} because it was disabled by ${window.unityInputDisabledBy}`)}catch(l){$.error(`Failed to enable Unity input for ${t}:`,l)}};return n?i():a(),()=>{n&&a()}},[n,t])},Toe=({isOpen:n,onClose:t,userData:i,onConfirm:a,fullscreenRef:l})=>{const[d,f]=N.useState((i==null?void 0:i.username)||""),[_,v]=N.useState((i==null?void 0:i.Nickname)||""),[b,C]=N.useState(!1),[I,O]=N.useState(null),[L,M]=N.useState(!1),F=Na(),z=ae=>!(!ae||ae.trim()===""||!/^[a-z0-9]{1,15}$/.test(ae)),Z=async ae=>{var ne,pe;if(!z(ae))return!ae||ae.trim()===""?O("Username cannot be empty"):O("Username must be 1-15 characters, lowercase letters and numbers only"),!1;C(!0),O(null);try{let X=!1,J=0;const Q=3;for(;J<Q;)try{X=await Mse(ae);break}catch(se){if($.error(`Attempt ${J+1}: Error checking username:`,se),J++,J>=Q)throw se;await new Promise(de=>setTimeout(de,1e3))}return X?(O("Username is already taken"),!1):!0}catch(X){return $.error("Error checking username after retries:",X),X.code==="permission-denied"||(ne=X.message)!=null&&ne.includes("permissions")?O("Username check unavailable. Please try again or pick a unique name."):O("Error checking username availability. Please try again."),X.code==="permission-denied"||((pe=X.message)==null?void 0:pe.includes("permissions"))}finally{C(!1)}};N.useEffect(()=>{if(!d){O("Username cannot be empty");return}if(d!==(i==null?void 0:i.username)){const ae=setTimeout(async()=>{await Z(d)},500);return()=>clearTimeout(ae)}},[d]),N.useEffect(()=>{if(i&&i.firstName&&i.lastName){const ae=`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`;v(ae)}},[i]);const K=async()=>{M(!0);try{if(!await Z(d)){M(!1);return}if(_.length>15){O("Display Name must be at most 15 characters"),M(!1);return}Kw(_),$.log("UsernameConfirmation: Preparing to confirm user registration");const ne=i.firstName&&i.lastName?`${i.firstName}${i.lastName.charAt(0).toUpperCase()}`:"",pe={...i,firstName:i.firstName||"",lastName:i.lastName||"",companyName:i.companyName||"",linkedInProfile:i.linkedInProfile||"",username:d,Nickname:_||ne,email:i.email,password:i.password};$.log("UsernameConfirmation: Processed registration data with fields:",Object.keys(pe).join(", ")),await a(pe),t()}catch(ae){$.error("Error during username confirmation:",ae),F({title:"Error",description:"An error occurred. Please try again.",status:"error",duration:3e3,isClosable:!0})}finally{M(!1)}},re=()=>{L||t()};return T.jsxs(Fs,{isOpen:n,onClose:re,size:"md",portalProps:{containerRef:l},isCentered:!0,motionPreset:"slideInBottom",closeOnOverlayClick:!L,closeOnEsc:!L,children:[T.jsx(Ws,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),T.jsxs(Bs,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",children:[T.jsxs(xo,{children:[T.jsx(MC,{size:"lg",mb:2,children:"Customize Your Profile"}),T.jsx(at,{fontSize:"sm",color:"gray.400",children:"Set your username and nickname"})]}),T.jsx(io,{color:"gray.400",isDisabled:L}),T.jsx(zs,{children:T.jsxs(pi,{spacing:6,align:"stretch",children:[T.jsxs(kr,{isInvalid:!!I,children:[T.jsx(Gi,{children:"Username"}),T.jsxs(Ly,{children:[T.jsx(PF,{bg:"gray.700",color:"gray.400",border:"none",children:"@"}),T.jsx(Hi,{placeholder:"username",value:d,onChange:ae=>f(ae.target.value.toLowerCase()),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15})]}),I?T.jsx(Xh,{children:I}):T.jsx(n0,{color:"gray.400",children:"Lowercase letters and numbers only, max 15 characters"})]}),T.jsxs(kr,{children:[T.jsx(Gi,{children:"Nickname"}),T.jsx(Hi,{placeholder:"Nickname",value:_,onChange:ae=>v(ae.target.value),bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},maxLength:15}),T.jsx(n0,{color:"gray.400",children:"This is the name shown to others, max 15 characters"})]})]})}),T.jsx(Sp,{children:T.jsxs(ji,{gap:3,width:"100%",children:[T.jsx(Jn,{variant:"outline",onClick:re,flex:"1",isDisabled:L,children:"Back"}),T.jsx(Jn,{colorScheme:"blue",onClick:K,isLoading:L||b,isDisabled:!!I||!d||L,flex:"2",children:"Finish"})]})})]})]})};Toe.propTypes={isOpen:Sn.bool.isRequired,onClose:Sn.func.isRequired,userData:Sn.object.isRequired,onConfirm:Sn.func.isRequired,fullscreenRef:Sn.object};const qze="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function q3({mode:n,label:t,buttonProps:i={},isOpen:a,onClose:l}){const{register:d,handleSubmit:f,formState:{errors:_}}=Soe(),{register:v}=N.useContext(Nc),b=Na(),{fullscreenRef:C}=Yd(),[I,O]=N.useState(!1),[L,M]=N.useState(!1),[F,z]=N.useState(null),Z=N.useRef(null),[K,re]=N.useState(!1),[ae,ne]=N.useState(null),[pe,X]=N.useState(!1),J=a!==void 0?a:I,Q=l||(()=>O(!1));_N(J||K),N.useEffect(()=>{!J&&Z.current&&(Z.current.reset(),z(null))},[J]);const se=Ve=>{z(Ve)},de=async Ve=>{$.log("Register.jsx: Processing registration form submission");const{email:xe,password:Re,confirmPassword:ve,...be}=Ve;if($.log("Register.jsx: Registration data fields:",Object.keys(be).join(", ")),!F){b({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}if(Re!==ve){b({title:"Error",description:"Passwords do not match.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}Kw(be.firstName),Kw(be.lastName),Kw(be.companyName),M(!0);try{const ze=await aBe(be.firstName||"",be.lastName||""),Pe=be.firstName&&be.lastName?`${be.firstName}${be.lastName.charAt(0).toUpperCase()}`:"";Pe&&Kw(Pe),$.log("Register.jsx: Generated username and nickname for new user");const we={...be,firstName:be.firstName||"",lastName:be.lastName||"",companyName:be.companyName||"",linkedInProfile:be.linkedInProfile||"",email:xe,password:Re,username:ze,Nickname:Pe,captchaToken:F};$.log("Register.jsx: Prepared registration data with fields:",Object.keys(we).join(", ")),ne(we),re(!0)}catch(ze){$.error("User: Registration Error:",ze);let Pe="An error occurred during registration. Please try again.",we=!1;ze.code==="auth/email-already-in-use"?(Pe="This email address is already registered. Please sign in instead.",we=!0):ze.code==="auth/invalid-email"?Pe="The email address is not valid. Please check and try again.":ze.code==="auth/weak-password"?Pe="The password is too weak. Please choose a stronger password.":ze.message&&(Pe=ze.message),b({title:"Registration Failed",description:T.jsxs(T.Fragment,{children:[Pe,we&&T.jsx(at,{mt:2,children:T.jsx(Gl,{color:"blue.400",onClick:()=>{Q(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Go to Sign In"})})]}),status:"error",duration:5e3,isClosable:!0,position:"top"})}finally{M(!1),Z.current&&Z.current.reset()}},he=async Ve=>{M(!0);try{$.log("Register.jsx: Completing registration with confirmed username");const{email:xe,password:Re,...ve}=Ve,be={...ve,firstName:ve.firstName||"",lastName:ve.lastName||"",companyName:ve.companyName||"",linkedInProfile:ve.linkedInProfile||"",username:ve.username||"",Nickname:ve.Nickname||""};$.log("Register.jsx: Final registration data includes fields:",Object.keys(be).join(", "));const ze=await v(xe,Re,be);Q(),re(!1),$.log("User: Registration process complete."),b({title:"Registration Successful",description:"Please check your email for a verification link. You'll need to verify your email before signing in.",status:"success",duration:8e3,isClosable:!0,position:"top"}),ne(null),X(!1)}catch(xe){$.error("User: Registration Error during final step:",xe);let Re="An error occurred during registration. Please try again.";xe.code==="auth/email-already-in-use"?Re="This email address is already in use. Please try another one.":xe.message&&(Re=xe.message),b({title:"Registration Failed",description:Re,status:"error",duration:5e3,isClosable:!0,position:"top"}),re(!1),ne(null),X(!1)}finally{M(!1)}},le=()=>{l?l():O(!I)},Oe=n==="link"?T.jsx(Gl,{variant:"header",onClick:le,children:t}):T.jsx(Jn,{onClick:le,...i,children:t});return T.jsxs(T.Fragment,{children:[!a&&Oe,T.jsxs(Fs,{isOpen:J&&!K,onClose:Q,size:"md",portalProps:{containerRef:C},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[T.jsx(Ws,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),T.jsxs(Bs,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:Ve=>{Ve.stopPropagation()},children:[T.jsxs(xo,{p:8,textAlign:"center",children:[T.jsx(MC,{size:"lg",mb:2,children:"Create Account"}),T.jsx(at,{fontSize:"sm",color:"gray.400",children:"Fill in your details to get started"})]}),T.jsx(io,{color:"gray.400"}),T.jsx(zs,{px:8,children:T.jsx("form",{onSubmit:f(de),children:T.jsxs(pi,{spacing:4,children:[T.jsxs(kr,{isInvalid:_.companyName,isRequired:!0,children:[T.jsx(Hi,{placeholder:"Company Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("companyName",{required:"Company name is required",setValueAs:Ve=>Ve===""?"":Ve})}),T.jsx(Xh,{children:_.companyName&&_.companyName.message})]}),T.jsxs(ji,{gap:4,w:"100%",children:[T.jsxs(kr,{isInvalid:_.firstName,isRequired:!0,children:[T.jsx(Hi,{placeholder:"First Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("firstName",{required:"First name is required",setValueAs:Ve=>Ve===""?"":Ve})}),T.jsx(Xh,{children:_.firstName&&_.firstName.message})]}),T.jsxs(kr,{isInvalid:_.lastName,isRequired:!0,children:[T.jsx(Hi,{placeholder:"Last Name",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("lastName",{required:"Last name is required",setValueAs:Ve=>Ve===""?"":Ve})}),T.jsx(Xh,{children:_.lastName&&_.lastName.message})]})]}),T.jsxs(kr,{isInvalid:_.email,isRequired:!0,children:[T.jsx(Hi,{type:"email",placeholder:"Work Email Address",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("email",{required:"Email is required",pattern:{value:/^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$/,message:"Invalid email address"}})}),T.jsx(Xh,{children:_.email&&_.email.message})]}),T.jsxs(ji,{gap:4,w:"100%",children:[T.jsxs(kr,{isInvalid:_.password,isRequired:!0,children:[T.jsx(Hi,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("password",{required:"Password is required",minLength:{value:8,message:"Password must be at least 8 characters long"}})}),T.jsx(Xh,{children:_.password&&_.password.message})]}),T.jsxs(kr,{isInvalid:_.confirmPassword,isRequired:!0,children:[T.jsx(Hi,{type:"password",placeholder:"Confirm Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("confirmPassword",{required:"Confirm password is required"})}),T.jsx(Xh,{children:_.confirmPassword&&_.confirmPassword.message})]})]}),T.jsx(kr,{children:T.jsx(Hi,{placeholder:"LinkedIn Profile (optional)",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},...d("linkedInProfile",{setValueAs:Ve=>Ve===""?"":Ve})})}),T.jsx(ft,{width:"100%",display:"flex",justifyContent:"center",my:4,children:T.jsx(boe,{ref:Z,sitekey:qze,onChange:se,theme:"dark"})})]})})}),T.jsxs(Sp,{px:8,pb:8,flexDirection:"column",gap:4,children:[T.jsx(Jn,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",onClick:f(de),isLoading:L,loadingText:"Processing",isDisabled:!F,children:"Next: Set Your Username"}),T.jsxs(at,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Already have an account?"," ",T.jsx(Gl,{color:"blue.400",onClick:()=>{Q(),window.dispatchEvent(new CustomEvent("openSignInModal"))},children:"Sign In"})]})]})]})]}),K&&T.jsx(Toe,{isOpen:K,onClose:()=>re(!1),userData:ae,onConfirm:he,fullscreenRef:C,isRegistering:pe})]})}q3.propTypes={mode:Sn.oneOf(["button","link"]),label:Sn.string,buttonProps:Sn.object,isOpen:Sn.bool,onClose:Sn.func};const Yze=zg({d:"M0,12a1.5,1.5,0,0,0,1.5,1.5h8.75a.25.25,0,0,1,.25.25V22.5a1.5,1.5,0,0,0,3,0V13.75a.25.25,0,0,1,.25-.25H22.5a1.5,1.5,0,0,0,0-3H13.75a.25.25,0,0,1-.25-.25V1.5a1.5,1.5,0,0,0-3,0v8.75a.25.25,0,0,1-.25.25H1.5A1.5,1.5,0,0,0,0,12Z",displayName:"AddIcon"}),Xze=zg({viewBox:"0 0 14 14",d:"M14,7.77 L14,6.17 L12.06,5.53 L11.61,4.44 L12.49,2.6 L11.36,1.47 L9.55,2.38 L8.46,1.93 L7.77,0.01 L6.17,0.01 L5.54,1.95 L4.43,2.4 L2.59,1.52 L1.46,2.65 L2.37,4.46 L1.92,5.55 L0,6.23 L0,7.82 L1.94,8.46 L2.39,9.55 L1.51,11.39 L2.64,12.52 L4.45,11.61 L5.54,12.06 L6.23,13.98 L7.82,13.98 L8.45,12.04 L9.56,11.59 L11.4,12.47 L12.53,11.34 L11.61,9.53 L12.08,8.44 L14,7.75 L14,7.77 Z M7,10 C5.34,10 4,8.66 4,7 C4,5.34 5.34,4 7,4 C8.66,4 10,5.34 10,7 C10,8.66 8.66,10 7,10 Z",displayName:"SettingsIcon"}),Jze=zg({d:"M19.5,9.5h-.75V6.75a6.75,6.75,0,0,0-13.5,0V9.5H4.5a2,2,0,0,0-2,2V22a2,2,0,0,0,2,2h15a2,2,0,0,0,2-2V11.5A2,2,0,0,0,19.5,9.5Zm-9.5,6a2,2,0,1,1,3,1.723V19.5a1,1,0,0,1-2,0V17.223A1.994,1.994,0,0,1,10,15.5ZM7.75,6.75a4.25,4.25,0,0,1,8.5,0V9a.5.5,0,0,1-.5.5H8.25a.5.5,0,0,1-.5-.5Z",displayName:"LockIcon"}),Qze=zg({displayName:"ChevronDownIcon",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"}),sQ=zg({displayName:"EmailIcon",path:T.jsxs("g",{fill:"currentColor",children:[T.jsx("path",{d:"M11.114,14.556a1.252,1.252,0,0,0,1.768,0L22.568,4.87a.5.5,0,0,0-.281-.849A1.966,1.966,0,0,0,22,4H2a1.966,1.966,0,0,0-.289.021.5.5,0,0,0-.281.849Z"}),T.jsx("path",{d:"M23.888,5.832a.182.182,0,0,0-.2.039l-6.2,6.2a.251.251,0,0,0,0,.354l5.043,5.043a.75.75,0,1,1-1.06,1.061l-5.043-5.043a.25.25,0,0,0-.354,0l-2.129,2.129a2.75,2.75,0,0,1-3.888,0L7.926,13.488a.251.251,0,0,0-.354,0L2.529,18.531a.75.75,0,0,1-1.06-1.061l5.043-5.043a.251.251,0,0,0,0-.354l-6.2-6.2a.18.18,0,0,0-.2-.039A.182.182,0,0,0,0,6V18a2,2,0,0,0,2,2H22a2,2,0,0,0,2-2V6A.181.181,0,0,0,23.888,5.832Z"})]})}),Zze=zg({displayName:"CloseIcon",d:"M.439,21.44a1.5,1.5,0,0,0,2.122,2.121L11.823,14.3a.25.25,0,0,1,.354,0l9.262,9.263a1.5,1.5,0,1,0,2.122-2.121L14.3,12.177a.25.25,0,0,1,0-.354l9.263-9.262A1.5,1.5,0,0,0,21.439.44L12.177,9.7a.25.25,0,0,1-.354,0L2.561.44A1.5,1.5,0,0,0,.439,2.561L9.7,11.823a.25.25,0,0,1,0,.354Z"}),eWe=zg({displayName:"QuestionOutlineIcon",path:T.jsxs("g",{stroke:"currentColor",strokeWidth:"1.5",children:[T.jsx("path",{strokeLinecap:"round",fill:"none",d:"M9,9a3,3,0,1,1,4,2.829,1.5,1.5,0,0,0-1,1.415V14.25"}),T.jsx("path",{fill:"none",strokeLinecap:"round",d:"M12,17.25a.375.375,0,1,0,.375.375A.375.375,0,0,0,12,17.25h0"}),T.jsx("circle",{fill:"none",strokeMiterlimit:"10",cx:"12",cy:"12",r:"11.25"})]})}),tWe=zg({displayName:"HamburgerIcon",viewBox:"0 0 24 24",d:"M 3 5 A 1.0001 1.0001 0 1 0 3 7 L 21 7 A 1.0001 1.0001 0 1 0 21 5 L 3 5 z M 3 11 A 1.0001 1.0001 0 1 0 3 13 L 21 13 A 1.0001 1.0001 0 1 0 21 11 L 3 11 z M 3 17 A 1.0001 1.0001 0 1 0 3 19 L 21 19 A 1.0001 1.0001 0 1 0 21 17 L 3 17 z"}),nWe="6Le4oQUrAAAAAHe0GMH5Z0tpuqTV2qqDzK9Yk4Uv";function Y3({mode:n="button",label:t="Sign In",buttonProps:i={},initialIsOpen:a=!1}){const{signIn:l}=N.useContext(Nc),{fullscreenRef:d}=Yd(),f=Na(),{register:_,handleSubmit:v,formState:{errors:b}}=Soe(),[C,I]=N.useState(!1),[O,L]=N.useState(a),[M,F]=N.useState(!1),[z,Z]=N.useState(!1),[K,re]=N.useState(""),[ae,ne]=N.useState(!1),[pe,X]=N.useState(null),J=N.useRef(null);_N(O||z),N.useEffect(()=>{const xe=()=>{L(!0)};return window.addEventListener("openSignInModal",xe),()=>{window.removeEventListener("openSignInModal",xe)}},[]);const Q=xe=>{X(xe)},se=async xe=>{if(!pe){f({title:"Verification Required",description:"Please complete the reCAPTCHA verification.",status:"error",duration:3e3,isClosable:!0,position:"top"});return}I(!0);try{await l(xe.email,xe.password,pe),$.log("User: Sign-in process complete."),L(!1),window.location.reload()}catch(Re){$.error("User: SignIn Error:",Re);const ve=Re.message||"An error occurred while logging in. Please check your credentials.",be=ve.includes("verify your email");f({title:be?"Email Verification Required":"Error",description:ve,status:be?"warning":"error",duration:1e4,isClosable:!0,position:"top",container:d.current})}finally{I(!1),J.current&&J.current.reset()}},de=async()=>{if(!K){f({title:"Email Required",description:"Please enter your email address to reset your password.",status:"warning",duration:3e3,isClosable:!0,position:"top",container:d.current});return}try{ne(!0),await Cje(x3,K),f({title:"Password Reset Email Sent",description:"Check your email for instructions to reset your password.",status:"success",duration:5e3,isClosable:!0,position:"top",container:d.current}),Z(!1)}catch(xe){$.error("User: Reset Password Error:",xe),f({title:"Error",description:xe.message||"Failed to send password reset email. Please try again.",status:"error",duration:5e3,isClosable:!0,position:"top",container:d.current})}finally{ne(!1)}},he=()=>L(xe=>!xe),le=()=>{L(!1),F(!0)},Oe=()=>{Z(!0)},Ve=n==="link"?T.jsx(Gl,{variant:"header",onClick:he,children:t}):T.jsx(Jn,{onClick:he,...i,children:t});return T.jsxs(T.Fragment,{children:[Ve,T.jsxs(Fs,{isOpen:O,onClose:he,size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[T.jsx(Ws,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),T.jsx("form",{onSubmit:v(se),children:T.jsxs(Bs,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:xe=>{xe.stopPropagation()},children:[T.jsxs(xo,{p:8,textAlign:"center",children:[T.jsx(MC,{size:"lg",mb:2,children:"Welcome Back"}),T.jsx(at,{fontSize:"sm",color:"gray.400",children:"Enter your credentials to access your account"})]}),T.jsx(io,{color:"gray.400"}),T.jsx(zs,{px:8,pb:8,children:T.jsxs(pi,{spacing:4,children:[T.jsxs(kr,{isInvalid:b.email,children:[T.jsxs(Ly,{children:[T.jsx(oC,{pointerEvents:"none",children:T.jsx(sQ,{color:"gray.500"})}),T.jsx(Hi,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},..._("email",{required:"Email is required."})})]}),T.jsx(Xh,{children:b.email&&b.email.message})]}),T.jsxs(kr,{isInvalid:b.password,children:[T.jsxs(Ly,{children:[T.jsx(oC,{pointerEvents:"none",children:T.jsx(Jze,{color:"gray.500"})}),T.jsx(Hi,{type:"password",placeholder:"Password",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},..._("password",{required:"Password is required."})})]}),T.jsx(Xh,{children:b.password&&b.password.message})]}),T.jsx(ft,{alignSelf:"flex-end",children:T.jsx(Gl,{color:"blue.400",fontSize:"sm",onClick:Oe,children:"Forgot Password?"})}),T.jsx(ji,{width:"100%",justifyContent:"center",my:4,children:T.jsx(boe,{ref:J,sitekey:nWe,onChange:Q,theme:"dark"})})]})}),T.jsxs(Sp,{px:8,pb:8,flexDirection:"column",gap:4,children:[T.jsx(Jn,{type:"submit",colorScheme:"blue",size:"lg",width:"100%",isLoading:C,loadingText:"Signing In",isDisabled:!pe,children:"Sign In"}),T.jsxs(at,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Don't have an account?"," ",T.jsx(Gl,{color:"blue.400",onClick:le,children:"Sign Up"})]})]})]})})]}),T.jsxs(Fs,{isOpen:z,onClose:()=>Z(!1),size:"md",portalProps:{containerRef:d},isCentered:!0,motionPreset:"slideInBottom",blockScrollOnMount:!1,children:[T.jsx(Ws,{bg:"blackAlpha.800",backdropFilter:"blur(5px)"}),T.jsxs(Bs,{bg:"gray.800",borderRadius:"xl",boxShadow:"xl",color:"white",maxW:"md",mx:4,position:"relative",zIndex:9999,sx:{isolation:"isolate","& input":{position:"relative",zIndex:1e4,isolation:"isolate"},"& *":{pointerEvents:"auto !important"}},onKeyDown:xe=>{xe.stopPropagation()},children:[T.jsxs(xo,{p:8,textAlign:"center",children:[T.jsx(MC,{size:"lg",mb:2,children:"Reset Password"}),T.jsx(at,{fontSize:"sm",color:"gray.400",children:"Enter your email to receive password reset instructions"})]}),T.jsx(io,{color:"gray.400"}),T.jsx(zs,{px:8,pb:4,children:T.jsx(kr,{children:T.jsxs(Ly,{children:[T.jsx(oC,{pointerEvents:"none",children:T.jsx(sQ,{color:"gray.500"})}),T.jsx(Hi,{type:"email",placeholder:"Email",bg:"gray.700",border:"none",color:"white",_placeholder:{color:"gray.500"},_hover:{bg:"gray.600"},_focus:{bg:"gray.600",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},value:K,onChange:xe=>re(xe.target.value)})]})})}),T.jsxs(Sp,{px:8,pb:8,flexDirection:"column",gap:4,children:[T.jsx(Jn,{colorScheme:"blue",size:"lg",width:"100%",onClick:de,isLoading:ae,loadingText:"Sending",children:"Send Reset Link"}),T.jsxs(at,{fontSize:"sm",color:"gray.400",textAlign:"center",children:["Remember your password?"," ",T.jsx(Gl,{color:"blue.400",onClick:()=>Z(!1),children:"Back to Sign In"})]})]})]})]}),T.jsx(q3,{mode:"link",isOpen:M,onClose:()=>F(!1)})]})}Y3.propTypes={mode:Sn.oneOf(["button","link"]),label:Sn.string,buttonProps:Sn.object,initialIsOpen:Sn.bool};function rWe(){const{loadingProgression:n,isLoaded:t,error:i}=Qo(),{user:a}=N.useContext(Nc),[l,d]=N.useState(!1),[f,_]=N.useState(!1),[v,b]=N.useState(!1),[C,I]=N.useState(!1),O=N.useRef(!1),L=N.useRef(!1),M=N.useRef(null),F=N.useRef(null),z=N.useRef(null),Z=El(),K=N.useRef(null),re=N.useRef(null),ae=N.useRef(null);N.useRef(null),N.useEffect(()=>{d(!a&&n===0)},[a,n]),N.useEffect(()=>{const X=document.createElement("style");return X.textContent=`
      /* Set initial Unity canvas styles */
      #unity-canvas, #unity-container {
        opacity: 0 !important;
        transition: opacity 1s ease-in-out;
        z-index: 1 !important; /* Ensure Unity is below our loader */
      }
      
      /* Loader overlay styles */
      .loader-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 99999 !important; /* Extremely high z-index */
        display: flex;
        align-items: center;
        justify-content: center;
        transition: opacity 1.5s ease-in-out;
        pointer-events: auto !important;
        transform: translateZ(0); /* Create stacking context */
      }
      
      /* Loader content styles */
      .loader-content {
        background-color: rgba(0, 0, 0, 0.8);
        padding: 1rem;
        border-radius: 0.5rem;
        color: white;
        text-align: center;
        z-index: 100000 !important; /* Even higher z-index */
      }
    `,document.head.appendChild(X),K.current=X,()=>{K.current&&document.head.removeChild(K.current)}},[]),N.useEffect(()=>{const X=()=>{const J=document.getElementById("unity-canvas"),Q=document.getElementById("unity-container");J&&(M.current=J,J.style.zIndex="1"),Q&&(F.current=Q,Q.style.zIndex="1"),J&&Q&&ae.current&&(clearInterval(ae.current),ae.current=null)};return X(),ae.current=setInterval(X,100),()=>{ae.current&&(clearInterval(ae.current),ae.current=null)}},[]),N.useEffect(()=>{window.isFirstSceneLoaded&&(L.current=!0,I(!0));const J=Z("FirstSceneLoaded",()=>{L.current=!0,I(!0),window.isFirstSceneLoaded=!0}),Q=setTimeout(()=>{L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0)},1e4);return()=>{J(),clearTimeout(Q)}},[Z]),N.useEffect(()=>{window.isPlayerInstantiated&&(O.current=!0,b(!0),L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0));const X=()=>{O.current=!0,b(!0),L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0)};window.addEventListener("PlayerInstantiated",X);const J=Z("PlayerInstantiated",X),Q=setTimeout(()=>{O.current||(O.current=!0,b(!0),L.current||(L.current=!0,I(!0),window.isFirstSceneLoaded=!0))},2e4);return()=>{window.removeEventListener("PlayerInstantiated",X),J(),clearTimeout(Q)}},[Z]),N.useEffect(()=>(C&&v&&(console.log("LoaderProgress: Both conditions met, showing Unity canvas"),re.current&&clearTimeout(re.current),re.current=setTimeout(()=>{M.current&&(M.current.style.opacity="1",M.current.style.removeProperty("opacity")),F.current&&(F.current.style.opacity="1",F.current.style.removeProperty("opacity")),z.current&&(z.current.style.opacity="0",z.current.style.pointerEvents="none",setTimeout(()=>{z.current&&(z.current.style.display="none")},1500))},2e3)),()=>{re.current&&clearTimeout(re.current)}),[C,v]);const ne=()=>t?t&&!C&&!v?"Scene initializing":C&&!v?"Player initializing":"Ready":"World loading",pe=()=>t?t&&!C&&!v?85:C&&!v?95:100:n*80;return T.jsx(T.Fragment,{children:l?T.jsx(ft,{position:"absolute",zIndex:"99999",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",style:{transform:"translateZ(0)"},children:T.jsxs(pi,{spacing:4,padding:6,borderRadius:"md",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",children:[T.jsx(at,{fontSize:"xl",fontWeight:"bold",children:"Sign In Required"}),T.jsx(at,{textAlign:"center",children:"Please sign in to enter The Disruptive Spaces"}),T.jsx(Jn,{colorScheme:"blue",size:"lg",width:"200px",onClick:()=>_(!0),children:"Sign In"})]})}):T.jsx(ft,{ref:z,className:"loader-overlay",style:{transform:"translateZ(0)",zIndex:99999},children:T.jsxs(ji,{className:"loader-content",flexDirection:"column",alignItems:"center",width:"300px",style:{zIndex:1e5},children:[T.jsx(at,{fontWeight:"bold",children:"Entering The Spaces Metaverse"}),T.jsx(at,{fontSize:"sm",children:ne()}),T.jsx(Uy,{value:pe(),size:"lg",width:"100%",marginY:2})]})})})}function woe({mode:n="button",label:t="Sign Out"}){const i=Na(),{signOut:a}=N.useContext(Nc),{fullscreenRef:l}=Yd(),d=async()=>{try{await a(),i({title:"Logged Out",description:"You have been successfully logged out.",status:"success",duration:3e3,isClosable:!0,position:"top",container:l.current}),window.location.href="/"}catch(_){console.error("SignOut Error:",_),i({title:"Error",description:"An error occurred while logging out.",status:"error",duration:3e3,isClosable:!0,position:"top",container:l.current})}},f=n==="link"?T.jsx(Gl,{variant:"header",onClick:d,style:{cursor:"pointer"},children:t}):null;return T.jsx(T.Fragment,{children:f})}woe.propTypes={mode:Sn.oneOf(["button","link"]),label:Sn.string};function iWe(){const{user:n}=N.useContext(Nc);return T.jsx("div",{children:n!==null?T.jsx("div",{children:T.jsx(woe,{})}):T.jsxs("div",{children:[T.jsx(q3,{}),T.jsx(Y3,{})]})})}function sWe(){const{fullscreenRef:n}=Yd(),[t,i]=N.useState(!1),a=()=>{i(!t)};return T.jsxs(T.Fragment,{children:[T.jsx(jf,{label:"Help",hasArrow:!0,placement:"top",closeOnClick:!0,portalProps:{containerRef:n},children:T.jsx(ko,{"aria-label":"Controller Help",icon:T.jsx(eWe,{}),onClick:a,variant:"iconButton"})}),T.jsxs(Fs,{isOpen:t,onClose:a,size:"md",portalProps:{containerRef:n},children:[T.jsx(Ws,{}),T.jsxs(Bs,{children:[T.jsx(xo,{children:"Notes"}),T.jsx(io,{}),T.jsx(zs,{children:T.jsx(at,{variant:"formIntro",children:"The help button is showing so we can see the blur and transparency styles on the button."})}),T.jsx(Sp,{children:T.jsx(Jn,{variant:"primary",onClick:a,children:"Close"})})]})]})]})}var Coe={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},oQ=hi.createContext&&hi.createContext(Coe),Pg=function(){return Pg=Object.assign||function(n){for(var t,i=1,a=arguments.length;i<a;i++){t=arguments[i];for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&(n[l]=t[l])}return n},Pg.apply(this,arguments)},oWe=function(n,t){var i={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&t.indexOf(a)<0&&(i[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(i[a[l]]=n[a[l]]);return i};function Roe(n){return n&&n.map(function(t,i){return hi.createElement(t.tag,Pg({key:i},t.attr),Roe(t.child))})}function Dr(n){return function(t){return hi.createElement(aWe,Pg({attr:Pg({},n.attr)},t),Roe(n.child))}}function aWe(n){var t=function(i){var a=n.attr,l=n.size,d=n.title,f=oWe(n,["attr","size","title"]),_=l||i.size||"1em",v;return i.className&&(v=i.className),n.className&&(v=(v?v+" ":"")+n.className),hi.createElement("svg",Pg({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},i.attr,a,f,{className:v,style:Pg(Pg({color:n.color||i.color},i.style),n.style),height:_,width:_,xmlns:"http://www.w3.org/2000/svg"}),d&&hi.createElement("title",null,d),n.children)};return oQ!==void 0?hi.createElement(oQ.Consumer,null,function(i){return t(i)}):t(Coe)}function Ioe(n){return Dr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"}}]})(n)}function aQ(n){return Dr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"}}]})(n)}function cQ(n){return Dr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"}}]})(n)}function ZV(n){return Dr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M528 448H112c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h416c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm64-320c-26.5 0-48 21.5-48 48 0 7.1 1.6 13.7 4.4 19.8L476 239.2c-15.4 9.2-35.3 4-44.2-11.6L350.3 85C361 76.2 368 63 368 48c0-26.5-21.5-48-48-48s-48 21.5-48 48c0 15 7 28.2 17.7 37l-81.5 142.6c-8.9 15.6-28.9 20.8-44.2 11.6l-72.3-43.4c2.7-6 4.4-12.7 4.4-19.8 0-26.5-21.5-48-48-48S0 149.5 0 176s21.5 48 48 48c2.6 0 5.2-.4 7.7-.8L128 416h384l72.3-192.8c2.5.4 5.1.8 7.7.8 26.5 0 48-21.5 48-48s-21.5-48-48-48z"}}]})(n)}function cWe(n){return Dr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M488.6 250.2L392 214V105.5c0-15-9.3-28.4-23.4-33.7l-100-37.5c-8.1-3.1-17.1-3.1-25.3 0l-100 37.5c-14.1 5.3-23.4 18.7-23.4 33.7V214l-96.6 36.2C9.3 255.5 0 268.9 0 283.9V394c0 13.6 7.7 26.1 19.9 32.2l100 50c10.1 5.1 22.1 5.1 32.2 0l103.9-52 103.9 52c10.1 5.1 22.1 5.1 32.2 0l100-50c12.2-6.1 19.9-18.6 19.9-32.2V283.9c0-15-9.3-28.4-23.4-33.7zM358 214.8l-85 31.9v-68.2l85-37v73.3zM154 104.1l102-38.2 102 38.2v.6l-102 41.4-102-41.4v-.6zm84 291.1l-85 42.5v-79.1l85-38.8v75.4zm0-112l-102 41.4-102-41.4v-.6l102-38.2 102 38.2v.6zm240 112l-85 42.5v-79.1l85-38.8v75.4zm0-112l-102 41.4-102-41.4v-.6l102-38.2 102 38.2v.6z"}}]})(n)}function lWe(n){return Dr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"}}]})(n)}function uWe(n){return Dr({attr:{viewBox:"0 0 192 512"},child:[{tag:"path",attr:{d:"M96 184c39.8 0 72 32.2 72 72s-32.2 72-72 72-72-32.2-72-72 32.2-72 72-72zM24 80c0 39.8 32.2 72 72 72s72-32.2 72-72S135.8 8 96 8 24 40.2 24 80zm0 352c0 39.8 32.2 72 72 72s72-32.2 72-72-32.2-72-72-72-72 32.2-72 72z"}}]})(n)}function dWe(n){return Dr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480.07 96H160a160 160 0 1 0 114.24 272h91.52A160 160 0 1 0 480.07 96zM248 268a12 12 0 0 1-12 12h-52v52a12 12 0 0 1-12 12h-24a12 12 0 0 1-12-12v-52H84a12 12 0 0 1-12-12v-24a12 12 0 0 1 12-12h52v-52a12 12 0 0 1 12-12h24a12 12 0 0 1 12 12v52h52a12 12 0 0 1 12 12zm216 76a40 40 0 1 1 40-40 40 40 0 0 1-40 40zm64-96a40 40 0 1 1 40-40 40 40 0 0 1-40 40z"}}]})(n)}function Aoe(n){return Dr({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"}}]})(n)}function hWe(n){return Dr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}}]})(n)}function pWe(n){return Dr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"}}]})(n)}function ej(n){return Dr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"}}]})(n)}function tj(n){return Dr({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z"}}]})(n)}function fWe(n){return Dr({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 352a160 160 0 0 0 160 160h64a160 160 0 0 0 160-160V224H0zM176 0h-16A160 160 0 0 0 0 160v32h176zm48 0h-16v192h176v-32A160 160 0 0 0 224 0z"}}]})(n)}function mWe(n){return Dr({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"}}]})(n)}function gWe(n){return Dr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M466.5 83.7l-192-80a48.15 48.15 0 0 0-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"}}]})(n)}function nj(n){return Dr({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}}]})(n)}function _We(n){return Dr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208H432c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h192c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"}}]})(n)}function yWe(n){return Dr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"}}]})(n)}function EWe(n){return Dr({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M215.03 71.05L126.06 160H24c-13.26 0-24 10.74-24 24v144c0 13.25 10.74 24 24 24h102.06l88.97 88.95c15.03 15.03 40.97 4.47 40.97-16.97V88.02c0-21.46-25.96-31.98-40.97-16.97zM461.64 256l45.64-45.64c6.3-6.3 6.3-16.52 0-22.82l-22.82-22.82c-6.3-6.3-16.52-6.3-22.82 0L416 210.36l-45.64-45.64c-6.3-6.3-16.52-6.3-22.82 0l-22.82 22.82c-6.3 6.3-6.3 16.52 0 22.82L370.36 256l-45.63 45.63c-6.3 6.3-6.3 16.52 0 22.82l22.82 22.82c6.3 6.3 16.52 6.3 22.82 0L416 301.64l45.64 45.64c6.3 6.3 16.52 6.3 22.82 0l22.82-22.82c6.3-6.3 6.3-16.52 0-22.82L461.64 256z"}}]})(n)}function vWe(n){return Dr({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M634.91 154.88C457.74-8.99 182.19-8.93 5.09 154.88c-6.66 6.16-6.79 16.59-.35 22.98l34.24 33.97c6.14 6.1 16.02 6.23 22.4.38 145.92-133.68 371.3-133.71 517.25 0 6.38 5.85 16.26 5.71 22.4-.38l34.24-33.97c6.43-6.39 6.3-16.82-.36-22.98zM320 352c-35.35 0-64 28.65-64 64s28.65 64 64 64 64-28.65 64-64-28.65-64-64-64zm202.67-83.59c-115.26-101.93-290.21-101.82-405.34 0-6.9 6.1-7.12 16.69-.57 23.15l34.44 33.99c6 5.92 15.66 6.32 22.05.8 83.95-72.57 209.74-72.41 293.49 0 6.39 5.52 16.05 5.13 22.05-.8l34.44-33.99c6.56-6.46 6.33-17.06-.56-23.15z"}}]})(n)}function Poe({open:n,onClose:t}){const i=N.useRef(null),a=ac(),{user:l}=N.useContext(Nc),d=v=>{i.current&&!i.current.contains(v.target)&&t()},f=async v=>{const b=_(v);if((b==null?void 0:b.source)==="readyplayerme"&&(b.eventName==="v1.frame.ready"&&i.current.contentWindow.postMessage(JSON.stringify({target:"readyplayerme",type:"subscribe",eventName:"v1.**"}),"*"),b.eventName==="v1.avatar.exported")){const C=b.data.url;if(console.log(`Avatar URL: ${C}`),a("AvatarUrlFromReact",{url:C}),l&&l.uid)try{await Use(l.uid,C),t()}catch(I){console.error("Error updating RPM URL:",I)}else console.error("No authenticated user found to update rpmURL.")}},_=v=>{try{return JSON.parse(v.data)}catch{return null}};return N.useEffect(()=>(n&&(document.addEventListener("mousedown",d),window.addEventListener("message",f)),()=>{document.removeEventListener("mousedown",d),window.removeEventListener("message",f)}),[n]),n&&T.jsx(Ju,{children:T.jsx(ft,{position:"fixed",top:"0",left:"0",width:"100%",height:"100%",bg:"rgba(0, 0, 0, 0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:v=>v.stopPropagation(),children:T.jsx(ft,{position:"relative",maxWidth:"1080px",maxHeight:"800px",width:"90%",height:"90%",children:T.jsx("iframe",{ref:i,src:"https://spacesmetaverse.readyplayer.me/avatar?frameApi",title:"Ready Player Me",width:"100%",height:"100%",style:{border:"none",borderRadius:"8px"},allow:"camera *; microphone *; clipboard-write"})})})})}function SWe({isOpen:n,onClose:t}){const[i,a]=N.useState(!1),[l,d]=N.useState(null),{user:f}=N.useContext(Nc),_=ac(),v=M=>{M.stopPropagation(),a(!0)},b=()=>{a(!1),t()},C=async M=>{if(d(M),f&&f.uid)try{await Use(f.uid,M.url),_("AvatarUrlFromReact",{url:M.url}),t()}catch(F){console.error("Error updating RPM URL:",F)}else console.error("No authenticated user found to update rpmURL.")},I=bg("gray.200","whiteAlpha.300"),O="rgba(0, 0, 0, 0.3)",L=[{id:1,url:"https://models.readyplayer.me/67c8408d38f7924e15a8bd0a.glb",name:"Default Avatar 1"},{id:2,url:"https://models.readyplayer.me/67c8576838e3cf57cc697c15.glb",name:"Default Avatar 2"},{id:3,url:"https://models.readyplayer.me/67c884144c4878c55e515ff5.glb",name:"Default Avatar 3"},{id:4,url:"https://models.readyplayer.me/67c885af25f4d62e75c0ff1e.glb",name:"Default Avatar 4"},{id:5,url:"https://models.readyplayer.me/67c8860f4c4878c55e5189b6.glb",name:"Default Avatar 5"},{id:6,url:"https://models.readyplayer.me/67c8869db6d0b438b7abd822.glb",name:"Default Avatar 6"},{id:7,url:"https://models.readyplayer.me/67c886ed28ee0e0bfac89688.glb",name:"Default Avatar 7"},{id:8,url:"https://models.readyplayer.me/67c88731795ea3e2e6ea84db.glb",name:"Default Avatar 8"},{id:9,url:"https://models.readyplayer.me/67c8878b0cdc0f22383f0f8f.glb",name:"Default Avatar 9"}];return T.jsxs(T.Fragment,{children:[T.jsx(Ju,{children:T.jsxs(Fs,{isOpen:n,onClose:t,isCentered:!0,size:"xl",zIndex:9999,children:[T.jsx(Ws,{bg:"rgba(0, 0, 0, 0.7)"}),T.jsxs(Bs,{bg:"gray.800",color:"white",maxW:"900px",children:[T.jsx(xo,{fontSize:"lg",children:"Customise Your Avatar"}),T.jsx(io,{color:"white",_hover:{bg:"transparent",color:"whiteAlpha.800"},_focus:{boxShadow:"none"},size:"lg",position:"absolute",right:2,top:2}),T.jsx(zs,{pb:4,children:T.jsxs(pi,{spacing:4,align:"stretch",children:[T.jsx(at,{fontSize:"sm",children:"Choose from our collection or create your own unique avatar"}),T.jsxs(ane,{columns:5,spacing:2,children:[T.jsx(ft,{position:"relative",cursor:"pointer",borderWidth:"2px",borderStyle:"dashed",borderColor:I,borderRadius:"lg",overflow:"hidden",onClick:v,_hover:{bg:O},transition:"all 0.2s",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",children:T.jsxs(pi,{spacing:1,children:[T.jsx(En,{as:mWe,boxSize:4}),T.jsx(at,{fontSize:"xs",children:"Create Custom Avatar"})]})}),L.map(M=>T.jsxs(ft,{position:"relative",cursor:"pointer",borderWidth:"2px",borderColor:(l==null?void 0:l.id)===M.id?"blue.400":I,borderRadius:"lg",overflow:"hidden",onClick:()=>C(M),_hover:{bg:O},transition:"all 0.2s",aspectRatio:"1",children:[T.jsx(rp,{src:M.url.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"),alt:M.name,width:"100%",height:"100%",objectFit:"cover"}),T.jsx(ft,{position:"absolute",bottom:"0",left:"0",right:"0",p:1,bg:"rgba(0, 0, 0, 0.7)",children:T.jsx(at,{fontSize:"xs",children:M.name})})]},M.id))]})]})})]})]})}),i&&T.jsx(Poe,{open:i,onClose:b})]})}function bWe(){const{fullscreenRef:n}=Yd(),[t,i]=N.useState(!1),[a,l]=N.useState(!1),[d,f]=N.useState(!1),[_,v]=N.useState(!1),{user:b}=N.useContext(Nc),[C,I]=N.useState(null),[O,L]=N.useState(!0),M=(K,re)=>!K||!re?"?":`${K.charAt(0)}${re.charAt(0)}`.toUpperCase(),F=async()=>{if(b!=null&&b.uid){L(!0);try{const K=await Yu(b.uid);I({rpmURL:K.rpmURL?K.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,firstName:K.firstName,lastName:K.lastName})}catch(K){console.error("Error fetching profile data:",K)}finally{L(!1)}}};N.useEffect(()=>{F()},[b==null?void 0:b.uid]),N.useEffect(()=>{const K=()=>{i(!0)};return window.addEventListener("PlayerInstantiated",K),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]);const z=()=>l(!a),Z=()=>{l(!1),F()};return t?T.jsxs(T.Fragment,{children:[T.jsx(jf,{label:"Edit Avatar",hasArrow:!0,placement:"top",closeOnClick:!0,isOpen:_,portalProps:{containerRef:n},children:T.jsxs(ft,{position:"relative",onMouseEnter:()=>{f(!0),v(!0)},onMouseLeave:()=>{f(!1),v(!1)},cursor:"pointer",onClick:z,children:[T.jsx(Ep,{src:O||C==null?void 0:C.rpmURL,size:"md",borderRadius:"full",bg:"white",name:O?M(C==null?void 0:C.firstName,C==null?void 0:C.lastName):" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),d&&T.jsx(ft,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.4)",borderRadius:"full",children:T.jsx(at,{fontSize:"xs",fontWeight:"bold",color:"white",children:"Edit"})})]})}),T.jsx(SWe,{isOpen:a,onClose:Z})]}):null}function TWe(n){return Dr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 0 0 0 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 0 0 391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 0 0-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]})(n)}function wWe(n){return Dr({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 0 0-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0 0 13.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 0 0 0 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 0 0-11.3 0l-42.4 42.3a8.03 8.03 0 0 0 0 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 0 0 4.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 0 0-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 0 0-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]})(n)}function CWe(){const{isFullscreen:n,toggleFullscreen:t,fullscreenRef:i,isMobile:a}=Yd(),l=Na();N.useEffect(()=>{const f=_=>{console.error("Fullscreen error:",_),l({title:"Fullscreen Error",description:"Could not enter fullscreen mode. Try tapping the button again or use the browser's fullscreen option.",status:"error",duration:5e3,isClosable:!0,position:"top"})};return document.addEventListener("fullscreenerror",f),document.addEventListener("webkitfullscreenerror",f),document.addEventListener("mozfullscreenerror",f),document.addEventListener("MSFullscreenError",f),()=>{document.removeEventListener("fullscreenerror",f),document.removeEventListener("webkitfullscreenerror",f),document.removeEventListener("mozfullscreenerror",f),document.removeEventListener("MSFullscreenError",f)}},[l]);const d=()=>{i.current?(a&&/iPhone|iPad|iPod/i.test(navigator.userAgent)&&!n&&l({title:"Mobile Fullscreen",description:"Tap the button again if fullscreen doesn't activate. For iOS, you may need to use the browser's share button and 'Add to Home Screen' for the best experience.",status:"info",duration:5e3,isClosable:!0,position:"top"}),t()):(console.error("Fullscreen target not set"),l({title:"Fullscreen Error",description:"Could not find fullscreen target element.",status:"error",duration:3e3,isClosable:!0,position:"top"}))};return T.jsx(jf,{label:n?"Exit Fullscreen":"Enter Fullscreen",hasArrow:!0,placement:"bottom",closeOnClick:!0,portalProps:{containerRef:i},children:T.jsx(ko,{"aria-label":n?"Exit Fullscreen":"Enter Fullscreen",icon:n?T.jsx(TWe,{}):T.jsx(wWe,{}),onClick:d,variant:"iconButton",size:a?"lg":"md"})})}const lQ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none"}};function RWe(){const{isOpen:n,onOpen:t,onClose:i}=yp(),{fullscreenRef:a}=Yd(),[l,d]=rze(!1);N.useEffect(()=>{$.log("VideoPlayer: Current video URL:",l),l&&($.log("VideoPlayer: Opening modal for video URL:",l),t())},[l,t]);const f=()=>{$.log("VideoPlayer: Closing modal"),d(),i()};return T.jsx(Ju,{containerRef:a,children:T.jsxs(Fs,{isOpen:n,onClose:f,size:"lg",isCentered:!0,portalProps:{containerRef:a},children:[T.jsx(Ws,{bg:"rgba(0, 0, 0, 0.8)"}),T.jsxs(Bs,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"modal",children:[T.jsx(io,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),T.jsx(zs,{p:0,width:"100%",children:l&&T.jsx(ft,{style:lQ.iframeContainer,children:T.jsx("iframe",{src:l,style:lQ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:"Video Player"})})})]})]})})}function IWe({isOpen:n,onClose:t,playerName:i,playerId:a,uid:l}){const[d,f]=N.useState(null),[_,v]=N.useState(!0),[b,C]=N.useState(null);return N.useEffect(()=>{n&&(async()=>{if(v(!0),C(null),!l){$.warn("NameplateModal: No UID provided for player:",i),C("No user ID available for this player"),v(!1);return}try{$.log("NameplateModal: Fetching profile for UID:",l);const O=await Yu(l);O?f({firstName:O.firstName,lastName:O.lastName,linkedinUrl:O.linkedinUrl,websiteUrl:O.websiteUrl,rpmURL:O.rpmURL?O.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}):C("Could not find profile data for this player")}catch(O){$.error("Error fetching profile data:",O),C("Error loading profile data")}finally{v(!1)}})()},[l,n,i]),T.jsxs(Fs,{isOpen:n,onClose:t,isCentered:!0,size:"md",children:[T.jsx(Ws,{backdropFilter:"blur(10px)"}),T.jsxs(Bs,{bg:"gray.900",color:"white",borderRadius:"xl",children:[T.jsx(xo,{children:"Player Info"}),T.jsx(io,{}),T.jsx(zs,{pb:6,children:_?T.jsx(Rte,{py:8,children:T.jsx(qd,{size:"xl",color:"blue.400"})}):b?T.jsxs(tp,{status:"warning",variant:"solid",borderRadius:"md",children:[T.jsx(np,{}),b]}):T.jsxs(pi,{spacing:4,align:"center",children:[T.jsx(Ep,{size:"2xl",src:d==null?void 0:d.rpmURL,bg:"whiteAlpha.300",name:i,borderWidth:"2px",borderColor:"whiteAlpha.300"}),T.jsxs(pi,{spacing:1,children:[T.jsx(at,{fontSize:"2xl",fontWeight:"bold",children:i}),(d==null?void 0:d.firstName)&&T.jsxs(at,{fontSize:"md",color:"gray.400",children:[d.firstName," ",d.lastName]}),T.jsxs(at,{fontSize:"xs",color:"gray.500",mt:1,children:["ID: ",a]})]}),((d==null?void 0:d.linkedinUrl)||(d==null?void 0:d.websiteUrl))&&T.jsxs(T.Fragment,{children:[T.jsx(wg,{borderColor:"whiteAlpha.300"}),T.jsxs(yr,{spacing:4,pt:2,children:[(d==null?void 0:d.linkedinUrl)&&T.jsx(Gl,{href:d.linkedinUrl,isExternal:!0,children:T.jsx(ko,{icon:T.jsx(Ioe,{}),variant:"ghost",colorScheme:"linkedin",size:"lg","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),(d==null?void 0:d.websiteUrl)&&T.jsx(Gl,{href:d.websiteUrl,isExternal:!0,children:T.jsx(ko,{icon:T.jsx(Aoe,{}),variant:"ghost",colorScheme:"blue",size:"lg","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})})]})]})]})})]})]})}const AWe=({isVisible:n,onToggleVisibility:t,spaceID:i})=>{const[a]=ZDe("(max-width: 768px)"),[l,d]=N.useState(!1);N.useEffect(()=>{(()=>{const lt=navigator.userAgent||navigator.vendor||window.opera,Lt=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(lt);d(Lt),Lt&&$.log("UnityPlayerList: Mobile browser detected, component will not render")})()},[]);const f=a||l,_=coe(),[v,b]=N.useState(!1),[C,I]=N.useState([]),[O,L]=N.useState(!1),[M,F]=N.useState({}),[z,Z]=N.useState({}),[K,re]=N.useState(null),[ae,ne]=N.useState(!1),[pe,X]=N.useState(!1),J=Na(),[Q,se]=N.useState(null),{isOpen:de,onOpen:he,onClose:le}=yp(),[Oe,Ve]=N.useState(null),xe=window.currentUser||{};N.useEffect(()=>{var He;$.log("Current user info:",{uid:xe==null?void 0:xe.uid,groups:xe==null?void 0:xe.groups,isAdmin:(He=xe==null?void 0:xe.groups)==null?void 0:He.includes("disruptiveAdmin")})},[xe]),N.useEffect(()=>{if(xe&&xe.groups&&xe.groups.includes("disruptiveAdmin")){$.log("Current user is disruptiveAdmin (from groups)"),ne(!0);return}(async()=>{if(xe&&xe.uid)try{const lt=await lN(xe.uid,"disruptiveAdmin");$.log("Current user disruptiveAdmin status:",lt),ne(lt)}catch(lt){console.error("UnityPlayerList: Error checking disruptiveAdmin status:",lt),ne(!1)}})()},[xe]);const ve=(()=>{if(i)return i;if(window.spaceID)return window.spaceID;const lt=(window.location.pathname||"").split("/"),mt=lt[lt.length-1];if(mt&&mt.length>5)return mt;const Lt=document.body.getAttribute("data-space-id");if(Lt)return Lt;const Xt=localStorage.getItem("currentSpaceId");return Xt||"fallback-space-id"})();N.useEffect(()=>{(async()=>{try{const mt=await Gu(ve);mt&&mt.voiceDisabled?(console.log("UnityPlayerList: Voice is disabled for this space"),X(!0)):X(!1)}catch(mt){console.error("UnityPlayerList: Error checking if voice is disabled:",mt)}})();const lt=mt=>{mt.detail&&typeof mt.detail.voiceDisabled=="boolean"&&(console.log("UnityPlayerList: Voice setting changed:",mt.detail.voiceDisabled),X(mt.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",lt),()=>{window.removeEventListener("SpaceVoiceSettingChanged",lt)}},[ve]),N.useEffect(()=>{const He={};_.forEach(lt=>{if(lt.uid){if(lt.isLocalPlayer&&window.agoraClient&&window.agoraClient.client)He[lt.uid]=window.agoraClient.client.uid;else if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const mt=window.agoraClient.client.remoteUsers,Lt=mt.find(Xt=>String(Xt.uid)===String(lt.uid));if(Lt)He[lt.uid]=Lt.uid;else{const Xt=mt.find($t=>typeof $t.uid=="string"&&$t.uid.includes(lt.uid));if(Xt)He[lt.uid]=Xt.uid;else{const $t=mt.find(Te=>typeof lt.uid=="string"&&lt.uid.includes(String(Te.uid)));if($t)He[lt.uid]=$t.uid;else{const Te=mt.filter(je=>!(typeof je.uid=="string"&&je.uid.startsWith("screen-")));Te.length===1&&!lt.isLocalPlayer&&(He[lt.uid]=Te[0].uid)}}}}}}),Z(He)},[_]);const be=()=>{if(window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"){const He=window.agoraClient.isVoiceEnabled;He!==O&&L(He)}if(window.agoraClient&&window.agoraClient.client&&window.agoraClient.client.remoteUsers){const He=window.agoraClient.client.remoteUsers,lt={};He.forEach(mt=>{typeof mt.uid=="string"&&mt.uid.startsWith("screen-")||(lt[mt.uid]=!!mt.audioTrack&&!mt.audioTrack.muted)}),JSON.stringify(lt)!==JSON.stringify(M)&&F(lt)}};N.useEffect(()=>{const He=setInterval(be,500),lt=mt=>{mt.detail&&typeof mt.detail.enabled=="boolean"&&L(mt.detail.enabled)};return window.addEventListener("VoiceToggled",lt),be(),()=>{clearInterval(He),window.removeEventListener("VoiceToggled",lt)}},[]),N.useEffect(()=>{const He=()=>{$.log("UnityPlayerList: Player instantiated, showing list"),b(!0)};return window.addEventListener("PlayerInstantiated",He),window.isPlayerInstantiated&&($.log("UnityPlayerList: Player was already instantiated"),b(!0)),()=>{window.removeEventListener("PlayerInstantiated",He)}},[]),N.useEffect(()=>{(async()=>{const lt=await Promise.all(_.map(async mt=>{if(mt.uid)try{const Lt=await Yu(mt.uid);let Xt=null;if(Lt.groups){const $t=`space_${ve}_owners`,Te=`space_${ve}_hosts`;Lt.groups.includes($t)?Xt="owner":Lt.groups.includes(Te)&&(Xt="host")}return we({uid:mt.uid})&&re(Xt),{...mt,firstName:Lt.firstName,lastName:Lt.lastName,linkedInProfile:Lt.linkedInProfile,websiteUrl:Lt.websiteUrl,rpmURL:Lt.rpmURL?Lt.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null,role:Xt}}catch(Lt){return $.error(`Error fetching data for player ${mt.playerName}:`,Lt),mt}return mt}));I(lt)})()},[_,ve]);const ze=[...C].sort((He,lt)=>He.isLocalPlayer?-1:lt.isLocalPlayer?1:0),Pe=()=>{$.log("UnityPlayerList: Toggling visibility"),t&&t()},we=He=>!!(He.isLocalPlayer||xe&&(xe.uid&&He.uid===xe.uid||xe.uid&&He.id===xe.uid)),ke=He=>{try{if(we(He))return window.agoraClient&&typeof window.agoraClient.isVoiceEnabled=="boolean"?window.agoraClient.isVoiceEnabled:O;if(He.uid){if(M[He.uid])return!0;const lt=z[He.uid];if(lt&&M[lt])return!0;const mt=parseInt(He.uid);if(!isNaN(mt)&&M[mt])return!0}return!1}catch(lt){return console.error("Error in hasActiveMic:",lt),!1}},Ue=({player:He})=>{const lt=He.role;return lt==="owner"?T.jsxs(yr,{spacing:1,bg:"green.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(72, 187, 120, 0.5)",border:"1px solid",borderColor:"green.400",children:[T.jsx(En,{as:ZV,color:"green.400",boxSize:5}),T.jsx(Of,{colorScheme:"green",variant:"solid",fontSize:"md",px:2,children:"Owner"})]}):lt==="host"?T.jsxs(yr,{spacing:1,bg:"purple.900",p:2,borderRadius:"md",px:3,boxShadow:"0 0 10px rgba(159, 122, 234, 0.5)",border:"1px solid",borderColor:"purple.400",children:[T.jsx(En,{as:nj,color:"purple.400",boxSize:5}),T.jsx(Of,{colorScheme:"purple",variant:"solid",fontSize:"md",px:2,children:"Host"})]}):null},{kickPlayer:Be,isKicking:qe,kickResult:$e,error:it,resetKickState:Je}=pze();N.useEffect(()=>{$e!=null&&$e.success&&Q&&(J({title:"Remove Successful",description:`${Q} has been removed from the space.`,status:"success",duration:3e3,isClosable:!0}),se(null),Je())},[$e,Q,J,Je]),N.useEffect(()=>{it&&(J({title:"Error Removing Player",description:it,status:"error",duration:3e3,isClosable:!0}),se(null),Je())},[it,J,Je]);const Ct=()=>{Oe&&(se(Oe.playerName),Be(Oe.uid,xe==null?void 0:xe.uid),J({title:"Processing",description:`Removing ${Oe.playerName}...`,status:"info",duration:2e3,isClosable:!0}),Ve(null),le())},kt=(He,lt)=>{console.log(`Action "${He}" triggered for player: ${lt.playerName}`);const mt=ze.find(Xt=>Xt.isLocalPlayer);if(!((mt==null?void 0:mt.role)==="owner")){J({title:"Permission Denied",description:"You don't have permission to perform this action.",status:"error",duration:3e3,isClosable:!0}),console.error("Permission denied: User attempted to perform action without proper permissions");return}switch(He){case"remove":Ve(lt),he();break;default:console.log(`Unhandled action: ${He}`);break}};return T.jsxs(T.Fragment,{children:[T.jsxs(ft,{position:"absolute",top:"100px",right:"20px",zIndex:"1",bg:"rgba(0,0,0,0.4)",p:4,borderRadius:"md",color:"white",minWidth:"200px",maxHeight:"300px",visibility:v&&n&&!f?"visible":"hidden",role:"group",children:[T.jsx(ft,{position:"absolute",top:2,right:2,opacity:0,_groupHover:{opacity:1},transition:"opacity 0.2s",children:T.jsx(ko,{icon:T.jsx(Zze,{boxSize:3}),size:"xs","aria-label":"Close list",variant:"unstyled",color:"white",onClick:Pe,_hover:{opacity:.8}})}),T.jsxs(at,{fontWeight:"bold",mb:2,fontSize:"sm",children:["People Online: ",_.length]}),T.jsx(ft,{maxHeight:"200px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:T.jsx(pi,{align:"stretch",spacing:1,width:"100%",children:ze.map((He,lt)=>{const mt=we(He),Lt=!pe&&ke(He);He.uid||He.id;const Xt=ze.find(Ke=>Ke.isLocalPlayer);Xt!=null&&Xt.uid||(Xt==null||Xt.id);const $t=He.role==="owner",je=(Xt==null?void 0:Xt.role)==="owner"&&!mt&&!$t;return T.jsx(ft,{children:T.jsxs(Vne,{placement:"left",trigger:"hover",children:[T.jsx(Wne,{children:T.jsxs(yr,{width:"100%",spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},transition:"background 0.2s",children:[T.jsx(Ep,{size:"xs",src:He.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),T.jsx(at,{fontSize:"xs",children:He.playerName}),He.role==="owner"&&T.jsx(En,{as:ZV,color:"green.400",boxSize:2.5}),He.role==="host"&&T.jsx(En,{as:nj,color:"purple.400",boxSize:2.5}),T.jsx(xC,{}),!pe&&(Lt?T.jsx(ft,{color:"green.400",children:T.jsx(tj,{})}):T.jsx(ft,{color:"red.400",children:T.jsx(ej,{})})),mt?T.jsx(at,{fontSize:"xs",color:"gray.300",ml:1,children:"(you)"}):je?T.jsxs(A1,{children:[T.jsx(P1,{as:ko,"aria-label":"Options",icon:T.jsx(uWe,{}),variant:"ghost",size:"xs",color:"gray.300",ml:1,minW:"16px",h:"16px",p:0}),T.jsx(O1,{bg:"rgba(0,0,0,0.8)",borderColor:"whiteAlpha.300",minW:"120px",zIndex:10001,children:T.jsx(xk,{icon:T.jsx(_We,{}),onClick:()=>kt("remove",He),bg:"black",color:"white",_hover:{bg:"gray.800"},fontSize:"sm",children:"Remove"})})]}):null]})}),T.jsx(zne,{bg:"rgba(0,0,0,0.8)",border:"none",boxShadow:"dark-lg",color:"white",p:4,width:"auto",minWidth:"250px",ml:"-20px",position:"absolute",left:"-250px",top:"-100px",transform:"none !important",zIndex:1e4,children:T.jsx(Fne,{children:T.jsxs(pi,{align:"center",spacing:3,children:[T.jsx(Ep,{size:"xl",src:He.rpmURL,bg:"whiteAlpha.400",name:" ",borderWidth:"2px",borderColor:"whiteAlpha.300"}),T.jsx(at,{fontSize:"xl",fontWeight:"bold",children:He.playerName}),T.jsx(Ue,{player:He}),He.firstName&&T.jsxs(at,{fontSize:"sm",color:"gray.300",children:[He.firstName," ",He.lastName]}),T.jsxs(yr,{spacing:4,pt:2,children:[He.linkedInProfile&&T.jsx(Gl,{href:He.linkedInProfile,isExternal:!0,children:T.jsx(ko,{icon:T.jsx(Ioe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"LinkedIn profile",_hover:{bg:"whiteAlpha.200"}})}),He.websiteUrl&&T.jsx(Gl,{href:He.websiteUrl,isExternal:!0,children:T.jsx(ko,{icon:T.jsx(Aoe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"md","aria-label":"Personal website",_hover:{bg:"whiteAlpha.200"}})}),!pe&&T.jsx(ko,{icon:Lt?T.jsx(tj,{}):T.jsx(ej,{}),variant:"ghost",colorScheme:Lt?"green":"red",size:"md","aria-label":"Microphone status",isDisabled:!0}),pe&&T.jsx(ko,{icon:T.jsx(EWe,{}),variant:"ghost",colorScheme:"red",size:"md","aria-label":"Voice chat disabled",isDisabled:!0,title:"Voice chat is disabled for this space"})]})]})})})]})},lt)})})})]}),T.jsxs(Fs,{isOpen:de,onClose:le,isCentered:!0,children:[T.jsx(Ws,{}),T.jsxs(Bs,{bg:"gray.800",color:"white",children:[T.jsx(xo,{children:"Confirm Removal"}),T.jsx(io,{}),T.jsx(zs,{children:T.jsxs(at,{children:["Remove ",Oe==null?void 0:Oe.playerName," from the room?"]})}),T.jsxs(Sp,{children:[T.jsx(Jn,{colorScheme:"red",onClick:Ct,isLoading:qe,mr:3,children:"Remove"}),T.jsx(Jn,{bg:"white",color:"gray.800",onClick:le,_hover:{bg:"gray.200"},children:"Cancel"})]})]})]})]})};var _k={exports:{}},PWe=_k.exports,uQ;function OWe(){return uQ||(uQ=1,function(n,t){(function(i,a){n.exports=a()})(PWe,function(){function i(e,r){return r.forEach(function(s){s&&typeof s!="string"&&!Array.isArray(s)&&Object.keys(s).forEach(function(o){if(o!=="default"&&!(o in e)){var c=Object.getOwnPropertyDescriptor(s,o);Object.defineProperty(e,o,c.get?c:{enumerable:!0,get:function(){return s[o]}})}})}),Object.freeze(e)}var a=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Sy<"u"?Sy:typeof self<"u"?self:{};function l(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d=function(e){try{return!!e()}catch{return!0}},f=!d(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),_=f,v=Function.prototype,b=v.call,C=_&&v.bind.bind(b,b),I=_?C:function(e){return function(){return b.apply(e,arguments)}},O=I({}.isPrototypeOf),L=function(e){return e&&e.Math==Math&&e},M=L(typeof globalThis=="object"&&globalThis)||L(typeof window=="object"&&window)||L(typeof self=="object"&&self)||L(typeof a=="object"&&a)||function(){return this}()||a||Function("return this")(),F=f,z=Function.prototype,Z=z.apply,K=z.call,re=typeof Reflect=="object"&&Reflect.apply||(F?K.bind(Z):function(){return K.apply(Z,arguments)}),ae=I,ne=ae({}.toString),pe=ae("".slice),X=function(e){return pe(ne(e),8,-1)},J=X,Q=I,se=function(e){if(J(e)==="Function")return Q(e)},de=typeof document=="object"&&document.all,he={all:de,IS_HTMLDDA:de===void 0&&de!==void 0},le=he.all,Oe=he.IS_HTMLDDA?function(e){return typeof e=="function"||e===le}:function(e){return typeof e=="function"},Ve={},xe=!d(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Re=f,ve=Function.prototype.call,be=Re?ve.bind(ve):function(){return ve.apply(ve,arguments)},ze={},Pe={}.propertyIsEnumerable,we=Object.getOwnPropertyDescriptor,ke=we&&!Pe.call({1:2},1);ze.f=ke?function(e){var r=we(this,e);return!!r&&r.enumerable}:Pe;var Ue,Be,qe=function(e,r){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:r}},$e=d,it=X,Je=Object,Ct=I("".split),kt=$e(function(){return!Je("z").propertyIsEnumerable(0)})?function(e){return it(e)=="String"?Ct(e,""):Je(e)}:Je,He=function(e){return e==null},lt=He,mt=TypeError,Lt=function(e){if(lt(e))throw mt("Can't call method on "+e);return e},Xt=kt,$t=Lt,Te=function(e){return Xt($t(e))},je=Oe,Ke=he.all,gt=he.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:je(e)||e===Ke}:function(e){return typeof e=="object"?e!==null:je(e)},Et={},wt=Et,Kt=M,mn=Oe,vn=function(e){return mn(e)?e:void 0},rn=function(e,r){return arguments.length<2?vn(wt[e])||vn(Kt[e]):wt[e]&&wt[e][r]||Kt[e]&&Kt[e][r]},Tt=typeof navigator<"u"&&String(navigator.userAgent)||"",ir=M,Ut=Tt,Wt=ir.process,gn=ir.Deno,Ni=Wt&&Wt.versions||gn&&gn.version,ys=Ni&&Ni.v8;ys&&(Be=(Ue=ys.split("."))[0]>0&&Ue[0]<4?1:+(Ue[0]+Ue[1])),!Be&&Ut&&(!(Ue=Ut.match(/Edge\/(\d+)/))||Ue[1]>=74)&&(Ue=Ut.match(/Chrome\/(\d+)/))&&(Be=+Ue[1]);var oi=Be,Zo=oi,cc=d,so=M.String,oo=!!Object.getOwnPropertySymbols&&!cc(function(){var e=Symbol();return!so(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Zo&&Zo<41}),Dc=oo&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Es=rn,Da=Oe,Mo=O,xa=Object,lc=Dc?function(e){return typeof e=="symbol"}:function(e){var r=Es("Symbol");return Da(r)&&Mo(r.prototype,xa(e))},vl=String,La=function(e){try{return vl(e)}catch{return"Object"}},uc=Oe,_o=La,Di=TypeError,vt=function(e){if(uc(e))return e;throw Di(_o(e)+" is not a function")},pn=vt,vr=He,mi=function(e,r){var s=e[r];return vr(s)?void 0:pn(s)},Uo=be,yo=Oe,Zl=gt,Cp=TypeError,Sl={exports:{}},eu=M,wi=Object.defineProperty,Eo=function(e,r){try{wi(eu,e,{value:r,configurable:!0,writable:!0})}catch{eu[e]=r}return r},Bi="__core-js_shared__",Xd=M[Bi]||Eo(Bi,{}),Jd=Xd;(Sl.exports=function(e,r){return Jd[e]||(Jd[e]=r!==void 0?r:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var dc=Sl.exports,Qd=Lt,Qu=Object,ea=function(e){return Qu(Qd(e))},Zd=ea,qr=I({}.hasOwnProperty),Ci=Object.hasOwn||function(e,r){return qr(Zd(e),r)},xc=I,bl=0,Ma=Math.random(),Rp=xc(1 .toString),eh=function(e){return"Symbol("+(e===void 0?"":e)+")_"+Rp(++bl+Ma,36)},tu=dc,Vo=Ci,nm=eh,vo=oo,Ip=Dc,Tl=M.Symbol,th=tu("wks"),nh=Ip?Tl.for||Tl:Tl&&Tl.withoutSetter||nm,Sr=function(e){return Vo(th,e)||(th[e]=vo&&Vo(Tl,e)?Tl[e]:nh("Symbol."+e)),th[e]},nu=be,ru=gt,Zu=lc,hc=mi,ta=function(e,r){var s,o;if(yo(s=e.toString)&&!Zl(o=Uo(s,e))||yo(s=e.valueOf)&&!Zl(o=Uo(s,e)))return o;throw Cp("Can't convert object to primitive value")},ed=TypeError,wl=Sr("toPrimitive"),iu=function(e,r){if(!ru(e)||Zu(e))return e;var s,o=hc(e,wl);if(o){if(s=nu(o,e,r),!ru(s)||Zu(s))return s;throw ed("Can't convert object to primitive value")}return ta(e)},Qr=lc,pc=function(e){var r=iu(e,"string");return Qr(r)?r:r+""},ur=gt,Lc=M.document,rm=ur(Lc)&&ur(Lc.createElement),su=function(e){return rm?Lc.createElement(e):{}},rh=su,Ap=!xe&&!d(function(){return Object.defineProperty(rh("div"),"a",{get:function(){return 7}}).a!=7}),im=xe,Pp=be,na=ze,ds=qe,ra=Te,ia=pc,ou=Ci,sa=Ap,oa=Object.getOwnPropertyDescriptor;Ve.f=im?oa:function(e,r){if(e=ra(e),r=ia(r),sa)try{return oa(e,r)}catch{}if(ou(e,r))return ds(!Pp(na.f,e,r),e[r])};var sm=d,Mc=Oe,vs=/#|\.prototype\./,td=function(e,r){var s=Cl[Op(e)];return s==om||s!=au&&(Mc(r)?sm(r):!!r)},Op=td.normalize=function(e){return String(e).replace(vs,".").toLowerCase()},Cl=td.data={},au=td.NATIVE="N",om=td.POLYFILL="P",Ua=td,Va=vt,Rl=f,Se=se(se.bind),De=function(e,r){return Va(e),r===void 0?e:Rl?Se(e,r):function(){return e.apply(r,arguments)}},rt={},tn=xe&&d(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),er=gt,Rr=String,Yr=TypeError,fn=function(e){if(er(e))return e;throw Yr(Rr(e)+" is not an object")},zr=xe,Ri=Ap,Ks=tn,aa=fn,ca=pc,nd=TypeError,is=Object.defineProperty,Il=Object.getOwnPropertyDescriptor,ih="enumerable",Uc="configurable",Kg="writable";rt.f=zr?Ks?function(e,r,s){if(aa(e),r=ca(r),aa(s),typeof e=="function"&&r==="prototype"&&"value"in s&&Kg in s&&!s[Kg]){var o=Il(e,r);o&&o[Kg]&&(e[r]=s.value,s={configurable:Uc in s?s[Uc]:o[Uc],enumerable:ih in s?s[ih]:o[ih],writable:!1})}return is(e,r,s)}:is:function(e,r,s){if(aa(e),r=ca(r),aa(s),Ri)try{return is(e,r,s)}catch{}if("get"in s||"set"in s)throw nd("Accessors not supported");return"value"in s&&(e[r]=s.value),e};var am=rt,rd=qe,la=xe?function(e,r,s){return am.f(e,r,rd(1,s))}:function(e,r,s){return e[r]=s,e},cu=M,cm=re,qg=se,sE=Oe,lm=Ve.f,um=Ua,id=Et,sd=De,od=la,Yg=Ci,oE=function(e){var r=function(s,o,c){if(this instanceof r){switch(arguments.length){case 0:return new e;case 1:return new e(s);case 2:return new e(s,o)}return new e(s,o,c)}return cm(e,this,arguments)};return r.prototype=e.prototype,r},Gn=function(e,r){var s,o,c,u,h,m,y,E,S,R=e.target,P=e.global,D=e.stat,G=e.proto,j=P?cu:D?cu[R]:(cu[R]||{}).prototype,B=P?id:id[R]||od(id,R,{})[R],Y=B.prototype;for(u in r)o=!(s=um(P?u:R+(D?".":"#")+u,e.forced))&&j&&Yg(j,u),m=B[u],o&&(y=e.dontCallGetSet?(S=lm(j,u))&&S.value:j[u]),h=o&&y?y:r[u],o&&typeof m==typeof h||(E=e.bind&&o?sd(h,cu):e.wrap&&o?oE(h):G&&sE(h)?qg(h):h,(e.sham||h&&h.sham||m&&m.sham)&&od(E,"sham",!0),od(B,u,E),G&&(Yg(id,c=R+"Prototype")||od(id,c,{}),od(id[c],u,h),e.real&&Y&&(s||!Y[u])&&od(Y,u,h)))},dm=Math.ceil,ua=Math.floor,aE=Math.trunc||function(e){var r=+e;return(r>0?ua:dm)(r)},cE=aE,Vc=function(e){var r=+e;return r!=r||r===0?0:cE(r)},A=Vc,W=Math.max,ie=Math.min,ge=function(e,r){var s=A(e);return s<0?W(s+r,0):ie(s,r)},Qe=Vc,ut=Math.min,Gt=function(e){return e>0?ut(Qe(e),9007199254740991):0},Zr=Gt,gi=function(e){return Zr(e.length)},Ir=Te,ao=ge,Ss=gi,fc=function(e){return function(r,s,o){var c,u=Ir(r),h=Ss(u),m=ao(o,h);if(e&&s!=s){for(;h>m;)if((c=u[m++])!=c)return!0}else for(;h>m;m++)if((e||m in u)&&u[m]===s)return e||m||0;return!e&&-1}},da={includes:fc(!0),indexOf:fc(!1)},kp=da.includes;Gn({target:"Array",proto:!0,forced:d(function(){return!Array(1).includes()})},{includes:function(e){return kp(this,e,arguments.length>1?arguments[1]:void 0)}});var hm=Et,mc=function(e){return hm[e+"Prototype"]},vR=mc("Array").includes,SR=gt,pm=X,yN=Sr("match"),bR=function(e){var r;return SR(e)&&((r=e[yN])!==void 0?!!r:pm(e)=="RegExp")},EN=bR,TR=TypeError,q0={};q0[Sr("toStringTag")]="z";var Np=String(q0)==="[object z]",Xg=Np,vN=Oe,Dp=X,SN=Sr("toStringTag"),wR=Object,Y0=Dp(function(){return arguments}())=="Arguments",jc=Xg?Dp:function(e){var r,s,o;return e===void 0?"Undefined":e===null?"Null":typeof(s=function(c,u){try{return c[u]}catch{}}(r=wR(e),SN))=="string"?s:Y0?Dp(r):(o=Dp(r))=="Object"&&vN(r.callee)?"Arguments":o},CR=jc,RR=String,ja=function(e){if(CR(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return RR(e)},bN=Sr("match"),TN=Gn,wN=function(e){if(EN(e))throw TR("The method doesn't accept regular expressions");return e},CN=Lt,IR=ja,Al=function(e){var r=/./;try{"/./"[e](r)}catch{try{return r[bN]=!1,"/./"[e](r)}catch{}}return!1},Jg=I("".indexOf);TN({target:"String",proto:!0,forced:!Al("includes")},{includes:function(e){return!!~Jg(IR(CN(this)),IR(wN(e)),arguments.length>1?arguments[1]:void 0)}});var AR=mc("String").includes,X0=O,PR=vR,OR=AR,Qg=Array.prototype,J0=String.prototype,RN=function(e){var r=e.includes;return e===Qg||X0(Qg,e)&&r===Qg.includes?PR:typeof e=="string"||e===J0||X0(J0,e)&&r===J0.includes?OR:r},ct=l(RN),Q0=vt,Zg=ea,Z0=kt,kR=gi,lE=TypeError,fm=function(e){return function(r,s,o,c){Q0(s);var u=Zg(r),h=Z0(u),m=kR(u),y=e?m-1:0,E=e?-1:1;if(o<2)for(;;){if(y in h){c=h[y],y+=E;break}if(y+=E,e?y<0:m<=y)throw lE("Reduce of empty array with no initial value")}for(;e?y>=0:m>y;y+=E)y in h&&(c=s(c,h[y],y,u));return c}},eb={left:fm(!1)},NR=d,xp=function(e,r){var s=[][e];return!!s&&NR(function(){s.call(null,r||function(){return 1},1)})},Lp=typeof process<"u"&&X(process)=="process",DR=eb.left;Gn({target:"Array",proto:!0,forced:!Lp&&oi>79&&oi<83||!xp("reduce")},{reduce:function(e){var r=arguments.length;return DR(this,e,r,r>1?arguments[1]:void 0)}});var xR=mc("Array").reduce,LR=O,MR=xR,uE=Array.prototype,sh=function(e){var r=e.reduce;return e===uE||LR(uE,e)&&r===uE.reduce?MR:r},dE=sh,gc=l(dE),IN=X,e_=Array.isArray||function(e){return IN(e)=="Array"},t_=Gn,AN=e_,UR=I([].reverse),tb=[1,2];t_({target:"Array",proto:!0,forced:String(tb)===String(tb.reverse())},{reverse:function(){return AN(this)&&(this.length=this.length),UR(this)}});var xi=mc("Array").reverse,nb=O,hE=xi,Mp=Array.prototype,VR=function(e){var r=e.reverse;return e===Mp||nb(Mp,e)&&r===Mp.reverse?hE:r},pE=VR,mm=l(pE),fE=eh,Up=dc("keys"),n_=function(e){return Up[e]||(Up[e]=fE(e))},PN=!d(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),ON=Ci,jR=Oe,mE=ea,gE=PN,_E=n_("IE_PROTO"),r_=Object,rb=r_.prototype,i_=gE?r_.getPrototypeOf:function(e){var r=mE(e);if(ON(r,_E))return r[_E];var s=r.constructor;return jR(s)&&r instanceof s?s.prototype:r instanceof r_?rb:null},kN=I,FR=vt,NN=Oe,DN=String,ib=TypeError,oh=function(e,r,s){try{return kN(FR(Object.getOwnPropertyDescriptor(e,r)[s]))}catch{}},BR=fn,gm=function(e){if(typeof e=="object"||NN(e))return e;throw ib("Can't set "+DN(e)+" as a prototype")},lu=Object.setPrototypeOf||("__proto__"in{}?function(){var e,r=!1,s={};try{(e=oh(Object.prototype,"__proto__","set"))(s,[]),r=s instanceof Array}catch{}return function(o,c){return BR(o),gm(c),r?e(o,c):o.__proto__=c,o}}():void 0),ah={},Fc={},s_=Ci,xN=Te,LN=da.indexOf,Vp=Fc,_m=I([].push),jp=function(e,r){var s,o=xN(e),c=0,u=[];for(s in o)!s_(Vp,s)&&s_(o,s)&&_m(u,s);for(;r.length>c;)s_(o,s=r[c++])&&(~LN(u,s)||_m(u,s));return u},ym=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],sb=jp,Em=ym.concat("length","prototype");ah.f=Object.getOwnPropertyNames||function(e){return sb(e,Em)};var Bc={};Bc.f=Object.getOwnPropertySymbols;var Li=rn,Ii=ah,ch=Bc,jo=fn,Fa=I([].concat),Fp=Li("Reflect","ownKeys")||function(e){var r=Ii.f(jo(e)),s=ch.f;return s?Fa(r,s(e)):r},Bp=Ci,Ba=Fp,yE=Ve,zR=rt,EE={},vE=jp,WR=ym,zc=Object.keys||function(e){return vE(e,WR)},SE=xe,ob=tn,GR=rt,MN=fn,lh=Te,vm=zc;EE.f=SE&&!ob?Object.defineProperties:function(e,r){MN(e);for(var s,o=lh(r),c=vm(r),u=c.length,h=0;u>h;)GR.f(e,s=c[h++],o[s]);return e};var ad,o_=rn("document","documentElement"),bE=fn,Wc=EE,_c=ym,zp=Fc,cd=o_,ld=su,ud="prototype",TE="script",wE=n_("IE_PROTO"),a_=function(){},za=function(e){return"<"+TE+">"+e+"</"+TE+">"},Wa=function(e){e.write(za("")),e.close();var r=e.parentWindow.Object;return e=null,r},_i=function(){try{ad=new ActiveXObject("htmlfile")}catch{}var e,r,s;_i=typeof document<"u"?document.domain&&ad?Wa(ad):(r=ld("iframe"),s="java"+TE+":",r.style.display="none",cd.appendChild(r),r.src=String(s),(e=r.contentWindow.document).open(),e.write(za("document.F=Object")),e.close(),e.F):Wa(ad);for(var o=_c.length;o--;)delete _i[ud][_c[o]];return _i()};zp[wE]=!0;var ha=Object.create||function(e,r){var s;return e!==null?(a_[ud]=bE(e),s=new a_,a_[ud]=null,s[wE]=e):s=_i(),r===void 0?s:Wc.f(s,r)},HR=gt,$R=la,CE=Error,ab=I("".replace),KR=String(CE("zxcasd").stack),c_=/\n\s*at [^:]*:[^\n]*/,qR=c_.test(KR),Sm=qe,cb=!d(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Sm(1,7)),e.stack!==7)}),UN=la,l_=function(e,r){if(qR&&typeof e=="string"&&!CE.prepareStackTrace)for(;r--;)e=ab(e,c_,"");return e},RE=cb,lb=Error.captureStackTrace,uh={},bm=uh,YR=Sr("iterator"),IE=Array.prototype,u_=function(e){return e!==void 0&&(bm.Array===e||IE[YR]===e)},Tm=jc,AE=mi,ub=He,db=uh,hb=Sr("iterator"),dd=function(e){if(!ub(e))return AE(e,hb)||AE(e,"@@iterator")||db[Tm(e)]},Gc=be,Wp=vt,pb=fn,XR=La,hd=dd,dh=TypeError,d_=function(e,r){var s=arguments.length<2?hd(e):r;if(Wp(s))return pb(Gc(s,e));throw dh(XR(e)+" is not iterable")},JR=be,uu=fn,hh=mi,h_=function(e,r,s){var o,c;uu(e);try{if(!(o=hh(e,"return"))){if(r==="throw")throw s;return s}o=JR(o,e)}catch(u){c=!0,o=u}if(r==="throw")throw s;if(c)throw o;return uu(o),s},QR=De,PE=be,ZR=fn,p_=La,du=u_,f_=gi,wm=O,Gp=d_,fb=dd,Hp=h_,eI=TypeError,Cm=function(e,r){this.stopped=e,this.result=r},zi=Cm.prototype,ph=function(e,r,s){var o,c,u,h,m,y,E,S=s&&s.that,R=!(!s||!s.AS_ENTRIES),P=!(!s||!s.IS_RECORD),D=!(!s||!s.IS_ITERATOR),G=!(!s||!s.INTERRUPTED),j=QR(r,S),B=function(ee){return o&&Hp(o,"normal",ee),new Cm(!0,ee)},Y=function(ee){return R?(ZR(ee),G?j(ee[0],ee[1],B):j(ee[0],ee[1])):G?j(ee,B):j(ee)};if(P)o=e.iterator;else if(D)o=e;else{if(!(c=fb(e)))throw eI(p_(e)+" is not iterable");if(du(c)){for(u=0,h=f_(e);h>u;u++)if((m=Y(e[u]))&&wm(zi,m))return m;return new Cm(!1)}o=Gp(e,c)}for(y=P?e.next:o.next;!(E=PE(y,o)).done;){try{m=Y(E.value)}catch(ee){Hp(o,"throw",ee)}if(typeof m=="object"&&m&&wm(zi,m))return m}return new Cm(!1)},mb=ja,gb=Gn,OE=O,_b=i_,hu=lu,Ki=function(e,r,s){for(var o=Ba(r),c=zR.f,u=yE.f,h=0;h<o.length;h++){var m=o[h];Bp(e,m)||s&&Bp(s,m)||c(e,m,u(r,m))}},bs=ha,Ts=la,Rm=qe,m_=function(e,r){HR(r)&&"cause"in r&&$R(e,"cause",r.cause)},g_=function(e,r,s,o){RE&&(lb?lb(e,r):UN(e,"stack",l_(s,o)))},VN=ph,Fo=function(e,r){return e===void 0?arguments.length<2?"":r:mb(e)},yb=Sr("toStringTag"),Im=Error,Eb=[].push,pa=function(e,r){var s,o=OE(Ga,this);hu?s=hu(Im(),o?_b(this):Ga):(s=o?this:bs(Ga),Ts(s,yb,"Error")),r!==void 0&&Ts(s,"message",Fo(r)),g_(s,pa,s.stack,1),arguments.length>2&&m_(s,arguments[2]);var c=[];return VN(e,Eb,{that:c}),Ts(s,"errors",c),s};hu?hu(pa,Im):Ki(pa,Im,{name:!0});var Ga=pa.prototype=bs(Im.prototype,{constructor:Rm(1,pa),message:Rm(1,""),name:Rm(1,"AggregateError")});gb({global:!0},{AggregateError:pa});var fh,$p,Am,tI=Oe,vb=M.WeakMap,nI=tI(vb)&&/native code/.test(String(vb)),Sb=M,rI=gt,iI=la,kE=Ci,NE=Xd,__=n_,sI=Fc,y_="Object already initialized",Pm=Sb.TypeError,oI=Sb.WeakMap;if(nI||NE.state){var Hc=NE.state||(NE.state=new oI);Hc.get=Hc.get,Hc.has=Hc.has,Hc.set=Hc.set,fh=function(e,r){if(Hc.has(e))throw Pm(y_);return r.facade=e,Hc.set(e,r),r},$p=function(e){return Hc.get(e)||{}},Am=function(e){return Hc.has(e)}}else{var Kp=__("state");sI[Kp]=!0,fh=function(e,r){if(kE(e,Kp))throw Pm(y_);return r.facade=e,iI(e,Kp,r),r},$p=function(e){return kE(e,Kp)?e[Kp]:{}},Am=function(e){return kE(e,Kp)}}var mh,bb,Tb,pd={set:fh,get:$p,has:Am,enforce:function(e){return Am(e)?$p(e):fh(e,{})},getterFor:function(e){return function(r){var s;if(!rI(r)||(s=$p(r)).type!==e)throw Pm("Incompatible receiver, "+e+" required");return s}}},DE=xe,aI=Ci,wb=Function.prototype,jN=DE&&Object.getOwnPropertyDescriptor,Cb=aI(wb,"name"),cI={PROPER:Cb&&(function(){}).name==="something",CONFIGURABLE:Cb&&(!DE||DE&&jN(wb,"name").configurable)},FN=la,fd=function(e,r,s,o){return o&&o.enumerable?e[r]=s:FN(e,r,s),e},lI=d,uI=Oe,xE=gt,BN=ha,dI=i_,zN=fd,yc=Sr("iterator"),LE=!1;[].keys&&("next"in(Tb=[].keys())?(bb=dI(dI(Tb)))!==Object.prototype&&(mh=bb):LE=!0);var ME=!xE(mh)||lI(function(){var e={};return mh[yc].call(e)!==e});uI((mh=ME?{}:BN(mh))[yc])||zN(mh,yc,function(){return this});var Rb={IteratorPrototype:mh,BUGGY_SAFARI_ITERATORS:LE},hI=jc,pI=Np?{}.toString:function(){return"[object "+hI(this)+"]"},Ib=Np,Om=rt.f,Ab=la,Pb=Ci,WN=pI,Ob=Sr("toStringTag"),md=function(e,r,s,o){if(e){var c=s?e:e.prototype;Pb(c,Ob)||Om(c,Ob,{configurable:!0,value:r}),o&&!Ib&&Ab(c,"toString",WN)}},fI=Rb.IteratorPrototype,mI=ha,gI=qe,GN=md,Ha=uh,fa=function(){return this},UE=function(e,r,s,o){var c=r+" Iterator";return e.prototype=mI(fI,{next:gI(+!o,s)}),GN(e,c,!1,!0),Ha[c]=fa,e},_I=Gn,yI=be,EI=cI,vI=UE,kb=i_,SI=md,VE=fd,Nb=uh,bI=Rb,Db=EI.PROPER,km=bI.BUGGY_SAFARI_ITERATORS,jE=Sr("iterator"),FE="keys",qp="values",TI="entries",wI=function(){return this},BE=function(e,r,s,o,c,u,h){vI(s,r,o);var m,y,E,S=function(Y){if(Y===c&&j)return j;if(!km&&Y in D)return D[Y];switch(Y){case FE:case qp:case TI:return function(){return new s(this,Y)}}return function(){return new s(this)}},R=r+" Iterator",P=!1,D=e.prototype,G=D[jE]||D["@@iterator"]||c&&D[c],j=!km&&G||S(c),B=r=="Array"&&D.entries||G;if(B&&(m=kb(B.call(new e)))!==Object.prototype&&m.next&&(SI(m,R,!0,!0),Nb[R]=wI),Db&&c==qp&&G&&G.name!==qp&&(P=!0,j=function(){return yI(G,this)}),c)if(y={values:S(qp),keys:u?j:S(FE),entries:S(TI)},h)for(E in y)(km||P||!(E in D))&&VE(D,E,y[E]);else _I({target:r,proto:!0,forced:km||P},y);return h&&D[jE]!==j&&VE(D,jE,j,{}),Nb[r]=j,y},zE=function(e,r){return{value:e,done:r}},WE=Te,pu=uh,CI=pd;rt.f;var RI=BE,GE=zE,xb="Array Iterator",II=CI.set,E_=CI.getterFor(xb);RI(Array,"Array",function(e,r){II(this,{type:xb,target:WE(e),index:0,kind:r})},function(){var e=E_(this),r=e.target,s=e.kind,o=e.index++;return!r||o>=r.length?(e.target=void 0,GE(void 0,!0)):GE(s=="keys"?o:s=="values"?r[o]:[o,r[o]],!1)},"values"),pu.Arguments=pu.Array;var Bo=rt,HE=function(e,r,s){return Bo.f(e,r,s)},HN=rn,$E=HE,zo=xe,AI=Sr("species"),sn=O,Nm=TypeError,v_=function(e,r){if(sn(r,e))return e;throw Nm("Incorrect invocation")},PI=Oe,Lb=Xd,S_=I(Function.toString);PI(Lb.inspectSource)||(Lb.inspectSource=function(e){return S_(e)});var b_=Lb.inspectSource,Mb=I,OI=d,Ub=Oe,kI=jc,Vb=b_,KE=function(){},So=[],$c=rn("Reflect","construct"),fu=/^\s*(?:class|function)\b/,NI=Mb(fu.exec),DI=!fu.exec(KE),ma=function(e){if(!Ub(e))return!1;try{return $c(KE,So,e),!0}catch{return!1}},jb=function(e){if(!Ub(e))return!1;switch(kI(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return DI||!!NI(fu,Vb(e))}catch{return!0}};jb.sham=!0;var $a,Dm,Fb,qE,T_=!$c||OI(function(){var e;return ma(ma.call)||!ma(Object)||!ma(function(){e=!0})||e})?jb:ma,xI=T_,$N=La,YE=TypeError,XE=fn,Kc=function(e){if(xI(e))return e;throw YE($N(e)+" is not a constructor")},xr=He,co=Sr("species"),ss=function(e,r){var s,o=XE(e).constructor;return o===void 0||xr(s=XE(o)[co])?r:Kc(s)},ws=I([].slice),Ec=TypeError,Pl=function(e,r){if(e<r)throw Ec("Not enough arguments");return e},Cs=/(?:ipad|iphone|ipod).*applewebkit/i.test(Tt),bo=M,Yp=re,JE=De,QE=Oe,w_=Ci,ga=d,ZE=o_,xm=ws,mu=su,ev=Pl,Bb=Cs,gh=Lp,Lm=bo.setImmediate,gu=bo.clearImmediate,tv=bo.process,Xp=bo.Dispatch,zb=bo.Function,C_=bo.MessageChannel,nv=bo.String,To=0,qc={},Yc="onreadystatechange";ga(function(){$a=bo.location});var Wo=function(e){if(w_(qc,e)){var r=qc[e];delete qc[e],r()}},rv=function(e){return function(){Wo(e)}},iv=function(e){Wo(e.data)},sv=function(e){bo.postMessage(nv(e),$a.protocol+"//"+$a.host)};Lm&&gu||(Lm=function(e){ev(arguments.length,1);var r=QE(e)?e:zb(e),s=xm(arguments,1);return qc[++To]=function(){Yp(r,void 0,s)},Dm(To),To},gu=function(e){delete qc[e]},gh?Dm=function(e){tv.nextTick(rv(e))}:Xp&&Xp.now?Dm=function(e){Xp.now(rv(e))}:C_&&!Bb?(qE=(Fb=new C_).port2,Fb.port1.onmessage=iv,Dm=JE(qE.postMessage,qE)):bo.addEventListener&&QE(bo.postMessage)&&!bo.importScripts&&$a&&$a.protocol!=="file:"&&!ga(sv)?(Dm=sv,bo.addEventListener("message",iv,!1)):Dm=Yc in mu("script")?function(e){ZE.appendChild(mu("script"))[Yc]=function(){ZE.removeChild(this),Wo(e)}}:function(e){setTimeout(rv(e),0)});var ov={set:Lm,clear:gu},gd=function(){this.head=null,this.tail=null};gd.prototype={add:function(e){var r={item:e,next:null},s=this.tail;s?s.next=r:this.head=r,this.tail=r},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Jp,R_,_d,I_,_h,Wb=gd,LI=/ipad|iphone|ipod/i.test(Tt)&&typeof Pebble<"u",Gb=/web0s(?!.*chrome)/i.test(Tt),_u=M,MI=De,KN=Ve.f,av=ov.set,UI=Wb,Qp=Cs,qN=LI,Mm=Gb,cv=Lp,qi=_u.MutationObserver||_u.WebKitMutationObserver,VI=_u.document,Hb=_u.process,lv=_u.Promise,jI=KN(_u,"queueMicrotask"),uv=jI&&jI.value;if(!uv){var A_=new UI,dv=function(){var e,r;for(cv&&(e=Hb.domain)&&e.exit();r=A_.get();)try{r()}catch(s){throw A_.head&&Jp(),s}e&&e.enter()};Qp||cv||Mm||!qi||!VI?!qN&&lv&&lv.resolve?((I_=lv.resolve(void 0)).constructor=lv,_h=MI(I_.then,I_),Jp=function(){_h(dv)}):cv?Jp=function(){Hb.nextTick(dv)}:(av=MI(av,_u),Jp=function(){av(dv)}):(R_=!0,_d=VI.createTextNode(""),new qi(dv).observe(_d,{characterData:!0}),Jp=function(){_d.data=R_=!R_}),uv=function(e){A_.head||Jp(),A_.add(e)}}var vc=uv,yh=function(e){try{return{error:!1,value:e()}}catch(r){return{error:!0,value:r}}},Zp=M.Promise,yd=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",hv=!yd&&!Lp&&typeof window=="object"&&typeof document=="object",ef=M,Eh=Zp,$b=Oe,Kb=Ua,YN=b_,qb=Sr,XN=hv,FI=yd,pv=oi,P_=Eh&&Eh.prototype,fv=qb("species"),Yb=$b(ef.PromiseRejectionEvent),Xb=Kb("Promise",function(){var e=YN(Eh),r=e!==String(Eh);if(!r&&pv===66||!P_.catch||!P_.finally)return!0;if(!pv||pv<51||!/native code/.test(e)){var s=new Eh(function(c){c(1)}),o=function(c){c(function(){},function(){})};if((s.constructor={})[fv]=o,!(s.then(function(){})instanceof o))return!0}return!r&&(XN||FI)&&!Yb}),O_={CONSTRUCTOR:Xb,REJECTION_EVENT:Yb},Ol={},mv=vt,gv=TypeError,Jb=function(e){var r,s;this.promise=new e(function(o,c){if(r!==void 0||s!==void 0)throw gv("Bad Promise constructor");r=o,s=c}),this.resolve=mv(r),this.reject=mv(s)};Ol.f=function(e){return new Jb(e)};var Um,Qb,JN=Gn,tf=Lp,vh=M,Ed=be,QN=fd,_v=md,p=function(e){var r=HN(e);zo&&r&&!r[AI]&&$E(r,AI,{configurable:!0,get:function(){return this}})},g=vt,w=Oe,k=gt,V=v_,H=ss,ue=ov.set,Ce=vc,Me=function(e,r){try{arguments.length==1?console.error(e):console.error(e,r)}catch{}},st=yh,xt=Wb,Mt=pd,Dt=Zp,Zt=O_,an=Ol,cn="Promise",os=Zt.CONSTRUCTOR,et=Zt.REJECTION_EVENT,Fe=Mt.getterFor(cn),nt=Mt.set,Ft=Dt&&Dt.prototype,ln=Dt,bn=Ft,Rn=vh.TypeError,jn=vh.document,Rs=vh.process,Ar=an.f,Sh=Ar,ZN=!!(jn&&jn.createEvent&&vh.dispatchEvent),Q3="unhandledrejection",Z3=function(e){var r;return!(!k(e)||!w(r=e.then))&&r},e4=function(e,r){var s,o,c,u=r.value,h=r.state==1,m=h?e.ok:e.fail,y=e.resolve,E=e.reject,S=e.domain;try{m?(h||(r.rejection===2&&Hoe(r),r.rejection=1),m===!0?s=u:(S&&S.enter(),s=m(u),S&&(S.exit(),c=!0)),s===e.promise?E(Rn("Promise-chain cycle")):(o=Z3(s))?Ed(o,s,y,E):y(s)):E(u)}catch(R){S&&!c&&S.exit(),E(R)}},t4=function(e,r){e.notified||(e.notified=!0,Ce(function(){for(var s,o=e.reactions;s=o.get();)e4(s,e);e.notified=!1,r&&!e.rejection&&Goe(e)}))},n4=function(e,r,s){var o,c;ZN?((o=jn.createEvent("Event")).promise=r,o.reason=s,o.initEvent(e,!1,!0),vh.dispatchEvent(o)):o={promise:r,reason:s},!et&&(c=vh["on"+e])?c(o):e===Q3&&Me("Unhandled promise rejection",s)},Goe=function(e){Ed(ue,vh,function(){var r,s=e.facade,o=e.value;if(r4(e)&&(r=st(function(){tf?Rs.emit("unhandledRejection",o,s):n4(Q3,s,o)}),e.rejection=tf||r4(e)?2:1,r.error))throw r.value})},r4=function(e){return e.rejection!==1&&!e.parent},Hoe=function(e){Ed(ue,vh,function(){var r=e.facade;tf?Rs.emit("rejectionHandled",r):n4("rejectionhandled",r,e.value)})},yv=function(e,r,s){return function(o){e(r,o,s)}},Ev=function(e,r,s){e.done||(e.done=!0,s&&(e=s),e.value=r,e.state=2,t4(e,!0))},eD=function(e,r,s){if(!e.done){e.done=!0,s&&(e=s);try{if(e.facade===r)throw Rn("Promise can't be resolved itself");var o=Z3(r);o?Ce(function(){var c={done:!1};try{Ed(o,r,yv(eD,c,e),yv(Ev,c,e))}catch(u){Ev(c,u,e)}}):(e.value=r,e.state=1,t4(e,!1))}catch(c){Ev({done:!1},c,e)}}};os&&(bn=(ln=function(e){V(this,bn),g(e),Ed(Um,this);var r=Fe(this);try{e(yv(eD,r),yv(Ev,r))}catch(s){Ev(r,s)}}).prototype,(Um=function(e){nt(this,{type:cn,done:!1,notified:!1,parent:!1,reactions:new xt,rejection:!1,state:0,value:void 0})}).prototype=QN(bn,"then",function(e,r){var s=Fe(this),o=Ar(H(this,ln));return s.parent=!0,o.ok=!w(e)||e,o.fail=w(r)&&r,o.domain=tf?Rs.domain:void 0,s.state==0?s.reactions.add(o):Ce(function(){e4(o,s)}),o.promise}),Qb=function(){var e=new Um,r=Fe(e);this.promise=e,this.resolve=yv(eD,r),this.reject=yv(Ev,r)},an.f=Ar=function(e){return e===ln||e===void 0?new Qb(e):Sh(e)}),JN({global:!0,wrap:!0,forced:os},{Promise:ln}),_v(ln,cn,!1,!0),p(cn);var i4=Sr("iterator"),s4=!1;try{var $oe=0,o4={next:function(){return{done:!!$oe++}},return:function(){s4=!0}};o4[i4]=function(){return this},Array.from(o4,function(){throw 2})}catch{}var Koe=Zp,qoe=function(e,r){if(!s4)return!1;var s=!1;try{var o={};o[i4]=function(){return{next:function(){return{done:s=!0}}}},e(o)}catch{}return s},BI=O_.CONSTRUCTOR||!qoe(function(e){Koe.all(e).then(void 0,function(){})}),Yoe=be,Xoe=vt,Joe=Ol,Qoe=yh,Zoe=ph;Gn({target:"Promise",stat:!0,forced:BI},{all:function(e){var r=this,s=Joe.f(r),o=s.resolve,c=s.reject,u=Qoe(function(){var h=Xoe(r.resolve),m=[],y=0,E=1;Zoe(e,function(S){var R=y++,P=!1;E++,Yoe(h,r,S).then(function(D){P||(P=!0,m[R]=D,--E||o(m))},c)}),--E||o(m)});return u.error&&c(u.value),s.promise}});var eae=Gn,tae=O_.CONSTRUCTOR;Zp&&Zp.prototype,eae({target:"Promise",proto:!0,forced:tae,real:!0},{catch:function(e){return this.then(void 0,e)}});var nae=be,rae=vt,iae=Ol,sae=yh,oae=ph;Gn({target:"Promise",stat:!0,forced:BI},{race:function(e){var r=this,s=iae.f(r),o=s.reject,c=sae(function(){var u=rae(r.resolve);oae(e,function(h){nae(u,r,h).then(s.resolve,o)})});return c.error&&o(c.value),s.promise}});var aae=be,cae=Ol;Gn({target:"Promise",stat:!0,forced:O_.CONSTRUCTOR},{reject:function(e){var r=cae.f(this);return aae(r.reject,void 0,e),r.promise}});var lae=fn,uae=gt,dae=Ol,a4=function(e,r){if(lae(e),uae(r)&&r.constructor===e)return r;var s=dae.f(e);return(0,s.resolve)(r),s.promise},hae=Gn,pae=Zp,fae=O_.CONSTRUCTOR,mae=a4,gae=rn("Promise"),_ae=!fae;hae({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return mae(_ae&&this===gae?pae:this,e)}});var yae=be,Eae=vt,vae=Ol,Sae=yh,bae=ph;Gn({target:"Promise",stat:!0,forced:BI},{allSettled:function(e){var r=this,s=vae.f(r),o=s.resolve,c=s.reject,u=Sae(function(){var h=Eae(r.resolve),m=[],y=0,E=1;bae(e,function(S){var R=y++,P=!1;E++,yae(h,r,S).then(function(D){P||(P=!0,m[R]={status:"fulfilled",value:D},--E||o(m))},function(D){P||(P=!0,m[R]={status:"rejected",reason:D},--E||o(m))})}),--E||o(m)});return u.error&&c(u.value),s.promise}});var Tae=be,wae=vt,Cae=rn,Rae=Ol,Iae=yh,Aae=ph,c4="No one promise resolved";Gn({target:"Promise",stat:!0,forced:BI},{any:function(e){var r=this,s=Cae("AggregateError"),o=Rae.f(r),c=o.resolve,u=o.reject,h=Iae(function(){var m=wae(r.resolve),y=[],E=0,S=1,R=!1;Aae(e,function(P){var D=E++,G=!1;S++,Tae(m,r,P).then(function(j){G||R||(R=!0,c(j))},function(j){G||R||(G=!0,y[D]=j,--S||u(new s(y,c4)))})}),--S||u(new s(y,c4))});return h.error&&u(h.value),o.promise}});var Pae=Gn,tD=Zp,Oae=d,kae=rn,Nae=Oe,Dae=ss,l4=a4,xae=tD&&tD.prototype;Pae({target:"Promise",proto:!0,real:!0,forced:!!tD&&Oae(function(){xae.finally.call({then:function(){}},function(){})})},{finally:function(e){var r=Dae(this,kae("Promise")),s=Nae(e);return this.then(s?function(o){return l4(r,e()).then(function(){return o})}:e,s?function(o){return l4(r,e()).then(function(){throw o})}:e)}});var nD=I,Lae=Vc,Mae=ja,Uae=Lt,Vae=nD("".charAt),u4=nD("".charCodeAt),jae=nD("".slice),d4=function(e){return function(r,s){var o,c,u=Mae(Uae(r)),h=Lae(s),m=u.length;return h<0||h>=m?e?"":void 0:(o=u4(u,h))<55296||o>56319||h+1===m||(c=u4(u,h+1))<56320||c>57343?e?Vae(u,h):o:e?jae(u,h,h+2):c-56320+(o-55296<<10)+65536}},rD={codeAt:d4(!1),charAt:d4(!0)},Fae=rD.charAt,Bae=ja,h4=pd,zae=BE,p4=zE,f4="String Iterator",Wae=h4.set,Gae=h4.getterFor(f4);zae(String,"String",function(e){Wae(this,{type:f4,string:Bae(e),index:0})},function(){var e,r=Gae(this),s=r.string,o=r.index;return o>=s.length?p4(void 0,!0):(e=Fae(s,o),r.index+=e.length,p4(e,!1))});var Hae=Et.Promise,$ae={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Kae=M,qae=jc,Yae=la,m4=uh,g4=Sr("toStringTag");for(var iD in $ae){var _4=Kae[iD],sD=_4&&_4.prototype;sD&&qae(sD)!==g4&&Yae(sD,g4,iD),m4[iD]=m4.Array}var y4=Hae,ht=l(y4),Xae=mc("Array").values,Jae=jc,Qae=Ci,Zae=O,ece=Xae,oD=Array.prototype,tce={DOMTokenList:!0,NodeList:!0},nce=function(e){var r=e.values;return e===oD||Zae(oD,e)&&r===oD.values||Qae(tce,Jae(e))?ece:r},Xc=l(nce),rce=d,ice=Sr("iterator"),aD=!rce(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),r=e.searchParams,s=new URLSearchParams("a=1&a=2"),o="";return e.pathname="c%20d",r.forEach(function(c,u){r.delete("b"),o+=u+c}),s.delete("a",2),!e.toJSON||!s.has("a",1)||s.has("a",2)||!r.size&&!0||!r.sort||e.href!=="http://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[ice]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||o!=="a1c3"||new URL("http://x",void 0).host!=="x"}),sce=fd,oce=pc,ace=rt,cce=qe,zI=function(e,r,s){var o=oce(r);o in e?ace.f(e,o,cce(0,s)):e[o]=s},E4=ge,lce=gi,uce=zI,dce=Array,hce=Math.max,cD=function(e,r,s){for(var o=lce(e),c=E4(r,o),u=E4(s===void 0?o:s,o),h=dce(hce(u-c,0)),m=0;c<u;c++,m++)uce(h,m,e[c]);return h.length=m,h},v4=cD,pce=Math.floor,lD=function(e,r){var s=e.length,o=pce(s/2);return s<8?fce(e,r):mce(e,lD(v4(e,0,o),r),lD(v4(e,o),r),r)},fce=function(e,r){for(var s,o,c=e.length,u=1;u<c;){for(o=u,s=e[u];o&&r(e[o-1],s)>0;)e[o]=e[--o];o!==u++&&(e[o]=s)}return e},mce=function(e,r,s,o){for(var c=r.length,u=s.length,h=0,m=0;h<c||m<u;)e[h+m]=h<c&&m<u?o(r[h],s[m])<=0?r[h++]:s[m++]:h<c?r[h++]:s[m++];return e},S4=lD,uD=Gn,vv=M,WI=be,bh=I,Sv=xe,b4=aD,T4=fd,gce=HE,_ce=function(e,r,s){for(var o in r)s&&s.unsafe&&e[o]?e[o]=r[o]:sce(e,o,r[o],s);return e},yce=md,Ece=UE,dD=pd,w4=v_,hD=Oe,vce=Ci,Sce=De,bce=jc,Tce=fn,C4=gt,Sc=ja,wce=ha,R4=qe,pD=d_,Cce=dd,bv=Pl,Rce=S4,Ice=Sr("iterator"),Zb="URLSearchParams",I4=Zb+"Iterator",A4=dD.set,yu=dD.getterFor(Zb),Ace=dD.getterFor(I4),Pce=Object.getOwnPropertyDescriptor,fD=function(e){if(!Sv)return vv[e];var r=Pce(vv,e);return r&&r.value},P4=fD("fetch"),GI=fD("Request"),eT=fD("Headers"),mD=GI&&GI.prototype,O4=eT&&eT.prototype,Oce=vv.RegExp,kce=vv.TypeError,k4=vv.decodeURIComponent,Nce=vv.encodeURIComponent,Dce=bh("".charAt),N4=bh([].join),k_=bh([].push),gD=bh("".replace),xce=bh([].shift),D4=bh([].splice),x4=bh("".split),Lce=bh("".slice),Mce=/\+/g,L4=Array(4),Uce=function(e){return L4[e-1]||(L4[e-1]=Oce("((?:%[\\da-f]{2}){"+e+"})","gi"))},Vce=function(e){try{return k4(e)}catch{return e}},M4=function(e){var r=gD(e,Mce," "),s=4;try{return k4(r)}catch{for(;s;)r=gD(r,Uce(s--),Vce);return r}},jce=/[!'()~]|%20/g,Fce={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Bce=function(e){return Fce[e]},U4=function(e){return gD(Nce(e),jce,Bce)},_D=Ece(function(e,r){A4(this,{type:I4,iterator:pD(yu(e).entries),kind:r})},"Iterator",function(){var e=Ace(this),r=e.kind,s=e.iterator.next(),o=s.value;return s.done||(s.value=r==="keys"?o.key:r==="values"?o.value:[o.key,o.value]),s},!0),V4=function(e){this.entries=[],this.url=null,e!==void 0&&(C4(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?Dce(e,0)==="?"?Lce(e,1):e:Sc(e)))};V4.prototype={type:Zb,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var r,s,o,c,u,h,m,y=Cce(e);if(y)for(s=(r=pD(e,y)).next;!(o=WI(s,r)).done;){if(u=(c=pD(Tce(o.value))).next,(h=WI(u,c)).done||(m=WI(u,c)).done||!WI(u,c).done)throw kce("Expected sequence with length 2");k_(this.entries,{key:Sc(h.value),value:Sc(m.value)})}else for(var E in e)vce(e,E)&&k_(this.entries,{key:E,value:Sc(e[E])})},parseQuery:function(e){if(e)for(var r,s,o=x4(e,"&"),c=0;c<o.length;)(r=o[c++]).length&&(s=x4(r,"="),k_(this.entries,{key:M4(xce(s)),value:M4(N4(s,"="))}))},serialize:function(){for(var e,r=this.entries,s=[],o=0;o<r.length;)e=r[o++],k_(s,U4(e.key)+"="+U4(e.value));return N4(s,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var HI=function(){w4(this,Tv);var e=A4(this,new V4(arguments.length>0?arguments[0]:void 0));Sv||(this.size=e.entries.length)},Tv=HI.prototype;if(_ce(Tv,{append:function(e,r){var s=yu(this);bv(arguments.length,2),k_(s.entries,{key:Sc(e),value:Sc(r)}),Sv||this.length++,s.updateURL()},delete:function(e){for(var r=yu(this),s=bv(arguments.length,1),o=r.entries,c=Sc(e),u=s<2?void 0:arguments[1],h=u===void 0?u:Sc(u),m=0;m<o.length;){var y=o[m];if(y.key!==c||h!==void 0&&y.value!==h)m++;else if(D4(o,m,1),h!==void 0)break}Sv||(this.size=o.length),r.updateURL()},get:function(e){var r=yu(this).entries;bv(arguments.length,1);for(var s=Sc(e),o=0;o<r.length;o++)if(r[o].key===s)return r[o].value;return null},getAll:function(e){var r=yu(this).entries;bv(arguments.length,1);for(var s=Sc(e),o=[],c=0;c<r.length;c++)r[c].key===s&&k_(o,r[c].value);return o},has:function(e){for(var r=yu(this).entries,s=bv(arguments.length,1),o=Sc(e),c=s<2?void 0:arguments[1],u=c===void 0?c:Sc(c),h=0;h<r.length;){var m=r[h++];if(m.key===o&&(u===void 0||m.value===u))return!0}return!1},set:function(e,r){var s=yu(this);bv(arguments.length,1);for(var o,c=s.entries,u=!1,h=Sc(e),m=Sc(r),y=0;y<c.length;y++)(o=c[y]).key===h&&(u?D4(c,y--,1):(u=!0,o.value=m));u||k_(c,{key:h,value:m}),Sv||(this.size=c.length),s.updateURL()},sort:function(){var e=yu(this);Rce(e.entries,function(r,s){return r.key>s.key?1:-1}),e.updateURL()},forEach:function(e){for(var r,s=yu(this).entries,o=Sce(e,arguments.length>1?arguments[1]:void 0),c=0;c<s.length;)o((r=s[c++]).value,r.key,this)},keys:function(){return new _D(this,"keys")},values:function(){return new _D(this,"values")},entries:function(){return new _D(this,"entries")}},{enumerable:!0}),T4(Tv,Ice,Tv.entries,{}),T4(Tv,"toString",function(){return yu(this).serialize()},{enumerable:!0}),Sv&&gce(Tv,"size",{get:function(){return yu(this).entries.length},configurable:!0,enumerable:!0}),yce(HI,Zb),uD({global:!0,forced:!b4},{URLSearchParams:HI}),!b4&&hD(eT)){var zce=bh(O4.has),Wce=bh(O4.set),j4=function(e){if(C4(e)){var r,s=e.body;if(bce(s)===Zb)return r=e.headers?new eT(e.headers):new eT,zce(r,"content-type")||Wce(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),wce(e,{body:R4(0,Sc(s)),headers:R4(0,r)})}return e};if(hD(P4)&&uD({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return P4(e,arguments.length>1?j4(arguments[1]):{})}}),hD(GI)){var yD=function(e){return w4(this,mD),new GI(e,arguments.length>1?j4(arguments[1]):{})};mD.constructor=yD,yD.prototype=mD,uD({global:!0,dontCallGetSet:!0,forced:!0},{Request:yD})}}var Eu,Gce={URLSearchParams:HI,getState:yu},Hce=Et.URLSearchParams,F4=xe,$ce=I,Kce=be,qce=d,ED=zc,Yce=Bc,Xce=ze,Jce=ea,Qce=kt,wv=Object.assign,B4=Object.defineProperty,Zce=$ce([].concat),ele=!wv||qce(function(){if(F4&&wv({b:1},wv(B4({},"a",{enumerable:!0,get:function(){B4(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},r={},s=Symbol(),o="abcdefghijklmnopqrst";return e[s]=7,o.split("").forEach(function(c){r[c]=c}),wv({},e)[s]!=7||ED(wv({},r)).join("")!=o})?function(e,r){for(var s=Jce(e),o=arguments.length,c=1,u=Yce.f,h=Xce.f;o>c;)for(var m,y=Qce(arguments[c++]),E=u?Zce(ED(y),u(y)):ED(y),S=E.length,R=0;S>R;)m=E[R++],F4&&!Kce(h,y,m)||(s[m]=y[m]);return s}:wv,tle=fn,nle=h_,rle=De,ile=be,sle=ea,ole=function(e,r,s,o){try{return o?r(tle(s)[0],s[1]):r(s)}catch(c){nle(e,"throw",c)}},ale=u_,cle=T_,lle=gi,z4=zI,ule=d_,dle=dd,W4=Array,N_=I,vD=2147483647,hle=/[^\0-\u007E]/,G4=/[.\u3002\uFF0E\uFF61]/g,H4="Overflow: input needs wider integers to process",$4=RangeError,ple=N_(G4.exec),Cv=Math.floor,SD=String.fromCharCode,K4=N_("".charCodeAt),q4=N_([].join),Vm=N_([].push),fle=N_("".replace),mle=N_("".split),gle=N_("".toLowerCase),Y4=function(e){return e+22+75*(e<26)},_le=function(e,r,s){var o=0;for(e=s?Cv(e/700):e>>1,e+=Cv(e/r);e>455;)e=Cv(e/35),o+=36;return Cv(o+36*e/(e+38))},yle=function(e){var r=[];e=function(Y){for(var ee=[],fe=0,ye=Y.length;fe<ye;){var Ee=K4(Y,fe++);if(Ee>=55296&&Ee<=56319&&fe<ye){var _e=K4(Y,fe++);(64512&_e)==56320?Vm(ee,((1023&Ee)<<10)+(1023&_e)+65536):(Vm(ee,Ee),fe--)}else Vm(ee,Ee)}return ee}(e);var s,o,c=e.length,u=128,h=0,m=72;for(s=0;s<e.length;s++)(o=e[s])<128&&Vm(r,SD(o));var y=r.length,E=y;for(y&&Vm(r,"-");E<c;){var S=vD;for(s=0;s<e.length;s++)(o=e[s])>=u&&o<S&&(S=o);var R=E+1;if(S-u>Cv((vD-h)/R))throw $4(H4);for(h+=(S-u)*R,u=S,s=0;s<e.length;s++){if((o=e[s])<u&&++h>vD)throw $4(H4);if(o==u){for(var P=h,D=36;;){var G=D<=m?1:D>=m+26?26:D-m;if(P<G)break;var j=P-G,B=36-G;Vm(r,SD(Y4(G+j%B))),P=Cv(j/B),D+=36}Vm(r,SD(Y4(P))),m=_le(h,R,E==y),h=0,E++}}h++,u++}return q4(r,"")},Ele=Gn,bD=xe,vle=aD,TD=M,X4=De,vu=I,$I=fd,Su=HE,Sle=v_,wD=Ci,CD=ele,Rv=function(e){var r=sle(e),s=cle(this),o=arguments.length,c=o>1?arguments[1]:void 0,u=c!==void 0;u&&(c=rle(c,o>2?arguments[2]:void 0));var h,m,y,E,S,R,P=dle(r),D=0;if(!P||this===W4&&ale(P))for(h=lle(r),m=s?new this(h):W4(h);h>D;D++)R=u?c(r[D],D):r[D],z4(m,D,R);else for(S=(E=ule(r,P)).next,m=s?new this:[];!(y=ile(S,E)).done;D++)R=u?ole(E,c,[y.value,D],!0):y.value,z4(m,D,R);return m.length=D,m},vd=cD,ble=rD.codeAt,Tle=function(e){var r,s,o=[],c=mle(fle(gle(e),G4,"."),".");for(r=0;r<c.length;r++)s=c[r],Vm(o,ple(hle,s)?"xn--"+yle(s):s);return q4(o,".")},nf=ja,wle=md,Cle=Pl,J4=Gce,Q4=pd,Rle=Q4.set,KI=Q4.getterFor("URL"),Ile=J4.URLSearchParams,Ale=J4.getState,tT=TD.URL,RD=TD.TypeError,qI=TD.parseInt,Ple=Math.floor,Z4=Math.pow,bu=vu("".charAt),Sd=vu(/./.exec),nT=vu([].join),Ole=vu(1 .toString),kle=vu([].pop),Iv=vu([].push),ID=vu("".replace),Nle=vu([].shift),Dle=vu("".split),rT=vu("".slice),YI=vu("".toLowerCase),xle=vu([].unshift),AD="Invalid scheme",D_="Invalid host",e5="Invalid port",t5=/[a-z]/i,Lle=/[\d+-.a-z]/i,PD=/\d/,Mle=/^0x/i,Ule=/^[0-7]+$/,Vle=/^\d+$/,n5=/^[\da-f]+$/i,jle=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Fle=/[\0\t\n\r #/:<>?@[\\\]^|]/,Ble=/^[\u0000-\u0020]+/,zle=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Wle=/[\t\n\r]/g,iT=function(e){var r,s,o,c;if(typeof e=="number"){for(r=[],s=0;s<4;s++)xle(r,e%256),e=Ple(e/256);return nT(r,".")}if(typeof e=="object"){for(r="",o=function(u){for(var h=null,m=1,y=null,E=0,S=0;S<8;S++)u[S]!==0?(E>m&&(h=y,m=E),y=null,E=0):(y===null&&(y=S),++E);return E>m&&(h=y,m=E),h}(e),s=0;s<8;s++)c&&e[s]===0||(c&&(c=!1),o===s?(r+=s?":":"::",c=!0):(r+=Ole(e[s],16),s<7&&(r+=":")));return"["+r+"]"}return e},XI={},r5=CD({},XI,{" ":1,'"':1,"<":1,">":1,"`":1}),i5=CD({},r5,{"#":1,"?":1,"{":1,"}":1}),OD=CD({},i5,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),jm=function(e,r){var s=ble(e,0);return s>32&&s<127&&!wD(r,e)?e:encodeURIComponent(e)},JI={ftp:21,file:null,http:80,https:443,ws:80,wss:443},sT=function(e,r){var s;return e.length==2&&Sd(t5,bu(e,0))&&((s=bu(e,1))==":"||!r&&s=="|")},s5=function(e){var r;return e.length>1&&sT(rT(e,0,2))&&(e.length==2||(r=bu(e,2))==="/"||r==="\\"||r==="?"||r==="#")},Gle=function(e){return e==="."||YI(e)==="%2e"},kD={},o5={},ND={},a5={},c5={},DD={},l5={},u5={},QI={},ZI={},xD={},LD={},MD={},UD={},d5={},VD={},Av={},Th={},h5={},x_={},rf={},jD=function(e,r,s){var o,c,u,h=nf(e);if(r){if(c=this.parse(h))throw RD(c);this.searchParams=null}else{if(s!==void 0&&(o=new jD(s,!0)),c=this.parse(h,null,o))throw RD(c);(u=Ale(new Ile)).bindURL(this),this.searchParams=u}};jD.prototype={type:"URL",parse:function(e,r,s){var o,c,u,h,m,y=this,E=r||kD,S=0,R="",P=!1,D=!1,G=!1;for(e=nf(e),r||(y.scheme="",y.username="",y.password="",y.host=null,y.port=null,y.path=[],y.query=null,y.fragment=null,y.cannotBeABaseURL=!1,e=ID(e,Ble,""),e=ID(e,zle,"$1")),e=ID(e,Wle,""),o=Rv(e);S<=o.length;){switch(c=o[S],E){case kD:if(!c||!Sd(t5,c)){if(r)return AD;E=ND;continue}R+=YI(c),E=o5;break;case o5:if(c&&(Sd(Lle,c)||c=="+"||c=="-"||c=="."))R+=YI(c);else{if(c!=":"){if(r)return AD;R="",E=ND,S=0;continue}if(r&&(y.isSpecial()!=wD(JI,R)||R=="file"&&(y.includesCredentials()||y.port!==null)||y.scheme=="file"&&!y.host))return;if(y.scheme=R,r)return void(y.isSpecial()&&JI[y.scheme]==y.port&&(y.port=null));R="",y.scheme=="file"?E=UD:y.isSpecial()&&s&&s.scheme==y.scheme?E=a5:y.isSpecial()?E=u5:o[S+1]=="/"?(E=c5,S++):(y.cannotBeABaseURL=!0,Iv(y.path,""),E=h5)}break;case ND:if(!s||s.cannotBeABaseURL&&c!="#")return AD;if(s.cannotBeABaseURL&&c=="#"){y.scheme=s.scheme,y.path=vd(s.path),y.query=s.query,y.fragment="",y.cannotBeABaseURL=!0,E=rf;break}E=s.scheme=="file"?UD:DD;continue;case a5:if(c!="/"||o[S+1]!="/"){E=DD;continue}E=QI,S++;break;case c5:if(c=="/"){E=ZI;break}E=Th;continue;case DD:if(y.scheme=s.scheme,c==Eu)y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=vd(s.path),y.query=s.query;else if(c=="/"||c=="\\"&&y.isSpecial())E=l5;else if(c=="?")y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=vd(s.path),y.query="",E=x_;else{if(c!="#"){y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=vd(s.path),y.path.length--,E=Th;continue}y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,y.path=vd(s.path),y.query=s.query,y.fragment="",E=rf}break;case l5:if(!y.isSpecial()||c!="/"&&c!="\\"){if(c!="/"){y.username=s.username,y.password=s.password,y.host=s.host,y.port=s.port,E=Th;continue}E=ZI}else E=QI;break;case u5:if(E=QI,c!="/"||bu(R,S+1)!="/")continue;S++;break;case QI:if(c!="/"&&c!="\\"){E=ZI;continue}break;case ZI:if(c=="@"){P&&(R="%40"+R),P=!0,u=Rv(R);for(var j=0;j<u.length;j++){var B=u[j];if(B!=":"||G){var Y=jm(B,OD);G?y.password+=Y:y.username+=Y}else G=!0}R=""}else if(c==Eu||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()){if(P&&R=="")return"Invalid authority";S-=Rv(R).length+1,R="",E=xD}else R+=c;break;case xD:case LD:if(r&&y.scheme=="file"){E=VD;continue}if(c!=":"||D){if(c==Eu||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()){if(y.isSpecial()&&R=="")return D_;if(r&&R==""&&(y.includesCredentials()||y.port!==null))return;if(h=y.parseHost(R))return h;if(R="",E=Av,r)return;continue}c=="["?D=!0:c=="]"&&(D=!1),R+=c}else{if(R=="")return D_;if(h=y.parseHost(R))return h;if(R="",E=MD,r==LD)return}break;case MD:if(!Sd(PD,c)){if(c==Eu||c=="/"||c=="?"||c=="#"||c=="\\"&&y.isSpecial()||r){if(R!=""){var ee=qI(R,10);if(ee>65535)return e5;y.port=y.isSpecial()&&ee===JI[y.scheme]?null:ee,R=""}if(r)return;E=Av;continue}return e5}R+=c;break;case UD:if(y.scheme="file",c=="/"||c=="\\")E=d5;else{if(!s||s.scheme!="file"){E=Th;continue}if(c==Eu)y.host=s.host,y.path=vd(s.path),y.query=s.query;else if(c=="?")y.host=s.host,y.path=vd(s.path),y.query="",E=x_;else{if(c!="#"){s5(nT(vd(o,S),""))||(y.host=s.host,y.path=vd(s.path),y.shortenPath()),E=Th;continue}y.host=s.host,y.path=vd(s.path),y.query=s.query,y.fragment="",E=rf}}break;case d5:if(c=="/"||c=="\\"){E=VD;break}s&&s.scheme=="file"&&!s5(nT(vd(o,S),""))&&(sT(s.path[0],!0)?Iv(y.path,s.path[0]):y.host=s.host),E=Th;continue;case VD:if(c==Eu||c=="/"||c=="\\"||c=="?"||c=="#"){if(!r&&sT(R))E=Th;else if(R==""){if(y.host="",r)return;E=Av}else{if(h=y.parseHost(R))return h;if(y.host=="localhost"&&(y.host=""),r)return;R="",E=Av}continue}R+=c;break;case Av:if(y.isSpecial()){if(E=Th,c!="/"&&c!="\\")continue}else if(r||c!="?")if(r||c!="#"){if(c!=Eu&&(E=Th,c!="/"))continue}else y.fragment="",E=rf;else y.query="",E=x_;break;case Th:if(c==Eu||c=="/"||c=="\\"&&y.isSpecial()||!r&&(c=="?"||c=="#")){if((m=YI(m=R))===".."||m==="%2e."||m===".%2e"||m==="%2e%2e"?(y.shortenPath(),c=="/"||c=="\\"&&y.isSpecial()||Iv(y.path,"")):Gle(R)?c=="/"||c=="\\"&&y.isSpecial()||Iv(y.path,""):(y.scheme=="file"&&!y.path.length&&sT(R)&&(y.host&&(y.host=""),R=bu(R,0)+":"),Iv(y.path,R)),R="",y.scheme=="file"&&(c==Eu||c=="?"||c=="#"))for(;y.path.length>1&&y.path[0]==="";)Nle(y.path);c=="?"?(y.query="",E=x_):c=="#"&&(y.fragment="",E=rf)}else R+=jm(c,i5);break;case h5:c=="?"?(y.query="",E=x_):c=="#"?(y.fragment="",E=rf):c!=Eu&&(y.path[0]+=jm(c,XI));break;case x_:r||c!="#"?c!=Eu&&(c=="'"&&y.isSpecial()?y.query+="%27":y.query+=c=="#"?"%23":jm(c,XI)):(y.fragment="",E=rf);break;case rf:c!=Eu&&(y.fragment+=jm(c,r5))}S++}},parseHost:function(e){var r,s,o;if(bu(e,0)=="["){if(bu(e,e.length-1)!="]"||(r=function(c){var u,h,m,y,E,S,R,P=[0,0,0,0,0,0,0,0],D=0,G=null,j=0,B=function(){return bu(c,j)};if(B()==":"){if(bu(c,1)!=":")return;j+=2,G=++D}for(;B();){if(D==8)return;if(B()!=":"){for(u=h=0;h<4&&Sd(n5,B());)u=16*u+qI(B(),16),j++,h++;if(B()=="."){if(h==0||(j-=h,D>6))return;for(m=0;B();){if(y=null,m>0){if(!(B()=="."&&m<4))return;j++}if(!Sd(PD,B()))return;for(;Sd(PD,B());){if(E=qI(B(),10),y===null)y=E;else{if(y==0)return;y=10*y+E}if(y>255)return;j++}P[D]=256*P[D]+y,++m!=2&&m!=4||D++}if(m!=4)return;break}if(B()==":"){if(j++,!B())return}else if(B())return;P[D++]=u}else{if(G!==null)return;j++,G=++D}}if(G!==null)for(S=D-G,D=7;D!=0&&S>0;)R=P[D],P[D--]=P[G+S-1],P[G+--S]=R;else if(D!=8)return;return P}(rT(e,1,-1)),!r))return D_;this.host=r}else if(this.isSpecial()){if(e=Tle(e),Sd(jle,e)||(r=function(c){var u,h,m,y,E,S,R,P=Dle(c,".");if(P.length&&P[P.length-1]==""&&P.length--,(u=P.length)>4)return c;for(h=[],m=0;m<u;m++){if((y=P[m])=="")return c;if(E=10,y.length>1&&bu(y,0)=="0"&&(E=Sd(Mle,y)?16:8,y=rT(y,E==8?1:2)),y==="")S=0;else{if(!Sd(E==10?Vle:E==8?Ule:n5,y))return c;S=qI(y,E)}Iv(h,S)}for(m=0;m<u;m++)if(S=h[m],m==u-1){if(S>=Z4(256,5-u))return null}else if(S>255)return null;for(R=kle(h),m=0;m<h.length;m++)R+=h[m]*Z4(256,3-m);return R}(e),r===null))return D_;this.host=r}else{if(Sd(Fle,e))return D_;for(r="",s=Rv(e),o=0;o<s.length;o++)r+=jm(s[o],XI);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return wD(JI,this.scheme)},shortenPath:function(){var e=this.path,r=e.length;!r||this.scheme=="file"&&r==1&&sT(e[0],!0)||e.length--},serialize:function(){var e=this,r=e.scheme,s=e.username,o=e.password,c=e.host,u=e.port,h=e.path,m=e.query,y=e.fragment,E=r+":";return c!==null?(E+="//",e.includesCredentials()&&(E+=s+(o?":"+o:"")+"@"),E+=iT(c),u!==null&&(E+=":"+u)):r=="file"&&(E+="//"),E+=e.cannotBeABaseURL?h[0]:h.length?"/"+nT(h,"/"):"",m!==null&&(E+="?"+m),y!==null&&(E+="#"+y),E},setHref:function(e){var r=this.parse(e);if(r)throw RD(r);this.searchParams.update()},getOrigin:function(){var e=this.scheme,r=this.port;if(e=="blob")try{return new Pv(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+iT(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(nf(e)+":",kD)},getUsername:function(){return this.username},setUsername:function(e){var r=Rv(nf(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var s=0;s<r.length;s++)this.username+=jm(r[s],OD)}},getPassword:function(){return this.password},setPassword:function(e){var r=Rv(nf(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var s=0;s<r.length;s++)this.password+=jm(r[s],OD)}},getHost:function(){var e=this.host,r=this.port;return e===null?"":r===null?iT(e):iT(e)+":"+r},setHost:function(e){this.cannotBeABaseURL||this.parse(e,xD)},getHostname:function(){var e=this.host;return e===null?"":iT(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,LD)},getPort:function(){var e=this.port;return e===null?"":nf(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=nf(e))==""?this.port=null:this.parse(e,MD))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+nT(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Av))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=nf(e))==""?this.query=null:(bu(e,0)=="?"&&(e=rT(e,1)),this.query="",this.parse(e,x_)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=nf(e))!=""?(bu(e,0)=="#"&&(e=rT(e,1)),this.fragment="",this.parse(e,rf)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Pv=function(e){var r=Sle(this,bc),s=Cle(arguments.length,1)>1?arguments[1]:void 0,o=Rle(r,new jD(e,!1,s));bD||(r.href=o.serialize(),r.origin=o.getOrigin(),r.protocol=o.getProtocol(),r.username=o.getUsername(),r.password=o.getPassword(),r.host=o.getHost(),r.hostname=o.getHostname(),r.port=o.getPort(),r.pathname=o.getPathname(),r.search=o.getSearch(),r.searchParams=o.getSearchParams(),r.hash=o.getHash())},bc=Pv.prototype,Tu=function(e,r){return{get:function(){return KI(this)[e]()},set:r&&function(s){return KI(this)[r](s)},configurable:!0,enumerable:!0}};if(bD&&(Su(bc,"href",Tu("serialize","setHref")),Su(bc,"origin",Tu("getOrigin")),Su(bc,"protocol",Tu("getProtocol","setProtocol")),Su(bc,"username",Tu("getUsername","setUsername")),Su(bc,"password",Tu("getPassword","setPassword")),Su(bc,"host",Tu("getHost","setHost")),Su(bc,"hostname",Tu("getHostname","setHostname")),Su(bc,"port",Tu("getPort","setPort")),Su(bc,"pathname",Tu("getPathname","setPathname")),Su(bc,"search",Tu("getSearch","setSearch")),Su(bc,"searchParams",Tu("getSearchParams")),Su(bc,"hash",Tu("getHash","setHash"))),$I(bc,"toJSON",function(){return KI(this).serialize()},{enumerable:!0}),$I(bc,"toString",function(){return KI(this).serialize()},{enumerable:!0}),tT){var p5=tT.createObjectURL,f5=tT.revokeObjectURL;p5&&$I(Pv,"createObjectURL",X4(p5,tT)),f5&&$I(Pv,"revokeObjectURL",X4(f5,tT))}wle(Pv,"URL"),Ele({global:!0,forced:!vle,sham:!bD},{URL:Pv});var Hle=Gn,$le=d,Kle=Pl,m5=ja,qle=aD,g5=rn("URL");Hle({target:"URL",stat:!0,forced:!(qle&&$le(function(){g5.canParse()}))},{canParse:function(e){var r=Kle(arguments.length,1),s=m5(e),o=r<2||arguments[1]===void 0?void 0:m5(arguments[1]);try{return!!new g5(s,o)}catch{return!1}}});var eA=l(Et.URL);let _5=!0,y5=!0;function tA(e,r,s){const o=e.match(r);return o&&o.length>=s&&parseInt(o[s],10)}function L_(e,r,s){if(!e.RTCPeerConnection)return;const o=e.RTCPeerConnection.prototype,c=o.addEventListener;o.addEventListener=function(h,m){if(h!==r)return c.apply(this,arguments);const y=E=>{const S=s(E);S&&(m.handleEvent?m.handleEvent(S):m(S))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(m,y),c.apply(this,[h,y])};const u=o.removeEventListener;o.removeEventListener=function(h,m){if(h!==r||!this._eventMap||!this._eventMap[r])return u.apply(this,arguments);if(!this._eventMap[r].has(m))return u.apply(this,arguments);const y=this._eventMap[r].get(m);return this._eventMap[r].delete(m),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,u.apply(this,[h,y])},Object.defineProperty(o,"on"+r,{get(){return this["_on"+r]},set(h){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),h&&this.addEventListener(r,this["_on"+r]=h)},enumerable:!0,configurable:!0})}function Yle(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(_5=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Xle(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(y5=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function E5(){if(typeof window=="object"){if(_5)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function FD(e,r){y5&&console.warn(e+" is deprecated, please use "+r+" instead.")}function v5(e){return Object.prototype.toString.call(e)==="[object Object]"}function S5(e){var r;return v5(e)?gc(r=Object.keys(e)).call(r,function(s,o){const c=v5(e[o]),u=c?S5(e[o]):e[o],h=c&&!Object.keys(u).length;return u===void 0||h?s:Object.assign(s,{[o]:u})},{}):e}function BD(e,r,s){r&&!s.has(r.id)&&(s.set(r.id,r),Object.keys(r).forEach(o=>{o.endsWith("Id")?BD(e,e.get(r[o]),s):o.endsWith("Ids")&&r[o].forEach(c=>{BD(e,e.get(c),s)})}))}function b5(e,r,s){const o=s?"outbound-rtp":"inbound-rtp",c=new Map;if(r===null)return c;const u=[];return e.forEach(h=>{h.type==="track"&&h.trackIdentifier===r.id&&u.push(h)}),u.forEach(h=>{e.forEach(m=>{m.type===o&&m.trackId===h.id&&BD(e,m,c)})}),c}const T5=E5;function w5(e,r){const s=e&&e.navigator;if(!s.mediaDevices)return;const o=function(h){if(typeof h!="object"||h.mandatory||h.optional)return h;const m={};return Object.keys(h).forEach(y=>{if(y==="require"||y==="advanced"||y==="mediaSource")return;const E=typeof h[y]=="object"?h[y]:{ideal:h[y]};E.exact!==void 0&&typeof E.exact=="number"&&(E.min=E.max=E.exact);const S=function(R,P){return R?R+P.charAt(0).toUpperCase()+P.slice(1):P==="deviceId"?"sourceId":P};if(E.ideal!==void 0){m.optional=m.optional||[];let R={};typeof E.ideal=="number"?(R[S("min",y)]=E.ideal,m.optional.push(R),R={},R[S("max",y)]=E.ideal,m.optional.push(R)):(R[S("",y)]=E.ideal,m.optional.push(R))}E.exact!==void 0&&typeof E.exact!="number"?(m.mandatory=m.mandatory||{},m.mandatory[S("",y)]=E.exact):["min","max"].forEach(R=>{E[R]!==void 0&&(m.mandatory=m.mandatory||{},m.mandatory[S(R,y)]=E[R])})}),h.advanced&&(m.optional=(m.optional||[]).concat(h.advanced)),m},c=function(h,m){if(r.version>=61)return m(h);if((h=JSON.parse(JSON.stringify(h)))&&typeof h.audio=="object"){const y=function(E,S,R){S in E&&!(R in E)&&(E[R]=E[S],delete E[S])};y((h=JSON.parse(JSON.stringify(h))).audio,"autoGainControl","googAutoGainControl"),y(h.audio,"noiseSuppression","googNoiseSuppression"),h.audio=o(h.audio)}if(h&&typeof h.video=="object"){let y=h.video.facingMode;y=y&&(typeof y=="object"?y:{ideal:y});const E=r.version<66;if(y&&(y.exact==="user"||y.exact==="environment"||y.ideal==="user"||y.ideal==="environment")&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||E)){let S;if(delete h.video.facingMode,y.exact==="environment"||y.ideal==="environment"?S=["back","rear"]:y.exact!=="user"&&y.ideal!=="user"||(S=["front"]),S)return s.mediaDevices.enumerateDevices().then(R=>{let P=(R=R.filter(D=>D.kind==="videoinput")).find(D=>S.some(G=>{var j;return ct(j=D.label.toLowerCase()).call(j,G)}));return!P&&R.length&&ct(S).call(S,"back")&&(P=R[R.length-1]),P&&(h.video.deviceId=y.exact?{exact:P.deviceId}:{ideal:P.deviceId}),h.video=o(h.video),T5("chrome: "+JSON.stringify(h)),m(h)})}h.video=o(h.video)}return T5("chrome: "+JSON.stringify(h)),m(h)},u=function(h){return r.version>=64?h:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[h.name]||h.name,message:h.message,constraint:h.constraint||h.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(s.getUserMedia=(function(h,m,y){c(h,E=>{s.webkitGetUserMedia(E,m,S=>{y&&y(u(S))})})}).bind(s),s.mediaDevices.getUserMedia){const h=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(m){return c(m,y=>h(y).then(E=>{if(y.audio&&!E.getAudioTracks().length||y.video&&!E.getVideoTracks().length)throw E.getTracks().forEach(S=>{S.stop()}),new DOMException("","NotFoundError");return E},E=>ht.reject(u(E))))}}}function C5(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function R5(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=s=>{s.stream.addEventListener("addtrack",o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.track.id):{track:o.track};const u=new Event("track");u.track=o.track,u.receiver=c,u.transceiver={receiver:c},u.streams=[s.stream],this.dispatchEvent(u)}),s.stream.getTracks().forEach(o=>{let c;c=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(h=>h.track&&h.track.id===o.id):{track:o};const u=new Event("track");u.track=o,u.receiver=c,u.transceiver={receiver:c},u.streams=[s.stream],this.dispatchEvent(u)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else L_(e,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function I5(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const r=function(c,u){return{track:u,get dtmf(){return this._dtmf===void 0&&(u.kind==="audio"?this._dtmf=c.createDTMFSender(u):this._dtmf=null),this._dtmf},_pc:c}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const c=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(h,m){let y=c.apply(this,arguments);return y||(y=r(this,h),this._senders.push(y)),y};const u=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(h){u.apply(this,arguments);const m=this._senders.indexOf(h);m!==-1&&this._senders.splice(m,1)}}const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){this._senders=this._senders||[],s.apply(this,[c]),c.getTracks().forEach(u=>{this._senders.push(r(this,u))})};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._senders=this._senders||[],o.apply(this,[c]),c.getTracks().forEach(u=>{const h=this._senders.find(m=>m.track===u);h&&this._senders.splice(this._senders.indexOf(h),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const s=r.apply(this,[]);return s.forEach(o=>o._pc=this),s},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function A5(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[s,o,c]=arguments;if(arguments.length>0&&typeof s=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof s!="function"))return r.apply(this,[]);const u=function(m){const y={};return m.result().forEach(E=>{const S={id:E.id,timestamp:E.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[E.type]||E.type};E.names().forEach(R=>{S[R]=E.stat(R)}),y[S.id]=S}),y},h=function(m){return new Map(Object.keys(m).map(y=>[y,m[y]]))};if(arguments.length>=2){const m=function(y){o(h(u(y)))};return r.apply(this,[m,s])}return new ht((m,y)=>{r.apply(this,[function(E){m(h(u(E)))},y])}).then(o,c)}}function P5(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const s=e.RTCPeerConnection.prototype.getSenders;s&&(e.RTCPeerConnection.prototype.getSenders=function(){const c=s.apply(this,[]);return c.forEach(u=>u._pc=this),c});const o=e.RTCPeerConnection.prototype.addTrack;o&&(e.RTCPeerConnection.prototype.addTrack=function(){const c=o.apply(this,arguments);return c._pc=this,c}),e.RTCRtpSender.prototype.getStats=function(){const c=this;return this._pc.getStats().then(u=>b5(u,c.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const s=e.RTCPeerConnection.prototype.getReceivers;s&&(e.RTCPeerConnection.prototype.getReceivers=function(){const o=s.apply(this,[]);return o.forEach(c=>c._pc=this),o}),L_(e,"track",o=>(o.receiver._pc=o.srcElement,o)),e.RTCRtpReceiver.prototype.getStats=function(){const o=this;return this._pc.getStats().then(c=>b5(c,o.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const s=arguments[0];let o,c,u;return this.getSenders().forEach(h=>{h.track===s&&(o?u=!0:o=h)}),this.getReceivers().forEach(h=>(h.track===s&&(c?u=!0:c=h),h.track===s)),u||o&&c?ht.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):o?o.getStats():c?c.getStats():ht.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function O5(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(u=>this._shimmedLocalStreams[u][0])};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,h){if(!h)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const m=r.apply(this,arguments);return this._shimmedLocalStreams[h.id]?this._shimmedLocalStreams[h.id].indexOf(m)===-1&&this._shimmedLocalStreams[h.id].push(m):this._shimmedLocalStreams[h.id]=[h,m],m};const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(y=>{if(this.getSenders().find(S=>S.track===y))throw new DOMException("Track already exists.","InvalidAccessError")});const h=this.getSenders();s.apply(this,arguments);const m=this.getSenders().filter(y=>h.indexOf(y)===-1);this._shimmedLocalStreams[u.id]=[u].concat(m)};const o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],o.apply(this,arguments)};const c=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(h=>{const m=this._shimmedLocalStreams[h].indexOf(u);m!==-1&&this._shimmedLocalStreams[h].splice(m,1),this._shimmedLocalStreams[h].length===1&&delete this._shimmedLocalStreams[h]}),c.apply(this,arguments)}}function k5(e,r){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&r.version>=65)return O5(e);const s=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const y=s.apply(this);return this._reverseStreams=this._reverseStreams||{},y.map(E=>this._reverseStreams[E.id])};const o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(y){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},y.getTracks().forEach(E=>{if(this.getSenders().find(R=>R.track===E))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[y.id]){const E=new e.MediaStream(y.getTracks());this._streams[y.id]=E,this._reverseStreams[E.id]=y,y=E}o.apply(this,[y])};const c=e.RTCPeerConnection.prototype.removeStream;function u(y,E){let S=E.sdp;return Object.keys(y._reverseStreams||[]).forEach(R=>{const P=y._reverseStreams[R],D=y._streams[P.id];S=S.replace(new RegExp(D.id,"g"),P.id)}),new RTCSessionDescription({type:E.type,sdp:S})}e.RTCPeerConnection.prototype.removeStream=function(y){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.apply(this,[this._streams[y.id]||y]),delete this._reverseStreams[this._streams[y.id]?this._streams[y.id].id:y.id],delete this._streams[y.id]},e.RTCPeerConnection.prototype.addTrack=function(y,E){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const S=[].slice.call(arguments,1);if(S.length!==1||!S[0].getTracks().find(D=>D===y))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(D=>D.track===y))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const P=this._streams[E.id];if(P)P.addTrack(y),ht.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const D=new e.MediaStream([y]);this._streams[E.id]=D,this._reverseStreams[D.id]=E,this.addStream(D)}return this.getSenders().find(D=>D.track===y)},["createOffer","createAnswer"].forEach(function(y){const E=e.RTCPeerConnection.prototype[y],S={[y](){const R=arguments;return arguments.length&&typeof arguments[0]=="function"?E.apply(this,[P=>{const D=u(this,P);R[0].apply(null,[D])},P=>{R[1]&&R[1].apply(null,P)},arguments[2]]):E.apply(this,arguments).then(P=>u(this,P))}};e.RTCPeerConnection.prototype[y]=S[y]});const h=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(y,E){let S=E.sdp;return Object.keys(y._reverseStreams||[]).forEach(R=>{const P=y._reverseStreams[R],D=y._streams[P.id];S=S.replace(new RegExp(P.id,"g"),D.id)}),new RTCSessionDescription({type:E.type,sdp:S})}(this,arguments[0]),h.apply(this,arguments)):h.apply(this,arguments)};const m=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const y=m.get.apply(this);return y.type===""?y:u(this,y)}}),e.RTCPeerConnection.prototype.removeTrack=function(y){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!y._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(y._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let E;this._streams=this._streams||{},Object.keys(this._streams).forEach(S=>{this._streams[S].getTracks().find(R=>y.track===R)&&(E=this._streams[S])}),E&&(E.getTracks().length===1?this.removeStream(this._reverseStreams[E.id]):E.removeTrack(y.track),this.dispatchEvent(new Event("negotiationneeded")))}}function zD(e,r){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const o=e.RTCPeerConnection.prototype[s],c={[s](){return arguments[0]=new(s==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[s]=c[s]})}function N5(e,r){L_(e,"negotiationneeded",s=>{const o=s.target;if(!(r.version<72||o.getConfiguration&&o.getConfiguration().sdpSemantics==="plan-b")||o.signalingState==="stable")return s})}var D5=Object.freeze({__proto__:null,fixNegotiationNeeded:N5,shimAddTrackRemoveTrack:k5,shimAddTrackRemoveTrackWithNative:O5,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof r=="function"?e.navigator.mediaDevices.getDisplayMedia=function(s){return r(s).then(o=>{const c=s.video&&s.video.width,u=s.video&&s.video.height,h=s.video&&s.video.frameRate;return s.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:o,maxFrameRate:h||3}},c&&(s.video.mandatory.maxWidth=c),u&&(s.video.mandatory.maxHeight=u),e.navigator.mediaDevices.getUserMedia(s)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:I5,shimGetStats:A5,shimGetUserMedia:w5,shimMediaStream:C5,shimOnTrack:R5,shimPeerConnection:zD,shimSenderReceiverGetStats:P5});function x5(e,r){const s=e&&e.navigator,o=e&&e.MediaStreamTrack;if(s.getUserMedia=function(c,u,h){FD("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(c).then(u,h)},!(r.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const c=function(h,m,y){m in h&&!(y in h)&&(h[y]=h[m],delete h[m])},u=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(h){return typeof h=="object"&&typeof h.audio=="object"&&(h=JSON.parse(JSON.stringify(h)),c(h.audio,"autoGainControl","mozAutoGainControl"),c(h.audio,"noiseSuppression","mozNoiseSuppression")),u(h)},o&&o.prototype.getSettings){const h=o.prototype.getSettings;o.prototype.getSettings=function(){const m=h.apply(this,arguments);return c(m,"mozAutoGainControl","autoGainControl"),c(m,"mozNoiseSuppression","noiseSuppression"),m}}if(o&&o.prototype.applyConstraints){const h=o.prototype.applyConstraints;o.prototype.applyConstraints=function(m){return this.kind==="audio"&&typeof m=="object"&&(m=JSON.parse(JSON.stringify(m)),c(m,"autoGainControl","mozAutoGainControl"),c(m,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[m])}}}}function L5(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function WD(e,r){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(c){const u=e.RTCPeerConnection.prototype[c],h={[c](){return arguments[0]=new(c==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)}};e.RTCPeerConnection.prototype[c]=h[c]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[c,u,h]=arguments;return o.apply(this,[c||null]).then(m=>{if(r.version<53&&!u)try{m.forEach(y=>{y.type=s[y.type]||y.type})}catch(y){if(y.name!=="TypeError")throw y;m.forEach((E,S)=>{m.set(S,Object.assign({},E,{type:s[E.type]||E.type}))})}return m}).then(u,h)}}function M5(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=r.apply(this,[]);return o.forEach(c=>c._pc=this),o});const s=e.RTCPeerConnection.prototype.addTrack;s&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=s.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ht.resolve(new Map)}}function U5(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const s=r.apply(this,[]);return s.forEach(o=>o._pc=this),s}),L_(e,"track",s=>(s.receiver._pc=s.srcElement,s)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function V5(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(r){FD("removeStream","removeTrack"),this.getSenders().forEach(s=>{var o;s.track&&ct(o=r.getTracks()).call(o,s.track)&&this.removeTrack(s)})})}function j5(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function F5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.addTransceiver;r&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let s=arguments[1]&&arguments[1].sendEncodings;s===void 0&&(s=[]),s=[...s];const o=s.length>0;o&&s.forEach(u=>{if("rid"in u&&!/^[a-z0-9]{0,16}$/i.test(u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in u&&!(parseFloat(u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in u&&!(parseFloat(u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const c=r.apply(this,arguments);if(o){const{sender:u}=c,h=u.getParameters();(!("encodings"in h)||h.encodings.length===1&&Object.keys(h.encodings[0]).length===0)&&(h.encodings=s,u.sendEncodings=s,this.setParametersPromises.push(u.setParameters(h).then(()=>{delete u.sendEncodings}).catch(()=>{delete u.sendEncodings})))}return c})}function B5(e){if(typeof e!="object"||!e.RTCRtpSender)return;const r=e.RTCRtpSender.prototype.getParameters;r&&(e.RTCRtpSender.prototype.getParameters=function(){const s=r.apply(this,arguments);return"encodings"in s||(s.encodings=[].concat(this.sendEncodings||[{}])),s})}function z5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ht.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function W5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?ht.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var G5=Object.freeze({__proto__:null,shimAddTransceiver:F5,shimCreateAnswer:W5,shimCreateOffer:z5,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(s){if(!s||!s.video){const o=new DOMException("getDisplayMedia without video constraints is undefined");return o.name="NotFoundError",o.code=8,ht.reject(o)}return s.video===!0?s.video={mediaSource:r}:s.video.mediaSource=r,e.navigator.mediaDevices.getUserMedia(s)})},shimGetParameters:B5,shimGetUserMedia:x5,shimOnTrack:L5,shimPeerConnection:WD,shimRTCDataChannel:j5,shimReceiverGetStats:U5,shimRemoveStream:V5,shimSenderGetStats:M5});function H5(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(s){var o;this._localStreams||(this._localStreams=[]),ct(o=this._localStreams).call(o,s)||this._localStreams.push(s),s.getAudioTracks().forEach(c=>r.call(this,c,s)),s.getVideoTracks().forEach(c=>r.call(this,c,s))},e.RTCPeerConnection.prototype.addTrack=function(s){for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c&&c.forEach(h=>{var m;this._localStreams?ct(m=this._localStreams).call(m,h)||this._localStreams.push(h):this._localStreams=[h]}),r.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const s=this._localStreams.indexOf(r);if(s===-1)return;this._localStreams.splice(s,1);const o=r.getTracks();this.getSenders().forEach(c=>{ct(o).call(o,c.track)&&this.removeTrack(c)})})}}function $5(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=o=>{o.streams.forEach(c=>{var u;if(this._remoteStreams||(this._remoteStreams=[]),ct(u=this._remoteStreams).call(u,c))return;this._remoteStreams.push(c);const h=new Event("addstream");h.stream=c,this.dispatchEvent(h)})})}});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const s=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(o){o.streams.forEach(c=>{if(s._remoteStreams||(s._remoteStreams=[]),s._remoteStreams.indexOf(c)>=0)return;s._remoteStreams.push(c);const u=new Event("addstream");u.stream=c,s.dispatchEvent(u)})}),r.apply(s,arguments)}}}function K5(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,s=r.createOffer,o=r.createAnswer,c=r.setLocalDescription,u=r.setRemoteDescription,h=r.addIceCandidate;r.createOffer=function(y,E){const S=arguments.length>=2?arguments[2]:arguments[0],R=s.apply(this,[S]);return E?(R.then(y,E),ht.resolve()):R},r.createAnswer=function(y,E){const S=arguments.length>=2?arguments[2]:arguments[0],R=o.apply(this,[S]);return E?(R.then(y,E),ht.resolve()):R};let m=function(y,E,S){const R=c.apply(this,[y]);return S?(R.then(E,S),ht.resolve()):R};r.setLocalDescription=m,m=function(y,E,S){const R=u.apply(this,[y]);return S?(R.then(E,S),ht.resolve()):R},r.setRemoteDescription=m,m=function(y,E,S){const R=h.apply(this,[y]);return S?(R.then(E,S),ht.resolve()):R},r.addIceCandidate=m}function q5(e){const r=e&&e.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const s=r.mediaDevices,o=s.getUserMedia.bind(s);r.mediaDevices.getUserMedia=c=>o(Y5(c))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(s,o,c){r.mediaDevices.getUserMedia(s).then(o,c)}).bind(r))}function Y5(e){return e&&e.video!==void 0?Object.assign({},e,{video:S5(e.video)}):e}function X5(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection;e.RTCPeerConnection=function(s,o){if(s&&s.iceServers){const c=[];for(let u=0;u<s.iceServers.length;u++){let h=s.iceServers[u];!h.hasOwnProperty("urls")&&h.hasOwnProperty("url")?(FD("RTCIceServer.url","RTCIceServer.urls"),h=JSON.parse(JSON.stringify(h)),h.urls=h.url,delete h.url,c.push(h)):c.push(s.iceServers[u])}s.iceServers=c}return new r(s,o)},e.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function J5(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Q5(e){const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(s){if(s){s.offerToReceiveAudio!==void 0&&(s.offerToReceiveAudio=!!s.offerToReceiveAudio);const o=this.getTransceivers().find(u=>u.receiver.track.kind==="audio");s.offerToReceiveAudio===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):s.offerToReceiveAudio!==!0||o||this.addTransceiver("audio",{direction:"recvonly"}),s.offerToReceiveVideo!==void 0&&(s.offerToReceiveVideo=!!s.offerToReceiveVideo);const c=this.getTransceivers().find(u=>u.receiver.track.kind==="video");s.offerToReceiveVideo===!1&&c?c.direction==="sendrecv"?c.setDirection?c.setDirection("sendonly"):c.direction="sendonly":c.direction==="recvonly"&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive"):s.offerToReceiveVideo!==!0||c||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function Z5(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var eB=Object.freeze({__proto__:null,shimAudioContext:Z5,shimCallbacksAPI:K5,shimConstraints:Y5,shimCreateOfferLegacy:Q5,shimGetUserMedia:q5,shimLocalStreamsAPI:H5,shimRTCIceServerUrls:X5,shimRemoteStreamsAPI:$5,shimTrackEventTransceiver:J5}),tB=`	
\v\f\r \u2028\u2029\uFEFF`,Jle=Lt,Qle=ja,GD=tB,nB=I("".replace),Zle=RegExp("^["+GD+"]+"),eue=RegExp("(^|[^"+GD+"])["+GD+"]+$"),tue=function(e){return function(r){var s=Qle(Jle(r));return 1&e&&(s=nB(s,Zle,"")),2&e&&(s=nB(s,eue,"$1")),s}},nue={trim:tue(3)},rue=cI.PROPER,iue=d,rB=tB,sue=nue.trim;Gn({target:"String",proto:!0,forced:function(e){return iue(function(){return!!rB[e]()||""[e]()!==""||rue&&rB[e].name!==e})}("trim")},{trim:function(){return sue(this)}});var oue=mc("String").trim,aue=O,cue=oue,HD=String.prototype,lue=function(e){var r=e.trim;return typeof e=="string"||e===HD||aue(HD,e)&&r===HD.trim?cue:r},wo=l(lue),iB={exports:{}};(function(e){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(s){return s.trim().split(`
`).map(o=>o.trim())},r.splitSections=function(s){return s.split(`
m=`).map((o,c)=>(c>0?"m="+o:o).trim()+`\r
`)},r.getDescription=function(s){const o=r.splitSections(s);return o&&o[0]},r.getMediaSections=function(s){const o=r.splitSections(s);return o.shift(),o},r.matchPrefix=function(s,o){return r.splitLines(s).filter(c=>c.indexOf(o)===0)},r.parseCandidate=function(s){let o;o=s.indexOf("a=candidate:")===0?s.substring(12).split(" "):s.substring(10).split(" ");const c={foundation:o[0],component:{1:"rtp",2:"rtcp"}[o[1]]||o[1],protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]};for(let u=8;u<o.length;u+=2)switch(o[u]){case"raddr":c.relatedAddress=o[u+1];break;case"rport":c.relatedPort=parseInt(o[u+1],10);break;case"tcptype":c.tcpType=o[u+1];break;case"ufrag":c.ufrag=o[u+1],c.usernameFragment=o[u+1];break;default:c[o[u]]===void 0&&(c[o[u]]=o[u+1])}return c},r.writeCandidate=function(s){const o=[];o.push(s.foundation);const c=s.component;c==="rtp"?o.push(1):c==="rtcp"?o.push(2):o.push(c),o.push(s.protocol.toUpperCase()),o.push(s.priority),o.push(s.address||s.ip),o.push(s.port);const u=s.type;return o.push("typ"),o.push(u),u!=="host"&&s.relatedAddress&&s.relatedPort&&(o.push("raddr"),o.push(s.relatedAddress),o.push("rport"),o.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(o.push("tcptype"),o.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(o.push("ufrag"),o.push(s.usernameFragment||s.ufrag)),"candidate:"+o.join(" ")},r.parseIceOptions=function(s){return s.substring(14).split(" ")},r.parseRtpMap=function(s){let o=s.substring(9).split(" ");const c={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),c.name=o[0],c.clockRate=parseInt(o[1],10),c.channels=o.length===3?parseInt(o[2],10):1,c.numChannels=c.channels,c},r.writeRtpMap=function(s){let o=s.payloadType;s.preferredPayloadType!==void 0&&(o=s.preferredPayloadType);const c=s.channels||s.numChannels||1;return"a=rtpmap:"+o+" "+s.name+"/"+s.clockRate+(c!==1?"/"+c:"")+`\r
`},r.parseExtmap=function(s){const o=s.substring(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1],attributes:o.slice(2).join(" ")}},r.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},r.parseFmtp=function(s){const o={};let c;const u=s.substring(s.indexOf(" ")+1).split(";");for(let h=0;h<u.length;h++)c=u[h].trim().split("="),o[c[0].trim()]=c[1];return o},r.writeFmtp=function(s){let o="",c=s.payloadType;if(s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const u=[];Object.keys(s.parameters).forEach(h=>{s.parameters[h]!==void 0?u.push(h+"="+s.parameters[h]):u.push(h)}),o+="a=fmtp:"+c+" "+u.join(";")+`\r
`}return o},r.parseRtcpFb=function(s){const o=s.substring(s.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},r.writeRtcpFb=function(s){let o="",c=s.payloadType;return s.preferredPayloadType!==void 0&&(c=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(u=>{o+="a=rtcp-fb:"+c+" "+u.type+(u.parameter&&u.parameter.length?" "+u.parameter:"")+`\r
`}),o},r.parseSsrcMedia=function(s){const o=s.indexOf(" "),c={ssrc:parseInt(s.substring(7,o),10)},u=s.indexOf(":",o);return u>-1?(c.attribute=s.substring(o+1,u),c.value=s.substring(u+1)):c.attribute=s.substring(o+1),c},r.parseSsrcGroup=function(s){const o=s.substring(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(c=>parseInt(c,10))}},r.getMid=function(s){const o=r.matchPrefix(s,"a=mid:")[0];if(o)return o.substring(6)},r.parseFingerprint=function(s){const o=s.substring(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1].toUpperCase()}},r.getDtlsParameters=function(s,o){return{role:"auto",fingerprints:r.matchPrefix(s+o,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(s,o){let c="a=setup:"+o+`\r
`;return s.fingerprints.forEach(u=>{c+="a=fingerprint:"+u.algorithm+" "+u.value+`\r
`}),c},r.parseCryptoLine=function(s){const o=s.substring(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},r.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?r.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const o=s.substring(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},r.getCryptoParameters=function(s,o){return r.matchPrefix(s+o,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(s,o){const c=r.matchPrefix(s+o,"a=ice-ufrag:")[0],u=r.matchPrefix(s+o,"a=ice-pwd:")[0];return c&&u?{usernameFragment:c.substring(12),password:u.substring(10)}:null},r.writeIceParameters=function(s){let o="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(o+=`a=ice-lite\r
`),o},r.parseRtpParameters=function(s){const o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},c=r.splitLines(s)[0].split(" ");o.profile=c[2];for(let h=3;h<c.length;h++){const m=c[h],y=r.matchPrefix(s,"a=rtpmap:"+m+" ")[0];if(y){const E=r.parseRtpMap(y),S=r.matchPrefix(s,"a=fmtp:"+m+" ");switch(E.parameters=S.length?r.parseFmtp(S[0]):{},E.rtcpFeedback=r.matchPrefix(s,"a=rtcp-fb:"+m+" ").map(r.parseRtcpFb),o.codecs.push(E),E.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(E.name.toUpperCase())}}}r.matchPrefix(s,"a=extmap:").forEach(h=>{o.headerExtensions.push(r.parseExtmap(h))});const u=r.matchPrefix(s,"a=rtcp-fb:* ").map(r.parseRtcpFb);return o.codecs.forEach(h=>{u.forEach(m=>{h.rtcpFeedback.find(y=>y.type===m.type&&y.parameter===m.parameter)||h.rtcpFeedback.push(m)})}),o},r.writeRtpDescription=function(s,o){let c="";c+="m="+s+" ",c+=o.codecs.length>0?"9":"0",c+=" "+(o.profile||"UDP/TLS/RTP/SAVPF")+" ",c+=o.codecs.map(h=>h.preferredPayloadType!==void 0?h.preferredPayloadType:h.payloadType).join(" ")+`\r
`,c+=`c=IN IP4 0.0.0.0\r
`,c+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,o.codecs.forEach(h=>{c+=r.writeRtpMap(h),c+=r.writeFmtp(h),c+=r.writeRtcpFb(h)});let u=0;return o.codecs.forEach(h=>{h.maxptime>u&&(u=h.maxptime)}),u>0&&(c+="a=maxptime:"+u+`\r
`),o.headerExtensions&&o.headerExtensions.forEach(h=>{c+=r.writeExtmap(h)}),c},r.parseRtpEncodingParameters=function(s){const o=[],c=r.parseRtpParameters(s),u=c.fecMechanisms.indexOf("RED")!==-1,h=c.fecMechanisms.indexOf("ULPFEC")!==-1,m=r.matchPrefix(s,"a=ssrc:").map(P=>r.parseSsrcMedia(P)).filter(P=>P.attribute==="cname"),y=m.length>0&&m[0].ssrc;let E;const S=r.matchPrefix(s,"a=ssrc-group:FID").map(P=>P.substring(17).split(" ").map(D=>parseInt(D,10)));S.length>0&&S[0].length>1&&S[0][0]===y&&(E=S[0][1]),c.codecs.forEach(P=>{if(P.name.toUpperCase()==="RTX"&&P.parameters.apt){let D={ssrc:y,codecPayloadType:parseInt(P.parameters.apt,10)};y&&E&&(D.rtx={ssrc:E}),o.push(D),u&&(D=JSON.parse(JSON.stringify(D)),D.fec={ssrc:y,mechanism:h?"red+ulpfec":"red"},o.push(D))}}),o.length===0&&y&&o.push({ssrc:y});let R=r.matchPrefix(s,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,o.forEach(P=>{P.maxBitrate=R})),o},r.parseRtcpParameters=function(s){const o={},c=r.matchPrefix(s,"a=ssrc:").map(m=>r.parseSsrcMedia(m)).filter(m=>m.attribute==="cname")[0];c&&(o.cname=c.value,o.ssrc=c.ssrc);const u=r.matchPrefix(s,"a=rtcp-rsize");o.reducedSize=u.length>0,o.compound=u.length===0;const h=r.matchPrefix(s,"a=rtcp-mux");return o.mux=h.length>0,o},r.writeRtcpParameters=function(s){let o="";return s.reducedSize&&(o+=`a=rtcp-rsize\r
`),s.mux&&(o+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(o+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),o},r.parseMsid=function(s){let o;const c=r.matchPrefix(s,"a=msid:");if(c.length===1)return o=c[0].substring(7).split(" "),{stream:o[0],track:o[1]};const u=r.matchPrefix(s,"a=ssrc:").map(h=>r.parseSsrcMedia(h)).filter(h=>h.attribute==="msid");return u.length>0?(o=u[0].value.split(" "),{stream:o[0],track:o[1]}):void 0},r.parseSctpDescription=function(s){const o=r.parseMLine(s),c=r.matchPrefix(s,"a=max-message-size:");let u;c.length>0&&(u=parseInt(c[0].substring(19),10)),isNaN(u)&&(u=65536);const h=r.matchPrefix(s,"a=sctp-port:");if(h.length>0)return{port:parseInt(h[0].substring(12),10),protocol:o.fmt,maxMessageSize:u};const m=r.matchPrefix(s,"a=sctpmap:");if(m.length>0){const y=m[0].substring(10).split(" ");return{port:parseInt(y[0],10),protocol:y[1],maxMessageSize:u}}},r.writeSctpDescription=function(s,o){let c=[];return c=s.protocol!=="DTLS/SCTP"?["m="+s.kind+" 9 "+s.protocol+" "+o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+o.port+`\r
`]:["m="+s.kind+" 9 "+s.protocol+" "+o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+o.port+" "+o.protocol+` 65535\r
`],o.maxMessageSize!==void 0&&c.push("a=max-message-size:"+o.maxMessageSize+`\r
`),c.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(s,o,c){let u;const h=o!==void 0?o:2;return u=s||r.generateSessionId(),`v=0\r
o=`+(c||"thisisadapterortc")+" "+u+" "+h+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(s,o){const c=r.splitLines(s);for(let u=0;u<c.length;u++)switch(c[u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return c[u].substring(2)}return o?r.getDirection(o):"sendrecv"},r.getKind=function(s){return r.splitLines(s)[0].split(" ")[0].substring(2)},r.isRejected=function(s){return s.split(" ",2)[1]==="0"},r.parseMLine=function(s){const o=r.splitLines(s)[0].substring(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},r.parseOLine=function(s){const o=r.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},r.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const o=r.splitLines(s);for(let c=0;c<o.length;c++)if(o[c].length<2||o[c].charAt(1)!=="=")return!1;return!0},e.exports=r})(iB);var sB=iB.exports,Ov=l(sB),uue=i({__proto__:null,default:Ov},[sB]);function nA(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const r=e.RTCIceCandidate;e.RTCIceCandidate=function(s){if(typeof s=="object"&&s.candidate&&s.candidate.indexOf("a=")===0&&((s=JSON.parse(JSON.stringify(s))).candidate=s.candidate.substr(2)),s.candidate&&s.candidate.length){const o=new r(s),c=Ov.parseCandidate(s.candidate),u=Object.assign(o,c);return u.toJSON=function(){return{candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex,usernameFragment:u.usernameFragment}},u}return new r(s)},e.RTCIceCandidate.prototype=r.prototype,L_(e,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new e.RTCIceCandidate(s.candidate),writable:"false"}),s))}function $D(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||L_(e,"icecandidate",r=>{if(r.candidate){const s=Ov.parseCandidate(r.candidate.candidate);s.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return r})}function rA(e,r){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const s=function(m){if(!m||!m.sdp)return!1;const y=Ov.splitSections(m.sdp);return y.shift(),y.some(E=>{const S=Ov.parseMLine(E);return S&&S.kind==="application"&&S.protocol.indexOf("SCTP")!==-1})},o=function(m){const y=m.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(y===null||y.length<2)return-1;const E=parseInt(y[1],10);return E!=E?-1:E},c=function(m){let y=65536;return r.browser==="firefox"&&(y=r.version<57?m===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),y},u=function(m,y){let E=65536;r.browser==="firefox"&&r.version===57&&(E=65535);const S=Ov.matchPrefix(m.sdp,"a=max-message-size:");return S.length>0?E=parseInt(S[0].substr(19),10):r.browser==="firefox"&&y!==-1&&(E=2147483637),E},h=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:m}=this.getConfiguration();m==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const m=o(arguments[0]),y=c(m),E=u(arguments[0],m);let S;S=y===0&&E===0?Number.POSITIVE_INFINITY:y===0||E===0?Math.max(y,E):Math.min(y,E);const R={};Object.defineProperty(R,"maxMessageSize",{get:()=>S}),this._sctp=R}return h.apply(this,arguments)}}function iA(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function r(o,c){const u=o.send;o.send=function(){const h=arguments[0],m=h.length||h.size||h.byteLength;if(o.readyState==="open"&&c.sctp&&m>c.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+c.sctp.maxMessageSize+" bytes)");return u.apply(o,arguments)}}const s=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const o=s.apply(this,arguments);return r(o,this),o},L_(e,"datachannel",o=>(r(o.channel,o.target),o))}function KD(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const o=r[s];r[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=c=>{const u=c.target;if(u._lastConnectionState!==u.connectionState){u._lastConnectionState=u.connectionState;const h=new Event("connectionstatechange",c);u.dispatchEvent(h)}return c},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),o.apply(this,arguments)}})}function qD(e,r){if(!e.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(o){if(o&&o.sdp&&o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const c=o.sdp.split(`
`).filter(u=>wo(u).call(u)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&o instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:o.type,sdp:c}):o.sdp=c}return s.apply(this,arguments)}}function sA(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const s=e.RTCPeerConnection.prototype.addIceCandidate;s&&s.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?ht.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ht.resolve())})}function oA(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const s=e.RTCPeerConnection.prototype.setLocalDescription;s&&s.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let o=arguments[0]||{};if(typeof o!="object"||o.type&&o.sdp)return s.apply(this,arguments);if(o={type:o.type,sdp:o.sdp},!o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":o.type="offer";break;default:o.type="answer"}return o.sdp||o.type!=="offer"&&o.type!=="answer"?s.apply(this,[o]):(o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(c=>s.apply(this,[c]))})}var due=Object.freeze({__proto__:null,removeExtmapAllowMixed:qD,shimAddIceCandidateNullOrEmpty:sA,shimConnectionState:KD,shimMaxMessageSize:rA,shimParameterlessSetLocalDescription:oA,shimRTCIceCandidate:nA,shimRTCIceCandidateRelayProtocol:$D,shimSendThrowTypeError:iA});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const s=E5,o=function(u){const h={browser:null,version:null};if(u===void 0||!u.navigator)return h.browser="Not a browser.",h;const{navigator:m}=u;if(m.mozGetUserMedia)h.browser="firefox",h.version=tA(m.userAgent,/Firefox\/(\d+)\./,1);else if(m.webkitGetUserMedia||u.isSecureContext===!1&&u.webkitRTCPeerConnection)h.browser="chrome",h.version=tA(m.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!u.RTCPeerConnection||!m.userAgent.match(/AppleWebKit\/(\d+)\./))return h.browser="Not a supported browser.",h;h.browser="safari",h.version=tA(m.userAgent,/AppleWebKit\/(\d+)\./,1),h.supportsUnifiedPlan=u.RTCRtpTransceiver&&"currentDirection"in u.RTCRtpTransceiver.prototype}return h}(e),c={browserDetails:o,commonShim:due,extractVersion:tA,disableLog:Yle,disableWarnings:Xle,sdp:uue};switch(o.browser){case"chrome":if(!D5||!zD||!r.shimChrome)return s("Chrome shim is not included in this adapter release."),c;if(o.version===null)return s("Chrome shim can not determine version, not shimming."),c;s("adapter.js shimming chrome."),c.browserShim=D5,sA(e,o),oA(e),w5(e,o),C5(e),zD(e,o),R5(e),k5(e,o),I5(e),A5(e),P5(e),N5(e,o),nA(e),$D(e),KD(e),rA(e,o),iA(e),qD(e,o);break;case"firefox":if(!G5||!WD||!r.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox."),c.browserShim=G5,sA(e,o),oA(e),x5(e,o),WD(e,o),L5(e),V5(e),M5(e),U5(e),j5(e),F5(e),B5(e),z5(e),W5(e),nA(e),KD(e),rA(e,o),iA(e);break;case"safari":if(!eB||!r.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari."),c.browserShim=eB,sA(e,o),oA(e),X5(e),Q5(e),K5(e),H5(e),$5(e),J5(e),q5(e),Z5(e),nA(e),$D(e),rA(e,o),iA(e),qD(e,o);break;default:s("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var oB=La,hue=TypeError,aB=Tt.match(/firefox\/(\d+)/i),pue=!!aB&&+aB[1],fue=/MSIE|Trident/.test(Tt),cB=Tt.match(/AppleWebKit\/(\d+)\./),mue=!!cB&&+cB[1],gue=Gn,lB=I,_ue=vt,yue=ea,uB=gi,Eue=function(e,r){if(!delete e[r])throw hue("Cannot delete property "+oB(r)+" of "+oB(e))},dB=ja,YD=d,vue=S4,Sue=xp,hB=pue,bue=fue,pB=oi,fB=mue,Fm=[],mB=lB(Fm.sort),Tue=lB(Fm.push),wue=YD(function(){Fm.sort(void 0)}),Cue=YD(function(){Fm.sort(null)}),Rue=Sue("sort"),gB=!YD(function(){if(pB)return pB<70;if(!(hB&&hB>3)){if(bue)return!0;if(fB)return fB<603;var e,r,s,o,c="";for(e=65;e<76;e++){switch(r=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:s=3;break;case 68:case 71:s=4;break;default:s=2}for(o=0;o<47;o++)Fm.push({k:r+o,v:s})}for(Fm.sort(function(u,h){return h.v-u.v}),o=0;o<Fm.length;o++)r=Fm[o].k.charAt(0),c.charAt(c.length-1)!==r&&(c+=r);return c!=="DGBEFHACIJK"}});gue({target:"Array",proto:!0,forced:wue||!Cue||!Rue||!gB},{sort:function(e){e!==void 0&&_ue(e);var r=yue(this);if(gB)return e===void 0?mB(r):mB(r,e);var s,o,c=[],u=uB(r);for(o=0;o<u;o++)o in r&&Tue(c,r[o]);for(vue(c,function(h){return function(m,y){return y===void 0?-1:m===void 0?1:h!==void 0?+h(m,y)||0:dB(m)>dB(y)?1:-1}}(e)),s=uB(c),o=0;o<s;)r[o]=c[o++];for(;o<u;)Eue(r,o++);return r}});var Iue=mc("Array").sort,Aue=O,Pue=Iue,XD=Array.prototype,Oue=function(e){var r=e.sort;return e===XD||Aue(XD,e)&&r===XD.sort?Pue:r},oT=l(Oue),JD=M;Gn({global:!0,forced:JD.globalThis!==JD},{globalThis:JD});var _B=l(M),QD={exports:{}};(function(e,r){(function(s,o){var c="function",u="undefined",h="object",m="string",y="major",E="model",S="name",R="type",P="vendor",D="version",G="architecture",j="console",B="mobile",Y="tablet",ee="smarttv",fe="wearable",ye="embedded",Ee="Amazon",_e="Apple",Ne="ASUS",Ze="BlackBerry",pt="Browser",yt="Chrome",In="Firefox",An="Google",mr="Huawei",li="LG",Jr="Microsoft",Ta="Motorola",We="Opera",ot="Samsung",At="Sharp",Ye="Sony",U="Xiaomi",ce="Zebra",me="Facebook",tt="Chromium OS",en="Mac OS",lr=function(ki){for(var Zi={},Pr=0;Pr<ki.length;Pr++)Zi[ki[Pr].toUpperCase()]=ki[Pr];return Zi},Qi=function(ki,Zi){return typeof ki===m&&Qa(Zi).indexOf(Qa(ki))!==-1},Qa=function(ki){return ki.toLowerCase()},Sf=function(ki,Zi){if(typeof ki===m)return ki=ki.replace(/^\s\s*/,""),typeof Zi===u?ki:ki.substring(0,350)},hy=function(ki,Zi){for(var Pr,Cc,zh,ui,Kn,Za,cg=0;cg<Zi.length&&!Kn;){var Ld=Zi[cg],G7=Zi[cg+1];for(Pr=Cc=0;Pr<Ld.length&&!Kn&&Ld[Pr];)if(Kn=Ld[Pr++].exec(ki))for(zh=0;zh<G7.length;zh++)Za=Kn[++Cc],typeof(ui=G7[zh])===h&&ui.length>0?ui.length===2?typeof ui[1]==c?this[ui[0]]=ui[1].call(this,Za):this[ui[0]]=ui[1]:ui.length===3?typeof ui[1]!==c||ui[1].exec&&ui[1].test?this[ui[0]]=Za?Za.replace(ui[1],ui[2]):o:this[ui[0]]=Za?ui[1].call(this,Za,ui[2]):o:ui.length===4&&(this[ui[0]]=Za?ui[3].call(this,Za.replace(ui[1],ui[2])):o):this[ui]=Za||o;cg+=2}},lw=function(ki,Zi){for(var Pr in Zi)if(typeof Zi[Pr]===h&&Zi[Pr].length>0){for(var Cc=0;Cc<Zi[Pr].length;Cc++)if(Qi(Zi[Pr][Cc],ki))return Pr==="?"?o:Pr}else if(Qi(Zi[Pr],ki))return Pr==="?"?o:Pr;return ki},rO={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},iO={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[D,[S,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[D,[S,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[S,D],[/opios[\/ ]+([\w\.]+)/i],[D,[S,We+" Mini"]],[/\bopr\/([\w\.]+)/i],[D,[S,We]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[S,D],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[D,[S,"UC"+pt]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[D,[S,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[D,[S,"WeChat"]],[/konqueror\/([\w\.]+)/i],[D,[S,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[D,[S,"IE"]],[/yabrowser\/([\w\.]+)/i],[D,[S,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[S,/(.+)/,"$1 Secure "+pt],D],[/\bfocus\/([\w\.]+)/i],[D,[S,In+" Focus"]],[/\bopt\/([\w\.]+)/i],[D,[S,We+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[D,[S,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[D,[S,"Dolphin"]],[/coast\/([\w\.]+)/i],[D,[S,We+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[D,[S,"MIUI "+pt]],[/fxios\/([-\w\.]+)/i],[D,[S,In]],[/\bqihu|(qi?ho?o?|360)browser/i],[[S,"360 "+pt]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[S,/(.+)/,"$1 "+pt],D],[/(comodo_dragon)\/([\w\.]+)/i],[[S,/_/g," "],D],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[S,D],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[S],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[S,me],D],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[S,D],[/\bgsa\/([\w\.]+) .*safari\//i],[D,[S,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[D,[S,yt+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[S,yt+" WebView"],D],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[D,[S,"Android "+pt]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[S,D],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[D,[S,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[D,S],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[S,[D,lw,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[S,D],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[S,"Netscape"],D],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[D,[S,In+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[S,D],[/(cobalt)\/([\w\.]+)/i],[S,[D,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[G,"amd64"]],[/(ia32(?=;))/i],[[G,Qa]],[/((?:i[346]|x)86)[;\)]/i],[[G,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[G,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[G,"armhf"]],[/windows (ce|mobile); ppc;/i],[[G,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[G,/ower/,"",Qa]],[/(sun4\w)[;\)]/i],[[G,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[G,Qa]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[E,[P,ot],[R,Y]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[E,[P,ot],[R,B]],[/\((ip(?:hone|od)[\w ]*);/i],[E,[P,_e],[R,B]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[E,[P,_e],[R,Y]],[/(macintosh);/i],[E,[P,_e]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[E,[P,At],[R,B]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[E,[P,mr],[R,Y]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[E,[P,mr],[R,B]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[E,/_/g," "],[P,U],[R,B]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[E,/_/g," "],[P,U],[R,Y]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[E,[P,"OPPO"],[R,B]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[E,[P,"Vivo"],[R,B]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[E,[P,"Realme"],[R,B]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[E,[P,Ta],[R,B]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[E,[P,Ta],[R,Y]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[E,[P,li],[R,Y]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[E,[P,li],[R,B]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[E,[P,"Lenovo"],[R,Y]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[E,/_/g," "],[P,"Nokia"],[R,B]],[/(pixel c)\b/i],[E,[P,An],[R,Y]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[E,[P,An],[R,B]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[E,[P,Ye],[R,B]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[E,"Xperia Tablet"],[P,Ye],[R,Y]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[E,[P,"OnePlus"],[R,B]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[E,[P,Ee],[R,Y]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[E,/(.+)/g,"Fire Phone $1"],[P,Ee],[R,B]],[/(playbook);[-\w\),; ]+(rim)/i],[E,P,[R,Y]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[E,[P,Ze],[R,B]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[E,[P,Ne],[R,Y]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[E,[P,Ne],[R,B]],[/(nexus 9)/i],[E,[P,"HTC"],[R,Y]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[P,[E,/_/g," "],[R,B]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[E,[P,"Acer"],[R,Y]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[E,[P,"Meizu"],[R,B]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[P,E,[R,B]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[P,E,[R,Y]],[/(surface duo)/i],[E,[P,Jr],[R,Y]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[E,[P,"Fairphone"],[R,B]],[/(u304aa)/i],[E,[P,"AT&T"],[R,B]],[/\bsie-(\w*)/i],[E,[P,"Siemens"],[R,B]],[/\b(rct\w+) b/i],[E,[P,"RCA"],[R,Y]],[/\b(venue[\d ]{2,7}) b/i],[E,[P,"Dell"],[R,Y]],[/\b(q(?:mv|ta)\w+) b/i],[E,[P,"Verizon"],[R,Y]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[E,[P,"Barnes & Noble"],[R,Y]],[/\b(tm\d{3}\w+) b/i],[E,[P,"NuVision"],[R,Y]],[/\b(k88) b/i],[E,[P,"ZTE"],[R,Y]],[/\b(nx\d{3}j) b/i],[E,[P,"ZTE"],[R,B]],[/\b(gen\d{3}) b.+49h/i],[E,[P,"Swiss"],[R,B]],[/\b(zur\d{3}) b/i],[E,[P,"Swiss"],[R,Y]],[/\b((zeki)?tb.*\b) b/i],[E,[P,"Zeki"],[R,Y]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[P,"Dragon Touch"],E,[R,Y]],[/\b(ns-?\w{0,9}) b/i],[E,[P,"Insignia"],[R,Y]],[/\b((nxa|next)-?\w{0,9}) b/i],[E,[P,"NextBook"],[R,Y]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[P,"Voice"],E,[R,B]],[/\b(lvtel\-)?(v1[12]) b/i],[[P,"LvTel"],E,[R,B]],[/\b(ph-1) /i],[E,[P,"Essential"],[R,B]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[E,[P,"Envizen"],[R,Y]],[/\b(trio[-\w\. ]+) b/i],[E,[P,"MachSpeed"],[R,Y]],[/\btu_(1491) b/i],[E,[P,"Rotor"],[R,Y]],[/(shield[\w ]+) b/i],[E,[P,"Nvidia"],[R,Y]],[/(sprint) (\w+)/i],[P,E,[R,B]],[/(kin\.[onetw]{3})/i],[[E,/\./g," "],[P,Jr],[R,B]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[E,[P,ce],[R,Y]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[E,[P,ce],[R,B]],[/smart-tv.+(samsung)/i],[P,[R,ee]],[/hbbtv.+maple;(\d+)/i],[[E,/^/,"SmartTV"],[P,ot],[R,ee]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[P,li],[R,ee]],[/(apple) ?tv/i],[P,[E,_e+" TV"],[R,ee]],[/crkey/i],[[E,yt+"cast"],[P,An],[R,ee]],[/droid.+aft(\w)( bui|\))/i],[E,[P,Ee],[R,ee]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[E,[P,At],[R,ee]],[/(bravia[\w ]+)( bui|\))/i],[E,[P,Ye],[R,ee]],[/(mitv-\w{5}) bui/i],[E,[P,U],[R,ee]],[/Hbbtv.*(technisat) (.*);/i],[P,E,[R,ee]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[P,Sf],[E,Sf],[R,ee]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,ee]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[P,E,[R,j]],[/droid.+; (shield) bui/i],[E,[P,"Nvidia"],[R,j]],[/(playstation [345portablevi]+)/i],[E,[P,Ye],[R,j]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[E,[P,Jr],[R,j]],[/((pebble))app/i],[P,E,[R,fe]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[E,[P,_e],[R,fe]],[/droid.+; (glass) \d/i],[E,[P,An],[R,fe]],[/droid.+; (wt63?0{2,3})\)/i],[E,[P,ce],[R,fe]],[/(quest( 2| pro)?)/i],[E,[P,me],[R,fe]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[P,[R,ye]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[E,[R,B]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[E,[R,Y]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,Y]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,B]],[/(android[-\w\. ]{0,9});.+buil/i],[E,[P,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[D,[S,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[D,[S,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[S,D],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[D,S]],os:[[/microsoft (windows) (vista|xp)/i],[S,D],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[S,[D,lw,rO]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[S,"Windows"],[D,lw,rO]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[D,/_/g,"."],[S,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[S,en],[D,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[D,S],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[S,D],[/\(bb(10);/i],[D,[S,Ze]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[D,[S,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[D,[S,In+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[D,[S,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[D,[S,"watchOS"]],[/crkey\/([\d\.]+)/i],[D,[S,yt+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[S,tt],D],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[S,D],[/(sunos) ?([\w\.\d]*)/i],[[S,"Solaris"],D],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[S,D]]},Bl=function(ki,Zi){if(typeof ki===h&&(Zi=ki,ki=o),!(this instanceof Bl))return new Bl(ki,Zi).getResult();var Pr=typeof s!==u&&s.navigator?s.navigator:o,Cc=ki||(Pr&&Pr.userAgent?Pr.userAgent:""),zh=Pr&&Pr.userAgentData?Pr.userAgentData:o,ui=Zi?function(Kn,Za){var cg={};for(var Ld in Kn)Za[Ld]&&Za[Ld].length%2==0?cg[Ld]=Za[Ld].concat(Kn[Ld]):cg[Ld]=Kn[Ld];return cg}(iO,Zi):iO;return this.getBrowser=function(){var Kn={};return Kn[S]=o,Kn[D]=o,hy.call(Kn,Cc,ui.browser),Kn[y]=function(Za){return typeof Za===m?Za.replace(/[^\d\.]/g,"").split(".")[0]:o}(Kn[D]),Pr&&Pr.brave&&typeof Pr.brave.isBrave==c&&(Kn[S]="Brave"),Kn},this.getCPU=function(){var Kn={};return Kn[G]=o,hy.call(Kn,Cc,ui.cpu),Kn},this.getDevice=function(){var Kn={};return Kn[P]=o,Kn[E]=o,Kn[R]=o,hy.call(Kn,Cc,ui.device),!Kn[R]&&zh&&zh.mobile&&(Kn[R]=B),Kn[E]=="Macintosh"&&Pr&&typeof Pr.standalone!==u&&Pr.maxTouchPoints&&Pr.maxTouchPoints>2&&(Kn[E]="iPad",Kn[R]=Y),Kn},this.getEngine=function(){var Kn={};return Kn[S]=o,Kn[D]=o,hy.call(Kn,Cc,ui.engine),Kn},this.getOS=function(){var Kn={};return Kn[S]=o,Kn[D]=o,hy.call(Kn,Cc,ui.os),!Kn[S]&&zh&&zh.platform!="Unknown"&&(Kn[S]=zh.platform.replace(/chrome os/i,tt).replace(/macos/i,en)),Kn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Cc},this.setUA=function(Kn){return Cc=typeof Kn===m&&Kn.length>350?Sf(Kn,350):Kn,this},this.setUA(Cc),this};Bl.VERSION="0.7.34",Bl.BROWSER=lr([S,D,y]),Bl.CPU=lr([G]),Bl.DEVICE=lr([E,P,R,j,B,ee,Y,fe,ye]),Bl.ENGINE=Bl.OS=lr([S,D]),e.exports&&(r=e.exports=Bl),r.UAParser=Bl;var ag=typeof s!==u&&(s.jQuery||s.Zepto);if(ag&&!ag.ua){var py=new Bl;ag.ua=py.getResult(),ag.ua.get=function(){return py.getUA()},ag.ua.set=function(ki){py.setUA(ki);var Zi=py.getResult();for(var Pr in Zi)ag.ua[Pr]=Zi[Pr]}}})(typeof window=="object"?window:a)})(QD,QD.exports);var kue=l(QD.exports),Nue=jc,Due=Ci,xue=He,Lue=uh,Mue=Sr("iterator"),Uue=Object,Vue=function(e){if(xue(e))return!1;var r=Uue(e);return r[Mue]!==void 0||"@@iterator"in r||Due(Lue,Nue(r))},jue=l(Vue),yB=ov.clear;Gn({global:!0,bind:!0,forced:M.clearImmediate!==yB},{clearImmediate:yB});var Fue=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",EB=M,Bue=re,zue=Oe,Wue=Fue,Gue=Tt,Hue=ws,$ue=Pl,Kue=EB.Function,que=/MSIE .\./.test(Gue)||Wue&&function(){var e=EB.Bun.version.split(".");return e.length<3||e[0]==0&&(e[1]<3||e[1]==3&&e[2]==0)}(),Yue=Gn,vB=M,SB=ov.set,Xue=function(e,r){var s=1;return que?function(o,c){var u=$ue(arguments.length,1)>s,h=zue(o)?o:Kue(o),m=u?Hue(arguments,s):[],y=u?function(){Bue(h,this,m)}:h;return e(y)}:e},bB=vB.setImmediate?Xue(SB):SB;Yue({global:!0,bind:!0,forced:vB.setImmediate!==bB},{setImmediate:bB});var TB=l(Et.setImmediate),Jue=Gn,Que=vc,Zue=vt,ede=Pl,tde=Lp,nde=M.process;Jue({global:!0,dontCallGetSet:!0},{queueMicrotask:function(e){ede(arguments.length,1),Zue(e);var r=tde&&nde.domain;Que(r?r.bind(e):e)}});var wB=l(Et.queueMicrotask);function CB(e,r){return function(){return e.apply(r,arguments)}}const{toString:rde}=Object.prototype,{getPrototypeOf:ZD}=Object,aA=(ex=Object.create(null),e=>{const r=rde.call(e);return ex[r]||(ex[r]=r.slice(8,-1).toLowerCase())});var ex;const bd=e=>(e=e.toLowerCase(),r=>aA(r)===e),cA=e=>r=>typeof r===e,{isArray:kv}=Array,aT=cA("undefined"),RB=bd("ArrayBuffer"),ide=cA("string"),kl=cA("function"),IB=cA("number"),lA=e=>e!==null&&typeof e=="object",uA=e=>{if(aA(e)!=="object")return!1;const r=ZD(e);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||Symbol.toStringTag in e||jue(e))},sde=bd("Date"),ode=bd("File"),ade=bd("Blob"),cde=bd("FileList"),lde=bd("URLSearchParams"),[ude,dde,hde,pde]=["ReadableStream","Request","Response","Headers"].map(bd);function cT(e,r){let s,o,{allOwnKeys:c=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),kv(e))for(s=0,o=e.length;s<o;s++)r.call(null,e[s],s,e);else{const u=c?Object.getOwnPropertyNames(e):Object.keys(e),h=u.length;let m;for(s=0;s<h;s++)m=u[s],r.call(null,e[m],m,e)}}function AB(e,r){r=r.toLowerCase();const s=Object.keys(e);let o,c=s.length;for(;c-- >0;)if(o=s[c],r===o.toLowerCase())return o;return null}const M_=_B!==void 0?_B:typeof self<"u"?self:typeof window<"u"?window:Sy,PB=e=>!aT(e)&&e!==M_,fde=(tx=typeof Uint8Array<"u"&&ZD(Uint8Array),e=>tx&&e instanceof tx);var tx;const mde=bd("HTMLFormElement"),OB=(e=>{let{hasOwnProperty:r}=e;return(s,o)=>r.call(s,o)})(Object.prototype),gde=bd("RegExp"),kB=(e,r)=>{const s=Object.getOwnPropertyDescriptors(e),o={};cT(s,(c,u)=>{let h;(h=r(c,u,e))!==!1&&(o[u]=h||c)}),Object.defineProperties(e,o)},nx="abcdefghijklmnopqrstuvwxyz",NB="0123456789",DB={DIGIT:NB,ALPHA:nx,ALPHA_DIGIT:nx+nx.toUpperCase()+NB},_de=bd("AsyncFunction"),xB=(LB=typeof TB=="function",MB=kl(M_.postMessage),LB?TB:MB?(rx="axios@".concat(Math.random()),dA=[],M_.addEventListener("message",e=>{let{source:r,data:s}=e;r===M_&&s===rx&&dA.length&&dA.shift()()},!1),e=>{dA.push(e),M_.postMessage(rx,"*")}):e=>setTimeout(e));var LB,MB,rx,dA;const yde=wB!==void 0?wB.bind(M_):typeof process<"u"&&process.nextTick||xB;var dt={isArray:kv,isArrayBuffer:RB,isBuffer:function(e){return e!==null&&!aT(e)&&e.constructor!==null&&!aT(e.constructor)&&kl(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let r;return e&&(typeof FormData=="function"&&e instanceof FormData||kl(e.append)&&((r=aA(e))==="formdata"||r==="object"&&kl(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&RB(e.buffer),r},isString:ide,isNumber:IB,isBoolean:e=>e===!0||e===!1,isObject:lA,isPlainObject:uA,isReadableStream:ude,isRequest:dde,isResponse:hde,isHeaders:pde,isUndefined:aT,isDate:sde,isFile:ode,isBlob:ade,isRegExp:gde,isFunction:kl,isStream:e=>lA(e)&&kl(e.pipe),isURLSearchParams:lde,isTypedArray:fde,isFileList:cde,forEach:cT,merge:function e(){const{caseless:r}=PB(this)&&this||{},s={},o=(c,u)=>{const h=r&&AB(s,u)||u;uA(s[h])&&uA(c)?s[h]=e(s[h],c):uA(c)?s[h]=e({},c):kv(c)?s[h]=c.slice():s[h]=c};for(let c=0,u=arguments.length;c<u;c++)arguments[c]&&cT(arguments[c],o);return s},extend:function(e,r,s){let{allOwnKeys:o}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return cT(r,(c,u)=>{s&&kl(c)?e[u]=CB(c,s):e[u]=c},{allOwnKeys:o}),e},trim:e=>wo(e)?wo(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,r,s,o)=>{e.prototype=Object.create(r.prototype,o),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:r.prototype}),s&&Object.assign(e.prototype,s)},toFlatObject:(e,r,s,o)=>{let c,u,h;const m={};if(r=r||{},e==null)return r;do{for(c=Object.getOwnPropertyNames(e),u=c.length;u-- >0;)h=c[u],o&&!o(h,e,r)||m[h]||(r[h]=e[h],m[h]=!0);e=s!==!1&&ZD(e)}while(e&&(!s||s(e,r))&&e!==Object.prototype);return r},kindOf:aA,kindOfTest:bd,endsWith:(e,r,s)=>{e=String(e),(s===void 0||s>e.length)&&(s=e.length),s-=r.length;const o=e.indexOf(r,s);return o!==-1&&o===s},toArray:e=>{if(!e)return null;if(kv(e))return e;let r=e.length;if(!IB(r))return null;const s=new Array(r);for(;r-- >0;)s[r]=e[r];return s},forEachEntry:(e,r)=>{const s=(e&&e[Symbol.iterator]).call(e);let o;for(;(o=s.next())&&!o.done;){const c=o.value;r.call(e,c[0],c[1])}},matchAll:(e,r)=>{let s;const o=[];for(;(s=e.exec(r))!==null;)o.push(s);return o},isHTMLForm:mde,hasOwnProperty:OB,hasOwnProp:OB,reduceDescriptors:kB,freezeMethods:e=>{kB(e,(r,s)=>{if(kl(e)&&["arguments","caller","callee"].indexOf(s)!==-1)return!1;const o=e[s];kl(o)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+s+"'")}))})},toObjectSet:(e,r)=>{const s={},o=c=>{c.forEach(u=>{s[u]=!0})};return kv(e)?o(e):o(String(e).split(r)),s},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,s,o){return s.toUpperCase()+o}),noop:()=>{},toFiniteNumber:(e,r)=>e!=null&&Number.isFinite(e=+e)?e:r,findKey:AB,global:M_,isContextDefined:PB,ALPHABET:DB,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:DB.ALPHA_DIGIT,s="";const{length:o}=r;for(;e--;)s+=r[Math.random()*o|0];return s},isSpecCompliantForm:function(e){return!!(e&&kl(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{const r=new Array(10),s=(o,c)=>{if(lA(o)){if(r.indexOf(o)>=0)return;if(!("toJSON"in o)){r[c]=o;const u=kv(o)?[]:{};return cT(o,(h,m)=>{const y=s(h,c+1);!aT(y)&&(u[m]=y)}),r[c]=void 0,u}}return o};return s(e,0)},isAsyncFn:_de,isThenable:e=>e&&(lA(e)||kl(e))&&kl(e.then)&&kl(e.catch),setImmediate:xB,asap:yde};function ar(e,r,s,o,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",r&&(this.code=r),s&&(this.config=s),o&&(this.request=o),c&&(this.response=c,this.status=c.status?c.status:null)}dt.inherits(ar,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:dt.toJSONObject(this.config),code:this.code,status:this.status}}});const UB=ar.prototype,VB={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{VB[e]={value:e}}),Object.defineProperties(ar,VB),Object.defineProperty(UB,"isAxiosError",{value:!0}),ar.from=(e,r,s,o,c,u)=>{const h=Object.create(UB);return dt.toFlatObject(e,h,function(m){return m!==Error.prototype},m=>m!=="isAxiosError"),ar.call(h,e.message,r,s,o,c),h.cause=e,h.name=e.name,u&&Object.assign(h,u),h};function ix(e){return dt.isPlainObject(e)||dt.isArray(e)}function jB(e){return dt.endsWith(e,"[]")?e.slice(0,-2):e}function FB(e,r,s){return e?e.concat(r).map(function(o,c){return o=jB(o),!s&&c?"["+o+"]":o}).join(s?".":""):r}const Ede=dt.toFlatObject(dt,{},null,function(e){return/^is[A-Z]/.test(e)});function hA(e,r,s){if(!dt.isObject(e))throw new TypeError("target must be an object");r=r||new FormData;const o=(s=dt.toFlatObject(s,{metaTokens:!0,dots:!1,indexes:!1},!1,function(P,D){return!dt.isUndefined(D[P])})).metaTokens,c=s.visitor||E,u=s.dots,h=s.indexes,m=(s.Blob||typeof Blob<"u"&&Blob)&&dt.isSpecCompliantForm(r);if(!dt.isFunction(c))throw new TypeError("visitor must be a function");function y(P){if(P===null)return"";if(dt.isDate(P))return P.toISOString();if(!m&&dt.isBlob(P))throw new ar("Blob is not supported. Use a Buffer instead.");return dt.isArrayBuffer(P)||dt.isTypedArray(P)?m&&typeof Blob=="function"?new Blob([P]):Buffer.from(P):P}function E(P,D,G){let j=P;if(P&&!G&&typeof P=="object"){if(dt.endsWith(D,"{}"))D=o?D:D.slice(0,-2),P=JSON.stringify(P);else if(dt.isArray(P)&&function(B){return dt.isArray(B)&&!B.some(ix)}(P)||(dt.isFileList(P)||dt.endsWith(D,"[]"))&&(j=dt.toArray(P)))return D=jB(D),j.forEach(function(B,Y){!dt.isUndefined(B)&&B!==null&&r.append(h===!0?FB([D],Y,u):h===null?D:D+"[]",y(B))}),!1}return!!ix(P)||(r.append(FB(G,D,u),y(P)),!1)}const S=[],R=Object.assign(Ede,{defaultVisitor:E,convertValue:y,isVisitable:ix});if(!dt.isObject(e))throw new TypeError("data must be an object");return function P(D,G){if(!dt.isUndefined(D)){if(S.indexOf(D)!==-1)throw Error("Circular reference detected in "+G.join("."));S.push(D),dt.forEach(D,function(j,B){(!(dt.isUndefined(j)||j===null)&&c.call(r,j,dt.isString(B)?wo(B).call(B):B,G,R))===!0&&P(j,G?G.concat(B):[B])}),S.pop()}}(e),r}function BB(e){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(s){return r[s]})}function sx(e,r){this._pairs=[],e&&hA(e,this,r)}const zB=sx.prototype;function vde(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function WB(e,r,s){if(!r)return e;const o=s&&s.encode||vde;dt.isFunction(s)&&(s={serialize:s});const c=s&&s.serialize;let u;if(u=c?c(r,s):dt.isURLSearchParams(r)?r.toString():new sx(r,s).toString(o),u){const h=e.indexOf("#");h!==-1&&(e=e.slice(0,h)),e+=(e.indexOf("?")===-1?"?":"&")+u}return e}zB.append=function(e,r){this._pairs.push([e,r])},zB.toString=function(e){const r=e?function(s){return e.call(this,s,BB)}:BB;return this._pairs.map(function(s){return r(s[0])+"="+r(s[1])},"").join("&")};var GB=class{constructor(){this.handlers=[]}use(e,r,s){return this.handlers.push({fulfilled:e,rejected:r,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){dt.forEach(this.handlers,function(r){r!==null&&e(r)})}},HB={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},$B={exports:{}},Sde=Gn,bde=xe,KB=rt.f;Sde({target:"Object",stat:!0,forced:Object.defineProperty!==KB,sham:!bde},{defineProperty:KB});var qB=Et.Object,Tde=$B.exports=function(e,r,s){return qB.defineProperty(e,r,s)};qB.defineProperty.sham&&(Tde.sham=!0);var YB=l($B.exports),wde=TypeError,XB=e_,Cde=T_,Rde=gt,Ide=Sr("species"),JB=Array,Ade=function(e){var r;return XB(e)&&(r=e.constructor,(Cde(r)&&(r===JB||XB(r.prototype))||Rde(r)&&(r=r[Ide])===null)&&(r=void 0)),r===void 0?JB:r},QB=function(e,r){return new(Ade(e))(r===0?0:r)},Pde=d,Ode=oi,kde=Sr("species"),ZB=function(e){return Ode>=51||!Pde(function(){var r=[];return(r.constructor={})[kde]=function(){return{foo:1}},r[e](Boolean).foo!==1})},Nde=Gn,Dde=d,xde=e_,Lde=gt,Mde=ea,Ude=gi,e6=function(e){if(e>9007199254740991)throw wde("Maximum allowed index exceeded");return e},t6=zI,Vde=QB,jde=ZB,Fde=oi,n6=Sr("isConcatSpreadable"),Bde=Fde>=51||!Dde(function(){var e=[];return e[n6]=!1,e.concat()[0]!==e}),zde=function(e){if(!Lde(e))return!1;var r=e[n6];return r!==void 0?!!r:xde(e)};Nde({target:"Array",proto:!0,forced:!Bde||!jde("concat")},{concat:function(e){var r,s,o,c,u,h=Mde(this),m=Vde(h,0),y=0;for(r=-1,o=arguments.length;r<o;r++)if(zde(u=r===-1?h:arguments[r]))for(c=Ude(u),e6(y+c),s=0;s<c;s++,y++)s in u&&t6(m,y,u[s]);else e6(y+1),t6(m,y++,u);return m.length=y,m}});var r6={},Wde=X,Gde=Te,i6=ah.f,Hde=cD,s6=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];r6.f=function(e){return s6&&Wde(e)=="Window"?function(r){try{return i6(r)}catch{return Hde(s6)}}(e):i6(Gde(e))};var Nv={},$de=Sr;Nv.f=$de;var o6=Et,Kde=Ci,qde=Nv,Yde=rt.f,Is=function(e){var r=o6.Symbol||(o6.Symbol={});Kde(r,e)||Yde(r,e,{value:qde.f(e)})},Xde=be,Jde=rn,Qde=Sr,Zde=fd,a6=function(){var e=Jde("Symbol"),r=e&&e.prototype,s=r&&r.valueOf,o=Qde("toPrimitive");r&&!r[o]&&Zde(r,o,function(c){return Xde(s,this)},{})},ehe=De,the=kt,nhe=ea,rhe=gi,ihe=QB,c6=I([].push),she=function(e){var r=e==1,s=e==2,o=e==3,c=e==4,u=e==6,h=e==7,m=e==5||u;return function(y,E,S,R){for(var P,D,G=nhe(y),j=the(G),B=ehe(E,S),Y=rhe(j),ee=0,fe=R||ihe,ye=r?fe(y,Y):s||h?fe(y,0):void 0;Y>ee;ee++)if((m||ee in j)&&(D=B(P=j[ee],ee,G),e))if(r)ye[ee]=D;else if(D)switch(e){case 3:return!0;case 5:return P;case 6:return ee;case 2:c6(ye,P)}else switch(e){case 4:return!1;case 7:c6(ye,P)}return u?-1:o||c?c:ye}},l6={forEach:she(0)},pA=Gn,ox=M,ax=be,ohe=I,Dv=xe,xv=oo,ahe=d,Go=Ci,che=O,cx=fn,fA=Te,lx=pc,lhe=ja,ux=qe,lT=ha,u6=zc,uhe=ah,d6=r6,dhe=Bc,h6=Ve,p6=rt,hhe=EE,f6=ze,m6=fd,phe=HE,dx=dc,g6=Fc,_6=eh,fhe=Sr,mhe=Nv,ghe=Is,_he=a6,yhe=md,y6=pd,mA=l6.forEach,Jc=n_("hidden"),gA="Symbol",uT="prototype",Ehe=y6.set,E6=y6.getterFor(gA),Td=Object[uT],U_=ox.Symbol,_A=U_&&U_[uT],vhe=ox.TypeError,hx=ox.QObject,v6=h6.f,V_=p6.f,S6=d6.f,She=f6.f,b6=ohe([].push),sf=dx("symbols"),dT=dx("op-symbols"),bhe=dx("wks"),px=!hx||!hx[uT]||!hx[uT].findChild,fx=Dv&&ahe(function(){return lT(V_({},"a",{get:function(){return V_(this,"a",{value:7}).a}})).a!=7})?function(e,r,s){var o=v6(Td,r);o&&delete Td[r],V_(e,r,s),o&&e!==Td&&V_(Td,r,o)}:V_,mx=function(e,r){var s=sf[e]=lT(_A);return Ehe(s,{type:gA,tag:e,description:r}),Dv||(s.description=r),s},yA=function(e,r,s){e===Td&&yA(dT,r,s),cx(e);var o=lx(r);return cx(s),Go(sf,o)?(s.enumerable?(Go(e,Jc)&&e[Jc][o]&&(e[Jc][o]=!1),s=lT(s,{enumerable:ux(0,!1)})):(Go(e,Jc)||V_(e,Jc,ux(1,{})),e[Jc][o]=!0),fx(e,o,s)):V_(e,o,s)},gx=function(e,r){cx(e);var s=fA(r),o=u6(s).concat(R6(s));return mA(o,function(c){Dv&&!ax(T6,s,c)||yA(e,c,s[c])}),e},T6=function(e){var r=lx(e),s=ax(She,this,r);return!(this===Td&&Go(sf,r)&&!Go(dT,r))&&(!(s||!Go(this,r)||!Go(sf,r)||Go(this,Jc)&&this[Jc][r])||s)},w6=function(e,r){var s=fA(e),o=lx(r);if(s!==Td||!Go(sf,o)||Go(dT,o)){var c=v6(s,o);return!c||!Go(sf,o)||Go(s,Jc)&&s[Jc][o]||(c.enumerable=!0),c}},C6=function(e){var r=S6(fA(e)),s=[];return mA(r,function(o){Go(sf,o)||Go(g6,o)||b6(s,o)}),s},R6=function(e){var r=e===Td,s=S6(r?dT:fA(e)),o=[];return mA(s,function(c){!Go(sf,c)||r&&!Go(Td,c)||b6(o,sf[c])}),o};xv||(U_=function(){if(che(_A,this))throw vhe("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?lhe(arguments[0]):void 0,r=_6(e),s=function(o){this===Td&&ax(s,dT,o),Go(this,Jc)&&Go(this[Jc],r)&&(this[Jc][r]=!1),fx(this,r,ux(1,o))};return Dv&&px&&fx(Td,r,{configurable:!0,set:s}),mx(r,e)},m6(_A=U_[uT],"toString",function(){return E6(this).tag}),m6(U_,"withoutSetter",function(e){return mx(_6(e),e)}),f6.f=T6,p6.f=yA,hhe.f=gx,h6.f=w6,uhe.f=d6.f=C6,dhe.f=R6,mhe.f=function(e){return mx(fhe(e),e)},Dv&&phe(_A,"description",{configurable:!0,get:function(){return E6(this).description}})),pA({global:!0,wrap:!0,forced:!xv,sham:!xv},{Symbol:U_}),mA(u6(bhe),function(e){ghe(e)}),pA({target:gA,stat:!0,forced:!xv},{useSetter:function(){px=!0},useSimple:function(){px=!1}}),pA({target:"Object",stat:!0,forced:!xv,sham:!Dv},{create:function(e,r){return r===void 0?lT(e):gx(lT(e),r)},defineProperty:yA,defineProperties:gx,getOwnPropertyDescriptor:w6}),pA({target:"Object",stat:!0,forced:!xv},{getOwnPropertyNames:C6}),_he(),yhe(U_,gA),g6[Jc]=!0;var I6=oo&&!!Symbol.for&&!!Symbol.keyFor,The=Gn,whe=rn,Che=Ci,Rhe=ja,A6=dc,Ihe=I6,_x=A6("string-to-symbol-registry"),Ahe=A6("symbol-to-string-registry");The({target:"Symbol",stat:!0,forced:!Ihe},{for:function(e){var r=Rhe(e);if(Che(_x,r))return _x[r];var s=whe("Symbol")(r);return _x[r]=s,Ahe[s]=r,s}});var Phe=Gn,Ohe=Ci,khe=lc,Nhe=La,Dhe=I6,P6=dc("symbol-to-string-registry");Phe({target:"Symbol",stat:!0,forced:!Dhe},{keyFor:function(e){if(!khe(e))throw TypeError(Nhe(e)+" is not a symbol");if(Ohe(P6,e))return P6[e]}});var O6=e_,xhe=Oe,k6=X,Lhe=ja,N6=I([].push),Mhe=Gn,D6=rn,x6=re,Uhe=be,hT=I,L6=d,M6=Oe,U6=lc,V6=ws,Vhe=function(e){if(xhe(e))return e;if(O6(e)){for(var r=e.length,s=[],o=0;o<r;o++){var c=e[o];typeof c=="string"?N6(s,c):typeof c!="number"&&k6(c)!="Number"&&k6(c)!="String"||N6(s,Lhe(c))}var u=s.length,h=!0;return function(m,y){if(h)return h=!1,y;if(O6(this))return y;for(var E=0;E<u;E++)if(s[E]===m)return y}}},jhe=oo,Fhe=String,Bm=D6("JSON","stringify"),EA=hT(/./.exec),j6=hT("".charAt),Bhe=hT("".charCodeAt),zhe=hT("".replace),Whe=hT(1 .toString),Ghe=/[\uD800-\uDFFF]/g,F6=/^[\uD800-\uDBFF]$/,B6=/^[\uDC00-\uDFFF]$/,z6=!jhe||L6(function(){var e=D6("Symbol")();return Bm([e])!="[null]"||Bm({a:e})!="{}"||Bm(Object(e))!="{}"}),W6=L6(function(){return Bm("\uDF06\uD834")!=='"\\udf06\\ud834"'||Bm("\uDEAD")!=='"\\udead"'}),Hhe=function(e,r){var s=V6(arguments),o=Vhe(r);if(M6(o)||e!==void 0&&!U6(e))return s[1]=function(c,u){if(M6(o)&&(u=Uhe(o,this,Fhe(c),u)),!U6(u))return u},x6(Bm,null,s)},$he=function(e,r,s){var o=j6(s,r-1),c=j6(s,r+1);return EA(F6,e)&&!EA(B6,c)||EA(B6,e)&&!EA(F6,o)?"\\u"+Whe(Bhe(e,0),16):e};Bm&&Mhe({target:"JSON",stat:!0,forced:z6||W6},{stringify:function(e,r,s){var o=V6(arguments),c=x6(z6?Hhe:Bm,null,o);return W6&&typeof c=="string"?zhe(c,Ghe,$he):c}});var G6=Bc,Khe=ea;Gn({target:"Object",stat:!0,forced:!oo||d(function(){G6.f(1)})},{getOwnPropertySymbols:function(e){var r=G6.f;return r?r(Khe(e)):[]}}),Is("asyncIterator"),Is("hasInstance"),Is("isConcatSpreadable"),Is("iterator"),Is("match"),Is("matchAll"),Is("replace"),Is("search"),Is("species"),Is("split");var qhe=a6;Is("toPrimitive"),qhe();var Yhe=rn,Xhe=md;Is("toStringTag"),Xhe(Yhe("Symbol"),"Symbol"),Is("unscopables"),md(M.JSON,"JSON",!0);var Jhe=Et.Symbol,Qhe=Sr,Zhe=rt.f,H6=Qhe("metadata"),$6=Function.prototype;$6[H6]===void 0&&Zhe($6,H6,{value:null}),Is("dispose"),Is("metadata");var epe=Jhe;Is("asyncDispose");var tpe=I,yx=rn("Symbol"),npe=yx.keyFor,rpe=tpe(yx.prototype.valueOf),K6=yx.isRegisteredSymbol||function(e){try{return npe(rpe(e))!==void 0}catch{return!1}};Gn({target:"Symbol",stat:!0},{isRegisteredSymbol:K6});for(var ipe=dc,q6=rn,spe=I,ope=lc,ape=Sr,vA=q6("Symbol"),Y6=vA.isWellKnownSymbol,X6=q6("Object","getOwnPropertyNames"),cpe=spe(vA.prototype.valueOf),J6=ipe("wks"),Ex=0,Q6=X6(vA),lpe=Q6.length;Ex<lpe;Ex++)try{var Z6=Q6[Ex];ope(vA[Z6])&&ape(Z6)}catch{}var ez=function(e){if(Y6&&Y6(e))return!0;try{for(var r=cpe(e),s=0,o=X6(J6),c=o.length;s<c;s++)if(J6[o[s]]==r)return!0}catch{}return!1};Gn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:ez}),Is("matcher"),Is("observable"),Gn({target:"Symbol",stat:!0},{isRegistered:K6}),Gn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:ez}),Is("metadataKey"),Is("patternMatch"),Is("replaceAll");var Lv=l(epe),tz=l(Nv.f("iterator"));function pT(e){return pT=typeof Lv=="function"&&typeof tz=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Lv=="function"&&r.constructor===Lv&&r!==Lv.prototype?"symbol":typeof r},pT(e)}var upe=l(Nv.f("toPrimitive"));function dpe(e){var r=function(s,o){if(pT(s)!=="object"||s===null)return s;var c=s[upe];if(c!==void 0){var u=c.call(s,o);if(pT(u)!=="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(s)}(e,"string");return pT(r)==="symbol"?r:String(r)}function q(e,r,s){return(r=dpe(r))in e?YB(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}var nz=l(Hce),hpe={isBrowser:!0,classes:{URLSearchParams:nz!==void 0?nz:sx,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const vx=typeof window<"u"&&typeof document<"u",Sx=typeof navigator=="object"&&navigator||void 0,ppe=vx&&(!Sx||["ReactNative","NativeScript","NS"].indexOf(Sx.product)<0),fpe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",mpe=vx&&window.location.href||"http://localhost";function rz(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function iz(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?rz(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):rz(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}var Ka=iz(iz({},Object.freeze({__proto__:null,hasBrowserEnv:vx,hasStandardBrowserEnv:ppe,hasStandardBrowserWebWorkerEnv:fpe,navigator:Sx,origin:mpe})),hpe),gpe=fn,_pe=be,ype=Ci,Epe=O,vpe=function(){var e=gpe(this),r="";return e.hasIndices&&(r+="d"),e.global&&(r+="g"),e.ignoreCase&&(r+="i"),e.multiline&&(r+="m"),e.dotAll&&(r+="s"),e.unicode&&(r+="u"),e.unicodeSets&&(r+="v"),e.sticky&&(r+="y"),r},sz=RegExp.prototype,oz=function(e){var r=e.flags;return r!==void 0||"flags"in sz||ype(e,"flags")||!Epe(sz,e)?r:_pe(vpe,e)},Spe=rD.charAt,az=be,bpe=fn,Tpe=Oe,wpe=X,Cpe=/./.exec,Rpe=TypeError,Ipe=Gn,cz=be,lz=se,Ape=UE,SA=zE,uz=Lt,dz=Gt,fT=ja,Ppe=fn,Ope=He,kpe=X,Npe=bR,hz=oz,Dpe=mi,xpe=d,Lpe=ss,Mpe=function(e,r,s){return r+(s?Spe(e,r).length:1)},Upe=function(e,r){var s=e.exec;if(Tpe(s)){var o=az(s,e,r);return o!==null&&bpe(o),o}if(wpe(e)==="RegExp")return az(Cpe,e,r);throw Rpe("RegExp#exec called on incompatible receiver")},pz=pd,Vpe=Sr("matchAll"),fz="RegExp String",mz=fz+" Iterator",jpe=pz.set,Fpe=pz.getterFor(mz),Bpe=TypeError,bx=lz("".indexOf),bA=lz("".matchAll),Tx=!!bA&&!xpe(function(){bA("a",/./)}),zpe=Ape(function(e,r,s,o){jpe(this,{type:mz,regexp:e,string:r,global:s,unicode:o,done:!1})},fz,function(){var e=Fpe(this);if(e.done)return SA(void 0,!0);var r=e.regexp,s=e.string,o=Upe(r,s);return o===null?(e.done=!0,SA(void 0,!0)):e.global?(fT(o[0])===""&&(r.lastIndex=Mpe(s,dz(r.lastIndex),e.unicode)),SA(o,!1)):(e.done=!0,SA(o,!1))}),gz=function(e){var r,s,o,c=Ppe(this),u=fT(e),h=Lpe(c,RegExp),m=fT(hz(c));return r=new h(h===RegExp?c.source:c,m),s=!!~bx(m,"g"),o=!!~bx(m,"u"),r.lastIndex=dz(c.lastIndex),new zpe(r,u,s,o)};Ipe({target:"String",proto:!0,forced:Tx},{matchAll:function(e){var r,s,o,c,u=uz(this);if(Ope(e)){if(Tx)return bA(u,e)}else{if(Npe(e)&&(r=fT(uz(hz(e))),!~bx(r,"g")))throw Bpe("`.matchAll` does not allow non-global regexes");if(Tx)return bA(u,e);if((o=Dpe(e,Vpe))===void 0&&kpe(e)=="RegExp"&&(o=gz),o)return cz(o,e,u)}return s=fT(u),c=new RegExp(e,"g"),cz(gz,c,s)}});var Wpe=mc("String").matchAll,Gpe=O,Hpe=Wpe,wx=String.prototype,$pe=function(e){var r=e.matchAll;return typeof e=="string"||e===wx||Gpe(wx,e)&&r===wx.matchAll?Hpe:r},Kpe=l($pe);function _z(e){function r(s,o,c,u){let h=s[u++];if(h==="__proto__")return!0;const m=Number.isFinite(+h),y=u>=s.length;return h=!h&&dt.isArray(c)?c.length:h,y?(dt.hasOwnProp(c,h)?c[h]=[c[h],o]:c[h]=o,!m):(c[h]&&dt.isObject(c[h])||(c[h]=[]),r(s,o,c[h],u)&&dt.isArray(c[h])&&(c[h]=function(E){const S={},R=Object.keys(E);let P;const D=R.length;let G;for(P=0;P<D;P++)G=R[P],S[G]=E[G];return S}(c[h])),!m)}if(dt.isFormData(e)&&dt.isFunction(e.entries)){const s={};return dt.forEachEntry(e,(o,c)=>{r(function(u){return Kpe(dt).call(dt,/\w+|\[(\w*)]/g,u).map(h=>h[0]==="[]"?"":h[1]||h[0])}(o),c,s,0)}),s}return null}const Cx={transitional:HB,adapter:["xhr","http","fetch"],transformRequest:[function(e,r){const s=r.getContentType()||"",o=s.indexOf("application/json")>-1,c=dt.isObject(e);if(c&&dt.isHTMLForm(e)&&(e=new FormData(e)),dt.isFormData(e))return o?JSON.stringify(_z(e)):e;if(dt.isArrayBuffer(e)||dt.isBuffer(e)||dt.isStream(e)||dt.isFile(e)||dt.isBlob(e)||dt.isReadableStream(e))return e;if(dt.isArrayBufferView(e))return e.buffer;if(dt.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(c){if(s.indexOf("application/x-www-form-urlencoded")>-1)return function(h,m){return hA(h,new Ka.classes.URLSearchParams,Object.assign({visitor:function(y,E,S,R){return Ka.isNode&&dt.isBuffer(y)?(this.append(E,y.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},m))}(e,this.formSerializer).toString();if((u=dt.isFileList(e))||s.indexOf("multipart/form-data")>-1){const h=this.env&&this.env.FormData;return hA(u?{"files[]":e}:e,h&&new h,this.formSerializer)}}return c||o?(r.setContentType("application/json",!1),function(h,m,y){if(dt.isString(h))try{return(m||JSON.parse)(h),wo(dt).call(dt,h)}catch(E){if(E.name!=="SyntaxError")throw E}return(y||JSON.stringify)(h)}(e)):e}],transformResponse:[function(e){const r=this.transitional||Cx.transitional,s=r&&r.forcedJSONParsing,o=this.responseType==="json";if(dt.isResponse(e)||dt.isReadableStream(e))return e;if(e&&dt.isString(e)&&(s&&!this.responseType||o)){const c=!(r&&r.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(u){if(c)throw u.name==="SyntaxError"?ar.from(u,ar.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ka.classes.FormData,Blob:Ka.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};dt.forEach(["delete","get","head","post","put","patch"],e=>{Cx.headers[e]={}});var Rx=Cx;const qpe=dt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),yz=Symbol("internals");function mT(e){var r;return e&&wo(r=String(e)).call(r).toLowerCase()}function TA(e){return e===!1||e==null?e:dt.isArray(e)?e.map(TA):String(e)}function Ix(e,r,s,o,c){return dt.isFunction(o)?o.call(this,r,s):(c&&(r=s),dt.isString(r)?dt.isString(o)?r.indexOf(o)!==-1:dt.isRegExp(o)?o.test(r):void 0:void 0)}class wA{constructor(r){r&&this.set(r)}set(r,s,o){const c=this;function u(y,E,S){const R=mT(E);if(!R)throw new Error("header name must be a non-empty string");const P=dt.findKey(c,R);(!P||c[P]===void 0||S===!0||S===void 0&&c[P]!==!1)&&(c[P||E]=TA(y))}const h=(y,E)=>dt.forEach(y,(S,R)=>u(S,R,E));if(dt.isPlainObject(r)||r instanceof this.constructor)h(r,s);else if(dt.isString(r)&&(r=wo(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(wo(m=r).call(m)))h((y=>{const E={};let S,R,P;return y&&y.split(`
`).forEach(function(D){var G,j;P=D.indexOf(":"),S=wo(G=D.substring(0,P)).call(G).toLowerCase(),R=wo(j=D.substring(P+1)).call(j),!S||E[S]&&qpe[S]||(S==="set-cookie"?E[S]?E[S].push(R):E[S]=[R]:E[S]=E[S]?E[S]+", "+R:R)}),E})(r),s);else if(dt.isHeaders(r))for(const[y,E]of r.entries())u(E,y,o);else r!=null&&u(s,r,o);var m;return this}get(r,s){if(r=mT(r)){const o=dt.findKey(this,r);if(o){const c=this[o];if(!s)return c;if(s===!0)return function(u){const h=Object.create(null),m=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let y;for(;y=m.exec(u);)h[y[1]]=y[2];return h}(c);if(dt.isFunction(s))return s.call(this,c,o);if(dt.isRegExp(s))return s.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,s){if(r=mT(r)){const o=dt.findKey(this,r);return!(!o||this[o]===void 0||s&&!Ix(0,this[o],o,s))}return!1}delete(r,s){const o=this;let c=!1;function u(h){if(h=mT(h)){const m=dt.findKey(o,h);!m||s&&!Ix(0,o[m],m,s)||(delete o[m],c=!0)}}return dt.isArray(r)?r.forEach(u):u(r),c}clear(r){const s=Object.keys(this);let o=s.length,c=!1;for(;o--;){const u=s[o];r&&!Ix(0,this[u],u,r,!0)||(delete this[u],c=!0)}return c}normalize(r){const s=this,o={};return dt.forEach(this,(c,u)=>{var h;const m=dt.findKey(o,u);if(m)return s[m]=TA(c),void delete s[u];const y=r?function(E){return wo(E).call(E).toLowerCase().replace(/([a-z\d])(\w*)/g,(S,R,P)=>R.toUpperCase()+P)}(u):wo(h=String(u)).call(h);y!==u&&delete s[u],s[y]=TA(c),o[y]=!0}),this}concat(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return this.constructor.concat(this,...s)}toJSON(r){const s=Object.create(null);return dt.forEach(this,(o,c)=>{o!=null&&o!==!1&&(s[c]=r&&dt.isArray(o)?o.join(", "):o)}),s}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[s,o]=r;return s+": "+o}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const s=new this(r);for(var o=arguments.length,c=new Array(o>1?o-1:0),u=1;u<o;u++)c[u-1]=arguments[u];return c.forEach(h=>s.set(h)),s}static accessor(r){const s=(this[yz]=this[yz]={accessors:{}}).accessors,o=this.prototype;function c(u){const h=mT(u);s[h]||(function(m,y){const E=dt.toCamelCase(" "+y);["get","set","has"].forEach(S=>{Object.defineProperty(m,S+E,{value:function(R,P,D){return this[S].call(this,y,R,P,D)},configurable:!0})})}(o,u),s[h]=!0)}return dt.isArray(r)?r.forEach(c):c(r),this}}wA.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),dt.reduceDescriptors(wA.prototype,(e,r)=>{let{value:s}=e,o=r[0].toUpperCase()+r.slice(1);return{get:()=>s,set(c){this[o]=c}}}),dt.freezeMethods(wA);var wd=wA;function Ax(e,r){const s=this||Rx,o=r||s,c=wd.from(o.headers);let u=o.data;return dt.forEach(e,function(h){u=h.call(s,u,c.normalize(),r?r.status:void 0)}),c.normalize(),u}function Ez(e){return!(!e||!e.__CANCEL__)}function Mv(e,r,s){ar.call(this,e??"canceled",ar.ERR_CANCELED,r,s),this.name="CanceledError"}function vz(e,r,s){const o=s.config.validateStatus;s.status&&o&&!o(s.status)?r(new ar("Request failed with status code "+s.status,[ar.ERR_BAD_REQUEST,ar.ERR_BAD_RESPONSE][Math.floor(s.status/100)-4],s.config,s.request,s)):e(s)}dt.inherits(Mv,ar,{__CANCEL__:!0});const CA=function(e,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,o=0;const c=function(u,h){u=u||10;const m=new Array(u),y=new Array(u);let E,S=0,R=0;return h=h!==void 0?h:1e3,function(P){const D=Date.now(),G=y[R];E||(E=D),m[S]=P,y[S]=D;let j=R,B=0;for(;j!==S;)B+=m[j++],j%=u;if(S=(S+1)%u,S===R&&(R=(R+1)%u),D-E<h)return;const Y=G&&D-G;return Y?Math.round(1e3*B/Y):void 0}}(50,250);return function(u,h){let m,y,E=0,S=1e3/h;const R=function(P){E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),m=null,y&&(clearTimeout(y),y=null),u.apply(null,P)};return[function(){const P=Date.now(),D=P-E;for(var G=arguments.length,j=new Array(G),B=0;B<G;B++)j[B]=arguments[B];D>=S?R(j,P):(m=j,y||(y=setTimeout(()=>{y=null,R(m)},S-D)))},()=>m&&R(m)]}(u=>{const h=u.loaded,m=u.lengthComputable?u.total:void 0,y=h-o,E=c(y);o=h,e({loaded:h,total:m,progress:m?h/m:void 0,bytes:y,rate:E||void 0,estimated:E&&m&&h<=m?(m-h)/E:void 0,event:u,lengthComputable:m!=null,[r?"download":"upload"]:!0})},s)},Sz=(e,r)=>{const s=e!=null;return[o=>r[0]({lengthComputable:s,total:e,loaded:o}),r[1]]},bz=e=>function(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return dt.asap(()=>e(...s))};var Ype=Ka.hasStandardBrowserEnv?((e,r)=>s=>(s=new eA(s,Ka.origin),e.protocol===s.protocol&&e.host===s.host&&(r||e.port===s.port)))(new eA(Ka.origin),Ka.navigator&&/(msie|trident)/i.test(Ka.navigator.userAgent)):()=>!0,Xpe=Ka.hasStandardBrowserEnv?{write(e,r,s,o,c,u){const h=[e+"="+encodeURIComponent(r)];dt.isNumber(s)&&h.push("expires="+new Date(s).toGMTString()),dt.isString(o)&&h.push("path="+o),dt.isString(c)&&h.push("domain="+c),u===!0&&h.push("secure"),document.cookie=h.join("; ")},read(e){const r=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Tz(e,r){return e&&!function(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}(r)?function(s,o){return o?s.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):s}(e,r):r}function wz(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}const Cz=e=>e instanceof wd?function(r){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?arguments[s]:{};s%2?wz(Object(o),!0).forEach(function(c){q(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):wz(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},e):e;function j_(e,r){r=r||{};const s={};function o(E,S,R,P){return dt.isPlainObject(E)&&dt.isPlainObject(S)?dt.merge.call({caseless:P},E,S):dt.isPlainObject(S)?dt.merge({},S):dt.isArray(S)?S.slice():S}function c(E,S,R,P){return dt.isUndefined(S)?dt.isUndefined(E)?void 0:o(void 0,E,0,P):o(E,S,0,P)}function u(E,S){if(!dt.isUndefined(S))return o(void 0,S)}function h(E,S){return dt.isUndefined(S)?dt.isUndefined(E)?void 0:o(void 0,E):o(void 0,S)}function m(E,S,R){return R in r?o(E,S):R in e?o(void 0,E):void 0}const y={url:u,method:u,data:u,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:m,headers:(E,S,R)=>c(Cz(E),Cz(S),0,!0)};return dt.forEach(Object.keys(Object.assign({},e,r)),function(E){const S=y[E]||c,R=S(e[E],r[E],E);dt.isUndefined(R)&&S!==m||(s[E]=R)}),s}var Rz=e=>{const r=j_({},e);let s,{data:o,withXSRFToken:c,xsrfHeaderName:u,xsrfCookieName:h,headers:m,auth:y}=r;if(r.headers=m=wd.from(m),r.url=WB(Tz(r.baseURL,r.url),e.params,e.paramsSerializer),y&&m.set("Authorization","Basic "+btoa((y.username||"")+":"+(y.password?unescape(encodeURIComponent(y.password)):""))),dt.isFormData(o)){if(Ka.hasStandardBrowserEnv||Ka.hasStandardBrowserWebWorkerEnv)m.setContentType(void 0);else if((s=m.getContentType())!==!1){const[E,...S]=s?s.split(";").map(R=>wo(R).call(R)).filter(Boolean):[];m.setContentType([E||"multipart/form-data",...S].join("; "))}}if(Ka.hasStandardBrowserEnv&&(c&&dt.isFunction(c)&&(c=c(r)),c||c!==!1&&Ype(r.url))){const E=u&&h&&Xpe.read(h);E&&m.set(u,E)}return r},Jpe=typeof XMLHttpRequest<"u"&&function(e){return new ht(function(r,s){const o=Rz(e);let c=o.data;const u=wd.from(o.headers).normalize();let h,m,y,E,S,{responseType:R,onUploadProgress:P,onDownloadProgress:D}=o;function G(){E&&E(),S&&S(),o.cancelToken&&o.cancelToken.unsubscribe(h),o.signal&&o.signal.removeEventListener("abort",h)}let j=new XMLHttpRequest;function B(){if(!j)return;const ee=wd.from("getAllResponseHeaders"in j&&j.getAllResponseHeaders());vz(function(fe){r(fe),G()},function(fe){s(fe),G()},{data:R&&R!=="text"&&R!=="json"?j.response:j.responseText,status:j.status,statusText:j.statusText,headers:ee,config:e,request:j}),j=null}j.open(o.method.toUpperCase(),o.url,!0),j.timeout=o.timeout,"onloadend"in j?j.onloadend=B:j.onreadystatechange=function(){j&&j.readyState===4&&(j.status!==0||j.responseURL&&j.responseURL.indexOf("file:")===0)&&setTimeout(B)},j.onabort=function(){j&&(s(new ar("Request aborted",ar.ECONNABORTED,e,j)),j=null)},j.onerror=function(){s(new ar("Network Error",ar.ERR_NETWORK,e,j)),j=null},j.ontimeout=function(){let ee=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const fe=o.transitional||HB;o.timeoutErrorMessage&&(ee=o.timeoutErrorMessage),s(new ar(ee,fe.clarifyTimeoutError?ar.ETIMEDOUT:ar.ECONNABORTED,e,j)),j=null},c===void 0&&u.setContentType(null),"setRequestHeader"in j&&dt.forEach(u.toJSON(),function(ee,fe){j.setRequestHeader(fe,ee)}),dt.isUndefined(o.withCredentials)||(j.withCredentials=!!o.withCredentials),R&&R!=="json"&&(j.responseType=o.responseType),D&&([y,S]=CA(D,!0),j.addEventListener("progress",y)),P&&j.upload&&([m,E]=CA(P),j.upload.addEventListener("progress",m),j.upload.addEventListener("loadend",E)),(o.cancelToken||o.signal)&&(h=ee=>{j&&(s(!ee||ee.type?new Mv(null,e,j):ee),j.abort(),j=null)},o.cancelToken&&o.cancelToken.subscribe(h),o.signal&&(o.signal.aborted?h():o.signal.addEventListener("abort",h)));const Y=function(ee){const fe=/^([-+\w]{1,25})(:?\/\/|:)/.exec(ee);return fe&&fe[1]||""}(o.url);Y&&Ka.protocols.indexOf(Y)===-1?s(new ar("Unsupported protocol "+Y+":",ar.ERR_BAD_REQUEST,e)):j.send(c||null)})},Qpe=(e,r)=>{const{length:s}=e=e?e.filter(Boolean):[];if(r||s){let o,c=new AbortController;const u=function(E){if(!o){o=!0,m();const S=E instanceof Error?E:this.reason;c.abort(S instanceof ar?S:new Mv(S instanceof Error?S.message:S))}};let h=r&&setTimeout(()=>{h=null,u(new ar("timeout ".concat(r," of ms exceeded"),ar.ETIMEDOUT))},r);const m=()=>{e&&(h&&clearTimeout(h),h=null,e.forEach(E=>{E.unsubscribe?E.unsubscribe(u):E.removeEventListener("abort",u)}),e=null)};e.forEach(E=>E.addEventListener("abort",u));const{signal:y}=c;return y.unsubscribe=()=>dt.asap(m),y}},Zpe=y4,efe=Ol;Gn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=efe.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var tfe=Ol,nfe=yh;Gn({target:"Promise",stat:!0,forced:!0},{try:function(e){var r=tfe.f(this),s=nfe(e);return(s.error?r.reject:r.resolve)(s.value),r.promise}});var Px=l(Zpe),Iz=Nv.f("asyncIterator"),rfe=l(Iz);function Ox(e,r){this.v=e,this.k=r}function gT(e){var r,s;function o(u,h){try{var m=e[u](h),y=m.value,E=y instanceof Ox;Px.resolve(E?y.v:y).then(function(S){if(E){var R=u==="return"?"return":"next";if(!y.k||S.done)return o(R,S);S=e[R](S).value}c(m.done?"return":"normal",S)},function(S){o("throw",S)})}catch(S){c("throw",S)}}function c(u,h){switch(u){case"return":r.resolve({value:h,done:!0});break;case"throw":r.reject(h);break;default:r.resolve({value:h,done:!1})}(r=r.next)?o(r.key,r.arg):s=null}this._invoke=function(u,h){return new Px(function(m,y){var E={key:u,arg:h,resolve:m,reject:y,next:null};s?s=s.next=E:(r=s=E,o(u,h))})},typeof e.return!="function"&&(this.return=void 0)}function Nl(e){return function(){return new gT(e.apply(this,arguments))}}function Dn(e){return new Ox(e,0)}function RA(e){var r={},s=!1;function o(c,u){return s=!0,{done:!1,value:new Ox(u=new Px(function(h){h(e[c](u))}),1)}}return r[Lv!==void 0&&tz||"@@iterator"]=function(){return this},r.next=function(c){return s?(s=!1,c):o("next",c)},typeof e.throw=="function"&&(r.throw=function(c){if(s)throw s=!1,c;return o("throw",c)}),typeof e.return=="function"&&(r.return=function(c){return s?(s=!1,c):o("return",c)}),r}gT.prototype[typeof Lv=="function"&&rfe||"@@asyncIterator"]=function(){return this},gT.prototype.next=function(e){return this._invoke("next",e)},gT.prototype.throw=function(e){return this._invoke("throw",e)},gT.prototype.return=function(e){return this._invoke("return",e)};var kx=l(Iz);function Nx(e){var r,s,o,c=2;for(typeof Symbol<"u"&&(s=kx,o=Symbol.iterator);c--;){if(s&&(r=e[s])!=null)return r.call(e);if(o&&(r=e[o])!=null)return new IA(r.call(e));s="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function IA(e){function r(s){if(Object(s)!==s)return ht.reject(new TypeError(s+" is not an object."));var o=s.done;return ht.resolve(s.value).then(function(c){return{value:c,done:o}})}return IA=function(s){this.s=s,this.n=s.next},IA.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var o=this.s.return;return o===void 0?ht.resolve({value:s,done:!0}):r(o.apply(this.s,arguments))},throw:function(s){var o=this.s.return;return o===void 0?ht.reject(s):r(o.apply(this.s,arguments))}},new IA(e)}const ife=function*(e,r){let s=e.byteLength;if(!r||s<r)return void(yield e);let o,c=0;for(;c<s;)o=c+r,yield e.slice(c,o),c=o},sfe=function(){var e=Nl(function*(r,s){var o,c=!1,u=!1;try{for(var h,m=Nx(ofe(r));c=!(h=yield Dn(m.next())).done;c=!1){const y=h.value;yield*RA(Nx(ife(y,s)))}}catch(y){u=!0,o=y}finally{try{c&&m.return!=null&&(yield Dn(m.return()))}finally{if(u)throw o}}});return function(r,s){return e.apply(this,arguments)}}(),ofe=function(){var e=Nl(function*(r){if(r[kx])return void(yield*RA(Nx(r)));const s=r.getReader();try{for(;;){const{done:o,value:c}=yield Dn(s.read());if(o)break;yield c}}finally{yield Dn(s.cancel())}});return function(r){return e.apply(this,arguments)}}(),Az=(e,r,s,o)=>{const c=sfe(e,r);let u,h=0,m=y=>{u||(u=!0,o&&o(y))};return new ReadableStream({async pull(y){try{const{done:E,value:S}=await c.next();if(E)return m(),void y.close();let R=S.byteLength;if(s){let P=h+=R;s(P)}y.enqueue(new Uint8Array(S))}catch(E){throw m(E),E}},cancel:y=>(m(y),c.return())},{highWaterMark:2})};function Pz(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function Oz(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Pz(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Pz(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}const AA=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",kz=AA&&typeof ReadableStream=="function",afe=AA&&(typeof TextEncoder=="function"?(Nz=new TextEncoder,e=>Nz.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var Nz;const Dz=function(e){try{for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return!!e(...s)}catch{return!1}},cfe=kz&&Dz(()=>{let e=!1;const r=new Request(Ka.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!r}),Dx=kz&&Dz(()=>dt.isReadableStream(new Response("").body)),PA={stream:Dx&&(e=>e.body)};var xz;AA&&(xz=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!PA[e]&&(PA[e]=dt.isFunction(xz[e])?r=>r[e]():(r,s)=>{throw new ar("Response type '".concat(e,"' is not supported"),ar.ERR_NOT_SUPPORT,s)})}));const lfe=async(e,r)=>{const s=dt.toFiniteNumber(e.getContentLength());return s??(async o=>o==null?0:dt.isBlob(o)?o.size:dt.isSpecCompliantForm(o)?(await new Request(Ka.origin,{method:"POST",body:o}).arrayBuffer()).byteLength:dt.isArrayBufferView(o)||dt.isArrayBuffer(o)?o.byteLength:(dt.isURLSearchParams(o)&&(o+=""),dt.isString(o)?(await afe(o)).byteLength:void 0))(r)};var ufe=AA&&(async e=>{let{url:r,method:s,data:o,signal:c,cancelToken:u,timeout:h,onDownloadProgress:m,onUploadProgress:y,responseType:E,headers:S,withCredentials:R="same-origin",fetchOptions:P}=Rz(e);E=E?(E+"").toLowerCase():"text";let D,G=Qpe([c,u&&u.toAbortSignal()],h);const j=G&&G.unsubscribe&&(()=>{G.unsubscribe()});let B;try{if(y&&cfe&&s!=="get"&&s!=="head"&&(B=await lfe(S,o))!==0){let Ee,_e=new Request(r,{method:"POST",body:o,duplex:"half"});if(dt.isFormData(o)&&(Ee=_e.headers.get("content-type"))&&S.setContentType(Ee),_e.body){const[Ne,Ze]=Sz(B,CA(bz(y)));o=Az(_e.body,65536,Ne,Ze)}}dt.isString(R)||(R=R?"include":"omit");const Y="credentials"in Request.prototype;D=new Request(r,Oz(Oz({},P),{},{signal:G,method:s.toUpperCase(),headers:S.normalize().toJSON(),body:o,duplex:"half",credentials:Y?R:void 0}));let ee=await fetch(D);const fe=Dx&&(E==="stream"||E==="response");if(Dx&&(m||fe&&j)){const Ee={};["status","statusText","headers"].forEach(pt=>{Ee[pt]=ee[pt]});const _e=dt.toFiniteNumber(ee.headers.get("content-length")),[Ne,Ze]=m&&Sz(_e,CA(bz(m),!0))||[];ee=new Response(Az(ee.body,65536,Ne,()=>{Ze&&Ze(),j&&j()}),Ee)}E=E||"text";let ye=await PA[dt.findKey(PA,E)||"text"](ee,e);return!fe&&j&&j(),await new ht((Ee,_e)=>{vz(Ee,_e,{data:ye,headers:wd.from(ee.headers),status:ee.status,statusText:ee.statusText,config:e,request:D})})}catch(Y){throw j&&j(),Y&&Y.name==="TypeError"&&/fetch/i.test(Y.message)?Object.assign(new ar("Network Error",ar.ERR_NETWORK,e,D),{cause:Y.cause||Y}):ar.from(Y,Y&&Y.code,e,D)}});const xx={http:null,xhr:Jpe,fetch:ufe};dt.forEach(xx,(e,r)=>{if(e){try{Object.defineProperty(e,"name",{value:r})}catch{}Object.defineProperty(e,"adapterName",{value:r})}});const Lz=e=>"- ".concat(e),dfe=e=>dt.isFunction(e)||e===null||e===!1;var Mz={getAdapter:e=>{e=dt.isArray(e)?e:[e];const{length:r}=e;let s,o;const c={};for(let u=0;u<r;u++){let h;if(s=e[u],o=s,!dfe(s)&&(o=xx[(h=String(s)).toLowerCase()],o===void 0))throw new ar("Unknown adapter '".concat(h,"'"));if(o)break;c[h||"#"+u]=o}if(!o){const u=Object.entries(c).map(h=>{let[m,y]=h;return"adapter ".concat(m," ")+(y===!1?"is not supported by the environment":"is not available in the build")});throw new ar("There is no suitable adapter to dispatch the request "+(r?u.length>1?`since :
`+u.map(Lz).join(`
`):" "+Lz(u[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return o},adapters:xx};function Lx(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Mv(null,e)}function Uz(e){return Lx(e),e.headers=wd.from(e.headers),e.data=Ax.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),Mz.getAdapter(e.adapter||Rx.adapter)(e).then(function(r){return Lx(e),r.data=Ax.call(e,e.transformResponse,r),r.headers=wd.from(r.headers),r},function(r){return Ez(r)||(Lx(e),r&&r.response&&(r.response.data=Ax.call(e,e.transformResponse,r.response),r.response.headers=wd.from(r.response.headers))),ht.reject(r)})}const Vz="1.7.9",OA={};["object","boolean","number","function","string","symbol"].forEach((e,r)=>{OA[e]=function(s){return typeof s===e||"a"+(r<1?"n ":" ")+e}});const jz={};OA.transitional=function(e,r,s){function o(c,u){return"[Axios v"+Vz+"] Transitional option '"+c+"'"+u+(s?". "+s:"")}return(c,u,h)=>{if(e===!1)throw new ar(o(u," has been removed"+(r?" in "+r:"")),ar.ERR_DEPRECATED);return r&&!jz[u]&&(jz[u]=!0,console.warn(o(u," has been deprecated since v"+r+" and will be removed in the near future"))),!e||e(c,u,h)}},OA.spelling=function(e){return(r,s)=>(console.warn("".concat(s," is likely a misspelling of ").concat(e)),!0)};var kA={assertOptions:function(e,r,s){if(typeof e!="object")throw new ar("options must be an object",ar.ERR_BAD_OPTION_VALUE);const o=Object.keys(e);let c=o.length;for(;c-- >0;){const u=o[c],h=r[u];if(h){const m=e[u],y=m===void 0||h(m,u,e);if(y!==!0)throw new ar("option "+u+" must be "+y,ar.ERR_BAD_OPTION_VALUE)}else if(s!==!0)throw new ar("Unknown option "+u,ar.ERR_BAD_OPTION)}},validators:OA};const wh=kA.validators;let NA=class{constructor(e){this.defaults=e,this.interceptors={request:new GB,response:new GB}}async request(e,r){try{return await this._request(e,r)}catch(s){if(s instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const c=o.stack?o.stack.replace(/^.+\n/,""):"";try{s.stack?c&&!String(s.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+c):s.stack=c}catch{}}throw s}}_request(e,r){typeof e=="string"?(r=r||{}).url=e:r=e||{},r=j_(this.defaults,r);const{transitional:s,paramsSerializer:o,headers:c}=r;s!==void 0&&kA.assertOptions(s,{silentJSONParsing:wh.transitional(wh.boolean),forcedJSONParsing:wh.transitional(wh.boolean),clarifyTimeoutError:wh.transitional(wh.boolean)},!1),o!=null&&(dt.isFunction(o)?r.paramsSerializer={serialize:o}:kA.assertOptions(o,{encode:wh.function,serialize:wh.function},!0)),kA.assertOptions(r,{baseUrl:wh.spelling("baseURL"),withXsrfToken:wh.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let u=c&&dt.merge(c.common,c[r.method]);c&&dt.forEach(["delete","get","head","post","put","patch","common"],D=>{delete c[D]}),r.headers=wd.concat(u,c);const h=[];let m=!0;this.interceptors.request.forEach(function(D){typeof D.runWhen=="function"&&D.runWhen(r)===!1||(m=m&&D.synchronous,h.unshift(D.fulfilled,D.rejected))});const y=[];let E;this.interceptors.response.forEach(function(D){y.push(D.fulfilled,D.rejected)});let S,R=0;if(!m){const D=[Uz.bind(this),void 0];for(D.unshift.apply(D,h),D.push.apply(D,y),S=D.length,E=ht.resolve(r);R<S;)E=E.then(D[R++],D[R++]);return E}S=h.length;let P=r;for(R=0;R<S;){const D=h[R++],G=h[R++];try{P=D(P)}catch(j){G.call(this,j);break}}try{E=Uz.call(this,P)}catch(D){return ht.reject(D)}for(R=0,S=y.length;R<S;)E=E.then(y[R++],y[R++]);return E}getUri(e){return WB(Tz((e=j_(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};dt.forEach(["delete","get","head","options"],function(e){NA.prototype[e]=function(r,s){return this.request(j_(s||{},{method:e,url:r,data:(s||{}).data}))}}),dt.forEach(["post","put","patch"],function(e){function r(s){return function(o,c,u){return this.request(j_(u||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:o,data:c}))}}NA.prototype[e]=r(),NA.prototype[e+"Form"]=r(!0)});var DA=NA;class Mx{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let s;this.promise=new ht(function(c){s=c});const o=this;this.promise.then(c=>{if(!o._listeners)return;let u=o._listeners.length;for(;u-- >0;)o._listeners[u](c);o._listeners=null}),this.promise.then=c=>{let u;const h=new ht(m=>{o.subscribe(m),u=m}).then(c);return h.cancel=function(){o.unsubscribe(u)},h},r(function(c,u,h){o.reason||(o.reason=new Mv(c,u,h),s(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const s=this._listeners.indexOf(r);s!==-1&&this._listeners.splice(s,1)}toAbortSignal(){const r=new AbortController,s=o=>{r.abort(o)};return this.subscribe(s),r.signal.unsubscribe=()=>this.unsubscribe(s),r.signal}static source(){let r;return{token:new Mx(function(o){r=o}),cancel:r}}}var hfe=Mx;const Ux={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ux).forEach(e=>{let[r,s]=e;Ux[s]=r});var pfe=Ux;const lo=function e(r){const s=new DA(r),o=CB(DA.prototype.request,s);return dt.extend(o,DA.prototype,s,{allOwnKeys:!0}),dt.extend(o,s,null,{allOwnKeys:!0}),o.create=function(c){return e(j_(r,c))},o}(Rx);lo.Axios=DA,lo.CanceledError=Mv,lo.CancelToken=hfe,lo.isCancel=Ez,lo.VERSION=Vz,lo.toFormData=hA,lo.AxiosError=ar,lo.Cancel=lo.CanceledError,lo.all=function(e){return ht.all(e)},lo.spread=function(e){return function(r){return e.apply(null,r)}},lo.isAxiosError=function(e){return dt.isObject(e)&&e.isAxiosError===!0},lo.mergeConfig=j_,lo.AxiosHeaders=wd,lo.formToJSON=e=>_z(dt.isHTMLForm(e)?new FormData(e):e),lo.getAdapter=Mz.getAdapter,lo.HttpStatusCode=pfe,lo.default=lo;var _a=lo;const ffe=()=>{};function _T(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:ffe};return e.promise=new ht((r,s)=>{e.resolve=o=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,r(o),e.value=o)},e.reject=o=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,s(o))}}),e}const xA=new Map,LA=new Map,Ch=new Map;let Yi=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),Hn=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const Fz=new kue;let Cd=Fz.getResult(),Vx=null;function xn(e){if(!Vx){Cd=Fz.getResult();const r=function(m){if(m.engine.name==="Blink"&&m.browser.name!=="WeChat")return Hn.CHROME;switch(m.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Hn.CHROME;case"Safari":case"Mobile Safari":return Hn.SAFARI;case"Edge":return Hn.EDGE;case"Firefox":return Hn.FIREFOX;case"QQ":case"QQBrowser":return Hn.QQ;case"Opera":return Hn.OPERA;case"WeChat":return Hn.WECHAT;default:return m.browser.name||""}}(Cd),s=Bz(Cd),o=function(m){return m.os.name==="Windows"?m.os.version?m.os.name+" "+m.os.version:m.os.name:m.os.name||""}(Cd),c=Cd.os.version,u=Bz(Cd,!1),h=Cd.device.type;if(!(r&&s&&o&&c))return{name:r,version:s,os:o,osVersion:c,browserVersion:u,deviceType:h};Vx={name:r,version:s,os:o,osVersion:c,browserVersion:u,deviceType:h}}return Vx}function Bz(e){let r,s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",s?r.split(".")[0]:r}function MA(){return xn().os}function zz(){const e=xn();return"".concat(e.os," ").concat(e.osVersion)}function UA(){const e=xn();return!!(Cd.engine.name==="WebKit"&&e.os===Yi.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Hn.SAFARI||Ho()&&e.name!==Hn.SAFARI)}function of(){return xn().name===Hn.CHROME}function As(){return xn().name===Hn.SAFARI}function Wz(){return xn().name===Hn.EDGE}function Wr(){return xn().name===Hn.FIREFOX}function Ho(){return xn().os===Yi.IOS}function yT(e){const r=xn();return!(r.name!==Hn.CHROME||!r.osVersion)&&Number(r.version)>=e}function Gz(e){const r=xn();return!(r.name!==Hn.CHROME||!r.osVersion)&&Number(r.version)<e}function jx(e,r,s){const o=xn();return!(o.name!==e||!o.osVersion)&&(s?Number(o.version)>=r&&Number(o.version)<=s:Number(o.version)===r)}function Fx(e){const r=xn();return!(r.name!==Hn.EDGE||!r.osVersion)&&Number(r.version)>=e}function Hz(e){const r=xn();return!(r.name!==Hn.SAFARI||!r.osVersion)&&Number(r.version)>=e}function $z(e,r,s){const o=xn();if(o.os!==Yi.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return r&&Number(c[0])===e&&Number(c[1])<r||Number(c[0])<e}function Kz(e,r,s){const o=xn();if(o.name!==Hn.SAFARI||!o.osVersion||!o.browserVersion)return!1;const c=o.browserVersion.split(".");return s?r&&Number(c[0])===e&&Number(c[1])<r||Number(c[0])<e:r?Number(c[0])===e&&Number(c[1])<=r||Number(c[0])<e:Number(c[0])<=e}function Bx(e){const r=xn();return!(r.name!==Hn.OPERA||!r.osVersion)&&Number(r.version)>=e}function qz(){const e=xn();if(e.os!==Yi.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function Uv(){const e=xn();if(e.os!==Yi.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===15}function zx(){const e=xn();if(e.os!==Yi.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===16}function Yz(){const e=xn();if(e.os!==Yi.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function wu(){return As()&&navigator.maxTouchPoints>0}function Xz(){return xn().name===Hn.WECHAT}function Jz(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function Wx(){const e=MA();return function(){const{deviceType:r}=xn();return r==="mobile"||r==="tablet"}()||e===Yi.ANDROID||e===Yi.IOS||e===Yi.HARMONY_OS}function af(){const e=xn();return e.name!==Hn.EDGE&&e.name!==Hn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function VA(){return MA()===Yi.ANDROID}function ET(){const e=xn();return VA()&&(e.name===Hn.CHROME||e.name===Hn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Qz(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function St(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Qz(Object(s),!0).forEach(function(o){Qt(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Qz(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}function Qt(e,r,s){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var y=m.call(u,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}let te=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Le=class extends Error{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;super(r),Qt(this,"code",void 0),Qt(this,"message",void 0),Qt(this,"data",void 0),Qt(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=s}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return e==="error"&&(r||console).error(this.toString()),e==="warning"&&(r||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function cf(e,r){if(typeof e!="boolean")throw new Le(te.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function Wi(e,r,s){if(!ct(s).call(s,e))throw new Le(te.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(s)))}function cr(e,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<s||e>o||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(c){return typeof c=="number"&&c%1==0}(e))throw new Le(te.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(s,", ").concat(o,"]. integer only"))}function Gx(e,r){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Le(te.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));e.min!==void 0&&cr(e.min,"".concat(r,".min"),0,1/0),e.max!==void 0&&cr(e.max,"".concat(r,".max"),1,1/0),e.exact!==void 0&&cr(e.exact,"".concat(r,".exact"),1,1/0),e.ideal!==void 0&&cr(e.ideal,"".concat(r,".ideal"),1,1/0)}else cr(e,r,1,1/0)}function hs(e,r){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,c=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Le(te.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!Zz(e,s,o,c))throw new Le(te.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(s,",").concat(o,"].").concat(c?" ASCII characters only.":""))}function lf(e,r){if(!Array.isArray(e))throw new Le(te.INVALID_PARAMS,"".concat(r," should be an array"))}function Gr(e){return e==null}function Zz(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=s&&e.length>=r&&(!o||function(c){if(typeof c!="string")return!1;for(let u=0;u<c.length;u+=1){const h=c.charCodeAt(u);if(h<0||h>255)return!1}return!0}(e))}var vT=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(vT||{}),Hx=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(Hx||{});const eW=new class{constructor(){Qt(this,"_clientSize",null),Qt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Qt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Qt(this,"getStyle",e=>window.getComputedStyle(e,null)),Qt(this,"checkCssVisibleProperty",e=>{var r;let s=!0;const o=this.getStyle(e),{display:c,visibility:u,opacity:h,filter:m}=o;return(c==="none"||ct(r=["hidden","collapse"]).call(r,u)||Number(h)<.1)&&(s=!1),!!s&&(m&&m.split(" ").filter(y=>{var E;const S=y.split("(")[0];return ct(E=["brightness","blur","opacity"]).call(E,S)}).map(y=>{const[E,S]=y.split(/\(|\)/);return[E,Number(S.match(/^[0-9\.]+/))]}).forEach(y=>{const[E,S]=y;switch(E){case"brightness":(S<.1||S>3)&&(s=!1);break;case"blur":S>3&&(s=!1);break;case"opacity":S<.1&&(s=!1)}}),s)}),Qt(this,"checkPropertyUpToAllParentNodes",(e,r)=>{let s=!0,o=!0;const c=h=>r(h);let u=e;for(;u&&o;)c(u)||(s=!1,o=!1),u=u.parentElement,u||(o=!1);return s}),Qt(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),Qt(this,"getSizeAboutClient",e=>{const{width:r,height:s,left:o,right:c,top:u,bottom:h}=e.getBoundingClientRect(),m=this.getClientWidth(),y=this.getClientHeight();return{width:r,height:s,left:o,right:c,top:u,bottom:h,clientWidth:m,clientHeight:y,clientMin:Math.min(m,y)}}),Qt(this,"checkActualSize",()=>{const{width:e,height:r,clientMin:s}=this._clientSize;return this.checkSizeIsVisible(e,r,s)}),Qt(this,"elementFromPoint",(e,r)=>document.elementFromPoint?document.elementFromPoint(e,r):null),Qt(this,"checkCoverForAPoint",(e,r,s)=>{const o=this.elementFromPoint(e,r);return o!==null&&o!==s}),Qt(this,"getPointPositionList",()=>{const{width:e,height:r,left:s,top:o}=this._clientSize,c=e/6,u=r/6,h=[],m=10**6;for(let y=0;y<5;y++)for(let E=0;E<5;E++){const S=(s*m+(y===0?.1:y===4?(c*y*m-1e5)/m:c*y)*m)/m,R=(o*m+(E===0?.1:E===4?(u*E*m-1e5)/m:u*E)*m)/m;h.push({x:S,y:R})}return[...h]}),Qt(this,"checkElementCover",e=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,e)).filter(r=>!!r).length>6),Qt(this,"checkSizeIsVisible",(e,r,s)=>(e>50||s/e<=10)&&(r>50||s/r<=10)),Qt(this,"checkSizeOfPartInClient",()=>{const{left:e,right:r,top:s,bottom:o,clientHeight:c,clientWidth:u,clientMin:h}=this._clientSize;let m,y,E,S;if(e<0)m=0;else{if(!(e<u))return!1;m=e}if(r<0)return!1;if(y=r<u?r:u,s<0)E=0;else{if(!(s<c))return!1;E=s}if(o<0)return!1;S=o<c?o:c;const R=y-m,P=S-E;return this.checkSizeIsVisible(R,P,h)}),Qt(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),Qt(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(vT.COVERED);{const r=this.checkActualSize(),s=this.checkSizeOfPartInClient();return r&&!s?this.returnHiddenResult(vT.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(vT.SIZE)}}return this.returnHiddenResult(vT.STYLE)}return this.returnHiddenResult(Hx.UNMOUNTED)}return this.returnHiddenResult(Hx.INVALID_HTML_ELEMENT)}),Qt(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function $x(e){return new TextEncoder().encode(e)}const tW=function(e,r){const s=new Uint8Array(e.byteLength+r.byteLength);return s.set(new Uint8Array(e),0),s.set(new Uint8Array(r),e.byteLength),s},Kx=async e=>function(r,s){let o="";return new Uint8Array(r).forEach(c=>{o+=c.toString(s).padStart(2,"0")}),o}(await crypto.subtle.digest("SHA-256",$x(e)),16);let jr=class{constructor(){Qt(this,"_events",{}),Qt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(r=>r.listener):[]}on(e,r){this._events[e]||(this._events[e]=[]);const s=this._events[e];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!1})}once(e,r){this._events[e]||(this._events[e]=[]);const s=this._events[e];this._indexOfListener(s,r)===-1&&s.push({listener:r,once:!0})}off(e,r){if(!this._events[e])return;const s=this._events[e],o=this._indexOfListener(s,r);o!==-1&&s.splice(o,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const r=this._events[e].map(u=>u);for(var s=arguments.length,o=new Array(s>1?s-1:0),c=1;c<s;c++)o[c-1]=arguments[c];for(let u=0;u<r.length;u+=1){const h=r[u];h.once&&this.off(e,h.listener),h.listener.apply(this,o||[])}}safeEmit(e){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];[...this._events[e]||[]].forEach(c=>{c.once&&this.off(e,c.listener);try{c.listener.apply(this,s)}catch(u){console.error("safeEmit event:".concat(e," error ").concat(u==null?void 0:u.toString()))}})}_indexOfListener(e,r){let s=e.length;for(;s--;)if(e[s].listener===r)return s;return-1}},ST=null;function nW(){if(ST)return ST;if(window.electron)return ST=window.electron;if(!window.require)return null;try{return ST=window.require("electron"),ST}catch{return null}}let Ai=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),Hr=function(e){return e.TRACER="tracer",e}({});function rW(e){return cr(e.timeout,"config.timeout",0,1e5),cr(e.timeoutFactor,"config.timeoutFactor",0,100,!1),cr(e.maxRetryCount,"config.maxRetryConfig",0,1/0),cr(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let mfe=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),Yn=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function bT(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function iW(e){return hs(e.turnServerURL,"turnServerURL"),hs(e.username,"username"),hs(e.password,"password"),e.udpport&&cr(e.udpport,"udpport",1,99999,!0),e.forceturn&&cf(e.forceturn,"forceturn"),e.security&&cf(e.security,"security"),e.tcpport&&cr(e.tcpport,"tcpport",1,99999,!0),!0}function qx(e){return e.level!==void 0&&Wi(e.level,"level",[1,2,3]),e.delay!==void 0&&cr(e.delay,"delay",0,3e3,!0),!0}let Tn=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),Ps=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),Tc=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Vv=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function Os(e,r){for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return e.getListeners(r).length===0?ht.reject(new Le(te.UNEXPECTED_ERROR,"can not emit promise")):new ht((u,h)=>{e.emit(r,...o,u,h)})}function hr(e,r){if(e.getListeners(r).length===0)return ht.resolve();for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return Os(e,r,...o)}function Qc(e,r){if(e.getListeners(r).length===0)return null;for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];return TT(e,r,...o)}function TT(e,r){let s=null,o=null;for(var c=arguments.length,u=new Array(c>2?c-2:0),h=2;h<c;h++)u[h-2]=arguments[h];if(e.emit(r,...u,m=>{s=m},m=>{o=m}),o!==null)throw o;if(s===null)throw new Le(te.UNEXPECTED_ERROR,"handler is not sync");return s}const yi=new class extends jr{set networkState(e){this.emit(Vv.NETWORK_STATE_CHANGE,e,this._networkState),e===Tc.ONLINE?this.emit(Vv.ONLINE):e===Tc.OFFLINE&&(this.onlineWaiter=new ht(r=>{this.once(Vv.ONLINE,()=>{this.onlineWaiter=void 0,r(Tc.ONLINE)})}),this.emit(Vv.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===Tc.ONLINE}constructor(){super(),Qt(this,"_moduleName","network-indicator"),Qt(this,"_networkState",Tc.ONLINE),Qt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Tc.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Tc.OFFLINE})}};function jA(e,r){const s=e.indexOf(r);s!==-1&&e.splice(s,1)}function jv(e){const r=[];return e.forEach(s=>{r.indexOf(s)===-1&&r.push(s)}),r}function FA(e){ht!==void 0?ht.resolve().then(e):setTimeout(e,0)}function $r(e){return JSON.parse(JSON.stringify(e))}function F_(e){try{return $r(e)}catch{return e}}const sW={};function zm(e,r){sW[r]||(sW[r]=!0,e())}function B_(e){const r=window.atob(e),s=new Uint8Array(new ArrayBuffer(r.length));for(let o=0;o<r.length;o+=1)s[o]=r.charCodeAt(o);return s}function Wm(e){let r="";for(let s=0;s<e.length;s+=1)r+=String.fromCharCode(e[s]);return window.btoa(r)}function oW(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,s=new TextEncoder().encode(e);if(s.length>r)s=s.slice(0,r);else if(s.length<r){const o=new Uint8Array(r);o.set(s),s=o}return s}function aW(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];const o=gc(r).call(r,(h,m)=>h+m.length,0),c=new Uint8Array(new ArrayBuffer(o));let u=0;return r.forEach(h=>{c.set(h,u),u+=h.length}),c}function Rh(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function cW(e){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(s=>{r+=typeof s=="string"?Rh(s):s.size}),r+138}function gfe(e){const r=new Le(te.TIMEOUT,"timeout");return new ht((s,o)=>{window.setTimeout(()=>o(r),e)})}function ps(e){return new ht(r=>{window.setTimeout(r,e)})}function pr(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const s=Math.random().toString(16).substr(2,e).toLowerCase();return s.length===e?"".concat(r).concat(s):"".concat(r).concat(s)+pr(e-s.length,"")}function z_(){return pr(32,"").toUpperCase()}const BA=()=>{},lW=new class{constructor(){Qt(this,"fnMap",new Map)}throttleByKey(e,r,s,o){for(var c=arguments.length,u=new Array(c>4?c-4:0),h=4;h<c;h++)u[h-4]=arguments[h];if(this.fnMap.has(r)){const m=this.fnMap.get(r);if(m.threshold!==s){m.fn(...m.args),clearTimeout(m.timer);const y=window.setTimeout(()=>{const E=this.fnMap.get(r);E&&E.fn(...E.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:e,threshold:s,timer:y,args:u,skipFn:o})}else m.skipFn&&m.skipFn(...m.args),this.fnMap.set(r,St(St({},m),{},{fn:e,args:u,skipFn:o}))}else{const m=window.setTimeout(()=>{const y=this.fnMap.get(r);y&&y.fn(...y.args),this.fnMap.delete(r)},s);this.fnMap.set(r,{fn:e,threshold:s,timer:m,args:u,skipFn:o})}}},uW=lW.throttleByKey.bind(lW);function dW(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function Yx(e,r){if(!dW(e)||!dW(r)||Array.isArray(e)&&!Array.isArray(r)||!Array.isArray(e)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(e)){const s=[...e];for(let o=0;o<r.length;o++)s[o]=Yx(e[o],r[o]);return s}{const s=St({},e);for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&(Object.prototype.hasOwnProperty.call(e,o)?s[o]=Yx(e[o],r[o]):s[o]=r[o]);return s}}function hW(e,r){let s=[0];if(s=new Array(r).fill(0),e===0)return s;let o=0;for(;e>0&&(s[o]=255&e,e>>=8,o++,o!==r););return s}function Xx(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function pW(e){const r="0123456789abcdef";function s(fe){let ye,Ee="";for(ye=0;ye<=3;ye++)Ee+=r.charAt(fe>>8*ye+4&15)+r.charAt(fe>>8*ye&15);return Ee}function o(fe,ye){const Ee=(65535&fe)+(65535&ye);return(fe>>16)+(ye>>16)+(Ee>>16)<<16|65535&Ee}function c(fe,ye,Ee,_e,Ne,Ze){return o(function(pt,yt){return pt<<yt|pt>>>32-yt}(o(o(ye,fe),o(_e,Ze)),Ne),Ee)}function u(fe,ye,Ee,_e,Ne,Ze,pt){return c(ye&Ee|~ye&_e,fe,ye,Ne,Ze,pt)}function h(fe,ye,Ee,_e,Ne,Ze,pt){return c(ye&_e|Ee&~_e,fe,ye,Ne,Ze,pt)}function m(fe,ye,Ee,_e,Ne,Ze,pt){return c(ye^Ee^_e,fe,ye,Ne,Ze,pt)}function y(fe,ye,Ee,_e,Ne,Ze,pt){return c(Ee^(ye|~_e),fe,ye,Ne,Ze,pt)}const E=function(fe){let ye;const Ee=1+(fe.length+8>>6),_e=new Array(16*Ee);for(ye=0;ye<16*Ee;ye++)_e[ye]=0;for(ye=0;ye<fe.length;ye++)_e[ye>>2]|=fe.charCodeAt(ye)<<ye%4*8;return _e[ye>>2]|=128<<ye%4*8,_e[16*Ee-2]=8*fe.length,_e}(e);let S,R,P,D,G,j=1732584193,B=-271733879,Y=-1732584194,ee=271733878;for(S=0;S<E.length;S+=16)R=j,P=B,D=Y,G=ee,j=u(j,B,Y,ee,E[S+0],7,-680876936),ee=u(ee,j,B,Y,E[S+1],12,-389564586),Y=u(Y,ee,j,B,E[S+2],17,606105819),B=u(B,Y,ee,j,E[S+3],22,-1044525330),j=u(j,B,Y,ee,E[S+4],7,-176418897),ee=u(ee,j,B,Y,E[S+5],12,1200080426),Y=u(Y,ee,j,B,E[S+6],17,-1473231341),B=u(B,Y,ee,j,E[S+7],22,-45705983),j=u(j,B,Y,ee,E[S+8],7,1770035416),ee=u(ee,j,B,Y,E[S+9],12,-1958414417),Y=u(Y,ee,j,B,E[S+10],17,-42063),B=u(B,Y,ee,j,E[S+11],22,-1990404162),j=u(j,B,Y,ee,E[S+12],7,1804603682),ee=u(ee,j,B,Y,E[S+13],12,-40341101),Y=u(Y,ee,j,B,E[S+14],17,-1502002290),B=u(B,Y,ee,j,E[S+15],22,1236535329),j=h(j,B,Y,ee,E[S+1],5,-165796510),ee=h(ee,j,B,Y,E[S+6],9,-1069501632),Y=h(Y,ee,j,B,E[S+11],14,643717713),B=h(B,Y,ee,j,E[S+0],20,-373897302),j=h(j,B,Y,ee,E[S+5],5,-701558691),ee=h(ee,j,B,Y,E[S+10],9,38016083),Y=h(Y,ee,j,B,E[S+15],14,-660478335),B=h(B,Y,ee,j,E[S+4],20,-405537848),j=h(j,B,Y,ee,E[S+9],5,568446438),ee=h(ee,j,B,Y,E[S+14],9,-1019803690),Y=h(Y,ee,j,B,E[S+3],14,-187363961),B=h(B,Y,ee,j,E[S+8],20,1163531501),j=h(j,B,Y,ee,E[S+13],5,-1444681467),ee=h(ee,j,B,Y,E[S+2],9,-51403784),Y=h(Y,ee,j,B,E[S+7],14,1735328473),B=h(B,Y,ee,j,E[S+12],20,-1926607734),j=m(j,B,Y,ee,E[S+5],4,-378558),ee=m(ee,j,B,Y,E[S+8],11,-2022574463),Y=m(Y,ee,j,B,E[S+11],16,1839030562),B=m(B,Y,ee,j,E[S+14],23,-35309556),j=m(j,B,Y,ee,E[S+1],4,-1530992060),ee=m(ee,j,B,Y,E[S+4],11,1272893353),Y=m(Y,ee,j,B,E[S+7],16,-155497632),B=m(B,Y,ee,j,E[S+10],23,-1094730640),j=m(j,B,Y,ee,E[S+13],4,681279174),ee=m(ee,j,B,Y,E[S+0],11,-358537222),Y=m(Y,ee,j,B,E[S+3],16,-722521979),B=m(B,Y,ee,j,E[S+6],23,76029189),j=m(j,B,Y,ee,E[S+9],4,-640364487),ee=m(ee,j,B,Y,E[S+12],11,-421815835),Y=m(Y,ee,j,B,E[S+15],16,530742520),B=m(B,Y,ee,j,E[S+2],23,-995338651),j=y(j,B,Y,ee,E[S+0],6,-198630844),ee=y(ee,j,B,Y,E[S+7],10,1126891415),Y=y(Y,ee,j,B,E[S+14],15,-1416354905),B=y(B,Y,ee,j,E[S+5],21,-57434055),j=y(j,B,Y,ee,E[S+12],6,1700485571),ee=y(ee,j,B,Y,E[S+3],10,-1894986606),Y=y(Y,ee,j,B,E[S+10],15,-1051523),B=y(B,Y,ee,j,E[S+1],21,-2054922799),j=y(j,B,Y,ee,E[S+8],6,1873313359),ee=y(ee,j,B,Y,E[S+15],10,-30611744),Y=y(Y,ee,j,B,E[S+6],15,-1560198380),B=y(B,Y,ee,j,E[S+13],21,1309151649),j=y(j,B,Y,ee,E[S+4],6,-145523070),ee=y(ee,j,B,Y,E[S+11],10,-1120210379),Y=y(Y,ee,j,B,E[S+2],15,718787259),B=y(B,Y,ee,j,E[S+9],21,-343485551),j=o(j,R),B=o(B,P),Y=o(Y,D),ee=o(ee,G);return s(j)+s(B)+s(Y)+s(ee)}let _fe=1,fW=console,qs=class{static setLogger(e){fW=e}constructor(e,r){Qt(this,"id",void 0),Qt(this,"lockingPromise",ht.resolve()),Qt(this,"locks",0),Qt(this,"name",""),Qt(this,"lockId",void 0),this.lockId=_fe++,e&&(this.name=e),r&&(this.id=r),this.logger("created")}logger(e,r){const s=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),o=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(r??"");fW.debug("".concat(s," ").concat(o))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let r;this.locks+=1,this.logger("locked",e);const s=new ht(c=>{r=()=>{this.locks-=1,this.logger("unlocked",e),c()}}),o=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>s),o}};function Fv(e,r){return function(s,o,c){const u=c.value;if(typeof u!="function")throw new Error("Cannot use mutex on object property.");return c.value=async function(){const h=this[r];if(!h)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(e));const m=await h.lock("From ".concat(e,".").concat(o));try{for(var y=arguments.length,E=new Array(y),S=0;S<y;S++)E[S]=arguments[S];return await u.apply(this,E)}finally{m()}},c}}const Pi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Jx(e,r){const s=Math.floor(r.timeout*Math.pow(r.timeoutFactor,e));return Math.min(r.maxRetryTimeout,s)}function Rd(e,r,s,o){const c=Object.assign({},Pi,o);let u=c.timeout;const h=async()=>{await function(E){return new ht(S=>{window.setTimeout(S,E)})}(u),u*=c.timeoutFactor,u=Math.min(c.maxRetryTimeout,u)};let m=!1;const y=new ht(async(E,S)=>{r=r||(()=>!1),s=s||(()=>!0);for(let R=0;R<c.maxRetryCount;R+=1){if(m)return S(new Le(te.OPERATION_ABORTED));try{const P=await e();if(!r(P,R)||R+1===c.maxRetryCount)return E(P);await h()}catch(P){if(!s(P,R)||R+1===c.maxRetryCount)return S(P);await h()}}});return y.cancel=()=>m=!0,y}let zA,mW=class{constructor(e){Qt(this,"input",[]),Qt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:gc(e=this.input).call(e,(r,s)=>r+s)/this.input.length}},WA=0,Qx=0;function Zx(e,r,s,o){return new ht((c,u)=>{r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),WA+=Rh(r.data)):s&&(r.data.size?WA+=r.data.size:r.data instanceof FormData?WA+=cW(r.data):WA+=Rh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,_a.request(r).then(h=>{typeof h.data=="string"?Qx+=Rh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?Qx+=h.data.byteLength:Qx+=Rh(JSON.stringify(h.data)),c(h.data)}).catch(h=>{_a.isCancel(h)?u(new Le(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Le(te.NETWORK_TIMEOUT,h.message)):h.response?u(new Le(te.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Le(te.NETWORK_ERROR,h.message))})})}async function yfe(e,r){const s=new Blob([r.data],{type:"buffer"});return await Zx(e,St(St({},r),{},{data:s,headers:{"Content-Type":"application/octet-stream"}}),!0)}const gW=()=>window.isSecureContext!==void 0;function Cu(e){if(Array.isArray(e))return e.map(s=>s);if(!_W(e))return e;const r={};for(const s in e){const o=e[s];_W(o)||Array.isArray(o)?r[s]=Cu(o):r[s]=o}return r}function _W(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let eL=class{constructor(e){Qt(this,"input",[]),Qt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Ih={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},wT={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Ih,remoteCandidate:Ih},updateInterval:0},yW={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},EW={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},vW={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},SW={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0};let tL=class{constructor(e,r){Qt(this,"onFirstVideoReceived",void 0),Qt(this,"onFirstVideoDecoded",void 0),Qt(this,"onFirstAudioReceived",void 0),Qt(this,"onFirstVideoDecodedTimeout",void 0),Qt(this,"onFirstAudioDecoded",void 0),Qt(this,"onSelectedLocalCandidateChanged",void 0),Qt(this,"onSelectedRemoteCandidateChanged",void 0),Qt(this,"videoIsReady",!1),Qt(this,"videoIsReady2",{}),Qt(this,"pc",void 0),Qt(this,"options",void 0),Qt(this,"intervalTimer",void 0),Qt(this,"stats",Cu(wT)),Qt(this,"isFirstVideoReceived",{}),Qt(this,"isFirstVideoDecoded",{}),Qt(this,"isFirstAudioReceived",{}),Qt(this,"isFirstAudioDecoded",{}),Qt(this,"isFirstVideoDecodedTimeout",{}),Qt(this,"lossRateWindowStats",[]),this.pc=e,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ht(e=>{e({local:St({},Ih),remote:St({},Ih)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,r){this.videoIsReady2[e]=r}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,s=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,c=0,u=0,h=0;for(const m of s)e[m].forEach((y,E)=>{if(!this.lossRateWindowStats[r-1][m][E]||!this.lossRateWindowStats[0][m][E])return;const S=this.lossRateWindowStats[r-1][m][E].packets-this.lossRateWindowStats[0][m][E].packets,R=this.lossRateWindowStats[r-1][m][E].packetsLost-this.lossRateWindowStats[0][m][E].packetsLost;m==="videoSend"||m==="audioSend"?(o+=S,u+=R):(c+=S,h+=R),Number.isNaN(S)||Number.isNaN(S)?y.packetLostRate=0:y.packetLostRate=S<=0||R<=0?0:R/(S+R)});e.sendPacketLossRate=o<=0||u<=0?0:u/(o+u),e.recvPacketLossRate=c<=0||h<=0?0:h/(c+h)}},Efe=class extends tL{constructor(){super(...arguments),Qt(this,"_stats",wT),Qt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),r=this.statsResponsesToObjects(e);this._stats=Cu(wT);const s=r.filter(c=>c.type==="ssrc");this.processSSRCStats(s);const o=r.find(c=>c.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(r=>{var s;const o=ct(s=r.id).call(s,"send");switch("".concat(r.mediaType,"_").concat(o?"send":"recv")){case"video_send":{const c=Cu(EW);c.codec=r.googCodecName,c.adaptionChangeReason="none",r.googCpuLimitedResolution&&(c.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(c.adaptionChangeReason="bandwidth"),c.avgEncodeMs=Number(r.googAvgEncodeMs),c.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},c.firsCount=Number(r.googFirReceived),c.nacksCount=Number(r.googNacksReceived),c.plisCount=Number(r.googPlisReceived),c.frameCount=Number(r.framesEncoded),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(c),this._stats.rtt=c.rttMs;break}case"video_recv":{const c=Cu(yW),u=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(c.codec=r.googCodecName,c.targetDelayMs=Number(r.googTargetDelayMs),c.renderDelayMs=Number(r.googRenderDelayMs),c.currentDelayMs=Number(r.googCurrentDelayMs),c.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),c.decodeMs=Number(r.googDecodeMs),c.maxDecodeMs=Number(r.googMaxDecodeMs),c.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},c.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},c.decodeFrameRate=Number(r.googFrameRateDecoded),c.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},c.jitterBufferMs=Number(r.googJitterBufferMs),c.firsCount=Number(r.googFirsSent),c.nacksCount=Number(r.googNacksSent),c.plisCount=Number(r.googPlisSent),c.framesDecodeCount=Number(r.framesDecoded),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.packets>0&&!this.isFirstVideoReceived[c.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(c.ssrc),this.isFirstVideoReceived[c.ssrc]=!0),c.framesDecodeCount>0&&!this.isFirstVideoDecoded[c.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(c.ssrc,c.decodedFrame.width,c.decodedFrame.height),this.isFirstVideoDecoded[c.ssrc]=!0),u){const h=u.stats,m=Date.now()-u.lts;c.framesDecodeFreezeTime=h.framesDecodeFreezeTime,c.framesDecodeInterval=h.framesDecodeInterval,c.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[c.ssrc]?(u.lts=Date.now(),c.framesDecodeInterval=m,c.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?c.framesDecodeFreezeTime+=c.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):c.framesDecodeCount<u.stats.framesDecodeCount&&(c.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(c.ssrc,{stats:St({},c),lts:Date.now()}),this._stats.videoRecv.push(c);break}case"audio_recv":{const c=Cu(SW);c.codec=r.googCodecName,c.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,c.decodingCNG=Number(r.googDecodingCNG),c.decodingCTN=Number(r.googDecodingCTN),c.decodingCTSG=Number(r.googDecodingCTSG),c.decodingNormal=Number(r.googDecodingNormal),c.decodingPLC=Number(r.googDecodingPLC),c.decodingPLCCNG=Number(r.googDecodingPLCCNG),c.expandRate=Number(r.googExpandRate),c.accelerateRate=Number(r.googAccelerateRate),c.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),c.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),c.speechExpandRate=Number(r.googSpeechExpandRate),c.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),c.jitterBufferMs=Number(r.googJitterBufferMs),c.jitterMs=Number(r.googJitterReceived),c.bytes=Number(r.bytesReceived),c.packets=Number(r.packetsReceived),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),c.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),c.receivedFrames>0&&!this.isFirstAudioReceived[c.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(c.ssrc),this.isFirstAudioReceived[c.ssrc]=!0),c.decodingNormal>0&&!this.isFirstAudioDecoded[c.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(c.ssrc),this.isFirstAudioDecoded[c.ssrc]=!0),this._stats.audioRecv.push(c);break}case"audio_send":{const c=Cu(vW);c.codec=r.googCodecName,c.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,c.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),c.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),c.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),c.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),c.bytes=Number(r.bytesSent),c.packets=Number(r.packetsSent),c.packetsLost=Number(r.packetsLost),c.ssrc=Number(r.ssrc),c.rttMs=Number(r.googRtt||0),this._stats.rtt=c.rttMs,this._stats.audioSend.push(c);break}}})}_getStats(){return new ht((e,r)=>{this.pc.getStats(e,r)})}statsResponsesToObjects(e){const r=[];return e.result().forEach(s=>{const o={id:s.id,timestamp:s.timestamp.valueOf().toString(),type:s.type};s.names().forEach(c=>{o[c]=s.stat(c)}),r.push(o)}),r}},CT=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),GA=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),nL=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),Zc=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var Bv=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(Bv||{});function RT(e,r,s,o){let c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Bv.kNone;if(!r)return;const u=Number(r[s]);if(typeof u!="number")return;const h=Number(r[o]);if(typeof h!="number")return;if(!e)return h?u/h*c:void 0;const m=Number(e[s]);if(typeof m!="number")return;const y=Number(e[o]);if(typeof y!="number")return;const E=h-y;return E?(u-m)/E*c:void 0}let bW=class extends tL{constructor(){super(...arguments),Qt(this,"_stats",wT),Qt(this,"report",void 0),Qt(this,"lastDecodeVideoReceiverStats",new Map),Qt(this,"lastVideoFramesRecv",new Map),Qt(this,"lastVideoFramesSent",new Map),Qt(this,"lastVideoFramesDecode",new Map),Qt(this,"lastVideoFramesOutput",new Map),Qt(this,"lastVideoJBDelay",new Map),Qt(this,"lastAudioJBDelay",new Map),Qt(this,"mediaBytesSent",new Map),Qt(this,"mediaBytesRetransmit",new Map),Qt(this,"mediaBytesTargetEncode",new Map),Qt(this,"lastDecodeAudioReceiverStats",new Map),Qt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Cu(wT),this.report.forEach(e=>{switch(e.type){case Zc.OUTBOUND:case Zc.INBOUND:{const r=e.mediaType||e.kind,s=!r&&"frameWidth"in e,o=!r&&!("frameWidth"in e);e.type===Zc.OUTBOUND?r==="audio"||o?this.processAudioOutboundStats(e):(r==="video"||s)&&this.processVideoOutboundStats(e):e.type===Zc.INBOUND&&(r==="audio"||o?this.processAudioInboundStats(e):(r==="video"||s)&&this.processVideoInboundStats(e));break}case Zc.TRANSPORT:{const r=this.report.get(e.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case Zc.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),r={local:St({},Ih),remote:St({},Ih)};return e.forEach(s=>{let o;if(s.type===Zc.TRANSPORT&&(o=e.get(s.selectedCandidatePairId)),s.type===Zc.CANDIDATE_PAIR&&s.selected&&(o=s),o){const c=(u,h)=>{u.type=h.type,u.id=h.id,h.address&&(u.address=h.address),h.candidateType&&(u.candidateType=h.candidateType),h.port&&(u.port=h.port),h.priority&&(u.priority=h.priority),h.protocol&&(u.protocol=h.protocol),h.relayProtocol&&(u.relayProtocol=h.relayProtocol)};if(o.localCandidateId){const u=e.get(o.localCandidateId);u&&c(r.local,u)}if(o.remoteCandidateId){const u=e.get(o.remoteCandidateId);u&&c(r.remote,u)}}}),r}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(r=>{e.currentRoundTripTime&&(r.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{e.currentRoundTripTime&&(r.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const r=this.report.get(e.localCandidateId);r&&this.processCandidateStats(r)}if(e.remoteCandidateId){const r=this.report.get(e.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(e){let r;e.type===Zc.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),e.type===Zc.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=e.type,r.id=e.id,e.address&&(r.address=e.address),e.candidateType&&(r.candidateType=e.candidateType),e.port&&(r.port=e.port),e.priority&&(r.priority=e.priority),e.protocol&&(r.protocol=e.protocol),e.relayProtocol&&(r.relayProtocol=e.relayProtocol),e.type===Zc.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(St({},r),St({},this.stats.selectedCandidatePair.localCandidate)),e.type===Zc.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(St({},r),St({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let r=this._stats.audioRecv.find(o=>o.ssrc===e.ssrc);r||(r=Cu(SW),this._stats.audioRecv.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsReceived,r.packetsLost=e.packetsLost,r.packetsDiscarded=e.packetsDiscarded,r.bytes=e.bytesReceived,r.jitterMs=1e3*e.jitter,r.retransmittedBytesReceived=e.retransmittedBytesReceived,r.retransmittedPacketsReceived=e.retransmittedPacketsReceived,r.totalProcessingDelay=e.totalProcessingDelay,r.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const s=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=RT(s,r,"totalProcessingDelay","jitterBufferEmittedCount",Bv.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),r.receivedFrames||(r.receivedFrames=e.packetsReceived),r.droppedFrames||(r.droppedFrames=e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof e.concealedSamples=="number"&&(r.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,St({},r))}processVideoInboundStats(e){let r=this._stats.videoRecv.find(h=>h.ssrc===e.ssrc);r||(r=Cu(yW),this._stats.videoRecv.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsReceived,r.packetsLost=e.packetsLost,r.bytes=e.bytesReceived,r.firsCount=e.firCount,r.nacksCount=e.nackCount,r.plisCount=e.pliCount,r.framesDecodeCount=e.framesDecoded,r.framesDroppedCount=e.framesDropped,r.totalInterFrameDelay=e.totalInterFrameDelay,r.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,r.totalFreezesDuration=e.totalFreezesDuration,r.totalProcessingDelay=e.totalProcessingDelay,r.packetsDiscarded=e.packetsDiscarded,r.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,r.totalAssemblyTime=e.totalAssemblyTime,r.keyFramesDecoded=e.keyFramesDecoded,r.retransmittedBytesReceived=e.retransmittedBytesReceived,r.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const s=this.lastDecodeVideoReceiverStats.get(r.ssrc),o=this.lastVideoFramesDecode.get(r.ssrc),c=this.lastVideoFramesOutput.get(r.ssrc),u=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const h=r.decodedFrame?r.decodedFrame.width:0,m=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,h,m),this.isFirstVideoDecoded[r.ssrc]=!0}if(s){const h=s.stats,m=u-s.lts;r.framesDecodeFreezeTime=h.framesDecodeFreezeTime,r.framesDecodeInterval=h.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&m>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>h.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(s.lts=Date.now(),r.framesDecodeInterval=m,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<h.framesDecodeCount&&(r.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(s.stats.framesDecodeCount>e.framesDecoded?r.qpSumPerFrame=e.qpSum/e.framesDecoded:r.qpSumPerFrame=(e.qpSum-s.qpSum)/(e.framesDecoded-s.stats.framesDecodeCount))}e.totalDecodeTime&&(r.decodeMs=1e3*e.totalDecodeTime,r.avgDecodeMs=RT(s==null?void 0:s.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=RT(s==null?void 0:s.stats,r,"totalProcessingDelay","framesDecodeCount",Bv.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=RT(s==null?void 0:s.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",Bv.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=RT(s==null?void 0:s.stats,r,"totalInterFrameDelay","framesDecodeCount",Bv.kMillisecondsFromSeconds),o&&u-o.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-o.count)/((u-o.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:r.decodeFrameRate})):o?r.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:u,rate:0}),r.framesDroppedCount&&e.framesReceived&&(c&&u-c.lts>=800?(r.outputFrameRate=Math.round((e.framesReceived-r.framesDroppedCount-c.count)/((u-c.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:e.framesReceived-r.framesDroppedCount,lts:u,rate:Math.max(r.outputFrameRate,0)})):c?r.outputFrameRate=c.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:e.framesReceived-r.framesDroppedCount,lts:u,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(r.framesRateFirefox=e.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:St({},r),lts:s?s.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let r=this._stats.videoSend.find(o=>o.ssrc===e.ssrc);r||(r=Cu(EW),this._stats.videoSend.push(r));const s=this.mediaBytesSent.get(e.ssrc);if(s)s.add(e.bytesSent);else{const o=new eL(10);o.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,o)}if(e.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(e.ssrc);if(o)o.add(e.retransmittedBytesSent);else{const c=new eL(10);c.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,c)}}if(e.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(e.ssrc);if(o)o.add(e.totalEncodedBytesTarget);else{const c=new eL(10);c.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,c)}}if(r.ssrc=e.ssrc,r.bytes=e.bytesSent,r.packets=e.packetsSent,r.firsCount=e.firCount,r.nacksCount=e.nackCount,r.plisCount=e.pliCount,r.frameCount=e.framesEncoded,r.adaptionChangeReason=e.qualityLimitationReason,r.scalabilityMode=e.scalabilityMode,r.retransmittedBytesSent=e.retransmittedBytesSent,r.retransmittedPacketsSent=e.retransmittedPacketsSent,r.hugeFramesSent=e.hugeFramesSent,r.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){const o=this.lastEncoderMs.get(e.ssrc);if(!o||o.lastFrameCount>e.framesEncoded)r.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const c=e.framesEncoded-o.lastFrameCount,u=e.totalEncodeTime-o.lastEncoderTime;r.avgEncodeMs=1e3*u/c}}if(e.framesEncoded&&e.qpSum){const o=this.lastEncoderMs.get(e.ssrc);!o||o.lastFrameCount>e.framesEncoded?r.qpSumPerFrame=e.qpSum/e.framesEncoded:r.qpSumPerFrame=(e.qpSum-o.lastQpSum)/(e.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,r),this.processVideoTrackSenderStats(e,e.trackId,r),e.remoteId)this.processRemoteInboundStats(e.remoteId,r);else{const o=this.findRemoteStatsId(e.ssrc,Zc.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,r)}}processAudioOutboundStats(e){let r=this._stats.audioSend.find(s=>s.ssrc===e.ssrc);if(r||(r=Cu(vW),this._stats.audioSend.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsSent,r.bytes=e.bytesSent,r.retransmittedBytesSent=e.retransmittedBytesSent,r.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,r),e.remoteId)this.processRemoteInboundStats(e.remoteId,r);else{const s=this.findRemoteStatsId(e.ssrc,Zc.REMOTE_INBOUND);s&&this.processRemoteInboundStats(s,r)}}findRemoteStatsId(e,r){var s;const o=Array.from(Xc(s=this.report).call(s)).find(c=>c.type===r&&c.ssrc===e);return o?o.id:null}processVideoMediaSource(e,r){const s=this.report.get(e);s&&s.width&&s.height&&s.framesPerSecond&&(r.inputFrame={width:s.width,height:s.height,frameRate:s.framesPerSecond})}processAudioMediaSource(e,r){const s=this.report.get(e);s&&(r.inputLevel=s.audioLevel)}processVideoTrackSenderStats(e,r,s){var o,c,u,h;const m=r?this.report.get(r):void 0,y=(o=m==null?void 0:m.framesSent)!==null&&o!==void 0?o:e.framesSent;if(typeof y!="number")return;let E=(c=m==null?void 0:m.frameWidth)!==null&&c!==void 0?c:e.frameWidth,S=(u=m==null?void 0:m.frameHeight)!==null&&u!==void 0?u:e.frameHeight,R=(h=m==null?void 0:m.framesPerSecond)!==null&&h!==void 0?h:e.framesPerSecond;if(typeof E=="number"&&typeof S=="number"||(E=0,S=0),R==null){const P=Date.now(),D=this.lastVideoFramesSent.get(s.ssrc);D&&P-D.lts>=800?(R=Math.round((y-D.count)/((P-D.lts)/1e3)),this.lastVideoFramesSent.set(s.ssrc,{count:y,lts:P,rate:R})):D?R=D.rate:this.lastVideoFramesSent.set(s.ssrc,{count:y,lts:P,rate:0})}s.sentFrame={width:E,height:S,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(e,r,s){var o,c,u,h,m;const y=r?this.report.get(r):void 0,E=(o=y==null?void 0:y.framesReceived)!==null&&o!==void 0?o:e.framesReceived,S=(c=y==null?void 0:y.frameWidth)!==null&&c!==void 0?c:e.frameWidth,R=(u=y==null?void 0:y.frameHeight)!==null&&u!==void 0?u:e.frameHeight,P=(h=y==null?void 0:y.jitterBufferDelay)!==null&&h!==void 0?h:e.jitterBufferDelay,D=(m=y==null?void 0:y.jitterBufferEmittedCount)!==null&&m!==void 0?m:e.jitterBufferEmittedCount;if(typeof E=="number"){const G=this.lastVideoFramesRecv.get(s.ssrc),j=Date.now();s.framesReceivedCount=E;let B=0;G&&j-G.lts>=800?(B=Math.round((E-G.count)/((j-G.lts)/1e3)),this.lastVideoFramesRecv.set(s.ssrc,{count:E,lts:j,rate:B})):G?B=G.rate:this.lastVideoFramesRecv.set(s.ssrc,{count:E,lts:j,rate:0}),s.receivedFrame={width:S||0,height:R||0,frameRate:B||0},s.decodedFrame={width:S||0,height:R||0,frameRate:s.decodeFrameRate||0},s.outputFrame={width:S||0,height:R||0,frameRate:s.outputFrameRate||s.decodeFrameRate||0}}if(P&&D){const G=this.lastVideoJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let j=G.jitterBufferMs;const B=D-G.jitterBufferEmittedCount;B>0&&(j=1e3*(P-G.jitterBufferDelay)/B),s.jitterBufferMs=j,s.currentDelayMs=Math.round(j),this.lastVideoJBDelay.set(s.ssrc,{jitterBufferDelay:P,jitterBufferEmittedCount:D,jitterBufferMs:s.currentDelayMs})}}processAudioTrackSenderStats(e,r,s){var o,c,u,h;const m=r?this.report.get(r):void 0,y=(o=(c=m==null?void 0:m.echoReturnLoss)!==null&&c!==void 0?c:e.echoReturnLoss)!==null&&o!==void 0?o:0,E=(u=(h=m==null?void 0:m.echoReturnLossEnhancement)!==null&&h!==void 0?h:e.echoReturnLossEnhancement)!==null&&u!==void 0?u:0;s.aecReturnLoss=y,s.aecReturnLossEnhancement=E}processAudioTrackReceiverStats(e,r,s){var o,c,u,h,m,y,E;const S=r?this.report.get(r):void 0,R=(o=S==null?void 0:S.removedSamplesForAcceleration)!==null&&o!==void 0?o:e.removedSamplesForAcceleration,P=(c=S==null?void 0:S.totalSamplesReceived)!==null&&c!==void 0?c:e.totalSamplesReceived,D=(u=S==null?void 0:S.jitterBufferDelay)!==null&&u!==void 0?u:e.jitterBufferDelay,G=(h=S==null?void 0:S.jitterBufferEmittedCount)!==null&&h!==void 0?h:e.jitterBufferEmittedCount,j=(m=S==null?void 0:S.audioLevel)!==null&&m!==void 0?m:e==null?void 0:e.audioLevel,B=(y=S==null?void 0:S.totalSamplesDuration)!==null&&y!==void 0?y:e==null?void 0:e.totalSamplesDuration,Y=(E=S==null?void 0:S.concealedSamples)!==null&&E!==void 0?E:e.concealedSamples;if(typeof P=="number"&&(s.totalSamplesReceived=P),R&&P&&(s.accelerateRate=R/P),D&&G){const fe=this.lastAudioJBDelay.get(s.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let ye=fe.jitterBufferMs;const Ee=G-fe.jitterBufferEmittedCount;Ee>0&&(ye=1e3*(D-fe.jitterBufferDelay)/Ee),s.jitterBufferMs=Math.round(ye),this.lastAudioJBDelay.set(s.ssrc,{jitterBufferDelay:D,jitterBufferEmittedCount:G,jitterBufferMs:s.jitterBufferMs})}s.outputLevel=j;let ee=1920;B&&P&&(ee=P/B/50,s.receivedFrames=Math.round(P/ee)),Y&&(s.droppedFrames=Math.round(Y/ee))}processRemoteInboundStats(e,r){const s=this.report.get(e);s&&(r.packetsLost=s.packetsLost,s.roundTripTime&&(r.rttMs=1e3*s.roundTripTime),s.jitter&&(r.jitterMs=1e3*s.jitter),s.timestamp&&(r.timestamp=s.timestamp))}getCodecFromCodecStats(e){const r=this.report.get(e);if(!r)return"";const s=r.mimeType.match(/\/(.*)$/);return s&&s[1]?s[1]:""}updateSendBitrate(){let e=0,r=null,s=null;this.mediaBytesSent.forEach(c=>{e+=c.diffMean()}),this.mediaBytesRetransmit.forEach(c=>{r=r===null?c.diffMean():r+c.diffMean()}),this.mediaBytesTargetEncode.forEach(c=>{s=s===null?c.diffMean():s+c.diffMean()});const o=r!==null?e-r:e;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),s!==null&&(this._stats.bitrate.targetEncoded=8*s/(this.options.updateInterval/1e3))}},vfe=class extends tL{updateStats(){return ht.resolve()}};function rL(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const u=function(){const h=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return h&&h[0]?Number(h[0].split("/")[1]):null}();return u?u<76?new Efe(e,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new bW(e,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):function(h){if(!window.RTCStatsReport)return!1;const m=h.getStats();return!!(m instanceof ht||function(y){return!!y&&(typeof y=="object"||typeof y=="function")&&typeof y.then=="function"}(m))}(e)?new bW(e,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c}):new vfe(e,{updateInterval:r,lossRateInterval:s,freezeRateLimit:o,firstVideoDecodedTimeout:c})}const TW="websdk_ng_install_id";function iL(){try{if(oe("INSTALL_ID"))return oe("INSTALL_ID");let e=window.localStorage.getItem(TW);return e||(e=z_(),window.localStorage.setItem(TW,e)),sr("INSTALL_ID",e),e}catch{return}}const Dl=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const r=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const s=r[1],o=r[2];return"".concat(s,".").concat(o)}return"4.0.0.999"}("4.23.2"),sL=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let W_=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const ks=function(){const e="us".concat("erna","me"),r="pa".concat("sswo","rd"),s=["t","s","t"];s.splice(1,0,"e");const o=s.join(""),c=[];for(let m=0;m<6;m++)c.push("1");const u=c.join(""),h={};return h[e]=o,h[r]=u,Object.assign(h,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=ks;const HA={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},oL={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},aL="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",cL={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},wr=St(St(St({},cL),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:oL,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},HA),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function sr(e,r,s){var o,c,u;ct(o=Object.keys(wr)).call(o,e)&&(!s&&ct(c=Object.keys(Id)).call(c,e)||(wr[e]=r,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||r!==!0||(wr.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(wr.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&r&&(u=!!r,wr.USE_NEW_NETWORK_CONFIG=u,u&&(wr.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],wr.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],wr.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],wr.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],wr.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",wr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",wr.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&r&&(wr.ENABLE_INSTANT_VIDEO=!0,wr.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&r&&(wr.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&r&&(wr.NEW_TURN_MODE||(wr.NEW_TURN_MODE=4))))}function oe(e){return wr[e]}sL||(wr.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],wr.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],wr.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],wr.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],wr.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],wr.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],wr.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",wr.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",wr.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",wr.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",wr.AREAS=["NORTH_AMERICA","OVERSEA"]);let wW=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const Id={};var wn=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(wn||{});let $A=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const CW=128,Sfe=96,RW=1e3,zv=10;let bfe=0;var IW=(()=>{var e={8:(o,c,u)=>{u.r(c),u.d(c,{Parser:()=>pt,Printer:()=>li,parse:()=>ot,print:()=>At});const h=`
`,m="".concat("\r").concat(h),y=" ";let E;function S(Ye){return Ye>="0"&&Ye<="9"}function R(Ye){return Ye>="!"&&Ye<="~"}function P(Ye){return R(Ye)||Ye>=""&&Ye<=""}function D(Ye){return Ye==="!"||Ye>="#"&&Ye<="'"||Ye>="*"&&Ye<="+"||Ye>="-"&&Ye<="."||Ye>="0"&&Ye<="9"||Ye>="A"&&Ye<="Z"||Ye>="^"&&Ye<="~"}function G(Ye){return Ye>="1"&&Ye<="9"}function j(Ye){return Ye>="A"&&Ye<="Z"||Ye>="a"&&Ye<="z"}function B(Ye){return Ye==="d"||Ye==="h"||Ye==="m"||Ye==="s"}function Y(Ye){return Ye>""&&Ye<"	"||Ye>"\v"&&Ye<"\f"||Ye>""&&Ye<""}function ee(Ye){return j(Ye)||S(Ye)||Ye==="+"||Ye==="/"}function fe(Ye){return S(Ye)||j(Ye)||Ye==="+"||Ye==="/"||Ye==="-"||Ye==="_"}function ye(Ye){return j(Ye)||S(Ye)||Ye==="+"||Ye==="/"}function Ee(Ye,U){var ce=Object.keys(Ye);if(Object.getOwnPropertySymbols){var me=Object.getOwnPropertySymbols(Ye);U&&(me=me.filter(function(tt){return Object.getOwnPropertyDescriptor(Ye,tt).enumerable})),ce.push.apply(ce,me)}return ce}function _e(Ye){for(var U=1;U<arguments.length;U++){var ce=arguments[U]!=null?arguments[U]:{};U%2?Ee(Object(ce),!0).forEach(function(me){Ne(Ye,me,ce[me])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ye,Object.getOwnPropertyDescriptors(ce)):Ee(Object(ce)).forEach(function(me){Object.defineProperty(Ye,me,Object.getOwnPropertyDescriptor(ce,me))})}return Ye}function Ne(Ye,U,ce){return U in Ye?Object.defineProperty(Ye,U,{value:ce,enumerable:!0,configurable:!0,writable:!0}):Ye[U]=ce,Ye}(function(Ye){Ye.VERSION="v",Ye.ORIGIN="o",Ye.SESSION_NAME="s",Ye.INFORMATION="i",Ye.URI="u",Ye.EMAIL="e",Ye.PHONE="p",Ye.CONNECTION="c",Ye.BANDWIDTH="b",Ye.TIME="t",Ye.REPEAT="r",Ye.ZONE_ADJUSTMENTS="z",Ye.KEY="k",Ye.ATTRIBUTE="a",Ye.MEDIA="m"})(E||(E={}));class Ze{consumeText(U,ce){let me=ce;for(;me<U.length;){const tt=U[me];if(tt==="\0"||tt==="\r"||tt===h)break;me+=1}if(me-ce==0)throw new Error("Invalid text, at ".concat(U));return me}consumeUnicastAddress(U,ce,me){return this.consumeTill(U,ce,y)}consumeOneOrMore(U,ce,me){let tt=ce;for(;me(U[tt]);)tt++;if(tt-ce==0)throw new Error("Invalid rule at ".concat(ce,"."));return tt}consumeSpace(U,ce){if(U[ce]===y)return ce+1;throw new Error("Invalid space at ".concat(ce,"."))}consumeIP4Address(U,ce){let me=ce;for(let tt=0;tt<4;tt++)if(me=this.consumeDecimalUChar(U,me),tt!==3){if(U[me]!==".")throw new Error("Invalid IP4 address.");me++}return me}consumeDecimalUChar(U,ce){let me=ce;for(let en=0;en<3&&S(U[me]);en++,me++);if(me-ce==0)throw new Error("Invalid decimal uchar.");const tt=parseInt(U.slice(ce,me));if(tt>=0&&tt<=255)return me;throw new Error("Invalid decimal uchar")}consumeIP6Address(U,ce){let me=this.consumeHexpart(U,ce);return U[me]===":"&&(me+=1,me=this.consumeIP4Address(U,me)),me}consumeHexpart(U,ce){let me=ce;if(U[me]===":"&&U[me+1]===":"){me+=2;try{me=this.consumeHexseq(U,me)}catch{}return me}if(me=this.consumeHexseq(U,me),U[me]===":"&&U[me+1]===":"){me+=2;try{me=this.consumeHexseq(U,me)}catch{}return me}return me}consumeHexseq(U,ce){let me=ce;for(;me=this.consumeHex4(U,me),U[me]===":"&&U[me+1]!==":";)me+=1;return me}consumeHex4(U,ce){let me=0;for(;me<4;me++)if(!((tt=U[ce+me])>="0"&&tt<="9"||tt>="a"&&tt<="f"||tt>="A"&&tt<="F")){if(me===0)throw new Error("Invalid hex 4");break}var tt;return ce+me}consumeFQDN(U,ce){let me=ce;for(;S(U[me])||j(U[me])||U[me]==="-"||U[me]===".";)me+=1;if(me-ce<4)throw new Error("Invalid FQDN");return me}consumeExtnAddr(U,ce){return this.consumeOneOrMore(U,ce,P)}consumeMulticastAddress(U,ce,me){switch(me){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(U,ce);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(U,ce);default:try{return this.consumeFQDN(U,ce)}catch{return this.consumeExtnAddr(U,ce)}}}consumeIP6MulticastAddress(U,ce){const me=this.consumeHexpart(U,ce);return U[me]==="/"?this.consumeInteger(U,me+1):me}consumeIP4MulticastAddress(U,ce){let me=ce+3;const tt=U.slice(ce,me),en=parseInt(tt);if(en<224||en>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let lr=0;lr<3;lr++){if(U[me]!==".")throw new Error("Invalid IP4 multicast address.");me+=1,me=this.consumeDecimalUChar(U,me)}return U[me]==="/"&&(me+=1),me=this.consumeTTL(U,me),U[me]==="/"&&(me=this.consumeInteger(U,me)),me}consumeInteger(U,ce){if(!G(U[ce]))throw new Error("Invalid integer.");for(ce+=1;S(U[ce]);)ce+=1;return ce}consumeTTL(U,ce){if(U[ce]==="0")return ce+1;if(!G(U[ce]))throw new Error("Invalid TTL.");ce+=1;for(let me=0;me<2&&S(U[ce]);me++)ce+=1;return ce}consumeToken(U,ce){return this.consumeOneOrMore(U,ce,D)}consumeTime(U,ce){let me=ce;if(U[me]==="0")return me+1;for(G(U[me])&&(me+=1);S(U[me]);)me++;if(me-ce<10)throw new Error("Invalid time");return me}consumeAddress(U,ce){return this.consumeTill(U,ce,y)}consumeTypedTime(U,ce){let me=ce;return me=this.consumeOneOrMore(U,me,S),B(U[me])?me+1:me}consumeRepeatInterval(U,ce){if(!G(U[ce]))throw new Error("Invalid repeat interval");for(ce+=1;S(U[ce]);)ce+=1;return B(U[ce])&&(ce+=1),ce}consumePort(U,ce){return this.consumeOneOrMore(U,ce,S)}consume(U,ce,me){for(let tt=0;tt<me.length;tt++){if(ce+tt>=U.length)throw new Error("consume exceeding value length");if(U[ce+tt]!==me[tt])throw new Error("consume ".concat(me," failed at ").concat(tt))}return ce+me.length}consumeTill(U,ce,me){let tt=ce;for(;tt<U.length&&(typeof me!="string"||U[tt]!==me)&&(typeof me!="function"||!me(U[tt]));)tt++;return tt}}class pt extends Ze{constructor(){super(),Ne(this,"records",[]),Ne(this,"currentLine",0)}parse(U){const ce=this.probeEOL(U);this.records=U.split(ce).filter(py=>!!wo(py).call(py)).map(this.parseLine),this.currentLine=0;const me=this.parseVersion(),tt=this.parseOrigin(),en=this.parseSessionName(),lr=this.parseInformation(),Qi=this.parseUri(),Qa=this.parseEmail(),Sf=this.parsePhone(),hy=this.parseConnection(),lw=this.parseBandWidth(),rO=this.parseTimeFields(),iO=this.parseKey(),Bl=this.parseSessionAttribute(),ag=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:me,origin:tt,sessionName:en,information:lr,uri:Qi,emails:Qa,phones:Sf,connection:hy,bandwidths:lw,timeFields:rO,key:iO,attributes:Bl,mediaDescriptions:ag}}getCurrentRecord(){const U=this.records[this.currentLine];if(!U)throw new Error("Record doesn't exit.");return U}probeEOL(U){for(let ce=0;ce<U.length;ce++)if(U[ce]===h)return U[ce-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(U,ce){if(U.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const me=U[0];if(U[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:me,value:U.slice(2),line:ce,cur:0}}parseSessionAttribute(){const U=new In;for(;this.currentLine<this.records.length;){const ce=this.getCurrentRecord();if(ce.type!==E.ATTRIBUTE)break;const me={attField:this.extractOneOrMore(ce,tt=>D(tt)&&tt!==":"),_cur:0};ce.value[ce.cur]===":"&&(ce.cur+=1,me.attValue=this.extractOneOrMore(ce,Y)),U.parse(me),this.currentLine++}return U.digest()}parseMediaAttributes(U){const ce=new An(U);for(;this.currentLine<this.records.length;){const me=this.getCurrentRecord();if(me.type!==E.ATTRIBUTE)break;const tt={attField:this.extractOneOrMore(me,en=>D(en)&&en!==":"),_cur:0};me.value[me.cur]===":"&&(me.cur+=1,tt.attValue=this.extractOneOrMore(me,Y)),ce.parse(tt),this.currentLine++}return ce.digest()}parseKey(){const U=this.getCurrentRecord();if(U.type===E.KEY){if(U.value==="prompt"||U.value==="clear:"||U.value==="base64:"||U.value==="uri:")return U.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const U=this.getCurrentRecord();if(U.type===E.ZONE_ADJUSTMENTS){const ce=[];for(;;)try{const me=this.extract(U,this.consumeTime);this.consumeSpaceForRecord(U);let tt=!1;U.value[U.cur]==="-"&&(tt=!0,U.cur+=1);const en=this.extract(U,this.consumeTypedTime);ce.push({time:me,typedTime:en,back:tt})}catch{break}if(ce.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,ce}return[]}parseRepeat(){const U=[];for(;;){const ce=this.getCurrentRecord();if(ce.type!==E.REPEAT)break;{const me=this.extract(ce,this.consumeRepeatInterval),tt=this.parseTypedTime(ce);U.push({repeatInterval:me,typedTimes:tt}),this.currentLine++}}return U}parseTypedTime(U){const ce=[];for(;;)try{this.consumeSpaceForRecord(U),ce.push(this.extract(U,this.consumeTypedTime))}catch{break}if(ce.length===0)throw new Error("Invalid typed time.");return ce}parseTime(){const U=this.getCurrentRecord(),ce=this.extract(U,this.consumeTime);this.consumeSpaceForRecord(U);const me=this.extract(U,this.consumeTime);return this.currentLine++,{startTime:ce,stopTime:me}}parseBandWidth(){const U=[];for(;this.currentLine<this.records.length;){const ce=this.getCurrentRecord();if(ce.type!==E.BANDWIDTH)break;{const me=this.extractOneOrMore(ce,D);if(ce.value[ce.cur]!==":")throw new Error("Invalid bandwidth field.");ce.cur++;const tt=this.extractOneOrMore(ce,S);U.push({bwtype:me,bandwidth:tt}),this.currentLine++}}return U}parseVersion(){const U=this.getCurrentRecord();if(U.type!==E.VERSION)throw new Error("first sdp record must be version");const ce=U.value.slice(0,this.consumeOneOrMore(U.value,0,S));if(ce.length!==U.value.length)throw new Error('invalid proto version, "v='.concat(U.value,'"'));return this.currentLine++,ce}parseOrigin(){const U=this.getCurrentRecord();if(U.type!==E.ORIGIN)throw new Error("second line of sdp must be origin");const ce=this.extractOneOrMore(U,P);this.consumeSpaceForRecord(U);const me=this.extractOneOrMore(U,S);this.consumeSpaceForRecord(U);const tt=this.extractOneOrMore(U,S);this.consumeSpaceForRecord(U);const en=this.extractOneOrMore(U,D);this.consumeSpaceForRecord(U);const lr=this.extractOneOrMore(U,D);this.consumeSpaceForRecord(U);const Qi=this.extract(U,this.consumeUnicastAddress);return this.currentLine++,{username:ce,sessId:me,sessVersion:tt,nettype:en,addrtype:lr,unicastAddress:Qi}}parseSessionName(){const U=this.getCurrentRecord();if(U.type===E.SESSION_NAME){const ce=this.extract(U,this.consumeText);return this.currentLine++,ce}}parseInformation(){const U=this.getCurrentRecord();if(U.type!==E.INFORMATION)return;const ce=this.extract(U,this.consumeText);return this.currentLine++,ce}parseUri(){const U=this.getCurrentRecord();if(U.type===E.URI)return this.currentLine++,U.value}parseEmail(){const U=[];for(;;){const ce=this.getCurrentRecord();if(ce.type!==E.EMAIL)break;U.push(ce.value),this.currentLine++}return U}parsePhone(){const U=[];for(;;){const ce=this.getCurrentRecord();if(ce.type!==E.PHONE)break;U.push(ce.value),this.currentLine++}return U}parseConnection(){const U=this.getCurrentRecord();if(U.type===E.CONNECTION){const ce=this.extractOneOrMore(U,D);this.consumeSpaceForRecord(U);const me=this.extractOneOrMore(U,D);this.consumeSpaceForRecord(U);const tt=this.extract(U,this.consumeAddress);return this.currentLine++,{nettype:ce,addrtype:me,address:tt}}}parseMedia(){const U=this.getCurrentRecord(),ce=this.extract(U,this.consumeToken);this.consumeSpaceForRecord(U);let me=this.extract(U,this.consumePort);U.value[U.cur]==="/"&&(U.cur+=1,me+=this.extract(U,this.consumeInteger)),this.consumeSpaceForRecord(U);const tt=[];for(tt.push(this.extract(U,this.consumeToken));U.value[U.cur]==="/";)U.cur+=1,tt.push(this.extract(U,this.consumeToken));if(tt.length===0)throw new Error("Invalid proto");const en=this.parseFmt(U);return this.currentLine++,{mediaType:ce,port:me,protos:tt,fmts:en}}parseTimeFields(){const U=[];for(;this.getCurrentRecord().type===E.TIME;){const ce=this.parseTime(),me=this.parseRepeat(),tt=this.parseZone();U.push({time:ce,repeats:me,zones:tt})}return U}parseMediaDescription(){const U=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.MEDIA;){const ce=this.parseMedia(),me=this.parseInformation(),tt=this.parseConnections(),en=this.parseBandWidth(),lr=this.parseKey(),Qi=this.parseMediaAttributes(ce);U.push({media:ce,information:me,connections:tt,bandwidths:en,key:lr,attributes:Qi})}return U}parseConnections(){const U=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.CONNECTION;)U.push(this.parseConnection());return U}parseFmt(U){const ce=[];for(;;)try{this.consumeSpaceForRecord(U),ce.push(this.extract(U,this.consumeToken))}catch{break}if(ce.length===0)throw new Error("Invalid fmts");return ce}extract(U,ce){for(var me=arguments.length,tt=new Array(me>2?me-2:0),en=2;en<me;en++)tt[en-2]=arguments[en];const lr=ce.call(this,U.value,U.cur,...tt),Qi=U.value.slice(U.cur,lr);return U.cur=lr,Qi}extractOneOrMore(U,ce){const me=this.consumeOneOrMore(U.value,U.cur,ce),tt=U.value.slice(U.cur,me);return U.cur=me,tt}consumeSpaceForRecord(U){if(U.value[U.cur]!==y)throw new Error("Invalid space at ".concat(U.cur,"."));U.cur+=1}}class yt extends Ze{constructor(){super(...arguments),Ne(this,"attributes",void 0),Ne(this,"digested",!1)}extractOneOrMore(U,ce,me){const tt=this.consumeOneOrMore(U.attValue,U._cur,ce),en=U.attValue.slice(U._cur,tt),[lr,Qi]=me||[];if(typeof lr=="number"&&en.length<lr)throw new Error("error in length, should be more or equal than ".concat(lr," characters."));if(typeof Qi=="number"&&en.length>Qi)throw new Error("error in length, should be less or equal than ".concat(Qi," characters."));return U._cur=tt,en}consumeAttributeSpace(U){if(U.attValue[U._cur]!==y)throw new Error("Invalid space at ".concat(U._cur,"."));U._cur+=1}extract(U,ce){if(!U.attValue)throw new Error("Nothing to extract from attValue.");for(var me=arguments.length,tt=new Array(me>2?me-2:0),en=2;en<me;en++)tt[en-2]=arguments[en];const lr=ce.call(this,U.attValue,U._cur,...tt),Qi=U.attValue.slice(U._cur,lr);return U._cur=lr,Qi}atEnd(U){if(!U.attValue)throw new Error;return U._cur>=U.attValue.length}peekChar(U){if(!U.attValue)throw new Error;return U.attValue[U._cur]}peek(U,ce){if(!U.attValue)throw new Error;for(let me=0;me<ce.length;me++)if(ce[me]!==U.attValue[U._cur+me])return!1;return!0}parseIceUfrag(U){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(U,ee,[4,256])}parseIcePwd(U){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(U,ee,[22,256])}parseIceOptions(U){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const ce=[];for(;!this.atEnd(U);){ce.push(this.extractOneOrMore(U,ee));try{this.consumeAttributeSpace(U)}catch(me){if(this.atEnd(U))break;throw me}}this.attributes.iceOptions=ce}parseFingerprint(U){const ce=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill);this.attributes.fingerprints.push({hashFunction:ce,fingerprint:me})}parseExtmap(U){const ce=this.extractOneOrMore(U,S);let me;this.peekChar(U)==="/"&&(this.extract(U,this.consume,"/"),me=this.extract(U,this.consumeToken)),this.consumeAttributeSpace(U);const tt=this.extract(U,this.consumeTill,y),en=_e(_e({entry:parseInt(ce,10)},me&&{direction:me}),{},{extensionName:tt});this.peekChar(U)===y&&(this.consumeAttributeSpace(U),en.extensionAttributes=this.extract(U,this.consumeTill)),this.attributes.extmaps.push(en)}parseSetup(U){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const ce=this.extract(U,this.consumeTill);if(ce!=="active"&&ce!=="passive"&&ce!=="actpass"&&ce!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=ce}}class In extends yt{constructor(){super(...arguments),Ne(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(U){if(this.digested)throw new Error("already digested");try{switch(U.attField){case"group":this.parseGroup(U);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(U);break;case"ice-pwd":this.parseIcePwd(U);break;case"ice-options":this.parseIceOptions(U);break;case"fingerprint":this.parseFingerprint(U);break;case"setup":this.parseSetup(U);break;case"tls-id":this.parseTlsId(U);break;case"identity":this.parseIdentity(U);break;case"extmap":this.parseExtmap(U);break;case"msid-semantic":this.parseMsidSemantic(U);break;default:U.ignored=!0,this.attributes.unrecognized.push(U)}}catch(ce){throw console.error("parsing session attribute ".concat(U.attField,' error, "a=').concat(U.attField,":").concat(U.attValue,'"')),ce}if(!U.ignored&&U.attValue&&!this.atEnd(U))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(U){const ce=this.extract(U,this.consumeToken),me=[];for(;!this.atEnd(U)&&this.peekChar(U)===y;)this.consumeAttributeSpace(U),me.push(this.extract(U,this.consumeToken));this.attributes.groups.push({semantic:ce,identificationTag:me})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(U){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(U,fe)}parseIdentity(U){const ce=this.extractOneOrMore(U,ye),me=[];for(;!this.atEnd(U)&&this.peekChar(U)===y;){this.consumeAttributeSpace(U);const tt=this.extract(U,this.consumeToken);this.extract(U,this.consume,"=");const en=this.extractOneOrMore(U,lr=>lr!==y&&Y(lr));me.push({name:tt,value:en})}this.attributes.identities.push({assertionValue:ce,extensions:me})}parseMsidSemantic(U){this.peekChar(U)===y&&this.consumeAttributeSpace(U);const ce={semantic:this.extract(U,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(U)}catch{break}if(this.peekChar(U)==="*"){this.extract(U,this.consume,"*"),ce.applyForAll=!0;break}{const me=this.extract(U,this.consumeTill,y);ce.identifierList.push(me)}}this.attributes.msidSemantic=ce}}class An extends yt{constructor(U){super(),Ne(this,"attributes",void 0),U.protos.indexOf("RTP")!==-1||U.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(U){if(this.digested)throw new Error("already digested");try{switch(U.attField){case"extmap":this.parseExtmap(U);break;case"setup":this.parseSetup(U);break;case"ice-ufrag":this.parseIceUfrag(U);break;case"ice-pwd":this.parseIcePwd(U);break;case"ice-options":this.parseIceOptions(U);break;case"candidate":this.parseCandidate(U);break;case"remote-candidate":this.parseRemoteCandidate(U);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(U);break;case"rtpmap":this.parseRtpmap(U);break;case"ptime":this.parsePtime(U);break;case"maxptime":this.parseMaxPtime(U);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(U);break;case"ssrc":this.parseSSRC(U);break;case"fmtp":this.parseFmtp(U);break;case"rtcp-fb":this.parseRtcpFb(U);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(U);break;case"mid":this.parseMid(U);break;case"msid":this.parseMsid(U);break;case"imageattr":this.parseImageAttr(U);break;case"rid":this.parseRid(U);break;case"simulcast":this.parseSimulcast(U);break;case"sctp-port":this.parseSctpPort(U);break;case"max-message-size":this.parseMaxMessageSize(U);break;case"ssrc-group":this.parseSSRCGroup(U);break;default:U.ignored=!0,this.attributes.unrecognized.push(U)}}catch(ce){throw console.error("parsing media attribute ".concat(U.attField,' error, "a=').concat(U.attField,":").concat(U.attValue,'"')),ce}if(!U.ignored&&U.attValue&&!this.atEnd(U))throw new Error("attribute parsing error")}parseCandidate(U){const ce=this.extractOneOrMore(U,ee,[1,32]);this.consumeAttributeSpace(U);const me=this.extractOneOrMore(U,S,[1,5]);this.consumeAttributeSpace(U);const tt=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U);const en=this.extractOneOrMore(U,S,[1,10]);this.consumeAttributeSpace(U);const lr=this.extract(U,this.consumeAddress);this.consumeAttributeSpace(U);const Qi=this.extract(U,this.consumePort);this.consumeAttributeSpace(U),this.extract(U,this.consume,"typ"),this.consumeAttributeSpace(U);const Qa={foundation:ce,componentId:me,transport:tt,priority:en,connectionAddress:lr,port:Qi,type:this.extract(U,this.consumeToken),extension:{}};for(this.peek(U," raddr")&&(this.extract(U,this.consume," raddr"),this.consumeAttributeSpace(U),Qa.relAddr=this.extract(U,this.consumeAddress)),this.peek(U," rport")&&(this.extract(U,this.consume," rport"),this.consumeAttributeSpace(U),Qa.relPort=this.extract(U,this.consumePort));this.peekChar(U)===y;){this.consumeAttributeSpace(U);const Sf=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U),Qa.extension[Sf]=this.extractOneOrMore(U,R)}this.attributes.candidates.push(Qa)}parseRemoteCandidate(U){const ce=[];for(;;){const me=this.extractOneOrMore(U,S,[1,5]);this.consumeAttributeSpace(U);const tt=this.extract(U,this.consumeAddress);this.consumeAttributeSpace(U);const en=this.extract(U,this.consumePort);ce.push({componentId:me,connectionAddress:tt,port:en});try{this.consumeAttributeSpace(U)}catch{break}}this.attributes.remoteCandidatesList.push(ce)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(U){const ce=this.extract(U,this.consumeToken);this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill,"/");this.extract(U,this.consume,"/");const tt={encodingName:me,clockRate:this.extractOneOrMore(U,S)};this.atEnd(U)||this.peekChar(U)!=="/"||(this.extract(U,this.consume,"/"),tt.encodingParameters=parseInt(this.extract(U,this.consumeTill),10));const en=this.attributes.payloads.find(lr=>lr.payloadType===parseInt(ce,10));en?en.rtpMap=tt:this.attributes.payloads.push({payloadType:parseInt(ce,10),rtpMap:tt,rtcpFeedbacks:[]})}parsePtime(U){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(U,this.consumeTill)}parseMaxPtime(U){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(U,this.consumeTill)}parseDirection(U){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=U.attField}parseSSRC(U){const ce=this.extractOneOrMore(U,S);this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill,":");let tt;this.peekChar(U)===":"&&(this.extract(U,this.consume,":"),tt=this.extract(U,this.consumeTill));const en=this.attributes.ssrcs.find(lr=>lr.ssrcId===parseInt(ce,10));en?en.attributes[me]=tt:this.attributes.ssrcs.push({ssrcId:parseInt(ce,10),attributes:{[me]:tt}})}parseFmtp(U){const ce=this.extract(U,this.consumeTill,y);this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill),tt={};me.split(";").forEach(lr=>{let[Qi,Qa]=lr.split("=");Qi=wo(Qi).call(Qi);const Sf=typeof Qa=="string"?wo(Qa).call(Qa):null;typeof Qi=="string"&&Qi.length>0&&(tt[Qi]=Sf)});const en=this.attributes.payloads.find(lr=>lr.payloadType===parseInt(ce,10));en?en.fmtp={parameters:tt}:this.attributes.payloads.push({payloadType:parseInt(ce,10),rtcpFeedbacks:[],fmtp:{parameters:tt}})}parseFmtParameters(U){const ce={},me=this.extract(U,this.consumeTill,"=");U._cur++;const tt=this.extract(U,this.consumeTill,";");for(ce[me]=tt;U.attValue[U._cur]===";";){const en=this.extract(U,this.consumeTill,"=");U._cur++;const lr=this.extract(U,this.consumeTill,";");ce[en]=lr}return ce}parseRtcpFb(U){let ce="";ce=this.peekChar(U)==="*"?this.extract(U,this.consume,"*"):this.extract(U,this.consumeTill,y),this.consumeAttributeSpace(U);const me=this.extract(U,this.consumeTill,y);let tt;if(me==="trr-int")tt={type:me,interval:this.extract(U,this.consumeTill)};else{const en={type:me};this.peekChar(U)===y&&(this.consumeAttributeSpace(U),en.parameter=this.extract(U,this.consumeToken),this.peekChar(U)===y&&(en.additional=this.extract(U,this.consumeTill))),tt=en}if(ce==="*")this.attributes.rtcpFeedbackWildcards.push(tt);else{const en=this.attributes.payloads.find(lr=>lr.payloadType===parseInt(ce,10));en?en.rtcpFeedbacks.push(tt):this.attributes.payloads.push({payloadType:parseInt(ce,10),rtcpFeedbacks:[tt]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(U){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const ce={port:this.extract(U,this.consumePort)};this.peekChar(U)===y&&(this.consumeAttributeSpace(U),ce.netType=this.extractOneOrMore(U,D),this.consumeAttributeSpace(U),ce.addressType=this.extractOneOrMore(U,D),this.consumeAttributeSpace(U),ce.address=this.extract(U,this.consumeAddress)),this.attributes.rtcp=ce}parseMsid(U){const ce={id:this.extractOneOrMore(U,D,[1,64])};this.peekChar(U)===y&&(this.consumeAttributeSpace(U),ce.appdata=this.extractOneOrMore(U,D,[1,64])),this.attributes.msids.push(ce)}parseImageAttr(U){this.attributes.imageattr.push(U.attValue)}parseRid(U){const ce=this.extractOneOrMore(U,tt=>j(tt)||S(tt)||tt==="_"||tt==="-");this.consumeAttributeSpace(U);const me={id:ce,direction:this.extract(U,this.consumeToken),params:[]};if(this.peekChar(U)===y){if(this.consumeAttributeSpace(U),this.peek(U,"pt=")){this.extract(U,this.consume,"pt=");const tt=[];for(;;){const en=this.extract(U,this.consumeToken);tt.push(en);try{this.extract(U,this.consume,",")}catch{break}}me.payloads=tt,this.peekChar(U)===y&&this.extract(U,this.consume,y)}for(;;){const tt=this.extract(U,this.consumeToken);switch(tt){case"depend":{const en={type:tt,rids:this.extract(U,this.consume,"=").split(",")};me.params.push(en);break}default:{const en={type:tt};this.peekChar(U)==="="&&(this.extract(U,this.consume,"="),en.val=this.extract(U,this.consumeTill,";")),me.params.push(en)}}try{this.extract(U,this.consume,";")}catch{break}}}this.attributes.rids.push(me)}parseSimulcast(U){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=U.attValue,this.extract(U,this.consumeTill)}parseSctpPort(U){this.attributes.sctpPort=this.extractOneOrMore(U,S,[1,5])}parseMaxMessageSize(U){this.attributes.maxMessageSize=this.extractOneOrMore(U,S,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(U){this.attributes.mid=this.extract(U,this.consumeToken)}parseSSRCGroup(U){const ce=this.extract(U,this.consumeToken),me=[];for(;;)try{this.consumeAttributeSpace(U);const tt=this.extract(U,this.consumeInteger);me.push(parseInt(tt,10))}catch{break}this.attributes.ssrcGroups.push({semantic:ce,ssrcIds:me})}}function mr(Ye,U,ce){return U in Ye?Object.defineProperty(Ye,U,{value:ce,enumerable:!0,configurable:!0,writable:!0}):Ye[U]=ce,Ye}class li{constructor(){mr(this,"eol",m)}print(U,ce){let me="";return ce&&(this.eol=ce),me+=this.printVersion(U.version),me+=this.printOrigin(U.origin),me+=this.printSessionName(U.sessionName),me+=this.printInformation(U.information),me+=this.printUri(U.uri),me+=this.printEmail(U.emails),me+=this.printPhone(U.phones),me+=this.printConnection(U.connection),me+=this.printBandwidth(U.bandwidths),me+=this.printTimeFields(U.timeFields),me+=this.printKey(U.key),me+=this.printSessionAttributes(U.attributes),me+=this.printMediaDescription(U.mediaDescriptions),me}printVersion(U){return"v=".concat(U).concat(this.eol)}printOrigin(U){return"o=".concat(U.username," ").concat(U.sessId," ").concat(U.sessVersion," ").concat(U.nettype," ").concat(U.addrtype," ").concat(U.unicastAddress).concat(this.eol)}printSessionName(U){return U?"s=".concat(U).concat(this.eol):""}printInformation(U){return U?"i=".concat(U).concat(this.eol):""}printUri(U){return U?"u=".concat(U).concat(this.eol):""}printEmail(U){let ce="";for(const me of U)ce+="e=".concat(me).concat(this.eol);return ce}printPhone(U){let ce="";for(const me of U)ce+="e=".concat(me).concat(this.eol);return ce}printConnection(U){return U?"c=".concat(U.nettype," ").concat(U.addrtype," ").concat(U.address).concat(this.eol):""}printBandwidth(U){let ce="";for(const me of U)ce+="b=".concat(me.bwtype,":").concat(me.bandwidth).concat(this.eol);return ce}printTimeFields(U){let ce="";for(const me of U){ce+="t=".concat(me.time.startTime," ").concat(me.time.startTime).concat(this.eol);for(const tt of me.repeats)ce+="r=".concat(tt.repeatInterval," ").concat(tt.typedTimes.join(" ")).concat(this.eol);me.zoneAdjustments&&(ce+="z=",ce+="z=".concat(me.zoneAdjustments.map(tt=>"".concat(tt.time," ").concat(tt.back?"-":""," ").concat(tt.typedTime)).join(" ")).concat(this.eol),ce+=this.eol)}return ce}printKey(U){return U?"k=".concat(U).concat(this.eol):""}printAttributes(U){let ce="";for(const me of U)ce+="a=".concat(me.attField).concat(me.attValue?":".concat(me.attValue):"").concat(this.eol);return ce}printMediaDescription(U){let ce="";for(const me of U)ce+=this.printMedia(me.media),ce+=this.printInformation(me.information),ce+=this.printConnections(me.connections),ce+=this.printBandwidth(me.bandwidths),ce+=this.printKey(me.key),ce+=this.printMediaAttributes(me);return ce}printConnections(U){let ce="";for(const me of U)ce+=this.printConnection(me);return ce}printMedia(U){return"m=".concat(U.mediaType," ").concat(U.port," ").concat(U.protos.join("/")," ").concat(U.fmts.join(" ")).concat(this.eol)}printSessionAttributes(U){return new Ta(this.eol).print(U)}printMediaAttributes(U){return new We(this.eol).print(U)}}class Jr{constructor(U){mr(this,"eol",void 0),this.eol=U}printIceUfrag(U){return U===void 0?"":"a=ice-ufrag:".concat(U).concat(this.eol)}printIcePwd(U){return U===void 0?"":"a=ice-pwd:".concat(U).concat(this.eol)}printIceOptions(U){return U===void 0?"":"a=ice-options:".concat(U.join(y)).concat(this.eol)}printFingerprints(U){return U.length>0?U.map(ce=>"a=fingerprint:".concat(ce.hashFunction).concat(y).concat(ce.fingerprint)).join(this.eol)+this.eol:""}printExtmap(U){return U.map(ce=>"a=extmap:".concat(ce.entry).concat(ce.direction?"/".concat(ce.direction):"").concat(y).concat(ce.extensionName).concat(ce.extensionAttributes?"".concat(y).concat(ce.extensionAttributes):"").concat(this.eol)).join("")}printSetup(U){return U===void 0?"":"a=setup:".concat(U).concat(this.eol)}printUnrecognized(U){return U.map(ce=>"a=".concat(ce.attField).concat(ce.attValue?":".concat(ce.attValue):"").concat(this.eol)).join("")}}class Ta extends Jr{print(U){let ce="";return ce+=this.printGroups(U.groups),ce+=this.printMsidSemantic(U.msidSemantic),ce+=this.printIceLite(U.iceLite),ce+=this.printIceUfrag(U.iceUfrag),ce+=this.printIcePwd(U.icePwd),ce+=this.printIceOptions(U.iceOptions),ce+=this.printFingerprints(U.fingerprints),ce+=this.printSetup(U.setup),ce+=this.printTlsId(U.tlsId),ce+=this.printIdentity(U.identities),ce+=this.printExtmap(U.extmaps),ce+=this.printUnrecognized(U.unrecognized),ce}printGroups(U){let ce="";return U.length>0&&(ce+=U.map(me=>"a=group:".concat(me.semantic).concat(me.identificationTag.map(tt=>"".concat(y).concat(tt)).join("")).concat(this.eol)).join("")),ce}printIceLite(U){return U===void 0?"":"a=ice-lite"+this.eol}printTlsId(U){return U?"a=tls-id:".concat(U).concat(this.eol):""}printIdentity(U){return U.length===0?"":U.map(ce=>"a=identity:".concat(ce.assertionValue).concat(ce.extensions.map(me=>"".concat(y).concat(me.name).concat(me.value?"=".concat(me.value):"")))).join(this.eol)+this.eol}printMsidSemantic(U){if(!U)return"";let ce="a=msid-semantic:".concat(U.semantic);return U.applyForAll?ce+="".concat(y,"*"):U.identifierList.length>0&&(ce+=U.identifierList.map(me=>"".concat(y).concat(me))),ce+this.eol}}class We extends Jr{print(U){const ce=U.attributes;let me="";return me+=this.printRTCP(ce.rtcp),me+=this.printIceUfrag(ce.iceUfrag),me+=this.printIcePwd(ce.icePwd),me+=this.printIceOptions(ce.iceOptions),me+=this.printCandidates(ce.candidates),me+=this.printRemoteCandidatesList(ce.remoteCandidatesList),me+=this.printEndOfCandidates(ce.endOfCandidates),me+=this.printFingerprints(ce.fingerprints),me+=this.printSetup(ce.setup),me+=this.printMid(ce.mid),me+=this.printExtmap(ce.extmaps),me+=this.printRTPRelated(ce),me+=this.printPtime(ce.ptime),me+=this.printMaxPtime(ce.maxPtime),me+=this.printDirection(ce.direction),me+=this.printSSRCGroups(ce.ssrcGroups),me+=this.printSSRC(ce.ssrcs),me+=this.printRTCPMux(ce.rtcpMux),me+=this.printRTCPMuxOnly(ce.rtcpMuxOnly),me+=this.printRTCPRsize(ce.rtcpRsize),me+=this.printMSId(ce.msids),me+=this.printImageattr(ce.imageattr),me+=this.printRid(ce.rids),me+=this.printSimulcast(ce.simulcast),me+=this.printSCTPPort(ce.sctpPort),me+=this.printMaxMessageSize(ce.maxMessageSize),me+=this.printUnrecognized(ce.unrecognized),me}printCandidates(U){return U.map(ce=>"a=candidate:".concat(ce.foundation).concat(y).concat(ce.componentId).concat(y).concat(ce.transport).concat(y).concat(ce.priority).concat(y).concat(ce.connectionAddress).concat(y).concat(ce.port).concat(y,"typ").concat(y).concat(ce.type).concat(ce.relAddr?"".concat(y,"raddr").concat(y).concat(ce.relAddr):"").concat(ce.relPort?"".concat(y,"rport").concat(y).concat(ce.relPort):"").concat(Object.keys(ce.extension).map(me=>"".concat(y).concat(me).concat(y).concat(ce.extension[me])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(U){return U.map(ce=>"a=remote-candidates:".concat(ce.join(y)).concat(this.eol)).join("")}printEndOfCandidates(U){return U===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(U){if(!U.payloads)return"";const ce=U.payloads;let me="";me+=U.rtcpFeedbackWildcards.map(tt=>this.printRTCPFeedback("*",tt)).join("");for(const tt of ce)me+=this.printRtpMap(tt.payloadType,tt.rtpMap),me+=this.printFmtp(tt.payloadType,tt.fmtp),me+=tt.rtcpFeedbacks.map(en=>this.printRTCPFeedback(tt.payloadType,en)).join("");return me}printFmtp(U,ce){if(!ce)return"";const me=Object.keys(ce.parameters);return me.length===1&&ce.parameters[me[0]]===null?"a=fmtp:".concat(U).concat(y).concat(me[0]).concat(this.eol):"a=fmtp:".concat(U).concat(y).concat(Object.keys(ce.parameters).map(tt=>"".concat(tt,"=").concat(ce.parameters[tt])).join(";")).concat(this.eol)}printRtpMap(U,ce){return ce?"a=rtpmap:".concat(U).concat(y).concat(ce.encodingName,"/").concat(ce.clockRate).concat(ce.encodingParameters?"/".concat(ce.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(U,ce){let me="a=rtcp-fb:".concat(U).concat(y),tt=ce;return tt.type==="trr-int"?me+="ttr-int".concat(y).concat(tt.interval):(me+="".concat(tt.type),tt.parameter&&(me+="".concat(y).concat(tt.parameter),tt.additional&&(me+="".concat(y).concat(tt.additional)))),me+this.eol}printPtime(U){return U===void 0?"":"a=ptime:".concat(U).concat(this.eol)}printMaxPtime(U){return U===void 0?"":"a=maxptime:".concat(U).concat(this.eol)}printDirection(U){return U===void 0?"":"a=".concat(U).concat(this.eol)}printSSRC(U){return U.map(ce=>Object.keys(ce.attributes).map(me=>"a=ssrc:".concat(ce.ssrcId.toString(10)).concat(y).concat(me).concat(ce.attributes[me]?":".concat(ce.attributes[me]):"").concat(this.eol)).join("")).join("")}printRTCPMux(U){return U===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(U){return U===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(U){return U===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(U){if(U===void 0)return"";let ce="a=rtcp:".concat(U.port);return U.netType&&(ce+="".concat(y).concat(U.netType)),U.addressType&&(ce+="".concat(y).concat(U.addressType)),U.address&&(ce+="".concat(y).concat(U.address)),ce+this.eol}printMSId(U){return U.map(ce=>"a=msid:".concat(ce.id).concat(ce.appdata?"".concat(y).concat(ce.appdata):"").concat(this.eol)).join("")}printImageattr(U){return U.map(ce=>"a=imageattr:".concat(ce).concat(this.eol)).join("")}printRid(U){return U.map(ce=>{let me="a=rid:".concat(ce.id).concat(y).concat(ce.direction);return ce.payloads&&(me+="".concat(y,"pt=").concat(ce.payloads.join(","))),ce.params.length>0&&(me+="".concat(y).concat(ce.params.map(tt=>tt.type==="depend"?"depend=".concat(tt.rids.join(",")):"".concat(tt.type,"=").concat(tt.val)).join(";"))),me+this.eol}).join("")}printSimulcast(U){return U===void 0?"":"a=simulcast:".concat(U).concat(this.eol)}printSCTPPort(U){return U===void 0?"":"a=sctp-port:".concat(U).concat(this.eol)}printMaxMessageSize(U){return U===void 0?"":"a=max-message-size:".concat(U).concat(this.eol)}printMid(U){return U===void 0?"":"a=mid:".concat(U).concat(this.eol)}printSSRCGroups(U){return U.map(ce=>"a=ssrc-group:".concat(ce.semantic).concat(ce.ssrcIds.map(me=>"".concat(y).concat(me.toString(10))).join("")).concat(this.eol)).join("")}}function ot(Ye){return new pt().parse(Ye)}function At(Ye,U){return new li().print(Ye,U)}}},r={};function s(o){if(r[o])return r[o].exports;var c=r[o]={exports:{}};return e[o](c,c.exports,s),c.exports}return s.d=(o,c)=>{for(var u in c)s.o(c,u)&&!s.o(o,u)&&Object.defineProperty(o,u,{enumerable:!0,get:c[u]})},s.o=(o,c)=>Object.prototype.hasOwnProperty.call(o,c),s.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},s(8)})();function qa(e){return IW.parse(e)}function Gm(e,r){return IW.print(e,r)}var Tfe=mc("Array").keys,wfe=jc,Cfe=Ci,Rfe=O,Ife=Tfe,lL=Array.prototype,Afe={DOMTokenList:!0,NodeList:!0},Pfe=function(e){var r=e.keys;return e===lL||Rfe(lL,e)&&r===lL.keys||Cfe(Afe,wfe(e))?Ife:r},el=l(Pfe);function AW(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function un(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?AW(Object(s),!0).forEach(function(o){Kr(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):AW(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}function Kr(e,r,s){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var y=m.call(u,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}const PW=new class extends jr{constructor(){super(...arguments),Kr(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:r}=e;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class Ofe{constructor(r){Kr(this,"logger",void 0),Kr(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.debug(...this.prefixLists,...s)}info(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.info(...this.prefixLists,...s)}warning(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.warning(...this.prefixLists,...s)}error(){for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];this.logger.error(...this.prefixLists,...s)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function uL(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function OW(){const e=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const xl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},KA=Date.now(),IT=e=>{for(const r in xl)if(Object.prototype.hasOwnProperty.call(xl,r)&&xl[r]===e)return r;return"DEFAULT"},x=new class{constructor(){Kr(this,"proxyServerURL",void 0),Kr(this,"logLevel",xl.DEBUG),Kr(this,"uploadState","collecting"),Kr(this,"uploadLogWaitingList",[]),Kr(this,"uploadLogUploadingList",[]),Kr(this,"uploadErrorCount",0),Kr(this,"currentLogID",0),Kr(this,"url",void 0),Kr(this,"extLog",(e,r)=>{this.appendLogToWaitingList(e,...r)})}debug(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];const o=[xl.DEBUG].concat(r);this.log.apply(this,o)}info(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];const o=[xl.INFO].concat(r);this.log.apply(this,o)}warning(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];const o=[xl.WARNING].concat(r);this.log.apply(this,o)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];const o=[xl.ERROR].concat(r);this.log.apply(this,o)}upload(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];const o=[xl.DEBUG].concat(r);this.uploadLog.apply(this,o)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){sr("UPLOAD_LOG",!0)}disableLogUpload(){sr("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new Ofe(this).prefix(e)}log(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];if(Date.now()-KA<100)return void setTimeout(()=>{this.log(...r)},Date.now()-KA);const o=Math.max(0,Math.min(4,r[0]));if(r[0]=uL()+" Agora-SDK [".concat(IT(o),"]:"),this.appendLogToWaitingList(o,...r),o<this.logLevel)return;const c=uL()+" %cAgora-SDK [".concat(IT(o),"]:");let u=[];if(!oe("USE_NEW_LOG"))switch(o){case xl.DEBUG:u=[c,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,u);break;case xl.INFO:u=[c,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,u);break;case xl.WARNING:u=[c,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,u);break;case xl.ERROR:u=[c,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,u)}}uploadLog(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];if(Date.now()-KA<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-KA);const o=Math.max(0,Math.min(4,r[0]));r[0]=uL()+" Agora-SDK [".concat(IT(o),"]:"),this.appendLogToWaitingList(o,...r)}appendLogToWaitingList(e){if(!oe("UPLOAD_LOG"))return;for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];Array.isArray(s[0])?s[0][0]=OW()+" Agora-SDK [".concat(IT(e),"]:"):s[0]=OW()+" Agora-SDK [".concat(IT(e),"]:");let c="";s.forEach(u=>{typeof u=="object"&&(u=JSON.stringify(u)),c+="".concat(u," ")}),this.uploadLogWaitingList.push({payload_str:c,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,r={sdk_version:Dl,process_id:oe("PROCESS_ID"),payload:JSON.stringify(e)};return Rd(async()=>{const s=await _a.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(oe("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(oe("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(s.data!=="OK"){const o=new Error("unexpected upload log response");throw o.response=s,o}},()=>(this.uploadLogUploadingList=[],!1),s=>{const o={status:-1,message:s.message,errorRange:e.map(c=>c.log_item_id)};return s.response?(o.status=s.response.status,o.data=s.response.data,o.headers=s.response.headers):s.request&&(o.status=s.request.status),PW.reportLogUploadError(o),!0},{timeout:oe("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:oe("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,oe("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),oe("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var kW;function kfe(e){return hs(e.reportId,"params.reportId",0,100,!1),hs(e.category,"params.category",0,100,!1),hs(e.event,"params.event",0,100,!1),hs(e.label,"params.label",0,100,!1),cr(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(kW={}).FREE="free",kW.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const Nfe={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Xi=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Lr=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Dfe=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Ht(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,s,o){const c=o.value;if(typeof c=="function"){const u=e.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);o.value=function(){for(var h,m=arguments.length,y=new Array(m),E=0;E<m;E++)y[E]=arguments[E];let S=y;if(e.argsMap)try{S=e.argsMap(this,...y)}catch(P){x.warning(P),S=[]}try{JSON.stringify(S)}catch{x.warning("arguments for method ".concat(u,".").concat(String(s)," not serializable for apiInvoke.")),S=[]}const R=(e.report||Nt).reportApiInvoke(this._sessionId||null,{id:this._clientId||((h=this.store)===null||h===void 0?void 0:h.clientId)||this._ID,name:"".concat(u,".").concat(String(s)),options:S,tag:Hr.TRACER,reportResult:e.reportResult},e.throttleTime);try{const P=c.apply(this,y);return P instanceof ht?P.then(D=>(R.onSuccess(e.reportResult&&D),D)).catch(D=>{throw R.onError(D),D}):(R.onSuccess(e.reportResult&&P),P)}catch(P){throw R.onError(P),P}}}return o}}const Nt=new class{constructor(){Kr(this,"baseInfoMap",new Map),Kr(this,"proxyServer",void 0),Kr(this,"eventUploadTimer",void 0),Kr(this,"setSessionIdTimer",void 0),Kr(this,"url",void 0),Kr(this,"sids",new Set),Kr(this,"backupUrl",void 0),Kr(this,"_appId",void 0),Kr(this,"_aid",0),Kr(this,"keyEventUploadPendingItems",[]),Kr(this,"normalEventUploadPendingItems",[]),Kr(this,"apiInvokeUploadPendingItems",[]),Kr(this,"apiInvokeCount",0),Kr(this,"apiInvokeLoggedCount",0),Kr(this,"ltsList",[]),Kr(this,"lastSendNormalEventTime",Date.now()),Kr(this,"customReportCounterTimer",void 0),Kr(this,"customReportCount",0),Kr(this,"extApiInvoke",async e=>{for(const r of e){const s=un(un({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Hr.TRACER});this.sendApiInvoke(s)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),oe("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),oe("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,r=>{let[s,o]=r;return s+o}),16)||0}reportApiInvoke(e,r,s){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const o=Date.now();this.apiInvokeCount+=1;const c=this.apiInvokeCount,u=!!oe("SHOW_REPORT_INVOKER_LOG"),h=!!oe("SHOW_REPORT_USER_INVOKER_LOG"),m=u||h&&r.id;m&&(this.apiInvokeLoggedCount+=1);const y=this.apiInvokeLoggedCount;function E(D,G){if(m){let j="[apiInvoke-".concat(y,"]");r.id&&(j+="[".concat(r.id,"]")),r.name&&(j+="[".concat(r.name,"]")),x.info("".concat(j," ").concat(D),D==="start"?r.options:G||"")}}const S=()=>({tag:r.tag,invokeId:c,sid:e,name:r.name,apiInvokeTime:o,options:r.options,states:r.states||null});E("start");let R=!1;ps(r.timeout).then(()=>{R||(this.sendApiInvoke(un(un({},S()),{},{error:te.API_INVOKE_TIMEOUT,success:!1})),E("timeout"))});const P=new Le(te.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:D=>{const G=()=>{if(R)throw P;return R=!0,this.sendApiInvoke(un(un({},S()),{},{success:!0},r.reportResult&&{result:D})),E("onSuccess"),D};return s?uW(G,r.name+"Success",s,()=>R=!0):G()},onError:D=>{const G=()=>{if(R)throw D;R=!0,this.sendApiInvoke(un(un({},S()),{},{success:!1,error:D})),E("onFailure",D.toString())};return s?uW(G,r.name+"Error",s,()=>R=!0):G()}}}sessionInit(e,r){if(this.baseInfoMap.has(e))return;const s=Date.now(),o=this.createBaseInfo(e,s);o.cname=r.cname;const c=Object.assign({},{willUploadConsoleLog:oe("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:sL?"global":"oversea",areas:oe("AREAS")&&oe("AREAS").join(",")},r.extend),{stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:y,lsid:E,clientRole:S}=r,R=Date.now(),P=un(un({},o),{},{eventType:Xi.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:aL,lts:R,elapse:R-s,extend:JSON.stringify(c),mode:r.mode,process:oe("PROCESS_ID"),appType:oe("APP_TYPE"),success:!0,version:Dl,stringUid:u,channelProfile:h,channelMode:m,isABTestSuccess:y,lsid:E,clientType:ct(D=window.navigator.userAgent).call(D,"AgoraWebView")?42:20,clientRole:S,serviceId:oe("PROCESS_ID"),extensionID:oe("PLUGIN_INFO").join(",")||""});var D;this.send({type:Lr.SESSION,data:P},!0)}joinChooseServer(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=un(un({},o),{},{role:r.role,eventType:Xi.JOIN_CHOOSE_SERVER,lts:c,eventElapse:r.elapse||c-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:c-s.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0});this.send({type:Lr.JOIN_CHOOSE_SERVER,data:u},!0)}reqUserAccount(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=un(un({},o),{},{eventType:Xi.REQ_USER_ACCOUNT,lts:c,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||c-s.startTime,eventElapse:c-r.lts,extend:JSON.stringify(r.extend)});this.send({type:Lr.REQ_USER_ACCOUNT,data:u},!0)}joinGateway(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info;r.vid&&(o.vid=r.vid),o.uid=r.uid,o.cid=r.cid;const c=Date.now(),{firstSuccess:u,avoidJoinStartTime:h,addr:m,isProxy:y}=r,E=c-(u&&h?h:s.startTime),S=un(un({},o),{},{eventType:Xi.JOIN_GATEWAY,lts:c,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:E,eventElapse:c-r.lts,firstSuccess:u,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:iL(),isABTestSuccess:r.isABTestSuccess?1:0}),R=S.success?1:0;if(r.succ&&(s.lastJoinSuccessTime=c),u)this.send({type:Lr.JOIN_GATEWAY,data:S},!0);else{let P;if(m)if(y){const G=m.match(/h=(\d{1,3}-){3}\d{1,3}/g),j=m.match(/p=[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:G&&G.length?G[0].split("=")[1].replace(/-/g,"."):"",port:j&&j.length?j[0].split("=")[1]:"",isProxy:y?1:0}}else{const G=m.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),j=m.match(/(:|p=)[0-9]{1,6}/g);P={isSuccess:R,gatewayIp:G&&G.length?G[0].split("//")[1].replace(/-/g,"."):"",port:j&&j.length?j[0].split(/:|p=/g)[1]:"",isProxy:y?1:0}}else P={isSuccess:R,gatewayIp:"",port:"",isProxy:y?1:0};delete S.success,delete S.eventType,delete S.firstSuccess,S.vid=Number(S.vid);const D=Object.assign({},S,P,{eventType:Xi.REJOIN_GATEWAY});this.send({type:Lr.RE_JOIN_GATEWAY,data:D},!0)}}joinChannelTimeout(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=Date.now(),c=un(un({},s.info),{},{lts:o,timeout:r,elapse:o-s.startTime});this.send({type:Lr.JOIN_CHANNEL_TIMEOUT,data:c},!0)}publish(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=un(un({},o),{},{eventType:Xi.PUBLISH,lts:c,eventElapse:r.eventElapse,elapse:c-s.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:Lr.PUBLISH,data:u},!0)}subscribe(e,r,s){const o=this.baseInfoMap.get(e);if(!o)return;const c=o.info,u=Date.now(),h=un(un({},c),{},{eventType:Xi.SUBSCRIBE,lts:u,eventElapse:r.eventElapse,elapse:u-o.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},s&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?h.peerSuid=r.peerid:h.peer=r.peerid,this.send({type:Lr.SUBSCRIBE,data:h},!0)}wsCompressorInit(e){var r;const s=[...el(r=this.baseInfoMap).call(r)],o=s.length?s[0]:"UnableToGetSid",c=this.baseInfoMap.get(o);if(!c)return;const u=c.info,h=Date.now(),m=un(un({},u),{},{eventType:Xi.WS_COMPRESSOR_INIT,lts:h,eventElapse:e.eventElapse,elapse:h-c.startTime,status:e.status?1:2});this.send({type:Lr.WS_COMPRESSOR_INIT,data:m},!0)}firstRemoteVideoDecode(e,r,s,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=un(un(un({},u),o),{},{elapse:h-c.startTime,eventType:r,lts:h,firstDecodeFrame:Math.max((o.firstFrame||h)-c.startTime,0),apEnd:Math.max(o.apEnd-c.startTime,0),apStart:Math.max(o.apStart-c.startTime,0),joinGwEnd:Math.max(o.joinGwEnd-c.startTime,0),joinGwStart:Math.max(o.joinGwStart-c.startTime,0),pcEnd:Math.max(o.pcEnd-c.startTime,0),pcStart:Math.max(o.pcStart-c.startTime,0),subscriberEnd:Math.max(o.subscriberEnd-c.startTime,0),subscriberStart:Math.max(o.subscriberStart-c.startTime,0),videoAddNotify:Math.max(o.videoAddNotify-c.startTime,0)});this.send({type:s,data:m},!0)}firstRemoteFrame(e,r,s,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=un(un(un({},u),o),{},{elapse:h-c.startTime,eventType:r,lts:h});this.send({type:s,data:m},!0)}abTest(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=un(un(un({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-s.startTime,eventType:Xi.AB_TEST,lts:c});this.send({type:Lr.AB_TEST,data:u},!0)}pcStats(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=un(un(un({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),elapse:c-s.startTime,eventType:Xi.PC_STATS,lts:c,preallocation:r.preallocation?1:0});this.send({type:Lr.PC_STATS,data:u},!0)}updateRemoteRTPCapabilities(e,r){if(e){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=un(un(un({},o),r),{},{vid:o.vid===void 0?0:Number(o.vid),eventType:Xi.UPDATE_REMOTE_RTPCAPABILITIES,lts:c});this.send({type:Lr.UPDATE_REMOTE_RTPCAPABILITIES,data:u},!0)}}onGatewayStream(e,r,s,o){const c=this.baseInfoMap.get(e);if(!c)return;const u=c.info,h=Date.now(),m=un(un(un({},u),o),{},{eventType:r,lts:h});this.send({type:s,data:m},!0)}streamSwitch(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=un(un({},o),{},{eventType:Xi.STREAM_SWITCH,lts:c,isDual:r.isdual,elapse:c-s.startTime,success:r.succ});this.send({type:Lr.STREAM_SWITCH,data:u},!0)}requestProxyAppCenter(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=un(un({},o),{},{eventType:Xi.REQUEST_PROXY_APPCENTER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Lr.REQUEST_PROXY_APPCENTER,data:u},!0)}requestProxyWorkerManager(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=un(un({},o),{},{eventType:Xi.REQUEST_PROXY_WORKER_MANAGER,lts:c,eventElapse:c-r.lts,elapse:c-s.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:Lr.REQUEST_PROXY_WORKER_MANAGER,data:u},!0)}setProxyServer(e){this.proxyServer=e,e?x.debug("reportProxyServerurl: ".concat(e)):x.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=un(un({},o),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:c,elapse:c-s.startTime,joinChannelSuccessElapse:c-(s.lastJoinSuccessTime||c),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:Lr.PEER_PUBLISH_STATUS,data:u},!0)}workerEvent(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now();(function(u,h,m){const y=u[h];if(!y||typeof y!="string")return[u];u[h]="";const E=Rh(JSON.stringify(u));let S=0;const R=[];let P=0;for(let D=0;D<y.length;D++)P+=y.charCodeAt(D)<=127?1:3,P<=m-E||(R[R.length]=St(St({},u),{},{[h]:y.substring(S,D)}),S=D,P=y.charCodeAt(D)<=127?1:3);return S!==y.length-1&&(R[R.length]=St(St({},u),{},{[h]:y.substring(S)})),R})(un(un(un({},o),r),{},{elapse:c-s.startTime,lts:c,productType:"WebRTC"}),"payload",1300).forEach(u=>this.send({type:Lr.WORKER_EVENT,data:u},!0))}apworkerEvent(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=un(un(un({},o),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Lr.AP_WORKER_EVENT,data:u},!0)}joinWebProxyAP(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=un(un(un({},o),r),{},{elapse:c-s.startTime,lts:c,extend:r.extend||void 0});this.send({type:Lr.JOIN_WEB_PROXY_AP,data:u},!0)}WebSocketQuit(e,r){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),u=un(un(un({},o),r),{},{elapse:c-s.startTime,lts:c});this.send({type:Lr.WEBSOCKET_QUIT,data:u},!0)}async sendCustomReportMessage(e,r){if(this.customReportCount+=r.length,this.customReportCount>oe("CUSTOM_REPORT_LIMIT"))throw new Le(te.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const s=Date.now(),o=r.map(c=>({type:Lr.USER_ANALYTICS,data:un(un({sid:e},c),{},{lts:s})}));try{oe("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(o):await this.postDataToStatsCollector(o)}catch(c){throw x.error("send custom report message failed",c.toString()),new Le(te.CUSTOM_REPORT_SEND_FAILED,c.message)}}sendApiInvoke(e){const r=oe("NOT_REPORT_EVENT");if(e.tag&&ct(r)&&ct(r).call(r,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const s=this.baseInfoMap.get(e.sid);if(!s)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:o,uid:c,cid:u}=s.info;let h;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Le){const{code:y,message:E}=e.error;h=y||E||e.error.toString()}else h=e.error.toString();const m={invokeId:e.invokeId,sid:e.sid,cname:o,cid:u,uid:c,lts:e.lts,success:e.success,elapse:e.lts-s.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?h:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Lr.API_INVOKE,data:m},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const r=Array.from(this.sids).find(s=>s!==null);r&&e.forEach(s=>{s&&(s.sid=r,this.sendApiInvoke(Object.assign({},s)))}),e.length=0}send(e,r){if(r)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>oe("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,r){const s=[],o=[];for(;e.length;){const u=e.shift();s.length<20?s.push(u):o.push(u)}e.push(...o);for(const u of[...s]){var c;this.ltsList.indexOf(u.data.lts)!==-1?(u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(u.data.lts)):(this.ltsList.push(u.data.lts),oT(c=this.ltsList).call(c,(h,m)=>h-m))}return r||(this.lastSendNormalEventTime=Date.now()),oe("ENABLE_EVENT_REPORT")&&s.length&&(oe("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(s):this.postDataToStatsCollector(s)).catch((u=>h=>{oe("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(u),this.normalEventUploadPendingItems.length>oe("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-oe("NORMAL_EVENT_QUEUE_CAPACITY")),x.warning("report: drop normal events"))))})(s)),e}async postDataToStatsCollector2(e){yi.networkState===Tc.OFFLINE&&await ht.race([yi.onlineWaiter,ps(2*Pi.maxRetryTimeout)]);const r=c=>{let u=new Uint8Array;return c.forEach(h=>{const m=$x(JSON.stringify(h.data)),y=new ArrayBuffer(5),E=(R=>{let P=0;return Object.entries(Lr).forEach(D=>{let[G,j]=D;j===R.type&&(P=Dfe[G])}),P})(h),S=new DataView(y);S.setUint16(0,m.byteLength,!0),S.setUint8(2,255&E),S.setUint8(3,E>>>8&255),S.setUint8(4,E>>>16&255),u=tW(u,new Uint8Array(y)),u=tW(u,m)}),u},s="event";let o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(s):"https://".concat(oe("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(s);for(let c=0;c<2;c+=1){c===1&&(o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(s):"https://".concat(oe("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(s));try{await Zx(o,{timeout:1e4,data:r(e),headers:un(un({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(u){if(c===1)throw u;continue}return}}async postDataToStatsCollector(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=(m=>{const y=m&&m.data.sid&&this.baseInfoMap.get(m.data.sid);return y&&y.info.vid&&+y.info.vid||0})(e[0]),o=s?void 0:this._aid,c={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(m=>JSON.stringify(m)),vid:s,aid:o};yi.networkState===Tc.OFFLINE&&await ht.race([yi.onlineWaiter,ps(2*Pi.maxRetryTimeout)]);const u=r?"/events/proto-raws":"/events/messages";let h=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("EVENT_REPORT_DOMAIN"),"&p=").concat(oe("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(oe("EVENT_REPORT_DOMAIN"),":").concat(oe("STATS_COLLECTOR_PORT")).concat(u));for(let m=0;m<2;m+=1){m===1&&(h=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(oe("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(oe("STATS_COLLECTOR_PORT"),"&d=").concat(u):"https://".concat(oe("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(oe("STATS_COLLECTOR_PORT")).concat(u)));try{r?await yfe(h,{timeout:1e4,data:c}):await Zx(h,{timeout:1e4,data:c})}catch(y){if(m===1)throw y;continue}return}}createBaseInfo(e,r){const s=Object.assign({},Nfe);return s.sid=e,this.baseInfoMap.set(e,{info:s,startTime:r}),s}reportResourceTiming(e,r){const s=performance.getEntriesByName(e),o=s[s.length-1];o&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:o,tag:Hr.TRACER}).onSuccess()}};PW.on("REPORT_LOG_UPLOAD",e=>{e.networkState=yi.networkState,Nt.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Hr.TRACER}).onSuccess("logUploadError")});class Ae extends Le{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Kr(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,x)}throw(){super.throw(x)}}const fs={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function Fn(){return fs}function NW(){return"setSinkId"in HTMLAudioElement.prototype&&(!oe("RESTRICTION_SET_PLAYBACK_DEVICE")||(of()||Wz())&&!Wx())}function DW(){return!fs.supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&af()}let ms=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function Wv(e,r,s){return{sampleRate:e,stereo:r,bitrate:s}}function Ln(e,r,s,o,c){return{width:e,height:r,frameRate:s,bitrateMin:o,bitrateMax:c}}function Ru(e,r,s,o,c){return{width:{max:e},height:{max:r},frameRate:s,bitrateMin:o,bitrateMax:c}}function dL(e,r){return{numSpatialLayers:e,numTemporalLayers:r}}const xfe={"90p":Ln(160,90),"90p_1":Ln(160,90),"120p":Ln(160,120,15,30,65),"120p_1":Ln(160,120,15,30,65),"120p_3":Ln(120,120,15,30,50),"120p_4":Ln(212,120),"180p":Ln(320,180,15,30,140),"180p_1":Ln(320,180,15,30,140),"180p_3":Ln(180,180,15,30,100),"180p_4":Ln(240,180,15,30,120),"240p":Ln(320,240,15,40,200),"240p_1":Ln(320,240,15,40,200),"240p_3":Ln(240,240,15,40,140),"240p_4":Ln(424,240,15,40,220),"360p":Ln(640,360,15,80,400),"360p_1":Ln(640,360,15,80,400),"360p_3":Ln(360,360,15,80,260),"360p_4":Ln(640,360,30,80,600),"360p_6":Ln(360,360,30,80,400),"360p_7":Ln(480,360,15,80,320),"360p_8":Ln(480,360,30,80,490),"360p_9":Ln(640,360,15,80,800),"360p_10":Ln(640,360,24,80,800),"360p_11":Ln(640,360,24,80,1e3),"480p":Ln(640,480,15,100,500),"480p_1":Ln(640,480,15,100,500),"480p_2":Ln(640,480,30,100,1e3),"480p_3":Ln(480,480,15,100,400),"480p_4":Ln(640,480,30,100,750),"480p_6":Ln(480,480,30,100,600),"480p_8":Ln(848,480,15,100,610),"480p_9":Ln(848,480,30,100,930),"480p_10":Ln(640,480,10,100,400),"720p":Ln(1280,720,15,120,1130),"720p_auto":Ln(1280,720,30,900,3e3),"720p_1":Ln(1280,720,15,120,1130),"720p_2":Ln(1280,720,30,120,2e3),"720p_3":Ln(1280,720,30,120,1710),"720p_5":Ln(960,720,15,120,910),"720p_6":Ln(960,720,30,120,1380),"1080p":Ln(1920,1080,15,120,2080),"1080p_1":Ln(1920,1080,15,120,2080),"1080p_2":Ln(1920,1080,30,120,3e3),"1080p_3":Ln(1920,1080,30,120,3150),"1080p_5":Ln(1920,1080,60,120,4780),"1440p":Ln(2560,1440,30,120,4850),"1440p_1":Ln(2560,1440,30,120,4850),"1440p_2":Ln(2560,1440,60,120,7350),"4k":Ln(3840,2160,30,120,8910),"4k_1":Ln(3840,2160,30,120,8910),"4k_3":Ln(3840,2160,60,120,13500)},Lfe={"480p":Ru(640,480,5),"480p_1":Ru(640,480,5),"480p_2":Ru(640,480,30),"480p_3":Ru(640,480,15),"720p":Ru(1280,720,5),"720p_auto":Ln(1280,720,30,900,3e3),"720p_1":Ru(1280,720,5),"720p_2":Ru(1280,720,30),"720p_3":Ru(1280,720,15),"1080p":Ru(1920,1080,5),"1080p_1":Ru(1920,1080,5),"1080p_2":Ru(1920,1080,30),"1080p_3":Ru(1920,1080,15)},Mfe={"1SL1TL":dL(1,1),"3SL3TL":dL(3,3),"2SL3TL":dL(2,3)};function Ah(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},xfe[e]):e}function hL(e){return typeof e=="string"?Object.assign({},Lfe[e]):e}function qA(e){return typeof e=="string"?Object.assign({},Mfe[e]):e}const Ufe={speech_low_quality:Wv(16e3,!1),speech_standard:Wv(32e3,!1,18),music_standard:Wv(48e3,!1),standard_stereo:Wv(48e3,!0,56),high_quality:Wv(48e3,!1,128),high_quality_stereo:Wv(48e3,!0,192)};function YA(e){return typeof e=="string"?Object.assign({},Ufe[e]):e}const Gv=[];function xW(e){return Wi(e,"mediaSource",["screen","window","application"]),!0}let Rt=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),fr=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),Hv=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),Vfe=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),jfe=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),G_=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),$v=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),Kv=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),qv=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),tl=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const pL={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},fL={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},LW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},Ffe={uplinkNetworkQuality:0,downlinkNetworkQuality:0},MW={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let $o=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),nl=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),AT=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),H_=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Co=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),Ph=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const mL={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let XA=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function UW(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function Mr(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?UW(Object(s),!0).forEach(function(o){Ie(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):UW(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}function Ie(e,r,s){return(r=function(o){var c=function(u,h){if(typeof u!="object"||u===null)return u;var m=u[Symbol.toPrimitive];if(m!==void 0){var y=m.call(u,"string");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)}(o);return typeof c=="symbol"?c:String(c)}(r))in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}function Mn(e,r,s,o,c){var u,h,m={};return Object.keys(o).forEach(function(y){m[y]=o[y]}),m.enumerable=!!m.enumerable,m.configurable=!!m.configurable,("value"in m||m.initializer)&&(m.writable=!0),m=gc(u=mm(h=s.slice()).call(h)).call(u,function(y,E){return E(e,r,y)||y},m),c&&m.initializer!==void 0&&(m.value=m.initializer?m.initializer.call(c):void 0,m.initializer=void 0),m.initializer===void 0&&(Object.defineProperty(e,r,m),m=null),m}class VW extends jr{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(G_.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,s){super(),Ie(this,"trackMediaType",void 0),Ie(this,"_ID",void 0),Ie(this,"_rtpTransceiver",void 0),Ie(this,"_lowRtpTransceiver",void 0),Ie(this,"_hints",[]),Ie(this,"_isClosed",!1),Ie(this,"_originMediaStreamTrack",void 0),Ie(this,"mediaStreamTrack",void 0),Ie(this,"_external",{}),this._ID=s||pr(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(o){ct(Gv).call(Gv,o)||Gv.push(o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||zm(()=>{var s;Nt.reportApiInvoke(null,{name:Ai.GET_MEDIA_STREAM_TRACK,options:[],tag:Hr.TRACER}).onSuccess(((s=this._mediaStreamTrack)===null||s===void 0?void 0:s.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===Hv.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const s=Gv.indexOf(r);s!==-1&&Gv.splice(s,1)}(this),this.emit($v.CLOSED),this.removeAllListeners(G_.SEI_RECEIVED)}_updateRtpTransceiver(r,s){if(s===Hv.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(G_.TRANSCEIVER_UPDATED,r,s)}}class Yv extends VW{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,s){super(r,s),Ie(this,"_enabled",!0),Ie(this,"_muted",!1),Ie(this,"_isExternalTrack",!1),Ie(this,"_isClosed",!1),Ie(this,"_enabledMutex",void 0),Ie(this,"processor",void 0),Ie(this,"_processorContext",void 0),Ie(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new qs("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,s;return(r=(s=this._originMediaStreamTrack)===null||s===void 0?void 0:s.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,x.debug("[".concat(this.getTrackId(),"] close")),this.emit(Rt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,s){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=o,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),s&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await hr(this,Rt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit($v.TRACK_ENDED)}stateCheck(r,s){if(x.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(s,"]")),cf(s,r),this._enabled&&this._muted&&r==="enabled"&&s===!1)throw new Le(te.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",x);if(!this._enabled&&!this._muted&&r==="muted"&&s===!0)throw new Le(te.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",x)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():ht.resolve([])}}const jW=window.AudioContext||window.webkitAudioContext;let rl=null;const or=new class extends jr{constructor(){super(...arguments),Ie(this,"prevState",void 0),Ie(this,"curState",void 0),Ie(this,"currentTime",void 0),Ie(this,"currentTimeStuckAt",void 0),Ie(this,"interruptDetectorTrack",void 0),Ie(this,"onLocalAudioTrackMute",()=>{x.info("ios15-interruption-start"),this.emit(ms.IOS_15_16_INTERRUPTION_START)}),Ie(this,"onLocalAudioTrackUnmute",async()=>{x.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?x.info("ios15-interruption-end-canceled"):(rl&&await rl.suspend(),this.emit(ms.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){x.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){x.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Xv(){if(!rl){if(function(){if(!jW)return void x.error("your browser is not support web audio");x.info("create audio context");const e=Mr({},oe("WEBAUDIO_INIT_OPTIONS"));x.debug("audio context init option:",JSON.stringify(e)),rl=new jW(e),or.curState=rl.state,rl.onstatechange=()=>{or.prevState=or.curState,or.curState=rl?rl.state:void 0;const{prevState:r,curState:s}=or,o=s==="running",c=s==="interrupted",u=r==="running",h=r==="suspended",m=r==="interrupted",y=xn().osVersion;(Ho()||wu())&&u&&c&&(x.info("ios".concat(y,"-interruption-start")),or.emit(ms.IOS_INTERRUPTION_START)),(Ho()||wu())&&(h||m)&&o&&(x.info("ios".concat(y,"-interruption-end")),or.emit(ms.IOS_INTERRUPTION_END)),r!==s&&or.emit(ms.STATE_CHANGE,s,r)},setInterval(()=>{var r;const s=(r=rl)===null||r===void 0?void 0:r.currentTime;or.currentTime!==s?(or.currentTimeStuckAt&&(x.debug("AudioContext current time resume at ".concat(s)),or.currentTimeStuckAt=void 0),or.currentTime=s):(s!==or.currentTimeStuckAt&&(Nt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:s},tag:Hr.TRACER}).onSuccess(),x.warning("AudioContext current time stuck at ".concat(s))),or.currentTimeStuckAt=s)},5e3),async function(r){const s=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let o,c=!1,u=!1,h=!1;function m(j){r.state==="running"?y(!1):Ho()||wu()?r.state==="suspended"&&(y(!0),j&&r.resume().then(E,E)):r.state!=="closed"&&(y(!0),j&&r.resume().then(E,E))}function y(j){if(c!==j){c=j;for(let B=0,Y=s;B<Y.length;B+=1){const ee=Y[B];j?window.addEventListener(ee,S,{capture:!0,passive:!0}):window.removeEventListener(ee,S,{capture:!0,passive:!0})}}}function E(){m(!1)}function S(){m(!0)}function R(j){if(!h)if(o.paused)if(j){let B;P(!1),h=!0;try{B=o.play(),B?B.then(D,D):(o.addEventListener("playing",D),o.addEventListener("abort",D),o.addEventListener("error",D))}catch{D()}}else P(!0);else P(!1)}function P(j){if(u!==j){u=j;for(let B=0,Y=s;B<Y.length;B++){const ee=Y[B];j?window.addEventListener(ee,G,{capture:!0,passive:!0}):window.removeEventListener(ee,G,{capture:!0,passive:!0})}}}function D(){o.removeEventListener("playing",D),o.removeEventListener("abort",D),o.removeEventListener("error",D),h=!1,R(!1)}function G(){R(!0)}if(Ho()){const j=r.createMediaStreamDestination(),B=document.createElement("div");B.innerHTML="<audio x-webkit-airplay='deny'></audio>",o=B.children.item(0),o.controls=!1,o.disableRemotePlayback=!0,o.preload="auto",o.srcObject=j.stream,R(!0)}or.on(ms.STATE_CHANGE,function(){m(!0)}),m(!1)}(rl)}(),!rl)throw new Le(te.NOT_SUPPORTED,"can not create audio context");return rl}return rl}function $_(e){if(function(){if(gL!==null)return gL;const o=Xv(),c=o.createBufferSource(),u=o.createGain(),h=o.createGain();c.connect(u),c.connect(h),c.disconnect(u);let m=!1;try{c.disconnect(u)}catch{m=!0}return c.disconnect(),gL=m,m}())return;const r=e.connect,s=e.disconnect;e.connect=(o,c,u)=>{var h;return e._inputNodes||(e._inputNodes=[]),ct(h=e._inputNodes).call(h,o)||(o instanceof AudioNode?(e._inputNodes.push(o),r.call(e,o,c,u)):r.call(e,o,c)),e},e.disconnect=(o,c,u)=>{s.call(e),o?jA(e._inputNodes,o):e._inputNodes=[];for(const h of e._inputNodes)r.call(e,h)}}let gL=null;function _L(e,r){let s=!1;const o=1/r;if(oe("DISABLE_WEBAUDIO")){const c=window.setInterval(()=>{s?window.clearInterval(c):e(performance.now()/1e3)},1e3*o)}else{const c=Xv();let u=c.createGain();u.gain.value=0,u.connect(c.destination);const h=()=>{if(s)return void(u=null);const m=c.createOscillator();m.onended=h,m.connect(u),m.start(0),m.stop(c.currentTime+o),e(c.currentTime)};h()}return()=>{s=!0}}class FW{constructor(){Ie(this,"context",void 0),Ie(this,"analyserNode",void 0),Ie(this,"sourceNode",void 0),this.context=Xv(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Ho()||wu()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(o);for(let c=0;c<r.length;++c)r[c]=o[c]/128-1}const s=gc(r).call(r,(o,c)=>o+c*c,0)/r.length;return Math.max(10*Math.log10(s)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,s;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(s=this.sourceNode)===null||s===void 0||s.connect(this.analyserNode)}catch{x.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class BW extends jr{get processSourceNode(){return this.sourceNode}set processedNode(r){var s;if(!this.isDestroyed&&this._processedNode!==r){try{var o;(o=this.sourceNode)===null||o===void 0||o.disconnect(this.outputNode)}catch{}(s=this._processedNode)===null||s===void 0||s.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Ie(this,"outputNode",void 0),Ie(this,"outputTrack",void 0),Ie(this,"isPlayed",!1),Ie(this,"sourceNode",void 0),Ie(this,"context",void 0),Ie(this,"audioBufferNode",void 0),Ie(this,"destNode",void 0),Ie(this,"audioOutputLevel",0),Ie(this,"volumeLevelAnalyser",void 0),Ie(this,"_processedNode",void 0),Ie(this,"playNode",void 0),Ie(this,"isDestroyed",!1),Ie(this,"onNoAudioInput",void 0),Ie(this,"isNoAudioInput",!1),Ie(this,"_noAudioInputCount",0),this.context=Xv(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),$_(this.outputNode),this.volumeLevelAnalyser=new FW}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=s=>{this.emit(tl.ON_AUDIO_BUFFER,function(o){for(let c=0;c<o.outputBuffer.numberOfChannels;c+=1){const u=o.outputBuffer.getChannelData(c);for(let h=0;h<u.length;h+=1)u[h]=0}return o.inputBuffer}(s))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Fn().webAudioMediaStreamDest)throw new Le(te.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&FA(()=>{or.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Ho()||wu()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const s=this.volumeLevelAnalyser.getAnalyserNode();let o;s.getFloatTimeDomainData?(o=new Float32Array(s.fftSize),s.getFloatTimeDomainData(o)):(o=new Uint8Array(s.fftSize),s.getByteTimeDomainData(o));let c=!1;for(let u=0;u<o.length;u++)o[u]!==0&&(c=!0);return c?(this.isNoAudioInput=!1,!0):(await ps(200),await this.checkHasAudioInput(r?r+1:1)&&c)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,s;(r=this.processedNode)===null||r===void 0||r.disconnect(),(s=this.sourceNode)===null||s===void 0||s.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class zW extends BW{get isFreeze(){return!1}constructor(r,s,o){var c;if(super(),Ie(this,"sourceNode",void 0),Ie(this,"track",void 0),Ie(this,"clonedTrack",void 0),Ie(this,"audioElement",void 0),Ie(this,"isCurrentTrackCloned",!1),Ie(this,"isRemoteTrack",!1),Ie(this,"originVolumeLevelAnalyser",void 0),Ie(this,"rebuildWebAudio",async()=>{if(x.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void x.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>x.info("resume success")),x.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const m=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?m.stop():this.isCurrentTrackCloned=!0;const y=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(y),$_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const E=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(E,this.context.currentTime),$_(this.outputNode),this.emit(tl.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=y,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new Le(te.UNEXPECTED_ERROR);this.track=r;const u=new MediaStream([this.track]);if(this.isRemoteTrack=!!s,this.sourceNode=this.context.createMediaStreamSource(u),$_(this.sourceNode),o){const m=o.clone();m.enabled=!0,this.clonedTrack=m,x.debug("create an unmuted track ".concat(m.id," from the original track ").concat(o.id," to get the volume"));const y=this.context.createMediaStreamSource(new MediaStream([m]));$_(y),this.originVolumeLevelAnalyser=new FW,this.originVolumeLevelAnalyser.updateSource(y)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=u;const h=xn();s&&h.os===Yi.IOS&&Number((c=h.osVersion)===null||c===void 0?void 0:c.split(".")[0])<15&&(or.on(ms.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(m=>{m||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const s=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(s),$_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(tl.UPDATE_SOURCE),this.audioElement.srcObject=s}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),or.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const s=r.clone();s.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=s),x.debug("create an unmuted track ".concat(s.id," from the original track ").concat(r.id," to get the volume"));const o=this.context.createMediaStreamSource(new MediaStream([s]));$_(o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function WW(e,r,s){const o=(u,h)=>u?typeof u!="number"?u.max||u.exact||u.ideal||u.min||h:u:h,c={audio:!!s&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:o(r.height,1080),maxWidth:o(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(c.video.mandatory.maxFrameRate=r.frameRate.max,c.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(c.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(c)}async function Bfe(e,r){const s=await GW(e.mediaSource),{sourceId:o,audio:c}=await function(u){let h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new ht((m,y)=>{const E=document.createElement("div");E.innerText="share screen",E.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const S=document.createElement("div");S.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");const P=document.createElement("div");P.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const D=document.createElement("div");D.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const G=document.createElement("button");G.innerHTML="cancel",G.setAttribute("style","width: 85px;"),G.onclick=()=>{document.body.removeChild(Y);const ee=new Error("NotAllowedError");ee.name="NotAllowedError",y(ee)};let j=h;const B=document.createElement("div");if(h){const ee=document.createElement("input");ee.setAttribute("type","checkbox");const fe=document.createElement("span");ee.setAttribute("style","margin-right: 6px;"),fe.innerText="Share audio",ee.checked=j,ee.onchange=()=>{j=ee.checked},B.appendChild(ee),B.appendChild(fe)}D.appendChild(B),D.appendChild(G),S.appendChild(R),S.appendChild(P),S.appendChild(D);const Y=document.createElement("div");Y.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),Y.appendChild(E),Y.appendChild(S),document.body.appendChild(Y),u.map(ee=>{if(ee.id){const fe=document.createElement("div");fe.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let ye=ee.thumbnail;try{const{width:Ee}=ye.getSize();Ee>1920&&(ye=ye.resize({width:1920}))}catch(Ee){throw Ee&&Ee.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Ee}fe.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+ye.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+ee.name.replace(/[\u00A0-\u9999<>\&]/g,function(Ee){return"&#"+Ee.charCodeAt(0)+";"})+"</span>",fe.onclick=()=>{document.body.removeChild(Y),m({sourceId:ee.id,audio:j})},P.appendChild(fe)}})})}(s,r);return await WW(o,e,c)}async function GW(e){let r=["window","screen"];e!=="application"&&e!=="window"||(r=["window"]),e==="screen"&&(r=["screen"]);const s=nW();if(!s)throw console.error("failed to fetch electron, please mount it to window"),new Le(te.ELECTRON_IS_NULL);let o=null;try{var c;o=((c=s.desktopCapturer)===null||c===void 0?void 0:c.getSources({types:r}))||s.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{o=null}o&&o.then||(o=new ht((u,h)=>{s.desktopCapturer.getSources({types:r},(m,y)=>{m?h(m):u(y)})}));try{return await o}catch(u){throw new Le(te.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,u.toString())}}const yL=new qs("safari");let HW=!1,$W=!1;async function il(e,r){let s=0,o=null;for(;s<2;)try{o=await zfe(e,r,s>0);break}catch(c){if(c instanceof Le)throw x.error("[".concat(r,"] ").concat(c.toString())),c;const u=JA(c.name||c.code||c,c.message);if(u.code===te.MEDIA_OPTION_INVALID){x.debug("[".concat(r,"] detect media option invalid, retry")),s+=1,await ps(500);continue}throw x.error("[".concat(r,"] ").concat(u.toString())),u}if(!o)throw new Le(te.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return o}async function zfe(e,r,s){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Le(te.NOT_SUPPORTED,"can not find getUserMedia");s&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const o=Fn(),c=new MediaStream;if(e.audioSource&&c.addTrack(e.audioSource),e.videoSource&&c.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return x.debug("Using Video Source/ Audio Source"),c;if(e.screen)if(nW())e.screen.sourceId?Jv(c,await WW(e.screen.sourceId,e.screen,!!e.screenAudio)):Jv(c,await Bfe(e.screen,!!e.screenAudio));else if(of()&&e.screen.extensionId&&e.screen.mandatory){if(!o.getStreamFromExtension)throw new Le(te.NOT_SUPPORTED,"This browser does not support screen sharing");x.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const P=await(h=e.screen.extensionId,m=r,new ht((D,G)=>{try{chrome.runtime.sendMessage(h,{getStream:!0},j=>{if(!j||!j.streamId)return x.error("[".concat(m,"] No response from Chrome Plugin. Plugin not installed properly"),j),void G(new Le(te.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));D(j.streamId)})}catch(j){x.error("[".concat(m,"] AgoraRTC screensharing plugin is not accessible(").concat(h,")"),j.toString()),G(new Le(te.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=P,Jv(c,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(o.getDisplayMedia){var u;e.screen.mediaSource&&xW(e.screen.mediaSource);const P={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(u=e.screen.displaySurface)!==null&&u!==void 0?u:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:D,surfaceSwitching:G,systemAudio:j,preferCurrentTab:B}=e.screen,Y={selfBrowserSurface:D,surfaceSwitching:G,systemAudio:j,preferCurrentTab:B};!D&&delete Y.selfBrowserSurface,!G&&delete Y.surfaceSwitching,!j&&delete Y.systemAudio,!B&&delete Y.preferCurrentTab,x.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:P,audio:e.screenAudio,controls:Y})),Jv(c,await navigator.mediaDevices.getDisplayMedia(Mr({video:P,audio:e.screenAudio},Y)))}else{if(!Wr())throw x.error("[".concat(r,"] This browser does not support screenSharing")),new Le(te.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&xW(e.screen.mediaSource);const P={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};x.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify(P))),Jv(c,await navigator.mediaDevices.getUserMedia(P))}}var h,m;if(!e.video&&!e.audio)return c;let y={video:e.video,audio:e.audio},E=oe("MEDIA_DEVICE_CONSTRAINTS");if(E)try{typeof E=="string"&&(E=JSON.parse(E)),y=Yx(y,E)}catch{}x.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(y)),xn();let S,R=null;(As()||Ho()||UA())&&(R=await yL.lock());try{S=await navigator.mediaDevices.getUserMedia(y)}catch(P){throw R&&R(),P}return y.audio&&(HW=!0),y.video&&($W=!0),Jv(c,S),R&&R(),c}function JA(e,r){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Le(te.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new Le(te.DEVICE_NOT_FOUND,"".concat(e,": ").concat(r));case"NotSupportedError":return new Le(te.NOT_SUPPORTED,"".concat(e,": ").concat(r));case"NotReadableError":return new Le(te.NOT_READABLE,"".concat(e,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Le(te.PERMISSION_DENIED,"".concat(e,": ").concat(r));case"ConstraintNotSatisfiedError":return new Le(te.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(r));default:return x.error("getUserMedia unexpected error",e),new Le(te.UNEXPECTED_ERROR,"".concat(e,": ").concat(r))}}function Jv(e,r){const s=e.getVideoTracks()[0],o=e.getAudioTracks()[0],c=r.getVideoTracks()[0],u=r.getAudioTracks()[0];u&&(o&&e.removeTrack(o),e.addTrack(u)),c&&(s&&e.removeTrack(s),e.addTrack(c))}const sl=new class extends jr{get state(){return this._state}set state(e){e!==this._state&&(this.emit(H_.STATE_CHANGE,e),this._state=e)}constructor(){super(),Ie(this,"_state",AT.IDLE),Ie(this,"isAccessMicrophonePermission",!1),Ie(this,"isAccessCameraPermission",!1),Ie(this,"lastAccessMicrophonePermission",!1),Ie(this,"lastAccessCameraPermission",!1),Ie(this,"checkdeviceMatched",!1),Ie(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(oe("ENUMERATE_DEVICES_INTERVAL")||(VA()||MA()===Yi.HARMONY_OS)&&af())&&this.updateDevicesInfo()},oe("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>x.error(e.toString()))}async enumerateDevices(e,r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Le(te.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const o=await navigator.mediaDevices.enumerateDevices(),c=this.checkMediaDeviceInfoIsOk(o);let u=!this.isAccessMicrophonePermission&&e,h=!this.isAccessCameraPermission&&r;c.audio&&(u=!1),c.video&&(h=!1);let m=null,y=null,E=null;if(!s&&(u||h)){if(yL.isLocked&&(x.debug("[device manager] wait GUM lock"),(await yL.lock())(),x.debug("[device manager] GUM unlock")),HW&&(u=!1,this.isAccessMicrophonePermission=!0),$W&&(h=!1,this.isAccessCameraPermission=!0),x.debug("[device manager] check media device permissions",e,r,u,h),u&&h){try{E=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(S){const R=JA(S.name||S.code||S,S.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(u){try{m=await navigator.mediaDevices.getUserMedia({audio:e})}catch(S){const R=JA(S.name||S.code||S,S.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(h){try{y=await navigator.mediaDevices.getUserMedia({video:r})}catch(S){const R=JA(S.name||S.code||S,S.message);if(R.code===te.PERMISSION_DENIED)throw R;x.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}x.debug("[device manager] mic permission",e,"cam permission",r)}try{const S=await navigator.mediaDevices.enumerateDevices();return m&&m.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),E&&E.getTracks().forEach(R=>R.stop()),m=null,y=null,E=null,S}catch(S){return m&&m.getTracks().forEach(R=>R.stop()),y&&y.getTracks().forEach(R=>R.stop()),E&&E.getTracks().forEach(R=>R.stop()),m=null,y=null,E=null,new Le(te.ENUMERATE_DEVICES_FAILED,S.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(e){let r=null;return this.deviceInfoMap.forEach(s=>{s.device.label===e&&(r=s.device.deviceId)}),r}async getDeviceById(e){const r=(await this.enumerateDevices(!0,!0,!0)).find(s=>s.deviceId===e);if(!r)throw new Le(te.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return r}async init(){this.state=AT.INITING;try{await this.updateDevicesInfo(),this.state=AT.INITEND}catch(e){throw x.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=AT.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Le(te.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),r=Date.now(),s=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const c=e.find(h=>h.kind==="audioinput"&&h.deviceId==="default"),u=e.find(h=>h.kind==="audiooutput"&&h.deviceId==="default");c&&u?u.groupId===c.groupId?x.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is the same group")):x.debug("[device-check] default input ".concat(c.label," and output ").concat(u.label," is not the same group")):x.debug("[device-check] default input or output not found")}const o=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(c=>{if(!c.deviceId)return;const u=this.deviceInfoMap.get("".concat(c.kind,"_").concat(c.deviceId));if((u?u.state:"INACTIVE")!=="ACTIVE"){const h={initAt:r,updateAt:r,device:c,state:"ACTIVE"};this.deviceInfoMap.set("".concat(c.kind,"_").concat(c.deviceId),h),s.push(h)}u&&(u.updateAt=r)}),this.deviceInfoMap.forEach((c,u)=>{c.state==="ACTIVE"&&c.updateAt!==r&&(c.state="INACTIVE",s.push(c))}),this.state!==AT.INITEND)return o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));s.forEach(c=>{switch(c.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(H_.RECORDING_DEVICE_CHANGED,c);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(H_.CAMERA_DEVICE_CHANGED,c);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(H_.PLAYOUT_DEVICE_CHANGED,c)}}),o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const r=e.filter(c=>c.kind==="audioinput"),s=e.filter(c=>c.kind==="videoinput"),o={audio:!1,video:!1};for(const c of r)if(c.label&&c.deviceId){o.audio=!0;break}for(const c of s)if(c.label&&c.deviceId){o.video=!0;break}return o}};let EL=!1;const ol=new class extends jr{constructor(){super(...arguments),Ie(this,"onAutoplayFailed",void 0),Ie(this,"onAudioAutoplayFailed",void 0)}};function KW(){if(xn(),!EL){const e=r=>{r.preventDefault(),EL=!1,ET()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};EL=!0,ET()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),x.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),ol.onAutoplayFailed?ol.onAutoplayFailed():ol.onAudioAutoplayFailed?x.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):x.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),ol.emit("autoplay-failed")}}function qW(e,r,s,o){if(!e)return;const c=Nt.getBaseInfoBySessionId(e);if(!c)return;const u=c.info,h=Date.now(),m=Mr(Mr({},u),{},{vid:u.vid===void 0?0:Number(u.vid),lts:h,elapse:h-c.startTime,cbRegistered:ol.onAutoplayFailed||ol.onAudioAutoplayFailed?1:-1,errorMsg:s,mediaType:r,trackId:o,extend:void 0});Nt.send({type:Lr.AUTOPLAY_FAILED,data:m},!0)}const Wfe=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],ya=new class{constructor(){Ie(this,"onAutoplayFailed",void 0),Ie(this,"elementMap",new Map),Ie(this,"elementStateMap",new Map),Ie(this,"elementsNeedToResume",[]),Ie(this,"sinkIdMap",new Map),Ie(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(r=>{let[s,o]=r;const c=this.elementStateMap.get(s),u=o.srcObject.getAudioTracks()[0],h=u&&u.readyState;if(x.debug("resume after interrupted, ele: ".concat(c," audio: ").concat(h," ").concat(e)),h==="live"){if(e)return o.pause(),void o.play();if(or.curState==="running")return Uv()?(o.pause(),void o.play()):void(c&&c==="paused"&&o.play())}})}),Ie(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[r,s]=e;const o=s.srcObject.getAudioTracks()[0];o&&o.readyState==="live"&&(x.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),s.pause(),s.play())})}),this.autoResumeAudioElement(),or.on(ms.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),or.on(ms.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),or.on(ms.STATE_CHANGE,()=>{Ho()&&or.prevState==="suspended"&&or.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,r){const s=this.elementMap.get(e);if(this.sinkIdMap.set(e,r),s)try{await s.setSinkId(r)}catch(o){throw new Le(te.PERMISSION_DENIED,"can not set sink id: "+o.toString())}}play(e,r,s,o){if(this.elementMap.has(r))return;const c=document.createElement("audio");c.autoplay=!0,c.srcObject=new MediaStream([e]),this.bindAudioElementEvents(r,c),this.elementMap.set(r,c),this.elementStateMap.set(r,Co.INIT),this.setVolume(r,s);const u=this.sinkIdMap.get(r);if(u)try{c.setSinkId(u).catch(m=>{x.warning("[".concat(r,"] set sink id failed"),m.toString())})}catch(m){x.warning("[".concat(r,"] set sink id failed"),m.toString())}const h=c.play();h&&h.then&&h.catch(m=>{o&&qW(o,"audio",m.message,r),x.warning("audio element play warning",m.toString()),this.elementMap.has(r)&&m.name==="NotAllowedError"&&(x.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(c),FA(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),KW()}))})}updateTrack(e,r){const s=this.elementMap.get(e);s&&(s.srcObject=new MediaStream([r]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,r){const s=this.elementMap.get(e);s&&(r=Math.max(0,Math.min(100,r)),s.volume=r/100)}stop(e){const r=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!r)return;const s=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(s,1),r.srcObject=null,r.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,r){Wfe.forEach(s=>{r.addEventListener(s,o=>{const c=this.elementStateMap.get(e),u=o.type==="pause"?"paused":o.type;if(x.debug("[".concat(e,"] audio-element-status change ").concat(c," => ").concat(u)),o.type==="error"){const h=r==null?void 0:r.error;h&&x.error("[".concat(e,"] media error, code: ").concat(h.code,", message: ").concat(h.message))}this.elementStateMap.set(e,u)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(s=>{x.debug("Auto resume audio element success")}).catch(s=>{x.warning("Auto resume audio element failed!",s)})}),this.elementsNeedToResume=[]};new ht(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{ET()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function ai(){return function(e,r,s){const o=s.value;return typeof o=="function"&&(s.value=function(){this._isClosed&&new Le(te.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",x);for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];const m=o.apply(this,u);return m instanceof ht?new ht((y,E)=>{m.then(y).catch(E)}):m}),s}}class YW extends jr{constructor(r){super(),Ie(this,"name","VideoProcessorDestination"),Ie(this,"ID","0"),Ie(this,"_source",void 0),Ie(this,"videoContext",void 0),Ie(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Le(te.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Le(te.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit($o.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit($o.ON_TRACK,void 0)}}class XW extends jr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s){super(),Ie(this,"constraintsMap",new Map),Ie(this,"statsRegistry",[]),Ie(this,"usageRegistry",[]),Ie(this,"trackId",void 0),Ie(this,"direction",void 0),Ie(this,"_chained",!1),this.trackId=r,this.direction=s}async getConstraints(){return await Os(this,nl.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,s){var o;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),hr(this,nl.REQUEST_UPDATE_CONSTRAINTS,Array.from(Xc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return x.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),hr(this,nl.REQUEST_UPDATE_CONSTRAINTS,Array.from(Xc(s=this.constraintsMap).call(s)))}registerStats(r,s,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:o})}unregisterStats(r,s){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:s,processorName:o,type:c,stats:h})}catch(h){x.error(new Le(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let o=s();o instanceof ht&&(o=await o),r.push(Mr(Mr({},o),{},{direction:this.direction}))}catch(o){x.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class JW extends jr{constructor(r){super(),Ie(this,"name","AudioProcessorDestination"),Ie(this,"ID","0"),Ie(this,"inputTrack",void 0),Ie(this,"inputNode",void 0),Ie(this,"audioProcessorContext",void 0),Ie(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Le(te.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Le(te.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit($o.ON_TRACK,void 0),this.emit($o.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit($o.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit($o.ON_NODE,this.inputNode))}}class QW extends jr{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,s,o){super(),Ie(this,"constraintsMap",new Map),Ie(this,"statsRegistry",[]),Ie(this,"audioContext",void 0),Ie(this,"trackId",void 0),Ie(this,"direction",void 0),Ie(this,"usageRegistry",[]),Ie(this,"_chained",!1),this.audioContext=r,this.trackId=s,this.direction=o}async getConstraints(){return Os(this,nl.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,s){var o;return x.info("processor ".concat(s.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(s,r),hr(this,nl.REQUEST_UPDATE_CONSTRAINTS,Array.from(Xc(o=this.constraintsMap).call(o)))}async requestRevertConstraints(r){var s;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),hr(this,nl.REQUEST_UPDATE_CONSTRAINTS,Array.from(Xc(s=this.constraintsMap).call(s)))}registerStats(r,s,o){this.statsRegistry.find(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:s,cb:o})}unregisterStats(r,s){const o=this.statsRegistry.findIndex(c=>c.processorID===r.ID&&c.processorName===r.name&&c.type===s);o!==-1&&this.statsRegistry.splice(o,1)}gatherStats(){const r=[];for(const{processorID:s,processorName:o,type:c,cb:u}of this.statsRegistry)try{const h=u();r.push({processorID:s,processorName:o,type:c,stats:h})}catch(h){x.error(new Le(te.UNEXPECTED_ERROR,h.message))}return r}registerUsage(r,s){this.usageRegistry.find(o=>o.processorID===r.ID&&o.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:s})}unregisterUsage(r){const s=this.usageRegistry.findIndex(o=>o.processorID===r.ID&&o.processorName===r.name);s!==-1&&this.usageRegistry.splice(s,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:s}of this.usageRegistry)try{let o=s();o instanceof ht&&(o=await o),r.push(Mr(Mr({},o),{},{direction:this.direction}))}catch(o){x.error("gather extension usage error",o)}return r}getDirection(){return this.direction}}class vL extends jr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Ie(this,"context",void 0),Ie(this,"processSourceNode",void 0),Ie(this,"outputTrack",void 0),Ie(this,"processedNode",void 0),Ie(this,"clonedTrack",void 0),Ie(this,"outputNode",void 0),this.outputNode=new Gfe}setVolume(){}createOutputTrack(){throw new Le(te.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Gfe{disconnect(){}connect(){}}function ZW(e){return new ht((r,s)=>{let o=!1;const c=document.createElement("video");c.setAttribute("autoplay",""),c.setAttribute("muted",""),c.muted=!0,c.autoplay=!0,c.setAttribute("playsinline",""),c.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(c);const u=Ho()?"canplay":"playing";c.addEventListener(u,()=>{const h=c.videoWidth,m=c.videoHeight;!h&&Wr()||(o=!0,c.srcObject=null,c.remove(),r([h,m]))}),c.srcObject=new MediaStream([e]),c.play().catch(BA),setTimeout(()=>{o||(c.srcObject=null,c.remove(),r([c.videoWidth,c.videoHeight]))},4e3)})}function QA(e){const r={};e.facingMode&&(r.facingMode=e.facingMode),e.cameraId&&(r.deviceId={exact:e.cameraId});const s=Ah(e.encoderConfig);return s.width!=null&&(r.width=s.width),s.height!=null&&(r.height=s.height),!Jz()&&s.frameRate&&(r.frameRate=s.frameRate),Wz()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),Wr()&&(r.frameRate={ideal:30,max:30}),r}function e8(e){const r={};return Jz()||(e.AGC!==void 0&&(r.autoGainControl=e.AGC),e.AEC!==void 0&&(r.echoCancellation=e.AEC),e.ANS!==void 0&&(r.noiseSuppression=e.ANS,of()&&e.ANS&&(r.googHighpassFilter=e.ANS))),r}function t8(e){const r=e8(e);if(e.encoderConfig){const s=YA(e.encoderConfig);r.channelCount=s.stereo?2:1,r.sampleRate=s.sampleRate,r.sampleSize=s.sampleSize}return e.microphoneId&&(r.deviceId={exact:e.microphoneId}),VA()&&(r.sampleRate=void 0),r}const Hfe=e=>{const r=e._encoderConfig;if(!r)return;const{frameRate:s,width:o,height:c}=e.getMediaStreamTrackSettings();let{frameRate:u=s,width:h=o,height:m=c}=r;if(!u||!h||!m)return;h=Xx(h),m=Xx(m),u=Xx(u);const{max:y,min:E}=function(D,G,j){const B=200*Math.pow(j/15,.6)*Math.pow(D*G/640/360,.75);return{min:Math.floor(B),max:Math.floor(4*B)}}(h,m,u),{bitrateMax:S,bitrateMin:R}=r||{};S||x.debug("calculate bitrate: [w: ".concat(h,", h: ").concat(m,", fps: ").concat(u,"] => [brMax: ").concat(S,", brMin: ").concat(R,"]"));const{maxFramerate:P}=oe("ENCODER_CONFIG_LIMIT");return P&&typeof P=="number"&&(u=Math.min(u,P)),{frameRate:u,bitrateMax:S||y,bitrateMin:R||E,scaleResolutionDownBy:1,scale:0}},n8=async(e,r,s)=>await(async(o,c,u)=>{const h=function(E){const S=[];for(let R=0;R<E.length;R+=2)S.push(parseInt(E.slice(R,R+2),16));return Uint8Array.from(S)}(pW(""+c+u)).slice(0,16),m=h.slice(0,12),y=await window.crypto.subtle.importKey("raw",h,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:m},y,o))})(e.buffer,r,s),SL=e=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new ht((s,o)=>{r.toBlob(async c=>{if(r.remove(),c){const u=await r8(c);s({buffer:u,width:r.width,height:r.height})}else o(new Le(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},r8=async e=>{const r=await e.arrayBuffer();return new Uint8Array(r)};var i8,s8,o8,a8,c8,l8,u8,d8,h8,p8,f8,m8,g8,_8,y8,E8,v8,S8,Fr,b8,T8,w8,C8,R8,I8,Oh,A8,P8,O8,k8,N8,D8,x8,L8,M8,U8,V8,j8,F8,Ns;let Xr=(i8=Ht({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),s8=Ht({argsMap:(e,r)=>[e.getTrackId(),r]}),o8=ai(),a8=Fv("LocalAudioTrack","_enabledMutex"),c8=Ht({argsMap:(e,r)=>[e.getTrackId(),r]}),l8=ai(),u8=Fv("LocalAudioTrack","_enabledMutex"),d8=Ht({argsMap:(e,r)=>[e.getTrackId(),r]}),h8=ai(),p8=ai(),f8=ai(),m8=Ht({argsMap:e=>[e.getTrackId()]}),g8=ai(),_8=Ht({argsMap:e=>[e.getTrackId()]}),y8=ai(),E8=Ht({argsMap:e=>[e.getTrackId()]}),v8=Ht({argsMap:(e,r)=>[e.getTrackId(),r.name]}),S8=Ht({argsMap:e=>[e.getTrackId()]}),Mn((Fr=class extends Yv{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?ya.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,r,s,o){super(e,s),Ie(this,"trackMediaType",qv.AUDIO),Ie(this,"_encoderConfig",void 0),Ie(this,"_trackSource",void 0),Ie(this,"metadata",[]),Ie(this,"_enabled",!0),Ie(this,"_volume",100),Ie(this,"_useAudioElement",!0),Ie(this,"_bypassWebAudio",!1),Ie(this,"processor",void 0),Ie(this,"_processorContext",void 0),Ie(this,"_processorDestination",void 0),Ie(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!o,this._trackSource=new vL,oe("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),oe("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),As()&&!rl?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){cr(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&ya.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void x.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,hr(this,Rt.NEED_REPLACE_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),s)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!NW())throw new Le(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ya.setSinkID(this.getTrackId(),e)}async setEnabled(e,r,s){return this._setEnabled(e,r,s)}async _setEnabled(e,r,s){if(!s){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{s||(this._enabled=!0),await hr(this,Rt.NEED_ENABLE_TRACK,this),x.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(o){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}}else{this._originMediaStreamTrack.enabled=!1,s||(this._enabled=!1);try{await hr(this,Rt.NEED_DISABLE_TRACK,this)}catch(o){throw s||(this._enabled=!0),x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await hr(this,Rt.NEED_MUTE_TRACK,this):await hr(this,Rt.NEED_UNMUTE_TRACK,this))}getStats(){return zm(()=>{x.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Qc(this,Rt.GET_STATS)||Mr({},pL)}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(tl.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(tl.ON_AUDIO_BUFFER),this._source.on(tl.ON_AUDIO_BUFFER,s=>e(s))}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] start audio playback in element")),ya.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?ya.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ya.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,r){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await hr(this,Rt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return ht.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Le(te.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(e){e.on($o.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await hr(this,Rt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await hr(this,Rt.NEED_REPLACE_TRACK,this))}),e.on($o.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(e){e.removeAllListeners($o.ON_TRACK),e.removeAllListeners($o.ON_NODE)}bindProcessorContextEvents(e){e.on(nl.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(nl.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof vL&&(this._trackSource=new zW(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new QW(this._source.context,this.getTrackId(),"local"),r=new JW(e);return this._processorContext=e,this._processorDestination=r,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(r),this._source.on(tl.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(ya.stop(this.getTrackId()),this._source.play()),hr(this,Rt.NEED_REPLACE_MIXING_TRACK,this).then(()=>{x.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(s=>{x.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),s)})),{processorContext:e,processorDestination:r}}}).prototype,"setVolume",[i8],Object.getOwnPropertyDescriptor(Fr.prototype,"setVolume"),Fr.prototype),Mn(Fr.prototype,"setPlaybackDevice",[s8,o8],Object.getOwnPropertyDescriptor(Fr.prototype,"setPlaybackDevice"),Fr.prototype),Mn(Fr.prototype,"setEnabled",[a8,c8,l8],Object.getOwnPropertyDescriptor(Fr.prototype,"setEnabled"),Fr.prototype),Mn(Fr.prototype,"setMuted",[u8,d8,h8],Object.getOwnPropertyDescriptor(Fr.prototype,"setMuted"),Fr.prototype),Mn(Fr.prototype,"getStats",[p8],Object.getOwnPropertyDescriptor(Fr.prototype,"getStats"),Fr.prototype),Mn(Fr.prototype,"setAudioFrameCallback",[f8],Object.getOwnPropertyDescriptor(Fr.prototype,"setAudioFrameCallback"),Fr.prototype),Mn(Fr.prototype,"play",[m8,g8],Object.getOwnPropertyDescriptor(Fr.prototype,"play"),Fr.prototype),Mn(Fr.prototype,"stop",[_8,y8],Object.getOwnPropertyDescriptor(Fr.prototype,"stop"),Fr.prototype),Mn(Fr.prototype,"close",[E8],Object.getOwnPropertyDescriptor(Fr.prototype,"close"),Fr.prototype),Mn(Fr.prototype,"pipe",[v8],Object.getOwnPropertyDescriptor(Fr.prototype,"pipe"),Fr.prototype),Mn(Fr.prototype,"unpipe",[S8],Object.getOwnPropertyDescriptor(Fr.prototype,"unpipe"),Fr.prototype),Fr),ZA=(b8=Ht({argsMap:(e,r)=>[e.getTrackId(),r]}),T8=ai(),w8=Fv("MicrophoneAudioTrack","_enabledMutex"),C8=Ht({argsMap:(e,r,s)=>[e.getTrackId(),r,s]}),R8=ai(),I8=Ht({argsMap:e=>[e.getTrackId()]}),Mn((Oh=class extends Xr{get __className__(){return"MicrophoneAudioTrack"}constructor(e,r,s,o){super(e,r.encoderConfig?YA(r.encoderConfig):{},o,oe("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Ie(this,"_config",void 0),Ie(this,"_deviceName","default"),Ie(this,"_constraints",void 0),Ie(this,"_originalConstraints",void 0),Ie(this,"_enabled",!0),this._config=r,this._constraints=s,this._originalConstraints=s,this._deviceName=e.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(Uv()||zx())&&or.bindInterruptDetectorTrack(this)}async setDevice(e){if(x.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const r=await sl.getDeviceById(e),s={};s.audio=Mr({},this._constraints),s.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let o=null;try{o=await il(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),c.toString()),o=await il({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await sl.getDeviceById(e);this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}x.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,r,s){if(r)return x.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!s){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),e),oe("AUTO_RESET_AUDIO_ROUTE")&&(Ho()||wu())){const h=navigator.audioSession;h&&(e||(h.type="playback"),h.type="auto")}if(!e){var o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(o=this._source.clonedTrack)===null||o===void 0||o.stop(),s||(this._enabled=!1);try{await hr(this,Rt.NEED_DISABLE_TRACK,this)}catch(h){throw x.error("[".concat(this.getTrackId(),"] setEnabled false failed"),h.toString()),h}return}const c=Mr({},this._constraints),u=sl.searchDeviceIdByName(this._deviceName);u&&!c.deviceId&&(c.deviceId=u);try{s||(this._enabled=!0);const h=await il({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(h.getAudioTracks()[0],!1),await hr(this,Rt.NEED_ENABLE_TRACK,this)}catch(h){throw s||(this._enabled=!1),x.error("[".concat(this.getTrackId(),"] setEnabled true failed"),h.toString()),h}x.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Uv()||zx())&&or.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Ho()||wu())&&this._enabled&&!this._isClosed&&or.duringInterruption){const e=async()=>{or.off(ms.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};or.on(ms.IOS_INTERRUPTION_END,e)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit($v.TRACK_ENDED)}async renewMediaStreamTrack(e){const r=e||this._constraints,s=sl.searchDeviceIdByName(this._deviceName);if(s&&!r.deviceId&&(r.deviceId=s),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const o=await il({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(nl.REQUEST_UPDATE_CONSTRAINTS,async(r,s,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){o(c)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(nl.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[b8,T8],Object.getOwnPropertyDescriptor(Oh.prototype,"setDevice"),Oh.prototype),Mn(Oh.prototype,"setEnabled",[w8,C8,R8],Object.getOwnPropertyDescriptor(Oh.prototype,"setEnabled"),Oh.prototype),Mn(Oh.prototype,"close",[I8],Object.getOwnPropertyDescriptor(Oh.prototype,"close"),Oh.prototype),Oh),$fe=(A8=Ht({argsMap:(e,r)=>[e.getTrackId(),r,e.duration]}),P8=ai(),O8=Ht({argsMap:e=>[e.getTrackId()]}),k8=ai(),N8=Ht({argsMap:e=>[e.getTrackId()]}),D8=ai(),x8=Ht({argsMap:e=>[e.getTrackId()]}),L8=ai(),M8=Ht({argsMap:e=>[e.getTrackId()]}),U8=ai(),V8=Ht({argsMap:e=>[e.getTrackId()]}),j8=Ht({argsMap:e=>[e.getTrackId()]}),F8=ai(),Mn((Ns=class extends Xr{get __className__(){return"BufferSourceAudioTrack"}constructor(e,r,s,o){super(r.createOutputTrack(),s,o),Ie(this,"source",void 0),Ie(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=r,this._bufferSource.on(tl.AUDIO_SOURCE_STATE_CHANGE,c=>{this.safeEmit($v.SOURCE_STATE_CHANGE,c)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){cr(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[A8,P8],Object.getOwnPropertyDescriptor(Ns.prototype,"startProcessAudioBuffer"),Ns.prototype),Mn(Ns.prototype,"pauseProcessAudioBuffer",[O8,k8],Object.getOwnPropertyDescriptor(Ns.prototype,"pauseProcessAudioBuffer"),Ns.prototype),Mn(Ns.prototype,"seekAudioBuffer",[N8,D8],Object.getOwnPropertyDescriptor(Ns.prototype,"seekAudioBuffer"),Ns.prototype),Mn(Ns.prototype,"resumeProcessAudioBuffer",[x8,L8],Object.getOwnPropertyDescriptor(Ns.prototype,"resumeProcessAudioBuffer"),Ns.prototype),Mn(Ns.prototype,"stopProcessAudioBuffer",[M8,U8],Object.getOwnPropertyDescriptor(Ns.prototype,"stopProcessAudioBuffer"),Ns.prototype),Mn(Ns.prototype,"close",[V8],Object.getOwnPropertyDescriptor(Ns.prototype,"close"),Ns.prototype),Mn(Ns.prototype,"setAudioBufferPlaybackSpeed",[j8,F8],Object.getOwnPropertyDescriptor(Ns.prototype,"setAudioBufferPlaybackSpeed"),Ns.prototype),Ns);class Mi extends Xr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=Xv().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,pr(8,"track-mix-")),Ie(this,"trackList",void 0),Ie(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(x.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):x.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){x.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}jA(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(s=>{s._encoderConfig&&((s._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=s._encoderConfig.bitrate),(s._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=s._encoderConfig.sampleRate),(s._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=s._encoderConfig.sampleSize),s._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(s=>{s instanceof Mi?s.emit(G_.TRANSCEIVER_UPDATED,r):s._updateRtpTransceiver(r)}))}}class Kfe extends BW{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(tl.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Ie(this,"audioBuffer",void 0),Ie(this,"sourceNode",void 0),Ie(this,"startPlayTime",0),Ie(this,"startPlayOffset",0),Ie(this,"pausePlayTime",0),Ie(this,"options",void 0),Ie(this,"currentLoopCount",0),Ie(this,"currentPlaybackSpeed",100),Ie(this,"_currentState","stopped"),this.audioBuffer=r,this.options=s,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):x.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const B8=new Map;class bL{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const r=this.renderStats.curTs-this.renderStats.lastTs,s=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/r;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,s}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(r){r!==this._videoElementStatus&&(x.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var s;r!==this._videoState&&(this._videoState=r,(s=this.onVideoStateChanged)===null||s===void 0||s.call(this,this.videoState))}constructor(r){Ie(this,"trackId",void 0),Ie(this,"config",void 0),Ie(this,"onFirstVideoFrameDecoded",void 0),Ie(this,"onVideoStateChanged",void 0),Ie(this,"freezeTimeCounterList",[]),Ie(this,"renderFreezeAccTime",0),Ie(this,"isKeepLastFrame",!1),Ie(this,"timeUpdatedCount",0),Ie(this,"freezeTime",0),Ie(this,"playbackTime",0),Ie(this,"lastTimeUpdatedTime",0),Ie(this,"autoplayFailed",!1),Ie(this,"videoTrack",void 0),Ie(this,"videoElement",void 0),Ie(this,"cacheVideoElement",void 0),Ie(this,"renderStats",void 0),Ie(this,"_videoState",Ph.VideoStateStopped),Ie(this,"videoElementCheckInterval",void 0),Ie(this,"videoElementFreezeTimeout",void 0),Ie(this,"_videoElementStatus",Co.NONE),Ie(this,"isGettingVideoDimensions",!1),Ie(this,"startGetVideoDimensions",()=>{const s=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return x.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(s,500)};!this.isGettingVideoDimensions&&s()}),Ie(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&or.curState==="running"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(zz())),Yz()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Ie(this,"handleVideoEvents",s=>{switch(s.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Co.PLAYING;break;case"loadeddata":if(this.videoState=Ph.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Co.CANPLAY;break;case"stalled":this.videoElementStatus=Co.STALLED;break;case"suspend":this.videoElementStatus=Co.SUSPEND;break;case"pause":this.videoElementStatus=Co.PAUSED,Ho()||wu()||As()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Co.WAITING;break;case"abort":this.videoElementStatus=Co.ABORT;break;case"ended":this.videoElementStatus=Co.ENDED;break;case"emptied":this.videoElementStatus=Co.EMPTIED;break;case"error":{const o=this.videoElement.error;o&&(this.videoElementStatus=Co.ERROR,x.error("[".concat(this.trackId,"] media error: ").concat(o.message," (").concat(o.code,")")));break}case"timeupdate":{const o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=o);const c=o-this.lastTimeUpdatedTime,u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=o,uf.lastVisibleTime<uf.lastHiddenTime||u<uf.lastHiddenTime||u<uf.lastVisibleTime)return;for(c>oe("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=c),this.playbackTime+=c;this.playbackTime>=6e3;){this.playbackTime-=6e3;const h=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(h),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Ie(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(x.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(zz())),Yz()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),or.on(ms.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),or.on(ms.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const s=this.videoElement.play();s&&s.catch&&s.catch(c=>{r&&qW(r,"video",c.message,this.trackId),c.name==="NotAllowedError"?(x.warning("detected video element autoplay failed",c),this.autoplayFailed=!0,this.handleAutoPlayFailed()):x.warning("[".concat(this.trackId,"] play warning: "),c)});const o=xn();if((o.name==="Safari"&&Number(o.version)===15||Uv())&&s&&s.then){const c=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};s.then(c).catch(c)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const s=r.getContext("2d");if(!s)return x.error("create canvas context failed!"),new ImageData(2,2);s.drawImage(this.videoElement,0,0,r.width,r.height);const o=s.getImageData(0,0,r.width,r.height);return r.remove(),o}async getCurrentFrameToUint8Array(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=document.createElement("canvas");o.width=this.videoElement.videoWidth,o.height=this.videoElement.videoHeight;const c=o.getContext("2d");return c?(c.drawImage(this.videoElement,0,0,o.width,o.height),new ht((u,h)=>{o.toBlob(async m=>{if(o.remove(),m){const y=await r8(m);u({buffer:y,width:o.width,height:o.height})}else h(new Le(te.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,s<0?.1:s>1?1:s)})):await SL(r)}destroy(){this.renderStats=void 0,or.off(ms.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),or.off(ms.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Ph.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Co.INIT,!this.videoElementCheckInterval&&(z8.forEach(u=>{this.videoElement.addEventListener(u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(u){return u!==document.body&&document.body.contains(u)})(this.videoElement)||(this.videoElementStatus=Co.DESTROYED)},1e3),oe("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,s;let u;const h=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",h),this.videoElementFreezeTimeout=window.setTimeout(m,oe("VIDEO_FREEZE_DURATION")))},m=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Ph.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Ph.VideoStateFrozen:document.addEventListener("visibilitychange",h))},y=(E,S)=>{if(this.videoElementStatus===Co.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=S.mediaTime):this.renderStats={lastTs:S.mediaTime,curTs:S.mediaTime,lastRenderNum:0,renderNum:0},u){const D=S.presentationTime-u.presentationTime;this.videoState===Ph.VideoStateStarting&&(this.videoState=Ph.VideoStateDecoding),this.videoState===Ph.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(m,oe("VIDEO_FREEZE_DURATION"))),D<oe("VIDEO_FREEZE_DURATION")&&this.videoState===Ph.VideoStateFrozen&&(this.videoState=Ph.VideoStateDecoding),D>oe("VIDEO_FREEZE_DURATION")&&uf.lastVisibleTime>=uf.lastHiddenTime&&u.timestamp>uf.lastVisibleTime&&u.timestamp>uf.lastHiddenTime&&(this.renderFreezeAccTime+=D)}u=Mr(Mr({},S),{},{timestamp:E})}var R,P;oe("ENABLE_VIDEO_FRAME_CALLBACK")&&((R=(P=this.videoElement).requestVideoFrameCallback)===null||R===void 0||R.call(P,y))};(r=(s=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(s,y)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),VA()&&!oe("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const o=xn();o.name==="Safari"&&Number(o.version)===15||Uv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Wr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Wr()&&this.videoElement.load());const c=this.videoElement.play();c!==void 0&&c.catch(u=>{x.debug("[".concat(this.trackId,"] playback interrupted"),u.toString())})}resetVideoElement(){z8.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Co.NONE}handleAutoPlayFailed(){const r=s=>{s.preventDefault(),this.videoElement.play().then(()=>{x.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(o=>{x.error(o)}),this.autoplayFailed=!1,ET()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};ET()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),KW()}}const z8=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class W8 extends bL{constructor(r){super(r),Ie(this,"container",void 0),Ie(this,"slot",void 0),this.slot=r.element,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const s=r.element;s!==this.slot&&(this.destroy(),this.slot=s),this.createElements()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var s;(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var s;let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(s=this.container)!==null&&s!==void 0&&s.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,o):await SL(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",oe("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var G8,H8,$8,K8,q8,Y8,X8,J8,Q8,Z8,eG,tG,nG,rG,iG,sG,oG,aG,cG,lG,uG,dG,hG,pG,On,fG,mG,gG,_G,yG,EG,vG,SG,al;let Cr=(G8=Ht({argsMap:(e,r,s)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),H8=ai(),$8=Ht({argsMap:e=>[e.getTrackId()]}),K8=Fv("LocalVideoTrack","_enabledMutex"),q8=Ht({argsMap:(e,r)=>[e.getTrackId(),r]}),Y8=ai(),X8=Fv("LocalVideoTrack","_enabledMutex"),J8=Ht({argsMap:(e,r)=>[e.getTrackId(),r]}),Q8=ai(),Z8=Ht({argsMap:(e,r)=>[e.getTrackId(),r]}),eG=ai(),tG=ai(),nG=Ht({argsMap:(e,r,s)=>[e.getTrackId(),r,s]}),rG=ai(),iG=ai(),sG=ai(),oG=ai(),aG=ai(),cG=ai(),lG=ai(),uG=Ht({argsMap:(e,r)=>[e.getTrackId(),r.name]}),dG=Ht({argsMap:e=>[e.getTrackId()]}),hG=Ht({argsMap:e=>[e.getTrackId()]}),pG=Ht({argsMap:(e,r,s)=>[e.getTrackId(),r.label,s]}),On=class Ooe extends Yv{get videoHeight(){if(As()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(As()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Co.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,s,o,c,u,h){if(super(r,u),Ie(this,"trackMediaType",qv.VIDEO),Ie(this,"_player",void 0),Ie(this,"isUseScaleResolutionDownBy",!1),Ie(this,"_videoVisibleTimer",null),Ie(this,"_previousVideoVisibleStatus",void 0),Ie(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ie(this,"_encoderConfig",void 0),Ie(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Ie(this,"_optimizationMode",void 0),Ie(this,"_videoHeight",void 0),Ie(this,"_videoWidth",void 0),Ie(this,"_forceBitrateLimit",void 0),Ie(this,"_enabled",!0),Ie(this,"_processorDestination",void 0),Ie(this,"_processorContext",void 0),As()){const{width:m,height:y}=r.getSettings();this._videoWidth=m,this._videoHeight=y}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=s,this._scalabilityMode=o,this._optimizationMode=c,this._hints=h||[],this._hints.indexOf(fr.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(jx(Hn.CHROME,115)&&MA().indexOf("Windows")!==-1){const m=function(y,E){if("VideoFrame"in window&&"TransformStream"in window&&Fn().supportWebRTCInsertableStream){const S=new MediaStreamTrackProcessor(y),R=new MediaStreamTrackGenerator({kind:"video"});let P,D,G=Date.now();const j=()=>{B&&(clearInterval(B),B=void 0),P&&(P.close(),P=void 0),y.stop(),D=void 0,R.removeEventListener("ended",j)};let B=window.setInterval(()=>{if(D&&P&&Date.now()-G>1e3)try{R.readyState==="live"?D.enqueue(P.clone()):j()}catch{j()}},1e3);const Y=new TransformStream({transform:(ee,fe)=>{R.readyState==="live"?(D=fe,G=Date.now(),P===void 0?(P=ee,fe.enqueue(ee.clone())):(fe.enqueue(P),P=ee)):ee.close()}});return R.addEventListener("ended",j),S.readable.pipeThrough(Y).pipeTo(R.writable),R}}(r);m&&(x.info("local screen video track begin to inject frame"),this._mediaStreamTrack=m)}s&&this._hints.indexOf(fr.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(s),this._processorContext=new XW(this.getTrackId(),"local"),this._processorDestination=new YW(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const c=document.getElementById(r);c?r=c:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(s));const o=Mr(Mr(Mr({},this._getDefaultPlayerConfig()),s),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(o):(r instanceof HTMLVideoElement?this._player=new bL(o):this._player=new W8(o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const c=this.getVideoElementVisibleStatus();this.safeEmit($v.VIDEO_ELEMENT_VISIBLE_STATUS,c)}catch{}},oe("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await hr(this,Rt.NEED_DISABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}return s||(this._enabled=!1),void x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await hr(this,Rt.NEED_ENABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to true error"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,x.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await hr(this,Rt.NEED_MUTE_TRACK,this):await hr(this,Rt.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=Ah(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const o=QA({encoderConfig:r});(As()||Ho()||wu())&&(o.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(o));try{await this._originMediaStreamTrack.applyConstraints(o),this.updateMediaStreamTrackResolution()}catch(c){const u=new Le(te.UNEXPECTED_ERROR,c.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),u.toString()),u}}this._encoderConfig=r,this._hints.indexOf(fr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await hr(this,Rt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(x)}}getStats(){return zm(()=>{x.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Qc(this,Rt.GET_STATS)||Mr({},fL)}async setBeautyEffect(r){x.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,s):await SL(r)}async setBitrateLimit(r){x.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void x.error(te.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const s=this._optimizationMode;try{this._optimizationMode=r,await hr(this,Rt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(o){throw this._optimizationMode=s,x.error("[".concat(this.getTrackId(),"] set optimization mode failed"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return x.error(te.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,x.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){ZW(this._originMediaStreamTrack).then(r=>{let[s,o]=r;this._videoHeight=o,this._videoWidth=s}).catch(BA)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");x.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=Ah(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(fr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await hr(this,Rt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(x)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:s,frameRate:o}=this.getMediaStreamTrackSettings();if(!r||!s||!o)return;const{bitrateMax:c,bitrateMin:u}=this._encoderConfig;if(u==null||c==null){const{max:h,min:m}=function(y,E,S,R,P){const D=oe("BITRATE_ADAPTER_TYPE");if(D==="DEFAULT_BITRATE")return{min:R,max:P};if(P===void 0){var G;const B=Math.floor(200*Math.pow(S/15,.6)*Math.pow(y*E/640/360,.75));P=D==="STANDARD_BITRATE"?4*B:2*B,R=(G=R)!==null&&G!==void 0?G:B}else{var j;R=(j=R)!==null&&j!==void 0?j:Math.floor(P/10)}return{min:R,max:P}}(r,s,o,u,c);this._encoderConfig.bitrateMin=m,this._encoderConfig.bitrateMax=h,x.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(s,", fps: ").concat(o,"] => [brMax: ").concat(h,", brMin: ").concat(m,"]"))}}getVideoElementVisibleStatus(){try{var r,s;const o=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),c={track:this,element:this==null||(s=this._player)===null||s===void 0?void 0:s.getVideoElement(),slot:o==null?void 0:o.parentElement},{element:u,slot:h}=c;if(this.isPlaying&&u instanceof HTMLVideoElement&&h instanceof HTMLElement){const m=eW.checkOneElementVisible(u),y=Object.assign({},m);if(y.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=y.visible;const E=Nt.reportApiInvoke(null,{tag:Hr.TRACER,name:Ai.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});y.visible?E.onSuccess("Video is visible"):E.onSuccess("Invisible because of ".concat(y.reason))}return y}return}catch(o){throw new Le(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,o.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Mr(Mr({},o),Ah(r))),o=F_(o);const c=pr(8,"track-video-cloned-"),u=new Ooe(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,o,F_(this._scalabilityMode),this._optimizationMode,c,F_(this._hints));return r&&o&&u.setEncoderConfiguration(o),x.debug("clone video track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),u}async replaceTrack(r,s){if(!(r instanceof MediaStreamTrack))throw new Le(te.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new Le(te.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,s,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(zm(()=>{Nt.reportApiInvoke(null,{name:Ai.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Hr.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!oe("ENABLE_VIDEO_SEI")||!oe("ENABLE_ENCODED_TRANSFORM"))return void x.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new Le(te.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const s=this.getRTCRtpTransceiver();if(!s)return void x.warning("Video track is not published, SEI can not be send");const o=s.sender.getParameters();if(o.codecs.length===0)return;const c=o.codecs[0].mimeType.toLocaleLowerCase();c==="video/h264"?this.safeEmit("sei-to-send",r):x.warning("SEI is not supported by ".concat(c))}bindProcessorDestinationEvents(){this.processorDestination.on($o.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await hr(this,Rt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await hr(this,Rt.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners($o.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(nl.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(nl.REQUEST_CONSTRAINTS)}},Mn(On.prototype,"play",[G8,H8],Object.getOwnPropertyDescriptor(On.prototype,"play"),On.prototype),Mn(On.prototype,"stop",[$8],Object.getOwnPropertyDescriptor(On.prototype,"stop"),On.prototype),Mn(On.prototype,"setEnabled",[K8,q8,Y8],Object.getOwnPropertyDescriptor(On.prototype,"setEnabled"),On.prototype),Mn(On.prototype,"setMuted",[X8,J8,Q8],Object.getOwnPropertyDescriptor(On.prototype,"setMuted"),On.prototype),Mn(On.prototype,"setEncoderConfiguration",[Z8,eG],Object.getOwnPropertyDescriptor(On.prototype,"setEncoderConfiguration"),On.prototype),Mn(On.prototype,"getStats",[tG],Object.getOwnPropertyDescriptor(On.prototype,"getStats"),On.prototype),Mn(On.prototype,"setBeautyEffect",[nG,rG],Object.getOwnPropertyDescriptor(On.prototype,"setBeautyEffect"),On.prototype),Mn(On.prototype,"getCurrentFrameData",[iG],Object.getOwnPropertyDescriptor(On.prototype,"getCurrentFrameData"),On.prototype),Mn(On.prototype,"getCurrentFrameImage",[sG],Object.getOwnPropertyDescriptor(On.prototype,"getCurrentFrameImage"),On.prototype),Mn(On.prototype,"setBitrateLimit",[oG],Object.getOwnPropertyDescriptor(On.prototype,"setBitrateLimit"),On.prototype),Mn(On.prototype,"setOptimizationMode",[aG],Object.getOwnPropertyDescriptor(On.prototype,"setOptimizationMode"),On.prototype),Mn(On.prototype,"setScalabiltyMode",[cG],Object.getOwnPropertyDescriptor(On.prototype,"setScalabiltyMode"),On.prototype),Mn(On.prototype,"updateMediaStreamTrackResolution",[lG],Object.getOwnPropertyDescriptor(On.prototype,"updateMediaStreamTrackResolution"),On.prototype),Mn(On.prototype,"pipe",[uG],Object.getOwnPropertyDescriptor(On.prototype,"pipe"),On.prototype),Mn(On.prototype,"unpipe",[dG],Object.getOwnPropertyDescriptor(On.prototype,"unpipe"),On.prototype),Mn(On.prototype,"close",[hG],Object.getOwnPropertyDescriptor(On.prototype,"close"),On.prototype),Mn(On.prototype,"replaceTrack",[pG],Object.getOwnPropertyDescriptor(On.prototype,"replaceTrack"),On.prototype),On),TL=(fG=Ht({argsMap:(e,r)=>[e.getTrackId(),r]}),mG=ai(),gG=Fv("CameraVideoTrack","_enabledMutex"),_G=Ht({argsMap:(e,r)=>[e.getTrackId(),r]}),yG=ai(),EG=Ht({argsMap:(e,r)=>[e.getTrackId(),r]}),vG=ai(),SG=Ht({argsMap:e=>[e.getTrackId()]}),al=class koe extends Cr{get __className__(){return"CameraVideoTrack"}constructor(r,s,o,c,u,h){super(r,Ah(s.encoderConfig),c,u,h),Ie(this,"_config",void 0),Ie(this,"_originalConstraints",void 0),Ie(this,"_constraints",void 0),Ie(this,"_enabled",!0),Ie(this,"_deviceName","default"),Ie(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Uv()||zx())&&!function(){const m=xn();if(m.os!==Yi.IOS||!m.osVersion)return!1;const y=m.osVersion.split(".");return Number(y[0])===15&&Number(y[1])>=2}()&&Xz()&&this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=s,this._originalConstraints=o,this._constraints=o,this._deviceName=r.label,this._encoderConfig=Ah(this._config.encoderConfig),or.on(ms.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),or.on(ms.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(x.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const s=await sl.getDeviceById(r),o={};o.video=Mr({},this._constraints),o.video.deviceId={exact:r},o.video.facingMode=void 0,this._originMediaStreamTrack.stop();let c=null;try{c=await il(o,this.getTrackId())}catch(u){throw x.error("[".concat(this.getTrackId(),"] setDevice failed"),u.toString()),c=await il({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),u}await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}else try{const s=await sl.getDeviceById(r);this._deviceName=s.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(s){throw x.error("[".concat(this.getTrackId(),"] setDevice error"),s.toString()),s}x.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){x.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const s={video:Mr(Mr({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let o=null;try{o=await il(s,this.getTrackId())}catch(c){throw x.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),c.toString()),o=await il({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),c}await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=Mr({},s.video),x.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,s){if(!s){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(x.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const o=await il({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1)}await hr(this,Rt.NEED_ENABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled true error"),o.toString()),o}this.updateMediaStreamTrackResolution(),x.info("[".concat(this.getTrackId(),"] setEnabled to true success")),s||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),s||(this._enabled=!1);try{await hr(this,Rt.NEED_DISABLE_TRACK,this)}catch(o){throw x.error("[".concat(this.getTrackId(),"] setEnabled to false error"),o.toString()),o}x.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,s){if(!this._enabled)throw new Le(te.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=Ah(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const o=$r(this._config);o.encoderConfig=r;const c=QA(o);(As()||Ho()||wu())&&(c.deviceId=void 0),x.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(c));try{await this._originMediaStreamTrack.applyConstraints(c),this.updateMediaStreamTrackResolution()}catch(u){const h=new Le(te.UNEXPECTED_ERROR,u.toString());throw x.error("[".concat(this.getTrackId(),"] applyConstraints error"),h.toString()),h}this._config=o,this._constraints=c,this._originalConstraints=c,this._encoderConfig=r,this._hints.indexOf(fr.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await hr(this,Rt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(u){return u.throw(x)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Ho()||wu())&&this._enabled&&!this._isClosed&&or.duringInterruption){const r=async()=>{or.off(ms.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(x.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};or.on(ms.IOS_INTERRUPTION_END,r)}else x.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit($v.TRACK_ENDED)}async renewMediaStreamTrack(r){const s=r||this._constraints,o=sl.searchDeviceIdByName(this._deviceName);if(o&&!s.deviceId&&(s.deviceId={exact:o}),this._enabled){const c=await il({video:s},this.getTrackId());this._constraints=s,await this._updateOriginMediaStreamTrack(c.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),or.off(ms.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),or.off(ms.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],o=this._encoderConfig;r&&(o=Mr(Mr({},o),Ah(r))),o=F_(o);const c=pr(8,"track-cam-cloned-"),u=new koe(s?this._mediaStreamTrack.clone():this._mediaStreamTrack,F_(Mr(Mr({},this._config),{},{encoderConfig:o})),F_(this._constraints),F_(this._scalabilityMode),this._optimizationMode,c);return r&&o&&u.setEncoderConfiguration(o),x.debug("clone track from ".concat(this.getTrackId()," to ").concat(c,", clone ").concat(s)),u}bindProcessorContextEvents(){this.processorContext.on(nl.REQUEST_UPDATE_CONSTRAINTS,async(r,s,o)=>{try{const c=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(c),s()}catch(c){o(c)}}),this.processorContext.on(nl.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},Mn(al.prototype,"setDevice",[fG,mG],Object.getOwnPropertyDescriptor(al.prototype,"setDevice"),al.prototype),Mn(al.prototype,"setEnabled",[gG,_G,yG],Object.getOwnPropertyDescriptor(al.prototype,"setEnabled"),al.prototype),Mn(al.prototype,"setEncoderConfiguration",[EG,vG],Object.getOwnPropertyDescriptor(al.prototype,"setEncoderConfiguration"),al.prototype),Mn(al.prototype,"close",[SG],Object.getOwnPropertyDescriptor(al.prototype,"close"),al.prototype),al);function wL(e,r,s,o){s.optimizationMode&&(o&&o.width&&o.height?(s.encoderConfig=Mr(Mr({},o),{},{bitrateMin:o.bitrateMin,bitrateMax:o.bitrateMax}),s.optimizationMode!=="motion"&&s.optimizationMode!=="detail"||(r.contentHint=s.optimizationMode,r.contentHint===s.optimizationMode?x.debug("[".concat(e,"] set content hint to"),s.optimizationMode):x.debug("[".concat(e,"] set content hint failed")))):x.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var bG,TG,wG,CG,Ll,RG,IG,AG,PG,OG,kG,Ro;class NG extends VW{getUserId(){return this._userId}constructor(r,s,o,c){super(r,"track-".concat(r.kind,"-").concat(s,"-").concat(c.clientId,"_").concat(pr(5,""))),Ie(this,"_userId",void 0),Ie(this,"_uintId",void 0),Ie(this,"_isDestroyed",!1),Ie(this,"store",void 0),Ie(this,"processor",void 0),Ie(this,"processorContext",void 0),this._userId=s,this._uintId=o,this.store=c}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,x.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Qv=(bG=Ht({argsMap:(e,r,s)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",s]}),TG=Ht({argsMap:e=>[e.getTrackId()]}),wG=Ht({argsMap:(e,r)=>[e.getTrackId(),r.name]}),CG=Ht({argsMap:e=>[e.getTrackId()]}),Mn((Ll=class extends NG{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Co.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,r,s,o){super(e,r,s,o),Ie(this,"_videoVisibleTimer",null),Ie(this,"_previousVideoVisibleStatus",void 0),Ie(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ie(this,"trackMediaType",qv.VIDEO),Ie(this,"_videoWidth",void 0),Ie(this,"_videoHeight",void 0),Ie(this,"_player",void 0),Ie(this,"processorDestination",void 0),Ie(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new XW(this.getTrackId(),"remote"),this.processorDestination=new YW(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return zm(()=>{x.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Qc(this,Rt.GET_STATS)||Mr({},MW)}play(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const o=document.getElementById(e);o?e=o:(x.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}x.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const s=Mr(Mr({fit:"cover"},r),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(s):(e instanceof HTMLVideoElement?this._player=new bL(s):this._player=new W8(s),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Kv.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=o=>{this.safeEmit(Kv.VIDEO_STATE_CHANGED,o)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(Kv.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},oe("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,x.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){ZW(this._originMediaStreamTrack).then(e=>{let[r,s]=e;this._videoHeight=s,this._videoWidth=r}).catch(BA)}_updatePlayerSource(){x.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,r;const s=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),o={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:s==null?void 0:s.parentElement},{element:c,slot:u}=o;if(this.isPlaying&&c instanceof HTMLVideoElement&&u instanceof HTMLElement){const h=eW.checkOneElementVisible(c),m=Object.assign({},h);if(m.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=m.visible;const y=Nt.reportApiInvoke(null,{tag:Hr.TRACER,name:Ai.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});m.visible?y.onSuccess("Video is visible"):y.onSuccess("Invisible because of ".concat(m.reason))}return m}return}catch(s){throw new Le(te.GET_VIDEO_ELEMENT_VISIBLE_ERROR,s.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on($o.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners($o.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(G_.SEI_RECEIVED,e)}}).prototype,"play",[bG],Object.getOwnPropertyDescriptor(Ll.prototype,"play"),Ll.prototype),Mn(Ll.prototype,"stop",[TG],Object.getOwnPropertyDescriptor(Ll.prototype,"stop"),Ll.prototype),Mn(Ll.prototype,"pipe",[wG],Object.getOwnPropertyDescriptor(Ll.prototype,"pipe"),Ll.prototype),Mn(Ll.prototype,"unpipe",[CG],Object.getOwnPropertyDescriptor(Ll.prototype,"unpipe"),Ll.prototype),Ll),Zv=(RG=Ht({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),IG=Ht({argsMap:(e,r)=>[e.getTrackId(),r]}),AG=Ht({argsMap:e=>[e.getTrackId()]}),PG=Ht({argsMap:e=>[e.getTrackId()]}),OG=Ht({argsMap:(e,r)=>[e.getTrackId(),r.name]}),kG=Ht({argsMap:e=>[e.getTrackId()]}),Mn((Ro=class extends NG{get isPlaying(){return this._useAudioElement?ya.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,r,s,o){super(e,r,s,o),Ie(this,"trackMediaType",qv.AUDIO),Ie(this,"_source",void 0),Ie(this,"_useAudioElement",!0),Ie(this,"_volume",100),Ie(this,"processorContext",void 0),Ie(this,"processorDestination",void 0),Ie(this,"_played",!1),Ie(this,"_bypassWebAudio",!1),oe("DISABLE_WEBAUDIO")?(this._source=new vL,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new zW(e,!0),oe("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(tl.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Kv.FIRST_FRAME_DECODED)}),this.processorContext=new QW(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new JW(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(tl.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(tl.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(tl.ON_AUDIO_BUFFER),this._source.on(tl.ON_AUDIO_BUFFER,s=>e(s))}setVolume(e){this._volume=e,this._useAudioElement?ya.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!NW())throw new Le(te.NOT_SUPPORTED,"your browser does not support setting the audio output device");await ya.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return zm(()=>{x.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Qc(this,Rt.GET_STATS)||Mr({},LW)}play(){x.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(x.debug("[".concat(this.getTrackId(),"] use audio element to play")),ya.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){x.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?ya.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];x.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&ya.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Le(te.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on($o.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on($o.ON_NODE,e=>{this._source.processedNode=e;const r=!e;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners($o.ON_TRACK),this.processorDestination.removeAllListeners($o.ON_NODE)}}).prototype,"setVolume",[RG],Object.getOwnPropertyDescriptor(Ro.prototype,"setVolume"),Ro.prototype),Mn(Ro.prototype,"setPlaybackDevice",[IG],Object.getOwnPropertyDescriptor(Ro.prototype,"setPlaybackDevice"),Ro.prototype),Mn(Ro.prototype,"play",[AG],Object.getOwnPropertyDescriptor(Ro.prototype,"play"),Ro.prototype),Mn(Ro.prototype,"stop",[PG],Object.getOwnPropertyDescriptor(Ro.prototype,"stop"),Ro.prototype),Mn(Ro.prototype,"pipe",[OG],Object.getOwnPropertyDescriptor(Ro.prototype,"pipe"),Ro.prototype),Mn(Ro.prototype,"unpipe",[kG],Object.getOwnPropertyDescriptor(Ro.prototype,"unpipe"),Ro.prototype),Ro);const uf=new class extends jr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Ie(this,"_lastHiddenTime",0),Ie(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),x.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class DG extends jr{constructor(r,s){super(),Ie(this,"trackMediaType",qv.DATA),Ie(this,"_version",1),Ie(this,"_type",3),Ie(this,"_config",void 0),Ie(this,"_originDataChannel",void 0),Ie(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Ie(this,"_dataStreamPacketHandler",{serialize:o=>o,deserialize:o=>o}),Ie(this,"_datachannelEventMap",new Map),this._config=r,s&&(this._originDataChannel=s,this._bandDataChannelEvents(s)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return oe("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,s;return(r=(s=this._originDataChannel)===null||s===void 0?void 0:s.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new ht((r,s)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const o=setTimeout(()=>{var c;s(new Le(te.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((c=this._originDataChannel)===null||c===void 0?void 0:c.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(o),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(o),new Le(te.DATACHANNEL_CONNECTION_TIMEOUT)}}else s(new Le(te.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[XA.OPEN,XA.CLOSE,XA.ERROR].forEach(s=>{const o=()=>{this.emit(s)};this._datachannelEventMap.set(s,o),r.addEventListener(s,o)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(s=>{let[o,c]=s;r.removeEventListener(o,c)}),this._datachannelEventMap.clear()}}class qfe extends DG{constructor(r){super(r),Ie(this,"_messageListener",void 0),this._messageListener=s=>{if(s.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const o=s.data.slice(0,this._dataStreamPacketHeader.byteLength),c=new DataView(o).getUint8(3);if(c!==this.id)return void(oe("SHOW_DATASTREAM2_LOG")&&x.debug("invalid datachannel id: ".concat(c," !== ").concat(this.id)));let u=s.data.slice(this._dataStreamPacketHeader.byteLength);u=this._dataStreamPacketHandler.deserialize(u),this.emit(XA.MESSAGE,u)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Yfe extends DG{send(r){if(this._originDataChannel){let s=r;s=this._dataStreamPacketHandler.serialize(r);const o=new Uint8Array(this._dataStreamPacketHeader.byteLength+s.byteLength);o.set(new Uint8Array(this._dataStreamPacketHeader),0),o.set(new Uint8Array(s),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(o.buffer)}}}function eP(){const e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>eA.revokeObjectURL(e),0),new Worker(eA.createObjectURL(e))}const xG=71,CL=1,RL=2,IL=1,LG=2;var df=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(df||{});function MG(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=e.getUint8(0);if(s!==xG)return;const o=e.getUint16(1),c=CL+RL+o,u=new Uint8Array(e.byteLength-c);u.set(new Uint8Array(e.buffer,c,e.byteLength-c));const h={m:s,tlvLen:o,tlv:[],frame:u};let m=CL+RL;for(;m<c;){const y=e.getUint8(m),E=e.getUint16(m+IL),S=IL+LG;if(y===df.AUDIO_LEVEL){let R=e.getUint8(m+S);for(let P=1;P<E;P++)R=R<<8|e.getUint8(m+S+P);h.tlv.push({tag:y,length:E,value:r?127^R>>1:127&R})}else if(y===df.METADATA||y===df.AUDIO_64_BIT_PTS){const R=new Uint8Array(E);for(let P=0;P<E;P++)R[P]=e.getUint8(m+S+P);h.tlv.push({tag:y,length:E,value:R})}m+=S+E}return h}const tP=new Map,nP=127,K_=1e-10,AL=139/13,rP=new Map;function PL(e,r,s){const o="".concat(e,"-").concat(r,"-").concat(s);let c=0;return rP.has(o)?c=rP.get(o):(c=Math.log(function(h,m){const y=h-m;m<y&&(m=y);let E=1;for(let S=h,R=1;S>m;S--,R++)E=E*S/R;return E}(r,e))+e*Math.log(.5)+(r-e)*Math.log(1-.5)-Math.log(s)+s*e,rP.set(o,c)),c<K_&&(c=K_),c}function UG(e,r,s){const o=r.length,c=e.length/o;let u=!1;for(let h=0,m=0;h<o;h++){let y=0;for(let E=m+c;m<E;m++)e[m]>s&&y++;r[h]!==y&&(r[h]=y,u=!0)}return u}window.cache=rP;let Xfe=0;class VG{constructor(r){Ie(this,"id",void 0),Ie(this,"immediates",[]),Ie(this,"lastNonSilence",-1),Ie(this,"immediateSpeechActivityScore",K_),Ie(this,"lastLevelChangedTime",Date.now()),Ie(this,"levels",[]),Ie(this,"longs",[]),Ie(this,"longSpeechActivityScore",K_),Ie(this,"mediums",[]),Ie(this,"mediumSpeechActivityScore",K_),Ie(this,"minLevel",0),Ie(this,"nextMinLevel",0),Ie(this,"nextMinLevelWindowLength",0),Ie(this,"energyScore",0),this.id=r||"".concat(Xfe++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,s=this.levels,o=this.minLevel+AL;let c=!1;for(let u=0;u<r.length;++u){let h=s[u];h<o&&(h=0);const m=Math.floor(h/AL);r[u]!==m&&(r[u]=m,c=!0)}return c}computeLongs(){return UG(this.mediums,this.longs,4)}computeMediums(){return UG(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=PL(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=PL(this.longs[0],10,47),this.longSpeechActivityScore>K_&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=PL(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(mm(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,s){if(this.lastLevelChangedTime<=s){this.lastLevelChangedTime=s;let o=r;return r<0&&(o=0),r>nP&&(o=nP),this.levels.unshift(o),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(o),o>=this.minLevel+AL?o:o/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let s=Math.sqrt(this.minLevel*this.nextMinLevel);s<0?s=0:s>nP&&(s=nP),this.minLevel=s,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class Jfe{constructor(r){Ie(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const s=this.algorithm.runInDecisionMaker(this);s<=0?r=!0:setTimeout(this.execute.bind(this),s)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class OL{constructor(r,s,o){Ie(this,"isDominant",void 0),Ie(this,"energyRanking",void 0),Ie(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=s,this.energyScore=o}}class Qfe extends jr{constructor(r){super(),Ie(this,"dominantId",null),Ie(this,"lastDecisionTime",0),Ie(this,"lastLevelChangedTime",0),Ie(this,"lastLevelIdleTime",0),Ie(this,"relativeSpeechActivities",[]),Ie(this,"speakers",new Map),Ie(this,"enableSilence",!1),Ie(this,"timeoutToSilenceInterval",0),Ie(this,"decisionMaker",null),Ie(this,"loudest",[]),Ie(this,"numLoudestToTrack",3),Ie(this,"energyExpireTimeMs",250),Ie(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,s=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,s!=null&&(this.energyExpireTimeMs=s),o!=null&&(this.energyAlphaPct=o),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(s=>s.id===r)}levelChanged(r,s){const o=Date.now(),c=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<o&&(this.lastLevelChangedTime=o,this.maybeStartDecisionMaker());const u=c.levelChanged(s,o);return this.updateLoudestList(c,u,o)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(s=>{this.speakers.has(s.id)||this.speakers.set(s.id,s)})}removeSpeakers(r){r.forEach(s=>{this.speakers.delete(s.id)})}getOrCreateSpeaker(r){let s=this.speakers.get(r);return s||(s=new VG(r),this.speakers.set(r,s),this.maybeStartDecisionMaker()),s}updateLoudestList(r,s,o){const c=r.id===this.dominantId;if(s<0){let y=0;for(;y<this.loudest.length&&this.loudest[y]!==r;)++y;return new OL(c,y,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*s+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new OL(c,0,r.energyScore);const u=o-this.energyExpireTimeMs;let h=0;for(;h<this.loudest.length;){const y=this.loudest[h];if(y.getLastLevelChangedTime()<u&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(h,1);else if(y.id!==r.id)++h;else if(this.loudest.splice(h,1),this.loudest.length<this.numLoudestToTrack)break}let m=0;for(;m<this.loudest.length&&!(this.loudest[m].energyScore<r.energyScore);)++m;return m<this.numLoudestToTrack&&(this.loudest.splice(m,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new OL(c,m,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new Jfe(this),this.decisionMaker.execute())}makeDecision(r){let s=null,o=null;const c=this.speakers.size;let u=null;if(c===0)u=null;else if(c===1){var h;const m=Xc(h=this.speakers).call(h).next().value;this.enableSilence&&m&&(u=m.id,m.evaluateSpeechActivityScores(r),r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null))}else{let m=this.dominantId==null?null:this.speakers.get(this.dominantId);if(m==null){const S=this.speakers.entries().next();S.value&&(u=S.value[0],m=S.value[1])}else u=m.id;m!=null&&m.evaluateSpeechActivityScores(r);const y=this.relativeSpeechActivities;let E=2;for(const S of this.speakers.entries()){const[R,P]=S;if(P===m)continue;P.evaluateSpeechActivityScores(r);for(let B=0;B<y.length;++B){const Y=m==null?K_:m.getSpeechActivityScore(B);y[B]=Math.log(P.getSpeechActivityScore(B)/Y)}const D=y[0],G=y[1],j=y[2];D>3&&G>2&&j>0&&G>E&&(E=G,u=R)}this.enableSilence&&m!=null&&u===m.id&&r-m.lastNonSilence>this.timeoutToSilenceInterval&&(u=null)}u==null&&!this.enableSilence||u===this.dominantId||(s=this.dominantId,this.dominantId=u,o=this.dominantId),o==null&&!this.enableSilence||o===s||this.emit("ActiveSpeakerChanged",o)}_runInDecisionMaker(){const r=Date.now(),s=300-(r-this.lastLevelIdleTime);let o=0;s<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):o=s;let c=300-(r-this.lastDecisionTime);return c<=0&&(this.lastDecisionTime=r,this.makeDecision(r),c=300-(Date.now()-r)),c>0&&o>c&&(o=c),o}timeoutIdleLevels(r){const s=[];for(const c of Xc(o=this.speakers).call(o)){var o;const u=r-c.getLastLevelChangedTime();36e5<u&&(this.dominantId==null||c.id!==this.dominantId)?s.push(c.id):300<u&&c.levelTimedOut()}s.forEach(c=>this.speakers.delete(c))}}const eS=new Map;let Ad=null,iP=null;const jG=3;let q_=[];const Pd=new Map,sP=new Map;class Zfe{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,s){Ie(this,"id",void 0),Ie(this,"track",void 0),Ie(this,"score",0),Ie(this,"active",!0),Ie(this,"muted",!1),Ie(this,"timer",0),Ie(this,"actives",0),Ie(this,"inactives",0),this.id=r,this.track=s,this.setActive(Pd.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:s,inactives:o}=function(){const c=[],u=[];return Array.from(Xc(Pd).call(Pd)).forEach(h=>{h.active?c.push(h):u.push(h)}),{actives:c,inactives:u}}();if(s.length>3){let c;s.forEach(u=>{(!c||c.score>u.score)&&(c=u)}),c&&c.setActive(!1)}if(s.length<3&&o.length>0){let c;o.forEach(u=>{(!c||c.score<u.score)&&u.id!==this.id&&(c=u)}),c&&r&&!this.active&&(c.samples>40&&c.activeRate-this.activeRate>.4?c.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(s){let o;return Array.from(Xc(Pd).call(Pd)).forEach(c=>{!c.active||c.id===s||c.samples<40||(!o||c.score<o.score)&&(o=c)}),o}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(s){let o;return Array.from(Xc(Pd).call(Pd)).forEach(c=>{c.active||c.id===s||c.samples<40||(!o||c.score>o.score)&&(o=c)}),o}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let oP;function FG(e){const r=Pd.get(e);r&&(Pd.delete(e),r.clearTimer())}const aP=new Map,eme=new Map;function tme(e,r,s){let o=new Uint8Array(e,r,s),c=[],u=0;for(;c.length<s;)u+3<s&&o[u]===0&&o[u+1]===0&&o[u+2]===3&&(o[u+3]===0||o[u+3]===1||o[u+3]===2||o[u+3]===3)?(c.push(o[u],o[u+1],o[u+3]),u+=4):(c.push(o[u]),u++);return new Uint8Array(c)}const cP=new Map,PT=new Map;(function(){const e=xn();fs.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),fs.getStreamFromExtension=e.name===Hn.CHROME&&Number(e.version)>34,fs.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let s=!1;try{r.addTransceiver("audio"),s=!0}catch{}return r.close(),s}(),fs.supportMinBitrate=e.name===Hn.CHROME||e.name===Hn.EDGE,fs.supportSetRtpSenderParameters=function(){const r=xn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!af()||!(!As()&&!UA())||r.name===Hn.FIREFOX&&Number(r.version)>=64)}(),e.name===Hn.SAFARI&&(Number(e.version)>=14?fs.supportDualStream=!0:fs.supportDualStream=!1),fs.webAudioMediaStreamDest=function(){const r=xn();return!(r.name===Hn.SAFARI&&Number(r.version)<12)}(),fs.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",fs.supportWebGL=typeof WebGLRenderingContext<"u",fs.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,af()||(fs.webAudioWithAEC=!0),fs.supportShareAudio=function(){const r=xn();return(r.os===Yi.WIN_10||r.os===Yi.WIN_81||r.os===Yi.WIN_7||r.os===Yi.LINUX||r.os===Yi.MAC_OS||r.os===Yi.CHROMIUM_OS)&&r.name===Hn.CHROME&&Number(r.version)>=74}(),fs.supportDataChannel=!!(yT(76)||function(r){const s=xn();return!(s.name!==Hn.FIREFOX||!s.osVersion)&&Number(s.version)>=r}(68)||Hz(14)),fs.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!Wr()&&!!r&&r.prototype.setConfiguration instanceof Function}(),fs.supportWebRTCEncodedTransform=function(){const r=xn();return r.name==="Chrome"&&Number(r.version)>=87||r.name==="Safari"&&Number(r.version)>=15}(),fs.supportWebRTCInsertableStream=function(){const r=xn();return(r.name===Hn.CHROME||r.name===Hn.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),fs.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,fs.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,FA(()=>{fs.supportDualStreamEncoding=function(){const r=xn();return!!oe("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&oe("CHROME_DUAL_STREAM_USE_ENCODING"))}(),x.debug("browser ua: ",navigator.userAgent),x.info("browser info: ",e),x.info("browser compatibility: ",fs)})})();const nme=["CHINA","GLOBAL"],BG=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Y_=[],tS=[];function X_(e,r){return!!r&&Y_.some(s=>s.uid===e&&s.channelName===r)}function kL(){return tS.length>0}var rme=l6.forEach,zG=xp("forEach")?[].forEach:function(e){return rme(this,e,arguments.length>1?arguments[1]:void 0)};Gn({target:"Array",proto:!0,forced:[].forEach!=zG},{forEach:zG});var ime=mc("Array").forEach,sme=jc,ome=Ci,ame=O,cme=ime,NL=Array.prototype,lme={DOMTokenList:!0,NodeList:!0},ume=function(e){var r=e.forEach;return e===NL||ame(NL,e)&&r===NL.forEach||ome(lme,sme(e))?cme:r},dme=l(ume),hme=ea,WG=zc;Gn({target:"Object",stat:!0,forced:d(function(){WG(1)})},{keys:function(e){return WG(hme(e))}});var GG=l(Et.Object.keys),pme=l(dE),fme=l(pE),mme=Gn,HG=e_,gme=T_,_me=gt,$G=ge,yme=gi,Eme=Te,vme=zI,Sme=Sr,bme=ws,Tme=ZB("slice"),wme=Sme("species"),DL=Array,Cme=Math.max;mme({target:"Array",proto:!0,forced:!Tme},{slice:function(e,r){var s,o,c,u=Eme(this),h=yme(u),m=$G(e,h),y=$G(r===void 0?h:r,h);if(HG(u)&&(s=u.constructor,(gme(s)&&(s===DL||HG(s.prototype))||_me(s)&&(s=s[wme])===null)&&(s=void 0),s===DL||s===void 0))return bme(u,m,y);for(o=new(s===void 0?DL:s)(Cme(y-m,0)),c=0;m<y;m++,c++)m in u&&vme(o,c,u[m]);return o.length=c,o}});var Rme=mc("Array").slice,Ime=O,Ame=Rme,xL=Array.prototype,Pme=function(e){var r=e.slice;return e===xL||Ime(xL,e)&&r===xL.slice?Ame:r},Ome=l(Pme);function It(e,r,s,o,c){var u,h,m,y={};return dme(u=GG(o)).call(u,function(E){y[E]=o[E]}),y.enumerable=!!y.enumerable,y.configurable=!!y.configurable,("value"in y||y.initializer)&&(y.writable=!0),y=pme(h=fme(m=Ome(s).call(s)).call(m)).call(h,function(E,S){return S(e,r,E)||E},y),c&&y.initializer!==void 0&&(y.value=y.initializer?y.initializer.call(c):void 0,y.initializer=void 0),y.initializer===void 0&&(YB(e,r,y),y=null),y}let lP=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),LL=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Iu=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),Ko=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),Bt=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),_r=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Jt=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),Yt=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),OT=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Cn=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),qo=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),nn=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function uP(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw x.error("Invalid Channel Name ".concat(e)),new Ae(te.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function dP(e){if(r=e,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||Zz(e,1,255)))throw new Ae(te.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof e=="string"&&x.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let hf=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const kme={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},ML={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function UL(e,r){hs(e.url,"".concat(r,".url"),1,1e3,!1),Gr(e.x)||cr(e.x,"".concat(r,".x"),0,1e4),Gr(e.y)||cr(e.y,"".concat(r,".y"),0,1e4),Gr(e.width)||cr(e.width,"".concat(r,".width"),0,1e4),Gr(e.height)||cr(e.height,"".concat(r,".height"),0,1e4),Gr(e.zOrder)||cr(e.zOrder,"".concat(r,".zOrder"),0,255),Gr(e.alpha)||cr(e.alpha,"".concat(r,".alpha"),0,1,!1)}const Nme={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let Hm=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),VL=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Ui=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function KG(e){if(!e.channelName)throw new Ae(te.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new Ae(te.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&hs(e.token,"info.token",1,2047),dP(e.uid),uP(e.channelName),!0}let Yo=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),pf=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),Ya=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),nS=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),Qn=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),as=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),hP=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Ji=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),$n=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const qG=[$n.AFRICA,$n.ASIA,$n.CHINA,$n.EUROPE,$n.GLOBAL,$n.INDIA,$n.JAPAN,$n.NORTH_AMERICA,$n.OCEANIA,$n.OVERSEA,$n.SOUTH_AMERICA];let Ys=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const pP={CHINA:{},ASIA:{CODE:Ys.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Ys.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Ys.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Ys.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Ys.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Ys.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Ys.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Ys.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Ys.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Ys.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Ys.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Ys.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Ys.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};sL&&(pP.CHINA={CODE:Ys.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let kT=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function YG(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class XG extends jr{constructor(r,s){super(),q(this,"onICEConnectionStateChange",void 0),q(this,"onConnectionStateChange",void 0),q(this,"onDTLSTransportStateChange",void 0),q(this,"onDTLSTransportError",void 0),q(this,"onICETransportStateChange",void 0),q(this,"onFirstAudioReceived",void 0),q(this,"onFirstVideoReceived",void 0),q(this,"onFirstAudioDecoded",void 0),q(this,"onFirstVideoDecoded",void 0),q(this,"onFirstVideoDecodedTimeout",void 0),q(this,"onSelectedLocalCandidateChanged",void 0),q(this,"onSelectedRemoteCandidateChanged",void 0),q(this,"onICECandidateError",void 0),q(this,"getLocalVideoStats",void 0)}}class JG extends XG{constructor(r,s){super(r,s),q(this,"establishPromise",void 0)}}let bt=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),Xs=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),ff=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const QG=["disconnected","failed"];let Xe=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),Xn=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),jt=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Au=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Pu=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),cs=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),ZG=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),kh=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),Ml=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Od=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),rS=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),ci=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),iS=function(e){return e.ABORT="abort",e}({}),$m=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),Dme=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const xme={[lP.ACCESS_POINT]:{[Ko.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Ko.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Ko.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Ko.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Ko.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Ko.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Ko.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Ko.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Ko.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Ko.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Ko.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Ko.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Ko.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Ko.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Ko.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Ko.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Ko.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Ko.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[lP.UNILBS]:{[Iu.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Iu.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Iu.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Iu.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Iu.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Iu.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Iu.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Iu.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Iu.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Iu.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Iu.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Iu.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[lP.STRING_UID_ALLOCATOR]:{[LL.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[LL.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[LL.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function sS(e){const r=xme[Math.floor(e/1e4)];if(!r)return{desc:"unknown error",retry:!1};const s=r[e%1e4];if(!s){if(Math.floor(e/1e4)===lP.ACCESS_POINT){const o=e%1e4;if(o.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(o.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return s}const Lme={[Bt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Bt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Bt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Bt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Bt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Bt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Bt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Bt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Bt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Bt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Bt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Bt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Bt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Bt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Bt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Bt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Bt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Bt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Bt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Bt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Bt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Bt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Bt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Bt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Bt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Bt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Bt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Bt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Bt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Bt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Bt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Bt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Bt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Bt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Bt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Bt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Bt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Bt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Bt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Bt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Bt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Bt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Bt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Bt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Bt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Bt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Bt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Bt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Bt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Bt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Bt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Bt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Bt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Bt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Bt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Bt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Bt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Bt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Bt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Bt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Bt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Bt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Bt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Bt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function NT(e){return Lme[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function e9(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function jL(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?e9(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):e9(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}function t9(e,r){if(typeof e=="string")return e;const{proxy:s,host:o,port:c}=e;if(r){const u=oe("JOIN_GATEWAY_FALLBACK_PORT")||443;return u===443?"wss://".concat(o,"/ws/?p=").concat(Number(c)+150):"wss://".concat(o,":").concat(u,"/ws/?p=").concat(Number(c)+150)}return s?"wss://".concat(s,"/ws/?h=").concat(o,"&p=").concat(c):"wss://".concat(o,":").concat(c)}const Mme=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Ume=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Vme=/wss:\/\/(.+):([0-9]+)\/?/,jme=/wss:\/\/(.[^\/]+)\/?/;let Fme=0;class Bme{constructor(r,s){q(this,"id",0),q(this,"store",void 0),q(this,"recordIndex",void 0),q(this,"websockets",[]),q(this,"try443PortDuration",2e3),q(this,"forceCloseWSDuration",5e3),q(this,"try443PortTimeout",null),q(this,"forceCloseTimeout",null),q(this,"isTry443PortFailed",!1),q(this,"isNormalPortFailed",!1),q(this,"useDoubleDomain",!1),q(this,"useProxy",!1),q(this,"startTime",Date.now()),this.id=++Fme,this.try443PortDuration=oe("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=s}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const s=Date.now()-this.startTime;for(var o=arguments.length,c=new Array(o),u=0;u<o;u++)c[u]=arguments[u];x.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(s,"ms:"),...c)}createWebSocket(r,s,o){this.logger("createWebSocket:",r,{isTry443Port:s,hasTimeoutDetection:o});const c=oe("GATEWAY_DOMAINS"),u=Date.now(),h=[],m=c.find(P=>{var D;return ct(D=r.host).call(D,P)});m||(this.useDoubleDomain=!1);const y=[];if(this.useDoubleDomain)c.forEach(P=>{y.push(t9(jL(jL({},r),{},{host:r.host.replace(m,P)}),s))});else{const P=jL({},r);if(s&&m){const D=c.find(G=>G!==m);D&&(P.host=P.host.replace(m,D))}y.push(t9(P,s))}try{y.forEach(P=>{const D=new WebSocket(P);D.binaryType="arraybuffer",h.push(D),this.logger("ws is connecting:",D.url)})}catch(P){if(this.logger("ws create failed"),h.forEach(D=>D.close()),h.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,s,o);if(!s&&Number(r.port)!==443)return this.createWebSocket(r,!0,o);throw new Ae(te.WS_ERR,"init websocket failed! Error: ".concat(P.toString()))}const E=_T();this.store&&this.store.recordJoinChannelService({urls:h.map(P=>P.url),service:"gateway"},this.recordIndex),h.forEach(P=>{P.onopen=()=>{this.logger("onopen: ws ".concat(P.url," open cost ").concat(Date.now()-u,"ms")),this.websockets.forEach(D=>{D!==P&&(D.onopen=null,D.onclose=null,D.onmessage=null,D.close(),this.logger("close backup websocket: ".concat(D.url)))}),this.websockets.length=0,E.resolve(P)},P.onclose=D=>{this.logger("onclose: ws ".concat(P.url," closed cost ").concat(Date.now()-u,"ms state: ").concat(P.readyState));const G=h.every(j=>j.readyState===WebSocket.CLOSED||j.readyState===WebSocket.CLOSING);this.logger("".concat(s?"443":"47xx"," websocket closed, all failed: ").concat(G)),G&&(s||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(D.reason)),E.reject({code:D.code,reason:hP.A_ROUND_WS_FAILED})):!s&&G&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),s?this.isTry443PortFailed=G:this.isNormalPortFailed=G},P.onmessage=D=>this.logger("".concat(P.url," onmessage: ").concat(D.data))}),this.websockets.push(...h);const S=()=>{this.websockets.forEach(P=>P.readyState!==WebSocket.OPEN&&P.close())},R=()=>{if(E.isResolved)return S();xn().os===Yi.MAC_OS&&Wr()&&S(),this.createWebSocket(r,!0,!0).then(P=>{E.resolve(P)}).catch(P=>{this.isNormalPortFailed&&E.reject(P),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",E.isResolved),this.forceCloseTimeout=null,S()},this.forceCloseWSDuration)};return o||(()=>{if(s||this.useProxy)return this.logger("add 5s timeout at ".concat(s?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,S()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",E.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),E.promise}chooseBestWebsocket(r,s,o,c){return this.useDoubleDomain=!!s,typeof r=="string"&&(r=function(u){let h,m,y;return[,h,m,y]=u.match(Mme)||[],h||([,m,y]=u.match(Ume)||[]),m&&y||([,m,y]=u.match(Vme)||[]),m&&y||([,m]=u.match(jme)||[]),m||x.warning("un-destructible url: ",u),{proxy:h,host:m,port:y||"443"}}(r)),this.recordIndex=c,this.useProxy=!!r.proxy,o&&this.useProxy&&(x.warn("cannot use 443 only when use proxy"),o=!1),this.createWebSocket(r,!!o,!1).finally(()=>this.clearTimeout())}}function n9(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}class r9 extends jr{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var s;ct(s=["tryNext","recover"]).call(s,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(nn.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(nn.CONNECTED):this._state==="closed"?this.emit(nn.CLOSED):this._state==="failed"&&this.emit(nn.FAILED))}resetReconnectCount(r){x.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,s){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],c=arguments.length>3&&arguments[3]!==void 0&&arguments[3],u=arguments.length>4&&arguments[4]!==void 0&&arguments[4],h=arguments.length>5?arguments[5]:void 0;super(),q(this,"connectionID",0),q(this,"currentURLIndex",0),q(this,"urls",[]),q(this,"_reconnectMode","tryNext"),q(this,"reconnectReason",void 0),q(this,"_initMutex",void 0),q(this,"name",void 0),q(this,"_state","closed"),q(this,"reconnectInterrupter",void 0),q(this,"websocket",void 0),q(this,"retryConfig",void 0),q(this,"reconnectCount",0),q(this,"forceCloseTimeout",5e3),q(this,"onlineReconnectListener",void 0),q(this,"useCompress",void 0),q(this,"tryDoubleDomain",!1),q(this,"use443PortOnly",!1),q(this,"wsInflateLength",0),q(this,"wsDeflateLength",0),q(this,"closeEstablishingWs",()=>{}),q(this,"store",void 0),q(this,"joinGatewayRecordIndex",void 0),this.store=h,this.name=r,this.retryConfig=function(R){for(var P=1;P<arguments.length;P++){var D=arguments[P]!=null?arguments[P]:{};P%2?n9(Object(D),!0).forEach(function(G){q(R,G,D[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(D)):n9(Object(D)).forEach(function(G){Object.defineProperty(R,G,Object.getOwnPropertyDescriptor(D,G))})}return R}({},s),this.useCompress=o,this.tryDoubleDomain=c,this.use443PortOnly=u,this._initMutex=new qs("websocket",h?h.clientId:void 0);const{timeout:m,timeoutFactor:y}=s,E=Math.max(300,Math.floor(3*m/5)),S=Math.max(1.2,Math.floor(8*y)/10);Tc.ONLINE&&(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=S),yi.on(Vv.NETWORK_STATE_CHANGE,(R,P)=>{R!==P&&(this.resetReconnectCount("network state change: ".concat(P," -> ").concat(R)),R===Tc.ONLINE?(this.retryConfig.timeout=E,this.retryConfig.timeoutFactor=S):(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=y))})}getConnection(){return this.websocket||void 0}async init(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=s,this.urls=r,this.state="connecting";try{const c=_T(),u=this.urls[this.currentURLIndex];oe("ENABLE_PREALLOC_PC")&&this.emit(ZG.PRE_CONNECT_PC),this.createWebSocketConnection(u).then(c.resolve).catch(c.reject),this.once(nn.CLOSED,()=>{c.reject(new Le(te.WS_DISCONNECT))}),this.once(nn.CONNECTED,c.resolve),await c.promise}catch{}finally{o()}}close(r,s){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const o=this.websocket;s?setTimeout(()=>o.close(),500):o.close(),this.websocket=void 0}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,s){if(!this.websocket)return void x.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),x.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(s)]},this.joinGatewayRecordIndex);const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:s})}sendMessage(r){let s=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Le(te.WS_ABORT,"websocket is not ready");try{s||(r=JSON.stringify(r)),this.websocket.send(r)}catch(o){throw new Le(te.WS_ERR,"send websocket message error"+o.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,s=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:s}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var s;const o=_T();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const c=S=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),x.debug("[".concat(this.name,"] websocket opened:"),S),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o.resolve()},u=async S=>{var R;if(x.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(S.code,", reason: ").concat(S.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)o.reject(new Le(te.WS_DISCONNECT,"websocket close: ".concat(S.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=S.reason,this.state="reconnecting");const P=Qc(this,nn.WILL_RECONNECT,this.reconnectMode,S.reason)||this.reconnectMode,D=await this.reconnectWithAction(P);if(this.state==="closed")return void x.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!D)return o.reject(new Le(te.WS_DISCONNECT,"websocket reconnect failed: ".concat(S.code))),this.close(!0);o.resolve()}},h=S=>{this.emit(nn.ON_MESSAGE,S)},m=S=>{x.warn("[".concat(this.connectionID,"] ws open error ").concat(S))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),oe("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=oe("GATEWAY_WSS_ADDRESS")),x.debug("[".concat(this.name,"] start connect, url:"),r);const y=(s=this.store)===null||s===void 0?void 0:s.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var E;const S=await this.chooseBestWebsocketConnection(r);this.websocket=S,c&&c(this.websocket.url),this.websocket.onclose=u,this.websocket.onmessage=h,this.websocket.onerror=m,(E=this.store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:"success"},y),this.joinGatewayRecordIndex=y}catch(S){const R=this.state==="closed",P=S instanceof Le,D=P&&S.code===te.WS_ABORT,G=P&&S.code===te.WS_ERR,j=P?S.message:S&&(S.reason||S.toString());x.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(j)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:D?"aborted":"error",errors:[S]},y),R||G?(o.reject(R?new Le(te.WS_DISCONNECT,"websocket is closed: ".concat(j)):new Le(te.WS_ERR,"init websocket failed: ".concat(j))),G&&x.error("[".concat(this.name,"] init websocket failed: ").concat(j))):u&&u(S)}return o.promise}async reconnectWithAction(r){let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;x.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||yi.isOnline||!yi.onlineWaiter||(this.onlineReconnectListener=yi.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let o=!0;if(this.reconnectInterrupter=()=>o=!1,s){const h=Jx(this.reconnectCount,this.retryConfig);x.debug("[".concat(this.name,"] wait ").concat(h,"ms to reconnect websocket, mode: ").concat(r)),await ht.race([ps(h),this.onlineReconnectListener||new ht(()=>{})])}if(this._state==="closed"||!o)return!1;this.reconnectCount+=1;const c=async(h,m)=>{this.emit(nn.RECONNECT_CREATE_CONNECTION,m),await this.createWebSocketConnection(h)};try{if(r==="retry")await c(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);x.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await c(this.urls[this.currentURLIndex],r)}else r==="recover"&&(x.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Os(this,nn.REQUEST_NEW_URLS),this.currentURLIndex=0,await c(this.urls[this.currentURLIndex],r))}catch(h){var u;x.error("[".concat(this.name,"] reconnect failed ").concat(h&&h.toString()));const m=h==null||(u=h.data)===null||u===void 0?void 0:u.desc;return Array.isArray(m)&&ct(m).call(m,"dynamic key expired")?(this.emit(nn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,s)}return!0}}class FL extends r9{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){const o=_T(),c=function(h,m){return new Bme(h,m)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),c.closeAllWebsockets(),o.reject(new Le(te.WS_ABORT,"choose best websocket aborted"))};const u=oe("GATEWAY_DOMAINS");return x.debug("[choose-best-ws] currentDomain: ",r,", domains: ",u,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),c.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,s).then(o.resolve).catch(o.reject),o.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class DT extends r9{constructor(r,s){super(r,s,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,s){return new ht((o,c)=>{let u=!1;const h=[];this.closeEstablishingWs=()=>{x.debug("[choose-best-ws] close establishing websockets"),h.forEach(G=>{G.onclose=null,G.onopen=null,G.onmessage=null,G.close()}),c(new Le(te.WS_ABORT,"choose best websocket aborted"))};const m=oe("GATEWAY_DOMAINS");let y;const E=r.indexOf("?h="),S=m.find(G=>E!==-1?ct(r).call(r,G,E):ct(r).call(r,G));x.debug("[choose-best-ws] currentDomain: ",S,", domains: ",m);let R=!this.tryDoubleDomain||!S;if(!R&&S){var P;const G=Date.now();try{m.forEach(j=>{const B=E===-1?r.replace(S,j):r.substr(0,E)+r.substr(E).replace(S,j),Y=new WebSocket(B);Y.binaryType="arraybuffer",h.push(Y),x.debug("[choose-best-ws] ws is connecting:",Y.url)})}catch{for(x.debug("[choose-best-ws] ws create failed, fallback to single url"),h.forEach(B=>B.close());h.length;)h.pop();R=!0}(P=this.store)===null||P===void 0||P.recordJoinChannelService({urls:h.map(j=>j.url),service:"gateway"},s),h.forEach(j=>{j.onopen=()=>{if(u)return;const B=Date.now()-G;x.debug("[choose-best-ws] ws open cost ".concat(B,"ms")),h.filter(Y=>Y!==j).forEach(Y=>{x.debug("[choose-best-ws]close backup websocket: ".concat(Y.url)),Y.close()}),u=!0,o(j)},j.onclose=B=>{y=B,!u&&(h.find(Y=>!(Y.readyState===WebSocket.CLOSED||Y.readyState===WebSocket.CLOSING))||(x.debug("[choose-best-ws] all websocket is closed"),u=!0,c(y)))},j.onmessage=B=>{x.debug("[choose-best-ws]".concat(j.url," onmessage: ").concat(B.data))}}),ps(this.forceCloseTimeout).then(()=>{h.forEach(j=>{j.readyState!==WebSocket.OPEN&&j.close()})})}if(R){var D;let G;x.debug("[choose-best-ws] use single url: ",r),(D=this.store)===null||D===void 0||D.recordJoinChannelService({urls:[r],service:"gateway"},s);try{G=new WebSocket(r),h.push(G),G.binaryType="arraybuffer"}catch(j){const B=new Le(te.WS_ERR,"init websocket failed! Error: ".concat(j.toString()));return x.error("[".concat(this.name,"]").concat(B)),void c(B)}G.onopen=()=>{o(G)},G.onclose=j=>{c(j)},G.onmessage=j=>{x.debug("[choose-best-ws]".concat(G.url," onmessage: ").concat(j.data))},ps(this.forceCloseTimeout).then(()=>{G&&G.readyState!==WebSocket.OPEN&&G.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class zme extends jr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===_r.CONNECTED?this.emit(Jt.WS_CONNECTED):r===_r.RECONNECTING?this.emit(Jt.WS_RECONNECTING,this._websocketReconnectReason):r===_r.CLOSED&&this.emit(Jt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),q(this,"_disconnectedReason",void 0),q(this,"_websocketReconnectReason",void 0),q(this,"_connectionState",_r.CLOSED),q(this,"reconnectToken",void 0),q(this,"websocket",void 0),q(this,"openConnectionTime",void 0),q(this,"clientId",void 0),q(this,"lastMsgTime",Date.now()),q(this,"uploadCache",[]),q(this,"uploadCacheInterval",void 0),q(this,"rttRolling",new mW(5)),q(this,"pingpongTimer",void 0),q(this,"wsInflateDataTimer",void 0),q(this,"pingpongTimeoutCount",0),q(this,"joinResponse",void 0),q(this,"multiIpOption",void 0),q(this,"initError",void 0),q(this,"spec",void 0),q(this,"store",void 0),q(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Jt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){if(this.emit(c._type,c._message),c._type===Cn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Cn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Yn.UID_BANNED);break;case 15:this.close(Yn.IP_BANNED);break;case 16:this.close(Yn.CHANNEL_BANNED)}if(c._type===Cn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Bt.ERR_LICENSE_MISSING:this.close(Yn.LICENSE_MISSING);break;case Bt.ERR_LICENSE_EXPIRED:this.close(Yn.LICENSE_EXPIRED);break;case Bt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Yn.LICENSE_MINUTES_EXCEEDED);break;case Bt.ERR_LICENSE_PERIOD_INVALID:this.close(Yn.LICENSE_PERIOD_INVALID);break;case Bt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Yn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Bt.ERR_LICENSE_ILLEGAL:this.close(Yn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new FL("gateway-".concat(this.clientId),this.spec.retryConfig,!0,oe("JOIN_GATEWAY_USE_DUAL_DOMAIN"),oe("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===_r.CONNECTED&&this.reconnect("retry",Ps.OFFLINE)})}async request(r,s,o,c){const u=pr(6,""),h={_id:u,_type:r,_message:s},m=this.websocket.connectionID,y=()=>new ht((G,j)=>{if(this.connectionState===_r.CONNECTED)return G();const B=()=>{this.off(Jt.WS_CLOSED,Y),G()},Y=()=>{this.off(Jt.WS_CONNECTED,B),j(new Ae(te.WS_ABORT))};this.once(Jt.WS_CONNECTED,B),this.once(Jt.WS_CLOSED,Y),r!==Yt.PUBLISH&&r!==Yt.PUBLISH_DATASTREAM&&r!==Yt.SUBSCRIBE&&r!==Yt.SUBSCRIBE_DATASTREAM&&r!==Yt.UNSUBSCRIBE&&r!==Yt.UNSUBSCRIBE_DATASTREAM&&r!==Yt.UNPUBLISH&&r!==Yt.UNPUBLISH_DATASTREAM&&r!==Yt.CONTROL&&r!==Yt.RESTART_ICE||this.once(Jt.DISCONNECT_P2P,()=>{j(new Ae(te.DISCONNECT_P2P))}),r!==Yt.PUBLISH&&r!==Yt.RESTART_ICE||this.once(Jt.ABORT_P2P_EXECUTION,()=>{j(new Ae(te.DISCONNECT_P2P))})});if(this.connectionState!==_r.CONNECTING&&this.connectionState!==_r.RECONNECTING||r===Yt.JOIN||r===Yt.REJOIN||await y(),this.websocket.sendMessage(h,!0),c)return;const E=new ht((G,j)=>{let B=!1;const Y=(fe,ye)=>{B=!0,G({isSuccess:fe==="success",message:ye||{}}),this.off(Jt.WS_CLOSED,ee),this.off(Jt.WS_RECONNECTING,ee),this.emit(Jt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(u),Y);const ee=()=>{j(new Ae(te.WS_ABORT,"type: ".concat(r))),this.off(Jt.WS_CLOSED,ee),this.off(Jt.WS_RECONNECTING,ee),this.off("res-@".concat(u),Y)};this.once(Jt.WS_CLOSED,ee),this.once(Jt.WS_RECONNECTING,ee),ps(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||B||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Jt.REQUEST_TIMEOUT,r,s))})});let S=null;try{S=await E}catch(G){if(this.connectionState===_r.CLOSED||r===Yt.LEAVE)throw new Ae(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?G.throw():r===Yt.JOIN||r===Yt.REJOIN?null:(await y(),await this.request(r,s))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=NT(R),D=new Ae(te.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Bt.ERR_TOO_MANY_BROADCASTERS?((r===Yt.JOIN||r===Yt.REJOIN)&&(this.initError=D,this.close()),D.throw()):P.action==="failed"?D.throw():P.action==="quit"?(this.initError=D,this.close(),D.throw()):(R===Bt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ps.MULTI_IP)):this.reconnect(P.action,Ps.SERVER_ERROR),r===Yt.JOIN||r===Yt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new ht(o=>{const c=u=>{(!s||s(u))&&(this.off(r,c),o(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(OT.WRTC_STATS,s)}upload(r,s){const o={_type:r,_message:s};try{this.websocket.sendMessage(o)}catch{const u=oe("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==_r.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},oe("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const o={_type:r,_message:s};this.websocket.sendMessage(o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ht((s,o)=>{this.once(Jt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Jt.WS_CLOSED,c=>o(this.initError||new Ae(te.WS_ABORT,c))),this.connectionState=_r.CONNECTING,this.websocket.init(r).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||Yn.LEAVE,this.connectionState=_r.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Jt.ABORT_P2P_EXECUTION);const r=await Os(this,Jt.REQUEST_JOIN_INFO),s=await this.request(Yt.JOIN,r);if(!s)return this.emit(Jt.REPORT_JOIN_GATEWAY,hP.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Jt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=_r.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Ae(te.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=TT(this,Jt.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const s=await this.request(Yt.REJOIN,r);return!!s&&(this.connectionState=_r.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),s.peers&&s.peers.forEach(o=>{this.emit(Cn.ON_USER_ONLINE,{uid:o.uid}),o.audio&&this.emit(Cn.ON_ADD_AUDIO_STREAM,{uid:o.uid,uint_id:o.uint_id,audio:!0,ssrcId:o.audio_ssrc}),o.video&&this.emit(Cn.ON_ADD_VIDEO_STREAM,{uid:o.uid,uint_id:o.uint_id,video:!0,ssrcId:o.video_ssrc}),o.audio_mute?this.emit(Cn.MUTE_AUDIO,{uid:o.uid}):this.emit(Cn.UNMUTE_AUDIO,{uid:o.uid}),o.video_mute?this.emit(Cn.MUTE_VIDEO,{uid:o.uid}):this.emit(Cn.UNMUTE_VIDEO,{uid:o.uid}),o.audio_enable_local?this.emit(Cn.ENABLE_LOCAL_AUDIO,{uid:o.uid}):this.emit(Cn.DISABLE_LOCAL_AUDIO,{uid:o.uid}),o.video_enable_local?this.emit(Cn.ENABLE_LOCAL_VIDEO,{uid:o.uid}):this.emit(Cn.DISABLE_LOCAL_VIDEO,{uid:o.uid}),o.audio||o.video||this.emit(Cn.ON_REMOVE_STREAM,{uid:o.uid,uint_id:o.uint_id})}),!0)}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=NT(r.code);if(r.code===28&&"detail"in r&&(x.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(Jt.RECOVER_NOTIFICATION,r.detail)),s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Yn.UID_BANNED),void this.close()):void this.reconnect(s.action,Ps.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=oe("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>oe("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ps.TIMEOUT):this.request(Yt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-s;this.rttRolling.add(o),oe("REPORT_STATS")&&this.send(Yt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:s}=this.websocket.getWsInflateData();r!==0&&s!==0&&this.upload(OT.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:s,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(nn.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Jt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(nn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(nn.CLOSED,()=>{this.connectionState=_r.CLOSED}),this.websocket.on(nn.FAILED,()=>{this._disconnectedReason=Yn.NETWORK_ERROR,this.connectionState=_r.CLOSED}),this.websocket.on(nn.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===_r.CONNECTED?this.connectionState=_r.RECONNECTING:this.connectionState=_r.CONNECTING}),this.websocket.on(nn.WILL_RECONNECT,(r,s,o)=>{const c=TT(this,Jt.IS_P2P_DISCONNECTED),u=c||r!=="retry";c&&r==="retry"&&(x.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",s=hP.P2P_DISCONNECTED),u&&(x.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(Jt.REPORT_JOIN_GATEWAY,s||hP.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Jt.DISCONNECT_P2P)),o(r)}),this.websocket.on(nn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{x.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",Ps.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(Jt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Ae){if(r.code===te.UNEXPECTED_RESPONSE&&r.data.code===Bt.ERR_NO_AUTHORIZED)return this.initError=new Ae(te.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Yn.TOKEN_EXPIRE);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ps.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(nn.REQUEST_NEW_URLS,(r,s)=>{Os(this,Jt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(nn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(ZG.PRE_CONNECT_PC,()=>{this.emit(Jt.PRE_CONNECT_PC)})}}let Wme=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),Ei=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function i9(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function fP(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?i9(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):i9(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}function Km(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(oe("TURN_DOMAIN")):(x.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function BL(e,r){e.addresses||(e.addresses=[]);const s=function(m,y){if(oe("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return m.map(R=>{let{ip:P,port:D}=R;return{address:"".concat(P,":").concat(D)}});const E=oe("GATEWAY_DOMAINS");let S=E[1]&&ct(y).call(y,E[1])?1:0;return m.map(R=>{let{domain_prefix:P,port:D,ip:G}=R;if(P)return{address:"".concat(P,".").concat(E[S++%E.length],":").concat(D)};const j=/^[\.\:\d]+$/.test(G),B=j?"".concat(G.replace(/[^\d]/g,"-"),".").concat(E[S++%E.length],":").concat(D):"".concat(G,":").concat(D);return j||x.debug("Cannot recognized as ip address: ".concat(G,", use as host")),{ip:G,port:D,address:B}})}(e.addresses,r),o=Array.isArray(e.detail)&&e.detail[18];if(o&&typeof o=="string"){const m=o.split(";");for(let y=0;y<m.length;y++){var c;const E=wo(c=m[y]).call(c);s[y]&&E&&(s[y].ip6=E)}}const u=e.detail&&e.detail.candidate;let h;if(u){const[m,y]=u.split(":");m&&y&&(h={port:Number(y),ip:m,address:"".concat(m,":").concat(y)})}return{gatewayAddrs:s,apGatewayAddress:h,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function wc(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function s9(e){const r=e._encoderConfig;if(!r)return{};const s={resolution:r.width&&r.height?"".concat(wc(r.width),"x").concat(wc(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(s.maxFrameRate=r.frameRate,s.minFrameRate=r.frameRate):r.frameRate&&(s.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,s.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),s}function o9(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function xT(e,r){let s,o,c;switch(r){case Ei.CHOOSE_SERVER:o=4096,c="choose server";break;case Ei.CLOUD_PROXY:o=1048576,c="proxy";break;case Ei.CLOUD_PROXY_5:o=4194304,c="proxy5";break;case Ei.CLOUD_PROXY_FALLBACK:o=4194310,c="proxy fallback";break;default:throw new Ae(te.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(u=>{u.buffer&&u.buffer.flag===o&&(s={code:u.buffer.code,addresses:(u.buffer.edges_services||[]).map(h=>fP(fP({},h),{},{ticket:u.buffer.cert})),server_ts:e.enter_ts,uid:u.buffer.uid,cid:u.buffer.cid,cname:u.buffer.cname,detail:fP(fP({},u.buffer.detail),e.detail),flag:u.buffer.flag,opid:e.opid,cert:u.buffer.cert})}),!s)throw new Ae(te.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(c," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return s}async function a9(e,r){return await ht.all(e.addresses.map(async s=>({address:oe("USE_TURN_IP")?s.ip:Km(s.ip),tcpport:s.port,udpport:s.port,username:r&&oe("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():ks.username,password:r&&oe("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Kx(r.toString()):ks.password})))}function zL(e,r){const s=r.getMediaStreamTrack(!0).getSettings(),o=r.videoHeight||s.height,c=r.videoWidth||s.width;return o&&c?Math.max(Math.min(o,c)/Math.min(wc(e.height),wc(e.width)),1):(x.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function qm(e){let{candidateType:r,relayProtocol:s,type:o,address:c,port:u,protocol:h}=e;const m={candidateType:r,relayProtocol:s,protocol:h};if(o!=="local-candidate"){const y=c.split(".");y.length>=4&&(y[1]="*",y[2]="*"),m.address=y.join("."),m.port=u}return m}function mP(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:oe("SVC_MODE");if(oe("ENABLE_SVC"))return function(r){return r in GA}(e)?e:GA.L1T3}const c9={[bt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[bt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function gP(e,r,s){r.forEach(o=>{var c;const u=c9[e].find(m=>{var y;let{key:E}=m;return ct(y=o.extensionName).call(y,E)});if(!u)return;const h=s.find(m=>{let{extensionName:y}=m;return ct(y).call(y,u.key)});h&&ct(c=h.extensionName).call(c,"gdpr_forbidden")&&(o.extensionName=h.extensionName)})}function oS(e,r){r.forEach(s=>{var o;const c=c9[e].find(u=>{var h;let{key:m}=u;return ct(h=s.extensionName).call(h,m)});ct(o=s.extensionName).call(o,"gdpr_forbidden")&&c&&(s.extensionName=c.extensionName)})}function l9(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||ct(e).call(e,"abs-send-time")}function _P(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||ct(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function u9(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function d9(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?u9(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):u9(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}function LT(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},o=arguments.length>3?arguments[3]:void 0;const{filterRTX:c,filterVideoFec:u,filterAudioFec:h,filterAudioCodec:m,filterVideoCodec:y}=r,{useXR:E}=s;let S=[],R=[],P=[],D=[],G=!1,j=!1;if(qa(e).mediaDescriptions.forEach(Y=>{o&&o!==Y.attributes.direction||(Y.media.mediaType!=="video"||G||(R=Y.attributes.payloads,D=Y.attributes.extmaps,G=!0),Y.media.mediaType!=="audio"||j||(S=Y.attributes.payloads,P=Y.attributes.extmaps,j=!0))}),!D||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!P||S.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(Y=>{var ee;(ee=Y.rtpMap)!==null&&ee!==void 0&&ee.clockRate&&(Y.rtpMap.clockRate=parseInt(Y.rtpMap.clockRate)),E&&Y.rtcpFeedbacks.push({type:"rrtr"})}),S.forEach(Y=>{var ee;(ee=Y.rtpMap)!==null&&ee!==void 0&&ee.clockRate&&(Y.rtpMap.clockRate=parseInt(Y.rtpMap.clockRate)),E&&Y.rtcpFeedbacks.push({type:"rrtr"})}),c&&(S=S.filter(Y=>{var ee;return((ee=Y.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())!=="rtx"}),R=R.filter(Y=>{var ee;return((ee=Y.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())!=="rtx"})),u&&(R=R.filter(Y=>{var ee;return!/(red)|(ulpfec)|(flexfec)/i.test(((ee=Y.rtpMap)===null||ee===void 0?void 0:ee.encodingName)||"")})),h&&(S=S.filter(Y=>{var ee;return!/(red)|(ulpfec)|(flexfec)/i.test(((ee=Y.rtpMap)===null||ee===void 0?void 0:ee.encodingName)||"")})),m&&(m==null?void 0:m.length)>0&&(S=S.filter(Y=>{var ee;return ct(m).call(m,((ee=Y.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLowerCase())||"")})),y&&(y==null?void 0:y.length)>0){const Y=R.filter(ee=>{var fe;return ct(y).call(y,((fe=ee.rtpMap)===null||fe===void 0?void 0:fe.encodingName.toLowerCase())||"")});R=Y.concat(c?[]:HL(Y,R))}const B=oe("UNSUPPORTED_VIDEO_CODEC");return B&&B.length>0&&(R=R.filter(Y=>!(Y.rtpMap&&ct(B).call(B,Y.rtpMap.encodingName.toLowerCase())))),{audioCodecs:S,videoCodecs:R,audioExtensions:P,videoExtensions:D}}function Ym(e){const r=qa(e);let s,o;for(const c of r.mediaDescriptions){if(!s){const u=c.attributes.iceUfrag,h=c.attributes.icePwd;if(!u||!h)throw new Error("Cannot get iceUfrag or icePwd from SDP.");s={iceUfrag:u,icePwd:h}}if(!o){const u=c.attributes.fingerprints;u.length>0&&(o={fingerprints:u})}}if(!o&&r.attributes.fingerprints.length>0&&(o={fingerprints:r.attributes.fingerprints}),!o||!s)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:s,dtlsParameters:o}}function h9(e,r){const s=[],o=e.attributes.ssrcGroups.filter(h=>h.semantic==="FID"),c=e.attributes.ssrcGroups.find(h=>h.semantic==="SIM"),u=e.attributes.ssrcs;if(c)c.ssrcIds.forEach(h=>{var m;const y=(m=o.find(E=>E.ssrcIds[0]===h))===null||m===void 0?void 0:m.ssrcIds[1];s.push({ssrcId:h,rtx:r?y:void 0})});else if(o.length>0){const h=o[0].ssrcIds[0],m=o[0].ssrcIds[1];s.push({ssrcId:h,rtx:r?m:void 0})}else{if(u.length===0)throw new Error("No ssrcs found on local media description.");s.push({ssrcId:u[0].ssrcId})}return s}function p9(e,r,s){const{cname:o}=e;let c=[];r&&(c=f9(r)),c.length===0&&(c=e.iceParameters.candidates.map(S=>({foundation:S.foundation,componentId:"1",transport:S.protocol,priority:S.priority.toString(),connectionAddress:S.ip,port:S.port.toString(),type:S.type,extension:{}})),x.debug("Using candidates from gateway."));const u={fingerprints:e.dtlsParameters.fingerprints.map(S=>({hashFunction:S.algorithm,fingerprint:S.fingerprint}))},h={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let m;switch(e.dtlsParameters.role){case"server":m="passive";break;case"client":m="active";break;case"auto":m="actpass"}const y=EP(e.rtpCapabilities),E=[];return Array.isArray(s)&&s.length>0&&s.forEach(S=>{E.push({kind:bt.VIDEO,ssrcId:S.v,rtx:S.v_rtx,mslabel:"".concat(S.v,"_").concat(S.a)},{kind:bt.AUDIO,ssrcId:S.a,mslabel:"".concat(S.v,"_").concat(S.a)})}),{dtlsParameters:u,iceParameters:h,candidates:c,rtpCapabilities:y,setup:m,cname:o,preSSRCs:E}}function f9(e){let r=[];return e.ip&&typeof e.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],x.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),x.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),r}function J_(e,r,s){const o=[],c=[];return e.forEach(u=>{let{ssrcId:h,rtx:m}=u;const y=pr(8,"track-"),E={ssrcId:h,attributes:d9({label:y,mslabel:s=s||pr(10,""),msid:"".concat(s," ").concat(y)},r&&{cname:r})};if(o.push(E),m!==void 0){const S={ssrcId:m,attributes:d9({label:y,mslabel:s,msid:"".concat(s," ").concat(y)},r&&{cname:r})};o.push(S),c.push({semantic:"FID",ssrcIds:[h,m]})}}),e.length>1&&c.push({semantic:"SIM",ssrcIds:e.map(u=>{let{ssrcId:h}=u;return h})}),{ssrcs:o,ssrcGroups:c}}function aS(e,r){r instanceof Xr&&e.attributes.payloads.forEach(s=>{var o;const c=(o=s.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase();if(!c||["opus","pcmu","pcma","g722"].indexOf(c)===-1)return;s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters.minptime="10",s.fmtp.parameters.useinbandfec="1";const u=r._encoderConfig;u&&c!=="pcmu"&&c!=="pcma"&&c!=="g722"&&(u.bitrate&&!Wr()&&(s.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*u.bitrate))),u.sampleRate&&(s.fmtp.parameters.maxplaybackrate="".concat(u.sampleRate),s.fmtp.parameters["sprop-maxcapturerate"]="".concat(u.sampleRate)),u.stereo&&(s.fmtp.parameters.stereo="1",s.fmtp.parameters["sprop-stereo"]="1"))})}function WL(e){const r=e.attributes.unrecognized.findIndex(s=>s.attField==="x-google-flag"&&s.attValue==="conference");r!==-1&&e.attributes.unrecognized.splice(r,1)}function GL(e,r){var s;if(!(r instanceof Cr&&r._encoderConfig&&r._hints.indexOf(fr.SCREEN_TRACK)===-1))return;const o=r._encoderConfig;Fn().supportMinBitrate&&o.bitrateMin&&e.attributes.payloads.forEach(c=>{var u,h;ct(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-min-bitrate"]="".concat(o.bitrateMin))}),Fn().supportMinBitrate&&!ct(s=r._hints).call(s,fr.LOW_STREAM)&&o.bitrateMax&&e.attributes.payloads.forEach(c=>{var u,h;ct(u=["h264","h265","vp8","vp9","av1"]).call(u,((h=c.rtpMap)===null||h===void 0?void 0:h.encodingName.toLowerCase())||"")&&(c.fmtp||(c.fmtp={parameters:{}}),c.fmtp.parameters["x-google-start-bitrate"]="".concat(oe("X_GOOGLE_START_BITRATE")||Math.floor(o.bitrateMax)))})}function m9(e){if(e.media.mediaType!=="video")return;const r=xn();if(r.name!==Hn.SAFARI&&r.os!==Yi.IOS)return;const s=e.attributes.extmaps.findIndex(o=>/video-orientation/g.test(o.extensionName));s!==-1&&e.attributes.extmaps.splice(s,1)}function yP(e,r,s){if(!r)return;let o,c;if(e.media.mediaType==="video"?(o=s.videoExtensions,c=s.videoCodecs):(o=s.audioExtensions,c=s.audioCodecs),r.twcc===!0){const u=o.find(h=>_P(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(y=>_P(y.extensionName))||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(y,E){return E.filter(S=>!!y.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="transport-cc")))}(c,e.attributes.payloads).forEach(y=>{y.rtcpFeedbacks.find(E=>E.type==="transport-cc")||y.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const u=e.attributes.extmaps.findIndex(h=>_P(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(y=>y.type==="transport-cc");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}if(r.remb===!0){const u=o.find(h=>l9(h.extensionName));if(u){const h=u.extensionName;e.attributes.extmaps.find(y=>y.extensionName===h)||e.attributes.extmaps.push({entry:u.entry,extensionName:h}),function(y,E){return E.filter(S=>!!y.find(R=>R.payloadType===S.payloadType&&!!R.rtcpFeedbacks.find(P=>P.type==="goog-remb")))}(c,e.attributes.payloads).forEach(y=>{y.rtcpFeedbacks.find(E=>E.type==="goog-remb")||y.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const u=e.attributes.extmaps.findIndex(h=>l9(h.extensionName));u!==-1&&e.attributes.extmaps.splice(u,1),e.attributes.payloads.forEach(h=>{const m=h.rtcpFeedbacks.findIndex(y=>y.type==="goog-remb");m!==-1&&h.rtcpFeedbacks.splice(m,1)})}}function g9(e,r,s){if(Wr()||e.media.mediaType!=="video"||!(r instanceof Cr)||s!=="vp9"&&s!=="vp8"||s==="vp8"&&!oe("SIMULCAST")||s==="vp9"&&oe("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const o=s==="vp8"?2:r._scalabilityMode.numSpatialLayers,c=e.attributes.ssrcs[0],u=e.attributes.ssrcGroups.find(m=>m.semantic==="FID"&&m.ssrcIds[0]===c.ssrcId),h={semantic:"SIM",ssrcIds:[c.ssrcId]};for(let m=1;m<o;m++)e.attributes.ssrcs.push({ssrcId:c.ssrcId+m,attributes:$r(c.attributes)}),h.ssrcIds.push(c.ssrcId+m),u&&(e.attributes.ssrcs.push({ssrcId:u.ssrcIds[1]+m,attributes:$r(c.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[c.ssrcId+m,u.ssrcIds[1]+m]}));e.attributes.ssrcGroups.unshift(h)}async function _9(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=new RTCPeerConnection;s.addTransceiver("video",{direction:"sendonly"}),s.addTransceiver("audio",{direction:"sendonly"}),s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const o=(await s.createOffer()).sdp,{send:c,recv:u,sendrecv:h}=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},E=arguments.length>2?arguments[2]:void 0;const S=LT(E,m,y,"sendonly"),R=LT(E,m,y,"recvonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ou(S,R,"videoExtensions",P,D,G),Ou(S,R,"videoCodecs",P,D,G),Ou(S,R,"audioExtensions",P,D,G),Ou(S,R,"audioCodecs",P,D,G),oe("RAISE_H264_BASELINE_PRIORITY")){const j=[],B=[];G.videoCodecs.forEach((Y,ee)=>{var fe;if(((fe=Y.rtpMap)===null||fe===void 0?void 0:fe.encodingName.toLocaleLowerCase())==="h264"){var ye,Ee;const _e=G.videoCodecs[ee+1],Ne=_e&&b9(Y,_e),Ze=(ye=Y.fmtp)===null||ye===void 0?void 0:ye.parameters["profile-level-id"],pt=(Ee=Y.fmtp)===null||Ee===void 0?void 0:Ee.parameters["packetization-mode"];!Ze||Ze!==oe("FIRST_H264_PROFILE_LEVEL_ID")||oe("FIRST_PACKETIZATION_MODE")&&pt!==oe("FIRST_PACKETIZATION_MODE")?Ne?B.push([Y,_e]):B.push([Y]):Ne?j.push([Y,_e]):j.push([Y])}}),j.length>0&&B.length>0&&(x.debug("raising H264 baseline profile priority"),G.videoCodecs.forEach((Y,ee)=>{var fe;if(((fe=Y.rtpMap)===null||fe===void 0?void 0:fe.encodingName.toLocaleLowerCase())==="h264"){const ye=b9(Y,G.videoCodecs[ee+1]),Ee=j.shift()||B.shift()||[];Ee.length>0&&(ye?G.videoCodecs.splice(ee,2,...Ee):G.videoCodecs.splice(ee,1,...Ee))}}),D.videoCodecs=D.videoCodecs.filter(Y=>{var ee,fe;return!(((ee=Y.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLocaleLowerCase())==="h264"&&((fe=Y.fmtp)===null||fe===void 0?void 0:fe.parameters["profile-level-id"])!==oe("FIRST_H264_PROFILE_LEVEL_ID"))}),oe("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(Y=>{var ee,fe;return!(((ee=Y.rtpMap)===null||ee===void 0?void 0:ee.encodingName.toLocaleLowerCase())==="h264"&&((fe=Y.fmtp)===null||fe===void 0?void 0:fe.parameters["profile-level-id"])!==oe("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:P,recv:D,sendrecv:G}}(e,r,o);try{s.close()}catch{}return{send:c,recv:u,sendrecv:h}}function y9(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=LT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ou(e,r,"videoExtensions",s,o,c),Ou(e,r,"videoCodecs",s,o,c),Ou(e,r,"audioExtensions",s,o,c),Ou(e,r,"audioCodecs",s,o,c),oe("RAISE_H264_BASELINE_PRIORITY")){const u=c.videoCodecs.findIndex(h=>h.rtpMap&&h.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&h.fmtp&&h.fmtp.parameters["profile-level-id"]==="42001f");if(u!==-1){const h=c.videoCodecs.findIndex(m=>m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(h<u){x.debug("raising H264 baseline profile priority");const m=c.videoCodecs[u];c.videoCodecs.splice(u,1),c.videoCodecs.splice(h,0,m)}h!==-1&&(o.videoCodecs=o.videoCodecs.filter(m=>!(m.rtpMap&&m.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&m.fmtp&&m.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:s,recv:o,sendrecv:c}}function Ou(e,r,s,o,c,u){if(s==="videoExtensions"||s==="audioExtensions"){const h=[];return e[s].forEach(m=>{r[s].some((y,E)=>{if(m.entry===y.entry&&m.extensionName===y.extensionName)return h.push(E),!0})?u[s].push(m):o[s].push(m)}),void r[s].forEach((m,y)=>{h.indexOf(y)===-1&&c[s].push(m)})}if(s==="videoCodecs"||s==="audioCodecs"){const h=[];return e[s].forEach(m=>{r[s].some((y,E)=>{if(m.payloadType===y.payloadType&&JSON.stringify(m)===JSON.stringify(y))return h.push(E),!0})?u[s].push(m):o[s].push(m)}),void r[s].forEach((m,y)=>{h.indexOf(y)===-1&&c[s].push(m)})}}function EP(e){const{send:r,recv:s,sendrecv:o}=e;if(!o){if(!r||!s)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:s}}let c,u;return r?(c={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},c.audioCodecs=[...r.audioCodecs,...o.audioCodecs],c.videoCodecs=[...r.videoCodecs,...o.videoCodecs],c.audioExtensions=[...r.audioExtensions,...o.audioExtensions],c.videoExtensions=[...r.videoExtensions,...o.videoExtensions]):c=o,s?(u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},u.audioCodecs=[...s.audioCodecs,...o.audioCodecs],u.videoCodecs=[...s.videoCodecs,...o.videoCodecs],u.audioExtensions=[...s.audioExtensions,...o.audioExtensions],u.videoExtensions=[...s.videoExtensions,...o.videoExtensions]):u=o,{send:c,recv:u}}function cS(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(r=>{var s;return((s=r.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function MT(e,r,s,o){let c=[];if(e===bt.VIDEO){if(oe("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(c=r.videoCodecs.filter(u=>{var h;return ct(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)&&u&&u.fmtp&&u.fmtp.parameters["profile-level-id"]===oe("H264_PROFILE_LEVEL_ID")})),!Array.isArray(c)||c.length===0){let u=[];const h=[],m=[],y=[];if(s.videoCodecs.forEach(E=>{const S=E.rtpMap&&E.rtpMap.encodingName.toLowerCase()||"";ct(S).call(S,o)?u.push(E):ct(S).call(S,"vp9")?h.push(E):ct(S).call(S,"vp8")?m.push(E):ct(S).call(S,"h264")&&y.push(E)}),u.length===0){let E="";h.length!==0?(u=h,E="vp9"):m.length!==0?(u=m,E="vp8"):y.length!==0&&(u=y,E="h264"),x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(E))}u.length!==0&&(c=r.videoCodecs.filter(E=>u.some(S=>S.payloadType===E.payloadType)))}if(c.length===0&&(x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),c=r.videoCodecs),oe("USE_PUB_RTX")||oe("USE_SUB_RTX")){const u=HL(c,r.videoCodecs);c=[...c,...u]}}else c=r.audioCodecs.filter(u=>{var h;return ct(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,o)}),c.length===0&&(x.warning("codec ".concat(o," not included in rtpCapabilities, fallback to opus")),c=r.audioCodecs.filter(u=>{var h;return ct(h=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"").call(h,"opus")}));return c}function HL(e,r){const s=e.map(o=>o.payloadType.toString());return r.filter(o=>o.rtpMap&&o.rtpMap.encodingName==="rtx"&&o.fmtp&&o.fmtp.parameters.apt&&ct(s).call(s,o.fmtp&&o.fmtp.parameters.apt))}async function UT(e,r,s){const o=r.toString(),c=v9(o,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:o});const u=await e.createAnswer();if(!u.sdp)throw new Error("cannot get answer sdp");let h=u.sdp;h=E9(h,s||{}),c==null||c(h||""),await e.setLocalDescription({type:"answer",sdp:h})}function E9(e,r,s){const o=qa(e),{useXR:c}=r;return o.mediaDescriptions.forEach(u=>{var h;u.attributes.mid&&(Array.isArray(s)&&!ct(s).call(s,u.attributes.mid)||(u.media.mediaType==="audio"&&cS(u),c&&ct(h=["audio","video"]).call(h,u.media.mediaType)&&u.attributes.payloads.forEach(m=>{m.rtcpFeedbacks.findIndex(y=>y.type==="rrtr")===-1&&m.rtcpFeedbacks.push({type:"rrtr"})})))}),Gm(o)}function v9(e,r,s,o){if(oe("SDP_LOGGING"))return x.upload("exchanging ".concat(s," ").concat(r," SDP during P2PConnection.").concat(o,`
`),e),r==="offer"?c=>{v9(c,"answer",s==="local"?"remote":"local",o)}:void 0}function S9(e){const r=oe("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(s=>ct(e).call(e,s))}function b9(e,r){try{var s;return((s=e.fmtp)===null||s===void 0?void 0:s.parameters.apt)===r.payloadType.toString()}catch{return!1}}function T9(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function Ul(e,r){return typeof oe(e)===r?oe(e):void 0}function Gme(){try{const e=oe("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(r){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?arguments[s]:{};s%2?T9(Object(o),!0).forEach(function(c){q(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):T9(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}({},e)}catch(e){return x.debug("handle gateway attributes failed: ",e),{}}}const w9={};function Xm(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&x.debug("install service ".concat(e.name)),w9[e.name]=e}function mf(e){const r=w9[e];if(!r)throw new Le(te.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return r}function C9(e,r){return mf("DataStream").create(e,r)}function vP(){return mf("InterceptFrame").create()}function R9(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function gf(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?R9(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):R9(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}const $L=new Map;class Hme extends jr{get state(){return this._state}set state(r){if(r===this._state)return;const s=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(as.CONNECTION_STATE_CHANGE,r,s,this._disconnectedReason):this.emit(as.CONNECTION_STATE_CHANGE,r,s)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){x.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,s){var o,c,u;super(),q(this,"store",void 0),q(this,"joinInfo",void 0),q(this,"key",void 0),q(this,"ntpOffset",0),q(this,"signal",void 0),q(this,"role",void 0),q(this,"inChannelInfo",{joinAt:null,duration:0}),q(this,"spec",void 0),q(this,"_state","DISCONNECTED"),q(this,"_statsCollector",void 0),q(this,"_disconnectedReason",void 0),q(this,"isSignalRecover",!1),q(this,"hasChangeBGPAddress",!1),q(this,"trafficStatsInterval",void 0),q(this,"networkQualityInterval",void 0),q(this,"_joinGatewayStartTime",0),q(this,"_signalTimeout",!1),q(this,"_clientRoleOptions",void 0),q(this,"_isProactiveJoin",!1),this.store=r,this.spec=s,this.signal=this.store.useP2P?(o={spec:gf(gf({},s),{},{retryConfig:s.websocketRetryConfig}),store:r},(c=(u=mf("P2PChannel")).createSubmodule)===null||c===void 0?void 0:c.call(u,o)):new zme(gf(gf({},s),{},{retryConfig:s.websocketRetryConfig}),r),this._statsCollector=s.statsCollector,this.role=s.role||"audience",this._clientRoleOptions=s.clientRoleOptions,this.handleSignalEvents()}async join(r,s,o){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const c=Date.now();let u=$L.get(r.cname);if(u||(u=new Map,$L.set(r.cname,u)),this._isProactiveJoin=!0,u.has(r.uid)){const E=new Ae(te.UID_CONFLICT);throw Nt.joinGateway(r.sid,{lts:c,succ:!1,ec:E.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),E}u.set(r.uid,!0),this.joinInfo=r,this.key=s;let h=0;this.joinGatewayStartTime=c;const m=r.proxyServer;try{x.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(h));const E=r.gatewayAddrs.map(S=>{let{address:R}=S;const[P,D]=R.split(":"),G={host:P,port:D};return r.proxyServer&&(G.proxy=r.proxyServer),G});h=(await this.signal.init(E)).uid,x.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(h," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(E){var y;throw x.error("[".concat(this.store.clientId,"] User join failed"),E.toString()),Nt.joinGateway(r.sid,{lts:c,succ:!1,ec:((y=E.data)===null||y===void 0?void 0:y.desc)||E.code,errorMsg:E.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!m,signalChannel:"0",preload:r.preload}),u.delete(r.uid),this.signal.close(),E}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),x.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(E=>{x.warning("[".concat(this.store.clientId,"] get traffic stats error"),E.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(as.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(as.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(as.NETWORK_QUALITY,{uplinkNetworkQuality:o9(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:o9(this._statsCollector.trafficStats.B_dnq)}):this.emit(as.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),h}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],s=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){s!==Yn.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==_r.CONNECTED||await function(o,c){return c===1/0?o:ht.race([o,gfe(c)])}(this.signal.request(Yt.LEAVE,void 0,!0),3e3)}catch(o){x.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),o)}this.signal.close(s),s!==Yn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const c={state:"offer",p2p_id:this.store.p2pId,ortc:s,mode:this.spec.mode,extend:oe("PUB_EXTEND"),twcc:!!oe("PUBLISH_TWCC"),rtx:!!oe("USE_PUB_RTX")};try{return(await this.signal.request(Yt.PUBLISH,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Bt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),u.toString()),await this.tryUnpubBeforeRepub(r,s),this.publish(r,s,!1);throw u}}async publishDataChannel(r,s,o){var c;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const u={stream_id:s.streamId,ordered:s.ordered?1:0,max_retrans_times:(c=s.maxRetransmits)!==null&&c!==void 0?c:10,channel_id:s.channelId,metadata:s.metadata};try{await this.signal.request(Yt.PUBLISH_DATASTREAM,u,!0)}catch(h){if(o&&h.data&&h.data.code===Bt.ERR_PUBLISH_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),h.toString()),await this.tryUnpubDataChannelBeforeRepub(r,s),this.publishDataChannel(r,s,!1);throw h}}async unpublish(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Yt.UNPUBLISH,{stream_id:s,ortc:r},!0)}catch(o){x.warning("[".concat(this.store.clientId,"] unpublish warning: "),o)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ht.all(r.map(s=>this.signal.request(Yt.UNPUBLISH_DATASTREAM,{channel_id:s},!0)))}catch(s){x.warning("unpublish datachannels warning: ",s)}}async presubscribe(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!oe("SUBSCRIBE_TWCC"),rtx:!!oe("USE_SUB_RTX")||void 0,extend:oe("SUB_EXTEND"),svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return await this.signal.request(Yt.PRE_SUBSCRIBE,c,!0)}catch(u){if(o&&u.data&&u.data.code===Bt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),u.toString()),this.presubscribe(r,s,!1);throw u}}async subscribe(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const c={stream_id:r,stream_type:s.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!oe("SUBSCRIBE_TWCC"),rtx:!!oe("USE_SUB_RTX"),extend:oe("SUB_EXTEND"),ssrcId:s.ssrcId,svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return(await this.signal.request(Yt.SUBSCRIBE,c,!0))._message}catch(u){if(o&&u.data&&u.data.code===Bt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),u.toString()),await this.tryUnsubBeforeResub(r,s),await this.subscribe(r,s,!1);throw u}}async subscribeDataChannel(r,s,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const c={uid:r,stream_id:s.id,channel_id:s.datachannelId};try{return void await this.signal.request(Yt.SUBSCRIBE_DATASTREAM,c,!0)}catch(u){if(o&&u.data&&u.data.code===Bt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),u.toString()),await this.tryUnsubDataChannelBeforeResub(r,s),await this.subscribeDataChannel(r,s,!1);throw u}}async subscribeAll(r,s){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const o={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!oe("USE_SUB_RTX"),twcc:!!oe("SUBSCRIBE_TWCC"),svc:Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0};try{return await this.signal.request(Yt.SUBSCRIBE_STREAMS,o,!0)}catch(c){if(s&&c.data&&c.data.code===Bt.ERR_SUBSCRIBE_REQUEST_INVALID)return x.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),c.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw c}}async setVideoProfile(r){const s=function(o){if(!(o.bitrateMax&&o.bitrateMin&&o.frameRate&&o.height&&o.width))return;let c=o.frameRate,u=o.width,h=o.height,m=!0;return typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,c||(m=!1)),typeof u!="number"&&(u=u.exact||u.ideal||u.max||u.min||0,u||(m=!1)),typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,c||(m=!1)),m?{stream_type:0,width:u,height:h,fps:c,start_bps:1e3*o.bitrateMax,min_bps:1e3*o.bitrateMin,target_bps:1e3*o.bitrateMax}:void 0}(r);if(s)return this.signal.request(Yt.SET_VIDEO_PROFILE,s);x.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,s){try{await this.signal.request(Yt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:s},!0)}catch(o){x.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),o)}}async unsubscribeDataChannel(r,s){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ht.all(r.map(o=>this.signal.request(Yt.UNSUBSCRIBE_DATASTREAM,{stream_id:o,uid:s},!0)))}catch(o){x.warning("unsubscribeDataChannel warning: ",o)}}async massUnsubscribe(r){try{await this.signal.request(Yt.UNSUBSCRIBE_STREAMS,r,!0)}catch(s){x.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),s)}}async reconnectPC(r){const{iceParameters:s,dtlsParameters:o,rtpCapabilities:c}=r;return{gatewayEstablishParams:await this.signal.request(Yt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:s,dtlsParameters:o,rtpCapabilities:c}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Yt.GATEWAY_INFO)}async renewToken(r){await this.signal.request(Yt.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,s){s&&(this._clientRoleOptions=Object.assign({},s)),oe("CLIENT_ROLE_OPTIONS")&&(x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(oe("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},oe("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,s){if(s&&(this._clientRoleOptions=Object.assign({},s)),oe("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},oe("CLIENT_ROLE_OPTIONS")),x.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(oe("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let o,c=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(o=this._clientRoleOptions.delay,c=1):c=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:c=0,await this.signal.request(Yt.SET_CLIENT_ROLE,{role:r,level:c,delay:o,client_ts:Date.now()}),this.role=r}async setRemoteVideoStreamType(r,s){await this.signal.request(Yt.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:s})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(Yt.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,s){await this.signal.request(Yt.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:s})}async pickSVCLayer(r,s){await this.signal.request(Yt.PICK_SVC_LAYER,{stream_id:r,spatial_layer:s.spatialLayer,temporal_layer:s.temporalLayer})}async setRTM2Flag(r){await this.signal.request(Yt.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,s,o){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,s,o)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),gf({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Yt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=$L.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(s){let o;return o=s.startsWith("dc")?s.match(/(dc\:\/\/)?([^:]+):(\d+)/):s.match(/(wss\:\/\/)?([^:]+):(\d+)/),o?{username:ks.username,password:ks.password,turnServerURL:o[2],tcpport:parseInt(o[3])+30,udpport:parseInt(o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(gf(gf({},ks),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(Yt.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(s=>{const o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(c=>c.peer_uid===s.peer_uid);o&&o.B_st!==s.B_st&&FA(()=>{this.emit(as.STREAM_TYPE_CHANGE,s.peer_uid,s.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){if(!this.joinInfo||!this.key)throw new Ae(te.UNEXPECTED_ERROR,"can not generate join message, no join info");const s=Object.assign({},this.joinInfo.apResponse);let o=oe("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}var c;o&&o.length>128&&(o=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(as.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,ct(tS).call(tS,c)||tS.push(c);const u=!(Wr()||Gz(87)||DW())&&typeof oe("ENABLE_PRE_SUB")=="boolean"&&oe("ENABLE_PRE_SUB"),h=!DW()&&Ul("ENABLE_PREALLOC_PC","boolean"),m=Gme(),y=yT(87)||function(){const S=xn();if(S.name!==Hn.SAFARI||!S.browserVersion)return!1;const R=S.browserVersion.split(".");return Number(R[0])>15||Number(R[0])===15&&Number(R[1])>=4}(),E=gf({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Dl,browser:navigator.userAgent,process_id:oe("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:s,extend:oe("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:gf({enableEncodedTransform:!!oe("ENABLE_AUDIO_METADATA")&&y||!!oe("ENABLE_AUDIO_TOPN")&&jx(Hn.CHROME,87,116)||void 0,enableAudioMetadata:!!oe("ENABLE_AUDIO_METADATA")&&y,enableAudioPts:!!oe("ENABLE_AUDIO_PTS_METADATA")&&y,topnSmoothLevel:oe("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:oe("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:oe("TOPN_SWITCH_HOLD_MS"),topnAudioGain:oe("TOPN_AUDIO_GAIN"),enablePublishedUserList:oe("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:oe("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Ul("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Ul("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Ul("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:oe("USE_PUB_RTX")===!0||oe("USE_SUB_RTX")===!0||void 0,disableFEC:oe("DISABLE_FEC"),enableNTPReport:!!oe("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!oe("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!oe("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Ul("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!oe("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!oe("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Ul("USE_XR","boolean"),enableLossbasedBwe:Ul("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!oe("ENABLE_AUT_CC")||void 0,enableCCFallback:Ul("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:h,preSubNum:u?Ul("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Ul("PUBLISH_TWCC","boolean"),enableSubTWCC:Ul("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Ul("USE_PUB_RTX","boolean"),enableSubRTX:Ul("USE_SUB_RTX","boolean"),enableSubSVC:oe("ENABLE_SVC")?oe("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(oe("SVC"))&&oe("SVC").length!==0?oe("SVC"):void 0,enableSvcExtended:oe("ENABLE_SVC")&&Array.isArray(oe("SVC_EXTENDED"))&&oe("SVC_EXTENDED").length!==0?oe("SVC_EXTENDED"):void 0},m)},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(E.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(E.aes_mode=this.joinInfo.aesmode,oe("ENCRYPT_AES")?(E.aes_secret=this.joinInfo.aespassword,E.aes_encrypt=!0):E.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(E.aes_salt=this.joinInfo.aessalt)),s.addresses[this.signal.websocket.currentURLIndex]&&(E.ap_response.ticket=s.addresses[this.signal.websocket.currentURLIndex].ticket,delete s.addresses),this.joinInfo.defaultVideoStream!==void 0&&(E.default_video_stream=this.joinInfo.defaultVideoStream),E}getRejoinMessage(){if(!this.joinInfo)throw new Ae(te.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Jt.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Jt.WS_RECONNECTING,r=>{this.joinInfo&&Nt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||Ps.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Nt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Jt.WS_CLOSED,r=>{let s;switch(r){case Yn.LEAVE:s=Ps.LEAVE;break;case Yn.UID_BANNED:case Yn.IP_BANNED:case Yn.CHANNEL_BANNED:case Yn.SERVER_ERROR:s=Ps.SERVER_ERROR;break;case Yn.FALLBACK:s=Ps.FALLBACK;break;case Yn.LICENSE_MISSING:case Yn.LICENSE_EXPIRED:case Yn.LICENSE_MINUTES_EXCEEDED:case Yn.LICENSE_PERIOD_INVALID:case Yn.LICENSE_MULTIPLE_SDK_SERVICE:case Yn.LICENSE_ILLEGAL:case Yn.TOKEN_EXPIRE:s=r;break;default:s=Ps.NETWORK_ERROR}x.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(s||"undefined -> "+Ps.NETWORK_ERROR)),this.joinInfo&&Nt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===Yn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:s}),this._disconnectedReason=r,r!==Yn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Jt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=oe("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(x.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(Nt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void x.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));sr("EVENT_REPORT_DOMAIN",r[1]),sr("EVENT_REPORT_BACKUP_DOMAIN",r[1]),sr("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(Cn.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(Jt.REQUEST_RECOVER,(r,s,o)=>{if(!this.joinInfo)return o(new Ae(te.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Os(this,as.REQUEST_NEW_GATEWAY_LIST).then(s).catch(o)}),this.signal.on(Jt.REQUEST_JOIN_INFO,async(r,s,o)=>{var c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const u=$r((c=this.joinInfo)===null||c===void 0?void 0:c.turnServer);if(oe("NEW_TURN_MODE")&&u){let E=u.servers,S=u.serversFromGateway;const R=this.signal.currentURLIndex;E.length>0&&(E=[E[R%E.length]],u.servers=E),Array.isArray(S)&&S.length>0&&(S=[S[0]],u.serversFromGateway=S),x.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}const{iceParameters:h,dtlsParameters:m,rtpCapabilities:y}=await Os(this,as.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:u});try{r(this.getJoinMessage({ortc:{iceParameters:h,dtlsParameters:m,rtpCapabilities:y,version:"2"}}))}catch(E){s(E)}}),this.signal.on(Jt.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(Jt.REPORT_JOIN_GATEWAY,(r,s)=>{if(!this.joinInfo)return;let o,c="";var u;r instanceof Ae?(o=((u=r.data)===null||u===void 0?void 0:u.desc)||r.code,c=r.message):o=r,Nt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:o,errorMsg:c,addr:s,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Jt.IS_P2P_DISCONNECTED,r=>{r(TT(this,as.IS_P2P_DISCONNECTED))}),this.signal.on(Jt.DISCONNECT_P2P,()=>{this.emit(as.DISCONNECT_P2P)}),this.signal.on(Jt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Jt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Jt.JOIN_RESPONSE,r=>{const s=this.getCurrentGatewayAddress();this.emit(as.JOIN_RESPONSE,r,s)}),this.signal.on(Jt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress(),s=oe("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(r&&s){const o=f9(r);this.emit(as.PRE_CONNECT_PC,{candidates:o,fingerprint:s})}}}),this.signal.on(Jt.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof oe("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(oe("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,s){try{await this.signal.request(Yt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[s]},!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),o),o}}async tryUnsubDataChannelBeforeResub(r,s){try{await this.signal.request(Yt.UNSUBSCRIBE,{stream_id:s.id},!0)}catch(o){throw x.warning("unsubscribe datachannel warning",o),o}}async tryUnpubBeforeRepub(r,s){try{await this.signal.request(Yt.UNPUBLISH,{stream_id:r,ortc:s},!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),o),o}}async tryUnpubDataChannelBeforeRepub(r,s){try{await this.signal.request(Yt.UNPUBLISH_DATASTREAM,{channnel_id:s.channelId},!0)}catch(o){throw x.warning("unpublish datastream warning: ",o),o}}async tryMassUnsubBeforeResub(r){const s={users:r.map(o=>({stream_id:o.stream_id,stream_type:o.stream_type}))};try{await this.signal.request(Yt.UNSUBSCRIBE_STREAMS,s,!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),o),o}}async muteLocal(r,s){const o={action:r.find(c=>c.stream_type===Qn.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Yt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),c),c}}async unmuteLocal(r,s){const o={action:r.find(c=>c.stream_type===Qn.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:s};try{await this.signal.request(Yt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),c),c}}async muteRemote(r,s){const o={action:r===bt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Yt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),c),c}}async unmuteRemote(r,s){const o={action:r===bt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:s};try{await this.signal.request(Yt.CONTROL,o,!0,!0)}catch(c){throw x.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),c),c}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,s){this.signal.upload(r,s)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const s={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(Yt.RESTART_ICE,s,!0)}catch(o){throw x.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),o),o}}reconnect(r,s){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,s||Ps.P2P_FAILED)}getCurrentGatewayAddress(){var r,s;if(!oe("GATEWAY_WSS_ADDRESS"))return oe("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(x.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(s=this.joinInfo)!==null&&s!==void 0&&s.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(Yt.SET_PARAMETER,{enablePublishAudioFilter:r})}}let SP=0,KL=0;function kd(e,r,s,o){return new ht((c,u)=>{r.timeout=r.timeout||oe("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!s?(r.data=JSON.stringify(r.data),SP+=Rh(r.data)):s&&(r.data.size?SP+=r.data.size:r.data instanceof FormData?SP+=cW(r.data):SP+=Rh(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,_a.request(r).then(h=>{typeof h.data=="string"?KL+=Rh(h.data):h.data instanceof ArrayBuffer||h.data instanceof Uint8Array?KL+=h.data.byteLength:KL+=Rh(JSON.stringify(h.data)),o&&c({data:h.data,headers:h.headers}),c(h.data)}).catch(h=>{_a.isCancel(h)?u(new Ae(te.OPERATION_ABORTED,"cancel token canceled")):h.code==="ECONNABORTED"?u(new Ae(te.NETWORK_TIMEOUT,h.message)):h.response?u(new Ae(te.NETWORK_RESPONSE_ERROR,h.response.status)):u(new Ae(te.NETWORK_ERROR,h.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function r(We){var ot=0;return function(){return ot<We.length?{done:!1,value:We[ot++]}:{done:!0}}}var s=typeof Object.defineProperties=="function"?Object.defineProperty:function(We,ot,At){return We==Array.prototype||We==Object.prototype||(We[ot]=At.value),We},o,c=function(We){We=[typeof globalThis=="object"&&globalThis,We,typeof window=="object"&&window,typeof self=="object"&&self,typeof a=="object"&&a];for(var ot=0;ot<We.length;++ot){var At=We[ot];if(At&&At.Math==Math)return At}throw Error("Cannot find global object")}(this);function u(We,ot){if(ot)e:{var At=c;We=We.split(".");for(var Ye=0;Ye<We.length-1;Ye++){var U=We[Ye];if(!(U in At))break e;At=At[U]}(ot=ot(Ye=At[We=We[We.length-1]]))!=Ye&&ot!=null&&s(At,We,{configurable:!0,writable:!0,value:ot})}}function h(We){return(We={next:We})[Symbol.iterator]=function(){return this},We}function m(We){var ot=typeof Symbol<"u"&&Symbol.iterator&&We[Symbol.iterator];return ot?ot.call(We):{next:r(We)}}if(u("Symbol",function(We){function ot(U,ce){this.A=U,s(this,"description",{configurable:!0,writable:!0,value:ce})}if(We)return We;ot.prototype.toString=function(){return this.A};var At="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Ye=0;return function U(ce){if(this instanceof U)throw new TypeError("Symbol is not a constructor");return new ot(At+(ce||"")+"_"+Ye++,ce)}}),u("Symbol.iterator",function(We){if(We)return We;We=Symbol("Symbol.iterator");for(var ot="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),At=0;At<ot.length;At++){var Ye=c[ot[At]];typeof Ye=="function"&&typeof Ye.prototype[We]!="function"&&s(Ye.prototype,We,{configurable:!0,writable:!0,value:function(){return h(r(this))}})}return We}),typeof Object.setPrototypeOf=="function")o=Object.setPrototypeOf;else{var y;e:{var E={};try{E.__proto__={a:!0},y=E.a;break e}catch{}y=!1}o=y?function(We,ot){if(We.__proto__=ot,We.__proto__!==ot)throw new TypeError(We+" is not extensible");return We}:null}var S=o;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function P(We){if(We.m)throw new TypeError("Generator is already running");We.m=!0}function D(We,ot){return We.h=3,{value:ot}}function G(We){this.g=new R,this.G=We}function j(We,ot,At,Ye){try{var U=ot.call(We.g.j,At);if(!(U instanceof Object))throw new TypeError("Iterator result "+U+" is not an object");if(!U.done)return We.g.m=!1,U;var ce=U.value}catch(me){return We.g.j=null,We.g.s(me),B(We)}return We.g.j=null,Ye.call(We.g,ce),B(We)}function B(We){for(;We.g.h;)try{var ot=We.G(We.g);if(ot)return We.g.m=!1,{value:ot.value,done:!1}}catch(At){We.g.v=void 0,We.g.s(At)}if(We.g.m=!1,We.g.l){if(ot=We.g.l,We.g.l=null,ot.F)throw ot.D;return{value:ot.return,done:!0}}return{value:void 0,done:!0}}function Y(We){this.next=function(ot){return We.o(ot)},this.throw=function(ot){return We.s(ot)},this.return=function(ot){return function(At,Ye){P(At.g);var U=At.g.j;return U?j(At,"return"in U?U.return:function(ce){return{value:ce,done:!0}},Ye,At.g.return):(At.g.return(Ye),B(At))}(We,ot)},this[Symbol.iterator]=function(){return this}}function ee(We,ot){return ot=new Y(new G(ot)),S&&We.prototype&&S(ot,We.prototype),ot}if(R.prototype.o=function(We){this.v=We},R.prototype.s=function(We){this.l={D:We,F:!0},this.h=this.C||this.u},R.prototype.return=function(We){this.l={return:We},this.h=this.u},G.prototype.o=function(We){return P(this.g),this.g.j?j(this,this.g.j.next,We,this.g.o):(this.g.o(We),B(this))},G.prototype.s=function(We){return P(this.g),this.g.j?j(this,this.g.j.throw,We,this.g.o):(this.g.s(We),B(this))},u("Array.prototype.entries",function(We){return We||function(){return function(ot,At){ot instanceof String&&(ot+="");var Ye=0,U=!1,ce={next:function(){if(!U&&Ye<ot.length){var me=Ye++;return{value:At(me,ot[me]),done:!1}}return U=!0,{done:!0,value:void 0}}};return ce[Symbol.iterator]=function(){return ce},ce}(this,function(ot,At){return[ot,At]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var fe=function(We,ot){for(var At=0;At<We.length;At++)ot(We[At])},ye=function(We){return We.replace(/\r?\n|\r/g,`\r
`)},Ee=function(We,ot,At){return ot instanceof Blob?(At=At!==void 0?At+"":typeof ot.name=="string"?ot.name:"blob",ot.name===At&&Object.prototype.toString.call(ot)!=="[object Blob]"||(ot=new File([ot],At)),[String(We),ot]):[String(We),String(ot)]},_e=function(We,ot){if(We.length<ot)throw new TypeError(ot+" argument required, but only "+We.length+" present.")},Ne=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Ze=Ne.FormData,pt=Ne.XMLHttpRequest&&Ne.XMLHttpRequest.prototype.send,yt=Ne.Request&&Ne.fetch,In=Ne.navigator&&Ne.navigator.sendBeacon,An=Ne.Element&&Ne.Element.prototype,mr=Ne.Symbol&&Symbol.toStringTag;mr&&(Blob.prototype[mr]||(Blob.prototype[mr]="Blob"),"File"in Ne&&!File.prototype[mr]&&(File.prototype[mr]="File"));try{new File([],"")}catch{Ne.File=function(ot,At,Ye){return ot=new Blob(ot,Ye||{}),Object.defineProperties(ot,{name:{value:At},lastModified:{value:+(Ye&&Ye.lastModified!==void 0?new Date(Ye.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),mr&&Object.defineProperty(ot,mr,{value:"File"}),ot}}var li=function(We){return We.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Jr=function(We){this.i=[];var ot=this;We&&fe(We.elements,function(At){if(At.name&&!At.disabled&&At.type!=="submit"&&At.type!=="button"&&!At.matches("form fieldset[disabled] *"))if(At.type==="file"){var Ye=At.files&&At.files.length?At.files:[new File([],"",{type:"application/octet-stream"})];fe(Ye,function(U){ot.append(At.name,U)})}else At.type==="select-multiple"||At.type==="select-one"?fe(At.options,function(U){!U.disabled&&U.selected&&ot.append(At.name,U.value)}):At.type==="checkbox"||At.type==="radio"?At.checked&&ot.append(At.name,At.value):(Ye=At.type==="textarea"?ye(At.value):At.value,ot.append(At.name,Ye))})};if((e=Jr.prototype).append=function(We,ot,At){_e(arguments,2),this.i.push(Ee(We,ot,At))},e.delete=function(We){_e(arguments,1);var ot=[];We=String(We),fe(this.i,function(At){At[0]!==We&&ot.push(At)}),this.i=ot},e.entries=function We(){var ot,At=this;return ee(We,function(Ye){if(Ye.h==1&&(ot=0),Ye.h!=3)return ot<At.i.length?Ye=D(Ye,At.i[ot]):(Ye.h=0,Ye=void 0),Ye;ot++,Ye.h=2})},e.forEach=function(We,ot){_e(arguments,1);for(var At=m(this),Ye=At.next();!Ye.done;Ye=At.next()){var U=m(Ye.value);Ye=U.next().value,U=U.next().value,We.call(ot,U,Ye,this)}},e.get=function(We){_e(arguments,1);var ot=this.i;We=String(We);for(var At=0;At<ot.length;At++)if(ot[At][0]===We)return ot[At][1];return null},e.getAll=function(We){_e(arguments,1);var ot=[];return We=String(We),fe(this.i,function(At){At[0]===We&&ot.push(At[1])}),ot},e.has=function(We){_e(arguments,1),We=String(We);for(var ot=0;ot<this.i.length;ot++)if(this.i[ot][0]===We)return!0;return!1},e.keys=function We(){var ot,At,Ye,U,ce=this;return ee(We,function(me){if(me.h==1&&(ot=m(ce),At=ot.next()),me.h!=3)return At.done?void(me.h=0):(Ye=At.value,U=m(Ye),D(me,U.next().value));At=ot.next(),me.h=2})},e.set=function(We,ot,At){_e(arguments,2),We=String(We);var Ye=[],U=Ee(We,ot,At),ce=!0;fe(this.i,function(me){me[0]===We?ce&&(ce=!Ye.push(U)):Ye.push(me)}),ce&&Ye.push(U),this.i=Ye},e.values=function We(){var ot,At,Ye,U,ce=this;return ee(We,function(me){if(me.h==1&&(ot=m(ce),At=ot.next()),me.h!=3)return At.done?void(me.h=0):(Ye=At.value,(U=m(Ye)).next(),D(me,U.next().value));At=ot.next(),me.h=2})},Jr.prototype._asNative=function(){for(var We=new Ze,ot=m(this),At=ot.next();!At.done;At=ot.next()){var Ye=m(At.value);At=Ye.next().value,Ye=Ye.next().value,We.append(At,Ye)}return We},Jr.prototype._blob=function(){var We="----formdata-polyfill-"+Math.random(),ot=[],At="--"+We+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Ye,U){return typeof Ye=="string"?ot.push(At+li(ye(U))+`"\r
\r
`+ye(Ye)+`\r
`):ot.push(At+li(ye(U))+'"; filename="'+li(Ye.name)+`"\r
Content-Type: `+(Ye.type||"application/octet-stream")+`\r
\r
`,Ye,`\r
`)}),ot.push("--"+We+"--"),new Blob(ot,{type:"multipart/form-data; boundary="+We})},Jr.prototype[Symbol.iterator]=function(){return this.entries()},Jr.prototype.toString=function(){return"[object FormData]"},An&&!An.matches&&(An.matches=An.matchesSelector||An.mozMatchesSelector||An.msMatchesSelector||An.oMatchesSelector||An.webkitMatchesSelector||function(We){for(var ot=(We=(this.document||this.ownerDocument).querySelectorAll(We)).length;0<=--ot&&We.item(ot)!==this;);return-1<ot}),mr&&(Jr.prototype[mr]="FormData"),pt){var Ta=Ne.XMLHttpRequest.prototype.setRequestHeader;Ne.XMLHttpRequest.prototype.setRequestHeader=function(We,ot){Ta.call(this,We,ot),We.toLowerCase()==="content-type"&&(this.B=!0)},Ne.XMLHttpRequest.prototype.send=function(We){We instanceof Jr?(We=We._blob(),this.B||this.setRequestHeader("Content-Type",We.type),pt.call(this,We)):pt.call(this,We)}}yt&&(Ne.fetch=function(We,ot){return ot&&ot.body&&ot.body instanceof Jr&&(ot.body=ot.body._blob()),yt.call(this,We,ot)}),In&&(Ne.navigator.sendBeacon=function(We,ot){return ot instanceof Jr&&(ot=ot._asNative()),In.call(this,We,ot)}),Ne.FormData=Jr}})();const VT=()=>{const e=oe("AREAS");return e.length===0&&e.push($n.GLOBAL),gc(e).call(e,(r,s,o)=>{const c=I9(s);return c?o===0?c:"".concat(r,",").concat(c):r},"")},I9=e=>e===$n.OVERSEA?"".concat(Ys.ASIA,",").concat(Ys.EUROPE,",").concat(Ys.AFRICA,",").concat(Ys.NORTH_AMERICA,",").concat(Ys.SOUTH_AMERICA,",").concat(Ys.OCEANIA):Ys[e],$me=e=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(s=>{const o=pP[s],c=Object.keys(o);c&&c.map(u=>{u!=="CODE"&&(r[u]=r[u].concat(o[u]))})}),r},bP={GLOBAL:{ASIA:[$n.CHINA,$n.JAPAN,$n.INDIA,$n.KOREA,$n.HKMC],EUROPE:[],NORTH_AMERICA:[$n.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},TP=Object.keys(bP[$n.GLOBAL]),qL=[$n.CHINA,$n.NORTH_AMERICA,$n.EUROPE,$n.ASIA,$n.JAPAN,$n.INDIA,$n.OCEANIA,$n.SOUTH_AMERICA,$n.AFRICA,$n.KOREA,$n.HKMC,$n.US],Kme=function(e,r){let s=[];if(ct(e).call(e,$n.GLOBAL)){const u=[$n.GLOBAL,$n.OVERSEA],h=Object.keys(pP);if(r===$n.GLOBAL)throw new Ae(te.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===$n.CHINA)s=[$n.OVERSEA];else if(c=r,ct(TP).call(TP,c)){const m=(o=r,bP[$n.GLOBAL][o]||[]),y=[...u,r,...m];s=h.filter(E=>!ct(y).call(y,E))}else if(function(m){let y=!1;return TP.forEach(E=>{var S;ct(S=bP[$n.GLOBAL][E]).call(S,m)&&(y=!0)}),y}(r)){const m=function(E){let S;return TP.forEach(R=>{var P;ct(P=bP[$n.GLOBAL][R]).call(P,E)&&(S=R)}),S}(r),y=[...u,m,r];s=h.filter(E=>!ct(y).call(y,E))}else s=e;s=function(m){const y=[];return qL.forEach(E=>{ct(m).call(m,E)&&y.push(E)}),y.concat(m.filter(E=>!ct(qL).call(qL,E)))}(s)}else s=e;var o,c;return s};function A9(e){var r,s;if(!e&&ct(r=oe("AREAS")).call(r,$n.EXTENSIONS))return x.debug("update area from ap : reset"),void YL(nme,!0);if(!ct(s=oe("AREAS")).call(s,$n.GLOBAL)||!e)return;let o=pP.EXTENSIONS;o&&(o={CODE:I9($n.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},x.debug("update area from ap success: ".concat(e,",config is "),o),sr("AREAS",[$n.EXTENSIONS],!0),Object.keys(o).map(c=>{c==="LOG_UPLOAD_SERVER"||c==="EVENT_REPORT_DOMAIN"||c==="EVENT_REPORT_BACKUP_DOMAIN"||c==="PROXY_SERVER_TYPE3"?sr(c,o[c][0]):sr(c,o[c])}))}function YL(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=Nt.reportApiInvoke(null,{name:Ai.SET_AREA,options:e,tag:Hr.TRACER});try{let o=[];if(typeof e=="string"&&(o=[e]),Array.isArray(e)&&(e.forEach(u=>{if(!ct(qG).call(qG,u))throw new Ae(te.INVALID_PARAMS,"invalid area code")}),o=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:u,excludedArea:h}=e;if(!u)throw new Ae(te.INVALID_PARAMS,"area code is needed");let m=u;typeof u=="string"&&(m=[u]),o=h?Kme(m,h):m}if(!r){if(Id.AREAS){const u=new Ae(te.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return s.onError(u),void x.warning("setArea is prohibited because of config-distribute")}if(ct(o).call(o,$n.GLOBAL)&&oe("AREAS")===$n.EXTENSIONS){const u=new Ae(te.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return s.onError(u),void x.warning("setArea is prohibited because of ap extensions")}}sr("AREAS",o,r);const c=$me(o);Object.keys(c).map(u=>{u==="LOG_UPLOAD_SERVER"||u==="EVENT_REPORT_DOMAIN"||u==="EVENT_REPORT_BACKUP_DOMAIN"||u==="PROXY_SERVER_TYPE3"?sr(u,c[u][0]):sr(u,c[u])}),x.debug("set area success:",o.join(","))}catch(o){throw s.onError(o),o}s.onSuccess()}function P9(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function Nh(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?P9(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):P9(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}let XL=1;function qme(e,r,s,o,c){XL+=1;const u={sid:s.sid,command:"convergeAllocateEdge",uid:"666",appId:s.appId,ts:Math.floor(Date.now()/1e3),seq:XL,requestId:XL,version:Dl,cname:s.cname},h={service_name:r,json_body:JSON.stringify(u)};let m,y,E=e[0];return Rd(async()=>{m=Date.now();const S=await kd(E,{data:h,cancelToken:o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(y=Date.now()-m,S.code!==0){const D=new Ae(te.UNEXPECTED_RESPONSE,"live streaming ap error, code"+S.code,{retry:!0,responseTime:y});throw x.error(D.toString()),D}const R=JSON.parse(S.json_body);if(R.code!==200){const D=new Ae(te.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:y});throw x.error(D.toString()),D}if(!R.servers||R.servers.length===0){const D=new Ae(te.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:y});throw x.error(D.toString()),D}const P=function(D,G){return{addressList:D.servers.map(j=>"wss://".concat(j.address.replace(/\./g,"-"),".").concat(oe("WORKER_DOMAIN"),":").concat(j.wss,"?serviceName=").concat(encodeURIComponent(G))),workerToken:D.workerToken,vid:D.vid}}(R,r);return oe("LIVE_STREAMING_ADDRESS")&&(P.addressList=oe("LIVE_STREAMING_ADDRESS")instanceof Array?oe("LIVE_STREAMING_ADDRESS"):[oe("LIVE_STREAMING_ADDRESS")]),Nh(Nh({},P),{},{responseTime:y})},(S,R)=>(Nt.apworkerEvent(s.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(S.addressList),firstSuccess:R===0,responseTime:y,serverIp:e[R%e.length]}),!1),(S,R)=>(Nt.apworkerEvent(s.sid,{success:!1,sc:S.data&&S.data.code||200,serviceName:r,responseTime:y,serverIp:e[R%e.length]}),!!(S.code!==te.OPERATION_ABORTED&&S.code!==te.UNEXPECTED_RESPONSE||S.data&&S.data.retry)&&(E=e[(R+1)%e.length],!0)),c)}let JL=1;function O9(e,r,s,o){let{url:c,areaCode:u}=e;const{clientId:h,sid:m}=r,y=Date.now();let E;const S=r.role,[R,P]=ZL(r,u,[Ei.CHOOSE_SERVER]);let D=yi.networkState;return Rd(async()=>{D&&yi.networkState===Tc.OFFLINE&&yi.onlineWaiter&&await ht.race([yi.onlineWaiter,ps(o&&o.maxRetryTimeout||Pi.maxRetryTimeout)]),D=yi.networkState;const{data:G,headers:j}=await kd(c,{data:R,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);E=j.http3==="1"?1:-1,Nt.reportResourceTiming(c,m),N9(G,c,r,y,[Ei.CHOOSE_SERVER],E);const B=xT(G,Ei.CHOOSE_SERVER);return QL(B),BL(B,c)},G=>(G&&Nt.joinChooseServer(m,{role:S,lts:y,succ:!0,csAddr:c,opid:P,serverList:G.gatewayAddrs.map(j=>j.address),ec:null,cid:G.cid.toString(),uid:G.uid.toString(),csIp:G.csIp,unilbsServerIds:[Ei.CHOOSE_SERVER].toString(),isHttp3:E,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:G.res.detail&&G.res.detail[38]}),!1),G=>G.code!==te.OPERATION_ABORTED&&(G.code===te.CAN_NOT_GET_GATEWAY_SERVER?G.data.retry:(Nt.joinChooseServer(m,{role:S,lts:y,succ:!1,csAddr:c,serverList:null,opid:P,ec:G.code,csIp:G.data&&G.data.csIp,unilbsServerIds:[Ei.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:D}),isHttp3:E,corssRegionTagReq:r.apRequestDetail}),x.warning("[".concat(h||"sid-".concat(m.slice(0,6)),"] Choose server network error, retry"),G),!0)),o)}function k9(e,r,s,o){let c,{url:u,areaCode:h,serviceIds:m}=e;const y=Date.now(),E=r.role,[S,R]=ZL(r,h,m);let P;return Rd(async()=>{P&&yi.networkState===Tc.OFFLINE&&yi.onlineWaiter&&await ht.race([yi.onlineWaiter,ps(o&&o.maxRetryTimeout||Pi.maxRetryTimeout)]),P=yi.networkState;const{data:D,headers:G}=await kd(u,{data:S,cancelToken:s,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=G.http3==="1"?1:-1,Nt.reportResourceTiming(u,r.sid),N9(D,u,r,y,m,c);const j=xT(D,Ei.CHOOSE_SERVER),B=xT(D,r.cloudProxyServer==="proxy5"?Ei.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?Ei.CLOUD_PROXY:Ei.CLOUD_PROXY_FALLBACK);return QL(j),{gatewayInfo:BL(j,u),proxyInfo:B,url:u}},D=>(D.gatewayInfo&&Nt.joinChooseServer(r.sid,{role:E,lts:y,succ:!0,csAddr:u,serverList:D.gatewayInfo.gatewayAddrs.map(G=>G.address),ec:null,opid:R,cid:D.gatewayInfo.cid.toString(),uid:D.gatewayInfo.uid.toString(),csIp:D.gatewayInfo.csIp,unilbsServerIds:m.toString(),isHttp3:c,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:D.gatewayInfo.res.detail&&D.gatewayInfo.res.detail[38]}),D.proxyInfo&&Nt.joinWebProxyAP(r.sid,{lts:y,sucess:1,apServerAddr:u,turnServerAddrList:D.proxyInfo.addresses.map(G=>G.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:m.toString()}),!1),D=>D.code!==te.OPERATION_ABORTED&&(D.code===te.CAN_NOT_GET_GATEWAY_SERVER?D.data.retry:(Nt.joinWebProxyAP(r.sid,{lts:y,sucess:0,apServerAddr:u,turnServerAddrList:null,errorCode:D.code,eventType:r.cloudProxyServer,unilbsServerIds:m.toString(),extend:JSON.stringify({networkState:P})}),x.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),D),!0)),o)}const N9=(e,r,s,o,c,u)=>{const{sid:h,clientId:m,cloudProxyServer:y}=s,E=[],S=R=>{R.flag===4096?Nt.joinChooseServer(h,{role:s.role,lts:o,succ:!1,csAddr:r,opid:e.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:c.toString(),isHttp3:u,corssRegionTagReq:s.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||Nt.joinWebProxyAP(h,{lts:o,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:R.error.code,eventType:y,unilbsServerIds:c.toString()})};if(e.response_body.forEach(R=>{const P=R.buffer.code;if(R.uri===23&&P===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{const D={error:new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:R.buffer.flag};E.push(D),S(D)}if(P!==0){const D=sS(P),G={error:new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,D.desc,{desc:D.desc,retry:D.retry,csIp:e.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?x.warning(G.error.toString()):E.push(G),S(G)}}),E.length)throw x.warning("[".concat(m||"sid-".concat(h.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(E.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,E.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!E.find(R=>R.error.data.retry),csIp:e.detail[502],desc:[...new Set(E.map(R=>{var P;return R==null||(P=R.error)===null||P===void 0||(P=P.data)===null||P===void 0?void 0:P.desc}).filter(R=>!!R))]})},QL=e=>{var r,s,o,c;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(oe("AP_AREA")&&((o=e.detail)!==null&&o!==void 0&&o[23]&&typeof((c=e.detail)===null||c===void 0?void 0:c[23])=="string"?A9(e.detail[23].toLowerCase()):A9()),(r=e.detail)!==null&&r!==void 0&&r[19]&&typeof((s=e.detail)===null||s===void 0?void 0:s[19])=="string"){const h=e.detail[19],m=h==null?void 0:h.split(";");for(let y=0;y<m.length;y++){var u;const E=wo(u=m[y]).call(u);e.addresses[y]&&m&&(e.addresses[y].fingerprint=E)}}if(oe("GATEWAY_ADDRESS")&&oe("GATEWAY_ADDRESS").length>0){x.debug("assign gateway address to",oe("GATEWAY_ADDRESS"));const h=oe("GATEWAY_ADDRESS").map(m=>{var y,E;const S=(y=(E=e.addresses.find(R=>R.ip===m.ip&&R.port===m.port))===null||E===void 0?void 0:E.fingerprint)!==null&&y!==void 0?y:"";return{ip:m.ip,port:m.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:S}});e.addresses=h}},Yme=(e,r)=>{if(e.response_body&&e.response_body.length){const s=e.response_body[0];if(s.buffer.code!==0){const o=sS(s.buffer.code);throw new Ae(te.UPDATE_TICKET_FAILED,"[".concat(s.buffer.code,"]: ").concat(o.desc),{retry:o.retry})}return s.buffer.ticket}throw x.debug("update ticket request received ap response without response body:",r),new Ae(te.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},ZL=(e,r,s)=>{const o=Math.floor(Math.random()*1e12),c=e.role==="host"?"1":e.role==="audience"?"2":void 0,u={appid:e.appId,client_ts:Date.now(),opid:o,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Nh(Nh(Nh({6:e.stringUid,11:r,12:oe("USE_NEW_TOKEN")?"1":void 0},c?{17:c}:{}),{},{22:r},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:s,uid:e.uid||0}}]};u.request_bodies.forEach(m=>{e.multiIP&&e.multiIP.gateway_ip&&(m.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const h=new FormData;return h.append("request",JSON.stringify(u)),[h,o]},Xme=(e,r)=>{const s=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:s,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:r,uid:e.uid||0,edges_services:e.apResponse.addresses.map(u=>({ip:u.ip,port:u.port}))}}]},c=new FormData;return c.append("request",JSON.stringify(o)),[c,s]};let lS=0;function uS(e){return ht.all(e.map(r=>r.then(s=>{throw s},s=>s))).then(r=>{throw r},r=>r)}const jT=async e=>{let{fragementLength:r,referenceList:s,asyncMapHandler:o,allFailedhandler:c,promisesCollector:u}=e,h=0;const m=r;let y,E=0;const S=async()=>{const R=(()=>{const P=h*m,D=P+m;return s.slice(P,D).map(o)})();u&&u.push(...R);try{y=await uS(R)}catch(P){if(E+=m,h++,!(E>=s.length))return void await S();c(P)}R.forEach(P=>P.cancel())};return await S(),y},D9=async e=>{let{referenceList:r,asyncMapHandler:s,closeFn:o}=e;const c=r.length;let u=0;const h=async()=>{const m=s(r.shift());try{return await m}catch(y){if(u++,u>=c||o!=null&&o(y))throw y;return h()}};return h()};async function e2(e,r,s,o){return{gatewayInfo:await async function(u,h,m,y){let E=null;const S=[],R=async()=>{const D=oe("WEBCS_DOMAIN").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(B=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(B+"/api/v2/transpond/webrtc?v=2"):"https://".concat(B,"/api/v2/transpond/webrtc?v=2"),areaCode:VT()})),G=y.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(B=>B.url)}),j=await jT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:B=>(x.debug("[".concat(u.clientId,"] Connect to choose_server:"),B.url),O9(B,u,h,m)),allFailedhandler:B=>{throw y.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},G),B[0]},promisesCollector:S});return y.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j},P=async()=>{if(await ps(1e3),E!==null)return E;const D=oe("WEBCS_DOMAIN_BACKUP_LIST").map(B=>({url:u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(B+"/api/v2/transpond/webrtc?v=2"):"https://".concat(B,"/api/v2/transpond/webrtc?v=2"),areaCode:VT()})),G=y.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(B=>B.url)}),j=await jT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:B=>(x.debug("[".concat(u.clientId,"] Connect to backup choose_server:"),B.url),O9(B,u,h,m)),allFailedhandler:B=>{throw y.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},G),B[0]},promisesCollector:S});return y.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j};try{return E=await uS([R(),P()]),S.length&&S.forEach(D=>D.cancel&&typeof D.cancel=="function"&&D.cancel()),E}catch(D){throw D[0]}}(e,r,s,o)}}async function x9(e,r,s,o,c){const u=e.cloudProxyServer;if(u==="disabled"){if(e.useLocalAccessPoint)return await e2(e,r,s,c);if(oe("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:P,proxyInfo:D}=await U9(e,r,s,c);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:P};const G=D.map(j=>({turnServerURL:j.address,tcpport:j.tcpport||ks.tcpport,udpport:j.udpport||ks.udpport,username:j.username||ks.username,password:j.password||ks.password,forceturn:!1,security:!0}));if(c.useP2P){var h;const j=(h=e.uid)!==null&&h!==void 0?h:P.uid,B="glb:".concat(j.toString()),Y=await Kx(B),ee=D.map(fe=>({turnServerURL:fe.address,tcpport:fe.tcpport||ks.tcpport,udpport:fe.udpport||ks.udpport,username:B,password:Y,forceturn:!1,security:!0}));G.push(...ee)}return e.turnServer={mode:"manual",servers:G},{gatewayInfo:P}}return await e2(e,r,s,c)}const{proxyInfo:m,gatewayInfo:y}=await U9(e,r,s,c),E={gatewayInfo:y},S=m.map(P=>({turnServerURL:P.address,tcpport:u==="proxy3"?void 0:P.tcpport?P.tcpport:ks.tcpport,udpport:u==="proxy4"?void 0:P.udpport?P.udpport:ks.udpport,username:P.username||ks.username,password:P.password||ks.password,forceturn:u!=="proxy4",security:u==="proxy5"}));if(c.useP2P){var R;const P=(R=e.uid)!==null&&R!==void 0?R:y.uid,D="glb:".concat(P.toString()),G=await Kx(D),j=m.map(B=>({turnServerURL:B.address,tcpport:u==="proxy3"?void 0:B.tcpport||ks.tcpport,udpport:u==="proxy4"?void 0:B.udpport||ks.udpport,username:D,password:G,forceturn:u!=="proxy4",security:u==="proxy5"}));S.push(...j)}return e.turnServer={mode:"manual",servers:S},x.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(u)),E}async function L9(e,r,s,o,c){const u=oe("ACCOUNT_REGISTER").slice(0,oe("AJAX_REQUEST_CONCURRENT"));let h=[];h=r.proxyServer?u.map(y=>"https://".concat(r.proxyServer,"/ap/?url=").concat(y+"/api/v1")):u.map(y=>"https://".concat(y,"/api/v1"));const m=c==null?void 0:c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:h});try{const y=await async function(E,S,R,P,D){const G=Date.now(),j={sid:R.sid,opid:10,appid:R.appId,string_uid:S};let B=E[0];const Y=await Rd(()=>kd(B+"".concat(B.indexOf("?")===-1?"?":"&","action=stringuid"),{data:j,cancelToken:P,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(ee,fe)=>{if(ee.code===0){if(ee.uid<=0||ee.uid>=Math.pow(2,32))throw x.error("Invalid Uint Uid ".concat(S," => ").concat(ee.uid),ee),Nt.reqUserAccount(j.sid,{lts:G,success:!1,serverAddr:B,stringUid:j.string_uid,uid:ee.uid,errorCode:te.INVALID_UINT_UID_FROM_STRING_UID,extend:j}),new Ae(te.INVALID_UINT_UID_FROM_STRING_UID);return Nt.reqUserAccount(j.sid,{lts:G,success:!0,serverAddr:B,stringUid:j.string_uid,uid:ee.uid,errorCode:null,extend:j}),!1}const ye=sS(ee.code);return ye.retry&&(B=E[(fe+1)%E.length]),Nt.reqUserAccount(j.sid,{lts:G,success:!1,serverAddr:B,stringUid:j.string_uid,uid:ee.uid,errorCode:ye.desc,extend:j}),ye.retry},(ee,fe)=>ee.code!==te.OPERATION_ABORTED&&(Nt.reqUserAccount(j.sid,{lts:G,success:!1,serverAddr:B,stringUid:j.string_uid,uid:null,errorCode:ee.code,extend:j}),B=E[(fe+1)%E.length],!0),D);if(Y.code!==0){const ee=sS(Y.code);throw new Ae(te.UNEXPECTED_RESPONSE,ee.desc)}return Y}(h,e,r,s,o);return c==null||c.recordJoinChannelService({status:"success",endTs:Date.now()},m),y.uid}catch(y){throw c==null||c.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[y]},m),y}}async function Jme(e,r,s){const o=oe("ACCOUNT_REGISTER");let c=[];c=r.proxyServer?o.map(u=>"https://".concat(r.proxyServer,"/ap/?url=").concat(u+"/api/v1")):o.map(u=>"https://".concat(u,"/api/v1"));try{return await D9({referenceList:c,asyncMapHandler:h=>async function(m,y,E,S){const R=Date.now(),P={sid:E.sid,opid:10,appid:E.appId,string_uid:y};try{const D=await kd(m+"".concat(m.indexOf("?")===-1?"?":"&","action=stringuid"),{data:P,cancelToken:S,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(D.code!==0){const G=sS(D.code);throw new Ae(te.UNEXPECTED_RESPONSE,"preload sua error:".concat(G.desc),G)}if(D.uid<=0||D.uid>=Math.pow(2,32))throw new Ae(te.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:R,url:m,req:P,uid:D.uid,elapse:Date.now()-R}}catch(D){throw D}}(h,e,r,s),closeFn:h=>h.code===te.OPERATION_ABORTED||h.code===te.UNEXPECTED_RESPONSE&&!h.data.retry})}catch(u){throw u}}async function Qme(e,r,s){const o=oe("CDS_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(y=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(y+"/api/v1"):"https://".concat(y,"/api/v1?action=config")),c=o.map(y=>function(E,S,R,P){const D=xn(),G={flag:64,cipher_method:0,features:Nh(Nh(Nh(Nh(Nh({install_id:iL(),device:D.name,system:D.os,system_general:navigator.userAgent,vendor:S.appId,version:Dl,cname:S.cname,session_id:S.sid,proxyServer:S.proxyServer,sdk_type:Wme.WEB_RTC,browser_name:D.name,browser_version:D.version,user_agent:navigator.userAgent,channel_name:S.cname},S.stringUid&&{string_uid:S.stringUid}),S.uid&&{uid:S.uid+""}),D.os&&{os_name:D.os}),D.osVersion&&{os_version:D.osVersion}),{},{detail:""})};return Rd(()=>kd(E,{data:G,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,j=>j.code!==te.OPERATION_ABORTED,P)}(y,e,r,s));let u=null,h=null,m={};try{u=await uS(c)}catch(y){if(y.code===te.OPERATION_ABORTED)throw y;h=y}if(c.forEach(y=>y.cancel()),Nt.reportApiInvoke(e.sid,{name:Ai.REQUEST_CONFIG_DISTRIBUTE,options:{error:h,res:u}}).onSuccess(),u&&u.test_tags)try{m=function(y){if(!y.test_tags)return{};const E=y.test_tags,S=Object.keys(E),R={};return S.forEach(P=>{var D;const G=wo(D=P.slice(4)).call(D),j=JSON.parse(E[P]),B=j[1];R[G]={tag:j[0]||"",value:B}}),R}(u)}catch{}return m}async function M9(e,r){const s=oe("WEBCS_DOMAIN").concat(oe("WEBCS_DOMAIN_BACKUP_LIST")).map(o=>({url:"https://".concat(o,"/api/v2/transpond/webrtc?v=2"),areaCode:VT(),serviceIds:[Ei.CHOOSE_SERVER,Ei.CLOUD_PROXY_FALLBACK]}));try{return await D9({referenceList:s,asyncMapHandler:c=>async function(u,h,m){let y,{url:E,areaCode:S,serviceIds:R}=u;const P=Date.now(),[D,G]=ZL(h,S,R);let j=yi.networkState;try{j&&yi.networkState===Tc.OFFLINE&&yi.onlineWaiter&&await ht.race([yi.onlineWaiter,ps(Pi.maxRetryTimeout)]),j=yi.networkState;const{data:B,headers:Y}=await kd(E,{data:D,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);y=Y.http3==="1"?1:-1,(Ee=>{const _e=[];if(Ee.response_body.forEach(Ne=>{const Ze=Ne.buffer.code;if(Ne.uri===23&&Ze===0&&!Ne.buffer.edges_services)if(Ne.buffer.flag===4194310)Ne.buffer.edges_services=[];else{const pt={error:new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:Ee.detail[502]}),flag:Ne.buffer.flag};_e.push(pt)}if(Ze!==0){const pt=sS(Ze),yt={error:new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,pt.desc,{desc:pt.desc,retry:pt.retry,csIp:Ee.detail[502]}),flag:Ne.buffer.flag};Ne.buffer.flag===4194310?x.warning(yt.error.toString()):_e.push(yt)}}),_e.length)throw new Ae(te.CAN_NOT_GET_GATEWAY_SERVER,_e.map(Ne=>"flag: ".concat(Ne.flag,", message: ").concat(Ne.error.message)).join(" | "),{retry:!!_e.find(Ne=>Ne.error.data.retry),csIp:Ee.detail[502],desc:[...new Set(_e.map(Ne=>{var Ze;return Ne==null||(Ze=Ne.error)===null||Ze===void 0||(Ze=Ze.data)===null||Ze===void 0?void 0:Ze.desc}).filter(Ne=>!!Ne))]})})(B);const fe=xT(B,Ei.CHOOSE_SERVER),ye=xT(B,Ei.CLOUD_PROXY_FALLBACK);return QL(fe),{gatewayInfo:BL(fe,E),proxyInfo:ye,opid:G,requestTime:P,url:E,isHttp3:y,elapse:Date.now()-P}}catch(B){throw B}}(c,e,r),closeFn:c=>c.code===te.OPERATION_ABORTED||c.code===te.CAN_NOT_GET_GATEWAY_SERVER&&!c.data.retry})}catch(o){throw o}}async function U9(e,r,s,o){const c=oe("PROXY_SERVER_TYPE3"),u=(D,G,j)=>{let B=j||c;return Array.isArray(B)&&(B=G%2==0?c[1]:c[0]),"https://".concat(B,"/ap/?url=").concat(D)};let h=null;const m=[],y=async()=>{const D=oe("WEBCS_DOMAIN").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map((B,Y)=>{let ee;return ee=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(B,"/api/v2/transpond/webrtc?v=2"),Y,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(B,"/api/v2/transpond/webrtc?v=2"):u("".concat(B,"/api/v2/transpond/webrtc?v=2"),Y),{url:ee,areaCode:VT(),serviceIds:[Ei.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Ei.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Ei.CLOUD_PROXY:Ei.CLOUD_PROXY_FALLBACK]}}),G=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(B=>B.url)}),j=await jT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:B=>(x.debug("[".concat(e.clientId,"] Connect to choose_server:"),B.url),k9(B,e,r,s)),allFailedhandler:B=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},G),B[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j},E=async()=>{if(await ps(1e3),h!==null)return h;const D=oe("WEBCS_DOMAIN_BACKUP_LIST").map((B,Y)=>{let ee;return ee=e.cloudProxyServer==="disabled"&&e.proxyServer?u("".concat(B,"/api/v2/transpond/webrtc?v=2"),Y,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(B,"/api/v2/transpond/webrtc?v=2"):u("".concat(B,"/api/v2/transpond/webrtc?v=2"),Y),{url:ee,areaCode:VT(),serviceIds:[Ei.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Ei.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Ei.CLOUD_PROXY:Ei.CLOUD_PROXY_FALLBACK]}}),G=o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(B=>B.url)}),j=await jT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:B=>(x.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),B.url),k9(B,e,r,s)),allFailedhandler:B=>{throw o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:B},G),B[0]},promisesCollector:m});return o.recordJoinChannelService({endTs:Date.now(),status:"success"},G),j};let S,R,P;try{({gatewayInfo:S,proxyInfo:R,url:P}=await uS([y(),E()]))}catch(D){throw D[0]}if(m.length&&m.forEach(D=>D.cancel&&typeof D.cancel=="function"&&D.cancel()),!S||!R)throw new Ae(te.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=P,e.cloudProxyServer!=="disabled"&&Array.isArray(c)&&P){const D=/^https?:\/\/(.+?)(\/.*)?$/.exec(P)[1];ct(c).call(c,D)&&(e.proxyServer=D,x.setProxyServer(D),Nt.setProxyServer(D))}return h={gatewayInfo:S,proxyInfo:await a9(R,S.uid)},h}async function Zme(e,r,s){const o=oe("UAP_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1?action=uap"):"https://".concat(u,"/api/v1?action=uap")),c=o.map(u=>function(h,m,y,E){const S={command:"convergeAllocateEdge",sid:m.sid,appId:m.appId,token:m.token,ts:Date.now(),version:Dl,cname:m.cname,uid:m.uid.toString(),requestId:JL,seq:JL};JL+=1;const R={service_name:"tele_channel",json_body:JSON.stringify(S)};return Rd(async()=>{const P=await kd(h,{data:R,cancelToken:y,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(P.code!==0){const G=new Ae(te.UNEXPECTED_RESPONSE,"cross channel ap error, code"+P.code,{retry:!0});throw x.error(G.toString()),G}const D=JSON.parse(P.json_body);if(D.code!==200){const G=new Ae(te.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(D.code,", reason: ").concat(D.reason));throw x.error(G.toString()),G}if(!D.servers||D.servers.length===0){const G=new Ae(te.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw x.error(G.toString()),G}return{vid:D.vid,workerToken:D.workerToken,addressList:(oe("CHANNEL_MEDIA_RELAY_SERVERS")||D.servers).map(G=>"wss://".concat(G.address.replace(/\./g,"-"),".").concat(oe("WORKER_DOMAIN"),":").concat(G.wss))}},void 0,P=>!!(P.code!==te.OPERATION_ABORTED&&P.code!==te.UNEXPECTED_RESPONSE||P.data&&P.data.retry),E)}(u,e,r,s));try{const u=await uS(c);return c.forEach(h=>h.cancel()),u}catch(u){throw u[0]}}async function ege(e,r,s){let o=null;const c=[],u=async h=>{const m=oe(h?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(y=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(y+"/api/v2/transpond/webrtc?v=2"):"https://".concat(y,"/api/v2/transpond/webrtc?v=2"));return h&&(await ps(1e3),o!==null)?o:await jT({fragementLength:oe("FRAGEMENT_LENGTH"),referenceList:m,asyncMapHandler:y=>(x.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(h?"backup":""," choose_server:"),y),function(E,S,R,P){const[D]=Xme(S,[Ei.CHOOSE_SERVER]);let G=yi.networkState;return Rd(async()=>{G&&yi.networkState===Tc.OFFLINE&&yi.onlineWaiter&&await ht.race([yi.onlineWaiter,ps(P&&P.maxRetryTimeout||Pi.maxRetryTimeout)]),G=yi.networkState;const j=await kd(E,{data:D,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return Yme(j,E)},()=>!1,j=>j.code!==te.OPERATION_ABORTED&&(j.code===te.UPDATE_TICKET_FAILED?j.data.retry:(x.warning("[".concat(S.clientId,"] update ticket network error, retry"),j),!0)),P)}(y,e,r,s)),allFailedhandler:y=>{throw y[0]},promisesCollector:c})};try{return o=await uS([u(!1),u(!0)]),c.length&&c.forEach(h=>h.cancel&&typeof h.cancel=="function"&&h.cancel()),o}catch(h){throw h[0]}}function V9(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function t2(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?V9(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):V9(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}class tge extends jr{get isSuccess(){return!!this.configs}constructor(r,s){super(),q(this,"configs",void 0),q(this,"store",void 0),q(this,"joinInfo",void 0),q(this,"cancelToken",void 0),q(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),q(this,"interval",void 0),q(this,"mutex",void 0),q(this,"mutableParamsRead",!1),q(this,"configCache",{}),q(this,"limit_bitrate",void 0),this.mutex=new qs("config-distribute",r),this.store=s}startGetConfigDistribute(r,s){this.joinInfo=r,this.cancelToken=s,this.interval&&this.stopGetConfigDistribute(),oe("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},oe("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Nt.reportApiInvoke(null,{options:void 0,name:Ai.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Hr.TRACER}).onSuccess(JSON.stringify(Id))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void x.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const s=await this.mutex.lock();try{r=await Qme(this.joinInfo,this.cancelToken,this.retryConfig),x.debug("[config-distribute] get config distribute",JSON.stringify(r));const o=function(c){var u;const h=oT(u=Object.keys(c).filter(E=>/^webrtc_ng_global_parameter/.test(E))).call(u);for(let E=0;E<h.length;E++)for(let S=h.length-1;S>E;S--){const R=h[S],P=c[R].value;if(typeof P.__priority=="number"){const D=P.__priority,G=h[S-1],j=c[G].value;if(typeof j.__priority=="number"){if(!(D>j.__priority))continue;{const B=R;h[S]=h[S-1],h[S-1]=B}}else{const B=R;h[S]=h[S-1],h[S-1]=B}}}const m=Date.now();let y={};return h.forEach(E=>{const S=c[E].value.__expires;S&&S<=m||(y[E]=c[E])}),y}(r);this.cacheGlobalParameterConfig(o),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=o}catch(o){const c=new Ae(te.NETWORK_RESPONSE_ERROR,o);x.warning("[config-distribute] ".concat(c.toString()))}finally{s()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){YG(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(kT.UPDATE_BITRATE_LIMIT,r):this.emit(kT.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&t2({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const s={},o=Object.keys(r),c=[];o.forEach(u=>{const h=r[u].value;s[u]=h;const m=h.__id;if(m&&this.configCache[u]&&this.configCache[u].__id===m)return;const y=h.__type,E=r[u].value,S=r[u].tag;let R=0;y?y===wW.REALTIME&&(R=1):Object.keys(E).some(P=>Object.prototype.hasOwnProperty.call(cL,P)||!kL()&&Object.prototype.hasOwnProperty.call(HA,P)?(R=1,!0):void 0),c.push({tag:S,isApplied:R,feature:u,params:JSON.stringify(h)})}),c.forEach(u=>{let{tag:h,feature:m,params:y,isApplied:E}=u;this.store.sessionId&&Nt.abTest(this.store.sessionId,{intSucc:1,isApplied:E,tag:h,feature:m,params:y,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=s}catch(s){x.debug("handleABTestConfigDistribute error",s)}}cacheGlobalParameterConfig(r){const s=function(c){const u={};return Object.keys(c).forEach(h=>{const m=c[h].value,y=m.__expires,E=m.__type;Object.keys(m).forEach(S=>{S==="__id"||S==="__type"||S==="__priority"||S==="__expires"||Object.prototype.hasOwnProperty.call(u,S)||(u[S]=t2(t2({value:m[S]},y&&{expires:y}),E&&{type:E}))})}),u}(r);try{var o;const c=(o=s.LIMIT_BITRATE)===null||o===void 0?void 0:o.value;delete s.LIMIT_BITRATE,c&&YG(c)&&this.handleBitrateLimit(c),this.limit_bitrate=c,this.handleGlobalParameterConfig(s),this.handleABTestConfigDistribute(r),function(m){try{const y=Date.now();Object.keys(m).forEach(E=>{const{value:S,type:R,expires:P}=m[E];P&&P<=y||((R===wW.REALTIME||Object.prototype.hasOwnProperty.call(cL,E))&&(Id[E]=S,wr[E]=S,x.debug("Update realtime parameters from config distribute",E,S)),R||kL()||!Object.prototype.hasOwnProperty.call(HA,E)||(Id[E]=S,wr[E]=S,x.debug("Update gateway parameters from config distribute",E,S)))})}catch(y){x.error("Error update config immediately: ".concat(m),y.message)}}(s);const u=JSON.stringify(s),h=window.btoa(u);window.localStorage.setItem("websdk_ng_global_parameter",h),x.debug("Caching global parameters ".concat(u))}catch(c){x.error("Error caching global parameters:",c.message)}}handleGlobalParameterConfig(r){try{const s=Date.now();Object.keys(r).forEach(o=>{if(o==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(wr,o)){const{value:c,expires:u}=r[o];if(u&&u<=s)return;(function(h,m){try{return typeof h=="object"&&typeof m=="object"&&JSON.stringify(h)===JSON.stringify(m)}catch{return!1}})(wr[o],c)||(Id[o]=c,wr[o]=c,this.emit(kT.UPDATE_CLIENT_ROLE_OPTIONS,c),x.debug("Updating client role options: ".concat(JSON.stringify(c))))}})}catch(s){x.error("Error handling global parameter config:",s.message)}}}class nge extends jr{constructor(){super(...arguments),q(this,"resultStorage",new Map)}setLocalAudioStats(r,s,o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(o,s)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(o,s))}setLocalVideoStats(r,s,o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(o,s)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(o,s)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(o))}setRemoteAudioStats(r,s){const o=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",o,this.checkAudioOutputLevel(s))}setRemoteVideoStats(r,s){const o=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",o,this.checkVideoDecode(s))}record(r,s,o){if(oe("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const c=this.resultStorage.get(r);if(c&&(c.result.push(o),c.result.length>=5)){var u;const h=ct(u=c.result).call(u,!0);c.isPrevNormal&&!h&&this.emit("exception",j9[r],r,s),!c.isPrevNormal&&h&&this.emit("exception",j9[r]+2e3,r+"_RECOVER",s),c.isPrevNormal=h,c.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,s){return s instanceof Mi&&!s.isActive||!!s.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,s){let o=null;s._encoderConfig&&s._encoderConfig.frameRate&&(o=wc(s._encoderConfig.frameRate));const c=r.captureFrameRate;return!o||!c||!(o>10&&c<5||o<10&&o>=5&&c<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checkSendVideoBitrate(r,s){return!!s.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,s){return s instanceof Mi&&!s.isActive||!!s.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const j9={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},Js=new class{markSubscribeStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(r))}markPublishStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(r))}measureFromSubscribeStart(e,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(r));if(s.length>0){const o=s[s.length-1];return Math.round(performance.now()-o.startTime)}return 0}measureFromPublishStart(e,r){const s=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(r));if(s.length>0){const o=s[s.length-1];return Math.round(performance.now()-o.startTime)}return 0}};function F9(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function Q_(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?F9(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):F9(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}class FT{constructor(r){q(this,"store",void 0),q(this,"onStatsException",void 0),q(this,"onUploadPublishDuration",void 0),q(this,"onStatsChanged",void 0),q(this,"localStats",new Map),q(this,"remoteStats",new Map),q(this,"updateStatsInterval",void 0),q(this,"trafficStats",void 0),q(this,"trafficStatsPeerList",[]),q(this,"uplinkStats",void 0),q(this,"exceptionMonitor",void 0),q(this,"p2pChannel",void 0),q(this,"scalabilityMode",GA.L1T1),q(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new nge,this.exceptionMonitor.on("exception",(s,o,c)=>{this.onStatsException&&this.onStatsException(s,o,c)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Xe.LocalAudioTrack)||Q_({},pL)}getLocalVideoTrackStats(){return this.localStats.get(Xe.LocalVideoTrack)||Q_({},fL)}getRemoteAudioTrackStats(r){const s=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(y=>y.peer_uid===u);return m&&(h.publishDuration=m.B_ppad+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.audioStats;u&&(o[r]=s(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{audioStats:m}]=u;m&&(o[h]=s(h,m))});return o}getRemoteNetworkQualityStats(r){const s={};if(r){var o;const c=(o=this.remoteStats.get(r))===null||o===void 0?void 0:o.networkStats;c&&(s[r]=c)}else Array.from(this.remoteStats.entries()).forEach(c=>{let[u,{networkStats:h}]=c;h&&(s[u]=h)});return s}getRemoteVideoTrackStats(r){const s=(u,h)=>{if(!this.trafficStats)return h;const m=this.trafficStats.peer_delay.find(y=>y.peer_uid===u);return m&&(h.publishDuration=m.B_ppvd+(Date.now()-this.trafficStats.timestamp)),h},o={};if(r){var c;const u=(c=this.remoteStats.get(r))===null||c===void 0?void 0:c.videoStats;u&&(o[r]=s(r,u))}else Array.from(this.remoteStats.entries()).forEach(u=>{let[h,{videoStats:m}]=u;m&&(o[h]=s(h,m))});return o}getRTCStats(){let r=0,s=0,o=0,c=0;const u=this.localStats.get(Xe.LocalAudioTrack);u&&(r+=u.sendBytes,s+=u.sendBitrate);const h=this.localStats.get(Xe.LocalVideoTrack);h&&(r+=h.sendBytes,s+=h.sendBitrate);const m=this.localStats.get(Xe.LocalVideoLowTrack);m&&(r+=m.sendBytes,s+=m.sendBitrate),this.remoteStats.forEach(E=>{let{audioStats:S,videoStats:R}=E;S&&(o+=S.receiveBytes,c+=S.receiveBitrate),R&&(o+=R.receiveBytes,c+=R.receiveBitrate)});let y=1;return this.trafficStats&&(y+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:y,SendBitrate:s,SendBytes:r,RecvBytes:o,RecvBitrate:c,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(s=>s.B_ppad!==void 0||s.B_ppvd!==void 0),r.peer_delay.filter(s=>this.trafficStatsPeerList.indexOf(s.peer_uid)===-1).forEach(s=>{var o;const c=(o=this.p2pChannel)===null||o===void 0?void 0:o.getRemoteMedia(s.peer_uid),u=c!=null&&c.videoSSRC?Js.measureFromSubscribeStart(this.store.clientId,c.videoSSRC):0,h=c!=null&&c.audioSSRC?Js.measureFromSubscribeStart(this.store.clientId,c.audioSSRC):0;s.B_ppad!==void 0&&s.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(s.peer_uid,s.B_ppad,s.B_ppvd,u>h?u:h),this.trafficStatsPeerList.push(s.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&x.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,s,o){if(!r)return!1;const c=!!o&&s.framesDecodeFreezeTime>o.framesDecodeFreezeTime,u=!o||s.framesDecodeCount>o.framesDecodeCount;return c||!u}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(s=>{let[o,c]=s;switch(o){case Xe.LocalVideoTrack:case Xe.LocalVideoLowTrack:{const h=c,m=Q_({},fL),y=r.getStats(),E=r.getLocalMedia(o);if(y){const S=y.videoSend.find(R=>R.ssrc===(E==null?void 0:E.ssrcs[0].ssrcId));if(S){const R=r.getLocalVideoSize(),P=r.getEncoderConfig(Xe.LocalVideoTrack);S.codec!=="H264"&&S.codec!=="H265"&&S.codec!=="VP8"&&S.codec!=="VP9"&&S.codec!=="AV1X"&&S.codec!=="AV1"||(m.codecType=S.codec),m.sendBytes=S.bytes,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0,S.inputFrame?(m.captureFrameRate=S.inputFrame.frameRate,m.captureResolutionHeight=S.inputFrame.height,m.captureResolutionWidth=S.inputFrame.width):R&&(m.captureResolutionWidth=R.width,m.captureResolutionHeight=R.height),S.sentFrame?(m.sendFrameRate=S.sentFrame.frameRate,m.sendResolutionHeight=S.sentFrame.height,m.sendResolutionWidth=S.sentFrame.width):R&&(m.sendResolutionWidth=R.width,m.sendResolutionHeight=R.height),S.avgEncodeMs&&(m.encodeDelay=S.avgEncodeMs),P&&P.bitrateMax&&(m.targetSendBitrate=1e3*P.bitrateMax),m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.totalDuration=h?h.totalDuration+1:1,m.totalFreezeTime=h?h.totalFreezeTime:0,this.isLocalVideoFreeze(S)&&(m.totalFreezeTime+=1),S.scalabilityMode&&this.scalabilityMode!==S.scalabilityMode&&(x.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(S.scalabilityMode)),this.scalabilityMode=S.scalabilityMode)}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var u;this.localStats.set(o,m),((h==null?void 0:h.sendResolutionWidth)!==m.sendResolutionWidth||(h==null?void 0:h.sendResolutionHeight)!==m.sendResolutionHeight)&&((u=this.onStatsChanged)===null||u===void 0||u.call(this,"resolution",{width:m.sendResolutionWidth,height:m.sendResolutionHeight})),m&&E&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,E.track,m);break}case Xe.LocalAudioTrack:{const h=c,m=Q_({},pL),y=r.getStats(),E=r.getLocalMedia(o);if(y){const S=y.audioSend.find(R=>R.ssrc===(E==null?void 0:E.ssrcs[0].ssrcId));if(S){if(S.codec!=="opus"&&S.codec!=="aac"&&S.codec!=="PCMU"&&S.codec!=="PCMA"&&S.codec!=="G722"||(m.codecType=S.codec),S.inputLevel)m.sendVolumeLevel=Math.round(32767*S.inputLevel);else{const R=r.getLocalAudioVolume();R&&(m.sendVolumeLevel=Math.round(32767*R))}m.sendBytes=S.bytes,m.sendPackets=S.packets,m.sendPacketsLost=S.packetsLost,m.sendJitterMs=S.jitterMs,m.sendRttMs=S.rttMs,m.sendBitrate=h?8*Math.max(0,m.sendBytes-h.sendBytes):0}}this.trafficStats&&(m.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Xe.LocalAudioTrack,m),m&&E&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,E.track,m);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(s=>{var o,c;let[u,{videoStats:h,audioStats:m,videoPcStats:y}]=s;const E=m,S=h,R=y,P=Q_({},LW),D=Q_({},MW),G=Q_({},Ffe),{audioTrack:j,videoTrack:B,audioSSRC:Y,videoSSRC:ee}=r.getRemoteMedia(u);let fe;fe=this.store.useP2P?r.getStats(!0):r.getStats();const ye=(o=fe)===null||o===void 0?void 0:o.audioRecv.find(Ze=>Ze.ssrc===Y),Ee=(c=fe)===null||c===void 0?void 0:c.videoRecv.find(Ze=>Ze.ssrc===ee),_e=this.trafficStats&&this.trafficStats.peer_delay.find(Ze=>Ze.peer_uid===u);if(ye&&(ye.codec!=="opus"&&ye.codec!=="aac"&&ye.codec!=="PCMU"&&ye.codec!=="PCMA"&&ye.codec!=="G722"||(P.codecType=ye.codec),ye.outputLevel?P.receiveLevel=Math.round(32767*ye.outputLevel):j&&(P.receiveLevel=Math.round(32767*j.getVolumeLevel())),P.receiveBytes=ye.bytes,P.receivePackets=ye.packets,P.receivePacketsLost=ye.packetsLost,P.receivePacketsDiscarded=ye.packetsDiscarded,P.packetLossRate=P.receivePacketsLost/(P.receivePackets+P.receivePacketsLost),P.receiveBitrate=E?8*Math.max(0,P.receiveBytes-E.receiveBytes):0,P.totalDuration=E?E.totalDuration+1:1,P.totalFreezeTime=E?E.totalFreezeTime:0,P.freezeRate=P.totalFreezeTime/P.totalDuration,P.receiveDelay=ye.jitterBufferMs,P.totalDuration>10&&FT.isRemoteAudioFreeze(j)&&(P.totalFreezeTime+=1)),Ee){var Ne;Ee.codec!=="H264"&&Ee.codec!=="H265"&&Ee.codec!=="VP8"&&Ee.codec!=="VP9"&&Ee.codec!=="AV1X"&&Ee.codec!=="AV1"||(D.codecType=Ee.codec),D.receiveBytes=Ee.bytes,D.receiveBitrate=S?8*Math.max(0,D.receiveBytes-S.receiveBytes):0,D.decodeFrameRate=Ee.decodeFrameRate<0?0:Ee.decodeFrameRate,D.renderFrameRate=Ee.decodeFrameRate<0?0:Ee.decodeFrameRate,Ee.outputFrame&&(D.renderFrameRate=Ee.outputFrame.frameRate),Ee.receivedFrame?(D.receiveFrameRate=Ee.receivedFrame.frameRate,D.receiveResolutionHeight=Ee.receivedFrame.height,D.receiveResolutionWidth=Ee.receivedFrame.width):B&&(D.receiveResolutionHeight=B._videoHeight||0,D.receiveResolutionWidth=B._videoWidth||0),Ee.framesRateFirefox!==void 0&&(D.receiveFrameRate=Math.round(Ee.framesRateFirefox)),D.receivePackets=Ee.packets,D.receivePacketsLost=Ee.packetsLost,D.packetLossRate=D.receivePacketsLost/(D.receivePackets+D.receivePacketsLost);const Ze=S?S.totalFreezeTime:0,pt=S?S.totalDuration:0;D.totalDuration=S?S.totalDuration+1:1,D.totalFreezeTime=(Ne=Ee.totalFreezesDuration)!==null&&Ne!==void 0?Ne:Ze||0,D.receiveDelay=Ee.jitterBufferMs||0;const yt=!!ee&&r.getRemoteVideoIsReady(ee);Ee.totalFreezesDuration===void 0&&B&&yt&&FT.isRemoteVideoFreeze(B,Ee,R)&&(D.totalFreezeTime+=1),D.freezeRate=Math.max(0,Math.min((D.totalFreezeTime-Ze)/(D.totalDuration-pt),1))}_e&&(P.end2EndDelay=_e.B_ad,D.end2EndDelay=_e.B_vd,P.transportDelay=_e.B_ed,D.transportDelay=_e.B_ed,P.currentPacketLossRate=_e.B_ealr4/100,D.currentPacketLossRate=_e.B_evlr4/100,G.uplinkNetworkQuality=_e.B_punq?_e.B_punq:0,G.downlinkNetworkQuality=_e.B_pdnq?_e.B_pdnq:0),this.remoteStats.set(u,{audioStats:P,videoStats:D,videoPcStats:Ee,networkStats:G}),j&&this.exceptionMonitor.setRemoteAudioStats(j,P),B&&this.exceptionMonitor.setRemoteVideoStats(B,D)})}}class B9{constructor(){q(this,"destChannelMediaInfos",new Map),q(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){KG(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){KG(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){uP(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function z9(e){if(!(e instanceof B9))return new Ae(te.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=e.getSrcChannelMediaInfo(),s=e.getDestChannelMediaInfo();if(!r)return new Ae(te.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(s.size===0)return new Ae(te.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Jm{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,s){q(this,"uid",void 0),q(this,"_uintid",void 0),q(this,"_trust_in_room_",!0),q(this,"_trust_audio_enabled_state_",!0),q(this,"_trust_video_enabled_state_",!0),q(this,"_trust_audio_mute_state_",!0),q(this,"_trust_video_mute_state_",!0),q(this,"_audio_muted_",!1),q(this,"_video_muted_",!1),q(this,"_audio_enabled_",!0),q(this,"_video_enabled_",!0),q(this,"_audio_added_",!1),q(this,"_video_added_",!1),q(this,"_is_pre_created",!1),q(this,"_video_pre_subscribed",!1),q(this,"_audio_pre_subscribed",!1),q(this,"_trust_video_stream_added_state_",!0),q(this,"_trust_audio_stream_added_state_",!0),q(this,"_audioTrack",void 0),q(this,"_videoTrack",void 0),q(this,"_dataChannels",[]),q(this,"_audioSSRC",void 0),q(this,"_videoSSRC",void 0),q(this,"_audioOrtc",void 0),q(this,"_videoOrtc",void 0),q(this,"_cname",void 0),q(this,"_rtxSsrcId",void 0),q(this,"_videoMid",void 0),q(this,"_audioMid",void 0),this.uid=r,this._uintid=s}}function W9(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function G9(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?W9(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):W9(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}const BT="9",H9=4e4;function $9(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function _f(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?$9(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):$9(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}var dS=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(dS||{});const wP=new Map;function K9(e,r,s,o){let{scale:c}=e;if(c===0&&o===dS.UP||c>=r.length-1&&o===dS.DOWN)return e;let u=_f(_f({},e),{},{scale:o===dS.DOWN?++c:--c});switch(s){case"maintain-framerate":u=_f(_f({},u),r[c].motion);break;case"maintain-resolution":u=_f(_f({},u),r[c].detail);break;case"balanced":u=_f(_f({},u),r[c].balanced)}return u}function q9(e,r){if(r){const s={overUse:0,underUse:0,adaptationList:Y9(r)};wP.set(e,s)}else wP.delete(e)}function Y9(e){const r=_f({},e),{bitrateMax:s,frameRate:o,scaleResolutionDownBy:c,bitrateMin:u}=r,{MIN_FRAME_RATE:h,MAX_THRESHOLD_FRAMERATE:m,MAX_SCALE:y,BITRATE_MIN_THRESHOLD:E,BITRATE_MAX_THRESHOLD:S,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:P,PERF_SCALE_DOWN_THRESHOLD:D,PERF_SCALE_UP_THRESHOLD:G,BALANCE_BITRATE_FACTOR:j,BALANCE_FRAMERATE_FACTOR:B,BALANCE_RESOLUTION_FACTOR:Y,MOTION_RESOLUTION_FACTOR:ee,MOTION_BITRATE_FACTOR:fe,DETAIL_FRAMERATE_FACTOR:ye,DETAIL_BITRATE_FACTOR:Ee}=oL,_e=Math.min(r.frameRate,m),Ne=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(P,1)*s),bwe_up:s,fps_down:Math.round(Math.pow(D,1)*_e),fps_up:o},balanced:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:u},motion:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:u},detail:{scaleResolutionDownBy:1,frameRate:o,bitrateMax:s,bitrateMin:u}}];for(let Ze=1;Ze<=y;Ze++){const pt={bwe_up:Math.round(Math.pow(R,Ze)*s),bwe_down:Math.round(Math.pow(P,Ze+1)*s),fps_up:Math.round(Math.pow(G,Ze)*_e),fps_down:Math.round(Math.pow(D,Ze+1)*_e)},yt={scaleResolutionDownBy:c/Math.pow(Y,Ze),frameRate:Math.max(Math.round(Math.pow(B,Ze)*o),h),bitrateMax:Math.max(Math.round(Math.pow(j,Ze)*s),S),bitrateMin:Math.max(Math.round(Math.pow(j,Ze)*u),E)},In={scaleResolutionDownBy:c/Math.pow(ee,Ze),frameRate:o,bitrateMax:Math.max(Math.round(Math.pow(fe,Ze)*s),S),bitrateMin:Math.max(Math.round(Math.pow(fe,Ze)*u),E)},An={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(ye,Ze)*o),h),bitrateMax:Math.max(Math.round(Math.pow(Ee,Ze)*s),S),bitrateMin:Math.max(Math.round(Math.pow(Ee,Ze)*u),E)};Ne.push({scale:Ze,threshold:pt,balanced:yt,motion:In,detail:An})}return Ne}function rge(e,r,s,o,c,u){const h=wP.get(e)||{overUse:0,underUse:0,adaptationList:Y9(c)},{adaptationList:m}=h;wP.set(e,h);const{OVERUSE_TIMES_THRESHOLD:y,UNDERUSE_TIMES_THRESHOLD:E}=oL,{scale:S}=o;let R,P;return typeof r=="number"&&r>0&&function(D,G,j,B){if(G>=j.length)return!1;let{threshold:{fps_down:Y}}=j[G];return oe("FORCE_AG_HIGH_FRAMERATE")&&B==="maintain-framerate"&&(Y=j[0].threshold.fps_down),D<Y}(r,S,m,u)&&(h.overUse++,P=CT.CPU,h.overUse>y)||typeof s=="number"&&s>0&&function(D,G,j){if(G>=j.length)return!1;const{threshold:{bwe_down:B}}=j[G];return D<B}(s,S,m)&&(h.overUse++,P=CT.BANDWIDTH,h.overUse>y)?(h.overUse=0,h.underUse=0,R=K9(o,m,u,dS.DOWN),[R,P]):(typeof r=="number"&&r>0&&typeof s=="number"&&s>0&&function(D,G,j,B){if(G===0)return;let{threshold:{fps_up:Y}}=j[G];return oe("FORCE_AG_HIGH_FRAMERATE")&&B==="maintain-framerate"&&(Y=j[1].threshold.fps_up),D>Y}(r,S,m,u)&&function(D,G,j){if(G===0)return;const{threshold:{bwe_up:B}}=j[G];return D>B}(s,S,m)&&(h.underUse++,h.underUse>E&&(h.overUse=0,h.underUse=0,R=K9(o,m,u,dS.UP),R.scale===0&&(P=CT.NONE))),[R,P])}function X9(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function n2(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?X9(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):X9(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}function ige(e){var r;return!!oe("ENABLE_AG_ADAPTATION")&&!!(e instanceof TL||ct(r=e._hints).call(r,fr.CUSTOM_TRACK))&&(!!oe("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(s){const o=xn();if(o.os!==Yi.IOS||!o.osVersion)return!1;const c=o.osVersion.split(".");return Number(c[0])>=s}(14)&&$z(17,4)||Hz(14)&&Kz(17,4,!0)))}const CP=new Map;function RP(e,r){const s=CP.get(e);if(s){const{timer:o}=s;window.clearTimeout(o),CP.delete(e)}r.qualityLimitationReason=CT.NONE,q9(e)}function sge(e,r){var s;let o;switch(r){case Xe.LocalAudioTrack:o=Qn.Audio;break;case Xe.LocalVideoTrack:o=ct(s=e._hints).call(s,fr.SCREEN_TRACK)?Qn.Screen:Qn.High;break;case Xe.LocalVideoLowTrack:o=Qn.Low}return o}function r2(e){const r=Fn();if(e.some(s=>s._bypassWebAudio))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function i2(e,r){r2(e);const s=new Mi;return e.forEach(o=>s.addAudioTrack(o)),s}const oge=!Fn().supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&af();function IP(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var s;return oge?(s={spec:r,store:e},mf("PlanBConnection").create(s)):new Dh(r,e)}function s2(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function J9(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(bT(e.turnServer.servers))return!1;if(oe("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var kn;function Q9(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function Nd(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Q9(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):Q9(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}let Dh=(kn=class Ey extends JG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return ct(s=Object.keys($A)).call(s,r)}))]}constructor(r,s){super(r,s),q(this,"id",pr(5,"connection-")),q(this,"store",void 0),q(this,"peerConnection",void 0),q(this,"forceTurn",!1),q(this,"remoteSDP",void 0),q(this,"initialOffer",void 0),q(this,"transportEventReceiver",void 0),q(this,"statsFilter",void 0),q(this,"extension",{useXR:oe("USE_XR")}),q(this,"localCapabilities",void 0),q(this,"remoteCodecs",void 0),q(this,"localCandidateCount",0),q(this,"allCandidatesReceived",!1),q(this,"isPreallocation",!1),q(this,"preSSRCMap",new Map),q(this,"dataStreamChannelMap",new Map),q(this,"establishPromise",void 0),q(this,"recoveredDataChannelIds",[]),q(this,"currentDataChannelId",1),q(this,"supportAV1RtpSpec",!1),q(this,"mutex",void 0),q(this,"qualityLimitationReason",CT.NONE),q(this,"isFirstConnected",!1),this.store=s,this.forceTurn=J9(r),this.mutex=new qs("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(Ey.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=rL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,Wr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(r){const s=this.preSSRCMap.get(r);if(s!==void 0){const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);if(o)return{transceiver:o,track:o.receiver.track,id:s}}}async updateRemoteRTPCapabilities(r,s){if(this.remoteCodecs=s,!this.remoteSDP)return void x.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(s));if(this.remoteSDP.updateRemoteCodec(r,s,this.store.codec)){const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}else x.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Ym(o.sdp),u=await _9({filterRTX:!oe("USE_PUB_RTX")&&!oe("USE_SUB_RTX"),filterVideoFec:oe("FILTER_VIDEO_FEC"),filterAudioFec:oe("FILTER_AUDIO_FEC"),filterVideoCodec:oe("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=EP(u),this.initialOffer=o,oe("ENABLE_SVC")&&this.store.codec=="av1"){const m=await async function(){try{const y=new RTCPeerConnection;y.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:GA.L1T3}]});const E=await y.createOffer();if(!E.sdp)return void y.close();const S=qa(E.sdp).mediaDescriptions[0];if(!S)return;const R=S.attributes.extmaps.find(P=>P.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return y.close(),R}catch{return}}();var r;m&&(this.supportAV1RtpSpec=!0,(r=u.send)===null||r===void 0||r.videoExtensions.push(m))}let h;return o.sdp&&S9(o.sdp)&&(h=$r(u),(s=h).send&&(oS(bt.VIDEO,s.send.videoExtensions),oS(bt.AUDIO,s.send.audioExtensions)),s.recv&&(oS(bt.VIDEO,s.recv.videoExtensions),oS(bt.AUDIO,s.recv.audioExtensions)),s.sendrecv&&(oS(bt.VIDEO,s.sendrecv.videoExtensions),oS(bt.AUDIO,s.sendrecv.audioExtensions))),Nd(Nd({},c),{},{rtpCapabilities:h||u,offerSDP:o.sdp})}catch(o){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}var s}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&S9(this.initialOffer.sdp)&&(s=r.rtpCapabilities,o=this.localCapabilities,s.send&&(gP(bt.VIDEO,s.send.videoExtensions,o.send.videoExtensions),gP(bt.AUDIO,s.send.audioExtensions,o.send.audioExtensions)),s.recv&&(gP(bt.VIDEO,s.recv.videoExtensions,o.recv.videoExtensions),gP(bt.AUDIO,s.recv.audioExtensions,o.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return $r(this._localCapabilities)}get rtpCapabilities(){return $r(this._rtpCapabilities)}get candidates(){return $r(this._candidates)}get iceParameters(){return $r(this._iceParameters)}get dtlsParameters(){return $r(this._dtlsParameters)}constructor(E){let S=arguments.length>1&&arguments[1]!==void 0&&arguments[1];q(this,"sessionDesc",void 0),q(this,"_localCapabilities",void 0),q(this,"_rtpCapabilities",void 0),q(this,"_candidates",void 0),q(this,"_originCandidates",void 0),q(this,"_iceParameters",void 0),q(this,"_isUseExtmapAllowMixed",void 0),q(this,"_dtlsParameters",void 0),q(this,"setup",void 0),q(this,"currentMidIndex",void 0),q(this,"cname",void 0),q(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=S,E=$r(E);const{iceParameters:R,dtlsParameters:P,candidates:D,rtpCapabilities:G,setup:j,localCapabilities:B,cname:Y}=E;this._rtpCapabilities=G,this._candidates=D,this._originCandidates=$r(D),this._iceParameters=R,this._dtlsParameters=P,this._localCapabilities=B,this.setup=j,this.cname=Y,this.sessionDesc=this.updateRemoteRTPCapabilities(G),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(E){const S=this.candidates,R=this.dtlsParameters,P=this.iceParameters,D=this.rtpCapabilities.send;let G=this.sessionDesc.mediaDescriptions.length-1;for(let j=1;j<E;j++){const B=2*j+2e4,Y=2*j+H9,{ssrcs:ee,ssrcGroups:fe}=J_([{ssrcId:B}],this.cname),{ssrcs:ye,ssrcGroups:Ee}=J_([{ssrcId:Y,rtx:oe("USE_SUB_RTX")?Y+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:BT,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.videoCodecs.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:D.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ye,ssrcGroups:Ee,rtcpFeedbackWildcards:[],payloads:D.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:BT,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.audioCodecs.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:P.iceUfrag,icePwd:P.icePwd,unrecognized:[],candidates:S,extmaps:D.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ee,ssrcGroups:fe,rtcpFeedbackWildcards:[],payloads:D.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++G)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return Gm(this.sessionDesc)}send(E,S,R,P){const{ssrcs:D,ssrcGroups:G}=J_(S,this.cname,oe("SYNC_GROUP")?R:void 0),j=this.findPreloadMediaDesc(D);if(j){if(Wr()&&this.firefoxSsrcMidMap.set(D[0].ssrcId,j.attributes.mid),P&&(P.twcc||P.remb)){const B=this.sessionDesc.mediaDescriptions.indexOf(j);return this.sessionDesc.mediaDescriptions[B]=this.mungSendMediaDesc(j,P),{mid:j.attributes.mid,needExchangeSDP:!0}}return{mid:j.attributes.mid,needExchangeSDP:!1}}{const B=this.findAvailableMediaIndex(E,D);let Y;return B===-1||B===1&&(As()||function(){const ee=xn();return!(ee.name!==Hn.CHROME||!ee.osVersion)&&Number(ee.version)<=90}()||oe("ENABLE_ENCODED_TRANSFORM")&&of())||B===0&&oe("USE_SUB_RTX")||qz()?(Y=this.createOrRecycleSendMedia(E,D,G,"sendonly",P),this.updateBundleMids()):(Y=$r(this.sessionDesc.mediaDescriptions[B]),Y.attributes.direction="sendonly",Y.attributes.ssrcs=D,Y.attributes.ssrcGroups=G,this.sessionDesc.mediaDescriptions[B]=this.mungSendMediaDesc(Y,P)),Wr()&&this.firefoxSsrcMidMap.set(D[0].ssrcId,Y.attributes.mid),{mid:Y.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:E,needExchangeSDP:S}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:E.attributes.mid,needExchangeSDP:S}}batchSend(E){const S=E.map(D=>{let{kind:G,ssrcMsg:j,mslabel:B}=D;return this.send(G,j,B)}),R=[];let P=!1;return S.forEach(D=>{let{mid:G,needExchangeSDP:j}=D;j&&(P=!0),R.push(G)}),{mids:R,needExchangeSDP:P}}stopSending(E){const S=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&E.indexOf(R.attributes.mid)!==-1);if(S.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");S.forEach(R=>{R.attributes.mid==="0"||Wr()||qz()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(E){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===E);if(!S)throw new Error("mediaDescription not found with ".concat(E," in remote SDP when calling RemoteSDP.mute."));S.attributes.direction="inactive"}unmute(E){const S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===E);if(!S)throw new Error("mediaDescription not found with ".concat(E," in remote SDP when calling RemoteSDP.unmute."));S.attributes.direction="sendonly"}muteRemote(E){const S=this.sessionDesc.mediaDescriptions.filter(R=>ct(E).call(E,R.attributes.mid||""));if(S.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(E){const S=this.sessionDesc.mediaDescriptions.filter(R=>ct(E).call(E,R.attributes.mid||""));if(S.length!==E.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");S.forEach(R=>{R.attributes.direction="recvonly"})}receive(E,S,R,P){E.forEach((D,G)=>{this.createOrRecycleRecvMedia(D,[],"recvonly",S,R,P[G])}),this.updateBundleMids()}stopReceiving(E){const S=this.sessionDesc.mediaDescriptions.filter(R=>E.indexOf(R.attributes.mid)!==-1);if(S.length!==E.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");S.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(E){const S=this.sessionDesc||qa((R=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(R?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var R;this._rtpCapabilities=E;const P=this.rtpCapabilities.send,D=this.localCapabilities.send;for(const G of S.mediaDescriptions){if(G.attributes.iceUfrag=this._iceParameters.iceUfrag,G.attributes.icePwd=this._iceParameters.icePwd,G.attributes.fingerprints=this._dtlsParameters.fingerprints,G.attributes.candidates=this._candidates,G.attributes.setup=this.setup,G.media.mediaType==="application"&&(G.attributes.sctpPort="5000"),G.media.mediaType==="video"){if(P.videoCodecs.length===0){const j=D.videoCodecs.filter(B=>{var Y,ee;return(Y=B.rtpMap)===null||Y===void 0?void 0:ct(ee=Y.encodingName.toLowerCase()).call(ee,"vp8")})||[D.videoCodecs[0]];G.media.fmts=j.map(B=>B.payloadType.toString(10)),G.attributes.payloads=j,G.attributes.extmaps=[]}else if(G.media.fmts=P.videoCodecs.map(j=>j.payloadType.toString(10)),G.attributes.payloads=P.videoCodecs,G.attributes.extmaps=P.videoExtensions,oe("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:j,ssrcGroups:B}=J_([{ssrcId:H9,rtx:oe("USE_SUB_RTX")?40001:void 0}],this.cname);G.attributes.ssrcs=j,G.attributes.ssrcGroups=B}}if(G.media.mediaType==="audio"){if(P.audioCodecs.length===0){const j=D.audioCodecs.filter(B=>{var Y,ee;return(Y=B.rtpMap)===null||Y===void 0?void 0:ct(ee=Y.encodingName.toLowerCase()).call(ee,"opus")})||[D.audioCodecs[0]];G.media.fmts=j.map(B=>B.payloadType.toString(10)),G.attributes.payloads=j,G.attributes.extmaps=[]}else if(G.media.fmts=P.audioCodecs.map(j=>j.payloadType.toString(10)),G.attributes.payloads=P.audioCodecs,G.attributes.extmaps=P.audioExtensions,cS(G),oe("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:j,ssrcGroups:B}=J_([{ssrcId:2e4}],this.cname);G.attributes.ssrcs=j,G.attributes.ssrcGroups=B}}}return this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(E){const S=this._originCandidates.filter(P=>P.transport==="udp"),R=[];if(S.forEach(P=>{R.push(G9(G9({},P),{},{foundation:"tcpcandidate",priority:Number(P.priority)-1+"",transport:"tcp",port:Number(P.port)+90+""}))}),S.length!==0){switch(E){case Xs.TCP_RELAY:this._candidates=R;break;case Xs.UDP_TCP_RELAY:case Xs.RELAY:this._candidates=[...S,...R];break;default:this._candidates=S}for(const P of this.sessionDesc.mediaDescriptions)P.attributes.candidates=this.candidates}}restartICE(E){E=$r(E),this._iceParameters=E,this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.iceUfrag=E.iceUfrag,S.attributes.icePwd=E.icePwd})}predictReceivingMids(E){const S=[];for(let R=0;R<E;R++)S.push((this.currentMidIndex+R+1).toString(10));return S}findAvailableMediaIndex(E,S){return this.sessionDesc.mediaDescriptions.findIndex(R=>{const P=R.media.mediaType===E&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if(Wr()){if(P){const D=this.firefoxSsrcMidMap.get(S[0].ssrcId);return!(D||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!D||D!==R.attributes.mid)}return!1}return P})}createOrRecycleDataChannel(){for(const R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;const E="".concat(this.currentMidIndex),S={media:{mediaType:"application",port:BT,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(E),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(S),{mediaDesc:S,needExchangeSDP:!0}}createOrRecycleRecvMedia(E,S,R,P,D,G){const j=E._mediaStreamTrack.kind,B=this.rtpCapabilities.recv,Y=MT(j,B,this.localCapabilities.send,j===bt.VIDEO?P:D),ee=j===bt.VIDEO?B.videoExtensions:B.audioExtensions;this.currentMidIndex+=1;const fe="".concat(this.currentMidIndex);let ye={media:{mediaType:j,port:BT,protos:["UDP","TLS","RTP","SAVPF"],fmts:Y.map(_e=>_e.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:ee,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:Y,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(fe)}};ye=this.mungRecvMediaDsec(ye,E,G);const Ee=this.findFirstClosedMedia(j);if(Ee){const _e=this.sessionDesc.mediaDescriptions.indexOf(Ee);this.sessionDesc.mediaDescriptions[_e]=ye}else this.sessionDesc.mediaDescriptions.push(ye);return ye}updateRemoteCodec(E,S,R){const P=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(ye=>ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||"").filter(ye=>{var Ee;return ct(Ee=Object.keys($A)).call(Ee,ye)}))],D=new Set(S);if(P.every(ye=>D.has(ye)))return x.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(S)),!1;const G=this._rtpCapabilities.recv.videoCodecs.filter(ye=>S.some(Ee=>{var _e;return ct(_e=ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||"").call(_e,Ee)}));if(G.length===0)return x.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(P," codecs: ").concat(S)),!1;const j=[...new Set(G.map(ye=>ye.rtpMap&&ye.rtpMap.encodingName.toLowerCase()||""))];let B;if(x.debug("updateRemoteCodec, from ".concat(P," to ").concat(j)),E.length===0)B=this.sessionDesc.mediaDescriptions.filter(ye=>ye.media.mediaType==="video"&&ye.attributes.direction==="recvonly");else if(B=this.sessionDesc.mediaDescriptions.filter(ye=>ye.attributes.mid&&ct(E).call(E,ye.attributes.mid)&&ye.attributes.direction==="recvonly"),B.length!==E.length)return x.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(E,", codecs: ").concat(S)),!1;if(oe("USE_PUB_RTX")||oe("USE_SUB_RTX")){const ye=HL(G,this.rtpCapabilities.recv.videoCodecs);G.push(...ye)}this._rtpCapabilities.recv.videoCodecs=G;const Y=this.localCapabilities.send,ee=this.rtpCapabilities.recv,fe=MT(bt.VIDEO,ee,Y,R);return B.forEach(ye=>{const Ee=fe.map(_e=>_e.payloadType.toString(10));x.debug("updateRemoteCodec mid: ".concat(ye.attributes.mid,", from"),ye.attributes.payloads,"to",fe),ye.attributes.payloads=fe,ye.media.fmts=Ee}),!0}createOrRecycleSendMedia(E,S,R,P,D){const G=this.rtpCapabilities.send,j=E===bt.VIDEO?G.videoCodecs:G.audioCodecs,B=E===bt.VIDEO?G.videoExtensions:G.audioExtensions;this.currentMidIndex+=1;const Y="".concat(this.currentMidIndex);let ee={media:{mediaType:E,port:BT,protos:["UDP","TLS","RTP","SAVPF"],fmts:j.map(ye=>ye.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:B,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:S,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:j,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:P,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Y)}};ee=this.mungSendMediaDesc(ee,D);const fe=this.findFirstClosedMedia(E);if(fe){const ye=this.sessionDesc.mediaDescriptions.indexOf(fe);this.sessionDesc.mediaDescriptions[ye]=ee}else this.sessionDesc.mediaDescriptions.push(ee);return ee}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(E=>E.media.port!=="0").map(E=>E.attributes.mid)}mungRecvMediaDsec(E,S,R){const P=$r(E);return WL(P),aS(P,S),GL(P,S),m9(P),yP(P,R,this.localCapabilities.send),P}mungSendMediaDesc(E,S){const R=$r(E);return yP(R,S,this.localCapabilities.recv),cS(R),R}updateRecvMedia(E,S){const R=this.sessionDesc.mediaDescriptions.findIndex(P=>P.attributes.mid===E);if(R!==-1){const P=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],S);this.sessionDesc.mediaDescriptions[R]=P}}bumpMid(E){this.currentMidIndex+=E}findFirstClosedMedia(E){return this.sessionDesc.mediaDescriptions.find(S=>Wr()?S.media.port==="0"&&S.media.mediaType===E:S.media.port==="0")}findPreloadMediaDesc(E){return this.sessionDesc.mediaDescriptions.find(S=>{var R;return((R=S.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===E[0].ssrcId})}getSSRC(E){var S;return(S=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===E))===null||S===void 0?void 0:S.attributes.ssrcs}}(Nd(Nd({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const c=this.remoteSDP.toString(),u=E9(this.initialOffer.sdp,this.extension),h=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),h==null||h(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c});const m=this.peerConnection.getTransceivers()[0];if(m!=null&&m.receiver&&this.tryBindTransportEvents(m.receiver),oe("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(oe("PRELOAD_MEDIA_COUNT"));const E=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:E});const S=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(S)}const{preSSRCs:y}=r;if(Array.isArray(y)&&y.length>0){const{mids:E}=this.remoteSDP.batchSend(y.map(S=>({kind:S.kind,ssrcMsg:[{ssrcId:S.ssrcId,rtx:S.rtx}],mslabel:S.mslabel})));E.forEach((S,R)=>{this.preSSRCMap.set(y[R].ssrcId,S)}),await UT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(c.toString()))}var s,o}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:s}=r;this.remoteSDP.updateRemoteRTPCapabilities(s),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:o}=r;if(Array.isArray(o)&&o.length>0){const{mids:c}=this.remoteSDP.batchSend(o.map(u=>Object.assign({},{kind:u.kind,ssrcMsg:[{ssrcId:u.ssrcId,rtx:u.rtx}],mslabel:u.mslabel})));c.forEach((u,h)=>{this.preSSRCMap.set(o[h].ssrcId,u)})}await UT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(s.toString()))}}send(r,s,o){var c=this;return Nl(function*(){const u=yield Dn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=mP();r.forEach(B=>{const Y=c.peerConnection.addTransceiver(B._mediaStreamTrack,Nd({direction:"sendonly"},B.trackMediaType==="video"&&c.supportAV1RtpSpec&&m?{sendEncodings:[{scalabilityMode:m}]}:{}));h.push(Y),B._updateRtpTransceiver(Y)}),Wr()&&oe("SIMULCAST")===!0&&(yield Dn(c.applySimulcastForFirefox(h,r)));const y=yield Dn(c.peerConnection.createOffer()),E=c.remoteSDP.predictReceivingMids(r.length),S=c.mungSendOfferSDP(y.sdp,r,E),R=qa(S),P=E.map(B=>{const Y=R.mediaDescriptions.find(ee=>ee.attributes.mid===B);if(!Y)throw new Error("Cannot extract ssrc from mediaDescription.");return h9(Y,oe("USE_PUB_RTX"))});let D;try{D=yield P}catch(B){D=[],c.remoteSDP.receive(r,s,o,D);const Y=c.remoteSDP.toString();throw yield Dn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Dn(c.peerConnection.setRemoteDescription({type:"answer",sdp:Y})),yield Dn(c.stopSending(E,!0)),B}c.remoteSDP.receive(r,s,o,D);const G=c.remoteSDP.toString(),j=c.logSDPExchange(S,"offer","local","send");return yield Dn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Dn(c.applySimulcastEncodings(h,r)),yield Dn(c.applySendEncodings(h,r)),j==null||j(G),yield Dn(c.peerConnection.setRemoteDescription({type:"answer",sdp:G})),h.map((B,Y)=>{const ee=E[Y];return{localSSRC:P[Y],id:ee,transceiver:B}})}catch(h){throw h instanceof Le?h:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async createDataChannels(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let o=this.dataStreamChannelMap.get(r);if(o&&o.readyState==="open")x.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const u=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof u!="number")throw new Error("create DataChannel error, because cannot get dc id");o=this.peerConnection.createDataChannel("datastream-channel",{id:u,negotiated:!0,ordered:!1,maxRetransmits:oe("DATASTREAM_MAX_RETRANSMITS")}),o.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,o)}s.forEach(u=>{u._updateOriginDataChannel(o)});const{needExchangeSDP:c}=this.remoteSDP.sendDataChannel();if(c){const u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const h=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(h),x.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else x.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(o){throw o instanceof Le?o:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(o.toString()))}}async stopDataChannels(r){try{const s=this.dataStreamChannelMap.get(r);return s&&(s.id&&this.recoveredDataChannelIds.push(s.id),s.close()),void this.dataStreamChannelMap.delete(r)}catch(s){throw s instanceof Le?s:new Le(te.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(s.toString()))}}async stopSending(r,s){const o=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(y=>r.indexOf(y.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");c.map(y=>{var E;RP(this.id+y.mid,this),y.direction="inactive",(E=y.stop)===null||E===void 0||E.call(y)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.peerConnection.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);h&&(await UT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const m=this.peerConnection.getTransceivers().find(y=>y.mid===u);if(!m)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,id:u,transceiver:m}}catch(u){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:s,needExchangeSDP:o}=this.remoteSDP.batchSend(r);return o&&(await UT(this.peerConnection,this.remoteSDP,this.extension),x.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),s.map(c=>{const u=this.peerConnection.getTransceivers().find(h=>h.mid===c);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:c,transceiver:u}})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(u=>{Array.from(this.preSSRCMap.entries()).some(h=>{let[m,y]=h;if(y===u)return this.preSSRCMap.delete(m),!0})}),this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(s.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(s.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async(h,m)=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const u=this.remoteSDP.toString();c==null||c(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return Nl(function*(){const o=yield Dn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Fn().supportPCSetConfiguration,u=oe("FORCE_TURN_TCP")||s.forceTurn;if(r===Xs.RELAY&&!c)return;if(c&&!u){const R=r===Xs.RELAY?"relay":"all",P=s.peerConnection.getConfiguration();P.iceTransportPolicy!==R&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(P.iceTransportPolicy,"] to [").concat(R,"]")),P.iceTransportPolicy=R,s.peerConnection.setConfiguration(P))}s.remoteSDP.updateCandidates(r);const h=yield Dn(s.peerConnection.createOffer({iceRestart:!0}));if(!h.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const m=Ym(h.sdp),{remoteIceParameters:y}=yield m.iceParameters;s.remoteSDP.restartICE(y);const E=s.remoteSDP.toString(),S=s.logSDPExchange(h.sdp||"","offer","local","restartICE");s.store.descriptionStart(),yield Dn(s.peerConnection.setLocalDescription(h)),S==null||S(E),yield Dn(s.peerConnection.setRemoteDescription({type:"answer",sdp:E}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(Xs.TCP_RELAY),await UT(this.peerConnection,this.remoteSDP,this.extension)}catch(s){x.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),s)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(s=>{RP(this.id+s.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Nd(Nd({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(te.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(s)?Wr()||await this.applySimulcastEncodings(o,[s]):await this.applySendEncodings(o,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:o,remote:c}=s.getSelectedCandidatePair();return{local:Nd(Nd({},Ih),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:Nd(Nd({},Ih),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var s;const o="code: ".concat(r.errorCode,", message: ").concat(r.errorText),c=r.port?"local: ".concat(r.port):"";x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(o,"), url: ").concat(r.url||"",", host_candidate:").concat(c)),(s=this.onICECandidateError)===null||s===void 0||s.call(this,o)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},oe("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[]};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&(bT(r.turnServer.servers)?s.iceServers=r.turnServer.servers:oe("NEW_TURN_MODE")&&s.iceServers?(oe("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&s.iceServers.push(...Ey.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):s.iceServers.push(...Ey.newTurnServerConfigToIceServers(r.turnServer.servers)),oe("NEW_FORCE_TURN")&&(s.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(s.iceServers&&s.iceServers.push(...Ey.turnServerConfigToIceServers(r.turnServer.servers)),oe("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...Ey.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),oe("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(s.iceTransportPolicy="relay")}))),oe("ENABLE_ENCODED_TRANSFORM")&&Fn().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{o.security?o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Km(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&!oe("FORCE_TURN_TCP")&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),s}static newTurnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{const c=oe("NEW_TURN_MODE");c===1?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}):c===2?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}):c===3?s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Km(o.turnServerURL),":443?transport=tcp")}):c===4&&(s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=udp")}),s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":3478?transport=tcp")}),s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(Km(o.turnServerURL),":443?transport=tcp")}))}),s}tryBindTransportEvents(r){const s=r.transport;if(s){this.transportEventReceiver=r,s.onstatechange=()=>{var c;s!=null&&s.state&&((c=this.onDTLSTransportStateChange)===null||c===void 0||c.call(this,s.state))},s.onerror=c=>{var u;(u=this.onDTLSTransportError)===null||u===void 0||u.call(this,"error"in c?c.error:c)};const o=s.iceTransport;o&&(o.onstatechange=()=>{const c=s==null?void 0:s.iceTransport.state;var u;c&&((u=this.onICETransportStateChange)===null||u===void 0||u.call(this,c))},o.getSelectedCandidatePair&&(o.onselectedcandidatepairchange=()=>{if(o.getSelectedCandidatePair()){const{local:c,remote:u}=o.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol}),", remote ").concat(JSON.stringify({candidateType:u.type,protocol:u.protocol,address:u.address,port:u.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var o,c;if(s||(s=this.peerConnection.getSenders().find(B=>B.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Fn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const u={},h={};switch(r._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;case"balanced":u.degradationPreference="balanced"}const m=function(j,B){return j.getTransceivers().find(Y=>Y.sender.track===B||Y.receiver.track===B)}(this.peerConnection,r._mediaStreamTrack),y=Hfe(r);if(ige(r)&&m&&s&&y&&this.getLocalVideoStats&&ct(o=["vp8","vp9"]).call(o,this.store.codec)){var E;const j=u.degradationPreference||(ct(E=r._hints).call(E,fr.CUSTOM_TRACK)?oe("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(B,Y,ee,fe,ye,Ee){if(RP(B,ee),ye(Y),fe!=="balanced"&&fe!=="maintain-framerate"&&fe!=="maintain-resolution")return;let _e=-1;q9(B,Y);const Ne=window.setInterval(()=>{const pt=CP.get(B);if(!oe("ENABLE_AG_ADAPTATION")||!pt)return RP(B,ee),void ye(Y);const yt=Ee();if(yt.sendPackets>0&&yt.OutgoingAvailableBandwidth>0){if(_e===-1)return void(_e=Date.now());if(Date.now()-_e<1e3)return;const In=yt.sendFrameRate,An=yt.OutgoingAvailableBandwidth,[mr,li]=rge(B,In,An,pt.adaptationConfig,Y,fe);li&&(ee.qualityLimitationReason=li),mr&&pt.adaptationConfig.scale!==mr.scale&&(x.debug("[".concat(B,"] applyAdaptation: ").concat(ee.qualityLimitationReason,`
           sendFps `).concat(In,", bwe ").concat(An,", switch from ").concat(pt.adaptationConfig.scale," to ").concat(mr.scale," ")),pt.adaptationConfig=n2(n2({},pt.adaptationConfig),mr),ye(mr))}},oe("CHECK_LOCAL_STATS_INTERVAL")),Ze=n2({},Y);CP.set(B,{timer:Ne,adaptationConfig:Ze,originConfig:Y,adaptationFunc:ye}),x.debug("[".concat(B,"] start adaptation, originConfig: ").concat(JSON.stringify(Y),", degradationPreference: ").concat(fe))})(this.id+m.mid,y,this,j,B=>{s&&this.updateAdaptation(s,B)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var S;const{bitrateMax:j,frameRate:B,scaleResolutionDownBy:Y}=r._encoderConfig;j&&(h.maxBitrate=1e3*j),(ct(S=r._hints).call(S,fr.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(B&&(h.maxFramerate=wc(B)),Y&&Y>=1&&(h.scaleResolutionDownBy=Y))}const{maxFramerate:R}=oe("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(h.maxFramerate=h.maxFramerate?Math.min(h.maxFramerate,R):R),oe("DSCP_TYPE")&&af()){var P;const j=oe("DSCP_TYPE");ct(P=["very-low","low","medium","high"]).call(P,j)&&(h.networkPriority=j)}const D=s.getParameters(),G=(c=D.encodings)===null||c===void 0?void 0:c[0];Wr()&&!G&&(u.encodings=[h]),G&&Object.assign(G,h),Object.assign(D,u),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(D.encodings))),await s.setParameters(D),await async function(j,B,Y){try{var ee;if(!Fn().supportSetRtpSenderParameters||!function(Ne){return Ne==="vp9"||Ne==="av1"}(j)||!oe("ENABLE_SVC"))return;const fe={},ye={},Ee=B.getParameters(),_e=(ee=Ee.encodings)===null||ee===void 0?void 0:ee[0];ye.scalabilityMode=mP(Y),_e&&Object.assign(_e,ye),Object.assign(Ee,fe),await B.setParameters(Ee),x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(Ee.encodings)))}catch(fe){x.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",fe)}}(this.store.codec,s,oe("SVC_MODE"))}async updateAdaptation(r,s){var o,c;if(!r)return x.debug("[updateAdaptation] no rtpSender found");if(!Fn().supportSetRtpSenderParameters)return x.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const u={},{bitrateMax:h,frameRate:m,scaleResolutionDownBy:y}=s;h&&(u.maxBitrate=1e3*h),m&&(u.maxFramerate=wc(m)),y&&y>=1&&ct(o=["vp8","vp9"]).call(o,this.store.codec)&&(u.scaleResolutionDownBy=y);const E=r.getParameters(),S=(c=E.encodings)===null||c===void 0?void 0:c[0];S&&Object.assign(S,u),Object.assign(E,{});try{await r.setParameters(E),x.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(E.encodings)))}catch(R){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?x.debug("[updateAdaptation] peerConnection not connected}"):x.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):x.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,s){try{if(!Fn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=s[o];u instanceof Cr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,o){const c=qa(r);return s.forEach((u,h)=>{const m=o[h],y=c.mediaDescriptions.find(E=>E.attributes.mid===m);y&&(aS(y,u),g9(y,u,this.store.codec))}),Gm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let y=0;y<r.length;y++){var o,c,u,h,m;const E=r[y],S=s[y];if(S instanceof Cr&&!ct(o=S._hints).call(o,fr.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const D=E.sender.getParameters();await E.sender.setParameters(Object.assign(D,R))}}}async applySimulcastEncodings(r,s){if(!Wr()&&r.length===s.length)for(let o=0;o<r.length;o++){const c=s[o];if(c instanceof Cr&&this.isVP8Simulcast(c)){const u=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const y=u.sender.getParameters();await u.sender.setParameters(Object.assign(y,h))}}}isVP8Simulcast(r){var s,o,c,u,h;return!!(r instanceof Cr&&oe("SIMULCAST")&&this.store.codec==="vp8"&&!ct(s=r._hints).call(s,fr.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,o,c){if(oe("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s&&s.length!==0?s[0].ssrcId:void 0}setConfiguration(r){if(Fn().supportPCSetConfiguration){const s=Ey.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},It(kn.prototype,"updateRemoteRTPCapabilities",[Ea],Object.getOwnPropertyDescriptor(kn.prototype,"updateRemoteRTPCapabilities"),kn.prototype),It(kn.prototype,"connect",[Ea],Object.getOwnPropertyDescriptor(kn.prototype,"connect"),kn.prototype),It(kn.prototype,"updateRemoteConnect",[Ea],Object.getOwnPropertyDescriptor(kn.prototype,"updateRemoteConnect"),kn.prototype),It(kn.prototype,"createDataChannels",[Ea],Object.getOwnPropertyDescriptor(kn.prototype,"createDataChannels"),kn.prototype),It(kn.prototype,"receive",[Ea],Object.getOwnPropertyDescriptor(kn.prototype,"receive"),kn.prototype),It(kn.prototype,"batchReceive",[Ea],Object.getOwnPropertyDescriptor(kn.prototype,"batchReceive"),kn.prototype),It(kn.prototype,"stopReceiving",[Ea],Object.getOwnPropertyDescriptor(kn.prototype,"stopReceiving"),kn.prototype),It(kn.prototype,"muteRemote",[Ea],Object.getOwnPropertyDescriptor(kn.prototype,"muteRemote"),kn.prototype),It(kn.prototype,"unmuteRemote",[Ea],Object.getOwnPropertyDescriptor(kn.prototype,"unmuteRemote"),kn.prototype),It(kn.prototype,"muteLocal",[Ea],Object.getOwnPropertyDescriptor(kn.prototype,"muteLocal"),kn.prototype),It(kn.prototype,"unmuteLocal",[Ea],Object.getOwnPropertyDescriptor(kn.prototype,"unmuteLocal"),kn.prototype),It(kn.prototype,"close",[Ea],Object.getOwnPropertyDescriptor(kn.prototype,"close"),kn.prototype),It(kn.prototype,"updateEncoderConfig",[Ea],Object.getOwnPropertyDescriptor(kn.prototype,"updateEncoderConfig"),kn.prototype),It(kn.prototype,"updateSendParameters",[Ea],Object.getOwnPropertyDescriptor(kn.prototype,"updateSendParameters"),kn.prototype),It(kn.prototype,"replaceTrack",[Ea],Object.getOwnPropertyDescriptor(kn.prototype,"replaceTrack"),kn.prototype),It(kn.prototype,"updateAdaptation",[Ea],Object.getOwnPropertyDescriptor(kn.prototype,"updateAdaptation"),kn.prototype),It(kn.prototype,"getRemoteSSRC",[Ea],Object.getOwnPropertyDescriptor(kn.prototype,"getRemoteSSRC"),kn.prototype),kn);function Ea(e,r,s){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await o.apply(this,m)}finally{u()}},s}function o2(e,r){let s=document.createElement("video"),o=document.createElement("canvas");s.setAttribute("style","display:none"),o.setAttribute("style","display:none"),s.setAttribute("muted",""),s.muted=!0,s.setAttribute("autoplay",""),s.autoplay=!0,s.setAttribute("playsinline",""),o.width=wc(r.width),o.height=wc(r.height);const c=wc(r.framerate||15);document.body.append(s),document.body.append(o);let u=e._mediaStreamTrack;s.srcObject=new MediaStream([u]),s.play();const h=o.getContext("2d");if(!h)throw new Ae(te.UNEXPECTED_ERROR,"can not get canvas context");const m=Fn(),y=o.captureStream(m.supportRequestFrame?0:c).getVideoTracks()[0];y.canvas||(y.canvas=o),o.startCapture=()=>{if(!s)return o.stopCapture&&o.stopCapture();if(s.paused&&s.play(),s.videoHeight>2&&s.videoWidth>2){const S=s.videoWidth,R=s.videoHeight/S,P=o.width*R;Math.abs(P-o.height)>=2&&(x.debug("adjust low stream resolution","".concat(o.width,"x").concat(o.height," -> ").concat(o.width,"x").concat(P)),o.height=P)}h.drawImage(s,0,0,o.width,o.height),y.requestFrame&&y.requestFrame(),u!==e._mediaStreamTrack&&(u=e._mediaStreamTrack,s.srcObject=new MediaStream([u]))},o.stopCapture=_L(()=>o.startCapture&&o.startCapture(),c);const E=y.stop;return y.stop=()=>{E.call(y),s&&(s.remove(),s.srcObject=null,s=null),o&&(o.width=0,o.remove(),o.stopCapture&&o.stopCapture(),o.startCapture=void 0,o.stopCapture=void 0,o=null),x.debug("clean low stream renderer")},y}var AP=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(AP||{}),vi=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e[e.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e[e.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e[e.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e}(vi||{}),Z_=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(Z_||{}),Si=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e[e.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e[e.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e[e.AVG_DECODE=2200]="AVG_DECODE",e[e.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e[e.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e[e.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e[e.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e}(Si||{}),ey=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(ey||{}),Z9=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(Z9||{}),xh=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e[e.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",e}(xh||{}),va=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e[e.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",e[e.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",e[e.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",e}(va||{}),eH=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(eH||{}),Sa=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(Sa||{}),PP=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(PP||{});const ty=1e3,ny=6,OP=3,age=Math.max(ny,OP);function qt(e,r,s){s!=null&&Number.isFinite(s)&&(e[r]=Math.round(Math.max(0,s)))}function tH(e){const r={[Sa.CONN_TYPE]:0,[Sa.RTT]:e.rtt,[Sa.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const s=e.selectedCandidatePair.localCandidate.relayProtocol;s==="udp"&&(r[Sa.CONN_TYPE]=1),s==="tcp"&&(r[Sa.CONN_TYPE]=3),s==="tls"&&(r[Sa.CONN_TYPE]=4);break}case"srflx":r[Sa.CONN_TYPE]=2;break;case"unknown":r[Sa.CONN_TYPE]=5;break;default:r[Sa.CONN_TYPE]=0}return r}function nH(e){let r=0;switch(e){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class rH extends jr{constructor(r){super(),q(this,"store",void 0),q(this,"uploadWRTCStatsTimer",void 0),q(this,"uploadOutboundDenoiserStatsTimer",void 0),q(this,"uploadExtStatsTimer",void 0),q(this,"uploadExtUsageStatsTimer",void 0),q(this,"uploadInboundExtStatsTimer",void 0),q(this,"requestStats",void 0),q(this,"requestTransportStats",void 0),q(this,"requestLocalMedia",void 0),q(this,"requestRemoteMedia",void 0),q(this,"requestAllTracks",void 0),q(this,"requestVideoIsReady",void 0),q(this,"requestUploadStats",void 0),q(this,"requestUpload",void 0),q(this,"uploadOutboundStarted",!1),q(this,"uploadInboundStarted",!1),q(this,"uploadTransportStarted",!1),q(this,"uploadBaseStatsStarted",!1),q(this,"uploadExtensionUsageStarted",!1),q(this,"lastRecvStats",void 0),q(this,"lastSendStats",void 0),q(this,"lastRefRecvStats",void 0),q(this,"lastRefSendStats",void 0),q(this,"lastFullRecvStats",void 0),q(this,"lastFullSendStats",void 0),q(this,"needUploadRenderFreezeTime",!0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const s=r%OP==0,o=r%ny==0;let c,u;if(this.uploadTransportStarted&&(c=this.requestStats(),this.store.useP2P&&(u=this.requestStats(!0))),!c&&this.uploadOutboundStarted&&(c=this.requestStats()),!u&&this.uploadInboundStarted&&(u=this.requestStats(!0)),c||u){var h;const m={};if(this.uploadTransportStarted&&c){const E=this.getTransportStats(c,u,s);E&&(m.misc=[E])}if(this.uploadOutboundStarted&&c){const E=this.getOutboundStats(c,o?this.lastFullSendStats:s?this.lastRefSendStats:this.lastSendStats,s,o);E&&(m.outbound=[E])}if(this.uploadInboundStarted&&u){const E=this.getInboundStats(u,o?this.lastFullRecvStats:s?this.lastRefRecvStats:this.lastRecvStats,s,o);E&&(m.inbound=E)}const y=(h=this.requestTransportStats)===null||h===void 0?void 0:h.call(this).connectState;y&&(Array.isArray(m.misc)?m.misc[0]&&m.misc[0].addition&&(m.misc[0].addition[PP.RTC_PEER_CONNECTION_STATE]=nL[y]):m.misc=[{addition:{[PP.RTC_PEER_CONNECTION_STATE]:nL[y]}}]),this.requestUploadStats(m)}this.lastRecvStats=u,this.lastSendStats=c,o&&(this.lastFullRecvStats=u,this.lastFullSendStats=c),s&&(this.lastRefRecvStats=u,this.lastRefSendStats=c)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var s,o;const c=(s=this.requestTransportStats)===null||s===void 0?void 0:s.call(this);return void(c&&((o=this.requestUploadStats)===null||o===void 0||o.call(this,{misc:[{addition:{[PP.RTC_PEER_CONNECTION_STATE]:nL[c.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===age+1&&(r=1)},ty)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(r,s,o){if(!this.requestStats)return;if(!o)return r.rtt==null?void 0:{addition:{[Sa.RTT]:r.rtt,[Sa.CONN_TYPE]:void 0,[Sa.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const c=tH(r);if(this.store.useP2P){if(s){const u=tH(s);c[Sa.CONN_TYPE]+=u[Sa.CONN_TYPE]<<3}c[Sa.CONN_TYPE]+=110}else c[Sa.CONN_TYPE]+=100;return{addition:c}}getOutboundStats(r,s,o,c){if(!this.requestUploadStats||!this.requestLocalMedia)return;const u=this.requestLocalMedia();if(!u||u.length===0)return;let h,m,y;return u.forEach(E=>{let[S,{track:R,ssrcs:P}]=E;switch(S){case Xe.LocalVideoLowTrack:case Xe.LocalVideoTrack:if(S===Xe.LocalVideoTrack){const D=function(B,Y,ee,fe,ye,Ee){const _e=Y.videoSend.find(yt=>yt.ssrc===B);if(!_e)return;const Ne={},{sentFrame:Ze,inputFrame:pt}=_e;if(Ee&&(qt(Ne,vi.QP_SUM,_e.qpSumPerFrame),pt&&Ze)){const yt=pt.frameRate,In=Ze.frameRate;Ne[vi.FREEZE]=function(An,mr){let li=!0;return li=!(An<=5)&&(An<=10?mr<3:An<=20?mr<4:mr<5),li}(yt,In)?1:0}if(ye){switch(Ze&&(qt(Ne,vi.HEIGHT,Ze.height),qt(Ne,vi.WIDTH,Ze.width),qt(Ne,vi.FRAME_RATE,Ze.frameRate)),Ne[vi.DISABLED]=fe._originMediaStreamTrack&&!fe._originMediaStreamTrack.enabled||fe._mediaStreamTrack&&!fe._mediaStreamTrack.enabled?1:0,_e.adaptionChangeReason){case"none":Ne[vi.ADAPTATION]=0;break;case"cpu":Ne[vi.ADAPTATION]=1;break;case"bandwidth":Ne[vi.ADAPTATION]=2;break;case"other":Ne[vi.ADAPTATION]=3}let yt=0;_e.adaptionChangeReason&&(yt+=nH(_e.adaptionChangeReason)),Y.qualityLimitationReason&&(yt+=nH(Y.qualityLimitationReason)<<3),Ne[vi.ADAPTATION]=yt,Ne[vi.PLAYER_STATUS]=mL[fe._player?fe._player.videoElementStatus:"uninit"],qt(Ne,vi.NACKS,_e.nacksCount),qt(Ne,vi.PLIS,_e.plisCount),qt(Ne,vi.FIRS,_e.firsCount),qt(Ne,vi.AVG_ENCODE,_e.avgEncodeMs),qt(Ne,vi.HUGE_FRAME_SENT,_e.hugeFramesSent),qt(Ne,vi.BYTES_RETRANSMIT,_e.retransmittedBytesSent),qt(Ne,vi.PACKAGES_RETRANSMIT,_e.retransmittedPacketsSent),qt(Ne,vi.KEY_FRAMES_ENCODED,_e.keyFramesEncoded);const In=ee&&ee.videoSend.find(An=>An.ssrc===B);if(In){let An=ye?ty:ty*ny;In.timestamp&&_e.timestamp&&(An=_e.timestamp-In.timestamp),In.packets!=null&&_e.packets!=null&&qt(Ne,vi.PACKAGE_RATE,1e3*(_e.packets-In.packets)/An),_e.packetsLost!=null&&In.packetsLost!=null&&qt(Ne,vi.PACKAGE_LOST,_e.packetsLost-In.packetsLost),In.bytes!=null&&_e.bytes!=null&&qt(Ne,vi.BITRATE,8*(_e.bytes-In.bytes)/An)}}return Ne}(P[0].ssrcId,r,s,R,o,c),G=R&&function(B,Y,ee,fe){const ye=Y.videoSend.find(_e=>_e.ssrc===B);if(!ye)return null;const Ee={};if(fe){const _e=ye.inputFrame,Ne=_e&&_e.height||ee.videoHeight||0,Ze=_e&&_e.width||ee.videoWidth||0,pt=_e&&_e.frameRate||0;qt(Ee,AP.HEIGHT,Ne),qt(Ee,AP.WIDTH,Ze),qt(Ee,AP.FRAME_RATE,pt)}return Ee}(P[0].ssrcId,r,R,o),j=function(B,Y){const ee={};return Y&&(qt(ee,vi.RETRANSMIT,B.bitrate.retransmit),qt(ee,vi.TARGET_ENCODED,B.bitrate.targetEncoded),qt(ee,vi.ACTUAL_ENCODED,B.bitrate.actualEncoded),qt(ee,vi.TRANSMIT,B.bitrate.transmit),qt(ee,vi.BANDWIDTH,B.sendBandwidth)),ee}(r,o);m=Object.assign({},D,G,j)}else y=function(D,G,j,B){const Y=G.videoSend.find(fe=>fe.ssrc===D);if(!Y)return;const ee={};if(B){const fe=Y.sentFrame;if(fe&&(qt(ee,Z_.HEIGHT,fe.height),qt(ee,Z_.WIDTH,fe.width),qt(ee,Z_.FRAME_RATE,fe.frameRate)),j){const ye=j.videoSend.find(Ee=>Ee.ssrc===D);if(ye){let Ee=ty*ny;ye.timestamp&&Y.timestamp&&(Ee=Y.timestamp-ye.timestamp),ye.packets!=null&&Y.packets!=null&&qt(ee,Z_.PACKAGE_RATE,1e3*(Y.packets-ye.packets)/Ee),Y.packetsLost!=null&&ye.packetsLost!=null&&qt(ee,Z_.PACKAGE_LOST,Y.packetsLost-ye.packetsLost),ye.bytes!=null&&Y.bytes!=null&&qt(ee,Z_.BITRATE,8*(Y.bytes-ye.bytes)/Ee)}}}return ee}(P[0].ssrcId,r,s,o);break;case Xe.LocalAudioTrack:h=R&&function(D,G,j,B,Y){const ee=G.audioSend.find(ye=>ye.ssrc===D);if(!ee)return;const fe={};if(Y){fe[xh.DISABLED]=B._originMediaStreamTrack&&!B._originMediaStreamTrack.enabled||B._mediaStreamTrack&&!B._mediaStreamTrack.enabled?1:0;const ye=100*B._source.getAccurateVolumeLevel(),Ee=ee.inputLevel;if(Ee!=null){const Ne=Math.ceil(50*Math.log10(100*Ee+1));qt(fe,xh.LEVEL,Ne)}qt(fe,Z9.PCM_LEVEL,ye),qt(fe,xh.AEC_RETURN_LOSS,ee.aecReturnLoss),qt(fe,xh.AEC_RETURN_LOSS_ENH,ee.aecReturnLossEnhancement),qt(fe,xh.BYTES_RETRANSMIT,ee.retransmittedBytesSent),qt(fe,xh.PACKAGES_RETRANSMIT,ee.retransmittedPacketsSent),fe[xh.FREEZE]=0;const _e=j&&j.audioSend.find(Ne=>Ne.ssrc===D);if(_e){let Ne=ty*ny;_e.timestamp&&ee.timestamp&&(Ne=ee.timestamp-_e.timestamp),_e.bytes!=null&&ee.bytes!=null&&qt(fe,xh.BITRATE,8*(ee.bytes-_e.bytes)/Ne),_e.packets!=null&&ee.packets!=null&&qt(fe,xh.PACKAGE_RATE,1e3*(ee.packets-_e.packets)/Ne)}}return fe}(P[0].ssrcId,r,s,R,o)}}),{high:m,low:y,audio:h}}getInboundStats(r,s,o,c){if(!this.requestRemoteMedia)return;const u=this.requestRemoteMedia()||[],h=[];return u.forEach(m=>{let[y,E]=m;const S={peer:y.uid};if(E.has(bt.VIDEO)&&y.videoTrack){const R=y._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(y._videoSSRC)||!1,P=y.videoTrack?function(D,G,j,B,Y,ee,fe,ye){const Ee=G.videoRecv.find(An=>An.ssrc===D);if(!Ee)return;const _e={},{receivedFrame:Ne,outputFrame:Ze,decodeFrameRate:pt}=Ee,yt=j&&j.videoRecv.find(An=>An.ssrc===D);if(qt(_e,ey.FRAME_RATE_DECODE,pt),Ee.framesRateFirefox&&qt(_e,Si.FRAME_RATE,Ee.framesRateFirefox),Ne&&qt(_e,Si.FRAME_RATE,Ne.frameRate),qt(_e,Si.FRAMES_DROPPED,Ee.framesDroppedCount),qt(_e,Si.BYTES_RETRANSMIT,Ee.retransmittedBytesReceived),qt(_e,Si.PACKAGES_RETRANSMIT,Ee.retransmittedPacketsReceived),qt(_e,Si.PACKAGES_DISCARDED,Ee.packetsDiscarded),qt(_e,Si.AVG_DECODE,Ee.avgDecodeMs),qt(_e,Si.AVG_PROCESSING_DELAY,Ee.avgProcessingDelayMs),qt(_e,Si.AVG_ASSEMBLY_TIME,Ee.avgFramesAssembledFromMultiplePacketsMs),qt(_e,Si.AVG_INTER_FRAME_DELAY,Ee.avgInterFrameDelayMs),qt(_e,Si.KEY_FRAMES_DECODED,Ee.keyFramesDecoded),yt){const An=G.timestamp-j.timestamp||ty*(ye?ny:fe?OP:1);Ee.packetsLost!=null&&yt.packetsLost!=null&&qt(_e,Si.PACKAGE_LOST,Ee.packetsLost-yt.packetsLost),yt.bytes!=null&&Ee.bytes!=null&&qt(_e,Si.BITRATE,8*(Ee.bytes-yt.bytes)/An),yt.packets!=null&&Ee.packets!=null&&qt(_e,Si.PACKAGE_RATE,1e3*(Ee.packets-yt.packets)/An)}if(ye&&(qt(_e,Si.QP_SUM,Ee.qpSumPerFrame),_e[Si.FREEZE]=Y&&FT.isRemoteVideoFreeze(B,Ee,yt)?1:0),fe){var In;Ne?(qt(_e,Si.HEIGHT,Ne.height),qt(_e,Si.WIDTH,Ne.width)):B&&(qt(_e,Si.HEIGHT,B._videoHeight||0),qt(_e,Si.WIDTH,B._videoWidth||0)),Ze&&qt(_e,ey.FRAME_RATE_OUTPUT,Ze.frameRate);const An=(In=B._player)===null||In===void 0?void 0:In.rendFrameRate.toFixed(0);if(An&&qt(_e,ey.FRAME_RATE_RENDER,+An),qt(_e,Si.JITTER_BUFFER,Ee.jitterBufferMs),qt(_e,Si.CURRENT_DELAY,Ee.currentDelayMs),qt(_e,Si.FIRS,Ee.firsCount),qt(_e,Si.NACKS,Ee.nacksCount),qt(_e,Si.PLIS,Ee.plisCount),B){_e[Si.DISABLED]=B._originMediaStreamTrack.enabled&&B._mediaStreamTrack.enabled?0:1;const mr=B._player;if(mr){const{freezeTimeCounterList:li,renderFreezeAccTime:Jr,videoElementStatus:Ta}=mr;if(li&&li.length>0&&qt(_e,ey.FREEZE_TIME,li.splice(0,1)[0]),ee&&uf.visibility==="visible"&&Ta===Co.PLAYING&&Fn().supportRequestVideoFrameCallback){const We=Math.min(6e3,Jr);mr.renderFreezeAccTime=Math.max(0,Jr-We),qt(_e,ey.FREEZE_TIME_RENDER,We)}if(typeof Ee.totalFreezesDuration=="number"){const We=yt&&yt.totalFreezesDuration?Ee.totalFreezesDuration-yt.totalFreezesDuration:Ee.totalFreezesDuration;qt(_e,ey.FREEZE_DURATION,1e3*We)}}}if(_e[Si.PLAYER_STATUS]=mL[B._player?B._player.videoElementStatus:"uninit"],yt&&Ee.totalInterFrameDelay!==void 0&&Ee.totalSquaredInterFrameDelay!==void 0&&yt.totalInterFrameDelay!==void 0&&yt.totalSquaredInterFrameDelay!==void 0){const mr=Ee.totalInterFrameDelay-yt.totalInterFrameDelay,li=Ee.totalSquaredInterFrameDelay-yt.totalSquaredInterFrameDelay,Jr=Ee.framesDecodeCount-yt.framesDecodeCount,Ta=mr/Jr*1e3,We=Math.round(1e3*Math.sqrt((li-Math.pow(mr,2)/Jr)/Jr));!isNaN(We)&&Ta+We>Math.max(3*Ta,Ta+150)&&(_e[Si.I_FRAME_DELAY]=We)}}return _e}(y._videoSSRC,r,s,y.videoTrack,R===!0,this.needUploadRenderFreezeTime,o,c):void 0;P&&(S.video=P)}if(E.has(bt.AUDIO)&&y.audioTrack){const R=y.audioTrack?function(P,D,G,j,B,Y){const ee=D.audioRecv.find(_e=>_e.ssrc===P);if(!ee)return;const fe={},ye=G&&G.audioRecv.find(_e=>_e.ssrc===P);if(qt(fe,va.JITTER,ee.jitterMs),qt(fe,va.BYTES_RETRANSMIT,ee.retransmittedBytesReceived),qt(fe,va.PACKAGES_RETRANSMIT,ee.retransmittedPacketsReceived),qt(fe,va.PACKAGES_DISCARDED,ee.packetsDiscarded),qt(fe,va.AVG_PROCESSING_DELAY,ee.avgProcessingDelayMs),ye){const _e=D.timestamp-G.timestamp||ty*(Y?ny:B?OP:1);ee.packets!=null&&ye.packets!=null&&qt(fe,va.PACKAGE_RATE,1e3*(ee.packets-ye.packets)/_e),B&&ye.bytes!=null&&ee.bytes!=null&&qt(fe,va.BITRATE,8*(ee.bytes-ye.bytes)/_e),ee.packetsLost!=null&&ye.packetsLost!=null&&qt(fe,va.PACKAGE_LOST,ee.packetsLost-ye.packetsLost)}if(Y){const{receivedFrames:_e,droppedFrames:Ne}=ee;_e!=null&&Ne!=null&&(fe[va.FREEZE]=(Ee=_e)===0||100*Ne/Ee>20?1:0)}var Ee;if(B){const _e=100*j._source.getAccurateVolumeLevel(),Ne=ee.outputLevel;if(Ne!=null){const Ze=Math.ceil(50*Math.log10(100*Ne+1));qt(fe,eH.LEVEL,Ze)}if(qt(fe,va.PCM_LEVEL,_e),j&&(fe[va.DISABLED]=j._originMediaStreamTrack.enabled&&j._mediaStreamTrack.enabled?0:1),qt(fe,va.JITTER_BUFFER,ee.jitterBufferMs),qt(fe,va.CURRENT_DELAY,ee.jitterBufferMs),fe[va.PLAYER_STATUS]=mL[ya.getPlayerState(j.getTrackId())],ye){const Ze=ee.concealedSamples-ye.concealedSamples;Ze>0&&qt(fe,va.CONCEALED_SAMPLES,Ze);const pt=ee.totalSamplesReceived-ye.totalSamplesReceived;pt>0&&qt(fe,va.TOTAL_SAMPLES_RECEIVED,pt)}}return fe}(y._audioSSRC,r,s,y.audioTrack,o,c):void 0;R&&(S.audio=R)}(S.video||S.audio)&&h.push(S)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,h}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(s=>s instanceof ZA);if(r&&r._external.getDenoiserStats){const s=r._external.getDenoiserStats();s&&this.requestUpload(OT.DENOISER_STATS,s)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[s,o]=r;o.has(bt.VIDEO)&&s.videoTrack&&s.videoTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)}),o.has(bt.AUDIO)&&s.audioTrack&&s.audioTrack.getProcessorStats().forEach(c=>{this.requestUpload&&this.requestUpload(c.type,c.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const s=Date.now(),o={connectionInterval:oe("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:s};let c=[];const u=this.requestAllTracks&&this.requestAllTracks()||[];for(const E of u)!E.muted&&E.enabled&&(c=c.concat(await E.getProcessorUsage()));const h=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[E,S]of h)S.has(bt.VIDEO)&&E.videoTrack&&(c=c.concat(await E.videoTrack.getProcessorUsage())),S.has(bt.AUDIO)&&E.audioTrack&&(c=c.concat(await E.audioTrack.getProcessorUsage()));if(c.length===0)return;o.details=function(E,S){const R={};for(const{id:j,value:B,level:Y,direction:ee}of E){var P;const fe=(P=S.get(j))!==null&&P!==void 0?P:0,ye=B===2?fe+oe("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:fe;var D,G;S.set(j,ye),R[j]?(B===2&&(R[j].value=B),Y>R[j].level&&(R[j].level=Y),ee==="remote"&&(R[j].remoteUidCount+=1),R[j].totalTs=(D=S.get(j))!==null&&D!==void 0?D:0):R[j]={value:B,level:Y,remoteUidCount:ee==="local"?0:1,totalTs:(G=S.get(j))!==null&&G!==void 0?G:0}}return Object.keys(R).map(j=>{const{level:B,value:Y,totalTs:ee}=R[j];return{id:j,level:B,value:Y,totalTs:ee}})}(c,r);const m=Date.now(),y=m>s?m:s+1;this.requestUpload&&this.requestUpload(OT.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:y})},oe("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const cge=oe("ICE_RESTART_INTERVAL");let kP=new Map,hS=new Map,Qm=[Xs.UDP_TCP_RELAY,Xs.TCP_RELAY,Xs.RELAY],a2=oe("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Fn().supportPCSetConfiguration;function iH(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const s=kP.get(e.id);s&&(window.clearTimeout(s),kP.delete(e.id));const o=hS.get(e.id);r&&o&&o.index===Qm.length-1&&(x.debug("[".concat(e.id,"] reset ICE restart policy")),hS.delete(e.id))}function sH(e,r,s){if(kP.size===0&&hS.size===0&&(Array.isArray(oe("RESTART_SEQUENCE"))&&oe("RESTART_SEQUENCE").length>0&&!function(m,y){if(m.length!==y.length)return!1;for(let E=0;E<m.length;E+=1){const S=m[E];if(m.filter(R=>R===S).length!==y.filter(R=>R===S).length)return!1}return!0}(Qm,oe("RESTART_SEQUENCE"))&&(Qm=oe("RESTART_SEQUENCE").filter(m=>{var y;if(ct(y=Object.values(Xs)).call(y,m))return!0}),x.debug("use reconnection policy from config distribution, queues: ".concat(Qm.join(" => ")))),a2=oe("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&Fn().supportPCSetConfiguration),Qm.length===0)return void s();let o,{index:c=0,type:u}=hS.get(e.id)||{};if(a2&&u===Xs.RELAY)return void s();let h=u&&c>=Qm.length-1;if(a2)u=Xs.RELAY;else{if(h)return void s();u?(c++,u=Qm[c]):(u=Qm[0],c=0)}x.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(u,", index: ").concat(c)),r(u),hS.set(e.id,{index:c,type:u}),o=window.setTimeout(()=>sH(e,r,s),cge),kP.set(e.id,o)}var yn;function oH(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function Lh(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?oH(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):oH(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}function aH(e){var r,s,o,c=2;for(typeof Symbol<"u"&&(s=kx,o=Symbol.iterator);c--;){if(s&&(r=e[s])!=null)return r.call(e);if(o&&(r=e[o])!=null)return new NP(r.call(e));s="@@asyncIterator",o="@@iterator"}throw new TypeError("Object is not async iterable")}function NP(e){function r(s){if(Object(s)!==s)return ht.reject(new TypeError(s+" is not an object."));var o=s.done;return ht.resolve(s.value).then(function(c){return{value:c,done:o}})}return NP=function(s){this.s=s,this.n=s.next},NP.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(s){var o=this.s.return;return o===void 0?ht.resolve({value:s,done:!0}):r(o.apply(this.s,arguments))},throw:function(s){var o=this.s.return;return o===void 0?ht.reject(s):r(o.apply(this.s,arguments))}},new NP(e)}let zT=(yn=class extends jr{get state(){return this._state}set state(e){const r=this._state;this._state=e,this.emit(jt.StateChange,r,this._state)}constructor(e,r){super(),q(this,"isPlanB",void 0),q(this,"store",void 0),q(this,"statsUploader",void 0),q(this,"connection",void 0),q(this,"localTrackMap",new Map),q(this,"remoteUserMap",new Map),q(this,"localDataChannels",[]),q(this,"remoteDataChannelMap",new Map),q(this,"pendingLocalTracks",[]),q(this,"pendingRemoteTracks",[]),q(this,"pendingLocalDataChannels",[]),q(this,"pendingRemoteDataChannels",[]),q(this,"statsCollector",void 0),q(this,"shouldForwardP2PCreation",void 0),q(this,"iceFailedCount",0),q(this,"dtlsFailedCount",0),q(this,"mutex",void 0),q(this,"_state",Xn.Disconnected),q(this,"_pcStatsUploadType",oe("NEW_ICE_RESTART")?ff.FIRST_CONNECTION:ff.OLD_FIRST_CONNECTION),q(this,"_isStartRestartIce",!1),q(this,"_restartTimer",void 0),q(this,"_isTryConnecting",!1),q(this,"_iceError",null),q(this,"_forceTurn",!1),q(this,"_isWaitPcToRePub",!1),q(this,"handleMuteLocalTrack",async(s,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Xn.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const h=this.filterTobeMutedTracks(s);if(h.length===0)return void o();const m=h.find(E=>E[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const y=this.createMuteMessage(h);await hr(this,jt.RequestMuteLocal,y),o()}catch(h){c(h)}finally{u()}}),q(this,"handleUnmuteLocalTrack",async(s,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Xn.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void o();const m=h.find(E=>E[0]==="videoLowTrack");if(m){const E=m[1];if(E.track._originMediaStreamTrack.stop(),!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fn().supportDualStreamEncoding){const S=s._mediaStreamTrack.clone();E.track._mediaStreamTrack=S,E.track._originMediaStreamTrack=S}else{const S=o2(s,TT(this,jt.RequestLowStreamParameter));E.track._mediaStreamTrack=S,E.track._originMediaStreamTrack=S}await new ht((S,R)=>{this.handleReplaceTrack(E.track,S,R,!0)})}await this.connection.unmuteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const y=this.createUnmuteMessage(h);await hr(this,jt.RequestUnmuteLocal,y),o()}catch(h){c(h)}finally{u()}}),q(this,"handleUpdateVideoEncoder",async(s,o,c,u)=>{let h;u||(h=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const y=this.localTrackMap.get(Xe.LocalVideoTrack);if(!this.connection||!y||y.track!==s||this.state!==Xn.Connected)return void o();const{id:E,track:S}=y;await this.connection.updateSendParameters(E,S),await this.connection.updateEncoderConfig(E,S),this.emit(jt.UpdateVideoEncoder,S),o()}catch(y){c(y)}finally{var m;(m=h)===null||m===void 0||m()}}),q(this,"handleUpdateVideoSendParameters",async(s,o,c)=>{const u=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Xe.LocalVideoTrack);if(!this.connection||!h||h.track!==s||this.state!==Xn.Connected)return void o();const{id:m,track:y}=h;await this.connection.updateSendParameters(m,y),o()}catch(h){c(h)}finally{u()}}),q(this,"handleReplaceMixingTrack",async(s,o,c,u)=>{if(!this.connection||this.state!==Xn.Connected)return void o();const h=i2([s]);let m;x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(h.getTrackId(),"]")),typeof u=="boolean"&&u||(m=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(s,h),o()}catch(E){c(E)}finally{var y;(y=m)===null||y===void 0||y()}}),q(this,"handleReplaceTrack",async(s,o,c,u)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var m;const E=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return s===R});if(!this.connection||!E||this.state!==Xn.Connected)return void o();if(await((m=this.connection)===null||m===void 0?void 0:m.replaceTrack(s,E[1].id)),this.isPlanB){const S=E[1];S.id=s._mediaStreamTrack.id,this.localTrackMap.set(E[0],S)}if(E[0]===Xe.LocalVideoTrack&&!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fn().supportDualStreamEncoding){const S=this.localTrackMap.get(Xe.LocalVideoLowTrack);if(S){const R=s._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new ht((P,D)=>{this.handleReplaceTrack(S.track,P,D,!0)})}}o()}catch(E){c(E)}finally{var y;(y=h)===null||y===void 0||y()}}),q(this,"handleGetRTCStats",s=>{s(this.statsCollector.getRTCStats())}),q(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),q(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),q(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),q(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new rH(this.store),this.bindStatsUploaderEvents(),this.mutex=new qs("P2PChannel-mutex",this.store.clientId),this.isPlanB=!Fn().supportUnifiedPlan||oe("CHROME_FORCE_PLAN_B")&&af(),this.shouldForwardP2PCreation=oe("FORWARD_P2P_CREATION")&&Fn().supportPCSetConfiguration&&Wx(),this.shouldForwardP2PCreation&&(this.connection=IP(this.store),this.emit(jt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var r;this.state=Xn.New,this._forceTurn=J9(e),x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const s=this.shouldForwardP2PCreation&&((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!s||(s&&this.connection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=IP(this.store,e),this.emit(jt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=oe("NEW_ICE_RESTART")?ff.FIRST_CONNECTION:ff.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");oe("ENABLE_PREALLOC_PC")&&this.state===Xn.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Xn.Connected)}updateRemoteRTPCapabilities(e){const r=Array.from(this.localTrackMap.entries()).filter(c=>{var u;let[h]=c;return ct(u=[Xe.LocalVideoLowTrack,Xe.LocalVideoTrack]).call(u,h)}),s=r.map(c=>{let[,{id:u}]=c;return u}),o=r.map(c=>{let[u]=c;return u});if(this.connection instanceof Dh){if(Nt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(o),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!ct(e).call(e,this.store.codec)){const c=["vp9","vp8","h264"].find(u=>ct(e).call(e,u));c&&(this.store.codec=c,x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(c,".")))}this.connection.updateRemoteRTPCapabilities(s,e)}}async getEstablishParams(){var e;if(this.connection instanceof Dh&&this.connection.peerConnectionState!=="closed"&&ct(e=[Xn.New,Xn.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==Xn.Connected){if(this.state===Xn.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(s=>{var o;ct(o=this.pendingLocalDataChannels).call(o,s)||this.pendingLocalDataChannels.push(s)}),[]}const r=this.filterTobePublishedDataChannels(e);return r.length===0?[]:(r.forEach(s=>{const o=Date.now();this.store.publish(s.id.toString(),"datachannel",o)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(s=>{this.localDataChannels.push(s);const o=Date.now();this.store.publish(s.id+"","datachannel",void 0,o)}),e.map(s=>({streamId:s.id,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:s.metadata,channelId:s._originDataChannelId})))}publish(e,r,s){var o=this;return Nl(function*(){const c=yield Dn(o.mutex.lock("From P2PChannel.publish"));try{var u;const h=o.connection&&ct(u=["disconnected","failed"]).call(u,o.connection.peerConnectionState);if(!o.connection||o.state!==Xn.Connected||h){if(o.state===Xn.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");o.throwIfTrackTypeNotMatch(e);const y=e.filter(E=>o.pendingLocalTracks.indexOf(E)===-1);return o.pendingLocalTracks=o.pendingLocalTracks.concat(y),void(h&&(o._isWaitPcToRePub=!0))}o.store.pubId=o.store.pubId+1,Js.markPublishStart(o.store.clientId,o.store.pubId);const m=o.filterTobePublishedTracks(e,r,s);if(m.length===0)return void(yield Dn(o.tryToUnmuteAudio(e)));yield*RA(aH(o.doPublish(o.connection,m)))}finally{c()}})()}doPublish(e,r){var s=this;return Nl(function*(){r.forEach(P=>{let{track:D,type:G}=P;const j=Date.now();s.store.publish(D.getTrackId(),G===Xe.LocalAudioTrack?"audio":"video",j)}),s.bindLocalTrackEvents(r);const o=r.map(P=>{let{track:D}=P;return D}),c=yield Dn(e.send(o,s.store.codec,s.store.audioCodec)),u=(yield Dn(c.next())).value,h=s.createGatewayPublishMessage(r,u);let m;try{m=yield h}catch(P){throw c.throw(P),(P==null?void 0:P.code)===te.WS_ABORT&&r.forEach(D=>{let{track:G}=D;s.pendingLocalTracks.indexOf(G)===-1&&s.pendingLocalTracks.push(G)}),s.unbindLocalTrackEvents(r),P}const y=s.mapPubResToRemoteConfig(h,m,o),E=(yield Dn(c.next(y))).value;if(s.state===Xn.Disconnected)throw new Le(te.UNEXPECTED_ERROR,"PeerConnection already disconnected.");oe("ENABLE_VIDEO_SEI");const S=oe("ENABLE_ENCODED_TRANSFORM"),R=oe("ENABLE_AUDIO_METADATA");o.forEach(async P=>{const D=P.getRTCRtpTransceiver();if(!D||!S)return;const{interceptLocalVideoFrame:G,interceptLocalAudioFrame:j}=vP();P.trackMediaType===bt.VIDEO?await G(D.sender,P):P.trackMediaType===bt.AUDIO&&await j(D.sender,{metadata:R?()=>{const B=P.metadata.shift();return B&&B.value}:void 0})}),r.forEach(P=>{let{type:D}=P;s.statsCollector.addLocalStats(D)}),s.assignLocalTracks(r,E),s.statsUploader.startUploadOutboundStats(),r.forEach(P=>{let{track:D,type:G}=P;const j=Date.now();s.store.publish(D.getTrackId(),G===Xe.LocalAudioTrack?"audio":"video",void 0,j)})})()}async updateVideoStreamParameter(e,r){const s=this.localTrackMap.get(r);if(!s||!this.connection)return;if(!(s.track instanceof Cr))return x.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:o}=s,c=function(u,h){const m={};return u.height&&u.width&&(m.scaleResolutionDownBy=zL(u,h)),m.maxFramerate=u.framerate?wc(u.framerate):void 0,m.maxBitrate=u.bitrate?1e3*u.bitrate:void 0,m}(e,o);if(o._encoderConfig||(o._encoderConfig={}),r!==Xe.LocalVideoLowTrack||!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fn().supportDualStreamEncoding)c.scaleResolutionDownBy!=null&&(o._encoderConfig.scaleResolutionDownBy=c.scaleResolutionDownBy);else{const u=o._originMediaStreamTrack;if(!u.canvas)return x.warn("[".concat(o.getTrackId(),"] no canvas on track"));(function(h,m){const y=h.canvas;m.width&&(y.width=wc(m.width)),m.height&&(y.height=wc(m.height)),m.framerate&&(y.stopCapture&&y.stopCapture(),y.stopCapture=_L(()=>{!y.startCapture&&y.stopCapture&&y.stopCapture(),y.startCapture&&y.startCapture()},wc(m.framerate)))})(u,e)}c.maxBitrate!=null&&(o._encoderConfig.bitrateMax=c.maxBitrate/1e3),c.maxFramerate!=null&&(o._encoderConfig.frameRate&&typeof o._encoderConfig.frameRate=="object"?o._encoderConfig.frameRate.max=c.maxFramerate:o._encoderConfig.frameRate={max:c.maxFramerate}),x.debug("[".concat(o.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(o._encoderConfig))),await this.connection.updateRtpSenderEncodings(o)}publishLowStream(e){var r=this;return Nl(function*(){if(!r.connection||r.state!==Xn.Connected)return;const s=yield Dn(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const c=r.localTrackMap.get(Xe.LocalVideoTrack);if(!c)throw new Le(te.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(Xe.LocalVideoLowTrack))throw new Le(te.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const u=[{track:r.getLowVideoTrack(c.track,e),type:Xe.LocalVideoLowTrack}];if(yield*RA(aH(r.doPublish(r.connection,u))),c.track.muted||!c.track.enabled){var o;const h=(o=r.localTrackMap.get(Xe.LocalVideoLowTrack))===null||o===void 0?void 0:o.id;h!==void 0&&(yield Dn(r.connection.muteLocal([h])))}}finally{s()}})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Os(this,jt.RequestRePublish,this.pendingLocalTracks),this.emit(jt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(x.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Os(this,jt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:s,kind:o}=this.pendingRemoteTracks[r];(o!==bt.AUDIO||s._audio_added_&&s._audioSSRC)&&(o!==bt.VIDEO||s._video_added_&&s._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(e)await Os(this,jt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:s}of this.pendingRemoteTracks)await this.subscribe(r,s,s===bt.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:s}=r;this.emit(jt.MediaReconnectEnd,s.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Xn.Connected)return void e.forEach(o=>{const c=this.pendingLocalTracks.indexOf(o);c!==-1&&this.pendingLocalTracks.splice(c,1)});const r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;const s=r.find(o=>o[0]==="videoLowTrack");return s&&s[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(e){if(!this.connection||this.state!==Xn.Connected)return void e.forEach(s=>{const o=this.pendingLocalDataChannels.indexOf(s);o!==-1&&this.pendingLocalDataChannels.splice(o,1)});const r=this.filterTobeUnpublishedDataChannels(e);return r.length!==0?(r.forEach(s=>{const o=this.localDataChannels.indexOf(s);o!==-1&&this.localDataChannels.splice(o,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(s=>s.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==Xn.Connected)return;const e=this.localTrackMap.get(Xe.LocalVideoLowTrack);if(!e)return;e.track.close();const r=[[Xe.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,r)}async doUnpublish(e,r){const s=this.createGatewayUnpublishMessage(r);return await e.stopSending(r.map(o=>{let[,{id:c}]=o;return c})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(o=>{let[c,{track:u}]=o;return{type:c,track:u}})),r.forEach(o=>{let[c]=o;this.statsCollector.removeLocalStats(c)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),s}async subscribeDataChannel(e,r){if(!this.connection||this.state!==Xn.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const s=r.filter(o=>{var c;return!((c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.get(o.id))});if(s.length!==0)return await this.connection.createDataChannels(e.uid,s),s.forEach(o=>{var c;this.remoteDataChannelMap.has(e)?(c=this.remoteDataChannelMap.get(e))===null||c===void 0||c.set(o.id,o):this.remoteDataChannelMap.set(e,new Map([[o.id,o]]));const u=this.pendingRemoteDataChannels.findIndex(h=>{let{user:m,id:y}=h;return m.uid===e.uid&&y===o.id});u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),s.map(o=>o.id)}async subscribe(e,r,s,o,c){var u;if(!this.connection||this.state!==Xn.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((u=this.remoteUserMap.get(e))!==null&&u!==void 0&&u.has(r))return;let h,m,y;const E=this.connection.getPreMedia(s);if(E)x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(s,", no need to send sub to gateway.")),y=E.transceiver,h=E.track,m=E.id;else if(c){const P=c.find(G=>{let{stream_type:j}=G;return j===r});if(!P)throw new Le(te.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const D=await this.connection.receive(r,P.ssrcs,String(e._uintid),P.attributes);this.connection instanceof Dh&&(y=D.transceiver),h=D.track,m=D.id}else{const P=await this.connection.receive(r,[{ssrcId:s,rtx:o}],String(e._uintid),void 0);this.connection instanceof Dh&&(y=P.transceiver),h=P.track,m=P.id}if(r===bt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(h):(e._audioTrack=new Zv(h,e.uid,e._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),y&&e._audioTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(h):(e._videoTrack=new Qv(h,e.uid,e._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),y&&e._videoTrack._updateRtpTransceiver(y),this.bindRemoteTrackEvents(e,e._videoTrack)),y&&oe("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:P,interceptRemoteAudioFrame:D}=vP();r==bt.VIDEO?await P(y.receiver,{onSei:oe("ENABLE_VIDEO_SEI")&&(G=>{var j;return(j=e._videoTrack)===null||j===void 0?void 0:j._onSei(G)})}):r==bt.AUDIO&&await D(y.receiver,{enableTopn:!!oe("ENABLE_AUDIO_TOPN"),enableMetadata:!!oe("ENABLE_AUDIO_METADATA"),onMetadata:G=>{this.safeEmit(jt.AudioMetadata,G)}})}const S=this.remoteUserMap.get(e);S?S.set(r,m):this.remoteUserMap.set(e,new Map([[r,m]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex(P=>{let{user:D,kind:G}=P;return D.uid===e.uid&&r===G});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(jt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Xn.Connected)throw new Le(te.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(c=>{var u;let{user:h,mediaType:m}=c;return!((u=this.remoteUserMap.get(h))!==null&&u!==void 0&&u.has(m))});const r=[],s=new Map;e.forEach(c=>{if(!this.connection)return;const u=this.connection.getPreMedia(c.ssrcId);u?s.set(c.ssrcId,u):r.push(c)});const o=await this.connection.batchReceive(r.map(c=>{let{user:u,mediaType:h,ssrcId:m,rtxSsrcId:y}=c;return{kind:h,ssrcMsg:[{ssrcId:m,rtx:y}],mslabel:String(u._uintid)}}));r.forEach((c,u)=>{s.set(c.ssrcId,o[u])});for(const{user:c,mediaType:u,ssrcId:h}of e){const m=s.get(h);if(!m)return void x.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(c.uid," subscribe data,").concat(u,", ").concat(h));const{track:y,id:E,transceiver:S}=m;if(S&&oe("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:G}=vP();u==bt.VIDEO?await D(S.receiver,{onSei:oe("ENABLE_VIDEO_SEI")&&(j=>{var B;return(B=c._videoTrack)===null||B===void 0?void 0:B._onSei(j)})}):u==bt.AUDIO&&await G(S.receiver,{enableTopn:!!oe("ENABLE_AUDIO_TOPN"),enableMetadata:!!oe("ENABLE_AUDIO_METADATA"),onMetadata:j=>{this.safeEmit(jt.AudioMetadata,j)}})}if(u===bt.AUDIO?(c._audioTrack?c._audioTrack._updateOriginMediaStreamTrack(y):(c._audioTrack=new Zv(y,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(c._audioTrack.getTrackId()))),S&&c._audioTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._audioTrack)):(c._videoTrack?c._videoTrack._updateOriginMediaStreamTrack(y):(c._videoTrack=new Qv(y,c.uid,c._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(c._videoTrack.getTrackId()))),S&&c._videoTrack._updateRtpTransceiver(S),this.bindRemoteTrackEvents(c,c._videoTrack)),oe("ENABLE_VIDEO_SEI")&&S){const{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:G}=vP();u==bt.VIDEO?await D(S.receiver,{onSei:j=>{var B;(B=c._videoTrack)===null||B===void 0||B._onSei(j)}}):u==bt.AUDIO&&await G(S.receiver)}const R=this.remoteUserMap.get(c);R?R.set(u,E):this.remoteUserMap.set(c,new Map([[u,E]])),this.statsCollector.addRemoteStats(c.uid),this.statsUploader.startUploadInboundStats();const P=this.pendingRemoteTracks.findIndex(D=>{let{user:G,kind:j}=D;return G.uid===c.uid&&u===j});P!==-1&&(this.pendingRemoteTracks.splice(P,1),this.emit(jt.MediaReconnectEnd,c.uid))}}async unsubscribe(e,r,s){const o=this.pendingRemoteTracks.filter(h=>{let{user:m,kind:y}=h;return r!==void 0?m.uid===e.uid&&r===y:m.uid===e.uid});if(o.forEach(h=>{const m=this.pendingRemoteTracks.indexOf(h);this.pendingRemoteTracks.splice(m,1)}),this.connection&&this.state===Xn.Connected||s||o.forEach(h=>{let{kind:m}=h;var y;if(m===bt.AUDIO)(y=e._audioTrack)===null||y===void 0||y._destroy(),e._audioTrack=void 0;else if(m===bt.VIDEO){var E;(E=e._videoTrack)===null||E===void 0||E._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Xn.Connected)return;const c=this.filterTobeUnSubscribedTracks(e,r);if(c.length===0)return;await this.connection.stopReceiving(c.map(h=>{let[,{id:m}]=h;return m}));const u=this.createUnsubscribeMessage(c);return this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),c.forEach(h=>{let[m,{kind:y}]=h;var E,S;if(y===bt.VIDEO&&m._videoSSRC&&((E=this.connection)===null||E===void 0||E.setStatsRemoteVideoIsReady(m._videoSSRC,!1)),y===bt.VIDEO)this.unbindRemoteTrackEvents(m._videoTrack),s||((S=m._videoTrack)===null||S===void 0||S._destroy(),m._videoTrack=void 0);else if(y===bt.AUDIO){var R;this.unbindRemoteTrackEvents(m._audioTrack),!s&&((R=m._audioTrack)===null||R===void 0||R._destroy(),m._audioTrack=void 0)}}),u}async unsubscribeDataChannel(e,r){if(r.forEach(c=>{const u=this.pendingRemoteDataChannels.findIndex(h=>h.id===c.id);u!==-1&&this.pendingRemoteDataChannels.splice(u,1)}),!this.connection)return;const s=this.filterTobeUnSubscribedDataChannels(e,r);if(s.length===0)return;r.forEach(c=>{c._close()});const o=this.remoteDataChannelMap.get(e);return s.forEach(c=>{o&&o.delete(c.id)}),o&&o.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),s.map(c=>c.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let r=[];for(const{user:c,mediaType:u}of e){const h=this.pendingRemoteTracks.filter(m=>{let{user:y,kind:E}=m;return u!==void 0?y.uid===c.uid&&u===E:y.uid===c.uid});h.forEach(m=>{const y=this.pendingRemoteTracks.indexOf(m);this.pendingRemoteTracks.splice(y,1)}),r=r.concat(h)}if(!this.connection||this.state!==Xn.Connected)return void r.forEach(c=>{let{user:u,kind:h}=c;var m;if(h===bt.AUDIO)(m=u._audioTrack)===null||m===void 0||m._destroy(),u._audioTrack=void 0;else if(h===bt.VIDEO){var y;(y=u._videoTrack)===null||y===void 0||y._destroy(),u._videoTrack=void 0}});const s=gc(e).call(e,(c,u)=>{let{user:h,mediaType:m}=u;const y=this.filterTobeUnSubscribedTracks(h,m);return c.concat(y)},[]);if(s.length===0)return;await this.connection.stopReceiving(s.map(c=>{let[,{id:u}]=c;return u}));const o=this.createUnsubscribeAllMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach(c=>{let[u,{kind:h}]=c;var m,y;if(h===bt.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===bt.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),(y=u._videoTrack)===null||y===void 0||y._destroy(),u._videoTrack=void 0;else if(h===bt.AUDIO){var E;this.unbindRemoteTrackEvents(u._audioTrack),(E=u._audioTrack)===null||E===void 0||E._destroy(),u._audioTrack=void 0}}),o}isPreSubScribe(e){return!this.connection||this.state!==Xn.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,r){if(!this.connection)return;const s=this.remoteUserMap.get(e);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));const o=r===bt.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.connection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.connection)return;const s=this.remoteUserMap.get(e);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}addAudioMetadata(e){const r=this.localTrackMap.get(Xe.LocalAudioTrack),s=r&&r.track;s&&s.metadata.push(e)}getAllTracks(e){const r=this.localTrackMap.get(Xe.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Mi){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Xe.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===Xe.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[o]=s;return!(e&&o===Xe.LocalVideoLowTrack)}).map(s=>{let[,{track:o}]=s;return o})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,r,s,o,c){if(e){const h=this.localTrackMap.get(Xe.LocalAudioTrack),m=o?this.localTrackMap.get(Xe.LocalVideoLowTrack):this.localTrackMap.get(Xe.LocalVideoTrack);Nt.publish(this.store.sessionId,{eventElapse:Js.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(fr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;s||(s=[]);const h=s.find(y=>y instanceof Xr),m=o?(u=this.localTrackMap.get(Xe.LocalVideoTrack))===null||u===void 0?void 0:u.track:s.find(y=>y instanceof Cr);Nt.publish(this.store.sessionId,{eventElapse:Js.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(fr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,r,s,o){const c=o===bt.VIDEO?s._videoSSRC:s._audioSSRC;c&&Nt.subscribe(this.store.sessionId,{succ:e,ec:r,video:o===bt.VIDEO,audio:o===bt.AUDIO,peerid:s.uid,subscribeRequestid:c,p2pid:this.store.p2pId,eventElapse:Js.measureFromSubscribeStart(this.store.clientId,c),preSsrc:this.isPreSubScribe(c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new qs("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=IP(this.store),this.emit(jt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Xe.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Mi){if(e.track.trackList.length>0){const r=e.track;e.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=Xn.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Xe.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Xe.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const r=this.localTrackMap.get(e);return r&&r.track instanceof Cr||r&&r.track instanceof Xr?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(e);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(e);return!!s&&(!r||s.has(r))}getRemoteMedia(e){var r;const s=Array.from(el(r=this.remoteUserMap).call(r)).find(o=>o.uid===e);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(s=>{let[o]=s;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Xe.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=oT(e).call(e,(s,o)=>s.level-o.level),e}async disconnectForReconnect(){this.connection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Xn.Reconnecting,oe("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=IP(this.store),this.emit(jt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[s,{track:o}]=e;switch(s){case Xe.LocalVideoTrack:ct(r=o._hints).call(r,fr.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Xe.LocalAudioTrack:o instanceof Mi?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Xe.LocalVideoLowTrack:}}),this.emit(jt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,s]=e;Array.from(el(s).call(s)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(jt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[r,s]=e;Array.from(el(s).call(s)).forEach(o=>{this.setPendingRemoteDataChannel(r,o)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,r){for(const s of this.pendingRemoteDataChannels){const{user:o,id:c}=s;if((e instanceof Jm?e.uid:e)===o.uid&&c===r)return!0}return!1}setPendingRemoteDataChannel(e,r){this.hasPendingRemoteDataChannel(e,r)||this.pendingRemoteDataChannels.push({user:e,id:r})}hasPendingRemoteMedia(e,r){for(const s of this.pendingRemoteTracks){const{user:o,kind:c}=s;if((e instanceof Jm?e.uid:e)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}restartICE(e){var r=this;return Nl(function*(){if(!r.connection||r.state!==Xn.Connected)return;const s=yield Dn(r.mutex.lock("From P2PChannel.restartICE"));let o;try{o=yield Dn(r.connection.restartICE(e));const u=yield Dn(o.next());if(u.done)return;const h=u.value,m=yield h;switch(s2(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),e){case Xs.UDP_TCP_RELAY:r._pcStatsUploadType=ff.UDP_TCP_RESTART;break;case Xs.TCP_RELAY:r._pcStatsUploadType=ff.TCP_RESTART;break;case Xs.RELAY:r._pcStatsUploadType=ff.RELAY_RESTART;break;default:r._pcStatsUploadType=ff.OLD_RESTART}r._isTryConnecting=!0,o.next(m)}catch(u){var c;(c=o)===null||c===void 0||c.throw(u)}finally{s()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),r=this.localTrackMap.get(Xe.LocalVideoTrack),s=this.localTrackMap.get(Xe.LocalAudioTrack),o=e.videoSend.find(D=>D.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),c=e.audioSend.find(D=>D.ssrc===(s==null?void 0:s.ssrcs[0].ssrcId));if(!o||!c)return 1;const u=Qc(this,jt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,y=h&&m?(h+m)/2:h||m,E=(y&&u?(y+u)/2:y||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*E/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(fr.SCREEN_TRACK)===-1){const D=P._encoderConfig.bitrateMax,G=e.bitrate.actualEncoded;if(D&&G){const j=(1e3*D-G)/(1e3*D);return BG[j<.15?0:j<.3?1:j<.45?2:j<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[o]=s;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(G=>G.ssrc===c),m=e.videoRecv.find(G=>G.ssrc===u);if(!h&&!m)return void(r+=1);const y=Qc(this,jt.NeedSignalRTT),E=e.rtt,S=(E&&y?(E+y)/2:E||y)||0,R=h?h.jitterMs:void 0,P=e.recvPacketLossRate;let D=.7*P*100/50+.3*S/1500;R&&(D=.6*P*100/50+.2*S/1500+.2*R/400),r+=D<.1?1:D<.17?2:D<.36?3:D<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new ht((r,s)=>{this.handleMuteLocalTrack(e,r,s)})}async replaceTrack(e,r){var s;if(x.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==Xn.Connected)return;const o=Array.from(this.localTrackMap.entries()).find(u=>{let[,{track:h}]=u;return e===h});if(!o)return;const c=o[0];if(e!==r&&(this.unbindLocalTrackEvents([{track:e,type:c}]),this.bindLocalTrackEvents([{track:r,type:c}]),o[1].track=r),await((s=this.connection)===null||s===void 0?void 0:s.replaceTrack(r,o[1].id)),this.isPlanB){const u=o[1];u.id=r._mediaStreamTrack.id,this.localTrackMap.set(c,u)}if(c===Xe.LocalVideoTrack&&!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fn().supportDualStreamEncoding){const u=this.localTrackMap.get(Xe.LocalVideoLowTrack);if(u){const h=e._mediaStreamTrack.clone();u.track._originMediaStreamTrack.stop(),u.track._mediaStreamTrack=h,u.track._originMediaStreamTrack=h,await new ht((m,y)=>{this.handleReplaceTrack(u.track,m,y,!0)})}}}filterTobePublishedTracks(e,r,s){const o=[],c=this.getAllTracks();e=jv(e=e.filter(y=>c.indexOf(y)===-1));let u,h=!1;const m=this.localTrackMap.get(Xe.LocalAudioTrack);for(const y of e){if(y instanceof Cr&&(this.localTrackMap.has(Xe.LocalVideoTrack)||h?new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:y,type:Xe.LocalVideoTrack}),h=!0),r)){const E=this.getLowVideoTrack(y,s);o.push({track:E,type:Xe.LocalVideoLowTrack})}if(y instanceof Xr)if(m){const E=m.track;if(E instanceof Mi)r2([y]),E.addAudioTrack(y),this.bindLocalAudioTrackEvents(y,!0);else{const S=i2([E,y]);x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(S.getTrackId(),"]")),this.replaceTrack(E,S)}}else u instanceof Mi?(r2([y]),u.addAudioTrack(y)):u||!y._useAudioElement&&Fn().webAudioMediaStreamDest&&!y._bypassWebAudio?u=i2(u?[y,u]:[y]):u=y}return u&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(u.getTrackId(),"]")),o.push({track:u,type:Xe.LocalAudioTrack})),o}filterTobeUnpublishedTracks(e){const r=[],s=this.getAllTracks();e=jv(e=e.filter(o=>s.indexOf(o)!==-1));for(const o of e){if(o instanceof Xr){const c=this.localTrackMap.get(Xe.LocalAudioTrack);if(!c)continue;c.track instanceof Mi?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([Xe.LocalAudioTrack,c]),c.track.close())):r.push([Xe.LocalAudioTrack,c])}if(o instanceof Cr){const c=this.localTrackMap.get(Xe.LocalVideoTrack);if(!c)continue;r.push([Xe.LocalVideoTrack,c]);const u=this.localTrackMap.get(Xe.LocalVideoLowTrack);u&&r.push([Xe.LocalVideoLowTrack,u])}}return r}filterTobePublishedDataChannels(e){return e=(e=jv(e)).filter(r=>this.localDataChannels.findIndex(s=>s.id===r.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=jv(e)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(e){e.forEach(r=>{let{track:s,type:o}=r;switch(o){case Xe.LocalVideoTrack:s.addListener(Rt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Rt.GET_RTC_STATS,this.handleGetRTCStats),s.addListener(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Rt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Rt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Xe.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Xe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof Mi?e.trackList.forEach(s=>{s.addListener(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Rt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Rt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(e.addListener(Rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(Rt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:o}]=r;return{track:o,type:s}})),e.forEach(r=>{let{track:s,type:o}=r;switch(o){case Xe.LocalVideoTrack:s.off(Rt.GET_STATS,this.handleGetLocalVideoStats),s.off(Rt.GET_RTC_STATS,this.handleGetRTCStats),s.off(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Rt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Rt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Xe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Xe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Mi?e.trackList.forEach(r=>{r.off(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Rt.GET_STATS,this.handleGetLocalAudioStats),r.off(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Rt.GET_STATS,this.handleGetLocalAudioStats),e.off(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Rt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof Qv&&r.addListener(Rt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(e))}),r instanceof Zv&&r.addListener(Rt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Rt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,s]=e;s.has(bt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(bt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((s,o)=>{var c;let u,h,{track:m,type:y}=s;switch(y){case Xe.LocalAudioTrack:u=Qn.Audio,h={dtx:m instanceof ZA&&m._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Xe.LocalVideoTrack:u=ct(c=m._hints).call(c,fr.SCREEN_TRACK)?Qn.Screen:Qn.High,h=Lh(Lh({},s9(m)),{},{codec:this.store.codec,svc_mode:mP()});break;case Xe.LocalVideoLowTrack:u=Qn.Low,h=Lh(Lh({},s9(m)),{},{codec:this.store.codec,svc_mode:mP()})}return{stream_type:u,attributes:h,ssrcs:r[o]}})}createGatewayUnpublishMessage(e){return e.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalVideoTrack:o=ct(s=u._hints).call(s,fr.SCREEN_TRACK)?Qn.Screen:Qn.High;break;case Xe.LocalAudioTrack:o=Qn.Audio;break;case Xe.LocalVideoLowTrack:o=Qn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,r){e.forEach((s,o)=>{let{track:c,type:u}=s;this.localTrackMap.set(u,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{if(x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(jt.PeerConnectionStateChange,r),r==="connecting"&&e instanceof Dh&&!Wr()&&oe("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&e.extendCandidate()},oe("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Dh&&iH(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=ff.DISCONNECTED_OR_FAILED,Qc(this,jt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const s=this.pendingLocalTracks.map(c=>c.getTrackId()),o=this.pendingLocalDataChannels.map(c=>"dc_".concat(c.id));Nt.reportApiInvoke(this.store.sessionId,{name:Ai.REPUB_AFTER_PC_CONNECTED,options:s.concat(o),tag:Hr.TRACER}).onSuccess(),this.republish()}if(oe("NEW_ICE_RESTART")&&e instanceof Dh&&!Wr()&&!this._forceTurn){if(ct(QG).call(QG,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const s=c=>{s2(e)&&(x.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(c)),Qc(this,jt.QueryClientConnectionState)==="CONNECTED"&&this.emit(jt.RequestRestartICE,c))},o=()=>{s2(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),x.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(jt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{sH(e,s,o)},800))}}else{if(r==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&oe("ICE_RESTART")&&Qc(this,jt.QueryClientConnectionState)==="CONNECTED"&&this.emit(jt.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(jt.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(x.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(jt.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),Nt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Hr.TRACER}).onSuccess(),this.emit(jt.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var s;const o=Array.from(el(s=this.remoteUserMap).call(s)).find(u=>u._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(Kv.FIRST_FRAME_DECODED),Nt.firstRemoteFrame(this.store.sessionId,Xi.FIRST_AUDIO_DECODE,Lr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Js.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var s;const o=Array.from(el(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);o&&Nt.firstRemoteFrame(this.store.sessionId,Xi.FIRST_AUDIO_RECEIVED,Lr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Js.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,s,o)=>{this.reportVideoFirstFrameDecoded(r,s,o)},e.onFirstVideoReceived=r=>{var s;const o=Array.from(el(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);o&&Nt.firstRemoteFrame(this.store.sessionId,Xi.FIRST_VIDEO_RECEIVED,Lr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Js.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(r,s)=>{const o=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&o===c||this.emit(jt.ConnectionTypeChange,o),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(qm(s))," -> ").concat(JSON.stringify(qm(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(qm(s))," -> ").concat(JSON.stringify(qm(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),s=this.statsCollector.getRTCStats();return Lh(Lh({},r),s)},e.onICECandidateError=r=>{this._iceError=r}}resetConnection(e){e instanceof Dh&&function(r){hS.delete(r.id),iH(r)}(e),e.close(),this.emit(jt.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const r=[];if(this.getAllTracks().indexOf(e)===-1)return r;const s=this.localTrackMap.get(Xe.LocalAudioTrack);if(e instanceof Xr&&(s==null?void 0:s.track)instanceof Mi)return s.track.isActive||r.push([Xe.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(r.push(o),o[0]===Xe.LocalVideoTrack)){const c=this.localTrackMap.get(Xe.LocalVideoLowTrack);c&&r.push([Xe.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(e){const r=[],s=this.localTrackMap.get(Xe.LocalAudioTrack);if(e instanceof Xr&&(s==null?void 0:s.track)instanceof Mi)return s.track.isActive&&r.push([Xe.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===Xe.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get(Xe.LocalVideoLowTrack);c&&r.push([Xe.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(e){return e.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalAudioTrack:o=Qn.Audio;break;case Xe.LocalVideoTrack:o=ct(s=u._hints).call(s,fr.SCREEN_TRACK)?Qn.Screen:Qn.High;break;case Xe.LocalVideoLowTrack:o=Qn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalAudioTrack:o=Qn.Audio;break;case Xe.LocalVideoTrack:o=ct(s=u._hints).call(s,fr.SCREEN_TRACK)?Qn.Screen:Qn.High;break;case Xe.LocalVideoLowTrack:o=Qn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,r){const s=[],o=this.remoteUserMap.get(e);if(!o)return s;if(r){const c=o.get(r);if(!c)return s;s.push([e,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;s.push([e,{kind:u,id:h}])});return s}filterTobeUnSubscribedDataChannels(e,r){const s=[];return r.forEach(o=>{var c;(c=this.remoteDataChannelMap.get(e))!==null&&c!==void 0&&c.has(o.id)&&s.push(o)}),s}createUnsubscribeMessage(e){const r=[];return e.forEach(s=>{let[o,{kind:c,id:u}]=s;switch(c){case bt.VIDEO:return void(o._videoSSRC&&r.push({stream_type:bt.VIDEO,ssrcId:o._videoSSRC}));case bt.AUDIO:return void(o._audioSSRC&&r.push({stream_type:bt.AUDIO,ssrcId:o._audioSSRC}))}}),r}createUnsubscribeAllMessage(e){const r=new Map;return e.forEach(s=>{let[o,{kind:c}]=s;if(r.has(o)){let u=r.get(o);c===bt.VIDEO?u|=Ji.Video:u|=Ji.Audio,r.set(o,u)}else c===bt.VIDEO?r.set(o,Ji.Video):r.set(o,Ji.Audio)}),{users:Array.from(r.entries()).map(s=>{let[o,c]=s;return{stream_id:o.uid,stream_type:c}})}}withdrawRemoteTracks(e){e.forEach(r=>{let[s,{kind:o}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(e){const r=this.localTrackMap.get(Xe.LocalVideoTrack),s=this.localTrackMap.get(Xe.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(e.uplink),await new ht((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),s&&e.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new ht((o,c)=>{this.handleUpdateVideoEncoder(s.track,o,c,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,r,s){return e.map((o,c)=>{var u;let{stream_type:h}=o;const m=(u=r.find(y=>{let{stream_type:E}=y;return h===E}))===null||u===void 0?void 0:u.attributes;if(m&&oe("DISABLE_SCREEN_SHARE_REMB")){const y=s[c]._hints;(ct(y).call(y,fr.SCREEN_TRACK)||ct(y).call(y,fr.SCREEN_LOW_TRACK))&&(m.remb=!1,x.debug("disable remb for screen share, hints:",y))}return m})}async tryToUnmuteAudio(e){for(let s=0;s<e.length;s++)if(e[s]instanceof Xr){var r;const o=this.filterTobeUnmutedTracks(e[s]);if(o.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(o.map(u=>{let[,{id:h}]=u;return h})));const c=this.createUnmuteMessage(o);return void await hr(this,jt.RequestUnmuteLocal,c)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(jt.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(jt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ps(Jx(this.dtlsFailedCount,Pi)),this.emit(jt.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),r.length>0&&await Os(this,jt.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(jt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Xe.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Cr)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof Cr).length>1)throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof Xr).length>1&&(e.some(r=>r instanceof Xr&&r._bypassWebAudio)||!Fn().webAudioMediaStreamDest))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of e){if(r instanceof Cr&&this.pendingLocalTracks.some(s=>s instanceof Cr))throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Xr&&this.pendingLocalTracks.some(s=>s instanceof Xr)&&(!Fn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof Xr&&s._bypassWebAudio)))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){var s;const o=!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fn().supportDualStreamEncoding,c=Lh(Lh({},{width:160,height:120,framerate:15,bitrate:50}),r);let u;u=o?e._mediaStreamTrack.clone():o2(e,c);const h=pr(8,"track-low-"),m=new Cr(u,Lh(Lh({},o&&{scaleResolutionDownBy:zL(c,e)}),{},{frameRate:c.framerate,bitrateMax:c.bitrate,bitrateMin:c.bitrate}),void 0,void 0,h);return m.on(G_.TRANSCEIVER_UPDATED,y=>{e._updateRtpTransceiver(y,Hv.LOW_STREAM)}),m._hints.push(fr.LOW_STREAM),ct(s=e._hints).call(s,fr.SCREEN_TRACK)&&m._hints.push(fr.SCREEN_LOW_TRACK),e.on("sei-to-send",y=>{m.emit("sei-to-send",y)}),e.addListener(Rt.NEED_CLOSE,()=>{m.close()}),m}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,r,s){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Dh){var c,u,h,m;const y=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:E,dtlsTransportState:S,peerConnectionState:R}=this.connection,{local:P,remote:D}=await this.connection.getSelectedCandidatePair();Nt.pcStats(this.store.sessionId,{startTime:y,eventElapse:e-y||0,iceconnectionsate:E,dtlsstate:S,connectionstate:R,intSucc:r?1:2,error:this._iceError||o||"",selectedLocalCandidateProtocol:(c=P==null?void 0:P.protocol)!==null&&c!==void 0?c:"",selectedLocalCandidateType:(u=P.candidateType)!==null&&u!==void 0?u:"",selectedLocalCandidateAddress:"".concat(P.address,":").concat(P.port),selectedRemoteCandidateProtocol:(h=D.protocol)!==null&&h!==void 0?h:"",selectedRemoteCandidateType:(m=D.candidateType)!==null&&m!==void 0?m:"",selectedRemoteCandidateAddress:"".concat(D.address,":").concat(D.port),restartCnt:s,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,r,s,o){var c;const u=Array.from(el(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(y=>y.userId===u.uid&&y.type==="video");Nt.firstRemoteVideoDecode(this.store.sessionId,Xi.FIRST_VIDEO_DECODE,Lr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:s,subscribeElapse:Js.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0,firstFrame:(m==null?void 0:m.firstFrame)||0})}}async remoteMediaSsrcChanged(e,r,s){if(!this.connection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(r);if(!c)return!1;const u=await this.connection.getRemoteSSRC(c);return u!==void 0&&u!==s}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:s}]=e;r===Xe.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,Hv.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},It(yn.prototype,"startP2PConnection",[Io],Object.getOwnPropertyDescriptor(yn.prototype,"startP2PConnection"),yn.prototype),It(yn.prototype,"connect",[Io],Object.getOwnPropertyDescriptor(yn.prototype,"connect"),yn.prototype),It(yn.prototype,"updateRemoteRTPCapabilities",[Io],Object.getOwnPropertyDescriptor(yn.prototype,"updateRemoteRTPCapabilities"),yn.prototype),It(yn.prototype,"publishDataChannel",[Io],Object.getOwnPropertyDescriptor(yn.prototype,"publishDataChannel"),yn.prototype),It(yn.prototype,"unpublish",[Io],Object.getOwnPropertyDescriptor(yn.prototype,"unpublish"),yn.prototype),It(yn.prototype,"unpublishDataChannel",[Io],Object.getOwnPropertyDescriptor(yn.prototype,"unpublishDataChannel"),yn.prototype),It(yn.prototype,"unpublishLowStream",[Io],Object.getOwnPropertyDescriptor(yn.prototype,"unpublishLowStream"),yn.prototype),It(yn.prototype,"subscribeDataChannel",[Io],Object.getOwnPropertyDescriptor(yn.prototype,"subscribeDataChannel"),yn.prototype),It(yn.prototype,"subscribe",[Io],Object.getOwnPropertyDescriptor(yn.prototype,"subscribe"),yn.prototype),It(yn.prototype,"massSubscribe",[Io],Object.getOwnPropertyDescriptor(yn.prototype,"massSubscribe"),yn.prototype),It(yn.prototype,"unsubscribe",[Io],Object.getOwnPropertyDescriptor(yn.prototype,"unsubscribe"),yn.prototype),It(yn.prototype,"unsubscribeDataChannel",[Io],Object.getOwnPropertyDescriptor(yn.prototype,"unsubscribeDataChannel"),yn.prototype),It(yn.prototype,"massUnsubscribe",[Io],Object.getOwnPropertyDescriptor(yn.prototype,"massUnsubscribe"),yn.prototype),It(yn.prototype,"muteRemote",[Io],Object.getOwnPropertyDescriptor(yn.prototype,"muteRemote"),yn.prototype),It(yn.prototype,"unmuteRemote",[Io],Object.getOwnPropertyDescriptor(yn.prototype,"unmuteRemote"),yn.prototype),It(yn.prototype,"hasRemoteMediaWithLock",[Io],Object.getOwnPropertyDescriptor(yn.prototype,"hasRemoteMediaWithLock"),yn.prototype),It(yn.prototype,"disconnectForReconnect",[Io],Object.getOwnPropertyDescriptor(yn.prototype,"disconnectForReconnect"),yn.prototype),It(yn.prototype,"updateBitrateLimit",[Io],Object.getOwnPropertyDescriptor(yn.prototype,"updateBitrateLimit"),yn.prototype),It(yn.prototype,"remoteMediaSsrcChanged",[Io],Object.getOwnPropertyDescriptor(yn.prototype,"remoteMediaSsrcChanged"),yn.prototype),yn);function Io(e,r,s){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PChannel.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await o.apply(this,m)}finally{u()}},s}function cH(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function lH(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?cH(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):cH(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}const lge=Date.now(),uge=20,c2=new Map,DP=new Map;async function uH(e){const r=c2.get(e),s=Array.isArray(r)&&r[r.length-1],o=DP.get(e);if(!s)return void(o.isSyncing=!1);const c={uid:s.uid,payload:s.payload};o.firstRecvTs===0&&(o.firstRecvTs=s.recvTs,o.firstSendTs=s.sendTs);const u=s.sendTs-o.firstSendTs,h=u-(Date.now()-o.firstRecvTs);h>0&&(o.firstRecvTs=Date.now()-u);let m=s.mediaDelay+h;m<=0?(r.pop(),dH(s.context,c),m=0):m=Math.min(m,uge),setTimeout(()=>r.length&&uH(e),m)}function dH(e,r){e.safeEmit(Tn.STREAM_MESSAGE,r.uid,r.payload),e.onStreamMessage&&e.onStreamMessage(r)}function dge(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return dH(s,{uid:e.uid,payload:e.payload});const o="".concat(s.id,"-").concat(e.uid),c=c2.get(o)||[],u=c.findIndex(E=>e.sendTs>=E.sendTs),h=lH(lH({},e),{},{context:s,mediaDelay:r,recvTs:Date.now()});u===-1?c.push(h):c.splice(u,0,h),c2.set(o,c);let m=!1;var y;DP.has(o)?m=!((y=DP.get(o))===null||y===void 0||!y.isSyncing):DP.set(o,{isSyncing:m,firstRecvTs:0,firstSendTs:0}),m||uH(o)}const hge=xn().name;function hH(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function pH(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?hH(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):hH(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}const pS="websdk_ng_cache_parameter",pge=oe("MAX_PRELOAD_ASYNC_LENGTH"),fge=1e4,ry=new Map,iy=[];let l2=null,u2=0,d2=0;const xP=new Map,mge=function(e,r){const s=[];let o=0;const c=async()=>{const u=s.shift();u&&await u(),s.length>0&&o<r?c():o--};return async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return new ht(async(y,E)=>{s.push(async()=>{try{const S=await e(...h);y(S)}catch(S){E(S)}}),o<r&&(o++,c())})}}(fH,pge),h2=_a.CancelToken.source();async function fH(e,r,s,o,c,u){try{if(!oe("ENABLE_PRELOAD"))return;if(!Fn().supportWebCrypto)return void zm(()=>{x.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!s&&s!==null)throw new Le(te.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&hs(s,"token",1,2047),hs(e,"appid",1,2047),uP(r),o&&dP(o);const h=z_();x.debug("preload channel ".concat(r,", uid is ").concat(o));const m={appId:e,cname:r,token:s||e,uid:typeof o!="string"?o:null,sid:h,proxyServer:c};let y,E;typeof o=="string"?(m.stringUid=o,[E,y]=await ht.all([Jme(o,{sid:h,appId:e},h2.token),M9(pH(pH({},m),{},{token:s||e,uid:0}),h2.token)]),m.uid=E.uid,y.gatewayInfo.uid=m.uid,y.gatewayInfo.res.uid=m.uid):(u&&(m.stringUid=u),y=await M9(m,h2.token));const S={sid:h,appId:e,cname:r,token:s||e,uid:m.stringUid||o,intUid:m.uid||y.gatewayInfo.uid,stringUid:m.stringUid,ts:Date.now(),sua:E,ap:y};await async function(R){let P;try{R.uid&&gH({appId:R.appId,cname:R.cname,token:R.token,uid:R.uid,stringUid:R.stringUid});const D=vH(R),G=await async function(B,Y){try{const ee=await window.crypto.subtle.importKey("raw",oW(Y),"AES-GCM",!1,["encrypt"]),fe=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},ee,B_(window.btoa(JSON.stringify(B))));return Wm(new Uint8Array(fe))}catch{return}}(R,R.token||R.appId);if(!G)return;P=EH(pS);const j=P?JSON.parse(P):[];j.push({[D]:G}),j.length>oe("AP_CACHE_NUM")&&j.shift(),LP(pS,JSON.stringify(j))}catch(D){x.warn("Error caching server parameters:",D.message),LP(pS,"")}}(S),u2++}catch(h){throw d2++,function(m){l2||(l2=window.setTimeout(()=>{let E="";xP.forEach((S,R)=>{E+="".concat(R,": ").concat(S," ;")}),Nt.reportApiInvoke(null,{name:Ai.PRELOAD,options:{success:u2,failed:d2,err:E}}).onError(m),u2=0,d2=0,xP.clear(),l2=null},fge));const y=xP.get(m.code)||0;xP.set(m.code,y+1)}(h),h}}async function mH(e){try{if(oe("AP_REQUEST_DETAIL")||oe("ENABLE_ROLE_SELECT_EDGE"))return;const r=gH(e);if(!r||e.cloudProxyServer!=="disabled")return;const s=await async function(o,c){try{const u=await window.crypto.subtle.importKey("raw",oW(c),"AES-GCM",!1,["decrypt"]),h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},u,B_(o));return JSON.parse(window.atob(Wm(new Uint8Array(h))))}catch{return}}(r,e.token||e.appId);if(!s||!function(o,c){return o.cname===c.cname&&o.appId===c.appId&&o.token===c.token?c.stringUid?o.stringUid===c.stringUid:typeof c.uid=="number"?o.uid===c.uid:o.uid==c.uid:!1}(s,e))return;if(s&&Date.now()-s.ts<oe("AP_CACHE_LIFETIME"))return s}catch(r){x.warn("Error get preloadInfo",r.message)}}function gH(e){let r;try{if(r=EH(pS),!r)return;const s=JSON.parse(r),o=vH(e),c=function(h,m){for(let y=h.length-1;y>=0;y--)if(m(h[y]))return y;return-1}(s,h=>o in h);if(c===-1)return;const u=s.splice(c,1)[0];return LP(pS,JSON.stringify(s)),u[o]}catch(s){x.warn("Error delete preload info: ".concat(r),s.message),LP(pS,"")}}function p2(e){if(e){let r=ry.get(e);r&&(window.clearTimeout(r),r=null,ry.delete(e)),ct(iy).call(iy,e)||e.cloudProxyServer!=="disabled"||iy.push(e)}if(ry.size<oe("AP_CACHE_NUM")&&iy.length>0){const r=iy.shift();ry.set(r,window.setTimeout(async()=>{const{appId:s,cname:o,token:c,stringUid:u,uid:h,proxyServer:m}=r;try{await mge(s,o,c,h,m,u),ry.has(r)&&p2(r)}catch(y){x.warn("update preload failed",y.message),_H(r)}},oe("AP_UPDATE_INTERVAL")))}}function _H(e){const r=iy.indexOf(e);r!==-1&&iy.splice(r,1);let s=ry.get(e);s&&(window.clearTimeout(s),s=null,ry.delete(e),p2())}function yH(e,r){const s=e.sua,o=e.ap;r&&s&&Nt.reqUserAccount(e.sid,{lts:s.requestTime,elapse:s.elapse,success:!0,serverAddr:s.url,stringUid:r,uid:e.intUid,errorCode:null,extend:s.req}),Nt.reportResourceTiming(e.ap.url,e.sid),Nt.joinWebProxyAP(e.sid,{lts:o.requestTime,elapse:o.elapse,sucess:1,apServerAddr:o.url,turnServerAddrList:o.proxyInfo.addresses.map(c=>c.ip).join(","),eventType:"disabled",unilbsServerIds:[Ei.CHOOSE_SERVER,Ei.CLOUD_PROXY_FALLBACK].toString()}),Nt.joinChooseServer(e.sid,{lts:o.requestTime,elapse:o.elapse,succ:!0,csAddr:o.url,opid:o.opid,serverList:o.gatewayInfo.gatewayAddrs.map(c=>c.address),ec:null,cid:o.gatewayInfo.cid.toString(),uid:o.gatewayInfo.uid.toString(),csIp:o.gatewayInfo.csIp,unilbsServerIds:[Ei.CHOOSE_SERVER].toString(),isHttp3:o.isHttp3})}function EH(e){return window.atob(window.localStorage.getItem(e)||"")}function LP(e,r){window.localStorage.setItem(e,window.btoa(r))}function vH(e){let r="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(r+="_s_".concat(e.uid)),typeof e.uid=="number"&&(r+="_".concat(e.uid)),e.token&&(r+="_".concat(e.token)),pW(r)}function gge(e){let r=function(){const s=Ege.pop();return s?(s.offset=s.limit=0,s):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(s,o){let c=s.appId;c!==void 0&&(bi(o,10),Zm(o,c));let u=s.cid;u!==void 0&&(bi(o,16),bi(o,u));let h=s.cname;h!==void 0&&(bi(o,26),Zm(o,h));let m=s.deviceId;m!==void 0&&(bi(o,34),Zm(o,m));let y=s.elapse;y!==void 0&&(bi(o,40),eg(o,y));let E=s.fileSize;E!==void 0&&(bi(o,48),eg(o,fS(E)));let S=s.height;S!==void 0&&(bi(o,56),eg(o,fS(S)));let R=s.jpg;R!==void 0&&(bi(o,66),bi(o,R.length),bH(o,R));let P=s.networkType;P!==void 0&&(bi(o,72),eg(o,fS(P)));let D=s.osType;D!==void 0&&(bi(o,80),eg(o,fS(D)));let G=s.requestId;G!==void 0&&(bi(o,90),Zm(o,G));let j=s.sdkVersion;j!==void 0&&(bi(o,98),Zm(o,j));let B=s.sequence;B!==void 0&&(bi(o,104),eg(o,fS(B)));let Y=s.sid;Y!==void 0&&(bi(o,114),Zm(o,Y));let ee=s.timestamp;ee!==void 0&&(bi(o,120),eg(o,ee));let fe=s.uid;fe!==void 0&&(bi(o,128),bi(o,fe));let ye=s.vid;ye!==void 0&&(bi(o,136),bi(o,ye));let Ee=s.width;Ee!==void 0&&(bi(o,144),eg(o,fS(Ee)));let _e=s.service;_e!==void 0&&(bi(o,152),bi(o,_e));let Ne=s.callbackData;Ne!==void 0&&(bi(o,162),bi(o,Ne.length),bH(o,Ne));let Ze=s.ticket;Ze!==void 0&&(bi(o,170),Zm(o,Ze));let pt=s.vendorConfigs;pt!==void 0&&(bi(o,178),Zm(o,pt))}(e,r),function(s){let o=s.bytes,c=s.limit;return o.length===c?o:o.subarray(0,c)}(r)}function _ge(e){return function(s){let o={};e:for(;!vge(s);){let c=WT(s);switch(c>>>3){case 0:break e;case 1:o.code=WT(s);break;case 2:o.msg=TH(s,WT(s));break;case 3:o.requestId=TH(s,WT(s));break;case 4:o.timestamp=Sge(s,!1);break;default:yge(s,7&c)}}return o}({bytes:r=e,offset:0,limit:r.length});var r}function yge(e,r){switch(r){case 0:for(;128&ku(e););break;case 2:f2(e,WT(e));break;case 5:f2(e,4);break;case 1:f2(e,8);break;default:throw new Error("Unimplemented type: "+r)}}function fS(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let Ege=[];function f2(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function vge(e){return e.offset>=e.limit}function MP(e,r){let s=e.bytes,o=e.offset,c=e.limit,u=o+r;if(u>s.length){let h=new Uint8Array(2*u);h.set(s),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function SH(e,r){let s=e.offset;if(s+r>e.limit)throw new Error("Read past limit");return e.offset+=r,s}function bH(e,r){let s=MP(e,r.length);e.bytes.set(r,s)}function TH(e,r){let s=SH(e,r),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<r;m++){let y,E,S,R,P=c[m+s];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=u:(y=c[m+s+1],(192&y)!=128?h+=u:(R=(31&P)<<6|63&y,R<128?h+=u:(h+=o(R),m++))):(240&P)==224?m+2>=r?h+=u:(y=c[m+s+1],E=c[m+s+2],(49344&(y|E<<8))!=32896?h+=u:(R=(15&P)<<12|(63&y)<<6|63&E,R<2048||R>=55296&&R<=57343?h+=u:(h+=o(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(y=c[m+s+1],E=c[m+s+2],S=c[m+s+3],(12632256&(y|E<<8|S<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&y)<<12|(63&E)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function Zm(e,r){let s=r.length,o=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}bi(e,o);let c=MP(e,o),u=e.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function ku(e){return e.bytes[SH(e,1)]}function wH(e,r){let s=MP(e,1);e.bytes[s]=r}function WT(e){let r,s=0,o=0;do r=ku(e),s<32&&(o|=(127&r)<<s),s+=7;while(128&r);return o}function bi(e,r){for(r>>>=0;r>=128;)wH(e,127&r|128),r>>>=7;wH(e,r)}function Sge(e,r){let s,o=0,c=0,u=0;return s=ku(e),o=127&s,128&s&&(s=ku(e),o|=(127&s)<<7,128&s&&(s=ku(e),o|=(127&s)<<14,128&s&&(s=ku(e),o|=(127&s)<<21,128&s&&(s=ku(e),c=127&s,128&s&&(s=ku(e),c|=(127&s)<<7,128&s&&(s=ku(e),c|=(127&s)<<14,128&s&&(s=ku(e),c|=(127&s)<<21,128&s&&(s=ku(e),u=127&s,128&s&&(s=ku(e),u|=(127&s)<<7))))))))),{low:o|c<<28,high:c>>>4|u<<24,unsigned:r}}function eg(e,r){let s=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?o===0?s<16384?s<128?1:2:s<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=MP(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=u!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=u!==2?s>>>7|128:s>>>7&127;case 1:m[h]=u!==1?128|s:127&s}}const CH={},RH={},UP=4294967296,bge=UP*UP,Tge=bge/2;AH(0,!0);const IH=AH(0),wge=GT(0,-2147483648,!1),Cge=GT(-1,2147483647,!1);function AH(e,r){let s,o,c;return r?(c=0<=(e>>>=0)&&e<256)&&(o=RH[e],o)?o:(s=GT(e,0,!0),c&&(RH[e]=s),s):(c=-128<=(e|=0)&&e<128)&&(o=CH[e],o)?o:(s=GT(e,e<0?-1:0,!1),c&&(CH[e]=s),s)}function GT(e,r,s){return{low:0|e,high:0|r,unsigned:!!s}}function PH(e,r){if(isNaN(e))return IH;{if(e<=-9223372036854776e3)return wge;if(e+1>=Tge)return Cge}return e<0?IH:GT(e%UP|0,e/UP|0,r)}function OH(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}class m2 extends jr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(Od.CONNECTION_STATE_CHANGE,r,s)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var s;super(),q(this,"name","AgoraRTCImageModeration"),q(this,"_connectionState",Ml.CONNECTING),q(this,"_sequence",0),q(this,"_moderationStartTime",void 0),q(this,"_workerConnection",void 0),q(this,"_workerMessageLengthLimit",void 0),q(this,"_qualityRatio",void 0),q(this,"_connectInfo",void 0),q(this,"_cancelTokenSource",_a.CancelToken.source()),q(this,"_retryConfig",void 0),q(this,"_moderationInterval",void 0),q(this,"_moderationTimer",null),q(this,"_moderationMode",1),q(this,"_quality",1),q(this,"_qualityTimer",null),q(this,"_ticket",void 0),q(this,"_moderationIntervalMinimum",void 0),q(this,"_uploadFailedNum",0),q(this,"_uploadNum",0),q(this,"_uploadTimer",null),q(this,"_extraInfo",void 0),q(this,"_vendor",""),q(this,"_encoder",new TextEncoder),q(this,"_moderationId",void 0),q(this,"inspectImage",()=>{if(this.connectionState!==Ml.CONNECTED)throw new Ae(te.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Ml.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=pr(5,"image-moderation-"),this._workerMessageLengthLimit=oe("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=oe("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=oe("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new DT("worker-"+this._moderationId,Pi),this.on(Od.STATE_CHANGE,(o,c)=>{x.debug("[".concat(this._moderationId,"] Moderation operation :").concat(rS[o]," ").concat(c||""))}),this.handleWorkerEvents()}async init(r,s){this.emit(Od.STATE_CHANGE,rS.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=s,new ht((c,u)=>{this.on(Od.CONNECTION_STATE_CHANGE,(h,m)=>{h===Ml.CONNECTED&&c()}),this.requestAP(r,o,s).then(h=>{this.connectWorker(h)}).catch(h=>{u(h)})})}updateConfig(r){var s;this._moderationInterval=(s=r.interval)!==null&&s!==void 0?s:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),x.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===Ml.CONNECTED&&this.inspectImage()}async requestAP(r,s,o){const c=oe("WEBCS_DOMAIN").map(y=>"https://".concat(y,"/api/v1")),u=await function(y,E,S,R){let{appId:P,areaCode:D,cname:G,sid:j,token:B,uid:Y}=E;lS++;const ee="moderation_plugin",fe={service_name:ee,json_body:JSON.stringify({appId:P,areaCode:D,cname:G,command:"allocateEdge",requestId:lS,seq:lS,sid:j,appToken:B,ts:Date.now(),uid:Y+""})};let ye,Ee,_e=y[0];return Rd(async()=>{ye=Date.now();const Ne=await kd(_e,{data:fe,cancelToken:S,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Ee=Date.now()-ye,Ne.code!==0){const yt=new Ae(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Ne.code,{retry:!0,responseTime:Ee});throw x.error(yt.toString()),yt}const Ze=JSON.parse(Ne.json_body);if(Ze.code!==200){const yt=new Ae(te.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Ze.code,", reason: ").concat(Ze.reason),{code:Ze.code,responseTime:Ee});throw x.error(yt.toString()),yt}if(!Ze.servers||!Array.isArray(Ze.servers)||Ze.servers.length===0){const yt=new Ae(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Ze.code,responseTime:Ee});throw x.error(yt.toString()),yt}if(!Ze.servers.some(yt=>!!yt.wss)){const yt=new Ae(te.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Ze.code,responseTime:Ee});throw x.error(yt.toString()),yt}const pt=oe("IMAGE_MODERATION_WORKER_HOST");return{addressList:Ze.servers.map(yt=>{let{address:In,wss:An}=yt;if(In&&An)return"wss://".concat(In.replace(/\./g,"-"),".").concat(pt,":").concat(An,"/moderation")}).filter(yt=>!!yt),workerToken:Ze.workerToken,vid:Ze.vid,ticket:Ze.appTicket,responseTime:Ee}},(Ne,Ze)=>(Nt.apworkerEvent(j,{success:!0,sc:200,serviceName:ee,responseDetail:JSON.stringify(Ne.addressList),firstSuccess:Ze===0,responseTime:Ee,serverIp:y[Ze%y.length]}),!1),(Ne,Ze)=>(Nt.apworkerEvent(j,{success:!1,sc:Ne.data&&Ne.data.code||200,serviceName:ee,responseTime:Ee,serverIp:y[Ze%y.length]}),!!(Ne.code!==te.OPERATION_ABORTED&&Ne.code!==te.UNEXPECTED_RESPONSE||Ne.data&&Ne.data.retry)&&(_e=y[(Ze+1)%y.length],!0)),R)}(c,r,s,o);this.emit(Od.STATE_CHANGE,rS.AP_CONNECTED);const{addressList:h,ticket:m}=u;return this._ticket=m,h}async connectWorker(r){this.emit(Od.STATE_CHANGE,rS.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(nn.CONNECTED,async()=>{this.emit(Od.STATE_CHANGE,rS.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Ml.CONNECTED}),this._workerConnection.on(nn.CLOSED,()=>{this.connectionState=Ml.CLOSED}),this._workerConnection.on(nn.FAILED,()=>{this.connectionState=Ml.CLOSED}),this._workerConnection.on(nn.RECONNECTING,()=>{this.connectionState=this.connectionState===Ml.CONNECTED?Ml.RECONNECTING:Ml.CONNECTING}),this._workerConnection.on(nn.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const s=_ge(new Uint8Array(r.data));oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(s)),this._uploadNum++,s.code===void 0||s.code===0||(this._uploadFailedNum++,x.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(s.code,", msg is ").concat(s.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Nt.reportApiInvoke(this._connectInfo.sid||null,{name:Ai.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,s.code],tag:Hr.TRACER}).onError(new Ae(te.IMAGE_MODERATION_UPLOAD_FAILED,s.msg)),this._uploadTimer=null},oe("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else x.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(nn.WILL_RECONNECT,(r,s,o)=>{r==="recover"&&o(r),o("tryNext")}),this._workerConnection.on(nn.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=Qc(this,Od.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being played can be inspected"));this._sequence++;const o=await this.generateRequestData(r,s);this._workerConnection.sendMessage(o,!0,!0)}else oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&x.debug("Only the track being published can be inspected")}async generateRequestData(r,s){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:y}=s;const E=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await n8(S,o,c),P=this._sequence+"-"+u+"-"+y+"-"+E+"-"+pr(12,""),D={appId:o,cid:u,cname:c,deviceId:"",elapse:m2.intToLong(Number(E-this._moderationStartTime)),fileSize:S.buffer.byteLength,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this._sequence,sid:m,timestamp:PH(E),uid:y,vid:h,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete D.callbackData;const G=gge(D);if(G.byteLength<this._workerMessageLengthLimit){if(oe("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const j=function(B){for(var Y=1;Y<arguments.length;Y++){var ee=arguments[Y]!=null?arguments[Y]:{};Y%2?OH(Object(ee),!0).forEach(function(fe){q(B,fe,ee[fe])}):Object.getOwnPropertyDescriptors?Object.defineProperties(B,Object.getOwnPropertyDescriptors(ee)):OH(Object(ee)).forEach(function(fe){Object.defineProperty(B,fe,Object.getOwnPropertyDescriptor(ee,fe))})}return B}({},D);delete j.jpg,x.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(j))}return G}{const j=this.quality*this._qualityRatio;return this.quality=j,await this.generateRequestData(r,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:y})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=_a.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Ml.CLOSED,this.emit(Od.STATE_CHANGE,rS.CLOSED)}}function kH(e){if(cr(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Ae(te.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Ae(te.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Rge={name:"ImageModeration",create:function(e){let{config:r}=e;return kH(r),new m2(r)}};var NH,DH,xH,LH,MH,UH,VH,jH,FH,BH,zH,WH,GH,HH,$H,KH,qH,YH,XH,JH,QH,ZH,e$,t$,n$,r$,i$,s$,o$,a$,c$,l$,u$,d$,h$,p$,f$,m$,g$,_$,y$,_t;function E$(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function Nu(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?E$(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):E$(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}qs.setLogger(x);let Ige=(NH=Ht(),DH=Ht({argsMap:(e,r)=>{if(!Array.isArray(r)){if(!(r instanceof Yv))return[r];r=[r]}return r.map(s=>s?Object(s).toString():"null")}}),xH=Ht({argsMap:(e,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==qv.DATA?(Array.isArray(r)||(r=[r]),r.map(s=>s.getTrackId())):[r.getChannelId()])}),LH=Ht({argsMap:(e,r,s,o)=>[typeof r=="object"?r.uid:r,s,o]}),MH=Ht({argsMap:(e,r,s)=>[r,s]}),UH=Ht({argsMap:(e,r)=>r.map(s=>{let{user:o,mediaType:c}=s;return[o==null?void 0:o.uid,c]})}),VH=Ht({argsMap:(e,r,s,o)=>[typeof r=="object"?r.uid:r,s,o]}),jH=Ht({argsMap:(e,r)=>r.map(s=>{let{user:o,mediaType:c}=s;return{uid:o==null?void 0:o.uid,mediaType:c}})}),FH=Ht(),BH=Ht(),zH=Ht(),WH=Ht(),GH=Ht(),HH=Ht(),$H=Ht(),KH=Ht(),qH=Ht(),YH=Ht(),XH=Ht(),JH=Ht(),QH=Ht(),ZH=Ht(),e$=Ht(),t$=Ht({argsMap:(e,r)=>[r]}),n$=Ht(),r$=Ht(),i$=Ht(),s$=Ht(),o$=Ht(),a$=Ht(),c$=Ht(),l$=Ht(),u$=Ht({argsMap:(e,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),d$=Ht(),h$=Ht(),p$=Ht(),f$=Ht(),m$=Ht(),g$=Ht(),_$=Ht({reportResult:!0}),y$=Ht(),_t=class extends jr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,r){let s;if(super(),q(this,"store",void 0),q(this,"_uid",void 0),q(this,"_channelName",void 0),q(this,"_uintUid",void 0),q(this,"_users",[]),q(this,"_config",void 0),q(this,"_clientId",void 0),q(this,"_appId",void 0),q(this,"_sessionId",null),q(this,"_key",void 0),q(this,"_rtmConfig",{}),q(this,"_joinInfo",void 0),q(this,"_gateway",void 0),q(this,"_statsCollector",void 0),q(this,"_configDistribute",void 0),q(this,"_leaveMutex",void 0),q(this,"_publishMutex",void 0),q(this,"_renewTokenMutex",void 0),q(this,"_subscribeMutex",void 0),q(this,"_encryptionMode","none"),q(this,"_encryptionSecret",null),q(this,"_encryptionSalt",null),q(this,"_encryptDataStream",!1),q(this,"_encryptDataStreamKey",null),q(this,"_encryptDataStreamIv",null),q(this,"_proxyServer",void 0),q(this,"_turnServer",{servers:[],mode:"auto"}),q(this,"_cloudProxyServerMode","disabled"),q(this,"_isDualStreamEnabled",!1),q(this,"_defaultStreamFallbackType",void 0),q(this,"_lowStreamParameter",void 0),q(this,"_streamFallbackTypeCacheMap",new Map),q(this,"_remoteStreamTypeCacheMap",new Map),q(this,"_axiosCancelSource",_a.CancelToken.source()),q(this,"_audioVolumeIndicationInterval",void 0),q(this,"_networkQualityInterval",void 0),q(this,"_userOfflineTimeout",void 0),q(this,"_streamRemovedTimeout",void 0),q(this,"_liveTranscodeStreamingClient",void 0),q(this,"_liveRawStreamingClient",void 0),q(this,"_channelMediaRelayClient",void 0),q(this,"_networkQualitySensitivity","normal"),q(this,"_p2pChannel",void 0),q(this,"_useLocalAccessPoint",!1),q(this,"_setLocalAPVersion",void 0),q(this,"_joinAndNotLeaveYet",!1),q(this,"_numberOfJoinCount",0),q(this,"_remoteDefaultVideoStreamType",void 0),q(this,"_inspect",void 0),q(this,"_moderation",void 0),q(this,"_license",void 0),q(this,"_pendingPublishedUsers",[]),q(this,"ntpAlignErrorCount",0),q(this,"remoteInboundOffset",0),q(this,"_peerConnectionState",void 0),q(this,"_handleLocalTrackEnable",(c,u,h)=>{this.publish(c,!1).then(u).catch(h)}),q(this,"_handleLocalTrackDisable",(c,u,h)=>{this.unpublish(c).then(u).catch(h)}),q(this,"_handleUserOnline",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&X_(c.uid,this.channelName))return void x.debug("[".concat(c.uid,"] will be ignored in local"));this.isStringUID&&typeof c.uid!="string"&&x.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const u=this._users.find(h=>h.uid===c.uid);if(u)u._trust_in_room_=!0,u._is_pre_created&&(u._is_pre_created=!1,this.safeEmit(Tn.USER_JOINED,u));else{const h=new Jm(c.uid,c.uint_id||c.uid);this._users.push(h),x.debug("[".concat(this._clientId,"] user online"),c.uid),this.safeEmit(Tn.USER_JOINED,h)}}),q(this,"_handleUserOffline",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&X_(c.uid,this.channelName))return;const u=this._users.find(h=>h.uid===c.uid);u&&(this._handleRemoveStream(c),this._handleRemoveDataChannels(c),u._audio_pre_subscribed||u._video_pre_subscribed?u._is_pre_created=!0:jA(this._users,u),this._remoteStreamTypeCacheMap.delete(u.uid),this._streamFallbackTypeCacheMap.delete(u.uid),x.debug("[".concat(this._clientId,"] user offline"),c.uid,"reason:",c.reason),this.safeEmit(Tn.USER_LEAVED,u,c.reason))}),q(this,"_handleAddAudioOrVideoStream",(c,u,h,m,y,E,S)=>{if(oe("BLOCK_LOCAL_CLIENT")&&X_(u,this.channelName))return;const R=this._users.find(D=>D.uid===u);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(R.uid,c,void 0,void 0,void 0,Date.now());const P=c==="audio"?R.hasAudio:R.hasVideo;R._uintid||(R._uintid=y||u),c==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,c==="audio"?(R._audio_added_=!0,h!==void 0&&(R._audioSSRC=h),m!==void 0&&(R._cname=m),E&&(R._audioOrtc=E)):(R._video_added_=!0,h!==void 0&&(R._videoSSRC=h),m!==void 0&&(R._cname=m),S!==void 0&&(R._rtxSsrcId=S),E&&(R._videoOrtc=E)),(c==="audio"?R.hasAudio:R.hasVideo)&&!P&&(x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(c)),this.safeEmit(Tn.USER_PUBLISHED,R,c)),c==="video"?Nt.onGatewayStream(this._sessionId,Xi.ON_ADD_VIDEO_STREAM,Lr.ON_ADD_VIDEO_STREAM,{peer:y||u,ssrc:R._videoSSRC}):Nt.onGatewayStream(this._sessionId,Xi.ON_ADD_AUDIO_STREAM,Lr.ON_ADD_AUDIO_STREAM,{peer:y||u,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,c,h).then(D=>{if(D&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof zT))return this._p2pChannel.unsubscribe(R,c,!0).then(()=>this._subscribe(R,c,!0).catch(G=>{x.error("[".concat(this._clientId,"] resubscribe error"),G.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(R,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,c,!0).catch(D=>{x.error("[".concat(this._clientId,"] resubscribe error"),D.toString())}))}),q(this,"_handleRemoveStream",c=>{if(oe("BLOCK_LOCAL_CLIENT")&&X_(c.uid,this.channelName))return;const u=this._users.find(m=>m.uid===c.uid);if(!u)return void x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));x.debug("[".concat(this._clientId,"] stream removed with uid ").concat(c.uid));let h=()=>{};u.hasAudio&&u.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(Tn.USER_UNPUBLISHED,u,"audio"),x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(Tn.USER_UNPUBLISHED,u,"video")}:u.hasVideo?h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished video track")),this.safeEmit(Tn.USER_UNPUBLISHED,u,"video")}:u.hasAudio&&(h=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(u.uid," unpublished audio track")),this.safeEmit(Tn.USER_UNPUBLISHED,u,"audio")}),u._video_pre_subscribed||u._audio_pre_subscribed||(u._trust_audio_stream_added_state_=!0,u._trust_video_stream_added_state_=!0,u._audio_added_=!1,u._video_added_=!1,this._p2pChannel instanceof zT&&this._p2pChannel.unsubscribe(u).then(m=>{if(m)return this._gateway.unsubscribe(m,u.uid)}),u._audioSSRC=void 0,u._videoSSRC=void 0,u._audioOrtc=void 0,u._videoOrtc=void 0,u._rtxSsrcId=void 0),Nt.onGatewayStream(this._sessionId,Xi.ON_REMOVE_STREAM,Lr.ON_REMOVE_STREAM,{peer:c.uint_id||c.uid}),h()}),q(this,"_handleSetStreamLocalEnable",(c,u,h)=>{if(oe("BLOCK_LOCAL_CLIENT")&&X_(u,this.channelName))return;const m=this._users.find(S=>S.uid===u);if(!m)return void x.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));x.debug("[".concat(this._clientId,"] local ").concat(c," ").concat(h?"enabled":"disabled"," with uid ").concat(u));const y=c==="audio"?m.hasAudio:m.hasVideo;if(c==="audio"){m._trust_audio_enabled_state_=!0;const S=m._audio_enabled_;if(m._audio_enabled_=h,m._audio_enabled_===S)return;{const R=m._audio_enabled_?"enable-local-audio":"disable-local-audio";x.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(Tn.USER_INFO_UPDATED,u,R)}}else{m._trust_video_enabled_state_=!0;const S=m._video_enabled_;if(m._video_enabled_=h,m._video_enabled_===S)return;{const R=m._video_enabled_?"enable-local-video":"disable-local-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(u,", msg: ").concat(R)),this.safeEmit(Tn.USER_INFO_UPDATED,u,R)}}const E=c==="audio"?m.hasAudio:m.hasVideo;return y!==E?!y&&E?(x.info("[".concat(this._clientId,"] remote user ").concat(u," published ").concat(c)),void this.safeEmit(Tn.USER_PUBLISHED,m,c)):(c==="video"&&m._videoTrack&&m._videoTrack._destroy(),c==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,c),x.info("[".concat(this._clientId,"] remote user ").concat(u," unpublished ").concat(c)),void this.safeEmit(Tn.USER_UNPUBLISHED,m,c)):void 0}),q(this,"_handleMuteStream",(c,u,h)=>{if(oe("BLOCK_LOCAL_CLIENT")&&X_(c,this.channelName))return;x.debug("[".concat(this._clientId,"] receive mute message"),c,u,h);const m=this._users.find(S=>S.uid===c);if(!m)return void x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c));const y=u==="audio"?m.hasAudio:m.hasVideo;if(u==="audio"){m._trust_audio_mute_state_=!0;const S=m._audio_muted_;if(m._audio_muted_=h,m._audio_muted_===S)return;{const R=m._audio_muted_?"mute-audio":"unmute-audio";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(Tn.USER_INFO_UPDATED,c,R)}}else{m._trust_video_mute_state_=!0;const S=m._video_muted_;if(m._video_muted_=h,m._video_muted_===S)return;{const R=m._video_muted_?"mute-video":"unmute-video";x.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(c,", msg: ").concat(R)),this.safeEmit(Tn.USER_INFO_UPDATED,c,R)}}const E=u==="audio"?m.hasAudio:m.hasVideo;if(y!==E){if(!y&&E)return(u==="audio"?m._audioSSRC:m._videoSSRC)?(x.info("[".concat(this._clientId,"] remote user ").concat(c," published ").concat(u)),void this.safeEmit(Tn.USER_PUBLISHED,m,u)):void x.warning("[".concat(this._clientId,"] remote user ").concat(c," receive ").concat(u," unmute message  before add stream message, ").concat(u," SSRC doesn't exist yet."));u==="video"&&m._videoTrack&&!m._video_pre_subscribed&&m._videoTrack._destroy(),u==="audio"&&m._audioTrack,this._p2pChannel.muteRemote(m,u),x.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished ").concat(u)),this.safeEmit(Tn.USER_UNPUBLISHED,m,u)}}),q(this,"_handleP2PLost",async c=>{x.debug("[".concat(this._clientId,"] receive p2p lost"),c),parseInt(c.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():x.warning("[".concat(this._clientId,"] P2PLost stream not found"),c)}),q(this,"_handleTokenWillExpire",()=>{x.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Tn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),q(this,"_handleBeforeUnload",c=>{c.type==="beforeunload"&&c.returnValue!==void 0&&c.returnValue!==""||(this.leave(),x.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),q(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Tn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const c={downlinkNetworkQuality:0,uplinkNetworkQuality:0};c.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),c.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Tn.NETWORK_QUALITY,c)}),q(this,"_handleP2PAddAudioOrVideoStream",(c,u,h,m)=>{const y=this._users.find(S=>S.uid===u);if(!y)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));x.debug("[".concat(this._clientId,"] stream added with uid ").concat(u,", type ").concat(c)),this.store.subscribe(y.uid,c,void 0,void 0,void 0,Date.now());const E=c==="audio"?y.hasAudio:y.hasVideo;c==="audio"?y._trust_audio_stream_added_state_=!0:y._trust_video_stream_added_state_=!0,c==="audio"?(y._audio_added_=!0,h!==void 0&&(y._audioSSRC=h),m!==void 0&&(y._audioMid=m)):(y._video_added_=!0,h!==void 0&&(y._videoSSRC=h),m!==void 0&&(y._videoMid=m)),(c==="audio"?y.hasAudio:y.hasVideo)&&!E&&(x.info("[".concat(this._clientId,"] remote user ").concat(y.uid," published ").concat(c)),this.safeEmit(Tn.USER_PUBLISHED,y,c)),this._p2pChannel.hasPendingRemoteMedia(y,c)&&(x.debug("[".concat(this._clientId,"] resubscribe ").concat(c," for user ").concat(y.uid," after reconnect.")),this._subscribe(y,c,!0).catch(S=>{x.error("[".concat(this._clientId,"] resubscribe error"),S.toString())}))}),this._config=e,this._clientId=r||pr(5,"client-"),this.store=new class{constructor(c,u,h,m){Qt(this,"state",void 0),this.state={codec:c,audioCodec:u,mode:h,clientId:m,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:W_.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(c){this.state=function(u,h){switch(h.type){case wn.SET_SESSION_ID:return St(St({},u),{},{sessionId:h.sessionId});case wn.SET_P2P_ID:return St(St({},u),{},{p2pId:h.p2pId});case wn.SET_UID:return St(St({},u),{},{uid:h.uid});case wn.SET_INT_UID:return St(St({},u),{},{intUid:h.intUid});case wn.SET_PUB_ID:return St(St({},u),{},{pubId:h.pubId});case wn.KEY_METRIC_CLIENT_CREATED:return St(St({},u),{},{keyMetrics:St(St({},u.keyMetrics),{},{clientCreated:h.metric})});case wn.KEY_METRIC_JOIN_START:return St(St({},u),{},{keyMetrics:St(St({},u.keyMetrics),{},{joinStart:h.metric})});case wn.AVOID_JOIN_START:return St(St({},u),{},{avoidJoinStart:h.avoidJoinStart});case wn.KEY_METRIC_JOIN_END:return St(St({},u),{},{keyMetrics:St(St({},u.keyMetrics),{},{joinEnd:h.metric})});case wn.KEY_METRIC_REQUEST_AP_START:return St(St({},u),{},{keyMetrics:St(St({},u.keyMetrics),{},{requestAPStart:h.metric})});case wn.KEY_METRIC_REQUEST_AP_END:return St(St({},u),{},{keyMetrics:St(St({},u.keyMetrics),{},{requestAPEnd:h.metric})});case wn.KEY_METRIC_JOIN_GATEWAY_START:return St(St({},u),{},{keyMetrics:St(St({},u.keyMetrics),{},{joinGatewayStart:h.metric})});case wn.KEY_METRIC_JOIN_GATEWAY_END:return St(St({},u),{},{keyMetrics:St(St({},u.keyMetrics),{},{joinGatewayEnd:h.metric})});case wn.KEY_METRIC_PEER_CONNECTION_START:return St(St({},u),{},{keyMetrics:St(St({},u.keyMetrics),{},{peerConnectionStart:h.metric})});case wn.KEY_METRIC_PEER_CONNECTION_END:return St(St({},u),{},{keyMetrics:St(St({},u.keyMetrics),{},{peerConnectionEnd:h.metric})});case wn.KEY_METRIC_DESCRIPTION_START:return St(St({},u),{},{keyMetrics:St(St({},u.keyMetrics),{},{descriptionStart:h.metric})});case wn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return St(St({},u),{},{keyMetrics:St(St({},u.keyMetrics),{},{signalChannelOpen:h.metric})});case wn.KEY_METRIC_ICE_CONNECTION_END:return St(St({},u),{},{keyMetrics:St(St({},u.keyMetrics),{},{iceConnectionEnd:h.metric})});case wn.KEY_METRIC_PUBLISH:{const m=u.keyMetrics.publish,y=m.findIndex(E=>E.trackId===h.metric.trackId);return y!==-1?(m[y]=St(St({},m[y]),h.metric),St(St({},u),{},{keyMetrics:St(St({},u.keyMetrics),{},{publish:[...m]})})):St(St({},u),{},{keyMetrics:St(St({},u.keyMetrics),{},{publish:[...u.keyMetrics.publish,h.metric]})})}case wn.KEY_METRIC_SUBSCRIBE:{const m=u.keyMetrics.subscribe,y=m.findIndex(E=>E.userId===h.metric.userId&&E.type===h.metric.type);return y!==-1?(m[y]=St(St({},m[y]),h.metric),St(St({},u),{},{keyMetrics:St(St({},u.keyMetrics),{},{subscribe:[...m]})})):St(St({},u),{},{keyMetrics:St(St({},u.keyMetrics),{},{subscribe:[...u.keyMetrics.subscribe,h.metric]})})}case wn.SET_CLOUD_PROXY_SERVER_MODE:return u.cloudProxyServerMode=h.mode,u;case wn.RECORD_JOIN_CHANNEL_SERVICE:return typeof h.index!="number"?u.joinChannelServiceRecords=[...u.joinChannelServiceRecords,h.record]:(u.joinChannelServiceRecords[h.index]=St(St({},u.joinChannelServiceRecords[h.index]),h.record),u.joinChannelServiceRecords=[...u.joinChannelServiceRecords]),u;case wn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return u.joinChannelServiceRecords=[],u;case wn.RESET_KEY_METRICS:return u.keyMetrics={publish:[],subscribe:[]},u;case wn.SET_USE_P2P:return St(St({},u),{},{useP2P:h.val});case wn.SET_TRANSPORT_TYPE:return St(St({},u),{},{p2pTransport:h.val});default:return u}}(this.state,c)}set sessionId(c){this.dispatch({type:wn.SET_SESSION_ID,sessionId:c})}get sessionId(){return this.state.sessionId}set cid(c){this.state.cid=c}get cid(){return this.state.cid}set codec(c){this.state.codec=c}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(c){this.dispatch({type:wn.SET_P2P_ID,p2pId:c})}get p2pId(){return this.state.p2pId}set dcId(c){this.dispatch({type:wn.SET_DC_ID,dcId:c})}get dcId(){return this.state.dcId}set uid(c){this.dispatch({type:wn.SET_UID,uid:c})}get uid(){return this.state.uid}set intUid(c){this.dispatch({type:wn.SET_INT_UID,intUid:c})}get intUid(){return this.state.intUid}set pubId(c){this.dispatch({type:wn.SET_PUB_ID,pubId:c})}get pubId(){return this.state.pubId}set cloudProxyServerMode(c){this.dispatch({type:wn.SET_CLOUD_PROXY_SERVER_MODE,mode:c})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(c){this.dispatch({type:wn.SET_USE_P2P,val:c})}get useP2P(){return this.state.useP2P}set p2pTransport(c){this.dispatch({type:wn.SET_TRANSPORT_TYPE,val:c})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(c){this.state.hasStartJoinChannel=c}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(c){this.state.isABTestSuccess=c}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:wn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:wn.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:wn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:wn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:wn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:wn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:wn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:wn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:wn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:wn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:wn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:wn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(c,u,h,m){this.dispatch({type:wn.KEY_METRIC_PUBLISH,metric:St(St({trackId:c,type:u},h&&{publishStart:h}),m&&{publishEnd:m})})}subscribe(c,u,h,m,y,E,S){this.dispatch({type:wn.KEY_METRIC_SUBSCRIBE,metric:St(St(St(St(St({userId:c,type:u},h&&{subscribeStart:h}),m&&{subscribeEnd:m}),y&&{firstFrame:y}),E&&{streamAdded:E}),S&&{firstDecoded:S})})}massSubscribe(c,u,h,m){c.forEach(y=>{this.dispatch({type:wn.KEY_METRIC_SUBSCRIBE,metric:St(St(St({userId:y.userId,type:y.type},u&&{subscribeStart:u}),h&&{subscribeEnd:h}),m&&{firstFrame:m})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(c,u){c.service==="gateway"&&Array.isArray(c.urls)&&(c.urls=c.urls.map(h=>h.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof u!="number"?(this.dispatch({type:wn.RECORD_JOIN_CHANNEL_SERVICE,record:St(St({},c),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(u<0||u>=this.state.joinChannelServiceRecords.length||this.dispatch({type:wn.RECORD_JOIN_CHANNEL_SERVICE,record:c,index:u}),u)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:wn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:wn.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(c){this.dispatch({type:wn.AVOID_JOIN_START,avoidJoinStart:c})}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new qs("client-leave",this._clientId),this._publishMutex=new qs("client-publish",this._clientId),this._renewTokenMutex=new qs("client-renewtoken",this._clientId),this._subscribeMutex=new qs("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),x.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Dl," build: ").concat(aL,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{qx(e.clientRoleOptions),s=Object.assign({},e.clientRoleOptions)}catch(c){x.warning("[".concat(this._clientId,"] ").concat(c.toString()))}var o;this._statsCollector=new FT(this.store),this._statsCollector.onStatsException=(c,u,h)=>{x.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(c,", msg: ").concat(u,", uid: ").concat(h)),this.safeEmit(Tn.EXCEPTION,{code:c,msg:u,uid:h})},this._statsCollector.onUploadPublishDuration=(c,u,h,m)=>{const y=this._users.find(E=>E.uid===c);y&&Nt.peerPublishStatus(this._sessionId,{subscribeElapse:m,audioPublishDuration:u,videoPublishDuration:h,peer:y._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new Hme(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Pi,httpRetryConfig:e.httpRetryConfig||Pi,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:s}),this._configDistribute=new tge(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(o={store:this.store,statsCollector:this._statsCollector},mf("P2PChannel").create(o)),this._handleP2PEvents()):this._p2pChannel=new zT(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,r,s,o,c){let u=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],h=arguments.length>6&&arguments[6]!==void 0&&arguments[6];sr("JOIN_GATEWAY_USE_443PORT_ONLY",u),sr("JOIN_GATEWAY_USE_DUAL_DOMAIN",h);const m=this._gateway.signal.websocket;return m instanceof FL&&(m.use443PortOnly=u,m.tryDoubleDomain=h),async function(y,E,S){xA.get(y)||xA.set(y,[]),LA.get(y)||LA.set(y,E),Ch.get(y)||Ch.set(y,0);const R=xA.get(y),P=LA.get(y);if(!R||!P)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Ch.get(y)===P){const Y=_T();R.push(Y),await Y.promise}Ch.set(y,Ch.get(y)+1);for(var D=arguments.length,G=new Array(D>3?D-3:0),j=3;j<D;j++)G[j-3]=arguments[j];const B=await S(...G);return Ch.set(y,Ch.get(y)-1),Ch.get(y)===P-1&&R.length>0&&(R[0].resolve(),R.shift()),Ch.get(y)===0&&(xA.set(y,[]),LA.set(y,0),Ch.set(y,0)),B}("client.join",oe("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,r,s,o,c)}async join(e,r,s,o,c){const u=++this._numberOfJoinCount;this.store.joinStart(),o&&(this.store.uid=o);const h=(zA||zA||(zA=(window.location.protocol.split(":")[0]||"").toUpperCase(),zA))==="HTTPS",m=gW()?window.isSecureContext:"Browser Not Support";(!gW()&&!h||!window.isSecureContext)&&x.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),x.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),Nt.setAppId(e);try{if(!s&&s!==null)throw new Ae(te.INVALID_PARAMS,"Invalid token: ".concat(s,". If you don not use token, set it to null"));s&&hs(s,"token",1,2047),hs(e,"appid",1,2047),uP(r),o&&dP(o),c&&hs(c,"optionalInfo",1,2047)}catch(j){throw Nt.reportApiInvoke(z_(),{name:Ai.JOIN,options:[e,r,s,o],states:{isHttps:h,isSecureContext:m},tag:Hr.TRACER}).onError(j),j}if(this._leaveMutex.isLocked&&(x.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),x.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const j=new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Nt.reportApiInvoke(z_(),{name:Ai.JOIN,options:[e,r,s,o],states:{isHttps:h,isSecureContext:m},tag:Hr.TRACER}).onError(j),j}this._gateway.state="CONNECTING";const y=await mH({appId:e,cname:r,uid:o,stringUid:typeof o=="string"?o:void 0,token:s||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const E=(y==null?void 0:y.sid)||z_();x.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(u)),this._sessionId||(this._sessionId=E,this.store.sessionId=this._sessionId);const S=Nt.reportApiInvoke(E,{id:this._clientId,name:Ai.JOIN,options:[e,r,s,o],states:{isHttps:h,isSecureContext:m},tag:Hr.TRACER}),R=Nu(Nu(Nu({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:r,uid:typeof o!="string"?o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:s||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:c,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!y},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:oe("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof o=="string"&&(R.stringUid=o,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async j=>{const B=function(ye){const Ee=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),_e=new Uint8Array(new ArrayBuffer(Ee.length));for(let Ne=0;Ne<Ee.length;Ne+=1)_e[Ne]=Ee.charCodeAt(Ne);return _e}(),Y=await window.crypto.subtle.importKey("spki",B,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),ee=$x(j),fe=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Y,ee);return function(ye){let Ee="";for(let _e=0;_e<ye.length;_e+=1)Ee+=String.fromCharCode(ye[_e]);return window.btoa(Ee)}(new Uint8Array(fe))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const j=new TextEncoder,B=oe("USE_PURE_ENCRYPTION_MASTER_KEY")?j.encode(R.appId+this._encryptionSecret+this._encryptionSecret):j.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(Y,ee,fe){const ye=await window.crypto.subtle.importKey("raw",ee,"PBKDF2",!1,["deriveBits","deriveKey"]),Ee=Y==="aes-128-gcm2"?128:256,_e=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:RW,hash:"SHA-256",salt:fe},ye,Ee+Sfe);return new Uint8Array(_e).subarray(Ee/8)}(this._encryptionMode,B,B_(this._encryptionSalt)),this._encryptDataStreamKey=await async function(Y,ee,fe){const ye=await window.crypto.subtle.importKey("raw",ee,"PBKDF2",!1,["deriveBits","deriveKey"]),Ee=Y==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:RW,hash:"SHA-256",salt:fe},ye,{name:"AES-GCM",length:Ee},!0,["encrypt","decrypt"])}(this._encryptionMode,B,B_(this._encryptionSalt))}else m?x.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):x.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,x.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:e,stringUid:R.stringUid});const P=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&P===this._sessionId&&Nt.joinChannelTimeout(this._sessionId,5)},5e3);try{var D;let j;const B=R.cloudProxyServer;if(ct(D=["proxy3","proxy4","proxy5"]).call(D,B)){const Ee=oe("PROXY_SERVER_TYPE3");Array.isArray(Ee)?R.proxyServer=Ee[0]:R.proxyServer=Ee}if(Nt.setProxyServer(R.proxyServer),x.setProxyServer(R.proxyServer),this.store.requestAPStart(),y){if(x.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(y.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=y.intUid),j={gatewayInfo:y.ap.gatewayInfo},oe("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(y.ap.proxyInfo.addresses.length===0)x.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const Ee=(await a9(y.ap.proxyInfo,y.ap.gatewayInfo.uid)).map(_e=>({turnServerURL:_e.address,tcpport:_e.tcpport||ks.tcpport,udpport:_e.udpport||ks.udpport,username:_e.username||ks.username,password:_e.password||ks.password,forceturn:!1,security:!0}));R.turnServer={mode:"manual",servers:Ee}}yH(y,R.stringUid)}else{if(R.stringUid&&!R.uid){let Ee;[Ee,j]=await ht.all([L9(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||Pi,this.store),x9(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Pi,!0,this.store)]),x.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(Ee)),R.uid=Ee,j.gatewayInfo.uid=Ee,j.gatewayInfo.res.uid=Ee}else j=await x9(R,this._axiosCancelSource.token,this._config.httpRetryConfig||Pi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(kT.UPDATE_BITRATE_LIMIT,Ee=>{this._p2pChannel.updateBitrateLimit(Ee)}),this._configDistribute.on(kT.UPDATE_CLIENT_ROLE_OPTIONS,Ee=>{this._setClientRoleOptions(Ee)})},0),this._key=s||e;const Y=j.gatewayInfo,ee=R.uid?R.uid:Y.uid;this._joinInfo=Nu(Nu({},R),{},{cid:Y.cid,uid:ee,vid:Y.vid,apResponse:Y.res,apGatewayAddress:Y.apGatewayAddress,uni_lbs_ip:Y.uni_lbs_ip,gatewayAddrs:Y.gatewayAddrs}),this.store.intUid=ee,this.store.cid=Y.cid;const fe=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));S.onSuccess(fe),this._appId=e,this._channelName=R.cname,this._uid=fe,this.store.uid=fe,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(As()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const ye=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return x.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(ye)),setTimeout(()=>{x.startUpload()},5e3),this.store.joinEnd(),G=this,ct(Y_).call(Y_,G)||Y_.push(G),this._cloudProxyServerMode==="disabled"&&Fn().supportWebCrypto&&oe("ENABLE_PRELOAD")&&p2(this._joinInfo),fe}catch(j){const B=Array.isArray(j)?j[0]:j;throw B&&B.code===te.OPERATION_ABORTED?x.warning("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),B):x.error("[".concat(this._clientId,"] join number: ").concat(u,", Joining channel failed, rollback"),B),B.code!==te.OPERATION_ABORTED&&this._numberOfJoinCount===u&&(this._gateway.state="DISCONNECTED",this._reset()),S.onError(B),B}var G}_joinGateway(){if(!this._joinInfo||!this._key)throw new Ae(te.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!oe("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){x.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(As()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const s=Y_.indexOf(r);s!==-1&&Y_.splice(s,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return x.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Yn.LEAVE),x.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof Yv))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new Ae(te.INVALID_PARAMS,"param list is empty");const s=e;if(this._gateway.role==="audience")throw new Ae(te.INVALID_OPERATION,"audience can not publish stream");for(const c of s){if(!(c instanceof Yv))throw new Ae(te.INVALID_PARAMS,"parameter is not local track");if(!c._enabled&&r)throw new Ae(te.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(c.getTrackId()))}x.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))));const o=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&s.forEach(c=>{const u=this._configDistribute.getBitrateLimit();c instanceof Cr&&u&&c.setBitrateLimit(u.uplink)});try{await this._publishHighStream(s),x.info("[".concat(this._clientId,"] Publish success, id ").concat(s.map(c=>"".concat(c.getTrackId()," "))))}catch(c){throw x.error("[".concat(this._clientId,"] publish error"),c.toString()),c}finally{o()}}async _publishDataChannel(e){cr(e.id,"id",0,65535,!0),cf(e.ordered,"ordered"),hs(e.metadata,"metadata",0,512),x.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(c=>c.id===e.id)!==-1)throw new Ae(te.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Ae(te.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&oe("FORCE_TURN")&&!oe("TURN_ENABLE_TCP")&&!oe("TURN_ENABLE_UDP"))throw new Ae(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const s=function(c){return C9(c,!1)}(e),o=await this._p2pChannel.publishDataChannel([s]);if(o.length>0){if(typeof s._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Ae(te.CREATE_DATACHANNEL_ERROR);try{await ht.all(o.map(c=>this._uid&&this._gateway.publishDataChannel(this._uid,c,!0))),await s._waitTillOpen()}catch(c){if(c.code!==te.DISCONNECT_P2P)throw c}}return x.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(s.id)),s}catch(s){throw x.error("[".concat(this._clientId,"] publish datachannels error"),s.toString()),s}finally{r()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new Ae(te.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(e)if(Array.isArray(e))r=e;else{if(!(e instanceof Yv))return this._unpublishDataChannel([e]);r=[e]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);x.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(o=>"".concat(o.getTrackId()," "))," "));const s=await this._publishMutex.lock();try{if(this.store.useP2P){const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.sendExtensionMessage(ci.UNPUBLISH,{unpubMsg:o},!0)}else{const o=await this._p2pChannel.unpublish(r);o&&await this._gateway.unpublish(o,this._uid),x.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(c=>"".concat(c.getTrackId()))))}}catch(o){throw x.error("[".concat(this._clientId,"] unpublish error"),o.toString()),o}finally{s&&s()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),x.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(s=>"".concat(s.id," "))," "));const r=await this._publishMutex.lock();try{const s=await this._p2pChannel.unpublishDataChannel(e);s&&await this._gateway.unpublishDataChannel(s),x.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(o=>"".concat(o.id))))}catch(s){throw x.error("[".concat(this._clientId,"] unpublish dataChannel error"),s.toString()),s}finally{r&&r()}}async subscribe(e,r,s){if(!(e instanceof Jm)){const o=this.remoteUsers.find(c=>c.uid===e);if(!o)throw new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");e=o}return r==="datachannel"?this._subscribeDataChannel(e,s):this._subscribe(e,r)}async presubscribe(e,r){if(Wi(r,"mediaType",["audio","video"]),this.store.useP2P)throw new Ae(te.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const s=r===bt.AUDIO,o=r===bt.VIDEO,c=await this._subscribeMutex.lock();try{const{ssrcId:u,ortc:h,rtxSsrcId:m,cname:y,uint_id:E}=await this._gateway.presubscribe(e,r,!0);if(u==null)throw new Ae(te.UNEXPECTED_RESPONSE,"no ssrc id");let S=this._users.find(P=>P.uid===e);S||(S=new Jm(e,E||e),S._is_pre_created=!0,this._users.push(S)),y&&(S._cname=y),S._uintid||(S._uintid=E||e),s&&(S._audioSSRC=u,S._audio_pre_subscribed=!0,h&&(S._audioOrtc=h)),o&&(S._videoSSRC=u,S._video_pre_subscribed=!0,h&&(S._videoOrtc=h),m!=null&&(S._rtxSsrcId=m)),x.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(u)),await this._p2pChannel.subscribe(S,r,u,m,h);const R=s?S._audioTrack:S._videoTrack;if(!R)throw new Ae(te.UNEXPECTED_ERROR,"can not find remote track in user");return s&&(S._trust_audio_stream_added_state_=!0,S._audio_added_=!0),o&&(S._trust_video_stream_added_state_=!0,S._video_added_=!0),R}catch(u){throw x.error("[".concat(this._clientId,"] presub user ").concat(e," error"),u),u}finally{c()}}async _subscribeDataChannel(e,r){var s;if(cr(r,"channelId",0,65535,!0),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(m=>m===e))throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new Ae(te.INVALID_REMOTE_USER,"user is not published");const c=(s=e._dataChannels)===null||s===void 0?void 0:s.find(m=>m.id===r);if(!c)throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new Ae(te.REMOTE_USER_IS_NOT_PUBLISHED);const u=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const m=await this._p2pChannel.subscribeDataChannel(e,[c]);if(m&&ct(m).call(m,c.id))try{var h;if(typeof c._originDataChannelId!="number")throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Ae(te.CREATE_DATACHANNEL_ERROR);const y={id:c.id,datachannelId:c._originDataChannelId,ordered:c.ordered,maxRetransmits:c.maxRetransmits,metadata:(h=c.metadata)!==null&&h!==void 0?h:""};await this._gateway.subscribeDataChannel(e.uid,y,!0),await c._waitTillOpen()}catch(y){if((y==null?void 0:y.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[c]),y;await this._p2pChannel.unsubscribeDataChannel(e,[c]),this._p2pChannel.setPendingRemoteDataChannel(e,c.id)}return x.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),c}finally{u()}}async _p2pSubscribe(e,r,s){if(Wi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(u=>u===e)){const u=new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),u}if(!e.hasAudio&&!e.hasVideo){const u=new Ae(te.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),u}if(!s&&(r==="audio"&&!e.hasAudio||r==="video"&&!e.hasVideo)){const u=new Ae(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),u}const c=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{const h=r==="audio"?e._audioSSRC:e._videoSSRC,m=r==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,r,h,m)}catch(h){throw h}x.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(h=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),h)});const u=r==="audio"?e._audioTrack:e._videoTrack;if(!u)throw new Ae(te.UNEXPECTED_ERROR,"can not find remote track in user object");return u}catch(u){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),u),u}finally{c()}}async _subscribe(e,r,s){if(this.store.useP2P)return this._p2pSubscribe(e,r);if(Wi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(E=>E===e)){const E=new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),E}if(!e.hasAudio&&!e.hasVideo){const E=new Ae(te.INVALID_REMOTE_USER,"user is not published");throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),E}if(!(s||(r!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(r!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const E=new Ae(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),E}let c=r==="audio"?e._audioSSRC:e._videoSSRC,u=r==="audio"?e._audioOrtc:e._videoOrtc,h=r==="video"?e._rtxSsrcId:void 0,m={stream_type:r==="audio"?bt.AUDIO:bt.VIDEO,ssrcId:c};const y=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{const S=r==="audio"?e._audioSSRC:e._videoSSRC;S!==void 0&&S!==c&&(c=S,u=r==="audio"?e._audioOrtc:e._videoOrtc,h=r==="video"?e._rtxSsrcId:void 0,m={stream_type:r==="audio"?bt.AUDIO:bt.VIDEO,ssrcId:c}),Js.markSubscribeStart(this.store.clientId,c),this.store.subscribe(e.uid,r,Date.now()),await this._p2pChannel.subscribe(e,r,c,h,u);try{this._p2pChannel.isPreSubScribe(c)||await this._gateway.subscribe(e.uid,m,!0)}catch(R){if((R==null?void 0:R.code)!==te.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,r),R;await this._p2pChannel.unsubscribe(e,r,!0),this._p2pChannel.setPendingRemoteMedia(e,r)}this.store.subscribe(e.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,r)}catch(S){throw this._p2pChannel.reportSubscribeEvent(!1,S==null?void 0:S.code,e,r),S}x.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(S=>{x.warning("[".concat(this._clientId,"] auto set fallback failed"),S)});const E=r==="audio"?e._audioTrack:e._videoTrack;if(!E)throw new Ae(te.UNEXPECTED_ERROR,"can not find remote track in user object");return E}catch(E){throw x.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),E),E}finally{y()}}async massSubscribe(e){if(lf(e,"subscribeList"),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),s=new Map,o=await this._subscribeMutex.lock();x.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(m=>{let{user:y,mediaType:E}=m;return"user: ".concat(y==null?void 0:y.uid,", mediaType: ").concat(E)}).join("; ")));const c=(e=[...e]).map(m=>{let{user:y,mediaType:E}=m;return{user:y,mediaType:E}}),u=await this._p2pChannel.globalLock();try{var h;for(let y=e.length-1;y>=0;y--){const E=e[y],{user:S,mediaType:R}=E;if(Wi(R,"mediaType",["audio","video"]),!S){const j=new Ae(te.INVALID_PARAMS,"user property does not exist in subscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),j}if(!this._users.find(j=>j===S)){const j=new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");x.error("[".concat(this._clientId,"] can not massSubscribe ").concat(S.uid,", this user is not in the channel")),c[y].error=j,e.splice(y,1);continue}if(R==="audio"&&(!S.hasAudio||S._audioSSRC===void 0)||R==="video"&&(!S.hasVideo||S._videoSSRC===void 0)){const j=new Ae(te.REMOTE_USER_IS_NOT_PUBLISHED);x.error("[".concat(this._clientId,"] can not subscribe ").concat(S.uid," with mediaType ").concat(R,", remote user is not published")),c[y].error=j,e.splice(y,1);continue}const D=Ji.Video|Ji.LwoVideo,G=s.get(S);if(G){if(R==="video"?G&D:G&Ji.Audio){e.splice(y,1),x.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(S.uid,", mediaType:").concat(R," twice"));continue}s.set(S,G|(R==="video"?D:Ji.Audio))}else s.set(S,R==="video"?D:Ji.Audio)}for(let y=e.length-1;y>=0;y--){const E=e[y],{user:S,mediaType:R}=E,P=Ji.Video|Ji.LwoVideo;if(this._p2pChannel.hasRemoteMedia(S,R)){await this._p2pChannel.unmuteRemoteNoLock(S,R);const D=s.get(S);s.set(S,R==="video"?D^P:D^Ji.Audio),e.splice(y,1)}}this.store.massSubscribe(e.map(y=>({userId:y.user.uid,type:y.mediaType})),r);let m=gc(h=Array.from(s.entries())).call(h,(y,E)=>{let[S,R]=E;if(R===0)return y;const P={stream_id:S.uid,stream_type:R};return R&Ji.Audio&&(P.audio_ssrc=S._audioSSRC),R&Ji.Video&&(P.video_ssrc=S._videoSSRC),y.push(P),y},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(E=>{let{user:S,mediaType:R}=E;return{user:S,mediaType:R,ssrcId:R===bt.VIDEO?S._videoSSRC:S._audioSSRC,rtxSsrcId:R===bt.VIDEO?S._rtxSsrcId:void 0}}));const y=new Map;if(m=m.filter(E=>E.video_ssrc&&!this._p2pChannel.isPreSubScribe(E.video_ssrc)||E.audio_ssrc&&!this._p2pChannel.isPreSubScribe(E.audio_ssrc)||!E.video_ssrc&&!E.audio_ssrc),m.length>0){const E=await this._gateway.subscribeAll(m,!0);((E==null?void 0:E.users)||[]).forEach(S=>{let{stream_id:R,video_error_code:P,audio_error_code:D,error_code:G}=S;(P||D||G)&&y.set(R,{video_error_code:P,audio_error_code:D,error_code:G})})}if(Array.from(y.entries()).length>0){const E=[];Array.from(y.entries()).forEach(S=>{let[R,P]=S;const D=this.remoteUsers.find(G=>G.uid===R);if(D){let G;P.error_code||P.video_error_code&&P.audio_error_code?G=void 0:P.video_error_code?G=bt.VIDEO:P.audio_error_code&&(G=bt.AUDIO),E.push({user:D,mediaType:G})}}),E.length>0&&await this._p2pChannel.massUnsubscribeNoLock(E)}for(const E of c){const S=y.get(E.user.uid);if(S){const R=S.error_code||E.mediaType==="audio"&&S.audio_error_code||E.mediaType==="video"&&S.video_error_code;if(R){const P=NT(R);x.error("user:".concat(E.user.uid," mediaType:").concat(E.mediaType," has massSubscribe error ").concat(P.desc)),E.error=new Ae(te.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(P.desc))}}E.error||(E.mediaType==="video"?E.track=E.user.videoTrack:E.track=E.user.audioTrack)}return this.store.massSubscribe(c.filter(E=>!E.error).map(E=>({userId:E.user.uid,type:E.mediaType})),void 0,Date.now()),c.forEach(E=>{var S;Nt.subscribe(this.store.sessionId,{succ:!!E.error,ec:((S=E.error)===null||S===void 0?void 0:S.code)||null,video:E.mediaType===bt.VIDEO,audio:E.mediaType===bt.AUDIO,peerid:E.user.uid,subscribeRequestid:E.mediaType===bt.VIDEO?E.user._videoSSRC:E.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(E.user._videoSSRC)},!0)}),x.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(E=>{let{user:S,mediaType:R}=E;return"user: ".concat(S==null?void 0:S.uid,", mediaType: ").concat(R)}).join("; "))),c}catch(y){throw await this._p2pChannel.massUnsubscribeNoLock(e),y}}finally{u(),o()}}async unsubscribe(e,r,s){if(!(e instanceof Jm)){const u=this.remoteUsers.find(h=>h.uid===e);if(!u)throw new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");e=u}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(e,s)}else await this._unsubscribeDataChannel(e,s);if(r&&Wi(r,"mediaType",["audio","video"]),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(u=>u===e)){const u=new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),u}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(r));const c=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,r);else{const u=await this._p2pChannel.unsubscribe(e,r);u&&await this._gateway.unsubscribe(u,e.uid),r&&r!=="audio"||(e._audio_pre_subscribed=!1),r&&r!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&jA(this._users,e),x.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(r))}}catch(u){if(u.code===te.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),u.toString()),u}finally{c()}}async _unsubscribeDataChannel(e,r){if(r&&cr(r,"id",0,65535,!0),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(c=>c===e)){const c=new Ae(te.INVALID_REMOTE_USER,"user is not in the channel");throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),c}let o;if(typeof r=="number"){const c=e._dataChannels.find(u=>u.id===r);c&&(o=[c])}else o=e._dataChannels;if(o===void 0){const c=new Ae(te.REMOTE_USER_IS_NOT_PUBLISHED);throw x.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(r,", remote datachannel is not published")),c}x.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(o.map(c=>c.id)));try{const c=await this._p2pChannel.unsubscribeDataChannel(e,o);c&&await this._gateway.unsubscribeDataChannel(c,e.uid),x.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(c))}catch(c){if(c.code===te.DISCONNECT_P2P)return void x.warning("disconnecting p2p, abort unsubscribe request.");throw x.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),c.toString()),c}}async massUnsubscribe(e){if(lf(e,"unsubscribeList"),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");x.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(s=>{let{user:o,mediaType:c}=s;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(c,";")}).join())),e=[...e];const r=new Map;for(let s=e.length-1;s>=0;s--){const{user:o,mediaType:c}=e[s];if(!o){const m=new Ae(te.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw x.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),m}if(Wi(c,"mediaType",["video","audio",void 0]),!this._users.find(m=>m===o)){x.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(o.uid,", user is not in the channel")),e.splice(s,1);continue}const h=Ji.Video|Ji.LwoVideo;if(r.has(o)){const m=r.get(o);let y;switch(c){case"video":y=m&h;break;case"audio":y=m&Ji.Audio;break;default:y=m&(Ji.Audio|h)}if(y){x.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(o.uid,",mediaType:").concat(c," twice.")),e.splice(s,1);continue}c?c==="audio"?r.set(o,m|Ji.Audio):c==="video"&&r.set(o,m|h):r.set(o,m|Ji.Audio|h)}else c?c==="audio"?r.set(o,Ji.Audio):c==="video"&&r.set(o,h):r.set(o,Ji.Audio|h)}try{const s=await this._p2pChannel.massUnsubscribe(e);s&&await this._gateway.massUnsubscribe(s),x.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(o=>{let{user:c,mediaType:u}=o;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(u,";")}).join()))}catch(s){if(s.code===te.DISCONNECT_P2P)return void x.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw x.error("[".concat(this._clientId,"] massUnsubscribe error"),s.toString()),s}}async setLowStreamParameter(e){(function(s){if(!s)throw new Le(te.INVALID_PARAMS);Gr(s.width)||Gx(s.width,"streamParameter.width"),Gr(s.height)||Gx(s.height,"streamParameter.height"),Gr(s.framerate)||Gx(s.framerate,"streamParameter.framerate"),Gr(s.bitrate)||cr(s.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&x.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),x.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&e.bitrate&&r.bitrate<e.bitrate&&(e.bitrate=r.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Xe.LocalVideoLowTrack)}async enableDualStream(){if(!Fn().supportDualStream)throw Nt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Ae(te.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Ae(te.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Nt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,Nt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),x.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Xe.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Nt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,Nt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),x.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,r){if(function(o){Wi(o,"role",["audience","host"])}(e),r&&qx(r),this.mode==="rtc"||this.mode==="p2p")throw x.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Ae(te.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&e==="host")throw new Ae(te.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Ae(te.INVALID_OPERATION,"can not set client role to audience when publishing stream");const s=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==s&&oe("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,r),this._config.role=e,this._gateway.reconnect("recover",Ps.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,r),this._config.role=e),x.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(r&&r.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{e&&qx(e),await this._gateway.setClientRole(this._config.role,e),r=!0}catch{}finally{x.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const r=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!r||!r.timestamp)return 0;const s=r.timestamp-Date.now();return Math.abs(s)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?s:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,r){if(hs(e,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new Ae(te.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Ae(te.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Nt.setProxyServer(this._proxyServer),x.setProxyServer(this._proxyServer),x.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(e,r){if(Array.isArray(e)||(e=[e]),!r){if(this.connectionState!=="DISCONNECTED")throw new Ae(te.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Ae(te.INVALID_OPERATION,"You have already set the proxy")}if(bT(e))return this._turnServer={servers:e,mode:"original-manual"},void x.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(e.map(s=>s.urls).join(","),"."));e.forEach(s=>iW(s)),this._turnServer={servers:e,mode:"manual"},x.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new Ae(te.INVALID_OPERATION,"you should set license before join channel");if(hs(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Ae(te.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,x.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new Ae(te.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Ae(te.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let s;switch(e===void 0&&(e=3),e){case 1:case 2:throw new Ae(te.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:s="proxy3";break;case 4:s="proxy4";break;case 5:s="proxy5";break;default:throw new Ae(te.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=s,this.store.cloudProxyServerMode=s,x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Ae(te.INVALID_OPERATION,"Stop proxy server after leave channel");Nt.setProxyServer(),x.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",x.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Ae(te.INVALID_PARAMS,"accessPoints is required.");lf(e.accessPoints.serverList,"accessPoints.serverList"),hs(e.accessPoints.domain,"accessPoints.domain");const r=(P,D)=>{cr(P,D,0,65535,!0)};let s=443;if(e.accessPoints.port&&(r(e.accessPoints.port,"accessPoints.port"),s=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Ae(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");oe("CLOSE_AFB_FOR_LOCAL_AP")&&(sr("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),sr("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,c=e.accessPoints.domain,u=e.accessPoints.serverList.map(P=>o.test(P)?"".concat(P.replace(/\./g,"-"),".").concat(c):P),h=u.map(P=>"".concat(P,":").concat(s));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,sr("WEBCS_DOMAIN",h),sr("WEBCS_DOMAIN_BACKUP_LIST",h),sr("GATEWAY_DOMAINS",[c]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(lf(e.report.hostname,"report.hostname"),sr("EVENT_REPORT_DOMAIN",e.report.hostname[0]),sr("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(sr("EVENT_REPORT_DOMAIN",u[0]),sr("EVENT_REPORT_BACKUP_DOMAIN",u[1]||u[0]));let m=6443;e.report&&e.report.port&&(r(e.report.port,"report.port"),m=e.report.port),sr("STATS_COLLECTOR_PORT",m),e.report?sr("ENABLE_EVENT_REPORT",!0):sr("ENABLE_EVENT_REPORT",!1);let y="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(lf(e.log.hostname,"log.hostname"),y=e.log.hostname[0]):y=u[0];let E=6444;e.log&&e.log.port&&(r(e.log.port,"log.port"),E=e.log.port),sr("LOG_UPLOAD_SERVER","".concat(y,":").concat(E));let S=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(lf(e.cds.hostname,"cds.hostname"),S=e.cds.hostname):S=u;let R=443;e.cds&&e.cds.port&&(r(e.cds.port,"cds.port"),R=e.cds.port),sr("CDS_AP",S.map(P=>"".concat(P,":").concat(R))),e.cds?sr("ENABLE_CONFIG_DISTRIBUTE",!0):sr("ENABLE_CONFIG_DISTRIBUTE",!1),x.info("set local access point v2 success")}setLocalAccessPoints(e,r){if(lf(e,"serverList"),hs(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Ae(te.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const s=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(o=>s.test(o)?"".concat(o.replace(/\./g,"-"),".").concat(r):o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,sr("WEBCS_DOMAIN",e),sr("WEBCS_DOMAIN_BACKUP_LIST",e),sr("GATEWAY_DOMAINS",[r]),sr("EVENT_REPORT_DOMAIN",e[0]),sr("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),sr("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),x.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Wi(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw x.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else x.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,r){Wi(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,r),setTimeout(()=>{const s=this._users.find(o=>o.uid===e);s&&s.videoTrack&&s.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw x.error("[".concat(this._clientId,"] set remote video stream type error"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(e,r)}async setStreamFallbackOption(e,r){Wi(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,r)}catch(s){throw x.error("[".concat(this._clientId,"] set stream fallback option"),s.toString()),s}x.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(e,r)}setEncryptionConfig(e,r,s,o){(function(u){Wi(u,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),hs(r,"secret");const c=["aes-128-gcm2","aes-256-gcm2"];if(ct(c).call(c,e)){if(!s||!(s instanceof Uint8Array&&s.length===32))throw new Ae(te.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(s)throw new Ae(te.INVALID_PARAMS,"current encrypt mode does not need salt");if(o){if(cf(o,"encryptDataStream"),!ct(c).call(c,e))throw new Ae(te.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||x.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=r,s&&(this._encryptionSalt=Wm(s))}async renewToken(e){if(hs(e,"token",1,2047),!this._key||!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const s=await this._renewTokenMutex.lock();try{if(oe("USE_NEW_TOKEN")){x.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const o=await ege(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Pi);x.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:o})}else x.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});x.debug("[".concat(this._clientId,"] renewToken success"))}catch(o){throw this._key=r,this._joinInfo.token=r,x.error("[".concat(this._clientId,"] renewToken failed"),o.toString()),o}finally{s()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?x.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Tn.VOLUME_INDICATOR,e)},oe("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return e.Duration=Math.round(r.duration/1e3),e}async startLiveStreaming(e,r){if(!r){if(this.codec!=="h264")throw new Ae(te.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Ae(te.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Ae(te.LIVE_STREAMING_TASK_CONFLICT);const s=r?hf.TRANSCODE:hf.RAW;return this._createLiveStreamingClient(s).startLiveStreamingTask(e,s)}setLiveTranscoding(e){return this._createLiveStreamingClient(hf.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(s=>s&&s.hasUrl(e));if(!r.length)throw new Ae(te.INVALID_PARAMS,"can not find live streaming url to stop");await ht.all(r.map(s=>s&&s.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){z9(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){z9(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof zT&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var r;let s=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const c=new TextEncoder;e.payload=c.encode(e.payload)}let o=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ct(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(o=!0,e.payload=await async function(c,u,h){var m;const y=gc(m=Array.from(h)).call(m,(j,B)=>j+B,0),E={serverTs:0,seq:bfe++,length:h.length,checkSum:y},S=new Uint8Array(hW(y,2)),R=new ArrayBuffer(zv),P=new DataView(R);P.setUint32(0,E.serverTs),P.setUint16(4,E.seq),P.setUint16(6,E.length),P.setUint16(8,E.checkSum);const D=16-h.length%16;h=aW(h,new Uint8Array(D));const G=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c,tagLength:CW,additionalData:S},u,h);return aW(new Uint8Array(R),new Uint8Array(G))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new Ae(te.INVALID_PARAMS,o?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Yt.DATA_STREAM,{payload:Wm(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-lge},!s)}sendMetadata(e){if(!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Ae(te.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Yt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Wm(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(kfe),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"can not send custom report, not joined");await Nt.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,r){Wi(r.spatialLayer,"spatialLayer",[0,1,2,3]),Wi(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,r)}catch(s){throw x.error("[".concat(this._clientId,"] pick SVC layer failed"),s.toString()),s}}async setRTMConfig(e){const{apRTM:r=!1,rtmFlag:s}=e;if(cf(r,"apRTM"),cr(s,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=s,x.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=s,this._gateway.setRTM2Flag(s)}_reset(){if(x.debug("[".concat(this._clientId,"] reset client")),function(e){const r=tS.indexOf(e);r!==-1&&tS.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=_a.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&_H(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Nt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(r=>r._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new qs("client-publish",this._clientId),this._subscribeMutex=new qs("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,r){var s;const o=e||z_();e?x.debug("[".concat(this._clientId,"] new Session ").concat(o)):x.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(o));const c=e?"":this._sessionId||"";this._sessionId=o,this.store.sessionId=o,Nt.addSid(o);const u={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((s=this._joinInfo)===null||s===void 0?void 0:s.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:c,clientRole:this.role==="audience"?2:1};Nt.sessionInit(this._sessionId,Nu({cname:r.channel,appid:r.appId},u)),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new Ae(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&oe("FORCE_TURN")&&!oe("TURN_ENABLE_TCP")&&!oe("TURN_ENABLE_UDP"))throw new Ae(te.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");x.debug("[".concat(this._clientId,"] publish high stream"));try{const s=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const o=(await s.next()).value;if(o){try{await this._gateway.sendExtensionMessage(ci.PUBLISH,o,!0)}catch(c){throw s.throw(c),c}await s.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const o=(await s.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==te.DISCONNECT_P2P)throw s.throw(u),u}await s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const c of e)c instanceof Cr&&c._encoderConfig&&this._gateway.setVideoProfile(c._encoderConfig).catch(u=>{x.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!c.muted&&c.enabled||await this._p2pChannel.muteLocalTrack(c)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,e),(s==null?void 0:s.code)===te.WS_ABORT)return;throw s}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Ae(te.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Ae(te.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));x.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const s=await this._p2pChannel.publishLowStream(this._lowStreamParameter),o=(await s.next()).value;if(o){var r;let c;try{c=await this._gateway.publish(this._uid,o,!0)}catch(u){if(u.code!==te.DISCONNECT_P2P)throw s.throw(u),u}s.next(((r=c)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(s){if(this._p2pChannel.reportPublishEvent(!1,s==null?void 0:s.code,void 0,!0),(s==null?void 0:s.code)===te.WS_ABORT)return;throw s}}_createLiveStreamingClient(e){const r=()=>{if(!this._joinInfo||!this._appId)return new Ae(te.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const s=(o={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},mf("LiveStreaming").create(o));var o;return s.onLiveStreamError=(c,u)=>{Nt.reportApiInvoke(this._sessionId,{name:Ai.ON_LIVE_STREAM_ERROR,options:[c,u],tag:Hr.TRACER}).onSuccess(),this.safeEmit(Tn.LIVE_STREAMING_ERROR,c,u)},s.onLiveStreamWarning=(c,u)=>{Nt.reportApiInvoke(this._sessionId,{name:Ai.ON_LIVE_STREAM_WARNING,options:[c,u],tag:Hr.TRACER}).onSuccess(),this.safeEmit(Tn.LIVE_STREAMING_WARNING,c,u)},s.on(VL.REQUEST_WORKER_MANAGER_LIST,(c,u,h)=>{if(!this._joinInfo)return h(new Ae(te.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(m,y,E,S){const R=oe("UAP_AP").slice(0,oe("AJAX_REQUEST_CONCURRENT")).map(P=>y.proxyServer?"https://".concat(y.proxyServer,"/ap/?url=").concat(P+"/api/v1?action=uap"):"https://".concat(P,"/api/v1?action=uap"));return await qme(R,m,y,E,S)})(c,this._joinInfo,this._axiosCancelSource.token,Pi).then(u).catch(h)}),s};return e===hf.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Ae(te.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:s}=this.getLocalVideoStats(),o=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:s}},mf("ChannelMediaRelay").create(e));o.on("state",c=>{c===Ya.RELAY_STATE_FAILURE&&o&&o.dispose(),this.safeEmit(Tn.CHANNEL_MEDIA_RELAY_STATE,c)}),o.on("event",c=>{this.safeEmit(Tn.CHANNEL_MEDIA_RELAY_EVENT,c)}),this._channelMediaRelayClient=o,this._statsCollector.onStatsChanged=(c,u)=>{var h;c==="resolution"&&((h=this._channelMediaRelayClient)===null||h===void 0||h.setVideoProfile(u))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,r){const{added:s,deleted:o}=e,c=[];if(r){const u=[];this._users.forEach(h=>{h._dataChannels.forEach(m=>{s.every(y=>y.uid!==h._uintid||y.stream_id!==m.id)&&u.push({uid:h._uintid,stream_id:m.id,ordered:m.ordered,max_retrans_times:m.maxRetransmits,metadata:m.metadata})})}),u.length>0&&this._handleUpdateDataChannel({added:[],deleted:u})}Array.isArray(s)&&s.length>0&&s.forEach(u=>{const{uid:h,stream_id:m,ordered:y,max_retrans_times:E,metadata:S}=u,R=this._users.find(P=>P._uintid===h);if(!R)return void x.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(x.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(h)),ct(c).call(c,R)||c.push(R),R._uintid||(R._uintid=h),R._dataChannels.findIndex(P=>P.id===u.stream_id)===-1){const P={id:m,ordered:!!y,maxRetransmits:E,metadata:S},D=function(G){return C9(G,!0)}(P);R._dataChannels.push(D),x.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),r||this.safeEmit(Tn.USER_PUBLISHED,R,"datachannel",P)}this._p2pChannel.hasPendingRemoteDataChannel(R,u.stream_id)&&(x.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,u.stream_id).catch(P=>{x.error("[".concat(this._clientId,"] resubscribe datachannel error"),P.toString())}))}),r&&(this.safeEmit(Tn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(o)&&o.length>0&&o.forEach(u=>{const{uid:h,stream_id:m}=u,y=this._users.find(S=>S._uintid===h);if(!y)return void x.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const E=y._dataChannels.find(S=>S.id===u.stream_id);E&&(x.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(h)),this._p2pChannel.unsubscribeDataChannel(y,[E]).then(S=>{if(y._dataChannels=y._dataChannels.filter(R=>R!==E),S)return this._gateway.unsubscribeDataChannel(S,y.uid)}),x.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished datachannel ,id:").concat(E.id)),this.safeEmit(Tn.USER_UNPUBLISHED,y,"datachannel",E._config))})}_handleRemoveDataChannels(e){const r=this._users.find(s=>s.uid===e.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){x.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const s=()=>{x.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(o=>{this.safeEmit(Tn.USER_UNPUBLISHED,r,"datachannel",o._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(o=>{if(o)return this._gateway.unsubscribeDataChannel(o,r.uid)}),s()}}else x.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(as.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(e)try{const r=JSON.parse(window.atob(e)),s=Date.now();Object.keys(r).forEach(o=>{const{value:c,type:u,expires:h}=r[o];h&&h<=s||u||kL()||!Object.prototype.hasOwnProperty.call(HA,o)||(Id[o]=c,wr[o]=c,x.debug("Update gateway parameters from config distribute",o,c))})}catch(r){x.error("Error update config from local cache",r.message)}})()}),this._gateway.on(as.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(as.CONNECTION_STATE_CHANGE,(e,r,s)=>{var o;if(s===Yn.FALLBACK)return;const c=()=>{this.safeEmit(Tn.CONNECTION_STATE_CHANGE,e,r,s)};if(Nt.reportApiInvoke(this._sessionId||((o=this._gateway.joinInfo)===null||o===void 0?void 0:o.sid)||null,{name:Ai.CONNECTION_STATE_CHANGE,options:[e,r,s],tag:Hr.TRACER}).onSuccess(JSON.stringify({cur:e,prev:r,reason:s})),x.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void c();if(e==="RECONNECTING")this._users.forEach(h=>{h._trust_in_room_=!1,h._trust_audio_enabled_state_=!1,h._trust_video_enabled_state_=!1,h._trust_audio_mute_state_=!1,h._trust_video_mute_state_=!1,h._trust_audio_stream_added_state_=!1,h._trust_video_stream_added_state_=!1,h._is_pre_created||(h._audio_pre_subscribed||(h._audioSSRC=void 0,h._audioOrtc=void 0),h._video_pre_subscribed||(h._videoSSRC=void 0,h._videoOrtc=void 0,h._rtxSsrcId=void 0),h._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var u;this._streamFallbackTypeCacheMap.forEach((h,m)=>{this._gateway.setStreamFallbackOption(m,h).catch(y=>{x.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),y)})}),this._remoteStreamTypeCacheMap.forEach((h,m)=>{this._gateway.setRemoteVideoStreamType(m,h).catch(y=>{x.warning("[".concat(this._clientId,"] auto set remote stream type failed"),y)})}),this._remoteDefaultVideoStreamType!==void 0&&((u=this._joinInfo)===null||u===void 0?void 0:u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{x.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(h=>{x.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(h))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(h=>!h._trust_in_room_).forEach(h=>{x.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(h.uid)),this._handleUserOffline({uid:h.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(h=>{h._trust_audio_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,bt.AUDIO,!1)),h._trust_video_mute_state_||(x.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(h.uid)),this._handleMuteStream(h.uid,bt.VIDEO,!1)),h._trust_audio_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(h.uid)),this._handleSetStreamLocalEnable("audio",h.uid,!0)),h._trust_video_enabled_state_||(x.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(h.uid)),this._handleSetStreamLocalEnable("video",h.uid,!0)),h._trust_video_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(h.uid)),this._handleResetAddStream(h,"video")),h._trust_audio_stream_added_state_||(x.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(h.uid)),this._handleResetAddStream(h,"audio")),h._video_added_||h._audio_added_||(x.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(h.uid)),this._handleRemoveStream({uid:h.uid,uint_id:h._uintid}))}))},1e3))}c()}),this._gateway.on(as.REQUEST_NEW_GATEWAY_LIST,async(e,r)=>{if(!this._joinInfo)return r(new Ae(te.UNEXPECTED_ERROR,"can not recover, no join info"));try{let s;const o=await mH(Nu(Nu({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));o?(s=o.ap,yH(o),this._joinInfo.preload=!0):(s=await e2(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Pi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=s.gatewayInfo.res,this._joinInfo.gatewayAddrs=s.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=s.gatewayInfo.uni_lbs_ip);const c=[];s.gatewayInfo.gatewayAddrs.forEach(u=>{let{address:h}=u;const[m,y]=h.split(":");this._joinInfo&&this._joinInfo.proxyServer?c.push({proxy:this._joinInfo.proxyServer,host:m,port:y}):c.push({host:m,port:y})}),e(c)}catch(s){r(s)}}),this._gateway.on(as.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Tn.NETWORK_QUALITY,e)}),this._gateway.on(as.STREAM_TYPE_CHANGE,(e,r)=>{this.safeEmit(Tn.STREAM_TYPE_CHANGED,e,r),Nt.reportApiInvoke(this._sessionId,{name:Ai.STREAM_TYPE_CHANGE,options:[e,r],tag:Hr.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:r}))}),this._gateway.on(as.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(as.REQUEST_P2P_CONNECTION_PARAMS,async(e,r,s)=>{try{let o=await this._p2pChannel.getEstablishParams();oe("ENABLE_PREALLOC_PC")&&o||(o=await this._p2pChannel.startP2PConnection(e)),r(o)}catch(o){s(o)}}),this._gateway.on(as.JOIN_RESPONSE,(e,r)=>{if(this.store.useP2P)return;let s;e.attributes?s=e.attributes.userAttributes.preSubSsrcs:x.debug("no attributes in joinResponse");const o=p9(e.ortc,r,s);this._p2pChannel.connect(o)}),this._gateway.on(as.PRE_CONNECT_PC,async e=>{const{candidates:r,fingerprint:s}=e;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){var o;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:c,cid:u}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(u,"_").concat(c),icePwd:"".concat(u,"_").concat(c)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(o=oe("FINGERPRINT"))!==null&&o!==void 0?o:s}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Cn.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Cn.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Cn.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(Cn.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Cn.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Cn.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Cn.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Cn.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Cn.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,bt.AUDIO,!0)),this._gateway.signal.on(Cn.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,bt.AUDIO,!1)),this._gateway.signal.on(Cn.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,bt.VIDEO,!0)),this._gateway.signal.on(Cn.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,bt.VIDEO,!1)),this._gateway.signal.on(Cn.RECEIVE_METADATA,e=>{const r=B_(e.metadata);this.safeEmit(Tn.RECEIVE_METADATA,e.uid,r)}),this._gateway.signal.on(Cn.ON_DATA_STREAM,async e=>{var r;if(!e)return;let s=B_(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&ct(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(e.payload.length<zv)throw new Ae(te.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(zv));s=await async function(u,h,m){const y=m.subarray(0,zv),E=y.slice(8,zv),S=(E[0]<<8)+E[1],R=(y[6]<<8)+y[7],P=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:u,tagLength:CW,additionalData:new Uint8Array(hW(S,2))},h,m.subarray(zv));return new Uint8Array(P).subarray(0,R)}(this._encryptDataStreamIv,this._encryptDataStreamKey,s)}let o=0;if(e.ordered||e.syncWithAudio){const c=this._p2pChannel.getStats(),u=this.remoteUsers.find(m=>m.uid===e.uid),h=c==null?void 0:c.audioRecv.find(m=>m.ssrc===(u==null?void 0:u._audioSSRC));o=h==null?void 0:h.jitterBufferMs}(o==null||Number.isNaN(o))&&(o=0),dge(Nu(Nu({},e),{},{payload:s}),o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Cn.ON_CRYPT_ERROR,()=>{zm(()=>{x.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Tn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Cn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{x.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Yn.TOKEN_EXPIRE),this.safeEmit(Tn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Cn.ON_STREAM_FALLBACK_UPDATE,e=>{x.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Tn.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Cn.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),x.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Cn.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Cn.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Jt.REQUEST_TIMEOUT,(e,r)=>{if(this._joinInfo)switch(e){case Yt.PUBLISH:{if(!r)return;const c=r.ortc;if(c){var s,o;const u=c.some(y=>{let{stream_type:E}=y;return E===Qn.Audio}),h=c.some(y=>{let{stream_type:E}=y;return E!==Qn.Audio}),m=c.some(y=>{let{stream_type:E}=y;return E===Qn.Screen||E===Qn.ScreenLow});r.state==="offer"&&Nt.publish(this._joinInfo.sid,{eventElapse:Js.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:te.TIMEOUT,audio:u,video:h,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(s=c.find(y=>{let{stream_type:E}=y;return E===Qn.Audio}))===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId.toString():void 0,videoName:h?(o=c.find(y=>{let{stream_type:E}=y;return E!==Qn.Audio}))===null||o===void 0||(o=o.ssrcs[0])===null||o===void 0?void 0:o.ssrcId.toString():void 0})}break}case Yt.SUBSCRIBE:r&&Nt.subscribe(this._joinInfo.sid,{succ:!1,ec:te.TIMEOUT,audio:r.stream_type===bt.AUDIO,video:r.stream_type===bt.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:Js.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(Cn.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Cn.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;oe("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(o=>!X_(o.string_id||o.stream_id,this.channelName)));const r=[],s=[];for(const o of e.users){let c=this._users.find(S=>S._uintid===o.stream_id);c?c._trust_in_room_=!0:(c=new Jm(o.string_id||o.stream_id,o.stream_id),this._users.push(c),this.getListeners(Tn.PUBLISHED_USER_LIST).length===0&&(x.debug("[".concat(this._clientId,"] user online"),o.stream_id),this.safeEmit(Tn.USER_JOINED,c)));const u=Ji.Audio&o.stream_type,h=(Ji.Video|Ji.LwoVideo)&o.stream_type,m=(65280&o.stream_type)!=0,y=u&&c.hasAudio,E=h&&c.hasVideo;h&&(c._trust_video_stream_added_state_=!0,c._video_added_=!0,c._videoSSRC=o.video_ssrc,c._rtxSsrcId=o.video_rtx),u&&(c._trust_audio_stream_added_state_=!0,c._audio_added_=!0,c._audioSSRC=o.audio_ssrc),u&&!y&&this.getListeners(Tn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published audio")),this.safeEmit(Tn.USER_PUBLISHED,c,"audio")),h&&!E&&this.getListeners(Tn.PUBLISHED_USER_LIST).length===0&&(x.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published video")),this.safeEmit(Tn.USER_PUBLISHED,c,"video")),(u&&!y||h&&!E||m)&&r.push(c),h&&this._p2pChannel.hasPendingRemoteMedia(c,"video")&&s.push({user:c,mediaType:"video"}),u&&this._p2pChannel.hasPendingRemoteMedia(c,"audio")&&s.push({user:c,mediaType:"audio"})}s.length>0&&(x.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(s.map(o=>"user: ".concat(o.user.uid,", mediaType: ").concat(o.mediaType)).join("; ")," ")),this.massSubscribe(s).catch(o=>{x.error("[".concat(this._clientId,"] mass resubscribe error"),o.toString())})),this.getListeners(Tn.PUBLISHED_USER_LIST).length>0?oe("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(x.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(o=>o.uid).join(", "))),this.safeEmit(Tn.PUBLISHED_USER_LIST,r)):x.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(o=>o.uid).join(", ")))}),this._gateway.signal.on(Cn.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:r}=e;this._p2pChannel instanceof zT&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(s=>s.toLowerCase()).filter(s=>{var o;return ct(o=Object.keys($A)).call(o,s)}))})}_handleP2PEvents(){this._gateway.signal.on(Cn.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(ci.PUBLISH,(e,r,s)=>{const{uid:o}=e;e.forEach(c=>{const{kind:u,ssrcs:h,mid:m,isMuted:y}=c;this._handleP2PAddAudioOrVideoStream(u,o,h[0].ssrcId,m);const E=this._users.find(S=>S.uid===o);return E&&this.store.useP2P?this._p2pChannel.mockSubscribe(E,u,h[0].ssrcId,m).then(()=>{r()}).catch(s):r(),this._handleMuteStream(o,u,!!y)})}),this._gateway.signal.on(ci.CALL,async(e,r,s)=>{if(this.store.useP2P)try{var o;r(await this._p2pChannel.startP2P({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},e))}catch(c){s(c)}}),this._gateway.signal.on(Jt.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(ci.UNPUBLISH,async(e,r,s)=>{if(this.store.useP2P){const{unpubMsg:o,uid:c}=e,u=this._users.find(h=>h.uid===c);if(!u)return x.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(c)),void r();try{o.forEach(async h=>{let{stream_type:m}=h;const y=m===Qn.Audio?bt.AUDIO:bt.VIDEO;await this._p2pChannel.unsubscribe(u,y),this._handleMuteStream(c,y,!0)}),r()}catch(h){s(h)}}}),this._gateway.signal.on(ci.CONTROL,async(e,r)=>{const{action:s}=e;switch(s){case $m.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,bt.VIDEO,!0);break;case $m.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,bt.AUDIO,!0);break;case $m.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,bt.VIDEO,!1);break;case $m.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,bt.AUDIO,!1)}}),this._gateway.signal.on(ci.RESTART_ICE,async(e,r,s)=>{if(this.store.useP2P)try{const{direction:o,iceParameter:c}=e;o!==qo.SEND_ONLY||c?r(await this._p2pChannel.restartICE(o,c)):(this._p2pChannel.handleDisconnect(o),r())}catch(o){s(o)}}),this._gateway.signal.on(ci.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:r,direction:s}=e;this._p2pChannel.addRemoteCandidate(r,s)}}),this._p2pChannel.on(jt.RequestP2PRestartICE,async(e,r,s)=>{try{const{direction:o}=e;r(await this._gateway.sendExtensionMessage(ci.RESTART_ICE,e,o===qo.SEND_ONLY))}catch(o){s(o)}}),this._p2pChannel.on(jt.LocalCandidate,e=>{this._gateway.sendExtensionMessage(ci.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(jt.RequestP2PMuteLocal,async(e,r,s)=>{try{await this._gateway.sendExtensionMessage(ci.CONTROL,e,!0),r()}catch(o){s(o)}}),this._p2pChannel.on(jt.RequestP2PUnmuteRemote,async(e,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===te.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(jt.RequestP2PMuteRemote,async(e,r,s)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===te.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(jt.StateChange,(e,r)=>{r===Xn.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(jt.PeerConnectionStateChange,e=>{const r=this._peerConnectionState;e!==r&&(this.safeEmit(Tn.PEERCONNECTION_STATE_CHANGE,e,r),this._peerConnectionState=e)}),this._p2pChannel.on(jt.RequestMuteLocal,async(e,r,s)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===te.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(jt.RequestUnmuteLocal,async(e,r,s)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(o){o.code===te.DISCONNECT_P2P?r():s(o)}else r()}),this._p2pChannel.on(jt.RequestRePublish,(e,r,s)=>{this.publish(e,!1).then(r).catch(s)}),this._p2pChannel.on(jt.RequestRePublishDataChannel,(e,r,s)=>{ht.all(e.map(async o=>{const c=await this._p2pChannel.publishDataChannel([o]);try{c.forEach(u=>{this._uid&&this._gateway.publishDataChannel(this._uid,u,!0)})}catch(u){if(u.code!==te.DISCONNECT_P2P)throw u}})).then(r).catch(s)}),this._p2pChannel.on(jt.RequestReSubscribe,async(e,r,s)=>{try{for(const{user:o,kind:c}of e)c===bt.VIDEO?await this.subscribe(o,"video"):await this.subscribe(o,"audio");r()}catch(o){s(o)}}),this._p2pChannel.on(jt.RequestUpload,(e,r)=>{this._gateway.upload(e,r)}),this._p2pChannel.on(jt.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(jt.MediaReconnectStart,e=>{this.safeEmit(Tn.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(jt.MediaReconnectEnd,e=>{this.safeEmit(Tn.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(jt.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(jt.RequestRestartICE,async e=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(e),s=await r.next();if(s.done)return;const o=s.value;let c;try{c=await this._gateway.restartICE({iceParameters:o})}catch(h){return void r.throw(h)}const{iceParameters:u}=function(h){const m=h.iceParameters;return{iceParameters:{iceUfrag:m.iceUfrag,icePwd:m.icePwd}}}(c);await r.next({remoteIceParameters:u})}),this._p2pChannel.on(jt.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(jt.RequestReconnectPC,async()=>{var e;const{iceParameters:r,dtlsParameters:s,rtpCapabilities:o}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:c,gatewayAddress:u}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:s,rtpCapabilities:o}),h=p9(c,u);await this._p2pChannel.connect(h),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(jt.RequestUnpublishForReconnectPC,async(e,r,s)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),r()):s()}),this._p2pChannel.on(jt.P2PLost,()=>{this.safeEmit(Tn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(jt.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(jt.ConnectionTypeChange,e=>{this.safeEmit(Tn.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(jt.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(jt.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(jt.AudioMetadata,e=>{this.safeEmit(Tn.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const s=(r={config:e},mf("ContentInspect").create(r));this._inspect=s,this.handleVideoInspectEvents(s);const{appId:o,cname:c,sid:u,token:h,uid:m,cid:y,vid:E}=this._joinInfo;await s.init({appId:o,areaCode:"",cname:c,sid:u,token:h,uid:m,cid:y,vid:E?Number(E):0},Pi)}catch(s){throw Array.isArray(s)?s[0]:s}var r}handleVideoInspectEvents(e){e.on(cs.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(Tn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,s),s===Au.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Tn.CONTENT_INSPECT_ERROR,new Ae(te.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(cs.INSPECT_RESULT,(r,s)=>{var o;if((s==null?void 0:s.code)===te.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return x.debug("Stop inspect content because that has left channel"),this==null||(o=this._inspect)===null||o===void 0||o.close(),void(this._inspect=void 0);this.safeEmit(Tn.CONTENT_INSPECT_RESULT,r,s)}),e.on(cs.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,r){if(cf(e,"enabled"),e){if(!r)throw new Ae(te.INVALID_PARAMS,"config is required");if(kH(r),!this._joinInfo)throw new Ae(te.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const o=(s={config:r},mf("ImageModeration").create(s));this._moderation=o,this.handleImageModerationEvents(o);const{appId:c,cname:u,sid:h,token:m,uid:y,cid:E,vid:S}=this._joinInfo;await o.init({appId:c,areaCode:"",cname:u,sid:h,token:m,uid:y,cid:E,vid:S?Number(S):0},Pi)}}catch(o){throw Array.isArray(o)?o[0]:o}}else{var s;if(!this._moderation)throw new Ae(te.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(o){throw Array.isArray(o)?o[0]:o}}}handleImageModerationEvents(e){e.on(Od.CONNECTION_STATE_CHANGE,(r,s)=>{if(this.safeEmit(Tn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,s),r===Ml.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Ae(te.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Od.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(s=>s.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(r){Wi(r,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new Ae(te.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,x.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return x.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){cf(e,"enabled"),sr("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,r){switch(r){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},It(_t.prototype,"leave",[NH],Object.getOwnPropertyDescriptor(_t.prototype,"leave"),_t.prototype),It(_t.prototype,"publish",[DH],Object.getOwnPropertyDescriptor(_t.prototype,"publish"),_t.prototype),It(_t.prototype,"unpublish",[xH],Object.getOwnPropertyDescriptor(_t.prototype,"unpublish"),_t.prototype),It(_t.prototype,"subscribe",[LH],Object.getOwnPropertyDescriptor(_t.prototype,"subscribe"),_t.prototype),It(_t.prototype,"presubscribe",[MH],Object.getOwnPropertyDescriptor(_t.prototype,"presubscribe"),_t.prototype),It(_t.prototype,"massSubscribe",[UH],Object.getOwnPropertyDescriptor(_t.prototype,"massSubscribe"),_t.prototype),It(_t.prototype,"unsubscribe",[VH],Object.getOwnPropertyDescriptor(_t.prototype,"unsubscribe"),_t.prototype),It(_t.prototype,"massUnsubscribe",[jH],Object.getOwnPropertyDescriptor(_t.prototype,"massUnsubscribe"),_t.prototype),It(_t.prototype,"setLowStreamParameter",[FH],Object.getOwnPropertyDescriptor(_t.prototype,"setLowStreamParameter"),_t.prototype),It(_t.prototype,"enableDualStream",[BH],Object.getOwnPropertyDescriptor(_t.prototype,"enableDualStream"),_t.prototype),It(_t.prototype,"disableDualStream",[zH],Object.getOwnPropertyDescriptor(_t.prototype,"disableDualStream"),_t.prototype),It(_t.prototype,"setClientRole",[WH],Object.getOwnPropertyDescriptor(_t.prototype,"setClientRole"),_t.prototype),It(_t.prototype,"_setClientRoleOptions",[GH],Object.getOwnPropertyDescriptor(_t.prototype,"_setClientRoleOptions"),_t.prototype),It(_t.prototype,"setProxyServer",[HH],Object.getOwnPropertyDescriptor(_t.prototype,"setProxyServer"),_t.prototype),It(_t.prototype,"setTurnServer",[$H],Object.getOwnPropertyDescriptor(_t.prototype,"setTurnServer"),_t.prototype),It(_t.prototype,"setLicense",[KH],Object.getOwnPropertyDescriptor(_t.prototype,"setLicense"),_t.prototype),It(_t.prototype,"startProxyServer",[qH],Object.getOwnPropertyDescriptor(_t.prototype,"startProxyServer"),_t.prototype),It(_t.prototype,"stopProxyServer",[YH],Object.getOwnPropertyDescriptor(_t.prototype,"stopProxyServer"),_t.prototype),It(_t.prototype,"setLocalAccessPointsV2",[XH],Object.getOwnPropertyDescriptor(_t.prototype,"setLocalAccessPointsV2"),_t.prototype),It(_t.prototype,"setLocalAccessPoints",[JH],Object.getOwnPropertyDescriptor(_t.prototype,"setLocalAccessPoints"),_t.prototype),It(_t.prototype,"setRemoteDefaultVideoStreamType",[QH],Object.getOwnPropertyDescriptor(_t.prototype,"setRemoteDefaultVideoStreamType"),_t.prototype),It(_t.prototype,"setRemoteVideoStreamType",[ZH],Object.getOwnPropertyDescriptor(_t.prototype,"setRemoteVideoStreamType"),_t.prototype),It(_t.prototype,"setStreamFallbackOption",[e$],Object.getOwnPropertyDescriptor(_t.prototype,"setStreamFallbackOption"),_t.prototype),It(_t.prototype,"setEncryptionConfig",[t$],Object.getOwnPropertyDescriptor(_t.prototype,"setEncryptionConfig"),_t.prototype),It(_t.prototype,"renewToken",[n$],Object.getOwnPropertyDescriptor(_t.prototype,"renewToken"),_t.prototype),It(_t.prototype,"enableAudioVolumeIndicator",[r$],Object.getOwnPropertyDescriptor(_t.prototype,"enableAudioVolumeIndicator"),_t.prototype),It(_t.prototype,"startLiveStreaming",[i$],Object.getOwnPropertyDescriptor(_t.prototype,"startLiveStreaming"),_t.prototype),It(_t.prototype,"setLiveTranscoding",[s$],Object.getOwnPropertyDescriptor(_t.prototype,"setLiveTranscoding"),_t.prototype),It(_t.prototype,"stopLiveStreaming",[o$],Object.getOwnPropertyDescriptor(_t.prototype,"stopLiveStreaming"),_t.prototype),It(_t.prototype,"startChannelMediaRelay",[a$],Object.getOwnPropertyDescriptor(_t.prototype,"startChannelMediaRelay"),_t.prototype),It(_t.prototype,"updateChannelMediaRelay",[c$],Object.getOwnPropertyDescriptor(_t.prototype,"updateChannelMediaRelay"),_t.prototype),It(_t.prototype,"stopChannelMediaRelay",[l$],Object.getOwnPropertyDescriptor(_t.prototype,"stopChannelMediaRelay"),_t.prototype),It(_t.prototype,"sendCustomReportMessage",[u$],Object.getOwnPropertyDescriptor(_t.prototype,"sendCustomReportMessage"),_t.prototype),It(_t.prototype,"pickSVCLayer",[d$],Object.getOwnPropertyDescriptor(_t.prototype,"pickSVCLayer"),_t.prototype),It(_t.prototype,"setRTMConfig",[h$],Object.getOwnPropertyDescriptor(_t.prototype,"setRTMConfig"),_t.prototype),It(_t.prototype,"enableContentInspect",[p$],Object.getOwnPropertyDescriptor(_t.prototype,"enableContentInspect"),_t.prototype),It(_t.prototype,"disableContentInspect",[f$],Object.getOwnPropertyDescriptor(_t.prototype,"disableContentInspect"),_t.prototype),It(_t.prototype,"setImageModeration",[m$],Object.getOwnPropertyDescriptor(_t.prototype,"setImageModeration"),_t.prototype),It(_t.prototype,"setP2PTransport",[g$],Object.getOwnPropertyDescriptor(_t.prototype,"setP2PTransport"),_t.prototype),It(_t.prototype,"getJoinChannelServiceRecords",[_$],Object.getOwnPropertyDescriptor(_t.prototype,"getJoinChannelServiceRecords"),_t.prototype),It(_t.prototype,"setPublishAudioFilterEnabled",[y$],Object.getOwnPropertyDescriptor(_t.prototype,"setPublishAudioFilterEnabled"),_t.prototype),_t);class HT{constructor(r,s){q(this,"id",0),q(this,"element",void 0),q(this,"peerPair",void 0),q(this,"context",void 0),q(this,"audioPlayerElement",void 0),q(this,"audioTrack",void 0),HT.count+=1,this.id=HT.count,this.element=r,this.context=s}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const s=document.createElement("audio");s.srcObject=new MediaStream([r.track]),s.play(),this.audioPlayerElement=s}}async switchSdp(){if(!this.peerPair)return;const r=async(o,c)=>{const u=c==="offer"?await o.createOffer():await o.createAnswer();return await o.setLocalDescription(u),o.iceGatheringState==="complete"?o.localDescription:new ht(h=>{o.onicegatheringstatechange=()=>{o.iceGatheringState==="complete"&&h(o.localDescription)}})},s=async(o,c)=>await o.setRemoteDescription(c);try{const o=await r(this.peerPair[0],"offer");await s(this.peerPair[1],o);const c=await r(this.peerPair[1],"answer");await s(this.peerPair[0],c)}catch(o){throw new Ae(te.LOCAL_AEC_ERROR,o.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let s;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),s=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(s)}catch(c){throw new Ae(te.LOCAL_AEC_ERROR,c.toString()).print()}if(!s)throw new Ae(te.LOCAL_AEC_ERROR,"no dest node when local aec").print();const o=s.stream.getAudioTracks()[0];return this.audioTrack=o,o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,s=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(s),await this.switchSdp()}close(){x.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var v$,VP;q(HT,"count",0);const Age=window.AudioContext||window.webkitAudioContext,Pge=new(v$=Ht({report:Nt}),It((VP=class{constructor(){q(this,"units",[]),q(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return x.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Age);let r=this.units.find(s=>s&&s.getElement()===e);return r||(r=new HT(e,this.context),this.units.push(r)),r.startEchoCancellation(),x.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return xn().name!==Hn.SAFARI}}).prototype,"processExternalMediaAEC",[v$],Object.getOwnPropertyDescriptor(VP.prototype,"processExternalMediaAEC"),VP.prototype),VP);function S$(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function b$(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?S$(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):S$(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}const g2=window||document;function T$(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!g2)return;const s=Oi._cspEventHandlerPointer;if(s&&r)return void console.error(s,r);const o=c=>{if(!(c&&c.blockedURI&&(Oi.onSecurityPolicyViolation||Oi.getListeners(kh.SECURITY_POLICY_VIOLATION).length>0)))return;const u=c.blockedURI;oe("CSP_DETECTED_HOSTNAME_LIST").some(h=>ct(u).call(u,h))&&(Oi.onSecurityPolicyViolation&&typeof Oi.onSecurityPolicyViolation=="function"&&Oi.onSecurityPolicyViolation(c),Oi.getListeners(kh.SECURITY_POLICY_VIOLATION).length>0&&Oi.safeEmit(kh.SECURITY_POLICY_VIOLATION,c))};s&&g2.removeEventListener("securitypolicyviolation",s),(r||e&&typeof e=="function"||Oi.getListeners(kh.SECURITY_POLICY_VIOLATION).length>0)&&g2.addEventListener("securitypolicyviolation",o),Oi._cspEventHandlerPointer=o}var Oge=O,kge=oz,w$=RegExp.prototype,Nge=function(e){return e===w$||Oge(w$,e)?kge(e):e.flags},Ao=l(Nge);function mS(e){let r=e.length;for(;--r>=0;)e[r]=0}const _2=256,C$=286,$T=30,KT=15,y2=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),jP=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Dge=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),R$=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),yf=new Array(576);mS(yf);const qT=new Array(60);mS(qT);const YT=new Array(512);mS(YT);const XT=new Array(256);mS(XT);const E2=new Array(29);mS(E2);const FP=new Array($T);function v2(e,r,s,o,c){this.static_tree=e,this.extra_bits=r,this.extra_base=s,this.elems=o,this.max_length=c,this.has_stree=e&&e.length}let I$,A$,P$;function S2(e,r){this.dyn_tree=e,this.max_code=0,this.stat_desc=r}mS(FP);const O$=e=>e<256?YT[e]:YT[256+(e>>>7)],JT=(e,r)=>{e.pending_buf[e.pending++]=255&r,e.pending_buf[e.pending++]=r>>>8&255},cl=(e,r,s)=>{e.bi_valid>16-s?(e.bi_buf|=r<<e.bi_valid&65535,JT(e,e.bi_buf),e.bi_buf=r>>16-e.bi_valid,e.bi_valid+=s-16):(e.bi_buf|=r<<e.bi_valid&65535,e.bi_valid+=s)},Mh=(e,r,s)=>{cl(e,s[2*r],s[2*r+1])},k$=(e,r)=>{let s=0;do s|=1&e,e>>>=1,s<<=1;while(--r>0);return s>>>1},N$=(e,r,s)=>{const o=new Array(16);let c,u,h=0;for(c=1;c<=KT;c++)h=h+s[c-1]<<1,o[c]=h;for(u=0;u<=r;u++){let m=e[2*u+1];m!==0&&(e[2*u]=k$(o[m]++,m))}},D$=e=>{let r;for(r=0;r<C$;r++)e.dyn_ltree[2*r]=0;for(r=0;r<$T;r++)e.dyn_dtree[2*r]=0;for(r=0;r<19;r++)e.bl_tree[2*r]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},x$=e=>{e.bi_valid>8?JT(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},L$=(e,r,s,o)=>{const c=2*r,u=2*s;return e[c]<e[u]||e[c]===e[u]&&o[r]<=o[s]},b2=(e,r,s)=>{const o=e.heap[s];let c=s<<1;for(;c<=e.heap_len&&(c<e.heap_len&&L$(r,e.heap[c+1],e.heap[c],e.depth)&&c++,!L$(r,o,e.heap[c],e.depth));)e.heap[s]=e.heap[c],s=c,c<<=1;e.heap[s]=o},M$=(e,r,s)=>{let o,c,u,h,m=0;if(e.sym_next!==0)do o=255&e.pending_buf[e.sym_buf+m++],o+=(255&e.pending_buf[e.sym_buf+m++])<<8,c=e.pending_buf[e.sym_buf+m++],o===0?Mh(e,c,r):(u=XT[c],Mh(e,u+_2+1,r),h=y2[u],h!==0&&(c-=E2[u],cl(e,c,h)),o--,u=O$(o),Mh(e,u,s),h=jP[u],h!==0&&(o-=FP[u],cl(e,o,h)));while(m<e.sym_next);Mh(e,256,r)},T2=(e,r)=>{const s=r.dyn_tree,o=r.stat_desc.static_tree,c=r.stat_desc.has_stree,u=r.stat_desc.elems;let h,m,y,E=-1;for(e.heap_len=0,e.heap_max=573,h=0;h<u;h++)s[2*h]!==0?(e.heap[++e.heap_len]=E=h,e.depth[h]=0):s[2*h+1]=0;for(;e.heap_len<2;)y=e.heap[++e.heap_len]=E<2?++E:0,s[2*y]=1,e.depth[y]=0,e.opt_len--,c&&(e.static_len-=o[2*y+1]);for(r.max_code=E,h=e.heap_len>>1;h>=1;h--)b2(e,s,h);y=u;do h=e.heap[1],e.heap[1]=e.heap[e.heap_len--],b2(e,s,1),m=e.heap[1],e.heap[--e.heap_max]=h,e.heap[--e.heap_max]=m,s[2*y]=s[2*h]+s[2*m],e.depth[y]=(e.depth[h]>=e.depth[m]?e.depth[h]:e.depth[m])+1,s[2*h+1]=s[2*m+1]=y,e.heap[1]=y++,b2(e,s,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((S,R)=>{const P=R.dyn_tree,D=R.max_code,G=R.stat_desc.static_tree,j=R.stat_desc.has_stree,B=R.stat_desc.extra_bits,Y=R.stat_desc.extra_base,ee=R.stat_desc.max_length;let fe,ye,Ee,_e,Ne,Ze,pt=0;for(_e=0;_e<=KT;_e++)S.bl_count[_e]=0;for(P[2*S.heap[S.heap_max]+1]=0,fe=S.heap_max+1;fe<573;fe++)ye=S.heap[fe],_e=P[2*P[2*ye+1]+1]+1,_e>ee&&(_e=ee,pt++),P[2*ye+1]=_e,ye>D||(S.bl_count[_e]++,Ne=0,ye>=Y&&(Ne=B[ye-Y]),Ze=P[2*ye],S.opt_len+=Ze*(_e+Ne),j&&(S.static_len+=Ze*(G[2*ye+1]+Ne)));if(pt!==0){do{for(_e=ee-1;S.bl_count[_e]===0;)_e--;S.bl_count[_e]--,S.bl_count[_e+1]+=2,S.bl_count[ee]--,pt-=2}while(pt>0);for(_e=ee;_e!==0;_e--)for(ye=S.bl_count[_e];ye!==0;)Ee=S.heap[--fe],Ee>D||(P[2*Ee+1]!==_e&&(S.opt_len+=(_e-P[2*Ee+1])*P[2*Ee],P[2*Ee+1]=_e),ye--)}})(e,r),N$(s,E,e.bl_count)},U$=(e,r,s)=>{let o,c,u=-1,h=r[1],m=0,y=7,E=4;for(h===0&&(y=138,E=3),r[2*(s+1)+1]=65535,o=0;o<=s;o++)c=h,h=r[2*(o+1)+1],++m<y&&c===h||(m<E?e.bl_tree[2*c]+=m:c!==0?(c!==u&&e.bl_tree[2*c]++,e.bl_tree[32]++):m<=10?e.bl_tree[34]++:e.bl_tree[36]++,m=0,u=c,h===0?(y=138,E=3):c===h?(y=6,E=3):(y=7,E=4))},V$=(e,r,s)=>{let o,c,u=-1,h=r[1],m=0,y=7,E=4;for(h===0&&(y=138,E=3),o=0;o<=s;o++)if(c=h,h=r[2*(o+1)+1],!(++m<y&&c===h)){if(m<E)do Mh(e,c,e.bl_tree);while(--m!=0);else c!==0?(c!==u&&(Mh(e,c,e.bl_tree),m--),Mh(e,16,e.bl_tree),cl(e,m-3,2)):m<=10?(Mh(e,17,e.bl_tree),cl(e,m-3,3)):(Mh(e,18,e.bl_tree),cl(e,m-11,7));m=0,u=c,h===0?(y=138,E=3):c===h?(y=6,E=3):(y=7,E=4)}};let j$=!1;const F$=(e,r,s,o)=>{cl(e,0+(o?1:0),3),x$(e),JT(e,s),JT(e,~s),s&&e.pending_buf.set(e.window.subarray(r,r+s),e.pending),e.pending+=s};var xge=e=>{j$||((()=>{let r,s,o,c,u;const h=new Array(16);for(o=0,c=0;c<28;c++)for(E2[c]=o,r=0;r<1<<y2[c];r++)XT[o++]=c;for(XT[o-1]=c,u=0,c=0;c<16;c++)for(FP[c]=u,r=0;r<1<<jP[c];r++)YT[u++]=c;for(u>>=7;c<$T;c++)for(FP[c]=u<<7,r=0;r<1<<jP[c]-7;r++)YT[256+u++]=c;for(s=0;s<=KT;s++)h[s]=0;for(r=0;r<=143;)yf[2*r+1]=8,r++,h[8]++;for(;r<=255;)yf[2*r+1]=9,r++,h[9]++;for(;r<=279;)yf[2*r+1]=7,r++,h[7]++;for(;r<=287;)yf[2*r+1]=8,r++,h[8]++;for(N$(yf,287,h),r=0;r<$T;r++)qT[2*r+1]=5,qT[2*r]=k$(r,5);I$=new v2(yf,y2,257,C$,KT),A$=new v2(qT,jP,0,$T,KT),P$=new v2(new Array(0),Dge,0,19,7)})(),j$=!0),e.l_desc=new S2(e.dyn_ltree,I$),e.d_desc=new S2(e.dyn_dtree,A$),e.bl_desc=new S2(e.bl_tree,P$),e.bi_buf=0,e.bi_valid=0,D$(e)},Lge=(e,r,s,o)=>{let c,u,h=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(m=>{let y,E=4093624447;for(y=0;y<=31;y++,E>>>=1)if(1&E&&m.dyn_ltree[2*y]!==0)return 0;if(m.dyn_ltree[18]!==0||m.dyn_ltree[20]!==0||m.dyn_ltree[26]!==0)return 1;for(y=32;y<_2;y++)if(m.dyn_ltree[2*y]!==0)return 1;return 0})(e)),T2(e,e.l_desc),T2(e,e.d_desc),h=(m=>{let y;for(U$(m,m.dyn_ltree,m.l_desc.max_code),U$(m,m.dyn_dtree,m.d_desc.max_code),T2(m,m.bl_desc),y=18;y>=3&&m.bl_tree[2*R$[y]+1]===0;y--);return m.opt_len+=3*(y+1)+5+5+4,y})(e),c=e.opt_len+3+7>>>3,u=e.static_len+3+7>>>3,u<=c&&(c=u)):c=u=s+5,s+4<=c&&r!==-1?F$(e,r,s,o):e.strategy===4||u===c?(cl(e,2+(o?1:0),3),M$(e,yf,qT)):(cl(e,4+(o?1:0),3),((m,y,E,S)=>{let R;for(cl(m,y-257,5),cl(m,E-1,5),cl(m,S-4,4),R=0;R<S;R++)cl(m,m.bl_tree[2*R$[R]+1],3);V$(m,m.dyn_ltree,y-1),V$(m,m.dyn_dtree,E-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,h+1),M$(e,e.dyn_ltree,e.dyn_dtree)),D$(e),o&&x$(e)},Mge=(e,r,s)=>(e.pending_buf[e.sym_buf+e.sym_next++]=r,e.pending_buf[e.sym_buf+e.sym_next++]=r>>8,e.pending_buf[e.sym_buf+e.sym_next++]=s,r===0?e.dyn_ltree[2*s]++:(e.matches++,r--,e.dyn_ltree[2*(XT[s]+_2+1)]++,e.dyn_dtree[2*O$(r)]++),e.sym_next===e.sym_end),Uge=e=>{cl(e,2,3),Mh(e,256,yf),(r=>{r.bi_valid===16?(JT(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(e)},Vge={_tr_init:xge,_tr_stored_block:F$,_tr_flush_block:Lge,_tr_tally:Mge,_tr_align:Uge},QT=(e,r,s,o)=>{let c=65535&e|0,u=e>>>16&65535|0,h=0;for(;s!==0;){h=s>2e3?2e3:s,s-=h;do c=c+r[o++]|0,u=u+c|0;while(--h);c%=65521,u%=65521}return c|u<<16|0};const jge=new Uint32Array((()=>{let e,r=[];for(var s=0;s<256;s++){e=s;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;r[s]=e}return r})());var Xo=(e,r,s,o)=>{const c=jge,u=o+s;e^=-1;for(let h=o;h<u;h++)e=e>>>8^c[255&(e^r[h])];return-1^e},sy={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},BP={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Fge,_tr_stored_block:w2,_tr_flush_block:Bge,_tr_tally:tg,_tr_align:zge}=Vge,{Z_NO_FLUSH:ng,Z_PARTIAL_FLUSH:Wge,Z_FULL_FLUSH:Gge,Z_FINISH:Du,Z_BLOCK:B$,Z_OK:ba,Z_STREAM_END:z$,Z_STREAM_ERROR:Uh,Z_DATA_ERROR:Hge,Z_BUF_ERROR:C2,Z_DEFAULT_COMPRESSION:$ge,Z_FILTERED:Kge,Z_HUFFMAN_ONLY:zP,Z_RLE:qge,Z_FIXED:Yge,Z_DEFAULT_STRATEGY:Xge,Z_UNKNOWN:Jge,Z_DEFLATED:WP}=BP,R2=286,Qge=30,Zge=19,e_e=2*R2+1,t_e=15,oy=258,Vh=262,gS=42,ay=113,ZT=666,cy=(e,r)=>(e.msg=sy[r],r),W$=e=>2*e-(e>4?9:0),rg=e=>{let r=e.length;for(;--r>=0;)e[r]=0},n_e=e=>{let r,s,o,c=e.w_size;r=e.hash_size,o=r;do s=e.head[--o],e.head[o]=s>=c?s-c:0;while(--r);r=c,o=r;do s=e.prev[--o],e.prev[o]=s>=c?s-c:0;while(--r)};let ig=(e,r,s)=>(r<<e.hash_shift^s)&e.hash_mask;const Vl=e=>{const r=e.state;let s=r.pending;s>e.avail_out&&(s=e.avail_out),s!==0&&(e.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+s),e.next_out),e.next_out+=s,r.pending_out+=s,e.total_out+=s,e.avail_out-=s,r.pending-=s,r.pending===0&&(r.pending_out=0))},jl=(e,r)=>{Bge(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,r),e.block_start=e.strstart,Vl(e.strm)},ei=(e,r)=>{e.pending_buf[e.pending++]=r},ew=(e,r)=>{e.pending_buf[e.pending++]=r>>>8&255,e.pending_buf[e.pending++]=255&r},I2=(e,r,s,o)=>{let c=e.avail_in;return c>o&&(c=o),c===0?0:(e.avail_in-=c,r.set(e.input.subarray(e.next_in,e.next_in+c),s),e.state.wrap===1?e.adler=QT(e.adler,r,c,s):e.state.wrap===2&&(e.adler=Xo(e.adler,r,c,s)),e.next_in+=c,e.total_in+=c,c)},G$=(e,r)=>{let s,o,c=e.max_chain_length,u=e.strstart,h=e.prev_length,m=e.nice_match;const y=e.strstart>e.w_size-Vh?e.strstart-(e.w_size-Vh):0,E=e.window,S=e.w_mask,R=e.prev,P=e.strstart+oy;let D=E[u+h-1],G=E[u+h];e.prev_length>=e.good_match&&(c>>=2),m>e.lookahead&&(m=e.lookahead);do if(s=r,E[s+h]===G&&E[s+h-1]===D&&E[s]===E[u]&&E[++s]===E[u+1]){u+=2,s++;do;while(E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&E[++u]===E[++s]&&u<P);if(o=oy-(P-u),u=P-oy,o>h){if(e.match_start=r,h=o,o>=m)break;D=E[u+h-1],G=E[u+h]}}while((r=R[r&S])>y&&--c!=0);return h<=e.lookahead?h:e.lookahead},_S=e=>{const r=e.w_size;let s,o,c;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=r+(r-Vh)&&(e.window.set(e.window.subarray(r,r+r-o),0),e.match_start-=r,e.strstart-=r,e.block_start-=r,e.insert>e.strstart&&(e.insert=e.strstart),n_e(e),o+=r),e.strm.avail_in===0)break;if(s=I2(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=s,e.lookahead+e.insert>=3)for(c=e.strstart-e.insert,e.ins_h=e.window[c],e.ins_h=ig(e,e.ins_h,e.window[c+1]);e.insert&&(e.ins_h=ig(e,e.ins_h,e.window[c+3-1]),e.prev[c&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=c,c++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Vh&&e.strm.avail_in!==0)},H$=(e,r)=>{let s,o,c,u=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,h=0,m=e.strm.avail_in;do{if(s=65535,c=e.bi_valid+42>>3,e.strm.avail_out<c||(c=e.strm.avail_out-c,o=e.strstart-e.block_start,s>o+e.strm.avail_in&&(s=o+e.strm.avail_in),s>c&&(s=c),s<u&&(s===0&&r!==Du||r===ng||s!==o+e.strm.avail_in)))break;h=r===Du&&s===o+e.strm.avail_in?1:0,w2(e,0,0,h),e.pending_buf[e.pending-4]=s,e.pending_buf[e.pending-3]=s>>8,e.pending_buf[e.pending-2]=~s,e.pending_buf[e.pending-1]=~s>>8,Vl(e.strm),o&&(o>s&&(o=s),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+o),e.strm.next_out),e.strm.next_out+=o,e.strm.avail_out-=o,e.strm.total_out+=o,e.block_start+=o,s-=o),s&&(I2(e.strm,e.strm.output,e.strm.next_out,s),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s)}while(h===0);return m-=e.strm.avail_in,m&&(m>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=m&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-m,e.strm.next_in),e.strstart),e.strstart+=m,e.insert+=m>e.w_size-e.insert?e.w_size-e.insert:m),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),h?4:r!==ng&&r!==Du&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(c=e.window_size-e.strstart,e.strm.avail_in>c&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,c+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),c>e.strm.avail_in&&(c=e.strm.avail_in),c&&(I2(e.strm,e.window,e.strstart,c),e.strstart+=c,e.insert+=c>e.w_size-e.insert?e.w_size-e.insert:c),e.high_water<e.strstart&&(e.high_water=e.strstart),c=e.bi_valid+42>>3,c=e.pending_buf_size-c>65535?65535:e.pending_buf_size-c,u=c>e.w_size?e.w_size:c,o=e.strstart-e.block_start,(o>=u||(o||r===Du)&&r!==ng&&e.strm.avail_in===0&&o<=c)&&(s=o>c?c:o,h=r===Du&&e.strm.avail_in===0&&s===o?1:0,w2(e,e.block_start,s,h),e.block_start+=s,Vl(e.strm)),h?3:1)},A2=(e,r)=>{let s,o;for(;;){if(e.lookahead<Vh){if(_S(e),e.lookahead<Vh&&r===ng)return 1;if(e.lookahead===0)break}if(s=0,e.lookahead>=3&&(e.ins_h=ig(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),s!==0&&e.strstart-s<=e.w_size-Vh&&(e.match_length=G$(e,s)),e.match_length>=3)if(o=tg(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=ig(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ig(e,e.ins_h,e.window[e.strstart+1]);else o=tg(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(jl(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,r===Du?(jl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(jl(e,!1),e.strm.avail_out===0)?1:2},yS=(e,r)=>{let s,o,c;for(;;){if(e.lookahead<Vh){if(_S(e),e.lookahead<Vh&&r===ng)return 1;if(e.lookahead===0)break}if(s=0,e.lookahead>=3&&(e.ins_h=ig(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,s!==0&&e.prev_length<e.max_lazy_match&&e.strstart-s<=e.w_size-Vh&&(e.match_length=G$(e,s),e.match_length<=5&&(e.strategy===Kge||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){c=e.strstart+e.lookahead-3,o=tg(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=c&&(e.ins_h=ig(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(jl(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(o=tg(e,0,e.window[e.strstart-1]),o&&jl(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=tg(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,r===Du?(jl(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(jl(e,!1),e.strm.avail_out===0)?1:2};function jh(e,r,s,o,c){this.good_length=e,this.max_lazy=r,this.nice_length=s,this.max_chain=o,this.func=c}const tw=[new jh(0,0,0,0,H$),new jh(4,4,8,4,A2),new jh(4,5,16,8,A2),new jh(4,6,32,32,A2),new jh(4,4,16,16,yS),new jh(8,16,32,32,yS),new jh(8,16,128,128,yS),new jh(8,32,128,256,yS),new jh(32,128,258,1024,yS),new jh(32,258,258,4096,yS)];function r_e(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=WP,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*e_e),this.dyn_dtree=new Uint16Array(2*(2*Qge+1)),this.bl_tree=new Uint16Array(2*(2*Zge+1)),rg(this.dyn_ltree),rg(this.dyn_dtree),rg(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(t_e+1),this.heap=new Uint16Array(2*R2+1),rg(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*R2+1),rg(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const nw=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.status!==gS&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==ay&&r.status!==ZT?1:0},$$=e=>{if(nw(e))return cy(e,Uh);e.total_in=e.total_out=0,e.data_type=Jge;const r=e.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?gS:ay,e.adler=r.wrap===2?0:1,r.last_flush=-2,Fge(r),ba},K$=e=>{const r=$$(e);return r===ba&&(s=>{s.window_size=2*s.w_size,rg(s.head),s.max_lazy_match=tw[s.level].max_lazy,s.good_match=tw[s.level].good_length,s.nice_match=tw[s.level].nice_length,s.max_chain_length=tw[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0})(e.state),r},q$=(e,r,s,o,c,u)=>{if(!e)return Uh;let h=1;if(r===$ge&&(r=6),o<0?(h=0,o=-o):o>15&&(h=2,o-=16),c<1||c>9||s!==WP||o<8||o>15||r<0||r>9||u<0||u>Yge||o===8&&h!==1)return cy(e,Uh);o===8&&(o=9);const m=new r_e;return e.state=m,m.strm=e,m.status=gS,m.wrap=h,m.gzhead=null,m.w_bits=o,m.w_size=1<<m.w_bits,m.w_mask=m.w_size-1,m.hash_bits=c+7,m.hash_size=1<<m.hash_bits,m.hash_mask=m.hash_size-1,m.hash_shift=~~((m.hash_bits+3-1)/3),m.window=new Uint8Array(2*m.w_size),m.head=new Uint16Array(m.hash_size),m.prev=new Uint16Array(m.w_size),m.lit_bufsize=1<<c+6,m.pending_buf_size=4*m.lit_bufsize,m.pending_buf=new Uint8Array(m.pending_buf_size),m.sym_buf=m.lit_bufsize,m.sym_end=3*(m.lit_bufsize-1),m.level=r,m.strategy=u,m.method=s,K$(e)};var i_e=(e,r)=>{if(nw(e)||r>B$||r<0)return e?cy(e,Uh):Uh;const s=e.state;if(!e.output||e.avail_in!==0&&!e.input||s.status===ZT&&r!==Du)return cy(e,e.avail_out===0?C2:Uh);const o=s.last_flush;if(s.last_flush=r,s.pending!==0){if(Vl(e),e.avail_out===0)return s.last_flush=-1,ba}else if(e.avail_in===0&&W$(r)<=W$(o)&&r!==Du)return cy(e,C2);if(s.status===ZT&&e.avail_in!==0)return cy(e,C2);if(s.status===gS&&s.wrap===0&&(s.status=ay),s.status===gS){let c=WP+(s.w_bits-8<<4)<<8,u=-1;if(u=s.strategy>=zP||s.level<2?0:s.level<6?1:s.level===6?2:3,c|=u<<6,s.strstart!==0&&(c|=32),c+=31-c%31,ew(s,c),s.strstart!==0&&(ew(s,e.adler>>>16),ew(s,65535&e.adler)),e.adler=1,s.status=ay,Vl(e),s.pending!==0)return s.last_flush=-1,ba}if(s.status===57){if(e.adler=0,ei(s,31),ei(s,139),ei(s,8),s.gzhead)ei(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),ei(s,255&s.gzhead.time),ei(s,s.gzhead.time>>8&255),ei(s,s.gzhead.time>>16&255),ei(s,s.gzhead.time>>24&255),ei(s,s.level===9?2:s.strategy>=zP||s.level<2?4:0),ei(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(ei(s,255&s.gzhead.extra.length),ei(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=Xo(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(ei(s,0),ei(s,0),ei(s,0),ei(s,0),ei(s,0),ei(s,s.level===9?2:s.strategy>=zP||s.level<2?4:0),ei(s,3),s.status=ay,Vl(e),s.pending!==0)return s.last_flush=-1,ba}if(s.status===69){if(s.gzhead.extra){let c=s.pending,u=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+u>s.pending_buf_size;){let m=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+m),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>c&&(e.adler=Xo(e.adler,s.pending_buf,s.pending-c,c)),s.gzindex+=m,Vl(e),s.pending!==0)return s.last_flush=-1,ba;c=0,u-=m}let h=new Uint8Array(s.gzhead.extra);s.pending_buf.set(h.subarray(s.gzindex,s.gzindex+u),s.pending),s.pending+=u,s.gzhead.hcrc&&s.pending>c&&(e.adler=Xo(e.adler,s.pending_buf,s.pending-c,c)),s.gzindex=0}s.status=73}if(s.status===73){if(s.gzhead.name){let c,u=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>u&&(e.adler=Xo(e.adler,s.pending_buf,s.pending-u,u)),Vl(e),s.pending!==0)return s.last_flush=-1,ba;u=0}c=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,ei(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>u&&(e.adler=Xo(e.adler,s.pending_buf,s.pending-u,u)),s.gzindex=0}s.status=91}if(s.status===91){if(s.gzhead.comment){let c,u=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>u&&(e.adler=Xo(e.adler,s.pending_buf,s.pending-u,u)),Vl(e),s.pending!==0)return s.last_flush=-1,ba;u=0}c=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,ei(s,c)}while(c!==0);s.gzhead.hcrc&&s.pending>u&&(e.adler=Xo(e.adler,s.pending_buf,s.pending-u,u))}s.status=103}if(s.status===103){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(Vl(e),s.pending!==0))return s.last_flush=-1,ba;ei(s,255&e.adler),ei(s,e.adler>>8&255),e.adler=0}if(s.status=ay,Vl(e),s.pending!==0)return s.last_flush=-1,ba}if(e.avail_in!==0||s.lookahead!==0||r!==ng&&s.status!==ZT){let c=s.level===0?H$(s,r):s.strategy===zP?((u,h)=>{let m;for(;;){if(u.lookahead===0&&(_S(u),u.lookahead===0)){if(h===ng)return 1;break}if(u.match_length=0,m=tg(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++,m&&(jl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Du?(jl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(jl(u,!1),u.strm.avail_out===0)?1:2})(s,r):s.strategy===qge?((u,h)=>{let m,y,E,S;const R=u.window;for(;;){if(u.lookahead<=oy){if(_S(u),u.lookahead<=oy&&h===ng)return 1;if(u.lookahead===0)break}if(u.match_length=0,u.lookahead>=3&&u.strstart>0&&(E=u.strstart-1,y=R[E],y===R[++E]&&y===R[++E]&&y===R[++E])){S=u.strstart+oy;do;while(y===R[++E]&&y===R[++E]&&y===R[++E]&&y===R[++E]&&y===R[++E]&&y===R[++E]&&y===R[++E]&&y===R[++E]&&E<S);u.match_length=oy-(S-E),u.match_length>u.lookahead&&(u.match_length=u.lookahead)}if(u.match_length>=3?(m=tg(u,1,u.match_length-3),u.lookahead-=u.match_length,u.strstart+=u.match_length,u.match_length=0):(m=tg(u,0,u.window[u.strstart]),u.lookahead--,u.strstart++),m&&(jl(u,!1),u.strm.avail_out===0))return 1}return u.insert=0,h===Du?(jl(u,!0),u.strm.avail_out===0?3:4):u.sym_next&&(jl(u,!1),u.strm.avail_out===0)?1:2})(s,r):tw[s.level].func(s,r);if(c!==3&&c!==4||(s.status=ZT),c===1||c===3)return e.avail_out===0&&(s.last_flush=-1),ba;if(c===2&&(r===Wge?zge(s):r!==B$&&(w2(s,0,0,!1),r===Gge&&(rg(s.head),s.lookahead===0&&(s.strstart=0,s.block_start=0,s.insert=0))),Vl(e),e.avail_out===0))return s.last_flush=-1,ba}return r!==Du?ba:s.wrap<=0?z$:(s.wrap===2?(ei(s,255&e.adler),ei(s,e.adler>>8&255),ei(s,e.adler>>16&255),ei(s,e.adler>>24&255),ei(s,255&e.total_in),ei(s,e.total_in>>8&255),ei(s,e.total_in>>16&255),ei(s,e.total_in>>24&255)):(ew(s,e.adler>>>16),ew(s,65535&e.adler)),Vl(e),s.wrap>0&&(s.wrap=-s.wrap),s.pending!==0?ba:z$)},s_e=(e,r)=>{let s=r.length;if(nw(e))return Uh;const o=e.state,c=o.wrap;if(c===2||c===1&&o.status!==gS||o.lookahead)return Uh;if(c===1&&(e.adler=QT(e.adler,r,s,0)),o.wrap=0,s>=o.w_size){c===0&&(rg(o.head),o.strstart=0,o.block_start=0,o.insert=0);let y=new Uint8Array(o.w_size);y.set(r.subarray(s-o.w_size,s),0),r=y,s=o.w_size}const u=e.avail_in,h=e.next_in,m=e.input;for(e.avail_in=s,e.next_in=0,e.input=r,_S(o);o.lookahead>=3;){let y=o.strstart,E=o.lookahead-2;do o.ins_h=ig(o,o.ins_h,o.window[y+3-1]),o.prev[y&o.w_mask]=o.head[o.ins_h],o.head[o.ins_h]=y,y++;while(--E);o.strstart=y,o.lookahead=2,_S(o)}return o.strstart+=o.lookahead,o.block_start=o.strstart,o.insert=o.lookahead,o.lookahead=0,o.match_length=o.prev_length=2,o.match_available=0,e.next_in=h,e.input=m,e.avail_in=u,o.wrap=c,ba},rw={deflateInit:(e,r)=>q$(e,r,WP,15,8,Xge),deflateInit2:q$,deflateReset:K$,deflateResetKeep:$$,deflateSetHeader:(e,r)=>nw(e)||e.state.wrap!==2?Uh:(e.state.gzhead=r,ba),deflate:i_e,deflateEnd:e=>{if(nw(e))return Uh;const r=e.state.status;return e.state=null,r===ay?cy(e,Hge):ba},deflateSetDictionary:s_e,deflateInfo:"pako deflate (from Nodeca project)"};const o_e=(e,r)=>Object.prototype.hasOwnProperty.call(e,r);var GP={assign:function(e){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const s=r.shift();if(s){if(typeof s!="object")throw new TypeError(s+"must be non-object");for(const o in s)o_e(s,o)&&(e[o]=s[o])}}return e},flattenChunks:e=>{let r=0;for(let o=0,c=e.length;o<c;o++)r+=e[o].length;const s=new Uint8Array(r);for(let o=0,c=0,u=e.length;o<u;o++){let h=e[o];s.set(h,c),c+=h.length}return s}};let Y$=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Y$=!1}const iw=new Uint8Array(256);for(let e=0;e<256;e++)iw[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;iw[254]=iw[254]=1;var sw={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let r,s,o,c,u,h=e.length,m=0;for(c=0;c<h;c++)s=e.charCodeAt(c),(64512&s)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(s=65536+(s-55296<<10)+(o-56320),c++)),m+=s<128?1:s<2048?2:s<65536?3:4;for(r=new Uint8Array(m),u=0,c=0;u<m;c++)s=e.charCodeAt(c),(64512&s)==55296&&c+1<h&&(o=e.charCodeAt(c+1),(64512&o)==56320&&(s=65536+(s-55296<<10)+(o-56320),c++)),s<128?r[u++]=s:s<2048?(r[u++]=192|s>>>6,r[u++]=128|63&s):s<65536?(r[u++]=224|s>>>12,r[u++]=128|s>>>6&63,r[u++]=128|63&s):(r[u++]=240|s>>>18,r[u++]=128|s>>>12&63,r[u++]=128|s>>>6&63,r[u++]=128|63&s);return r},buf2string:(e,r)=>{const s=r||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,r));let o,c;const u=new Array(2*s);for(c=0,o=0;o<s;){let h=e[o++];if(h<128){u[c++]=h;continue}let m=iw[h];if(m>4)u[c++]=65533,o+=m-1;else{for(h&=m===2?31:m===3?15:7;m>1&&o<s;)h=h<<6|63&e[o++],m--;m>1?u[c++]=65533:h<65536?u[c++]=h:(h-=65536,u[c++]=55296|h>>10&1023,u[c++]=56320|1023&h)}}return((h,m)=>{if(m<65534&&h.subarray&&Y$)return String.fromCharCode.apply(null,h.length===m?h:h.subarray(0,m));let y="";for(let E=0;E<m;E++)y+=String.fromCharCode(h[E]);return y})(u,c)},utf8border:(e,r)=>{(r=r||e.length)>e.length&&(r=e.length);let s=r-1;for(;s>=0&&(192&e[s])==128;)s--;return s<0||s===0?r:s+iw[e[s]]>r?s:r}},X$=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const J$=Object.prototype.toString,{Z_NO_FLUSH:a_e,Z_SYNC_FLUSH:c_e,Z_FULL_FLUSH:l_e,Z_FINISH:u_e,Z_OK:HP,Z_STREAM_END:d_e,Z_DEFAULT_COMPRESSION:h_e,Z_DEFAULT_STRATEGY:p_e,Z_DEFLATED:f_e}=BP;function $P(e){this.options=GP.assign({level:h_e,method:f_e,chunkSize:16384,windowBits:15,memLevel:8,strategy:p_e},e||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new X$,this.strm.avail_out=0;let s=rw.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(s!==HP)throw new Error(sy[s]);if(r.header&&rw.deflateSetHeader(this.strm,r.header),r.dictionary){let o;if(o=typeof r.dictionary=="string"?sw.string2buf(r.dictionary):J$.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,s=rw.deflateSetDictionary(this.strm,o),s!==HP)throw new Error(sy[s]);this._dict_set=!0}}function m_e(e,r){const s=new $P(r);if(s.push(e,!0),s.err)throw s.msg||sy[s.err];return s.result}$P.prototype.push=function(e,r){const s=this.strm,o=this.options.chunkSize;let c,u;if(this.ended)return!1;for(u=r===~~r?r:r===!0?u_e:a_e,typeof e=="string"?s.input=sw.string2buf(e):J$.call(e)==="[object ArrayBuffer]"?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;)if(s.avail_out===0&&(s.output=new Uint8Array(o),s.next_out=0,s.avail_out=o),(u===c_e||u===l_e)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(c=rw.deflate(s,u),c===d_e)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),c=rw.deflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===HP;if(s.avail_out!==0){if(u>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(s.avail_in===0)break}else this.onData(s.output)}return!0},$P.prototype.onData=function(e){this.chunks.push(e)},$P.prototype.onEnd=function(e){e===HP&&(this.result=GP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var g_e={deflate:m_e};const KP=16209;var __e=function(e,r){let s,o,c,u,h,m,y,E,S,R,P,D,G,j,B,Y,ee,fe,ye,Ee,_e,Ne,Ze,pt;const yt=e.state;s=e.next_in,Ze=e.input,o=s+(e.avail_in-5),c=e.next_out,pt=e.output,u=c-(r-e.avail_out),h=c+(e.avail_out-257),m=yt.dmax,y=yt.wsize,E=yt.whave,S=yt.wnext,R=yt.window,P=yt.hold,D=yt.bits,G=yt.lencode,j=yt.distcode,B=(1<<yt.lenbits)-1,Y=(1<<yt.distbits)-1;e:do{D<15&&(P+=Ze[s++]<<D,D+=8,P+=Ze[s++]<<D,D+=8),ee=G[P&B];t:for(;;){if(fe=ee>>>24,P>>>=fe,D-=fe,fe=ee>>>16&255,fe===0)pt[c++]=65535&ee;else{if(!(16&fe)){if((64&fe)==0){ee=G[(65535&ee)+(P&(1<<fe)-1)];continue t}if(32&fe){yt.mode=16191;break e}e.msg="invalid literal/length code",yt.mode=KP;break e}ye=65535&ee,fe&=15,fe&&(D<fe&&(P+=Ze[s++]<<D,D+=8),ye+=P&(1<<fe)-1,P>>>=fe,D-=fe),D<15&&(P+=Ze[s++]<<D,D+=8,P+=Ze[s++]<<D,D+=8),ee=j[P&Y];n:for(;;){if(fe=ee>>>24,P>>>=fe,D-=fe,fe=ee>>>16&255,!(16&fe)){if((64&fe)==0){ee=j[(65535&ee)+(P&(1<<fe)-1)];continue n}e.msg="invalid distance code",yt.mode=KP;break e}if(Ee=65535&ee,fe&=15,D<fe&&(P+=Ze[s++]<<D,D+=8,D<fe&&(P+=Ze[s++]<<D,D+=8)),Ee+=P&(1<<fe)-1,Ee>m){e.msg="invalid distance too far back",yt.mode=KP;break e}if(P>>>=fe,D-=fe,fe=c-u,Ee>fe){if(fe=Ee-fe,fe>E&&yt.sane){e.msg="invalid distance too far back",yt.mode=KP;break e}if(_e=0,Ne=R,S===0){if(_e+=y-fe,fe<ye){ye-=fe;do pt[c++]=R[_e++];while(--fe);_e=c-Ee,Ne=pt}}else if(S<fe){if(_e+=y+S-fe,fe-=S,fe<ye){ye-=fe;do pt[c++]=R[_e++];while(--fe);if(_e=0,S<ye){fe=S,ye-=fe;do pt[c++]=R[_e++];while(--fe);_e=c-Ee,Ne=pt}}}else if(_e+=S-fe,fe<ye){ye-=fe;do pt[c++]=R[_e++];while(--fe);_e=c-Ee,Ne=pt}for(;ye>2;)pt[c++]=Ne[_e++],pt[c++]=Ne[_e++],pt[c++]=Ne[_e++],ye-=3;ye&&(pt[c++]=Ne[_e++],ye>1&&(pt[c++]=Ne[_e++]))}else{_e=c-Ee;do pt[c++]=pt[_e++],pt[c++]=pt[_e++],pt[c++]=pt[_e++],ye-=3;while(ye>2);ye&&(pt[c++]=pt[_e++],ye>1&&(pt[c++]=pt[_e++]))}break}}break}}while(s<o&&c<h);ye=D>>3,s-=ye,D-=ye<<3,P&=(1<<D)-1,e.next_in=s,e.next_out=c,e.avail_in=s<o?o-s+5:5-(s-o),e.avail_out=c<h?h-c+257:257-(c-h),yt.hold=P,yt.bits=D};const qP=15,y_e=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),E_e=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),v_e=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),S_e=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ow=(e,r,s,o,c,u,h,m)=>{const y=m.bits;let E,S,R,P,D,G,j=0,B=0,Y=0,ee=0,fe=0,ye=0,Ee=0,_e=0,Ne=0,Ze=0,pt=null;const yt=new Uint16Array(16),In=new Uint16Array(16);let An,mr,li,Jr=null;for(j=0;j<=qP;j++)yt[j]=0;for(B=0;B<o;B++)yt[r[s+B]]++;for(fe=y,ee=qP;ee>=1&&yt[ee]===0;ee--);if(fe>ee&&(fe=ee),ee===0)return c[u++]=20971520,c[u++]=20971520,m.bits=1,0;for(Y=1;Y<ee&&yt[Y]===0;Y++);for(fe<Y&&(fe=Y),_e=1,j=1;j<=qP;j++)if(_e<<=1,_e-=yt[j],_e<0)return-1;if(_e>0&&(e===0||ee!==1))return-1;for(In[1]=0,j=1;j<qP;j++)In[j+1]=In[j]+yt[j];for(B=0;B<o;B++)r[s+B]!==0&&(h[In[r[s+B]]++]=B);if(e===0?(pt=Jr=h,G=20):e===1?(pt=y_e,Jr=E_e,G=257):(pt=v_e,Jr=S_e,G=0),Ze=0,B=0,j=Y,D=u,ye=fe,Ee=0,R=-1,Ne=1<<fe,P=Ne-1,e===1&&Ne>852||e===2&&Ne>592)return 1;for(;;){An=j-Ee,h[B]+1<G?(mr=0,li=h[B]):h[B]>=G?(mr=Jr[h[B]-G],li=pt[h[B]-G]):(mr=96,li=0),E=1<<j-Ee,S=1<<ye,Y=S;do S-=E,c[D+(Ze>>Ee)+S]=An<<24|mr<<16|li|0;while(S!==0);for(E=1<<j-1;Ze&E;)E>>=1;if(E!==0?(Ze&=E-1,Ze+=E):Ze=0,B++,--yt[j]==0){if(j===ee)break;j=r[s+h[B]]}if(j>fe&&(Ze&P)!==R){for(Ee===0&&(Ee=fe),D+=Y,ye=j-Ee,_e=1<<ye;ye+Ee<ee&&(_e-=yt[ye+Ee],!(_e<=0));)ye++,_e<<=1;if(Ne+=1<<ye,e===1&&Ne>852||e===2&&Ne>592)return 1;R=Ze&P,c[R]=fe<<24|ye<<16|D-u|0}}return Ze!==0&&(c[D+Ze]=j-Ee<<24|64<<16|0),m.bits=fe,0};const{Z_FINISH:Q$,Z_BLOCK:b_e,Z_TREES:YP,Z_OK:ly,Z_STREAM_END:T_e,Z_NEED_DICT:w_e,Z_STREAM_ERROR:xu,Z_DATA_ERROR:Z$,Z_MEM_ERROR:e7,Z_BUF_ERROR:C_e,Z_DEFLATED:t7}=BP,XP=16180,JP=16190,Ef=16191,P2=16192,O2=16194,QP=16199,ZP=16200,k2=16206,ls=16209,n7=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function R_e(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const uy=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.mode<XP||r.mode>16211?1:0},r7=e=>{if(uy(e))return xu;const r=e.state;return e.total_in=e.total_out=r.total=0,e.msg="",r.wrap&&(e.adler=1&r.wrap),r.mode=XP,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,ly},i7=e=>{if(uy(e))return xu;const r=e.state;return r.wsize=0,r.whave=0,r.wnext=0,r7(e)},s7=(e,r)=>{let s;if(uy(e))return xu;const o=e.state;return r<0?(s=0,r=-r):(s=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?xu:(o.window!==null&&o.wbits!==r&&(o.window=null),o.wrap=s,o.wbits=r,i7(e))},o7=(e,r)=>{if(!e)return xu;const s=new R_e;e.state=s,s.strm=e,s.window=null,s.mode=XP;const o=s7(e,r);return o!==ly&&(e.state=null),o};let N2,D2,a7=!0;const I_e=e=>{if(a7){N2=new Int32Array(512),D2=new Int32Array(32);let r=0;for(;r<144;)e.lens[r++]=8;for(;r<256;)e.lens[r++]=9;for(;r<280;)e.lens[r++]=7;for(;r<288;)e.lens[r++]=8;for(ow(1,e.lens,0,288,N2,0,e.work,{bits:9}),r=0;r<32;)e.lens[r++]=5;ow(2,e.lens,0,32,D2,0,e.work,{bits:5}),a7=!1}e.lencode=N2,e.lenbits=9,e.distcode=D2,e.distbits=5},c7=(e,r,s,o)=>{let c;const u=e.state;return u.window===null&&(u.wsize=1<<u.wbits,u.wnext=0,u.whave=0,u.window=new Uint8Array(u.wsize)),o>=u.wsize?(u.window.set(r.subarray(s-u.wsize,s),0),u.wnext=0,u.whave=u.wsize):(c=u.wsize-u.wnext,c>o&&(c=o),u.window.set(r.subarray(s-o,s-o+c),u.wnext),(o-=c)?(u.window.set(r.subarray(s-o,s),0),u.wnext=o,u.whave=u.wsize):(u.wnext+=c,u.wnext===u.wsize&&(u.wnext=0),u.whave<u.wsize&&(u.whave+=c))),0};var A_e=(e,r)=>{let s,o,c,u,h,m,y,E,S,R,P,D,G,j,B,Y,ee,fe,ye,Ee,_e,Ne,Ze=0;const pt=new Uint8Array(4);let yt,In;const An=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(uy(e)||!e.output||!e.input&&e.avail_in!==0)return xu;s=e.state,s.mode===Ef&&(s.mode=P2),h=e.next_out,c=e.output,y=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,E=s.hold,S=s.bits,R=m,P=y,Ne=ly;e:for(;;)switch(s.mode){case XP:if(s.wrap===0){s.mode=P2;break}for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(2&s.wrap&&E===35615){s.wbits===0&&(s.wbits=15),s.check=0,pt[0]=255&E,pt[1]=E>>>8&255,s.check=Xo(s.check,pt,2,0),E=0,S=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&E)<<8)+(E>>8))%31){e.msg="incorrect header check",s.mode=ls;break}if((15&E)!==t7){e.msg="unknown compression method",s.mode=ls;break}if(E>>>=4,S-=4,_e=8+(15&E),s.wbits===0&&(s.wbits=_e),_e>15||_e>s.wbits){e.msg="invalid window size",s.mode=ls;break}s.dmax=1<<s.wbits,s.flags=0,e.adler=s.check=1,s.mode=512&E?16189:Ef,E=0,S=0;break;case 16181:for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(s.flags=E,(255&Ao(s))!==t7){e.msg="unknown compression method",s.mode=ls;break}if(57344&Ao(s)){e.msg="unknown header flags set",s.mode=ls;break}s.head&&(s.head.text=E>>8&1),512&Ao(s)&&4&s.wrap&&(pt[0]=255&E,pt[1]=E>>>8&255,s.check=Xo(s.check,pt,2,0)),E=0,S=0,s.mode=16182;case 16182:for(;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.head&&(s.head.time=E),512&Ao(s)&&4&s.wrap&&(pt[0]=255&E,pt[1]=E>>>8&255,pt[2]=E>>>16&255,pt[3]=E>>>24&255,s.check=Xo(s.check,pt,4,0)),E=0,S=0,s.mode=16183;case 16183:for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.head&&(s.head.xflags=255&E,s.head.os=E>>8),512&Ao(s)&&4&s.wrap&&(pt[0]=255&E,pt[1]=E>>>8&255,s.check=Xo(s.check,pt,2,0)),E=0,S=0,s.mode=16184;case 16184:if(1024&Ao(s)){for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.length=E,s.head&&(s.head.extra_len=E),512&Ao(s)&&4&s.wrap&&(pt[0]=255&E,pt[1]=E>>>8&255,s.check=Xo(s.check,pt,2,0)),E=0,S=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&Ao(s)&&(D=s.length,D>m&&(D=m),D&&(s.head&&(_e=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(o.subarray(u,u+D),_e)),512&Ao(s)&&4&s.wrap&&(s.check=Xo(s.check,o,D,u)),m-=D,u+=D,s.length-=D),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&Ao(s)){if(m===0)break e;D=0;do _e=o[u+D++],s.head&&_e&&s.length<65536&&(s.head.name+=String.fromCharCode(_e));while(_e&&D<m);if(512&Ao(s)&&4&s.wrap&&(s.check=Xo(s.check,o,D,u)),m-=D,u+=D,_e)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&Ao(s)){if(m===0)break e;D=0;do _e=o[u+D++],s.head&&_e&&s.length<65536&&(s.head.comment+=String.fromCharCode(_e));while(_e&&D<m);if(512&Ao(s)&&4&s.wrap&&(s.check=Xo(s.check,o,D,u)),m-=D,u+=D,_e)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&Ao(s)){for(;S<16;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(4&s.wrap&&E!==(65535&s.check)){e.msg="header crc mismatch",s.mode=ls;break}E=0,S=0}s.head&&(s.head.hcrc=Ao(s)>>9&1,s.head.done=!0),e.adler=s.check=0,s.mode=Ef;break;case 16189:for(;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}e.adler=s.check=n7(E),E=0,S=0,s.mode=JP;case JP:if(s.havedict===0)return e.next_out=h,e.avail_out=y,e.next_in=u,e.avail_in=m,s.hold=E,s.bits=S,w_e;e.adler=s.check=1,s.mode=Ef;case Ef:if(r===b_e||r===YP)break e;case P2:if(s.last){E>>>=7&S,S-=7&S,s.mode=k2;break}for(;S<3;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}switch(s.last=1&E,E>>>=1,S-=1,3&E){case 0:s.mode=16193;break;case 1:if(I_e(s),s.mode=QP,r===YP){E>>>=2,S-=2;break e}break;case 2:s.mode=16196;break;case 3:e.msg="invalid block type",s.mode=ls}E>>>=2,S-=2;break;case 16193:for(E>>>=7&S,S-=7&S;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if((65535&E)!=(E>>>16^65535)){e.msg="invalid stored block lengths",s.mode=ls;break}if(s.length=65535&E,E=0,S=0,s.mode=O2,r===YP)break e;case O2:s.mode=16195;case 16195:if(D=s.length,D){if(D>m&&(D=m),D>y&&(D=y),D===0)break e;c.set(o.subarray(u,u+D),h),m-=D,u+=D,y-=D,h+=D,s.length-=D;break}s.mode=Ef;break;case 16196:for(;S<14;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(s.nlen=257+(31&E),E>>>=5,S-=5,s.ndist=1+(31&E),E>>>=5,S-=5,s.ncode=4+(15&E),E>>>=4,S-=4,s.nlen>286||s.ndist>30){e.msg="too many length or distance symbols",s.mode=ls;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;S<3;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.lens[An[s.have++]]=7&E,E>>>=3,S-=3}for(;s.have<19;)s.lens[An[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,yt={bits:s.lenbits},Ne=ow(0,s.lens,0,19,s.lencode,0,s.work,yt),s.lenbits=yt.bits,Ne){e.msg="invalid code lengths set",s.mode=ls;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;Ze=s.lencode[E&(1<<s.lenbits)-1],B=Ze>>>24,Y=Ze>>>16&255,ee=65535&Ze,!(B<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(ee<16)E>>>=B,S-=B,s.lens[s.have++]=ee;else{if(ee===16){for(In=B+2;S<In;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(E>>>=B,S-=B,s.have===0){e.msg="invalid bit length repeat",s.mode=ls;break}_e=s.lens[s.have-1],D=3+(3&E),E>>>=2,S-=2}else if(ee===17){for(In=B+3;S<In;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=B,S-=B,_e=0,D=3+(7&E),E>>>=3,S-=3}else{for(In=B+7;S<In;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=B,S-=B,_e=0,D=11+(127&E),E>>>=7,S-=7}if(s.have+D>s.nlen+s.ndist){e.msg="invalid bit length repeat",s.mode=ls;break}for(;D--;)s.lens[s.have++]=_e}}if(s.mode===ls)break;if(s.lens[256]===0){e.msg="invalid code -- missing end-of-block",s.mode=ls;break}if(s.lenbits=9,yt={bits:s.lenbits},Ne=ow(1,s.lens,0,s.nlen,s.lencode,0,s.work,yt),s.lenbits=yt.bits,Ne){e.msg="invalid literal/lengths set",s.mode=ls;break}if(s.distbits=6,s.distcode=s.distdyn,yt={bits:s.distbits},Ne=ow(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,yt),s.distbits=yt.bits,Ne){e.msg="invalid distances set",s.mode=ls;break}if(s.mode=QP,r===YP)break e;case QP:s.mode=ZP;case ZP:if(m>=6&&y>=258){e.next_out=h,e.avail_out=y,e.next_in=u,e.avail_in=m,s.hold=E,s.bits=S,__e(e,P),h=e.next_out,c=e.output,y=e.avail_out,u=e.next_in,o=e.input,m=e.avail_in,E=s.hold,S=s.bits,s.mode===Ef&&(s.back=-1);break}for(s.back=0;Ze=s.lencode[E&(1<<s.lenbits)-1],B=Ze>>>24,Y=Ze>>>16&255,ee=65535&Ze,!(B<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(Y&&(240&Y)==0){for(fe=B,ye=Y,Ee=ee;Ze=s.lencode[Ee+((E&(1<<fe+ye)-1)>>fe)],B=Ze>>>24,Y=Ze>>>16&255,ee=65535&Ze,!(fe+B<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=fe,S-=fe,s.back+=fe}if(E>>>=B,S-=B,s.back+=B,s.length=ee,Y===0){s.mode=16205;break}if(32&Y){s.back=-1,s.mode=Ef;break}if(64&Y){e.msg="invalid literal/length code",s.mode=ls;break}s.extra=15&Y,s.mode=16201;case 16201:if(s.extra){for(In=s.extra;S<In;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.length+=E&(1<<s.extra)-1,E>>>=s.extra,S-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;Ze=s.distcode[E&(1<<s.distbits)-1],B=Ze>>>24,Y=Ze>>>16&255,ee=65535&Ze,!(B<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if((240&Y)==0){for(fe=B,ye=Y,Ee=ee;Ze=s.distcode[Ee+((E&(1<<fe+ye)-1)>>fe)],B=Ze>>>24,Y=Ze>>>16&255,ee=65535&Ze,!(fe+B<=S);){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}E>>>=fe,S-=fe,s.back+=fe}if(E>>>=B,S-=B,s.back+=B,64&Y){e.msg="invalid distance code",s.mode=ls;break}s.offset=ee,s.extra=15&Y,s.mode=16203;case 16203:if(s.extra){for(In=s.extra;S<In;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}s.offset+=E&(1<<s.extra)-1,E>>>=s.extra,S-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){e.msg="invalid distance too far back",s.mode=ls;break}s.mode=16204;case 16204:if(y===0)break e;if(D=P-y,s.offset>D){if(D=s.offset-D,D>s.whave&&s.sane){e.msg="invalid distance too far back",s.mode=ls;break}D>s.wnext?(D-=s.wnext,G=s.wsize-D):G=s.wnext-D,D>s.length&&(D=s.length),j=s.window}else j=c,G=h-s.offset,D=s.length;D>y&&(D=y),y-=D,s.length-=D;do c[h++]=j[G++];while(--D);s.length===0&&(s.mode=ZP);break;case 16205:if(y===0)break e;c[h++]=s.length,y--,s.mode=ZP;break;case k2:if(s.wrap){for(;S<32;){if(m===0)break e;m--,E|=o[u++]<<S,S+=8}if(P-=y,e.total_out+=P,s.total+=P,4&s.wrap&&P&&(e.adler=s.check=Ao(s)?Xo(s.check,c,P,h-P):QT(s.check,c,P,h-P)),P=y,4&s.wrap&&(Ao(s)?E:n7(E))!==s.check){e.msg="incorrect data check",s.mode=ls;break}E=0,S=0}s.mode=16207;case 16207:if(s.wrap&&Ao(s)){for(;S<32;){if(m===0)break e;m--,E+=o[u++]<<S,S+=8}if(4&s.wrap&&E!==(4294967295&s.total)){e.msg="incorrect length check",s.mode=ls;break}E=0,S=0}s.mode=16208;case 16208:Ne=T_e;break e;case ls:Ne=Z$;break e;case 16210:return e7;default:return xu}return e.next_out=h,e.avail_out=y,e.next_in=u,e.avail_in=m,s.hold=E,s.bits=S,(s.wsize||P!==e.avail_out&&s.mode<ls&&(s.mode<k2||r!==Q$))&&c7(e,e.output,e.next_out,P-e.avail_out),R-=e.avail_in,P-=e.avail_out,e.total_in+=R,e.total_out+=P,s.total+=P,4&s.wrap&&P&&(e.adler=s.check=Ao(s)?Xo(s.check,c,P,e.next_out-P):QT(s.check,c,P,e.next_out-P)),e.data_type=s.bits+(s.last?64:0)+(s.mode===Ef?128:0)+(s.mode===QP||s.mode===O2?256:0),(R===0&&P===0||r===Q$)&&Ne===ly&&(Ne=C_e),Ne},vf={inflateReset:i7,inflateReset2:s7,inflateResetKeep:r7,inflateInit:e=>o7(e,15),inflateInit2:o7,inflate:A_e,inflateEnd:e=>{if(uy(e))return xu;let r=e.state;return r.window&&(r.window=null),e.state=null,ly},inflateGetHeader:(e,r)=>{if(uy(e))return xu;const s=e.state;return(2&s.wrap)==0?xu:(s.head=r,r.done=!1,ly)},inflateSetDictionary:(e,r)=>{const s=r.length;let o,c,u;return uy(e)?xu:(o=e.state,o.wrap!==0&&o.mode!==JP?xu:o.mode===JP&&(c=1,c=QT(c,r,s,0),c!==o.check)?Z$:(u=c7(e,r,s,s),u?(o.mode=16210,e7):(o.havedict=1,ly)))},inflateInfo:"pako inflate (from Nodeca project)"},P_e=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const l7=Object.prototype.toString,{Z_NO_FLUSH:O_e,Z_FINISH:k_e,Z_OK:aw,Z_STREAM_END:x2,Z_NEED_DICT:L2,Z_STREAM_ERROR:N_e,Z_DATA_ERROR:u7,Z_MEM_ERROR:D_e}=BP;function eO(e){this.options=GP.assign({chunkSize:65536,windowBits:15,to:""},e||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||e&&e.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(15&r.windowBits)==0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new X$,this.strm.avail_out=0;let s=vf.inflateInit2(this.strm,r.windowBits);if(s!==aw)throw new Error(sy[s]);if(this.header=new P_e,vf.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=sw.string2buf(r.dictionary):l7.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(s=vf.inflateSetDictionary(this.strm,r.dictionary),s!==aw)))throw new Error(sy[s])}function x_e(e,r){const s=new eO(r);if(s.push(e),s.err)throw s.msg||sy[s.err];return s.result}eO.prototype.push=function(e,r){const s=this.strm,o=this.options.chunkSize,c=this.options.dictionary;let u,h,m;if(this.ended)return!1;for(h=r===~~r?r:r===!0?k_e:O_e,l7.call(e)==="[object ArrayBuffer]"?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;){for(s.avail_out===0&&(s.output=new Uint8Array(o),s.next_out=0,s.avail_out=o),u=vf.inflate(s,h),u===L2&&c&&(u=vf.inflateSetDictionary(s,c),u===aw?u=vf.inflate(s,h):u===u7&&(u=L2));s.avail_in>0&&u===x2&&s.state.wrap>0&&e[s.next_in]!==0;)vf.inflateReset(s),u=vf.inflate(s,h);switch(u){case N_e:case u7:case L2:case D_e:return this.onEnd(u),this.ended=!0,!1}if(m=s.avail_out,s.next_out&&(s.avail_out===0||u===x2))if(this.options.to==="string"){let y=sw.utf8border(s.output,s.next_out),E=s.next_out-y,S=sw.buf2string(s.output,y);s.next_out=E,s.avail_out=o-E,E&&s.output.set(s.output.subarray(y,y+E),0),this.onData(S)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(u!==aw||m!==0){if(u===x2)return u=vf.inflateEnd(this.strm),this.onEnd(u),this.ended=!0,!0;if(s.avail_in===0)break}}return!0},eO.prototype.onData=function(e){this.chunks.push(e)},eO.prototype.onEnd=function(e){e===aw&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=GP.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var L_e={inflate:x_e};const{deflate:M_e}=g_e,{inflate:U_e}=L_e;var V_e=M_e,j_e=U_e,d7=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(d7||{});class F_e{constructor(){q(this,"_sequence",0),q(this,"_startTime",Date.now()),q(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const s={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const m=new Uint8Array(4);m.set([1,0,0,0]);const y={id:0,length:4,data:m.buffer},E={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[y]};s.commonPacketHeader.extension=1,s.extension=E,s.payload=this.compress(r),s.commonPacketHeader.length=8+(s.extension.length+2)+s.payload.byteLength}else s.commonPacketHeader.length=8+s.payload.byteLength;oe("SHOW_DATASTREAM2_LOG")&&x.debug("send data header: ".concat(JSON.stringify(s.commonPacketHeader)));const o=new ArrayBuffer(s.commonPacketHeader.length),c=new Uint8Array(o),u=new DataView(o);let h=0;if(u.setUint16(h,s.commonPacketHeader.extension<<15|s.commonPacketHeader.reserved<<14|s.commonPacketHeader.length,!0),h+=2,u.setUint32(h,s.commonPacketHeader.sequence,!0),h+=4,u.setUint16(h,s.commonStreamHeader,!0),h+=2,s.extension){const m=this.serializeExtension(s.extension);c.set(new Uint8Array(m),h),h+=m.byteLength}if(c.set(new Uint8Array(s.payload),h),h+=s.payload.byteLength,h!==s.commonPacketHeader.length)throw Error("serialize error!");return o}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const s=new DataView(r);let o=0;const c=s.getUint16(o,!0);o+=2;const u={length:16383&c,reserved:(16384&c)>>14,extension:(32768&c)>>15,sequence:s.getUint16(o+2,!0)<<16|s.getUint16(o,!0)};let h,m;if(o+=4,oe("SHOW_DATASTREAM2_LOG")&&x.debug("receive data header: ".concat(JSON.stringify(u))),s.getUint16(o,!0),o+=2,u.extension){m=this.deserializeExtension(r.slice(o)),o+=2+m.length,h=r.slice(o);let y=!1;if(m.datas.length>0){const E=m.datas.find(S=>S.id===0);E&&(y=(1&new DataView(E.data).getUint32(0,!0))==1)}h=y?this.decompress(h):h}else h=r.slice(8);return h}serializeExtension(r){const{profile:s,length:o,datas:c}=r,u=new ArrayBuffer(o+2),h=new Uint8Array(u),m=new DataView(u);let y=0;if(m.setUint8(y++,s),m.setUint8(y++,o),c.forEach(E=>{s?(m.setUint8(y++,E.id),m.setUint8(y++,E.length),h.set(new Uint8Array(E.data),y),y+=E.data.byteLength):(m.setUint8(y++,E.id|E.length<<4),h.set(new Uint8Array(E.data),y),y+=E.data.byteLength)}),y!==o+2)throw Error("serialize extension error, is ".concat(y,"!==").concat(o+2));return u}deserializeExtension(r){const s=new DataView(r);let o=0;const c=s.getUint8(o);o++;const u=s.getUint8(o);o++;const h=c===d7.TWO_BYTE,m=[],y=new DataView(r,2);let E=0;for(;E<u;){let S=0,R=0,P=new ArrayBuffer(0);h?(S=y.getUint8(E),E++,R=y.getUint8(E),E++):(S=15&y.getUint8(E),R=y.getUint8(E)>>4,E++),R>0&&(P=y.buffer.slice(E+2,E+2+R),E+=P.byteLength),m.push({id:S,length:R,data:P})}if(E!==u)throw Error("parse error");return{profile:c,length:u,datas:m}}decompress(r){return j_e(new Uint8Array(r))}compress(r){return V_e(new Uint8Array(r))}}const B_e={name:"DataStream",create:(e,r)=>{const s=r?new qfe(e):new Yfe(e);return s.useDataStream(new F_e),s}};class z_e extends jr{constructor(r,s,o){super(),q(this,"ws",void 0),q(this,"requestId",1),q(this,"heartBeatTimer",void 0),q(this,"joinInfo",void 0),q(this,"clientId",void 0),q(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),q(this,"onClose",c=>{this.emit("close"),this.dispose()}),q(this,"onMessage",c=>{const u=JSON.parse(c.data);if(!u||u.command!=="serverResponse"||!u.requestId)return u&&u.command==="serverStatus"&&u.serverStatus&&u.serverStatus.command?(this.emit("status",u.serverStatus),void this.emit(u.serverStatus.command,u.serverStatus)):void 0;this.emit("req_".concat(u.requestId),u)}),this.joinInfo=r,this.clientId=s,this.ws=new DT("cross-channel-".concat(this.clientId),o),this.ws.on(nn.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(nn.CONNECTED,this.onOpen),this.ws.on(nn.ON_MESSAGE,this.onMessage),this.ws.on(nn.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const s=this.requestId++;return r.requestId=s,r.seq=s,this.ws.sendMessage(r),s}waitStatus(r){return new ht((s,o)=>{const c=window.setTimeout(()=>{o(new Ae(te.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,u=>{window.clearTimeout(c),u.state&&u.state!==0?o(new Ae(te.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):s(void 0)}),this.once("dispose",()=>{window.clearTimeout(c),o(new Ae(te.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new Ae(te.WS_DISCONNECT);const s=()=>new ht((h,m)=>{this.ws.once(nn.CLOSED,()=>m(new Ae(te.WS_ABORT))),this.ws.once(nn.CONNECTED,h)});this.ws.state!=="connected"&&await s();const o=this.sendMessage(r),c=new ht((h,m)=>{const y=()=>{m(new Ae(te.WS_ABORT))};this.ws.once(nn.RECONNECTING,y),this.ws.once(nn.CLOSED,y),this.once("req_".concat(o),h),ps(3e3).then(()=>{this.removeAllListeners("req_".concat(o)),this.ws.off(nn.RECONNECTING,y),this.ws.off(nn.CLOSED,y),m(new Ae(te.TIMEOUT,"cross channel ws request timeout"))})}),u=await c;if(!u||u.code!==200)throw new Ae(te.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(u)));return u}async connect(r){this.ws.removeAllListeners(nn.REQUEST_NEW_URLS),this.ws.on(nn.REQUEST_NEW_URLS,s=>{s(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const s=this.requestId++;return r.requestId=s,this.ws.sendMessage(r),s}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class W_e extends jr{set state(r){r!==this._state&&(r!==Ya.RELAY_STATE_FAILURE&&(this.errorCode=nS.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,s,o,c,u){super(),q(this,"joinInfo",void 0),q(this,"sid",void 0),q(this,"clientId",void 0),q(this,"cancelToken",_a.CancelToken.source()),q(this,"workerToken",void 0),q(this,"requestId",0),q(this,"signal",void 0),q(this,"prevChannelMediaConfig",void 0),q(this,"httpRetryConfig",void 0),q(this,"_resolution",void 0),q(this,"_state",Ya.RELAY_STATE_IDLE),q(this,"errorCode",nS.RELAY_OK),q(this,"onStatus",h=>{x.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(h))),h&&h.command&&(h.command==="onAudioPacketReceived"&&this.emit("event",pf.PACKET_RECEIVED_AUDIO_FROM_SRC),h.command==="onVideoPacketReceived"&&this.emit("event",pf.PACKET_RECEIVED_VIDEO_FROM_SRC),h.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=nS.SRC_TOKEN_EXPIRED,this.state=Ya.RELAY_STATE_FAILURE),h.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=nS.DEST_TOKEN_EXPIRED,this.state=Ya.RELAY_STATE_FAILURE))}),q(this,"onReconnect",async()=>{x.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",pf.NETWORK_DISCONNECTED),this.state=Ya.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(h=>{this.state!==Ya.RELAY_STATE_IDLE&&(x.error("auto restart channel media relay failed",h.toString()),this.errorCode=nS.SERVER_CONNECTION_LOST,this.state=Ya.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=s,this.sid=z_(),this.signal=new z_e(this.joinInfo,this.clientId,o),this.httpRetryConfig=c,this._resolution=u}async startChannelMediaRelay(r){if(this.state!==Ya.RELAY_STATE_IDLE)throw new Ae(te.INVALID_OPERATION);this.state=Ya.RELAY_STATE_CONNECTING,await this.connect(),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(s){throw s.data&&s.data.serverResponse&&s.data.serverResponse.command==="SetSourceChannel"?new Ae(te.CROSS_CHANNEL_FAILED_JOIN_SRC):s.data&&s.data.serverResponse&&s.serverResponse.command==="SetDestChannelStatus"?new Ae(te.CROSS_CHANNEL_FAILED_JOIN_DEST):s.data&&s.data.serverResponse&&s.serverResponse.command==="StartPacketTransfer"?new Ae(te.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):s}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==Ya.RELAY_STATE_RUNNING)throw new Ae(te.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==Ya.RELAY_STATE_RUNNING)throw new Ae(te.INVALID_OPERATION);const s=this.genMessage(Yo.SetVideoProfile);await this.signal.request(s),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),x.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Ya.RELAY_STATE_IDLE,this.dispose()}dispose(){x.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=_a.CancelToken.source(),this.state=Ya.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await Zme(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",pf.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const s=this.genMessage(Yo.StopPacketTransfer);await this.signal.request(s),await this.signal.waitStatus("Normal Quit"),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const o=this.genMessage(Yo.SetSdkProfile,r);await this.signal.request(o),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const c=this.genMessage(Yo.SetSourceChannel,r);await this.signal.request(c),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",pf.PACKET_JOINED_SRC_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const u=this.genMessage(Yo.SetSourceUserId,r);await this.signal.request(u),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const h=this.genMessage(Yo.SetDestChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",pf.PACKET_JOINED_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const m=this.genMessage(Yo.StartPacketTransfer,r);await this.signal.request(m),this.emit("event",pf.PACKET_SENT_TO_DEST_CHANNEL),this.state=Ya.RELAY_STATE_RUNNING,x.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const s=this.genMessage(Yo.UpdateDestChannel,r);await this.signal.request(s),this.emit("event",pf.PACKET_UPDATE_DEST_CHANNEL),x.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(Yo.StopPacketTransfer);await this.signal.request(r),x.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,s){const o=[],c=[],u=[];this.requestId+=1;const h={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Dl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};h.sdkVersion==="4.23.2"&&(h.sdkVersion="0.0.1");let m=null,y=null;switch(r){case Yo.SetSdkProfile:return h.clientRequest={command:"SetSdkProfile",type:"multi_channel"},h;case Yo.SetSourceChannel:if(y=s&&s.getSrcChannelMediaInfo(),!y)throw new Ae(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceChannel",uid:"0",channelName:y.channelName,token:y.token||this.joinInfo.appId},h;case Yo.SetSourceUserId:if(y=s&&s.getSrcChannelMediaInfo(),!y)throw new Ae(te.UNEXPECTED_ERROR,"can not find source config");return h.clientRequest={command:"SetSourceUserId",uid:y.uid+""},h;case Yo.SetDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Ae(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(E=>{o.push(E.channelName),c.push(E.uid+""),u.push(E.token||this.joinInfo.appId)}),h.clientRequest={command:"SetDestChannel",channelName:o,uid:c,token:u},h;case Yo.StartPacketTransfer:return h.clientRequest={command:"StartPacketTransfer"},h;case Yo.Reconnect:return h.clientRequest={command:"Reconnect"},h;case Yo.StopPacketTransfer:return h.clientRequest={command:"StopPacketTransfer"},h;case Yo.UpdateDestChannel:if(m=s&&s.getDestChannelMediaInfo(),!m)throw new Ae(te.UNEXPECTED_ERROR,"can not find dest config");return m.forEach(E=>{o.push(E.channelName),c.push(E.uid+""),u.push(E.token||this.joinInfo.appId)}),h.clientRequest={command:"UpdateDestChannel",channelName:o,uid:c,token:u},h;case Yo.SetVideoProfile:h.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return h}}const G_e={name:"ChannelMediaRelay",create:function(e){return new W_e(e.joinInfo,e.clientId,e.websocketRetryConfig||Pi,e.httpRetryConfig||Pi,e.resolution)}};function h7(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function cw(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?h7(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):h7(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}class H_e extends jr{constructor(r,s,o,c){super(),q(this,"spec",void 0),q(this,"token",void 0),q(this,"websocket",void 0),q(this,"pingpongTimer",void 0),q(this,"reconnectMode","retry"),q(this,"serviceMode",void 0),q(this,"reqId",0),q(this,"commandReqId",0),q(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),q(this,"handleWebSocketMessage",u=>{if(!u.data)return;const h=JSON.parse(u.data);h.requestId?this.emit("@".concat(h.requestId,"-").concat(h.sid),h):(Nt.workerEvent(this.spec.sid,{actionType:"status",serverCode:h.code,workerType:this.serviceMode===hf.TRANSCODE?1:2}),this.emit(Hm.PUBLISH_STREAM_STATUS,h))}),this.spec=s,this.token=r,this.serviceMode=c,this.websocket=new DT("live-streaming",o),this.websocket.on(nn.CONNECTED,this.handleWebSocketOpen),this.websocket.on(nn.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(nn.REQUEST_NEW_URLS,(u,h)=>{Os(this,Hm.REQUEST_NEW_ADDRESS).then(u).catch(h)}),this.websocket.on(nn.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,s,o,c){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const u=this.commandReqId,h=this.reqId;if(!h||!this.websocket)throw new Ae(te.UNEXPECTED_ERROR);const m=cw({command:r,sdkVersion:Dl==="4.23.2"?"0.0.1":Dl,seq:h,requestId:h,allocate:o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},s);if(this.websocket.state==="closed")throw new Ae(te.WS_DISCONNECT);const y=()=>new ht((P,D)=>{this.websocket.once(nn.CLOSED,()=>D(new Ae(te.WS_ABORT))),this.websocket.once(nn.CONNECTED,P)});this.websocket.state!=="connected"&&await y(),m.clientRequest&&(m.clientRequest.workerToken=this.token);const E=new ht((P,D)=>{const G=()=>{D(new Ae(te.WS_ABORT))};this.websocket.once(nn.RECONNECTING,G),this.websocket.once(nn.CLOSED,G),this.once("@".concat(h,"-").concat(this.spec.sid),j=>{P(j)})});c&&Nt.workerEvent(this.spec.sid,cw(cw({},c),{},{requestId:u,actionType:"request",payload:JSON.stringify(s.clientRequest),serverCode:0,code:0}));const S=Date.now();this.websocket.sendMessage(m);let R=null;try{R=await E}catch(P){if(this.websocket.state==="closed")throw P;return await y(),await this.request(r,s,o)}return c&&Nt.workerEvent(this.spec.sid,cw(cw({},c),{},{requestId:u,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-S})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=Dl==="4.23.2"?"0.0.1":Dl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case Ui.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void x.warning("live stream response already exists stream");case Ui.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Ui.LIVE_STREAM_RESPONSE_BAD_STREAM:case Ui.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Ae(te.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case Ui.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ui.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Ae(te.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case Ui.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new Ae(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(Hm.WARNING,s,r.serverResponse.url)}case Ui.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const s=new Ae(te.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(Hm.WARNING,s,r.serverResponse.url)}case Ui.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ui.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Ae(te.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case Ui.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const s=new Ae(te.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(Hm.WARNING,s,r.serverResponse.url)}case Ui.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case Ui.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Ui.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ui.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ui.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ui.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ui.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ui.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ui.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Ae(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(BA)},6e3)}}function p7(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function Xa(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?p7(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):p7(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}class $_e extends jr{constructor(r){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pi,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Pi;super(),q(this,"onLiveStreamWarning",void 0),q(this,"onLiveStreamError",void 0),q(this,"spec",void 0),q(this,"retryTimeout",1e4),q(this,"connection",void 0),q(this,"httpRetryConfig",void 0),q(this,"wsRetryConfig",void 0),q(this,"streamingTasks",new Map),q(this,"isStartingStreamingTask",!1),q(this,"taskMutex",new qs("live-streaming")),q(this,"cancelToken",_a.CancelToken.source()),q(this,"transcodingConfig",void 0),q(this,"uapResponse",void 0),q(this,"lastTaskId",1),q(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=o,this.wsRetryConfig=s}async setTranscodingConfig(r){const s=Xa(Xa({},Nme),r);s.videoCodecProfile!==66&&s.videoCodecProfile!==77&&s.videoCodecProfile!==100&&(x.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(s.videoCodecProfile," -> 100")),s.videoCodecProfile=100),s.transcodingUsers||(s.transcodingUsers=s.userConfigs),s.transcodingUsers&&(s.transcodingUsers=s.transcodingUsers.map(h=>Xa(Xa(Xa({},kme),h),{},{zOrder:h.zOrder?h.zOrder+1:1}))),function(h){Gr(h.width)||cr(h.width,"config.width",0,1e4),Gr(h.height)||cr(h.height,"config.height",0,1e4),Gr(h.videoBitrate)||cr(h.videoBitrate,"config.videoBitrate",1,1e6),Gr(h.videoFrameRate)||cr(h.videoFrameRate,"config.videoFrameRate"),Gr(h.lowLatency)||cf(h.lowLatency,"config.lowLatency"),Gr(h.audioSampleRate)||Wi(h.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Gr(h.audioBitrate)||cr(h.audioBitrate,"config.audioBitrate",1,128),Gr(h.audioChannels)||Wi(h.audioChannels,"config.audioChannels",[1,2,3,4,5]),Gr(h.videoGop)||cr(h.videoGop,"config.videoGop"),Gr(h.videoCodecProfile)||Wi(h.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Gr(h.userCount)||cr(h.userCount,"config.userCount",0,17),Gr(h.backgroundColor)||cr(h.backgroundColor,"config.backgroundColor",0,16777215),Gr(h.userConfigExtraInfo)||hs(h.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),h.transcodingUsers&&!Gr(h.transcodingUsers)&&(lf(h.transcodingUsers,"config.transcodingUsers"),h.transcodingUsers.forEach((m,y)=>{dP(m.uid),Gr(m.x)||cr(m.x,"transcodingUser[".concat(y,"].x"),0,1e4),Gr(m.y)||cr(m.y,"transcodingUser[".concat(y,"].y"),0,1e4),Gr(m.width)||cr(m.width,"transcodingUser[".concat(y,"].width"),0,1e4),Gr(m.height)||cr(m.height,"transcodingUser[".concat(y,"].height"),0,1e4),Gr(m.zOrder)||cr(m.zOrder-1,"transcodingUser[".concat(y,"].zOrder"),0,100),Gr(m.alpha)||cr(m.alpha,"transcodingUser[".concat(y,"].alpha"),0,1,!1)})),Gr(h.watermark)||UL(h.watermark,"watermark"),Gr(h.backgroundImage)||UL(h.backgroundImage,"backgroundImage"),h.images&&!Gr(h.images)&&(lf(h.images,"config.images"),h.images.forEach((m,y)=>{UL(m,"images[".concat(y,"]"))}))}(s);const o=[];s.images&&o.push(...s.images.map(h=>Xa(Xa(Xa({},ML),h),{},{zOrder:255}))),s.backgroundImage&&(o.push(Xa(Xa(Xa({},ML),s.backgroundImage),{},{zOrder:0})),delete s.backgroundImage),s.watermark&&(o.push(Xa(Xa(Xa({},ML),s.watermark),{},{zOrder:255})),delete s.watermark),s.images=o,s.transcodingUsers&&(s.userConfigs=s.transcodingUsers.map(h=>Xa({},h)),s.userCount=s.transcodingUsers.length,delete s.transcodingUsers);const c=(s.userConfigs||[]).map(h=>typeof h.uid=="number"?ht.resolve(h.uid):L9(h.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await ht.all(c)).forEach((h,m)=>{s.userConfigs&&s.userConfigs[m]&&(s.userConfigs[m].uid=h)}),this.transcodingConfig=s,this.connection)try{var u;const h=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Xc(u=this.streamingTasks).call(u)).map(m=>m.taskId).join("#")});x.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(h.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(h){if(!h.data||!h.data.retry)throw h;h.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(m=>{x.warning("[".concat(this.spec.clientId,"] live streaming receive error"),h.toString(),"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,h).then(()=>{x.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(m.url," success"))}).catch(y=>{x.error("[".concat(this.spec.clientId,"] live streaming republish failed"),m.url,y.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,y)})})}}async startLiveStreamingTask(r,s,o){if(!this.transcodingConfig&&s===hf.TRANSCODE)throw new Ae(te.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const c={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};x.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(s));const u=await this.taskMutex.lock();if(!this.connection&&o)return void u();if(this.streamingTasks.get(r)&&!o)return u(),new Ae(te.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(s))}catch(m){throw u(),m}switch(s){case hf.TRANSCODE:c.transcodingConfig=Xa({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(c.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const h=this.lastTaskId++;try{const m=new ht((E,S)=>{ps(this.retryTimeout).then(()=>{if(o)return S(o);const R=this.statusError.get(r);return R?(this.statusError.delete(r),S(R)):void 0})}),y=await ht.race([this.connection.request("request",{clientRequest:c},!0,{url:r,command:"PublishStream",workerType:s===hf.TRANSCODE?1:2,requestByUser:!o,tid:h.toString()}),m]);this.isStartingStreamingTask=!1,x.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(y.code)),this.streamingTasks.set(r,{clientRequest:c,mode:s,url:r,taskId:h}),u()}catch(m){if(u(),this.isStartingStreamingTask=!1,!m.data||!m.data.retry||o)throw m;return m.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,s,m)):await this.startLiveStreamingTask(r,s,m)}}stopLiveStreamingTask(r){return new ht((s,o)=>{const c=this.streamingTasks.get(r);if(!c||!this.connection)return new Ae(te.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const u=c.mode;c.abortTask=()=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),s()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:c.url}},!1,{url:r,command:"UnPublishStream",workerType:u===hf.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(h=>{x.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(h.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),s()}).catch(o)})}resetAllTask(){var r;const s=Array.from(Xc(r=this.streamingTasks).call(r));this.terminate();for(const o of s)this.startLiveStreamingTask(o.url,o.mode).catch(c=>{this.onLiveStreamError&&this.onLiveStreamError(o.url,c)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=_a.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new Ae(te.UNEXPECTED_ERROR,"live streaming connection has already connected");const s=await Os(this,VL.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=s,this.connection=new H_e(s.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(Hm.WARNING,(o,c)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(c,o)),this.connection.on(Hm.PUBLISH_STREAM_STATUS,o=>this.handlePublishStreamServer(o)),this.connection.on(Hm.REQUEST_NEW_ADDRESS,(o,c)=>{if(!this.connection)return c(new Ae(te.UNEXPECTED_ERROR,"can not get new live streaming address list"));Os(this,VL.REQUEST_WORKER_MANAGER_LIST,r).then(u=>{this.uapResponse=u,o(u.addressList)}).catch(c)}),await this.connection.init(s.addressList),this.connection}handlePublishStreamServer(r){const s=r.serverStatus&&r.serverStatus.url||"empty_url",o=this.streamingTasks.get(s),c=r.reason;switch(r.code){case Ui.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ui.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ui.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ui.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const h=new Ae(te.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(o)return x.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(s,h);if(!this.isStartingStreamingTask)return;this.statusError.set(s,h)}case Ui.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const h=new Ae(te.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,c);return this.onLiveStreamWarning&&this.onLiveStreamWarning(s,h)}case Ui.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ui.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var u;if(!this.connection)return;this.connection.tryNextAddress();const h=Array.from(Xc(u=this.streamingTasks).call(u));for(const m of h)m.abortTask?m.abortTask():(x.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",m.url),this.startLiveStreamingTask(m.url,m.mode,new Ae(te.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{x.debug("[".concat(this.spec.clientId,"] republish live stream success"),m.url)}).catch(y=>{x.error(y.toString()),this.onLiveStreamError&&this.onLiveStreamError(m.url,y)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const K_e={name:"LiveStreaming",create:function(e){return new $_e(e.joinInfo,e.websocketRetryConfig||Pi,e.httpRetryConfig||Pi)}};function q_e(e){let r=g7();return function(s,o){let c=s.appId;c!==void 0&&(tr(o,10),Fh(o,c));let u=s.cid;u!==void 0&&(tr(o,16),tr(o,u));let h=s.cname;h!==void 0&&(tr(o,26),Fh(o,h));let m=s.deviceId;m!==void 0&&(tr(o,34),Fh(o,m));let y=s.elapse;y!==void 0&&(tr(o,40),sg(o,y));let E=s.fileSize;E!==void 0&&(tr(o,48),sg(o,ES(E)));let S=s.height;S!==void 0&&(tr(o,56),sg(o,ES(S)));let R=s.jpg;R!==void 0&&(tr(o,66),tr(o,R.length),function(Ta,We){let ot=vS(Ta,We.length);Ta.bytes.set(We,ot)}(o,R));let P=s.networkType;P!==void 0&&(tr(o,72),sg(o,ES(P)));let D=s.osType;D!==void 0&&(tr(o,80),sg(o,ES(D)));let G=s.requestId;G!==void 0&&(tr(o,90),Fh(o,G));let j=s.sdkVersion;j!==void 0&&(tr(o,98),Fh(o,j));let B=s.sequence;B!==void 0&&(tr(o,104),sg(o,ES(B)));let Y=s.sid;Y!==void 0&&(tr(o,114),Fh(o,Y));let ee=s.timestamp;ee!==void 0&&(tr(o,120),sg(o,ee));let fe=s.uid;fe!==void 0&&(tr(o,128),tr(o,fe));let ye=s.vid;ye!==void 0&&(tr(o,136),tr(o,ye));let Ee=s.width;Ee!==void 0&&(tr(o,144),sg(o,ES(Ee)));let _e=s.service;_e!==void 0&&(tr(o,152),tr(o,_e));let Ne=s.callbackData;Ne!==void 0&&(tr(o,162),Fh(o,Ne));let Ze=s.jpgEncryption;Ze!==void 0&&(tr(o,168),tr(o,Ze));let pt=s.requestType;pt!==void 0&&(tr(o,176),tr(o,pt));let yt=s.scorePorn;yt!==void 0&&(tr(o,185),F2(o,yt));let In=s.scoreSexy;In!==void 0&&(tr(o,193),F2(o,In));let An=s.scoreNeutral;An!==void 0&&(tr(o,201),F2(o,An));let mr=s.scene;mr!==void 0&&(tr(o,208),tr(o,mr));let li=s.ossFilePrefix;li!==void 0&&(tr(o,218),Fh(o,li));let Jr=s.serviceVendor;if(Jr!==void 0)for(let Ta of Jr){tr(o,226);let We=g7();J_e(Ta,We),tr(o,We.limit),tye(o,We),eye(We)}}(e,r),function(s){let o=s.bytes,c=s.limit;return o.length===c?o:o.subarray(0,c)}(r)}function Y_e(e){return function(s){let o={};e:for(;!_7(s);){let c=Bh(s);switch(c>>>3){case 0:break e;case 1:o.code=Bh(s);break;case 2:o.msg=y7(s,Bh(s));break;case 3:{let u=Q_e(s);o.data=X_e(s),s.limit=u;break}default:f7(s,7&c)}}return o}({bytes:r=e,offset:0,limit:r.length});var r}function X_e(e){let r={};e:for(;!_7(e);){let s=Bh(e);switch(s>>>3){case 0:break e;case 1:r.requestId=y7(e,Bh(e));break;case 2:r.requestType=Bh(e)>>>0;break;case 3:r.scorePorn=j2(e);break;case 4:r.scoreSexy=j2(e);break;case 5:r.scoreNeutral=j2(e);break;case 6:r.requestScene=Bh(e)>>>0;break;case 7:r.scene=Bh(e)>>>0;break;default:f7(e,7&s)}}return r}function J_e(e,r){let s=e.service;s!==void 0&&(tr(r,8),tr(r,s));let o=e.vendor;o!==void 0&&(tr(r,16),tr(r,o));let c=e.token;c!==void 0&&(tr(r,26),Fh(r,c));let u=e.callbackUrl;u!==void 0&&(tr(r,34),Fh(r,u))}function Q_e(e){let r=Bh(e),s=e.limit;return e.limit=e.offset+r,s}function f7(e,r){switch(r){case 0:for(;128&E7(e););break;case 2:U2(e,Bh(e));break;case 5:U2(e,4);break;case 1:U2(e,8);break;default:throw new Error("Unimplemented type: "+r)}}let Z_e=new Float32Array(1);new Uint8Array(Z_e.buffer);let M2=new Float64Array(1),Ja=new Uint8Array(M2.buffer);function ES(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let m7=[];function g7(){const e=m7.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function eye(e){m7.push(e)}function U2(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function _7(e){return e.offset>=e.limit}function vS(e,r){let s=e.bytes,o=e.offset,c=e.limit,u=o+r;if(u>s.length){let h=new Uint8Array(2*u);h.set(s),e.bytes=h}return e.offset=u,u>c&&(e.limit=u),o}function V2(e,r){let s=e.offset;if(s+r>e.limit)throw new Error("Read past limit");return e.offset+=r,s}function y7(e,r){let s=V2(e,r),o=String.fromCharCode,c=e.bytes,u="",h="";for(let m=0;m<r;m++){let y,E,S,R,P=c[m+s];(128&P)==0?h+=o(P):(224&P)==192?m+1>=r?h+=u:(y=c[m+s+1],(192&y)!=128?h+=u:(R=(31&P)<<6|63&y,R<128?h+=u:(h+=o(R),m++))):(240&P)==224?m+2>=r?h+=u:(y=c[m+s+1],E=c[m+s+2],(49344&(y|E<<8))!=32896?h+=u:(R=(15&P)<<12|(63&y)<<6|63&E,R<2048||R>=55296&&R<=57343?h+=u:(h+=o(R),m+=2))):(248&P)==240?m+3>=r?h+=u:(y=c[m+s+1],E=c[m+s+2],S=c[m+s+3],(12632256&(y|E<<8|S<<16))!=8421504?h+=u:(R=(7&P)<<18|(63&y)<<12|(63&E)<<6|63&S,R<65536||R>1114111?h+=u:(R-=65536,h+=o(55296+(R>>10),56320+(1023&R)),m+=3))):h+=u}return h}function Fh(e,r){let s=r.length,o=0;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),o+=m<128?1:m<2048?2:m<65536?3:4}tr(e,o);let c=vS(e,o),u=e.bytes;for(let h=0;h<s;h++){let m=r.charCodeAt(h);m>=55296&&m<=56319&&h+1<s&&(m=(m<<10)+r.charCodeAt(++h)-56613888),m<128?u[c++]=m:(m<2048?u[c++]=m>>6&31|192:(m<65536?u[c++]=m>>12&15|224:(u[c++]=m>>18&7|240,u[c++]=m>>12&63|128),u[c++]=m>>6&63|128),u[c++]=63&m|128)}}function tye(e,r){let s=vS(e,r.limit),o=e.bytes,c=r.bytes;for(let u=0,h=r.limit;u<h;u++)o[u+s]=c[u]}function E7(e){return e.bytes[V2(e,1)]}function v7(e,r){let s=vS(e,1);e.bytes[s]=r}function j2(e){let r=V2(e,8),s=e.bytes;return Ja[0]=s[r++],Ja[1]=s[r++],Ja[2]=s[r++],Ja[3]=s[r++],Ja[4]=s[r++],Ja[5]=s[r++],Ja[6]=s[r++],Ja[7]=s[r++],M2[0]}function F2(e,r){let s=vS(e,8),o=e.bytes;M2[0]=r,o[s++]=Ja[0],o[s++]=Ja[1],o[s++]=Ja[2],o[s++]=Ja[3],o[s++]=Ja[4],o[s++]=Ja[5],o[s++]=Ja[6],o[s++]=Ja[7]}function Bh(e){let r,s=0,o=0;do r=E7(e),s<32&&(o|=(127&r)<<s),s+=7;while(128&r);return o}function tr(e,r){for(r>>>=0;r>=128;)v7(e,127&r|128),r>>>=7;v7(e,r)}function sg(e,r){let s=r.low>>>0,o=(r.low>>>28|r.high<<4)>>>0,c=r.high>>>24,u=c===0?o===0?s<16384?s<128?1:2:s<1<<21?3:4:o<16384?o<128?5:6:o<1<<21?7:8:c<128?9:10,h=vS(e,u),m=e.bytes;switch(u){case 10:m[h+9]=c>>>7&1;case 9:m[h+8]=u!==9?128|c:127&c;case 8:m[h+7]=u!==8?o>>>21|128:o>>>21&127;case 7:m[h+6]=u!==7?o>>>14|128:o>>>14&127;case 6:m[h+5]=u!==6?o>>>7|128:o>>>7&127;case 5:m[h+4]=u!==5?128|o:127&o;case 4:m[h+3]=u!==4?s>>>21|128:s>>>21&127;case 3:m[h+2]=u!==3?s>>>14|128:s>>>14&127;case 2:m[h+1]=u!==2?s>>>7|128:s>>>7&127;case 1:m[h]=u!==1?128|s:127&s}}function S7(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}const nye=new Map([["moderation",1],["supervise",2]]);class rye extends jr{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const s=this._connectionState;this._connectionState=r,this.emit(cs.CONNECTION_STATE_CHANGE,s,r)}get inspectType(){return this._inspectType}set inspectType(r){var s;this._inspectMode=gc(s=r.map(o=>nye.get(o)||0)).call(s,(o,c)=>o+c),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),q(this,"name","AgoraRTCVideoContentInspect"),q(this,"_connectionState",Au.CONNECTING),q(this,"_innerConnectionState",void 0),q(this,"sequence",0),q(this,"inspectStartTime",void 0),q(this,"workerManagerConnection",void 0),q(this,"workerConnection",void 0),q(this,"workerMessageLengthLimit",void 0),q(this,"inspectIntervalMinimum",void 0),q(this,"qualityRatio",void 0),q(this,"_connectInfo",void 0),q(this,"_cancelTokenSource",_a.CancelToken.source()),q(this,"_retryConfig",void 0),q(this,"wmSequence",0),q(this,"inspectInterval",void 0),q(this,"inspectTimer",null),q(this,"ossFilePrefix",void 0),q(this,"extraInfo",void 0),q(this,"_inspectType",void 0),q(this,"_inspectMode",void 0),q(this,"_quality",1),q(this,"qualityTimer",null),q(this,"_inspectId",void 0),q(this,"_needWorkUrlOnly",!1),q(this,"inspectImage",()=>{if(this.connectionState!==Au.CONNECTED)throw new Ae(te.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Au.CONNECTED?this.requestToInspectImage():x.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=pr(5,"inspect-"),this.workerMessageLengthLimit=oe("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=oe("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=oe("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new DT("worker-manager-"+this._inspectId,Pi),this.on(cs.STATE_CHANGE,(s,o)=>{this._innerConnectionState=s,x.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Pu[s]," ").concat(o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new DT("worker-"+this._inspectId,Pi),this.handleWorkerEvents()}async init(r,s){this.emit(cs.STATE_CHANGE,Pu.CONNECT_AP),this._connectInfo=r;const o=this._cancelTokenSource.token;return this._retryConfig=s,new ht((c,u)=>{this.on(cs.CONNECTION_STATE_CHANGE,(h,m)=>{m===Au.CONNECTED&&c()}),this.requestAP(r,o,s).then(h=>{this.connectWorkerManager(h)}).catch(h=>{u(h)})})}async requestAP(r,s,o){const c=oe("WEBCS_DOMAIN").map(m=>"https://".concat(m,"/api/v1")),u=await function(m,y,E,S){let{appId:R,areaCode:P,cname:D,sid:G,token:j,uid:B}=y;lS++;const Y="image_moderation_api",ee={service_name:Y,json_body:JSON.stringify({appId:R,areaCode:P,cname:D,command:"allocateEdge",requestId:lS,seq:lS,sid:G,token:j,ts:Date.now(),uid:B+""})};let fe,ye,Ee=m[0];return Rd(async()=>{fe=Date.now();const _e=await kd(Ee,{data:ee,cancelToken:E,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ye=Date.now()-fe,_e.code!==0){const yt=new Ae(te.UNEXPECTED_RESPONSE,"image inspect ap error, code"+_e.code,{retry:!0,responseTime:ye});throw x.error(yt.toString()),yt}const Ne=JSON.parse(_e.json_body);if(Ne.code!==200){const yt=new Ae(te.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Ne.code,", reason: ").concat(Ne.reason),{code:Ne.code,responseTime:ye});throw x.error(yt.toString()),yt}if(!Ne.servers||!Array.isArray(Ne.servers)||Ne.servers.length===0){const yt=new Ae(te.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Ne.code,responseTime:ye});throw x.error(yt.toString()),yt}const Ze=oe("VIDEO_INSPECT_WORKER_MANAGER_HOST"),pt=oe("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Ne.servers.map(yt=>{let{address:In,wss:An}=yt;if(In&&An)return"wss://".concat(In.replace(/\./g,"-"),".").concat(Ze,":").concat(pt||An)}).filter(yt=>!!yt),workerToken:Ne.workerToken,vid:Ne.vid,responseTime:ye}},(_e,Ne)=>(Nt.apworkerEvent(G,{success:!0,sc:200,serviceName:Y,responseDetail:JSON.stringify(_e.addressList),firstSuccess:Ne===0,responseTime:ye,serverIp:m[Ne%m.length]}),!1),(_e,Ne)=>(Nt.apworkerEvent(G,{success:!1,sc:_e.data&&_e.data.code||200,serviceName:Y,responseTime:ye,serverIp:m[Ne%m.length]}),!!(_e.code!==te.OPERATION_ABORTED&&_e.code!==te.UNEXPECTED_RESPONSE||_e.data&&_e.data.retry)&&(Ee=m[(Ne+1)%m.length],!0)),S)}(c,r,s,o);this.emit(cs.STATE_CHANGE,Pu.AP_CONNECTED);const{addressList:h}=u;return this.wmSequence++,h}async connectWorkerManager(r){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=s,this.emit(cs.STATE_CHANGE,Pu.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(nn.CONNECTED,async()=>{this.emit(cs.STATE_CHANGE,Pu.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(nn.CLOSED,()=>{this._innerConnectionState<Pu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(nn.FAILED,()=>{this._innerConnectionState<Pu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(nn.RECONNECTING,()=>{this._innerConnectionState<Pu.GET_WORKER_MANAGER_RESPONSE&&x.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(nn.ON_MESSAGE,async r=>{this.emit(cs.STATE_CHANGE,Pu.GET_WORKER_MANAGER_RESPONSE);const s=this.workerManagerConnection.url;this.workerManagerConnection.close();const o=JSON.parse(r.data);if(o.code!==200)throw x.error("[".concat(this._inspectId,"] Unexpected code ").concat(o.code," from worker manager")),new Ae(te.UNEXPECTED_RESPONSE,"response code of worker is unexpected",o);if(!(o.serverResponse&&o.serverResponse.portWss&&s))throw x.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(o))),new Ae(te.UNEXPECTED_RESPONSE,"response content of worker is unexpected",o);{const c=oe("VIDEO_INSPECT_WORKER_PORT")||o.serverResponse.portWss,u=s.replace(/:\d+\/?$/,":".concat(c));this.emit(cs.STATE_CHANGE,Pu.CONNECT_WORKER,u),this._needWorkUrlOnly?this.emit(cs.REQUEST_NEW_WORKER_URL,u):await this.connectWorker(u)}}),this.workerManagerConnection.on(nn.WILL_RECONNECT,(r,s,o)=>{o(r)}),this.workerManagerConnection.on(nn.REQUEST_NEW_URLS,(r,s)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(s)})}handleWorkerEvents(){this.workerConnection.on(nn.CONNECTED,async()=>{this.emit(cs.STATE_CHANGE,Pu.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Au.CONNECTED}),this.workerConnection.on(nn.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const o=Y_e(new Uint8Array(r.data));if(oe("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&x.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(o)),o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(cs.INSPECT_RESULT,void 0,void 0);if(o.data&&o.data.scorePorn&&o.data.scoreSexy&&o.data.scoreNeutral){var s;const c={porn:o.data.scorePorn,sexy:o.data.scoreSexy,neutral:o.data.scoreNeutral},u=gc(s=Object.keys(c)).call(s,(m,y)=>c[m]>c[y]?m:y,"porn"),h=Object.keys(c).find(m=>m===u);this.emit(cs.INSPECT_RESULT,h)}else this.emit(cs.INSPECT_RESULT,void 0,new Ae(te.UNEXPECTED_RESPONSE,o.code+"","There is an unexpected data on message"))}else this.emit(cs.INSPECT_RESULT,void 0,new Ae(te.UNEXPECTED_RESPONSE,o.code+"",o.msg))}else x.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(cs.INSPECT_RESULT,void 0,new Ae(te.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(nn.CLOSED,()=>{this.connectionState=Au.CLOSED}),this.workerConnection.on(nn.FAILED,()=>{this.connectionState=Au.CLOSED}),this.workerConnection.on(nn.RECONNECTING,()=>{this.connectionState=this.connectionState===Au.CONNECTED?Au.RECONNECTING:Au.CONNECTING}),this.workerConnection.on(nn.WILL_RECONNECT,(r,s,o)=>{r==="recover"&&o(r),o("tryNext")}),this.workerConnection.on(nn.REQUEST_NEW_URLS,(r,s)=>{this.workerManagerConnection.close(),this.once(cs.REQUEST_NEW_WORKER_URL,o=>{r([o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(o=>{this.connectWorkerManager(o,!0)}).catch(o=>{s(o)})})}async requestToInspectImage(){this.sequence++;const r=Qc(this,cs.CLIENT_LOCAL_VIDEO_TRACK),s={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(cs.INSPECT_RESULT,void 0,new Ae(te.INVALID_OPERATION,"Only the track being played can be inspected"));const o=await this.generateRequestData(r,s);this.workerConnection.sendMessage(o,!0,!0)}else this.emit(cs.INSPECT_RESULT,void 0,new Ae(te.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,s){let{appId:o,cname:c,cid:u,vid:h,sid:m,uid:y}=s;const E=Date.now(),S=await r.getCurrentFrameImage("image/jpeg",this.quality),R=await n8(S,o,c),P=this.sequence+"-"+u+"-"+y+"-"+E+"-"+pr(12,""),D={appId:o,cid:u,cname:c,deviceId:"",elapse:(G=Number(E-this.inspectStartTime),{low:G|=0,high:G>>31,unsigned:G>=0}),fileSize:R.byteLength,jpgEncryption:2,height:S.height,width:S.width,jpg:R,networkType:6,osType:7,requestId:P,sdkVersion:"4.23.2",sequence:this.sequence,sid:m,timestamp:PH(E),uid:y,vid:h,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var G;this.extraInfo===void 0&&delete D.callbackData,this.ossFilePrefix===void 0&&delete D.ossFilePrefix;const j=q_e(D);if(j.byteLength<this.workerMessageLengthLimit){if(oe("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const B=function(Y){for(var ee=1;ee<arguments.length;ee++){var fe=arguments[ee]!=null?arguments[ee]:{};ee%2?S7(Object(fe),!0).forEach(function(ye){q(Y,ye,fe[ye])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Y,Object.getOwnPropertyDescriptors(fe)):S7(Object(fe)).forEach(function(ye){Object.defineProperty(Y,ye,Object.getOwnPropertyDescriptor(fe,ye))})}return Y}({},D);delete B.jpg,x.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(B))}return j}{const B=this.quality*this.qualityRatio;return this.quality=B,await this.generateRequestData(r,{appId:o,cname:c,cid:u,vid:h,sid:m,uid:y})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=_a.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Au.CLOSED,this.emit(cs.STATE_CHANGE,Pu.CLOSED)}}const iye={name:"ContentInspect",create:function(e){let{config:r}=e;return function(s){if(!s)throw new Ae(te.INVALID_PARAMS,"inspectConfig is necessary.");if(!s.inspectType||!Array.isArray(s.inspectType))throw new Ae(te.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const o=[...new Set(s.inspectType)];o.forEach(c=>{var u;if(!ct(u=["supervise","moderation"]).call(u,c))throw new Ae(te.INVALID_PARAMS,"".concat(c," is not a valid inspect type."))}),s.inspectType=o}if(s&&s.extraInfo&&s.extraInfo.length>1024)throw new Ae(te.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new rye(r)}};var b7=l(Et.Object.getOwnPropertySymbols),sye=Gn,oye=da.indexOf,aye=xp,B2=se([].indexOf),T7=!!B2&&1/B2([1],1,-0)<0;sye({target:"Array",proto:!0,forced:T7||!aye("indexOf")},{indexOf:function(e){var r=arguments.length>1?arguments[1]:void 0;return T7?B2(this,e,r)||0:oye(this,e,r)}});var cye=mc("Array").indexOf,lye=O,uye=cye,z2=Array.prototype,dye=function(e){var r=e.indexOf;return e===z2||lye(z2,e)&&r===z2.indexOf?uye:r},w7=l(dye);function hye(e,r){if(e==null)return{};var s,o,c=function(h,m){if(h==null)return{};var y,E,S={},R=GG(h);for(E=0;E<R.length;E++)y=R[E],w7(m).call(m,y)>=0||(S[y]=h[y]);return S}(e,r);if(b7){var u=b7(e);for(o=0;o<u.length;o++)s=u[o],w7(r).call(r,s)>=0||Object.prototype.propertyIsEnumerable.call(e,s)&&(c[s]=e[s])}return c}let C7=class{get localCapabilities(){return $r(this._localCapabilities)}get rtpCapabilities(){return $r(this._rtpCapabilities)}get candidates(){return $r(this._candidates)}get iceParameters(){return $r(this._iceParameters)}get dtlsParameters(){return $r(this._dtlsParameters)}constructor(e){q(this,"sessionDesc",void 0),q(this,"_localCapabilities",void 0),q(this,"_rtpCapabilities",void 0),q(this,"_candidates",void 0),q(this,"_iceParameters",void 0),q(this,"_dtlsParameters",void 0),q(this,"setup",void 0),q(this,"currentMidIndex",void 0),q(this,"cname","o/i14u9pJrxRKAsu"),q(this,"firefoxSsrcMidMap",new Map),e=$r(e);const{remoteIceParameters:r,remoteDtlsParameters:s,candidates:o,remoteRTPCapabilities:c,localCapabilities:u,direction:h,setup:m,videoCodec:y,audioCodec:E}=e;let S;this.setup=m,S=h===qo.RECEIVE_ONLY?qa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):qa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=c,this._candidates=o,this._iceParameters=r,this._dtlsParameters=s,this._localCapabilities=u;const R=h===qo.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,P=h===qo.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,D=h===qo.RECEIVE_ONLY?c.send.videoCodecs:MT(bt.VIDEO,R,P,y),G=h===qo.RECEIVE_ONLY?c.send.audioCodecs:MT(bt.AUDIO,R,P,E);for(const j of S.mediaDescriptions)j.attributes.iceUfrag=r.iceUfrag,j.attributes.icePwd=r.icePwd,j.attributes.fingerprints=s.fingerprints,j.attributes.candidates=o,j.attributes.setup=this.setup,j.media.mediaType==="application"&&(j.attributes.sctpPort="5000"),j.media.mediaType==="video"&&(j.media.fmts=D.map(B=>B.payloadType.toString(10)),j.attributes.payloads=D,j.attributes.extmaps=R.videoExtensions),j.media.mediaType==="audio"&&(j.media.fmts=G.map(B=>B.payloadType.toString(10)),j.attributes.payloads=G,j.attributes.extmaps=R.audioExtensions,cS(j));this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Gm(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===e)}send(e,r,s,o,c){s=s.replace(/ /g,"-");const{ssrcs:u,ssrcGroups:h}=J_(r,this.cname,oe("SYNC_GROUP")?s:void 0),m=this.findPreloadMediaDesc(u);if(m){if(Wr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,m.attributes.mid),c&&(c.twcc||c.remb)){const y=this.sessionDesc.mediaDescriptions.indexOf(m);return this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(m,c),{mid:m.attributes.mid,needExchangeSDP:!0}}return{mid:m.attributes.mid,needExchangeSDP:!1}}{const y=this.findAvailableMediaIndex(e,u,o);let E;return y===-1?(E=this.createOrRecycleSendMedia(e,u,h,"sendonly",o,c),this.updateBundleMids()):(E=$r(this.sessionDesc.mediaDescriptions[y]),E.attributes.direction="sendonly",E.attributes.ssrcs=u,E.attributes.ssrcGroups=h,this.sessionDesc.mediaDescriptions[y]=this.mungSendMediaDesc(E,c)),Wr()&&this.firefoxSsrcMidMap.set(u[0].ssrcId,E.attributes.mid),{needExchangeSDP:!0,mid:E.attributes.mid}}}stopSending(e){const r=this.sessionDesc.mediaDescriptions.filter(s=>s.attributes.mid&&e.indexOf(s.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(s=>{s.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,r,s){const o=[];return e.forEach(c=>{const u=c._mediaStreamTrack.kind,h=this.findAvailableRecvMediaIndex(u);let m,y=!1;h===-1?(y=!0,m=this.createOrRecycleRecvMedia(c,[],"recvonly",r,s),this.updateBundleMids()):(m=$r(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="recvonly"),o.push({mid:m.attributes.mid,needCreateTransceiver:y})}),o}stopReceiving(e){const r=this.sessionDesc.mediaDescriptions.filter(s=>e.indexOf(s.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(s=>{s.media.port="0",s.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:r,protocol:s,address:o,port:c,type:u,relatedAddress:h,relatedPort:m,priority:y}=new RTCIceCandidate(e),E={foundation:r??"",componentId:"1",transport:s??"",priority:y?y+"":"",connectionAddress:o??"",port:c?c+"":"",type:u?u+"":"",relAddr:h??"",relPort:m?m+"":"",extension:{}};this.candidates.some(S=>S.priority===E.priority&&S.connectionAddress===E.connectionAddress&&S.port===E.port)||(this._candidates.push(E),this.sessionDesc.mediaDescriptions.forEach(S=>{S.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,r,s,o,c){const u=e._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=MT(u,h,this.localCapabilities.send,u===bt.AUDIO?c:o),y=u===bt.VIDEO?h.videoExtensions:h.audioExtensions,E="".concat(++this.currentMidIndex);let S={media:{mediaType:u,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(P=>P.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:s,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(E)}};S=this.mungRecvMediaDsec(S,e);const R=this.findFirstClosedMedia(u);if(R){const P=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[P]=S}else this.sessionDesc.mediaDescriptions.push(S);return S}muteRemote(e){const r=this.sessionDesc.mediaDescriptions.filter(s=>ct(e).call(e,s.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="inactive"})}unmuteRemote(e){const r=this.sessionDesc.mediaDescriptions.filter(s=>ct(e).call(e,s.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(s=>{s.attributes.direction="recvonly"})}findAvailableMediaIndex(e,r,s){return this.sessionDesc.mediaDescriptions.findIndex(o=>{const c=o.media.mediaType===e&&o.media.port!=="0"&&(o.attributes.direction==="sendonly"||o.attributes.direction==="sendrecv")&&o.attributes.ssrcs.length===0;if(Wr()){if(c){const u=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(u||o.attributes.mid!=="0"&&o.attributes.mid!=="1")||!(!u||u!==o.attributes.mid)}return!1}return c&&o.attributes.mid===s})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const s=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&s})}predictReceivingMids(e){const r=[];for(let s=0;s<e;s++)r.push((this.currentMidIndex+s+1).toString(10));return r}restartICE(e){e=$r(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=e.iceUfrag,r.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,r,s,o,c,u){const h=this.rtpCapabilities.send,m=e===bt.VIDEO?h.videoCodecs:h.audioCodecs,y=e===bt.VIDEO?h.videoExtensions:h.audioExtensions;Wr()&&(c="".concat(++this.currentMidIndex));let E={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:m.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:y,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:s,rtcpFeedbackWildcards:[],payloads:m,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:c}};E=this.mungSendMediaDesc(E,u);const S=this.findFirstClosedMedia(e);if(S){const R=this.sessionDesc.mediaDescriptions.indexOf(S);this.sessionDesc.mediaDescriptions[R]=E}else this.sessionDesc.mediaDescriptions.push(E);return E}mungRecvMediaDsec(e,r,s){const o=$r(e);return WL(o),aS(o,r),GL(o,r),m9(o),yP(o,s,this.localCapabilities.send),o}mungSendMediaDesc(e,r){const s=$r(e);return yP(s,r,this.localCapabilities.recv),cS(s),s}updateRecvMedia(e,r){const s=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===e);if(s!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[s],r);this.sessionDesc.mediaDescriptions[s]=o}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(r=>{var s;return((s=r.attributes)===null||s===void 0||(s=s.ssrcs[0])===null||s===void 0?void 0:s.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(r=>Wr()?r.media.port==="0"&&r.media.mediaType===e:r.media.port==="0")}};const pye=["sdp"];var br;function R7(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function og(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?R7(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):R7(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}let I7=(br=class DS extends XG{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,s;return(r=(s=this.peerConnection.getReceivers()[0])===null||s===void 0||(s=s.transport)===null||s===void 0?void 0:s.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,s,o){super(r,s),q(this,"direction",void 0),q(this,"name",void 0),q(this,"store",void 0),q(this,"spec",void 0),q(this,"peerConnection",void 0),q(this,"initialOffer",void 0),q(this,"transport",void 0),q(this,"statsFilter",void 0),q(this,"localCandidateCount",0),q(this,"_isInRestartIce",!1),q(this,"mutex",void 0),q(this,"onLocalCandidate",void 0),q(this,"remoteSDP",void 0),q(this,"pendingCandidates",[]),q(this,"localCapabilities",void 0),q(this,"isReady",!1),q(this,"restartCnt",0),q(this,"curTurnServerIndex",0),this.store=s,this.spec=r,this.mutex=new qs("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(DS.resolvePCConfiguration(r,s.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=o??qo.SEND_ONLY,this.name=this.direction===qo.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=rL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,Wr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const s=await _9();if(this.localCapabilities=EP(s),r){const{sdp:o}=r,c=hye(r,pye),u=function(){const S={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=LT(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),P={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},G={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Ou(R,S,"videoExtensions",P,D,G),Ou(R,S,"videoCodecs",P,D,G),Ou(R,S,"audioExtensions",P,D,G),Ou(R,S,"audioCodecs",P,D,G),oe("RAISE_H264_BASELINE_PRIORITY")){const j=G.videoCodecs.findIndex(B=>B.rtpMap&&B.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&B.fmtp&&B.fmtp.parameters["profile-level-id"]==="42001f");if(j!==-1){const B=G.videoCodecs.findIndex(Y=>Y.rtpMap&&Y.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(B<j){x.debug("raising H264 baseline profile priority");const Y=G.videoCodecs[j];G.videoCodecs.splice(j,1),G.videoCodecs.splice(B,0,Y)}B!==-1&&oe("FILTER_SEND_H264_BASELINE")&&(P.videoCodecs=P.videoCodecs.filter(Y=>!(Y.rtpMap&&Y.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&Y.fmtp&&Y.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:P,recv:D,sendrecv:G}}({},{},o);this.remoteSDP=new C7({remoteIceParameters:c.iceParameters,remoteDtlsParameters:c.dtlsParameters,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const h=await this.peerConnection.createAnswer();if(!h.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const m=Ym(h.sdp);await this.peerConnection.setLocalDescription(h);const y=await y9({},{},h.sdp);this.localCapabilities=EP(y);const E=this.peerConnection.getTransceivers()[0];return E!=null&&E.receiver&&E.receiver.transport&&this.tryBindTransportEvents(E.receiver.transport),og(og({},m),{},{sdp:h.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const c=Ym(o.sdp);return this.initialOffer=o,og(og({},c),{},{sdp:o.sdp})}}catch(s){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,s.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:s,iceParameters:o,dtlsParameters:c}=r,u=await y9({},{},s);this.remoteSDP=new C7({remoteIceParameters:o,remoteDtlsParameters:c,candidates:[],remoteRTPCapabilities:u,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const h=this.peerConnection.getTransceivers()[0];h!=null&&h.sender&&h.sender.transport&&this.tryBindTransportEvents(h.sender.transport)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(s=>{this.peerConnection.addIceCandidate(s)}),this.pendingCandidates=[])}catch(s){throw new Le(te.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(s.toString()))}}send(r,s,o){var c=this;return Nl(function*(){const u=yield Dn(c.mutex.lock("From P2PConnection.send"));try{if(!c.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const h=[],m=c.remoteSDP.receive(r,s,o);r.forEach((B,Y)=>{if(m[Y].needCreateTransceiver){const ee=c.peerConnection.addTransceiver(B._mediaStreamTrack,{direction:"sendonly"});h.push(ee),B._updateRtpTransceiver(ee)}else{const ee=c.peerConnection.getTransceivers().find(fe=>fe.mid===m[Y].mid);if(!ee)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(m[Y].mid));h.push(ee),B._updateRtpTransceiver(ee)}}),Wr()&&oe("SIMULCAST")===!0&&(yield Dn(c.applySimulcastForFirefox(h,r)));const y=m.map(B=>B.mid),E=yield Dn(c.peerConnection.createOffer()),S=c.mungSendOfferSDP(E.sdp,r,y),R=qa(S),P=y.map(B=>{const Y=R.mediaDescriptions.find(ee=>ee.attributes.mid===B);if(!Y)throw new Error("Cannot extract ssrc from mediaDescription.");return h9(Y,oe("USE_PUB_RTX"))}),D=h.map((B,Y)=>{const ee=y[Y];return{localSSRC:P[Y],id:ee}});yield Dn(c.peerConnection.setLocalDescription({type:"offer",sdp:S}));try{yield D}catch(B){const Y=c.remoteSDP.toString();throw yield Dn(c.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Dn(c.peerConnection.setRemoteDescription({type:"answer",sdp:Y})),yield Dn(c.stopSending(y,!0)),B}yield Dn(c.applySimulcastEncodings(h,r)),yield Dn(c.applySendEncodings(h,r));const G=c.remoteSDP.toString(),j=c.logSDPExchange(S,"offer","local","send");return j==null||j(G),yield Dn(c.setRemoteDescription({type:"answer",sdp:G})),h.map((B,Y)=>{const ee=y[Y];return{localSSRC:P[Y],id:ee}})}catch(h){throw h instanceof Le?h:new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(h.toString()))}finally{u()}})()}async stopSending(r,s){const o=s?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const c=this.peerConnection.getTransceivers().filter(y=>r.indexOf(y.mid)!==-1);if(c.length!==r.length)throw new Error("Transceivers' length (".concat(c.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));c.map(y=>{var E;y.direction="inactive",(E=y.stop)===null||E===void 0||E.call(y)});const u=await this.peerConnection.createOffer(),h=this.logSDPExchange(u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(u),this.remoteSDP.stopReceiving(r);const m=this.remoteSDP.toString();h==null||h(m),await this.setRemoteDescription({type:"answer",sdp:m})}catch(c){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(c.toString()))}finally{o&&o()}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);if(h){const y=this.remoteSDP.toString(),E=this.logSDPExchange(y,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:y});const S=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(S.sdp,u,r);E==null||E(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const m=this.peerConnection.getTransceivers().find(y=>y.mid===u);if(!m||m.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:m.receiver.track,mid:m.mid,transceiver:m}}catch(u){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async mockReceive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:u,needExchangeSDP:h}=this.remoteSDP.send(r,s,o,c);if(h){const m=this.remoteSDP.toString(),y=this.logSDPExchange(m,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:m});const E=await this.peerConnection.createAnswer(),S=this.mungReceiveAnswerSDP(E.sdp,u,r);y==null||y(S||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:S}),x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else x.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(u){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString(),o=this.logSDPExchange(s,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:s});const c=await this.peerConnection.createAnswer();o==null||o(c.sdp||""),await this.peerConnection.setLocalDescription(c)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===W_.Auto&&(this.store.p2pTransport=W_.SdRtn,Fn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(DS.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,Fn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(DS.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const s=await this.peerConnection.createOffer({iceRestart:!0});if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:o}=Ym(s.sdp);return this.store.descriptionStart(),this.direction===qo.SEND_ONLY&&await this.peerConnection.setLocalDescription(s),o}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===qo.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:o}=Ym(s.sdp);return await this.peerConnection.setLocalDescription(s),o}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s],[r]);this.remoteSDP.updateRecvMedia(r,s);const u=this.remoteSDP.toString(),h=this.logSDPExchange(c,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),h==null||h(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(te.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getTransceivers().filter(c=>c.mid===r);o.length===1&&(this.isVP8Simulcast(s)?Wr()||await this.applySimulcastEncodings(o,[s]):await this.applySendEncodings(o,[s]))}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getTransceivers().find(c=>c.mid===s);o&&await o.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const s=r[0].transport.iceTransport,{local:o,remote:c}=s.getSelectedCandidatePair();return{local:og(og({},Ih),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port}),remote:og(og({},Ih),{},{candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,s;ct(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(s=this.onICEConnectionStateChange)===null||s===void 0||s.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var s;r.candidate.candidate&&((s=this.onLocalCandidate)===null||s===void 0||s.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c={iceServers:[]};var u;return r.iceServers?c.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(bT(r.turnServer.servers)?c.iceServers=r.turnServer.servers:(c.iceServers&&c.iceServers.push(...DS.turnServerConfigToIceServers(r.turnServer.servers,s,o)),oe("USE_TURN_SERVER_OF_GATEWAY")&&c.iceServers&&r.turnServer.serversFromGateway&&c.iceServers.push(...DS.turnServerConfigToIceServers(r.turnServer.serversFromGateway,s,o)),ct(u=[W_.Relay,W_.SdRtn]).call(u,s)&&(c.iceTransportPolicy="relay"),oe("FORCE_TURN_TCP")?c.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(c.iceTransportPolicy="relay")}))),oe("ENABLE_ENCODED_TRANSFORM")&&Fn().supportWebRTCEncodedTransform&&(c.encodedInsertableStreams=!0),x.debug("P2PConnection p2pTransport is ".concat(s)),c}static turnServerConfigToIceServers(r,s){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const c=[],u=r.filter(m=>m.tcpport);x.debug("P2PConnection turnServers is ".concat(u,", current index is ").concat(o));const h=u.length>o?u[o]:u[0];switch(s){case W_.SdRtn:const m=r.filter(E=>{var S;return ct(S=E.username).call(S,"glb:")&&E.turnServerURL==E.turnServerURL}),y=m.length>o?m[o]:m[0];y&&(c.push({username:y.username,credential:y.password,credentialType:"password",urls:"turn:".concat(Km(y.turnServerURL),":").concat(y.tcpport,"?transport=udp")}),c.push({username:y.username,credential:y.password,credentialType:"password",urls:"turns:".concat(Km(y.turnServerURL),":").concat(y.tcpport,"?transport=tcp")}));break;case W_.Relay:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Km(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;default:h&&(c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(h.turnServerURL,":").concat(h.tcpport,"?transport=udp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Km(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}),c.push({username:h.username,credential:h.password,credentialType:"password",urls:"stun:".concat(h.turnServerURL,":").concat(h.tcpport)}))}return c}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var o;r!=null&&r.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,r.state))},r.onerror=o=>{var c;(c=this.onDTLSTransportError)===null||c===void 0||c.call(this,"error"in o?o.error:o)};const s=r.iceTransport;s&&(s.onstatechange=()=>{const o=r==null?void 0:r.iceTransport.state;var c;o&&((c=this.onICETransportStateChange)===null||c===void 0||c.call(this,o))},s.getSelectedCandidatePair&&(s.onselectedcandidatepairchange=()=>{if(s.getSelectedCandidatePair()){const{local:o,remote:c}=s.getSelectedCandidatePair();x.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:c.type,protocol:c.protocol,address:c.address,port:c.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,s){var o;if(s||(s=this.peerConnection.getSenders().find(S=>S.track===r._mediaStreamTrack)),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return x.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!Fn().supportSetRtpSenderParameters)return x.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const c={},u={};switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(r._encoderConfig){var h;const{bitrateMax:S,frameRate:R,scaleResolutionDownBy:P}=r._encoderConfig;S&&(u.maxBitrate=1e3*S),ct(h=r._hints).call(h,fr.LOW_STREAM)&&(R&&(u.maxFramerate=wc(R)),P&&P>=1&&(u.scaleResolutionDownBy=P))}if(oe("DSCP_TYPE")&&af()){var m;const S=oe("DSCP_TYPE");ct(m=["very-low","low","medium","high"]).call(m,S)&&(u.networkPriority=S)}const y=s.getParameters(),E=(o=y.encodings)===null||o===void 0?void 0:o[0];Wr()&&!E&&(c.encodings=[u]),E&&Object.assign(E,u),Object.assign(y,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(y.encodings))),await s.setParameters(y)}async applySendEncodings(r,s){try{if(!Fn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=s[o];u instanceof Cr&&!this.isVP8Simulcast(u)&&await this.updateRtpSenderEncodings(u,c.sender)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s,o){const c=qa(r);return s.forEach((u,h)=>{const m=o[h],y=c.mediaDescriptions.find(E=>E.attributes.mid===m);y&&(aS(y,u),g9(y,u,this.store.codec))}),Gm(c)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var s;(s=this.onFirstVideoDecodedTimeout)===null||s===void 0||s.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,s){if(r.length===s.length)for(let y=0;y<r.length;y++){var o,c,u,h,m;const E=r[y],S=s[y];if(S instanceof Cr&&!ct(o=S._hints).call(o,fr.LOW_STREAM)&&(c=S._encoderConfig)!==null&&c!==void 0&&c.bitrateMax&&((u=S._encoderConfig)===null||u===void 0?void 0:u.bitrateMax)>200&&(h=S._scalabilityMode)!==null&&h!==void 0&&h.numSpatialLayers&&((m=S._scalabilityMode)===null||m===void 0?void 0:m.numSpatialLayers)>1&&this.store.codec==="vp8"){const R={},P={high:1e3*(S._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:P.high}];const D=E.sender.getParameters();await E.sender.setParameters(Object.assign(D,R))}}}async applySimulcastEncodings(r,s){if(!Wr()&&r.length===s.length)for(let o=0;o<r.length;o++){const c=s[o];if(c instanceof Cr&&this.isVP8Simulcast(c)){const u=r[o],h={},m={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};h.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:m.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:m.medium,scaleResolutionDownBy:4}];const y=u.sender.getParameters();await u.sender.setParameters(Object.assign(y,h))}}}isVP8Simulcast(r){var s,o,c,u,h;return!!(r instanceof Cr&&oe("SIMULCAST")&&this.store.codec==="vp8"&&!ct(s=r._hints).call(s,fr.LOW_STREAM)&&(o=r._encoderConfig)!==null&&o!==void 0&&o.bitrateMax&&((c=r._encoderConfig)===null||c===void 0?void 0:c.bitrateMax)>200&&(u=r._scalabilityMode)!==null&&u!==void 0&&u.numSpatialLayers&&((h=r._scalabilityMode)===null||h===void 0?void 0:h.numSpatialLayers)>1)}logSDPExchange(r,s,o,c){if(oe("SDP_LOGGING"))return x.upload("[".concat(this.store.clientId,"] exchanging ").concat(o," ").concat(s," SDP during P2PConnection.").concat(c,`
`),r),s==="offer"?u=>{this.logSDPExchange(u,"answer",o==="local"?"remote":"local",c)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(h=>{h.direction="inactive"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.muteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getTransceivers().filter(h=>h.mid&&r.indexOf(h.mid)!==-1);if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");s.map(async h=>{h.direction="sendonly"});const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(o),this.remoteSDP.unmuteRemote(r);const u=this.remoteSDP.toString();c==null||c(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}async getRemoteSSRC(r,s){var o,c;if(s=(o=s)!==null&&o!==void 0?o:(c=this.currentRemoteDescription)===null||c===void 0?void 0:c.sdp){var u;const h=(u=qa(s).mediaDescriptions.find(m=>m.attributes.mid===r))===null||u===void 0?void 0:u.attributes.ssrcs;return h==null?void 0:h[0].ssrcId}}async setRemoteDescription(r){var s;await this.peerConnection.setRemoteDescription(r),ct(s=["connected","completed"]).call(s,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,s,o){const c=qa(r),u=c.mediaDescriptions.find(h=>h.attributes.mid===s);return u&&o===bt.AUDIO&&u.media.mediaType==="audio"&&cS(u),Gm(c)}},It(br.prototype,"establish",[Lu],Object.getOwnPropertyDescriptor(br.prototype,"establish"),br.prototype),It(br.prototype,"connect",[Lu],Object.getOwnPropertyDescriptor(br.prototype,"connect"),br.prototype),It(br.prototype,"receive",[Lu],Object.getOwnPropertyDescriptor(br.prototype,"receive"),br.prototype),It(br.prototype,"mockReceive",[Lu],Object.getOwnPropertyDescriptor(br.prototype,"mockReceive"),br.prototype),It(br.prototype,"stopReceiving",[Lu],Object.getOwnPropertyDescriptor(br.prototype,"stopReceiving"),br.prototype),It(br.prototype,"restartICE",[Lu],Object.getOwnPropertyDescriptor(br.prototype,"restartICE"),br.prototype),It(br.prototype,"close",[Lu],Object.getOwnPropertyDescriptor(br.prototype,"close"),br.prototype),It(br.prototype,"updateEncoderConfig",[Lu],Object.getOwnPropertyDescriptor(br.prototype,"updateEncoderConfig"),br.prototype),It(br.prototype,"updateSendParameters",[Lu],Object.getOwnPropertyDescriptor(br.prototype,"updateSendParameters"),br.prototype),It(br.prototype,"replaceTrack",[Lu],Object.getOwnPropertyDescriptor(br.prototype,"replaceTrack"),br.prototype),It(br.prototype,"muteLocal",[Lu],Object.getOwnPropertyDescriptor(br.prototype,"muteLocal"),br.prototype),It(br.prototype,"unmuteLocal",[Lu],Object.getOwnPropertyDescriptor(br.prototype,"unmuteLocal"),br.prototype),br);function Lu(e,r,s){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("From P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await o.apply(this,m)}finally{u()}},s}let Dd=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var A7,P7,O7,k7,N7,D7,x7,L7,M7,U7,V7,Ur;function j7(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function tO(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?j7(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):j7(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}let fye=(A7=xd(Dd.SEND_ONLY),P7=xd(Dd.SEND_ONLY),O7=xd(),k7=xd(Dd.RECEIVE_ONLY),N7=xd(Dd.RECEIVE_ONLY),D7=xd(Dd.RECEIVE_ONLY),x7=xd(Dd.RECEIVE_ONLY),L7=xd(Dd.RECEIVE_ONLY),M7=xd(Dd.RECEIVE_ONLY),U7=xd(),V7=xd(Dd.RECEIVE_ONLY),Ur=class extends jr{get state(){return this._state}set state(e){const r=this._state;this._state=e,this.emit(jt.StateChange,r,this._state)}constructor(e,r){super(),q(this,"isPlanB",!1),q(this,"store",void 0),q(this,"statsUploader",void 0),q(this,"sendConnection",void 0),q(this,"recvConnection",void 0),q(this,"localTrackMap",new Map),q(this,"remoteUserMap",new Map),q(this,"localDataChannels",[]),q(this,"pendingLocalTracks",[]),q(this,"pendingRemoteTracks",[]),q(this,"statsCollector",void 0),q(this,"dtlsFailedCount",0),q(this,"sendMutex",void 0),q(this,"recvMutex",void 0),q(this,"_state",Xn.Disconnected),q(this,"_restartStates",["disconnected","failed"]),q(this,"reconnectInterval",void 0),q(this,"uploadUnplinkStarted",!1),q(this,"uploadDownlinkStarted",!1),q(this,"uplinkStateUploadInterval",void 0),q(this,"downlinkStatsUploadInterval",void 0),q(this,"handleMuteLocalTrack",async(s,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==Xn.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const y=this.filterTobeMutedTracks(s);if(y.length===0)return void o();const E=y.find(D=>D[0]==="videoLowTrack");E&&E[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(y.map(D=>{let[,{id:G}]=D;return G}));let S=!1;var h,m;s.trackMediaType==="video"?S=!((h=this.localTrackMap.get(Xe.LocalAudioTrack))===null||h===void 0||!h.track._muted):S=((m=this.localTrackMap.get(Xe.LocalVideoTrack))===null||m===void 0?void 0:m.id)===void 0;const R=this.createMuteMessage(y);await hr(this,jt.RequestMuteLocal,R);const P=s.trackMediaType==="video"?$m.MUTE_LOCAL_VIDEO:$m.MUTE_LOCAL_AUDIO;await hr(this,jt.RequestP2PMuteLocal,{action:P,message:R,isMuteAll:S}),o()}catch(y){c(y)}finally{u()}}),q(this,"handleUnmuteLocalTrack",async(s,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==Xn.Connected)return void c(new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const h=this.filterTobeUnmutedTracks(s);if(h.length===0)return void o();await this.sendConnection.unmuteLocal(h.map(E=>{let[,{id:S}]=E;return S}));const m=this.createUnmuteMessage(h),y=s.trackMediaType==="video"?$m.UNMUTE_LOCAL_VIDEO:$m.UNMUTE_LOCAL_AUDIO;await hr(this,jt.RequestP2PMuteLocal,{action:y,message:m}),o()}catch(h){c(h)}finally{u()}}),q(this,"handleUpdateVideoEncoder",async(s,o,c,u)=>{let h;typeof u=="boolean"&&u||(h=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const y=this.localTrackMap.get(Xe.LocalVideoTrack);if(!this.sendConnection||!y||y.track!==s||this.state!==Xn.Connected)return void o();const{id:E,track:S}=y;E&&(await this.sendConnection.updateSendParameters(E,S),await this.sendConnection.updateEncoderConfig(E,S),this.emit(jt.UpdateVideoEncoder,S)),o()}catch(y){c(y)}finally{var m;(m=h)===null||m===void 0||m()}}),q(this,"handleUpdateVideoSendParameters",async(s,o,c)=>{const u=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const h=this.localTrackMap.get(Xe.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==s||this.state!==Xn.Connected)return void o();const{id:m,track:y}=h;m&&await this.sendConnection.updateSendParameters(m,y),o()}catch(h){c(h)}finally{u()}}),q(this,"handleReplaceTrack",async(s,o,c,u)=>{let h;x.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(s.getTrackId(),"]")),typeof u=="boolean"&&u||(h=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var m;const E=Array.from(this.localTrackMap.entries()).find(S=>{let[,{track:R}]=S;return s===R});if(!this.sendConnection||!E||E[1].id===void 0||this.state!==Xn.Connected)return void o();if(await((m=this.sendConnection)===null||m===void 0?void 0:m.replaceTrack(s,E[1].id)),E[0]===Xe.LocalVideoTrack&&Fn().supportDualStreamEncoding){const S=this.localTrackMap.get(Xe.LocalVideoLowTrack);if(S){const R=s._mediaStreamTrack.clone();S.track._originMediaStreamTrack.stop(),S.track._mediaStreamTrack=R,S.track._originMediaStreamTrack=R,await new ht((P,D)=>{this.handleReplaceTrack(S.track,P,D,!0)})}}o()}catch(E){c(E)}finally{var y;(y=h)===null||y===void 0||y()}}),q(this,"handleGetLocalVideoStats",s=>{s(this.statsCollector.getLocalVideoTrackStats())}),q(this,"handleGetLocalAudioStats",s=>{s(this.statsCollector.getLocalAudioTrackStats())}),q(this,"handleGetRemoteVideoStats",s=>this.statsCollector.getRemoteVideoTrackStats(s.uid)[s.uid]),q(this,"handleGetRemoteAudioStats",s=>this.statsCollector.getRemoteAudioTrackStats(s.uid)[s.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new rH(e),this.bindStatsUploaderEvents(),this.sendMutex=new qs("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new qs("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(s=>{s&&(s.iceConnectionState!=="disconnected"&&s.iceConnectionState!=="failed"||this.handleDisconnect(s.direction))})},oe("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,r){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,r){let s;try{if(r){this.recvConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),s=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new I7(e,this.store,qo.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const o=await this.recvConnection.establish(r);return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}{this.state=Xn.New,this.sendConnection&&(x.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),s=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new I7(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const o=await this.sendConnection.establish();return{iceParameters:o.iceParameters,dtlsParameters:o.dtlsParameters,sdp:o.sdp}}}finally{s&&s()}}async p2pConnect(e){if(!this.sendConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Xn.Connected}async addRemoteCandidate(e,r){if(r===qo.RECEIVE_ONLY){if(!this.sendConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Le(te.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,r,s){var o=this;return Nl(function*(){const c=yield Dn(o.sendMutex.lock("From P2PChannel.publish"));try{if(!o.sendConnection||o.state!==Xn.Connected){o.throwIfTrackTypeNotMatch(e);const E=e.filter(S=>o.pendingLocalTracks.indexOf(S)===-1);return void(o.pendingLocalTracks=o.pendingLocalTracks.concat(E))}o.store.pubId=o.store.pubId+1,Js.markPublishStart(o.store.clientId,o.store.pubId);const u=o.filterTobePublishedTracks(e,r,s);if(u.length===0)return void(yield Dn(o.tryToUnmuteAudio(e)));u.forEach(E=>{let{track:S,type:R}=E;const P=Date.now();o.store.publish(S.getTrackId(),R===Xe.LocalAudioTrack?"audio":"video",P)}),o.bindLocalTrackEvents(u);const h=yield Dn(o.sendConnection.send(u.map(E=>{let{track:S}=E;return S}),o.store.codec,o.store.audioCodec)),m=(yield Dn(h.next())).value,y=o.createGatewayPublishMessage(u,m);try{yield y}catch(E){throw h.throw(E),(E==null?void 0:E.code)===te.WS_ABORT&&u.forEach(S=>{let{track:R}=S;o.pendingLocalTracks.indexOf(R)===-1&&o.pendingLocalTracks.push(R)}),o.unbindLocalTrackEvents(u),E}yield Dn(h.next()),u.forEach(E=>{let{type:S}=E;o.statsCollector.addLocalStats(S)}),o.statsUploader.startUploadOutboundStats(),o.assignLocalTracks(u,m),u.forEach(E=>{let{track:S,type:R}=E;const P=Date.now();o.store.publish(S.getTrackId(),R===Xe.LocalAudioTrack?"audio":"video",void 0,P)}),o.startUploadUplinkState()}finally{c()}})()}async unpublish(e){if(!this.sendConnection||this.state!==Xn.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(c=>!ct(e).call(e,c)));const r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;const s=r.find(c=>c[0]==="videoLowTrack");s&&s[1].track.close();const o=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(c=>{let[,{id:u}]=c;return u})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(c=>{let[u,{track:h}]=c;return{type:u,track:h}})),r.forEach(c=>{let[u]=c;this.statsCollector.removeLocalStats(u)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===Xn.Connected)return s&&s[1].track.close(),o;e.forEach(c=>{const u=this.pendingLocalTracks.indexOf(c);u!==-1&&this.pendingLocalTracks.splice(u,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const r=[],s=[];Array.from(this.localTrackMap.entries()).forEach(o=>{let[c,{track:u,ssrcs:h}]=o;const m={stream_type:sge(u,c),ssrcs:h};u._muted||!u._enabled?r.push(m):s.push(m)}),r.length>0&&r.forEach(o=>{hr(this,jt.RequestMuteLocal,[o])}),s.length>0&&s.forEach(o=>{hr(this,jt.RequestUnmuteLocal,[o])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return Nl(function*(){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(x.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Os(this,jt.RequestRePublish,this.pendingLocalTracks),this.emit(jt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,r,s,o){var c;if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((c=this.remoteUserMap.get(e))!==null&&c!==void 0&&c.has(r))return;const{track:u,mid:h,transceiver:m}=await this.recvConnection.receive(r,[{ssrcId:s}],String(e.uid),o);r===bt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(u):(e._audioTrack=new Zv(u,e.uid,e._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),m&&e._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=s,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(u):(e._videoTrack=new Qv(u,e.uid,e._uintid,this.store),x.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),m&&e._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(e,e._videoTrack));const y=this.remoteUserMap.get(e);y?y.set(r,h):this.remoteUserMap.set(e,new Map([[r,h]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const E=this.pendingRemoteTracks.findIndex(S=>{let{user:R,kind:P}=S;return R.uid===e.uid&&r===P});E!==-1&&(this.pendingRemoteTracks.splice(E,1),this.emit(jt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,r,s,o){if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:s}],String(e.uid),o)}async unsubscribe(e,r,s){const o=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return r!==void 0?h.uid===e.uid&&r===m:h.uid===e.uid});if(o.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),this.recvConnection||s||o.forEach(u=>{let{kind:h}=u;var m;if(h===bt.AUDIO)(m=e._audioTrack)===null||m===void 0||m._destroy(),e._audioTrack=void 0;else if(h===bt.VIDEO){var y;(y=e._videoTrack)===null||y===void 0||y._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const c=this.filterTobeUnSubscribedTracks(e,r);c.length!==0&&(await this.recvConnection.stopReceiving(c.map(u=>{let[,{id:h}]=u;return h})),this.withdrawRemoteTracks(c),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),c.forEach(u=>{let[h,{kind:m}]=u;var y,E;if(m===bt.VIDEO&&h._videoSSRC&&((y=this.recvConnection)===null||y===void 0||y.setStatsRemoteVideoIsReady(h._videoSSRC,!1)),m===bt.VIDEO)this.unbindRemoteTrackEvents(h._videoTrack),s||((E=h._videoTrack)===null||E===void 0||E._destroy(),h._videoTrack=void 0);else if(m===bt.AUDIO){var S;this.unbindRemoteTrackEvents(h._audioTrack),!s&&((S=h._audioTrack)===null||S===void 0||S._destroy(),h._audioTrack=void 0)}}),c.forEach(u=>{let[,{kind:h}]=u;hr(this,jt.RequestP2PMuteRemote,h)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,s]=r;[bt.VIDEO,bt.AUDIO].forEach(o=>{s.has(o)?hr(this,jt.RequestP2PUnmuteRemote,o):hr(this,jt.RequestP2PMuteRemote,o)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Le(te.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(e);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!s.get(r))return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));const o=r===bt.VIDEO?e._videoSSRC:e._audioSSRC;o!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(o,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.recvConnection)return;const s=this.remoteUserMap.get(e);if(!s)return void x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));s.get(r)||x.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}getAllTracks(e){const r=this.localTrackMap.get(Xe.LocalAudioTrack);if((r==null?void 0:r.track)instanceof Mi){const s=r.track;return Array.from(this.localTrackMap.entries()).filter(o=>{let[c]=o;return c!==Xe.LocalAudioTrack}).filter(o=>{let[c]=o;return!(e&&c===Xe.LocalVideoLowTrack)}).map(o=>{let[,{track:c}]=o;return c}).concat(s.trackList)}return Array.from(this.localTrackMap.entries()).filter(s=>{let[o]=s;return!(e&&o===Xe.LocalVideoLowTrack)}).map(s=>{let[,{track:o}]=s;return o})}reportPublishEvent(e,r,s,o,c){if(e){const h=this.localTrackMap.get(Xe.LocalAudioTrack),m=o?this.localTrackMap.get(Xe.LocalVideoLowTrack):this.localTrackMap.get(Xe.LocalVideoTrack);Nt.publish(this.store.sessionId,{eventElapse:Js.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.track.getTrackLabel(),videoName:m==null?void 0:m.track.getTrackLabel(),screenshare:(m==null?void 0:m.track._hints.indexOf(fr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}else{var u;s||(s=[]);const h=s.find(y=>y instanceof Xr),m=o?(u=this.localTrackMap.get(Xe.LocalVideoTrack))===null||u===void 0?void 0:u.track:s.find(y=>y instanceof Cr);Nt.publish(this.store.sessionId,{eventElapse:Js.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:h==null?void 0:h.getTrackLabel(),videoName:m==null?void 0:m.getTrackLabel(),screenshare:(m==null?void 0:m._hints.indexOf(fr.SCREEN_TRACK))!==-1,audio:!!h,video:!!m,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:c})}}reportSubscribeEvent(e,r,s,o){const c=o===bt.VIDEO?s._videoSSRC:s._audioSSRC;c&&Nt.subscribe(this.store.sessionId,{succ:e,ec:r,video:o===bt.VIDEO,audio:o===bt.AUDIO,peerid:s.uid,subscribeRequestid:o===bt.VIDEO?s._videoSSRC:s._audioSSRC,p2pid:this.store.p2pId,eventElapse:Js.measureFromSubscribeStart(this.store.clientId,c)})}reset(){x.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new qs("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new qs("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(Xe.LocalAudioTrack);if((e==null?void 0:e.track)instanceof Mi){if(e.track.trackList.length>0){const r=e.track;e.track.trackList.forEach(s=>{r.removeAudioTrack(s)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=Xn.Disconnected}getStats(e){var r,s;return e?(s=this.recvConnection)===null||s===void 0?void 0:s.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(Xe.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(Xe.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const r=this.localTrackMap.get(e);return r&&r.track instanceof Cr||r&&r.track instanceof Xr?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(e);return!!s&&(!r||s.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;const s=this.remoteUserMap.get(e);return!!s&&(!r||s.has(r))}getRemoteMedia(e){var r;const s=Array.from(el(r=this.remoteUserMap).call(r)).find(o=>o.uid===e);return s?{audioTrack:s.audioTrack,audioSSRC:s._audioSSRC,videoTrack:s.videoTrack,videoSSRC:s._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(s=>{let[o]=s;return{uid:o.uid,level:o.audioTrack?100*o.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(Xe.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=oT(e).call(e,(s,o)=>s.level-o.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(x.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=Xn.Reconnecting,oe("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var s;r._videoTrack&&r._videoTrack._player&&((s=r._videoTrack._player.getVideoElement())===null||s===void 0||s.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[s,{track:o}]=e;switch(s){case Xe.LocalVideoTrack:ct(r=o._hints).call(r,fr.LOW_STREAM)?o.close():this.pendingLocalTracks.push(o);break;case Xe.LocalAudioTrack:o instanceof Mi?this.pendingLocalTracks=this.pendingLocalTracks.concat(o.trackList):this.pendingLocalTracks.push(o);case Xe.LocalVideoLowTrack:}}),this.emit(jt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,s]=e;Array.from(el(s).call(s)).forEach(o=>{this.setPendingRemoteMedia(r,o)}),this.emit(jt.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),x.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,r){for(const s of this.pendingRemoteTracks){const{user:o,kind:c}=s;if((e instanceof Jm?e.uid:e)===o.uid&&r===c)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}async restartICE(e,r){let s,o;if(e===qo.SEND_ONLY){if(!this.sendConnection)throw new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");s=await this.sendMutex.lock("From P2PChannel.restartICE"),o=this.sendConnection}else{if(!this.recvConnection)throw new Le(te.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");s=await this.recvMutex.lock("From P2PChannel.restartICE"),o=this.recvConnection}try{if(r){const c=await o.restartICE(r);return o.isInRestartIce=!1,c}{const c=await o.restartICE();if(c){const u=await Os(this,jt.RequestP2PRestartICE,{direction:qo.RECEIVE_ONLY,iceParameter:c});await o.restartICE(u),o.isInRestartIce=!1}}}finally{s()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),r=this.localTrackMap.get(Xe.LocalVideoTrack),s=this.localTrackMap.get(Xe.LocalAudioTrack),o=e.videoSend.find(D=>{var G;return D.ssrc===(r==null||(G=r.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)}),c=e.audioSend.find(D=>{var G;return D.ssrc===(s==null||(G=s.ssrcs)===null||G===void 0?void 0:G[0].ssrcId)});if(!o||!c)return 1;const u=Qc(this,jt.NeedSignalRTT),h=o?o.rttMs:void 0,m=c?c.rttMs:void 0,y=h&&m?(h+m)/2:h||m,E=(y&&u?(y+u)/2:y||u)||0,S=100*e.sendPacketLossRate*.7/50+.3*E/1500,R=S<.17?1:S<.36?2:S<.59?3:S<.1?4:5,P=r==null?void 0:r.track;if(P&&P._encoderConfig&&P._hints.indexOf(fr.SCREEN_TRACK)===-1){const D=P._encoderConfig.bitrateMax,G=e.bitrate.actualEncoded;if(D&&G){const j=(1e3*D-G)/(1e3*D);return BG[j<.15?0:j<.3?1:j<.45?2:j<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(s=>{let[o]=s;const c=o._audioSSRC,u=o._videoSSRC,h=e.audioRecv.find(G=>G.ssrc===c),m=e.videoRecv.find(G=>G.ssrc===u);if(!h&&!m)return void(r+=1);const y=Qc(this,jt.NeedSignalRTT),E=e.rtt,S=(E&&y?(E+y)/2:E||y)||0,R=h?h.jitterMs:void 0,P=e.recvPacketLossRate;let D=.7*P*100/50+.3*S/1500;R&&(D=.6*P*100/50+.2*S/1500+.2*R/400),r+=D<.1?1:D<.17?2:D<.36?3:D<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new ht((r,s)=>{this.handleMuteLocalTrack(e,r,s)})}filterTobePublishedTracks(e,r,s){const o=[],c=Fn(),u=this.getAllTracks();e=jv(e=e.filter(y=>u.indexOf(y)===-1));let h=!1,m=!1;for(const y of e){if(y instanceof Cr&&(this.localTrackMap.has(Xe.LocalVideoTrack)||h?new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(o.push({track:y,type:Xe.LocalVideoTrack}),h=!0),r)){const E=this.getLowVideoTrack(y,s);o.push({track:E,type:Xe.LocalVideoLowTrack})}if(y instanceof Xr){const E=this.localTrackMap.get(Xe.LocalAudioTrack);if(E){if(!(E.track instanceof Mi))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(y._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");E.track.addAudioTrack(y),this.bindLocalAudioTrackEvents(y,!0)}else if(m){const S=o.find(R=>{let{type:P}=R;return P===Xe.LocalAudioTrack});if(!(S.track instanceof Mi))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(y._bypassWebAudio)throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");S.track.addAudioTrack(y)}else{if(!c.webAudioMediaStreamDest||y instanceof Mi||y._bypassWebAudio)o.push({track:y,type:Xe.LocalAudioTrack});else{const S=new Mi;S.addAudioTrack(y),o.push({track:S,type:Xe.LocalAudioTrack})}m=!0}}}return o}filterTobeUnpublishedTracks(e){const r=[],s=this.getAllTracks();e=jv(e=e.filter(o=>s.indexOf(o)!==-1));for(const o of e){if(o instanceof Xr){const c=this.localTrackMap.get(Xe.LocalAudioTrack);if(!c)continue;c.track instanceof Mi?(c.track.removeAudioTrack(o),this.unbindLocalAudioTrackEvents(o),c.track.trackList.length===0&&(r.push([Xe.LocalAudioTrack,c]),c.track.close())):r.push([Xe.LocalAudioTrack,c])}if(o instanceof Cr){const c=this.localTrackMap.get(Xe.LocalVideoTrack);if(!c)continue;r.push([Xe.LocalVideoTrack,c]);const u=this.localTrackMap.get(Xe.LocalVideoLowTrack);u&&r.push([Xe.LocalVideoLowTrack,u])}}return r}bindLocalTrackEvents(e){e.forEach(r=>{let{track:s,type:o}=r;switch(o){case Xe.LocalVideoTrack:s.addListener(Rt.GET_STATS,this.handleGetLocalVideoStats),s.addListener(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Rt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.addListener(Rt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.addListener(Rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.addListener(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Xe.LocalAudioTrack:this.bindLocalAudioTrackEvents(s);case Xe.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof Mi?e.trackList.forEach(s=>{s.addListener(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.addListener(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.addListener(Rt.GET_STATS,this.handleGetLocalAudioStats),s.addListener(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.addListener(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Rt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||e.addListener(Rt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[s,{track:o}]=r;return{track:o,type:s}})),e.forEach(r=>{let{track:s,type:o}=r;switch(o){case Xe.LocalVideoTrack:s.off(Rt.GET_STATS,this.handleGetLocalVideoStats),s.off(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),s.off(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),s.off(Rt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),s.off(Rt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),s.off(Rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),s.off(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),s.off(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Xe.LocalAudioTrack:this.unbindLocalAudioTrackEvents(s);case Xe.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Mi?e.trackList.forEach(r=>{r.off(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(Rt.GET_STATS,this.handleGetLocalAudioStats),r.off(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Rt.GET_STATS,this.handleGetLocalAudioStats),e.off(Rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof Qv&&r.addListener(Rt.GET_STATS,s=>{s(this.handleGetRemoteVideoStats(e))}),r instanceof Zv&&r.addListener(Rt.GET_STATS,s=>{s(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Rt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,s]=e;s.has(bt.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),s.has(bt.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((s,o)=>{var c;let u,{track:h,type:m}=s;switch(m){case Xe.LocalAudioTrack:u=Qn.Audio;break;case Xe.LocalVideoTrack:u=ct(c=h._hints).call(c,fr.SCREEN_TRACK)?Qn.Screen:Qn.High;break;case Xe.LocalVideoLowTrack:u=Qn.Low}return{kind:m===Xe.LocalAudioTrack?bt.AUDIO:bt.VIDEO,stream_type:u,mid:r[o].id,ssrcs:r[o].localSSRC,isMuted:h.muted||!h.enabled}})}createGatewayUnpublishMessage(e){return e.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalVideoTrack:o=ct(s=u._hints).call(s,fr.SCREEN_TRACK)?Qn.Screen:Qn.High;break;case Xe.LocalAudioTrack:o=Qn.Audio;break;case Xe.LocalVideoLowTrack:o=Qn.Low}return{stream_type:o,ssrcs:h,mid:m}})}assignLocalTracks(e,r){e.forEach((s,o)=>{let{track:c,type:u}=s;this.localTrackMap.set(u,{track:c,id:r[o].id,ssrcs:r[o].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[s]=r;this.localTrackMap.delete(s)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{var s;x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(r,")")),this.emit(jt.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(e.isInRestartIce=!1),ct(s=this._restartStates).call(s,r)&&!e.isInRestartIce&&(r==="disconnected"&&await ps(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),Nt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:Hr.TRACER}).onSuccess(),this.emit(jt.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var s;const o=Array.from(el(s=this.remoteUserMap).call(s)).find(u=>u._audioSSRC===r);var c;o&&(this.store.subscribe(o.uid,"audio",void 0,void 0,void 0,Date.now()),(c=o.audioTrack)===null||c===void 0||c.emit(Kv.FIRST_FRAME_DECODED),Nt.firstRemoteFrame(this.store.sessionId,Xi.FIRST_AUDIO_DECODE,Lr.FIRST_AUDIO_DECODE,{peer:o._uintid,subscribeElapse:Js.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var s;const o=Array.from(el(s=this.remoteUserMap).call(s)).find(c=>c._audioSSRC===r);o&&Nt.firstRemoteFrame(this.store.sessionId,Xi.FIRST_AUDIO_RECEIVED,Lr.FIRST_AUDIO_RECEIVED,{peer:o._uintid,subscribeElapse:Js.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,s,o)=>{this.reportVideoFirstFrameDecoded(r,s,o)},e.onFirstVideoReceived=r=>{var s;const o=Array.from(el(s=this.remoteUserMap).call(s)).find(c=>c._videoSSRC===r);o&&Nt.firstRemoteFrame(this.store.sessionId,Xi.FIRST_VIDEO_RECEIVED,Lr.FIRST_VIDEO_RECEIVED,{peer:o._uintid,subscribeElapse:Js.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(r,s)=>{const o=r.candidateType==="relay",c=s.candidateType==="relay";s.candidateType!=="unknown"&&o===c||this.emit(jt.ConnectionTypeChange,o),x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(qm(s))," -> ").concat(JSON.stringify(qm(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,s)=>{x.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(qm(s))," -> ").concat(JSON.stringify(qm(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.onLocalCandidate=r=>{this.emit(jt.LocalCandidate,{candidate:r,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const r=e===qo.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,x.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),e===qo.SEND_ONLY?this.restartICE(e):Os(this,jt.RequestP2PRestartICE,{direction:qo.SEND_ONLY}))}filterTobeMutedTracks(e){const r=[];if(this.getAllTracks().indexOf(e)===-1)return r;const s=this.localTrackMap.get(Xe.LocalAudioTrack);if(e instanceof Xr&&(s==null?void 0:s.track)instanceof Mi)return s.track.isActive||r.push([Xe.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o&&(r.push(o),o[0]===Xe.LocalVideoTrack)){const c=this.localTrackMap.get(Xe.LocalVideoLowTrack);c&&r.push([Xe.LocalVideoLowTrack,c])}return r}filterTobeUnmutedTracks(e){const r=[],s=this.localTrackMap.get(Xe.LocalAudioTrack);if(e instanceof Xr&&(s==null?void 0:s.track)instanceof Mi)return s.track.isActive&&r.push([Xe.LocalAudioTrack,s]),r;const o=Array.from(this.localTrackMap.entries()).find(c=>{let[,{track:u}]=c;return e===u});if(o)if(o[0]===Xe.LocalVideoTrack){r.push(o);const c=this.localTrackMap.get(Xe.LocalVideoLowTrack);c&&r.push([Xe.LocalVideoLowTrack,c])}else r.push(o);return r}createMuteMessage(e){return e.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalAudioTrack:o=Qn.Audio;break;case Xe.LocalVideoTrack:o=ct(s=u._hints).call(s,fr.SCREEN_TRACK)?Qn.Screen:Qn.High;break;case Xe.LocalVideoLowTrack:o=Qn.Low}return{stream_type:o,ssrcs:h,mid:m}})}createUnmuteMessage(e){return e.map(r=>{var s;let o,[c,{track:u,ssrcs:h,id:m}]=r;switch(c){case Xe.LocalAudioTrack:o=Qn.Audio;break;case Xe.LocalVideoTrack:o=ct(s=u._hints).call(s,fr.SCREEN_TRACK)?Qn.Screen:Qn.High;break;case Xe.LocalVideoLowTrack:o=Qn.Low}return{stream_type:o,ssrcs:h,mid:m}})}filterTobeUnSubscribedTracks(e,r){const s=[],o=this.remoteUserMap.get(e);if(!o)return s;if(r){const c=o.get(r);if(!c)return s;s.push([e,{kind:r,id:c}])}else Array.from(o.entries()).forEach(c=>{let[u,h]=c;s.push([e,{kind:u,id:h}])});return s}createUnsubscribeMessage(e){const r=[];return e.forEach(s=>{let[o,{kind:c,id:u}]=s;switch(c){case bt.VIDEO:return void(o._videoSSRC&&r.push({stream_type:bt.VIDEO,ssrcId:o._videoSSRC}));case bt.AUDIO:return void(o._audioSSRC&&r.push({stream_type:bt.AUDIO,ssrcId:o._audioSSRC}))}}),r}withdrawRemoteTracks(e){e.forEach(r=>{let[s,{kind:o}]=r;const c=this.remoteUserMap.get(s);c&&(c.delete(o),Array.from(c.entries()).length===0&&this.remoteUserMap.delete(s))})}async updateBitrateLimit(e){const r=this.localTrackMap.get(Xe.LocalVideoTrack),s=this.localTrackMap.get(Xe.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(e.uplink),await new ht((o,c)=>{this.handleUpdateVideoEncoder(r.track,o,c,!0)})),s&&e.low_stream_uplink&&(await s.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new ht((o,c)=>{this.handleUpdateVideoEncoder(s.track,o,c,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return e!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof Xr){const s=this.filterTobeUnmutedTracks(e[r]);if(s.length===0)continue;const o=this.createUnmuteMessage(s);return void await hr(this,jt.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:r}]=e;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(jt.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(jt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await ps(Jx(this.dtlsFailedCount,Pi)),this.emit(jt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Xe.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Cr)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof Cr).length>1)throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof Xr).length>1&&(e.some(r=>r instanceof Xr&&r._bypassWebAudio)||!Fn().webAudioMediaStreamDest))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of e){if(r instanceof Cr&&this.pendingLocalTracks.some(s=>s instanceof Cr))throw new Le(te.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof Xr&&this.pendingLocalTracks.some(s=>s instanceof Xr)&&(!Fn().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(s=>s instanceof Xr&&s._bypassWebAudio)))throw new Le(te.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){const s=!oe("DISABLE_DUAL_STREAM_USE_ENCODING")&&Fn().supportDualStreamEncoding,o=tO(tO({},{width:160,height:120,framerate:15,bitrate:50}),r);let c;c=s?e._mediaStreamTrack.clone():o2(e,o);const u=pr(8,"track-low-"),h=new Cr(c,tO(tO({},s&&{scaleResolutionDownBy:zL(o,e)}),{},{frameRate:o.framerate,bitrateMax:o.bitrate,bitrateMin:o.bitrate}),void 0,void 0,u);return h.on(G_.TRANSCEIVER_UPDATED,m=>{e._updateRtpTransceiver(m,Hv.LOW_STREAM)}),h._hints.push(fr.LOW_STREAM),e.addListener(Rt.NEED_CLOSE,()=>{h.close()}),h}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,r,s,o){var c;const u=Array.from(el(c=this.remoteUserMap).call(c)).find(h=>h._videoSSRC===e);if(u){o||this.store.subscribe(u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const h=this.store.keyMetrics,m=h.subscribe.find(y=>y.userId===u.uid&&y.type==="video");Nt.firstRemoteVideoDecode(this.store.sessionId,Xi.FIRST_VIDEO_DECODE,Lr.FIRST_VIDEO_DECODE,{peer:u._uintid,videowidth:r,videoheight:s,subscribeElapse:Js.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:h.requestAPEnd||0,apStart:h.requestAPStart||0,joinGwEnd:h.joinGatewayEnd||0,joinGwStart:h.joinGatewayStart||0,pcEnd:h.peerConnectionEnd||0,pcStart:h.peerConnectionStart||0,subscriberEnd:(m==null?void 0:m.subscribeEnd)||0,subscriberStart:(m==null?void 0:m.subscribeStart)||0,videoAddNotify:(m==null?void 0:m.streamAdded)||0,state:o?1:0})}}async remoteMediaSsrcChanged(e,r,s){if(!this.recvConnection)return!1;const o=this.remoteUserMap.get(e);if(!o)return!1;const c=o.get(r);if(!c)return!1;const u=await this.recvConnection.getRemoteSSRC(c);return u!==void 0&&u!==s}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Le(te.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Le(te.NOT_SUPPORTED)}async subscribeDataChannel(e,r){throw new Le(te.NOT_SUPPORTED)}async unsubscribeDataChannel(e,r){throw new Le(te.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,r){throw new Le(te.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,r){throw new Le(te.NOT_SUPPORTED)}async preConnect(e){throw new Le(te.NOT_SUPPORTED)}getEstablishParams(){throw new Le(te.NOT_SUPPORTED)}async reSubscribe(e){throw new Le(te.NOT_SUPPORTED)}async updateVideoStreamParameter(e,r){throw new Le(te.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:s}]=e;r===Xe.LocalVideoLowTrack?s._updateRtpTransceiver(void 0,Hv.LOW_STREAM):s._updateRtpTransceiver(void 0)})}},It(Ur.prototype,"p2pConnect",[A7],Object.getOwnPropertyDescriptor(Ur.prototype,"p2pConnect"),Ur.prototype),It(Ur.prototype,"unpublish",[P7],Object.getOwnPropertyDescriptor(Ur.prototype,"unpublish"),Ur.prototype),It(Ur.prototype,"unpublishLowStream",[O7],Object.getOwnPropertyDescriptor(Ur.prototype,"unpublishLowStream"),Ur.prototype),It(Ur.prototype,"subscribe",[k7],Object.getOwnPropertyDescriptor(Ur.prototype,"subscribe"),Ur.prototype),It(Ur.prototype,"mockSubscribe",[N7],Object.getOwnPropertyDescriptor(Ur.prototype,"mockSubscribe"),Ur.prototype),It(Ur.prototype,"unsubscribe",[D7],Object.getOwnPropertyDescriptor(Ur.prototype,"unsubscribe"),Ur.prototype),It(Ur.prototype,"muteRemote",[x7],Object.getOwnPropertyDescriptor(Ur.prototype,"muteRemote"),Ur.prototype),It(Ur.prototype,"unmuteRemote",[L7],Object.getOwnPropertyDescriptor(Ur.prototype,"unmuteRemote"),Ur.prototype),It(Ur.prototype,"hasRemoteMediaWithLock",[M7],Object.getOwnPropertyDescriptor(Ur.prototype,"hasRemoteMediaWithLock"),Ur.prototype),It(Ur.prototype,"disconnectForReconnect",[U7],Object.getOwnPropertyDescriptor(Ur.prototype,"disconnectForReconnect"),Ur.prototype),It(Ur.prototype,"remoteMediaSsrcChanged",[V7],Object.getOwnPropertyDescriptor(Ur.prototype,"remoteMediaSsrcChanged"),Ur.prototype),Ur);function xd(e){return function(r,s,o){const c=r[s];if(typeof c!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];switch(e){case Dd.SEND_ONLY:{const y=await this.sendMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y()}}case Dd.RECEIVE_ONLY:{const y=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y()}}default:{const y=await this.sendMutex.lock("From P2PChannel2.".concat(s)),E=await this.recvMutex.lock("From P2PChannel2.".concat(s));try{return await c.apply(this,h)}finally{y(),E()}}}},o}}class dy extends jr{constructor(r,s){super(),q(this,"signal",void 0),q(this,"token",void 0),q(this,"tokenTimeout",void 0),q(this,"tokenInterval",void 0),q(this,"_sequence",0),q(this,"userMap",new Map),q(this,"encoder",new TextEncoder),this.signal=r,this.token=s;const o=()=>{this.signal.connectionState===_r.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(o,1e3):this.tokenInterval=window.setTimeout(o,3*oe("P2P_TOKEN_INTERVAL"))};o()}async send(r,s,o,c,u){var h,m,y;if(this.userMap.size===0)return;const E=Array.from(Xc(h=this.userMap).call(h))[0].token;typeof s!="string"&&(s=JSON.stringify(s)),c=(m=c)!==null&&m!==void 0?m:pr(6,""),u=(y=u)!==null&&y!==void 0?y:this._sequence++;const S={_id:c,_type:r,_seq:u,_message:s,token:"".concat(this.token,"_").concat(E)};oe("SHOW_P2P_LOG")&&x.debug("send message",S,"noNeedResponse : ".concat(o)),this.splitMessage(JSON.stringify(S)).forEach(P=>{this.signal.request(Yt.DATA_STREAM,{payload:Wm(this.encoder.encode(P))})});const R=new ht((P,D)=>{const G=window.setTimeout(()=>{this.off("res-@".concat(c,"_ack"),j),this.off("res-@".concat(c),Y),this.off(iS.ABORT,B),x.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(c)),this.userMap.size===0?D(new Le(te.INVALID_REMOTE_USER)):D(new Le(te.TIMEOUT))},oe("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),j=()=>{G&&window.clearTimeout(G),this.off(iS.ABORT,B),o&&P()},B=()=>{G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),j),this.off("res-@".concat(c),Y),D(new Le(te.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(c)))};this.once(iS.ABORT,B),this.once("res-@".concat(c,"_ack"),j);const Y=(fe,ye)=>{ee=!0,G&&window.clearTimeout(G),this.off("res-@".concat(c,"_ack"),j),this.off(iS.ABORT,B),fe==="success"?P(ye):D(new Le(te.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(c)))};let ee=!1;o||(this.once("res-@".concat(c),Y),ps(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{ee||x.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(c,", ").concat(S))}))});try{return await R}catch(P){if(P.code===te.TIMEOUT)return await this.send(r,s,o,c,u);throw P}}onMessage(r){var s;const{_uid:o}=r;let c,u=this.userMap.get(o);if(u)c=u.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==ci.CHECK)return;const{token:E}=r;c=new Map,u={uid:o,isStart:!0,token:E,splitMessageMap:c,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(o,u),this.signal.emit(Cn.ON_USER_ONLINE,{uid:o}),this.handleUserOnline()}if("id"in r&&"total"in r){var h;const{id:E,total:S}=r,R=(h=c.get(E))!==null&&h!==void 0?h:[];if(R.push(r),c.has(E)||c.set(E,R),R.length!==S)return;{const P=oT(R).call(R,(D,G)=>D.index-G.index).map(D=>D.payload).join("");c.delete(E),(r=JSON.parse(P))._uid=o}}const{_type:m,token:y}=r;if(ct(s=[ci.ACK,ci.CHECK]).call(s,m))return m===ci.CHECK&&this.handleCheckToken(u,y),void this.receiveMessage(r);y==="".concat(u.token,"_").concat(this.token)?this.handleReceivedMessage(r):x.debug('Receive unexpected message", '.concat(y,", cur_token: ").concat(u.token,"_").concat(this.token),r)}check(){const r={_id:pr(6,""),token:this.token,_type:ci.CHECK};oe("SHOW_P2P_LOG")&&x.debug("send message",r),this.signal.request(Yt.DATA_STREAM,{payload:Wm(this.encoder.encode(JSON.stringify(r)))})}ack(r){const s={_id:r,_type:ci.ACK,token:this.token};oe("SHOW_P2P_LOG")&&x.debug("send message",s),this.signal.request(Yt.DATA_STREAM,{payload:Wm(this.encoder.encode(JSON.stringify(s)))})}response(r,s,o){this.send(ci.RESPONSE,JSON.stringify({success:!o,message:s}),!0,r)}handleReceivedMessage(r){const s=()=>{this.userMap.forEach(E=>{const{receivedMessagesMap:S,nextExpectedSequenceNumber:R}=E;for(;S.has(R);){const P=S.get(R);S.delete(R),this.receiveMessage(P),E.nextExpectedSequenceNumber++}})};if(!r)return void s();const{_uid:o,_seq:c}=r,u=this.userMap.get(o),{receivedMessagesMap:h,isStart:m,nextExpectedSequenceNumber:y}=u;if(c<y)return this.ack(r._id),void x.debug("[external-signal] receive old message, seq: ".concat(c,", ").concat(r._message));h.set(c,r),m&&c===y&&(this.receiveMessage(r),h.delete(y),u.nextExpectedSequenceNumber++,s())}receiveMessage(r){const{_id:s,_type:o,_message:c,_uid:u}=r;if(oe("SHOW_P2P_LOG")&&x.debug("receive message",r),s){let h;switch(r._type!==ci.ACK&&(c&&(h=JSON.parse(c)),this.ack(r._id)),r._type){case ci.CANDIDATE:case ci.CONTROL:this.signal.emit(o,h,u);break;case ci.PUBLISH:case ci.UNPUBLISH:case ci.RESTART_ICE:case ci.CALL:h.uid=u,Os(this.signal,o,h).then(m=>{this.response(r._id,m)}).catch(()=>{this.response(r._id,void 0,!0)});break;case ci.ACK:this.getListeners("res-@".concat(s,"_ack")).length>0&&this.emit("res-@".concat(s,"_ack"));break;case ci.RESPONSE:{const{success:m,message:y}=h;this.emit("res-@".concat(s),m?"success":"failed",y);break}}}}splitMessage(r){if(r.length<dy.MAX_MESSAGE_SIZE)return[r];const s=[],{remoteToken:o}=JSON.parse(r),c=pr(6,"");let u=0,h=800;const m=Math.ceil(r.length/h);for(;r.length>0;){u++;const y={id:c,index:u,total:m,payload:r.slice(0,h),token:"".concat(this.token,"_").concat(o)};JSON.stringify(y).length>dy.MAX_MESSAGE_SIZE?h-=50:(s.push(y),r=r.slice(h))}return s.map(y=>JSON.stringify(y))}handleCheckToken(r,s){return r.token!==s?(x.debug("token changed, from ".concat(r.token," to ").concat(s)),this.reset(r.uid,s),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{x.debug("token timeout, ".concat(s)),this.reset(r.uid)},oe("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await Os(this.signal,ci.CALL,void 0),s=await this.send(ci.CALL,r);this.signal.emit(Jt.P2P_CONNECTION,s,!0)}async reset(r,s){const o=this.userMap.get(r);o&&(this.emit(iS.ABORT),this.signal.emit(Cn.ON_USER_OFFLINE,{uid:o.uid,reason:Dme.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),s||(x.debug("change local token from ".concat(s," to ").concat(s)),this.token=pr(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(iS.ABORT)}}q(dy,"MAX_SIZE",1),q(dy,"MAX_MESSAGE_SIZE",1024);class mye extends jr{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===_r.CONNECTED?this.emit(Jt.WS_CONNECTED):r===_r.RECONNECTING?this.emit(Jt.WS_RECONNECTING,this._websocketReconnectReason):r===_r.CLOSED&&this.emit(Jt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,s){super(),q(this,"_disconnectedReason",void 0),q(this,"_websocketReconnectReason",void 0),q(this,"_connectionState",_r.CLOSED),q(this,"reconnectToken",void 0),q(this,"p2pToken",void 0),q(this,"websocket",void 0),q(this,"openConnectionTime",void 0),q(this,"clientId",void 0),q(this,"lastMsgTime",Date.now()),q(this,"uploadCache",[]),q(this,"uploadCacheInterval",void 0),q(this,"rttRolling",new mW(5)),q(this,"pingpongTimer",void 0),q(this,"pingpongTimeoutCount",0),q(this,"joinResponse",void 0),q(this,"multiIpOption",void 0),q(this,"initError",void 0),q(this,"spec",void 0),q(this,"store",void 0),q(this,"_external_signal",void 0),q(this,"onWebsocketMessage",o=>{if(o.data instanceof ArrayBuffer)return void this.emit(Jt.ON_BINARY_DATA,o.data);const c=JSON.parse(o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(c,"_id")){const u="res-@".concat(c._id);this.emit(u,c._result,c._message)}else if(Object.prototype.hasOwnProperty.call(c,"_type")){switch(c._type){case Cn.ON_DATA_STREAM:return void this.handleDataStream(c._message);case Cn.MUTE_AUDIO:case Cn.MUTE_VIDEO:case Cn.ON_P2P_LOST:case Cn.ON_USER_ONLINE:return;case Cn.ON_USER_OFFLINE:const{uid:u}=c._message;return x.debug("[".concat(this.clientId,"] user-offline uid: ").concat(u)),void this._external_signal.reset(u)}if(this.emit(c._type,c._message),c._type===Cn.ON_NOTIFICATION&&this.handleNotification(c._message),c._type===Cn.ON_USER_BANNED)switch(c._message.error_code){case 14:this.close(Yn.UID_BANNED);break;case 15:this.close(Yn.IP_BANNED);break;case 16:this.close(Yn.CHANNEL_BANNED)}if(c._type===Cn.ON_USER_LICENSE_BANNED)switch(c._message.error_code){case Bt.ERR_LICENSE_MISSING:this.close(Yn.LICENSE_MISSING);break;case Bt.ERR_LICENSE_EXPIRED:this.close(Yn.LICENSE_EXPIRED);break;case Bt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Yn.LICENSE_MINUTES_EXCEEDED);break;case Bt.ERR_LICENSE_PERIOD_INVALID:this.close(Yn.LICENSE_PERIOD_INVALID);break;case Bt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Yn.LICENSE_MULTIPLE_SDK_SERVICE);break;case Bt.ERR_LICENSE_ILLEGAL:this.close(Yn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=s,this.websocket=new FL("gateway-".concat(this.clientId),this.spec.retryConfig,!0,oe("JOIN_GATEWAY_USE_DUAL_DOMAIN"),oe("JOIN_GATEWAY_USE_443PORT_ONLY"),s),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===_r.CONNECTED&&this.reconnect("retry",Ps.OFFLINE)}),this.p2pToken=pr(6,""),this._external_signal=new dy(this,this.p2pToken)}async request(r,s,o,c){const u=pr(6,""),h={_id:u,_type:r,_message:s},m=this.websocket.connectionID,y=()=>new ht((G,j)=>{if(this.connectionState===_r.CONNECTED)return G();const B=()=>{this.off(Jt.WS_CLOSED,Y),G()},Y=()=>{this.off(Jt.WS_CONNECTED,B),j(new Le(te.WS_ABORT))};this.once(Jt.WS_CONNECTED,B),this.once(Jt.WS_CLOSED,Y)});if(this.connectionState!==_r.CONNECTING&&this.connectionState!==_r.RECONNECTING||r===Yt.JOIN||r===Yt.REJOIN||await y(),this.websocket.sendMessage(h,!0),c)return;const E=new ht((G,j)=>{let B=!1;const Y=(fe,ye)=>{B=!0,G({isSuccess:fe==="success",message:ye||{}}),this.off(Jt.WS_CLOSED,ee),this.off(Jt.WS_RECONNECTING,ee),this.emit(Jt.REQUEST_SUCCESS,r,s)};this.once("res-@".concat(u),Y);const ee=()=>{j(new Le(te.WS_ABORT,"type: ".concat(r))),this.off(Jt.WS_CLOSED,ee),this.off(Jt.WS_RECONNECTING,ee),this.off("res-@".concat(u),Y)};this.once(Jt.WS_CLOSED,ee),this.once(Jt.WS_RECONNECTING,ee),ps(oe("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==m||B||(x.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(Jt.REQUEST_TIMEOUT,r,s))})});let S=null;try{S=await E}catch(G){if(this.connectionState===_r.CLOSED||r===Yt.LEAVE)throw new Le(te.WS_ABORT);return!this.spec.forceWaitGatewayResponse||o?G.throw():r===Yt.JOIN||r===Yt.REJOIN?null:(await y(),await this.request(r,s))}if(S.isSuccess)return S.message;const R=Number(S.message.error_code||S.message.code),P=NT(R),D=new Le(te.UNEXPECTED_RESPONSE,"".concat(P.desc,": ").concat(S.message.error_str),{code:R,data:S.message,desc:P.desc});return P.action==="success"?S.message:(x.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(R,", message: ").concat(P.desc,", action: ").concat(P.action)),R===Bt.ERR_TOO_MANY_BROADCASTERS?((r===Yt.JOIN||r===Yt.REJOIN)&&(this.initError=D,this.close()),D.throw()):P.action==="failed"?D.throw():P.action==="quit"?(this.initError=D,this.close(),D.throw()):(R===Bt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=S.message.option,x.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Ps.MULTI_IP)):this.reconnect(P.action,Ps.SERVER_ERROR),r===Yt.JOIN||r===Yt.REJOIN?null:await this.request(r,s)))}waitMessage(r,s){return new ht(o=>{const c=u=>{(!s||s(u))&&(this.off(r,c),o(u))};this.on(r,c)})}uploadWRTCStats(r){if(!this.store.sessionId)return void x.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const s={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(OT.WRTC_STATS,s)}upload(r,s){const o={_type:r,_message:s};try{this.websocket.sendMessage(o)}catch{const u=oe("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(o),this.uploadCache.length>u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==_r.CONNECTED)return;const h=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(h._type,h._message)},oe("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,s){const o={_type:r,_message:s};this.websocket.sendMessage(o)}async sendExtensionMessage(r,s,o){return await this._external_signal.send(r,s,o)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ht((s,o)=>{this.once(Jt.WS_CONNECTED,()=>s(this.joinResponse)),this.once(Jt.WS_CLOSED,()=>o(this.initError||new Le(te.WS_ABORT))),this.connectionState=_r.CONNECTING,this.websocket.init(r).catch(o)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||Yn.LEAVE,this.connectionState=_r.CLOSED,x.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=pr(6,""),this._external_signal.clear(),this._external_signal=new dy(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Jt.ABORT_P2P_EXECUTION);const r=await Os(this,Jt.REQUEST_JOIN_INFO),s=await this.request(Yt.JOIN,r);if(!s)return this.emit(Jt.REPORT_JOIN_GATEWAY,te.TIMEOUT,this.url||""),!1;this.joinResponse=s,this.emit(Jt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=_r.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,s){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,s)}handleDataStream(r){try{var s;const o=B_(r.payload),c=new TextDecoder().decode(o),u=JSON.parse(c);"total"in u&&"id"in u||ct(s=Object.values(ci)).call(s,u._type)?(u._uid=r.uid,this._external_signal.onMessage(u)):this.emit(Cn.ON_DATA_STREAM,r)}catch{this.emit(Cn.ON_DATA_STREAM,r)}}handleNotification(r){x.debug("[".concat(this.clientId,"] receive notification: "),r);const s=NT(r.code);if(s.action!=="success"){if(s.action!=="failed")return s.action==="quit"?(s.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Yn.UID_BANNED),void this.close()):void this.reconnect(s.action,Ps.SERVER_ERROR);x.error("[".concat(this.clientId,"] ignore error: "),s.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=oe("PING_PONG_TIME_OUT"),s=Date.now();this.pingpongTimeoutCount>=r&&(x.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(s-this.lastMsgTime,"ms")),s-this.lastMsgTime>oe("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Ps.TIMEOUT):this.request(Yt.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const o=Date.now()-s;this.rttRolling.add(o),oe("REPORT_STATS")&&this.send(Yt.PING_BACK,{pingpongElapse:o})}).catch(o=>{})}handleWebsocketEvents(){this.websocket.on(nn.RECONNECT_CREATE_CONNECTION,r=>{this.emit(Jt.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(nn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(nn.CLOSED,()=>{this.connectionState=_r.CLOSED}),this.websocket.on(nn.FAILED,()=>{this._disconnectedReason=Yn.NETWORK_ERROR,this.connectionState=_r.CLOSED}),this.websocket.on(nn.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===_r.CONNECTED?this.connectionState=_r.RECONNECTING:this.connectionState=_r.CONNECTING}),this.websocket.on(nn.WILL_RECONNECT,(r,s,o)=>{r!=="retry"?(x.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):x.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),o(r)}),this.websocket.on(nn.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(Jt.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof Le&&r.code===te.UNEXPECTED_RESPONSE&&r.data.code===Bt.ERR_NO_AUTHORIZED)return x.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Ps.SERVER_ERROR);x.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Ps.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(nn.REQUEST_NEW_URLS,(r,s)=>{Os(this,Jt.REQUEST_RECOVER,this.multiIpOption).then(r).catch(s)}),this.websocket.on(nn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const gye={name:"P2PChannel",create:function(e){let{store:r,statsCollector:s}=e;return new fye(r,s)},createSubmodule:function(e){let{store:r,spec:s}=e;return new mye(s,r)}};function F7(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function B7(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?F7(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):F7(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}class _ye{constructor(r){q(this,"sessionDesc",void 0),q(this,"localCapabilities",void 0),q(this,"rtpCapabilities",void 0),q(this,"candidates",void 0),q(this,"_originCandidates",void 0),q(this,"iceParameters",void 0),q(this,"dtlsParameters",void 0),q(this,"setup",void 0),q(this,"currentMidIndex",void 0),q(this,"cname",void 0),r=$r(r);const{iceParameters:s,dtlsParameters:o,candidates:c,rtpCapabilities:u,setup:h,localCapabilities:m,sdkCodec:y,cname:E}=r,S=qa(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=u,this.candidates=c,this._originCandidates=$r(c),this.iceParameters=s,this.dtlsParameters=o,this.setup=h,this.localCapabilities=m,this.cname=E;for(let R=0;R<S.mediaDescriptions.length;R++){const P=S.mediaDescriptions[R];if(P.attributes.iceUfrag=s.iceUfrag,P.attributes.icePwd=s.icePwd,P.attributes.fingerprints=o.fingerprints,P.attributes.candidates=c,P.attributes.setup=h,P.media.mediaType==="video"){P.media.fmts=u.videoCodecs.map(G=>G.payloadType.toString(10));let D=u.videoCodecs.filter(G=>{var j,B;return(j=G.rtpMap)===null||j===void 0?void 0:ct(B=j.encodingName.toLowerCase()).call(B,y)});D.length===0&&(D=u.videoCodecs),P.attributes.payloads=D,P.attributes.extmaps=u.videoExtensions}P.media.mediaType==="audio"&&(P.media.fmts=u.audioCodecs.map(D=>D.payloadType.toString(10)),P.attributes.payloads=u.audioCodecs,P.attributes.extmaps=u.audioExtensions),S.mediaDescriptions[R]=this.mungMediaDesc(P)}this.sessionDesc=S,this.currentMidIndex=S.mediaDescriptions.length-1}toString(){return Gm(this.sessionDesc)}send(r,s,o){const{ssrcs:c,ssrcGroups:u}=J_(s,this.cname),h=this.sessionDesc.mediaDescriptions.find(E=>r===bt.VIDEO?E.media.mediaType==="video":E.media.mediaType==="audio"),m=c[0].attributes.label,y=c[0].attributes.mslabel;return h.attributes.ssrcs=h.attributes.ssrcs.concat(c),h.attributes.ssrcGroups=h.attributes.ssrcGroups.concat(u),{id:m,mslabel:y}}batchSend(r){return r.map(s=>{let{kind:o,ssrcMsg:c}=s;return this.send(o,c,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(s=>{const o=[],c=[],u=[];s.attributes.ssrcs.forEach(h=>{ct(r).call(r,h.attributes.label||"")?u.push(h):o.push(h)}),s.attributes.ssrcGroups.forEach(h=>{var m;ct(m=u.map(y=>y.ssrcId)).call(m,h.ssrcIds[0])||c.push(h)}),s.attributes.ssrcs=o,s.attributes.ssrcGroups=c})}mute(r){const s=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));s.attributes.direction="inactive"}unmute(r){const s=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!s)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));s.attributes.direction="sendonly"}receive(r,s,o){r.forEach((c,u)=>{const h=c._mediaStreamTrack,m=this.sessionDesc.mediaDescriptions.findIndex(E=>E.attributes.mid===h.kind),y=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],c);this.sessionDesc.mediaDescriptions[m]=y})}stopReceiving(r){}updateCandidates(r){const s=this._originCandidates.filter(c=>c.transport==="udp"),o=[];if(s.forEach(c=>{o.push(B7(B7({},c),{},{foundation:"tcpcandidate",priority:Number(c.priority)-1+"",transport:"tcp",port:Number(c.port)+90+""}))}),s.length!==0){switch(r){case Xs.TCP_RELAY:this.candidates=o;break;case Xs.UDP_TCP_RELAY:case Xs.RELAY:this.candidates=[...s,...o];break;default:this.candidates=s}for(const c of this.sessionDesc.mediaDescriptions)c.attributes.candidates=this.candidates}}restartICE(r){r=$r(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(s=>{s.attributes.iceUfrag=r.iceUfrag,s.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const s=[];for(let o=0;o<r;o++)s.push((this.currentMidIndex+o+1).toString(10));return s}mungRecvMediaDsec(r,s){const o=$r(r);return aS(o,s),GL(o,s),o}updateRecvMedia(r,s){const o=this.sessionDesc.mediaDescriptions.findIndex(c=>c.attributes.mid===r);if(o!==-1){const c=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],s);this.sessionDesc.mediaDescriptions[o]=c}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,s,o){const c=this.sessionDesc.mediaDescriptions.find(h=>r===bt.VIDEO?h.attributes.mid==="video":h.attributes.mid==="audio");if(c){const h=c.attributes.ssrcs.find(m=>m.attributes.label===s);var u;h&&(h.attributes.label=o,(u=h.attributes.msid)===null||u===void 0||u.replace(s,o))}}mungMediaDesc(r){const s=$r(r);return WL(s),function(o){const c=o.attributes.extmaps.find(u=>_P(u.extensionName));c&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(c),1),o.attributes.payloads.forEach(u=>{const h=u.rtcpFeedbacks.findIndex(m=>m.type==="transport-cc");h!==-1&&u.rtcpFeedbacks.splice(h,1)})}(s),s}getSSRC(r){for(const s of this.sessionDesc.mediaDescriptions)for(const o of s.attributes.ssrcs)if(o.attributes.label===r)return[o]}}var dr;function z7(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),s.push.apply(s,o)}return s}function nO(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?z7(Object(s),!0).forEach(function(o){q(e,o,s[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):z7(Object(s)).forEach(function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(s,o))})}return e}let yye=(dr=class qw extends JG{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var s;return ct(s=Object.keys($A)).call(s,r)}))]}constructor(r,s){super(r,s),q(this,"store",void 0),q(this,"peerConnection",void 0),q(this,"remoteSDP",void 0),q(this,"initialOffer",void 0),q(this,"statsFilter",void 0),q(this,"useRTX",!1),q(this,"localCapabilities",void 0),q(this,"localCandidateCount",0),q(this,"allCandidatesReceived",!1),q(this,"establishPromise",void 0),q(this,"mutex",void 0),this.store=s,this.mutex=new qs("P2PConnection-mutex",s.clientId),this.peerConnection=new RTCPeerConnection(qw.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=rL(this.peerConnection,oe("STATS_UPDATE_INTERVAL"),void 0,Wr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Ym(r.sdp),o=LT(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:oe("FILTER_VIDEO_FEC"),filterAudioFec:oe("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=o,this.initialOffer=r,nO(nO({},s),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:o},offerSDP:r.sdp})}catch(r){throw new Le(te.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new _ye(nO(nO({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}}async updateRemoteRTPCapabilities(r,s){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,s){var o=this;return Nl(function*(){const c=yield Dn(o.mutex.lock());try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const u=r.map(P=>o.peerConnection.addTrack(P._mediaStreamTrack)),h=yield Dn(o.peerConnection.createOffer()),m=qa(h.sdp),y=r.map(P=>{const D=P._mediaStreamTrack,G=m.mediaDescriptions.find(j=>j.attributes.mid===D.kind);if(!G)throw new Error("Cannot extract ssrc from mediaDescription.");return function(j,B,Y){const ee=j.attributes.ssrcs.filter(ye=>ye.attributes.label===B),fe=j.attributes.ssrcGroups;if(ee.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(fe&&ee.length>1){const ye=fe.find(Ee=>Ee.ssrcIds.indexOf(ee[0].ssrcId)!==-1);return ye?[{ssrcId:ye.ssrcIds[0],rtx:Y?ye.ssrcIds[1]:void 0}]:[{ssrcId:ee[0].ssrcId}]}return[{ssrcId:ee[0].ssrcId}]}(G,D.id,o.useRTX)});let E;try{E=yield y}catch(P){throw u.forEach(D=>{As()&&D.replaceTrack(null),o.peerConnection.removeTrack(D)}),P}const S=o.mungSendOfferSDP(h.sdp,r);o.remoteSDP.receive(r,s,E);const R=o.remoteSDP.toString();return yield Dn(o.peerConnection.setLocalDescription({type:"offer",sdp:S})),yield Dn(o.applySendEncodings(u,r)),yield Dn(o.peerConnection.setRemoteDescription({type:"answer",sdp:R})),r.map((P,D)=>{const G=P._mediaStreamTrack.id;return{localSSRC:y[D],id:G}})}catch(u){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(u.toString()))}finally{c()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map(u=>{As()&&u.replaceTrack(null),this.peerConnection.removeTrack(u)});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(r);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}}async receive(r,s,o,c){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:u,mslabel:h}=this.remoteSDP.send(r,s,c),m=new ht((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(u)))},1e4),D=G=>{const j=xn();if((j.name==="Safari"&&Number(j.version)===11||Ho())&&G.track.id!==u&&G.streams[0].id===h){var B;const Y=G.streams[0].getTracks()[0];return(B=this.remoteSDP)===null||B===void 0||B.updateTrackLabel(r,u,G.track.id),this.peerConnection.removeEventListener("track",D),clearTimeout(P),void S(Y)}if(G.track.id===u)return this.peerConnection.removeEventListener("track",D),clearTimeout(P),void S(G.track)};this.peerConnection.addEventListener("track",D)}),y=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:y});const E=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(E),{track:await m,id:u}}catch(u){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(u.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(s.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(o=>{var c;return r.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1});if(s.length!==r.length)throw new Error("sender' length doesn't match mids' length.");s.map(o=>{if(As()&&o.track)o.track.enabled=!1;else{const c=o.getParameters();c.encodings.forEach(u=>u.active=!1),o.setParameters(c)}})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(s.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const s=this.peerConnection.getSenders().filter(u=>{var h;return r.indexOf(((h=u.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(s.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");s.map(async u=>{if(As()&&u.track)u.track.enabled=!0;else{const h=u.getParameters();h.encodings.forEach(m=>m.active=!0),await u.setParameters(h)}});const o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(o);const c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(s.toString()))}}restartICE(r){var s=this;return Nl(function*(){const o=yield Dn(s.mutex.lock("From P2PConnection.restartICE"));try{if(!s.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const c=Fn().supportPCSetConfiguration;if(r===Xs.RELAY&&!c)return;if(c){const E=s.peerConnection.getConfiguration(),S=r===Xs.RELAY?"relay":"all";E.iceTransportPolicy!==S&&(x.debug("[".concat(s.store.clientId,"] restartICE change iceTransportPolicy from [").concat(E.iceTransportPolicy,"] to [").concat(S,"]")),E.iceTransportPolicy=S,s.peerConnection.setConfiguration(E))}r!==Xs.RELAY&&s.remoteSDP.updateCandidates(r);const u=yield Dn(s.peerConnection.createOffer({iceRestart:!0}));if(!u.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const h=Ym(u.sdp),{remoteIceParameters:m}=yield h.iceParameters;s.remoteSDP.restartICE(m);const y=s.remoteSDP.toString();yield Dn(s.peerConnection.setLocalDescription(u)),yield Dn(s.peerConnection.setRemoteDescription({type:"answer",sdp:y}))}catch(c){x.warning("[".concat(s.store.clientId,"] restart ICE failed, abort operation"),c)}finally{o()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const o=await this.peerConnection.createOffer(),c=this.mungSendOfferSDP(o.sdp,[s]);this.remoteSDP.updateRecvMedia(s._mediaStreamTrack.kind,s);const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:c}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new Le(te.EXCHANGE_SDP_FAILED,o.toString())}}async updateSendParameters(r,s){const o=this.peerConnection.getSenders().filter(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===r});o.length===1&&await this.applySendEncodings(o,[s])}setStatsRemoteVideoIsReady(r,s){this.statsFilter.setVideoIsReady2(r,s)}async replaceTrack(r,s){const o=this.peerConnection.getSenders().find(c=>{var u;return((u=c.track)===null||u===void 0?void 0:u.id)===s});o&&await o.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,s){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new Le(te.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,x.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},oe("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const s={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?s.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(bT(r.turnServer.servers)?s.iceServers=r.turnServer.servers:(s.iceServers&&s.iceServers.push(...qw.turnServerConfigToIceServers(r.turnServer.servers)),oe("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&r.turnServer.serversFromGateway&&s.iceServers.push(...qw.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(s.iceTransportPolicy="relay")}))),s}static turnServerConfigToIceServers(r){const s=[];return r.forEach(o=>{o.security?o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}):(o.udpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.udpport,"?transport=udp")}),o.tcpport&&s.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=tcp")}))}),s}async updateRtpSenderEncodings(r,s){var o;if(s||(s=this.peerConnection.getSenders().find(E=>{var S;return((S=E.track)===null||S===void 0?void 0:S.id)===r._mediaStreamTrack.id})),!s)return x.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!Fn().supportSetRtpSenderParameters)return x.warn("Browser not support set rtp-sender parameters");const c={},u={};if(r instanceof Cr)switch(r._optimizationMode){case"motion":c.degradationPreference="maintain-framerate";break;case"detail":c.degradationPreference="maintain-resolution";break;default:c.degradationPreference="balanced"}if(oe("DSCP_TYPE")&&af()){var h;const E=oe("DSCP_TYPE");ct(h=["very-low","low","medium","high"]).call(h,E)&&(u.networkPriority=E)}const m=s.getParameters(),y=(o=m.encodings)===null||o===void 0?void 0:o[0];y&&Object.assign(y,u),Object.assign(m,c),x.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(m.encodings))),await s.setParameters(m)}async applySendEncodings(r,s){try{if(!Fn().supportSetRtpSenderParameters||r.length!==s.length)return;for(let o=0;o<r.length;o++){const c=r[o],u=s[o];c&&u&&await this.updateRtpSenderEncodings(u,c)}}catch{x.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,s){const o=qa(r);return s.forEach((c,u)=>{const h=c._mediaStreamTrack,m=o.mediaDescriptions.find(y=>y.attributes.mid===h.kind);m&&aS(m,c)}),Gm(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var s;(s=this.onFirstAudioReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var s;(s=this.onFirstVideoReceived)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var s;(s=this.onFirstAudioDecoded)===null||s===void 0||s.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,s,o)=>{var c;(c=this.onFirstVideoDecoded)===null||c===void 0||c.call(this,r,s,o)},this.statsFilter.onSelectedLocalCandidateChanged=(r,s)=>{var o;(o=this.onSelectedLocalCandidateChanged)===null||o===void 0||o.call(this,r,s)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,s)=>{var o;(o=this.onSelectedRemoteCandidateChanged)===null||o===void 0||o.call(this,r,s)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const s=this.remoteSDP.batchSend(r).map((u,h)=>{let{id:m,mslabel:y}=u;const{kind:E}=r[h];return new ht((S,R)=>{const P=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(m)))},1e4),D=G=>{const j=xn();if(j.name==="Safari"&&Number(j.version)===11&&G.track.id!==m&&G.streams[0].id===y){var B;const Y=G.streams[0].getTracks()[0];return(B=this.remoteSDP)===null||B===void 0||B.updateTrackLabel(E,m,G.track.id),this.peerConnection.removeEventListener("track",D),clearTimeout(P),void S({track:Y,id:m})}if(G.track.id===m)return this.peerConnection.removeEventListener("track",D),clearTimeout(P),void S({track:G.track,id:m})};this.peerConnection.addEventListener("track",D)})}),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(c),await ht.all(s)}catch(s){throw new Le(te.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const s=this.remoteSDP.getSSRC(r);return s==null?void 0:s[0].ssrcId}setConfiguration(r){if(Fn().supportPCSetConfiguration){const s=qw.resolvePCConfiguration(r);this.peerConnection.setConfiguration(s)}}},It(dr.prototype,"connect",[Fl],Object.getOwnPropertyDescriptor(dr.prototype,"connect"),dr.prototype),It(dr.prototype,"stopSending",[Fl],Object.getOwnPropertyDescriptor(dr.prototype,"stopSending"),dr.prototype),It(dr.prototype,"receive",[Fl],Object.getOwnPropertyDescriptor(dr.prototype,"receive"),dr.prototype),It(dr.prototype,"stopReceiving",[Fl],Object.getOwnPropertyDescriptor(dr.prototype,"stopReceiving"),dr.prototype),It(dr.prototype,"muteRemote",[Fl],Object.getOwnPropertyDescriptor(dr.prototype,"muteRemote"),dr.prototype),It(dr.prototype,"unmuteRemote",[Fl],Object.getOwnPropertyDescriptor(dr.prototype,"unmuteRemote"),dr.prototype),It(dr.prototype,"muteLocal",[Fl],Object.getOwnPropertyDescriptor(dr.prototype,"muteLocal"),dr.prototype),It(dr.prototype,"unmuteLocal",[Fl],Object.getOwnPropertyDescriptor(dr.prototype,"unmuteLocal"),dr.prototype),It(dr.prototype,"close",[Fl],Object.getOwnPropertyDescriptor(dr.prototype,"close"),dr.prototype),It(dr.prototype,"updateEncoderConfig",[Fl],Object.getOwnPropertyDescriptor(dr.prototype,"updateEncoderConfig"),dr.prototype),It(dr.prototype,"updateSendParameters",[Fl],Object.getOwnPropertyDescriptor(dr.prototype,"updateSendParameters"),dr.prototype),It(dr.prototype,"replaceTrack",[Fl],Object.getOwnPropertyDescriptor(dr.prototype,"replaceTrack"),dr.prototype),It(dr.prototype,"getRemoteSSRC",[Fl],Object.getOwnPropertyDescriptor(dr.prototype,"getRemoteSSRC"),dr.prototype),dr);function Fl(e,r,s){const o=e[r];if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this.mutex,u=await c.lock("Locking from P2PConnection.".concat(r));try{for(var h=arguments.length,m=new Array(h),y=0;y<h;y++)m[y]=arguments[y];return await o.apply(this,m)}finally{u()}},s}const Eye={name:"PlanBConnection",create:function(e){let{store:r,spec:s}=e;return new yye(s,r)}},vye={interceptLocalAudioFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Fn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(tP.has(e)||!e.track)return;const s={track:e.track};if(of()){if(!e.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),e.track&&e.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",o),s.track=e.track,s.track.addEventListener("ended",o));const y=r.metadata&&r.metadata();y?function(E,S){const{chunk:R,controller:P}=S,D=oe("ENABLE_AUDIO_PTS_METADATA")?df.AUDIO_64_BIT_PTS:df.METADATA;R.data=function(G,j,B){const Y=B.byteLength,ee=Y+IL+LG,fe=CL+RL+ee,ye=new ArrayBuffer(G.byteLength+fe),Ee=new DataView(ye);Ee.setUint8(0,xG),Ee.setUint16(1,ee),Ee.setUint8(3,j),Ee.setUint16(4,Y);for(let Ne=0;Ne<Y;Ne++)Ee.setUint8(6+Ne,B[Ne]);const _e=new Uint8Array(Ee.buffer);return _e.set(new Uint8Array(G),fe),_e.buffer}(R.data,D,E),P.enqueue(R)}(y,{chunk:h,controller:m}):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(As()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=eP(),u=new MessageChannel;await new ht(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-tx",port:u.port2},[u.port2]);e.transform=h,await new ht(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var y;if(m.data.transformed&&e.track&&((y=e.track)===null||y===void 0?void 0:y.id)!==s.track.id)x.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",o),s.track=e.track,s.track.addEventListener("ended",o);else if(m.data.getMetadata){const E=r.metadata&&r.metadata();E&&u.port1.postMessage({metadata:E})}},s.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=tP.get(e);if(c){tP.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}tP.set(e,s),e.track.addEventListener("ended",o)},interceptRemoteAudioFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Fn().supportWebRTCEncodedTransform)return void x.warning("browser not support audio encoded transform");if(aP.has(e))return;const s={track:e.track,onMetadata:r.onMetadata};if(of()){if(!e.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");jx(Hn.CHROME,87,116)||(r.enableTopn=!1);let c=null;try{c=e.createEncodedStreams()}catch(h){return void x.error("create audio-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),e.track&&e.track.id!==s.track.id&&(x.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",o),s.track=e.track,s.track.addEventListener("ended",o)),r.enableTopn?function(y,E,S){var R;const P=MG(new DataView(E.data));if(!P)return S.enqueue(E);const D=y.track.id;eme.set(D,y.track);const G=(R=P.tlv.find(ye=>ye.tag===df.AUDIO_LEVEL))===null||R===void 0?void 0:R.value;let j=0;typeof G=="number"&&(j=127-G);const B=Math.round(Math.pow(10,j/60)-1),{selected:Y,speaker:ee}=function(ye,Ee){let _e=eS.get(ye);if(_e||(_e=function(Ne){const Ze=new VG;return eS.set(Ne,Ze),Ad||(Ad=new Qfe(oe("TOPN_SILENCE_THRESHOLD")||500),Ad.on("ActiveSpeakerChanged",pt=>{pt!=null&&(iP=pt)})),Ad.addSpeakers([Ze]),Ze}(ye)),eS.size<=jG)return{selected:!0,speaker:_e};if(!Ad)throw new Error("no active speaker detector");return Ad.levelChanged(_e.id,Ee),q_=Ad.loudest.map(Ne=>Ne.id),iP&&!ct(q_).call(q_,iP)&&q_.length>=jG&&q_.pop(),{selected:ct(q_).call(q_,_e.id)||_e.id===iP,speaker:_e}}(y,B),fe=function(ye,Ee,_e){const Ne=Pd.get(ye)||new Zfe(ye,Ee);return Ne.score=_e,Pd.set(ye,Ne),function(Ze){if(sP.set(Ze,!0),!oP)return void(oP=Date.now());const pt=Date.now();pt-oP>1e3&&(sP.get(Ze)?sP.set(Ze,!1):(FG(Ze),sP.delete(Ze)),oP=pt)}(ye),Ne}(D,y.track,ee.energyScore);fe.addSample(Y),fe.active&&(E.data=P.frame.buffer,S.enqueue(E))}(e,h,m):r.enableMetadata?function(y,E,S){const R=MG(new DataView(y.data));if(!R)return E.enqueue(y);const P=R.tlv.find(D=>D.tag===df.METADATA||D.tag===df.AUDIO_64_BIT_PTS);P&&S&&P.value instanceof Uint8Array&&S(P.value),y.data=R.frame.buffer,E.enqueue(y)}(h,m,r.onMetadata):m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(As()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=eP(),u=new MessageChannel;await new ht(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"audio-metadata-rx",port:u.port2},[u.port2]);e.transform=h,await new ht(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var y;m.data.transformed&&e.track&&((y=e.track)===null||y===void 0?void 0:y.id)!==s.track.id?(x.debug("audio track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",o),s.track=e.track,s.track.addEventListener("ended",o)):m.data.metadata&&s.onMetadata&&s.onMetadata(m.data.metadata)},s.worker=c}function o(){e.track.removeEventListener("ended",o),function(c){const u=aP.get(c);if(u){(function(y){const E=eS.get(y);E&&(eS.delete(y),Ad&&(Ad.removeSpeakers([E]),eS.size===0&&(Ad.destroy(),Ad=null)))})(c),FG(c.track.id),aP.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(y){x.warning(y&&y.message)}}}(e)}aP.set(e,s),e.track.addEventListener("ended",o)},interceptLocalVideoFrame:async function(e,r){if(!Fn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(cP.has(e)||!e.track)return;const s={track:e.track};if(of()){if(!e.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(m){return void x.error("create video-encoded-streams error",m&&m.message)}const u=[];r.on("sei-to-send",m=>{u.push(m)});const h=new TransformStream({transform(m,y){s.controller||(s.controller=y),e.track&&e.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",o),s.track=e.track,s.track.addEventListener("ended",o));const E=u.shift();E&&(m.data=function(S,R){const P=function(ee){const fe=ee.length;let ye=[],Ee=0;for(;Ee<fe;)Ee+2<fe&&ee[Ee]===0&&ee[Ee+1]===0&&(ee[Ee+2]===0||ee[Ee+2]===1||ee[Ee+2]===2||ee[Ee+2]===3)?(ye.push(ee[Ee],ee[Ee+1],3,ee[Ee+2]),Ee+=3):(ye.push(ee[Ee]),Ee++);return new Uint8Array(ye)}(R),D=P.length,G=Math.floor(D/255),j=D%255,B=new Uint8Array(6+G+1+D+S.byteLength);B[0]=0,B[1]=0,B[2]=0,B[3]=1,B[4]=6,B[5]=101;let Y=0;for(;Y<G;)B[6+Y]=255,Y++;return B[6+Y]=j,Y++,B.set(P,6+Y),B.set(new Uint8Array(S),6+Y+D),B.buffer}(m.data,E)),y.enqueue(m)}});c.readable.pipeThrough(h).pipeTo(c.writable)}else{if(!As())return;{if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=eP(),u=new MessageChannel;await new ht(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-tx",port:u.port2},[u.port2]);e.transform=h,await new ht(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),r.on("sei-to-send",m=>{u.port1.postMessage({sei:m})}),u.port1.onmessage=m=>{var y;m.data.transformed&&e.track&&((y=e.track)===null||y===void 0?void 0:y.id)!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",o),s.track=e.track,s.track.addEventListener("ended",o))},s.worker=c}}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}const c=cP.get(e);if(c){cP.delete(e);try{var u,h;(u=c.controller)===null||u===void 0||u.terminate(),(h=c.worker)===null||h===void 0||h.terminate()}catch(m){x.warning(m&&m.message)}}}cP.set(e,s),e.track.addEventListener("ended",o)},interceptRemoteVideoFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Fn().supportWebRTCEncodedTransform)return void x.warning("browser not support video encoded transform");if(!e.track)return;if(PT.has(e)){const c=PT.get(e);return void(c&&(c.onSei=r.onSei))}const s={track:e.track,onSei:r.onSei};if(of()){if(!e.createEncodedStreams)return void x.warning("browser not support createEncodedStreams() API");let c=null;try{c=e.createEncodedStreams()}catch(h){return void x.error("create video-encoded-streams error",h&&h.message)}const u=new TransformStream({transform(h,m){s.controller||(s.controller=m),e.track&&e.track.id!==s.track.id&&(x.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",o),s.track=e.track,s.track.addEventListener("ended",o));const y=function(E){const S=new DataView(E.data);let R=0;for(;R+4<E.data.byteLength;){if(S.getUint8(R+0)===0&&S.getUint8(R+1)===0&&S.getUint8(R+2)===0&&S.getUint8(R+3)===1&&S.getUint8(R+4)===6){let P=R+6,D=0,G=0;for(;(G=S.getUint8(P++))===255;)D+=255;D+=G;const j=tme(E.data,P,D);return new Uint8Array(j)}R++}return null}(h);y&&s.onSei&&s.onSei(y),m.enqueue(h)}});c.readable.pipeThrough(u).pipeTo(c.writable)}else if(As()){if(typeof RTCRtpScriptTransform>"u")return void x.warning("browser not support RTCRtpScriptTransform");const c=eP(),u=new MessageChannel;await new ht(m=>c.onmessage=y=>{y.data==="registered"&&m(void 0)});const h=new RTCRtpScriptTransform(c,{name:"sei-rx",port:u.port2},[u.port2]);e.transform=h,await new ht(m=>c.onmessage=y=>{y.data==="started"&&m(void 0)}),u.port1.onmessage=m=>{var y;m.data.transformed&&e.track&&((y=e.track)===null||y===void 0?void 0:y.id)!==s.track.id?(x.debug("video track changed: ".concat(s.track.id," => ").concat(e.track.id)),s.track.removeEventListener("ended",o),s.track=e.track,s.track.addEventListener("ended",o)):m.data.sei&&s.onSei&&s.onSei(m.data.sei)},s.worker=c}function o(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",o)}(function(c){const u=PT.get(c);if(u){PT.delete(c);try{var h,m;(h=u.controller)===null||h===void 0||h.terminate(),(m=u.worker)===null||m===void 0||m.terminate()}catch(y){x.warning(y&&y.message)}}})(e)}PT.set(e,s),e.track.addEventListener("ended",o)}},Sye={name:"InterceptFrame",create:()=>vye};iL(),sr("PROCESS_ID","process-".concat(pr(8,""),"-").concat(pr(4,""),"-").concat(pr(4,""),"-").concat(pr(4,""),"-").concat(pr(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void x.error("Error loading sdk config",r.message)}if(e)try{const r=JSON.parse(window.atob(e)),s=Date.now();x.debug("Loading global parameters from cache",r),Object.keys(r).forEach(o=>{if(Object.prototype.hasOwnProperty.call(wr,o)){const{value:c,expires:u}=r[o];if(u&&u<=s)return;Id[o]=c,wr[o]=c}})}catch(r){x.error("Error loading mutableParamsCache: ".concat(e),r.message)}}(),Array.isArray(Id.AREAS)&&Id.AREAS.length>0&&YL(Id.AREAS,!0);const W7=(e,r,s)=>{x.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(r))),sr(e,r,s)};Xm(G_e,!1),Xm(K_e,!1),Xm(Rge,!1),Xm(iye,!1),Xm(B_e,!1),Xm(gye,!1),Xm(Eye,!1),Xm(Sye,!1);const Oi=function(e){const r=new jr,s=e,o={getListeners:r.getListeners.bind(r),on:(c,u)=>(function(h,m){h===kh.SECURITY_POLICY_VIOLATION&&T$(m,!0)}(c,u),r.on.bind(r)(c,u)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return b$(b$({},s),o)}({__TRACK_LIST__:Gv,VERSION:Dl,BUILD:aL,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:W7,getParameter:oe,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let r=new RTCPeerConnection;const s=await async function(o){let c;return Fn().supportUnifiedPlan?(o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"}),c=(await o.createOffer()).sdp):c=(await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,c}(r);if(!s)return e;r.close(),r=null,e=function(o){const c={video:[],audio:[]};return o.match(/ VP8/i)&&c.video.push("VP8"),o.match(/ VP9/i)&&c.video.push("VP9"),o.match(/ AV1/i)&&c.video.push("AV1"),o.match(/ H264/i)&&c.video.push("H264"),o.match(/ H265/i)&&c.video.push("H265"),o.match(/ opus/i)&&c.audio.push("OPUS"),o.match(/ PCMU/i)&&c.audio.push("PCMU"),o.match(/ PCMA/i)&&c.audio.push("PCMA"),o.match(/ G722/i)&&c.audio.push("G722"),c}(s)}catch(r){throw new Ae(te.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return e},checkSystemRequirements:function(){const e=Nt.reportApiInvoke(null,{name:Ai.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Hr.TRACER});let r=!1;try{const u=window.RTCPeerConnection,h=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,m=window.WebSocket;r=!!(u&&h&&m),r&&Wx()&&Gz(75)&&new u().close()}catch(u){return x.error("check system requirement failed: ",u),!1}let s=!1;const o=xn();o.name===Hn.CHROME&&Number(o.version)>=58&&(Cd.engine.name!=="WebKit"||function(){const u=xn();if(UA()){if(u.os===Yi.MAC_OS)return!0;if(u.os===Yi.IOS){const h=Cd.os.version&&Cd.os.version.split(".");if(h&&Number(h[0])===14&&h[1]&&Number(h[1])>=3||h&&Number(h[0])>14)return!0}}return!1}())&&(s=!0),(o.name===Hn.FIREFOX&&Number(o.version)>=56||o.name===Hn.OPERA&&Number(o.version)>=45||o.name===Hn.SAFARI&&Number(o.version)>=11||o.name==="WebKit"&&(Ho()||wu())&&o.osVersion&&Number(o.osVersion.split(".")[0])>=11||Xz()||xn().name===Hn.QQ)&&(s=!0),x.debug("checkSystemRequirements, api:",r,"browser",s);const c=r&&s;return e.onSuccess(c),c},getDevices:function(e){return sl.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return sl.getRecordingDevices(e)},getCameras:function(e){return sl.getCamerasDevices(e)},getElectronScreenSources:GW,getPlaybackDevices:function(e){return sl.getSpeakers(e)},createClient:function(){var e;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const s=pr(5,"client-"),o=Nt.reportApiInvoke(null,{id:s,name:Ai.CREATE_CLIENT,options:[r],tag:Hr.TRACER});try{(function(c){Wi(c.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Wi(c.mode,"config.mode",["rtc","live","p2p"]),c.audioCodec!==void 0&&Wi(c.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),c.proxyServer!==void 0&&hs(c.proxyServer,"config.proxyServer",1,1e4),c.turnServer!==void 0&&iW(c.turnServer),c.httpRetryConfig!==void 0&&rW(c.httpRetryConfig),c.websocketRetryConfig!==void 0&&rW(c.websocketRetryConfig)})(r)}catch(c){throw o.onError(c),c}return($z(16,0)||Kz(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",x.debug("browser not support vp9, force use vp8")),sr("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),o.onSuccess(),new Ige(Nu(Nu({forceWaitGatewayResponse:!0},r),{},{role:ct(e=["rtc","p2p"]).call(e,r.mode)?"host":r.role||"audience"}),s)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=oe("CAMERA_CAPTURE_CONFIG"),s=pr(8,"track-cam-"),o=Nt.reportApiInvoke(null,{id:s,tag:Hr.TRACER,name:Ai.CREATE_CAM_VIDEO_TRACK,options:[Mr({},e),r]});r&&(e.encoderConfig=r);const c=QA(e);let u=null;x.info("start create camera video track with config",JSON.stringify(e),"trackId",s);try{u=(await il({video:c},s)).getVideoTracks()[0]||null}catch(m){throw o.onError(m),m}if(!u){const m=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(m),m.throw(x)}e.optimizationMode&&wL(s,u,e,Ah(e.encoderConfig));const h=new TL(u,e,c,e.scalabiltyMode?qA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,s);return o.onSuccess(h.getTrackId()),x.info("create camera video success, trackId:",s),h},createCustomVideoTrack:function(e){const r=pr(8,"track-cus-"),s=Nt.reportApiInvoke(null,{id:r,tag:Hr.TRACER,name:Ai.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),o=new Cr(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?qA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[fr.CUSTOM_TRACK]);return s.onSuccess(o.getTrackId()),x.info("create custom video track success with config",e,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const s=typeof r=="object"?function(P){return e8(P)}(r):void 0;s&&(r="auto");const o=pr(8,"track-scr-v-"),c=Nt.reportApiInvoke(null,{id:o,tag:Hr.TRACER,name:Ai.CREATE_SCREEN_VIDEO_TRACK,options:[Mr({},e),r]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const u=function(P){const D={};P.screenSourceType&&(D.mediaSource=P.screenSourceType),P.extensionId&&of()&&(D.extensionId=P.extensionId);const{displaySurface:G,selfBrowserSurface:j,surfaceSwitching:B,systemAudio:Y,preferCurrentTab:ee}=P;(yT(107)||Fx(107)||Bx(93))&&(G&&(Wi(G,"displaySurface",["browser","window","monitor"]),D.displaySurface=G),j?(Wi(j,"selfBrowserSurface",["exclude","include"]),D.selfBrowserSurface=j):D.selfBrowserSurface="include",B&&(Wi(B,"surfaceSwitching",["exclude","include"]),D.surfaceSwitching=B)),(yT(105)||Fx(105)||Bx(91))&&Y&&(Wi(Y,"systemAudio",["exclude","include"]),D.systemAudio=Y),(yT(94)||Fx(94)||Bx(80))&&ee&&(D.preferCurrentTab=!0),P.electronScreenSourceId&&(D.sourceId=P.electronScreenSourceId);const fe=P.encoderConfig?hL(P.encoderConfig):null;return D.mandatory={chromeMediaSource:"desktop",maxWidth:fe?fe.width:void 0,maxHeight:fe?fe.height:void 0},fe&&(fe.frameRate&&(typeof fe.frameRate=="number"?(D.mandatory.maxFrameRate=fe.frameRate,D.mandatory.minFrameRate=fe.frameRate):(D.mandatory.maxFrameRate=fe.frameRate.max||fe.frameRate.ideal||fe.frameRate.exact||void 0,D.mandatory.minFrameRate=fe.frameRate.min||fe.frameRate.ideal||fe.frameRate.exact||void 0),D.frameRate=fe.frameRate),fe.width&&(D.width=fe.width),fe.height&&(D.height=fe.height)),D}(e);let h=null,m=null;const y=Fn();if(!y.supportShareAudio&&r==="enable"){const P=new Le(te.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return c.onError(P),P.throw(x)}x.info("start create screen video track with config",e,"withAudio",r,"trackId",o);const E=y.supportShareAudio&&r!=="disable";try{const P=await il({screen:u,screenAudio:E?s||!0:void 0},o);h=P.getVideoTracks()[0]||null,m=P.getAudioTracks()[0]||null}catch(P){throw c.onError(P),P}if(!h){const P=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return c.onError(P),P.throw(x)}if(!m&&r==="enable"){h&&h.stop();const P=new Le(te.SHARE_AUDIO_NOT_ALLOWED);return c.onError(P),P.throw(x)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(wL(o,h,e,e.encoderConfig&&hL(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const S=new Cr(h,e.encoderConfig?hL(e.encoderConfig):{},e.scalabiltyMode?qA(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[fr.SCREEN_TRACK]);if(!m)return c.onSuccess(S.getTrackId()),x.info("create screen video track success","video:",S.getTrackId()),S;const R=new Xr(m,void 0,pr(8,"track-scr-a-"),!1);return c.onSuccess([S.getTrackId(),R.getTrackId()]),x.info("create screen video track success","video:",S.getTrackId(),"audio:",R.getTrackId()),[S,R]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=oe("CAMERA_CAPTURE_CONFIG"),o=pr(8,"track-mic-"),c=pr(8,"track-cam-"),u=Nt.reportApiInvoke(null,{id:"".concat(o,"-").concat(c),tag:Hr.TRACER,name:Ai.CREATE_MIC_AND_CAM_TRACKS,options:[e,r,s]});s&&(r.encoderConfig=s);const h=QA(r),m=t8(e);let y=null,E=null;x.info("start create camera video track(".concat(c,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(r)));try{const P=await il({audio:m,video:h},"".concat(o,"-").concat(c));y=P.getAudioTracks()[0],E=P.getVideoTracks()[0]}catch(P){throw u.onError(P),P}if(!y||!E){const P=new Le(te.UNEXPECTED_ERROR,"can not find tracks in media stream");return u.onError(P),P.throw(x)}r.optimizationMode&&wL(c,E,r,Ah(r.encoderConfig));const S=new ZA(y,e,m,o),R=new TL(E,r,h,r.scalabiltyMode?qA(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,c);return u.onSuccess([S.getTrackId(),R.getTrackId()]),x.info("create camera video track(".concat(c,") and microphone audio track(").concat(o,") success")),[S,R]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=pr(8,"track-mic-"),s=Nt.reportApiInvoke(null,{id:r,tag:Hr.TRACER,name:Ai.CREATE_MIC_AUDIO_TRACK,options:[e]}),o=t8(e);let c=null;x.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{c=(await il({audio:o},r)).getAudioTracks()[0]||null}catch(h){throw s.onError(h),h}if(!c){const h=new Le(te.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(h),h.throw(x)}const u=new ZA(c,e,o,r);return s.onSuccess(u.getTrackId()),x.info("create microphone audio track success, trackId:",r),u},createCustomAudioTrack:function(e){const r=pr(8,"track-cus-"),s=Nt.reportApiInvoke(null,{id:r,tag:Hr.TRACER,name:Ai.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),o=new Xr(e.mediaStreamTrack,e.encoderConfig?YA(e.encoderConfig):{},r,!1);return x.info("create custom audio track success with config",e,"trackId",o.getTrackId()),s.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(e){var r;const{cacheOnlineFile:s,encoderConfig:o}=e;let{source:c}=e;const u={source:c instanceof AudioBuffer?"AudioBuffer":c instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":c,cacheOnlineFile:s,encoderConfig:o},h=pr(8,"track-buf-"),m=Nt.reportApiInvoke(null,{id:h,tag:Hr.TRACER,name:Ai.CREATE_BUFFER_AUDIO_TRACK,options:[u]});if(oe("DISABLE_WEBAUDIO"))throw new Le(te.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");x.info("start create buffer source audio track with config",JSON.stringify(u),"trackId",h);const y=c;if(!(c instanceof AudioBuffer))try{c=await async function(R,P){let D=null;if(typeof R=="string"){const j=B8.get(R);if(j)return x.debug("use cached audio resource: ",R),j;try{D=(await Rd(()=>_a.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(B){throw new Le(te.FETCH_AUDIO_FILE_FAILED,B.toString())}}else D=await new ht((B,Y)=>{const ee=new FileReader;ee.onload=fe=>{fe.target?B(fe.target.result):Y(new Le(te.READ_LOCAL_AUDIO_FILE_ERROR))},ee.onerror=()=>{Y(new Le(te.READ_LOCAL_AUDIO_FILE_ERROR))},ee.readAsArrayBuffer(R)});const G=await function(j){const B=Xv();return new ht((Y,ee)=>{B.decodeAudioData(j,fe=>{Y(fe)},fe=>{ee(new Le(te.DECODE_AUDIO_FILE_FAILED,fe.toString()))})})}(D);return typeof R=="string"&&P&&B8.set(R,G),G}(c,s)}catch(R){return m.onError(R),R.throw(x)}const E=new Kfe(c),S=new $fe(y,E,o?YA(o):{},h);return x.info("create buffer source audio track success, trackId:",h),m.onSuccess(S.getTrackId()),S},setAppType:function(e){if(x.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw x.debug("Invalid appType"),new Ae(te.INVALID_PARAMS,"invalid app type",e);sr("APP_TYPE",Math.floor(e))},setLogLevel:function(e){x.setLogLevel(e)},enableLogUpload:function(){oe("USE_NEW_LOG")?sr("UPLOAD_LOG",!0):x.enableLogUpload()},disableLogUpload:function(){oe("USE_NEW_LOG")?sr("UPLOAD_LOG",!1):x.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new B9},checkAudioTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Nt.reportApiInvoke(null,{tag:Hr.TRACER,name:Ai.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof Xr||e instanceof Zv)){const y=new Ae(te.INVALID_TRACK,"the parameter is not a audio track");return s.onError(y),y.throw()}r&&r<1e3&&(r=1e3);const o=e instanceof Xr?e.getTrackLabel():"remote_track",c=e.getVolumeLevel();let u=c,h=c;const m=Date.now();return new ht(y=>{const E=setInterval(()=>{const S=e.getVolumeLevel();u=S>u?S:u,h=S<h?S:h;const R=u-h>1e-4,P=Date.now()-m;if(R||P>r){clearInterval(E);const D=R,G={duration:P,deviceLabel:o,maxVolumeLevel:u,result:D};x.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(G))),s.onSuccess(G),y(D)}},200)})},checkVideoTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const s=Nt.reportApiInvoke(null,{tag:Hr.TRACER,name:Ai.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof Cr||e instanceof Qv)){const R=new Ae(te.INVALID_TRACK,"the parameter is not a video track");return s.onError(R),R.throw()}r&&r<1e3&&(r=1e3);const o=e instanceof Cr?e.getTrackLabel():"remote_track",c=e.getMediaStreamTrack(!0),u=document.createElement("video");u.style.width="1px",u.style.height="1px",u.setAttribute("muted",""),u.muted=!0,u.setAttribute("playsinline",""),u.controls=!1,(As()||UA())&&(u.style.opacity="0.01",u.style.position="fixed",u.style.left="0",u.style.top="0",document.body.appendChild(u)),u.srcObject=new MediaStream([c]),u.play();const h=document.createElement("canvas");h.width=160,h.height=120;let m=0,y=0;try{const R=Date.now();m=await function(P,D,G,j){let B,Y=0,ee=null;return new ht((fe,ye)=>{function Ee(){Y>j&&B&&(B(),fe(Y));const _e=G.getContext("2d");if(!_e){const pt=new Ae(te.UNEXPECTED_ERROR,"can not get canvas 2d context.");return x.error(pt.toString()),void ye(pt)}_e.drawImage(P,0,0,160,120);const Ne=_e.getImageData(0,0,G.width,G.height),Ze=Math.floor(Ne.data.length/3);if(ee){for(let pt=0;pt<Ze;pt+=3)if(Ne.data[pt]!==ee[pt])return Y+=1,void(ee=Ne.data);ee=Ne.data}else ee=Ne.data}setTimeout(()=>{B&&(B(),fe(Y))},D),B=_L(()=>{Ee()},30)})}(u,r,h,4),y=Date.now()-R}catch(R){throw s.onError(R),R}hge===Hn.SAFARI&&(u.pause(),u.remove()),u.srcObject=null;const E=m>4,S={duration:y,changedPicNum:m,deviceLabel:o,result:E};return x.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(S))),s.onSuccess(S),E},setArea:YL,audioElementPlayCenter:ya,resumeAudioContext:function(){ya.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){Pge.processExternalMediaAEC(e)},registerExtensions:function(e){const r=oe("PLUGIN_INFO")||[];e.forEach(s=>{"name"in s&&!ct(r).call(r,s.name)&&r.push(s.name);const o=s;o.__registered__=!0,o.logger.hookLog=x.extLog,o.reporter.hookApiInvoke=Nt.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(c=>{o.parameters[c]=oe(c)})}),W7("PLUGIN_INFO",r)},ChannelMediaRelayError:nS,ChannelMediaRelayEvent:pf,ChannelMediaRelayState:Ya,RemoteStreamFallbackType:jfe,RemoteStreamType:Vfe,ConnectionDisconnectedReason:Yn,AudienceLatencyLevelType:mfe,AREAS:$n,preload:async function(e,r,s,o){return fH(e,r,s,o)}});return Object.defineProperties(Oi,{onAudioAutoplayFailed:{get:()=>ol.onAudioAutoplayFailed,set:e=>{ol.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>ol.onAutoplayFailed,set:e=>{ol.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Oi._onSecurityPolicyViolation,set(e){Oi._onSecurityPolicyViolation=e,T$(e)}},__CLIENT_LIST__:{get:()=>oe("SHOW_GLOBAL_CLIENT_LIST")?Y_:[]}}),sl.on(H_.CAMERA_DEVICE_CHANGED,e=>{x.info("camera device changed",JSON.stringify(e)),Oi.onCameraChanged&&Oi.onCameraChanged(e),Oi.safeEmit(kh.CAMERA_CHANGED,e)}),sl.on(H_.RECORDING_DEVICE_CHANGED,e=>{x.info("microphone device changed",JSON.stringify(e)),Oi.onMicrophoneChanged&&Oi.onMicrophoneChanged(e),Oi.safeEmit(kh.MICROPHONE_CHANGED,e)}),sl.on(H_.PLAYOUT_DEVICE_CHANGED,e=>{x.debug("playout device changed",JSON.stringify(e)),Oi.onPlaybackDeviceChanged&&Oi.onPlaybackDeviceChanged(e),Oi.safeEmit(kh.PLAYBACK_DEVICE_CHANGED,e)}),ya.onAutoplayFailed=()=>{x.info("detect audio element autoplay failed"),ol.onAudioAutoplayFailed&&ol.onAudioAutoplayFailed()},or.on("autoplay-failed",()=>{x.info("detect webaudio autoplay failed"),ol.onAudioAutoplayFailed&&ol.onAudioAutoplayFailed(),Oi.safeEmit(kh.AUTOPLAY_FAILED)}),or.on(ms.STATE_CHANGE,(e,r)=>{x.info("audio context state changed: ".concat(r," => ").concat(e)),Oi.onAudioContextStateChanged&&Oi.onAudioContextStateChanged(e,r),Oi.safeEmit(kh.AUDIO_CONTEXT_STATE_CHANGED,e,r)}),yi.on(Vv.NETWORK_STATE_CHANGE,(e,r)=>{x.info("[network-indicator] network state changed, ".concat(r," => ").concat(e))}),window&&(window.__ARTC__=Oi),Oi})}(_k)),_k.exports}var kWe=OWe();const GC=Fg(kWe),NWe="9442a472625f44e7b2c5065b9f9b3988",DWe=GC.createClient({mode:"rtc",codec:"vp8"});let Pw=null;const Noe=N.createContext(null),Doe=({children:n,appId:t=NWe,channel:i=null,token:a=null,uid:l=null,enabled:d=!0,startMuted:f=!0,onClientReady:_=()=>{}})=>{const[v,b]=N.useState(!1),[C,I]=N.useState(!1),[O,L]=N.useState([]),[M,F]=N.useState(null),[z,Z]=N.useState(null),[K,re]=N.useState(null),[ae,ne]=N.useState(!1),[pe,X]=N.useState(!1),[J,Q]=N.useState(!1),[se,de]=N.useState(null),[he,le]=N.useState(!1),Oe=Na(),Ve=N.useRef(DWe),xe=N.useRef({appId:t,channel:i,uid:l,enabled:d}),Re=N.useRef(!1),ve=N.useRef(null);N.useRef(null),N.useEffect(()=>{xe.current={appId:t,channel:i,uid:l,enabled:d}},[t,i,l,d]),N.useEffect(()=>{Z(i)},[i]),N.useEffect(()=>{if(!Ve.current)return;const $e=it=>{$.log(`Connection state changed to: ${it}`),it==="DISCONNECTED"?(b(!1),$.log("Disconnected from Agora")):it==="CONNECTED"&&(b(!0),F(null))};return Ve.current.on("connection-state-change",$e),()=>{Ve.current.off("connection-state-change",$e)}},[]),N.useEffect(()=>{if(!i||!d)return;const $e=async(He,lt)=>{$.log(`User published: ${He.uid}, mediaType: ${lt}`);try{await Ve.current.subscribe(He,lt),lt==="audio"&&He.audioTrack.play(),L(mt=>mt.some(Lt=>Lt.uid===He.uid)?mt:[...mt,He])}catch(mt){$.error("Error subscribing to user:",mt)}},it=(He,lt)=>{$.log(`User unpublished: ${He.uid}, mediaType: ${lt}`),lt==="audio"&&He.audioTrack&&He.audioTrack.stop()},Je=He=>{$.log(`User joined: ${He.uid}`),L(lt=>lt.some(mt=>mt.uid===He.uid)?lt:[...lt,He])},Ct=He=>{$.log(`User left: ${He.uid}`),L(lt=>lt.filter(mt=>mt.uid!==He.uid))};return Ve.current.on("user-published",$e),Ve.current.on("user-unpublished",it),Ve.current.on("user-joined",Je),Ve.current.on("user-left",Ct),(async()=>{if(Re.current){$.log("Already initializing, skipping duplicate initialization");return}Re.current=!0;try{if(v&&ve.current===i){$.log(`Already joined to channel ${i}`),ne(!0),_(Ve.current);return}if(Ve.current.connectionState==="CONNECTING"||Ve.current.connectionState==="CONNECTED")if(ve.current&&ve.current!==i){$.log("Connected to different channel, leaving first");try{await Pe()}catch(He){$.error("Error leaving channel:",He)}}else{b(!0),ne(!0),ve.current=i,Pw=i,_(Ve.current);return}$.log(`Joining channel ${i}`),await ze(),$.log("Join channel completed")}catch(He){$.error("Error during initialization:",He)}finally{Re.current=!1}})(),()=>{$.log("Cleaning up event listeners"),Ve.current.off("user-published",$e),Ve.current.off("user-unpublished",it),Ve.current.off("user-joined",Je),Ve.current.off("user-left",Ct)}},[i,d,l,_,v]);const be=async()=>{if(!d||K)return K;$.log("Initializing microphone");try{const $e=await GC.createMicrophoneAudioTrack();return await $e.setMuted(f),re($e),$.log("Microphone initialized successfully"),$e}catch($e){return $.error("Error initializing microphone:",$e),F("Failed to initialize microphone. Please check your permissions."),null}};N.useEffect(()=>{(async()=>{if(i)try{const Ct=await Gu(i);Ct&&Ct.voiceDisabled?($.log("Voice is disabled for this space"),le(!0),v&&await Pe()):le(!1)}catch(Je){$.error("Error checking if voice is disabled:",Je)}})();const it=Je=>{Je.detail&&typeof Je.detail.voiceDisabled=="boolean"&&($.log("Voice setting changed:",Je.detail.voiceDisabled),le(Je.detail.voiceDisabled),Je.detail.voiceDisabled&&v?Pe():!Je.detail.voiceDisabled&&!v&&d&&i&&ze())};return window.addEventListener("SpaceVoiceSettingChanged",it),()=>{window.removeEventListener("SpaceVoiceSettingChanged",it)}},[i,v,d]);const ze=async()=>{if(!d)return $.log("Agora is disabled, not joining channel"),!1;if(he)return $.log("Voice is disabled for this space, not joining channel"),F("Voice chat is disabled for this space"),!1;if(!i)return $.error("AgoraProvider: No channel specified"),F("No channel specified"),!1;if($.log(`joinChannel called for channel ${i} with UID ${l}`),$.log("Current state:",{isJoined:v,isJoining:pe,connectionState:Ve.current.connectionState,joinedChannel:ve.current}),v&&ve.current===i)return $.log(`Already joined to channel: ${i}`),!0;if(pe)return $.log("AgoraProvider: Already in the process of joining"),!1;if(Ve.current.connectionState==="CONNECTED")if(ve.current&&ve.current!==i){$.log("Connected to different channel, leaving first");try{await Pe()}catch($e){$.error("Error leaving channel:",$e)}}else return $.log("Client already connected, setting joined state to true"),b(!0),ne(!0),ve.current=i,Pw=i,_(Ve.current),!0;if(Ve.current.connectionState==="CONNECTING")return $.log("Client already connecting, waiting for connection"),X(!0),new Promise($e=>{const it=setInterval(()=>{Ve.current.connectionState==="CONNECTED"&&(clearInterval(it),b(!0),X(!1),ne(!0),ve.current=i,Pw=i,_(Ve.current),$e(!0))},500);setTimeout(()=>{clearInterval(it),$.log("AgoraProvider: Connection timeout, considering join failed"),X(!1),$e(!1)},1e4)});try{if($.log(`Joining channel: ${i} with UID: ${l||"random"}`),$.log(`Using appId: ${t}, Type: ${typeof t}, Length: ${t.length}`),!t||t.trim()===""){const it="AgoraProvider: App ID is empty or invalid";return $.error(it),F(it),X(!1),!1}X(!0);const $e=l||Math.floor(Math.random()*1e6);return await Ve.current.join(t,i,a,$e),$.log(`Joined channel successfully with UID: ${Ve.current.uid}`),b(!0),X(!1),ne(!0),ve.current=i,Pw=i,_(Ve.current),!0}catch($e){return $.error("Error joining channel:",$e),F(`Error joining channel: ${$e.toString()}`),X(!1),!1}},Pe=async()=>{if(v)try{K&&await Ve.current.unpublish(K),await Ve.current.leave(),Pw=null,ve.current=null,$.log("Left channel successfully"),b(!1),L([])}catch($e){$.error("Error leaving channel:",$e),F($e.message||"Failed to leave channel")}};N.useEffect(()=>()=>{K&&K.close()},[]),N.useEffect(()=>{d&&i&&(!v||ve.current!==i)&&ze()},[d,i,v]);const we=()=>{if(!K)return!1;try{return K.isActive&&!K.muted}catch($e){return $.error("Error checking microphone status:",$e),!1}};N.useEffect(()=>{const $e=()=>{const Je=we();Je!==C&&($.log("Syncing microphone state:",{actualStatus:Je,currentState:C}),I(Je),window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:Je}})),window.agoraClient&&(window.agoraClient.isVoiceEnabled=Je,window.agoraClient.microphoneTrack=K))};K&&$e();const it=setInterval($e,1e3);return()=>{clearInterval(it)}},[K,C]);const ke=async()=>{var $e;if(he)return $.log("Voice is disabled for this space, cannot toggle"),Oe({title:"Voice Chat Disabled",description:"Voice chat has been disabled for this space by the owner.",status:"info",duration:3e3,isClosable:!0}),!1;try{const it=C!==void 0?C:K?!K.muted:!1;if($.log("AgoraProvider: Toggling voice, current state:",{isVoiceEnabled:C,currentState:it,hasMicTrack:!!K,trackMuted:K==null?void 0:K.muted}),!K&&($.log("AgoraProvider: No microphone track, initializing..."),!await be()))return $.error("AgoraProvider: Failed to initialize microphone"),it;const Je=!it;if($.log("AgoraProvider: New voice state will be:",Je),it){if(K)try{$.log("AgoraProvider: Muting microphone track"),await K.setMuted(!0),K.muted||($.warn("AgoraProvider: Track not muted after setMuted(true), trying again"),await K.setEnabled(!1)),$.log("AgoraProvider: Microphone track muted successfully, muted state:",K.muted)}catch(Ct){return $.error("Error muting track:",Ct),it}}else if(K)try{Ve.current&&v&&!(($e=Ve.current.localTracks)!=null&&$e.includes(K))&&($.log("AgoraProvider: Publishing microphone track"),await Ve.current.publish(K),$.log("AgoraProvider: Microphone track published successfully")),$.log("AgoraProvider: Unmuting microphone track"),await K.setMuted(!1),K.muted&&($.warn("AgoraProvider: Track still muted after setMuted(false), trying again"),await K.setEnabled(!0)),$.log("AgoraProvider: Microphone track unmuted successfully, muted state:",K.muted)}catch(Ct){return $.error("Error unmuting track:",Ct),it}return I(Je),Je}catch(it){return $.error("Error toggling voice:",it),C}},Ue=async $e=>{try{re($e),$.log("Microphone track updated successfully")}catch(it){throw $.error("Error updating microphone track:",it),it}},Be=async()=>{if(!Ve.current||!i)return $.error("AgoraProvider: Voice chat not connected"),!1;try{if(J)return $.log("AgoraProvider: Stopping screen share"),se&&(Array.isArray(se)?(await Ve.current.unpublish(se),se.forEach($e=>$e.close())):(await Ve.current.unpublish(se),se.close()),de(null)),Q(!1),$.log("AgoraProvider: Screen sharing stopped"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}}))),!1;$.log("AgoraProvider: Starting screen share");try{const $e=await GC.createScreenVideoTrack({encoderConfig:"1080p_1",optimizationMode:"detail"});return $.log("AgoraProvider: Screen track created:",$e),$e.on("track-ended",()=>{$.log("AgoraProvider: Screen sharing ended by browser UI"),Ve.current.unpublish($e),$e.close(),de(null),Q(!1),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!1,window.agoraClient.screenTrack=null,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!1}})))}),await Ve.current.publish($e),de($e),Q(!0),$.log("AgoraProvider: Screen sharing started"),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isScreenSharing=!0,window.agoraClient.screenTrack=$e,window.dispatchEvent(new CustomEvent("ScreenShareToggled",{detail:{enabled:!0}}))),!0}catch($e){return $.error("AgoraProvider: Error creating screen track:",$e),Q(!1),de(null),!1}}catch($e){return $.error("AgoraProvider: Error toggling screen share:",$e),Q(!1),de(null),!1}};N.useEffect(()=>{if($.log("AgoraProvider: Initializing window.agoraClient"),typeof window<"u"){window.agoraClient={isVoiceEnabled:!1,isJoined:!1,client:Ve.current,isScreenSharing:!1,screenTrack:null};const $e=Je=>{$.log("AgoraProvider: Received ToggleScreenShare event"),Be().then(Ct=>{Je.detail&&Je.detail.callback&&Je.detail.callback(!0,Ct)}).catch(Ct=>{$.error("AgoraProvider: Error handling ToggleScreenShare event:",Ct),Je.detail&&Je.detail.callback&&Je.detail.callback(!1,J)})},it=Je=>{$.log("AgoraProvider: Received JoinVoiceChat event"),ze().then(Ct=>{Je.detail&&Je.detail.callback&&Je.detail.callback(Ct)}).catch(Ct=>{$.error("AgoraProvider: Error handling JoinVoiceChat event:",Ct),Je.detail&&Je.detail.callback&&Je.detail.callback(!1)})};return window.addEventListener("ToggleScreenShare",$e),window.addEventListener("JoinVoiceChat",it),()=>{window.removeEventListener("ToggleScreenShare",$e),window.removeEventListener("JoinVoiceChat",it),typeof window<"u"&&window.agoraClient&&($.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}}return()=>{typeof window<"u"&&window.agoraClient&&($.log("AgoraProvider: Cleaning up window.agoraClient"),window.agoraClient=null)}},[]),N.useEffect(()=>{$.log("AgoraProvider: Voice enabled state changed:",C),typeof window<"u"&&(window.agoraClient||(window.agoraClient={}),window.agoraClient.isVoiceEnabled=C,window.agoraClient.microphoneTrack=K,window.agoraClient.client=Ve.current,window.dispatchEvent(new CustomEvent("VoiceToggled",{detail:{enabled:C}})),$.log("AgoraProvider: Updated window.agoraClient and dispatched event:",{isVoiceEnabled:C}))},[C,K]);const qe={client:Ve.current,isJoined:v,isVoiceEnabled:C,users:O,error:M,channel:z,appId:t,toggleVoice:ke,leaveChannel:Pe,joinChannel:ze,microphoneTrack:K,isReady:ae,createMicrophoneTrack:Ue,isScreenSharing:J,screenTrack:se,toggleScreenShare:Be,voiceDisabled:he};return T.jsx(Noe.Provider,{value:qe,children:n})},xoe=()=>{const n=N.useContext(Noe);if(!n)throw new Error("useAgoraContext must be used within an AgoraProvider");return n};Doe.propTypes={children:Sn.node.isRequired,appId:Sn.string.isRequired,channel:Sn.string.isRequired,token:Sn.string,uid:Sn.oneOfType([Sn.string,Sn.number])};const xWe=()=>{var Re,ve;const{client:n,isVoiceEnabled:t,isJoined:i,users:a,error:l,microphoneTrack:d,isReady:f,channel:_,appId:v,toggleVoice:b,joinChannel:C,leaveChannel:I,createMicrophoneTrack:O,isScreenSharing:L,screenTrack:M,toggleScreenShare:F,voiceDisabled:z}=xoe(),[Z,K]=N.useState(t!==void 0?t:((Re=window.agoraClient)==null?void 0:Re.isVoiceEnabled)||!1),[re,ae]=N.useState(L!==void 0?L:((ve=window.agoraClient)==null?void 0:ve.isScreenSharing)||!1),[ne,pe]=N.useState(z!==void 0?z:!1),[X,J]=N.useState(!0);N.useEffect(()=>{var be;t!==void 0?K(t):((be=window.agoraClient)==null?void 0:be.isVoiceEnabled)!==void 0?K(window.agoraClient.isVoiceEnabled):d&&K(!d.muted)},[t,d]),N.useEffect(()=>{var be;L!==void 0?ae(L):((be=window.agoraClient)==null?void 0:be.isScreenSharing)!==void 0&&ae(window.agoraClient.isScreenSharing)},[L]),N.useEffect(()=>{z!==void 0&&pe(z)},[z]);const Q=N.useRef({isVoiceEnabled:Z,isScreenSharing:re,isJoined:i,users:a,error:l,isReady:f,channel:_,appId:v,voiceDisabled:ne});N.useEffect(()=>{Q.current={isVoiceEnabled:Z,isScreenSharing:re,isJoined:i,users:a,error:l,isReady:f,channel:_,appId:v,voiceDisabled:ne}},[Z,re,i,a,l,f,_,v,ne]),N.useEffect(()=>{const be=setTimeout(()=>{J(!1)},5e3);return()=>clearTimeout(be)},[]),N.useEffect(()=>{f&&J(!1)},[f]),N.useEffect(()=>{console.log("useVoiceChat context:",{contextIsVoiceEnabled:t,localVoiceEnabled:Z,contextIsScreenSharing:L,localScreenSharing:re,isJoined:i,users:a.length,error:l,isReady:f,channel:_,appId:v,hasMicrophoneTrack:!!d,trackMuted:d==null?void 0:d.muted,hasScreenTrack:!!M})},[t,Z,L,re,i,a,l,f,_,v,d,M]);const se=async()=>{try{console.log("useVoiceChat: Toggling voice from:",Z);const be=await b();if(console.log("useVoiceChat: Toggle result:",be),be!==void 0)K(be);else{const ze=!Z;K(ze),window.agoraClient&&(window.agoraClient.isVoiceEnabled=ze)}return be!==void 0?be:!Z}catch(be){return console.error("useVoiceChat: Error toggling voice:",be),Z}},de=async()=>{try{console.log("useVoiceChat: Toggling screen share from:",re);const be=await F();if(console.log("useVoiceChat: Screen share toggle result:",be),be!==void 0)ae(be);else{const ze=!re;ae(ze),window.agoraClient&&(window.agoraClient.isScreenSharing=ze)}return be!==void 0?be:!re}catch(be){return console.error("useVoiceChat: Error toggling screen share:",be),re}},he=async()=>{Z&&d&&await se()},le=async()=>{!Z&&d&&await se()},Oe=be=>a.some(ze=>{var Pe;return ze.uid===be&&((Pe=ze.audioTrack)==null?void 0:Pe.isPlaying)}),Ve=N.useCallback(()=>{if(!d||!Z)return 0;try{return d.getVolumeLevel()}catch(be){return console.error("Error getting volume level:",be),0}},[d,Z]);return{isVoiceEnabled:Z,isScreenSharing:re,isJoined:i,users:a,error:l,toggleVoice:se,toggleScreenShare:de,mute:he,unmute:le,isUserSpeaking:Oe,getVolumeLevel:Ve,microphoneTrack:d,screenTrack:M,isLoading:X,channel:_,appId:v,joinChannel:C,leaveChannel:I,client:n,setMicrophoneDevice:async be=>{try{if(!be){console.error("No device ID provided");return}if(!n||!i){console.error("Client not initialized or not joined to a channel");return}d&&(Z&&await n.unpublish(d),await d.close());const ze=await GC.createMicrophoneAudioTrack({microphoneId:be,encoderConfig:"music_standard"});O&&await O(ze),Z&&await n.publish(ze),console.log("Microphone device changed successfully")}catch(ze){throw console.error("Error changing microphone device:",ze),ze}},voiceDisabled:ne}},LWe=({size:n="md",tooltipPlacement:t="top",defaultMuted:i=!0,joinOnClick:a=!0,className:l="voice-button"})=>{const{isVoiceEnabled:d,toggleVoice:f,isJoined:_,joinChannel:v,channel:b,client:C,voiceDisabled:I}=xWe(),[O,L]=N.useState(!1),[M,F]=N.useState(!1);N.useEffect(()=>{const K=()=>{$.log("VoiceButton: Player instantiated, showing button"),F(!0)};return window.addEventListener("PlayerInstantiated",K),window.isPlayerInstantiated&&($.log("VoiceButton: Player was already instantiated"),F(!0)),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]),N.useEffect(()=>{console.log("VoiceButton: State:",{isVoiceEnabled:d,isJoined:_,channel:b,hasClient:!!C,clientState:C==null?void 0:C.connectionState,windowAgoraClient:window.agoraClient,isPlayerReady:M,voiceDisabled:I})},[d,_,b,C,M,I]);const z=async()=>{if(!(O||I)){L(!0),console.log("VoiceButton: Handling click, current state:",{isVoiceEnabled:d,isJoined:_});try{if(!_&&a)try{console.log("VoiceButton: Not joined, attempting to join channel"),await v(),console.log("VoiceButton: Joined channel successfully")}catch(re){re.message&&re.message.includes("already in connecting/connected state")?console.log("VoiceButton: Already connected to channel"):console.error("VoiceButton: Error joining channel:",re)}console.log("VoiceButton: Toggling voice state from:",d);const K=await f();console.log("VoiceButton: Voice toggled, new state:",K)}catch(K){console.error("VoiceButton: Error toggling voice:",K)}finally{L(!1)}}},Z=()=>I?"Voice chat is disabled for this space":M?O?"Processing...":_?d?"Turn microphone off":"Turn microphone on":"Connecting to voice chat...":"Waiting for player to be ready...";return!M||I?null:T.jsx(jf,{label:Z(),placement:t,hasArrow:!0,children:T.jsxs(ft,{position:"relative",cursor:"pointer",onClick:z,children:[T.jsx(Ep,{size:n,borderRadius:"full",bg:d?"green.500":"red.500",icon:d?T.jsx(tj,{color:"white"}):T.jsx(ej,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:l,"data-testid":"voice-button"}),O&&T.jsx(ft,{position:"absolute",top:"0",left:"0",right:"0",bottom:"0",display:"flex",alignItems:"center",justifyContent:"center",bg:"rgba(0, 0, 0, 0.6)",borderRadius:"full",children:T.jsx(qd,{size:"sm",color:"white"})})]})})},MWe=hi.createContext({user:null}),UWe=({userNickname:n})=>{const{client:t,channel:i,screenTrack:a,isScreenSharing:l,toggleScreenShare:d}=xoe(),[f,_]=N.useState([]),[v,b]=N.useState(!1),[C,I]=N.useState(!0);N.useRef({});const O=N.useRef(null);N.useRef(null);const{user:L}=N.useContext(MWe)||{user:null},[M,F]=N.useState({}),z=N.useRef(a),[Z,K]=N.useState(null),{isOpen:re,onOpen:ae,onClose:ne}=yp(),[pe,X]=N.useState(!1),J=N.useRef(null),Q=N.useRef(null);N.useEffect(()=>{z.current=a},[a]),N.useEffect(()=>{if(!t||!i){b(!1);return}const Oe=setTimeout(()=>{I(!1)},5e3);console.log("Setting up screen share display with existing client:",t),console.log("Current channel:",i);const Ve=t.connectionState;if(console.log("Current connection state:",Ve),Ve==="CONNECTED")b(!0),I(!1);else{b(!1);const xe=Re=>{console.log("Connection state changed:",Re),Re==="CONNECTED"?(b(!0),I(!1)):b(!1)};return t.on("connection-state-change",xe),()=>{t.off("connection-state-change",xe),clearTimeout(Oe)}}return()=>{clearTimeout(Oe)}},[t,i]),N.useEffect(()=>{const Oe=async()=>{const Ve={...M};let xe=!1;for(const Re of f){if(M[Re.uid])continue;let ve=null,be=Re.uid;if(typeof be=="string"&&(be.includes("-")?(ve=be.split("-")[0],be=be.split("-")[1]):be.includes("_")&&(ve=be.split("_")[0],be=be.split("_")[1])),be)try{console.log("Trying to fetch nickname for user ID:",be);const ze=await Yu(be);ze&&ze.Nickname?(console.log("Found nickname in Firebase for user ID:",be,"Nickname:",ze.Nickname),Ve[Re.uid]=ze.Nickname,xe=!0):ve?(console.log("Using extracted name for user ID:",be,"Name:",ve),Ve[Re.uid]=ve,xe=!0):(Ve[Re.uid]="User",xe=!0)}catch(ze){console.error("Error fetching user profile:",ze),ve?(Ve[Re.uid]=ve,xe=!0):(Ve[Re.uid]="User",xe=!0)}else ve?(Ve[Re.uid]=ve,xe=!0):(Ve[Re.uid]="User",xe=!0)}xe&&F(Ve)};f.length>0&&Oe()},[f,M]),N.useEffect(()=>{if(!t||!i||!v)return;console.log("Setting up screen share event handlers");const Oe=async(Re,ve)=>{if(console.log("User published:",Re.uid,ve,Re),ve==="video"){console.log("Remote video track detected:",Re.uid);try{await t.subscribe(Re,ve),console.log("Subscribed to remote video track:",Re.uid),_(be=>be.some(ze=>ze.uid===Re.uid)?be:[...be,Re])}catch(be){console.error("Error subscribing to remote video track:",be)}}},Ve=(Re,ve)=>{if(console.log("User unpublished:",Re.uid,ve),ve==="video"){if(console.log("Remote video track unpublished:",Re.uid),Re.videoTrack)try{Re.videoTrack.stop()}catch(be){console.error("Error stopping video track:",be)}if(_(be=>be.filter(ze=>ze.uid!==Re.uid)),l&&z.current&&O.current)try{console.log("Ensuring local screen track is still playing after remote user unpublished"),z.current.play(O.current)}catch(be){console.error("Error replaying local screen track:",be)}}},xe=Re=>{console.log("User left:",Re.uid);const ve=f.find(be=>be.uid===Re.uid);if(ve&&ve.videoTrack)try{ve.videoTrack.stop()}catch(be){console.error("Error stopping video track:",be)}if(_(be=>be.filter(ze=>ze.uid!==Re.uid)),l&&z.current&&O.current)try{console.log("Ensuring local screen track is still playing after remote user left"),z.current.play(O.current)}catch(be){console.error("Error replaying local screen track:",be)}};return t.on("user-published",Oe),t.on("user-unpublished",Ve),t.on("user-left",xe),()=>{t.off("user-published",Oe),t.off("user-unpublished",Ve),t.off("user-left",xe)}},[t,i,v,f,l]),N.useEffect(()=>{if(console.log("Remote screens changed:",f.length,f),f.forEach(Oe=>{if(Oe.videoTrack)try{console.log("Playing video track for:",Oe.uid),Oe.videoTrack.play(`video-container-${Oe.uid}`)}catch(Ve){console.error("Error playing video track:",Ve)}}),l&&z.current&&O.current)try{console.log("Ensuring local screen track is still playing after remote screens changed"),z.current.play(O.current)}catch(Oe){console.error("Error replaying local screen track:",Oe)}},[f,l]),N.useEffect(()=>{if(console.log("Local screen sharing state changed:",l,a),l&&a&&O.current)try{console.log("Playing local screen track"),a.play(O.current)}catch(Oe){console.error("Error playing local screen track:",Oe)}},[l,a]),N.useEffect(()=>()=>{if(f.forEach(Oe=>{if(Oe.videoTrack)try{Oe.videoTrack.stop()}catch(Ve){console.error("Error stopping video track on unmount:",Ve)}}),a)try{a.stop()}catch(Oe){console.error("Error stopping local screen track on unmount:",Oe)}},[f,a]);const se=()=>{console.log("Stopping local screen share"),d()},de=Oe=>(console.log("Getting display name for UID:",Oe,"type:",typeof Oe),l&&L&&(Oe===L.uid||Oe===(t==null?void 0:t.uid))?n||"You":M[Oe]?M[Oe]:typeof Oe=="string"?Oe.includes("-")?Oe.split("-")[0]:Oe.includes("_")?Oe.split("_")[0]:Oe:"User"),he=Oe=>{console.log("Opening modal for remote screen",Oe),K(Oe),ae()},le=()=>{console.log("Opening modal for local screen"),K({isLocal:!0}),ae()};return N.useEffect(()=>{re&&Z?(console.log("Modal opened, activeScreen:",Z),setTimeout(()=>{if(Z.isLocal&&z.current)try{console.log("Playing local screen in modal"),z.current.play("modal-screen-container"),X(!0)}catch(Oe){console.error("Error playing local screen in modal:",Oe)}else if(Z.videoTrack)try{console.log("Playing remote screen in modal"),Z.videoTrack.play("modal-screen-container"),X(!0)}catch(Oe){console.error("Error playing remote screen in modal:",Oe)}},500)):re||(X(!1),K(null),setTimeout(()=>{if(l&&z.current)try{z.current.play("local-screen-container")}catch(Oe){console.error("Error playing local screen in small container:",Oe)}f.forEach(Oe=>{if(Oe.videoTrack)try{Oe.videoTrack.play(`video-container-${Oe.uid}`)}catch(Ve){console.error(`Error playing remote screen ${Oe.uid} in small container:`,Ve)}})},500))},[re,Z,l,f]),!v||C&&f.length===0&&!l||f.length===0&&!l?null:T.jsxs(T.Fragment,{children:[!re&&T.jsxs(ft,{position:"fixed",top:"20px",left:"20px",zIndex:1e4,overflow:"visible",ref:J,children:[l&&a&&T.jsxs(ft,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:le,children:[T.jsx(ft,{id:"local-screen-container",width:"100%",height:"100%",position:"relative"}),T.jsx(ft,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:n?`${n}'s Screen`:"Your Screen"})]}),f.map(Oe=>{const Ve=M[Oe.uid]||de(Oe.uid);return T.jsxs(ft,{position:"relative",mb:4,borderRadius:"md",overflow:"hidden",boxShadow:"xl",bg:"black",width:"200px",height:"120px",cursor:"pointer",transition:"all 0.2s",_hover:{filter:"brightness(0.8)",transform:"scale(1.05)"},onClick:()=>he(Oe),children:[T.jsx(ft,{id:`video-container-${Oe.uid}`,width:"100%",height:"100%",position:"relative"}),T.jsx(ft,{position:"absolute",bottom:2,left:2,color:"white",fontSize:"xs",bg:"rgba(0,0,0,0.5)",px:2,py:1,borderRadius:"md",zIndex:5,children:`${Ve}'s Screen`})]},Oe.uid)})]}),re&&T.jsx(ft,{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",bg:"rgba(0,0,0,0.8)",zIndex:1e4,display:"flex",justifyContent:"center",alignItems:"center",onClick:ne,children:T.jsxs(ft,{width:"80vw",height:"80vh",bg:"black",borderRadius:"md",overflow:"hidden",position:"relative",onClick:Oe=>Oe.stopPropagation(),children:[!pe&&T.jsxs(ft,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"white",textAlign:"center",children:[T.jsx(qd,{size:"xl"}),T.jsx(at,{mt:4,children:"Loading screen share..."})]}),T.jsx(ft,{id:"modal-screen-container",width:"100%",height:"100%",position:"relative",ref:Q}),T.jsx(ft,{position:"absolute",top:2,right:2,color:"white",bg:"rgba(0,0,0,0.5)",borderRadius:"full",width:"30px",height:"30px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",onClick:ne,children:""}),T.jsx(ft,{position:"absolute",bottom:4,left:4,color:"white",fontSize:"sm",bg:"rgba(0,0,0,0.5)",px:3,py:2,borderRadius:"md",children:Z!=null&&Z.isLocal?n?`${n}'s Screen`:"Your Screen":`${M[Z==null?void 0:Z.uid]||de(Z==null?void 0:Z.uid)}'s Screen`}),(Z==null?void 0:Z.isLocal)&&T.jsx(ft,{position:"absolute",bottom:4,right:4,children:T.jsx(Jn,{colorScheme:"red",size:"sm",onClick:se,children:"Stop Sharing"})})]})})]})},VWe=({onClose:n})=>{const t=Na(),[i,a]=N.useState(!1),[l,d]=N.useState(!1);N.useEffect(()=>{const v=()=>{window.agoraClient&&d(!!window.agoraClient.isScreenSharing)};v();const b=setInterval(v,1e3),C=()=>{v()};return window.addEventListener("ScreenShareToggled",C),()=>{clearInterval(b),window.removeEventListener("ScreenShareToggled",C)}},[]);const f=async v=>{if(v.preventDefault(),v.stopPropagation(),n&&n(),!window.agoraClient||!window.agoraClient.client){t({title:"Screen sharing not available",description:"Voice chat must be connected to use screen sharing",status:"warning",duration:3e3,isClosable:!0});return}try{if(a(!0),window.agoraClient.isJoined)_();else{console.log("ScreenShareMenuOption: Not joined to voice chat, joining automatically");const b=new CustomEvent("JoinVoiceChat",{detail:{callback:C=>{if(!C){console.error("ScreenShareMenuOption: Failed to join voice chat"),t({title:"Connection failed",description:"Could not connect to voice chat",status:"error",duration:3e3,isClosable:!0}),a(!1);return}_()}}});window.dispatchEvent(b)}}catch(b){console.error("Error in screen share handler:",b),a(!1),t({title:"Screen sharing error",description:b.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}},_=async()=>{try{const v=new CustomEvent("ToggleScreenShare",{detail:{callback:(b,C)=>{a(!1),b?(d(C),t(C?{title:"Screen sharing started",status:"success",duration:3e3,isClosable:!0}:{title:"Screen sharing stopped",status:"info",duration:3e3,isClosable:!0})):t({title:"Screen sharing error",description:"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}}});window.dispatchEvent(v)}catch(v){console.error("Error toggling screen share:",v),a(!1),t({title:"Screen sharing error",description:v.message||"Failed to toggle screen sharing",status:"error",duration:5e3,isClosable:!0})}};return T.jsx(at,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:f,color:l?"red.300":"white",children:i?"Connecting...":l?"Stop Screen Sharing":"Share Screen"})};function jWe({open:n,onClose:t}){const[i,a]=N.useState(0);return T.jsxs(Fs,{isOpen:n,onClose:t,size:"md",isCentered:!0,children:[T.jsx(Ws,{backdropFilter:"blur(4px)"}),T.jsxs(Bs,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"600px",h:"350px",overflow:"hidden",children:[T.jsx(xo,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Controls"}),T.jsx(io,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),T.jsx(zs,{p:0,display:"flex",children:T.jsxs(T0,{orientation:"vertical",variant:"unstyled",index:i,onChange:a,display:"flex",flexGrow:1,children:[T.jsxs(w0,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",children:[T.jsxs(Ra,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[T.jsx(En,{as:pWe,mb:1}),T.jsx(at,{fontSize:"xs",children:"Movement"})]}),T.jsxs(Ra,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[T.jsx(En,{as:fWe,mb:1}),T.jsx(at,{fontSize:"xs",children:"Camera"})]}),T.jsxs(Ra,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[T.jsx(En,{as:dWe,mb:1}),T.jsx(at,{fontSize:"xs",children:"Actions"})]}),T.jsxs(Ra,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[T.jsx(En,{as:hWe,mb:1}),T.jsx(at,{fontSize:"xs",children:"Tips"})]})]}),T.jsxs(LC,{flexGrow:1,display:"flex",flexDirection:"column",children:[T.jsxs(Ic,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Movement Controls"}),T.jsxs(ji,{wrap:"wrap",gap:3,children:[T.jsx(zl,{keyLabel:"W",description:"Move Forward"}),T.jsx(zl,{keyLabel:"A",description:"Move Left"}),T.jsx(zl,{keyLabel:"S",description:"Move Backward"}),T.jsx(zl,{keyLabel:"D",description:"Move Right"}),T.jsx(zl,{keyLabel:"Shift",description:"Run"}),T.jsx(zl,{keyLabel:"Space",description:"Jump / Double Jump"})]})]}),T.jsxs(Ic,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Camera Controls"}),T.jsxs(ji,{wrap:"wrap",gap:3,children:[T.jsx(zl,{keyLabel:"Mouse",description:"Look Around"}),T.jsx(zl,{keyLabel:"Click + Drag",description:"Rotate Camera"}),T.jsx(zl,{keyLabel:"Scroll",description:"Zoom In/Out"})]})]}),T.jsxs(Ic,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Action Controls"}),T.jsxs(ji,{wrap:"wrap",gap:3,children:[T.jsx(zl,{keyLabel:"E",description:"Interact"}),T.jsx(zl,{keyLabel:"F",description:"Emote Menu"}),T.jsx(zl,{keyLabel:"T",description:"Chat"}),T.jsx(zl,{keyLabel:"M",description:"Mute Mic"})]})]}),T.jsxs(Ic,{p:4,display:"flex",flexDirection:"column",h:"100%",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Tips & Tricks"}),T.jsxs(pi,{align:"stretch",spacing:2,children:[T.jsx(at,{fontSize:"xs",children:" Double-tap Shift to auto-run"}),T.jsx(at,{fontSize:"xs",children:" Press ESC to access settings"}),T.jsx(at,{fontSize:"xs",children:" Click on players to view their profile"}),T.jsx(at,{fontSize:"xs",children:" Use the minimap to navigate"})]})]})]})]})})]})]})}const zl=({keyLabel:n,description:t})=>T.jsx(ft,{bg:"whiteAlpha.100",borderRadius:"md",p:2,minW:"120px",maxW:"180px",children:T.jsxs(yr,{spacing:2,children:[T.jsx(ft,{bg:"whiteAlpha.200",borderRadius:"md",px:2,py:1,fontSize:"xs",fontWeight:"bold",minW:"30px",textAlign:"center",children:n}),T.jsx(at,{fontSize:"xs",children:t})]})}),FWe=()=>{const[n,t]=N.useState([]),[i,a]=N.useState(""),[l,d]=N.useState(0),[f,_]=N.useState(100),[v,b]=N.useState(100),[C,I]=N.useState(!0),[O,L]=N.useState(!0),[M,F]=N.useState(!1);N.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({audio:!0});const ne=await GC.getMicrophones();t(ne),ne.length>0&&a(ne[0].deviceId)}catch(ne){console.error("Error getting audio devices:",ne)}})()},[]),N.useEffect(()=>{const ae=setInterval(()=>{d(M?Math.random()*50:0)},100);return()=>clearInterval(ae)},[M]);const z=ae=>{const ne=ae.target.value;a(ne),console.log("Microphone changed to:",ne)},Z=ae=>{_(ae),console.log("Microphone volume set to:",ae)},K=ae=>{b(ae),console.log("Speaker volume set to:",ae)},re=()=>{F(!M)};return T.jsxs(pi,{spacing:6,align:"stretch",children:[T.jsxs(kr,{children:[T.jsxs(Gi,{children:["Microphone",T.jsx(Of,{ml:2,colorScheme:M?"green":"red",children:M?"Enabled":"Muted"})]}),T.jsxs(Hne,{value:i,onChange:z,bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"gray.500"},children:[n.map(ae=>T.jsx("option",{value:ae.deviceId,children:ae.label||`Microphone ${ae.deviceId.slice(0,5)}...`},ae.deviceId)),n.length===0&&T.jsx("option",{value:"",children:"No microphones found"})]})]}),T.jsxs(ft,{children:[T.jsx(at,{mb:2,children:"Microphone Level"}),T.jsx(Uy,{value:l,colorScheme:"green",size:"sm",borderRadius:"md",hasStripe:l>20,isAnimated:l>20})]}),T.jsxs(kr,{children:[T.jsxs(Gi,{children:["Microphone Volume: ",f,"%"]}),T.jsxs(dV,{value:f,onChange:Z,min:0,max:100,step:1,colorScheme:"blue",children:[T.jsx(pV,{bg:"gray.700",children:T.jsx(fV,{})}),T.jsx(hV,{boxSize:6})]})]}),T.jsxs(kr,{children:[T.jsxs(Gi,{children:["Speaker Volume: ",v,"%"]}),T.jsxs(dV,{value:v,onChange:K,min:0,max:100,step:1,colorScheme:"blue",children:[T.jsx(pV,{bg:"gray.700",children:T.jsx(fV,{})}),T.jsx(hV,{boxSize:6})]})]}),T.jsxs(kr,{display:"flex",alignItems:"center",children:[T.jsx(Gi,{mb:"0",children:"Microphone Enabled"}),T.jsx(hp,{isChecked:M,onChange:re,colorScheme:"green",size:"lg"})]}),T.jsxs(kr,{display:"flex",alignItems:"center",children:[T.jsx(Gi,{mb:"0",children:"Echo Cancellation"}),T.jsx(hp,{isChecked:C,onChange:()=>I(!C),colorScheme:"green",size:"lg"})]}),T.jsxs(kr,{display:"flex",alignItems:"center",children:[T.jsx(Gi,{mb:"0",children:"Noise Suppression"}),T.jsx(hp,{isChecked:O,onChange:()=>L(!O),colorScheme:"green",size:"lg"})]}),T.jsxs(tp,{status:"info",borderRadius:"md",children:[T.jsx(np,{}),"Note: These settings will be applied when you join a voice chat."]})]})};function BWe({open:n,onClose:t,containerRef:i}){return T.jsx(Ju,{containerRef:i,children:T.jsxs(Fs,{isOpen:n,onClose:t,size:"lg",isCentered:!0,children:[T.jsx(Ws,{}),T.jsxs(Bs,{bg:"gray.900",color:"white",borderRadius:"lg",children:[T.jsx(xo,{children:"Settings"}),T.jsx(io,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"}}),T.jsx(zs,{children:T.jsxs(T0,{variant:"enclosed",children:[T.jsxs(w0,{mb:4,children:[T.jsx(Ra,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Audio"}),T.jsx(Ra,{_selected:{color:"white",borderBottom:"2px solid white"},children:"Graphics"})]}),T.jsxs(LC,{children:[T.jsx(Ic,{children:T.jsx(ft,{p:4,bg:"gray.800",borderRadius:"md",children:T.jsx(FWe,{})})}),T.jsx(Ic,{children:T.jsx(ft,{p:4,bg:"gray.800",borderRadius:"md",children:"Graphics settings content goes here."})})]})]})})]})]})})}function zWe(n){return Dr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"8",r:"7"}},{tag:"polyline",attr:{points:"8.21 13.89 7 23 12 20 17 23 15.79 13.88"}}]})(n)}function WWe(n){return Dr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(n)}function dQ(n){return Dr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"2",y:"2",width:"20",height:"20",rx:"2.18",ry:"2.18"}},{tag:"line",attr:{x1:"7",y1:"2",x2:"7",y2:"22"}},{tag:"line",attr:{x1:"17",y1:"2",x2:"17",y2:"22"}},{tag:"line",attr:{x1:"2",y1:"12",x2:"22",y2:"12"}},{tag:"line",attr:{x1:"2",y1:"7",x2:"7",y2:"7"}},{tag:"line",attr:{x1:"2",y1:"17",x2:"7",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"17",x2:"22",y2:"17"}},{tag:"line",attr:{x1:"17",y1:"7",x2:"22",y2:"7"}}]})(n)}function Ry(n){return Dr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"rect",attr:{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}},{tag:"circle",attr:{cx:"8.5",cy:"8.5",r:"1.5"}},{tag:"polyline",attr:{points:"21 15 16 10 5 21"}}]})(n)}function Loe(n){return Dr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"10"}},{tag:"line",attr:{x1:"12",y1:"16",x2:"12",y2:"12"}},{tag:"line",attr:{x1:"12",y1:"8",x2:"12.01",y2:"8"}}]})(n)}function GWe(n){return Dr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}},{tag:"path",attr:{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}}]})(n)}function HWe(n){return Dr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"circle",attr:{cx:"12",cy:"12",r:"3"}},{tag:"path",attr:{d:"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"}}]})(n)}function $We(n){return Dr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"}}]})(n)}function u0(n){return Dr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polyline",attr:{points:"3 6 5 6 21 6"}},{tag:"path",attr:{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}},{tag:"line",attr:{x1:"10",y1:"11",x2:"10",y2:"17"}},{tag:"line",attr:{x1:"14",y1:"11",x2:"14",y2:"17"}}]})(n)}function yk(n){return Dr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}},{tag:"polyline",attr:{points:"17 8 12 3 7 8"}},{tag:"line",attr:{x1:"12",y1:"3",x2:"12",y2:"15"}}]})(n)}function hQ(n){return Dr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}},{tag:"circle",attr:{cx:"9",cy:"7",r:"4"}},{tag:"path",attr:{d:"M23 21v-2a4 4 0 0 0-3-3.87"}},{tag:"path",attr:{d:"M16 3.13a4 4 0 0 1 0 7.75"}}]})(n)}function qS(n){return Dr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"23 7 16 12 23 17 23 7"}},{tag:"rect",attr:{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"}}]})(n)}function KWe(n){return Dr({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"polygon",attr:{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}},{tag:"path",attr:{d:"M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"}}]})(n)}const qWe=async()=>{try{$.log("tagsFirestore: Fetching all tags");const n=Ql(zn,"tags"),t=await qu(n),i=[];return t.forEach(a=>{i.push({id:a.id,...a.data()})}),i}catch(n){throw $.error("tagsFirestore: Error fetching tags:",n),n}},YWe=async n=>{try{$.log(`tagsFirestore: Fetching tag with ID: ${n}`);const t=gr(zn,"tags",n),i=await go(t);return i.exists()?{id:i.id,...i.data()}:($.warn(`tagsFirestore: Tag with ID ${n} not found`),null)}catch(t){throw $.error(`tagsFirestore: Error fetching tag with ID ${n}:`,t),t}},XWe=async({id:n,name:t,color:i,description:a})=>{try{$.log(`tagsFirestore: Creating new tag: ${t}`);const l={name:t,color:i||"#808080",description:a||"",createdAt:new Date,updatedAt:new Date};let d;if(n){const f=gr(zn,"tags",n);await jg(f,l),d=n}else{const f=Ql(zn,"tags");d=(await Q5e(f,l)).id}return{id:d,...l}}catch(l){throw $.error("tagsFirestore: Error creating tag:",l),l}},JWe=async(n,t)=>{try{$.log(`tagsFirestore: Adding tag ${t} to space ${n}`);const i=gr(zn,"tags",t);if(!(await go(i)).exists())throw new Error(`Tag with ID ${t} does not exist`);const l=gr(zn,"spaces",n);return await Gs(l,{tags:eBe(t)}),!0}catch(i){throw $.error(`tagsFirestore: Error adding tag ${t} to space ${n}:`,i),i}},QWe=async(n,t)=>{try{$.log(`tagsFirestore: Removing tag ${t} from space ${n}`);const i=gr(zn,"spaces",n);return await Gs(i,{tags:tBe(t)}),!0}catch(i){throw $.error(`tagsFirestore: Error removing tag ${t} from space ${n}:`,i),i}},ZWe=async n=>{try{$.log(`tagsFirestore: Getting tags for space ${n}`);const t=gr(zn,"spaces",n),i=await go(t);if(!i.exists())throw new Error(`Space with ID ${n} not found`);const l=i.data().tags||[];if(l.length===0)return[];const d=[];for(const f of l){const _=await YWe(f);_&&d.push(_)}return d}catch(t){throw $.error(`tagsFirestore: Error getting tags for space ${n}:`,t),t}},e8e=async()=>{$.log("tagsFirestore: Initializing default tags");const n=[{id:"collaboration",name:"Collaboration",color:"#4287f5",description:"Spaces designed for team collaboration and meetings"},{id:"social",name:"Social",color:"#f54242",description:"Social gathering and networking spaces"},{id:"education",name:"Education",color:"#42f581",description:"Learning and educational environments"},{id:"events",name:"Events",color:"#f5a742",description:"Spaces optimized for hosting events"},{id:"showcase",name:"Showcase",color:"#9f42f5",description:"Spaces for exhibiting content and creations"},{id:"entertainment",name:"Entertainment",color:"#f542b3",description:"Entertainment and leisure spaces"},{id:"productivity",name:"Productivity",color:"#42dbf5",description:"Spaces focused on work and productivity"},{id:"featured",name:"Featured",color:"#f5f242",description:"Featured and highlighted spaces"}];try{let t=0,i=0;for(const a of n){$.log(`tagsFirestore: Processing tag: ${a.name}`);const l=gr(zn,"tags",a.id);(await go(l)).exists()?($.log(`tagsFirestore: Tag ${a.id} already exists, skipping`),i++):(await XWe(a),t++,$.log(`tagsFirestore: Created tag: ${a.name}`))}return $.log(`tagsFirestore: Tags initialization complete. Created: ${t}, Skipped: ${i}`),{created:t,skipped:i}}catch(t){throw $.error("tagsFirestore: Error initializing default tags:",t),t}},Moe=({spaceID:n})=>{const[t,i]=N.useState([]),[a,l]=N.useState([]),[d,f]=N.useState(!0),[_,v]=N.useState(!1),[b,C]=N.useState(!1),[I,O]=N.useState(null),{isOpen:L,onOpen:M,onClose:F}=yp(),z=Na(),{user:Z}=N.useContext(Nc),K=(Z==null?void 0:Z.groups)&&(Z.groups.includes("disruptiveAdmin")||Z.groups.includes("admin"));N.useEffect(()=>{re()},[n]);const re=async()=>{f(!0);try{let Q=[];try{Q=await qWe(),i(Q)}catch(se){$.error("SpaceTagsManager: Error loading available tags:",se),i([]),z({title:"Error loading tags",description:"Failed to load available tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}if(n)try{const se=await ZWe(n);l(se)}catch(se){$.error("SpaceTagsManager: Error loading space tags:",se),l([]),z({title:"Error loading space tags",description:"Failed to load this space's tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}}catch(Q){$.error("SpaceTagsManager: Error in loadTags:",Q),z({title:"Error loading tags",description:"Failed to load tags. Please try again later.",status:"error",duration:3e3,isClosable:!0})}finally{f(!1)}},ae=async()=>{C(!0),O(null);try{const Q=await e8e();console.log("Tag initialization result:",Q),O(Q),z({title:"Tags initialized",description:`Successfully created ${Q.created} tags. Skipped ${Q.skipped} existing tags.`,status:"success",duration:4e3,isClosable:!0}),await re()}catch(Q){$.error("SpaceTagsManager: Error initializing tags:",Q),O(!1),z({title:"Error initializing tags",description:"Failed to initialize tags. Please try again later.",status:"error",duration:4e3,isClosable:!0})}finally{C(!1)}},ne=async Q=>{if(!(!n||!Q)){v(!0);try{await JWe(n,Q);const se=t.find(de=>de.id===Q);se&&l(de=>[...de,se]),z({title:"Tag added",description:"Tag has been added to the space.",status:"success",duration:2e3,isClosable:!0})}catch(se){$.error(`SpaceTagsManager: Error adding tag ${Q} to space:`,se),z({title:"Error adding tag",description:"Failed to add tag to the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},pe=async Q=>{if(!(!n||!Q)){v(!0);try{await QWe(n,Q),l(se=>se.filter(de=>de.id!==Q)),z({title:"Tag removed",description:"Tag has been removed from the space.",status:"info",duration:2e3,isClosable:!0})}catch(se){$.error(`SpaceTagsManager: Error removing tag ${Q} from space:`,se),z({title:"Error removing tag",description:"Failed to remove tag from the space.",status:"error",duration:3e3,isClosable:!0})}finally{v(!1)}}},X=()=>{const Q=a.map(se=>se.id);return t.filter(se=>!Q.includes(se.id))},J=X().length===0;return T.jsxs(ft,{children:[T.jsx(ji,{mb:3,justifyContent:"space-between",alignItems:"center",children:T.jsxs(yr,{spacing:2,ml:"auto",children:[K&&T.jsx(Jn,{size:"xs",leftIcon:T.jsx(Xze,{}),onClick:M,variant:"outline",colorScheme:"purple",children:"Admin"}),T.jsxs(A1,{children:[T.jsx(P1,{as:Jn,size:"xs",leftIcon:T.jsx(Yze,{}),rightIcon:T.jsx(Qze,{}),isDisabled:d||_||J,children:J?"No Available Tags":"Add Tag"}),T.jsx(O1,{zIndex:1e3,bg:"gray.800",borderColor:"gray.700",color:"white",children:X().length>0?X().map(Q=>T.jsx(xk,{onClick:()=>ne(Q.id),icon:T.jsx(ft,{width:"12px",height:"12px",borderRadius:"full",bg:Q.color||"#888"}),_hover:{bg:"gray.700"},_focus:{bg:"gray.700"},_active:{bg:"gray.700"},_focusVisible:{bg:"gray.700"},bg:"gray.800",color:"white",children:Q.name},Q.id)):T.jsx(xk,{isDisabled:!0,bg:"gray.800",color:"gray.400",children:"No available tags to add"})})]})]})}),d?T.jsx(ji,{justify:"center",py:4,children:T.jsx(qd,{size:"sm",color:"blue.300"})}):t.length===0?T.jsx(ft,{children:T.jsxs(at,{fontSize:"sm",color:"red.400",mb:2,children:["No tags have been created in the system yet.",K?" Use the Admin button to initialize tags.":" Ask an admin to initialize tags."]})}):a.length===0?T.jsx(at,{fontSize:"sm",color:"gray.400",fontStyle:"italic",children:"No tags assigned to this space."}):T.jsx(nre,{spacing:2,children:a.map(Q=>T.jsx(FF,{children:T.jsxs(Jne,{size:"md",borderRadius:"full",variant:"subtle",colorScheme:"gray",boxShadow:`0 0 0 1px ${Q.color||"#888"}`,children:[T.jsx(ft,{width:"8px",height:"8px",borderRadius:"full",bg:Q.color||"#888",mr:1}),T.jsx(Qne,{children:Q.name}),T.jsx(ere,{onClick:()=>pe(Q.id),isDisabled:_})]})},Q.id))}),T.jsxs(Fs,{isOpen:L,onClose:F,size:"md",children:[T.jsx(Ws,{backdropFilter:"blur(4px)"}),T.jsxs(Bs,{bg:"gray.800",color:"white",children:[T.jsx(xo,{fontSize:"md",children:"Tag System Administration"}),T.jsx(io,{}),T.jsxs(zs,{children:[T.jsx(at,{fontSize:"sm",mb:4,children:"Initialize the default tags in your Firestore database. This will create a set of predefined tags if they don't already exist."}),I&&T.jsxs(tp,{status:"success",mb:4,borderRadius:"md",size:"sm",children:[T.jsx(np,{}),T.jsxs(at,{fontSize:"sm",children:["Tags initialized. Created: ",T.jsx("b",{children:I.created}),", Skipped: ",T.jsx("b",{children:I.skipped})]})]}),T.jsx(Jn,{colorScheme:"blue",onClick:ae,isLoading:b,loadingText:"Initializing...",size:"sm",width:"full",children:"Initialize Default Tags"})]}),T.jsx(Sp,{children:T.jsx(Jn,{variant:"ghost",size:"sm",onClick:F,children:"Close"})})]})]})]})};Moe.propTypes={spaceID:Sn.string.isRequired};const t8e=({isOpen:n,onClose:t})=>{const{spaceID:i}=Qo(),[a,l]=N.useState(0),[d,f]=N.useState(""),[_,v]=N.useState(""),[b,C]=N.useState(!1),[I,O]=N.useState(null),[L,M]=N.useState(null),[F,z]=N.useState(!1),[Z,K]=N.useState(0),[re,ae]=N.useState(null),ne=N.useRef(null),[pe,X]=N.useState(null),[J,Q]=N.useState(null),[se,de]=N.useState(!1),[he,le]=N.useState(0),[Oe,Ve]=N.useState(null),xe=N.useRef(null),[Re,ve]=N.useState(null),[be,ze]=N.useState(null),[Pe,we]=N.useState(!1),[ke,Ue]=N.useState(0),[Be,qe]=N.useState(null),$e=N.useRef(null),[it,Je]=N.useState([]),[Ct,kt]=N.useState([]),[He,lt]=N.useState(!1),[mt,Lt]=N.useState(!1),[Xt,$t]=N.useState(!0),[Te,je]=N.useState(!1),[Ke,gt]=N.useState(!1),[Et,wt]=N.useState(""),[Kt,mn]=N.useState(""),[vn,rn]=N.useState(""),[Tt,ir]=N.useState(!1),{setHLSStreamUrl:Ut,savedStreamData:Wt}=ooe(),gn=Na();N.useEffect(()=>{n&&i&&Ni()},[n,i]);const Ni=async()=>{try{const vt=await Gu(i);vt.logoUrl&&ae(vt.logoUrl),vt.backgroundUrl&&Ve(vt.backgroundUrl),vt.videoBackgroundUrl&&qe(vt.videoBackgroundUrl),vt.voiceDisabled!==void 0&&Lt(vt.voiceDisabled),vt.accessibleToAllUsers!==void 0&&$t(vt.accessibleToAllUsers),f(vt.name||""),v(vt.description||"");try{const pn=await toe(i);if(pn){wt(pn.streamUrl||""),mn(pn.rtmpUrl||""),rn(pn.streamKey||"");const vr=pn.enabled===!0;gt(vr),$.log("SpaceManageModal: Directly loaded streaming enabled state from Firebase:",{enabled:vr,rawValue:pn.enabled})}else gt(!1),$.log("SpaceManageModal: No stream data found in Firebase, defaulting enabled to false")}catch(pn){if($.error("Error fetching stream data directly:",pn),Wt){wt(Wt.streamUrl||""),mn(Wt.rtmpUrl||""),rn(Wt.streamKey||"");const vr=Wt.enabled===!0;gt(vr),$.log("SpaceManageModal: Loaded streaming enabled state from savedStreamData:",{enabled:vr,rawValue:Wt.enabled})}else gt(!1),$.log("SpaceManageModal: No savedStreamData available, defaulting enabled to false")}ys(vt)}catch(vt){$.error("Error fetching space data:",vt),gn({title:"Error",description:"Failed to load space data",status:"error",duration:3e3,isClosable:!0})}};N.useEffect(()=>{if(Wt){if(!Tt){wt(Wt.streamUrl||""),mn(Wt.rtmpUrl||""),rn(Wt.streamKey||"");const vt=Wt.enabled===!0;gt(vt),$.log("SpaceManageModal: Updated streaming enabled state from savedStreamData:",{enabled:vt,rawValue:Wt.enabled})}}else n&&!Tt&&$.log("SpaceManageModal: No savedStreamData available but NOT defaulting enabled to false (preserving current state)")},[Wt,Tt,n]);const ys=async vt=>{if(i&&n){lt(!0);try{const pn=FV(),vr=`space_${i}_owners`,mi=zV(Ql(pn,"users"),CJ("groups","array-contains",vr)),Uo=await qu(mi),yo=[];for(const wi of Uo.docs){const Eo=wi.data(),Bi=await Yu(wi.id);yo.push({uid:wi.id,email:Eo.email,displayName:Eo.displayName||Bi.Nickname||"Unknown User",photoURL:Eo.photoURL||Bi.photoURL,firstName:Bi.firstName,lastName:Bi.lastName})}Je(yo);const Zl=`space_${i}_hosts`,Cp=zV(Ql(pn,"users"),CJ("groups","array-contains",Zl)),Sl=await qu(Cp),eu=[];for(const wi of Sl.docs){const Eo=wi.data(),Bi=await Yu(wi.id);eu.push({uid:wi.id,email:Eo.email,displayName:Eo.displayName||Bi.Nickname||"Unknown User",photoURL:Eo.photoURL||Bi.photoURL,firstName:Bi.firstName,lastName:Bi.lastName})}kt(eu)}catch(pn){$.error("Error fetching space users:",pn),gn({title:"Error",description:"Failed to load space users",status:"error",duration:3e3,isClosable:!0})}finally{lt(!1)}}};N.useEffect(()=>{i&&n&&a===4&&ys()},[i,n,a]);const oi=vt=>{const pn=vt.target.files[0];if(pn){if(!pn.type.startsWith("image/")){gn({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}O(pn);const vr=new FileReader;vr.onloadend=()=>{M(vr.result)},vr.readAsDataURL(pn)}},Zo=vt=>{const pn=vt.target.files[0];if(pn){if(!pn.type.startsWith("image/")){gn({title:"Invalid file type",description:"Please select an image file",status:"error",duration:5e3,isClosable:!0});return}X(pn);const vr=new FileReader;vr.onloadend=()=>{Q(vr.result)},vr.readAsDataURL(pn)}},cc=vt=>{const pn=vt.target.files[0];if(pn){if(!pn.type.startsWith("video/")){gn({title:"Invalid file type",description:"Please select a video file",status:"error",duration:5e3,isClosable:!0});return}const vr=5*1024*1024;if(pn.size>vr){gn({title:"File too large",description:"Video file must be smaller than 5MB",status:"error",duration:5e3,isClosable:!0});return}ve(pn);const mi=new FileReader;mi.onloadend=()=>{ze(mi.result)},mi.readAsDataURL(pn)}},so=async()=>{if(!I){gn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{z(!0);const vt=setInterval(()=>{K(vr=>{const mi=vr+10;return mi>=90?90:mi})},300),pn=await P6e(i,I);clearInterval(vt),K(100),ae(pn),gn({title:"Upload successful",description:"Space logo has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{O(null),M(null),K(0),z(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:pn}}))}catch(vt){console.error("Error uploading logo:",vt),gn({title:"Upload failed",description:vt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),z(!1),K(0)}},oo=async()=>{if(!pe){gn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{de(!0);const vt=setInterval(()=>{le(vr=>{const mi=vr+10;return mi>=90?90:mi})},300),pn=await k6e(i,pe);clearInterval(vt),le(100),Ve(pn),gn({title:"Upload successful",description:"Space background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{X(null),Q(null),le(0),de(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:pn}}))}catch(vt){console.error("Error uploading background:",vt),gn({title:"Upload failed",description:vt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),de(!1),le(0)}},Dc=async()=>{if(re)try{z(!0),await O6e(i),ae(null),gn({title:"Logo removed",description:"Space logo has been removed",status:"info",duration:5e3,isClosable:!0}),z(!1),window.dispatchEvent(new CustomEvent("SpaceLogoUpdated",{detail:{logoUrl:null}}))}catch(vt){console.error("Error deleting logo:",vt),gn({title:"Deletion failed",description:vt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),z(!1)}},Es=async()=>{if(Oe)try{de(!0),await N6e(i),Ve(null),gn({title:"Background removed",description:"Space background has been removed",status:"info",duration:5e3,isClosable:!0}),de(!1),window.dispatchEvent(new CustomEvent("SpaceBackgroundUpdated",{detail:{backgroundUrl:null}}))}catch(vt){console.error("Error deleting background:",vt),gn({title:"Deletion failed",description:vt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),de(!1)}},Da=async()=>{if(!Re){gn({title:"No file selected",description:"Please select a file to upload",status:"warning",duration:5e3,isClosable:!0});return}try{we(!0);const vt=setInterval(()=>{Ue(vr=>{const mi=vr+10;return mi>=90?90:mi})},300),pn=await L6e(i,Re);clearInterval(vt),Ue(100),qe(pn),gn({title:"Upload successful",description:"Space video background has been updated",status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{ve(null),ze(null),Ue(0),we(!1)},1e3),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:pn}}))}catch(vt){console.error("Error uploading video background:",vt),gn({title:"Upload failed",description:vt.message||"An error occurred during upload",status:"error",duration:5e3,isClosable:!0}),we(!1),Ue(0)}},Mo=async()=>{if(Be)try{we(!0),await M6e(i),qe(null),gn({title:"Video background removed",description:"Space video background has been removed",status:"info",duration:5e3,isClosable:!0}),we(!1),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:null}}))}catch(vt){console.error("Error deleting video background:",vt),gn({title:"Deletion failed",description:vt.message||"An error occurred during deletion",status:"error",duration:5e3,isClosable:!0}),we(!1)}},xa=()=>{ne.current&&ne.current.click()},lc=()=>{xe.current&&xe.current.click()},vl=()=>{$e.current&&$e.current.click()},La=async()=>{je(!0);try{await D6e(i,{voiceDisabled:!mt}),Lt(!mt),gn({title:"Settings Updated",description:`Voice chat has been ${mt?"enabled":"disabled"} for this space.`,status:"success",duration:3e3,isClosable:!0})}catch(vt){$.error("Error updating voice settings:",vt),gn({title:"Error",description:"Failed to update voice settings",status:"error",duration:3e3,isClosable:!0})}finally{je(!1)}},uc=async()=>{je(!0);try{await x6e(i,!Xt),$t(!Xt),gn({title:"Settings Updated",description:`Space is now ${Xt?"not accessible":"accessible"} to all users.`,status:"success",duration:3e3,isClosable:!0})}catch(vt){$.error("Error updating accessibility settings:",vt),gn({title:"Error",description:"Failed to update accessibility settings",status:"error",duration:3e3,isClosable:!0})}finally{je(!1)}},_o=async()=>{if(i){C(!0);try{const vt=FV(),pn=gr(vt,"spaces",i);await Gs(pn,{name:d,description:_}),gn({title:"Success",description:"Space details updated successfully",status:"success",duration:3e3,isClosable:!0}),window.dispatchEvent(new CustomEvent("SpaceDetailsUpdated",{detail:{name:d,description:_}}))}catch(vt){$.error("Error updating space details:",vt),gn({title:"Error",description:"Failed to update space details",status:"error",duration:3e3,isClosable:!0})}finally{C(!1)}}},Di=async()=>{if(i){ir(!0);try{const vt={enabled:Ke,streamUrl:Et,rtmpUrl:Kt,streamKey:vn,playerIndex:"0",updatedAt:new Date().toISOString()};$.log("SpaceManageModal: Saving stream settings to Firebase:",{enabled:Ke,url:Et,hasRtmp:!!Kt,hasKey:!!vn});try{await HV(i,vt),$.log("SpaceManageModal: Successfully updated stream settings in Firebase directly")}catch(pn){throw $.error("SpaceManageModal: Error updating stream settings directly in Firebase:",pn),pn}await Ut(Et,0,{enabled:Ke,rtmpUrl:Kt,streamKey:vn}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:Ke,spaceId:i}})),gn({title:"Success",description:`Stream settings updated successfully. Streaming is now ${Ke?"enabled":"disabled"}.`,status:"success",duration:3e3,isClosable:!0}),setTimeout(()=>{Ni()},500)}catch(vt){$.error("Error updating stream settings:",vt),gn({title:"Error",description:"Failed to update stream settings",status:"error",duration:3e3,isClosable:!0})}finally{ir(!1)}}};return T.jsxs(Fs,{isOpen:n,onClose:t,size:"lg",isCentered:!0,children:[T.jsx(Ws,{backdropFilter:"blur(4px)"}),T.jsxs(Bs,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",maxW:"800px",maxH:"90vh",overflow:"hidden",children:[T.jsx(xo,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Manage Space"}),T.jsx(io,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),T.jsx(zs,{p:0,display:"flex",overflow:"hidden",children:T.jsxs(T0,{orientation:"vertical",variant:"unstyled",index:a,onChange:l,display:"flex",width:"100%",height:"100%",children:[T.jsxs(w0,{bg:"rgba(0, 0, 0, 0.2)",w:"80px",py:4,borderRight:"1px solid",borderColor:"whiteAlpha.200",flexShrink:0,children:[T.jsxs(Ra,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[T.jsx(En,{as:Loe,mb:1}),T.jsx(at,{fontSize:"xs",children:"Details"})]}),T.jsxs(Ra,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[T.jsx(En,{as:Ry,mb:1}),T.jsx(at,{fontSize:"xs",children:"Logo"})]}),T.jsxs(Ra,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[T.jsx(En,{as:WWe,mb:1}),T.jsx(at,{fontSize:"xs",children:"Background"})]}),T.jsxs(Ra,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[T.jsx(En,{as:HWe,mb:1}),T.jsx(at,{fontSize:"xs",children:"Settings"})]}),T.jsxs(Ra,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[T.jsx(En,{as:hQ,mb:1}),T.jsx(at,{fontSize:"xs",children:"Users"})]}),T.jsxs(Ra,{display:"flex",flexDirection:"column",alignItems:"center",py:3,_selected:{bg:"whiteAlpha.100",color:"blue.300"},_hover:{bg:"whiteAlpha.50"},children:[T.jsx(En,{as:qS,mb:1}),T.jsx(at,{fontSize:"xs",children:"Stream"})]})]}),T.jsxs(LC,{flexGrow:1,display:"flex",flexDirection:"column",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"4px"}},children:[T.jsxs(Ic,{p:4,display:"flex",flexDirection:"column",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Details"}),T.jsxs(pi,{spacing:4,align:"stretch",children:[T.jsxs(kr,{children:[T.jsx(Gi,{fontSize:"xs",children:"Space Name"}),T.jsx(Hi,{value:d,onChange:vt=>f(vt.target.value),placeholder:"Enter space name",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",maxLength:100})]}),T.jsxs(kr,{children:[T.jsx(Gi,{fontSize:"xs",children:"Description"}),T.jsx(tre,{value:_,onChange:vt=>v(vt.target.value),placeholder:"Enter space description",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},rows:4,resize:"vertical",maxLength:500})]}),T.jsxs(kr,{children:[T.jsx(Gi,{fontSize:"xs",children:"Space Tags"}),T.jsx(ft,{p:3,bg:"whiteAlpha.50",borderWidth:"1px",borderColor:"whiteAlpha.200",borderRadius:"md",children:i?T.jsx(Moe,{spaceID:i}):T.jsxs(tp,{status:"warning",variant:"subtle",borderRadius:"md",children:[T.jsx(np,{}),T.jsx(HS,{fontSize:"sm",children:"Space ID missing"}),T.jsx($S,{fontSize:"xs",children:"Unable to load tags without a valid space ID."})]})})]}),T.jsx(Jn,{colorScheme:"blue",size:"sm",onClick:_o,isLoading:b,loadingText:"Saving...",alignSelf:"flex-start",mt:2,children:"Save Details"})]})]}),T.jsxs(Ic,{p:4,display:"flex",flexDirection:"column",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Logo"}),T.jsx(at,{fontSize:"xs",mb:4,children:"Upload a logo for your space. This will be displayed during loading."}),(re||L)&&T.jsxs(ji,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[re&&T.jsxs(ft,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[T.jsx(at,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Logo"}),T.jsx(rp,{src:re,alt:"Space Logo",maxH:"120px",mx:"auto",objectFit:"contain"}),T.jsx(Jn,{mt:3,colorScheme:"red",leftIcon:T.jsx(En,{as:u0}),onClick:Dc,isLoading:F,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Logo"})]}),L&&T.jsxs(ft,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[T.jsx(at,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),T.jsx(rp,{src:L,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),T.jsxs(kr,{children:[T.jsx(Gi,{fontSize:"xs",children:"Upload New Logo"}),T.jsx(Hi,{type:"file",accept:"image/*",onChange:oi,ref:ne,display:"none"}),F&&T.jsxs(ft,{mt:3,mb:3,children:[T.jsxs(at,{fontSize:"xs",mb:1,children:["Uploading... ",Z,"%"]}),T.jsx(Uy,{value:Z,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),T.jsxs(yr,{mt:3,spacing:3,children:[T.jsx(Jn,{colorScheme:"blue",leftIcon:T.jsx(En,{as:Ry}),onClick:xa,isDisabled:F,size:"sm",variant:"outline",children:"Browse"}),T.jsx(Jn,{colorScheme:"green",leftIcon:T.jsx(En,{as:yk}),onClick:so,isLoading:F,loadingText:"Uploading...",isDisabled:!I||F,size:"sm",children:"Upload"})]}),T.jsx(n0,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: PNG format with transparent background. Max height: 400px."})]})]}),T.jsxs(Ic,{p:4,display:"flex",flexDirection:"column",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Background"}),T.jsx(at,{fontSize:"xs",mb:4,children:"Upload a background for your space. This will be displayed during loading."}),T.jsxs(T0,{variant:"enclosed",colorScheme:"blue",size:"md",mb:4,borderColor:"blue.300",children:[T.jsxs(w0,{children:[T.jsxs(Ra,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[T.jsx(En,{as:Ry,mr:2}),"Image"]}),T.jsxs(Ra,{fontSize:"sm",fontWeight:"medium",_selected:{color:"blue.300",bg:"whiteAlpha.200"},p:3,children:[T.jsx(En,{as:dQ,mr:2}),"Video (max 5MB)"]})]}),T.jsxs(LC,{mt:4,children:[T.jsxs(Ic,{p:0,children:[(Oe||J)&&T.jsxs(ji,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[Oe&&T.jsxs(ft,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[T.jsx(at,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Background"}),T.jsx(rp,{src:Oe,alt:"Space Background",maxH:"120px",mx:"auto",objectFit:"contain"}),T.jsx(Jn,{mt:3,colorScheme:"red",leftIcon:T.jsx(En,{as:u0}),onClick:Es,isLoading:se,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Background"})]}),J&&T.jsxs(ft,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[T.jsx(at,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),T.jsx(rp,{src:J,alt:"Preview",maxH:"120px",mx:"auto",objectFit:"contain"})]})]}),T.jsxs(kr,{children:[T.jsx(Gi,{fontSize:"xs",children:"Upload New Background Image"}),T.jsx(Hi,{type:"file",accept:"image/*",onChange:Zo,ref:xe,display:"none"}),se&&T.jsxs(ft,{mt:3,mb:3,children:[T.jsxs(at,{fontSize:"xs",mb:1,children:["Uploading... ",he,"%"]}),T.jsx(Uy,{value:he,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),T.jsxs(yr,{mt:3,spacing:3,children:[T.jsx(Jn,{colorScheme:"blue",leftIcon:T.jsx(En,{as:Ry}),onClick:lc,isDisabled:se,size:"sm",variant:"outline",children:"Browse"}),T.jsx(Jn,{colorScheme:"green",leftIcon:T.jsx(En,{as:yk}),onClick:oo,isLoading:se,loadingText:"Uploading...",isDisabled:!pe||se,size:"sm",children:"Upload"})]}),T.jsx(n0,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: High-quality image (1920x1080 or higher) that works well with the frosted glass overlay."})]})]}),T.jsxs(Ic,{p:0,children:[(Be||be)&&T.jsxs(ji,{direction:{base:"column",md:"row"},gap:4,mb:4,children:[Be&&T.jsxs(ft,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[T.jsx(at,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Current Video Background"}),T.jsx(ft,{maxH:"160px",overflow:"hidden",position:"relative",children:T.jsx("video",{src:Be,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})}),T.jsx(Jn,{mt:3,colorScheme:"red",leftIcon:T.jsx(En,{as:u0}),onClick:Mo,isLoading:Pe,loadingText:"Removing...",size:"xs",variant:"ghost",children:"Remove Video"})]}),be&&T.jsxs(ft,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",flex:"1",children:[T.jsx(at,{fontSize:"xs",fontWeight:"medium",mb:2,children:"Preview"}),T.jsx(ft,{maxH:"160px",overflow:"hidden",children:T.jsx("video",{src:be,controls:!0,muted:!0,style:{width:"100%",maxHeight:"120px",objectFit:"contain"}})})]})]}),T.jsxs(kr,{children:[T.jsx(Gi,{fontSize:"xs",children:"Upload New Video Background"}),T.jsx(Hi,{type:"file",accept:"video/*",onChange:cc,ref:$e,display:"none"}),Pe&&T.jsxs(ft,{mt:3,mb:3,children:[T.jsxs(at,{fontSize:"xs",mb:1,children:["Uploading... ",ke,"%"]}),T.jsx(Uy,{value:ke,size:"xs",colorScheme:"blue",borderRadius:"full"})]}),T.jsxs(yr,{mt:3,spacing:3,children:[T.jsx(Jn,{colorScheme:"blue",leftIcon:T.jsx(En,{as:dQ}),onClick:vl,isDisabled:Pe,size:"sm",variant:"outline",children:"Browse"}),T.jsx(Jn,{colorScheme:"green",leftIcon:T.jsx(En,{as:yk}),onClick:Da,isLoading:Pe,loadingText:"Uploading...",isDisabled:!Re||Pe,size:"sm",children:"Upload"})]}),T.jsx(n0,{fontSize:"xs",color:"whiteAlpha.700",mt:2,children:"Recommended: MP4 format. Maximum file size: 5MB. Short looping videos work best."})]})]})]})]})]}),T.jsxs(Ic,{p:4,display:"flex",flexDirection:"column",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Space Settings"}),T.jsx(at,{fontSize:"xs",mb:4,children:"Configure settings for your space."}),T.jsxs(pi,{spacing:4,align:"stretch",children:[T.jsx(ft,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:T.jsxs(yr,{justify:"space-between",align:"center",children:[T.jsxs(ft,{children:[T.jsxs(yr,{mb:1,spacing:2,children:[T.jsxs(ft,{position:"relative",w:"16px",h:"16px",children:[T.jsx(En,{as:KWe,color:mt?"red.400":"green.400"}),mt&&T.jsx(ft,{position:"absolute",top:"50%",left:"0",right:"0",height:"2px",bg:"red.400",transform:"rotate(45deg)",transformOrigin:"center"})]}),T.jsx(at,{fontSize:"sm",fontWeight:"600",children:"Voice Chat"})]}),T.jsx(at,{fontSize:"xs",color:"whiteAlpha.800",children:mt?"Voice chat is currently disabled for all users in this space.":"Voice chat is currently enabled for all users in this space."})]}),T.jsx(hp,{isChecked:!mt,onChange:La,colorScheme:"green",size:"md",isDisabled:Te})]})}),T.jsx(ft,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:T.jsxs(yr,{justify:"space-between",align:"center",children:[T.jsxs(ft,{children:[T.jsxs(yr,{mb:1,spacing:2,children:[T.jsx(ft,{position:"relative",w:"16px",h:"16px",children:T.jsx(En,{as:hQ,color:Xt?"green.400":"red.400"})}),T.jsx(at,{fontSize:"sm",fontWeight:"600",children:"Public Access"})]}),T.jsx(at,{fontSize:"xs",color:"whiteAlpha.800",children:Xt?"This space is accessible to all users in the 'users' group.":"This space is only accessible to specific users."}),T.jsx(at,{fontSize:"xs",color:"blue.300",mt:1,children:"Note: Space owners and hosts will always have access regardless of this setting."})]}),T.jsx(hp,{isChecked:Xt,onChange:uc,colorScheme:"green",size:"md",isDisabled:Te})]})}),T.jsxs(tp,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",children:[T.jsx(np,{color:"blue.300"}),T.jsxs(ft,{children:[T.jsx(HS,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),T.jsx($S,{fontSize:"xs",children:"Additional space configuration options will be available in a future update."})]})]})]})]}),T.jsxs(Ic,{p:4,display:"flex",flexDirection:"column",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Manage Users"}),T.jsx(at,{fontSize:"xs",mb:4,children:"View and manage the owners and hosts of this space."}),He?T.jsx(ji,{justify:"center",align:"center",h:"200px",children:T.jsx(qd,{color:"blue.300"})}):T.jsxs(pi,{spacing:4,align:"stretch",children:[T.jsxs(ft,{children:[T.jsxs(yr,{mb:2,children:[T.jsx(En,{as:zWe,color:"green.400"}),T.jsx(at,{fontSize:"sm",fontWeight:"600",children:"Owners"}),T.jsx(Of,{colorScheme:"green",ml:2,children:it.length})]}),T.jsx(ft,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:it.length===0?T.jsx(at,{fontSize:"xs",color:"whiteAlpha.600",children:"No owners found"}):T.jsx(pi,{spacing:1,align:"stretch",children:it.map(vt=>T.jsxs(yr,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[T.jsx(Ep,{size:"xs",src:vt.photoURL,name:vt.displayName}),T.jsxs(ft,{children:[T.jsx(at,{fontSize:"xs",children:vt.displayName}),T.jsx(at,{fontSize:"xs",color:"whiteAlpha.600",children:vt.firstName&&vt.lastName?`${vt.firstName} ${vt.lastName}`:"Full name not available"})]}),T.jsx(xC,{}),T.jsx(Of,{colorScheme:"green",variant:"solid",fontSize:"2xs",children:"Owner"})]},vt.uid))})})]}),T.jsxs(ft,{children:[T.jsxs(yr,{mb:2,children:[T.jsx(En,{as:$We,color:"purple.400"}),T.jsx(at,{fontSize:"sm",fontWeight:"600",children:"Hosts"}),T.jsx(Of,{colorScheme:"purple",ml:2,children:Ct.length})]}),T.jsx(ft,{borderWidth:"1px",borderRadius:"md",p:2,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",maxH:"120px",overflowY:"auto",css:{"&::-webkit-scrollbar":{width:"4px"},"&::-webkit-scrollbar-track":{background:"rgba(0,0,0,0.1)"},"&::-webkit-scrollbar-thumb":{background:"rgba(255,255,255,0.3)",borderRadius:"2px"}},children:Ct.length===0?T.jsx(at,{fontSize:"xs",color:"whiteAlpha.600",children:"No hosts found"}):T.jsx(pi,{spacing:1,align:"stretch",children:Ct.map(vt=>T.jsxs(yr,{spacing:2,p:1,borderRadius:"md",_hover:{bg:"whiteAlpha.100"},children:[T.jsx(Ep,{size:"xs",src:vt.photoURL,name:vt.displayName}),T.jsxs(ft,{children:[T.jsx(at,{fontSize:"xs",children:vt.displayName}),T.jsx(at,{fontSize:"xs",color:"whiteAlpha.600",children:vt.firstName&&vt.lastName?`${vt.firstName} ${vt.lastName}`:"Full name not available"})]}),T.jsx(xC,{}),T.jsx(Of,{colorScheme:"purple",variant:"solid",fontSize:"2xs",children:"Host"})]},vt.uid))})})]}),T.jsx(wg,{borderColor:"whiteAlpha.200"}),T.jsxs(tp,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",py:2,fontSize:"xs",children:[T.jsx(np,{color:"blue.300",boxSize:4}),T.jsxs(ft,{children:[T.jsx(HS,{fontSize:"xs",fontWeight:"medium",children:"Coming Soon"}),T.jsx($S,{fontSize:"xs",children:"User management features like adding/removing hosts and owners will be available in a future update."})]})]})]})]}),T.jsxs(Ic,{p:4,display:"flex",flexDirection:"column",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,color:"blue.300",children:"Stream Settings"}),T.jsxs(pi,{spacing:4,align:"stretch",children:[T.jsx(ft,{borderWidth:"1px",borderRadius:"md",p:3,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:T.jsxs(yr,{justify:"space-between",align:"center",children:[T.jsx(ft,{children:T.jsxs(yr,{mb:1,spacing:2,children:[T.jsx(ft,{position:"relative",w:"16px",h:"16px",children:T.jsx(En,{as:qS,color:Ke?"green.400":"red.400"})}),T.jsx(at,{fontSize:"sm",fontWeight:"600",children:"Streaming Enabled"})]})}),T.jsx(hp,{isChecked:Ke,onChange:async()=>{const vt=!Ke;gt(vt),ir(!0);try{$.log("SpaceManageModal: Auto-saving streaming enabled state:",vt);const pn={enabled:vt,streamUrl:Et||"",rtmpUrl:Kt||"",streamKey:vn||"",playerIndex:"0",updatedAt:new Date().toISOString()};try{await HV(i,pn),$.log("SpaceManageModal: Successfully updated streaming enabled state in Firebase directly")}catch(vr){throw $.error("SpaceManageModal: Error updating streaming state directly in Firebase:",vr),vr}await Ut(Et,0,{enabled:vt,rtmpUrl:Kt,streamKey:vn}),window.dispatchEvent(new CustomEvent("StreamSettingsChanged",{detail:{enabled:vt,spaceId:i}})),gn({title:"Streaming "+(vt?"Enabled":"Disabled"),description:`Streaming is now ${vt?"enabled":"disabled"}.`,status:"success",duration:2e3,isClosable:!0})}catch(pn){$.error("Error auto-saving streaming state:",pn),gt(!vt),gn({title:"Error",description:"Failed to update streaming status",status:"error",duration:3e3,isClosable:!0})}finally{ir(!1),setTimeout(()=>{Ni()},500)}},colorScheme:"green",size:"md",isDisabled:Tt})]})}),T.jsxs(ft,{borderWidth:"1px",borderRadius:"md",p:4,bg:"whiteAlpha.50",borderColor:"whiteAlpha.200",children:[T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,children:"Stream Configuration"}),T.jsxs(kr,{mb:4,children:[T.jsx(Gi,{fontSize:"xs",children:"Stream URL"}),T.jsx(Hi,{value:Et,onChange:vt=>wt(vt.target.value),placeholder:"https://example.com/stream.m3u8",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Tt})]}),T.jsx(wg,{my:3,borderColor:"whiteAlpha.200"}),T.jsx(at,{fontSize:"sm",fontWeight:"600",mb:3,children:"RTMP Configuration"}),T.jsxs(kr,{mb:3,children:[T.jsx(Gi,{fontSize:"xs",children:"RTMP URL"}),T.jsx(Hi,{value:Kt,onChange:vt=>mn(vt.target.value),placeholder:"rtmp://example.com/live",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Tt})]}),T.jsxs(kr,{mb:3,children:[T.jsx(Gi,{fontSize:"xs",children:"Stream Key"}),T.jsx(Hi,{value:vn,onChange:vt=>rn(vt.target.value),placeholder:"xxxxxxxxxxxxxxxxxxxxxxxx",size:"sm",bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},_focus:{borderColor:"blue.300",boxShadow:"0 0 0 1px #63B3ED"},color:"white",isDisabled:Tt,type:"password"})]})]}),T.jsx(Jn,{colorScheme:"blue",size:"sm",onClick:Di,isLoading:Tt,loadingText:"Saving...",alignSelf:"flex-start",mt:2,display:Ke?"inline-flex":"none",children:"Save Stream Settings"}),T.jsxs(tp,{status:"info",variant:"subtle",bg:"whiteAlpha.100",borderRadius:"md",borderWidth:"1px",borderColor:"blue.800",mt:2,mb:8,children:[T.jsx(np,{color:"blue.300"}),T.jsxs(ft,{children:[T.jsx(HS,{fontSize:"xs",fontWeight:"medium",children:"HLS Streaming"}),T.jsx($S,{fontSize:"xs",children:"After saving, the stream will be available on all screens. Player index: 0"})]})]})]})]})]})]})})]})]})},Uoe="spaces",Voe="portals",n8e=async(n,t,i)=>{try{const a=gr(zn,Uoe,n,Voe,t),l={...i,sourceSpaceId:n,portalId:t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await jg(a,l),$.log(`Saved portal ${t} to space ${n}`),!0}catch(a){return $.error("Error saving portal:",a),!1}},pQ=async(n,t,i)=>{try{const a=gr(zn,Uoe,n,Voe,t),l={...i,updatedAt:new Date().toISOString()};return await Gs(a,l),$.log(`Updated portal ${t} in space ${n}`),!0}catch(a){return $.error("Error updating portal:",a),!1}},r8e=({isOpen:n,onClose:t,currentSpaceId:i})=>{const[a,l]=N.useState([]),[d,f]=N.useState(!1),[_,v]=N.useState(null),[b,C]=N.useState(!1),I=Na(),{placePortal:O,directPlacePortal:L}=uoe(),M=bg("rgba(240, 240, 240, 0.95)","rgba(35, 35, 35, 0.95)"),F=bg("gray.800","white"),z=bg("gray.200","whiteAlpha.200"),Z=bg("gray.200","whiteAlpha.300");N.useEffect(()=>{n&&(async()=>{f(!0),v(null),l([]);try{const ne=Ql(zn,"spaces"),X=(await qu(ne)).docs.map(J=>({id:J.id,name:J.data().name||`Space ID: ${J.id}`}));l(X)}catch(ne){$.error("PortalAdminModal: Error fetching spaces:",ne),v("Failed to load spaces. Please check your connection and try again.")}f(!1)})()},[n]);const K=async(ae,ne)=>{if(!i){$.error("PortalAdminModal: currentSpaceId is not defined. Cannot save portal."),I({title:"Error",description:"Cannot place portal: Current space ID is missing.",status:"error",duration:5e3,isClosable:!0});return}C(!0),$.log(`PortalAdminModal: Attempting to place portal to ${ne} (${ae}) in space ${i}`);try{const pe=await Gu(ae);if(!pe)throw new Error(`Failed to fetch target space data for ${ae}`);const X=pe.backgroundUrl||pe.backgroundGsUrl;X||$.warn(`PortalAdminModal: No background image URL found for target space: ${ae}`);const J="PortalObjectPrefab",Q={x:0,y:1.5,z:0},se={x:0,y:0,z:0},de={x:1,y:1,z:1},he=`portal_${i}_${ae}_${Date.now()}`;if(!await n8e(i,he,{type:"portal",targetSpaceId:ae,targetSpaceName:ne,portalId:he,position:Q,rotation:se,scale:de,prefabName:J,initialImageUrl:X})){$.error(`PortalAdminModal: Failed to save portal data to Firebase for space ${i}.`),I({title:"Save Error",description:"Failed to save portal data to database.",status:"error",duration:5e3,isClosable:!0}),C(!1);return}$.log(`PortalAdminModal: Portal data saved to Firebase for space ${i}.`);let Ve=!1;try{const xe={portalId:he,prefabName:J,position:Q,rotation:se,scale:de,initialImageUrl:X};Ve=O(he,J,Q,se,de,X),Ve||(Ve=L(he,J,Q,se,de,X)),$.log("PortalAdminModal: Portal placement in Unity:",Ve)}catch(xe){$.error("PortalAdminModal: Error placing portal in Unity:",xe)}Ve?(I({title:"Portal Placed",description:`Portal to ${ne} created successfully.`,status:"success",duration:3e3,isClosable:!0}),t()):(I({title:"Portal Saved",description:"Portal data saved. It will appear when Unity is ready.",status:"info",duration:5e3,isClosable:!0}),t())}catch(pe){$.error("PortalAdminModal: Error creating portal:",pe),I({title:"Error",description:"Failed to create portal. Please try again.",status:"error",duration:5e3,isClosable:!0})}finally{C(!1)}},re=d||b;return T.jsxs(Fs,{isOpen:n,onClose:t,size:"lg",isCentered:!0,scrollBehavior:"inside",children:[T.jsx(Ws,{bg:"blackAlpha.700",backdropFilter:"blur(8px)"}),T.jsxs(Bs,{bg:M,backdropFilter:"blur(18px)",color:F,borderRadius:"lg",maxHeight:"80vh",boxShadow:"2xl",children:[T.jsx(xo,{borderBottom:"1px solid",borderColor:Z,fontSize:"lg",fontWeight:"semibold",children:"Select a Space to Create Portal To"}),T.jsx(io,{}),T.jsxs(zs,{p:6,children:[re&&T.jsxs(pi,{justifyContent:"center",alignItems:"center",height:"200px",children:[T.jsx(qd,{size:"xl",thickness:"4px",speed:"0.65s",emptyColor:"gray.200",color:"blue.500"}),T.jsx(at,{mt:3,children:"Loading Spaces..."})]}),_&&T.jsxs(tp,{status:"error",borderRadius:"md",variant:"subtle",children:[T.jsx(np,{}),_]}),!d&&!_&&a.length===0&&T.jsx(at,{textAlign:"center",py:10,children:"No spaces found or you may not have permission to view them."}),!d&&!_&&a.length>0&&T.jsx(R1,{spacing:3,children:a.map(ae=>T.jsx(dne,{p:3,borderRadius:"md",_hover:{bg:z,cursor:re?"not-allowed":"pointer",transform:re?"none":"scale(1.02)"},transition:"background-color 0.2s ease-in-out, transform 0.2s ease-in-out",onClick:()=>!re&&K(ae.id,ae.name),borderWidth:"1px",borderColor:"transparent",_focus:{boxShadow:"outline"},opacity:re?.7:1,pointerEvents:re?"none":"auto",children:ae.name},ae.id))})]})]})]})},fQ=["Recent","Furniture","Objects","Upload","Portals"],i8e={Furniture:"chair",Objects:"misc"},s8e=({isOpen:n,onClose:t,settings:i})=>{const[a,l]=N.useState(fQ[0]),[d,f]=N.useState(""),[_,v]=N.useState(!1),[b,C]=N.useState(!1),[I,O]=N.useState([]),[L,M]=N.useState(!0),[F,z]=N.useState(null),{placeCatalogueItem:Z}=doe(),K=bg("blue.500","blue.300"),re=bg("gray.500","gray.400"),ae=bg("whiteAlpha.200","whiteAlpha.200");N.useEffect(()=>{n&&(async()=>{M(!0),z(null),O([]);try{const he=Ql(zn,"catalogue"),le=await qu(he),Oe=[];le.forEach(Ve=>{var ve,be;const xe=Ve.data(),Re=["chair","misc"];xe.glbUrl&&((ve=xe.categories)!=null&&ve.some(ze=>Re.includes(ze)))&&Oe.push({id:Ve.id,name:xe.name||"Unnamed Item",thumbnail:((be=xe.thumbnail)==null?void 0:be.src)||"https://via.placeholder.com/150",glbUrl:xe.glbUrl,categories:xe.categories})}),O(Oe)}catch(he){console.error("Error fetching catalogue items:",he),z("Failed to load catalogue items. Please check your connection and try again.")}M(!1)})()},[n]);const ne=de=>{l(de),f(""),v(de==="Portals")},pe=(de,he)=>{const le=i8e[he];let Oe=de;return le&&(Oe=Oe.filter(Ve=>{var xe;return(xe=Ve.categories)==null?void 0:xe.includes(le)})),d&&(Oe=Oe.filter(Ve=>Ve.name.toLowerCase().includes(d.toLowerCase()))),Oe},X=["Furniture","Objects"].includes(a)?pe(I,a):[],J=async de=>{console.log(`Placing item: ${de.name}`);try{if(!de.glbUrl){console.error("Item is missing GLB URL");return}const he=`item_${i.spaceID}_${Date.now()}`,le={x:0,y:0,z:0},Oe={x:0,y:0,z:0},Ve={x:1,y:1,z:1},xe={itemId:he,name:de.name||"Unnamed Item",glbUrl:de.glbUrl,thumbnail:de.thumbnail||"https://via.placeholder.com/150",position:le,rotation:Oe,scale:Ve,createdAt:Date.now(),updatedAt:Date.now(),categories:de.categories||[]};if(!xe.glbUrl)throw new Error("GLB URL is required");await jg(gr(zn,"spaces",i.spaceID,"catalogue",he),xe),Z(he,xe.glbUrl,le,Oe,Ve)?t():console.error("Failed to place item in Unity")}catch(he){console.error("Error placing item:",he)}},Q=()=>{C(!0)},se=()=>{C(!1)};return T.jsxs(Fs,{isOpen:n,onClose:t,size:"5xl",isCentered:!0,children:[T.jsx(Ws,{bg:"blackAlpha.600",backdropFilter:"blur(5px)"}),T.jsxs(Bs,{bg:"rgba(30, 30, 30, 0.85)",backdropFilter:"blur(15px)",color:"white",borderRadius:"xl",height:"85vh",maxHeight:"750px",width:"85vw",maxWidth:"1200px",overflow:"hidden",children:[T.jsx(xo,{pb:2,borderBottom:"1px solid",borderColor:"whiteAlpha.300",children:_?"Create New Portal":"Content Catalogue"}),T.jsx(io,{top:"14px"}),T.jsxs(zs,{p:0,display:"flex",flexDirection:"column",height:"calc(100% - 60px)",children:[T.jsxs(yr,{spacing:4,p:4,borderBottom:"1px solid",borderColor:"whiteAlpha.300",overflowX:"auto",children:[fQ.filter(de=>de!=="Portals").map(de=>T.jsx(Jn,{variant:"ghost",size:"md",fontWeight:a===de?"semibold":"normal",color:a===de?"white":re,bg:a===de?ae:"transparent",borderBottom:a===de?`2px solid ${K}`:"2px solid transparent",borderRadius:"md",_hover:{bg:a!==de?"whiteAlpha.100":ae,color:"white"},onClick:()=>ne(de),px:4,whiteSpace:"nowrap",children:de},de)),T.jsx(xC,{}),T.jsx(Jn,{variant:"ghost",size:"md",fontWeight:a==="Portals"?"semibold":"normal",color:a==="Portals"?"white":re,bg:a==="Portals"?ae:"transparent",borderBottom:a==="Portals"?`2px solid ${K}`:"2px solid transparent",borderRadius:"md",_hover:{bg:a!=="Portals"?"whiteAlpha.100":ae,color:"white"},onClick:()=>ne("Portals"),px:4,whiteSpace:"nowrap",children:"Portals"},"Portals")]}),_&&a==="Portals"?T.jsx(ft,{p:4,flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",children:T.jsx(Jn,{size:"lg",colorScheme:"blue",onClick:Q,children:"Browse"})}):T.jsxs(T.Fragment,{children:[T.jsx(ft,{p:4,children:T.jsx(Hi,{placeholder:`Search in ${a}...`,value:d,onChange:de=>f(de.target.value),bg:"rgba(255, 255, 255, 0.05)",borderColor:"rgba(255, 255, 255, 0.2)",borderRadius:"md",size:"md",_placeholder:{color:"whiteAlpha.500"}})}),T.jsx(ft,{p:4,pt:0,overflowY:"auto",flexGrow:1,children:T.jsx(IF,{templateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:4,children:L?T.jsx(at,{color:"whiteAlpha.700",children:"Loading items..."}):X.length>0?X.map(de=>T.jsxs(ft,{p:2,bg:"whiteAlpha.100",borderRadius:"lg",textAlign:"center",cursor:"pointer",_hover:{bg:"whiteAlpha.300",transform:"scale(1.03)"},onClick:()=>J(de),transition:"all 0.2s ease-in-out",display:"flex",flexDirection:"column",children:[T.jsx(ft,{bgImage:`url(${de.thumbnail})`,bgSize:"contain",bgRepeat:"no-repeat",bgPos:"center",borderRadius:"md",h:"100px",mb:2,flexShrink:0}),T.jsx(at,{fontSize:"xs",noOfLines:2,flexGrow:1,display:"flex",alignItems:"center",justifyContent:"center",children:de.name})]},de.id)):T.jsxs(at,{color:"whiteAlpha.700",children:[a==="Furniture"&&"No chairs found in the catalogue.",a==="Objects"&&"No miscellaneous objects found in the catalogue.",!["Furniture","Objects"].includes(a)&&`No items found in "${a}"${d&&` matching "${d}"`}.`]})})})]})]})]}),T.jsx(r8e,{isOpen:b,onClose:se,currentSpaceId:i==null?void 0:i.spaceID})]})},o8e=({onTogglePlayerList:n,spaceID:t})=>{const{fullscreenRef:i}=Yd(),[a,l]=N.useState(!0),[d,f]=N.useState(!1),[_,v]=N.useState(!1),[b,C]=N.useState(!1),[I,O]=N.useState(!1),[L,M]=N.useState(!1),[F,z]=N.useState(!1),[Z,K]=N.useState(null),[re,ae]=N.useState(!1),[ne,pe]=N.useState(!1),[X,J]=N.useState(!1),[Q,se]=N.useState(!1),de=Na(),{user:he}=N.useContext(Nc),le=(he==null?void 0:he.Nickname)||"Unknown",[Oe,Ve]=N.useState(!1),xe=async()=>{if(he!=null&&he.uid&&t)try{const qe=await Yu(he.uid);let $e=!1,it=!1;if(qe.groups){const Ct=`space_${t}_owners`,kt=`space_${t}_hosts`;$e=qe.groups.includes(Ct),it=qe.groups.includes(kt)}const Je=await lN(he.uid,"disruptiveAdmin");if(se(Je),K({rpmURL:qe.rpmURL?qe.rpmURL.replace(".glb",".png?scene=fullbody-portrait-closeupfront&w=640&q=75"):null}),pe($e||Je),J(it),!$e&&!Je&&re){ae(!1);const Ct=new CustomEvent("editModeChanged",{detail:{enabled:!1}});window.dispatchEvent(Ct),de({title:"Edit Mode Disabled",description:"You don't have permission to edit this space.",status:"warning",duration:5e3,isClosable:!0,position:"top"})}}catch(qe){console.error("Error fetching profile data:",qe),pe(!1),J(!1),se(!1)}else pe(!1),J(!1),se(!1)};N.useEffect(()=>{xe()},[he==null?void 0:he.uid,t,re]),N.useEffect(()=>{const qe=()=>{l(!0)};return window.addEventListener("PlayerInstantiated",qe),()=>{window.removeEventListener("PlayerInstantiated",qe)}},[]),N.useEffect(()=>{(async()=>{try{window.agoraClient&&typeof window.agoraClient.voiceDisabled=="boolean"&&Ve(window.agoraClient.voiceDisabled)}catch(it){console.error("Error checking if voice is disabled:",it)}})();const $e=it=>{it.detail&&typeof it.detail.voiceDisabled=="boolean"&&(console.log("Voice setting changed:",it.detail.voiceDisabled),Ve(it.detail.voiceDisabled))};return window.addEventListener("SpaceVoiceSettingChanged",$e),()=>{window.removeEventListener("SpaceVoiceSettingChanged",$e)}},[]);const Re=()=>v(!_),ve=()=>C(!b),be=()=>{M(!L),Ue()},ze=()=>{O(!1),xe()},Pe=()=>{z(!1)},we=()=>{z(!0),Ue()},ke=qe=>{qe.stopPropagation(),typeof n=="function"&&($.log("CanvasMainMenu: Toggling player list"),n())},Ue=()=>{f(!1)},Be=qe=>{if(qe.stopPropagation(),!ne){de({title:"Permission Denied",description:"You don't have permission to edit this space. Only space owners can use Edit Mode.",status:"error",duration:5e3,isClosable:!0,position:"top"});return}const $e=!re;ae($e);const it=new CustomEvent("editModeChanged",{detail:{enabled:$e}});window.dispatchEvent(it),de({title:$e?"Edit Mode Enabled":"Edit Mode Disabled",description:$e?"You can now make changes to the scene.":"Scene editing is now disabled.",status:$e?"info":"success",duration:3e3,isClosable:!0,position:"top"})};return T.jsxs(T.Fragment,{children:[T.jsxs(A1,{isOpen:d,onClose:()=>f(!1),children:[T.jsx(P1,{as:ko,icon:T.jsx(tWe,{}),"aria-label":"Main menu",variant:"ghost",color:"white",bg:d?"whiteAlpha.400":"whiteAlpha.200",_hover:{bg:d?"whiteAlpha.500":"whiteAlpha.300"},size:"md",onClick:()=>f(!d)}),T.jsx(Ju,{containerRef:i,children:T.jsx(O1,{bg:"rgba(0,0,0,0.4)",backdropFilter:"blur(10px)",border:"none",boxShadow:"lg",color:"white",width:"300px",p:4,borderRadius:"xl",zIndex:9999,transform:"none !important",children:T.jsxs(pi,{align:"stretch",spacing:4,children:[T.jsxs(yr,{children:[T.jsx(Ep,{size:"md",src:Z==null?void 0:Z.rpmURL,bg:"white",name:" ",borderWidth:"1px",borderColor:"whiteAlpha.300"}),T.jsxs(pi,{align:"start",spacing:0,children:[T.jsxs(yr,{children:[T.jsx(at,{fontWeight:"bold",children:le}),ne&&!Q&&T.jsx(jf,{label:"Owner",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:T.jsx(ft,{display:"inline-block",children:T.jsx(En,{as:ZV,color:"green.400",boxSize:3})})}),!ne&&X&&!Q&&T.jsx(jf,{label:"Host",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:T.jsx(ft,{display:"inline-block",children:T.jsx(En,{as:nj,color:"purple.400",boxSize:3})})}),Q&&T.jsx(jf,{label:"Admin",placement:"top",hasArrow:!0,zIndex:1e4,openDelay:300,gutter:8,portalProps:{containerRef:i},children:T.jsx(ft,{display:"inline-block",children:T.jsx(En,{as:gWe,color:"blue.400",boxSize:3})})})]}),T.jsx(at,{fontSize:"sm",color:"whiteAlpha.800",children:"Spaces Metaverse"})]})]}),T.jsxs(yr,{spacing:4,justify:"center",children:[T.jsx(ko,{icon:T.jsx(yWe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"People",_hover:{bg:"whiteAlpha.200"},onClick:ke}),ne&&T.jsx(ko,{icon:T.jsx(lWe,{}),variant:"ghost",colorScheme:re?"green":"whiteAlpha",size:"sm","aria-label":"Edit Mode",_hover:{bg:"whiteAlpha.200"},onClick:Be}),!re&&T.jsx(ko,{icon:T.jsx(ft,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 3",_hover:{bg:"whiteAlpha.200"},isDisabled:!0}),re&&T.jsx(ko,{icon:T.jsx(cWe,{}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Catalogue",_hover:{bg:"whiteAlpha.200"},onClick:we}),T.jsx(ko,{icon:T.jsx(ft,{w:"4",h:"4"}),variant:"ghost",colorScheme:"whiteAlpha",size:"sm","aria-label":"Action 4",_hover:{bg:"whiteAlpha.200"}})]}),T.jsx(wg,{borderColor:"whiteAlpha.300"}),T.jsxs(pi,{align:"stretch",spacing:2,children:[ne&&T.jsxs(yr,{p:2,borderRadius:"md",_hover:{bg:"whiteAlpha.200"},justify:"space-between",children:[T.jsx(at,{fontSize:"md",children:"Edit Mode"}),T.jsx(hp,{id:"edit-mode-toggle",isChecked:re,onChange:Be,colorScheme:"green",sx:{"& .chakra-switch__track":{bg:re?"green.500":"black"}}})]}),ne&&T.jsx(at,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:be,children:"Manage Space"}),he&&t&&!Oe&&T.jsx(VWe,{onClose:Ue}),T.jsx(at,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:Re,children:"Settings"}),T.jsx(at,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:ve,children:"Controls"}),T.jsx(at,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",onClick:()=>window.open("https://support.spacesmetaverse.com/","_blank"),children:"Support"}),T.jsx(at,{fontSize:"md",cursor:"pointer",_hover:{bg:"whiteAlpha.200"},p:2,borderRadius:"md",color:"red.300",children:"Leave"})]})]})})})]}),b&&T.jsx(jWe,{open:b,onClose:ve}),_&&T.jsx(BWe,{open:_,onClose:Re}),I&&T.jsx(Poe,{open:I,onClose:ze}),T.jsx(t8e,{isOpen:L,onClose:be}),T.jsx(s8e,{isOpen:F,onClose:Pe,settings:{spaceID:t}})]})},a8e=({isOpen:n,onClose:t,mediaScreenId:i,onImageChange:a})=>{const{spaceID:l}=Qo(),d=ac(),f=Na(),_=N.useRef(null),v=N.useRef(null),b=N.useRef(),[C,I]=N.useState(null),[O,L]=N.useState(""),[M,F]=N.useState(!1),[z,Z]=N.useState(0),[K,re]=N.useState(null),[ae,ne]=N.useState(!0),[pe,X]=N.useState(!1),[J,Q]=N.useState(!1),[se,de]=N.useState(0),[he,le]=N.useState("image"),[Oe,Ve]=N.useState(""),[xe,Re]=N.useState(!1);N.useEffect(()=>{(async()=>{if(n&&i&&l){ne(!0);try{const Ct=await xf(l,i);if(Ct&&(Ct.imageUrl||Ct.videoUrl)){re(Ct);const kt=Ct.mediaType==="video";le(kt?"video":"image"),Re(Ct.displayAsVideo||!1),kt&&Ct.videoUrl&&(Ve(Ct.videoUrl),de(1))}else re(null)}catch(Ct){$.error("Error fetching existing image:",Ct),re(null)}finally{ne(!1)}}})()},[n,i,l]),N.useEffect(()=>{n||(I(null),L(""),Z(0),Ve(""))},[n]);const ve=N.useCallback(Je=>{Je.preventDefault(),Je.stopPropagation(),Q(!0)},[]),be=N.useCallback(Je=>{Je.preventDefault(),Je.stopPropagation(),Q(!1)},[]),ze=N.useCallback(Je=>{Je.preventDefault(),Je.stopPropagation()},[]),Pe=N.useCallback(Je=>{if(Je.preventDefault(),Je.stopPropagation(),Q(!1),Je.dataTransfer.files&&Je.dataTransfer.files.length>0){const Ct=Je.dataTransfer.files[0];we(Ct)}},[]);N.useEffect(()=>{const Je=v.current;if(Je)return Je.addEventListener("dragenter",ve),Je.addEventListener("dragleave",be),Je.addEventListener("dragover",ze),Je.addEventListener("drop",Pe),()=>{Je.removeEventListener("dragenter",ve),Je.removeEventListener("dragleave",be),Je.removeEventListener("dragover",ze),Je.removeEventListener("drop",Pe)}},[ve,be,ze,Pe]);const we=Je=>{if(!Je)return;if(!Je.type.startsWith("image/")){f({title:"Invalid file type",description:"Please select an image file (PNG, JPEG, etc.)",status:"error",duration:5e3,isClosable:!0});return}I(Je);const Ct=new FileReader;Ct.onloadend=()=>{L(Ct.result)},Ct.readAsDataURL(Je)},ke=Je=>{const Ct=Je.target.files[0];we(Ct)},Ue=async Je=>{const Ct=Je.target.checked;if(Re(Ct),K)try{await eze(l,i,Ct),Ct?d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!0}):d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:K.imageUrl||null,videoUrl:K.videoUrl||null,mediaType:K.mediaType||"image",displayAsVideo:!1}),re({...K,displayAsVideo:Ct}),f({title:"Display mode updated",description:`The media screen will now be displayed as ${Ct?"video":"image"}`,status:"success",duration:3e3,isClosable:!0}),$.log(`Updated display mode for media screen ${i} to ${Ct?"video":"image"}`),a&&a({type:"update",mediaScreenId:i,displayAsVideo:Ct})}catch(kt){$.error("Error updating display mode:",kt),f({title:"Update failed",description:kt.message||"An error occurred while updating the display mode",status:"error",duration:5e3,isClosable:!0}),Re(!Ct)}},Be=async()=>{if(he==="image"&&!C){f({title:"No file selected",description:"Please select an image to upload",status:"warning",duration:5e3,isClosable:!0});return}if(he==="video"&&!Oe){f({title:"No video URL",description:"Please enter a video URL",status:"warning",duration:5e3,isClosable:!0});return}try{F(!0);const Je=setInterval(()=>{Z(lt=>{const mt=lt+10;return mt>=90?90:mt})},300);let Ct;he==="image"?Ct=await $J(l,i,C,{mediaType:he,displayAsVideo:xe}):(Ct=Oe,await $J(l,i,null,{mediaType:"video",directUrl:Oe,displayAsVideo:xe})),clearInterval(Je),Z(100);let kt=null,He=null;he==="image"?(kt=xe?null:Ct,He=(K==null?void 0:K.videoUrl)||null):(kt=!xe&&(K!=null&&K.imageUrl)?K.imageUrl:null,He=Ct),d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:kt,videoUrl:He,mediaType:he,displayAsVideo:xe}),$.log(`Uploaded and sent ${he} for media screen ${i} (display as video: ${xe})`),a&&a({type:"upload",mediaScreenId:i,imageUrl:he==="image"?Ct:K==null?void 0:K.imageUrl,videoUrl:he==="video"?Ct:K==null?void 0:K.videoUrl,mediaType:he,displayAsVideo:xe}),f({title:"Upload successful",description:`The ${he} has been uploaded and applied to the media screen`,status:"success",duration:5e3,isClosable:!0}),setTimeout(()=>{I(null),L(""),F(!1),Z(0),t()},1e3)}catch(Je){$.error(`Error uploading ${he}:`,Je),f({title:"Upload failed",description:Je.message||`An error occurred while uploading the ${he}`,status:"error",duration:5e3,isClosable:!0}),F(!1),Z(0)}},qe=async()=>{X(!1);try{F(!0),await Z6e(l,i),d("SetMediaScreenImage",{mediaScreenId:i,imageUrl:he==="image"?null:(K==null?void 0:K.imageUrl)||null,videoUrl:he==="video"?null:(K==null?void 0:K.videoUrl)||null,mediaType:null,displayAsVideo:!1}),$.log(`Deleted ${he} for media screen ${i}`),a&&a({type:"delete",mediaScreenId:i}),f({title:`${he==="image"?"Image":"Video"} deleted`,description:`The ${he} has been removed from the media screen`,status:"success",duration:5e3,isClosable:!0}),re(null),F(!1),Ve(""),Re(!1),setTimeout(()=>{t()},500)}catch(Je){$.error(`Error deleting ${he}:`,Je),f({title:"Deletion failed",description:Je.message||`An error occurred while deleting the ${he}`,status:"error",duration:5e3,isClosable:!0}),F(!1)}},$e=()=>{M||(I(null),L(""),Z(0),t())},it=Je=>{de(Je),le(Je===0?"image":"video")};return T.jsxs(T.Fragment,{children:[T.jsxs(Fs,{isOpen:n,onClose:$e,size:"xl",children:[T.jsx(Ws,{backdropFilter:"blur(10px)"}),T.jsxs(Bs,{bg:"gray.800",color:"white",maxW:"900px",children:[T.jsx(xo,{children:"Media Screen Content"}),T.jsx(io,{isDisabled:M}),T.jsxs(ft,{px:6,pb:2,children:[T.jsxs(ji,{justify:"space-between",align:"center",bg:"gray.700",p:4,borderRadius:"md",mb:4,children:[T.jsxs(yr,{spacing:4,children:[T.jsx(at,{fontWeight:"medium",children:"Display as:"}),T.jsxs(yr,{spacing:2,children:[T.jsx(En,{as:Ry,color:xe?"gray.400":"green.300"}),T.jsx(hp,{colorScheme:"purple",size:"md",isChecked:xe,onChange:Ue}),T.jsx(En,{as:qS,color:xe?"purple.300":"gray.400"})]})]}),T.jsx(Of,{colorScheme:xe?"purple":"green",fontSize:"sm",px:2,py:1,borderRadius:"md",children:xe?"Video Output":"Image Output"})]}),T.jsxs(at,{fontSize:"sm",color:"gray.400",mb:1,children:["Media Screen ID: ",T.jsx("strong",{children:i})]}),T.jsx(at,{fontSize:"xs",color:"gray.500",mb:2,children:"The toggle above controls how the content will be displayed in the 3D space, regardless of the content type you upload."}),T.jsx(wg,{mb:4})]}),T.jsx(zs,{children:T.jsxs(ji,{children:[T.jsx(T0,{orientation:"vertical",variant:"solid-rounded",colorScheme:"blue",index:se,onChange:it,h:"100%",minW:"120px",mr:4,children:T.jsxs(w0,{children:[T.jsxs(Ra,{_selected:{color:"white",bg:"blue.500"},mb:2,py:6,justifyContent:"flex-start",children:[T.jsx(En,{as:Ry,mr:2})," Image"]}),T.jsxs(Ra,{_selected:{color:"white",bg:"blue.500"},py:6,justifyContent:"flex-start",children:[T.jsx(En,{as:qS,mr:2})," Video"]})]})}),T.jsx(ft,{flex:"1",children:ae?T.jsx(ji,{justify:"center",align:"center",h:"150px",children:T.jsx(qd,{size:"xl",color:"blue.400"})}):T.jsxs(T.Fragment,{children:[T.jsx(ft,{children:se===0?T.jsxs(pi,{spacing:4,align:"stretch",children:[K&&K.imageUrl&&he==="image"&&T.jsxs(ft,{children:[T.jsx(at,{fontWeight:"semibold",mb:2,children:"Current Image:"}),T.jsxs(ji,{children:[T.jsx(ft,{borderWidth:"1px",borderRadius:"md",overflow:"hidden",mb:2,maxW:"200px",mr:4,children:T.jsx(rp,{src:K.imageUrl,alt:"Current image",maxHeight:"150px",width:"100%",objectFit:"contain"})}),T.jsxs(pi,{align:"flex-start",spacing:2,children:[T.jsxs(at,{fontSize:"xs",color:"gray.400",children:["Uploaded: ",new Date(K.uploadedAt).toLocaleString()]}),T.jsxs(at,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),T.jsx(Jn,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:T.jsx(En,{as:u0}),onClick:()=>X(!0),isDisabled:M,children:"Delete"})]})]}),T.jsx(wg,{my:4})]}),T.jsx(at,{fontWeight:"semibold",mb:2,children:K&&K.imageUrl&&he==="image"?"Replace with new image:":"Upload new image:"}),T.jsxs(ft,{ref:v,borderWidth:"2px",borderRadius:"md",borderStyle:"dashed",borderColor:J?"blue.400":"gray.500",bg:J?"blue.900":"gray.700",p:6,textAlign:"center",transition:"all 0.2s",_hover:{borderColor:"blue.400",bg:"gray.600"},cursor:"pointer",onClick:()=>_.current.click(),children:[O?T.jsx(ft,{borderRadius:"md",overflow:"hidden",maxH:"200px",children:T.jsx(rp,{src:O,alt:"Preview",maxHeight:"200px",width:"100%",objectFit:"contain"})}):T.jsxs(pi,{spacing:2,children:[T.jsx(En,{as:yk,boxSize:"24px",color:"gray.400"}),T.jsx(at,{children:"Drag and drop an image here, or click to browse"}),T.jsx(at,{fontSize:"xs",color:"gray.400",children:"Supports PNG, JPG, JPEG, GIF"})]}),T.jsx(Hi,{type:"file",accept:"image/*",onChange:ke,ref:_,display:"none"})]}),C&&T.jsxs(at,{fontSize:"sm",children:["Selected file: ",C.name," (",Math.round(C.size/1024)," KB)"]})]}):T.jsxs(pi,{spacing:4,align:"stretch",children:[K&&K.videoUrl&&he==="video"&&T.jsxs(ft,{children:[T.jsx(at,{fontWeight:"semibold",mb:2,children:"Current Video URL:"}),T.jsxs(ji,{children:[T.jsx(ft,{borderWidth:"1px",borderRadius:"md",p:3,mb:2,flex:"1",mr:4,bg:"gray.700",children:T.jsx(at,{fontSize:"sm",wordBreak:"break-all",children:K.videoUrl})}),T.jsxs(pi,{align:"flex-start",spacing:2,children:[T.jsxs(at,{fontSize:"xs",color:"gray.400",children:["Added: ",new Date(K.uploadedAt).toLocaleString()]}),T.jsxs(at,{fontSize:"xs",color:"gray.400",children:["Display Mode: ",K.displayAsVideo?"Video":"Image"]}),T.jsx(Jn,{size:"sm",colorScheme:"red",variant:"outline",leftIcon:T.jsx(En,{as:u0}),onClick:()=>X(!0),isDisabled:M,children:"Delete"})]})]}),T.jsx(wg,{my:4})]}),T.jsx(at,{fontWeight:"semibold",mb:2,children:K&&K.videoUrl&&he==="video"?"Replace with new video:":"Add video URL:"}),T.jsx(ft,{p:3,bg:"blue.900",borderRadius:"md",mb:4,borderLeftWidth:"4px",borderLeftColor:"blue.400",children:T.jsxs(yr,{children:[T.jsx(En,{as:Loe,color:"blue.300"}),T.jsx(at,{fontSize:"sm",fontWeight:"medium",children:'After entering a URL, click the "Save Video URL" button at the bottom to save your changes.'})]})}),T.jsxs(kr,{children:[T.jsx(Gi,{fontSize:"sm",children:"Video URL"}),T.jsx(Hi,{placeholder:"Enter video URL (YouTube, Vimeo, etc.)",value:Oe,onChange:Je=>Ve(Je.target.value),bg:"gray.700",borderColor:"gray.600",_hover:{borderColor:"blue.400"},_focus:{borderColor:"blue.400",boxShadow:"0 0 0 1px var(--chakra-colors-blue-400)"},size:"lg"}),T.jsx(at,{fontSize:"xs",color:"gray.400",mt:1,children:"Enter a URL from YouTube, Vimeo, or other video hosting services"})]}),T.jsxs(ft,{mt:4,p:4,bg:"gray.700",borderRadius:"md",children:[T.jsxs(yr,{children:[T.jsx(En,{as:qS,color:"blue.300"}),T.jsx(at,{fontWeight:"medium",children:"Video Support"})]}),T.jsx(at,{fontSize:"sm",mt:2,color:"gray.300",children:"Video playback will be implemented in a future update. For now, you can add the URL which will be stored with the media screen."}),T.jsx(at,{fontSize:"sm",mt:2,color:"yellow.300",fontWeight:"medium",children:'Important: Click the "Upload" button at the bottom to save your video URL.'})]}),Oe&&T.jsxs(ft,{mt:4,p:4,bg:"gray.900",borderRadius:"md",borderWidth:"1px",borderColor:"blue.500",children:[T.jsxs(yr,{mb:2,children:[T.jsx(En,{as:GWe,color:"blue.300"}),T.jsx(at,{fontWeight:"medium",children:"URL Preview"})]}),T.jsx(at,{fontSize:"sm",wordBreak:"break-all",color:"gray.300",children:Oe}),T.jsx(at,{fontSize:"xs",color:"gray.400",mt:2,children:"This URL will be saved when you click the Upload button below"})]})]})}),M&&T.jsxs(ft,{mt:4,children:[T.jsxs(at,{mb:2,children:["Uploading: ",z,"%"]}),T.jsx(Uy,{value:z,colorScheme:"blue",size:"sm",borderRadius:"md"})]})]})})]})}),T.jsxs(Sp,{children:[T.jsx(Jn,{variant:"ghost",mr:3,onClick:$e,isDisabled:M,children:"Cancel"}),T.jsx(Jn,{colorScheme:"blue",onClick:Be,isLoading:M,loadingText:"Uploading",isDisabled:he==="image"&&!C||he==="video"&&!Oe||M||ae,leftIcon:T.jsx(En,{as:he==="image"?Ry:qS}),size:"lg",px:6,children:he==="image"?"Upload Image":"Save Video URL"})]})]})]}),T.jsx(F2e,{isOpen:pe,leastDestructiveRef:b,onClose:()=>X(!1),children:T.jsx(Ws,{children:T.jsxs(B2e,{bg:"gray.800",color:"white",children:[T.jsxs(xo,{fontSize:"lg",fontWeight:"bold",children:["Delete ",he==="video"?"Video":"Image"]}),T.jsxs(zs,{children:["Are you sure you want to delete this ",he,"? This will revert the media screen to its blank state."]}),T.jsxs(Sp,{children:[T.jsx(Jn,{ref:b,onClick:()=>X(!1),children:"Cancel"}),T.jsx(Jn,{colorScheme:"red",onClick:qe,ml:3,leftIcon:T.jsx(En,{as:u0}),children:"Delete"})]})]})})})]})},c8e=n=>{const[t,i]=N.useState(null),[a,l]=N.useState(""),[d,f]=N.useState(null),[_,v]=N.useState(!1),b=El(),{spaceID:C}=Qo(),I=N.useCallback(M=>{var F,z;try{if(!M)return null;if(M.includes("youtube.com")||M.includes("youtu.be")){let Z="";return M.includes("youtube.com/watch")?Z=new URLSearchParams(new URL(M).search).get("v"):M.includes("youtu.be/")&&(Z=M.split("youtu.be/")[1].split("?")[0]),Z?`https://www.youtube.com/embed/${Z}?autoplay=1`:M}if(M.includes("vimeo.com")){if(M.includes("player.vimeo.com/video"))return M;const Z=(z=(F=M.split("vimeo.com/")[1])==null?void 0:F.split("?")[0])==null?void 0:z.split("/")[0];return Z?`https://player.vimeo.com/video/${Z}?autoplay=1`:M}return M}catch(Z){return $.error("Error converting to embed URL:",Z),M}},[]),O=N.useCallback(()=>{setTimeout(()=>{v(!1),$.log("Video processing state reset")},100)},[]);N.useEffect(()=>{let M=!0,F=null;const Z=b("PlayMediaScreenVideo",async K=>{try{console.log("[DEBUG] PlayMediaScreenVideo event received:",K,"isEditMode:",n),console.log("PlayMediaScreenVideo event received:",K);const{mediaScreenId:re,videoUrl:ae}=K||{};if(!re){$.error("Media screen ID is missing in Unity event data."),O();return}if(n){console.log(`[DEBUG] Edit mode is active for screen ${re}, setting ID but not playing video`),$.log("Edit mode is active, setting media screen ID but not playing video"),f(re);return}if(v(!0),F=setTimeout(()=>{M&&($.warn("Video processing timeout reached, resetting state"),v(!1))},5e3),ae){if(console.log(`Using direct video URL from event: ${ae}`),M)try{const ne=I(ae);console.log(`Setting video URL to: ${ne} (original: ${ae})`),i(ne),l(`Media Screen ${re}`),f(re),$.log("Media screen video URL set directly from event:",ne)}catch(ne){$.error("Error setting video URL from direct URL:",ne)}finally{O(),clearTimeout(F)}return}console.log(`Fetching media screen data for ID: ${re}`);try{const ne=await xf(C,re);if(console.log("Media screen data from Firestore:",ne),!ne||!ne.videoUrl){$.error("No video URL found for media screen:",re),O(),clearTimeout(F);return}if(!ne.displayAsVideo){$.log("Media screen is not set to display as video:",re),console.log("displayAsVideo flag is false for this media screen"),O(),clearTimeout(F);return}if(M)try{const pe=I(ne.videoUrl);console.log(`Setting video URL to: ${pe} (original: ${ne.videoUrl})`),i(pe),l(ne.title||`Media Screen ${re}`),f(re),$.log("Media screen video URL set to:",pe)}catch(pe){$.error("Error setting video URL from Firestore:",pe)}finally{O(),clearTimeout(F)}}catch(ne){$.error(`Error fetching media screen data for ${re}:`,ne),O(),clearTimeout(F)}}catch(re){$.error("Error handling media screen video play:",re),console.error("Error handling media screen video play:",re),O(),clearTimeout(F)}});return()=>{M=!1,F&&clearTimeout(F),Z()}},[b,C,n,I,O]);const L=N.useCallback(()=>{i(null),l(""),f(null),v(!1),$.log("Video player state reset")},[]);return[t,a,d,L,_]},l8e=()=>{const{spaceID:n}=Qo(),t=ac(),i=El(),[a,l]=N.useState(!1);N.useEffect(()=>{if(window.isPlayerInstantiated){$.log("useMediaScreenThumbnails: Unity already ready (via window flag)"),l(!0);return}const b=()=>{$.log("useMediaScreenThumbnails: Unity is now ready (PlayerInstantiated event)"),l(!0)};return window.addEventListener("PlayerInstantiated",b),()=>{window.removeEventListener("PlayerInstantiated",b)}},[]);const d=N.useCallback(async b=>{try{return b.includes("vimeo.com")?await f(b):b.includes("youtube.com")||b.includes("youtu.be")?await _(b):"https://via.placeholder.com/640x360?text=Video"}catch(C){return $.error(`Error fetching thumbnail for ${b}:`,C),"https://via.placeholder.com/640x360?text=Error"}},[]),f=async b=>{try{const C=`https://vimeo.com/api/oembed.json?url=${encodeURIComponent(b)}`,I=await fetch(C);if(!I.ok)throw new Error(`Failed to fetch Vimeo thumbnail: ${I.statusText}`);const O=await I.json(),L=O.thumbnail_url.replace(/_\d+x\d+/,""),M=["640x360","295x166"];let F=null;for(let z of M){const Z=`https://i.vimeocdn.com/filter/overlay?src0=${encodeURIComponent(`${L}_${z}`)}&src1=http://f.vimeocdn.com/p/images/crawler_play.png`;try{if((await fetch(Z,{method:"HEAD"})).ok){F=Z;break}}catch(K){$.warn(`Failed to validate thumbnail URL: ${Z}`,K)}}return F||O.thumbnail_url}catch(C){return $.error(`Error fetching Vimeo thumbnail: ${C.message}`),"https://via.placeholder.com/640x360?text=Vimeo+Video"}},_=async b=>{let C="";if(b.includes("youtube.com/watch")?C=new URLSearchParams(new URL(b).search).get("v"):b.includes("youtu.be/")&&(C=b.split("youtu.be/")[1].split("?")[0]),!C)throw new Error("Could not extract YouTube video ID");const I=`https://img.youtube.com/vi/${C}/maxresdefault.jpg`;try{if((await fetch(I,{method:"HEAD"})).ok)return I}catch(O){$.warn(`Failed to validate maxresdefault thumbnail for YouTube video ${C}`,O)}return`https://img.youtube.com/vi/${C}/hqdefault.jpg`},v=N.useCallback(async b=>{try{if(!n||!b)return;$.log(`Refreshing thumbnail for media screen ${b}`);const C=await xf(n,b);if(!C){$.log(`No media screen found with ID ${b}`);return}if($.log("Media screen data:",C),!C.displayAsVideo||!C.videoUrl){$.log(`Media screen ${b} is not set to display as video or has no video URL`);return}const I=await d(C.videoUrl);t("SetMediaScreenThumbnail",{mediaScreenId:b,thumbnailUrl:I}),$.log(`Sent refreshed thumbnail for media screen ${b}: ${I}`)}catch(C){$.error(`Error refreshing thumbnail for media screen ${b}:`,C)}},[n,d,t]);N.useEffect(()=>{if(!a){$.log("useMediaScreenThumbnails: Waiting for Unity to be ready before setting up thumbnail listeners");return}$.log("useMediaScreenThumbnails: Unity is ready, now setting up thumbnail listeners");const C=i("SetMediaScreenThumbnail",async I=>{try{const{mediaScreenId:O,thumbnailUrl:L}=I;L==="refresh"&&O&&(console.log(`Received request to refresh thumbnail for media screen ${O}`),await v(O))}catch(O){console.error("Error handling SetMediaScreenThumbnail event:",O)}});return()=>{C()}},[i,v,a]),N.useEffect(()=>{if(!a){$.log("useMediaScreenThumbnails: Waiting for Unity to be ready before fetching thumbnails");return}$.log("useMediaScreenThumbnails: Unity is ready, now fetching thumbnails");const b=async()=>{try{if(!n)throw new Error("spaceID is not defined.");$.log("Fetching media screens for thumbnails...");const I=await W3(n);$.log("All media screens:",I);const O=I.filter(F=>F.displayAsVideo&&F.videoUrl);if($.log("Media screens set to display as videos:",O),O.length===0){$.log("No media screens set to display as videos found.");return}$.log(`Found ${O.length} media screens set to display as videos.`);const L=O.map(async F=>{try{const z=await d(F.videoUrl);return $.log(`Fetched thumbnail for ${F.id}: ${z}`),{mediaScreenId:F.id,thumbnailUrl:z}}catch(z){return $.error(`Error processing thumbnail for media screen ${F.id}:`,z),{mediaScreenId:F.id,thumbnailUrl:"https://via.placeholder.com/640x360?text=Error"}}}),M=await Promise.all(L);$.log("Fetched Media Screen Thumbnails",M),M.forEach(({mediaScreenId:F,thumbnailUrl:z})=>{t("SetMediaScreenThumbnail",{mediaScreenId:F,thumbnailUrl:z}),$.log(`Sent thumbnail to Unity for media screen ${F}: ${z}`)})}catch(I){$.error("Error fetching media screen thumbnails:",I)}};b();const C=setInterval(b,5*60*1e3);return()=>{clearInterval(C)}},[t,n,d,a])},mQ={iframeContainer:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",width:"100%",pointerEvents:"auto !important"},iframe:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",pointerEvents:"auto !important",zIndex:1e4}},u8e=()=>T.jsx("style",{dangerouslySetInnerHTML:{__html:`
        /* Disable pointer events on Unity elements when modal is open */
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        /* Make sure the modal is above Unity */
        .chakra-modal__overlay {
          z-index: 1001 !important;
          pointer-events: auto !important;
        }
        
        .chakra-modal__content {
          z-index: 1002 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the iframe is visible and interactive */
        .video-iframe {
          z-index: 1003 !important;
          pointer-events: auto !important;
        }
        
        /* Make sure the close button is accessible */
        .chakra-modal__close-btn {
          z-index: 1004 !important;
        }
        
        /* Ensure the iframe container allows clicks */
        .iframe-container {
          pointer-events: auto !important;
        }
        
        /* Remove the full-screen blocker */
      `}}),d8e=({videoUrl:n,videoTitle:t,mediaScreenId:i,isOpen:a,onClose:l})=>{const{fullscreenRef:d}=Yd();return _N(a,`video-modal-${i}`),N.useEffect(()=>{if(a){const f=b=>{b.target.classList&&b.target.classList.contains("chakra-modal__overlay")&&(b.stopPropagation(),b.preventDefault())};document.addEventListener("mousemove",f,!0),document.addEventListener("mousedown",f,!0),document.addEventListener("mouseup",f,!0),document.addEventListener("click",f,!0),document.addEventListener("wheel",f,!0);const _=document.getElementById("unity-canvas"),v=document.getElementById("unity-container");if(_&&(_.style.pointerEvents="none"),v&&(v.style.pointerEvents="none"),document.body.classList.add("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Disable"),window.unityInstance.SendMessage("CameraController","DisableInput","VideoModal")}catch(b){console.error("Error disabling Unity input:",b)}return()=>{if(document.removeEventListener("mousemove",f,!0),document.removeEventListener("mousedown",f,!0),document.removeEventListener("mouseup",f,!0),document.removeEventListener("click",f,!0),document.removeEventListener("wheel",f,!0),_&&(_.style.pointerEvents="auto"),v&&(v.style.pointerEvents="auto"),document.body.classList.remove("unity-input-disabled"),window.unityInstance)try{window.unityInstance.SendMessage("WebGLInputManager","Enable"),window.unityInstance.SendMessage("CameraController","EnableInput","VideoModal")}catch(b){console.error("Error re-enabling Unity input:",b)}}}},[a]),T.jsxs(T.Fragment,{children:[T.jsx(u8e,{}),T.jsxs(Fs,{isOpen:a,onClose:l,size:"xl",isCentered:!0,portalProps:{containerRef:d},closeOnOverlayClick:!0,closeOnEsc:!0,id:`video-modal-${i}`,children:[T.jsx(Ws,{bg:"rgba(0, 0, 0, 0.8)",onClick:f=>{f.target===f.currentTarget&&(l(),f.stopPropagation(),f.preventDefault())},onMouseMove:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseDown:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onMouseUp:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},onWheel:f=>{f.target===f.currentTarget&&(f.stopPropagation(),f.preventDefault())},style:{pointerEvents:"auto"}}),T.jsxs(Bs,{bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",className:"video-modal-content",children:[T.jsx(io,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"10004",_hover:{bg:"gray.600"},position:"absolute",top:"10px",right:"10px"}),T.jsx(zs,{p:0,width:"100%",children:n?T.jsx(ft,{className:"iframe-container",style:mQ.iframeContainer,children:T.jsx("iframe",{className:"video-iframe",src:n,style:mQ.iframe,allow:"autoplay; fullscreen",allowFullScreen:!0,title:t||"Video Player"})}):T.jsxs(ji,{direction:"column",align:"center",justify:"center",h:"400px",children:[T.jsx(qd,{size:"xl",mb:4}),T.jsx(at,{children:"Unable to load video"}),T.jsx(at,{fontSize:"sm",color:"gray.400",mt:2,children:"No video URL provided"})]})})]})]})]})},Qs=(...n)=>{},h8e=()=>{const{isOpen:n,onOpen:t,onClose:i}=yp(),[a,l]=N.useState(null),[d,f]=N.useState("image"),_=N.useRef(null);_N(n,"image-viewer-modal");const v=N.useCallback(I=>{I.stopPropagation()},[]);return N.useEffect(()=>{if(n&&_.current){const I=_.current;I.addEventListener("mousemove",v),I.addEventListener("mousedown",v),I.addEventListener("mouseup",v),I.addEventListener("wheel",v);const O=document.getElementById("unity-canvas");return O&&(O.style.pointerEvents="none"),()=>{I.removeEventListener("mousemove",v),I.removeEventListener("mousedown",v),I.removeEventListener("mouseup",v),I.removeEventListener("wheel",v),O&&(O.style.pointerEvents="auto")}}},[n,v]),{isOpen:n,currentImageUrl:a,currentMediaType:d,openImageViewer:(I,O="image")=>{console.log(`[DEBUG] Opening image viewer with URL: ${I} and original media type: ${O}`);const L=typeof I=="string"&&(I.match(/\.(jpeg|jpg|gif|png|webp)($|\?)/i)||I.includes("firebasestorage")&&!I.includes("video")),M=L?"image":O;console.log(`[DEBUG] Detected URL as ${L?"image":"non-image"}, using media type: ${M}`),l(I),f(M),t()},closeImageViewer:()=>{i(),setTimeout(()=>{l(null),f("image")},300)},modalContentRef:_,preventPropagation:v}},p8e=()=>T.jsx("style",{dangerouslySetInnerHTML:{__html:`
        body.unity-input-disabled #unity-container,
        body.unity-input-disabled #unity-canvas {
          pointer-events: none !important;
        }
        
        .image-viewer-modal-content {
          pointer-events: auto !important;
        }
        
        .chakra-modal__overlay {
          pointer-events: auto !important;
        }
      `}}),mU=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const t=new URL(n),i=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",i&&t.searchParams.set("alt",i),a&&t.searchParams.set("token",a),Qs(`Cleaned Firebase URL from ${n} to ${t.toString()}`),t.toString()}return n}catch(t){return console.error("Error cleaning Firebase URL:",t),n}},f8e=()=>{const{spaceID:n}=Qo(),[t,i]=N.useState(!1),[a,l]=N.useState([]),[d,f]=N.useState(null),{isOpen:_,onOpen:v,onClose:b}=yp(),[C,I]=N.useState({}),[O,L]=N.useState(0);N.useRef(null);const M=ac(),{fullscreenRef:F}=Yd(),z=El(),[Z,K]=N.useState(!1),{isOpen:re,currentImageUrl:ae,currentMediaType:ne,openImageViewer:pe,closeImageViewer:X,modalContentRef:J,preventPropagation:Q}=h8e(),[se,de,he,le,Oe]=c8e(t),{isOpen:Ve,onOpen:xe,onClose:Re}=yp();l8e(),aoe(),N.useEffect(()=>{if(window.isPlayerInstantiated){K(!0);return}const we=()=>{K(!0)};return window.addEventListener("PlayerInstantiated",we),()=>{window.removeEventListener("PlayerInstantiated",we)}},[]);const ve=N.useCallback(we=>{if(Array.isArray(a)&&a.length>0){const ke=a.find(Ue=>Ue.mediaScreenId===we);if(ke){const Ue=ke.imageUrl,Be=ke.videoUrl;return{screen:ke,imageUrl:Ue,videoUrl:Be,mediaType:ke.mediaType||"image",displayAsVideo:ke.displayAsVideo||!1}}}else console.warn("mediaScreens is not an array or is empty:",a);if(ae){let ke=null;return Array.isArray(a)&&(ke=a.find(Ue=>Ue.mediaScreenId===we)),{screen:ke||{mediaScreenId:we},imageUrl:ae,videoUrl:null,mediaType:(ke==null?void 0:ke.mediaType)||"image",displayAsVideo:(ke==null?void 0:ke.displayAsVideo)||!1}}return n&&we&&xf(n,we).then(ke=>{ke&&l(Ue=>Array.isArray(Ue)&&Ue.some(qe=>qe.mediaScreenId===we)?Ue.map(qe=>qe.mediaScreenId===we?{...qe,imageUrl:ke.imageUrl,videoUrl:ke.videoUrl,mediaType:ke.mediaType||"image",displayAsVideo:ke.displayAsVideo||!1,hasImage:!!ke.imageUrl,source:"firestore-fetch",lastUpdated:new Date().toISOString()}:qe):[...Array.isArray(Ue)?Ue:[],{mediaScreenId:we,imageUrl:ke.imageUrl,videoUrl:ke.videoUrl,mediaType:ke.mediaType||"image",displayAsVideo:ke.displayAsVideo||!1,hasImage:!!ke.imageUrl,source:"firestore-fetch",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}).catch(ke=>{console.error(`Error fetching media screen data for ${we}:`,ke)}),console.warn("No screen data found for:",we),null},[a,ae,n,l]),be=N.useCallback(we=>{if(console.log(`[DEBUG] Processing click on screen: ${we}, isEditMode: ${t}`),f(we),t)console.log(`[DEBUG] Opening upload modal for screen: ${we} in edit mode`),v();else{const ke=ve(we);if(ke){if(console.log(`[DEBUG] Screen data for ${we}:`,ke),Qs("Screen data details:",{mediaScreenId:we,imageUrl:ke.imageUrl,videoUrl:ke.videoUrl,mediaType:ke.mediaType,displayAsVideo:ke.displayAsVideo}),Ve&&he===we)return;if(ke.displayAsVideo&&ke.videoUrl)Qs(`Opening video player for: ${ke.videoUrl}`),M("PlayMediaScreenVideo",{mediaScreenId:we,videoUrl:ke.videoUrl});else if(ke.imageUrl){Qs(`Opening viewer modal with ${ke.mediaType}: ${ke.imageUrl}`);const Be=mU(ke.imageUrl);pe(Be,ke.mediaType||"image")}else n&&xf(n,we).then(Be=>{if(Be){if(Be.displayAsVideo&&Be.videoUrl)Qs(`Opening video player for: ${Be.videoUrl}`),M("PlayMediaScreenVideo",{mediaScreenId:we,videoUrl:Be.videoUrl});else if(Be.imageUrl){Qs(`Opening viewer modal with image: ${Be.imageUrl}`);const qe=mU(Be.imageUrl);pe(qe,Be.mediaType||"image")}l(qe=>Array.isArray(qe)&&qe.some(it=>it.mediaScreenId===we)?qe.map(it=>it.mediaScreenId===we?{...it,...Be,mediaScreenId:we,source:"firestore-click",lastUpdated:new Date().toISOString()}:it):[...Array.isArray(qe)?qe:[],{...Be,mediaScreenId:we,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(Be=>{console.error(`Error fetching media screen data for ${we}:`,Be)})}else n&&xf(n,we).then(Ue=>{if(Ue){if(Ue.displayAsVideo&&Ue.videoUrl)Qs(`Opening video player for: ${Ue.videoUrl}`),M("PlayMediaScreenVideo",{mediaScreenId:we,videoUrl:Ue.videoUrl});else if(Ue.imageUrl){Qs(`Opening viewer modal with image: ${Ue.imageUrl}`);const Be=mU(Ue.imageUrl);pe(Be,Ue.mediaType||"image")}l(Be=>Array.isArray(Be)&&Be.some($e=>$e.mediaScreenId===we)?Be.map($e=>$e.mediaScreenId===we?{...$e,...Ue,mediaScreenId:we,source:"firestore-click",lastUpdated:new Date().toISOString()}:$e):[...Array.isArray(Be)?Be:[],{...Ue,mediaScreenId:we,source:"firestore-click",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])}}).catch(Ue=>{console.error(`Error fetching media screen data for ${we}:`,Ue)})}},[t,v,ve,Ve,he,M,pe,n]);N.useEffect(()=>{if(!Z)return;const we=async()=>{if(n)try{const Ue=await W3(n),Be={};Ue.forEach(qe=>{qe.id&&qe.imageUrl&&(Be[qe.id]=qe.imageUrl)}),l(qe=>qe.map($e=>{const it=!!Be[$e.mediaScreenId],Je=Be[$e.mediaScreenId],Ct=$e.mediaType||"image";return{...$e,hasImage:it,imageUrl:Je,mediaType:Ct}}))}catch(Ue){console.error("Error fetching media screen images:",Ue)}};we();let ke=null;return t&&(ke=setInterval(we,5e3)),()=>{ke&&clearInterval(ke)}},[n,t,O,Z]);const ze=we=>{l(ke=>ke.map(Ue=>{if(Ue.mediaScreenId===we.mediaScreenId){if(we.type==="upload")return{...Ue,hasImage:!0,imageUrl:we.imageUrl,mediaType:we.mediaType||"image"};if(we.type==="delete")return{...Ue,hasImage:!1,imageUrl:null,mediaType:null}}return Ue})),we.type==="delete"?(setTimeout(()=>{l(ke=>ke.filter(Ue=>Ue.mediaScreenId!==we.mediaScreenId))},100),setTimeout(()=>{l(ke=>ke.filter(Ue=>Ue.mediaScreenId!==we.mediaScreenId))},1500)):setTimeout(()=>{l(ke=>ke.some(Be=>Be.mediaScreenId===we.mediaScreenId)?ke.map(Be=>Be.mediaScreenId===we.mediaScreenId?{...Be,imageUrl:we.imageUrl,hasImage:!0,mediaType:we.mediaType||"image"}:Be):[...ke,{mediaScreenId:we.mediaScreenId,imageUrl:we.imageUrl,hasImage:!0,mediaType:we.mediaType||"image",source:"delayed-update",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}])},1e3)};N.useEffect(()=>{const we=ke=>{const Ue=ke.detail.enabled;i(Ue),Ue?M("SetMediaScreenEditMode",{enabled:!0,showUploadIcon:!0}):M("SetMediaScreenEditMode",{enabled:!1,showUploadIcon:!1})};return window.addEventListener("editModeChanged",we),()=>{window.removeEventListener("editModeChanged",we)}},[M]),N.useEffect(()=>(window.JsSendMediaScreenClick=function(we){console.log("Unity: MediaScreenClick received with data:",we);try{const ke=JSON.parse(we),Ue=new CustomEvent("MediaScreenClick",{detail:JSON.stringify(ke)});window.dispatchEvent(Ue)}catch(ke){console.error("Error processing MediaScreenClick data:",ke)}},window.handleMediaScreenClick=function(we){console.log("Direct call to handleMediaScreenClick with ID:",we),be(we)},window.TestJavaScriptFromUnity=function(we){console.log("Unity called TestJavaScriptFromUnity with:",we),alert("Unity called JavaScript: "+we)},()=>{delete window.JsSendMediaScreenClick,delete window.handleMediaScreenClick,delete window.TestJavaScriptFromUnity}),[be]),N.useEffect(()=>{const we=Be=>{try{const qe=JSON.parse(Be.detail);$.log(`MediaScreen registered: ${qe.mediaScreenId}`),Qs("MediaScreen registered from Unity:",qe),l(it=>it.some(Ct=>Ct.mediaScreenId===qe.mediaScreenId)?it.map(Ct=>Ct.mediaScreenId===qe.mediaScreenId?{...Ct,...qe,source:"event",lastUpdated:new Date().toISOString()}:Ct):[...it,{...qe,source:"event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),t&&M("SetMediaScreenEditMode",{mediaScreenId:qe.mediaScreenId,enabled:!0,showUploadIcon:!0});const $e=qe.mediaScreenId;$e&&xf(n,$e).then(it=>{it&&(Qs(`Media screen data for ${$e}:`,it),it.displayAsVideo&&it.videoUrl&&(Qs(`Media screen ${$e} should display as video, sending null imageUrl`),M("SetMediaScreenImage",{mediaScreenId:$e,imageUrl:null,displayAsVideo:!0})))}).catch(it=>{console.error(`Error fetching media screen data for ${$e}:`,it)})}catch(qe){console.error("Error handling MediaScreen registration:",qe)}},ke=Be=>{try{Qs("MediaScreenClick event received:",Be);let qe;if(typeof Be=="string")qe=Be,Qs("MediaScreenClick: Direct call with ID:",qe);else{Qs("MediaScreenClick: Event from Unity:",Be),Qs("MediaScreenClick: Event detail:",Be.detail);try{qe=JSON.parse(Be.detail).mediaScreenId,Qs("MediaScreenClick: Parsed mediaScreenId:",qe)}catch($e){if(console.error("MediaScreenClick: Error parsing event detail:",$e),Be.detail&&Be.detail.mediaScreenId)qe=Be.detail.mediaScreenId,Qs("MediaScreenClick: Using direct mediaScreenId from detail:",qe);else throw new Error("Could not extract mediaScreenId from event")}}$.log(`MediaScreen clicked: ${qe}`),Qs("MediaScreen clicked:",qe),be(qe)}catch(qe){console.error("Error handling MediaScreen click:",qe)}},Ue=Be=>{if(Be.detail&&Be.detail.eventName==="RegisterMediaScreen")we({detail:Be.detail.eventData});else if(Be.detail&&Be.detail.eventName==="MediaScreenClick")ke({detail:Be.detail.eventData});else if(Be.detail&&Be.detail.eventName==="SetMediaScreenImage")try{const qe=JSON.parse(Be.detail.eventData);qe.mediaScreenId&&(Qs("SetMediaScreenImage event received:",qe),l($e=>Array.isArray($e)&&$e.some(Je=>Je.mediaScreenId===qe.mediaScreenId)?$e.map(Je=>Je.mediaScreenId===qe.mediaScreenId?{...Je,imageUrl:qe.imageUrl,hasImage:!!qe.imageUrl,displayAsVideo:qe.displayAsVideo||!1,lastUpdated:new Date().toISOString()}:Je):[...Array.isArray($e)?$e:[],{mediaScreenId:qe.mediaScreenId,imageUrl:qe.imageUrl,hasImage:!!qe.imageUrl,displayAsVideo:qe.displayAsVideo||!1,source:"set-media-screen-image",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]))}catch(qe){console.error("Error handling SetMediaScreenImage event:",qe)}};return window.addEventListener("RegisterMediaScreen",we),window.addEventListener("MediaScreenClick",ke),window.addEventListener("reactUnityEvent",Ue),()=>{window.removeEventListener("RegisterMediaScreen",we),window.removeEventListener("MediaScreenClick",ke),window.removeEventListener("reactUnityEvent",Ue)}},[t,v,M,a,re,Ve,pe,be,n]),N.useEffect(()=>{const we=ke=>{try{Qs("Direct MediaScreenClick event received:",ke);let Ue;if(ke.detail)try{Ue=JSON.parse(ke.detail).mediaScreenId}catch(Be){console.error("Error parsing MediaScreenClick event detail:",Be);return}if(!Ue){console.error("No mediaScreenId found in MediaScreenClick event");return}Qs(`Direct handler: Processing click for media screen ${Ue}`),be(Ue)}catch(Ue){console.error("Error in direct MediaScreenClick handler:",Ue)}};return window.addEventListener("MediaScreenClick",we),()=>{window.removeEventListener("MediaScreenClick",we)}},[be]),N.useEffect(()=>{se&&xe()},[se,xe]);const Pe=()=>{le(),Re()};return N.useEffect(()=>{const ke=z("RegisterMediaScreen",Ue=>{try{if($.log("Direct RegisterMediaScreen event received with data:",Ue),!Ue||!Ue.mediaScreenId){$.warn("RegisterMediaScreen event received with invalid data");return}const Be=Ue.mediaScreenId;$.log(`Media screen registered directly: ${Be}`),l(qe=>qe.some(it=>it.mediaScreenId===Be)?qe.map(it=>it.mediaScreenId===Be?{...it,...Ue,source:"direct-event",lastUpdated:new Date().toISOString()}:it):[...qe,{...Ue,source:"direct-event",firstDetected:new Date().toISOString(),lastUpdated:new Date().toISOString()}]),t&&M("SetMediaScreenEditMode",{mediaScreenId:Be,enabled:!0,showUploadIcon:!0})}catch(Be){console.error("Error handling direct RegisterMediaScreen event:",Be)}});return()=>{ke()}},[z,t,M]),N.useEffect(()=>{const ke=z("MediaScreenClick",Ue=>{try{if($.log("Direct MediaScreenClick event received with data:",Ue),!Ue||!Ue.mediaScreenId){$.warn("MediaScreenClick event received with invalid data");return}const Be=Ue.mediaScreenId;$.log(`Media screen clicked directly: ${Be}`),be(Be)}catch(Be){console.error("Error handling direct MediaScreenClick event:",Be)}});return()=>{ke()}},[z,be]),N.useEffect(()=>{t&&he&&(console.log(`[DEBUG] Detected currentVideoMediaScreenId change in edit mode: ${he}`),f(he),v(),le())},[t,he,v,le]),T.jsxs(T.Fragment,{children:[T.jsx(a8e,{isOpen:_,onClose:b,mediaScreenId:d,onImageChange:ze}),T.jsx(p8e,{}),T.jsx(Ju,{containerRef:F,children:T.jsxs(Fs,{isOpen:re,onClose:X,size:"lg",isCentered:!0,portalProps:{containerRef:F},id:"image-viewer-modal",blockScrollOnMount:!0,children:[T.jsx(Ws,{bg:"rgba(0, 0, 0, 0.8)",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q}),T.jsxs(Bs,{ref:J,bg:"gray.900",color:"white",borderRadius:"lg",overflow:"hidden",maxWidth:"80vw",maxHeight:"80vh",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",zIndex:"10000",className:"image-viewer-modal-content",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:[T.jsx(io,{size:"lg",bg:"gray.700",color:"white",borderRadius:"full",zIndex:"modal",_hover:{bg:"gray.600"},_focus:{boxShadow:"none"},position:"absolute",top:"10px",right:"10px"}),T.jsx(zs,{p:0,width:"100%",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:ae?T.jsx(ft,{position:"relative",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:ne==="image"?T.jsx(rp,{src:ae,maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",alt:"Media Screen Image",onLoad:()=>console.log("Image loaded successfully:",ae),onError:we=>console.error("Error loading image:",we,ae),onClick:Q}):T.jsxs(ft,{width:"100%",textAlign:"center",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:[T.jsx(at,{mb:4,fontSize:"lg",children:"Video URL:"}),T.jsx(at,{p:3,bg:"gray.800",borderRadius:"md",fontSize:"sm",wordBreak:"break-all",maxWidth:"100%",children:ae}),T.jsx(at,{mt:4,fontSize:"sm",color:"gray.400",children:"Video playback will be implemented in a future update"})]})}):T.jsx(ji,{direction:"column",align:"center",justify:"center",h:"400px",onClick:Q,onMouseMove:Q,onMouseDown:Q,onMouseUp:Q,onWheel:Q,children:T.jsx(at,{children:"No image available"})})})]})]})}),T.jsx(d8e,{videoUrl:se,videoTitle:de,mediaScreenId:he,isOpen:Ve,onClose:Pe})]})},joe=({backgroundUrl:n=null,videoBackgroundUrl:t=null,containerRef:i})=>{const[a,l]=N.useState(!1),[d,f]=N.useState(n),[_,v]=N.useState(t),b=N.useRef(null),C=N.useRef(null),I=N.useRef(null),O=N.useRef(!1),L=N.useRef(!1);N.useEffect(()=>{if(!(O.current||L.current)){if(L.current=!0,console.log(` PersistentBackground: Initializing with props - videoUrl: ${t}, imageUrl: ${n}`),t){console.log(` PersistentBackground: Using provided video URL: ${t}`),F(t),O.current=!0;return}if(n){console.log(` PersistentBackground: No video available, using image: ${n}`),z(n),O.current=!0;return}M()}},[n,t]),N.useEffect(()=>{const re=ae=>{const{videoBackgroundUrl:ne}=ae.detail;console.log(` PersistentBackground: Received video background update event: ${ne}`),ne&&!O.current&&(F(ne),O.current=!0)};return window.addEventListener("SpaceVideoBackgroundUpdated",re),()=>{window.removeEventListener("SpaceVideoBackgroundUpdated",re)}},[]);const M=()=>{const ae=window.location.pathname.match(/\/space\/([^\/]+)/);if(!ae||!ae[1]){console.warn(" PersistentBackground: Couldn't extract space ID from URL");return}const ne=ae[1];console.log(` PersistentBackground: Found space ID: ${ne}`),Gu(ne).then(pe=>{if(console.log(` PersistentBackground: Retrieved space data for ${ne}:`,pe?"success":"null"),pe&&pe.videoBackgroundUrl)console.log(` PersistentBackground: VIDEO FOUND: ${pe.videoBackgroundUrl}`),F(pe.videoBackgroundUrl),O.current=!0;else if(pe&&(pe.backgroundUrl||pe.backgroundGsUrl)){const X=pe.backgroundUrl||pe.backgroundGsUrl;console.log(` PersistentBackground: No video available, using image backdrop: ${X}`),z(X),O.current=!0}}).catch(pe=>{console.error(" PersistentBackground: Error fetching space data:",pe)})},F=re=>{if(!i||!i.current)return;console.log(` PersistentBackground: Setting up video background: ${re}`),K();const ae=document.createElement("video");I.current=ae,ae.autoplay=!0,ae.loop=!0,ae.muted=!0,ae.playsInline=!0,ae.setAttribute("playsinline",""),ae.setAttribute("webkit-playsinline",""),ae.setAttribute("preload","auto"),ae.src=re,Object.assign(ae.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",objectFit:"cover",zIndex:"20",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(ae),Z(),ae.load();try{ae.play().then(()=>console.log(" VIDEO PLAYING SUCCESSFULLY")).catch(ne=>{console.warn(" First video play attempt failed:",ne);const pe=()=>{ae.play().then(()=>console.log(" Video started after user interaction")).catch(X=>console.error(" Video still failed to play:",X))};window.addEventListener("click",pe,{once:!0}),window.addEventListener("touchstart",pe,{once:!0}),setTimeout(()=>{ae.play().then(()=>console.log(" Video started after timeout")).catch(X=>console.error(" Video still failed to play after timeout:",X))},1e3)})}catch(ne){console.error(" Error attempting to play video:",ne)}},z=re=>{if(!i||!i.current||!re)return;console.log(` PersistentBackground: Setting up image background: ${re}`);const ae=document.createElement("div");b.current=ae,Object.assign(ae.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundImage:`url('${re}')`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",zIndex:"19",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(ae),Z()},Z=()=>{if(!i||!i.current)return;const re=document.createElement("div");C.current=re,Object.assign(re.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(5px)",WebkitBackdropFilter:"blur(5px)",backgroundColor:"rgba(255, 255, 255, 0.08)",zIndex:"21",transition:"opacity 1.5s ease-in-out",pointerEvents:"none"}),i.current.appendChild(re)},K=()=>{!i||!i.current||(b.current&&i.current.contains(b.current)&&(i.current.removeChild(b.current),b.current=null),I.current&&i.current.contains(I.current)&&(I.current.pause(),I.current.src="",I.current.load(),i.current.removeChild(I.current),I.current=null),C.current&&i.current.contains(C.current)&&(i.current.removeChild(C.current),C.current=null))};return N.useEffect(()=>{if(!i||!i.current)return;const re=()=>{console.log(" PersistentBackground: Player instantiated, removing background"),l(!0),b.current&&(b.current.style.opacity="0"),I.current&&(I.current.style.opacity="0"),C.current&&(C.current.style.opacity="0"),setTimeout(()=>{K()},1500)};if(window.isPlayerInstantiated){console.log(" PersistentBackground: Player was already instantiated"),re();return}Gd.subscribe(Wd.playerInstantiated,re),window.addEventListener("PlayerInstantiated",re);const ae=setTimeout(()=>{console.log(" PersistentBackground: Timeout reached, removing background"),re()},3e4);return()=>{Gd.unsubscribe(Wd.playerInstantiated,re),window.removeEventListener("PlayerInstantiated",re),clearTimeout(ae),K()}},[i]),null};joe.propTypes={backgroundUrl:Sn.string,videoBackgroundUrl:Sn.string,containerRef:Sn.shape({current:Sn.instanceOf(Element)})};const gQ="https://www.spacesmetaverse.com/assets/images/SpacesLogo_Loader.png",Foe=({containerRef:n})=>{const{spaceID:t}=Qo(),[i,a]=N.useState(!1),[l,d]=N.useState(!1),[f,_]=N.useState(0),[v,b]=N.useState("Initialising World"),[C,I]=N.useState(null),O=N.useRef(null),L=N.useRef(null),M=N.useRef(null),F=N.useRef(null),z=N.useRef(null),Z=N.useRef(null);N.useEffect(()=>($.log("PersistentLoader: Component mounted with spaceID:",t),$.log("PersistentLoader: Container ref:",n),()=>{$.log("PersistentLoader: Component unmounting")}),[]);const{error:K}=Qo(),[re,ae]=N.useState(!1);return N.useEffect(()=>{K&&($.error("PersistentLoader: Unity error detected:",K),ae(!0),setTimeout(()=>{if(O.current){const ne=O.current.querySelector("div:first-child");ne&&(ne.textContent="Reconnecting...")}},3e3))},[K]),N.useEffect(()=>{(async()=>{if(t){$.log(`PersistentLoader: Fetching logo for space ${t}`);try{const pe=await Gu(t);pe&&pe.logoUrl?($.log(`PersistentLoader: Found logo URL: ${pe.logoUrl}`),I(pe.logoUrl)):$.log(`PersistentLoader: No logo URL found for space ${t}`)}catch(pe){$.error("PersistentLoader: Error fetching space logo:",pe)}}else $.warn("PersistentLoader: No spaceID provided, cannot fetch logo")})()},[t]),N.useEffect(()=>{const ne=pe=>{const{logoUrl:X}=pe.detail;$.log(`PersistentLoader: Logo update event received with URL: ${X}`),I(X),L.current?X?($.log("PersistentLoader: Updating logo element with new URL"),L.current.src=X,M.current.style.display="flex"):($.log("PersistentLoader: Hiding logo element (no URL)"),M.current.style.display="none"):$.warn("PersistentLoader: Logo ref is null during update")};return $.log("PersistentLoader: Adding SpaceLogoUpdated event listener"),window.addEventListener("SpaceLogoUpdated",ne),()=>{$.log("PersistentLoader: Removing SpaceLogoUpdated event listener"),window.removeEventListener("SpaceLogoUpdated",ne)}},[]),N.useEffect(()=>{if(!n||!n.current){$.error("PersistentLoader: Container ref is null or has no current property");return}$.log("PersistentLoader: Creating loader elements");const ne=document.createElement("div");if(O.current=ne,Object.assign(ne.style,{position:"absolute",top:"60%",left:"50%",transform:"translate(-50%, -50%)",width:"300px",padding:"16px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",color:"white",fontFamily:"Arial, sans-serif",backgroundColor:"rgba(0, 0, 0, 0.4)",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",borderRadius:"12px",boxShadow:"0 0 20px rgba(0, 0, 0, 0.3), inset 0 0 1px rgba(255, 255, 255, 0.3)",border:"1px solid rgba(255, 255, 255, 0.1)",opacity:"0"}),C){$.log(`PersistentLoader: Creating logo element with URL: ${C}`);const Re=document.createElement("div");M.current=Re,Object.assign(Re.style,{position:"absolute",top:"37.5%",left:"50%",transform:"translate(-50%, -50%)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:"50",transition:"opacity 0.8s ease-in-out",pointerEvents:"none",padding:"8px",width:"280px",opacity:"0"});const ve=document.createElement("img");L.current=ve,ve.src=C,ve.alt="Space Logo",ve.style.maxHeight="100px",ve.style.maxWidth="100%",ve.style.objectFit="contain",ve.style.filter="drop-shadow(0 0 8px rgba(0, 0, 0, 0.7))",Re.appendChild(ve),n.current.appendChild(Re),$.log("PersistentLoader: Logo container added to main container")}else $.log("PersistentLoader: No logo URL available, skipping logo creation");const pe=document.createElement("style");pe.textContent=`
      @keyframes progress-glow {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
    `,document.head.appendChild(pe),$.log("PersistentLoader: Animation styles added to document head");const X=document.createElement("div");X.style.fontSize="16px",X.style.fontWeight="bold",X.style.textAlign="center",X.style.marginBottom="16px",X.style.color="#ffffff",X.textContent="Initialising World";const J=document.createElement("div");J.style.width="240px",J.style.height="100px",J.style.position="relative",J.style.marginBottom="15px",J.style.padding="0px",J.style.overflow="hidden",J.style.boxSizing="border-box",J.style.transition="opacity 0.8s ease-in-out",J.style.opacity="0";const Q=document.createElement("div");Q.style.width="100%",Q.style.height="100%",Q.style.position="absolute",Q.style.top="0",Q.style.left="0",Q.style.maskImage=`url(${gQ})`,Q.style.maskSize="contain",Q.style.maskPosition="center",Q.style.maskRepeat="no-repeat",Q.style.webkitMaskImage=`url(${gQ})`,Q.style.webkitMaskSize="contain",Q.style.webkitMaskPosition="center",Q.style.webkitMaskRepeat="no-repeat",Q.style.background="linear-gradient(to right, #4facfe 0%, #00f2fe 15%, white 15%, white 100%)",Q.style.backgroundSize="100% 100%",Q.style.transition="background 0.5s ease-out",F.current=Q,z.current=null,J.appendChild(Q);const se=document.createElement("div");se.style.marginTop="8px",se.style.fontSize="14px",se.style.fontWeight="bold",se.style.color="#ffffff",se.textContent="0%",ne.appendChild(X),ne.appendChild(J),ne.appendChild(se),n.current.appendChild(ne),$.log("PersistentLoader: Loader element added to container"),setTimeout(()=>{M.current&&(M.current.style.opacity="1"),ne.style.opacity="1",J.style.opacity="1"},500);const de=Re=>{_(Re);const ve=Math.round(Re*100),be=`linear-gradient(to right, #4facfe 0%, #00f2fe ${ve}%, white ${ve}%, white 100%)`;Q.style.background=be,se.textContent=`${ve}%`,$.log(`PersistentLoader: Progress updated to ${ve}%`)},he=Re=>{b(Re),X.textContent=Re,$.log(`PersistentLoader: Loading stage updated to "${Re}"`)},le=[{stage:"Initialising World",progress:.33},{stage:"Loading Assets",progress:.66},{stage:"Loading User",progress:1}];re&&(le[0].stage="Connecting to Space",le[1].stage="Reconnecting...",le[2].stage="Please Wait"),he(le[0].stage),de(.25);const Oe=Re=>{const ve=Re.detail.progress;$.log(`PersistentLoader: Progress event received with value: ${ve}`),de(ve),ve<.33?he(le[0].stage):ve<.66?he(le[1].stage):he(le[2].stage)},Ve=()=>{$.log("PersistentLoader: First scene loaded event received"),a(!0),he(le[1].stage),de(.66)},xe=()=>{if($.log("PersistentLoader: Player instantiated event received"),Z.current&&(clearInterval(Z.current),$.log("PersistentLoader: Progress interval cleared")),d(!0),he(le[2].stage),de(1),re){$.log("PersistentLoader: Keeping loader visible due to Unity error");return}ne.style.transition="all 0.5s ease-in-out",J.style.transition="opacity 1.2s ease-in-out",X.style.transition="opacity 0.4s ease-in-out",se.style.transition="opacity 0.4s ease-in-out",M.current&&(M.current.style.transition="opacity 0.5s ease-in-out"),ne.style.backgroundColor="rgba(0, 0, 0, 0)",ne.style.backdropFilter="blur(0px)",ne.style.WebkitBackdropFilter="blur(0px)",ne.style.boxShadow="0 0 0 rgba(0, 0, 0, 0)",ne.style.border="1px solid rgba(255, 255, 255, 0)",X.style.opacity="0",se.style.opacity="0",M.current&&(M.current.style.opacity="0"),setTimeout(()=>{J.style.opacity="0",setTimeout(()=>{n.current&&n.current.contains(ne)?(n.current.removeChild(ne),$.log("PersistentLoader: Loader element removed after fade")):$.warn("PersistentLoader: Could not remove loader element (not found in container)"),M.current&&n.current&&n.current.contains(M.current)?(n.current.removeChild(M.current),$.log("PersistentLoader: Logo container removed after fade")):M.current&&$.warn("PersistentLoader: Could not remove logo container (not found in container)")},1300)},400)};if(window.isPlayerInstantiated)$.log("PersistentLoader: Player was already instantiated"),xe();else{$.log("PersistentLoader: Subscribing to playerInstantiated event"),Gd.subscribe(Wd.playerInstantiated,xe);const Re=()=>xe();$.log("PersistentLoader: Adding PlayerInstantiated event listener"),window.addEventListener("PlayerInstantiated",Re),$.log("PersistentLoader: Adding firstSceneLoaded event listener"),Gd.subscribe(Wd.firstSceneLoaded,Ve),$.log("PersistentLoader: Adding UnityProgress event listener"),window.addEventListener("UnityProgress",Oe),Z.current=setInterval(()=>{l||_(be=>{const ze=Math.min(be+.02,.95);return de(ze),ze<.33&&v!==le[0].stage?he(le[0].stage):ze>=.33&&ze<.66&&v!==le[1].stage?he(le[1].stage):ze>=.66&&v!==le[2].stage&&he(le[2].stage),ze})},300);const ve=setTimeout(()=>{$.log("PersistentLoader: Forcing loader removal after timeout"),xe()},6e4);return()=>{$.log("PersistentLoader: Cleaning up event listeners"),Gd.unsubscribe(Wd.playerInstantiated,xe),window.removeEventListener("PlayerInstantiated",Re),Gd.unsubscribe(Wd.firstSceneLoaded,Ve),window.removeEventListener("UnityProgress",Oe),clearInterval(Z.current),clearTimeout(ve),n.current&&n.current.contains(ne)&&(n.current.removeChild(ne),$.log("PersistentLoader: Loader element removed during cleanup")),M.current&&n.current&&n.current.contains(M.current)&&(n.current.removeChild(M.current),$.log("PersistentLoader: Logo container removed during cleanup"))}}},[C,n]),null};Foe.propTypes={containerRef:Sn.shape({current:Sn.instanceOf(Element)})};const x0=()=>window.unityInstance||window.gameInstance||window.reactUnityInstance,X3=()=>{document.body.classList.add("unity-focused");const n=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space","PageUp","PageDown","Home","End"],t=a=>{if(n.includes(a.key)){const l=a.target.tagName==="INPUT"||a.target.tagName==="TEXTAREA"||a.target.isContentEditable,d=document.querySelector("canvas")||document.getElementById("unity-canvas"),f=a.target.closest("canvas")||a.target.closest("#webgl-root"),_=document.activeElement===d;!l&&(f||_)&&a.preventDefault()}},i=a=>{document.querySelector("canvas")||document.getElementById("unity-canvas"),document.getElementById("unity-container")||document.getElementById("webgl-root"),a.target.closest("canvas")||a.target.closest("#webgl-root")?document.body.classList.add("unity-focused"):document.body.classList.remove("unity-focused")};return document.addEventListener("keydown",t),document.addEventListener("click",i),()=>{document.body.classList.remove("unity-focused"),document.removeEventListener("keydown",t),document.removeEventListener("click",i)}},Boe=()=>{document.body.classList.remove("unity-focused")};function o1(n){return console.log(`Setting Unity keyboard capture: ${n}`),n?(document.body.classList.add("unity-focused"),window.unityKeyboardEnabled=!0):(document.body.classList.remove("unity-focused"),window.unityKeyboardEnabled=!1),n?X3():Boe(),new Promise(t=>{try{const i=x0();if(i){try{n?i.SendMessage("WebGLInput","EnableKeyboardCapture"):i.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Unity preferred method)`),t(!0);return}catch(a){console.warn("Failed to use Unity preferred keyboard method, falling back to SetCaptureAllKeyboardInput",a)}try{i.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using fallback method)`),t(!0);return}catch(a){console.warn("Failed to use SetCaptureAllKeyboardInput, trying module method",a)}if(i.Module){!n&&i.Module.WebGLInputHandler&&!window._originalWebGLInputHandler&&(window._originalWebGLInputHandler=i.Module.WebGLInputHandler),n&&window._originalWebGLInputHandler?(i.Module.WebGLInputHandler=window._originalWebGLInputHandler,window._originalWebGLInputHandler=null):n||(i.Module.WebGLInputHandler=null),console.log(`Unity keyboard capture ${n?"enabled":"disabled"} (using Module method)`),t(!0);return}}else console.warn("Unity instance not available, cannot set keyboard capture"),window.__pendingKeyboardCaptureState=n,document.getElementById("webgl-root")&&(console.log("webgl-root detected, will poll for Unity instance"),rj(n)),t(!1)}catch(i){console.error("Error setting Unity keyboard capture:",i),t(!1)}})}function rj(n){window.__unityInstancePoller&&clearTimeout(window.__unityInstancePoller);const t=20;let i=0;const a=()=>{i++;const l=x0();if(l){console.log(`Unity instance found after ${i} attempts`);try{n?l.SendMessage("WebGLInput","EnableKeyboardCapture"):l.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${n}`),window.__pendingKeyboardCaptureState=null}catch(d){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",d);try{l.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",n),console.log(`Applied pending keyboard state: ${n} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(f){console.error("Failed to apply pending keyboard state with fallback method",f)}}}else if(i<t){const d=Math.min(500*Math.pow(1.2,i),5e3);console.log(`Unity instance not found (attempt ${i}/${t}), retrying in ${d}ms`),window.__unityInstancePoller=setTimeout(a,d)}else console.warn(`Unity instance still not found after ${t} attempts, giving up`)};window.__unityInstancePoller=setTimeout(a,500)}function m8e(){const n=x0();if(!n)return!1;const t=document.querySelector("canvas")||document.getElementById("unity-canvas");return!!(t&&document.activeElement===t||n.Module&&n.Module.WebGLInputHandler)}function Yw(n=!0){return console.log("Focusing Unity canvas"),n?X3():Boe(),new Promise(t=>{try{const i=document.querySelector("canvas")||document.getElementById("unity-canvas");if(i){try{i.focus({preventScroll:!0})}catch{i.focus()}if(i.style.pointerEvents="auto",n){o1(!0).then(t);return}t(!0)}else console.warn("Unity canvas not found"),t(!1)}catch(i){console.error("Error focusing Unity canvas:",i),t(!1)}})}function MO(n=!0){return console.log(`${n?"Blocking":"Unblocking"} Unity keyboard input`),X3(),new Promise(t=>{try{if(n)o1(!1).then(i=>{var d;i&&console.log("Successfully disabled Unity keyboard capture");const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.blur(),a.style.pointerEvents="none"),window.__keyEventHandler||(window.__keyEventHandler=f=>{window.__blockKeyboardInput&&!["INPUT","TEXTAREA","SELECT"].includes(f.target.tagName)&&f.stopPropagation()},document.addEventListener("keydown",window.__keyEventHandler,!0),document.addEventListener("keyup",window.__keyEventHandler,!0),document.addEventListener("keypress",window.__keyEventHandler,!0)),window.__blockKeyboardInput=!0;const l=x0();(d=l==null?void 0:l.Module)!=null&&d.WebGLInputHandler&&(window._savedWebGLInputHandler=l.Module.WebGLInputHandler,l.Module.WebGLInputHandler=null),t(!0)});else{window.__blockKeyboardInput=!1,window.__keyEventHandler&&(document.removeEventListener("keydown",window.__keyEventHandler,!0),document.removeEventListener("keyup",window.__keyEventHandler,!0),document.removeEventListener("keypress",window.__keyEventHandler,!0),window.__keyEventHandler=null);const i=x0();i!=null&&i.Module&&window._savedWebGLInputHandler&&(i.Module.WebGLInputHandler=window._savedWebGLInputHandler,window._savedWebGLInputHandler=null);const a=document.querySelector("canvas")||document.getElementById("unity-canvas");a&&(a.style.pointerEvents="auto"),o1(!0).then(l=>{l&&console.log("Successfully re-enabled Unity keyboard capture"),t(!0)})}}catch(i){console.error("Error in blockUnityKeyboardInput:",i),t(!1)}})}function g8e(n){if(n){if(console.log("Registering Unity instance"),window.unityInstance=n,typeof window.__pendingKeyboardCaptureState=="boolean")try{const t=window.__pendingKeyboardCaptureState;console.log(`Applying pending keyboard state: ${t}`);try{t?n.SendMessage("WebGLInput","EnableKeyboardCapture"):n.SendMessage("WebGLInput","DisableKeyboardCapture"),console.log(`Applied pending keyboard state: ${t} (Unity preferred method)`),window.__pendingKeyboardCaptureState=null}catch(i){console.warn("Failed to apply pending keyboard state with preferred method, trying fallback",i);try{n.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",t),console.log(`Applied pending keyboard state: ${t} (fallback method)`),window.__pendingKeyboardCaptureState=null}catch(a){console.error("Failed to apply pending keyboard state with fallback method",a)}}}catch(t){console.error("Error applying pending keyboard state:",t)}window.__unityInstancePoller&&(clearTimeout(window.__unityInstancePoller),window.__unityInstancePoller=null)}}function _8e(){if(console.log("Initializing Unity keyboard helpers"),window.setUnityKeyboardCapture=o1,window.focusUnity=Yw,window.blockUnityKeyboardInput=MO,window.hasUnityKeyboardFocus=m8e,window.getUnityInstance=x0,window.registerUnityInstance=g8e,document.getElementById("webgl-root")){const n=new MutationObserver(t=>{for(const i of t)if(i.addedNodes.length)for(let a=0;a<i.addedNodes.length;a++){const l=i.addedNodes[a];if(l.nodeName==="CANVAS"||l.querySelector&&l.querySelector("canvas")){console.log("Canvas detected, Unity might be loading. Setting up instance detection."),rj(!0),n.disconnect();break}}});n.observe(document.body,{childList:!0,subtree:!0}),document.querySelector("canvas")&&(console.log("Canvas already exists, Unity might be loaded. Starting instance detection."),rj(!0))}if(typeof window<"u"&&typeof require=="function")try{const n=require("react");window.useUnityKeyboardFocus=function(){const[i,a]=n.useState(!1);return n.useEffect(()=>(i?(console.log("useUnityKeyboardFocus: Blocking Unity keyboard input"),MO(!0),window.dispatchEvent(new CustomEvent("modal-opened"))):(console.log("useUnityKeyboardFocus: Unblocking Unity keyboard input"),MO(!1),window.dispatchEvent(new CustomEvent("modal-closed"))),()=>{i&&(console.log("useUnityKeyboardFocus: Cleanup - unblocking Unity keyboard input"),MO(!1),window.dispatchEvent(new CustomEvent("modal-closed")))}),[i]),[i,a]},console.log("Created useUnityKeyboardFocus hook globally")}catch(n){console.warn("Could not create React hook, React might not be available yet:",n)}}typeof window<"u"&&setTimeout(_8e,0);const y8e=({size:n="md",tooltipPlacement:t="top",className:i="livestream-button"})=>{const[a,l]=N.useState(!1),[d,f]=N.useState(!1),{savedStreamData:_,reloadStreamData:v}=ooe(),{spaceID:b}=Qo(),{user:C}=N.useContext(Nc),I=Na(),[O,L]=N.useState(!1),M=uK((_==null?void 0:_.rtmpUrl)||""),F=uK((_==null?void 0:_.streamKey)||"");N.useEffect(()=>{if(b){$.log("LiveStreamButton: Forcing reload of stream data"),v();const K=()=>{$.log("LiveStreamButton: Stream settings changed, reloading data"),v()};return window.addEventListener("StreamSettingsChanged",K),()=>{window.removeEventListener("StreamSettingsChanged",K)}}},[b,v]),N.useEffect(()=>{(async()=>{if(!(C!=null&&C.uid)||!b){L(!1);return}try{const re=await lBe(C.uid,"disruptiveAdmin"),ae=await pBe(C,b);L(re||ae)}catch(re){$.error("Error checking user permissions:",re),L(!1)}})()},[C==null?void 0:C.uid,b]),N.useEffect(()=>{$.log("LiveStreamButton: Current streaming data:",{enabled:_==null?void 0:_.enabled,hasRtmpUrl:!!(_!=null&&_.rtmpUrl),hasStreamKey:!!(_!=null&&_.streamKey),hasPermission:O,isPlayerReady:d})},[_,O,d]),N.useEffect(()=>{const K=()=>{$.log("LiveStreamButton: Player instantiated, showing button"),f(!0)};return window.addEventListener("PlayerInstantiated",K),window.isPlayerInstantiated&&($.log("LiveStreamButton: Player was already instantiated"),f(!0)),()=>{window.removeEventListener("PlayerInstantiated",K)}},[]);const z=()=>{window.dispatchEvent(new Event("modal-opened")),l(!0)},Z=()=>{window.dispatchEvent(new Event("modal-closed")),l(!1)};return!d||!O||(_==null?void 0:_.enabled)!==!0?($.log("LiveStreamButton: Not rendering button because:",{playerNotReady:!d,noPermission:!O,streamingDisabled:(_==null?void 0:_.enabled)!==!0,enabledValue:_==null?void 0:_.enabled}),null):T.jsxs(T.Fragment,{children:[T.jsx(jf,{label:"Live Stream Info",placement:t,hasArrow:!0,children:T.jsx(Ep,{size:n,borderRadius:"full",bg:"black",icon:T.jsx(vWe,{color:"white"}),borderWidth:"1px",borderColor:"whiteAlpha.300",className:i,"data-testid":"livestream-button",cursor:"pointer",onClick:z})}),T.jsxs(Fs,{isOpen:a,onClose:Z,isCentered:!0,size:"md",children:[T.jsx(Ws,{backdropFilter:"blur(4px)"}),T.jsxs(Bs,{bg:"rgba(23, 25, 35, 0.95)",color:"white",borderRadius:"md",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.5)",children:[T.jsx(xo,{borderBottom:"1px solid",borderColor:"whiteAlpha.200",py:2,fontSize:"md",fontWeight:"600",children:"Live Stream Info"}),T.jsx(io,{size:"sm",color:"whiteAlpha.700",_hover:{color:"white",bg:"whiteAlpha.100"}}),T.jsx(zs,{p:4,children:_!=null&&_.rtmpUrl&&(_!=null&&_.streamKey)?T.jsxs(ft,{children:[T.jsx(at,{fontSize:"sm",mb:4,color:"white",children:"Copy these details to your streaming software (OBS, Streamlabs, etc.)"}),T.jsxs(ft,{mb:4,children:[T.jsx(at,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"RTMP URL"}),T.jsx(ji,{children:T.jsxs(Ly,{size:"sm",children:[T.jsx(Hi,{value:_.rtmpUrl,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",color:"white"}),T.jsx(Nk,{children:T.jsx(ko,{"aria-label":"Copy RTMP URL",icon:M.hasCopied?T.jsx(aQ,{}):T.jsx(cQ,{}),size:"xs",colorScheme:M.hasCopied?"green":"blue",onClick:()=>{M.onCopy(),I({title:"RTMP URL copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),T.jsxs(ft,{mb:4,children:[T.jsx(at,{fontSize:"xs",fontWeight:"600",mb:1,color:"white",children:"Stream Key"}),T.jsx(ji,{children:T.jsxs(Ly,{size:"sm",children:[T.jsx(Hi,{value:_.streamKey,isReadOnly:!0,bg:"whiteAlpha.100",borderColor:"whiteAlpha.200",_hover:{borderColor:"whiteAlpha.300"},pr:"2.5rem",type:"password",color:"white"}),T.jsx(Nk,{children:T.jsx(ko,{"aria-label":"Copy Stream Key",icon:F.hasCopied?T.jsx(aQ,{}):T.jsx(cQ,{}),size:"xs",colorScheme:F.hasCopied?"green":"blue",onClick:()=>{F.onCopy(),I({title:"Stream Key copied",status:"success",duration:2e3,isClosable:!0,position:"top"})}})})]})})]}),T.jsx(at,{fontSize:"xs",color:"whiteAlpha.800",mt:4,children:"Stream to this RTMP server using the Stream Key above. View and manage stream settings in the Space Manager."})]}):T.jsxs(ft,{textAlign:"center",p:4,children:[T.jsx(at,{color:"white",children:"No stream configuration found for this space."}),T.jsx(at,{fontSize:"xs",mt:2,color:"whiteAlpha.800",children:"Configure streaming in the Space Manager under Stream tab."})]})})]})]})]})},zoe=({settings:n})=>{const{placePrefab:t,directPlacePrefab:i,isUnityLoaded:a}=loe(),l=Na(),[d,f]=N.useState({x:0,y:1,z:0}),[_,v]=N.useState({x:0,y:0,z:0}),[b,C]=N.useState({x:1,y:1,z:1}),[I,O]=N.useState("TestPrefab"),[L,M]=N.useState(!1),[F,z]=N.useState(!1),[Z,K]=N.useState(!1),{user:re}=N.useContext(Nc),ae=n==null?void 0:n.spaceID,{saveObject:ne,isLoading:pe}=hze(ae);N.useEffect(()=>{(async()=>{if(re!=null&&re.uid)try{const de=await lN(re.uid,"disruptiveAdmin");K(de)}catch(de){console.error("Error checking admin status:",de),K(!1)}})()},[re==null?void 0:re.uid]),N.useEffect(()=>{const se=de=>{z(de.detail.enabled)};return window.addEventListener("editModeChanged",se),()=>{window.removeEventListener("editModeChanged",se)}},[]);const X=(se,de)=>{f(he=>({...he,[se]:parseFloat(de)}))},J=async()=>{$.log("Placing prefab with values:",{prefabName:I,position:d,rotation:_,scale:b,useDirect:L,spaceId:ae});let se;if(L?(se=i(I,d,_,b),$.log("Used direct method to place prefab")):(se=t(I,d,_,b),$.log("Used hook method to place prefab")),se)if(ae&&F){const de=await ne(I,d,_,b);l(de?{title:"Success",description:"Prefab placed and saved to space",status:"success",duration:3e3,isClosable:!0}:{title:"Warning",description:"Prefab placed but failed to save to space",status:"warning",duration:3e3,isClosable:!0})}else l({title:"Success",description:"Prefab placed",status:"success",duration:3e3,isClosable:!0});else l({title:"Error",description:"Failed to place prefab",status:"error",duration:3e3,isClosable:!0})},Q=()=>{const se={x:(Math.random()*10-5).toFixed(2),y:(Math.random()*2).toFixed(2),z:(Math.random()*10-5).toFixed(2)};f({x:parseFloat(se.x),y:parseFloat(se.y),z:parseFloat(se.z)}),$.log("Set random position:",se)};return!F||!Z?null:T.jsxs(ft,{className:"prefab-placer",bg:"rgba(0, 0, 0, 0.7)",color:"white",p:4,borderRadius:"md",maxW:"300px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",children:[T.jsx(at,{fontWeight:"bold",mb:2,children:"Place Prefab in Unity"}),T.jsxs(ft,{mb:3,children:[T.jsx(at,{fontSize:"sm",children:"Prefab Name:"}),T.jsx("input",{type:"text",value:I,onChange:se=>O(se.target.value),style:{width:"100%",padding:"8px",marginTop:"4px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:"4px",color:"white"}})]}),T.jsxs(ji,{direction:"column",gap:2,mb:3,children:[T.jsx(at,{fontSize:"sm",children:"Position:"}),T.jsxs(ji,{gap:2,children:[T.jsxs(ft,{children:[T.jsx(at,{fontSize:"xs",children:"X"}),T.jsxs(Ls,{value:d.x,onChange:se=>X("x",se),step:.5,precision:2,size:"sm",children:[T.jsx(Us,{bg:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.3)"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]})]}),T.jsxs(ft,{children:[T.jsx(at,{fontSize:"xs",children:"Y"}),T.jsxs(Ls,{value:d.y,onChange:se=>X("y",se),step:.5,precision:2,size:"sm",children:[T.jsx(Us,{bg:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.3)"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]})]}),T.jsxs(ft,{children:[T.jsx(at,{fontSize:"xs",children:"Z"}),T.jsxs(Ls,{value:d.z,onChange:se=>X("z",se),step:.5,precision:2,size:"sm",children:[T.jsx(Us,{bg:"rgba(255, 255, 255, 0.1)",borderColor:"rgba(255, 255, 255, 0.3)"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]})]})]}),T.jsx(Jn,{onClick:Q,size:"xs",colorScheme:"blue",variant:"outline",mt:1,children:"Random Position"})]}),T.jsxs(kr,{display:"flex",alignItems:"center",mb:3,children:[T.jsx(Gi,{htmlFor:"use-direct",mb:"0",fontSize:"sm",children:"Use Direct Method"}),T.jsx(hp,{id:"use-direct",colorScheme:"green",isChecked:L,onChange:se=>M(se.target.checked)})]}),T.jsx(Jn,{onClick:J,colorScheme:"green",width:"100%",isDisabled:!a||pe,children:pe?"Loading...":"Place Prefab"}),!a&&T.jsx(at,{fontSize:"xs",color:"red.300",mt:1,children:"Waiting for Unity to load..."}),!ae&&T.jsx(at,{fontSize:"xs",color:"yellow.300",mt:1,children:"No space ID available - prefabs won't be saved"})]})};zoe.propTypes={settings:Sn.shape({spaceID:Sn.string})};function E8e(n,t,i){const a=N.useRef();N.useEffect(()=>(a.current&&clearTimeout(a.current),a.current=setTimeout(n,t),()=>clearTimeout(a.current)),i)}const v8e=({isOpen:n,onClose:t,portal:i,spaceId:a,style:l})=>{if(!n||!i)return null;const[d,f]=N.useState({x:0,y:1.5,z:0}),[_,v]=N.useState({x:0,y:0,z:0}),[b,C]=N.useState({x:1,y:1,z:1}),I=ac(),O=Na();N.useEffect(()=>{i&&(f(i.position||{x:0,y:1.5,z:0}),v(i.rotation||{x:0,y:0,z:0}),C(i.scale||{x:1,y:1,z:1}))},[i]),N.useEffect(()=>{I("UpdatePortalTransform",{portalId:i.portalId,position:d,rotation:_,scale:b})},[d,_,b,i.portalId,I]),E8e(()=>{const M={...i,position:d,rotation:_,scale:b};pQ(a,i.portalId,M)},300,[d,_,b,a,i.portalId]);const L=async()=>{try{if(I("DeletePortal",{portalId:i.portalId}),await pQ(a,i.portalId,null))O({title:"Portal Deleted",description:"The portal has been removed.",status:"success",duration:3e3,isClosable:!0}),t();else throw new Error("Failed to delete portal from Firebase")}catch{O({title:"Delete Error",description:"Failed to delete portal. Please try again.",status:"error",duration:5e3,isClosable:!0})}};return T.jsxs(ft,{position:"absolute",top:"72px",right:"24px",zIndex:2e3,minW:"340px",maxW:"360px",bg:"rgba(255,255,255,0.15)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.18)",borderRadius:"2xl",p:6,border:"1px solid rgba(255,255,255,0.2)",style:{backdropFilter:"blur(18px)",WebkitBackdropFilter:"blur(18px)",...l},color:"gray.900",children:[T.jsx(ft,{fontWeight:"bold",fontSize:"lg",mb:2,children:"Edit Portal"}),T.jsxs(pi,{spacing:4,align:"stretch",children:[T.jsxs(kr,{children:[T.jsx(Gi,{children:"Position"}),T.jsxs(yr,{children:[T.jsxs(Ls,{value:d.x,onChange:(M,F)=>f(z=>({...z,x:F})),step:.1,precision:2,children:[T.jsx(Us,{placeholder:"X"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]}),T.jsxs(Ls,{value:d.y,onChange:(M,F)=>f(z=>({...z,y:F})),step:.1,precision:2,children:[T.jsx(Us,{placeholder:"Y"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]}),T.jsxs(Ls,{value:d.z,onChange:(M,F)=>f(z=>({...z,z:F})),step:.1,precision:2,children:[T.jsx(Us,{placeholder:"Z"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]})]})]}),T.jsxs(kr,{children:[T.jsx(Gi,{children:"Rotation"}),T.jsxs(yr,{children:[T.jsxs(Ls,{value:_.x,onChange:(M,F)=>v(z=>({...z,x:F})),step:1,children:[T.jsx(Us,{placeholder:"X"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]}),T.jsxs(Ls,{value:_.y,onChange:(M,F)=>v(z=>({...z,y:F})),step:1,children:[T.jsx(Us,{placeholder:"Y"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]}),T.jsxs(Ls,{value:_.z,onChange:(M,F)=>v(z=>({...z,z:F})),step:1,children:[T.jsx(Us,{placeholder:"Z"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]})]})]}),T.jsxs(kr,{children:[T.jsx(Gi,{children:"Scale"}),T.jsxs(yr,{children:[T.jsxs(Ls,{value:b.x,onChange:(M,F)=>C(z=>({...z,x:F})),step:.1,precision:2,min:.1,children:[T.jsx(Us,{placeholder:"X"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]}),T.jsxs(Ls,{value:b.y,onChange:(M,F)=>C(z=>({...z,y:F})),step:.1,precision:2,min:.1,children:[T.jsx(Us,{placeholder:"Y"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]}),T.jsxs(Ls,{value:b.z,onChange:(M,F)=>C(z=>({...z,z:F})),step:.1,precision:2,min:.1,children:[T.jsx(Us,{placeholder:"Z"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]})]})]}),T.jsx(yr,{spacing:4,width:"100%",justify:"flex-end",children:T.jsx(Jn,{colorScheme:"red",onClick:L,variant:"outline",children:"Delete Portal"})}),T.jsx(Jn,{mt:2,variant:"ghost",colorScheme:"whiteAlpha",onClick:t,children:"Close"})]})]})},S8e=n=>{if(!n)return null;try{if(n.includes("firebasestorage.googleapis.com")){const t=new URL(n),i=t.searchParams.get("alt"),a=t.searchParams.get("token");return t.search="",i&&t.searchParams.set("alt",i),a&&t.searchParams.set("token",a),console.log(`Cleaned Firebase URL from ${n} to ${t.toString()}`),t.toString()}return n}catch(t){return console.error("Error cleaning Firebase URL:",t),n}},b8e=()=>{const{spaceID:n}=Qo(),t=ac(),[i,a]=N.useState(!1);N.useEffect(()=>{if(window.isPlayerInstantiated){$.log("useUnityPortalImages: Unity already ready (via window flag)"),a(!0);return}const l=()=>{$.log("useUnityPortalImages: Unity is now ready (PlayerInstantiated event)"),a(!0)};return window.addEventListener("PlayerInstantiated",l),()=>{window.removeEventListener("PlayerInstantiated",l)}},[]),N.useEffect(()=>{if(!i){$.log("useUnityPortalImages: Waiting for Unity to be ready before loading portal images");return}$.log("useUnityPortalImages: Unity is ready, now loading portal images"),(async()=>{try{if(!n)throw new Error("spaceID is not defined.");const d=Ql(zn,"spaces",n,"portals"),f=await qu(d);if(f.empty){$.log("useUnityPortalImages: No portals found for space:",n);return}$.log(`useUnityPortalImages: Found ${f.size} portals for space ${n}`);for(const _ of f.docs){const v=_.data(),b=v.portalId,C=v.targetSpaceId;if(!C){$.warn(`useUnityPortalImages: No target space ID found for portal: ${b}`);continue}const I=await Gu(C);if(!I){$.warn(`useUnityPortalImages: No space data found for target space: ${C}`);continue}const O=I.backgroundUrl||I.backgroundGsUrl;if(!O){$.warn(`useUnityPortalImages: No background image URL found for target space: ${C}`);continue}const L=S8e(O);t("SetPortalImage",JSON.stringify({portalId:b,imageUrl:L})),$.log(`Sent portal image data to Unity for portal ${b}: ${L}`)}}catch(d){$.error("Error fetching portal images:",d)}})()},[t,n,i])},T8e=()=>(b8e(),null);function w8e(n,t,i){const a=N.useRef();N.useEffect(()=>(a.current&&clearTimeout(a.current),a.current=setTimeout(n,t),()=>clearTimeout(a.current)),i)}const C8e=({isOpen:n,onClose:t,item:i,spaceId:a,style:l})=>{if(!n||!i)return null;const[d,f]=N.useState({x:0,y:0,z:0}),[_,v]=N.useState({x:0,y:0,z:0}),[b,C]=N.useState({x:1,y:1,z:1}),I=ac(),O=Na();N.useEffect(()=>{i&&(f(i.position||{x:0,y:0,z:0}),v(i.rotation||{x:0,y:0,z:0}),C(i.scale||{x:1,y:1,z:1}))},[i]),N.useEffect(()=>{I("UpdateCatalogueItem",{hotspotId:i.hotspotId,position:d,rotation:_,scale:b})},[d,_,b,i.hotspotId,I]),w8e(()=>{const M=gr(zn,"spaces",a,"catalogue",i.hotspotId);Gs(M,{position:d,rotation:_,scale:b,updatedAt:Date.now()})},300,[d,_,b,a,i.hotspotId]);const L=async()=>{try{I("DeleteCatalogueItem",{hotspotId:i.hotspotId});const M=gr(zn,"spaces",a,"catalogue",i.hotspotId);await Gs(M,{deleted:!0}),O({title:"Item Deleted",description:"The item has been removed.",status:"success",duration:3e3,isClosable:!0}),t()}catch{O({title:"Delete Error",description:"Failed to delete item. Please try again.",status:"error",duration:5e3,isClosable:!0})}};return T.jsxs(ft,{position:"absolute",top:"72px",right:"24px",zIndex:2e3,minW:"340px",maxW:"360px",bg:"rgba(255,255,255,0.15)",boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.18)",borderRadius:"2xl",p:6,border:"1px solid rgba(255,255,255,0.2)",style:{backdropFilter:"blur(18px)",WebkitBackdropFilter:"blur(18px)",...l},color:"gray.900",children:[T.jsx(ft,{fontWeight:"bold",fontSize:"lg",mb:2,children:"Edit Catalogue Item"}),T.jsxs(pi,{spacing:4,align:"stretch",children:[T.jsxs(kr,{children:[T.jsx(Gi,{children:"Position"}),T.jsxs(yr,{children:[T.jsxs(Ls,{value:d.x,onChange:(M,F)=>f(z=>({...z,x:F})),step:.1,precision:2,children:[T.jsx(Us,{placeholder:"X"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]}),T.jsxs(Ls,{value:d.y,onChange:(M,F)=>f(z=>({...z,y:F})),step:.1,precision:2,children:[T.jsx(Us,{placeholder:"Y"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]}),T.jsxs(Ls,{value:d.z,onChange:(M,F)=>f(z=>({...z,z:F})),step:.1,precision:2,children:[T.jsx(Us,{placeholder:"Z"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]})]})]}),T.jsxs(kr,{children:[T.jsx(Gi,{children:"Rotation"}),T.jsxs(yr,{children:[T.jsxs(Ls,{value:_.x,onChange:(M,F)=>v(z=>({...z,x:F})),step:1,children:[T.jsx(Us,{placeholder:"X"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]}),T.jsxs(Ls,{value:_.y,onChange:(M,F)=>v(z=>({...z,y:F})),step:1,children:[T.jsx(Us,{placeholder:"Y"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]}),T.jsxs(Ls,{value:_.z,onChange:(M,F)=>v(z=>({...z,z:F})),step:1,children:[T.jsx(Us,{placeholder:"Z"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]})]})]}),T.jsxs(kr,{children:[T.jsx(Gi,{children:"Scale"}),T.jsxs(yr,{children:[T.jsxs(Ls,{value:b.x,onChange:(M,F)=>C(z=>({...z,x:F})),step:.1,precision:2,min:.1,children:[T.jsx(Us,{placeholder:"X"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]}),T.jsxs(Ls,{value:b.y,onChange:(M,F)=>C(z=>({...z,y:F})),step:.1,precision:2,min:.1,children:[T.jsx(Us,{placeholder:"Y"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]}),T.jsxs(Ls,{value:b.z,onChange:(M,F)=>C(z=>({...z,z:F})),step:.1,precision:2,min:.1,children:[T.jsx(Us,{placeholder:"Z"}),T.jsxs(Ms,{children:[T.jsx(js,{}),T.jsx(Vs,{})]})]})]})]}),T.jsx(yr,{spacing:4,width:"100%",justify:"flex-end",children:T.jsx(Jn,{colorScheme:"red",onClick:L,variant:"outline",children:"Delete Item"})}),T.jsx(Jn,{mt:2,variant:"ghost",colorScheme:"whiteAlpha",onClick:t,children:"Close"})]})]})};function R8e(){const{clickedItem:n,clearClickedItem:t}=hoe(),[i,a]=N.useState(!1);N.useEffect(()=>{const f=_=>{_!=null&&_.detail&&typeof _.detail.enabled=="boolean"&&(a(_.detail.enabled),_.detail.enabled||t())};return window.addEventListener("editModeChanged",f),()=>window.removeEventListener("editModeChanged",f)},[t]);const l=()=>{t()};let d="";if(n!=null&&n.hotspotId){const f=n.hotspotId.split("_");f.length>=3&&(d=f.slice(1,-1).join("_"))}return T.jsx(T.Fragment,{children:n&&i&&T.jsx(C8e,{isOpen:!!n&&i,onClose:l,item:n,spaceId:d})})}const I8e="9442a472625f44e7b2c5065b9f9b3988",gU=()=>document.querySelector("canvas")||document.getElementById("unity-canvas"),J3=N.forwardRef(({settings:n},t)=>{const{unityProvider:i,isLoaded:a,error:l}=Qo(),d=X6e();Q6e();const f=ac(),_=yze(d),{user:v}=N.useContext(Nc),[b,C]=N.useState(!1),[I,O]=N.useState(window.devicePixelRatio),[L,M]=J6e();coe().find(kt=>kt.isLocalPlayer);const[z,Z]=N.useState(!0),[K,re]=N.useState(!0),ae=n.spaceID||"default";gze(),fze(ae);const[ne,pe]=N.useState(!1),[X,J]=N.useState(!1),[Q,se]=N.useState(!1),de=N.useMemo(()=>{const lt=new URLSearchParams(window.location.search).get("sessionId")||ae;return console.log("WebGLRenderer: Using session ID:",lt),lt},[ae]),[he,le]=N.useState(null);N.useEffect(()=>{v!=null&&v.uid&&Yu(v.uid).then(kt=>{le(kt),console.log("WebGLRenderer: User profile loaded:",(kt==null?void 0:kt.Nickname)||"Unknown")}).catch(kt=>{console.error("Error fetching user profile:",kt)})},[v==null?void 0:v.uid]),N.useEffect(()=>{if(l||!v){console.log("WebGLRenderer: User not logged in or Unity error, showing sign-in modal");const kt=setTimeout(()=>{J(!0),se(!0)},1e3);return()=>clearTimeout(kt)}else J(!1)},[l,v]),N.useEffect(()=>{console.log("WebGLRenderer: Setting up player instantiation listener");const kt=()=>{console.log("WebGLRenderer: Player instantiated event received"),re(!0),window.dispatchEvent(new CustomEvent("PlayerInstantiated")),window.isPlayerInstantiated=!0};window.isPlayerInstantiated&&(console.log("WebGLRenderer: Player was already instantiated from previous mount"),re(!0)),Gd.subscribe(Wd.playerInstantiated,kt);const He=setTimeout(()=>{K||(console.log("WebGLRenderer: Forcing player instantiation after timeout"),re(!0),window.isPlayerInstantiated=!0,window.dispatchEvent(new CustomEvent("PlayerInstantiated")))},5e3);return()=>{Gd.unsubscribe(Wd.playerInstantiated,kt),clearTimeout(He)}},[K]),N.useEffect(()=>{const kt=()=>{console.log("WebGLRenderer: Modal opened"),se(!0)},He=()=>{console.log("WebGLRenderer: Modal closed"),se(!1)};return window.addEventListener("modal-opened",kt),window.addEventListener("modal-closed",He),()=>{window.removeEventListener("modal-opened",kt),window.removeEventListener("modal-closed",He)}},[]),N.useEffect(()=>{se(L!==null)},[L]),N.useEffect(()=>{a||d?setTimeout(()=>{C(!0),console.log("WebGLRenderer: Unity is ready to receive messages.")},5e3):console.warn("WebGLRenderer: Unity is NOT ready yet.")},[a,d]),N.useEffect(()=>{a&&i&&setTimeout(()=>{if(window.unityInstance)try{console.log("WebGLRenderer: Disabling Unity keyboard capture on initialization"),window.unityInstance.SendMessage("WebGLInput","SetCaptureAllKeyboardInput",!1)}catch(kt){console.error("WebGLRenderer: Error disabling Unity keyboard capture:",kt)}},1e3)},[a,i]),N.useEffect(()=>{const kt=document.getElementById("webgl-root");return kt?(console.log("WebGLRenderer: Found webgl-root element, ensuring it is visible"),kt.style.display="block",kt.getAttribute("data-space-id")!==ae&&(kt.setAttribute("data-space-id",ae),console.log(`WebGLRenderer: Set data-space-id attribute to ${ae}`))):console.error("WebGLRenderer: Could not find webgl-root element"),()=>{}},[ae]),N.useEffect(()=>{const kt=()=>{const mt=gU();mt?(console.log("WebGLRenderer: Configuring Unity canvas for keyboard input"),mt.tabIndex=1,mt.style.outline="none",mt.addEventListener("click",()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),Q||Yw(!0)}),console.log("WebGLRenderer: Unity canvas configured with tabIndex=1")):console.warn("WebGLRenderer: Could not find Unity canvas to configure")};kt();const He=setTimeout(kt,1e3),lt=()=>{console.log("WebGLRenderer: Received unityReady event, configuring canvas"),kt()};return window.addEventListener("unityReady",lt),()=>{clearTimeout(He),window.removeEventListener("unityReady",lt)}},[a,Q]);const Oe=N.useCallback(()=>{console.log("WebGLRenderer: Unity canvas clicked, enabling keyboard capture"),Q||Yw(!0)},[Q]);N.useEffect(()=>{if(a&&i){const kt=gU();if(kt)return console.log("WebGLRenderer: Adding click handler to Unity canvas"),kt.addEventListener("click",Oe),()=>{kt.removeEventListener("click",Oe)}}},[a,i,Oe]),N.useEffect(()=>{if(a&&i){console.log("WebGLRenderer: Setting up global click handler for focus management");const kt=He=>{if(Q){console.log("WebGLRenderer: Modal is open, not refocusing Unity on click");return}if(He.target.tagName==="INPUT"||He.target.tagName==="TEXTAREA"||He.target.tagName==="SELECT"||He.target.tagName==="BUTTON"){console.log("WebGLRenderer: Clicked on form element, not refocusing Unity");return}if(He.target.closest(".chakra-modal__content")||He.target.closest('[role="dialog"]')||He.target.closest('[role="menu"]')||He.target.closest(".chakra-popover__content")||He.target.closest('[role="tooltip"]')){console.log("WebGLRenderer: Clicked inside modal/dialog content, not refocusing Unity");return}const lt=gU();if(lt&&(He.target===lt||lt.contains(He.target)))return;if(He.target.closest(".webgl-overlay")||He.target.closest(".game-ui")||He.target.closest(".player-list")||He.target.closest(".unity-ui-overlay")){console.log("WebGLRenderer: Clicked on UI overlay that should allow keyboard events"),setTimeout(()=>{Q||Yw(!0)},50);return}console.log("WebGLRenderer: Clicked outside forms/modals/special UI, refocusing Unity canvas"),setTimeout(()=>{lt&&!Q&&((lt.tabIndex===void 0||lt.tabIndex<0)&&(lt.tabIndex=1),lt.focus(),Yw(!0))},50)};return document.addEventListener("click",kt,!0),()=>{document.removeEventListener("click",kt,!0)}}},[a,i,Q]),N.useEffect(()=>{const kt=He=>{console.log("WebGLRenderer: Received 'sendUserToUnity' event"),f("FirebaseUserFromReact",He)};return Gd.subscribe(Wd.sendUserToUnity,kt),()=>Gd.unsubscribe(Wd.sendUserToUnity,kt)},[f]);const{setFullscreenRef:Ve,fullscreenRef:xe}=Yd();N.useEffect(()=>{Ve(t.current)},[t,Ve]);const Re=()=>{Z(!z)},ve=v&&n.enableVoiceChat;console.log("WebGLRenderer: Render with state:",{user:!!v,userId:v==null?void 0:v.uid,isPlayerInstantiated:K,showVoiceChat:ve,sessionId:de}),N.useEffect(()=>{const kt=He=>{console.log("Edit mode changed event:",He.detail),pe(He.detail.enabled)};return window.addEventListener("editModeChanged",kt),()=>{window.removeEventListener("editModeChanged",kt)}},[]),aoe(),nze();const be=N.useRef(null),{clickedPortal:ze,clearClickedPortal:Pe}=mze(),[we,ke]=N.useState(!1),[Ue,Be]=N.useState(!1),[qe,$e]=N.useState(""),[it,Je]=N.useState("");N.useEffect(()=>{async function kt(){if($e(""),Je(""),ze&&!ne){let He=ze.targetSpaceId;if(!He&&ze.portalId)try{const lt=gr(zn,"spaces",ae,"portals",ze.portalId),mt=await go(lt);mt.exists()&&(He=mt.data().targetSpaceId)}catch{}if(He)try{const lt=await Gu(He);$e((lt==null?void 0:lt.name)||He),Je((lt==null?void 0:lt.slug)||""),Be(!0)}catch{$e(He),Je(""),Be(!0)}else $e(""),Je(""),Be(!0)}}ze&&ne&&ke(!0),ze&&!ne&&kt()},[ze,ne,ae]);const Ct=()=>{console.log("Closing portal editor"),ke(!1),Pe()};return console.log("WebGLRenderer render state:",{isPortalEditorOpen:we,clickedPortal:ze,isEditMode:ne}),_ze(ae),hoe(),T.jsxs(ft,{className:"webgl-renderer",children:[n.urlLoadingBackground&&T.jsx(joe,{backgroundUrl:n.urlLoadingBackground,videoBackgroundUrl:n.videoBackgroundUrl,containerRef:be}),!X&&T.jsx(Foe,{containerRef:be}),X&&T.jsx(ft,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:"100",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",children:T.jsx(Y3,{mode:"button",label:"Sign In",initialIsOpen:!0,buttonProps:{size:"lg",colorScheme:"blue"}})}),T.jsx(R8e,{spaceId:ae,isEditMode:ne}),T.jsx(wj,{containerRef:xe.current?xe:document.body,children:T.jsxs("div",{ref:t,style:{width:"100%",height:"100%",aspectRatio:"auto",position:"absolute"},children:[T.jsxs(ft,{position:"absolute",zIndex:"10",top:4,right:4,display:"flex",alignItems:"center",gap:2,children:[n.showAuthButton&&T.jsx(iWe,{}),v&&T.jsx(y8e,{size:"md"}),ve&&T.jsxs(Doe,{appId:I8e,channel:de,uid:v==null?void 0:v.uid,enabled:!0,children:[T.jsx(LWe,{size:"md",defaultMuted:!0,joinOnClick:!0}),T.jsx(UWe,{userNickname:he==null?void 0:he.Nickname})]}),T.jsx(bWe,{}),T.jsx(ft,{position:"relative",zIndex:"9999",children:T.jsx(o8e,{onTogglePlayerList:Re,spaceID:ae})})]}),T.jsxs(ft,{ref:be,position:"relative",overflow:"hidden",width:"100%",height:"100%",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",bgColor:"#666666",children:[T.jsx(ft,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.1)",zIndex:"0"}),T.jsx(ft,{..._,width:"100%",height:"100%",position:"absolute",zIndex:"1",children:i?T.jsx(soe.Unity,{unityProvider:i,style:{width:"100%",height:"100%"},devicePixelRatio:I,tabIndex:1}):T.jsx(ft,{width:"100%",height:"100%"})}),T.jsx(ft,{position:"absolute",zIndex:"6",width:"100%",height:"100%",style:{display:"none"},children:T.jsx(rWe,{})})]}),T.jsx(ft,{..._,position:"absolute",zIndex:"2",top:4,left:4,display:"flex",alignItems:"flex-start",gap:3,height:"50px",children:n.showDisruptiveLogo&&T.jsx(rp,{src:n.urlDisruptiveLogo,width:"100px",alt:"Disruptive Logo"})}),T.jsx(ft,{..._,position:"absolute",zIndex:"2",bottom:4,left:4,display:"flex",alignItems:"flex-start",gap:3,children:v&&T.jsx(zoe,{settings:n})}),T.jsxs(ft,{..._,position:"absolute",zIndex:"2",bottom:4,right:4,display:"flex",alignItems:"flex-start",gap:3,children:[n.showHelpButton&&T.jsx(sWe,{}),T.jsx(CWe,{})]}),T.jsx(RWe,{}),T.jsx(IWe,{isOpen:L!==null,onClose:()=>{console.log(" Closing nameplate modal"),M()},playerName:(L==null?void 0:L.playerName)||"Unknown Player",playerId:(L==null?void 0:L.playerId)||"Unknown ID"}),T.jsx(AWe,{isVisible:z,onToggleVisibility:Z,spaceID:ae}),T.jsx(f8e,{}),T.jsx(ft,{position:"absolute",top:4,right:4,zIndex:1e3,children:we&&ze&&T.jsx(v8e,{isOpen:we,onClose:Ct,portal:ze,spaceId:ae})}),!ne&&Ue&&T.jsxs(Fs,{isOpen:Ue,onClose:()=>{Be(!1),Pe(),$e(""),Je("")},isCentered:!0,children:[T.jsx(Ws,{}),T.jsxs(Bs,{bg:"#181818",borderRadius:"2xl",boxShadow:"2xl",maxW:"420px",p:0,children:[T.jsx(xo,{textAlign:"center",fontWeight:"extrabold",fontSize:"2xl",color:"white",pt:8,pb:4,children:qe?`Visit ${qe}?`:"Visit Space?"}),T.jsx(io,{color:"white",top:4,right:4}),T.jsx(zs,{pb:8,pt:2,px:8,children:T.jsxs(ji,{mt:4,gap:6,justify:"center",children:[T.jsx(Jn,{variant:"outline",borderColor:"whiteAlpha.400",color:"white",fontWeight:"bold",borderRadius:"2xl",px:10,py:6,fontSize:"lg",onClick:()=>{Be(!1),Pe(),$e(""),Je("")},_hover:{bg:"whiteAlpha.100"},children:"Cancel"}),T.jsx(Jn,{colorScheme:"whiteAlpha",bg:"white",color:"#181818",fontWeight:"bold",borderRadius:"2xl",px:10,py:6,fontSize:"lg",onClick:()=>{it&&window.open(`https://www.spacesmetaverse.com/w/${it}`,"_blank","noopener"),Be(!1),Pe(),$e(""),Je("")},_hover:{bg:"gray.100"},children:"Visit"})]})})]})]}),T.jsx(T8e,{})]})})]})});J3.displayName="WebGLRenderer";J3.propTypes={settings:Sn.shape({urlLoadingBackground:Sn.string,videoBackgroundUrl:Sn.string,showAuthButton:Sn.bool,showDisruptiveLogo:Sn.bool,urlDisruptiveLogo:Sn.string,showHelpButton:Sn.bool,enableVoiceChat:Sn.bool,spaceID:Sn.string})};typeof window<"u"&&!window.MultipleView&&(console.log("Defining fallback MultipleView class - scripts may not be loaded yet"),window.MultipleView=class{constructor(){console.log("HISPlayer: Fallback MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from fallback"),{isPlaying:!1,play:()=>(console.log("HISPlayer: play called"),!0),pause:()=>(console.log("HISPlayer: pause called"),!0),mute:t=>(console.log("HISPlayer: mute called with state:",t),!0),isMuted:!1,seek:t=>(console.log("HISPlayer: seek called with time:",t),!0),setVolume:t=>(console.log("HISPlayer: setVolume called with volume:",t),!0),getVolume:()=>(console.log("HISPlayer: getVolume called"),1),getCurrentTime:()=>(console.log("HISPlayer: getCurrentTime called"),0),getDuration:()=>(console.log("HISPlayer: getDuration called"),100)}),initialize:()=>(console.log("HISPlayer: initialize called"),!0),setUnityContext:t=>(console.log("HISPlayer: setUnityContext called with:",t),window.hisPlayerContextId=t,!0),release:()=>(console.log("HISPlayer: release called"),!0),setProperties:t=>(console.log("HISPlayer: setProperties called with:",t),!0),setMultiPaths:t=>(console.log("HISPlayer: setMultiPaths called with:",t),window._hisplayer_paths=t,!0)}}});if(typeof window<"u"&&!window._hisPlayerInitialized){if($.log("WebGLLoader: Initializing HISPlayer functions"),window._hisPlayerInitialized=!0,window._hisplayer_event_queue=window._hisplayer_event_queue||[],window._hisplayer_error_queue=window._hisplayer_error_queue||[],!document.getElementById("hisplayer-error")){const n=document.createElement("div");n.id="hisplayer-error",n.style.position="absolute",n.style.top="10px",n.style.left="50%",n.style.transform="translateX(-50%)",n.style.color="red",n.style.zIndex="9999",document.body.appendChild(n),$.log("WebGLLoader: Created hisplayer-error div")}window.isErrorQueueEmpty=window.isErrorQueueEmpty||function(){return window._hisplayer_error_queue.length===0},window.getNextError=window.getNextError||function(){return window._hisplayer_error_queue.length>0?window._hisplayer_error_queue.shift():""},window.isEventQueueEmpty=window.isEventQueueEmpty||function(){return window._hisplayer_event_queue.length===0},window.getNextEvent=window.getNextEvent||function(){return window._hisplayer_event_queue.length>0?window._hisplayer_event_queue.shift():""},window.setUpContext=window.setUpContext||function(n){console.log("HISPlayer: setUpContext called with contextId:",n),window.hisPlayerContextId=n;try{if(window.MultipleView){console.log("HISPlayer: Creating MultipleView instance");const t=new window.MultipleView;if(t&&t.multiView&&typeof t.multiView.setUnityContext=="function")return t.multiView.setUnityContext(n),window._hisplayer_instance=t,console.log("HISPlayer: Successfully set Unity context ID"),!0;console.error("HISPlayer: Player initialization failed - missing expected methods")}else{console.error("HISPlayer: MultipleView class not found"),window.MultipleView=class{constructor(){console.log("HISPlayer: Backup MultipleView constructor called"),this.multiView={getPlayer:()=>(console.log("HISPlayer: getPlayer called from backup"),{isPlaying:!1,play:()=>!0,pause:()=>!0,mute:()=>!0,isMuted:!1,seek:()=>!0,setVolume:()=>!0,getVolume:()=>1,getCurrentTime:()=>0,getDuration:()=>100}),initialize:()=>!0,setUnityContext:a=>(window.hisPlayerContextId=a,!0),release:()=>!0,setProperties:()=>!0,setMultiPaths:()=>!0}}},console.log("HISPlayer: Trying again with backup MultipleView");const t=new window.MultipleView;return t.multiView.setUnityContext(n),window._hisplayer_instance=t,!0}}catch(t){console.error("HISPlayer: Error in setUpContext:",t);const i=document.getElementById("hisplayer-error");i&&(i.innerHTML="Error: "+t.message)}return!1}}const Woe=({spaceID:n,overrideSettings:t})=>{const i=N.useRef(null),[a,l]=N.useState(!0),[d,f]=N.useState({spaceID:n,loaderUrl:"",dataUrl:"",frameworkUrl:"",codeUrl:""}),[_,v]=N.useState({urlDisruptiveLogo:"gs://disruptive-metaverse.appspot.com/common/images/Disruptive-logo-white-p-500.png",urlLoadingBackground:"",videoBackgroundUrl:"",showDisruptiveLogo:null,showAuthButton:null,showHelpButton:null,enableVoiceChat:!0,spaceID:n});return N.useEffect(()=>{(async()=>{try{const C=await Gu(n);if(C){console.log("Space data: ",C),f(M=>({...M,spaceID:n,loaderUrl:C.loaderUrl,dataUrl:C.dataUrl,frameworkUrl:C.frameworkUrl,codeUrl:C.codeUrl}));const I=await fk(_.urlDisruptiveLogo);let O="";if(C.backgroundUrl)O=C.backgroundUrl;else if(C.backgroundGsUrl)try{O=await fk(C.backgroundGsUrl)}catch(M){$.warn("WebGLLoader: Error fetching background from GS URL:",M)}else if(C.gsUrlLoadingBackground)try{O=await fk(C.gsUrlLoadingBackground)}catch(M){$.warn("WebGLLoader: Error fetching background from legacy GS URL:",M)}let L="";C.videoBackgroundUrl&&(L=C.videoBackgroundUrl,console.log("WebGLLoader: Found video background URL:",L)),v(M=>({...M,urlLoadingBackground:O,videoBackgroundUrl:L,showAuthButton:C.showAuthButton!==void 0?C.showAuthButton:!0,showDisruptiveLogo:C.showDisruptiveLogo!==void 0?C.showDisruptiveLogo:!0,showHelpButton:C.showHelpButton!==void 0?C.showHelpButton:!0,enableVoiceChat:C.enableVoiceChat!==void 0?C.enableVoiceChat:!0,urlDisruptiveLogo:I,spaceID:n,...t||{}})),L&&(console.log("WebGLLoader: Dispatching video background event with URL:",L),window.dispatchEvent(new CustomEvent("SpaceVideoBackgroundUpdated",{detail:{videoBackgroundUrl:L}}))),l(!1)}else $.error(`WebGLLoader: No configuration found for spaceID: ${n}`)}catch(C){$.error("WebGLLoader: Error fetching space data:",C)}finally{l(!1)}})()},[n,_.urlDisruptiveLogo,t]),N.useEffect(()=>{a||($.log("WebGLLoader: Unity config from Firebase",d),$.log("WebGLLoader: Space settings from Firebase",_))},[a]),T.jsx(T.Fragment,{children:a?T.jsx("div",{className:"flex justify-center items-center h-full mt-12",children:"Getting space data..."}):T.jsx(Y6e,{...d,children:T.jsx(J3,{ref:i,settings:_})})})};Woe.propTypes={spaceID:Sn.string.isRequired,overrideSettings:Sn.object};function _Q(){const n=document.getElementById("webgl-root");if(n){const t=n.getAttribute("data-space-id"),i=n.getAttribute("data-theme")||"default",a=()=>{const[l,d]=N.useState(null);return N.useEffect(()=>{KMe(i).then(d)},[]),l?T.jsx(G1e,{theme:l,children:T.jsx(V6e,{children:T.jsx(j6e,{children:T.jsx(Woe,{spaceID:t})})})}):T.jsx("div",{children:"Loading theme..."})};try{kye.createRoot(n).render(T.jsx(a,{}))}catch(l){console.warn("Error initializing WebGL:",l)}}}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",_Q):_Q());export{$ye as a,ySe as b,$i as c,mSe as d,P8e as e,A8e as f,aSe as g,Bu as i,ep as m,gRe as t};
